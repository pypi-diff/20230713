# Comparing `tmp/sat-toolkit-0.1.2.tar.gz` & `tmp/sat-toolkit-0.2.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "sat-toolkit-0.1.2.tar", last modified: Thu Feb  2 16:32:52 2023, max compression
+gzip compressed data, was "sat-toolkit-0.2.0.tar", last modified: Thu Jul 13 09:25:38 2023, max compression
```

## Comparing `sat-toolkit-0.1.2.tar` & `sat-toolkit-0.2.0.tar`

### file list

```diff
@@ -1,20 +1,21 @@
-drwxrwxr-x   0 mnageler  (1000) mnageler  (1000)        0 2023-02-02 16:32:52.323881 sat-toolkit-0.1.2/
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)     1071 2022-11-30 12:59:13.000000 sat-toolkit-0.1.2/LICENSE
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       76 2023-02-02 16:32:19.000000 sat-toolkit-0.1.2/MANIFEST.in
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)      539 2023-02-02 16:32:52.323881 sat-toolkit-0.1.2/PKG-INFO
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       77 2022-11-30 12:59:49.000000 sat-toolkit-0.1.2/README.md
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       60 2023-01-19 16:35:36.000000 sat-toolkit-0.1.2/pyproject.toml
-drwxrwxr-x   0 mnageler  (1000) mnageler  (1000)        0 2023-02-02 16:32:52.323881 sat-toolkit-0.1.2/sat_toolkit/
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       64 2023-01-19 16:31:44.000000 sat-toolkit-0.1.2/sat_toolkit/__init__.py
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)  1633394 2023-02-02 16:02:19.000000 sat-toolkit-0.1.2/sat_toolkit/_cnf_util.cpp
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)    24314 2023-02-02 15:23:31.000000 sat-toolkit-0.1.2/sat_toolkit/_cnf_util.pyx
--rw-r--r--   0 mnageler  (1000) mnageler  (1000)     1327 2022-10-07 10:58:25.000000 sat-toolkit-0.1.2/sat_toolkit/fmt.h
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)      215 2022-09-13 12:07:45.000000 sat-toolkit-0.1.2/sat_toolkit/types.pxd
-drwxrwxr-x   0 mnageler  (1000) mnageler  (1000)        0 2023-02-02 16:32:52.323881 sat-toolkit-0.1.2/sat_toolkit.egg-info/
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)      539 2023-02-02 16:32:52.000000 sat-toolkit-0.1.2/sat_toolkit.egg-info/PKG-INFO
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)      343 2023-02-02 16:32:52.000000 sat-toolkit-0.1.2/sat_toolkit.egg-info/SOURCES.txt
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)        1 2023-02-02 16:32:52.000000 sat-toolkit-0.1.2/sat_toolkit.egg-info/dependency_links.txt
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       12 2023-02-02 16:32:52.000000 sat-toolkit-0.1.2/sat_toolkit.egg-info/requires.txt
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       12 2023-02-02 16:32:52.000000 sat-toolkit-0.1.2/sat_toolkit.egg-info/top_level.txt
--rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       38 2023-02-02 16:32:52.323881 sat-toolkit-0.1.2/setup.cfg
--rwxrwxr-x   0 mnageler  (1000) mnageler  (1000)     1041 2023-02-02 16:32:28.000000 sat-toolkit-0.1.2/setup.py
+drwxrwxr-x   0 mnageler  (1000) mnageler  (1000)        0 2023-07-13 09:25:38.803448 sat-toolkit-0.2.0/
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)     1071 2022-11-30 12:59:13.000000 sat-toolkit-0.2.0/LICENSE
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       76 2023-02-02 16:32:19.000000 sat-toolkit-0.2.0/MANIFEST.in
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)      539 2023-07-13 09:25:38.803448 sat-toolkit-0.2.0/PKG-INFO
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       77 2022-11-30 12:59:49.000000 sat-toolkit-0.2.0/README.md
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       60 2023-01-19 16:35:36.000000 sat-toolkit-0.2.0/pyproject.toml
+drwxrwxr-x   0 mnageler  (1000) mnageler  (1000)        0 2023-07-13 09:25:38.803448 sat-toolkit-0.2.0/sat_toolkit/
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)        0 2023-07-13 09:20:55.000000 sat-toolkit-0.2.0/sat_toolkit/__init__.py
+-rw-r--r--   0 mnageler  (1000) mnageler  (1000)     1327 2022-10-07 10:58:25.000000 sat-toolkit-0.2.0/sat_toolkit/fmt.h
+-rw-r--r--   0 mnageler  (1000) mnageler  (1000)  1864739 2023-07-12 20:33:02.000000 sat-toolkit-0.2.0/sat_toolkit/formula.cpp
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)    37809 2023-07-12 10:38:07.000000 sat-toolkit-0.2.0/sat_toolkit/formula.pyx
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)      215 2022-09-13 12:07:45.000000 sat-toolkit-0.2.0/sat_toolkit/types.pxd
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)     1028 2023-07-07 11:22:06.000000 sat-toolkit-0.2.0/sat_toolkit/util.py
+drwxrwxr-x   0 mnageler  (1000) mnageler  (1000)        0 2023-07-13 09:25:38.803448 sat-toolkit-0.2.0/sat_toolkit.egg-info/
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)      539 2023-07-13 09:25:38.000000 sat-toolkit-0.2.0/sat_toolkit.egg-info/PKG-INFO
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)      359 2023-07-13 09:25:38.000000 sat-toolkit-0.2.0/sat_toolkit.egg-info/SOURCES.txt
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)        1 2023-07-13 09:25:38.000000 sat-toolkit-0.2.0/sat_toolkit.egg-info/dependency_links.txt
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       12 2023-07-13 09:25:38.000000 sat-toolkit-0.2.0/sat_toolkit.egg-info/requires.txt
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       12 2023-07-13 09:25:38.000000 sat-toolkit-0.2.0/sat_toolkit.egg-info/top_level.txt
+-rw-rw-r--   0 mnageler  (1000) mnageler  (1000)       38 2023-07-13 09:25:38.803448 sat-toolkit-0.2.0/setup.cfg
+-rwxrwxr-x   0 mnageler  (1000) mnageler  (1000)     1041 2023-07-13 09:23:22.000000 sat-toolkit-0.2.0/setup.py
```

### Comparing `sat-toolkit-0.1.2/LICENSE` & `sat-toolkit-0.2.0/LICENSE`

 * *Files identical despite different names*

### Comparing `sat-toolkit-0.1.2/PKG-INFO` & `sat-toolkit-0.2.0/PKG-INFO`

 * *Files 20% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: sat-toolkit
-Version: 0.1.2
+Version: 0.2.0
 Summary: Tool for manipulating CNF formulas
 Home-page: https://github.com/fanosta/sat_toolkit
 Author: Marcel Nageler
 Author-email: marcel.nageler@iaik.tugraz.at
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
```

### Comparing `sat-toolkit-0.1.2/sat_toolkit/_cnf_util.cpp` & `sat-toolkit-0.2.0/sat_toolkit/formula.cpp`

 * *Files 9% similar despite different names*

```diff
@@ -1,39 +1,39 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.36 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "sat_toolkit/fmt.h"
         ],
         "include_dirs": [
             "sat_toolkit"
         ],
         "language": "c++",
-        "name": "sat_toolkit._cnf_util",
+        "name": "sat_toolkit.formula",
         "sources": [
-            "sat_toolkit/_cnf_util.pyx"
+            "sat_toolkit/formula.pyx"
         ]
     },
-    "module_name": "sat_toolkit._cnf_util"
+    "module_name": "sat_toolkit.formula"
 }
 END: Cython Metadata */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
+#define CYTHON_ABI "0_29_36"
+#define CYTHON_HEX_VERSION 0x001D24F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -93,18 +93,22 @@
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
   #undef CYTHON_USE_TP_FINALIZE
-  #define CYTHON_USE_TP_FINALIZE 0
+  #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1 && PYPY_VERSION_NUM >= 0x07030C00)
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
@@ -218,15 +222,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -257,15 +261,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -394,17 +398,14 @@
     operator T&() { return *ptr; }
     template<typename U> bool operator ==(U other) { return *ptr == other; }
     template<typename U> bool operator !=(U other) { return *ptr != other; }
   private:
     T *ptr;
 };
 
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
-  #define Py_OptimizeFlag 0
-#endif
 #define __PYX_BUILD_PY_SSIZE_T "n"
 #define CYTHON_FORMAT_SSIZE_T "z"
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
@@ -474,14 +475,19 @@
     }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
+#if PY_VERSION_HEX >= 0x030900F0 && !CYTHON_COMPILING_IN_PYPY
+  #define __Pyx_PyObject_GC_IsFinalized(o) PyObject_GC_IsFinalized(o)
+#else
+  #define __Pyx_PyObject_GC_IsFinalized(o) _PyGC_FINALIZED(o)
+#endif
 #ifndef Py_TPFLAGS_CHECKTYPES
   #define Py_TPFLAGS_CHECKTYPES 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_INDEX
   #define Py_TPFLAGS_HAVE_INDEX 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_NEWBUFFER
@@ -767,31 +773,31 @@
   #ifdef __cplusplus
     #define __PYX_EXTERN_C extern "C"
   #else
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
-#define __PYX_HAVE__sat_toolkit___cnf_util
-#define __PYX_HAVE_API__sat_toolkit___cnf_util
+#define __PYX_HAVE__sat_toolkit__formula
+#define __PYX_HAVE_API__sat_toolkit__formula
 /* Early includes */
+#include <string.h>
+#include <stdio.h>
+#include "pythread.h"
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
 #include <vector>
-#include <string.h>
-#include <stdio.h>
 #include <stdlib.h>
 #include "fmt.h"
 
     #define ffs(x) __builtin_ffsll(x)
     #define popcount(x) __builtin_popcountll(x)
     
-#include "pythread.h"
 #include "pystate.h"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
@@ -994,16 +1000,19 @@
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
 
 static const char *__pyx_f[] = {
-  "sat_toolkit/_cnf_util.pyx",
+  "sat_toolkit/formula.pyx",
   "stringsource",
+  "type.pxd",
+  "bool.pxd",
+  "complex.pxd",
 };
 /* MemviewSliceStruct.proto */
 struct __pyx_memoryview_obj;
 typedef struct {
   struct __pyx_memoryview_obj *memview;
   char *data;
   Py_ssize_t shape[8];
@@ -1169,100 +1178,131 @@
  * ctypedef short int16_t
  * ctypedef int int32_t
  * ctypedef long int64_t             # <<<<<<<<<<<<<<
  */
 typedef long __pyx_t_11sat_toolkit_5types_int64_t;
 
 /*--- Type declarations ---*/
-struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause;
-struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF;
-struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable;
-struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__;
-struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__;
+struct __pyx_obj_11sat_toolkit_7formula_Clause;
+struct __pyx_obj_11sat_toolkit_7formula_CNF;
+struct __pyx_obj_11sat_toolkit_7formula_Truthtable;
+struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__;
+struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__;
+struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__;
+struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__;
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
 
-/* "sat_toolkit/_cnf_util.pyx":46
+/* "sat_toolkit/formula.pyx":62
  * 
  * 
  * cdef class Clause:             # <<<<<<<<<<<<<<
  *     cdef vector[int] clause
  *     def __init__(self, clause):
  */
-struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause {
+struct __pyx_obj_11sat_toolkit_7formula_Clause {
   PyObject_HEAD
-  struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_Clause *__pyx_vtab;
+  struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause *__pyx_vtab;
   std::vector<int>  clause;
 };
 
 
-/* "sat_toolkit/_cnf_util.pyx":120
+/* "sat_toolkit/formula.pyx":220
  * 
  * 
  * cdef class CNF:             # <<<<<<<<<<<<<<
  *     """
  *     Class for storing and manipulating CNF formulas.
  */
-struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF {
+struct __pyx_obj_11sat_toolkit_7formula_CNF {
   PyObject_HEAD
-  struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *__pyx_vtab;
+  struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *__pyx_vtab;
   std::vector<int>  clauses;
   std::vector<size_t>  start_indices;
   int nvars;
   Py_ssize_t shape[1];
-  Py_ssize_t strides[1];
   Py_ssize_t view_count;
 };
 
 
-/* "sat_toolkit/_cnf_util.pyx":566
- *         self.view_count -= 1
+/* "sat_toolkit/formula.pyx":990
+ * 
  * 
  * cdef class Truthtable:             # <<<<<<<<<<<<<<
  *     """
  *     A boolean function represented as a truth table.
  */
-struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable {
+struct __pyx_obj_11sat_toolkit_7formula_Truthtable {
   PyObject_HEAD
   PyObject *on_set;
   PyObject *dc_set;
   __pyx_t_11sat_toolkit_5types_uint64_t numbits;
 };
 
 
-/* "sat_toolkit/_cnf_util.pyx":114
- *         return self.clause.size()
+/* "sat_toolkit/formula.pyx":164
+ *         return False
  * 
- *     def __iter__(self):             # <<<<<<<<<<<<<<
+ *     def __iter__(self) -> Iterable[int]:             # <<<<<<<<<<<<<<
  *         cdef size_t i = 0
  *         for i in range(self.clause.size()):
  */
-struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ {
+struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ {
   PyObject_HEAD
   size_t __pyx_v_i;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self;
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self;
   std::vector<int> ::size_type __pyx_t_0;
   std::vector<int> ::size_type __pyx_t_1;
   size_t __pyx_t_2;
 };
 
 
-/* "sat_toolkit/_cnf_util.pyx":472
+/* "sat_toolkit/formula.pyx":169
+ *             yield self.clause[i]
+ * 
+ *     def __reversed__(self) -> Iterable[int]:             # <<<<<<<<<<<<<<
+ *         cdef size_t i = 0
+ *         for i in reversed(range(self.clause.size())):
+ */
+struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ {
+  PyObject_HEAD
+  size_t __pyx_v_i;
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self;
+  size_t __pyx_t_0;
+};
+
+
+/* "sat_toolkit/formula.pyx":791
  *         return self.start_indices.size()
  * 
- *     def __iter__(self):             # <<<<<<<<<<<<<<
+ *     def __iter__(self) -> Iterable[Clause]:             # <<<<<<<<<<<<<<
  *         cdef size_t i = 0
  *         while i < self.start_indices.size():
  */
-struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ {
+struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ {
   PyObject_HEAD
   size_t __pyx_v_i;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self;
+};
+
+
+/* "sat_toolkit/formula.pyx":797
+ *             i += 1
+ * 
+ *     def __reversed__(self) -> Iterable[Clause]:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ *         for i in reversed(range(self.start_indices.size())):
+ */
+struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ {
+  PyObject_HEAD
+  size_t __pyx_v_i;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self;
+  size_t __pyx_t_0;
 };
 
 
 /* "View.MemoryView":106
  * 
  * @cname("__pyx_array")
  * cdef class array:             # <<<<<<<<<<<<<<
@@ -1336,57 +1376,64 @@
   PyObject *from_object;
   PyObject *(*to_object_func)(char *);
   int (*to_dtype_func)(char *, PyObject *);
 };
 
 
 
-/* "sat_toolkit/_cnf_util.pyx":46
+/* "View.MemoryView":106
  * 
+ * @cname("__pyx_array")
+ * cdef class array:             # <<<<<<<<<<<<<<
  * 
- * cdef class Clause:             # <<<<<<<<<<<<<<
- *     cdef vector[int] clause
- *     def __init__(self, clause):
+ *     cdef:
  */
 
-struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_Clause {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *(*from_memview)(__Pyx_memviewslice);
-  size_t (*_maxvar)(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *);
+struct __pyx_vtabstruct_array {
+  PyObject *(*get_memview)(struct __pyx_array_obj *);
 };
-static struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_Clause *__pyx_vtabptr_11sat_toolkit_9_cnf_util_Clause;
+static struct __pyx_vtabstruct_array *__pyx_vtabptr_array;
 
 
-/* "sat_toolkit/_cnf_util.pyx":120
+/* "sat_toolkit/formula.pyx":62
  * 
  * 
- * cdef class CNF:             # <<<<<<<<<<<<<<
- *     """
- *     Class for storing and manipulating CNF formulas.
+ * cdef class Clause:             # <<<<<<<<<<<<<<
+ *     cdef vector[int] clause
+ *     def __init__(self, clause):
  */
 
-struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *(*_from_dimacs)(__Pyx_memviewslice);
-  void (*_add_clauses)(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *, __Pyx_memviewslice);
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *(*get_clause)(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *, Py_ssize_t);
+struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause {
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *(*from_memview)(__Pyx_memviewslice);
+  size_t (*_maxvar)(struct __pyx_obj_11sat_toolkit_7formula_Clause *);
+  size_t (*_get_absolute_index)(struct __pyx_obj_11sat_toolkit_7formula_Clause *, Py_ssize_t);
+  size_t (*_get_slice_index)(struct __pyx_obj_11sat_toolkit_7formula_Clause *, Py_ssize_t);
 };
-static struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *__pyx_vtabptr_11sat_toolkit_9_cnf_util_CNF;
+static struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause *__pyx_vtabptr_11sat_toolkit_7formula_Clause;
 
 
-/* "View.MemoryView":106
+/* "sat_toolkit/formula.pyx":220
  * 
- * @cname("__pyx_array")
- * cdef class array:             # <<<<<<<<<<<<<<
  * 
- *     cdef:
+ * cdef class CNF:             # <<<<<<<<<<<<<<
+ *     """
+ *     Class for storing and manipulating CNF formulas.
  */
 
-struct __pyx_vtabstruct_array {
-  PyObject *(*get_memview)(struct __pyx_array_obj *);
+struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *(*_from_dimacs)(__Pyx_memviewslice);
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *(*_create_xor)(__Pyx_memviewslice);
+  int (*_add_clauses)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, __Pyx_memviewslice);
+  int (*_check_solution)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, __Pyx_memviewslice);
+  int (*_check_solution_for_single_clause)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, size_t, __Pyx_memviewslice);
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *(*get_clause)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, Py_ssize_t);
+  int (*_compare_clause)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, size_t, struct __pyx_obj_11sat_toolkit_7formula_Clause *);
+  size_t (*_get_slice_index)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, Py_ssize_t);
 };
-static struct __pyx_vtabstruct_array *__pyx_vtabptr_array;
+static struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *__pyx_vtabptr_11sat_toolkit_7formula_CNF;
 
 
 /* "View.MemoryView":331
  * 
  * @cname('__pyx_memoryview')
  * cdef class memoryview(object):             # <<<<<<<<<<<<<<
  * 
@@ -1546,19 +1593,76 @@
 #define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
 #endif
 
 /* RaiseException.proto */
 static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
 
-/* ArgTypeTest.proto */
-#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
-    ((likely((Py_TYPE(obj) == type) | (none_allowed && (obj == Py_None)))) ? 1 :\
-        __Pyx__ArgTypeTest(obj, type, name, exact))
-static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);
+/* GetItemInt.proto */
+#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
+    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
+               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
+#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
+    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
+                                                              int wraparound, int boundscheck);
+#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
+    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
+                                                              int wraparound, int boundscheck);
+static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
+                                                     int is_list, int wraparound, int boundscheck);
+
+/* PyObjectFormatSimple.proto */
+#if CYTHON_COMPILING_IN_PYPY
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        PyObject_Format(s, f))
+#elif PY_MAJOR_VERSION < 3
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        likely(PyString_CheckExact(s)) ? PyUnicode_FromEncodedObject(s, NULL, "strict") :\
+        PyObject_Format(s, f))
+#elif CYTHON_USE_TYPE_SLOTS
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        likely(PyLong_CheckExact(s)) ? PyLong_Type.tp_str(s) :\
+        likely(PyFloat_CheckExact(s)) ? PyFloat_Type.tp_str(s) :\
+        PyObject_Format(s, f))
+#else
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        PyObject_Format(s, f))
+#endif
+
+/* IncludeStringH.proto */
+#include <string.h>
+
+/* JoinPyUnicode.proto */
+static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
+                                      Py_UCS4 max_char);
+
+/* GCCDiagnostics.proto */
+#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#define __Pyx_HAS_GCC_DIAGNOSTIC
+#endif
+
+/* BuildPyUnicode.proto */
+static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
+                                                int prepend_sign, char padding_char);
+
+/* CIntToPyUnicode.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_int(int value, Py_ssize_t width, char padding_char, char format_char);
 
 /* PyCFunctionFastCall.proto */
 #if CYTHON_FAST_PYCCALL
 static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
 #else
 #define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
 #endif
@@ -1590,77 +1694,57 @@
     ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
 #endif // CYTHON_FAST_PYCALL
 #endif
 
-/* PyObjectCall2Args.proto */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
-
 /* PyObjectCallMethO.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
 #endif
 
 /* PyObjectCallOneArg.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
-/* SetItemInt.proto */
-#define __Pyx_SetItemInt(o, i, v, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_SetItemInt_Fast(o, (Py_ssize_t)i, v, is_list, wraparound, boundscheck) :\
-    (is_list ? (PyErr_SetString(PyExc_IndexError, "list assignment index out of range"), -1) :\
-               __Pyx_SetItemInt_Generic(o, to_py_func(i), v)))
-static int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v);
-static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v,
-                                               int is_list, int wraparound, int boundscheck);
-
-/* WriteUnraisableException.proto */
-static void __Pyx_WriteUnraisable(const char *name, int clineno,
-                                  int lineno, const char *filename,
-                                  int full_traceback, int nogil);
+/* ExtTypeTest.proto */
+static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);
 
-/* PyObjectFormatSimple.proto */
-#if CYTHON_COMPILING_IN_PYPY
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        PyObject_Format(s, f))
-#elif PY_MAJOR_VERSION < 3
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        likely(PyString_CheckExact(s)) ? PyUnicode_FromEncodedObject(s, NULL, "strict") :\
-        PyObject_Format(s, f))
-#elif CYTHON_USE_TYPE_SLOTS
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        likely(PyLong_CheckExact(s)) ? PyLong_Type.tp_str(s) :\
-        likely(PyFloat_CheckExact(s)) ? PyFloat_Type.tp_str(s) :\
-        PyObject_Format(s, f))
-#else
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        PyObject_Format(s, f))
+/* GetTopmostException.proto */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
 #endif
 
-/* IncludeStringH.proto */
-#include <string.h>
-
-/* JoinPyUnicode.proto */
-static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
-                                      Py_UCS4 max_char);
+/* SaveResetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
+#else
+#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
+#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
+#endif
 
 /* PyErrExceptionMatches.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
 static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
 #else
 #define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
 #endif
 
+/* GetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
+#endif
+
 /* GetAttr.proto */
 static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *, PyObject *);
 
 /* GetAttr3.proto */
 static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *, PyObject *, PyObject *);
 
 /* PyDictVersioning.proto */
@@ -1706,14 +1790,23 @@
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
+/* PyObjectCall2Args.proto */
+static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
+
+/* PyIntCompare.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_NeObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
+
+/* KeywordStringCheck.proto */
+static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name, int kw_allowed);
+
 /* MemviewSliceInit.proto */
 #define __Pyx_BUF_MAX_NDIMS %(BUF_MAX_NDIMS)d
 #define __Pyx_MEMVIEW_DIRECT   1
 #define __Pyx_MEMVIEW_PTR      2
 #define __Pyx_MEMVIEW_FULL     4
 #define __Pyx_MEMVIEW_CONTIG   8
 #define __Pyx_MEMVIEW_STRIDED  16
@@ -1732,25 +1825,36 @@
 #define __pyx_get_slice_count_pointer(memview) (memview->acquisition_count_aligned_p)
 #define __pyx_get_slice_count(memview) (*__pyx_get_slice_count_pointer(memview))
 #define __PYX_INC_MEMVIEW(slice, have_gil) __Pyx_INC_MEMVIEW(slice, have_gil, __LINE__)
 #define __PYX_XDEC_MEMVIEW(slice, have_gil) __Pyx_XDEC_MEMVIEW(slice, have_gil, __LINE__)
 static CYTHON_INLINE void __Pyx_INC_MEMVIEW(__Pyx_memviewslice *, int, int);
 static CYTHON_INLINE void __Pyx_XDEC_MEMVIEW(__Pyx_memviewslice *, int, int);
 
-/* GCCDiagnostics.proto */
-#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
-#define __Pyx_HAS_GCC_DIAGNOSTIC
+/* AssertionsEnabled.proto */
+#define __Pyx_init_assertions_enabled()
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
+  #define __pyx_assertions_enabled() (1)
+#elif PY_VERSION_HEX < 0x03080000  ||  CYTHON_COMPILING_IN_PYPY  ||  defined(Py_LIMITED_API)
+  #define __pyx_assertions_enabled() (!Py_OptimizeFlag)
+#elif CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030900A6
+  static int __pyx_assertions_enabled_flag;
+  #define __pyx_assertions_enabled() (__pyx_assertions_enabled_flag)
+  #undef __Pyx_init_assertions_enabled
+  static void __Pyx_init_assertions_enabled(void) {
+    __pyx_assertions_enabled_flag = ! _PyInterpreterState_GetConfig(__Pyx_PyThreadState_Current->interp)->optimization_level;
+  }
+#else
+  #define __pyx_assertions_enabled() (!Py_OptimizeFlag)
 #endif
 
-/* BuildPyUnicode.proto */
-static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
-                                                int prepend_sign, char padding_char);
-
-/* CIntToPyUnicode.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_int(int value, Py_ssize_t width, char padding_char, char format_char);
+/* ArgTypeTest.proto */
+#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
+    ((likely((Py_TYPE(obj) == type) | (none_allowed && (obj == Py_None)))) ? 1 :\
+        __Pyx__ArgTypeTest(obj, type, name, exact))
+static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);
 
 /* PyObjectCallNoArg.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
 #else
 #define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
 #endif
@@ -1774,17 +1878,14 @@
 #define __Pyx_PyObject_DelSlice(obj, cstart, cstop, py_start, py_stop, py_slice, has_cstart, has_cstop, wraparound)\
     __Pyx_PyObject_SetSlice(obj, (PyObject*)NULL, cstart, cstop, py_start, py_stop, py_slice, has_cstart, has_cstop, wraparound)
 static CYTHON_INLINE int __Pyx_PyObject_SetSlice(
         PyObject* obj, PyObject* value, Py_ssize_t cstart, Py_ssize_t cstop,
         PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
         int has_cstart, int has_cstop, int wraparound);
 
-/* ExtTypeTest.proto */
-static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);
-
 /* decode_c_string_utf16.proto */
 static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16(const char *s, Py_ssize_t size, const char *errors) {
     int byteorder = 0;
     return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
 }
 static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16LE(const char *s, Py_ssize_t size, const char *errors) {
     int byteorder = -1;
@@ -1833,90 +1934,41 @@
     }
     return res;
 }
 #else
 #define __Pyx_PyObject_LookupSpecial(o,n) __Pyx_PyObject_GetAttrStr(o,n)
 #endif
 
-/* GetTopmostException.proto */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
-#endif
-
-/* SaveResetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
-#else
-#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
-#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
-#endif
-
-/* GetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
-#endif
+/* CIntToPyUnicode.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_Py_ssize_t(Py_ssize_t value, Py_ssize_t width, char padding_char, char format_char);
 
 /* SliceObject.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
         PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
         PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
         int has_cstart, int has_cstop, int wraparound);
 
-/* PyIntCompare.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_NeObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
-
-/* PyIntCompare.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
-
-/* GetItemInt.proto */
-#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
-    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
-               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
-#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
-    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
-                                                              int wraparound, int boundscheck);
-#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
-    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
-                                                              int wraparound, int boundscheck);
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
-                                                     int is_list, int wraparound, int boundscheck);
-
 /* PyIntBinop.proto */
 #if !CYTHON_COMPILING_IN_PYPY
 static PyObject* __Pyx_PyInt_SubtractObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
 #else
 #define __Pyx_PyInt_SubtractObjC(op1, op2, intval, inplace, zerodivision_check)\
     (inplace ? PyNumber_InPlaceSubtract(op1, op2) : PyNumber_Subtract(op1, op2))
 #endif
 
+/* PyIntCompare.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
+
 /* ObjectGetItem.proto */
 #if CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject* key);
 #else
 #define __Pyx_PyObject_GetItem(obj, key)  PyObject_GetItem(obj, key)
 #endif
 
-/* CIntToPyUnicode.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_Py_ssize_t(Py_ssize_t value, Py_ssize_t width, char padding_char, char format_char);
-
 /* PyObjectFormat.proto */
 #if CYTHON_USE_UNICODE_WRITER
 static PyObject* __Pyx_PyObject_Format(PyObject* s, PyObject* f);
 #else
 #define __Pyx_PyObject_Format(s, f) PyObject_Format(s, f)
 #endif
 
@@ -2155,14 +2207,33 @@
 
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
+/* TypeImport.proto */
+#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_36
+#define __PYX_HAVE_RT_ImportType_proto_0_29_36
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_36(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_36(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_0_29_36 {
+   __Pyx_ImportType_CheckSize_Error_0_29_36 = 0,
+   __Pyx_ImportType_CheckSize_Warn_0_29_36 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_0_29_36 = 2
+};
+static PyTypeObject *__Pyx_ImportType_0_29_36(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_36 check_size);
+#endif
+
 /* GetNameInClass.proto */
 #define __Pyx_GetNameInClass(var, nmspace, name)  (var) = __Pyx__GetNameInClass(nmspace, name)
 static PyObject *__Pyx__GetNameInClass(PyObject *nmspace, PyObject *name);
 
 /* ClassMethod.proto */
 #include "descrobject.h"
 static CYTHON_UNUSED PyObject* __Pyx_Method_ClassMethod(PyObject *method);
@@ -2250,15 +2321,18 @@
                 int ndim,
                 __Pyx_TypeInfo *dtype,
                 __Pyx_BufFmt_StackElem stack[],
                 __Pyx_memviewslice *memviewslice,
                 PyObject *original_obj);
 
 /* ObjectToMemviewSlice.proto */
-static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_int(PyObject *, int writable_flag);
+static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(PyObject *, int writable_flag);
+
+/* ObjectToMemviewSlice.proto */
+static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_11sat_toolkit_5types_uint8_t(PyObject *, int writable_flag);
 
 /* CppExceptionConversion.proto */
 #ifndef __Pyx_CppExn2PyErr
 #include <new>
 #include <typeinfo>
 #include <stdexcept>
 #include <ios>
@@ -2303,23 +2377,23 @@
 
 /* ObjectToMemviewSlice.proto */
 static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_unsigned_char__const__(PyObject *, int writable_flag);
 
 /* MemviewDtypeToObject.proto */
 static CYTHON_INLINE PyObject *__pyx_memview_get_unsigned_char__const__(const char *itemp);
 
-/* MemviewDtypeToObject.proto */
-static CYTHON_INLINE PyObject *__pyx_memview_get_int(const char *itemp);
-static CYTHON_INLINE int __pyx_memview_set_int(const char *itemp, PyObject *obj);
-
 /* ObjectToMemviewSlice.proto */
-static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(PyObject *, int writable_flag);
+static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_dc_int(PyObject *, int writable_flag);
 
 /* ObjectToMemviewSlice.proto */
-static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_dc_int(PyObject *, int writable_flag);
+static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_d_dc_int__const__(PyObject *, int writable_flag);
+
+/* MemviewDtypeToObject.proto */
+static CYTHON_INLINE PyObject *__pyx_memview_get_int(const char *itemp);
+static CYTHON_INLINE int __pyx_memview_set_int(const char *itemp, PyObject *obj);
 
 /* MemviewSliceCopyTemplate.proto */
 static __Pyx_memviewslice
 __pyx_memoryview_copy_new_contig(const __Pyx_memviewslice *from_mvs,
                                  const char *mode, int ndim,
                                  size_t sizeof_dtype, int contig_flag,
                                  int dtype_is_object);
@@ -2344,26 +2418,26 @@
     char string[3];
 };
 static struct __pyx_typeinfo_string __Pyx_TypeInfoToFormat(__Pyx_TypeInfo *type);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);
 
+/* CIntToPy.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
+
 /* CIntFromPy.proto */
 static CYTHON_INLINE unsigned int __Pyx_PyInt_As_unsigned_int(PyObject *);
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_unsigned_int(unsigned int value);
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_unsigned_char(unsigned char value);
 
-/* CIntToPy.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
-
 /* CIntFromPy.proto */
 static CYTHON_INLINE char __Pyx_PyInt_As_char(PyObject *);
 
 /* PyObjectGetMethod.proto */
 static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method);
 
 /* PyObjectCallMethod1.proto */
@@ -2450,19 +2524,26 @@
 
 /* CheckBinaryVersion.proto */
 static int __Pyx_check_binary_version(void);
 
 /* InitStrings.proto */
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_f_11sat_toolkit_9_cnf_util_6Clause_from_memview(__Pyx_memviewslice __pyx_v_clause); /* proto*/
-static size_t __pyx_f_11sat_toolkit_9_cnf_util_6Clause__maxvar(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self); /* proto*/
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_f_11sat_toolkit_9_cnf_util_3CNF__from_dimacs(__Pyx_memviewslice __pyx_v_dimacs); /* proto*/
-static void __pyx_f_11sat_toolkit_9_cnf_util_3CNF__add_clauses(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_clauses); /* proto*/
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_f_11sat_toolkit_9_cnf_util_3CNF_get_clause(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto*/
+static struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_f_11sat_toolkit_7formula_6Clause_from_memview(__Pyx_memviewslice __pyx_v_clause); /* proto*/
+static size_t __pyx_f_11sat_toolkit_7formula_6Clause__maxvar(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self); /* proto*/
+static size_t __pyx_f_11sat_toolkit_7formula_6Clause__get_absolute_index(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto*/
+static size_t __pyx_f_11sat_toolkit_7formula_6Clause__get_slice_index(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto*/
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_f_11sat_toolkit_7formula_3CNF__from_dimacs(__Pyx_memviewslice __pyx_v_dimacs); /* proto*/
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_f_11sat_toolkit_7formula_3CNF__create_xor(__Pyx_memviewslice __pyx_v_packed_args); /* proto*/
+static int __pyx_f_11sat_toolkit_7formula_3CNF__add_clauses(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_clauses); /* proto*/
+static int __pyx_f_11sat_toolkit_7formula_3CNF__check_solution(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_solution); /* proto*/
+static int __pyx_f_11sat_toolkit_7formula_3CNF__check_solution_for_single_clause(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, size_t __pyx_v_clause_idx, __Pyx_memviewslice __pyx_v_solution); /* proto*/
+static struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_f_11sat_toolkit_7formula_3CNF_get_clause(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto*/
+static int __pyx_f_11sat_toolkit_7formula_3CNF__compare_clause(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, size_t __pyx_v_idx, struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_other); /* proto*/
+static size_t __pyx_f_11sat_toolkit_7formula_3CNF__get_slice_index(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto*/
 static PyObject *__pyx_array_get_memview(struct __pyx_array_obj *__pyx_v_self); /* proto*/
 static char *__pyx_memoryview_get_item_pointer(struct __pyx_memoryview_obj *__pyx_v_self, PyObject *__pyx_v_index); /* proto*/
 static PyObject *__pyx_memoryview_is_slice(struct __pyx_memoryview_obj *__pyx_v_self, PyObject *__pyx_v_obj); /* proto*/
 static PyObject *__pyx_memoryview_setitem_slice_assignment(struct __pyx_memoryview_obj *__pyx_v_self, PyObject *__pyx_v_dst, PyObject *__pyx_v_src); /* proto*/
 static PyObject *__pyx_memoryview_setitem_slice_assign_scalar(struct __pyx_memoryview_obj *__pyx_v_self, struct __pyx_memoryview_obj *__pyx_v_dst, PyObject *__pyx_v_value); /* proto*/
 static PyObject *__pyx_memoryview_setitem_indexed(struct __pyx_memoryview_obj *__pyx_v_self, PyObject *__pyx_v_index, PyObject *__pyx_v_value); /* proto*/
 static PyObject *__pyx_memoryview_convert_item_to_object(struct __pyx_memoryview_obj *__pyx_v_self, char *__pyx_v_itemp); /* proto*/
@@ -2471,44 +2552,126 @@
 static PyObject *__pyx_memoryviewslice_assign_item_from_object(struct __pyx_memoryviewslice_obj *__pyx_v_self, char *__pyx_v_itemp, PyObject *__pyx_v_value); /* proto*/
 
 /* Module declarations from 'cython.view' */
 static struct __pyx_array_obj *__pyx_array_new(PyObject *, Py_ssize_t, char *, char *, char *); /*proto*/
 
 /* Module declarations from 'cython' */
 
-/* Module declarations from 'libcpp.vector' */
+/* Module declarations from 'cpython.version' */
+
+/* Module declarations from '__builtin__' */
+
+/* Module declarations from 'cpython.type' */
+static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;
 
 /* Module declarations from 'libc.string' */
 
 /* Module declarations from 'libc.stdio' */
 
+/* Module declarations from 'cpython.object' */
+
+/* Module declarations from 'cpython.ref' */
+
+/* Module declarations from 'cpython.exc' */
+
+/* Module declarations from 'cpython.module' */
+
+/* Module declarations from 'cpython.mem' */
+
+/* Module declarations from 'cpython.tuple' */
+
+/* Module declarations from 'cpython.list' */
+
+/* Module declarations from 'cpython.sequence' */
+
+/* Module declarations from 'cpython.mapping' */
+
+/* Module declarations from 'cpython.iterator' */
+
+/* Module declarations from 'cpython.number' */
+
+/* Module declarations from 'cpython.int' */
+
+/* Module declarations from '__builtin__' */
+
+/* Module declarations from 'cpython.bool' */
+static PyTypeObject *__pyx_ptype_7cpython_4bool_bool = 0;
+
+/* Module declarations from 'cpython.long' */
+
+/* Module declarations from 'cpython.float' */
+
+/* Module declarations from '__builtin__' */
+
+/* Module declarations from 'cpython.complex' */
+static PyTypeObject *__pyx_ptype_7cpython_7complex_complex = 0;
+
+/* Module declarations from 'cpython.string' */
+
+/* Module declarations from 'cpython.unicode' */
+
+/* Module declarations from 'cpython.dict' */
+
+/* Module declarations from 'cpython.instance' */
+
+/* Module declarations from 'cpython.function' */
+
+/* Module declarations from 'cpython.method' */
+
+/* Module declarations from 'cpython.weakref' */
+
+/* Module declarations from 'cpython.getargs' */
+
+/* Module declarations from 'cpython.pythread' */
+
+/* Module declarations from 'cpython.pystate' */
+
+/* Module declarations from 'cpython.cobject' */
+
+/* Module declarations from 'cpython.oldbuffer' */
+
+/* Module declarations from 'cpython.set' */
+
+/* Module declarations from 'cpython.buffer' */
+
+/* Module declarations from 'cpython.bytes' */
+
+/* Module declarations from 'cpython.pycapsule' */
+
+/* Module declarations from 'cpython' */
+
+/* Module declarations from 'libcpp.vector' */
+
 /* Module declarations from 'libc.stdlib' */
 
 /* Module declarations from 'sat_toolkit.types' */
 
-/* Module declarations from 'sat_toolkit._cnf_util' */
-static PyTypeObject *__pyx_ptype_11sat_toolkit_9_cnf_util_Clause = 0;
-static PyTypeObject *__pyx_ptype_11sat_toolkit_9_cnf_util_CNF = 0;
-static PyTypeObject *__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable = 0;
-static PyTypeObject *__pyx_ptype_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ = 0;
-static PyTypeObject *__pyx_ptype_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ = 0;
+/* Module declarations from 'sat_toolkit.formula' */
+static PyTypeObject *__pyx_ptype_11sat_toolkit_7formula_Clause = 0;
+static PyTypeObject *__pyx_ptype_11sat_toolkit_7formula_CNF = 0;
+static PyTypeObject *__pyx_ptype_11sat_toolkit_7formula_Truthtable = 0;
+static PyTypeObject *__pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct____iter__ = 0;
+static PyTypeObject *__pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ = 0;
+static PyTypeObject *__pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ = 0;
+static PyTypeObject *__pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ = 0;
 static PyTypeObject *__pyx_array_type = 0;
 static PyTypeObject *__pyx_MemviewEnum_type = 0;
 static PyTypeObject *__pyx_memoryview_type = 0;
 static PyTypeObject *__pyx_memoryviewslice_type = 0;
 static PyObject *generic = 0;
 static PyObject *strided = 0;
 static PyObject *indirect = 0;
 static PyObject *contiguous = 0;
 static PyObject *indirect_contiguous = 0;
 static int __pyx_memoryview_thread_locks_used;
 static PyThread_type_lock __pyx_memoryview_thread_locks[8];
-static int __pyx_f_11sat_toolkit_9_cnf_util_startswith(__Pyx_memviewslice, char const *); /*proto*/
-static PyObject *__pyx_f_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause__set_state(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *, PyObject *); /*proto*/
-static PyObject *__pyx_f_11sat_toolkit_9_cnf_util___pyx_unpickle_Truthtable__set_state(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *, PyObject *); /*proto*/
+static int __pyx_f_11sat_toolkit_7formula_startswith(__Pyx_memviewslice, char const *); /*proto*/
+static int __pyx_f_11sat_toolkit_7formula_abs(int); /*proto*/
+static PyObject *__pyx_f_11sat_toolkit_7formula___pyx_unpickle_Clause__set_state(struct __pyx_obj_11sat_toolkit_7formula_Clause *, PyObject *); /*proto*/
+static PyObject *__pyx_f_11sat_toolkit_7formula___pyx_unpickle_Truthtable__set_state(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *, PyObject *); /*proto*/
 static PyObject *__pyx_convert_vector_to_py_int(const std::vector<int>  &); /*proto*/
 static std::vector<int>  __pyx_convert_vector_from_py_int(PyObject *); /*proto*/
 static PyObject *__pyx_convert_vector_to_py_size_t(const std::vector<size_t>  &); /*proto*/
 static struct __pyx_array_obj *__pyx_array_new(PyObject *, Py_ssize_t, char *, char *, char *); /*proto*/
 static void *__pyx_align_pointer(void *, size_t); /*proto*/
 static PyObject *__pyx_memoryview_new(PyObject *, int, int, __Pyx_TypeInfo *); /*proto*/
 static CYTHON_INLINE int __pyx_memoryview_check(PyObject *); /*proto*/
@@ -2539,88 +2702,96 @@
 static void __pyx_memoryview_refcount_objects_in_slice_with_gil(char *, Py_ssize_t *, Py_ssize_t *, int, int); /*proto*/
 static void __pyx_memoryview_refcount_objects_in_slice(char *, Py_ssize_t *, Py_ssize_t *, int, int); /*proto*/
 static void __pyx_memoryview_slice_assign_scalar(__Pyx_memviewslice *, int, size_t, void *, int); /*proto*/
 static void __pyx_memoryview__slice_assign_scalar(char *, Py_ssize_t *, Py_ssize_t *, int, size_t, void *); /*proto*/
 static PyObject *__pyx_unpickle_Enum__set_state(struct __pyx_MemviewEnum_obj *, PyObject *); /*proto*/
 static PyObject *__pyx_format_from_typeinfo(__Pyx_TypeInfo *); /*proto*/
 static __Pyx_TypeInfo __Pyx_TypeInfo_int = { "int", NULL, sizeof(int), { 0 }, 0, IS_UNSIGNED(int) ? 'U' : 'I', IS_UNSIGNED(int), 0 };
+static __Pyx_TypeInfo __Pyx_TypeInfo_int__const__ = { "const int", NULL, sizeof(int const ), { 0 }, 0, IS_UNSIGNED(int const ) ? 'U' : 'I', IS_UNSIGNED(int const ), 0 };
+static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_11sat_toolkit_5types_uint8_t = { "uint8_t", NULL, sizeof(__pyx_t_11sat_toolkit_5types_uint8_t), { 0 }, 0, IS_UNSIGNED(__pyx_t_11sat_toolkit_5types_uint8_t) ? 'U' : 'I', IS_UNSIGNED(__pyx_t_11sat_toolkit_5types_uint8_t), 0 };
 static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_11sat_toolkit_5types_uint8_t__const__ = { "const uint8_t", NULL, sizeof(__pyx_t_11sat_toolkit_5types_uint8_t const ), { 0 }, 0, IS_UNSIGNED(__pyx_t_11sat_toolkit_5types_uint8_t const ) ? 'U' : 'I', IS_UNSIGNED(__pyx_t_11sat_toolkit_5types_uint8_t const ), 0 };
 static __Pyx_TypeInfo __Pyx_TypeInfo_unsigned_char__const__ = { "const unsigned char", NULL, sizeof(unsigned char const ), { 0 }, 0, IS_UNSIGNED(unsigned char const ) ? 'U' : 'I', IS_UNSIGNED(unsigned char const ), 0 };
-static __Pyx_TypeInfo __Pyx_TypeInfo_int__const__ = { "const int", NULL, sizeof(int const ), { 0 }, 0, IS_UNSIGNED(int const ) ? 'U' : 'I', IS_UNSIGNED(int const ), 0 };
-#define __Pyx_MODULE_NAME "sat_toolkit._cnf_util"
-extern int __pyx_module_is_main_sat_toolkit___cnf_util;
-int __pyx_module_is_main_sat_toolkit___cnf_util = 0;
+#define __Pyx_MODULE_NAME "sat_toolkit.formula"
+extern int __pyx_module_is_main_sat_toolkit__formula;
+int __pyx_module_is_main_sat_toolkit__formula = 0;
 
-/* Implementation of 'sat_toolkit._cnf_util' */
+/* Implementation of 'sat_toolkit.formula' */
 static PyObject *__pyx_builtin_staticmethod;
 static PyObject *__pyx_builtin_object;
 static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_range;
 static PyObject *__pyx_builtin_IndexError;
+static PyObject *__pyx_builtin_reversed;
+static PyObject *__pyx_builtin_TypeError;
+static PyObject *__pyx_builtin_enumerate;
 static PyObject *__pyx_builtin_open;
 static PyObject *__pyx_builtin_MemoryError;
-static PyObject *__pyx_builtin_enumerate;
-static PyObject *__pyx_builtin_TypeError;
 static PyObject *__pyx_builtin_Ellipsis;
 static PyObject *__pyx_builtin_id;
 static const char __pyx_k_0[] = "0";
 static const char __pyx_k_1[] = "1";
 static const char __pyx_k_O[] = "-O";
 static const char __pyx_k_T[] = "-T";
 static const char __pyx_k_a[] = "a";
 static const char __pyx_k_b[] = "b";
 static const char __pyx_k_c[] = "c";
 static const char __pyx_k_f[] = "f";
 static const char __pyx_k_i[] = ".i ";
+static const char __pyx_k_l[] = "l";
 static const char __pyx_k_o[] = "-o";
 static const char __pyx_k_p[] = ".p ";
 static const char __pyx_k_r[] = "r";
 static const char __pyx_k_s[] = "-s";
 static const char __pyx_k_v[] = "v";
 static const char __pyx_k__3[] = ")";
-static const char __pyx_k__6[] = " < ";
-static const char __pyx_k__8[] = " ";
+static const char __pyx_k__5[] = " < ";
+static const char __pyx_k__7[] = " ";
 static const char __pyx_k_id[] = "id";
 static const char __pyx_k_io[] = "io";
 static const char __pyx_k_np[] = "np";
 static const char __pyx_k_sp[] = "sp";
 static const char __pyx_k_0_2[] = " 0\n";
 static const char __pyx_k_CNF[] = "CNF";
 static const char __pyx_k_O_2[] = "O";
 static const char __pyx_k_T_2[] = "T{";
-  static const char __pyx_k__13[] = "\n";
-  static const char __pyx_k__28[] = "-";
-  static const char __pyx_k__52[] = "^";
-  static const char __pyx_k__53[] = "";
-  static const char __pyx_k__54[] = ":";
-static const char __pyx_k__55[] = "}";
-static const char __pyx_k__56[] = ",";
-static const char __pyx_k__57[] = "*";
-static const char __pyx_k__60[] = "_";
+  static const char __pyx_k__17[] = "\n";
+  static const char __pyx_k__35[] = "-";
+  static const char __pyx_k__58[] = "^";
+  static const char __pyx_k__59[] = "";
+  static const char __pyx_k__60[] = ":";
+static const char __pyx_k__61[] = "}";
+static const char __pyx_k__62[] = ",";
+static const char __pyx_k__63[] = "*";
+static const char __pyx_k__66[] = "_";
+static const char __pyx_k_abc[] = "abc";
 static const char __pyx_k_all[] = "all";
 static const char __pyx_k_any[] = "any";
+static const char __pyx_k_arg[] = "arg";
 static const char __pyx_k_cnf[] = "cnf";
 static const char __pyx_k_dnf[] = "dnf";
-static const char __pyx_k_end[] = ".end\n";
+static const char __pyx_k_end[] = "end";
 static const char __pyx_k_i_2[] = "i";
 static const char __pyx_k_idx[] = "idx";
+static const char __pyx_k_lhs[] = "lhs";
 static const char __pyx_k_new[] = "__new__";
 static const char __pyx_k_o_1[] = ".o 1\n";
 static const char __pyx_k_obj[] = "obj";
 static const char __pyx_k_res[] = "res";
+static const char __pyx_k_rhs[] = "rhs";
 static const char __pyx_k_s_2[] = "(%s)";
 static const char __pyx_k_sep[] = "sep";
 static const char __pyx_k_sys[] = "sys";
 static const char __pyx_k_val[] = "val";
 static const char __pyx_k_None[] = "None";
 static const char __pyx_k_PIPE[] = "PIPE";
 static const char __pyx_k_args[] = "args";
 static const char __pyx_k_axis[] = "axis";
 static const char __pyx_k_base[] = "base";
 static const char __pyx_k_bits[] = "bits";
+static const char __pyx_k_copy[] = "copy";
 static const char __pyx_k_dict[] = "__dict__";
 static const char __pyx_k_exit[] = "__exit__";
 static const char __pyx_k_iter[] = "__iter__";
 static const char __pyx_k_join[] = "join";
 static const char __pyx_k_line[] = "line";
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_mask[] = "mask";
@@ -2637,213 +2808,251 @@
 static const char __pyx_k_step[] = "step";
 static const char __pyx_k_stop[] = "stop";
 static const char __pyx_k_test[] = "__test__";
 static const char __pyx_k_text[] = "text";
 static const char __pyx_k_wait[] = "wait";
 static const char __pyx_k_ASCII[] = "ASCII";
 static const char __pyx_k_Popen[] = "Popen";
+static const char __pyx_k_all_2[] = "__all__";
 static const char __pyx_k_array[] = "array";
 static const char __pyx_k_class[] = "__class__";
 static const char __pyx_k_close[] = "close";
 static const char __pyx_k_dtype[] = "dtype";
+static const char __pyx_k_empty[] = "empty";
+static const char __pyx_k_end_2[] = ".end\n";
 static const char __pyx_k_enter[] = "__enter__";
 static const char __pyx_k_error[] = "error";
 static const char __pyx_k_flags[] = "flags";
 static const char __pyx_k_int32[] = "int32";
 static const char __pyx_k_numpy[] = "numpy";
 static const char __pyx_k_nvars[] = "nvars";
 static const char __pyx_k_p_cnf[] = "p cnf ";
 static const char __pyx_k_phase[] = ".phase ";
 static const char __pyx_k_range[] = "range";
 static const char __pyx_k_shape[] = "shape";
 static const char __pyx_k_split[] = "split";
 static const char __pyx_k_start[] = "start";
 static const char __pyx_k_stdin[] = "stdin";
-static const char __pyx_k_strip[] = "strip";
 static const char __pyx_k_throw[] = "throw";
+static const char __pyx_k_uint8[] = "uint8";
 static const char __pyx_k_where[] = "where";
 static const char __pyx_k_write[] = "write";
 static const char __pyx_k_zeros[] = "zeros";
 static const char __pyx_k_Clause[] = "Clause(";
 static const char __pyx_k_append[] = "append";
 static const char __pyx_k_clause[] = "clause";
 static const char __pyx_k_dc_lut[] = "dc_lut";
 static const char __pyx_k_dc_set[] = "dc_set";
 static const char __pyx_k_dimacs[] = "dimacs";
 static const char __pyx_k_encode[] = "encode";
 static const char __pyx_k_format[] = "format";
 static const char __pyx_k_import[] = "__import__";
 static const char __pyx_k_invert[] = "invert";
+static const char __pyx_k_length[] = "length";
 static const char __pyx_k_name_2[] = "__name__";
+static const char __pyx_k_needle[] = "needle";
 static const char __pyx_k_object[] = "object";
 static const char __pyx_k_on_lut[] = "on_lut";
 static const char __pyx_k_on_set[] = "on_set";
 static const char __pyx_k_pickle[] = "pickle";
 static const char __pyx_k_prefix[] = "prefix";
 static const char __pyx_k_reduce[] = "__reduce__";
+static const char __pyx_k_rstrip[] = "rstrip";
 static const char __pyx_k_stdout[] = "stdout";
 static const char __pyx_k_struct[] = "struct";
 static const char __pyx_k_suffix[] = "suffix";
 static const char __pyx_k_typing[] = "typing";
 static const char __pyx_k_unpack[] = "unpack";
 static const char __pyx_k_update[] = "update";
 static const char __pyx_k_BytesIO[] = "BytesIO";
 static const char __pyx_k_Dverify[] = "-Dverify";
 static const char __pyx_k_clauses[] = "clauses";
 static const char __pyx_k_fortran[] = "fortran";
+static const char __pyx_k_indices[] = "indices";
 static const char __pyx_k_line_py[] = "line_py";
 static const char __pyx_k_memview[] = "memview";
 static const char __pyx_k_numbits[] = "numbits";
 static const char __pyx_k_outfile[] = "outfile";
 static const char __pyx_k_phase_2[] = "phase";
 static const char __pyx_k_timeout[] = "timeout";
-static const char __pyx_k_true_op[] = "true_op";
 static const char __pyx_k_write_2[] = "_write";
 static const char __pyx_k_CNF_over[] = "CNF over ";
 static const char __pyx_k_Clause_2[] = "Clause";
 static const char __pyx_k_Ellipsis[] = "Ellipsis";
+static const char __pyx_k_Sequence[] = "Sequence";
 static const char __pyx_k_StringIO[] = "StringIO";
 static const char __pyx_k_dimacs_2[] = ".dimacs";
 static const char __pyx_k_espresso[] = "espresso";
-static const char __pyx_k_false_op[] = "false_op";
 static const char __pyx_k_from_lut[] = "from_lut";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_getvalue[] = "getvalue";
 static const char __pyx_k_init_key[] = "init_key";
 static const char __pyx_k_itemsize[] = "itemsize";
+static const char __pyx_k_num_args[] = "num_args";
+static const char __pyx_k_num_xors[] = "num_xors";
 static const char __pyx_k_optlevel[] = "optlevel";
 static const char __pyx_k_pyx_type[] = "__pyx_type";
+static const char __pyx_k_register[] = "register";
+static const char __pyx_k_reversed[] = "reversed";
 static const char __pyx_k_setstate[] = "__setstate__";
 static const char __pyx_k_tempfile[] = "tempfile";
 static const char __pyx_k_TypeError[] = "TypeError";
 static const char __pyx_k_clauses_2[] = " clauses";
 static const char __pyx_k_dataclass[] = "dataclass";
 static const char __pyx_k_enumerate[] = "enumerate";
 static const char __pyx_k_lingeling[] = "lingeling";
 static const char __pyx_k_pyx_state[] = "__pyx_state";
 static const char __pyx_k_reduce_ex[] = "__reduce_ex__";
 static const char __pyx_k_to_dimacs[] = "to_dimacs";
-static const char __pyx_k_variables[] = "variables";
+static const char __pyx_k_variables[] = " variables";
 static const char __pyx_k_CNF___iter[] = "CNF.__iter__";
 static const char __pyx_k_IndexError[] = "IndexError";
 static const char __pyx_k_Truthtable[] = "Truthtable\n";
 static const char __pyx_k_ValueError[] = "ValueError";
 static const char __pyx_k_add_clause[] = "add_clause";
 static const char __pyx_k_bit_length[] = "bit_length";
+static const char __pyx_k_create_xor[] = "create_xor";
 static const char __pyx_k_dc_indices[] = "dc_indices";
 static const char __pyx_k_expected_1[] = " expected '1'.";
 static const char __pyx_k_extra_args[] = "extra_args";
+static const char __pyx_k_frombuffer[] = "frombuffer";
 static const char __pyx_k_fromstring[] = "fromstring";
 static const char __pyx_k_logical_or[] = "logical_or";
 static const char __pyx_k_on_indices[] = "on_indices";
 static const char __pyx_k_pyx_result[] = "__pyx_result";
 static const char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
+static const char __pyx_k_reversed_2[] = "__reversed__";
 static const char __pyx_k_subprocess[] = "subprocess";
 static const char __pyx_k_MemoryError[] = "MemoryError";
 static const char __pyx_k_PickleError[] = "PickleError";
+static const char __pyx_k_add_clauses[] = "add_clauses";
+static const char __pyx_k_collections[] = "collections";
 static const char __pyx_k_concatenate[] = "concatenate";
 static const char __pyx_k_dataclasses[] = "dataclasses";
 static const char __pyx_k_from_dimacs[] = "from_dimacs";
 static const char __pyx_k_lingeling_2[] = "lingeling_";
+static const char __pyx_k_packed_args[] = "packed_args";
 static const char __pyx_k_to_espresso[] = "to_espresso";
 static const char __pyx_k_Truthtable_2[] = "Truthtable";
 static const char __pyx_k_from_indices[] = "from_indices";
 static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
 static const char __pyx_k_searchsorted[] = "searchsorted";
+static const char __pyx_k_solution_len[] = "solution_len";
 static const char __pyx_k_staticmethod[] = "staticmethod";
 static const char __pyx_k_stringsource[] = "stringsource";
 static const char __pyx_k_Clause___iter[] = "Clause.__iter__";
+static const char __pyx_k_TYPE_CHECKING[] = "TYPE_CHECKING";
 static const char __pyx_k_count_nonzero[] = "count_nonzero";
 static const char __pyx_k_espresso_args[] = "espresso_args";
 static const char __pyx_k_from_espresso[] = "from_espresso";
+static const char __pyx_k_is_not_in_CNF[] = " is not in CNF";
 static const char __pyx_k_print_numvars[] = "print_numvars";
 static const char __pyx_k_pyx_getbuffer[] = "__pyx_getbuffer";
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
 static const char __pyx_k_start_indices[] = "start_indices";
+static const char __pyx_k_CNF___reversed[] = "CNF.__reversed__";
 static const char __pyx_k_INIT_INDEX_SET[] = "INIT_INDEX_SET";
 static const char __pyx_k_variables_with[] = " variables with ";
 static const char __pyx_k_View_MemoryView[] = "View.MemoryView";
 static const char __pyx_k_allocate_buffer[] = "allocate_buffer";
+static const char __pyx_k_create_all_zero[] = "create_all_zero";
 static const char __pyx_k_dtype_is_object[] = "dtype_is_object";
 static const char __pyx_k_minimize_dimacs[] = "_minimize_dimacs";
 static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
 static const char __pyx_k_sorted_contains[] = "sorted_contains";
+static const char __pyx_k_create_all_equal[] = "create_all_equal";
+static const char __pyx_k_is_not_in_Clause[] = " is not in Clause";
+static const char __pyx_k_Clause___reversed[] = "Clause.__reversed__";
 static const char __pyx_k_file_format_error[] = "file format error";
 static const char __pyx_k_pyx_unpickle_Enum[] = "__pyx_unpickle_Enum";
 static const char __pyx_k_CalledProcessError[] = "CalledProcessError";
 static const char __pyx_k_NamedTemporaryFile[] = "NamedTemporaryFile";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_index_out_of_range[] = "index out of range";
+static const char __pyx_k_solution_of_length[] = "solution of length ";
 static const char __pyx_k_strided_and_direct[] = "<strided and direct>";
 static const char __pyx_k_pyx_unpickle_Clause[] = "__pyx_unpickle_Clause";
+static const char __pyx_k_sat_toolkit_formula[] = "sat_toolkit.formula";
 static const char __pyx_k_strided_and_indirect[] = "<strided and indirect>";
 static const char __pyx_k_var_must_not_be_zero[] = "var must not be zero";
 static const char __pyx_k_contiguous_and_direct[] = "<contiguous and direct>";
-static const char __pyx_k_sat_toolkit__cnf_util[] = "sat_toolkit._cnf_util";
 static const char __pyx_k_MemoryView_of_r_object[] = "<MemoryView of %r object>";
 static const char __pyx_k_cannot_use_0_in_clause[] = "cannot use 0 in clause";
+static const char __pyx_k_too_short_for_CNF_with[] = " too short for CNF with ";
 static const char __pyx_k_MemoryView_of_r_at_0x_x[] = "<MemoryView of %r at 0x%x>";
 static const char __pyx_k_contiguous_and_indirect[] = "<contiguous and indirect>";
 static const char __pyx_k_invalid_value_for_phase[] = "invalid value for `phase`";
 static const char __pyx_k_pyx_unpickle_Truthtable[] = "__pyx_unpickle_Truthtable";
+static const char __pyx_k_sat_toolkit_formula_pyx[] = "sat_toolkit/formula.pyx";
 static const char __pyx_k_Cannot_index_with_type_s[] = "Cannot index with type '%s'";
 static const char __pyx_k_Invalid_shape_in_axis_d_d[] = "Invalid shape in axis %d: %d.";
 static const char __pyx_k_file_format_error_in_line[] = "file format error in line ";
-static const char __pyx_k_sat_toolkit__cnf_util_pyx[] = "sat_toolkit/_cnf_util.pyx";
+static const char __pyx_k_too_few_variables_supplied[] = "too few variables supplied";
+static const char __pyx_k_all_indices_must_be_nonzero[] = "all indices must be nonzero";
 static const char __pyx_k_itemsize_0_for_cython_array[] = "itemsize <= 0 for cython.array";
 static const char __pyx_k_use_from_lut_or_from_indices[] = "use .from_lut or .from_indices";
 static const char __pyx_k_write_locals_sorted_contains[] = "_write.<locals>.sorted_contains";
 static const char __pyx_k_unable_to_allocate_array_data[] = "unable to allocate array data.";
 static const char __pyx_k_cannot_use_0_as_part_of_clause[] = "cannot use 0 as part of clause";
 static const char __pyx_k_strided_and_direct_or_indirect[] = "<strided and direct or indirect>";
-static const char __pyx_k_variable_0_must_be_mapped_to_0[] = "variable 0 must be mapped to 0";
+static const char __pyx_k_variable_0_must_map_to_0_again[] = "variable 0 must map to 0 again";
 static const char __pyx_k_last_clause_not_terminated_with[] = "last clause not terminated with 0";
 static const char __pyx_k_need_to_provide_translation_for[] = "need to provide translation for all 1+{self.nvars} variables";
-static const char __pyx_k_too_few_variables_supplied_need[] = "too few variables supplied (need to include dummy variable for 0)";
 static const char __pyx_k_Buffer_view_does_not_expose_stri[] = "Buffer view does not expose strides";
 static const char __pyx_k_Can_only_create_a_buffer_that_is[] = "Can only create a buffer that is contiguous in memory.";
 static const char __pyx_k_Cannot_assign_to_read_only_memor[] = "Cannot assign to read-only memoryview";
 static const char __pyx_k_Cannot_create_writable_memory_vi[] = "Cannot create writable memory view from read-only memoryview";
 static const char __pyx_k_Empty_shape_tuple_for_cython_arr[] = "Empty shape tuple for cython.array";
 static const char __pyx_k_Incompatible_checksums_0x_x_vs_0[] = "Incompatible checksums (0x%x vs (0xab15654, 0x9d96e17, 0x4c5c891) = (clause))";
 static const char __pyx_k_Indirect_dimensions_not_supporte[] = "Indirect dimensions not supported";
 static const char __pyx_k_Invalid_mode_expected_c_or_fortr[] = "Invalid mode, expected 'c' or 'fortran', got %s";
 static const char __pyx_k_Out_of_bounds_on_buffer_access_a[] = "Out of bounds on buffer access (axis %d)";
 static const char __pyx_k_Unable_to_convert_item_to_object[] = "Unable to convert item to object";
+static const char __pyx_k_all_elements_in_solution_must_be[] = "all elements in solution must be in [0, 1]";
 static const char __pyx_k_cannot_alter_while_referenced_by[] = "cannot alter while referenced by buffer";
+static const char __pyx_k_cannot_find_all_solutions_for_CN[] = "cannot find all solutions for CNF with more than 32 variables";
+static const char __pyx_k_cannot_provide_a_writable_buffer[] = "cannot provide a writable buffer for CNF";
+static const char __pyx_k_create_xor_only_supports_positiv[] = "create_xor only supports positive indexes";
 static const char __pyx_k_explicitly_given_nvars_too_small[] = "explicitly given nvars too small (";
 static const char __pyx_k_got_differing_extents_in_dimensi[] = "got differing extents in dimension %d (got %d and %d)";
 static const char __pyx_k_got_unexpected_value_for_product[] = "got unexpected value for product term: ";
 static const char __pyx_k_length_parameter_must_be_a_power[] = "length parameter must be a power of 2";
+static const char __pyx_k_lhs_and_rhs_must_have_the_same_l[] = "lhs and rhs must have the same length";
+static const char __pyx_k_must_provide_at_least_one_argume[] = "must provide at least one argument";
 static const char __pyx_k_no_default___reduce___due_to_non[] = "no default __reduce__ due to non-trivial __cinit__";
 static const char __pyx_k_on_lut_and_dc_lut_must_be_distin[] = "on_lut and dc_lut must be distinct";
 static const char __pyx_k_parameters_must_be_one_dimension[] = "parameters must be one dimensional";
 static const char __pyx_k_parameters_must_have_the_same_sh[] = "parameters must have the same shape";
+static const char __pyx_k_right_hand_side_must_be_0_or_1_n[] = "right hand side must be 0 or 1, not ";
 static const char __pyx_k_unable_to_allocate_shape_and_str[] = "unable to allocate shape and strides.";
 static const char __pyx_k_variable_must_not_be_mapped_to_0[] = "variable must not be mapped to 0";
 static const char __pyx_k_Incompatible_checksums_0x_x_vs_0_2[] = "Incompatible checksums (0x%x vs (0xb9e22c6, 0x4062f4b, 0x8299fc5) = (dc_set, numbits, on_set))";
 static const char __pyx_k_Incompatible_checksums_0x_x_vs_0_3[] = "Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))";
 static PyObject *__pyx_kp_u_0;
 static PyObject *__pyx_kp_u_0_2;
 static PyObject *__pyx_kp_u_1;
 static PyObject *__pyx_n_s_ASCII;
 static PyObject *__pyx_kp_s_Buffer_view_does_not_expose_stri;
 static PyObject *__pyx_n_s_BytesIO;
 static PyObject *__pyx_n_s_CNF;
+static PyObject *__pyx_n_u_CNF;
 static PyObject *__pyx_n_s_CNF___iter;
+static PyObject *__pyx_n_s_CNF___reversed;
 static PyObject *__pyx_kp_u_CNF_over;
 static PyObject *__pyx_n_s_CalledProcessError;
 static PyObject *__pyx_kp_s_Can_only_create_a_buffer_that_is;
 static PyObject *__pyx_kp_s_Cannot_assign_to_read_only_memor;
 static PyObject *__pyx_kp_s_Cannot_create_writable_memory_vi;
 static PyObject *__pyx_kp_s_Cannot_index_with_type_s;
 static PyObject *__pyx_kp_u_Clause;
 static PyObject *__pyx_n_s_Clause_2;
+static PyObject *__pyx_n_u_Clause_2;
 static PyObject *__pyx_n_s_Clause___iter;
+static PyObject *__pyx_n_s_Clause___reversed;
 static PyObject *__pyx_kp_u_Dverify;
 static PyObject *__pyx_n_s_Ellipsis;
 static PyObject *__pyx_kp_s_Empty_shape_tuple_for_cython_arr;
 static PyObject *__pyx_n_s_INIT_INDEX_SET;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0_2;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0_3;
@@ -2858,138 +3067,168 @@
 static PyObject *__pyx_kp_u_None;
 static PyObject *__pyx_kp_u_O;
 static PyObject *__pyx_n_b_O_2;
 static PyObject *__pyx_kp_s_Out_of_bounds_on_buffer_access_a;
 static PyObject *__pyx_n_s_PIPE;
 static PyObject *__pyx_n_s_PickleError;
 static PyObject *__pyx_n_s_Popen;
+static PyObject *__pyx_n_s_Sequence;
 static PyObject *__pyx_n_s_StringIO;
 static PyObject *__pyx_kp_u_T;
+static PyObject *__pyx_n_s_TYPE_CHECKING;
 static PyObject *__pyx_kp_b_T_2;
 static PyObject *__pyx_n_u_Truthtable;
 static PyObject *__pyx_n_s_Truthtable_2;
+static PyObject *__pyx_n_u_Truthtable_2;
 static PyObject *__pyx_n_s_TypeError;
 static PyObject *__pyx_kp_s_Unable_to_convert_item_to_object;
 static PyObject *__pyx_n_s_ValueError;
 static PyObject *__pyx_n_s_View_MemoryView;
-static PyObject *__pyx_kp_u__13;
-static PyObject *__pyx_kp_u__28;
+static PyObject *__pyx_kp_u__17;
 static PyObject *__pyx_kp_u__3;
-static PyObject *__pyx_kp_b__52;
-static PyObject *__pyx_kp_b__53;
-static PyObject *__pyx_kp_b__54;
-static PyObject *__pyx_kp_b__55;
-static PyObject *__pyx_kp_u__56;
-static PyObject *__pyx_n_s__57;
-static PyObject *__pyx_kp_u__6;
-static PyObject *__pyx_n_s__60;
-static PyObject *__pyx_kp_u__8;
+static PyObject *__pyx_kp_u__35;
+static PyObject *__pyx_kp_u__5;
+static PyObject *__pyx_kp_b__58;
+static PyObject *__pyx_kp_b__59;
+static PyObject *__pyx_kp_b__60;
+static PyObject *__pyx_kp_b__61;
+static PyObject *__pyx_kp_u__62;
+static PyObject *__pyx_n_s__63;
+static PyObject *__pyx_n_s__66;
+static PyObject *__pyx_kp_u__7;
 static PyObject *__pyx_n_s_a;
+static PyObject *__pyx_n_s_abc;
 static PyObject *__pyx_n_s_add_clause;
+static PyObject *__pyx_n_s_add_clauses;
 static PyObject *__pyx_n_s_all;
+static PyObject *__pyx_n_s_all_2;
+static PyObject *__pyx_kp_u_all_elements_in_solution_must_be;
+static PyObject *__pyx_kp_u_all_indices_must_be_nonzero;
 static PyObject *__pyx_n_s_allocate_buffer;
 static PyObject *__pyx_n_s_any;
 static PyObject *__pyx_n_s_append;
+static PyObject *__pyx_n_s_arg;
 static PyObject *__pyx_n_s_args;
 static PyObject *__pyx_n_s_array;
 static PyObject *__pyx_n_s_axis;
 static PyObject *__pyx_n_u_b;
 static PyObject *__pyx_n_s_base;
 static PyObject *__pyx_n_s_bit_length;
 static PyObject *__pyx_n_s_bits;
 static PyObject *__pyx_n_s_c;
 static PyObject *__pyx_n_u_c;
 static PyObject *__pyx_kp_u_cannot_alter_while_referenced_by;
+static PyObject *__pyx_kp_u_cannot_find_all_solutions_for_CN;
+static PyObject *__pyx_kp_u_cannot_provide_a_writable_buffer;
 static PyObject *__pyx_kp_u_cannot_use_0_as_part_of_clause;
 static PyObject *__pyx_kp_u_cannot_use_0_in_clause;
 static PyObject *__pyx_n_s_class;
 static PyObject *__pyx_n_s_clause;
 static PyObject *__pyx_n_s_clauses;
 static PyObject *__pyx_kp_u_clauses_2;
 static PyObject *__pyx_n_s_cline_in_traceback;
 static PyObject *__pyx_n_s_close;
 static PyObject *__pyx_n_u_cnf;
+static PyObject *__pyx_n_s_collections;
 static PyObject *__pyx_n_s_concatenate;
 static PyObject *__pyx_kp_s_contiguous_and_direct;
 static PyObject *__pyx_kp_s_contiguous_and_indirect;
+static PyObject *__pyx_n_s_copy;
 static PyObject *__pyx_n_s_count_nonzero;
+static PyObject *__pyx_n_s_create_all_equal;
+static PyObject *__pyx_n_s_create_all_zero;
+static PyObject *__pyx_n_s_create_xor;
+static PyObject *__pyx_kp_u_create_xor_only_supports_positiv;
 static PyObject *__pyx_n_s_dataclass;
 static PyObject *__pyx_n_s_dataclasses;
 static PyObject *__pyx_n_s_dc_indices;
 static PyObject *__pyx_n_s_dc_lut;
 static PyObject *__pyx_n_s_dc_set;
 static PyObject *__pyx_n_s_dict;
 static PyObject *__pyx_n_s_dimacs;
 static PyObject *__pyx_kp_u_dimacs_2;
 static PyObject *__pyx_n_u_dnf;
 static PyObject *__pyx_n_s_dtype;
 static PyObject *__pyx_n_s_dtype_is_object;
+static PyObject *__pyx_n_s_empty;
 static PyObject *__pyx_n_s_encode;
-static PyObject *__pyx_kp_u_end;
+static PyObject *__pyx_n_s_end;
+static PyObject *__pyx_kp_u_end_2;
 static PyObject *__pyx_n_s_enter;
 static PyObject *__pyx_n_s_enumerate;
 static PyObject *__pyx_n_s_error;
 static PyObject *__pyx_n_s_espresso;
 static PyObject *__pyx_n_u_espresso;
 static PyObject *__pyx_n_s_espresso_args;
 static PyObject *__pyx_n_s_exit;
 static PyObject *__pyx_kp_u_expected_1;
 static PyObject *__pyx_kp_u_explicitly_given_nvars_too_small;
 static PyObject *__pyx_n_s_extra_args;
 static PyObject *__pyx_n_s_f;
-static PyObject *__pyx_n_s_false_op;
 static PyObject *__pyx_kp_u_file_format_error;
 static PyObject *__pyx_kp_u_file_format_error_in_line;
 static PyObject *__pyx_n_s_flags;
 static PyObject *__pyx_n_s_format;
 static PyObject *__pyx_n_s_fortran;
 static PyObject *__pyx_n_u_fortran;
 static PyObject *__pyx_n_s_from_dimacs;
 static PyObject *__pyx_n_s_from_espresso;
 static PyObject *__pyx_n_s_from_indices;
 static PyObject *__pyx_n_s_from_lut;
+static PyObject *__pyx_n_s_frombuffer;
 static PyObject *__pyx_n_s_fromstring;
 static PyObject *__pyx_n_s_getstate;
 static PyObject *__pyx_n_s_getvalue;
 static PyObject *__pyx_kp_s_got_differing_extents_in_dimensi;
 static PyObject *__pyx_kp_u_got_unexpected_value_for_product;
 static PyObject *__pyx_kp_u_i;
 static PyObject *__pyx_n_s_i_2;
 static PyObject *__pyx_n_s_id;
 static PyObject *__pyx_n_s_idx;
 static PyObject *__pyx_n_s_import;
 static PyObject *__pyx_kp_u_index_out_of_range;
+static PyObject *__pyx_n_s_indices;
 static PyObject *__pyx_n_s_init_key;
 static PyObject *__pyx_n_s_int32;
 static PyObject *__pyx_kp_u_invalid_value_for_phase;
 static PyObject *__pyx_n_s_invert;
 static PyObject *__pyx_n_s_io;
+static PyObject *__pyx_kp_u_is_not_in_CNF;
+static PyObject *__pyx_kp_u_is_not_in_Clause;
 static PyObject *__pyx_n_s_itemsize;
 static PyObject *__pyx_kp_s_itemsize_0_for_cython_array;
 static PyObject *__pyx_n_s_iter;
 static PyObject *__pyx_n_s_join;
+static PyObject *__pyx_n_s_l;
 static PyObject *__pyx_kp_u_last_clause_not_terminated_with;
+static PyObject *__pyx_n_s_length;
 static PyObject *__pyx_kp_u_length_parameter_must_be_a_power;
+static PyObject *__pyx_n_s_lhs;
+static PyObject *__pyx_kp_u_lhs_and_rhs_must_have_the_same_l;
 static PyObject *__pyx_n_s_line;
 static PyObject *__pyx_n_s_line_py;
 static PyObject *__pyx_n_u_lingeling;
 static PyObject *__pyx_n_u_lingeling_2;
 static PyObject *__pyx_n_s_logical_or;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_mask;
 static PyObject *__pyx_n_s_memview;
 static PyObject *__pyx_n_s_minimize_dimacs;
 static PyObject *__pyx_n_s_mode;
+static PyObject *__pyx_kp_u_must_provide_at_least_one_argume;
 static PyObject *__pyx_n_s_name;
 static PyObject *__pyx_n_s_name_2;
 static PyObject *__pyx_n_s_ndim;
 static PyObject *__pyx_kp_u_need_to_provide_translation_for;
+static PyObject *__pyx_n_s_needle;
 static PyObject *__pyx_n_s_new;
 static PyObject *__pyx_kp_s_no_default___reduce___due_to_non;
 static PyObject *__pyx_n_s_np;
+static PyObject *__pyx_n_s_num_args;
+static PyObject *__pyx_n_s_num_xors;
 static PyObject *__pyx_n_s_numbits;
 static PyObject *__pyx_n_s_numpy;
 static PyObject *__pyx_n_s_nvars;
 static PyObject *__pyx_kp_u_o;
 static PyObject *__pyx_kp_u_o_1;
 static PyObject *__pyx_n_s_obj;
 static PyObject *__pyx_n_s_object;
@@ -2999,14 +3238,15 @@
 static PyObject *__pyx_n_s_on_set;
 static PyObject *__pyx_n_s_open;
 static PyObject *__pyx_n_s_optlevel;
 static PyObject *__pyx_n_s_outfile;
 static PyObject *__pyx_kp_u_p;
 static PyObject *__pyx_kp_u_p_cnf;
 static PyObject *__pyx_n_s_pack;
+static PyObject *__pyx_n_s_packed_args;
 static PyObject *__pyx_kp_u_parameters_must_be_one_dimension;
 static PyObject *__pyx_kp_u_parameters_must_have_the_same_sh;
 static PyObject *__pyx_kp_u_phase;
 static PyObject *__pyx_n_s_phase_2;
 static PyObject *__pyx_n_s_pickle;
 static PyObject *__pyx_n_s_prefix;
 static PyObject *__pyx_n_s_print_numvars;
@@ -3016,33 +3256,42 @@
 static PyObject *__pyx_n_s_pyx_result;
 static PyObject *__pyx_n_s_pyx_state;
 static PyObject *__pyx_n_s_pyx_type;
 static PyObject *__pyx_n_s_pyx_unpickle_Clause;
 static PyObject *__pyx_n_s_pyx_unpickle_Enum;
 static PyObject *__pyx_n_s_pyx_unpickle_Truthtable;
 static PyObject *__pyx_n_s_pyx_vtable;
+static PyObject *__pyx_n_s_r;
 static PyObject *__pyx_n_u_r;
 static PyObject *__pyx_n_s_range;
 static PyObject *__pyx_n_s_read;
 static PyObject *__pyx_n_s_reduce;
 static PyObject *__pyx_n_s_reduce_cython;
 static PyObject *__pyx_n_s_reduce_ex;
+static PyObject *__pyx_n_s_register;
 static PyObject *__pyx_n_s_res;
+static PyObject *__pyx_n_s_reversed;
+static PyObject *__pyx_n_s_reversed_2;
+static PyObject *__pyx_n_s_rhs;
+static PyObject *__pyx_kp_u_right_hand_side_must_be_0_or_1_n;
+static PyObject *__pyx_n_s_rstrip;
 static PyObject *__pyx_kp_u_s;
 static PyObject *__pyx_kp_u_s_2;
-static PyObject *__pyx_n_s_sat_toolkit__cnf_util;
-static PyObject *__pyx_kp_s_sat_toolkit__cnf_util_pyx;
+static PyObject *__pyx_n_s_sat_toolkit_formula;
+static PyObject *__pyx_kp_s_sat_toolkit_formula_pyx;
 static PyObject *__pyx_n_s_searchsorted;
 static PyObject *__pyx_n_s_send;
 static PyObject *__pyx_n_s_sep;
 static PyObject *__pyx_n_s_setstate;
 static PyObject *__pyx_n_s_setstate_cython;
 static PyObject *__pyx_n_s_shape;
 static PyObject *__pyx_n_s_sign;
 static PyObject *__pyx_n_s_size;
+static PyObject *__pyx_n_s_solution_len;
+static PyObject *__pyx_kp_u_solution_of_length;
 static PyObject *__pyx_n_s_sort;
 static PyObject *__pyx_n_s_sorted_contains;
 static PyObject *__pyx_n_s_sp;
 static PyObject *__pyx_n_s_split;
 static PyObject *__pyx_n_s_start;
 static PyObject *__pyx_n_s_start_indices;
 static PyObject *__pyx_n_s_staticmethod;
@@ -3050,104 +3299,119 @@
 static PyObject *__pyx_n_s_stdout;
 static PyObject *__pyx_n_s_step;
 static PyObject *__pyx_n_s_stop;
 static PyObject *__pyx_kp_s_strided_and_direct;
 static PyObject *__pyx_kp_s_strided_and_direct_or_indirect;
 static PyObject *__pyx_kp_s_strided_and_indirect;
 static PyObject *__pyx_kp_s_stringsource;
-static PyObject *__pyx_n_s_strip;
 static PyObject *__pyx_n_s_struct;
 static PyObject *__pyx_n_s_subprocess;
 static PyObject *__pyx_n_s_suffix;
 static PyObject *__pyx_n_s_sys;
 static PyObject *__pyx_n_s_tempfile;
 static PyObject *__pyx_n_s_test;
 static PyObject *__pyx_n_s_text;
 static PyObject *__pyx_n_s_throw;
 static PyObject *__pyx_n_s_timeout;
 static PyObject *__pyx_n_s_to_dimacs;
 static PyObject *__pyx_n_s_to_espresso;
-static PyObject *__pyx_kp_u_too_few_variables_supplied_need;
-static PyObject *__pyx_n_s_true_op;
+static PyObject *__pyx_kp_u_too_few_variables_supplied;
+static PyObject *__pyx_kp_u_too_short_for_CNF_with;
 static PyObject *__pyx_n_s_typing;
+static PyObject *__pyx_n_s_uint8;
 static PyObject *__pyx_kp_s_unable_to_allocate_array_data;
 static PyObject *__pyx_kp_s_unable_to_allocate_shape_and_str;
 static PyObject *__pyx_n_s_unpack;
 static PyObject *__pyx_n_s_update;
 static PyObject *__pyx_kp_u_use_from_lut_or_from_indices;
 static PyObject *__pyx_n_s_v;
 static PyObject *__pyx_n_s_val;
 static PyObject *__pyx_kp_u_var_must_not_be_zero;
-static PyObject *__pyx_kp_u_variable_0_must_be_mapped_to_0;
+static PyObject *__pyx_kp_u_variable_0_must_map_to_0_again;
 static PyObject *__pyx_kp_u_variable_must_not_be_mapped_to_0;
-static PyObject *__pyx_n_s_variables;
+static PyObject *__pyx_kp_u_variables;
 static PyObject *__pyx_kp_u_variables_with;
 static PyObject *__pyx_n_s_wait;
 static PyObject *__pyx_n_s_where;
 static PyObject *__pyx_n_s_write;
 static PyObject *__pyx_n_s_write_2;
 static PyObject *__pyx_n_s_write_locals_sorted_contains;
 static PyObject *__pyx_n_s_zeros;
-static int __pyx_pf_11sat_toolkit_9_cnf_util_6Clause___init__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self, PyObject *__pyx_v_clause); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_2apply_to_variables(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self, PyObject *__pyx_v_variables, PyObject *__pyx_v_true_op, PyObject *__pyx_v_false_op); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_6maxvar___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_4__repr__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_6__getitem__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto */
-static Py_ssize_t __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_8__len__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_10__iter__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_13__reduce_cython__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_15__setstate_cython__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_3CNF___init__(CYTHON_UNUSED struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_clauses, CYTHON_UNUSED PyObject *__pyx_v_nvars); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_2__cinit__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_clauses, int __pyx_v_nvars); /* proto */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_4from_dimacs(PyObject *__pyx_v_dimacs); /* proto */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_6from_espresso(PyObject *__pyx_v_espresso); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_8add_clauses(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_clauses); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_10add_clause(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_clause); /* proto */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_12logical_or(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, int __pyx_v_var); /* proto */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_14implied_by(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, int __pyx_v_var); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_16to_dimacs(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_18to_espresso(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_print_numvars); /* proto */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_20minimize_espresso(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_espresso_args); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_22_minimize_dimacs(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_args, PyObject *__pyx_v_outfile); /* proto */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_24minimize_lingeling(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_optlevel, PyObject *__pyx_v_timeout, PyObject *__pyx_v_extra_args); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_26__getitem__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto */
-static Py_ssize_t __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_28__len__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_30__iter__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_33__eq__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_35__repr__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_37__str__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_39__reduce__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_41equiv(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_other); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_43translate(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_new_vars); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_45__getbuffer__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, Py_buffer *__pyx_v_buffer, CYTHON_UNUSED int __pyx_v_flags); /* proto */
-static void __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_47__releasebuffer__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, CYTHON_UNUSED Py_buffer *__pyx_v_buffer); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_7clauses___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_13start_indices___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_5nvars___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable___init__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_init_key, PyObject *__pyx_v_numbits, PyObject *__pyx_v_on_set, PyObject *__pyx_v_dc_set); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_2from_lut(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_on_lut, PyObject *__pyx_v_dc_lut); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_4from_indices(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_numbits, PyObject *__pyx_v_on_indices, PyObject *__pyx_v_dc_indices); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6_write_sorted_contains(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_a, PyObject *__pyx_v_v); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6_write(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_io, PyObject *__pyx_v_espresso, PyObject *__pyx_v_invert); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_8to_espresso(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_phase); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_10__repr__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_12__eq__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_14to_cnf(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_espresso_args); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_2__set__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_4__del__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_2__set__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_4__del__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_7numbits___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self); /* proto */
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_2__set__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_16__reduce_cython__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_18__setstate_cython__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_2__pyx_unpickle_Truthtable(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_6Clause___init__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, PyObject *__pyx_v_clause); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_2to_linear_constraint(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, PyObject *__pyx_v_variables); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_6maxvar___get__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_4__repr__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_6__getitem__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto */
+static Py_ssize_t __pyx_pf_11sat_toolkit_7formula_6Clause_8__len__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_6Clause_10__contains__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, int __pyx_v_needle); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_12__iter__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_15__reversed__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_18count(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, int __pyx_v_needle); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_20index(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, int __pyx_v_needle, PyObject *__pyx_v_start, PyObject *__pyx_v_end); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_22__eq__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_24__reduce_cython__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_26__setstate_cython__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_3CNF___init__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_clauses, PyObject *__pyx_v_nvars); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_3CNF_2__cinit__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_4from_dimacs(PyObject *__pyx_v_dimacs); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_6from_espresso(PyObject *__pyx_v_espresso); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_8create_all_zero(__Pyx_memviewslice __pyx_v_indices); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_10create_all_equal(__Pyx_memviewslice __pyx_v_lhs, __Pyx_memviewslice __pyx_v_rhs); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_12create_xor(PyObject *__pyx_v_rhs, PyObject *__pyx_v_args); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_14add_clauses(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_clauses); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_16add_clause(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_clause); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_18__iadd__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_clauses); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_20logical_or(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, int __pyx_v_var); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_22implied_by(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, int __pyx_v_var); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_24to_dimacs(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_26to_espresso(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_print_numvars); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_28minimize_espresso(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_espresso_args); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_30_minimize_dimacs(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_args, PyObject *__pyx_v_outfile); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_32minimize_lingeling(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_optlevel, PyObject *__pyx_v_timeout, PyObject *__pyx_v_extra_args); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_34check_solution(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_solution); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pf_11sat_toolkit_7formula_3CNF_36to_truthtable(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_38__getitem__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx); /* proto */
+static Py_ssize_t __pyx_pf_11sat_toolkit_7formula_3CNF_40__len__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_42__iter__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_45__reversed__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_3CNF_48__contains__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_needle); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_50count(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_needle); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_52index(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_needle, PyObject *__pyx_v_start, PyObject *__pyx_v_end); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_54__eq__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_56__repr__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_58__str__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_60__reduce__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_62equiv(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_other); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_64translate(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_mapping); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_3CNF_66__getbuffer__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_buffer *__pyx_v_buffer, int __pyx_v_flags); /* proto */
+static void __pyx_pf_11sat_toolkit_7formula_3CNF_68__releasebuffer__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_buffer *__pyx_v_buffer); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_7clauses___get__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_13start_indices___get__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_5nvars___get__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable___init__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_init_key, PyObject *__pyx_v_numbits, PyObject *__pyx_v_on_set, PyObject *__pyx_v_dc_set); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pf_11sat_toolkit_7formula_10Truthtable_2from_lut(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_on_lut, PyObject *__pyx_v_dc_lut); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pf_11sat_toolkit_7formula_10Truthtable_4from_indices(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_numbits, PyObject *__pyx_v_on_indices, PyObject *__pyx_v_dc_indices); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_6_write_sorted_contains(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_a, PyObject *__pyx_v_v); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_6_write(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_io, PyObject *__pyx_v_espresso, PyObject *__pyx_v_invert); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_8to_espresso(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_phase); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_10__repr__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_12__eq__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_10Truthtable_14to_cnf(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_espresso_args); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set___get__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set_2__set__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set_4__del__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set___get__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set_2__set__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set_4__del__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_7numbits___get__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self); /* proto */
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_7numbits_2__set__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_16__reduce_cython__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_18__setstate_cython__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula___pyx_unpickle_Clause(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
+static PyObject *__pyx_pf_11sat_toolkit_7formula_2__pyx_unpickle_Truthtable(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
 static int __pyx_array___pyx_pf_15View_dot_MemoryView_5array___cinit__(struct __pyx_array_obj *__pyx_v_self, PyObject *__pyx_v_shape, Py_ssize_t __pyx_v_itemsize, PyObject *__pyx_v_format, PyObject *__pyx_v_mode, int __pyx_v_allocate_buffer); /* proto */
 static int __pyx_array___pyx_pf_15View_dot_MemoryView_5array_2__getbuffer__(struct __pyx_array_obj *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /* proto */
 static void __pyx_array___pyx_pf_15View_dot_MemoryView_5array_4__dealloc__(struct __pyx_array_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_15View_dot_MemoryView_5array_7memview___get__(struct __pyx_array_obj *__pyx_v_self); /* proto */
 static Py_ssize_t __pyx_array___pyx_pf_15View_dot_MemoryView_5array_6__len__(struct __pyx_array_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_array___pyx_pf_15View_dot_MemoryView_5array_8__getattr__(struct __pyx_array_obj *__pyx_v_self, PyObject *__pyx_v_attr); /* proto */
 static PyObject *__pyx_array___pyx_pf_15View_dot_MemoryView_5array_10__getitem__(struct __pyx_array_obj *__pyx_v_self, PyObject *__pyx_v_item); /* proto */
@@ -3182,19 +3446,21 @@
 static PyObject *__pyx_pf___pyx_memoryview___reduce_cython__(CYTHON_UNUSED struct __pyx_memoryview_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf___pyx_memoryview_2__setstate_cython__(CYTHON_UNUSED struct __pyx_memoryview_obj *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
 static void __pyx_memoryviewslice___pyx_pf_15View_dot_MemoryView_16_memoryviewslice___dealloc__(struct __pyx_memoryviewslice_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_15View_dot_MemoryView_16_memoryviewslice_4base___get__(struct __pyx_memoryviewslice_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf___pyx_memoryviewslice___reduce_cython__(CYTHON_UNUSED struct __pyx_memoryviewslice_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf___pyx_memoryviewslice_2__setstate_cython__(CYTHON_UNUSED struct __pyx_memoryviewslice_obj *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
 static PyObject *__pyx_pf_15View_dot_MemoryView___pyx_unpickle_Enum(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util_Clause(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util_CNF(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util_Truthtable(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula_Clause(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula_CNF(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula_Truthtable(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct____iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_2___iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_array(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_int_0;
 static PyObject *__pyx_int_1;
 static PyObject *__pyx_int_67514187;
@@ -3203,164 +3469,240 @@
 static PyObject *__pyx_int_136945605;
 static PyObject *__pyx_int_136983863;
 static PyObject *__pyx_int_165244439;
 static PyObject *__pyx_int_179394132;
 static PyObject *__pyx_int_184977713;
 static PyObject *__pyx_int_194912966;
 static PyObject *__pyx_int_neg_1;
-static __Pyx_memviewslice __pyx_k__5;
-static PyObject *__pyx_k__14;
-static PyObject *__pyx_k__16;
-static PyObject *__pyx_k__25;
-static PyObject *__pyx_k__30;
+static PyObject *__pyx_k__18;
+static PyObject *__pyx_k__20;
+static PyObject *__pyx_k__32;
+static PyObject *__pyx_k__37;
 static PyObject *__pyx_tuple_;
 static PyObject *__pyx_tuple__2;
 static PyObject *__pyx_tuple__4;
-static PyObject *__pyx_tuple__7;
+static PyObject *__pyx_tuple__6;
+static PyObject *__pyx_tuple__8;
 static PyObject *__pyx_tuple__9;
-static PyObject *__pyx_slice__47;
+static PyObject *__pyx_slice__12;
 static PyObject *__pyx_tuple__10;
 static PyObject *__pyx_tuple__11;
-static PyObject *__pyx_tuple__12;
+static PyObject *__pyx_tuple__13;
+static PyObject *__pyx_tuple__14;
 static PyObject *__pyx_tuple__15;
-static PyObject *__pyx_tuple__17;
-static PyObject *__pyx_tuple__18;
+static PyObject *__pyx_tuple__16;
 static PyObject *__pyx_tuple__19;
-static PyObject *__pyx_tuple__20;
 static PyObject *__pyx_tuple__21;
 static PyObject *__pyx_tuple__22;
 static PyObject *__pyx_tuple__23;
 static PyObject *__pyx_tuple__24;
+static PyObject *__pyx_tuple__25;
 static PyObject *__pyx_tuple__26;
+static PyObject *__pyx_tuple__27;
+static PyObject *__pyx_tuple__28;
 static PyObject *__pyx_tuple__29;
+static PyObject *__pyx_tuple__30;
 static PyObject *__pyx_tuple__31;
-static PyObject *__pyx_tuple__32;
 static PyObject *__pyx_tuple__33;
-static PyObject *__pyx_tuple__34;
-static PyObject *__pyx_tuple__35;
 static PyObject *__pyx_tuple__36;
-static PyObject *__pyx_tuple__37;
 static PyObject *__pyx_tuple__38;
 static PyObject *__pyx_tuple__39;
 static PyObject *__pyx_tuple__40;
 static PyObject *__pyx_tuple__41;
 static PyObject *__pyx_tuple__42;
 static PyObject *__pyx_tuple__43;
 static PyObject *__pyx_tuple__44;
 static PyObject *__pyx_tuple__45;
 static PyObject *__pyx_tuple__46;
+static PyObject *__pyx_tuple__47;
 static PyObject *__pyx_tuple__48;
 static PyObject *__pyx_tuple__49;
 static PyObject *__pyx_tuple__50;
 static PyObject *__pyx_tuple__51;
-static PyObject *__pyx_tuple__58;
-static PyObject *__pyx_tuple__61;
-static PyObject *__pyx_tuple__63;
-static PyObject *__pyx_tuple__65;
+static PyObject *__pyx_tuple__52;
+static PyObject *__pyx_tuple__53;
+static PyObject *__pyx_tuple__54;
+static PyObject *__pyx_tuple__55;
+static PyObject *__pyx_tuple__56;
+static PyObject *__pyx_tuple__57;
+static PyObject *__pyx_tuple__64;
 static PyObject *__pyx_tuple__67;
-static PyObject *__pyx_tuple__68;
 static PyObject *__pyx_tuple__69;
-static PyObject *__pyx_tuple__70;
 static PyObject *__pyx_tuple__71;
-static PyObject *__pyx_tuple__72;
-static PyObject *__pyx_codeobj__27;
-static PyObject *__pyx_codeobj__59;
-static PyObject *__pyx_codeobj__62;
-static PyObject *__pyx_codeobj__64;
-static PyObject *__pyx_codeobj__66;
-static PyObject *__pyx_codeobj__73;
+static PyObject *__pyx_tuple__73;
+static PyObject *__pyx_tuple__75;
+static PyObject *__pyx_tuple__77;
+static PyObject *__pyx_tuple__79;
+static PyObject *__pyx_tuple__80;
+static PyObject *__pyx_tuple__81;
+static PyObject *__pyx_tuple__82;
+static PyObject *__pyx_tuple__83;
+static PyObject *__pyx_tuple__84;
+static PyObject *__pyx_codeobj__34;
+static PyObject *__pyx_codeobj__65;
+static PyObject *__pyx_codeobj__68;
+static PyObject *__pyx_codeobj__70;
+static PyObject *__pyx_codeobj__72;
+static PyObject *__pyx_codeobj__74;
+static PyObject *__pyx_codeobj__76;
+static PyObject *__pyx_codeobj__78;
+static PyObject *__pyx_codeobj__85;
 /* Late includes */
 
-/* "sat_toolkit/_cnf_util.pyx":39
- * from dataclasses import dataclass
+/* "sat_toolkit/formula.pyx":50
+ * __all__ = ['Clause', 'CNF', 'Truthtable']
  * 
  * cdef int startswith(const unsigned char[:] buf, const char *start) nogil:             # <<<<<<<<<<<<<<
  *     cdef ssize_t l = strlen(start)
  *     if buf.shape[0] < l:
  */
 
-static int __pyx_f_11sat_toolkit_9_cnf_util_startswith(__Pyx_memviewslice __pyx_v_buf, char const *__pyx_v_start) {
+static int __pyx_f_11sat_toolkit_7formula_startswith(__Pyx_memviewslice __pyx_v_buf, char const *__pyx_v_start) {
   Py_ssize_t __pyx_v_l;
   int __pyx_r;
   int __pyx_t_1;
   Py_ssize_t __pyx_t_2;
 
-  /* "sat_toolkit/_cnf_util.pyx":40
+  /* "sat_toolkit/formula.pyx":51
  * 
  * cdef int startswith(const unsigned char[:] buf, const char *start) nogil:
  *     cdef ssize_t l = strlen(start)             # <<<<<<<<<<<<<<
  *     if buf.shape[0] < l:
  *         return 0
  */
   __pyx_v_l = strlen(__pyx_v_start);
 
-  /* "sat_toolkit/_cnf_util.pyx":41
+  /* "sat_toolkit/formula.pyx":52
  * cdef int startswith(const unsigned char[:] buf, const char *start) nogil:
  *     cdef ssize_t l = strlen(start)
  *     if buf.shape[0] < l:             # <<<<<<<<<<<<<<
  *         return 0
  *     return strncmp(<const char *> &buf[0], <const char *> &start[0], l) == 0
  */
   __pyx_t_1 = (((__pyx_v_buf.shape[0]) < __pyx_v_l) != 0);
   if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":42
+    /* "sat_toolkit/formula.pyx":53
  *     cdef ssize_t l = strlen(start)
  *     if buf.shape[0] < l:
  *         return 0             # <<<<<<<<<<<<<<
  *     return strncmp(<const char *> &buf[0], <const char *> &start[0], l) == 0
  * 
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":41
+    /* "sat_toolkit/formula.pyx":52
  * cdef int startswith(const unsigned char[:] buf, const char *start) nogil:
  *     cdef ssize_t l = strlen(start)
  *     if buf.shape[0] < l:             # <<<<<<<<<<<<<<
  *         return 0
  *     return strncmp(<const char *> &buf[0], <const char *> &start[0], l) == 0
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":43
+  /* "sat_toolkit/formula.pyx":54
  *     if buf.shape[0] < l:
  *         return 0
  *     return strncmp(<const char *> &buf[0], <const char *> &start[0], l) == 0             # <<<<<<<<<<<<<<
  * 
- * 
+ * cdef int abs(int val) nogil:
  */
   __pyx_t_2 = 0;
   __pyx_r = (strncmp(((char const *)(&(*((unsigned char const  *) ( /* dim=0 */ (__pyx_v_buf.data + __pyx_t_2 * __pyx_v_buf.strides[0]) ))))), ((char const *)(&(__pyx_v_start[0]))), __pyx_v_l) == 0);
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":39
- * from dataclasses import dataclass
+  /* "sat_toolkit/formula.pyx":50
+ * __all__ = ['Clause', 'CNF', 'Truthtable']
  * 
  * cdef int startswith(const unsigned char[:] buf, const char *start) nogil:             # <<<<<<<<<<<<<<
  *     cdef ssize_t l = strlen(start)
  *     if buf.shape[0] < l:
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":48
+/* "sat_toolkit/formula.pyx":56
+ *     return strncmp(<const char *> &buf[0], <const char *> &start[0], l) == 0
+ * 
+ * cdef int abs(int val) nogil:             # <<<<<<<<<<<<<<
+ *     if val > 0:
+ *         return val
+ */
+
+static int __pyx_f_11sat_toolkit_7formula_abs(int __pyx_v_val) {
+  int __pyx_r;
+  int __pyx_t_1;
+
+  /* "sat_toolkit/formula.pyx":57
+ * 
+ * cdef int abs(int val) nogil:
+ *     if val > 0:             # <<<<<<<<<<<<<<
+ *         return val
+ *     return -val
+ */
+  __pyx_t_1 = ((__pyx_v_val > 0) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":58
+ * cdef int abs(int val) nogil:
+ *     if val > 0:
+ *         return val             # <<<<<<<<<<<<<<
+ *     return -val
+ * 
+ */
+    __pyx_r = __pyx_v_val;
+    goto __pyx_L0;
+
+    /* "sat_toolkit/formula.pyx":57
+ * 
+ * cdef int abs(int val) nogil:
+ *     if val > 0:             # <<<<<<<<<<<<<<
+ *         return val
+ *     return -val
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":59
+ *     if val > 0:
+ *         return val
+ *     return -val             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = (-__pyx_v_val);
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":56
+ *     return strncmp(<const char *> &buf[0], <const char *> &start[0], l) == 0
+ * 
+ * cdef int abs(int val) nogil:             # <<<<<<<<<<<<<<
+ *     if val > 0:
+ *         return val
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":64
  * cdef class Clause:
  *     cdef vector[int] clause
  *     def __init__(self, clause):             # <<<<<<<<<<<<<<
  *         cdef int c
  *         for c in clause:
  */
 
 /* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static int __pyx_pw_11sat_toolkit_7formula_6Clause_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_6Clause_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_clause = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
@@ -3379,1180 +3721,1365 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_clause)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 48, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 64, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_clause = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 48, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 64, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause___init__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self), __pyx_v_clause);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause___init__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self), __pyx_v_clause);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_6Clause___init__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self, PyObject *__pyx_v_clause) {
+static int __pyx_pf_11sat_toolkit_7formula_6Clause___init__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, PyObject *__pyx_v_clause) {
   int __pyx_v_c;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   Py_ssize_t __pyx_t_2;
   PyObject *(*__pyx_t_3)(PyObject *);
   PyObject *__pyx_t_4 = NULL;
   int __pyx_t_5;
   int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":50
+  /* "sat_toolkit/formula.pyx":66
  *     def __init__(self, clause):
  *         cdef int c
  *         for c in clause:             # <<<<<<<<<<<<<<
  *             if c == 0:
  *                 raise ValueError('cannot use 0 as part of clause')
  */
   if (likely(PyList_CheckExact(__pyx_v_clause)) || PyTuple_CheckExact(__pyx_v_clause)) {
     __pyx_t_1 = __pyx_v_clause; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
     __pyx_t_3 = NULL;
   } else {
-    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_clause); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 50, __pyx_L1_error)
+    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_clause); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
+    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 66, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_3)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 50, __pyx_L1_error)
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 50, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 66, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       } else {
         if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 50, __pyx_L1_error)
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 50, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 66, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       }
     } else {
       __pyx_t_4 = __pyx_t_3(__pyx_t_1);
       if (unlikely(!__pyx_t_4)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 50, __pyx_L1_error)
+          else __PYX_ERR(0, 66, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_4);
     }
-    __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 50, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 66, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_v_c = __pyx_t_5;
 
-    /* "sat_toolkit/_cnf_util.pyx":51
+    /* "sat_toolkit/formula.pyx":67
  *         cdef int c
  *         for c in clause:
  *             if c == 0:             # <<<<<<<<<<<<<<
  *                 raise ValueError('cannot use 0 as part of clause')
  *             self.clause.push_back(c)
  */
     __pyx_t_6 = ((__pyx_v_c == 0) != 0);
     if (unlikely(__pyx_t_6)) {
 
-      /* "sat_toolkit/_cnf_util.pyx":52
+      /* "sat_toolkit/formula.pyx":68
  *         for c in clause:
  *             if c == 0:
  *                 raise ValueError('cannot use 0 as part of clause')             # <<<<<<<<<<<<<<
  *             self.clause.push_back(c)
  *         self.clause.shrink_to_fit()
  */
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 52, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 68, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_Raise(__pyx_t_4, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __PYX_ERR(0, 52, __pyx_L1_error)
+      __PYX_ERR(0, 68, __pyx_L1_error)
 
-      /* "sat_toolkit/_cnf_util.pyx":51
+      /* "sat_toolkit/formula.pyx":67
  *         cdef int c
  *         for c in clause:
  *             if c == 0:             # <<<<<<<<<<<<<<
  *                 raise ValueError('cannot use 0 as part of clause')
  *             self.clause.push_back(c)
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":53
+    /* "sat_toolkit/formula.pyx":69
  *             if c == 0:
  *                 raise ValueError('cannot use 0 as part of clause')
  *             self.clause.push_back(c)             # <<<<<<<<<<<<<<
  *         self.clause.shrink_to_fit()
  * 
  */
     try {
       __pyx_v_self->clause.push_back(__pyx_v_c);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 53, __pyx_L1_error)
+      __PYX_ERR(0, 69, __pyx_L1_error)
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":50
+    /* "sat_toolkit/formula.pyx":66
  *     def __init__(self, clause):
  *         cdef int c
  *         for c in clause:             # <<<<<<<<<<<<<<
  *             if c == 0:
  *                 raise ValueError('cannot use 0 as part of clause')
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":54
+  /* "sat_toolkit/formula.pyx":70
  *                 raise ValueError('cannot use 0 as part of clause')
  *             self.clause.push_back(c)
  *         self.clause.shrink_to_fit()             # <<<<<<<<<<<<<<
  * 
  *     @staticmethod
  */
   __pyx_v_self->clause.shrink_to_fit();
 
-  /* "sat_toolkit/_cnf_util.pyx":48
+  /* "sat_toolkit/formula.pyx":64
  * cdef class Clause:
  *     cdef vector[int] clause
  *     def __init__(self, clause):             # <<<<<<<<<<<<<<
  *         cdef int c
  *         for c in clause:
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":57
+/* "sat_toolkit/formula.pyx":73
  * 
  *     @staticmethod
  *     cdef Clause from_memview(const int[:] clause):             # <<<<<<<<<<<<<<
  *         cdef size_t i
  *         cdef Clause res = Clause.__new__(Clause)
  */
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_f_11sat_toolkit_9_cnf_util_6Clause_from_memview(__Pyx_memviewslice __pyx_v_clause) {
+static struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_f_11sat_toolkit_7formula_6Clause_from_memview(__Pyx_memviewslice __pyx_v_clause) {
   size_t __pyx_v_i;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_res = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_res = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   std::vector<int> ::size_type __pyx_t_2;
   std::vector<int> ::size_type __pyx_t_3;
   size_t __pyx_t_4;
   size_t __pyx_t_5;
   int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("from_memview", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":59
+  /* "sat_toolkit/formula.pyx":75
  *     cdef Clause from_memview(const int[:] clause):
  *         cdef size_t i
  *         cdef Clause res = Clause.__new__(Clause)             # <<<<<<<<<<<<<<
  * 
  *         res.clause.resize(clause.shape[0])
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_11sat_toolkit_9_cnf_util_Clause(((PyTypeObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_Clause), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 59, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_11sat_toolkit_7formula_Clause(((PyTypeObject *)__pyx_ptype_11sat_toolkit_7formula_Clause), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 75, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_t_1);
+  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":61
+  /* "sat_toolkit/formula.pyx":77
  *         cdef Clause res = Clause.__new__(Clause)
  * 
  *         res.clause.resize(clause.shape[0])             # <<<<<<<<<<<<<<
  *         for i in range(res.clause.size()):
  *             if clause[i] == 0:
  */
   try {
     __pyx_v_res->clause.resize((__pyx_v_clause.shape[0]));
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 61, __pyx_L1_error)
+    __PYX_ERR(0, 77, __pyx_L1_error)
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":62
+  /* "sat_toolkit/formula.pyx":78
  * 
  *         res.clause.resize(clause.shape[0])
  *         for i in range(res.clause.size()):             # <<<<<<<<<<<<<<
  *             if clause[i] == 0:
  *                 raise ValueError('cannot use 0 as part of clause')
  */
   __pyx_t_2 = __pyx_v_res->clause.size();
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_i = __pyx_t_4;
 
-    /* "sat_toolkit/_cnf_util.pyx":63
+    /* "sat_toolkit/formula.pyx":79
  *         res.clause.resize(clause.shape[0])
  *         for i in range(res.clause.size()):
  *             if clause[i] == 0:             # <<<<<<<<<<<<<<
  *                 raise ValueError('cannot use 0 as part of clause')
  *             res.clause[i] = clause[i]
  */
     __pyx_t_5 = __pyx_v_i;
     __pyx_t_6 = (((*((int const  *) ( /* dim=0 */ (__pyx_v_clause.data + __pyx_t_5 * __pyx_v_clause.strides[0]) ))) == 0) != 0);
     if (unlikely(__pyx_t_6)) {
 
-      /* "sat_toolkit/_cnf_util.pyx":64
+      /* "sat_toolkit/formula.pyx":80
  *         for i in range(res.clause.size()):
  *             if clause[i] == 0:
  *                 raise ValueError('cannot use 0 as part of clause')             # <<<<<<<<<<<<<<
  *             res.clause[i] = clause[i]
  * 
  */
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 64, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_Raise(__pyx_t_1, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __PYX_ERR(0, 64, __pyx_L1_error)
+      __PYX_ERR(0, 80, __pyx_L1_error)
 
-      /* "sat_toolkit/_cnf_util.pyx":63
+      /* "sat_toolkit/formula.pyx":79
  *         res.clause.resize(clause.shape[0])
  *         for i in range(res.clause.size()):
  *             if clause[i] == 0:             # <<<<<<<<<<<<<<
  *                 raise ValueError('cannot use 0 as part of clause')
  *             res.clause[i] = clause[i]
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":65
+    /* "sat_toolkit/formula.pyx":81
  *             if clause[i] == 0:
  *                 raise ValueError('cannot use 0 as part of clause')
  *             res.clause[i] = clause[i]             # <<<<<<<<<<<<<<
  * 
  *         return res
  */
     __pyx_t_5 = __pyx_v_i;
     (__pyx_v_res->clause[__pyx_v_i]) = (*((int const  *) ( /* dim=0 */ (__pyx_v_clause.data + __pyx_t_5 * __pyx_v_clause.strides[0]) )));
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":67
+  /* "sat_toolkit/formula.pyx":83
  *             res.clause[i] = clause[i]
  * 
  *         return res             # <<<<<<<<<<<<<<
  * 
- *     def apply_to_variables(self, variables: list, true_op: Callable, false_op: Callable):
+ *     def to_linear_constraint(self, variables: List):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_res));
   __pyx_r = __pyx_v_res;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":57
+  /* "sat_toolkit/formula.pyx":73
  * 
  *     @staticmethod
  *     cdef Clause from_memview(const int[:] clause):             # <<<<<<<<<<<<<<
  *         cdef size_t i
  *         cdef Clause res = Clause.__new__(Clause)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.from_memview", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.from_memview", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_res);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":69
+/* "sat_toolkit/formula.pyx":85
  *         return res
  * 
- *     def apply_to_variables(self, variables: list, true_op: Callable, false_op: Callable):             # <<<<<<<<<<<<<<
- *         cdef size_t nvars = 0
- *         cdef size_t i
+ *     def to_linear_constraint(self, variables: List):             # <<<<<<<<<<<<<<
+ *         """
+ *         return the current clause as a linear constraint suitable for MILP modeling.
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_3apply_to_variables(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_6Clause_2apply_to_variables[] = "Clause.apply_to_variables(self, list variables: list, true_op: Callable, false_op: Callable)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_3apply_to_variables(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_variables = 0;
-  PyObject *__pyx_v_true_op = 0;
-  PyObject *__pyx_v_false_op = 0;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_3to_linear_constraint(PyObject *__pyx_v_self, PyObject *__pyx_v_variables); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_6Clause_2to_linear_constraint[] = "Clause.to_linear_constraint(self, variables: List)\n\n        return the current clause as a linear constraint suitable for MILP modeling.\n        the resulting constraint is suitable if all variables are constrained to [0, 1].\n\n        :param variables:   List of MILP (or similar) variables with overloaded\n                            __add__, __neg__, and __geq__. The list is shifted compared to the\n                            indexing, i.e. variables[0] correspsonds to index 1 in the Clause.\n        :return:    a linear constraint over variables\n        ";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_3to_linear_constraint(PyObject *__pyx_v_self, PyObject *__pyx_v_variables) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("apply_to_variables (wrapper)", 0);
-  {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_variables,&__pyx_n_s_true_op,&__pyx_n_s_false_op,0};
-    PyObject* values[3] = {0,0,0};
-    if (unlikely(__pyx_kwds)) {
-      Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-        CYTHON_FALLTHROUGH;
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-        CYTHON_FALLTHROUGH;
-        case  0: break;
-        default: goto __pyx_L5_argtuple_error;
-      }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
-        case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_variables)) != 0)) kw_args--;
-        else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_true_op)) != 0)) kw_args--;
-        else {
-          __Pyx_RaiseArgtupleInvalid("apply_to_variables", 1, 3, 3, 1); __PYX_ERR(0, 69, __pyx_L3_error)
-        }
-        CYTHON_FALLTHROUGH;
-        case  2:
-        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_false_op)) != 0)) kw_args--;
-        else {
-          __Pyx_RaiseArgtupleInvalid("apply_to_variables", 1, 3, 3, 2); __PYX_ERR(0, 69, __pyx_L3_error)
-        }
-      }
-      if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "apply_to_variables") < 0)) __PYX_ERR(0, 69, __pyx_L3_error)
-      }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
-      goto __pyx_L5_argtuple_error;
-    } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-    }
-    __pyx_v_variables = ((PyObject*)values[0]);
-    __pyx_v_true_op = values[1];
-    __pyx_v_false_op = values[2];
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("apply_to_variables", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 69, __pyx_L3_error)
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.apply_to_variables", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_RefNannyFinishContext();
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_variables), (&PyList_Type), 1, "variables", 1))) __PYX_ERR(0, 69, __pyx_L1_error)
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_2apply_to_variables(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self), __pyx_v_variables, __pyx_v_true_op, __pyx_v_false_op);
+  __Pyx_RefNannySetupContext("to_linear_constraint (wrapper)", 0);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_2to_linear_constraint(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self), ((PyObject *)__pyx_v_variables));
 
   /* function exit code */
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __pyx_r = NULL;
-  __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_2apply_to_variables(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self, PyObject *__pyx_v_variables, PyObject *__pyx_v_true_op, PyObject *__pyx_v_false_op) {
-  CYTHON_UNUSED size_t __pyx_v_nvars;
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_2to_linear_constraint(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, PyObject *__pyx_v_variables) {
   size_t __pyx_v_i;
   int __pyx_v_c;
-  PyObject *__pyx_v_res = NULL;
+  PyObject *__pyx_v_lhs = 0;
+  int __pyx_v_rhs;
+  PyObject *__pyx_v_var = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   Py_ssize_t __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   std::vector<int> ::size_type __pyx_t_4;
   std::vector<int> ::size_type __pyx_t_5;
   size_t __pyx_t_6;
-  PyObject *__pyx_t_7 = NULL;
+  long __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
-  int __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("apply_to_variables", 0);
+  __Pyx_RefNannySetupContext("to_linear_constraint", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":70
- * 
- *     def apply_to_variables(self, variables: list, true_op: Callable, false_op: Callable):
- *         cdef size_t nvars = 0             # <<<<<<<<<<<<<<
- *         cdef size_t i
+  /* "sat_toolkit/formula.pyx":98
  *         cdef int c
+ * 
+ *         cdef object lhs = 0             # <<<<<<<<<<<<<<
+ *         cdef int rhs = 1
+ * 
  */
-  __pyx_v_nvars = 0;
+  __Pyx_INCREF(__pyx_int_0);
+  __pyx_v_lhs = __pyx_int_0;
 
-  /* "sat_toolkit/_cnf_util.pyx":74
- *         cdef int c
+  /* "sat_toolkit/formula.pyx":99
  * 
- *         if <size_t> len(variables) < self._maxvar() + 1:             # <<<<<<<<<<<<<<
- *             raise ValueError(f'too few variables supplied (need to include dummy variable for 0)')
+ *         cdef object lhs = 0
+ *         cdef int rhs = 1             # <<<<<<<<<<<<<<
  * 
+ *         if <size_t> len(variables) < self._maxvar():
  */
-  if (unlikely(__pyx_v_variables == Py_None)) {
-    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 74, __pyx_L1_error)
-  }
-  __pyx_t_1 = PyList_GET_SIZE(__pyx_v_variables); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 74, __pyx_L1_error)
-  __pyx_t_2 = ((((size_t)__pyx_t_1) < (((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self->__pyx_vtab)->_maxvar(__pyx_v_self) + 1)) != 0);
-  if (unlikely(__pyx_t_2)) {
+  __pyx_v_rhs = 1;
 
-    /* "sat_toolkit/_cnf_util.pyx":75
+  /* "sat_toolkit/formula.pyx":101
+ *         cdef int rhs = 1
  * 
- *         if <size_t> len(variables) < self._maxvar() + 1:
- *             raise ValueError(f'too few variables supplied (need to include dummy variable for 0)')             # <<<<<<<<<<<<<<
+ *         if <size_t> len(variables) < self._maxvar():             # <<<<<<<<<<<<<<
+ *             raise IndexError(f'too few variables supplied')
  * 
- *         res = [None] * (<ssize_t> self.clause.size())
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 75, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 75, __pyx_L1_error)
+  __pyx_t_1 = PyObject_Length(__pyx_v_variables); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_2 = ((((size_t)__pyx_t_1) < ((struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause *)__pyx_v_self->__pyx_vtab)->_maxvar(__pyx_v_self)) != 0);
+  if (unlikely(__pyx_t_2)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":74
- *         cdef int c
+    /* "sat_toolkit/formula.pyx":102
  * 
- *         if <size_t> len(variables) < self._maxvar() + 1:             # <<<<<<<<<<<<<<
- *             raise ValueError(f'too few variables supplied (need to include dummy variable for 0)')
+ *         if <size_t> len(variables) < self._maxvar():
+ *             raise IndexError(f'too few variables supplied')             # <<<<<<<<<<<<<<
  * 
+ *         for i in range(self.clause.size()):
  */
-  }
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __PYX_ERR(0, 102, __pyx_L1_error)
 
-  /* "sat_toolkit/_cnf_util.pyx":77
- *             raise ValueError(f'too few variables supplied (need to include dummy variable for 0)')
+    /* "sat_toolkit/formula.pyx":101
+ *         cdef int rhs = 1
  * 
- *         res = [None] * (<ssize_t> self.clause.size())             # <<<<<<<<<<<<<<
+ *         if <size_t> len(variables) < self._maxvar():             # <<<<<<<<<<<<<<
+ *             raise IndexError(f'too few variables supplied')
  * 
- *         for i in range(self.clause.size()):
  */
-  __pyx_t_3 = PyList_New(1 * ((((Py_ssize_t)__pyx_v_self->clause.size())<0) ? 0:((Py_ssize_t)__pyx_v_self->clause.size()))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 77, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  { Py_ssize_t __pyx_temp;
-    for (__pyx_temp=0; __pyx_temp < ((Py_ssize_t)__pyx_v_self->clause.size()); __pyx_temp++) {
-      __Pyx_INCREF(Py_None);
-      __Pyx_GIVEREF(Py_None);
-      PyList_SET_ITEM(__pyx_t_3, __pyx_temp, Py_None);
-    }
   }
-  __pyx_v_res = ((PyObject*)__pyx_t_3);
-  __pyx_t_3 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":79
- *         res = [None] * (<ssize_t> self.clause.size())
+  /* "sat_toolkit/formula.pyx":104
+ *             raise IndexError(f'too few variables supplied')
  * 
  *         for i in range(self.clause.size()):             # <<<<<<<<<<<<<<
  *             c = self.clause[i]
- *             if c > 0:
+ *             var = variables[abs(c) - 1]
  */
   __pyx_t_4 = __pyx_v_self->clause.size();
   __pyx_t_5 = __pyx_t_4;
   for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
     __pyx_v_i = __pyx_t_6;
 
-    /* "sat_toolkit/_cnf_util.pyx":80
+    /* "sat_toolkit/formula.pyx":105
  * 
  *         for i in range(self.clause.size()):
  *             c = self.clause[i]             # <<<<<<<<<<<<<<
+ *             var = variables[abs(c) - 1]
  *             if c > 0:
- *                 res[i] = true_op(variables[c])
  */
     __pyx_v_c = (__pyx_v_self->clause[__pyx_v_i]);
 
-    /* "sat_toolkit/_cnf_util.pyx":81
+    /* "sat_toolkit/formula.pyx":106
  *         for i in range(self.clause.size()):
  *             c = self.clause[i]
+ *             var = variables[abs(c) - 1]             # <<<<<<<<<<<<<<
+ *             if c > 0:
+ *                 lhs += var
+ */
+    __pyx_t_7 = (__pyx_f_11sat_toolkit_7formula_abs(__pyx_v_c) - 1);
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_variables, __pyx_t_7, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 106, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_XDECREF_SET(__pyx_v_var, __pyx_t_3);
+    __pyx_t_3 = 0;
+
+    /* "sat_toolkit/formula.pyx":107
+ *             c = self.clause[i]
+ *             var = variables[abs(c) - 1]
  *             if c > 0:             # <<<<<<<<<<<<<<
- *                 res[i] = true_op(variables[c])
+ *                 lhs += var
  *             if c < 0:
  */
     __pyx_t_2 = ((__pyx_v_c > 0) != 0);
     if (__pyx_t_2) {
 
-      /* "sat_toolkit/_cnf_util.pyx":82
- *             c = self.clause[i]
+      /* "sat_toolkit/formula.pyx":108
+ *             var = variables[abs(c) - 1]
  *             if c > 0:
- *                 res[i] = true_op(variables[c])             # <<<<<<<<<<<<<<
+ *                 lhs += var             # <<<<<<<<<<<<<<
  *             if c < 0:
- *                 res[i] = false_op(variables[-c])
+ *                 lhs += -var
  */
-      if (unlikely(__pyx_v_variables == Py_None)) {
-        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 82, __pyx_L1_error)
-      }
-      __Pyx_INCREF(__pyx_v_true_op);
-      __pyx_t_7 = __pyx_v_true_op; __pyx_t_8 = NULL;
-      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
-        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
-        if (likely(__pyx_t_8)) {
-          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
-          __Pyx_INCREF(__pyx_t_8);
-          __Pyx_INCREF(function);
-          __Pyx_DECREF_SET(__pyx_t_7, function);
-        }
-      }
-      __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, PyList_GET_ITEM(__pyx_v_variables, __pyx_v_c)) : __Pyx_PyObject_CallOneArg(__pyx_t_7, PyList_GET_ITEM(__pyx_v_variables, __pyx_v_c));
-      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 82, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_lhs, __pyx_v_var); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (unlikely(__Pyx_SetItemInt(__pyx_v_res, __pyx_v_i, __pyx_t_3, size_t, 0, __Pyx_PyInt_FromSize_t, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_DECREF_SET(__pyx_v_lhs, __pyx_t_3);
+      __pyx_t_3 = 0;
 
-      /* "sat_toolkit/_cnf_util.pyx":81
- *         for i in range(self.clause.size()):
+      /* "sat_toolkit/formula.pyx":107
  *             c = self.clause[i]
+ *             var = variables[abs(c) - 1]
  *             if c > 0:             # <<<<<<<<<<<<<<
- *                 res[i] = true_op(variables[c])
+ *                 lhs += var
  *             if c < 0:
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":83
+    /* "sat_toolkit/formula.pyx":109
  *             if c > 0:
- *                 res[i] = true_op(variables[c])
+ *                 lhs += var
  *             if c < 0:             # <<<<<<<<<<<<<<
- *                 res[i] = false_op(variables[-c])
- *         return res
+ *                 lhs += -var
+ *                 rhs -= 1
  */
     __pyx_t_2 = ((__pyx_v_c < 0) != 0);
     if (__pyx_t_2) {
 
-      /* "sat_toolkit/_cnf_util.pyx":84
- *                 res[i] = true_op(variables[c])
+      /* "sat_toolkit/formula.pyx":110
+ *                 lhs += var
  *             if c < 0:
- *                 res[i] = false_op(variables[-c])             # <<<<<<<<<<<<<<
- *         return res
+ *                 lhs += -var             # <<<<<<<<<<<<<<
+ *                 rhs -= 1
  * 
  */
-      if (unlikely(__pyx_v_variables == Py_None)) {
-        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 84, __pyx_L1_error)
-      }
-      __pyx_t_9 = (-__pyx_v_c);
-      __Pyx_INCREF(__pyx_v_false_op);
-      __pyx_t_7 = __pyx_v_false_op; __pyx_t_8 = NULL;
-      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
-        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
-        if (likely(__pyx_t_8)) {
-          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
-          __Pyx_INCREF(__pyx_t_8);
-          __Pyx_INCREF(function);
-          __Pyx_DECREF_SET(__pyx_t_7, function);
-        }
-      }
-      __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, PyList_GET_ITEM(__pyx_v_variables, __pyx_t_9)) : __Pyx_PyObject_CallOneArg(__pyx_t_7, PyList_GET_ITEM(__pyx_v_variables, __pyx_t_9));
-      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 84, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_Negative(__pyx_v_var); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 110, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (unlikely(__Pyx_SetItemInt(__pyx_v_res, __pyx_v_i, __pyx_t_3, size_t, 0, __Pyx_PyInt_FromSize_t, 1, 0, 0) < 0)) __PYX_ERR(0, 84, __pyx_L1_error)
+      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_lhs, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 110, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_DECREF_SET(__pyx_v_lhs, __pyx_t_8);
+      __pyx_t_8 = 0;
 
-      /* "sat_toolkit/_cnf_util.pyx":83
+      /* "sat_toolkit/formula.pyx":111
+ *             if c < 0:
+ *                 lhs += -var
+ *                 rhs -= 1             # <<<<<<<<<<<<<<
+ * 
+ *         return lhs >= rhs
+ */
+      __pyx_v_rhs = (__pyx_v_rhs - 1);
+
+      /* "sat_toolkit/formula.pyx":109
  *             if c > 0:
- *                 res[i] = true_op(variables[c])
+ *                 lhs += var
  *             if c < 0:             # <<<<<<<<<<<<<<
- *                 res[i] = false_op(variables[-c])
- *         return res
+ *                 lhs += -var
+ *                 rhs -= 1
  */
     }
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":85
- *             if c < 0:
- *                 res[i] = false_op(variables[-c])
- *         return res             # <<<<<<<<<<<<<<
+  /* "sat_toolkit/formula.pyx":113
+ *                 rhs -= 1
  * 
+ *         return lhs >= rhs             # <<<<<<<<<<<<<<
  * 
+ *     cdef size_t _maxvar(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(__pyx_v_res);
-  __pyx_r = __pyx_v_res;
+  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_rhs); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 113, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __pyx_t_3 = PyObject_RichCompare(__pyx_v_lhs, __pyx_t_8, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 113, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_r = __pyx_t_3;
+  __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":69
+  /* "sat_toolkit/formula.pyx":85
  *         return res
  * 
- *     def apply_to_variables(self, variables: list, true_op: Callable, false_op: Callable):             # <<<<<<<<<<<<<<
- *         cdef size_t nvars = 0
- *         cdef size_t i
+ *     def to_linear_constraint(self, variables: List):             # <<<<<<<<<<<<<<
+ *         """
+ *         return the current clause as a linear constraint suitable for MILP modeling.
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.apply_to_variables", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.to_linear_constraint", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_res);
+  __Pyx_XDECREF(__pyx_v_lhs);
+  __Pyx_XDECREF(__pyx_v_var);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":88
- * 
+/* "sat_toolkit/formula.pyx":115
+ *         return lhs >= rhs
  * 
  *     cdef size_t _maxvar(self):             # <<<<<<<<<<<<<<
  *         cdef size_t i
  *         cdef int c, res = 0
  */
 
-static size_t __pyx_f_11sat_toolkit_9_cnf_util_6Clause__maxvar(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self) {
+static size_t __pyx_f_11sat_toolkit_7formula_6Clause__maxvar(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self) {
   size_t __pyx_v_i;
   int __pyx_v_c;
   int __pyx_v_res;
   size_t __pyx_r;
   __Pyx_RefNannyDeclarations
   std::vector<int> ::size_type __pyx_t_1;
   std::vector<int> ::size_type __pyx_t_2;
   size_t __pyx_t_3;
   int __pyx_t_4;
-  int __pyx_t_5;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_maxvar", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":90
+  /* "sat_toolkit/formula.pyx":117
  *     cdef size_t _maxvar(self):
  *         cdef size_t i
  *         cdef int c, res = 0             # <<<<<<<<<<<<<<
  *         for i in range(self.clause.size()):
  *             c = abs(self.clause[i])
  */
   __pyx_v_res = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":91
+  /* "sat_toolkit/formula.pyx":118
  *         cdef size_t i
  *         cdef int c, res = 0
  *         for i in range(self.clause.size()):             # <<<<<<<<<<<<<<
  *             c = abs(self.clause[i])
  *             if c > res:
  */
   __pyx_t_1 = __pyx_v_self->clause.size();
   __pyx_t_2 = __pyx_t_1;
   for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
     __pyx_v_i = __pyx_t_3;
 
-    /* "sat_toolkit/_cnf_util.pyx":92
+    /* "sat_toolkit/formula.pyx":119
  *         cdef int c, res = 0
  *         for i in range(self.clause.size()):
  *             c = abs(self.clause[i])             # <<<<<<<<<<<<<<
  *             if c > res:
  *                 res = c
  */
-    __pyx_t_4 = abs((__pyx_v_self->clause[__pyx_v_i])); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 92, __pyx_L1_error)
-    __pyx_v_c = __pyx_t_4;
+    __pyx_v_c = __pyx_f_11sat_toolkit_7formula_abs((__pyx_v_self->clause[__pyx_v_i]));
 
-    /* "sat_toolkit/_cnf_util.pyx":93
+    /* "sat_toolkit/formula.pyx":120
  *         for i in range(self.clause.size()):
  *             c = abs(self.clause[i])
  *             if c > res:             # <<<<<<<<<<<<<<
  *                 res = c
  *         return res
  */
-    __pyx_t_5 = ((__pyx_v_c > __pyx_v_res) != 0);
-    if (__pyx_t_5) {
+    __pyx_t_4 = ((__pyx_v_c > __pyx_v_res) != 0);
+    if (__pyx_t_4) {
 
-      /* "sat_toolkit/_cnf_util.pyx":94
+      /* "sat_toolkit/formula.pyx":121
  *             c = abs(self.clause[i])
  *             if c > res:
  *                 res = c             # <<<<<<<<<<<<<<
  *         return res
  * 
  */
       __pyx_v_res = __pyx_v_c;
 
-      /* "sat_toolkit/_cnf_util.pyx":93
+      /* "sat_toolkit/formula.pyx":120
  *         for i in range(self.clause.size()):
  *             c = abs(self.clause[i])
  *             if c > res:             # <<<<<<<<<<<<<<
  *                 res = c
  *         return res
  */
     }
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":95
+  /* "sat_toolkit/formula.pyx":122
  *             if c > res:
  *                 res = c
  *         return res             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __pyx_r = __pyx_v_res;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":88
- * 
+  /* "sat_toolkit/formula.pyx":115
+ *         return lhs >= rhs
  * 
  *     cdef size_t _maxvar(self):             # <<<<<<<<<<<<<<
  *         cdef size_t i
  *         cdef int c, res = 0
  */
 
   /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_WriteUnraisable("sat_toolkit._cnf_util.Clause._maxvar", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
-  __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":98
+/* "sat_toolkit/formula.pyx":125
  * 
  *     @property
- *     def maxvar(self):             # <<<<<<<<<<<<<<
+ *     def maxvar(self) -> int:             # <<<<<<<<<<<<<<
  *         return self._maxvar()
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_6maxvar_1__get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_6maxvar_1__get__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_6maxvar_1__get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_6maxvar_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_6maxvar___get__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_6maxvar___get__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_6maxvar___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_6maxvar___get__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":99
+  /* "sat_toolkit/formula.pyx":126
  *     @property
- *     def maxvar(self):
+ *     def maxvar(self) -> int:
  *         return self._maxvar()             # <<<<<<<<<<<<<<
  * 
- *     def __repr__(self):
+ *     def __repr__(self) -> str:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_FromSize_t(((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self->__pyx_vtab)->_maxvar(__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_FromSize_t(((struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause *)__pyx_v_self->__pyx_vtab)->_maxvar(__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":98
+  /* "sat_toolkit/formula.pyx":125
  * 
  *     @property
- *     def maxvar(self):             # <<<<<<<<<<<<<<
+ *     def maxvar(self) -> int:             # <<<<<<<<<<<<<<
  *         return self._maxvar()
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.maxvar.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.maxvar.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":101
+/* "sat_toolkit/formula.pyx":128
  *         return self._maxvar()
  * 
- *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *     def __repr__(self) -> str:             # <<<<<<<<<<<<<<
  *         return f'Clause({self.clause})'
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_5__repr__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_5__repr__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_5__repr__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_5__repr__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_4__repr__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_4__repr__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_4__repr__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_4__repr__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   Py_ssize_t __pyx_t_2;
   Py_UCS4 __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":102
+  /* "sat_toolkit/formula.pyx":129
  * 
- *     def __repr__(self):
+ *     def __repr__(self) -> str:
  *         return f'Clause({self.clause})'             # <<<<<<<<<<<<<<
  * 
- *     def __getitem__(self, ssize_t idx):
+ *     cdef size_t _get_absolute_index(self, ssize_t idx) except -1:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 129, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_Clause);
   __pyx_t_2 += 7;
   __Pyx_GIVEREF(__pyx_kp_u_Clause);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Clause);
-  __pyx_t_4 = __pyx_convert_vector_to_py_int(__pyx_v_self->clause); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_4 = __pyx_convert_vector_to_py_int(__pyx_v_self->clause); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 129, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 129, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 129, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":101
+  /* "sat_toolkit/formula.pyx":128
  *         return self._maxvar()
  * 
- *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *     def __repr__(self) -> str:             # <<<<<<<<<<<<<<
  *         return f'Clause({self.clause})'
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":104
+/* "sat_toolkit/formula.pyx":131
  *         return f'Clause({self.clause})'
  * 
- *     def __getitem__(self, ssize_t idx):             # <<<<<<<<<<<<<<
+ *     cdef size_t _get_absolute_index(self, ssize_t idx) except -1:             # <<<<<<<<<<<<<<
  *         if idx < 0:
  *             idx += self.clause.size()
  */
 
-/* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_7__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_idx); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_7__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_idx) {
-  Py_ssize_t __pyx_v_idx;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("__getitem__ (wrapper)", 0);
-  assert(__pyx_arg_idx); {
-    __pyx_v_idx = PyInt_AsSsize_t(__pyx_arg_idx); if (unlikely((__pyx_v_idx == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 104, __pyx_L3_error)
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_RefNannyFinishContext();
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_6__getitem__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self), ((Py_ssize_t)__pyx_v_idx));
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_6__getitem__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
-  PyObject *__pyx_r = NULL;
+static size_t __pyx_f_11sat_toolkit_7formula_6Clause__get_absolute_index(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
+  size_t __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__getitem__", 0);
+  __Pyx_RefNannySetupContext("_get_absolute_index", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":105
+  /* "sat_toolkit/formula.pyx":132
  * 
- *     def __getitem__(self, ssize_t idx):
+ *     cdef size_t _get_absolute_index(self, ssize_t idx) except -1:
  *         if idx < 0:             # <<<<<<<<<<<<<<
  *             idx += self.clause.size()
  *         if idx < 0 or <size_t> idx >= self.clause.size():
  */
   __pyx_t_1 = ((__pyx_v_idx < 0) != 0);
   if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":106
- *     def __getitem__(self, ssize_t idx):
+    /* "sat_toolkit/formula.pyx":133
+ *     cdef size_t _get_absolute_index(self, ssize_t idx) except -1:
  *         if idx < 0:
  *             idx += self.clause.size()             # <<<<<<<<<<<<<<
  *         if idx < 0 or <size_t> idx >= self.clause.size():
  *             raise IndexError('index out of range')
  */
     __pyx_v_idx = (__pyx_v_idx + __pyx_v_self->clause.size());
 
-    /* "sat_toolkit/_cnf_util.pyx":105
+    /* "sat_toolkit/formula.pyx":132
  * 
- *     def __getitem__(self, ssize_t idx):
+ *     cdef size_t _get_absolute_index(self, ssize_t idx) except -1:
  *         if idx < 0:             # <<<<<<<<<<<<<<
  *             idx += self.clause.size()
  *         if idx < 0 or <size_t> idx >= self.clause.size():
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":107
+  /* "sat_toolkit/formula.pyx":134
  *         if idx < 0:
  *             idx += self.clause.size()
  *         if idx < 0 or <size_t> idx >= self.clause.size():             # <<<<<<<<<<<<<<
  *             raise IndexError('index out of range')
- *         return self.clause[idx]
+ *         return <size_t> idx
  */
   __pyx_t_2 = ((__pyx_v_idx < 0) != 0);
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L5_bool_binop_done;
   }
   __pyx_t_2 = ((((size_t)__pyx_v_idx) >= __pyx_v_self->clause.size()) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L5_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":108
+    /* "sat_toolkit/formula.pyx":135
  *             idx += self.clause.size()
  *         if idx < 0 or <size_t> idx >= self.clause.size():
  *             raise IndexError('index out of range')             # <<<<<<<<<<<<<<
- *         return self.clause[idx]
+ *         return <size_t> idx
  * 
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 135, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 108, __pyx_L1_error)
+    __PYX_ERR(0, 135, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":107
+    /* "sat_toolkit/formula.pyx":134
  *         if idx < 0:
  *             idx += self.clause.size()
  *         if idx < 0 or <size_t> idx >= self.clause.size():             # <<<<<<<<<<<<<<
  *             raise IndexError('index out of range')
- *         return self.clause[idx]
+ *         return <size_t> idx
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":109
+  /* "sat_toolkit/formula.pyx":136
  *         if idx < 0 or <size_t> idx >= self.clause.size():
  *             raise IndexError('index out of range')
- *         return self.clause[idx]             # <<<<<<<<<<<<<<
+ *         return <size_t> idx             # <<<<<<<<<<<<<<
  * 
- *     def __len__(self):
+ *     cdef size_t _get_slice_index(self, ssize_t idx):
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyInt_From_int((__pyx_v_self->clause[__pyx_v_idx])); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 109, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_r = __pyx_t_3;
-  __pyx_t_3 = 0;
+  __pyx_r = ((size_t)__pyx_v_idx);
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":104
+  /* "sat_toolkit/formula.pyx":131
  *         return f'Clause({self.clause})'
  * 
- *     def __getitem__(self, ssize_t idx):             # <<<<<<<<<<<<<<
+ *     cdef size_t _get_absolute_index(self, ssize_t idx) except -1:             # <<<<<<<<<<<<<<
  *         if idx < 0:
  *             idx += self.clause.size()
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause._get_absolute_index", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1L;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":138
+ *         return <size_t> idx
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):             # <<<<<<<<<<<<<<
+ *         if idx < 0:
+ *             idx += self.clause.size()
+ */
+
+static size_t __pyx_f_11sat_toolkit_7formula_6Clause__get_slice_index(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
+  size_t __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  __Pyx_RefNannySetupContext("_get_slice_index", 0);
+
+  /* "sat_toolkit/formula.pyx":139
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):
+ *         if idx < 0:             # <<<<<<<<<<<<<<
+ *             idx += self.clause.size()
+ *         if idx < 0:
+ */
+  __pyx_t_1 = ((__pyx_v_idx < 0) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":140
+ *     cdef size_t _get_slice_index(self, ssize_t idx):
+ *         if idx < 0:
+ *             idx += self.clause.size()             # <<<<<<<<<<<<<<
+ *         if idx < 0:
+ *             return 0
+ */
+    __pyx_v_idx = (__pyx_v_idx + __pyx_v_self->clause.size());
+
+    /* "sat_toolkit/formula.pyx":139
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):
+ *         if idx < 0:             # <<<<<<<<<<<<<<
+ *             idx += self.clause.size()
+ *         if idx < 0:
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":141
+ *         if idx < 0:
+ *             idx += self.clause.size()
+ *         if idx < 0:             # <<<<<<<<<<<<<<
+ *             return 0
+ *         if <size_t> idx >= self.clause.size():
+ */
+  __pyx_t_1 = ((__pyx_v_idx < 0) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":142
+ *             idx += self.clause.size()
+ *         if idx < 0:
+ *             return 0             # <<<<<<<<<<<<<<
+ *         if <size_t> idx >= self.clause.size():
+ *             return self.clause.size()
+ */
+    __pyx_r = 0;
+    goto __pyx_L0;
+
+    /* "sat_toolkit/formula.pyx":141
+ *         if idx < 0:
+ *             idx += self.clause.size()
+ *         if idx < 0:             # <<<<<<<<<<<<<<
+ *             return 0
+ *         if <size_t> idx >= self.clause.size():
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":143
+ *         if idx < 0:
+ *             return 0
+ *         if <size_t> idx >= self.clause.size():             # <<<<<<<<<<<<<<
+ *             return self.clause.size()
+ *         return <size_t> idx
+ */
+  __pyx_t_1 = ((((size_t)__pyx_v_idx) >= __pyx_v_self->clause.size()) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":144
+ *             return 0
+ *         if <size_t> idx >= self.clause.size():
+ *             return self.clause.size()             # <<<<<<<<<<<<<<
+ *         return <size_t> idx
+ * 
+ */
+    __pyx_r = __pyx_v_self->clause.size();
+    goto __pyx_L0;
+
+    /* "sat_toolkit/formula.pyx":143
+ *         if idx < 0:
+ *             return 0
+ *         if <size_t> idx >= self.clause.size():             # <<<<<<<<<<<<<<
+ *             return self.clause.size()
+ *         return <size_t> idx
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":145
+ *         if <size_t> idx >= self.clause.size():
+ *             return self.clause.size()
+ *         return <size_t> idx             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = ((size_t)__pyx_v_idx);
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":138
+ *         return <size_t> idx
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):             # <<<<<<<<<<<<<<
+ *         if idx < 0:
+ *             idx += self.clause.size()
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":148
+ * 
+ * 
+ *     def __getitem__(self, ssize_t idx) -> int:             # <<<<<<<<<<<<<<
+ *         return self.clause[self._get_absolute_index(idx)]
+ * 
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_7__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_idx); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_7__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_idx) {
+  Py_ssize_t __pyx_v_idx;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__getitem__ (wrapper)", 0);
+  assert(__pyx_arg_idx); {
+    __pyx_v_idx = PyInt_AsSsize_t(__pyx_arg_idx); if (unlikely((__pyx_v_idx == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 148, __pyx_L3_error)
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_6__getitem__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self), ((Py_ssize_t)__pyx_v_idx));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_6__getitem__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  size_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__getitem__", 0);
+
+  /* "sat_toolkit/formula.pyx":149
+ * 
+ *     def __getitem__(self, ssize_t idx) -> int:
+ *         return self.clause[self._get_absolute_index(idx)]             # <<<<<<<<<<<<<<
+ * 
+ *     def __len__(self) -> int:
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause *)__pyx_v_self->__pyx_vtab)->_get_absolute_index(__pyx_v_self, __pyx_v_idx); if (unlikely(__pyx_t_1 == ((size_t)-1L))) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int((__pyx_v_self->clause[__pyx_t_1])); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":148
+ * 
+ * 
+ *     def __getitem__(self, ssize_t idx) -> int:             # <<<<<<<<<<<<<<
+ *         return self.clause[self._get_absolute_index(idx)]
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":111
- *         return self.clause[idx]
+/* "sat_toolkit/formula.pyx":151
+ *         return self.clause[self._get_absolute_index(idx)]
  * 
- *     def __len__(self):             # <<<<<<<<<<<<<<
+ *     def __len__(self) -> int:             # <<<<<<<<<<<<<<
  *         return self.clause.size()
  * 
  */
 
 /* Python wrapper */
-static Py_ssize_t __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_9__len__(PyObject *__pyx_v_self); /*proto*/
-static Py_ssize_t __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_9__len__(PyObject *__pyx_v_self) {
+static Py_ssize_t __pyx_pw_11sat_toolkit_7formula_6Clause_9__len__(PyObject *__pyx_v_self); /*proto*/
+static Py_ssize_t __pyx_pw_11sat_toolkit_7formula_6Clause_9__len__(PyObject *__pyx_v_self) {
   Py_ssize_t __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__len__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_8__len__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_8__len__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static Py_ssize_t __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_8__len__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self) {
+static Py_ssize_t __pyx_pf_11sat_toolkit_7formula_6Clause_8__len__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self) {
   Py_ssize_t __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__len__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":112
+  /* "sat_toolkit/formula.pyx":152
  * 
- *     def __len__(self):
+ *     def __len__(self) -> int:
  *         return self.clause.size()             # <<<<<<<<<<<<<<
  * 
- *     def __iter__(self):
+ *     def __contains__(self, int needle) -> bint:
  */
   __pyx_r = __pyx_v_self->clause.size();
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":111
- *         return self.clause[idx]
+  /* "sat_toolkit/formula.pyx":151
+ *         return self.clause[self._get_absolute_index(idx)]
  * 
- *     def __len__(self):             # <<<<<<<<<<<<<<
+ *     def __len__(self) -> int:             # <<<<<<<<<<<<<<
  *         return self.clause.size()
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_11sat_toolkit_9_cnf_util_6Clause_12generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "sat_toolkit/_cnf_util.pyx":114
+/* "sat_toolkit/formula.pyx":154
+ *         return self.clause.size()
+ * 
+ *     def __contains__(self, int needle) -> bint:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ *         cdef int c
+ */
+
+/* Python wrapper */
+static int __pyx_pw_11sat_toolkit_7formula_6Clause_11__contains__(PyObject *__pyx_v_self, PyObject *__pyx_arg_needle); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_6Clause_11__contains__(PyObject *__pyx_v_self, PyObject *__pyx_arg_needle) {
+  int __pyx_v_needle;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__contains__ (wrapper)", 0);
+  assert(__pyx_arg_needle); {
+    __pyx_v_needle = __Pyx_PyInt_As_int(__pyx_arg_needle); if (unlikely((__pyx_v_needle == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L3_error)
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__contains__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return -1;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_10__contains__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self), ((int)__pyx_v_needle));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_11sat_toolkit_7formula_6Clause_10__contains__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, int __pyx_v_needle) {
+  size_t __pyx_v_i;
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  std::vector<int> ::size_type __pyx_t_1;
+  std::vector<int> ::size_type __pyx_t_2;
+  size_t __pyx_t_3;
+  int __pyx_t_4;
+  __Pyx_RefNannySetupContext("__contains__", 0);
+
+  /* "sat_toolkit/formula.pyx":158
+ *         cdef int c
+ * 
+ *         for i in range(self.clause.size()):             # <<<<<<<<<<<<<<
+ *             if self.clause[i] == needle:
+ *                 return True
+ */
+  __pyx_t_1 = __pyx_v_self->clause.size();
+  __pyx_t_2 = __pyx_t_1;
+  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
+    __pyx_v_i = __pyx_t_3;
+
+    /* "sat_toolkit/formula.pyx":159
+ * 
+ *         for i in range(self.clause.size()):
+ *             if self.clause[i] == needle:             # <<<<<<<<<<<<<<
+ *                 return True
+ * 
+ */
+    __pyx_t_4 = (((__pyx_v_self->clause[__pyx_v_i]) == __pyx_v_needle) != 0);
+    if (__pyx_t_4) {
+
+      /* "sat_toolkit/formula.pyx":160
+ *         for i in range(self.clause.size()):
+ *             if self.clause[i] == needle:
+ *                 return True             # <<<<<<<<<<<<<<
+ * 
+ *         return False
+ */
+      __pyx_r = 1;
+      goto __pyx_L0;
+
+      /* "sat_toolkit/formula.pyx":159
+ * 
+ *         for i in range(self.clause.size()):
+ *             if self.clause[i] == needle:             # <<<<<<<<<<<<<<
+ *                 return True
+ * 
+ */
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":162
+ *                 return True
+ * 
+ *         return False             # <<<<<<<<<<<<<<
+ * 
+ *     def __iter__(self) -> Iterable[int]:
+ */
+  __pyx_r = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":154
  *         return self.clause.size()
  * 
- *     def __iter__(self):             # <<<<<<<<<<<<<<
+ *     def __contains__(self, int needle) -> bint:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ *         cdef int c
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+static PyObject *__pyx_gb_11sat_toolkit_7formula_6Clause_14generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+
+/* "sat_toolkit/formula.pyx":164
+ *         return False
+ * 
+ *     def __iter__(self) -> Iterable[int]:             # <<<<<<<<<<<<<<
  *         cdef size_t i = 0
  *         for i in range(self.clause.size()):
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_11__iter__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_11__iter__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_13__iter__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_13__iter__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_10__iter__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_12__iter__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_10__iter__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *__pyx_cur_scope;
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_12__iter__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self) {
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *__pyx_cur_scope;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__iter__", 0);
-  __pyx_cur_scope = (struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *)__pyx_tp_new_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__(__pyx_ptype_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *)__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct____iter__(__pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct____iter__, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 114, __pyx_L1_error)
+    __PYX_ERR(0, 164, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11sat_toolkit_9_cnf_util_6Clause_12generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_Clause___iter, __pyx_n_s_sat_toolkit__cnf_util); if (unlikely(!gen)) __PYX_ERR(0, 114, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11sat_toolkit_7formula_6Clause_14generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_Clause___iter, __pyx_n_s_sat_toolkit_formula); if (unlikely(!gen)) __PYX_ERR(0, 164, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_gb_11sat_toolkit_9_cnf_util_6Clause_12generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_11sat_toolkit_7formula_6Clause_14generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *__pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *)__pyx_generator->closure);
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *__pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   std::vector<int> ::size_type __pyx_t_1;
   std::vector<int> ::size_type __pyx_t_2;
   size_t __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -4563,45 +5090,45 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L6_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 114, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 164, __pyx_L1_error)
 
-  /* "sat_toolkit/_cnf_util.pyx":115
+  /* "sat_toolkit/formula.pyx":165
  * 
- *     def __iter__(self):
+ *     def __iter__(self) -> Iterable[int]:
  *         cdef size_t i = 0             # <<<<<<<<<<<<<<
  *         for i in range(self.clause.size()):
  *             yield self.clause[i]
  */
   __pyx_cur_scope->__pyx_v_i = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":116
- *     def __iter__(self):
+  /* "sat_toolkit/formula.pyx":166
+ *     def __iter__(self) -> Iterable[int]:
  *         cdef size_t i = 0
  *         for i in range(self.clause.size()):             # <<<<<<<<<<<<<<
  *             yield self.clause[i]
  * 
  */
   __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->clause.size();
   __pyx_t_2 = __pyx_t_1;
   for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
     __pyx_cur_scope->__pyx_v_i = __pyx_t_3;
 
-    /* "sat_toolkit/_cnf_util.pyx":117
+    /* "sat_toolkit/formula.pyx":167
  *         cdef size_t i = 0
  *         for i in range(self.clause.size()):
  *             yield self.clause[i]             # <<<<<<<<<<<<<<
  * 
- * 
+ *     def __reversed__(self) -> Iterable[int]:
  */
-    __pyx_t_4 = __Pyx_PyInt_From_int((__pyx_cur_scope->__pyx_v_self->clause[__pyx_cur_scope->__pyx_v_i])); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 117, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int((__pyx_cur_scope->__pyx_v_self->clause[__pyx_cur_scope->__pyx_v_i])); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 167, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_r = __pyx_t_4;
     __pyx_t_4 = 0;
     __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
     __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
     __pyx_cur_scope->__pyx_t_2 = __pyx_t_3;
     __Pyx_XGIVEREF(__pyx_r);
@@ -4610,22 +5137,22 @@
     /* return from generator, yielding value */
     __pyx_generator->resume_label = 1;
     return __pyx_r;
     __pyx_L6_resume_from_yield:;
     __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
     __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
     __pyx_t_3 = __pyx_cur_scope->__pyx_t_2;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 117, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 167, __pyx_L1_error)
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "sat_toolkit/_cnf_util.pyx":114
- *         return self.clause.size()
+  /* "sat_toolkit/formula.pyx":164
+ *         return False
  * 
- *     def __iter__(self):             # <<<<<<<<<<<<<<
+ *     def __iter__(self) -> Iterable[int]:             # <<<<<<<<<<<<<<
  *         cdef size_t i = 0
  *         for i in range(self.clause.size()):
  */
 
   /* function exit code */
   PyErr_SetNone(PyExc_StopIteration);
   goto __pyx_L0;
@@ -4638,36 +5165,752 @@
   __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
+static PyObject *__pyx_gb_11sat_toolkit_7formula_6Clause_17generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+
+/* "sat_toolkit/formula.pyx":169
+ *             yield self.clause[i]
+ * 
+ *     def __reversed__(self) -> Iterable[int]:             # <<<<<<<<<<<<<<
+ *         cdef size_t i = 0
+ *         for i in reversed(range(self.clause.size())):
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_16__reversed__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_6Clause_15__reversed__[] = "Clause.__reversed__(self) -> Iterable[int]";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_16__reversed__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__reversed__ (wrapper)", 0);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_15__reversed__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_15__reversed__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self) {
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *__pyx_cur_scope;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__reversed__", 0);
+  __pyx_cur_scope = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *)__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__(__pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__, __pyx_empty_tuple, NULL);
+  if (unlikely(!__pyx_cur_scope)) {
+    __pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *)Py_None);
+    __Pyx_INCREF(Py_None);
+    __PYX_ERR(0, 169, __pyx_L1_error)
+  } else {
+    __Pyx_GOTREF(__pyx_cur_scope);
+  }
+  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
+  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
+  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
+  {
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11sat_toolkit_7formula_6Clause_17generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_reversed_2, __pyx_n_s_Clause___reversed, __pyx_n_s_sat_toolkit_formula); if (unlikely(!gen)) __PYX_ERR(0, 169, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_cur_scope);
+    __Pyx_RefNannyFinishContext();
+    return (PyObject *) gen;
+  }
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__reversed__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_gb_11sat_toolkit_7formula_6Clause_17generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+{
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *__pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *)__pyx_generator->closure);
+  PyObject *__pyx_r = NULL;
+  size_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__reversed__", 0);
+  switch (__pyx_generator->resume_label) {
+    case 0: goto __pyx_L3_first_run;
+    case 1: goto __pyx_L6_resume_from_yield;
+    default: /* CPython raises the right error here */
+    __Pyx_RefNannyFinishContext();
+    return NULL;
+  }
+  __pyx_L3_first_run:;
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 169, __pyx_L1_error)
+
+  /* "sat_toolkit/formula.pyx":170
+ * 
+ *     def __reversed__(self) -> Iterable[int]:
+ *         cdef size_t i = 0             # <<<<<<<<<<<<<<
+ *         for i in reversed(range(self.clause.size())):
+ *             yield self.clause[i]
+ */
+  __pyx_cur_scope->__pyx_v_i = 0;
+
+  /* "sat_toolkit/formula.pyx":171
+ *     def __reversed__(self) -> Iterable[int]:
+ *         cdef size_t i = 0
+ *         for i in reversed(range(self.clause.size())):             # <<<<<<<<<<<<<<
+ *             yield self.clause[i]
+ * 
+ */
+  for (__pyx_t_1 = __pyx_cur_scope->__pyx_v_self->clause.size()-1 + 1; __pyx_t_1 >= 0 + 1; ) { __pyx_t_1-=1;
+    __pyx_cur_scope->__pyx_v_i = __pyx_t_1;
+
+    /* "sat_toolkit/formula.pyx":172
+ *         cdef size_t i = 0
+ *         for i in reversed(range(self.clause.size())):
+ *             yield self.clause[i]             # <<<<<<<<<<<<<<
+ * 
+ *     def count(self, int needle) -> size_t:
+ */
+    __pyx_t_2 = __Pyx_PyInt_From_int((__pyx_cur_scope->__pyx_v_self->clause[__pyx_cur_scope->__pyx_v_i])); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 172, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_r = __pyx_t_2;
+    __pyx_t_2 = 0;
+    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
+    __Pyx_XGIVEREF(__pyx_r);
+    __Pyx_RefNannyFinishContext();
+    __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
+    /* return from generator, yielding value */
+    __pyx_generator->resume_label = 1;
+    return __pyx_r;
+    __pyx_L6_resume_from_yield:;
+    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 172, __pyx_L1_error)
+  }
+  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
+
+  /* "sat_toolkit/formula.pyx":169
+ *             yield self.clause[i]
+ * 
+ *     def __reversed__(self) -> Iterable[int]:             # <<<<<<<<<<<<<<
+ *         cdef size_t i = 0
+ *         for i in reversed(range(self.clause.size())):
+ */
+
+  /* function exit code */
+  PyErr_SetNone(PyExc_StopIteration);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("__reversed__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
+  #if !CYTHON_USE_EXC_INFO_STACK
+  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
+  #endif
+  __pyx_generator->resume_label = -1;
+  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":174
+ *             yield self.clause[i]
+ * 
+ *     def count(self, int needle) -> size_t:             # <<<<<<<<<<<<<<
+ *         "Return the number of times needle appears in the list."
+ *         cdef size_t i
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_19count(PyObject *__pyx_v_self, PyObject *__pyx_arg_needle); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_6Clause_18count[] = "Clause.count(self, int needle) -> size_t\nReturn the number of times needle appears in the list.";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_19count(PyObject *__pyx_v_self, PyObject *__pyx_arg_needle) {
+  int __pyx_v_needle;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("count (wrapper)", 0);
+  assert(__pyx_arg_needle); {
+    __pyx_v_needle = __Pyx_PyInt_As_int(__pyx_arg_needle); if (unlikely((__pyx_v_needle == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 174, __pyx_L3_error)
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.count", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_18count(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self), ((int)__pyx_v_needle));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_18count(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, int __pyx_v_needle) {
+  size_t __pyx_v_i;
+  size_t __pyx_v_count;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  std::vector<int> ::size_type __pyx_t_1;
+  std::vector<int> ::size_type __pyx_t_2;
+  size_t __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("count", 0);
+
+  /* "sat_toolkit/formula.pyx":178
+ *         cdef size_t i
+ *         cdef int c
+ *         cdef size_t count = 0             # <<<<<<<<<<<<<<
+ * 
+ *         for i in range(self.clause.size()):
+ */
+  __pyx_v_count = 0;
+
+  /* "sat_toolkit/formula.pyx":180
+ *         cdef size_t count = 0
+ * 
+ *         for i in range(self.clause.size()):             # <<<<<<<<<<<<<<
+ *             if self.clause[i] == needle:
+ *                 count += 1
+ */
+  __pyx_t_1 = __pyx_v_self->clause.size();
+  __pyx_t_2 = __pyx_t_1;
+  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
+    __pyx_v_i = __pyx_t_3;
+
+    /* "sat_toolkit/formula.pyx":181
+ * 
+ *         for i in range(self.clause.size()):
+ *             if self.clause[i] == needle:             # <<<<<<<<<<<<<<
+ *                 count += 1
+ * 
+ */
+    __pyx_t_4 = (((__pyx_v_self->clause[__pyx_v_i]) == __pyx_v_needle) != 0);
+    if (__pyx_t_4) {
+
+      /* "sat_toolkit/formula.pyx":182
+ *         for i in range(self.clause.size()):
+ *             if self.clause[i] == needle:
+ *                 count += 1             # <<<<<<<<<<<<<<
+ * 
+ *         return count
+ */
+      __pyx_v_count = (__pyx_v_count + 1);
+
+      /* "sat_toolkit/formula.pyx":181
+ * 
+ *         for i in range(self.clause.size()):
+ *             if self.clause[i] == needle:             # <<<<<<<<<<<<<<
+ *                 count += 1
+ * 
+ */
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":184
+ *                 count += 1
+ * 
+ *         return count             # <<<<<<<<<<<<<<
+ * 
+ *     def index(self, int needle, start=None, end=None) -> size_t:
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_v_count); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":174
+ *             yield self.clause[i]
+ * 
+ *     def count(self, int needle) -> size_t:             # <<<<<<<<<<<<<<
+ *         "Return the number of times needle appears in the list."
+ *         cdef size_t i
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.count", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":186
+ *         return count
+ * 
+ *     def index(self, int needle, start=None, end=None) -> size_t:             # <<<<<<<<<<<<<<
+ *         """
+ *         Return zero-based index in the list of the first item whose value is
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_21index(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_6Clause_20index[] = "Clause.index(self, int needle, start=None, end=None) -> size_t\n\n        Return zero-based index in the list of the first item whose value is\n        equal to needle. Raises a ValueError if there is no such item.\n\n        The optional arguments start and end are interpreted as in the slice\n        notation and are used to limit the search to a particular subsequence\n        of the list. The returned index is computed relative to the beginning\n        of the full sequence rather than the start argument.\n        ";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_21index(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  int __pyx_v_needle;
+  PyObject *__pyx_v_start = 0;
+  PyObject *__pyx_v_end = 0;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("index (wrapper)", 0);
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_needle,&__pyx_n_s_start,&__pyx_n_s_end,0};
+    PyObject* values[3] = {0,0,0};
+    values[1] = ((PyObject *)Py_None);
+    values[2] = ((PyObject *)Py_None);
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      switch (pos_args) {
+        case  0:
+        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_needle)) != 0)) kw_args--;
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_start);
+          if (value) { values[1] = value; kw_args--; }
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_end);
+          if (value) { values[2] = value; kw_args--; }
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "index") < 0)) __PYX_ERR(0, 186, __pyx_L3_error)
+      }
+    } else {
+      switch (PyTuple_GET_SIZE(__pyx_args)) {
+        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+    }
+    __pyx_v_needle = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_needle == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 186, __pyx_L3_error)
+    __pyx_v_start = values[1];
+    __pyx_v_end = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("index", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 186, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.index", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_20index(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self), __pyx_v_needle, __pyx_v_start, __pyx_v_end);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_20index(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, int __pyx_v_needle, PyObject *__pyx_v_start, PyObject *__pyx_v_end) {
+  size_t __pyx_v_i;
+  size_t __pyx_v_start_idx;
+  size_t __pyx_v_end_idx;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int __pyx_t_2;
+  Py_ssize_t __pyx_t_3;
+  size_t __pyx_t_4;
+  size_t __pyx_t_5;
+  size_t __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("index", 0);
+
+  /* "sat_toolkit/formula.pyx":196
+ *         of the full sequence rather than the start argument.
+ *         """
+ *         cdef size_t i, start_idx = 0, end_idx = self.clause.size()             # <<<<<<<<<<<<<<
+ * 
+ *         if start is not None:
+ */
+  __pyx_v_start_idx = 0;
+  __pyx_v_end_idx = __pyx_v_self->clause.size();
+
+  /* "sat_toolkit/formula.pyx":198
+ *         cdef size_t i, start_idx = 0, end_idx = self.clause.size()
+ * 
+ *         if start is not None:             # <<<<<<<<<<<<<<
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:
+ */
+  __pyx_t_1 = (__pyx_v_start != Py_None);
+  __pyx_t_2 = (__pyx_t_1 != 0);
+  if (__pyx_t_2) {
+
+    /* "sat_toolkit/formula.pyx":199
+ * 
+ *         if start is not None:
+ *             start_idx = self._get_slice_index(start)             # <<<<<<<<<<<<<<
+ *         if end is not None:
+ *             end_idx = self._get_slice_index(end)
+ */
+    __pyx_t_3 = PyInt_AsSsize_t(__pyx_v_start); if (unlikely((__pyx_t_3 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 199, __pyx_L1_error)
+    __pyx_v_start_idx = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause *)__pyx_v_self->__pyx_vtab)->_get_slice_index(__pyx_v_self, __pyx_t_3);
+
+    /* "sat_toolkit/formula.pyx":198
+ *         cdef size_t i, start_idx = 0, end_idx = self.clause.size()
+ * 
+ *         if start is not None:             # <<<<<<<<<<<<<<
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":200
+ *         if start is not None:
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:             # <<<<<<<<<<<<<<
+ *             end_idx = self._get_slice_index(end)
+ * 
+ */
+  __pyx_t_2 = (__pyx_v_end != Py_None);
+  __pyx_t_1 = (__pyx_t_2 != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":201
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:
+ *             end_idx = self._get_slice_index(end)             # <<<<<<<<<<<<<<
+ * 
+ *         for i in range(start_idx, end_idx):
+ */
+    __pyx_t_3 = PyInt_AsSsize_t(__pyx_v_end); if (unlikely((__pyx_t_3 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 201, __pyx_L1_error)
+    __pyx_v_end_idx = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause *)__pyx_v_self->__pyx_vtab)->_get_slice_index(__pyx_v_self, __pyx_t_3);
+
+    /* "sat_toolkit/formula.pyx":200
+ *         if start is not None:
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:             # <<<<<<<<<<<<<<
+ *             end_idx = self._get_slice_index(end)
+ * 
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":203
+ *             end_idx = self._get_slice_index(end)
+ * 
+ *         for i in range(start_idx, end_idx):             # <<<<<<<<<<<<<<
+ *             if self.clause[i] == needle:
+ *                 return i
+ */
+  __pyx_t_4 = __pyx_v_end_idx;
+  __pyx_t_5 = __pyx_t_4;
+  for (__pyx_t_6 = __pyx_v_start_idx; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
+    __pyx_v_i = __pyx_t_6;
+
+    /* "sat_toolkit/formula.pyx":204
+ * 
+ *         for i in range(start_idx, end_idx):
+ *             if self.clause[i] == needle:             # <<<<<<<<<<<<<<
+ *                 return i
+ * 
+ */
+    __pyx_t_1 = (((__pyx_v_self->clause[__pyx_v_i]) == __pyx_v_needle) != 0);
+    if (__pyx_t_1) {
+
+      /* "sat_toolkit/formula.pyx":205
+ *         for i in range(start_idx, end_idx):
+ *             if self.clause[i] == needle:
+ *                 return i             # <<<<<<<<<<<<<<
+ * 
+ *         raise ValueError(f'{needle} is not in Clause')
+ */
+      __Pyx_XDECREF(__pyx_r);
+      __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_i); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 205, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_7);
+      __pyx_r = __pyx_t_7;
+      __pyx_t_7 = 0;
+      goto __pyx_L0;
+
+      /* "sat_toolkit/formula.pyx":204
+ * 
+ *         for i in range(start_idx, end_idx):
+ *             if self.clause[i] == needle:             # <<<<<<<<<<<<<<
+ *                 return i
+ * 
+ */
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":207
+ *                 return i
+ * 
+ *         raise ValueError(f'{needle} is not in Clause')             # <<<<<<<<<<<<<<
+ * 
+ *     def __eq__(self, other) -> bool:
+ */
+  __pyx_t_7 = __Pyx_PyUnicode_From_int(__pyx_v_needle, 0, ' ', 'd'); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 207, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_8 = __Pyx_PyUnicode_Concat(__pyx_t_7, __pyx_kp_u_is_not_in_Clause); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 207, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+  __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 207, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __Pyx_Raise(__pyx_t_7, 0, 0, 0);
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+  __PYX_ERR(0, 207, __pyx_L1_error)
+
+  /* "sat_toolkit/formula.pyx":186
+ *         return count
+ * 
+ *     def index(self, int needle, start=None, end=None) -> size_t:             # <<<<<<<<<<<<<<
+ *         """
+ *         Return zero-based index in the list of the first item whose value is
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.index", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":209
+ *         raise ValueError(f'{needle} is not in Clause')
+ * 
+ *     def __eq__(self, other) -> bool:             # <<<<<<<<<<<<<<
+ *         cdef Clause other_clause
+ *         try:
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_23__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_23__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__eq__ (wrapper)", 0);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_22__eq__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self), ((PyObject *)__pyx_v_other));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_22__eq__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, PyObject *__pyx_v_other) {
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_other_clause = 0;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__eq__", 0);
+
+  /* "sat_toolkit/formula.pyx":211
+ *     def __eq__(self, other) -> bool:
+ *         cdef Clause other_clause
+ *         try:             # <<<<<<<<<<<<<<
+ *             other_clause = other
+ *         except TypeError:
+ */
+  {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
+    __Pyx_XGOTREF(__pyx_t_1);
+    __Pyx_XGOTREF(__pyx_t_2);
+    __Pyx_XGOTREF(__pyx_t_3);
+    /*try:*/ {
+
+      /* "sat_toolkit/formula.pyx":212
+ *         cdef Clause other_clause
+ *         try:
+ *             other_clause = other             # <<<<<<<<<<<<<<
+ *         except TypeError:
+ *             return False
+ */
+      if (!(likely(((__pyx_v_other) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_other, __pyx_ptype_11sat_toolkit_7formula_Clause))))) __PYX_ERR(0, 212, __pyx_L3_error)
+      __pyx_t_4 = __pyx_v_other;
+      __Pyx_INCREF(__pyx_t_4);
+      __pyx_v_other_clause = ((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_t_4);
+      __pyx_t_4 = 0;
+
+      /* "sat_toolkit/formula.pyx":211
+ *     def __eq__(self, other) -> bool:
+ *         cdef Clause other_clause
+ *         try:             # <<<<<<<<<<<<<<
+ *             other_clause = other
+ *         except TypeError:
+ */
+    }
+    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    goto __pyx_L8_try_end;
+    __pyx_L3_error:;
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "sat_toolkit/formula.pyx":213
+ *         try:
+ *             other_clause = other
+ *         except TypeError:             # <<<<<<<<<<<<<<
+ *             return False
+ *         return self.clause == other_clause.clause
+ */
+    __pyx_t_5 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_TypeError);
+    if (__pyx_t_5) {
+      __Pyx_AddTraceback("sat_toolkit.formula.Clause.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(0, 213, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_GOTREF(__pyx_t_6);
+      __Pyx_GOTREF(__pyx_t_7);
+
+      /* "sat_toolkit/formula.pyx":214
+ *             other_clause = other
+ *         except TypeError:
+ *             return False             # <<<<<<<<<<<<<<
+ *         return self.clause == other_clause.clause
+ * 
+ */
+      __Pyx_XDECREF(__pyx_r);
+      __Pyx_INCREF(Py_False);
+      __pyx_r = Py_False;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      goto __pyx_L6_except_return;
+    }
+    goto __pyx_L5_except_error;
+    __pyx_L5_except_error:;
+
+    /* "sat_toolkit/formula.pyx":211
+ *     def __eq__(self, other) -> bool:
+ *         cdef Clause other_clause
+ *         try:             # <<<<<<<<<<<<<<
+ *             other_clause = other
+ *         except TypeError:
+ */
+    __Pyx_XGIVEREF(__pyx_t_1);
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
+    goto __pyx_L1_error;
+    __pyx_L6_except_return:;
+    __Pyx_XGIVEREF(__pyx_t_1);
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
+    goto __pyx_L0;
+    __pyx_L8_try_end:;
+  }
+
+  /* "sat_toolkit/formula.pyx":215
+ *         except TypeError:
+ *             return False
+ *         return self.clause == other_clause.clause             # <<<<<<<<<<<<<<
+ * 
+ * collections.abc.Sequence.register(Clause)
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_7 = __Pyx_PyBool_FromLong((__pyx_v_self->clause == __pyx_v_other_clause->clause)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 215, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_r = __pyx_t_7;
+  __pyx_t_7 = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":209
+ *         raise ValueError(f'{needle} is not in Clause')
+ * 
+ *     def __eq__(self, other) -> bool:             # <<<<<<<<<<<<<<
+ *         cdef Clause other_clause
+ *         try:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_other_clause);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
 /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
  *     cdef tuple state
  *     cdef object _dict
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_14__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_6Clause_13__reduce_cython__[] = "Clause.__reduce_cython__(self)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_14__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_25__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_6Clause_24__reduce_cython__[] = "Clause.__reduce_cython__(self)";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_25__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_13__reduce_cython__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_24__reduce_cython__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_13__reduce_cython__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_24__reduce_cython__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self) {
   PyObject *__pyx_v_state = 0;
   PyObject *__pyx_v__dict = 0;
   int __pyx_v_use_setstate;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
@@ -4865,15 +6108,15 @@
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_state);
   __Pyx_XDECREF(__pyx_v__dict);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
@@ -4883,43 +6126,43 @@
  *     else:
  *         return __pyx_unpickle_Clause, (type(self), 0xab15654, state)
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
  *     __pyx_unpickle_Clause__set_state(self, __pyx_state)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_16__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_6Clause_15__setstate_cython__[] = "Clause.__setstate_cython__(self, __pyx_state)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_16__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_27__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_6Clause_26__setstate_cython__[] = "Clause.__setstate_cython__(self, __pyx_state)";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_6Clause_27__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_6Clause_15__setstate_cython__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_6Clause_26__setstate_cython__(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_6Clause_15__setstate_cython__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_6Clause_26__setstate_cython__(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Clause, (type(self), 0xab15654, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Clause__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
   if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
-  __pyx_t_1 = __pyx_f_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11sat_toolkit_7formula___pyx_unpickle_Clause__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Clause, (type(self), 0xab15654, state)
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
@@ -4927,35 +6170,35 @@
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Clause.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Clause.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":136
+/* "sat_toolkit/formula.pyx":243
  *     cdef ssize_t view_count
  * 
  *     def __init__(self, clauses = None, nvars = -1):             # <<<<<<<<<<<<<<
- *         pass
- * 
+ *         if clauses is not None:
+ *             self.add_clauses(clauses)
  */
 
 /* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  CYTHON_UNUSED PyObject *__pyx_v_clauses = 0;
-  CYTHON_UNUSED PyObject *__pyx_v_nvars = 0;
+static int __pyx_pw_11sat_toolkit_7formula_3CNF_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_3CNF_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyObject *__pyx_v_clauses = 0;
+  PyObject *__pyx_v_nvars = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
@@ -4985,15 +6228,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_nvars);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 136, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 243, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
@@ -5002,418 +6245,348 @@
       }
     }
     __pyx_v_clauses = values[0];
     __pyx_v_nvars = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 136, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 243, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF___init__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), __pyx_v_clauses, __pyx_v_nvars);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF___init__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), __pyx_v_clauses, __pyx_v_nvars);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_3CNF___init__(CYTHON_UNUSED struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_clauses, CYTHON_UNUSED PyObject *__pyx_v_nvars) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("__init__", 0);
-
-  /* function exit code */
-  __pyx_r = 0;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "sat_toolkit/_cnf_util.pyx":139
- *         pass
- * 
- *     def __cinit__(self, int[:] clauses = None, int nvars = -1):             # <<<<<<<<<<<<<<
- *         cdef ssize_t i, l = 0
- *         if clauses is not None:
- */
-
-/* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  __Pyx_memviewslice __pyx_v_clauses = { 0, 0, { 0 }, { 0 }, { 0 } };
-  int __pyx_v_nvars;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
-  {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_clauses,&__pyx_n_s_nvars,0};
-    PyObject* values[2] = {0,0};
-    if (unlikely(__pyx_kwds)) {
-      Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-        CYTHON_FALLTHROUGH;
-        case  0: break;
-        default: goto __pyx_L5_argtuple_error;
-      }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
-        case  0:
-        if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_clauses);
-          if (value) { values[0] = value; kw_args--; }
-        }
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_nvars);
-          if (value) { values[1] = value; kw_args--; }
-        }
-      }
-      if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
-      }
-    } else {
-      switch (PyTuple_GET_SIZE(__pyx_args)) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-        CYTHON_FALLTHROUGH;
-        case  0: break;
-        default: goto __pyx_L5_argtuple_error;
-      }
-    }
-    if (values[0]) {
-      __pyx_v_clauses = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_clauses.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
-    } else {
-      __pyx_v_clauses = __pyx_k__5;
-      __PYX_INC_MEMVIEW(&__pyx_v_clauses, 1);
-    }
-    if (values[1]) {
-      __pyx_v_nvars = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_nvars == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
-    } else {
-      __pyx_v_nvars = ((int)-1);
-    }
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_RefNannyFinishContext();
-  return -1;
-  __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_2__cinit__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), __pyx_v_clauses, __pyx_v_nvars);
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static int __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_2__cinit__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_clauses, int __pyx_v_nvars) {
-  Py_ssize_t __pyx_v_l;
+static int __pyx_pf_11sat_toolkit_7formula_3CNF___init__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_clauses, PyObject *__pyx_v_nvars) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  Py_ssize_t __pyx_t_3;
-  Py_UCS4 __pyx_t_4;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
+  Py_ssize_t __pyx_t_6;
+  Py_UCS4 __pyx_t_7;
+  int __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__cinit__", 0);
-
-  /* "sat_toolkit/_cnf_util.pyx":140
- * 
- *     def __cinit__(self, int[:] clauses = None, int nvars = -1):
- *         cdef ssize_t i, l = 0             # <<<<<<<<<<<<<<
- *         if clauses is not None:
- *             l = clauses.shape[0]
- */
-  __pyx_v_l = 0;
-
-  /* "sat_toolkit/_cnf_util.pyx":141
- *     def __cinit__(self, int[:] clauses = None, int nvars = -1):
- *         cdef ssize_t i, l = 0
- *         if clauses is not None:             # <<<<<<<<<<<<<<
- *             l = clauses.shape[0]
- *         self.shape[0] = l
- */
-  __pyx_t_1 = ((((PyObject *) __pyx_v_clauses.memview) != Py_None) != 0);
-  if (__pyx_t_1) {
-
-    /* "sat_toolkit/_cnf_util.pyx":142
- *         cdef ssize_t i, l = 0
- *         if clauses is not None:
- *             l = clauses.shape[0]             # <<<<<<<<<<<<<<
- *         self.shape[0] = l
- *         self.strides[0] = sizeof(self.clauses[0])
- */
-    __pyx_v_l = (__pyx_v_clauses.shape[0]);
-
-    /* "sat_toolkit/_cnf_util.pyx":141
- *     def __cinit__(self, int[:] clauses = None, int nvars = -1):
- *         cdef ssize_t i, l = 0
- *         if clauses is not None:             # <<<<<<<<<<<<<<
- *             l = clauses.shape[0]
- *         self.shape[0] = l
- */
-  }
-
-  /* "sat_toolkit/_cnf_util.pyx":143
- *         if clauses is not None:
- *             l = clauses.shape[0]
- *         self.shape[0] = l             # <<<<<<<<<<<<<<
- *         self.strides[0] = sizeof(self.clauses[0])
- *         self.view_count = 0
- */
-  (__pyx_v_self->shape[0]) = __pyx_v_l;
-
-  /* "sat_toolkit/_cnf_util.pyx":144
- *             l = clauses.shape[0]
- *         self.shape[0] = l
- *         self.strides[0] = sizeof(self.clauses[0])             # <<<<<<<<<<<<<<
- *         self.view_count = 0
- *         self.nvars = 0
- */
-  (__pyx_v_self->strides[0]) = (sizeof((__pyx_v_self->clauses[0])));
-
-  /* "sat_toolkit/_cnf_util.pyx":145
- *         self.shape[0] = l
- *         self.strides[0] = sizeof(self.clauses[0])
- *         self.view_count = 0             # <<<<<<<<<<<<<<
- *         self.nvars = 0
- * 
- */
-  __pyx_v_self->view_count = 0;
-
-  /* "sat_toolkit/_cnf_util.pyx":146
- *         self.strides[0] = sizeof(self.clauses[0])
- *         self.view_count = 0
- *         self.nvars = 0             # <<<<<<<<<<<<<<
- * 
- *         if clauses is not None:
- */
-  __pyx_v_self->nvars = 0;
+  __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":148
- *         self.nvars = 0
+  /* "sat_toolkit/formula.pyx":244
  * 
+ *     def __init__(self, clauses = None, nvars = -1):
  *         if clauses is not None:             # <<<<<<<<<<<<<<
- *             self._add_clauses(clauses)
+ *             self.add_clauses(clauses)
  *         if nvars != -1:
  */
-  __pyx_t_1 = ((((PyObject *) __pyx_v_clauses.memview) != Py_None) != 0);
-  if (__pyx_t_1) {
+  __pyx_t_1 = (__pyx_v_clauses != Py_None);
+  __pyx_t_2 = (__pyx_t_1 != 0);
+  if (__pyx_t_2) {
 
-    /* "sat_toolkit/_cnf_util.pyx":149
- * 
+    /* "sat_toolkit/formula.pyx":245
+ *     def __init__(self, clauses = None, nvars = -1):
  *         if clauses is not None:
- *             self._add_clauses(clauses)             # <<<<<<<<<<<<<<
+ *             self.add_clauses(clauses)             # <<<<<<<<<<<<<<
  *         if nvars != -1:
  *             if nvars < self.nvars:
  */
-    ((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self->__pyx_vtab)->_add_clauses(__pyx_v_self, __pyx_v_clauses);
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_clauses); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_4, function);
+      }
+    }
+    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_clauses) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_clauses);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 245, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":148
- *         self.nvars = 0
+    /* "sat_toolkit/formula.pyx":244
  * 
+ *     def __init__(self, clauses = None, nvars = -1):
  *         if clauses is not None:             # <<<<<<<<<<<<<<
- *             self._add_clauses(clauses)
+ *             self.add_clauses(clauses)
  *         if nvars != -1:
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":150
+  /* "sat_toolkit/formula.pyx":246
  *         if clauses is not None:
- *             self._add_clauses(clauses)
+ *             self.add_clauses(clauses)
  *         if nvars != -1:             # <<<<<<<<<<<<<<
  *             if nvars < self.nvars:
  *                 raise ValueError(f"explicitly given nvars too small ({nvars} < {self.nvars})")
  */
-  __pyx_t_1 = ((__pyx_v_nvars != -1L) != 0);
-  if (__pyx_t_1) {
+  __pyx_t_3 = __Pyx_PyInt_NeObjC(__pyx_v_nvars, __pyx_int_neg_1, -1L, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 246, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 246, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (__pyx_t_2) {
 
-    /* "sat_toolkit/_cnf_util.pyx":151
- *             self._add_clauses(clauses)
+    /* "sat_toolkit/formula.pyx":247
+ *             self.add_clauses(clauses)
  *         if nvars != -1:
  *             if nvars < self.nvars:             # <<<<<<<<<<<<<<
  *                 raise ValueError(f"explicitly given nvars too small ({nvars} < {self.nvars})")
  *             self.nvars = nvars
  */
-    __pyx_t_1 = ((__pyx_v_nvars < __pyx_v_self->nvars) != 0);
-    if (unlikely(__pyx_t_1)) {
+    __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->nvars); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 247, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = PyObject_RichCompare(__pyx_v_nvars, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 247, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 247, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(__pyx_t_2)) {
 
-      /* "sat_toolkit/_cnf_util.pyx":152
+      /* "sat_toolkit/formula.pyx":248
  *         if nvars != -1:
  *             if nvars < self.nvars:
  *                 raise ValueError(f"explicitly given nvars too small ({nvars} < {self.nvars})")             # <<<<<<<<<<<<<<
  *             self.nvars = nvars
  * 
  */
-      __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 152, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = 0;
-      __pyx_t_4 = 127;
+      __pyx_t_4 = PyTuple_New(5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 248, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_6 = 0;
+      __pyx_t_7 = 127;
       __Pyx_INCREF(__pyx_kp_u_explicitly_given_nvars_too_small);
-      __pyx_t_3 += 34;
+      __pyx_t_6 += 34;
       __Pyx_GIVEREF(__pyx_kp_u_explicitly_given_nvars_too_small);
-      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_explicitly_given_nvars_too_small);
-      __pyx_t_5 = __Pyx_PyUnicode_From_int(__pyx_v_nvars, 0, ' ', 'd'); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 152, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
-      __Pyx_GIVEREF(__pyx_t_5);
-      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
-      __pyx_t_5 = 0;
-      __Pyx_INCREF(__pyx_kp_u__6);
-      __pyx_t_3 += 3;
-      __Pyx_GIVEREF(__pyx_kp_u__6);
-      PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__6);
-      __pyx_t_5 = __Pyx_PyUnicode_From_int(__pyx_v_self->nvars, 0, ' ', 'd'); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 152, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
-      __Pyx_GIVEREF(__pyx_t_5);
-      PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_5);
-      __pyx_t_5 = 0;
+      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_explicitly_given_nvars_too_small);
+      __pyx_t_3 = __Pyx_PyObject_FormatSimple(__pyx_v_nvars, __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 248, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) : __pyx_t_7;
+      __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_3);
+      __Pyx_GIVEREF(__pyx_t_3);
+      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
+      __pyx_t_3 = 0;
+      __Pyx_INCREF(__pyx_kp_u__5);
+      __pyx_t_6 += 3;
+      __Pyx_GIVEREF(__pyx_kp_u__5);
+      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u__5);
+      __pyx_t_3 = __Pyx_PyUnicode_From_int(__pyx_v_self->nvars, 0, ' ', 'd'); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 248, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_3);
+      __Pyx_GIVEREF(__pyx_t_3);
+      PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_t_3);
+      __pyx_t_3 = 0;
       __Pyx_INCREF(__pyx_kp_u__3);
-      __pyx_t_3 += 1;
+      __pyx_t_6 += 1;
       __Pyx_GIVEREF(__pyx_kp_u__3);
-      PyTuple_SET_ITEM(__pyx_t_2, 4, __pyx_kp_u__3);
-      __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_2, 5, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 152, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 152, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 152, __pyx_L1_error)
+      PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_kp_u__3);
+      __pyx_t_3 = __Pyx_PyUnicode_Join(__pyx_t_4, 5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 248, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 248, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_Raise(__pyx_t_4, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __PYX_ERR(0, 248, __pyx_L1_error)
 
-      /* "sat_toolkit/_cnf_util.pyx":151
- *             self._add_clauses(clauses)
+      /* "sat_toolkit/formula.pyx":247
+ *             self.add_clauses(clauses)
  *         if nvars != -1:
  *             if nvars < self.nvars:             # <<<<<<<<<<<<<<
  *                 raise ValueError(f"explicitly given nvars too small ({nvars} < {self.nvars})")
  *             self.nvars = nvars
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":153
+    /* "sat_toolkit/formula.pyx":249
  *             if nvars < self.nvars:
  *                 raise ValueError(f"explicitly given nvars too small ({nvars} < {self.nvars})")
  *             self.nvars = nvars             # <<<<<<<<<<<<<<
  * 
- * 
+ *     def __cinit__(self):
  */
-    __pyx_v_self->nvars = __pyx_v_nvars;
+    __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_v_nvars); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 249, __pyx_L1_error)
+    __pyx_v_self->nvars = __pyx_t_8;
 
-    /* "sat_toolkit/_cnf_util.pyx":150
+    /* "sat_toolkit/formula.pyx":246
  *         if clauses is not None:
- *             self._add_clauses(clauses)
+ *             self.add_clauses(clauses)
  *         if nvars != -1:             # <<<<<<<<<<<<<<
  *             if nvars < self.nvars:
  *                 raise ValueError(f"explicitly given nvars too small ({nvars} < {self.nvars})")
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":139
- *         pass
+  /* "sat_toolkit/formula.pyx":243
+ *     cdef ssize_t view_count
  * 
- *     def __cinit__(self, int[:] clauses = None, int nvars = -1):             # <<<<<<<<<<<<<<
- *         cdef ssize_t i, l = 0
+ *     def __init__(self, clauses = None, nvars = -1):             # <<<<<<<<<<<<<<
  *         if clauses is not None:
+ *             self.add_clauses(clauses)
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
-  __PYX_XDEC_MEMVIEW(&__pyx_v_clauses, 1);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":159
+/* "sat_toolkit/formula.pyx":251
+ *             self.nvars = nvars
+ * 
+ *     def __cinit__(self):             # <<<<<<<<<<<<<<
+ *         self.shape[0] = 0
+ *         self.view_count = 0
+ */
+
+/* Python wrapper */
+static int __pyx_pw_11sat_toolkit_7formula_3CNF_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_3CNF_3__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
+  if (unlikely(PyTuple_GET_SIZE(__pyx_args) > 0)) {
+    __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); return -1;}
+  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__cinit__", 0))) return -1;
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_2__cinit__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_11sat_toolkit_7formula_3CNF_2__cinit__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__cinit__", 0);
+
+  /* "sat_toolkit/formula.pyx":252
+ * 
+ *     def __cinit__(self):
+ *         self.shape[0] = 0             # <<<<<<<<<<<<<<
+ *         self.view_count = 0
+ *         self.nvars = 0
+ */
+  (__pyx_v_self->shape[0]) = 0;
+
+  /* "sat_toolkit/formula.pyx":253
+ *     def __cinit__(self):
+ *         self.shape[0] = 0
+ *         self.view_count = 0             # <<<<<<<<<<<<<<
+ *         self.nvars = 0
+ * 
+ */
+  __pyx_v_self->view_count = 0;
+
+  /* "sat_toolkit/formula.pyx":254
+ *         self.shape[0] = 0
+ *         self.view_count = 0
+ *         self.nvars = 0             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_v_self->nvars = 0;
+
+  /* "sat_toolkit/formula.pyx":251
+ *             self.nvars = nvars
+ * 
+ *     def __cinit__(self):             # <<<<<<<<<<<<<<
+ *         self.shape[0] = 0
+ *         self.view_count = 0
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":258
  * 
  *     @staticmethod
  *     cdef CNF _from_dimacs(const uint8_t[::1] dimacs):             # <<<<<<<<<<<<<<
  *         cdef CNF res = CNF.__new__(CNF)
  *         cdef const char *buf = <const char *> &dimacs[0]
  */
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_f_11sat_toolkit_9_cnf_util_3CNF__from_dimacs(__Pyx_memviewslice __pyx_v_dimacs) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_res = 0;
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_f_11sat_toolkit_7formula_3CNF__from_dimacs(__Pyx_memviewslice __pyx_v_dimacs) {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_res = 0;
   char const *__pyx_v_buf;
   size_t __pyx_v_off;
   size_t __pyx_v_nclauses;
   int __pyx_v_nvars;
   size_t __pyx_v_remaining_len;
   PyObject *__pyx_v_values = NULL;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   Py_ssize_t __pyx_t_2;
   int __pyx_t_3;
   int __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   __Pyx_memviewslice __pyx_t_9 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_10;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_from_dimacs", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":160
+  /* "sat_toolkit/formula.pyx":259
  *     @staticmethod
  *     cdef CNF _from_dimacs(const uint8_t[::1] dimacs):
  *         cdef CNF res = CNF.__new__(CNF)             # <<<<<<<<<<<<<<
  *         cdef const char *buf = <const char *> &dimacs[0]
  * 
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_11sat_toolkit_9_cnf_util_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_11sat_toolkit_7formula_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_t_1);
+  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":161
+  /* "sat_toolkit/formula.pyx":260
  *     cdef CNF _from_dimacs(const uint8_t[::1] dimacs):
  *         cdef CNF res = CNF.__new__(CNF)
  *         cdef const char *buf = <const char *> &dimacs[0]             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t off = -1, nclauses
  */
   __pyx_t_2 = 0;
   __pyx_v_buf = ((char const *)(&(*((__pyx_t_11sat_toolkit_5types_uint8_t const  *) ( /* dim=0 */ ((char *) (((__pyx_t_11sat_toolkit_5types_uint8_t const  *) __pyx_v_dimacs.data) + __pyx_t_2)) )))));
 
-  /* "sat_toolkit/_cnf_util.pyx":163
+  /* "sat_toolkit/formula.pyx":262
  *         cdef const char *buf = <const char *> &dimacs[0]
  * 
  *         cdef size_t off = -1, nclauses             # <<<<<<<<<<<<<<
  *         cdef int nvars, tmp
  * 
  */
   __pyx_v_off = -1L;
 
-  /* "sat_toolkit/_cnf_util.pyx":166
+  /* "sat_toolkit/formula.pyx":265
  *         cdef int nvars, tmp
  * 
  *         while (sscanf(buf, "c %*[^\n]\n%zn", &off) or 1) and off != -1ULL:             # <<<<<<<<<<<<<<
  *             buf += off
  *             off = -1
  */
   while (1) {
@@ -5429,43 +6602,43 @@
     }
     __pyx_L6_next_and:;
     __pyx_t_4 = ((__pyx_v_off != -1ULL) != 0);
     __pyx_t_3 = __pyx_t_4;
     __pyx_L5_bool_binop_done:;
     if (!__pyx_t_3) break;
 
-    /* "sat_toolkit/_cnf_util.pyx":167
+    /* "sat_toolkit/formula.pyx":266
  * 
  *         while (sscanf(buf, "c %*[^\n]\n%zn", &off) or 1) and off != -1ULL:
  *             buf += off             # <<<<<<<<<<<<<<
  *             off = -1
  * 
  */
     __pyx_v_buf = (__pyx_v_buf + __pyx_v_off);
 
-    /* "sat_toolkit/_cnf_util.pyx":168
+    /* "sat_toolkit/formula.pyx":267
  *         while (sscanf(buf, "c %*[^\n]\n%zn", &off) or 1) and off != -1ULL:
  *             buf += off
  *             off = -1             # <<<<<<<<<<<<<<
  * 
  * 
  */
     __pyx_v_off = -1L;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":171
+  /* "sat_toolkit/formula.pyx":270
  * 
  * 
  *         off = -1             # <<<<<<<<<<<<<<
  *         if (sscanf(buf, "p cnf %d %zd\n%zn", &nvars, &nclauses, &off) or 1) and off == -1ULL:
  *             raise ValueError('file format error')
  */
   __pyx_v_off = -1L;
 
-  /* "sat_toolkit/_cnf_util.pyx":172
+  /* "sat_toolkit/formula.pyx":271
  * 
  *         off = -1
  *         if (sscanf(buf, "p cnf %d %zd\n%zn", &nvars, &nclauses, &off) or 1) and off == -1ULL:             # <<<<<<<<<<<<<<
  *             raise ValueError('file format error')
  *         buf += off
  */
   __pyx_t_4 = (sscanf(__pyx_v_buf, ((char const *)"p cnf %d %zd\n%zn"), (&__pyx_v_nvars), (&__pyx_v_nclauses), (&__pyx_v_off)) != 0);
@@ -5480,143 +6653,143 @@
   }
   __pyx_L10_next_and:;
   __pyx_t_4 = ((__pyx_v_off == -1ULL) != 0);
   __pyx_t_3 = __pyx_t_4;
   __pyx_L9_bool_binop_done:;
   if (unlikely(__pyx_t_3)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":173
+    /* "sat_toolkit/formula.pyx":272
  *         off = -1
  *         if (sscanf(buf, "p cnf %d %zd\n%zn", &nvars, &nclauses, &off) or 1) and off == -1ULL:
  *             raise ValueError('file format error')             # <<<<<<<<<<<<<<
  *         buf += off
  * 
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 272, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 173, __pyx_L1_error)
+    __PYX_ERR(0, 272, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":172
+    /* "sat_toolkit/formula.pyx":271
  * 
  *         off = -1
  *         if (sscanf(buf, "p cnf %d %zd\n%zn", &nvars, &nclauses, &off) or 1) and off == -1ULL:             # <<<<<<<<<<<<<<
  *             raise ValueError('file format error')
  *         buf += off
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":174
+  /* "sat_toolkit/formula.pyx":273
  *         if (sscanf(buf, "p cnf %d %zd\n%zn", &nvars, &nclauses, &off) or 1) and off == -1ULL:
  *             raise ValueError('file format error')
  *         buf += off             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t remaining_len = dimacs.shape[0] - (buf - <const char *> &dimacs[0])
  */
   __pyx_v_buf = (__pyx_v_buf + __pyx_v_off);
 
-  /* "sat_toolkit/_cnf_util.pyx":176
+  /* "sat_toolkit/formula.pyx":275
  *         buf += off
  * 
  *         cdef size_t remaining_len = dimacs.shape[0] - (buf - <const char *> &dimacs[0])             # <<<<<<<<<<<<<<
  *         values = np.fromstring(buf[:remaining_len], dtype=np.int32, sep=' ')
  * 
  */
   __pyx_t_2 = 0;
   __pyx_v_remaining_len = ((__pyx_v_dimacs.shape[0]) - (__pyx_v_buf - ((char const *)(&(*((__pyx_t_11sat_toolkit_5types_uint8_t const  *) ( /* dim=0 */ ((char *) (((__pyx_t_11sat_toolkit_5types_uint8_t const  *) __pyx_v_dimacs.data) + __pyx_t_2)) )))))));
 
-  /* "sat_toolkit/_cnf_util.pyx":177
+  /* "sat_toolkit/formula.pyx":276
  * 
  *         cdef size_t remaining_len = dimacs.shape[0] - (buf - <const char *> &dimacs[0])
  *         values = np.fromstring(buf[:remaining_len], dtype=np.int32, sep=' ')             # <<<<<<<<<<<<<<
  * 
  *         res._add_clauses(values)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_fromstring); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_fromstring); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_buf + 0, __pyx_v_remaining_len - 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_buf + 0, __pyx_v_remaining_len - 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_sep, __pyx_kp_u__8) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_sep, __pyx_kp_u__7) < 0) __PYX_ERR(0, 276, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_values = __pyx_t_8;
   __pyx_t_8 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":179
+  /* "sat_toolkit/formula.pyx":278
  *         values = np.fromstring(buf[:remaining_len], dtype=np.int32, sep=' ')
  * 
  *         res._add_clauses(values)             # <<<<<<<<<<<<<<
  *         assert nvars >= res.nvars
  *         res.nvars = nvars
  */
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_values, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
-  ((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_9);
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_values, 0); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 278, __pyx_L1_error)
+  __pyx_t_10 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_9); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 278, __pyx_L1_error)
   __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "sat_toolkit/_cnf_util.pyx":180
+  /* "sat_toolkit/formula.pyx":279
  * 
  *         res._add_clauses(values)
  *         assert nvars >= res.nvars             # <<<<<<<<<<<<<<
  *         res.nvars = nvars
  *         return res
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
-  if (unlikely(!Py_OptimizeFlag)) {
+  if (unlikely(__pyx_assertions_enabled())) {
     if (unlikely(!((__pyx_v_nvars >= __pyx_v_res->nvars) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
-      __PYX_ERR(0, 180, __pyx_L1_error)
+      __PYX_ERR(0, 279, __pyx_L1_error)
     }
   }
   #endif
 
-  /* "sat_toolkit/_cnf_util.pyx":181
+  /* "sat_toolkit/formula.pyx":280
  *         res._add_clauses(values)
  *         assert nvars >= res.nvars
  *         res.nvars = nvars             # <<<<<<<<<<<<<<
  *         return res
  * 
  */
   __pyx_v_res->nvars = __pyx_v_nvars;
 
-  /* "sat_toolkit/_cnf_util.pyx":182
+  /* "sat_toolkit/formula.pyx":281
  *         assert nvars >= res.nvars
  *         res.nvars = nvars
  *         return res             # <<<<<<<<<<<<<<
  * 
  *     @staticmethod
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_res));
   __pyx_r = __pyx_v_res;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":159
+  /* "sat_toolkit/formula.pyx":258
  * 
  *     @staticmethod
  *     cdef CNF _from_dimacs(const uint8_t[::1] dimacs):             # <<<<<<<<<<<<<<
  *         cdef CNF res = CNF.__new__(CNF)
  *         cdef const char *buf = <const char *> &dimacs[0]
  */
 
@@ -5624,42 +6797,42 @@
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_8);
   __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF._from_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF._from_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_res);
   __Pyx_XDECREF(__pyx_v_values);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":185
+/* "sat_toolkit/formula.pyx":284
  * 
  *     @staticmethod
  *     def from_dimacs(dimacs: str) -> CNF:             # <<<<<<<<<<<<<<
  *         return CNF._from_dimacs(dimacs.encode())
  * 
  */
 
 /* Python wrapper */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_5from_dimacs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_4from_dimacs[] = "CNF.from_dimacs(unicode dimacs: str) -> CNF";
-static PyMethodDef __pyx_mdef_11sat_toolkit_9_cnf_util_3CNF_5from_dimacs = {"from_dimacs", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_5from_dimacs, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_4from_dimacs};
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_5from_dimacs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_5from_dimacs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_4from_dimacs[] = "CNF.from_dimacs(unicode dimacs: str) -> CNF";
+static PyMethodDef __pyx_mdef_11sat_toolkit_7formula_3CNF_5from_dimacs = {"from_dimacs", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_5from_dimacs, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_4from_dimacs};
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_5from_dimacs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_dimacs = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("from_dimacs (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_dimacs,0};
     PyObject* values[1] = {0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
@@ -5673,116 +6846,116 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dimacs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_dimacs") < 0)) __PYX_ERR(0, 185, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_dimacs") < 0)) __PYX_ERR(0, 284, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_dimacs = ((PyObject*)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("from_dimacs", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 185, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("from_dimacs", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 284, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.from_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.from_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dimacs), (&PyUnicode_Type), 1, "dimacs", 1))) __PYX_ERR(0, 185, __pyx_L1_error)
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_4from_dimacs(__pyx_v_dimacs);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dimacs), (&PyUnicode_Type), 1, "dimacs", 1))) __PYX_ERR(0, 284, __pyx_L1_error)
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_4from_dimacs(__pyx_v_dimacs);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_4from_dimacs(PyObject *__pyx_v_dimacs) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = NULL;
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_4from_dimacs(PyObject *__pyx_v_dimacs) {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   __Pyx_memviewslice __pyx_t_2 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("from_dimacs", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":186
+  /* "sat_toolkit/formula.pyx":285
  *     @staticmethod
  *     def from_dimacs(dimacs: str) -> CNF:
  *         return CNF._from_dimacs(dimacs.encode())             # <<<<<<<<<<<<<<
  * 
  *     @staticmethod
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(__pyx_v_dimacs == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 186, __pyx_L1_error)
+    __PYX_ERR(0, 285, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_dimacs, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 186, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_dimacs, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dc_nn___pyx_t_11sat_toolkit_5types_uint8_t__const__(__pyx_t_1, 0); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 186, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dc_nn___pyx_t_11sat_toolkit_5types_uint8_t__const__(__pyx_t_1, 0); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 285, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = ((PyObject *)__pyx_f_11sat_toolkit_9_cnf_util_3CNF__from_dimacs(__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 186, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11sat_toolkit_7formula_3CNF__from_dimacs(__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_2, 1);
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
-  __pyx_r = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_t_1);
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":185
+  /* "sat_toolkit/formula.pyx":284
  * 
  *     @staticmethod
  *     def from_dimacs(dimacs: str) -> CNF:             # <<<<<<<<<<<<<<
  *         return CNF._from_dimacs(dimacs.encode())
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_2, 1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.from_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.from_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":189
+/* "sat_toolkit/formula.pyx":288
  * 
  *     @staticmethod
  *     def from_espresso(espresso: str) -> CNF:             # <<<<<<<<<<<<<<
  *         cdef vector[int] clauses
  *         cdef vector[size_t] start_indices
  */
 
 /* Python wrapper */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_7from_espresso(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_6from_espresso[] = "CNF.from_espresso(unicode espresso: str) -> CNF";
-static PyMethodDef __pyx_mdef_11sat_toolkit_9_cnf_util_3CNF_7from_espresso = {"from_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_7from_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_6from_espresso};
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_7from_espresso(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_7from_espresso(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_6from_espresso[] = "CNF.from_espresso(unicode espresso: str) -> CNF";
+static PyMethodDef __pyx_mdef_11sat_toolkit_7formula_3CNF_7from_espresso = {"from_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_7from_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_6from_espresso};
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_7from_espresso(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_espresso = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("from_espresso (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_espresso,0};
     PyObject* values[1] = {0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
@@ -5796,55 +6969,55 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_espresso)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_espresso") < 0)) __PYX_ERR(0, 189, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_espresso") < 0)) __PYX_ERR(0, 288, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_espresso = ((PyObject*)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("from_espresso", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 189, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("from_espresso", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 288, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.from_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.from_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_espresso), (&PyUnicode_Type), 1, "espresso", 1))) __PYX_ERR(0, 189, __pyx_L1_error)
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_6from_espresso(__pyx_v_espresso);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_espresso), (&PyUnicode_Type), 1, "espresso", 1))) __PYX_ERR(0, 288, __pyx_L1_error)
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_6from_espresso(__pyx_v_espresso);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_6from_espresso(PyObject *__pyx_v_espresso) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_6from_espresso(PyObject *__pyx_v_espresso) {
   std::vector<int>  __pyx_v_clauses;
   __Pyx_memviewslice __pyx_v_line = { 0, 0, { 0 }, { 0 }, { 0 } };
   char __pyx_v_val;
   unsigned int __pyx_v_numbits;
   size_t __pyx_v_i;
   PyObject *__pyx_v_f = NULL;
   PyObject *__pyx_v_line_py = NULL;
   CYTHON_UNUSED PyObject *__pyx_v__ = NULL;
   PyObject *__pyx_v_bits = NULL;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_res = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_res = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   Py_ssize_t __pyx_t_5;
   PyObject *(*__pyx_t_6)(PyObject *);
@@ -5859,310 +7032,311 @@
   Py_UCS4 __pyx_t_15;
   unsigned int __pyx_t_16;
   size_t __pyx_t_17;
   size_t __pyx_t_18;
   int *__pyx_t_19;
   struct __pyx_array_obj *__pyx_t_20 = NULL;
   __Pyx_memviewslice __pyx_t_21 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_22;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("from_espresso", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":195
+  /* "sat_toolkit/formula.pyx":294
  *         cdef char val
  *         cdef uint64_t mask, sign
  *         cdef unsigned int numbits = 0             # <<<<<<<<<<<<<<
  *         cdef size_t i
  * 
  */
   __pyx_v_numbits = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":198
+  /* "sat_toolkit/formula.pyx":297
  *         cdef size_t i
  * 
  *         f = io.BytesIO(espresso.encode())             # <<<<<<<<<<<<<<
  * 
  *         for line_py in f:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_io); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 198, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_io); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 297, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_BytesIO); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 198, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_BytesIO); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 297, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (unlikely(__pyx_v_espresso == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 198, __pyx_L1_error)
+    __PYX_ERR(0, 297, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_espresso, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 198, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_espresso, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 297, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 198, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 297, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_f = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":200
+  /* "sat_toolkit/formula.pyx":299
  *         f = io.BytesIO(espresso.encode())
  * 
  *         for line_py in f:             # <<<<<<<<<<<<<<
- *             line = line_py.strip()
+ *             line = line_py.rstrip()
  *             if startswith(line, b'.i '):
  */
   if (likely(PyList_CheckExact(__pyx_v_f)) || PyTuple_CheckExact(__pyx_v_f)) {
     __pyx_t_1 = __pyx_v_f; __Pyx_INCREF(__pyx_t_1); __pyx_t_5 = 0;
     __pyx_t_6 = NULL;
   } else {
-    __pyx_t_5 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_f); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 200, __pyx_L1_error)
+    __pyx_t_5 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_f); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 299, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 200, __pyx_L1_error)
+    __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 299, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_6)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 200, __pyx_L1_error)
+        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 299, __pyx_L1_error)
         #else
-        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 200, __pyx_L1_error)
+        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 299, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         #endif
       } else {
         if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 200, __pyx_L1_error)
+        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 299, __pyx_L1_error)
         #else
-        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 200, __pyx_L1_error)
+        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 299, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         #endif
       }
     } else {
       __pyx_t_3 = __pyx_t_6(__pyx_t_1);
       if (unlikely(!__pyx_t_3)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 200, __pyx_L1_error)
+          else __PYX_ERR(0, 299, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_3);
     }
     __Pyx_XDECREF_SET(__pyx_v_line_py, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":201
+    /* "sat_toolkit/formula.pyx":300
  * 
  *         for line_py in f:
- *             line = line_py.strip()             # <<<<<<<<<<<<<<
+ *             line = line_py.rstrip()             # <<<<<<<<<<<<<<
  *             if startswith(line, b'.i '):
  *                 _, bits = line_py.split()
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_line_py, __pyx_n_s_strip); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 201, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_line_py, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 300, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 201, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_unsigned_char__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 201, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_unsigned_char__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 300, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_v_line, 1);
     __pyx_v_line = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "sat_toolkit/_cnf_util.pyx":202
+    /* "sat_toolkit/formula.pyx":301
  *         for line_py in f:
- *             line = line_py.strip()
+ *             line = line_py.rstrip()
  *             if startswith(line, b'.i '):             # <<<<<<<<<<<<<<
  *                 _, bits = line_py.split()
  *                 numbits = int(bits)
  */
-    __pyx_t_8 = (__pyx_f_11sat_toolkit_9_cnf_util_startswith(__pyx_v_line, ((char const *)".i ")) != 0);
+    __pyx_t_8 = (__pyx_f_11sat_toolkit_7formula_startswith(__pyx_v_line, ((char const *)".i ")) != 0);
     if (__pyx_t_8) {
 
-      /* "sat_toolkit/_cnf_util.pyx":203
- *             line = line_py.strip()
+      /* "sat_toolkit/formula.pyx":302
+ *             line = line_py.rstrip()
  *             if startswith(line, b'.i '):
  *                 _, bits = line_py.split()             # <<<<<<<<<<<<<<
  *                 numbits = int(bits)
  *             if startswith(line, b'.p '):
  */
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_line_py, __pyx_n_s_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 203, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_line_py, __pyx_n_s_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 302, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_4 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_4)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
           __Pyx_INCREF(__pyx_t_4);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 203, __pyx_L1_error)
+      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 302, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
         PyObject* sequence = __pyx_t_3;
         Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
         if (unlikely(size != 2)) {
           if (size > 2) __Pyx_RaiseTooManyValuesError(2);
           else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-          __PYX_ERR(0, 203, __pyx_L1_error)
+          __PYX_ERR(0, 302, __pyx_L1_error)
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
         if (likely(PyTuple_CheckExact(sequence))) {
           __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
           __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
         } else {
           __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
           __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
         }
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_4);
         #else
-        __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 203, __pyx_L1_error)
+        __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 302, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 203, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 302, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       } else {
         Py_ssize_t index = -1;
-        __pyx_t_9 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 203, __pyx_L1_error)
+        __pyx_t_9 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 302, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __pyx_t_10 = Py_TYPE(__pyx_t_9)->tp_iternext;
         index = 0; __pyx_t_2 = __pyx_t_10(__pyx_t_9); if (unlikely(!__pyx_t_2)) goto __pyx_L6_unpacking_failed;
         __Pyx_GOTREF(__pyx_t_2);
         index = 1; __pyx_t_4 = __pyx_t_10(__pyx_t_9); if (unlikely(!__pyx_t_4)) goto __pyx_L6_unpacking_failed;
         __Pyx_GOTREF(__pyx_t_4);
-        if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_9), 2) < 0) __PYX_ERR(0, 203, __pyx_L1_error)
+        if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_9), 2) < 0) __PYX_ERR(0, 302, __pyx_L1_error)
         __pyx_t_10 = NULL;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         goto __pyx_L7_unpacking_done;
         __pyx_L6_unpacking_failed:;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         __pyx_t_10 = NULL;
         if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-        __PYX_ERR(0, 203, __pyx_L1_error)
+        __PYX_ERR(0, 302, __pyx_L1_error)
         __pyx_L7_unpacking_done:;
       }
       __Pyx_XDECREF_SET(__pyx_v__, __pyx_t_2);
       __pyx_t_2 = 0;
       __Pyx_XDECREF_SET(__pyx_v_bits, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "sat_toolkit/_cnf_util.pyx":204
+      /* "sat_toolkit/formula.pyx":303
  *             if startswith(line, b'.i '):
  *                 _, bits = line_py.split()
  *                 numbits = int(bits)             # <<<<<<<<<<<<<<
  *             if startswith(line, b'.p '):
  *                 ...
  */
-      __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_v_bits); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 204, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_v_bits); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 303, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_11 = __Pyx_PyInt_As_unsigned_int(__pyx_t_3); if (unlikely((__pyx_t_11 == (unsigned int)-1) && PyErr_Occurred())) __PYX_ERR(0, 204, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyInt_As_unsigned_int(__pyx_t_3); if (unlikely((__pyx_t_11 == (unsigned int)-1) && PyErr_Occurred())) __PYX_ERR(0, 303, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_v_numbits = __pyx_t_11;
 
-      /* "sat_toolkit/_cnf_util.pyx":202
+      /* "sat_toolkit/formula.pyx":301
  *         for line_py in f:
- *             line = line_py.strip()
+ *             line = line_py.rstrip()
  *             if startswith(line, b'.i '):             # <<<<<<<<<<<<<<
  *                 _, bits = line_py.split()
  *                 numbits = int(bits)
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":205
+    /* "sat_toolkit/formula.pyx":304
  *                 _, bits = line_py.split()
  *                 numbits = int(bits)
  *             if startswith(line, b'.p '):             # <<<<<<<<<<<<<<
  *                 ...
  *             if startswith(line, b'#') or startswith(line, b'.'):
  */
-    __pyx_t_8 = (__pyx_f_11sat_toolkit_9_cnf_util_startswith(__pyx_v_line, ((char const *)".p ")) != 0);
+    __pyx_t_8 = (__pyx_f_11sat_toolkit_7formula_startswith(__pyx_v_line, ((char const *)".p ")) != 0);
     if (__pyx_t_8) {
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":207
+    /* "sat_toolkit/formula.pyx":306
  *             if startswith(line, b'.p '):
  *                 ...
  *             if startswith(line, b'#') or startswith(line, b'.'):             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-    __pyx_t_12 = (__pyx_f_11sat_toolkit_9_cnf_util_startswith(__pyx_v_line, ((char const *)"#")) != 0);
+    __pyx_t_12 = (__pyx_f_11sat_toolkit_7formula_startswith(__pyx_v_line, ((char const *)"#")) != 0);
     if (!__pyx_t_12) {
     } else {
       __pyx_t_8 = __pyx_t_12;
       goto __pyx_L10_bool_binop_done;
     }
-    __pyx_t_12 = (__pyx_f_11sat_toolkit_9_cnf_util_startswith(__pyx_v_line, ((char const *)".")) != 0);
+    __pyx_t_12 = (__pyx_f_11sat_toolkit_7formula_startswith(__pyx_v_line, ((char const *)".")) != 0);
     __pyx_t_8 = __pyx_t_12;
     __pyx_L10_bool_binop_done:;
     if (__pyx_t_8) {
 
-      /* "sat_toolkit/_cnf_util.pyx":208
+      /* "sat_toolkit/formula.pyx":307
  *                 ...
  *             if startswith(line, b'#') or startswith(line, b'.'):
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             val = line[line.shape[0] - 1]
  */
       goto __pyx_L3_continue;
 
-      /* "sat_toolkit/_cnf_util.pyx":207
+      /* "sat_toolkit/formula.pyx":306
  *             if startswith(line, b'.p '):
  *                 ...
  *             if startswith(line, b'#') or startswith(line, b'.'):             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":210
+    /* "sat_toolkit/formula.pyx":309
  *                 continue
  * 
  *             val = line[line.shape[0] - 1]             # <<<<<<<<<<<<<<
  *             if line.shape[0] != numbits + 2 or line[line.shape[0] - 2] != b' ':
  *                 raise ValueError('file format error')
  */
     __pyx_t_13 = ((__pyx_v_line.shape[0]) - 1);
     __pyx_v_val = (*((unsigned char const  *) ( /* dim=0 */ (__pyx_v_line.data + __pyx_t_13 * __pyx_v_line.strides[0]) )));
 
-    /* "sat_toolkit/_cnf_util.pyx":211
+    /* "sat_toolkit/formula.pyx":310
  * 
  *             val = line[line.shape[0] - 1]
  *             if line.shape[0] != numbits + 2 or line[line.shape[0] - 2] != b' ':             # <<<<<<<<<<<<<<
  *                 raise ValueError('file format error')
  * 
  */
     __pyx_t_12 = (((__pyx_v_line.shape[0]) != (__pyx_v_numbits + 2)) != 0);
@@ -6173,373 +7347,373 @@
     }
     __pyx_t_13 = ((__pyx_v_line.shape[0]) - 2);
     __pyx_t_12 = (((*((unsigned char const  *) ( /* dim=0 */ (__pyx_v_line.data + __pyx_t_13 * __pyx_v_line.strides[0]) ))) != ' ') != 0);
     __pyx_t_8 = __pyx_t_12;
     __pyx_L13_bool_binop_done:;
     if (unlikely(__pyx_t_8)) {
 
-      /* "sat_toolkit/_cnf_util.pyx":212
+      /* "sat_toolkit/formula.pyx":311
  *             val = line[line.shape[0] - 1]
  *             if line.shape[0] != numbits + 2 or line[line.shape[0] - 2] != b' ':
  *                 raise ValueError('file format error')             # <<<<<<<<<<<<<<
  * 
  *             #espresso_mask, val = line.split()
  */
-      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 212, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 311, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_Raise(__pyx_t_3, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __PYX_ERR(0, 212, __pyx_L1_error)
+      __PYX_ERR(0, 311, __pyx_L1_error)
 
-      /* "sat_toolkit/_cnf_util.pyx":211
+      /* "sat_toolkit/formula.pyx":310
  * 
  *             val = line[line.shape[0] - 1]
  *             if line.shape[0] != numbits + 2 or line[line.shape[0] - 2] != b' ':             # <<<<<<<<<<<<<<
  *                 raise ValueError('file format error')
  * 
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":216
+    /* "sat_toolkit/formula.pyx":315
  *             #espresso_mask, val = line.split()
  * 
  *             if val != b'1':             # <<<<<<<<<<<<<<
  *                 raise ValueError(f'got unexpected value for product term: {val!r} expected \'1\'.')
  * 
  */
     __pyx_t_8 = ((__pyx_v_val != '1') != 0);
     if (unlikely(__pyx_t_8)) {
 
-      /* "sat_toolkit/_cnf_util.pyx":217
+      /* "sat_toolkit/formula.pyx":316
  * 
  *             if val != b'1':
  *                 raise ValueError(f'got unexpected value for product term: {val!r} expected \'1\'.')             # <<<<<<<<<<<<<<
  * 
  *             for i in range(numbits):
  */
-      __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 217, __pyx_L1_error)
+      __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 316, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __pyx_t_14 = 0;
       __pyx_t_15 = 127;
       __Pyx_INCREF(__pyx_kp_u_got_unexpected_value_for_product);
       __pyx_t_14 += 39;
       __Pyx_GIVEREF(__pyx_kp_u_got_unexpected_value_for_product);
       PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_got_unexpected_value_for_product);
-      __pyx_t_4 = __Pyx_PyUnicode_From_char(__pyx_v_val, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 217, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyUnicode_From_char(__pyx_v_val, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 316, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_t_14 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
       __Pyx_GIVEREF(__pyx_t_4);
       PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
       __pyx_t_4 = 0;
       __Pyx_INCREF(__pyx_kp_u_expected_1);
       __pyx_t_14 += 14;
       __Pyx_GIVEREF(__pyx_kp_u_expected_1);
       PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_kp_u_expected_1);
-      __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_3, 3, __pyx_t_14, __pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 217, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_3, 3, __pyx_t_14, __pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 316, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 217, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 316, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_Raise(__pyx_t_3, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __PYX_ERR(0, 217, __pyx_L1_error)
+      __PYX_ERR(0, 316, __pyx_L1_error)
 
-      /* "sat_toolkit/_cnf_util.pyx":216
+      /* "sat_toolkit/formula.pyx":315
  *             #espresso_mask, val = line.split()
  * 
  *             if val != b'1':             # <<<<<<<<<<<<<<
  *                 raise ValueError(f'got unexpected value for product term: {val!r} expected \'1\'.')
  * 
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":219
+    /* "sat_toolkit/formula.pyx":318
  *                 raise ValueError(f'got unexpected value for product term: {val!r} expected \'1\'.')
  * 
  *             for i in range(numbits):             # <<<<<<<<<<<<<<
  *                 val = line[numbits - 1 - i]
  *                 if val == b'-':
  */
     __pyx_t_11 = __pyx_v_numbits;
     __pyx_t_16 = __pyx_t_11;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
 
-      /* "sat_toolkit/_cnf_util.pyx":220
+      /* "sat_toolkit/formula.pyx":319
  * 
  *             for i in range(numbits):
  *                 val = line[numbits - 1 - i]             # <<<<<<<<<<<<<<
  *                 if val == b'-':
  *                     continue
  */
       __pyx_t_18 = ((__pyx_v_numbits - 1) - __pyx_v_i);
       __pyx_v_val = (*((unsigned char const  *) ( /* dim=0 */ (__pyx_v_line.data + __pyx_t_18 * __pyx_v_line.strides[0]) )));
 
-      /* "sat_toolkit/_cnf_util.pyx":221
+      /* "sat_toolkit/formula.pyx":320
  *             for i in range(numbits):
  *                 val = line[numbits - 1 - i]
  *                 if val == b'-':             # <<<<<<<<<<<<<<
  *                     continue
  *                 # 0/1 swapped according to De Morgan's law
  */
       __pyx_t_8 = ((__pyx_v_val == '-') != 0);
       if (__pyx_t_8) {
 
-        /* "sat_toolkit/_cnf_util.pyx":222
+        /* "sat_toolkit/formula.pyx":321
  *                 val = line[numbits - 1 - i]
  *                 if val == b'-':
  *                     continue             # <<<<<<<<<<<<<<
  *                 # 0/1 swapped according to De Morgan's law
  *                 if val == b'0':
  */
         goto __pyx_L16_continue;
 
-        /* "sat_toolkit/_cnf_util.pyx":221
+        /* "sat_toolkit/formula.pyx":320
  *             for i in range(numbits):
  *                 val = line[numbits - 1 - i]
  *                 if val == b'-':             # <<<<<<<<<<<<<<
  *                     continue
  *                 # 0/1 swapped according to De Morgan's law
  */
       }
 
-      /* "sat_toolkit/_cnf_util.pyx":224
+      /* "sat_toolkit/formula.pyx":323
  *                     continue
  *                 # 0/1 swapped according to De Morgan's law
  *                 if val == b'0':             # <<<<<<<<<<<<<<
  *                     clauses.push_back((i + 1))
  *                     continue
  */
       __pyx_t_8 = ((__pyx_v_val == '0') != 0);
       if (__pyx_t_8) {
 
-        /* "sat_toolkit/_cnf_util.pyx":225
+        /* "sat_toolkit/formula.pyx":324
  *                 # 0/1 swapped according to De Morgan's law
  *                 if val == b'0':
  *                     clauses.push_back((i + 1))             # <<<<<<<<<<<<<<
  *                     continue
  *                 if val == b'1':
  */
         try {
           __pyx_v_clauses.push_back((__pyx_v_i + 1));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 225, __pyx_L1_error)
+          __PYX_ERR(0, 324, __pyx_L1_error)
         }
 
-        /* "sat_toolkit/_cnf_util.pyx":226
+        /* "sat_toolkit/formula.pyx":325
  *                 if val == b'0':
  *                     clauses.push_back((i + 1))
  *                     continue             # <<<<<<<<<<<<<<
  *                 if val == b'1':
  *                     clauses.push_back(-(i + 1))
  */
         goto __pyx_L16_continue;
 
-        /* "sat_toolkit/_cnf_util.pyx":224
+        /* "sat_toolkit/formula.pyx":323
  *                     continue
  *                 # 0/1 swapped according to De Morgan's law
  *                 if val == b'0':             # <<<<<<<<<<<<<<
  *                     clauses.push_back((i + 1))
  *                     continue
  */
       }
 
-      /* "sat_toolkit/_cnf_util.pyx":227
+      /* "sat_toolkit/formula.pyx":326
  *                     clauses.push_back((i + 1))
  *                     continue
  *                 if val == b'1':             # <<<<<<<<<<<<<<
  *                     clauses.push_back(-(i + 1))
  *                     continue
  */
       __pyx_t_8 = ((__pyx_v_val == '1') != 0);
       if (__pyx_t_8) {
 
-        /* "sat_toolkit/_cnf_util.pyx":228
+        /* "sat_toolkit/formula.pyx":327
  *                     continue
  *                 if val == b'1':
  *                     clauses.push_back(-(i + 1))             # <<<<<<<<<<<<<<
  *                     continue
  *                 raise ValueError(f'file format error in line {bytes(line)}')
  */
         try {
           __pyx_v_clauses.push_back((-(__pyx_v_i + 1)));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 228, __pyx_L1_error)
+          __PYX_ERR(0, 327, __pyx_L1_error)
         }
 
-        /* "sat_toolkit/_cnf_util.pyx":229
+        /* "sat_toolkit/formula.pyx":328
  *                 if val == b'1':
  *                     clauses.push_back(-(i + 1))
  *                     continue             # <<<<<<<<<<<<<<
  *                 raise ValueError(f'file format error in line {bytes(line)}')
  *             clauses.push_back(0)
  */
         goto __pyx_L16_continue;
 
-        /* "sat_toolkit/_cnf_util.pyx":227
+        /* "sat_toolkit/formula.pyx":326
  *                     clauses.push_back((i + 1))
  *                     continue
  *                 if val == b'1':             # <<<<<<<<<<<<<<
  *                     clauses.push_back(-(i + 1))
  *                     continue
  */
       }
 
-      /* "sat_toolkit/_cnf_util.pyx":230
+      /* "sat_toolkit/formula.pyx":329
  *                     clauses.push_back(-(i + 1))
  *                     continue
  *                 raise ValueError(f'file format error in line {bytes(line)}')             # <<<<<<<<<<<<<<
  *             clauses.push_back(0)
  * 
  */
-      __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_line, 1, (PyObject *(*)(char *)) __pyx_memview_get_unsigned_char__const__, (int (*)(char *, PyObject *)) NULL, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 230, __pyx_L1_error)
+      __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_line, 1, (PyObject *(*)(char *)) __pyx_memview_get_unsigned_char__const__, (int (*)(char *, PyObject *)) NULL, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 329, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_4 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyBytes_Type)), __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 230, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyBytes_Type)), __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 329, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 230, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 329, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_file_format_error_in_line, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 230, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_file_format_error_in_line, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 329, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 230, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 329, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_Raise(__pyx_t_3, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __PYX_ERR(0, 230, __pyx_L1_error)
+      __PYX_ERR(0, 329, __pyx_L1_error)
       __pyx_L16_continue:;
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":231
+    /* "sat_toolkit/formula.pyx":330
  *                     continue
  *                 raise ValueError(f'file format error in line {bytes(line)}')
  *             clauses.push_back(0)             # <<<<<<<<<<<<<<
  * 
  *         cdef CNF res = CNF.__new__(CNF)
  */
     try {
       __pyx_v_clauses.push_back(0);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 231, __pyx_L1_error)
+      __PYX_ERR(0, 330, __pyx_L1_error)
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":200
+    /* "sat_toolkit/formula.pyx":299
  *         f = io.BytesIO(espresso.encode())
  * 
  *         for line_py in f:             # <<<<<<<<<<<<<<
- *             line = line_py.strip()
+ *             line = line_py.rstrip()
  *             if startswith(line, b'.i '):
  */
     __pyx_L3_continue:;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":233
+  /* "sat_toolkit/formula.pyx":332
  *             clauses.push_back(0)
  * 
  *         cdef CNF res = CNF.__new__(CNF)             # <<<<<<<<<<<<<<
  *         if clauses.size() > 0:
  *             res._add_clauses(<int[:clauses.size()]> clauses.data())
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_11sat_toolkit_9_cnf_util_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 233, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_11sat_toolkit_7formula_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 332, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_t_1);
+  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":234
+  /* "sat_toolkit/formula.pyx":333
  * 
  *         cdef CNF res = CNF.__new__(CNF)
  *         if clauses.size() > 0:             # <<<<<<<<<<<<<<
  *             res._add_clauses(<int[:clauses.size()]> clauses.data())
  *         assert numbits >= <unsigned int> res.nvars
  */
   __pyx_t_8 = ((__pyx_v_clauses.size() > 0) != 0);
   if (__pyx_t_8) {
 
-    /* "sat_toolkit/_cnf_util.pyx":235
+    /* "sat_toolkit/formula.pyx":334
  *         cdef CNF res = CNF.__new__(CNF)
  *         if clauses.size() > 0:
  *             res._add_clauses(<int[:clauses.size()]> clauses.data())             # <<<<<<<<<<<<<<
  *         assert numbits >= <unsigned int> res.nvars
  *         res.nvars = numbits
  */
     __pyx_t_19 = __pyx_v_clauses.data();
     if (!__pyx_t_19) {
       PyErr_SetString(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
-      __PYX_ERR(0, 235, __pyx_L1_error)
+      __PYX_ERR(0, 334, __pyx_L1_error)
     }
-    __pyx_t_3 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 235, __pyx_L1_error)
+    __pyx_t_3 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 334, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_clauses.size())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 235, __pyx_L1_error)
+    __pyx_t_1 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_clauses.size())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 334, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_20 = __pyx_array_new(__pyx_t_1, sizeof(int), PyBytes_AS_STRING(__pyx_t_3), (char *) "c", (char *) __pyx_t_19);
-    if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 235, __pyx_L1_error)
+    if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 334, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_20);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_21 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(((PyObject *)__pyx_t_20), PyBUF_WRITABLE); if (unlikely(!__pyx_t_21.memview)) __PYX_ERR(0, 235, __pyx_L1_error)
+    __pyx_t_21 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(((PyObject *)__pyx_t_20), 0); if (unlikely(!__pyx_t_21.memview)) __PYX_ERR(0, 334, __pyx_L1_error)
     __Pyx_DECREF(((PyObject *)__pyx_t_20)); __pyx_t_20 = 0;
-    ((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_21);
+    __pyx_t_22 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_21); if (unlikely(__pyx_t_22 == ((int)-1))) __PYX_ERR(0, 334, __pyx_L1_error)
     __PYX_XDEC_MEMVIEW(&__pyx_t_21, 1);
     __pyx_t_21.memview = NULL;
     __pyx_t_21.data = NULL;
 
-    /* "sat_toolkit/_cnf_util.pyx":234
+    /* "sat_toolkit/formula.pyx":333
  * 
  *         cdef CNF res = CNF.__new__(CNF)
  *         if clauses.size() > 0:             # <<<<<<<<<<<<<<
  *             res._add_clauses(<int[:clauses.size()]> clauses.data())
  *         assert numbits >= <unsigned int> res.nvars
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":236
+  /* "sat_toolkit/formula.pyx":335
  *         if clauses.size() > 0:
  *             res._add_clauses(<int[:clauses.size()]> clauses.data())
  *         assert numbits >= <unsigned int> res.nvars             # <<<<<<<<<<<<<<
  *         res.nvars = numbits
  *         return res
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
-  if (unlikely(!Py_OptimizeFlag)) {
+  if (unlikely(__pyx_assertions_enabled())) {
     if (unlikely(!((__pyx_v_numbits >= ((unsigned int)__pyx_v_res->nvars)) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
-      __PYX_ERR(0, 236, __pyx_L1_error)
+      __PYX_ERR(0, 335, __pyx_L1_error)
     }
   }
   #endif
 
-  /* "sat_toolkit/_cnf_util.pyx":237
+  /* "sat_toolkit/formula.pyx":336
  *             res._add_clauses(<int[:clauses.size()]> clauses.data())
  *         assert numbits >= <unsigned int> res.nvars
  *         res.nvars = numbits             # <<<<<<<<<<<<<<
  *         return res
  * 
  */
   __pyx_v_res->nvars = __pyx_v_numbits;
 
-  /* "sat_toolkit/_cnf_util.pyx":238
+  /* "sat_toolkit/formula.pyx":337
  *         assert numbits >= <unsigned int> res.nvars
  *         res.nvars = numbits
  *         return res             # <<<<<<<<<<<<<<
  * 
- * 
+ *     @staticmethod
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_res));
   __pyx_r = __pyx_v_res;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":189
+  /* "sat_toolkit/formula.pyx":288
  * 
  *     @staticmethod
  *     def from_espresso(espresso: str) -> CNF:             # <<<<<<<<<<<<<<
  *         cdef vector[int] clauses
  *         cdef vector[size_t] start_indices
  */
 
@@ -6549,990 +7723,2764 @@
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
   __Pyx_XDECREF(__pyx_t_9);
   __Pyx_XDECREF(((PyObject *)__pyx_t_20));
   __PYX_XDEC_MEMVIEW(&__pyx_t_21, 1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.from_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.from_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_line, 1);
   __Pyx_XDECREF(__pyx_v_f);
   __Pyx_XDECREF(__pyx_v_line_py);
   __Pyx_XDECREF(__pyx_v__);
   __Pyx_XDECREF(__pyx_v_bits);
   __Pyx_XDECREF((PyObject *)__pyx_v_res);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":241
+/* "sat_toolkit/formula.pyx":340
+ * 
+ *     @staticmethod
+ *     def create_all_zero(const int[:] indices not None) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         creates a CNF that asserts that all variables for the provided indices
+ */
+
+/* Python wrapper */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_9create_all_zero(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_8create_all_zero[] = "CNF.create_all_zero(const int[:] indices) -> CNF\n\n        creates a CNF that asserts that all variables for the provided indices\n        are zero.\n        ";
+static PyMethodDef __pyx_mdef_11sat_toolkit_7formula_3CNF_9create_all_zero = {"create_all_zero", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_9create_all_zero, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_8create_all_zero};
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_9create_all_zero(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  __Pyx_memviewslice __pyx_v_indices = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("create_all_zero (wrapper)", 0);
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_indices,0};
+    PyObject* values[1] = {0};
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      switch (pos_args) {
+        case  0:
+        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
+        else goto __pyx_L5_argtuple_error;
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "create_all_zero") < 0)) __PYX_ERR(0, 340, __pyx_L3_error)
+      }
+    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+    }
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 340, __pyx_L3_error)
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("create_all_zero", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 340, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.create_all_zero", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  if (unlikely(((PyObject *)__pyx_v_indices.memview) == Py_None)) {
+    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "indices"); __PYX_ERR(0, 340, __pyx_L1_error)
+  }
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_8create_all_zero(__pyx_v_indices);
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_8create_all_zero(__Pyx_memviewslice __pyx_v_indices) {
+  std::vector<int>  __pyx_v_clauses;
+  size_t __pyx_v_i;
+  size_t __pyx_v_l;
+  int __pyx_v_val;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_res = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  size_t __pyx_t_1;
+  size_t __pyx_t_2;
+  size_t __pyx_t_3;
+  size_t __pyx_t_4;
+  int __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  int *__pyx_t_7;
+  struct __pyx_array_obj *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  __Pyx_memviewslice __pyx_t_10 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_11;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("create_all_zero", 0);
+
+  /* "sat_toolkit/formula.pyx":349
+ *         cdef int val
+ * 
+ *         l = indices.shape[0]             # <<<<<<<<<<<<<<
+ * 
+ *         clauses.resize(l * 2)
+ */
+  __pyx_v_l = (__pyx_v_indices.shape[0]);
+
+  /* "sat_toolkit/formula.pyx":351
+ *         l = indices.shape[0]
+ * 
+ *         clauses.resize(l * 2)             # <<<<<<<<<<<<<<
+ *         for i in range(l):
+ *             val = indices[i]
+ */
+  try {
+    __pyx_v_clauses.resize((__pyx_v_l * 2));
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 351, __pyx_L1_error)
+  }
+
+  /* "sat_toolkit/formula.pyx":352
+ * 
+ *         clauses.resize(l * 2)
+ *         for i in range(l):             # <<<<<<<<<<<<<<
+ *             val = indices[i]
+ *             if val == 0:
+ */
+  __pyx_t_1 = __pyx_v_l;
+  __pyx_t_2 = __pyx_t_1;
+  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
+    __pyx_v_i = __pyx_t_3;
+
+    /* "sat_toolkit/formula.pyx":353
+ *         clauses.resize(l * 2)
+ *         for i in range(l):
+ *             val = indices[i]             # <<<<<<<<<<<<<<
+ *             if val == 0:
+ *                 raise ValueError('all indices must be nonzero')
+ */
+    __pyx_t_4 = __pyx_v_i;
+    __pyx_v_val = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_4 * __pyx_v_indices.strides[0]) )));
+
+    /* "sat_toolkit/formula.pyx":354
+ *         for i in range(l):
+ *             val = indices[i]
+ *             if val == 0:             # <<<<<<<<<<<<<<
+ *                 raise ValueError('all indices must be nonzero')
+ *             clauses[2*i] = -val
+ */
+    __pyx_t_5 = ((__pyx_v_val == 0) != 0);
+    if (unlikely(__pyx_t_5)) {
+
+      /* "sat_toolkit/formula.pyx":355
+ *             val = indices[i]
+ *             if val == 0:
+ *                 raise ValueError('all indices must be nonzero')             # <<<<<<<<<<<<<<
+ *             clauses[2*i] = -val
+ * 
+ */
+      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 355, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __PYX_ERR(0, 355, __pyx_L1_error)
+
+      /* "sat_toolkit/formula.pyx":354
+ *         for i in range(l):
+ *             val = indices[i]
+ *             if val == 0:             # <<<<<<<<<<<<<<
+ *                 raise ValueError('all indices must be nonzero')
+ *             clauses[2*i] = -val
+ */
+    }
+
+    /* "sat_toolkit/formula.pyx":356
+ *             if val == 0:
+ *                 raise ValueError('all indices must be nonzero')
+ *             clauses[2*i] = -val             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+    (__pyx_v_clauses[(2 * __pyx_v_i)]) = (-__pyx_v_val);
+  }
+
+  /* "sat_toolkit/formula.pyx":359
+ * 
+ * 
+ *         cdef CNF res = CNF.__new__(CNF)             # <<<<<<<<<<<<<<
+ *         if clauses.size() > 0:
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())
+ */
+  __pyx_t_6 = ((PyObject *)__pyx_tp_new_11sat_toolkit_7formula_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 359, __pyx_L1_error)
+  __Pyx_GOTREF(((PyObject *)__pyx_t_6));
+  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_6);
+  __pyx_t_6 = 0;
+
+  /* "sat_toolkit/formula.pyx":360
+ * 
+ *         cdef CNF res = CNF.__new__(CNF)
+ *         if clauses.size() > 0:             # <<<<<<<<<<<<<<
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())
+ *         return res
+ */
+  __pyx_t_5 = ((__pyx_v_clauses.size() > 0) != 0);
+  if (__pyx_t_5) {
+
+    /* "sat_toolkit/formula.pyx":361
+ *         cdef CNF res = CNF.__new__(CNF)
+ *         if clauses.size() > 0:
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())             # <<<<<<<<<<<<<<
+ *         return res
+ * 
+ */
+    __pyx_t_7 = __pyx_v_clauses.data();
+    if (!__pyx_t_7) {
+      PyErr_SetString(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
+      __PYX_ERR(0, 361, __pyx_L1_error)
+    }
+    __pyx_t_9 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 361, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_9);
+    __pyx_t_6 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_clauses.size())); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 361, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_8 = __pyx_array_new(__pyx_t_6, sizeof(int), PyBytes_AS_STRING(__pyx_t_9), (char *) "c", (char *) __pyx_t_7);
+    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 361, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(((PyObject *)__pyx_t_8), 0); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 361, __pyx_L1_error)
+    __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
+    __pyx_t_11 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_10); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 361, __pyx_L1_error)
+    __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
+    __pyx_t_10.memview = NULL;
+    __pyx_t_10.data = NULL;
+
+    /* "sat_toolkit/formula.pyx":360
+ * 
+ *         cdef CNF res = CNF.__new__(CNF)
+ *         if clauses.size() > 0:             # <<<<<<<<<<<<<<
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())
+ *         return res
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":362
+ *         if clauses.size() > 0:
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())
+ *         return res             # <<<<<<<<<<<<<<
+ * 
+ *     @staticmethod
+ */
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __Pyx_INCREF(((PyObject *)__pyx_v_res));
+  __pyx_r = __pyx_v_res;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":340
+ * 
+ *     @staticmethod
+ *     def create_all_zero(const int[:] indices not None) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         creates a CNF that asserts that all variables for the provided indices
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(((PyObject *)__pyx_t_8));
+  __Pyx_XDECREF(__pyx_t_9);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.create_all_zero", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_res);
+  __PYX_XDEC_MEMVIEW(&__pyx_v_indices, 1);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":365
+ * 
+ *     @staticmethod
+ *     def create_all_equal(const int[:] lhs not None, const int[:] rhs not None) -> CNF:             # <<<<<<<<<<<<<<
+ *         "creates a CNF that asserts lhs[i] == rhs[i] for all i."
+ *         cdef vector[int] clauses
+ */
+
+/* Python wrapper */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_11create_all_equal(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_10create_all_equal[] = "CNF.create_all_equal(const int[:] lhs, const int[:] rhs) -> CNF\ncreates a CNF that asserts lhs[i] == rhs[i] for all i.";
+static PyMethodDef __pyx_mdef_11sat_toolkit_7formula_3CNF_11create_all_equal = {"create_all_equal", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_11create_all_equal, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_10create_all_equal};
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_11create_all_equal(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  __Pyx_memviewslice __pyx_v_lhs = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_v_rhs = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("create_all_equal (wrapper)", 0);
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_lhs,&__pyx_n_s_rhs,0};
+    PyObject* values[2] = {0,0};
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      switch (pos_args) {
+        case  0:
+        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lhs)) != 0)) kw_args--;
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rhs)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("create_all_equal", 1, 2, 2, 1); __PYX_ERR(0, 365, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "create_all_equal") < 0)) __PYX_ERR(0, 365, __pyx_L3_error)
+      }
+    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+    }
+    __pyx_v_lhs = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_lhs.memview)) __PYX_ERR(0, 365, __pyx_L3_error)
+    __pyx_v_rhs = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_rhs.memview)) __PYX_ERR(0, 365, __pyx_L3_error)
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("create_all_equal", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 365, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.create_all_equal", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  if (unlikely(((PyObject *)__pyx_v_lhs.memview) == Py_None)) {
+    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "lhs"); __PYX_ERR(0, 365, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_rhs.memview) == Py_None)) {
+    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "rhs"); __PYX_ERR(0, 365, __pyx_L1_error)
+  }
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_10create_all_equal(__pyx_v_lhs, __pyx_v_rhs);
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_10create_all_equal(__Pyx_memviewslice __pyx_v_lhs, __Pyx_memviewslice __pyx_v_rhs) {
+  std::vector<int>  __pyx_v_clauses;
+  size_t __pyx_v_i;
+  size_t __pyx_v_length;
+  int __pyx_v_l;
+  int __pyx_v_r;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_res = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  size_t __pyx_t_3;
+  size_t __pyx_t_4;
+  size_t __pyx_t_5;
+  size_t __pyx_t_6;
+  int __pyx_t_7;
+  int *__pyx_t_8;
+  struct __pyx_array_obj *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_10 = NULL;
+  __Pyx_memviewslice __pyx_t_11 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_12;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("create_all_equal", 0);
+
+  /* "sat_toolkit/formula.pyx":371
+ *         cdef int l, r
+ * 
+ *         length = lhs.shape[0]             # <<<<<<<<<<<<<<
+ *         if rhs.shape[0] != length:
+ *             raise ValueError('lhs and rhs must have the same length')
+ */
+  __pyx_v_length = (__pyx_v_lhs.shape[0]);
+
+  /* "sat_toolkit/formula.pyx":372
+ * 
+ *         length = lhs.shape[0]
+ *         if rhs.shape[0] != length:             # <<<<<<<<<<<<<<
+ *             raise ValueError('lhs and rhs must have the same length')
+ * 
+ */
+  __pyx_t_1 = (((__pyx_v_rhs.shape[0]) != __pyx_v_length) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "sat_toolkit/formula.pyx":373
+ *         length = lhs.shape[0]
+ *         if rhs.shape[0] != length:
+ *             raise ValueError('lhs and rhs must have the same length')             # <<<<<<<<<<<<<<
+ * 
+ *         clauses.resize(length * 6)
+ */
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 373, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 373, __pyx_L1_error)
+
+    /* "sat_toolkit/formula.pyx":372
+ * 
+ *         length = lhs.shape[0]
+ *         if rhs.shape[0] != length:             # <<<<<<<<<<<<<<
+ *             raise ValueError('lhs and rhs must have the same length')
+ * 
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":375
+ *             raise ValueError('lhs and rhs must have the same length')
+ * 
+ *         clauses.resize(length * 6)             # <<<<<<<<<<<<<<
+ *         for i in range(length):
+ *             l = lhs[i]
+ */
+  try {
+    __pyx_v_clauses.resize((__pyx_v_length * 6));
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 375, __pyx_L1_error)
+  }
+
+  /* "sat_toolkit/formula.pyx":376
+ * 
+ *         clauses.resize(length * 6)
+ *         for i in range(length):             # <<<<<<<<<<<<<<
+ *             l = lhs[i]
+ *             r = rhs[i]
+ */
+  __pyx_t_3 = __pyx_v_length;
+  __pyx_t_4 = __pyx_t_3;
+  for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {
+    __pyx_v_i = __pyx_t_5;
+
+    /* "sat_toolkit/formula.pyx":377
+ *         clauses.resize(length * 6)
+ *         for i in range(length):
+ *             l = lhs[i]             # <<<<<<<<<<<<<<
+ *             r = rhs[i]
+ *             if l == 0 or r == 0:
+ */
+    __pyx_t_6 = __pyx_v_i;
+    __pyx_v_l = (*((int const  *) ( /* dim=0 */ (__pyx_v_lhs.data + __pyx_t_6 * __pyx_v_lhs.strides[0]) )));
+
+    /* "sat_toolkit/formula.pyx":378
+ *         for i in range(length):
+ *             l = lhs[i]
+ *             r = rhs[i]             # <<<<<<<<<<<<<<
+ *             if l == 0 or r == 0:
+ *                 raise ValueError('all indices must be nonzero')
+ */
+    __pyx_t_6 = __pyx_v_i;
+    __pyx_v_r = (*((int const  *) ( /* dim=0 */ (__pyx_v_rhs.data + __pyx_t_6 * __pyx_v_rhs.strides[0]) )));
+
+    /* "sat_toolkit/formula.pyx":379
+ *             l = lhs[i]
+ *             r = rhs[i]
+ *             if l == 0 or r == 0:             # <<<<<<<<<<<<<<
+ *                 raise ValueError('all indices must be nonzero')
+ * 
+ */
+    __pyx_t_7 = ((__pyx_v_l == 0) != 0);
+    if (!__pyx_t_7) {
+    } else {
+      __pyx_t_1 = __pyx_t_7;
+      goto __pyx_L7_bool_binop_done;
+    }
+    __pyx_t_7 = ((__pyx_v_r == 0) != 0);
+    __pyx_t_1 = __pyx_t_7;
+    __pyx_L7_bool_binop_done:;
+    if (unlikely(__pyx_t_1)) {
+
+      /* "sat_toolkit/formula.pyx":380
+ *             r = rhs[i]
+ *             if l == 0 or r == 0:
+ *                 raise ValueError('all indices must be nonzero')             # <<<<<<<<<<<<<<
+ * 
+ *             clauses[6 * i + 0] = -l
+ */
+      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 380, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __PYX_ERR(0, 380, __pyx_L1_error)
+
+      /* "sat_toolkit/formula.pyx":379
+ *             l = lhs[i]
+ *             r = rhs[i]
+ *             if l == 0 or r == 0:             # <<<<<<<<<<<<<<
+ *                 raise ValueError('all indices must be nonzero')
+ * 
+ */
+    }
+
+    /* "sat_toolkit/formula.pyx":382
+ *                 raise ValueError('all indices must be nonzero')
+ * 
+ *             clauses[6 * i + 0] = -l             # <<<<<<<<<<<<<<
+ *             clauses[6 * i + 1] = r
+ *             clauses[6 * i + 2] = 0
+ */
+    (__pyx_v_clauses[((6 * __pyx_v_i) + 0)]) = (-__pyx_v_l);
+
+    /* "sat_toolkit/formula.pyx":383
+ * 
+ *             clauses[6 * i + 0] = -l
+ *             clauses[6 * i + 1] = r             # <<<<<<<<<<<<<<
+ *             clauses[6 * i + 2] = 0
+ * 
+ */
+    (__pyx_v_clauses[((6 * __pyx_v_i) + 1)]) = __pyx_v_r;
+
+    /* "sat_toolkit/formula.pyx":384
+ *             clauses[6 * i + 0] = -l
+ *             clauses[6 * i + 1] = r
+ *             clauses[6 * i + 2] = 0             # <<<<<<<<<<<<<<
+ * 
+ *             clauses[6 * i + 3] = l
+ */
+    (__pyx_v_clauses[((6 * __pyx_v_i) + 2)]) = 0;
+
+    /* "sat_toolkit/formula.pyx":386
+ *             clauses[6 * i + 2] = 0
+ * 
+ *             clauses[6 * i + 3] = l             # <<<<<<<<<<<<<<
+ *             clauses[6 * i + 4] = -r
+ *             clauses[6 * i + 5] = 0
+ */
+    (__pyx_v_clauses[((6 * __pyx_v_i) + 3)]) = __pyx_v_l;
+
+    /* "sat_toolkit/formula.pyx":387
+ * 
+ *             clauses[6 * i + 3] = l
+ *             clauses[6 * i + 4] = -r             # <<<<<<<<<<<<<<
+ *             clauses[6 * i + 5] = 0
+ * 
+ */
+    (__pyx_v_clauses[((6 * __pyx_v_i) + 4)]) = (-__pyx_v_r);
+
+    /* "sat_toolkit/formula.pyx":388
+ *             clauses[6 * i + 3] = l
+ *             clauses[6 * i + 4] = -r
+ *             clauses[6 * i + 5] = 0             # <<<<<<<<<<<<<<
+ * 
+ *         cdef CNF res = CNF.__new__(CNF)
+ */
+    (__pyx_v_clauses[((6 * __pyx_v_i) + 5)]) = 0;
+  }
+
+  /* "sat_toolkit/formula.pyx":390
+ *             clauses[6 * i + 5] = 0
+ * 
+ *         cdef CNF res = CNF.__new__(CNF)             # <<<<<<<<<<<<<<
+ *         if clauses.size() > 0:
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())
+ */
+  __pyx_t_2 = ((PyObject *)__pyx_tp_new_11sat_toolkit_7formula_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 390, __pyx_L1_error)
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_2);
+  __pyx_t_2 = 0;
+
+  /* "sat_toolkit/formula.pyx":391
+ * 
+ *         cdef CNF res = CNF.__new__(CNF)
+ *         if clauses.size() > 0:             # <<<<<<<<<<<<<<
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())
+ *         return res
+ */
+  __pyx_t_1 = ((__pyx_v_clauses.size() > 0) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":392
+ *         cdef CNF res = CNF.__new__(CNF)
+ *         if clauses.size() > 0:
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())             # <<<<<<<<<<<<<<
+ *         return res
+ * 
+ */
+    __pyx_t_8 = __pyx_v_clauses.data();
+    if (!__pyx_t_8) {
+      PyErr_SetString(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
+      __PYX_ERR(0, 392, __pyx_L1_error)
+    }
+    __pyx_t_10 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 392, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_10);
+    __pyx_t_2 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_clauses.size())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 392, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_9 = __pyx_array_new(__pyx_t_2, sizeof(int), PyBytes_AS_STRING(__pyx_t_10), (char *) "c", (char *) __pyx_t_8);
+    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 392, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_9);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(((PyObject *)__pyx_t_9), 0); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 392, __pyx_L1_error)
+    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
+    __pyx_t_12 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_11); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 392, __pyx_L1_error)
+    __PYX_XDEC_MEMVIEW(&__pyx_t_11, 1);
+    __pyx_t_11.memview = NULL;
+    __pyx_t_11.data = NULL;
+
+    /* "sat_toolkit/formula.pyx":391
+ * 
+ *         cdef CNF res = CNF.__new__(CNF)
+ *         if clauses.size() > 0:             # <<<<<<<<<<<<<<
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())
+ *         return res
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":393
+ *         if clauses.size() > 0:
+ *             res._add_clauses(<int[:clauses.size()]> clauses.data())
+ *         return res             # <<<<<<<<<<<<<<
+ * 
+ *     @staticmethod
+ */
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __Pyx_INCREF(((PyObject *)__pyx_v_res));
+  __pyx_r = __pyx_v_res;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":365
+ * 
+ *     @staticmethod
+ *     def create_all_equal(const int[:] lhs not None, const int[:] rhs not None) -> CNF:             # <<<<<<<<<<<<<<
+ *         "creates a CNF that asserts lhs[i] == rhs[i] for all i."
+ *         cdef vector[int] clauses
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(((PyObject *)__pyx_t_9));
+  __Pyx_XDECREF(__pyx_t_10);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_11, 1);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.create_all_equal", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_res);
+  __PYX_XDEC_MEMVIEW(&__pyx_v_lhs, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_v_rhs, 1);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":396
+ * 
+ *     @staticmethod
+ *     cdef CNF _create_xor(const int[:, ::1] packed_args):             # <<<<<<<<<<<<<<
+ *         cdef CNF res = CNF.__new__(CNF)
+ * 
+ */
+
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_f_11sat_toolkit_7formula_3CNF__create_xor(__Pyx_memviewslice __pyx_v_packed_args) {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_res = 0;
+  size_t __pyx_v_num_inputs;
+  size_t __pyx_v_num_xors;
+  size_t __pyx_v_row;
+  size_t __pyx_v_col;
+  size_t __pyx_v_mask;
+  int __pyx_v_rhs;
+  int __pyx_v_var_idx;
+  CYTHON_UNUSED size_t __pyx_v_needed_space;
+  __Pyx_memviewslice __pyx_v_tmp_clause = { 0, 0, { 0 }, { 0 }, { 0 } };
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
+  __Pyx_memviewslice __pyx_t_8 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  size_t __pyx_t_9;
+  size_t __pyx_t_10;
+  size_t __pyx_t_11;
+  size_t __pyx_t_12;
+  size_t __pyx_t_13;
+  size_t __pyx_t_14;
+  size_t __pyx_t_15;
+  size_t __pyx_t_16;
+  int __pyx_t_17;
+  int __pyx_t_18;
+  size_t __pyx_t_19;
+  size_t __pyx_t_20;
+  size_t __pyx_t_21;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("_create_xor", 0);
+
+  /* "sat_toolkit/formula.pyx":397
+ *     @staticmethod
+ *     cdef CNF _create_xor(const int[:, ::1] packed_args):
+ *         cdef CNF res = CNF.__new__(CNF)             # <<<<<<<<<<<<<<
+ * 
+ *         cdef size_t num_inputs, num_xors
+ */
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_11sat_toolkit_7formula_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 397, __pyx_L1_error)
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "sat_toolkit/formula.pyx":404
+ *         cdef int rhs, var_idx
+ * 
+ *         num_xors = packed_args.shape[0]             # <<<<<<<<<<<<<<
+ *         num_inputs = packed_args.shape[1] - 1
  * 
+ */
+  __pyx_v_num_xors = (__pyx_v_packed_args.shape[0]);
+
+  /* "sat_toolkit/formula.pyx":405
+ * 
+ *         num_xors = packed_args.shape[0]
+ *         num_inputs = packed_args.shape[1] - 1             # <<<<<<<<<<<<<<
+ * 
+ *         cdef size_t needed_space = num_inputs * ((1 << (num_inputs - 1)) + 1)
+ */
+  __pyx_v_num_inputs = ((__pyx_v_packed_args.shape[1]) - 1);
+
+  /* "sat_toolkit/formula.pyx":407
+ *         num_inputs = packed_args.shape[1] - 1
  * 
- *     cdef void _add_clauses(self, int[:] clauses):             # <<<<<<<<<<<<<<
+ *         cdef size_t needed_space = num_inputs * ((1 << (num_inputs - 1)) + 1)             # <<<<<<<<<<<<<<
+ *         cdef int[::1] tmp_clause = np.empty(num_inputs + 1, np.int32)
+ *         tmp_clause[num_inputs] = 0
+ */
+  __pyx_v_needed_space = (__pyx_v_num_inputs * ((1 << (__pyx_v_num_inputs - 1)) + 1));
+
+  /* "sat_toolkit/formula.pyx":408
+ * 
+ *         cdef size_t needed_space = num_inputs * ((1 << (num_inputs - 1)) + 1)
+ *         cdef int[::1] tmp_clause = np.empty(num_inputs + 1, np.int32)             # <<<<<<<<<<<<<<
+ *         tmp_clause[num_inputs] = 0
+ * 
+ */
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 408, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 408, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyInt_FromSize_t((__pyx_v_num_inputs + 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 408, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 408, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 408, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_4 = NULL;
+  __pyx_t_6 = 0;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+    if (likely(__pyx_t_4)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_3, function);
+      __pyx_t_6 = 1;
+    }
+  }
+  #if CYTHON_FAST_PYCALL
+  if (PyFunction_Check(__pyx_t_3)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_2, __pyx_t_5};
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 408, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  } else
+  #endif
+  #if CYTHON_FAST_PYCCALL
+  if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_2, __pyx_t_5};
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 408, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  } else
+  #endif
+  {
+    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 408, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    if (__pyx_t_4) {
+      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
+    }
+    __Pyx_GIVEREF(__pyx_t_2);
+    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_t_2);
+    __Pyx_GIVEREF(__pyx_t_5);
+    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_5);
+    __pyx_t_2 = 0;
+    __pyx_t_5 = 0;
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 408, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dc_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 408, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_tmp_clause = __pyx_t_8;
+  __pyx_t_8.memview = NULL;
+  __pyx_t_8.data = NULL;
+
+  /* "sat_toolkit/formula.pyx":409
+ *         cdef size_t needed_space = num_inputs * ((1 << (num_inputs - 1)) + 1)
+ *         cdef int[::1] tmp_clause = np.empty(num_inputs + 1, np.int32)
+ *         tmp_clause[num_inputs] = 0             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_t_9 = __pyx_v_num_inputs;
+  *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_tmp_clause.data) + __pyx_t_9)) )) = 0;
+
+  /* "sat_toolkit/formula.pyx":412
+ * 
+ * 
+ *         for row in range(num_xors):             # <<<<<<<<<<<<<<
+ * 
+ *             for col in range(num_inputs):
+ */
+  __pyx_t_9 = __pyx_v_num_xors;
+  __pyx_t_10 = __pyx_t_9;
+  for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
+    __pyx_v_row = __pyx_t_11;
+
+    /* "sat_toolkit/formula.pyx":414
+ *         for row in range(num_xors):
+ * 
+ *             for col in range(num_inputs):             # <<<<<<<<<<<<<<
+ *                 if packed_args[row, col] <= 0:
+ *                     raise ValueError("create_xor only supports positive indexes")
+ */
+    __pyx_t_12 = __pyx_v_num_inputs;
+    __pyx_t_13 = __pyx_t_12;
+    for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
+      __pyx_v_col = __pyx_t_14;
+
+      /* "sat_toolkit/formula.pyx":415
+ * 
+ *             for col in range(num_inputs):
+ *                 if packed_args[row, col] <= 0:             # <<<<<<<<<<<<<<
+ *                     raise ValueError("create_xor only supports positive indexes")
+ * 
+ */
+      __pyx_t_15 = __pyx_v_row;
+      __pyx_t_16 = __pyx_v_col;
+      __pyx_t_17 = (((*((int const  *) ( /* dim=1 */ ((char *) (((int const  *) ( /* dim=0 */ (__pyx_v_packed_args.data + __pyx_t_15 * __pyx_v_packed_args.strides[0]) )) + __pyx_t_16)) ))) <= 0) != 0);
+      if (unlikely(__pyx_t_17)) {
+
+        /* "sat_toolkit/formula.pyx":416
+ *             for col in range(num_inputs):
+ *                 if packed_args[row, col] <= 0:
+ *                     raise ValueError("create_xor only supports positive indexes")             # <<<<<<<<<<<<<<
+ * 
+ *             rhs = packed_args[row, num_inputs]
+ */
+        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 416, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_1);
+        __Pyx_Raise(__pyx_t_1, 0, 0, 0);
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        __PYX_ERR(0, 416, __pyx_L1_error)
+
+        /* "sat_toolkit/formula.pyx":415
+ * 
+ *             for col in range(num_inputs):
+ *                 if packed_args[row, col] <= 0:             # <<<<<<<<<<<<<<
+ *                     raise ValueError("create_xor only supports positive indexes")
+ * 
+ */
+      }
+    }
+
+    /* "sat_toolkit/formula.pyx":418
+ *                     raise ValueError("create_xor only supports positive indexes")
+ * 
+ *             rhs = packed_args[row, num_inputs]             # <<<<<<<<<<<<<<
+ *             if rhs not in [0, 1]:
+ *                 raise ValueError(f"right hand side must be 0 or 1, not {rhs}")
+ */
+    __pyx_t_12 = __pyx_v_row;
+    __pyx_t_13 = __pyx_v_num_inputs;
+    __pyx_v_rhs = (*((int const  *) ( /* dim=1 */ ((char *) (((int const  *) ( /* dim=0 */ (__pyx_v_packed_args.data + __pyx_t_12 * __pyx_v_packed_args.strides[0]) )) + __pyx_t_13)) )));
+
+    /* "sat_toolkit/formula.pyx":419
+ * 
+ *             rhs = packed_args[row, num_inputs]
+ *             if rhs not in [0, 1]:             # <<<<<<<<<<<<<<
+ *                 raise ValueError(f"right hand side must be 0 or 1, not {rhs}")
+ * 
+ */
+    switch (__pyx_v_rhs) {
+      case 0:
+      case 1:
+      __pyx_t_17 = 0;
+      break;
+      default:
+      __pyx_t_17 = 1;
+      break;
+    }
+    __pyx_t_18 = (__pyx_t_17 != 0);
+    if (unlikely(__pyx_t_18)) {
+
+      /* "sat_toolkit/formula.pyx":420
+ *             rhs = packed_args[row, num_inputs]
+ *             if rhs not in [0, 1]:
+ *                 raise ValueError(f"right hand side must be 0 or 1, not {rhs}")             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+      __pyx_t_1 = __Pyx_PyUnicode_From_int(__pyx_v_rhs, 0, ' ', 'd'); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_t_3 = __Pyx_PyUnicode_Concat(__pyx_kp_u_right_hand_side_must_be_0_or_1_n, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 420, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __PYX_ERR(0, 420, __pyx_L1_error)
+
+      /* "sat_toolkit/formula.pyx":419
+ * 
+ *             rhs = packed_args[row, num_inputs]
+ *             if rhs not in [0, 1]:             # <<<<<<<<<<<<<<
+ *                 raise ValueError(f"right hand side must be 0 or 1, not {rhs}")
+ * 
+ */
+    }
+
+    /* "sat_toolkit/formula.pyx":423
+ * 
+ * 
+ *             for mask in range(1 << num_inputs):             # <<<<<<<<<<<<<<
+ *                 if popcount(mask) % 2 == rhs:
+ *                     continue
+ */
+    __pyx_t_13 = (1 << __pyx_v_num_inputs);
+    __pyx_t_12 = __pyx_t_13;
+    for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_12; __pyx_t_14+=1) {
+      __pyx_v_mask = __pyx_t_14;
+
+      /* "sat_toolkit/formula.pyx":424
+ * 
+ *             for mask in range(1 << num_inputs):
+ *                 if popcount(mask) % 2 == rhs:             # <<<<<<<<<<<<<<
+ *                     continue
+ * 
+ */
+      __pyx_t_18 = (((popcount(__pyx_v_mask) % 2) == __pyx_v_rhs) != 0);
+      if (__pyx_t_18) {
+
+        /* "sat_toolkit/formula.pyx":425
+ *             for mask in range(1 << num_inputs):
+ *                 if popcount(mask) % 2 == rhs:
+ *                     continue             # <<<<<<<<<<<<<<
+ * 
+ *                 for col in range(num_inputs):
+ */
+        goto __pyx_L9_continue;
+
+        /* "sat_toolkit/formula.pyx":424
+ * 
+ *             for mask in range(1 << num_inputs):
+ *                 if popcount(mask) % 2 == rhs:             # <<<<<<<<<<<<<<
+ *                     continue
+ * 
+ */
+      }
+
+      /* "sat_toolkit/formula.pyx":427
+ *                     continue
+ * 
+ *                 for col in range(num_inputs):             # <<<<<<<<<<<<<<
+ *                     var_idx = packed_args[row, col]
+ *                     tmp_clause[col] = -var_idx if (mask >> col) & 1 else var_idx
+ */
+      __pyx_t_16 = __pyx_v_num_inputs;
+      __pyx_t_15 = __pyx_t_16;
+      for (__pyx_t_19 = 0; __pyx_t_19 < __pyx_t_15; __pyx_t_19+=1) {
+        __pyx_v_col = __pyx_t_19;
+
+        /* "sat_toolkit/formula.pyx":428
+ * 
+ *                 for col in range(num_inputs):
+ *                     var_idx = packed_args[row, col]             # <<<<<<<<<<<<<<
+ *                     tmp_clause[col] = -var_idx if (mask >> col) & 1 else var_idx
+ * 
+ */
+        __pyx_t_20 = __pyx_v_row;
+        __pyx_t_21 = __pyx_v_col;
+        __pyx_v_var_idx = (*((int const  *) ( /* dim=1 */ ((char *) (((int const  *) ( /* dim=0 */ (__pyx_v_packed_args.data + __pyx_t_20 * __pyx_v_packed_args.strides[0]) )) + __pyx_t_21)) )));
+
+        /* "sat_toolkit/formula.pyx":429
+ *                 for col in range(num_inputs):
+ *                     var_idx = packed_args[row, col]
+ *                     tmp_clause[col] = -var_idx if (mask >> col) & 1 else var_idx             # <<<<<<<<<<<<<<
+ * 
+ *                 res._add_clauses(tmp_clause)
+ */
+        if ((((__pyx_v_mask >> __pyx_v_col) & 1) != 0)) {
+          __pyx_t_6 = (-__pyx_v_var_idx);
+        } else {
+          __pyx_t_6 = __pyx_v_var_idx;
+        }
+        __pyx_t_21 = __pyx_v_col;
+        *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_tmp_clause.data) + __pyx_t_21)) )) = __pyx_t_6;
+      }
+
+      /* "sat_toolkit/formula.pyx":431
+ *                     tmp_clause[col] = -var_idx if (mask >> col) & 1 else var_idx
+ * 
+ *                 res._add_clauses(tmp_clause)             # <<<<<<<<<<<<<<
+ * 
+ *         return res
+ */
+      __pyx_t_6 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_v_tmp_clause); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 431, __pyx_L1_error)
+      __pyx_L9_continue:;
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":433
+ *                 res._add_clauses(tmp_clause)
+ * 
+ *         return res             # <<<<<<<<<<<<<<
+ * 
+ *     @staticmethod
+ */
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __Pyx_INCREF(((PyObject *)__pyx_v_res));
+  __pyx_r = __pyx_v_res;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":396
+ * 
+ *     @staticmethod
+ *     cdef CNF _create_xor(const int[:, ::1] packed_args):             # <<<<<<<<<<<<<<
+ *         cdef CNF res = CNF.__new__(CNF)
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_7);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF._create_xor", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_res);
+  __PYX_XDEC_MEMVIEW(&__pyx_v_tmp_clause, 1);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":436
+ * 
+ *     @staticmethod
+ *     def create_xor(*args, rhs=None) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         creates a CNF specifying the xor of the arguments is equal to the right
+ */
+
+/* Python wrapper */
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_13create_xor(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_12create_xor[] = "CNF.create_xor(*args, rhs=None) -> CNF\n\n        creates a CNF specifying the xor of the arguments is equal to the right\n        hand side (rhs).\n\n        Each argument is a 1-D array. The xors are computed elementwise.\n        ";
+static PyMethodDef __pyx_mdef_11sat_toolkit_7formula_3CNF_13create_xor = {"create_xor", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_13create_xor, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_12create_xor};
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_13create_xor(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyObject *__pyx_v_rhs = 0;
+  PyObject *__pyx_v_args = 0;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("create_xor (wrapper)", 0);
+  if (PyTuple_GET_SIZE(__pyx_args) > 0) {
+    __pyx_v_args = PyTuple_GetSlice(__pyx_args, 0, PyTuple_GET_SIZE(__pyx_args));
+    if (unlikely(!__pyx_v_args)) {
+      __Pyx_RefNannyFinishContext();
+      return NULL;
+    }
+    __Pyx_GOTREF(__pyx_v_args);
+  } else {
+    __pyx_v_args = __pyx_empty_tuple; __Pyx_INCREF(__pyx_empty_tuple);
+  }
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_rhs,0};
+    PyObject* values[1] = {0};
+    values[0] = ((PyObject *)Py_None);
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        default:
+        case  0: break;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      if (kw_args == 1) {
+        const Py_ssize_t index = 0;
+        PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
+        if (value) { values[index] = value; kw_args--; }
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, 0, "create_xor") < 0)) __PYX_ERR(0, 436, __pyx_L3_error)
+      }
+    } else if (PyTuple_GET_SIZE(__pyx_args) < 0) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+    }
+    __pyx_v_rhs = values[0];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("create_xor", 0, 0, 0, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 436, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_DECREF(__pyx_v_args); __pyx_v_args = 0;
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.create_xor", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_12create_xor(__pyx_v_rhs, __pyx_v_args);
+
+  /* function exit code */
+  __Pyx_XDECREF(__pyx_v_args);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_12create_xor(PyObject *__pyx_v_rhs, PyObject *__pyx_v_args) {
+  size_t __pyx_v_num_args;
+  size_t __pyx_v_num_xors;
+  size_t __pyx_v_i;
+  PyObject *__pyx_v_packed_args = NULL;
+  PyObject *__pyx_v_arg = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  Py_ssize_t __pyx_t_1;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  int __pyx_t_8;
+  PyObject *__pyx_t_9 = NULL;
+  size_t __pyx_t_10;
+  int __pyx_t_11;
+  __Pyx_memviewslice __pyx_t_12 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("create_xor", 0);
+
+  /* "sat_toolkit/formula.pyx":443
+ *         Each argument is a 1-D array. The xors are computed elementwise.
+ *         """
+ *         cdef size_t num_args = len(args)             # <<<<<<<<<<<<<<
+ *         cdef size_t num_xors = -1
+ *         cdef size_t i
+ */
+  __pyx_t_1 = PyTuple_GET_SIZE(__pyx_v_args); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 443, __pyx_L1_error)
+  __pyx_v_num_args = __pyx_t_1;
+
+  /* "sat_toolkit/formula.pyx":444
+ *         """
+ *         cdef size_t num_args = len(args)
+ *         cdef size_t num_xors = -1             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ * 
+ */
+  __pyx_v_num_xors = -1L;
+
+  /* "sat_toolkit/formula.pyx":448
+ * 
+ * 
+ *         if num_args < 1:             # <<<<<<<<<<<<<<
+ *             raise ValueError('must provide at least one argument')
+ * 
+ */
+  __pyx_t_2 = ((__pyx_v_num_args < 1) != 0);
+  if (unlikely(__pyx_t_2)) {
+
+    /* "sat_toolkit/formula.pyx":449
+ * 
+ *         if num_args < 1:
+ *             raise ValueError('must provide at least one argument')             # <<<<<<<<<<<<<<
+ * 
+ *         num_xors = len(args[0])
+ */
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 449, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __PYX_ERR(0, 449, __pyx_L1_error)
+
+    /* "sat_toolkit/formula.pyx":448
+ * 
+ * 
+ *         if num_args < 1:             # <<<<<<<<<<<<<<
+ *             raise ValueError('must provide at least one argument')
+ * 
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":451
+ *             raise ValueError('must provide at least one argument')
+ * 
+ *         num_xors = len(args[0])             # <<<<<<<<<<<<<<
+ * 
+ *         packed_args = np.zeros((num_xors, num_args + 1), np.int32)
+ */
+  __pyx_t_3 = PyTuple_GET_ITEM(__pyx_v_args, 0);
+  __Pyx_INCREF(__pyx_t_3);
+  __pyx_t_1 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 451, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_v_num_xors = __pyx_t_1;
+
+  /* "sat_toolkit/formula.pyx":453
+ *         num_xors = len(args[0])
+ * 
+ *         packed_args = np.zeros((num_xors, num_args + 1), np.int32)             # <<<<<<<<<<<<<<
+ * 
+ *         for i, arg in enumerate(args):
+ */
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 453, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 453, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_v_num_xors); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 453, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_6 = __Pyx_PyInt_FromSize_t((__pyx_v_num_args + 1)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 453, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_6);
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 453, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_GIVEREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
+  __Pyx_GIVEREF(__pyx_t_6);
+  PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
+  __pyx_t_4 = 0;
+  __pyx_t_6 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 453, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_6);
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 453, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+  __pyx_t_6 = NULL;
+  __pyx_t_8 = 0;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
+    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
+    if (likely(__pyx_t_6)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
+      __Pyx_INCREF(__pyx_t_6);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_5, function);
+      __pyx_t_8 = 1;
+    }
+  }
+  #if CYTHON_FAST_PYCALL
+  if (PyFunction_Check(__pyx_t_5)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_7, __pyx_t_4};
+    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  } else
+  #endif
+  #if CYTHON_FAST_PYCCALL
+  if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_7, __pyx_t_4};
+    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  } else
+  #endif
+  {
+    __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_9);
+    if (__pyx_t_6) {
+      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6); __pyx_t_6 = NULL;
+    }
+    __Pyx_GIVEREF(__pyx_t_7);
+    PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_t_7);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_4);
+    __pyx_t_7 = 0;
+    __pyx_t_4 = 0;
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_v_packed_args = __pyx_t_3;
+  __pyx_t_3 = 0;
+
+  /* "sat_toolkit/formula.pyx":455
+ *         packed_args = np.zeros((num_xors, num_args + 1), np.int32)
+ * 
+ *         for i, arg in enumerate(args):             # <<<<<<<<<<<<<<
+ *             packed_args[:, i] = arg
+ * 
+ */
+  __pyx_t_10 = 0;
+  __pyx_t_3 = __pyx_v_args; __Pyx_INCREF(__pyx_t_3); __pyx_t_1 = 0;
+  for (;;) {
+    if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
+    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_5); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 455, __pyx_L1_error)
+    #else
+    __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 455, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    #endif
+    __Pyx_XDECREF_SET(__pyx_v_arg, __pyx_t_5);
+    __pyx_t_5 = 0;
+    __pyx_v_i = __pyx_t_10;
+    __pyx_t_10 = (__pyx_t_10 + 1);
+
+    /* "sat_toolkit/formula.pyx":456
+ * 
+ *         for i, arg in enumerate(args):
+ *             packed_args[:, i] = arg             # <<<<<<<<<<<<<<
+ * 
+ *         if rhs is not None:
+ */
+    __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 456, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 456, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_9);
+    __Pyx_INCREF(__pyx_slice__12);
+    __Pyx_GIVEREF(__pyx_slice__12);
+    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_slice__12);
+    __Pyx_GIVEREF(__pyx_t_5);
+    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_5);
+    __pyx_t_5 = 0;
+    if (unlikely(PyObject_SetItem(__pyx_v_packed_args, __pyx_t_9, __pyx_v_arg) < 0)) __PYX_ERR(0, 456, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+
+    /* "sat_toolkit/formula.pyx":455
+ *         packed_args = np.zeros((num_xors, num_args + 1), np.int32)
+ * 
+ *         for i, arg in enumerate(args):             # <<<<<<<<<<<<<<
+ *             packed_args[:, i] = arg
+ * 
+ */
+  }
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "sat_toolkit/formula.pyx":458
+ *             packed_args[:, i] = arg
+ * 
+ *         if rhs is not None:             # <<<<<<<<<<<<<<
+ *             packed_args[:, num_args] = rhs
+ * 
+ */
+  __pyx_t_2 = (__pyx_v_rhs != Py_None);
+  __pyx_t_11 = (__pyx_t_2 != 0);
+  if (__pyx_t_11) {
+
+    /* "sat_toolkit/formula.pyx":459
+ * 
+ *         if rhs is not None:
+ *             packed_args[:, num_args] = rhs             # <<<<<<<<<<<<<<
+ * 
+ *         return CNF._create_xor(packed_args)
+ */
+    __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_num_args); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 459, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 459, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_9);
+    __Pyx_INCREF(__pyx_slice__12);
+    __Pyx_GIVEREF(__pyx_slice__12);
+    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_slice__12);
+    __Pyx_GIVEREF(__pyx_t_3);
+    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_3);
+    __pyx_t_3 = 0;
+    if (unlikely(PyObject_SetItem(__pyx_v_packed_args, __pyx_t_9, __pyx_v_rhs) < 0)) __PYX_ERR(0, 459, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+
+    /* "sat_toolkit/formula.pyx":458
+ *             packed_args[:, i] = arg
+ * 
+ *         if rhs is not None:             # <<<<<<<<<<<<<<
+ *             packed_args[:, num_args] = rhs
+ * 
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":461
+ *             packed_args[:, num_args] = rhs
+ * 
+ *         return CNF._create_xor(packed_args)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_int__const__(__pyx_v_packed_args, 0); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_9 = ((PyObject *)__pyx_f_11sat_toolkit_7formula_3CNF__create_xor(__pyx_t_12)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_9);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
+  __pyx_t_12.memview = NULL;
+  __pyx_t_12.data = NULL;
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_9);
+  __pyx_t_9 = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":436
+ * 
+ *     @staticmethod
+ *     def create_xor(*args, rhs=None) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         creates a CNF specifying the xor of the arguments is equal to the right
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_9);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.create_xor", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_packed_args);
+  __Pyx_XDECREF(__pyx_v_arg);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":466
+ * 
+ * 
+ *     cdef int _add_clauses(self, const int[:] clauses) nogil except -1:             # <<<<<<<<<<<<<<
  *         cdef size_t l, old_len, i
  * 
  */
 
-static void __pyx_f_11sat_toolkit_9_cnf_util_3CNF__add_clauses(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_clauses) {
+static int __pyx_f_11sat_toolkit_7formula_3CNF__add_clauses(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_clauses) {
   size_t __pyx_v_l;
   size_t __pyx_v_old_len;
   size_t __pyx_v_i;
+  int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_t_3;
   size_t __pyx_t_4;
   size_t __pyx_t_5;
   size_t __pyx_t_6;
   size_t __pyx_t_7;
-  int __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
   __Pyx_RefNannySetupContext("_add_clauses", 0);
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
 
-  /* "sat_toolkit/_cnf_util.pyx":244
+  /* "sat_toolkit/formula.pyx":467
+ * 
+ *     cdef int _add_clauses(self, const int[:] clauses) nogil except -1:
+ *         cdef size_t l, old_len, i             # <<<<<<<<<<<<<<
+ * 
+ *         if self.view_count > 0:
+ */
+  /*try:*/ {
+
+    /* "sat_toolkit/formula.pyx":469
  *         cdef size_t l, old_len, i
  * 
  *         if self.view_count > 0:             # <<<<<<<<<<<<<<
  *             raise ValueError('cannot alter while referenced by buffer')
  * 
  */
-  __pyx_t_1 = ((__pyx_v_self->view_count > 0) != 0);
-  if (unlikely(__pyx_t_1)) {
+    __pyx_t_1 = ((__pyx_v_self->view_count > 0) != 0);
+    if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":245
+      /* "sat_toolkit/formula.pyx":470
  * 
  *         if self.view_count > 0:
  *             raise ValueError('cannot alter while referenced by buffer')             # <<<<<<<<<<<<<<
  * 
  *         l = clauses.shape[0]
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 245, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 245, __pyx_L1_error)
+      {
+          #ifdef WITH_THREAD
+          PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+          #endif
+          /*try:*/ {
+            __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__13, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 470, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_2);
+            __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+            __PYX_ERR(0, 470, __pyx_L8_error)
+          }
+          /*finally:*/ {
+            __pyx_L8_error: {
+              #ifdef WITH_THREAD
+              __Pyx_PyGILState_Release(__pyx_gilstate_save);
+              #endif
+              goto __pyx_L4_error;
+            }
+          }
+      }
 
-    /* "sat_toolkit/_cnf_util.pyx":244
+      /* "sat_toolkit/formula.pyx":469
  *         cdef size_t l, old_len, i
  * 
  *         if self.view_count > 0:             # <<<<<<<<<<<<<<
  *             raise ValueError('cannot alter while referenced by buffer')
  * 
  */
-  }
+    }
 
-  /* "sat_toolkit/_cnf_util.pyx":247
+    /* "sat_toolkit/formula.pyx":472
  *             raise ValueError('cannot alter while referenced by buffer')
  * 
  *         l = clauses.shape[0]             # <<<<<<<<<<<<<<
  *         if l > 0 and clauses[l - 1] != 0:
  *             raise ValueError('last clause not terminated with 0')
  */
-  __pyx_v_l = (__pyx_v_clauses.shape[0]);
+    __pyx_v_l = (__pyx_v_clauses.shape[0]);
 
-  /* "sat_toolkit/_cnf_util.pyx":248
+    /* "sat_toolkit/formula.pyx":473
  * 
  *         l = clauses.shape[0]
  *         if l > 0 and clauses[l - 1] != 0:             # <<<<<<<<<<<<<<
  *             raise ValueError('last clause not terminated with 0')
  * 
  */
-  __pyx_t_3 = ((__pyx_v_l > 0) != 0);
-  if (__pyx_t_3) {
-  } else {
+    __pyx_t_3 = ((__pyx_v_l > 0) != 0);
+    if (__pyx_t_3) {
+    } else {
+      __pyx_t_1 = __pyx_t_3;
+      goto __pyx_L11_bool_binop_done;
+    }
+    __pyx_t_4 = (__pyx_v_l - 1);
+    __pyx_t_3 = (((*((int const  *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_4 * __pyx_v_clauses.strides[0]) ))) != 0) != 0);
     __pyx_t_1 = __pyx_t_3;
-    goto __pyx_L5_bool_binop_done;
-  }
-  __pyx_t_4 = (__pyx_v_l - 1);
-  __pyx_t_3 = (((*((int *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_4 * __pyx_v_clauses.strides[0]) ))) != 0) != 0);
-  __pyx_t_1 = __pyx_t_3;
-  __pyx_L5_bool_binop_done:;
-  if (unlikely(__pyx_t_1)) {
+    __pyx_L11_bool_binop_done:;
+    if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":249
+      /* "sat_toolkit/formula.pyx":474
  *         l = clauses.shape[0]
  *         if l > 0 and clauses[l - 1] != 0:
  *             raise ValueError('last clause not terminated with 0')             # <<<<<<<<<<<<<<
  * 
  *         old_len = self.clauses.size()
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 249, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 249, __pyx_L1_error)
+      {
+          #ifdef WITH_THREAD
+          PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+          #endif
+          /*try:*/ {
+            __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__14, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 474, __pyx_L14_error)
+            __Pyx_GOTREF(__pyx_t_2);
+            __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+            __PYX_ERR(0, 474, __pyx_L14_error)
+          }
+          /*finally:*/ {
+            __pyx_L14_error: {
+              #ifdef WITH_THREAD
+              __Pyx_PyGILState_Release(__pyx_gilstate_save);
+              #endif
+              goto __pyx_L4_error;
+            }
+          }
+      }
 
-    /* "sat_toolkit/_cnf_util.pyx":248
+      /* "sat_toolkit/formula.pyx":473
  * 
  *         l = clauses.shape[0]
  *         if l > 0 and clauses[l - 1] != 0:             # <<<<<<<<<<<<<<
  *             raise ValueError('last clause not terminated with 0')
  * 
  */
-  }
+    }
 
-  /* "sat_toolkit/_cnf_util.pyx":251
+    /* "sat_toolkit/formula.pyx":476
  *             raise ValueError('last clause not terminated with 0')
  * 
  *         old_len = self.clauses.size()             # <<<<<<<<<<<<<<
  *         self.clauses.resize(self.clauses.size() + l)
  * 
  */
-  __pyx_v_old_len = __pyx_v_self->clauses.size();
+    __pyx_v_old_len = __pyx_v_self->clauses.size();
 
-  /* "sat_toolkit/_cnf_util.pyx":252
+    /* "sat_toolkit/formula.pyx":477
  * 
  *         old_len = self.clauses.size()
  *         self.clauses.resize(self.clauses.size() + l)             # <<<<<<<<<<<<<<
  * 
  *         if l > 0:
  */
-  try {
-    __pyx_v_self->clauses.resize((__pyx_v_self->clauses.size() + __pyx_v_l));
-  } catch(...) {
-    __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 252, __pyx_L1_error)
-  }
+    try {
+      __pyx_v_self->clauses.resize((__pyx_v_self->clauses.size() + __pyx_v_l));
+    } catch(...) {
+      #ifdef WITH_THREAD
+      PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+      #endif
+      __Pyx_CppExn2PyErr();
+      #ifdef WITH_THREAD
+      __Pyx_PyGILState_Release(__pyx_gilstate_save);
+      #endif
+      __PYX_ERR(0, 477, __pyx_L4_error)
+    }
 
-  /* "sat_toolkit/_cnf_util.pyx":254
+    /* "sat_toolkit/formula.pyx":479
  *         self.clauses.resize(self.clauses.size() + l)
  * 
  *         if l > 0:             # <<<<<<<<<<<<<<
  *             self.start_indices.push_back(old_len)
  * 
  */
-  __pyx_t_1 = ((__pyx_v_l > 0) != 0);
-  if (__pyx_t_1) {
+    __pyx_t_1 = ((__pyx_v_l > 0) != 0);
+    if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":255
+      /* "sat_toolkit/formula.pyx":480
  * 
  *         if l > 0:
  *             self.start_indices.push_back(old_len)             # <<<<<<<<<<<<<<
  * 
  *         for i in range(l):
  */
-    try {
-      __pyx_v_self->start_indices.push_back(__pyx_v_old_len);
-    } catch(...) {
-      __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 255, __pyx_L1_error)
-    }
+      try {
+        __pyx_v_self->start_indices.push_back(__pyx_v_old_len);
+      } catch(...) {
+        #ifdef WITH_THREAD
+        PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+        #endif
+        __Pyx_CppExn2PyErr();
+        #ifdef WITH_THREAD
+        __Pyx_PyGILState_Release(__pyx_gilstate_save);
+        #endif
+        __PYX_ERR(0, 480, __pyx_L4_error)
+      }
 
-    /* "sat_toolkit/_cnf_util.pyx":254
+      /* "sat_toolkit/formula.pyx":479
  *         self.clauses.resize(self.clauses.size() + l)
  * 
  *         if l > 0:             # <<<<<<<<<<<<<<
  *             self.start_indices.push_back(old_len)
  * 
  */
-  }
+    }
 
-  /* "sat_toolkit/_cnf_util.pyx":257
+    /* "sat_toolkit/formula.pyx":482
  *             self.start_indices.push_back(old_len)
  * 
  *         for i in range(l):             # <<<<<<<<<<<<<<
  *             self.clauses[old_len + i] = clauses[i]
  *             if abs(clauses[i]) > self.nvars:
  */
-  __pyx_t_4 = __pyx_v_l;
-  __pyx_t_5 = __pyx_t_4;
-  for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
-    __pyx_v_i = __pyx_t_6;
+    __pyx_t_4 = __pyx_v_l;
+    __pyx_t_5 = __pyx_t_4;
+    for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
+      __pyx_v_i = __pyx_t_6;
 
-    /* "sat_toolkit/_cnf_util.pyx":258
+      /* "sat_toolkit/formula.pyx":483
  * 
  *         for i in range(l):
  *             self.clauses[old_len + i] = clauses[i]             # <<<<<<<<<<<<<<
  *             if abs(clauses[i]) > self.nvars:
  *                 self.nvars = abs(clauses[i])
  */
-    __pyx_t_7 = __pyx_v_i;
-    (__pyx_v_self->clauses[(__pyx_v_old_len + __pyx_v_i)]) = (*((int *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_7 * __pyx_v_clauses.strides[0]) )));
+      __pyx_t_7 = __pyx_v_i;
+      (__pyx_v_self->clauses[(__pyx_v_old_len + __pyx_v_i)]) = (*((int const  *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_7 * __pyx_v_clauses.strides[0]) )));
 
-    /* "sat_toolkit/_cnf_util.pyx":259
+      /* "sat_toolkit/formula.pyx":484
  *         for i in range(l):
  *             self.clauses[old_len + i] = clauses[i]
  *             if abs(clauses[i]) > self.nvars:             # <<<<<<<<<<<<<<
  *                 self.nvars = abs(clauses[i])
  * 
  */
-    __pyx_t_7 = __pyx_v_i;
-    __pyx_t_8 = abs((*((int *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_7 * __pyx_v_clauses.strides[0]) )))); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
-    __pyx_t_1 = ((__pyx_t_8 > __pyx_v_self->nvars) != 0);
-    if (__pyx_t_1) {
+      __pyx_t_7 = __pyx_v_i;
+      __pyx_t_1 = ((__pyx_f_11sat_toolkit_7formula_abs((*((int const  *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_7 * __pyx_v_clauses.strides[0]) )))) > __pyx_v_self->nvars) != 0);
+      if (__pyx_t_1) {
 
-      /* "sat_toolkit/_cnf_util.pyx":260
+        /* "sat_toolkit/formula.pyx":485
  *             self.clauses[old_len + i] = clauses[i]
  *             if abs(clauses[i]) > self.nvars:
  *                 self.nvars = abs(clauses[i])             # <<<<<<<<<<<<<<
  * 
  *             if clauses[i] == 0 and i + 1 < l:
  */
-      __pyx_t_7 = __pyx_v_i;
-      __pyx_t_8 = abs((*((int *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_7 * __pyx_v_clauses.strides[0]) )))); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 260, __pyx_L1_error)
-      __pyx_v_self->nvars = __pyx_t_8;
+        __pyx_t_7 = __pyx_v_i;
+        __pyx_v_self->nvars = __pyx_f_11sat_toolkit_7formula_abs((*((int const  *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_7 * __pyx_v_clauses.strides[0]) ))));
 
-      /* "sat_toolkit/_cnf_util.pyx":259
+        /* "sat_toolkit/formula.pyx":484
  *         for i in range(l):
  *             self.clauses[old_len + i] = clauses[i]
  *             if abs(clauses[i]) > self.nvars:             # <<<<<<<<<<<<<<
  *                 self.nvars = abs(clauses[i])
  * 
  */
-    }
+      }
 
-    /* "sat_toolkit/_cnf_util.pyx":262
+      /* "sat_toolkit/formula.pyx":487
  *                 self.nvars = abs(clauses[i])
  * 
  *             if clauses[i] == 0 and i + 1 < l:             # <<<<<<<<<<<<<<
  *                 self.start_indices.push_back(old_len + i + 1)
  * 
  */
-    __pyx_t_7 = __pyx_v_i;
-    __pyx_t_3 = (((*((int *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_7 * __pyx_v_clauses.strides[0]) ))) == 0) != 0);
-    if (__pyx_t_3) {
-    } else {
+      __pyx_t_7 = __pyx_v_i;
+      __pyx_t_3 = (((*((int const  *) ( /* dim=0 */ (__pyx_v_clauses.data + __pyx_t_7 * __pyx_v_clauses.strides[0]) ))) == 0) != 0);
+      if (__pyx_t_3) {
+      } else {
+        __pyx_t_1 = __pyx_t_3;
+        goto __pyx_L21_bool_binop_done;
+      }
+      __pyx_t_3 = (((__pyx_v_i + 1) < __pyx_v_l) != 0);
       __pyx_t_1 = __pyx_t_3;
-      goto __pyx_L12_bool_binop_done;
-    }
-    __pyx_t_3 = (((__pyx_v_i + 1) < __pyx_v_l) != 0);
-    __pyx_t_1 = __pyx_t_3;
-    __pyx_L12_bool_binop_done:;
-    if (__pyx_t_1) {
+      __pyx_L21_bool_binop_done:;
+      if (__pyx_t_1) {
 
-      /* "sat_toolkit/_cnf_util.pyx":263
+        /* "sat_toolkit/formula.pyx":488
  * 
  *             if clauses[i] == 0 and i + 1 < l:
  *                 self.start_indices.push_back(old_len + i + 1)             # <<<<<<<<<<<<<<
  * 
- *     def add_clauses(self, clauses) -> None:
+ *         return 0
  */
-      try {
-        __pyx_v_self->start_indices.push_back(((__pyx_v_old_len + __pyx_v_i) + 1));
-      } catch(...) {
-        __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 263, __pyx_L1_error)
-      }
+        try {
+          __pyx_v_self->start_indices.push_back(((__pyx_v_old_len + __pyx_v_i) + 1));
+        } catch(...) {
+          #ifdef WITH_THREAD
+          PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+          #endif
+          __Pyx_CppExn2PyErr();
+          #ifdef WITH_THREAD
+          __Pyx_PyGILState_Release(__pyx_gilstate_save);
+          #endif
+          __PYX_ERR(0, 488, __pyx_L4_error)
+        }
 
-      /* "sat_toolkit/_cnf_util.pyx":262
+        /* "sat_toolkit/formula.pyx":487
  *                 self.nvars = abs(clauses[i])
  * 
  *             if clauses[i] == 0 and i + 1 < l:             # <<<<<<<<<<<<<<
  *                 self.start_indices.push_back(old_len + i + 1)
  * 
  */
+      }
+    }
+
+    /* "sat_toolkit/formula.pyx":490
+ *                 self.start_indices.push_back(old_len + i + 1)
+ * 
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     def add_clauses(self, clauses) -> None:
+ */
+    __pyx_r = 0;
+    goto __pyx_L3_return;
+  }
+
+  /* "sat_toolkit/formula.pyx":467
+ * 
+ *     cdef int _add_clauses(self, const int[:] clauses) nogil except -1:
+ *         cdef size_t l, old_len, i             # <<<<<<<<<<<<<<
+ * 
+ *         if self.view_count > 0:
+ */
+  /*finally:*/ {
+    __pyx_L3_return: {
+      #ifdef WITH_THREAD
+      __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+      #endif
+      goto __pyx_L0;
+    }
+    __pyx_L4_error: {
+      #ifdef WITH_THREAD
+      __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+      #endif
+      goto __pyx_L1_error;
     }
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":241
+  /* "sat_toolkit/formula.pyx":466
  * 
  * 
- *     cdef void _add_clauses(self, int[:] clauses):             # <<<<<<<<<<<<<<
+ *     cdef int _add_clauses(self, const int[:] clauses) nogil except -1:             # <<<<<<<<<<<<<<
  *         cdef size_t l, old_len, i
  * 
  */
 
   /* function exit code */
+  __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_WriteUnraisable("sat_toolkit._cnf_util.CNF._add_clauses", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF._add_clauses", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
   __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":265
- *                 self.start_indices.push_back(old_len + i + 1)
+/* "sat_toolkit/formula.pyx":492
+ *         return 0
  * 
  *     def add_clauses(self, clauses) -> None:             # <<<<<<<<<<<<<<
- *         np_clauses = np.array(clauses, dtype=np.int32)
- *         self._add_clauses(np_clauses)
+ *         cdef const int[:] clauses_view = None
+ * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_9add_clauses(PyObject *__pyx_v_self, PyObject *__pyx_v_clauses); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_8add_clauses[] = "CNF.add_clauses(self, clauses) -> None";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_9add_clauses(PyObject *__pyx_v_self, PyObject *__pyx_v_clauses) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_15add_clauses(PyObject *__pyx_v_self, PyObject *__pyx_v_clauses); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_14add_clauses[] = "CNF.add_clauses(self, clauses) -> None";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_15add_clauses(PyObject *__pyx_v_self, PyObject *__pyx_v_clauses) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("add_clauses (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_8add_clauses(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_clauses));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_14add_clauses(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_clauses));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_8add_clauses(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_clauses) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_14add_clauses(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_clauses) {
+  __Pyx_memviewslice __pyx_v_clauses_view = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_v_np_clauses = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  __Pyx_memviewslice __pyx_t_1 = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  __Pyx_memviewslice __pyx_t_6 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_10 = NULL;
+  PyObject *__pyx_t_11 = NULL;
+  PyObject *__pyx_t_12 = NULL;
+  PyObject *__pyx_t_13 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_clauses", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":266
+  /* "sat_toolkit/formula.pyx":493
  * 
  *     def add_clauses(self, clauses) -> None:
- *         np_clauses = np.array(clauses, dtype=np.int32)             # <<<<<<<<<<<<<<
- *         self._add_clauses(np_clauses)
+ *         cdef const int[:] clauses_view = None             # <<<<<<<<<<<<<<
  * 
+ *         try:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(__pyx_v_clauses);
-  __Pyx_GIVEREF(__pyx_v_clauses);
-  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_clauses);
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_v_np_clauses = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(Py_None, 0); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_v_clauses_view = __pyx_t_1;
+  __pyx_t_1.memview = NULL;
+  __pyx_t_1.data = NULL;
 
-  /* "sat_toolkit/_cnf_util.pyx":267
- *     def add_clauses(self, clauses) -> None:
- *         np_clauses = np.array(clauses, dtype=np.int32)
- *         self._add_clauses(np_clauses)             # <<<<<<<<<<<<<<
+  /* "sat_toolkit/formula.pyx":495
+ *         cdef const int[:] clauses_view = None
+ * 
+ *         try:             # <<<<<<<<<<<<<<
+ *             clauses_view = clauses
+ *         except (TypeError, ValueError):
+ */
+  {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    __Pyx_ExceptionSave(&__pyx_t_2, &__pyx_t_3, &__pyx_t_4);
+    __Pyx_XGOTREF(__pyx_t_2);
+    __Pyx_XGOTREF(__pyx_t_3);
+    __Pyx_XGOTREF(__pyx_t_4);
+    /*try:*/ {
+
+      /* "sat_toolkit/formula.pyx":496
+ * 
+ *         try:
+ *             clauses_view = clauses             # <<<<<<<<<<<<<<
+ *         except (TypeError, ValueError):
+ *             np_clauses = np.array(clauses, copy=False, dtype=np.int32)
+ */
+      __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_clauses, 0); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 496, __pyx_L3_error)
+      __PYX_XDEC_MEMVIEW(&__pyx_v_clauses_view, 1);
+      __pyx_v_clauses_view = __pyx_t_1;
+      __pyx_t_1.memview = NULL;
+      __pyx_t_1.data = NULL;
+
+      /* "sat_toolkit/formula.pyx":495
+ *         cdef const int[:] clauses_view = None
+ * 
+ *         try:             # <<<<<<<<<<<<<<
+ *             clauses_view = clauses
+ *         except (TypeError, ValueError):
+ */
+    }
+    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    goto __pyx_L8_try_end;
+    __pyx_L3_error:;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
+
+    /* "sat_toolkit/formula.pyx":497
+ *         try:
+ *             clauses_view = clauses
+ *         except (TypeError, ValueError):             # <<<<<<<<<<<<<<
+ *             np_clauses = np.array(clauses, copy=False, dtype=np.int32)
+ *             clauses_view = np_clauses
+ */
+    __pyx_t_5 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_TypeError) || __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ValueError);
+    if (__pyx_t_5) {
+      __Pyx_AddTraceback("sat_toolkit.formula.CNF.add_clauses", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8) < 0) __PYX_ERR(0, 497, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __Pyx_GOTREF(__pyx_t_7);
+      __Pyx_GOTREF(__pyx_t_8);
+
+      /* "sat_toolkit/formula.pyx":498
+ *             clauses_view = clauses
+ *         except (TypeError, ValueError):
+ *             np_clauses = np.array(clauses, copy=False, dtype=np.int32)             # <<<<<<<<<<<<<<
+ *             clauses_view = np_clauses
+ * 
+ */
+      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_9);
+      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+      __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_9);
+      __Pyx_INCREF(__pyx_v_clauses);
+      __Pyx_GIVEREF(__pyx_v_clauses);
+      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_clauses);
+      __pyx_t_11 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_11);
+      if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_copy, Py_False) < 0) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_12);
+      __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_int32); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_13);
+      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+      if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_dtype, __pyx_t_13) < 0) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_9, __pyx_t_11); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 498, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_13);
+      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
+      __pyx_v_np_clauses = __pyx_t_13;
+      __pyx_t_13 = 0;
+
+      /* "sat_toolkit/formula.pyx":499
+ *         except (TypeError, ValueError):
+ *             np_clauses = np.array(clauses, copy=False, dtype=np.int32)
+ *             clauses_view = np_clauses             # <<<<<<<<<<<<<<
+ * 
+ *         self._add_clauses(clauses_view)
+ */
+      __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_np_clauses, 0); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 499, __pyx_L5_except_error)
+      __PYX_XDEC_MEMVIEW(&__pyx_v_clauses_view, 1);
+      __pyx_v_clauses_view = __pyx_t_1;
+      __pyx_t_1.memview = NULL;
+      __pyx_t_1.data = NULL;
+      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+      goto __pyx_L4_exception_handled;
+    }
+    goto __pyx_L5_except_error;
+    __pyx_L5_except_error:;
+
+    /* "sat_toolkit/formula.pyx":495
+ *         cdef const int[:] clauses_view = None
+ * 
+ *         try:             # <<<<<<<<<<<<<<
+ *             clauses_view = clauses
+ *         except (TypeError, ValueError):
+ */
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_XGIVEREF(__pyx_t_4);
+    __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_3, __pyx_t_4);
+    goto __pyx_L1_error;
+    __pyx_L4_exception_handled:;
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_XGIVEREF(__pyx_t_4);
+    __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_3, __pyx_t_4);
+    __pyx_L8_try_end:;
+  }
+
+  /* "sat_toolkit/formula.pyx":501
+ *             clauses_view = np_clauses
+ * 
+ *         self._add_clauses(clauses_view)             # <<<<<<<<<<<<<<
  * 
  *     def add_clause(self, clause) -> None:
  */
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_np_clauses, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 267, __pyx_L1_error)
-  ((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self->__pyx_vtab)->_add_clauses(__pyx_v_self, __pyx_t_6);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
-  __pyx_t_6.memview = NULL;
-  __pyx_t_6.data = NULL;
+  __pyx_t_5 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_add_clauses(__pyx_v_self, __pyx_v_clauses_view); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 501, __pyx_L1_error)
 
-  /* "sat_toolkit/_cnf_util.pyx":265
- *                 self.start_indices.push_back(old_len + i + 1)
+  /* "sat_toolkit/formula.pyx":492
+ *         return 0
  * 
  *     def add_clauses(self, clauses) -> None:             # <<<<<<<<<<<<<<
- *         np_clauses = np.array(clauses, dtype=np.int32)
- *         self._add_clauses(np_clauses)
+ *         cdef const int[:] clauses_view = None
+ * 
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.add_clauses", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(__pyx_t_9);
+  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_11);
+  __Pyx_XDECREF(__pyx_t_12);
+  __Pyx_XDECREF(__pyx_t_13);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.add_clauses", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
+  __PYX_XDEC_MEMVIEW(&__pyx_v_clauses_view, 1);
   __Pyx_XDECREF(__pyx_v_np_clauses);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":269
- *         self._add_clauses(np_clauses)
+/* "sat_toolkit/formula.pyx":503
+ *         self._add_clauses(clauses_view)
  * 
  *     def add_clause(self, clause) -> None:             # <<<<<<<<<<<<<<
- *         "add a single clause to CNF formula"
+ *         """Add a single clause to CNF formula. Specify the clause without trailing 0."""
  *         cdef ssize_t clause_len = len(clause)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_11add_clause(PyObject *__pyx_v_self, PyObject *__pyx_v_clause); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_10add_clause[] = "CNF.add_clause(self, clause) -> None\nadd a single clause to CNF formula";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_11add_clause(PyObject *__pyx_v_self, PyObject *__pyx_v_clause) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_17add_clause(PyObject *__pyx_v_self, PyObject *__pyx_v_clause); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_16add_clause[] = "CNF.add_clause(self, clause) -> None\nAdd a single clause to CNF formula. Specify the clause without trailing 0.";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_17add_clause(PyObject *__pyx_v_self, PyObject *__pyx_v_clause) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("add_clause (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_10add_clause(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_clause));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_16add_clause(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_clause));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_10add_clause(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_clause) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_16add_clause(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_clause) {
   Py_ssize_t __pyx_v_clause_len;
   PyObject *__pyx_v_np_clause = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   Py_ssize_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_t_7;
   __Pyx_memviewslice __pyx_t_8 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_clause", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":271
+  /* "sat_toolkit/formula.pyx":505
  *     def add_clause(self, clause) -> None:
- *         "add a single clause to CNF formula"
+ *         """Add a single clause to CNF formula. Specify the clause without trailing 0."""
  *         cdef ssize_t clause_len = len(clause)             # <<<<<<<<<<<<<<
  *         np_clause = np.zeros(clause_len + 1, dtype=np.int32)
- *         np_clause[:clause_len - 1] = clause
+ *         np_clause[:clause_len] = clause
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_clause); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_1 = PyObject_Length(__pyx_v_clause); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 505, __pyx_L1_error)
   __pyx_v_clause_len = __pyx_t_1;
 
-  /* "sat_toolkit/_cnf_util.pyx":272
- *         "add a single clause to CNF formula"
+  /* "sat_toolkit/formula.pyx":506
+ *         """Add a single clause to CNF formula. Specify the clause without trailing 0."""
  *         cdef ssize_t clause_len = len(clause)
  *         np_clause = np.zeros(clause_len + 1, dtype=np.int32)             # <<<<<<<<<<<<<<
- *         np_clause[:clause_len - 1] = clause
+ *         np_clause[:clause_len] = clause
  *         if np.count_nonzero(np_clause) != clause_len:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromSsize_t((__pyx_v_clause_len + 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __pyx_t_2 = PyInt_FromSsize_t((__pyx_v_clause_len + 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 272, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_np_clause = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":273
+  /* "sat_toolkit/formula.pyx":507
  *         cdef ssize_t clause_len = len(clause)
  *         np_clause = np.zeros(clause_len + 1, dtype=np.int32)
- *         np_clause[:clause_len - 1] = clause             # <<<<<<<<<<<<<<
+ *         np_clause[:clause_len] = clause             # <<<<<<<<<<<<<<
  *         if np.count_nonzero(np_clause) != clause_len:
  *             raise ValueError('cannot use 0 in clause')
  */
-  if (__Pyx_PyObject_SetSlice(__pyx_v_np_clause, __pyx_v_clause, 0, (__pyx_v_clause_len - 1), NULL, NULL, NULL, 0, 1, 0) < 0) __PYX_ERR(0, 273, __pyx_L1_error)
+  if (__Pyx_PyObject_SetSlice(__pyx_v_np_clause, __pyx_v_clause, 0, __pyx_v_clause_len, NULL, NULL, NULL, 0, 1, 0) < 0) __PYX_ERR(0, 507, __pyx_L1_error)
 
-  /* "sat_toolkit/_cnf_util.pyx":274
+  /* "sat_toolkit/formula.pyx":508
  *         np_clause = np.zeros(clause_len + 1, dtype=np.int32)
- *         np_clause[:clause_len - 1] = clause
+ *         np_clause[:clause_len] = clause
  *         if np.count_nonzero(np_clause) != clause_len:             # <<<<<<<<<<<<<<
  *             raise ValueError('cannot use 0 in clause')
  *         self._add_clauses(np_clause)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 274, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_count_nonzero); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 274, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_count_nonzero); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_np_clause) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_np_clause);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 274, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_clause_len); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 274, __pyx_L1_error)
+  __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_clause_len); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = PyObject_RichCompare(__pyx_t_6, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 274, __pyx_L1_error)
+  __pyx_t_2 = PyObject_RichCompare(__pyx_t_6, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 274, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (unlikely(__pyx_t_7)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":275
- *         np_clause[:clause_len - 1] = clause
+    /* "sat_toolkit/formula.pyx":509
+ *         np_clause[:clause_len] = clause
  *         if np.count_nonzero(np_clause) != clause_len:
  *             raise ValueError('cannot use 0 in clause')             # <<<<<<<<<<<<<<
  *         self._add_clauses(np_clause)
  * 
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 275, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 275, __pyx_L1_error)
+    __PYX_ERR(0, 509, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":274
+    /* "sat_toolkit/formula.pyx":508
  *         np_clause = np.zeros(clause_len + 1, dtype=np.int32)
- *         np_clause[:clause_len - 1] = clause
+ *         np_clause[:clause_len] = clause
  *         if np.count_nonzero(np_clause) != clause_len:             # <<<<<<<<<<<<<<
  *             raise ValueError('cannot use 0 in clause')
  *         self._add_clauses(np_clause)
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":276
+  /* "sat_toolkit/formula.pyx":510
  *         if np.count_nonzero(np_clause) != clause_len:
  *             raise ValueError('cannot use 0 in clause')
  *         self._add_clauses(np_clause)             # <<<<<<<<<<<<<<
  * 
  *     append = add_clause
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_np_clause, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 276, __pyx_L1_error)
-  ((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self->__pyx_vtab)->_add_clauses(__pyx_v_self, __pyx_t_8);
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_np_clause, 0); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 510, __pyx_L1_error)
+  __pyx_t_9 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_add_clauses(__pyx_v_self, __pyx_t_8); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 510, __pyx_L1_error)
   __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "sat_toolkit/_cnf_util.pyx":269
- *         self._add_clauses(np_clauses)
+  /* "sat_toolkit/formula.pyx":503
+ *         self._add_clauses(clauses_view)
  * 
  *     def add_clause(self, clause) -> None:             # <<<<<<<<<<<<<<
- *         "add a single clause to CNF formula"
+ *         """Add a single clause to CNF formula. Specify the clause without trailing 0."""
  *         cdef ssize_t clause_len = len(clause)
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
   __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.add_clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.add_clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_np_clause);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":280
+/* "sat_toolkit/formula.pyx":514
+ *     append = add_clause
+ * 
+ *     def __iadd__(self, clauses) -> CNF:             # <<<<<<<<<<<<<<
+ *         self.add_clauses(clauses)
+ *         return self
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_19__iadd__(PyObject *__pyx_v_self, PyObject *__pyx_v_clauses); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_19__iadd__(PyObject *__pyx_v_self, PyObject *__pyx_v_clauses) {
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__iadd__ (wrapper)", 0);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_18__iadd__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_clauses));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_18__iadd__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_clauses) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__iadd__", 0);
+
+  /* "sat_toolkit/formula.pyx":515
+ * 
+ *     def __iadd__(self, clauses) -> CNF:
+ *         self.add_clauses(clauses)             # <<<<<<<<<<<<<<
+ *         return self
+ * 
+ */
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_clauses); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 515, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = NULL;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
+    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
+    if (likely(__pyx_t_3)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_2, function);
+    }
+  }
+  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_clauses) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_clauses);
+  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 515, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "sat_toolkit/formula.pyx":516
+ *     def __iadd__(self, clauses) -> CNF:
+ *         self.add_clauses(clauses)
+ *         return self             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_self));
+  __pyx_r = ((PyObject *)__pyx_v_self);
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":514
  *     append = add_clause
  * 
+ *     def __iadd__(self, clauses) -> CNF:             # <<<<<<<<<<<<<<
+ *         self.add_clauses(clauses)
+ *         return self
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__iadd__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":519
+ * 
+ * 
  *     def logical_or(self, int var) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         return a new CNF corresponding to (var or self). I.e., the new CNF is
  */
 
 /* Python wrapper */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_13logical_or(PyObject *__pyx_v_self, PyObject *__pyx_arg_var); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_12logical_or[] = "CNF.logical_or(self, int var) -> CNF\n\n        return a new CNF corresponding to (var or self). I.e., the new CNF is\n        build by appending var to each clause\n        ";
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_13logical_or(PyObject *__pyx_v_self, PyObject *__pyx_arg_var) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_21logical_or(PyObject *__pyx_v_self, PyObject *__pyx_arg_var); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_20logical_or[] = "CNF.logical_or(self, int var) -> CNF\n\n        return a new CNF corresponding to (var or self). I.e., the new CNF is\n        build by appending var to each clause\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_21logical_or(PyObject *__pyx_v_self, PyObject *__pyx_arg_var) {
   int __pyx_v_var;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("logical_or (wrapper)", 0);
   assert(__pyx_arg_var); {
-    __pyx_v_var = __Pyx_PyInt_As_int(__pyx_arg_var); if (unlikely((__pyx_v_var == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 280, __pyx_L3_error)
+    __pyx_v_var = __Pyx_PyInt_As_int(__pyx_arg_var); if (unlikely((__pyx_v_var == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 519, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.logical_or", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.logical_or", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_12logical_or(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((int)__pyx_v_var));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_20logical_or(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((int)__pyx_v_var));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_12logical_or(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, int __pyx_v_var) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_20logical_or(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, int __pyx_v_var) {
   std::vector<int>  __pyx_v_new_clauses;
   Py_ssize_t __pyx_v_src;
   Py_ssize_t __pyx_v_dst;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_res = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_res = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   Py_ssize_t __pyx_t_3;
   Py_ssize_t __pyx_t_4;
   Py_ssize_t __pyx_t_5;
   int *__pyx_t_6;
   struct __pyx_array_obj *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   __Pyx_memviewslice __pyx_t_9 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_10;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("logical_or", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":285
+  /* "sat_toolkit/formula.pyx":524
  *         build by appending var to each clause
  *         """
  *         if var == 0:             # <<<<<<<<<<<<<<
  *             raise ValueError("var must not be zero")
  * 
  */
   __pyx_t_1 = ((__pyx_v_var == 0) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":286
+    /* "sat_toolkit/formula.pyx":525
  *         """
  *         if var == 0:
  *             raise ValueError("var must not be zero")             # <<<<<<<<<<<<<<
  * 
  *         cdef vector[int] new_clauses
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__12, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 525, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 286, __pyx_L1_error)
+    __PYX_ERR(0, 525, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":285
+    /* "sat_toolkit/formula.pyx":524
  *         build by appending var to each clause
  *         """
  *         if var == 0:             # <<<<<<<<<<<<<<
  *             raise ValueError("var must not be zero")
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":289
+  /* "sat_toolkit/formula.pyx":528
  * 
  *         cdef vector[int] new_clauses
  *         cdef ssize_t src = 0, dst = 0             # <<<<<<<<<<<<<<
  *         new_clauses.resize(self.clauses.size() + self.start_indices.size())
  * 
  */
   __pyx_v_src = 0;
   __pyx_v_dst = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":290
+  /* "sat_toolkit/formula.pyx":529
  *         cdef vector[int] new_clauses
  *         cdef ssize_t src = 0, dst = 0
  *         new_clauses.resize(self.clauses.size() + self.start_indices.size())             # <<<<<<<<<<<<<<
  * 
  *         for src in range(<ssize_t> self.clauses.size()):
  */
   try {
     __pyx_v_new_clauses.resize((__pyx_v_self->clauses.size() + __pyx_v_self->start_indices.size()));
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 290, __pyx_L1_error)
+    __PYX_ERR(0, 529, __pyx_L1_error)
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":292
+  /* "sat_toolkit/formula.pyx":531
  *         new_clauses.resize(self.clauses.size() + self.start_indices.size())
  * 
  *         for src in range(<ssize_t> self.clauses.size()):             # <<<<<<<<<<<<<<
  *             if self.clauses[src] == 0:
  *                 new_clauses[dst] = var
  */
   __pyx_t_3 = ((Py_ssize_t)__pyx_v_self->clauses.size());
   __pyx_t_4 = __pyx_t_3;
   for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {
     __pyx_v_src = __pyx_t_5;
 
-    /* "sat_toolkit/_cnf_util.pyx":293
+    /* "sat_toolkit/formula.pyx":532
  * 
  *         for src in range(<ssize_t> self.clauses.size()):
  *             if self.clauses[src] == 0:             # <<<<<<<<<<<<<<
  *                 new_clauses[dst] = var
  *                 dst += 1
  */
     __pyx_t_1 = (((__pyx_v_self->clauses[__pyx_v_src]) == 0) != 0);
     if (__pyx_t_1) {
 
-      /* "sat_toolkit/_cnf_util.pyx":294
+      /* "sat_toolkit/formula.pyx":533
  *         for src in range(<ssize_t> self.clauses.size()):
  *             if self.clauses[src] == 0:
  *                 new_clauses[dst] = var             # <<<<<<<<<<<<<<
  *                 dst += 1
  *             new_clauses[dst] = self.clauses[src]
  */
       (__pyx_v_new_clauses[__pyx_v_dst]) = __pyx_v_var;
 
-      /* "sat_toolkit/_cnf_util.pyx":295
+      /* "sat_toolkit/formula.pyx":534
  *             if self.clauses[src] == 0:
  *                 new_clauses[dst] = var
  *                 dst += 1             # <<<<<<<<<<<<<<
  *             new_clauses[dst] = self.clauses[src]
  *             dst += 1
  */
       __pyx_v_dst = (__pyx_v_dst + 1);
 
-      /* "sat_toolkit/_cnf_util.pyx":293
+      /* "sat_toolkit/formula.pyx":532
  * 
  *         for src in range(<ssize_t> self.clauses.size()):
  *             if self.clauses[src] == 0:             # <<<<<<<<<<<<<<
  *                 new_clauses[dst] = var
  *                 dst += 1
  */
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":296
+    /* "sat_toolkit/formula.pyx":535
  *                 new_clauses[dst] = var
  *                 dst += 1
  *             new_clauses[dst] = self.clauses[src]             # <<<<<<<<<<<<<<
  *             dst += 1
  * 
  */
     (__pyx_v_new_clauses[__pyx_v_dst]) = (__pyx_v_self->clauses[__pyx_v_src]);
 
-    /* "sat_toolkit/_cnf_util.pyx":297
+    /* "sat_toolkit/formula.pyx":536
  *                 dst += 1
  *             new_clauses[dst] = self.clauses[src]
  *             dst += 1             # <<<<<<<<<<<<<<
  * 
  *         cdef CNF res = CNF.__new__(CNF)
  */
     __pyx_v_dst = (__pyx_v_dst + 1);
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":299
+  /* "sat_toolkit/formula.pyx":538
  *             dst += 1
  * 
  *         cdef CNF res = CNF.__new__(CNF)             # <<<<<<<<<<<<<<
  *         res._add_clauses(<int[:new_clauses.size()]> new_clauses.data())
  *         return res
  */
-  __pyx_t_2 = ((PyObject *)__pyx_tp_new_11sat_toolkit_9_cnf_util_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 299, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_tp_new_11sat_toolkit_7formula_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_t_2);
+  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":300
+  /* "sat_toolkit/formula.pyx":539
  * 
  *         cdef CNF res = CNF.__new__(CNF)
  *         res._add_clauses(<int[:new_clauses.size()]> new_clauses.data())             # <<<<<<<<<<<<<<
  *         return res
  * 
  */
   __pyx_t_6 = __pyx_v_new_clauses.data();
   if (!__pyx_t_6) {
     PyErr_SetString(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
-    __PYX_ERR(0, 300, __pyx_L1_error)
+    __PYX_ERR(0, 539, __pyx_L1_error)
   }
-  __pyx_t_8 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 300, __pyx_L1_error)
+  __pyx_t_8 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_2 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_new_clauses.size())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 300, __pyx_L1_error)
+  __pyx_t_2 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_new_clauses.size())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_7 = __pyx_array_new(__pyx_t_2, sizeof(int), PyBytes_AS_STRING(__pyx_t_8), (char *) "c", (char *) __pyx_t_6);
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 300, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(((PyObject *)__pyx_t_7), PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 300, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(((PyObject *)__pyx_t_7), 0); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
-  ((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_9);
+  __pyx_t_10 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_9); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 539, __pyx_L1_error)
   __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "sat_toolkit/_cnf_util.pyx":301
+  /* "sat_toolkit/formula.pyx":540
  *         cdef CNF res = CNF.__new__(CNF)
  *         res._add_clauses(<int[:new_clauses.size()]> new_clauses.data())
  *         return res             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_res));
   __pyx_r = __pyx_v_res;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":280
- *     append = add_clause
+  /* "sat_toolkit/formula.pyx":519
+ * 
  * 
  *     def logical_or(self, int var) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         return a new CNF corresponding to (var or self). I.e., the new CNF is
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(((PyObject *)__pyx_t_7));
   __Pyx_XDECREF(__pyx_t_8);
   __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.logical_or", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.logical_or", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_res);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":304
+/* "sat_toolkit/formula.pyx":543
  * 
  * 
  *     def implied_by(self, int var) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         return a new CNF corresponding to (var -> self). I.e., the new CNF is
  */
 
 /* Python wrapper */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_15implied_by(PyObject *__pyx_v_self, PyObject *__pyx_arg_var); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_14implied_by[] = "CNF.implied_by(self, int var) -> CNF\n\n        return a new CNF corresponding to (var -> self). I.e., the new CNF is\n        build by appending ~var to each clause\n        ";
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_15implied_by(PyObject *__pyx_v_self, PyObject *__pyx_arg_var) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_23implied_by(PyObject *__pyx_v_self, PyObject *__pyx_arg_var); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_22implied_by[] = "CNF.implied_by(self, int var) -> CNF\n\n        return a new CNF corresponding to (var -> self). I.e., the new CNF is\n        build by appending ~var to each clause\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_23implied_by(PyObject *__pyx_v_self, PyObject *__pyx_arg_var) {
   int __pyx_v_var;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("implied_by (wrapper)", 0);
   assert(__pyx_arg_var); {
-    __pyx_v_var = __Pyx_PyInt_As_int(__pyx_arg_var); if (unlikely((__pyx_v_var == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 304, __pyx_L3_error)
+    __pyx_v_var = __Pyx_PyInt_As_int(__pyx_arg_var); if (unlikely((__pyx_v_var == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.implied_by", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.implied_by", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_14implied_by(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((int)__pyx_v_var));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_22implied_by(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((int)__pyx_v_var));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_14implied_by(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, int __pyx_v_var) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = NULL;
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_22implied_by(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, int __pyx_v_var) {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("implied_by", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":309
+  /* "sat_toolkit/formula.pyx":548
  *         build by appending ~var to each clause
  *         """
  *         return self.logical_or(-var)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_logical_or); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 309, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_logical_or); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 548, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_From_int((-__pyx_v_var)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 309, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int((-__pyx_v_var)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 548, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 309, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 548, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_11sat_toolkit_9_cnf_util_CNF))))) __PYX_ERR(0, 309, __pyx_L1_error)
-  __pyx_r = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_t_1);
+  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_11sat_toolkit_7formula_CNF))))) __PYX_ERR(0, 548, __pyx_L1_error)
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":304
+  /* "sat_toolkit/formula.pyx":543
  * 
  * 
  *     def implied_by(self, int var) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         return a new CNF corresponding to (var -> self). I.e., the new CNF is
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.implied_by", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.implied_by", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":312
+/* "sat_toolkit/formula.pyx":551
  * 
  * 
- *     def to_dimacs(self):             # <<<<<<<<<<<<<<
- *         cdef size_t max_len = snprintf(NULL, 0, "%d", -self.nvars)
- *         cdef size_t nclauses = self.start_indices.size()
+ *     def to_dimacs(self) -> str:             # <<<<<<<<<<<<<<
+ *         '''
+ *         return the CNF formatted in the DIMACS file format
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_17to_dimacs(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_16to_dimacs[] = "CNF.to_dimacs(self)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_17to_dimacs(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_25to_dimacs(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_24to_dimacs[] = "CNF.to_dimacs(self) -> str\n\n        return the CNF formatted in the DIMACS file format\n        ";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_25to_dimacs(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("to_dimacs (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_16to_dimacs(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_24to_dimacs(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_16to_dimacs(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_24to_dimacs(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
   size_t __pyx_v_max_len;
   size_t __pyx_v_nclauses;
   Py_ssize_t __pyx_v_buf_size;
   char *__pyx_v_buf;
   Py_ssize_t __pyx_v_buf_idx;
   Py_ssize_t __pyx_v_written;
   size_t __pyx_v_i;
@@ -7547,331 +10495,332 @@
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("to_dimacs", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":313
- * 
- *     def to_dimacs(self):
+  /* "sat_toolkit/formula.pyx":555
+ *         return the CNF formatted in the DIMACS file format
+ *         '''
  *         cdef size_t max_len = snprintf(NULL, 0, "%d", -self.nvars)             # <<<<<<<<<<<<<<
  *         cdef size_t nclauses = self.start_indices.size()
  *         cdef ssize_t buf_size = (self.clauses.size() - nclauses) * (max_len + 1) + nclauses * (2)
  */
   __pyx_v_max_len = snprintf(NULL, 0, ((char const *)"%d"), (-__pyx_v_self->nvars));
 
-  /* "sat_toolkit/_cnf_util.pyx":314
- *     def to_dimacs(self):
+  /* "sat_toolkit/formula.pyx":556
+ *         '''
  *         cdef size_t max_len = snprintf(NULL, 0, "%d", -self.nvars)
  *         cdef size_t nclauses = self.start_indices.size()             # <<<<<<<<<<<<<<
  *         cdef ssize_t buf_size = (self.clauses.size() - nclauses) * (max_len + 1) + nclauses * (2)
  *         cdef char *buf = <char *> malloc(buf_size + 1)
  */
   __pyx_v_nclauses = __pyx_v_self->start_indices.size();
 
-  /* "sat_toolkit/_cnf_util.pyx":315
+  /* "sat_toolkit/formula.pyx":557
  *         cdef size_t max_len = snprintf(NULL, 0, "%d", -self.nvars)
  *         cdef size_t nclauses = self.start_indices.size()
  *         cdef ssize_t buf_size = (self.clauses.size() - nclauses) * (max_len + 1) + nclauses * (2)             # <<<<<<<<<<<<<<
  *         cdef char *buf = <char *> malloc(buf_size + 1)
  *         cdef ssize_t buf_idx = 0, written
  */
   __pyx_v_buf_size = (((__pyx_v_self->clauses.size() - __pyx_v_nclauses) * (__pyx_v_max_len + 1)) + (__pyx_v_nclauses * 2));
 
-  /* "sat_toolkit/_cnf_util.pyx":316
+  /* "sat_toolkit/formula.pyx":558
  *         cdef size_t nclauses = self.start_indices.size()
  *         cdef ssize_t buf_size = (self.clauses.size() - nclauses) * (max_len + 1) + nclauses * (2)
  *         cdef char *buf = <char *> malloc(buf_size + 1)             # <<<<<<<<<<<<<<
  *         cdef ssize_t buf_idx = 0, written
  *         cdef size_t i
  */
   __pyx_v_buf = ((char *)malloc((__pyx_v_buf_size + 1)));
 
-  /* "sat_toolkit/_cnf_util.pyx":317
+  /* "sat_toolkit/formula.pyx":559
  *         cdef ssize_t buf_size = (self.clauses.size() - nclauses) * (max_len + 1) + nclauses * (2)
  *         cdef char *buf = <char *> malloc(buf_size + 1)
  *         cdef ssize_t buf_idx = 0, written             # <<<<<<<<<<<<<<
  *         cdef size_t i
  * 
  */
   __pyx_v_buf_idx = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":320
+  /* "sat_toolkit/formula.pyx":562
  *         cdef size_t i
  * 
  *         for i in range(self.clauses.size()):             # <<<<<<<<<<<<<<
  *             if self.clauses[i] == 0:
  *                 written = snprintf(&buf[buf_idx], buf_size, "0\n")
  */
   __pyx_t_1 = __pyx_v_self->clauses.size();
   __pyx_t_2 = __pyx_t_1;
   for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
     __pyx_v_i = __pyx_t_3;
 
-    /* "sat_toolkit/_cnf_util.pyx":321
+    /* "sat_toolkit/formula.pyx":563
  * 
  *         for i in range(self.clauses.size()):
  *             if self.clauses[i] == 0:             # <<<<<<<<<<<<<<
  *                 written = snprintf(&buf[buf_idx], buf_size, "0\n")
  *                 if written < 0:
  */
     __pyx_t_4 = (((__pyx_v_self->clauses[__pyx_v_i]) == 0) != 0);
     if (__pyx_t_4) {
 
-      /* "sat_toolkit/_cnf_util.pyx":322
+      /* "sat_toolkit/formula.pyx":564
  *         for i in range(self.clauses.size()):
  *             if self.clauses[i] == 0:
  *                 written = snprintf(&buf[buf_idx], buf_size, "0\n")             # <<<<<<<<<<<<<<
  *                 if written < 0:
  *                     assert 0
  */
       __pyx_v_written = snprintf((&(__pyx_v_buf[__pyx_v_buf_idx])), __pyx_v_buf_size, ((char const *)"0\n"));
 
-      /* "sat_toolkit/_cnf_util.pyx":323
+      /* "sat_toolkit/formula.pyx":565
  *             if self.clauses[i] == 0:
  *                 written = snprintf(&buf[buf_idx], buf_size, "0\n")
  *                 if written < 0:             # <<<<<<<<<<<<<<
  *                     assert 0
  *                 buf_idx += written
  */
       __pyx_t_4 = ((__pyx_v_written < 0) != 0);
       if (__pyx_t_4) {
 
-        /* "sat_toolkit/_cnf_util.pyx":324
+        /* "sat_toolkit/formula.pyx":566
  *                 written = snprintf(&buf[buf_idx], buf_size, "0\n")
  *                 if written < 0:
  *                     assert 0             # <<<<<<<<<<<<<<
  *                 buf_idx += written
  *                 buf_size -= written
  */
         #ifndef CYTHON_WITHOUT_ASSERTIONS
-        if (unlikely(!Py_OptimizeFlag)) {
+        if (unlikely(__pyx_assertions_enabled())) {
           if (unlikely(!0)) {
             PyErr_SetNone(PyExc_AssertionError);
-            __PYX_ERR(0, 324, __pyx_L1_error)
+            __PYX_ERR(0, 566, __pyx_L1_error)
           }
         }
         #endif
 
-        /* "sat_toolkit/_cnf_util.pyx":323
+        /* "sat_toolkit/formula.pyx":565
  *             if self.clauses[i] == 0:
  *                 written = snprintf(&buf[buf_idx], buf_size, "0\n")
  *                 if written < 0:             # <<<<<<<<<<<<<<
  *                     assert 0
  *                 buf_idx += written
  */
       }
 
-      /* "sat_toolkit/_cnf_util.pyx":325
+      /* "sat_toolkit/formula.pyx":567
  *                 if written < 0:
  *                     assert 0
  *                 buf_idx += written             # <<<<<<<<<<<<<<
  *                 buf_size -= written
  *             else:
  */
       __pyx_v_buf_idx = (__pyx_v_buf_idx + __pyx_v_written);
 
-      /* "sat_toolkit/_cnf_util.pyx":326
+      /* "sat_toolkit/formula.pyx":568
  *                     assert 0
  *                 buf_idx += written
  *                 buf_size -= written             # <<<<<<<<<<<<<<
  *             else:
  *                 written = snprintf(&buf[buf_idx], buf_size, "%d ", self.clauses[i])
  */
       __pyx_v_buf_size = (__pyx_v_buf_size - __pyx_v_written);
 
-      /* "sat_toolkit/_cnf_util.pyx":321
+      /* "sat_toolkit/formula.pyx":563
  * 
  *         for i in range(self.clauses.size()):
  *             if self.clauses[i] == 0:             # <<<<<<<<<<<<<<
  *                 written = snprintf(&buf[buf_idx], buf_size, "0\n")
  *                 if written < 0:
  */
       goto __pyx_L5;
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":328
+    /* "sat_toolkit/formula.pyx":570
  *                 buf_size -= written
  *             else:
  *                 written = snprintf(&buf[buf_idx], buf_size, "%d ", self.clauses[i])             # <<<<<<<<<<<<<<
  *                 if written < 0:
  *                     assert 0
  */
     /*else*/ {
       __pyx_v_written = snprintf((&(__pyx_v_buf[__pyx_v_buf_idx])), __pyx_v_buf_size, ((char const *)"%d "), (__pyx_v_self->clauses[__pyx_v_i]));
 
-      /* "sat_toolkit/_cnf_util.pyx":329
+      /* "sat_toolkit/formula.pyx":571
  *             else:
  *                 written = snprintf(&buf[buf_idx], buf_size, "%d ", self.clauses[i])
  *                 if written < 0:             # <<<<<<<<<<<<<<
  *                     assert 0
  *                 buf_idx += written
  */
       __pyx_t_4 = ((__pyx_v_written < 0) != 0);
       if (__pyx_t_4) {
 
-        /* "sat_toolkit/_cnf_util.pyx":330
+        /* "sat_toolkit/formula.pyx":572
  *                 written = snprintf(&buf[buf_idx], buf_size, "%d ", self.clauses[i])
  *                 if written < 0:
  *                     assert 0             # <<<<<<<<<<<<<<
  *                 buf_idx += written
  *                 buf_size -= written
  */
         #ifndef CYTHON_WITHOUT_ASSERTIONS
-        if (unlikely(!Py_OptimizeFlag)) {
+        if (unlikely(__pyx_assertions_enabled())) {
           if (unlikely(!0)) {
             PyErr_SetNone(PyExc_AssertionError);
-            __PYX_ERR(0, 330, __pyx_L1_error)
+            __PYX_ERR(0, 572, __pyx_L1_error)
           }
         }
         #endif
 
-        /* "sat_toolkit/_cnf_util.pyx":329
+        /* "sat_toolkit/formula.pyx":571
  *             else:
  *                 written = snprintf(&buf[buf_idx], buf_size, "%d ", self.clauses[i])
  *                 if written < 0:             # <<<<<<<<<<<<<<
  *                     assert 0
  *                 buf_idx += written
  */
       }
 
-      /* "sat_toolkit/_cnf_util.pyx":331
+      /* "sat_toolkit/formula.pyx":573
  *                 if written < 0:
  *                     assert 0
  *                 buf_idx += written             # <<<<<<<<<<<<<<
  *                 buf_size -= written
  * 
  */
       __pyx_v_buf_idx = (__pyx_v_buf_idx + __pyx_v_written);
 
-      /* "sat_toolkit/_cnf_util.pyx":332
+      /* "sat_toolkit/formula.pyx":574
  *                     assert 0
  *                 buf_idx += written
  *                 buf_size -= written             # <<<<<<<<<<<<<<
  * 
  *         assert buf_size >= 0
  */
       __pyx_v_buf_size = (__pyx_v_buf_size - __pyx_v_written);
     }
     __pyx_L5:;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":334
+  /* "sat_toolkit/formula.pyx":576
  *                 buf_size -= written
  * 
  *         assert buf_size >= 0             # <<<<<<<<<<<<<<
  *         py_str = buf[:buf_idx]
  *         free(buf)
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
-  if (unlikely(!Py_OptimizeFlag)) {
+  if (unlikely(__pyx_assertions_enabled())) {
     if (unlikely(!((__pyx_v_buf_size >= 0) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
-      __PYX_ERR(0, 334, __pyx_L1_error)
+      __PYX_ERR(0, 576, __pyx_L1_error)
     }
   }
   #endif
 
-  /* "sat_toolkit/_cnf_util.pyx":335
+  /* "sat_toolkit/formula.pyx":577
  * 
  *         assert buf_size >= 0
  *         py_str = buf[:buf_idx]             # <<<<<<<<<<<<<<
  *         free(buf)
  * 
  */
-  __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_buf + 0, __pyx_v_buf_idx - 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_buf + 0, __pyx_v_buf_idx - 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 577, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_v_py_str = ((PyObject*)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":336
+  /* "sat_toolkit/formula.pyx":578
  *         assert buf_size >= 0
  *         py_str = buf[:buf_idx]
  *         free(buf)             # <<<<<<<<<<<<<<
  * 
  *         return 'p cnf ' + str(self.nvars) + ' ' + str(nclauses) + '\n' + py_str.decode()
  */
   free(__pyx_v_buf);
 
-  /* "sat_toolkit/_cnf_util.pyx":338
+  /* "sat_toolkit/formula.pyx":580
  *         free(buf)
  * 
  *         return 'p cnf ' + str(self.nvars) + ' ' + str(nclauses) + '\n' + py_str.decode()             # <<<<<<<<<<<<<<
  * 
- *     def to_espresso(self, print_numvars: bool = True):
+ *     def to_espresso(self, print_numvars: bool = True) -> str:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->nvars); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->nvars); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyUnicode_Concat(__pyx_kp_u_p_cnf, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Concat(__pyx_kp_u_p_cnf, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_t_5, __pyx_kp_u__8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_t_5, __pyx_kp_u__7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_v_nclauses); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_v_nclauses); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyUnicode_Concat(__pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Concat(__pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyUnicode_Concat(__pyx_t_5, __pyx_kp_u__13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyUnicode_Concat(__pyx_t_5, __pyx_kp_u__17); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_decode_bytes(__pyx_v_py_str, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_decode_bytes(__pyx_v_py_str, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 580, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_r = __pyx_t_6;
+  if (!(likely(PyUnicode_CheckExact(__pyx_t_6))||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_6)->tp_name), 0))) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_r = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":312
+  /* "sat_toolkit/formula.pyx":551
  * 
  * 
- *     def to_dimacs(self):             # <<<<<<<<<<<<<<
- *         cdef size_t max_len = snprintf(NULL, 0, "%d", -self.nvars)
- *         cdef size_t nclauses = self.start_indices.size()
+ *     def to_dimacs(self) -> str:             # <<<<<<<<<<<<<<
+ *         '''
+ *         return the CNF formatted in the DIMACS file format
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.to_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.to_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_py_str);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":340
+/* "sat_toolkit/formula.pyx":582
  *         return 'p cnf ' + str(self.nvars) + ' ' + str(nclauses) + '\n' + py_str.decode()
  * 
- *     def to_espresso(self, print_numvars: bool = True):             # <<<<<<<<<<<<<<
- *         cdef size_t i, j
- *         cdef int lit
+ *     def to_espresso(self, print_numvars: bool = True) -> str:             # <<<<<<<<<<<<<<
+ *         '''
+ *         return the CNF formatted in the espresso file format
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_19to_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_18to_espresso[] = "CNF.to_espresso(self, print_numvars: bool = True)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_19to_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_27to_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_26to_espresso[] = "CNF.to_espresso(self, print_numvars: bool = True) -> str\n\n        return the CNF formatted in the espresso file format\n        ";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_27to_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_print_numvars = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("to_espresso (wrapper)", 0);
@@ -7893,42 +10842,42 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_print_numvars);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "to_espresso") < 0)) __PYX_ERR(0, 340, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "to_espresso") < 0)) __PYX_ERR(0, 582, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_print_numvars = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("to_espresso", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 340, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("to_espresso", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 582, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.to_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.to_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_18to_espresso(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), __pyx_v_print_numvars);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_26to_espresso(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), __pyx_v_print_numvars);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_18to_espresso(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_print_numvars) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_26to_espresso(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_print_numvars) {
   size_t __pyx_v_i;
   size_t __pyx_v_j;
   int __pyx_v_lit;
   char __pyx_v_target_char;
   char *__pyx_v_line_buf;
   fmt_buf __pyx_v_buf;
   PyObject *__pyx_v_py_bytes = NULL;
@@ -7940,299 +10889,345 @@
   size_t __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("to_espresso", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":345
+  /* "sat_toolkit/formula.pyx":590
  *         cdef char target_char
  *         cdef char *line_buf
  *         cdef fmt_buf buf = make_buf()             # <<<<<<<<<<<<<<
  * 
  *         if print_numvars:
  */
   __pyx_v_buf = make_buf();
 
-  /* "sat_toolkit/_cnf_util.pyx":347
+  /* "sat_toolkit/formula.pyx":592
  *         cdef fmt_buf buf = make_buf()
  * 
  *         if print_numvars:             # <<<<<<<<<<<<<<
  *             buf_printf(&buf, ".i %d\n", self.nvars)
  *             buf_printf(&buf, ".o 1\n", self.nvars)
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_print_numvars); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 347, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_print_numvars); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 592, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":348
+    /* "sat_toolkit/formula.pyx":593
  * 
  *         if print_numvars:
  *             buf_printf(&buf, ".i %d\n", self.nvars)             # <<<<<<<<<<<<<<
  *             buf_printf(&buf, ".o 1\n", self.nvars)
  *         buf_printf(&buf, ".p %zd\n", self.start_indices.size())
  */
     (void)(buf_printf((&__pyx_v_buf), ((char const *)".i %d\n"), __pyx_v_self->nvars));
 
-    /* "sat_toolkit/_cnf_util.pyx":349
+    /* "sat_toolkit/formula.pyx":594
  *         if print_numvars:
  *             buf_printf(&buf, ".i %d\n", self.nvars)
  *             buf_printf(&buf, ".o 1\n", self.nvars)             # <<<<<<<<<<<<<<
  *         buf_printf(&buf, ".p %zd\n", self.start_indices.size())
  * 
  */
     (void)(buf_printf((&__pyx_v_buf), ((char const *)".o 1\n"), __pyx_v_self->nvars));
 
-    /* "sat_toolkit/_cnf_util.pyx":347
+    /* "sat_toolkit/formula.pyx":592
  *         cdef fmt_buf buf = make_buf()
  * 
  *         if print_numvars:             # <<<<<<<<<<<<<<
  *             buf_printf(&buf, ".i %d\n", self.nvars)
  *             buf_printf(&buf, ".o 1\n", self.nvars)
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":350
+  /* "sat_toolkit/formula.pyx":595
  *             buf_printf(&buf, ".i %d\n", self.nvars)
  *             buf_printf(&buf, ".o 1\n", self.nvars)
  *         buf_printf(&buf, ".p %zd\n", self.start_indices.size())             # <<<<<<<<<<<<<<
  * 
  *         line_buf = <char *> malloc(self.nvars + 4)
  */
   (void)(buf_printf((&__pyx_v_buf), ((char const *)".p %zd\n"), __pyx_v_self->start_indices.size()));
 
-  /* "sat_toolkit/_cnf_util.pyx":352
+  /* "sat_toolkit/formula.pyx":597
  *         buf_printf(&buf, ".p %zd\n", self.start_indices.size())
  * 
  *         line_buf = <char *> malloc(self.nvars + 4)             # <<<<<<<<<<<<<<
  *         strcpy(line_buf + self.nvars, " 1\n");
  * 
  */
   __pyx_v_line_buf = ((char *)malloc((__pyx_v_self->nvars + 4)));
 
-  /* "sat_toolkit/_cnf_util.pyx":353
+  /* "sat_toolkit/formula.pyx":598
  * 
  *         line_buf = <char *> malloc(self.nvars + 4)
  *         strcpy(line_buf + self.nvars, " 1\n");             # <<<<<<<<<<<<<<
  * 
  *         for i in range(self.start_indices.size()):
  */
   (void)(strcpy((__pyx_v_line_buf + __pyx_v_self->nvars), ((char const *)" 1\n")));
 
-  /* "sat_toolkit/_cnf_util.pyx":355
+  /* "sat_toolkit/formula.pyx":600
  *         strcpy(line_buf + self.nvars, " 1\n");
  * 
  *         for i in range(self.start_indices.size()):             # <<<<<<<<<<<<<<
  *             memset(line_buf, b'-', self.nvars);
  * 
  */
   __pyx_t_2 = __pyx_v_self->start_indices.size();
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_i = __pyx_t_4;
 
-    /* "sat_toolkit/_cnf_util.pyx":356
+    /* "sat_toolkit/formula.pyx":601
  * 
  *         for i in range(self.start_indices.size()):
  *             memset(line_buf, b'-', self.nvars);             # <<<<<<<<<<<<<<
  * 
  *             j = 0
  */
     (void)(memset(__pyx_v_line_buf, '-', __pyx_v_self->nvars));
 
-    /* "sat_toolkit/_cnf_util.pyx":358
+    /* "sat_toolkit/formula.pyx":603
  *             memset(line_buf, b'-', self.nvars);
  * 
  *             j = 0             # <<<<<<<<<<<<<<
  *             while self.clauses[self.start_indices[i] + j] != 0:
  *                 lit = self.clauses[self.start_indices[i] + j]
  */
     __pyx_v_j = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":359
+    /* "sat_toolkit/formula.pyx":604
  * 
  *             j = 0
  *             while self.clauses[self.start_indices[i] + j] != 0:             # <<<<<<<<<<<<<<
  *                 lit = self.clauses[self.start_indices[i] + j]
  * 
  */
     while (1) {
       __pyx_t_1 = (((__pyx_v_self->clauses[((__pyx_v_self->start_indices[__pyx_v_i]) + __pyx_v_j)]) != 0) != 0);
       if (!__pyx_t_1) break;
 
-      /* "sat_toolkit/_cnf_util.pyx":360
+      /* "sat_toolkit/formula.pyx":605
  *             j = 0
  *             while self.clauses[self.start_indices[i] + j] != 0:
  *                 lit = self.clauses[self.start_indices[i] + j]             # <<<<<<<<<<<<<<
  * 
  *                 target_char = b'0'
  */
       __pyx_v_lit = (__pyx_v_self->clauses[((__pyx_v_self->start_indices[__pyx_v_i]) + __pyx_v_j)]);
 
-      /* "sat_toolkit/_cnf_util.pyx":362
+      /* "sat_toolkit/formula.pyx":607
  *                 lit = self.clauses[self.start_indices[i] + j]
  * 
  *                 target_char = b'0'             # <<<<<<<<<<<<<<
  *                 if lit < 0:
  *                     target_char = b'1'
  */
       __pyx_v_target_char = '0';
 
-      /* "sat_toolkit/_cnf_util.pyx":363
+      /* "sat_toolkit/formula.pyx":608
  * 
  *                 target_char = b'0'
  *                 if lit < 0:             # <<<<<<<<<<<<<<
  *                     target_char = b'1'
  *                     lit = -lit
  */
       __pyx_t_1 = ((__pyx_v_lit < 0) != 0);
       if (__pyx_t_1) {
 
-        /* "sat_toolkit/_cnf_util.pyx":364
+        /* "sat_toolkit/formula.pyx":609
  *                 target_char = b'0'
  *                 if lit < 0:
  *                     target_char = b'1'             # <<<<<<<<<<<<<<
  *                     lit = -lit
  * 
  */
         __pyx_v_target_char = '1';
 
-        /* "sat_toolkit/_cnf_util.pyx":365
+        /* "sat_toolkit/formula.pyx":610
  *                 if lit < 0:
  *                     target_char = b'1'
  *                     lit = -lit             # <<<<<<<<<<<<<<
  * 
  *                 line_buf[self.nvars - lit] = target_char
  */
         __pyx_v_lit = (-__pyx_v_lit);
 
-        /* "sat_toolkit/_cnf_util.pyx":363
+        /* "sat_toolkit/formula.pyx":608
  * 
  *                 target_char = b'0'
  *                 if lit < 0:             # <<<<<<<<<<<<<<
  *                     target_char = b'1'
  *                     lit = -lit
  */
       }
 
-      /* "sat_toolkit/_cnf_util.pyx":367
+      /* "sat_toolkit/formula.pyx":612
  *                     lit = -lit
  * 
  *                 line_buf[self.nvars - lit] = target_char             # <<<<<<<<<<<<<<
  * 
  *                 j += 1
  */
       (__pyx_v_line_buf[(__pyx_v_self->nvars - __pyx_v_lit)]) = __pyx_v_target_char;
 
-      /* "sat_toolkit/_cnf_util.pyx":369
+      /* "sat_toolkit/formula.pyx":614
  *                 line_buf[self.nvars - lit] = target_char
  * 
  *                 j += 1             # <<<<<<<<<<<<<<
  * 
  *             buf_printf(&buf, "%s", line_buf)
  */
       __pyx_v_j = (__pyx_v_j + 1);
     }
 
-    /* "sat_toolkit/_cnf_util.pyx":371
+    /* "sat_toolkit/formula.pyx":616
  *                 j += 1
  * 
  *             buf_printf(&buf, "%s", line_buf)             # <<<<<<<<<<<<<<
  * 
+ *         # handle the case of a CNF with 0 clauses, a.k.a. a tautology
+ */
+    (void)(buf_printf((&__pyx_v_buf), ((char const *)"%s"), __pyx_v_line_buf));
+  }
+
+  /* "sat_toolkit/formula.pyx":619
+ * 
+ *         # handle the case of a CNF with 0 clauses, a.k.a. a tautology
+ *         if self.start_indices.size() == 0:             # <<<<<<<<<<<<<<
+ *             memset(line_buf, b'-', self.nvars);
+ *             line_buf[self.nvars + 1] = b'0'
+ */
+  __pyx_t_1 = ((__pyx_v_self->start_indices.size() == 0) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":620
+ *         # handle the case of a CNF with 0 clauses, a.k.a. a tautology
+ *         if self.start_indices.size() == 0:
+ *             memset(line_buf, b'-', self.nvars);             # <<<<<<<<<<<<<<
+ *             line_buf[self.nvars + 1] = b'0'
+ *             buf_printf(&buf, "%s", line_buf)
+ */
+    (void)(memset(__pyx_v_line_buf, '-', __pyx_v_self->nvars));
+
+    /* "sat_toolkit/formula.pyx":621
+ *         if self.start_indices.size() == 0:
+ *             memset(line_buf, b'-', self.nvars);
+ *             line_buf[self.nvars + 1] = b'0'             # <<<<<<<<<<<<<<
+ *             buf_printf(&buf, "%s", line_buf)
+ * 
+ */
+    (__pyx_v_line_buf[(__pyx_v_self->nvars + 1)]) = '0';
+
+    /* "sat_toolkit/formula.pyx":622
+ *             memset(line_buf, b'-', self.nvars);
+ *             line_buf[self.nvars + 1] = b'0'
+ *             buf_printf(&buf, "%s", line_buf)             # <<<<<<<<<<<<<<
+ * 
  *         buf_printf(&buf, ".e\n")
  */
     (void)(buf_printf((&__pyx_v_buf), ((char const *)"%s"), __pyx_v_line_buf));
+
+    /* "sat_toolkit/formula.pyx":619
+ * 
+ *         # handle the case of a CNF with 0 clauses, a.k.a. a tautology
+ *         if self.start_indices.size() == 0:             # <<<<<<<<<<<<<<
+ *             memset(line_buf, b'-', self.nvars);
+ *             line_buf[self.nvars + 1] = b'0'
+ */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":373
+  /* "sat_toolkit/formula.pyx":624
  *             buf_printf(&buf, "%s", line_buf)
  * 
  *         buf_printf(&buf, ".e\n")             # <<<<<<<<<<<<<<
  *         py_bytes = buf.buf[:buf.len]
  * 
  */
   (void)(buf_printf((&__pyx_v_buf), ((char const *)".e\n")));
 
-  /* "sat_toolkit/_cnf_util.pyx":374
+  /* "sat_toolkit/formula.pyx":625
  * 
  *         buf_printf(&buf, ".e\n")
  *         py_bytes = buf.buf[:buf.len]             # <<<<<<<<<<<<<<
  * 
  *         free_buf(&buf)
  */
-  __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_buf.buf + 0, __pyx_v_buf.len - 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 374, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_buf.buf + 0, __pyx_v_buf.len - 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 625, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_v_py_bytes = ((PyObject*)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":376
+  /* "sat_toolkit/formula.pyx":627
  *         py_bytes = buf.buf[:buf.len]
  * 
  *         free_buf(&buf)             # <<<<<<<<<<<<<<
  *         return py_bytes.decode()
  * 
  */
   free_buf((&__pyx_v_buf));
 
-  /* "sat_toolkit/_cnf_util.pyx":377
+  /* "sat_toolkit/formula.pyx":628
  * 
  *         free_buf(&buf)
  *         return py_bytes.decode()             # <<<<<<<<<<<<<<
  * 
  *     def minimize_espresso(self, espresso_args: List[str] = []) -> CNF:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_5 = __Pyx_decode_bytes(__pyx_v_py_bytes, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 377, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_decode_bytes(__pyx_v_py_bytes, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 628, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
+  __pyx_r = ((PyObject*)__pyx_t_5);
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":340
+  /* "sat_toolkit/formula.pyx":582
  *         return 'p cnf ' + str(self.nvars) + ' ' + str(nclauses) + '\n' + py_str.decode()
  * 
- *     def to_espresso(self, print_numvars: bool = True):             # <<<<<<<<<<<<<<
- *         cdef size_t i, j
- *         cdef int lit
+ *     def to_espresso(self, print_numvars: bool = True) -> str:             # <<<<<<<<<<<<<<
+ *         '''
+ *         return the CNF formatted in the espresso file format
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.to_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.to_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_py_bytes);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":379
+/* "sat_toolkit/formula.pyx":630
  *         return py_bytes.decode()
  * 
  *     def minimize_espresso(self, espresso_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses espresso to minimize the given CNF.
  */
 
 /* Python wrapper */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_21minimize_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_20minimize_espresso[] = "CNF.minimize_espresso(self, espresso_args: List[str] = []) -> CNF\n\n        Uses espresso to minimize the given CNF.\n\n        :param espresso_args: extra parameters given when calling espresso, defaults to []\n\n        :return: a new CNF object as minimized by espresso\n        :rtype: CNF\n        ";
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_21minimize_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_29minimize_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_28minimize_espresso[] = "CNF.minimize_espresso(self, espresso_args: List[str] = []) -> CNF\n\n        Uses espresso to minimize the given CNF.\n\n        :param espresso_args: extra parameters given when calling espresso, defaults to []\n\n        :return: a new CNF object as minimized by espresso\n        :rtype: CNF\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_29minimize_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_espresso_args = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("minimize_espresso (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_espresso_args,0};
     PyObject* values[1] = {0};
-    values[0] = __pyx_k__14;
+    values[0] = __pyx_k__18;
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
@@ -8243,46 +11238,46 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_espresso_args);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "minimize_espresso") < 0)) __PYX_ERR(0, 379, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "minimize_espresso") < 0)) __PYX_ERR(0, 630, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_espresso_args = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("minimize_espresso", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 379, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("minimize_espresso", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 630, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.minimize_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.minimize_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_20minimize_espresso(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), __pyx_v_espresso_args);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_28minimize_espresso(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), __pyx_v_espresso_args);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_20minimize_espresso(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_espresso_args) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_28minimize_espresso(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_espresso_args) {
   int __pyx_v_ret_code;
   PyObject *__pyx_v_espresso = NULL;
   PyObject *__pyx_v_cnf = NULL;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
@@ -8290,85 +11285,85 @@
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
   int __pyx_t_10;
   int __pyx_t_11;
   PyObject *__pyx_t_12 = NULL;
   PyObject *__pyx_t_13 = NULL;
   int __pyx_t_14;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_t_15 = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_t_15 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("minimize_espresso", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":390
+  /* "sat_toolkit/formula.pyx":641
  *         cdef int ret_code
  * 
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:             # <<<<<<<<<<<<<<
  *             espresso.stdin.write(self.to_espresso())
  *             espresso.stdin.close()
  */
   /*with:*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Popen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Popen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_n_u_espresso);
     __Pyx_GIVEREF(__pyx_n_u_espresso);
     PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_espresso);
-    __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_espresso_args); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_espresso_args); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
     __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdin, __pyx_t_5) < 0) __PYX_ERR(0, 390, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdin, __pyx_t_5) < 0) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdout, __pyx_t_4) < 0) __PYX_ERR(0, 390, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdout, __pyx_t_4) < 0) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_text, Py_True) < 0) __PYX_ERR(0, 390, __pyx_L1_error)
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 390, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_text, Py_True) < 0) __PYX_ERR(0, 641, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 390, __pyx_L3_error)
+    __pyx_t_1 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 641, __pyx_L3_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 390, __pyx_L3_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 641, __pyx_L3_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = __pyx_t_3;
     __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     /*try:*/ {
       {
@@ -8378,41 +11373,41 @@
         __Pyx_XGOTREF(__pyx_t_7);
         __Pyx_XGOTREF(__pyx_t_8);
         __Pyx_XGOTREF(__pyx_t_9);
         /*try:*/ {
           __pyx_v_espresso = __pyx_t_1;
           __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":391
+          /* "sat_toolkit/formula.pyx":642
  * 
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:
  *             espresso.stdin.write(self.to_espresso())             # <<<<<<<<<<<<<<
  *             espresso.stdin.close()
  * 
  */
-          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 391, __pyx_L7_error)
+          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 391, __pyx_L7_error)
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_espresso); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 391, __pyx_L7_error)
+          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_espresso); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 642, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_2);
           __pyx_t_5 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
             if (likely(__pyx_t_5)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
               __Pyx_INCREF(__pyx_t_5);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_2, function);
             }
           }
           __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 391, __pyx_L7_error)
+          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_2 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
             __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
             if (likely(__pyx_t_2)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -8420,75 +11415,75 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_3, function);
             }
           }
           __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
           __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 391, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 642, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":392
+          /* "sat_toolkit/formula.pyx":643
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:
  *             espresso.stdin.write(self.to_espresso())
  *             espresso.stdin.close()             # <<<<<<<<<<<<<<
  * 
  *             cnf = CNF.from_espresso(espresso.stdout.read())
  */
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 392, __pyx_L7_error)
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 643, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_close); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 392, __pyx_L7_error)
+          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_close); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 643, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_3 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
             __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
             if (likely(__pyx_t_3)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
               __Pyx_INCREF(__pyx_t_3);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_4, function);
             }
           }
           __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 392, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 643, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":394
+          /* "sat_toolkit/formula.pyx":645
  *             espresso.stdin.close()
  * 
  *             cnf = CNF.from_espresso(espresso.stdout.read())             # <<<<<<<<<<<<<<
  * 
  *             ret_code = espresso.wait()
  */
-          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF), __pyx_n_s_from_espresso); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 394, __pyx_L7_error)
+          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_n_s_from_espresso); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 645, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 394, __pyx_L7_error)
+          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 645, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_read); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 394, __pyx_L7_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_read); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 645, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_2 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_2)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
               __Pyx_INCREF(__pyx_t_2);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
           __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-          if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 394, __pyx_L7_error)
+          if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 645, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __pyx_t_5 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
             if (likely(__pyx_t_5)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -8496,75 +11491,75 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_4, function);
             }
           }
           __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 394, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 645, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_v_cnf = __pyx_t_1;
           __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":396
+          /* "sat_toolkit/formula.pyx":647
  *             cnf = CNF.from_espresso(espresso.stdout.read())
  * 
  *             ret_code = espresso.wait()             # <<<<<<<<<<<<<<
  *             if ret_code != 0:
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  */
-          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_wait); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 396, __pyx_L7_error)
+          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_wait); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 647, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_4);
           __pyx_t_3 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
             __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
             if (likely(__pyx_t_3)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
               __Pyx_INCREF(__pyx_t_3);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_4, function);
             }
           }
           __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 396, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 647, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 396, __pyx_L7_error)
+          __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 647, __pyx_L7_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_v_ret_code = __pyx_t_10;
 
-          /* "sat_toolkit/_cnf_util.pyx":397
+          /* "sat_toolkit/formula.pyx":648
  * 
  *             ret_code = espresso.wait()
  *             if ret_code != 0:             # <<<<<<<<<<<<<<
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  */
           __pyx_t_11 = ((__pyx_v_ret_code != 0) != 0);
           if (unlikely(__pyx_t_11)) {
 
-            /* "sat_toolkit/_cnf_util.pyx":398
+            /* "sat_toolkit/formula.pyx":649
  *             ret_code = espresso.wait()
  *             if ret_code != 0:
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))             # <<<<<<<<<<<<<<
  * 
  *             return cnf
  */
-            __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 398, __pyx_L7_error)
+            __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 649, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_4);
-            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_CalledProcessError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 398, __pyx_L7_error)
+            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_CalledProcessError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 649, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-            __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_ret_code); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 398, __pyx_L7_error)
+            __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_ret_code); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 649, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_4);
-            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_args); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 398, __pyx_L7_error)
+            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_args); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 649, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_5);
-            __pyx_t_2 = PyUnicode_Join(__pyx_kp_u__8, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 398, __pyx_L7_error)
+            __pyx_t_2 = PyUnicode_Join(__pyx_kp_u__7, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 649, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_2);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
             __pyx_t_5 = NULL;
             __pyx_t_10 = 0;
             if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
               __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
               if (likely(__pyx_t_5)) {
@@ -8574,75 +11569,75 @@
                 __Pyx_DECREF_SET(__pyx_t_3, function);
                 __pyx_t_10 = 1;
               }
             }
             #if CYTHON_FAST_PYCALL
             if (PyFunction_Check(__pyx_t_3)) {
               PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_4, __pyx_t_2};
-              __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 398, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 649, __pyx_L7_error)
               __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
               __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             } else
             #endif
             #if CYTHON_FAST_PYCCALL
             if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
               PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_4, __pyx_t_2};
-              __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 398, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 649, __pyx_L7_error)
               __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
               __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             } else
             #endif
             {
-              __pyx_t_12 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 398, __pyx_L7_error)
+              __pyx_t_12 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 649, __pyx_L7_error)
               __Pyx_GOTREF(__pyx_t_12);
               if (__pyx_t_5) {
                 __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_5); __pyx_t_5 = NULL;
               }
               __Pyx_GIVEREF(__pyx_t_4);
               PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_10, __pyx_t_4);
               __Pyx_GIVEREF(__pyx_t_2);
               PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_10, __pyx_t_2);
               __pyx_t_4 = 0;
               __pyx_t_2 = 0;
-              __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 398, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 649, __pyx_L7_error)
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
             }
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             __Pyx_Raise(__pyx_t_1, 0, 0, 0);
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-            __PYX_ERR(0, 398, __pyx_L7_error)
+            __PYX_ERR(0, 649, __pyx_L7_error)
 
-            /* "sat_toolkit/_cnf_util.pyx":397
+            /* "sat_toolkit/formula.pyx":648
  * 
  *             ret_code = espresso.wait()
  *             if ret_code != 0:             # <<<<<<<<<<<<<<
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  */
           }
 
-          /* "sat_toolkit/_cnf_util.pyx":400
+          /* "sat_toolkit/formula.pyx":651
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  *             return cnf             # <<<<<<<<<<<<<<
  * 
- *     def _minimize_dimacs(self, args: List[str], outfile: str):
+ *     def _minimize_dimacs(self, args: List[str], outfile: str) -> CNF:
  */
           __Pyx_XDECREF(((PyObject *)__pyx_r));
-          if (!(likely(((__pyx_v_cnf) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_cnf, __pyx_ptype_11sat_toolkit_9_cnf_util_CNF))))) __PYX_ERR(0, 400, __pyx_L7_error)
+          if (!(likely(((__pyx_v_cnf) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_cnf, __pyx_ptype_11sat_toolkit_7formula_CNF))))) __PYX_ERR(0, 651, __pyx_L7_error)
           __Pyx_INCREF(__pyx_v_cnf);
-          __pyx_r = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_cnf);
+          __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_cnf);
           goto __pyx_L11_try_return;
 
-          /* "sat_toolkit/_cnf_util.pyx":390
+          /* "sat_toolkit/formula.pyx":641
  *         cdef int ret_code
  * 
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:             # <<<<<<<<<<<<<<
  *             espresso.stdin.write(self.to_espresso())
  *             espresso.stdin.close()
  */
         }
@@ -8650,37 +11645,37 @@
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
         __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         /*except:*/ {
-          __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.minimize_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_3, &__pyx_t_12) < 0) __PYX_ERR(0, 390, __pyx_L9_except_error)
+          __Pyx_AddTraceback("sat_toolkit.formula.CNF.minimize_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+          if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_3, &__pyx_t_12) < 0) __PYX_ERR(0, 641, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_GOTREF(__pyx_t_12);
-          __pyx_t_2 = PyTuple_Pack(3, __pyx_t_1, __pyx_t_3, __pyx_t_12); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 390, __pyx_L9_except_error)
+          __pyx_t_2 = PyTuple_Pack(3, __pyx_t_1, __pyx_t_3, __pyx_t_12); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 641, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_2);
           __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_2, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 390, __pyx_L9_except_error)
+          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 641, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_13);
           __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          if (__pyx_t_11 < 0) __PYX_ERR(0, 390, __pyx_L9_except_error)
+          if (__pyx_t_11 < 0) __PYX_ERR(0, 641, __pyx_L9_except_error)
           __pyx_t_14 = ((!(__pyx_t_11 != 0)) != 0);
           if (__pyx_t_14) {
             __Pyx_GIVEREF(__pyx_t_1);
             __Pyx_GIVEREF(__pyx_t_3);
             __Pyx_XGIVEREF(__pyx_t_12);
             __Pyx_ErrRestoreWithState(__pyx_t_1, __pyx_t_3, __pyx_t_12);
             __pyx_t_1 = 0; __pyx_t_3 = 0; __pyx_t_12 = 0; 
-            __PYX_ERR(0, 390, __pyx_L9_except_error)
+            __PYX_ERR(0, 641, __pyx_L9_except_error)
           }
           __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
           goto __pyx_L8_exception_handled;
         }
         __pyx_L9_except_error:;
@@ -8701,29 +11696,29 @@
         __Pyx_XGIVEREF(__pyx_t_9);
         __Pyx_ExceptionReset(__pyx_t_7, __pyx_t_8, __pyx_t_9);
       }
     }
     /*finally:*/ {
       /*normal exit:*/{
         if (__pyx_t_6) {
-          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 390, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 641, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         }
         goto __pyx_L6;
       }
       __pyx_L4_return: {
         __pyx_t_15 = __pyx_r;
         __pyx_r = 0;
         if (__pyx_t_6) {
-          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 390, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 641, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         }
         __pyx_r = __pyx_t_15;
         __pyx_t_15 = 0;
         goto __pyx_L0;
       }
@@ -8732,60 +11727,60 @@
     goto __pyx_L17;
     __pyx_L3_error:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L1_error;
     __pyx_L17:;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":379
+  /* "sat_toolkit/formula.pyx":630
  *         return py_bytes.decode()
  * 
  *     def minimize_espresso(self, espresso_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses espresso to minimize the given CNF.
  */
 
   /* function exit code */
-  __pyx_r = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)Py_None); __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_12);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.minimize_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.minimize_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_espresso);
   __Pyx_XDECREF(__pyx_v_cnf);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":402
+/* "sat_toolkit/formula.pyx":653
  *             return cnf
  * 
- *     def _minimize_dimacs(self, args: List[str], outfile: str):             # <<<<<<<<<<<<<<
+ *     def _minimize_dimacs(self, args: List[str], outfile: str) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         calls args with self.to_dimacs() as stdin, waits for the command to
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_23_minimize_dimacs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_22_minimize_dimacs[] = "CNF._minimize_dimacs(self, args: List[str], unicode outfile: str)\n\n        calls args with self.to_dimacs() as stdin, waits for the command to\n        finish with exit code 10 or 20 and parses `outfile` as DIAMCS`.\n\n        :return: a new CNF object read from `outfile`\n        :rtype: CNF\n        ";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_23_minimize_dimacs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_31_minimize_dimacs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_30_minimize_dimacs[] = "CNF._minimize_dimacs(self, args: List[str], unicode outfile: str) -> CNF\n\n        calls args with self.to_dimacs() as stdin, waits for the command to\n        finish with exit code 10 or 20 and parses `outfile` as DIAMCS`.\n\n        :return: a new CNF object read from `outfile`\n        :rtype: CNF\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_31_minimize_dimacs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_args = 0;
   PyObject *__pyx_v_outfile = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  PyObject *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_minimize_dimacs (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_args,&__pyx_n_s_outfile,0};
     PyObject* values[2] = {0,0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
@@ -8803,54 +11798,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_outfile)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_minimize_dimacs", 1, 2, 2, 1); __PYX_ERR(0, 402, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_minimize_dimacs", 1, 2, 2, 1); __PYX_ERR(0, 653, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_minimize_dimacs") < 0)) __PYX_ERR(0, 402, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_minimize_dimacs") < 0)) __PYX_ERR(0, 653, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_args = values[0];
     __pyx_v_outfile = ((PyObject*)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_minimize_dimacs", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 402, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_minimize_dimacs", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 653, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF._minimize_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF._minimize_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_outfile), (&PyUnicode_Type), 1, "outfile", 1))) __PYX_ERR(0, 402, __pyx_L1_error)
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_22_minimize_dimacs(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), __pyx_v_args, __pyx_v_outfile);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_outfile), (&PyUnicode_Type), 1, "outfile", 1))) __PYX_ERR(0, 653, __pyx_L1_error)
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_30_minimize_dimacs(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), __pyx_v_args, __pyx_v_outfile);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_22_minimize_dimacs(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_args, PyObject *__pyx_v_outfile) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_30_minimize_dimacs(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_args, PyObject *__pyx_v_outfile) {
   int __pyx_v_ret_code;
   PyObject *__pyx_v_minimizer = NULL;
   PyObject *__pyx_v_f = NULL;
-  PyObject *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
@@ -8858,78 +11853,79 @@
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
   int __pyx_t_10;
   int __pyx_t_11;
   int __pyx_t_12;
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_t_15 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_minimize_dimacs", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":410
+  /* "sat_toolkit/formula.pyx":661
  *         :rtype: CNF
  *         """
  *         cdef int ret_code = 0             # <<<<<<<<<<<<<<
  *         with sp.Popen(args, stdin=sp.PIPE, text=True) as minimizer:
  *             minimizer.stdin.write(self.to_dimacs())
  */
   __pyx_v_ret_code = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":411
+  /* "sat_toolkit/formula.pyx":662
  *         """
  *         cdef int ret_code = 0
  *         with sp.Popen(args, stdin=sp.PIPE, text=True) as minimizer:             # <<<<<<<<<<<<<<
  *             minimizer.stdin.write(self.to_dimacs())
  *             minimizer.stdin.close()
  */
   /*with:*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Popen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Popen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_v_args);
     __Pyx_GIVEREF(__pyx_v_args);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_args);
-    __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdin, __pyx_t_5) < 0) __PYX_ERR(0, 411, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdin, __pyx_t_5) < 0) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_text, Py_True) < 0) __PYX_ERR(0, 411, __pyx_L1_error)
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 411, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_text, Py_True) < 0) __PYX_ERR(0, 662, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 662, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_enter); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 411, __pyx_L3_error)
+    __pyx_t_1 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_enter); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L3_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 411, __pyx_L3_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 662, __pyx_L3_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = __pyx_t_3;
     __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     /*try:*/ {
       {
@@ -8939,41 +11935,41 @@
         __Pyx_XGOTREF(__pyx_t_7);
         __Pyx_XGOTREF(__pyx_t_8);
         __Pyx_XGOTREF(__pyx_t_9);
         /*try:*/ {
           __pyx_v_minimizer = __pyx_t_1;
           __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":412
+          /* "sat_toolkit/formula.pyx":663
  *         cdef int ret_code = 0
  *         with sp.Popen(args, stdin=sp.PIPE, text=True) as minimizer:
  *             minimizer.stdin.write(self.to_dimacs())             # <<<<<<<<<<<<<<
  *             minimizer.stdin.close()
  * 
  */
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_minimizer, __pyx_n_s_stdin); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 412, __pyx_L7_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_minimizer, __pyx_n_s_stdin); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 663, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 412, __pyx_L7_error)
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 663, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_dimacs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 412, __pyx_L7_error)
+          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_dimacs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 663, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_2);
           __pyx_t_4 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
             __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
             if (likely(__pyx_t_4)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
               __Pyx_INCREF(__pyx_t_4);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_2, function);
             }
           }
           __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 412, __pyx_L7_error)
+          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 663, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_2 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
             __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
             if (likely(__pyx_t_2)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -8981,77 +11977,77 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_3, function);
             }
           }
           __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
           __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 412, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 663, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":413
+          /* "sat_toolkit/formula.pyx":664
  *         with sp.Popen(args, stdin=sp.PIPE, text=True) as minimizer:
  *             minimizer.stdin.write(self.to_dimacs())
  *             minimizer.stdin.close()             # <<<<<<<<<<<<<<
  * 
  *             ret_code = minimizer.wait()
  */
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_minimizer, __pyx_n_s_stdin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 413, __pyx_L7_error)
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_minimizer, __pyx_n_s_stdin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 664, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_close); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 413, __pyx_L7_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_close); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 664, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_3 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_3)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
               __Pyx_INCREF(__pyx_t_3);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 413, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 664, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":415
+          /* "sat_toolkit/formula.pyx":666
  *             minimizer.stdin.close()
  * 
  *             ret_code = minimizer.wait()             # <<<<<<<<<<<<<<
  *             if ret_code not in [10, 20]:
  *                 # for SAT solvers ret_code == 10 corresponds to SATISFIABLE and
  */
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_minimizer, __pyx_n_s_wait); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 415, __pyx_L7_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_minimizer, __pyx_n_s_wait); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 666, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_5);
           __pyx_t_3 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_3)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
               __Pyx_INCREF(__pyx_t_3);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 415, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 666, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 415, __pyx_L7_error)
+          __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 666, __pyx_L7_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_v_ret_code = __pyx_t_10;
 
-          /* "sat_toolkit/_cnf_util.pyx":416
+          /* "sat_toolkit/formula.pyx":667
  * 
  *             ret_code = minimizer.wait()
  *             if ret_code not in [10, 20]:             # <<<<<<<<<<<<<<
  *                 # for SAT solvers ret_code == 10 corresponds to SATISFIABLE and
  *                 # ret == 20 to UNSATISFIABLE (see for example
  */
           switch (__pyx_v_ret_code) {
@@ -9062,31 +12058,31 @@
             default:
             __pyx_t_11 = 1;
             break;
           }
           __pyx_t_12 = (__pyx_t_11 != 0);
           if (unlikely(__pyx_t_12)) {
 
-            /* "sat_toolkit/_cnf_util.pyx":420
+            /* "sat_toolkit/formula.pyx":671
  *                 # ret == 20 to UNSATISFIABLE (see for example
  *                 # http://www.satcompetition.org/2004/format-solvers2004.html)
  *                 raise sp.CalledProcessError(ret_code, ' '.join(minimizer.args))             # <<<<<<<<<<<<<<
  * 
  *         with open(outfile, 'r') as f:
  */
-            __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 420, __pyx_L7_error)
+            __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 671, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_5);
-            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_CalledProcessError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 420, __pyx_L7_error)
+            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_CalledProcessError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 671, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_ret_code); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 420, __pyx_L7_error)
+            __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_ret_code); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 671, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_5);
-            __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_minimizer, __pyx_n_s_args); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 420, __pyx_L7_error)
+            __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_minimizer, __pyx_n_s_args); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 671, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_2);
-            __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__8, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 420, __pyx_L7_error)
+            __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__7, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 671, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_4);
             __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             __pyx_t_2 = NULL;
             __pyx_t_10 = 0;
             if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
               __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
               if (likely(__pyx_t_2)) {
@@ -9096,62 +12092,62 @@
                 __Pyx_DECREF_SET(__pyx_t_3, function);
                 __pyx_t_10 = 1;
               }
             }
             #if CYTHON_FAST_PYCALL
             if (PyFunction_Check(__pyx_t_3)) {
               PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_t_5, __pyx_t_4};
-              __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 671, __pyx_L7_error)
               __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
             } else
             #endif
             #if CYTHON_FAST_PYCCALL
             if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
               PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_t_5, __pyx_t_4};
-              __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 671, __pyx_L7_error)
               __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
             } else
             #endif
             {
-              __pyx_t_13 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 420, __pyx_L7_error)
+              __pyx_t_13 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 671, __pyx_L7_error)
               __Pyx_GOTREF(__pyx_t_13);
               if (__pyx_t_2) {
                 __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_2); __pyx_t_2 = NULL;
               }
               __Pyx_GIVEREF(__pyx_t_5);
               PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_10, __pyx_t_5);
               __Pyx_GIVEREF(__pyx_t_4);
               PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_10, __pyx_t_4);
               __pyx_t_5 = 0;
               __pyx_t_4 = 0;
-              __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_13, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_13, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 671, __pyx_L7_error)
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
             }
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             __Pyx_Raise(__pyx_t_1, 0, 0, 0);
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-            __PYX_ERR(0, 420, __pyx_L7_error)
+            __PYX_ERR(0, 671, __pyx_L7_error)
 
-            /* "sat_toolkit/_cnf_util.pyx":416
+            /* "sat_toolkit/formula.pyx":667
  * 
  *             ret_code = minimizer.wait()
  *             if ret_code not in [10, 20]:             # <<<<<<<<<<<<<<
  *                 # for SAT solvers ret_code == 10 corresponds to SATISFIABLE and
  *                 # ret == 20 to UNSATISFIABLE (see for example
  */
           }
 
-          /* "sat_toolkit/_cnf_util.pyx":411
+          /* "sat_toolkit/formula.pyx":662
  *         """
  *         cdef int ret_code = 0
  *         with sp.Popen(args, stdin=sp.PIPE, text=True) as minimizer:             # <<<<<<<<<<<<<<
  *             minimizer.stdin.write(self.to_dimacs())
  *             minimizer.stdin.close()
  */
         }
@@ -9163,37 +12159,37 @@
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         /*except:*/ {
-          __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF._minimize_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_3, &__pyx_t_13) < 0) __PYX_ERR(0, 411, __pyx_L9_except_error)
+          __Pyx_AddTraceback("sat_toolkit.formula.CNF._minimize_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
+          if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_3, &__pyx_t_13) < 0) __PYX_ERR(0, 662, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_GOTREF(__pyx_t_13);
-          __pyx_t_4 = PyTuple_Pack(3, __pyx_t_1, __pyx_t_3, __pyx_t_13); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 411, __pyx_L9_except_error)
+          __pyx_t_4 = PyTuple_Pack(3, __pyx_t_1, __pyx_t_3, __pyx_t_13); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 662, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_4);
           __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 411, __pyx_L9_except_error)
+          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 662, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_14);
           __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          if (__pyx_t_12 < 0) __PYX_ERR(0, 411, __pyx_L9_except_error)
+          if (__pyx_t_12 < 0) __PYX_ERR(0, 662, __pyx_L9_except_error)
           __pyx_t_11 = ((!(__pyx_t_12 != 0)) != 0);
           if (__pyx_t_11) {
             __Pyx_GIVEREF(__pyx_t_1);
             __Pyx_GIVEREF(__pyx_t_3);
             __Pyx_XGIVEREF(__pyx_t_13);
             __Pyx_ErrRestoreWithState(__pyx_t_1, __pyx_t_3, __pyx_t_13);
             __pyx_t_1 = 0; __pyx_t_3 = 0; __pyx_t_13 = 0; 
-            __PYX_ERR(0, 411, __pyx_L9_except_error)
+            __PYX_ERR(0, 662, __pyx_L9_except_error)
           }
           __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
           goto __pyx_L8_exception_handled;
         }
         __pyx_L9_except_error:;
@@ -9209,67 +12205,67 @@
         __Pyx_ExceptionReset(__pyx_t_7, __pyx_t_8, __pyx_t_9);
         __pyx_L12_try_end:;
       }
     }
     /*finally:*/ {
       /*normal exit:*/{
         if (__pyx_t_6) {
-          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 411, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 662, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         }
         goto __pyx_L6;
       }
       __pyx_L6:;
     }
     goto __pyx_L17;
     __pyx_L3_error:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L1_error;
     __pyx_L17:;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":422
+  /* "sat_toolkit/formula.pyx":673
  *                 raise sp.CalledProcessError(ret_code, ' '.join(minimizer.args))
  * 
  *         with open(outfile, 'r') as f:             # <<<<<<<<<<<<<<
  *             return CNF.from_dimacs(f.read())
  * 
  */
   /*with:*/ {
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 422, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 673, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_INCREF(__pyx_v_outfile);
     __Pyx_GIVEREF(__pyx_v_outfile);
     PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_v_outfile);
     __Pyx_INCREF(__pyx_n_u_r);
     __Pyx_GIVEREF(__pyx_n_u_r);
     PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_n_u_r);
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_13, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 422, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_13, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 673, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_3, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 422, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_3, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 673, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = __Pyx_PyObject_LookupSpecial(__pyx_t_3, __pyx_n_s_enter); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 422, __pyx_L18_error)
+    __pyx_t_1 = __Pyx_PyObject_LookupSpecial(__pyx_t_3, __pyx_n_s_enter); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 673, __pyx_L18_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_13 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 422, __pyx_L18_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 673, __pyx_L18_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = __pyx_t_13;
     __pyx_t_13 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     /*try:*/ {
       {
@@ -9279,39 +12275,39 @@
         __Pyx_XGOTREF(__pyx_t_9);
         __Pyx_XGOTREF(__pyx_t_8);
         __Pyx_XGOTREF(__pyx_t_7);
         /*try:*/ {
           __pyx_v_f = __pyx_t_1;
           __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":423
+          /* "sat_toolkit/formula.pyx":674
  * 
  *         with open(outfile, 'r') as f:
  *             return CNF.from_dimacs(f.read())             # <<<<<<<<<<<<<<
  * 
  *     def minimize_lingeling(self, optlevel=None, timeout=0, extra_args: List[str] = []) -> CNF:
  */
-          __Pyx_XDECREF(__pyx_r);
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF), __pyx_n_s_from_dimacs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 423, __pyx_L22_error)
+          __Pyx_XDECREF(((PyObject *)__pyx_r));
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_n_s_from_dimacs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 674, __pyx_L22_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_read); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 423, __pyx_L22_error)
+          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_read); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 674, __pyx_L22_error)
           __Pyx_GOTREF(__pyx_t_4);
           __pyx_t_5 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
             if (likely(__pyx_t_5)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
               __Pyx_INCREF(__pyx_t_5);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_4, function);
             }
           }
           __pyx_t_13 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 423, __pyx_L22_error)
+          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 674, __pyx_L22_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_4 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
             __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
             if (likely(__pyx_t_4)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -9319,22 +12315,23 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_3, function);
             }
           }
           __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_13) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_13);
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 423, __pyx_L22_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 674, __pyx_L22_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          __pyx_r = __pyx_t_1;
+          if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_11sat_toolkit_7formula_CNF))))) __PYX_ERR(0, 674, __pyx_L22_error)
+          __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L26_try_return;
 
-          /* "sat_toolkit/_cnf_util.pyx":422
+          /* "sat_toolkit/formula.pyx":673
  *                 raise sp.CalledProcessError(ret_code, ' '.join(minimizer.args))
  * 
  *         with open(outfile, 'r') as f:             # <<<<<<<<<<<<<<
  *             return CNF.from_dimacs(f.read())
  * 
  */
         }
@@ -9342,37 +12339,37 @@
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         /*except:*/ {
-          __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF._minimize_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_3, &__pyx_t_13) < 0) __PYX_ERR(0, 422, __pyx_L24_except_error)
+          __Pyx_AddTraceback("sat_toolkit.formula.CNF._minimize_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
+          if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_3, &__pyx_t_13) < 0) __PYX_ERR(0, 673, __pyx_L24_except_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_GOTREF(__pyx_t_13);
-          __pyx_t_4 = PyTuple_Pack(3, __pyx_t_1, __pyx_t_3, __pyx_t_13); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 422, __pyx_L24_except_error)
+          __pyx_t_4 = PyTuple_Pack(3, __pyx_t_1, __pyx_t_3, __pyx_t_13); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 673, __pyx_L24_except_error)
           __Pyx_GOTREF(__pyx_t_4);
           __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 422, __pyx_L24_except_error)
+          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 673, __pyx_L24_except_error)
           __Pyx_GOTREF(__pyx_t_14);
           __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          if (__pyx_t_11 < 0) __PYX_ERR(0, 422, __pyx_L24_except_error)
+          if (__pyx_t_11 < 0) __PYX_ERR(0, 673, __pyx_L24_except_error)
           __pyx_t_12 = ((!(__pyx_t_11 != 0)) != 0);
           if (__pyx_t_12) {
             __Pyx_GIVEREF(__pyx_t_1);
             __Pyx_GIVEREF(__pyx_t_3);
             __Pyx_XGIVEREF(__pyx_t_13);
             __Pyx_ErrRestoreWithState(__pyx_t_1, __pyx_t_3, __pyx_t_13);
             __pyx_t_1 = 0; __pyx_t_3 = 0; __pyx_t_13 = 0; 
-            __PYX_ERR(0, 422, __pyx_L24_except_error)
+            __PYX_ERR(0, 673, __pyx_L24_except_error)
           }
           __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
           goto __pyx_L23_exception_handled;
         }
         __pyx_L24_except_error:;
@@ -9393,100 +12390,100 @@
         __Pyx_XGIVEREF(__pyx_t_7);
         __Pyx_ExceptionReset(__pyx_t_9, __pyx_t_8, __pyx_t_7);
       }
     }
     /*finally:*/ {
       /*normal exit:*/{
         if (__pyx_t_6) {
-          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 422, __pyx_L1_error)
+          if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 673, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         goto __pyx_L21;
       }
       __pyx_L19_return: {
-        __pyx_t_7 = __pyx_r;
+        __pyx_t_15 = __pyx_r;
         __pyx_r = 0;
         if (__pyx_t_6) {
-          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 422, __pyx_L1_error)
-          __Pyx_GOTREF(__pyx_t_8);
-          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+          if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 673, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_7);
+          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
-        __pyx_r = __pyx_t_7;
-        __pyx_t_7 = 0;
+        __pyx_r = __pyx_t_15;
+        __pyx_t_15 = 0;
         goto __pyx_L0;
       }
       __pyx_L21:;
     }
     goto __pyx_L31;
     __pyx_L18_error:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L1_error;
     __pyx_L31:;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":402
+  /* "sat_toolkit/formula.pyx":653
  *             return cnf
  * 
- *     def _minimize_dimacs(self, args: List[str], outfile: str):             # <<<<<<<<<<<<<<
+ *     def _minimize_dimacs(self, args: List[str], outfile: str) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         calls args with self.to_dimacs() as stdin, waits for the command to
  */
 
   /* function exit code */
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)Py_None); __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_13);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF._minimize_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF._minimize_dimacs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_minimizer);
   __Pyx_XDECREF(__pyx_v_f);
-  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":425
+/* "sat_toolkit/formula.pyx":676
  *             return CNF.from_dimacs(f.read())
  * 
  *     def minimize_lingeling(self, optlevel=None, timeout=0, extra_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses Lingeling to minimize the given CNF.
  */
 
 /* Python wrapper */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_25minimize_lingeling(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_24minimize_lingeling[] = "CNF.minimize_lingeling(self, optlevel=None, timeout=0, extra_args: List[str] = []) -> CNF\n\n        Uses Lingeling to minimize the given CNF.\n\n        :param optlevel: optimization level given to Lingeling via -O<optlevel>\n        :param timeout: timeout given to Lingeling via -T <timeout>\n        :param extra_args: extra parameters given when calling Lingeling, defaults to []\n\n        :return: a new CNF object minimized by Lingeling\n        :rtype: CNF\n        ";
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_25minimize_lingeling(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_33minimize_lingeling(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_32minimize_lingeling[] = "CNF.minimize_lingeling(self, optlevel=None, timeout=0, extra_args: List[str] = []) -> CNF\n\n        Uses Lingeling to minimize the given CNF.\n\n        :param optlevel: optimization level given to Lingeling via -O<optlevel>\n        :param timeout: timeout given to Lingeling via -T <timeout>\n        :param extra_args: extra parameters given when calling Lingeling, defaults to []\n\n        :return: a new CNF object minimized by Lingeling\n        :rtype: CNF\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_33minimize_lingeling(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_optlevel = 0;
   PyObject *__pyx_v_timeout = 0;
   PyObject *__pyx_v_extra_args = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("minimize_lingeling (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_optlevel,&__pyx_n_s_timeout,&__pyx_n_s_extra_args,0};
     PyObject* values[3] = {0,0,0};
     values[0] = ((PyObject *)Py_None);
     values[1] = ((PyObject *)__pyx_int_0);
-    values[2] = __pyx_k__16;
+    values[2] = __pyx_k__20;
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
@@ -9513,15 +12510,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_extra_args);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "minimize_lingeling") < 0)) __PYX_ERR(0, 425, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "minimize_lingeling") < 0)) __PYX_ERR(0, 676, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -9533,200 +12530,200 @@
     }
     __pyx_v_optlevel = values[0];
     __pyx_v_timeout = values[1];
     __pyx_v_extra_args = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("minimize_lingeling", 0, 0, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 425, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("minimize_lingeling", 0, 0, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 676, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.minimize_lingeling", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.minimize_lingeling", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_24minimize_lingeling(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), __pyx_v_optlevel, __pyx_v_timeout, __pyx_v_extra_args);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_32minimize_lingeling(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), __pyx_v_optlevel, __pyx_v_timeout, __pyx_v_extra_args);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_24minimize_lingeling(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_optlevel, PyObject *__pyx_v_timeout, PyObject *__pyx_v_extra_args) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_32minimize_lingeling(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_optlevel, PyObject *__pyx_v_timeout, PyObject *__pyx_v_extra_args) {
   CYTHON_UNUSED int __pyx_v_ret_code;
   PyObject *__pyx_v_args = NULL;
   PyObject *__pyx_v_f = NULL;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
   PyObject *__pyx_t_10 = NULL;
   int __pyx_t_11;
   PyObject *__pyx_t_12 = NULL;
   PyObject *__pyx_t_13 = NULL;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_t_14 = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("minimize_lingeling", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":436
+  /* "sat_toolkit/formula.pyx":687
  *         :rtype: CNF
  *         """
  *         cdef int ret_code = 0             # <<<<<<<<<<<<<<
  * 
  *         args = ['lingeling', '-s']
  */
   __pyx_v_ret_code = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":438
+  /* "sat_toolkit/formula.pyx":689
  *         cdef int ret_code = 0
  * 
  *         args = ['lingeling', '-s']             # <<<<<<<<<<<<<<
  *         if optlevel is not None:
  *             args += [f'-O{optlevel}']
  */
-  __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 438, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 689, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_n_u_lingeling);
   __Pyx_GIVEREF(__pyx_n_u_lingeling);
   PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_lingeling);
   __Pyx_INCREF(__pyx_kp_u_s);
   __Pyx_GIVEREF(__pyx_kp_u_s);
   PyList_SET_ITEM(__pyx_t_1, 1, __pyx_kp_u_s);
   __pyx_v_args = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":439
+  /* "sat_toolkit/formula.pyx":690
  * 
  *         args = ['lingeling', '-s']
  *         if optlevel is not None:             # <<<<<<<<<<<<<<
  *             args += [f'-O{optlevel}']
  *         if timeout is not None:
  */
   __pyx_t_2 = (__pyx_v_optlevel != Py_None);
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "sat_toolkit/_cnf_util.pyx":440
+    /* "sat_toolkit/formula.pyx":691
  *         args = ['lingeling', '-s']
  *         if optlevel is not None:
  *             args += [f'-O{optlevel}']             # <<<<<<<<<<<<<<
  *         if timeout is not None:
  *             args += ['-T', f'{timeout}']
  */
-    __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_v_optlevel, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 440, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_v_optlevel, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 691, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_O, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 440, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_O, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 691, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 440, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 691, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_4);
     PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_args, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 440, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_args, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 691, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF_SET(__pyx_v_args, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":439
+    /* "sat_toolkit/formula.pyx":690
  * 
  *         args = ['lingeling', '-s']
  *         if optlevel is not None:             # <<<<<<<<<<<<<<
  *             args += [f'-O{optlevel}']
  *         if timeout is not None:
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":441
+  /* "sat_toolkit/formula.pyx":692
  *         if optlevel is not None:
  *             args += [f'-O{optlevel}']
  *         if timeout is not None:             # <<<<<<<<<<<<<<
  *             args += ['-T', f'{timeout}']
  * 
  */
   __pyx_t_3 = (__pyx_v_timeout != Py_None);
   __pyx_t_2 = (__pyx_t_3 != 0);
   if (__pyx_t_2) {
 
-    /* "sat_toolkit/_cnf_util.pyx":442
+    /* "sat_toolkit/formula.pyx":693
  *             args += [f'-O{optlevel}']
  *         if timeout is not None:
  *             args += ['-T', f'{timeout}']             # <<<<<<<<<<<<<<
  * 
  *         with NamedTemporaryFile(prefix='lingeling_', suffix='.dimacs') as f:
  */
-    __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_v_timeout, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_v_timeout, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 693, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 442, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 693, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_kp_u_T);
     __Pyx_GIVEREF(__pyx_kp_u_T);
     PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_T);
     __Pyx_GIVEREF(__pyx_t_4);
     PyList_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_args, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_args, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 693, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF_SET(__pyx_v_args, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":441
+    /* "sat_toolkit/formula.pyx":692
  *         if optlevel is not None:
  *             args += [f'-O{optlevel}']
  *         if timeout is not None:             # <<<<<<<<<<<<<<
  *             args += ['-T', f'{timeout}']
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":444
+  /* "sat_toolkit/formula.pyx":695
  *             args += ['-T', f'{timeout}']
  * 
  *         with NamedTemporaryFile(prefix='lingeling_', suffix='.dimacs') as f:             # <<<<<<<<<<<<<<
  *             args += ['-o', f.name]
  *             args += extra_args
  */
   /*with:*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_NamedTemporaryFile); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 444, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_NamedTemporaryFile); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 695, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 444, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 695, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_prefix, __pyx_n_u_lingeling_2) < 0) __PYX_ERR(0, 444, __pyx_L1_error)
-    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_suffix, __pyx_kp_u_dimacs_2) < 0) __PYX_ERR(0, 444, __pyx_L1_error)
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 444, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_prefix, __pyx_n_u_lingeling_2) < 0) __PYX_ERR(0, 695, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_suffix, __pyx_kp_u_dimacs_2) < 0) __PYX_ERR(0, 695, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 695, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 444, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 695, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 444, __pyx_L5_error)
+    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 695, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_7);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 444, __pyx_L5_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 695, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = __pyx_t_1;
     __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     /*try:*/ {
       {
@@ -9736,60 +12733,60 @@
         __Pyx_XGOTREF(__pyx_t_8);
         __Pyx_XGOTREF(__pyx_t_9);
         __Pyx_XGOTREF(__pyx_t_10);
         /*try:*/ {
           __pyx_v_f = __pyx_t_4;
           __pyx_t_4 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":445
+          /* "sat_toolkit/formula.pyx":696
  * 
  *         with NamedTemporaryFile(prefix='lingeling_', suffix='.dimacs') as f:
  *             args += ['-o', f.name]             # <<<<<<<<<<<<<<
  *             args += extra_args
  *             return self._minimize_dimacs(args, f.name)
  */
-          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 445, __pyx_L9_error)
+          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 696, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 445, __pyx_L9_error)
+          __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 696, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_INCREF(__pyx_kp_u_o);
           __Pyx_GIVEREF(__pyx_kp_u_o);
           PyList_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_o);
           __Pyx_GIVEREF(__pyx_t_4);
           PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
           __pyx_t_4 = 0;
-          __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_args, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 445, __pyx_L9_error)
+          __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_args, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 696, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF_SET(__pyx_v_args, __pyx_t_4);
           __pyx_t_4 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":446
+          /* "sat_toolkit/formula.pyx":697
  *         with NamedTemporaryFile(prefix='lingeling_', suffix='.dimacs') as f:
  *             args += ['-o', f.name]
  *             args += extra_args             # <<<<<<<<<<<<<<
  *             return self._minimize_dimacs(args, f.name)
  * 
  */
-          __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_args, __pyx_v_extra_args); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 446, __pyx_L9_error)
+          __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_args, __pyx_v_extra_args); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 697, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF_SET(__pyx_v_args, __pyx_t_4);
           __pyx_t_4 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":447
+          /* "sat_toolkit/formula.pyx":698
  *             args += ['-o', f.name]
  *             args += extra_args
  *             return self._minimize_dimacs(args, f.name)             # <<<<<<<<<<<<<<
  * 
- * 
+ *     def check_solution(self, uint8_t[:] solution) -> bool:
  */
           __Pyx_XDECREF(((PyObject *)__pyx_r));
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_minimize_dimacs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 447, __pyx_L9_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_minimize_dimacs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 698, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 447, __pyx_L9_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 698, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_1);
           __pyx_t_7 = NULL;
           __pyx_t_11 = 0;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_7)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -9798,89 +12795,89 @@
               __Pyx_DECREF_SET(__pyx_t_5, function);
               __pyx_t_11 = 1;
             }
           }
           #if CYTHON_FAST_PYCALL
           if (PyFunction_Check(__pyx_t_5)) {
             PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_v_args, __pyx_t_1};
-            __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 447, __pyx_L9_error)
+            __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 698, __pyx_L9_error)
             __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
             __Pyx_GOTREF(__pyx_t_4);
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           } else
           #endif
           #if CYTHON_FAST_PYCCALL
           if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
             PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_v_args, __pyx_t_1};
-            __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 447, __pyx_L9_error)
+            __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 698, __pyx_L9_error)
             __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
             __Pyx_GOTREF(__pyx_t_4);
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           } else
           #endif
           {
-            __pyx_t_12 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 447, __pyx_L9_error)
+            __pyx_t_12 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 698, __pyx_L9_error)
             __Pyx_GOTREF(__pyx_t_12);
             if (__pyx_t_7) {
               __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_7); __pyx_t_7 = NULL;
             }
             __Pyx_INCREF(__pyx_v_args);
             __Pyx_GIVEREF(__pyx_v_args);
             PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_v_args);
             __Pyx_GIVEREF(__pyx_t_1);
             PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_t_1);
             __pyx_t_1 = 0;
-            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_12, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 447, __pyx_L9_error)
+            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_12, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 698, __pyx_L9_error)
             __Pyx_GOTREF(__pyx_t_4);
             __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
           }
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_11sat_toolkit_9_cnf_util_CNF))))) __PYX_ERR(0, 447, __pyx_L9_error)
-          __pyx_r = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_t_4);
+          if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_11sat_toolkit_7formula_CNF))))) __PYX_ERR(0, 698, __pyx_L9_error)
+          __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_4);
           __pyx_t_4 = 0;
           goto __pyx_L13_try_return;
 
-          /* "sat_toolkit/_cnf_util.pyx":444
+          /* "sat_toolkit/formula.pyx":695
  *             args += ['-T', f'{timeout}']
  * 
  *         with NamedTemporaryFile(prefix='lingeling_', suffix='.dimacs') as f:             # <<<<<<<<<<<<<<
  *             args += ['-o', f.name]
  *             args += extra_args
  */
         }
         __pyx_L9_error:;
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         /*except:*/ {
-          __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.minimize_lingeling", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_12) < 0) __PYX_ERR(0, 444, __pyx_L11_except_error)
+          __Pyx_AddTraceback("sat_toolkit.formula.CNF.minimize_lingeling", __pyx_clineno, __pyx_lineno, __pyx_filename);
+          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_12) < 0) __PYX_ERR(0, 695, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_GOTREF(__pyx_t_12);
-          __pyx_t_1 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_5, __pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 444, __pyx_L11_except_error)
+          __pyx_t_1 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_5, __pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 695, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_1);
           __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 444, __pyx_L11_except_error)
+          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 695, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_13);
           __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          if (__pyx_t_2 < 0) __PYX_ERR(0, 444, __pyx_L11_except_error)
+          if (__pyx_t_2 < 0) __PYX_ERR(0, 695, __pyx_L11_except_error)
           __pyx_t_3 = ((!(__pyx_t_2 != 0)) != 0);
           if (__pyx_t_3) {
             __Pyx_GIVEREF(__pyx_t_4);
             __Pyx_GIVEREF(__pyx_t_5);
             __Pyx_XGIVEREF(__pyx_t_12);
             __Pyx_ErrRestoreWithState(__pyx_t_4, __pyx_t_5, __pyx_t_12);
             __pyx_t_4 = 0; __pyx_t_5 = 0; __pyx_t_12 = 0; 
-            __PYX_ERR(0, 444, __pyx_L11_except_error)
+            __PYX_ERR(0, 695, __pyx_L11_except_error)
           }
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
           goto __pyx_L10_exception_handled;
         }
         __pyx_L11_except_error:;
@@ -9901,29 +12898,29 @@
         __Pyx_XGIVEREF(__pyx_t_10);
         __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
       }
     }
     /*finally:*/ {
       /*normal exit:*/{
         if (__pyx_t_6) {
-          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 444, __pyx_L1_error)
+          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 695, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_10);
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         }
         goto __pyx_L8;
       }
       __pyx_L6_return: {
         __pyx_t_14 = __pyx_r;
         __pyx_r = 0;
         if (__pyx_t_6) {
-          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 444, __pyx_L1_error)
+          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 695, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_10);
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         }
         __pyx_r = __pyx_t_14;
         __pyx_t_14 = 0;
         goto __pyx_L0;
       }
@@ -9932,107 +12929,992 @@
     goto __pyx_L18;
     __pyx_L5_error:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L1_error;
     __pyx_L18:;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":425
+  /* "sat_toolkit/formula.pyx":676
  *             return CNF.from_dimacs(f.read())
  * 
  *     def minimize_lingeling(self, optlevel=None, timeout=0, extra_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses Lingeling to minimize the given CNF.
  */
 
   /* function exit code */
-  __pyx_r = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)Py_None); __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_12);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.minimize_lingeling", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.minimize_lingeling", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_args);
   __Pyx_XDECREF(__pyx_v_f);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":450
+/* "sat_toolkit/formula.pyx":700
+ *             return self._minimize_dimacs(args, f.name)
+ * 
+ *     def check_solution(self, uint8_t[:] solution) -> bool:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ *         for i in range(solution_len):
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_35check_solution(PyObject *__pyx_v_self, PyObject *__pyx_arg_solution); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_34check_solution[] = "CNF.check_solution(self, uint8_t[:] solution) -> bool";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_35check_solution(PyObject *__pyx_v_self, PyObject *__pyx_arg_solution) {
+  __Pyx_memviewslice __pyx_v_solution = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("check_solution (wrapper)", 0);
+  assert(__pyx_arg_solution); {
+    __pyx_v_solution = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_11sat_toolkit_5types_uint8_t(__pyx_arg_solution, PyBUF_WRITABLE); if (unlikely(!__pyx_v_solution.memview)) __PYX_ERR(0, 700, __pyx_L3_error)
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.check_solution", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_34check_solution(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), __pyx_v_solution);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_34check_solution(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_solution) {
+  size_t __pyx_v_i;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  long __pyx_t_2;
+  long __pyx_t_3;
+  size_t __pyx_t_4;
+  size_t __pyx_t_5;
+  __pyx_t_11sat_toolkit_5types_uint8_t __pyx_t_6;
+  int __pyx_t_7;
+  int __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("check_solution", 0);
+
+  /* "sat_toolkit/formula.pyx":702
+ *     def check_solution(self, uint8_t[:] solution) -> bool:
+ *         cdef size_t i
+ *         for i in range(solution_len):             # <<<<<<<<<<<<<<
+ *            if solution[i] not in [0, 1]:
+ *                raise ValueError(f'all elements in solution must be in [0, 1]')
+ */
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_solution_len); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyInt_As_long(__pyx_t_1); if (unlikely((__pyx_t_2 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 702, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_3 = __pyx_t_2;
+  for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
+    __pyx_v_i = __pyx_t_4;
+
+    /* "sat_toolkit/formula.pyx":703
+ *         cdef size_t i
+ *         for i in range(solution_len):
+ *            if solution[i] not in [0, 1]:             # <<<<<<<<<<<<<<
+ *                raise ValueError(f'all elements in solution must be in [0, 1]')
+ * 
+ */
+    __pyx_t_5 = __pyx_v_i;
+    __pyx_t_6 = (*((__pyx_t_11sat_toolkit_5types_uint8_t *) ( /* dim=0 */ (__pyx_v_solution.data + __pyx_t_5 * __pyx_v_solution.strides[0]) )));
+    __pyx_t_8 = ((__pyx_t_6 != 0) != 0);
+    if (__pyx_t_8) {
+    } else {
+      __pyx_t_7 = __pyx_t_8;
+      goto __pyx_L6_bool_binop_done;
+    }
+    __pyx_t_8 = ((__pyx_t_6 != 1) != 0);
+    __pyx_t_7 = __pyx_t_8;
+    __pyx_L6_bool_binop_done:;
+    __pyx_t_8 = (__pyx_t_7 != 0);
+    if (unlikely(__pyx_t_8)) {
+
+      /* "sat_toolkit/formula.pyx":704
+ *         for i in range(solution_len):
+ *            if solution[i] not in [0, 1]:
+ *                raise ValueError(f'all elements in solution must be in [0, 1]')             # <<<<<<<<<<<<<<
+ * 
+ *         return self._check_solution(solution)
+ */
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 704, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __PYX_ERR(0, 704, __pyx_L1_error)
+
+      /* "sat_toolkit/formula.pyx":703
+ *         cdef size_t i
+ *         for i in range(solution_len):
+ *            if solution[i] not in [0, 1]:             # <<<<<<<<<<<<<<
+ *                raise ValueError(f'all elements in solution must be in [0, 1]')
+ * 
+ */
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":706
+ *                raise ValueError(f'all elements in solution must be in [0, 1]')
+ * 
+ *         return self._check_solution(solution)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef int _check_solution(self, uint8_t[:] solution) nogil except -1:
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_9 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_check_solution(__pyx_v_self, __pyx_v_solution); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 706, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 706, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":700
+ *             return self._minimize_dimacs(args, f.name)
+ * 
+ *     def check_solution(self, uint8_t[:] solution) -> bool:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ *         for i in range(solution_len):
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.check_solution", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __PYX_XDEC_MEMVIEW(&__pyx_v_solution, 1);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":708
+ *         return self._check_solution(solution)
+ * 
+ *     cdef int _check_solution(self, uint8_t[:] solution) nogil except -1:             # <<<<<<<<<<<<<<
+ *         cdef size_t i, clause_pos, clause_elem
+ *         cdef uint8_t expected
+ */
+
+static int __pyx_f_11sat_toolkit_7formula_3CNF__check_solution(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, __Pyx_memviewslice __pyx_v_solution) {
+  size_t __pyx_v_i;
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  Py_ssize_t __pyx_t_3;
+  Py_UCS4 __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  std::vector<size_t> ::size_type __pyx_t_6;
+  std::vector<size_t> ::size_type __pyx_t_7;
+  size_t __pyx_t_8;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_RefNannySetupContext("_check_solution", 0);
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+
+  /* "sat_toolkit/formula.pyx":709
+ * 
+ *     cdef int _check_solution(self, uint8_t[:] solution) nogil except -1:
+ *         cdef size_t i, clause_pos, clause_elem             # <<<<<<<<<<<<<<
+ *         cdef uint8_t expected
+ * 
+ */
+  /*try:*/ {
+
+    /* "sat_toolkit/formula.pyx":712
+ *         cdef uint8_t expected
+ * 
+ *         if self.nvars >= solution.shape[0]:             # <<<<<<<<<<<<<<
+ *             raise IndexError(f'solution of length {solution.shape[0]} too short for CNF with {self.nvars} variables')
+ * 
+ */
+    __pyx_t_1 = ((__pyx_v_self->nvars >= (__pyx_v_solution.shape[0])) != 0);
+    if (__pyx_t_1) {
+
+      /* "sat_toolkit/formula.pyx":713
+ * 
+ *         if self.nvars >= solution.shape[0]:
+ *             raise IndexError(f'solution of length {solution.shape[0]} too short for CNF with {self.nvars} variables')             # <<<<<<<<<<<<<<
+ * 
+ *         for i in range(self.start_indices.size()):
+ */
+      {
+          #ifdef WITH_THREAD
+          PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+          #endif
+          /*try:*/ {
+            __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 713, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_2);
+            __pyx_t_3 = 0;
+            __pyx_t_4 = 127;
+            __Pyx_INCREF(__pyx_kp_u_solution_of_length);
+            __pyx_t_3 += 19;
+            __Pyx_GIVEREF(__pyx_kp_u_solution_of_length);
+            PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_solution_of_length);
+            __pyx_t_5 = __Pyx_PyUnicode_From_Py_ssize_t((__pyx_v_solution.shape[0]), 0, ' ', 'd'); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 713, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_5);
+            __pyx_t_3 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
+            __Pyx_GIVEREF(__pyx_t_5);
+            PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
+            __pyx_t_5 = 0;
+            __Pyx_INCREF(__pyx_kp_u_too_short_for_CNF_with);
+            __pyx_t_3 += 24;
+            __Pyx_GIVEREF(__pyx_kp_u_too_short_for_CNF_with);
+            PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u_too_short_for_CNF_with);
+            __pyx_t_5 = __Pyx_PyUnicode_From_int(__pyx_v_self->nvars, 0, ' ', 'd'); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 713, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_5);
+            __pyx_t_3 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
+            __Pyx_GIVEREF(__pyx_t_5);
+            PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_5);
+            __pyx_t_5 = 0;
+            __Pyx_INCREF(__pyx_kp_u_variables);
+            __pyx_t_3 += 10;
+            __Pyx_GIVEREF(__pyx_kp_u_variables);
+            PyTuple_SET_ITEM(__pyx_t_2, 4, __pyx_kp_u_variables);
+            __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_2, 5, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 713, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_5);
+            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+            __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IndexError, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 713, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_2);
+            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+            __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+            __PYX_ERR(0, 713, __pyx_L8_error)
+          }
+          /*finally:*/ {
+            __pyx_L8_error: {
+              #ifdef WITH_THREAD
+              __Pyx_PyGILState_Release(__pyx_gilstate_save);
+              #endif
+              goto __pyx_L4_error;
+            }
+          }
+      }
+
+      /* "sat_toolkit/formula.pyx":712
+ *         cdef uint8_t expected
+ * 
+ *         if self.nvars >= solution.shape[0]:             # <<<<<<<<<<<<<<
+ *             raise IndexError(f'solution of length {solution.shape[0]} too short for CNF with {self.nvars} variables')
+ * 
+ */
+    }
+
+    /* "sat_toolkit/formula.pyx":715
+ *             raise IndexError(f'solution of length {solution.shape[0]} too short for CNF with {self.nvars} variables')
+ * 
+ *         for i in range(self.start_indices.size()):             # <<<<<<<<<<<<<<
+ *             if not self._check_solution_for_single_clause(i, solution):
+ *                 return 0
+ */
+    __pyx_t_6 = __pyx_v_self->start_indices.size();
+    __pyx_t_7 = __pyx_t_6;
+    for (__pyx_t_8 = 0; __pyx_t_8 < __pyx_t_7; __pyx_t_8+=1) {
+      __pyx_v_i = __pyx_t_8;
+
+      /* "sat_toolkit/formula.pyx":716
+ * 
+ *         for i in range(self.start_indices.size()):
+ *             if not self._check_solution_for_single_clause(i, solution):             # <<<<<<<<<<<<<<
+ *                 return 0
+ * 
+ */
+      __pyx_t_1 = ((!(((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_check_solution_for_single_clause(__pyx_v_self, __pyx_v_i, __pyx_v_solution) != 0)) != 0);
+      if (__pyx_t_1) {
+
+        /* "sat_toolkit/formula.pyx":717
+ *         for i in range(self.start_indices.size()):
+ *             if not self._check_solution_for_single_clause(i, solution):
+ *                 return 0             # <<<<<<<<<<<<<<
+ * 
+ *         return 1
+ */
+        __pyx_r = 0;
+        goto __pyx_L3_return;
+
+        /* "sat_toolkit/formula.pyx":716
+ * 
+ *         for i in range(self.start_indices.size()):
+ *             if not self._check_solution_for_single_clause(i, solution):             # <<<<<<<<<<<<<<
+ *                 return 0
+ * 
+ */
+      }
+    }
+
+    /* "sat_toolkit/formula.pyx":719
+ *                 return 0
+ * 
+ *         return 1             # <<<<<<<<<<<<<<
+ * 
+ *     cdef int _check_solution_for_single_clause(self, size_t clause_idx, uint8_t[:] solution) nogil:
+ */
+    __pyx_r = 1;
+    goto __pyx_L3_return;
+  }
+
+  /* "sat_toolkit/formula.pyx":709
+ * 
+ *     cdef int _check_solution(self, uint8_t[:] solution) nogil except -1:
+ *         cdef size_t i, clause_pos, clause_elem             # <<<<<<<<<<<<<<
+ *         cdef uint8_t expected
+ * 
+ */
+  /*finally:*/ {
+    __pyx_L3_return: {
+      #ifdef WITH_THREAD
+      __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+      #endif
+      goto __pyx_L0;
+    }
+    __pyx_L4_error: {
+      #ifdef WITH_THREAD
+      __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+      #endif
+      goto __pyx_L1_error;
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":708
+ *         return self._check_solution(solution)
+ * 
+ *     cdef int _check_solution(self, uint8_t[:] solution) nogil except -1:             # <<<<<<<<<<<<<<
+ *         cdef size_t i, clause_pos, clause_elem
+ *         cdef uint8_t expected
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF._check_solution", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  __pyx_L0:;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":721
+ *         return 1
+ * 
+ *     cdef int _check_solution_for_single_clause(self, size_t clause_idx, uint8_t[:] solution) nogil:             # <<<<<<<<<<<<<<
+ *         cdef size_t clause_pos
+ *         cdef uint8_t expected
+ */
+
+static int __pyx_f_11sat_toolkit_7formula_3CNF__check_solution_for_single_clause(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, size_t __pyx_v_clause_idx, __Pyx_memviewslice __pyx_v_solution) {
+  size_t __pyx_v_clause_pos;
+  __pyx_t_11sat_toolkit_5types_uint8_t __pyx_v_expected;
+  int __pyx_v_clause_elem;
+  int __pyx_r;
+  int __pyx_t_1;
+  Py_ssize_t __pyx_t_2;
+
+  /* "sat_toolkit/formula.pyx":726
+ *         cdef int clause_elem
+ * 
+ *         clause_pos = self.start_indices[clause_idx]             # <<<<<<<<<<<<<<
+ * 
+ *         while self.clauses[clause_pos] != 0:
+ */
+  __pyx_v_clause_pos = (__pyx_v_self->start_indices[__pyx_v_clause_idx]);
+
+  /* "sat_toolkit/formula.pyx":728
+ *         clause_pos = self.start_indices[clause_idx]
+ * 
+ *         while self.clauses[clause_pos] != 0:             # <<<<<<<<<<<<<<
+ *             clause_elem = self.clauses[clause_pos]
+ *             expected = clause_elem > 0
+ */
+  while (1) {
+    __pyx_t_1 = (((__pyx_v_self->clauses[__pyx_v_clause_pos]) != 0) != 0);
+    if (!__pyx_t_1) break;
+
+    /* "sat_toolkit/formula.pyx":729
+ * 
+ *         while self.clauses[clause_pos] != 0:
+ *             clause_elem = self.clauses[clause_pos]             # <<<<<<<<<<<<<<
+ *             expected = clause_elem > 0
+ *             if clause_elem < 0:
+ */
+    __pyx_v_clause_elem = (__pyx_v_self->clauses[__pyx_v_clause_pos]);
+
+    /* "sat_toolkit/formula.pyx":730
+ *         while self.clauses[clause_pos] != 0:
+ *             clause_elem = self.clauses[clause_pos]
+ *             expected = clause_elem > 0             # <<<<<<<<<<<<<<
+ *             if clause_elem < 0:
+ *                 clause_elem = -clause_elem
+ */
+    __pyx_v_expected = (__pyx_v_clause_elem > 0);
+
+    /* "sat_toolkit/formula.pyx":731
+ *             clause_elem = self.clauses[clause_pos]
+ *             expected = clause_elem > 0
+ *             if clause_elem < 0:             # <<<<<<<<<<<<<<
+ *                 clause_elem = -clause_elem
+ * 
+ */
+    __pyx_t_1 = ((__pyx_v_clause_elem < 0) != 0);
+    if (__pyx_t_1) {
+
+      /* "sat_toolkit/formula.pyx":732
+ *             expected = clause_elem > 0
+ *             if clause_elem < 0:
+ *                 clause_elem = -clause_elem             # <<<<<<<<<<<<<<
+ * 
+ *             if expected == solution[clause_elem]:
+ */
+      __pyx_v_clause_elem = (-__pyx_v_clause_elem);
+
+      /* "sat_toolkit/formula.pyx":731
+ *             clause_elem = self.clauses[clause_pos]
+ *             expected = clause_elem > 0
+ *             if clause_elem < 0:             # <<<<<<<<<<<<<<
+ *                 clause_elem = -clause_elem
+ * 
+ */
+    }
+
+    /* "sat_toolkit/formula.pyx":734
+ *                 clause_elem = -clause_elem
+ * 
+ *             if expected == solution[clause_elem]:             # <<<<<<<<<<<<<<
+ *                 return True
+ * 
+ */
+    __pyx_t_2 = __pyx_v_clause_elem;
+    __pyx_t_1 = ((__pyx_v_expected == (*((__pyx_t_11sat_toolkit_5types_uint8_t *) ( /* dim=0 */ (__pyx_v_solution.data + __pyx_t_2 * __pyx_v_solution.strides[0]) )))) != 0);
+    if (__pyx_t_1) {
+
+      /* "sat_toolkit/formula.pyx":735
+ * 
+ *             if expected == solution[clause_elem]:
+ *                 return True             # <<<<<<<<<<<<<<
+ * 
+ *             clause_pos += 1
+ */
+      __pyx_r = 1;
+      goto __pyx_L0;
+
+      /* "sat_toolkit/formula.pyx":734
+ *                 clause_elem = -clause_elem
+ * 
+ *             if expected == solution[clause_elem]:             # <<<<<<<<<<<<<<
+ *                 return True
+ * 
+ */
+    }
+
+    /* "sat_toolkit/formula.pyx":737
+ *                 return True
+ * 
+ *             clause_pos += 1             # <<<<<<<<<<<<<<
+ * 
+ *         return False
+ */
+    __pyx_v_clause_pos = (__pyx_v_clause_pos + 1);
+  }
+
+  /* "sat_toolkit/formula.pyx":739
+ *             clause_pos += 1
+ * 
+ *         return False             # <<<<<<<<<<<<<<
+ * 
+ *     def to_truthtable(self) -> Truthtable:
+ */
+  __pyx_r = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":721
+ *         return 1
+ * 
+ *     cdef int _check_solution_for_single_clause(self, size_t clause_idx, uint8_t[:] solution) nogil:             # <<<<<<<<<<<<<<
+ *         cdef size_t clause_pos
+ *         cdef uint8_t expected
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":741
+ *         return False
+ * 
+ *     def to_truthtable(self) -> Truthtable:             # <<<<<<<<<<<<<<
+ *         """
+ *         Return the current CNF as a Truthtable by iterating over all possible
+ */
+
+/* Python wrapper */
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pw_11sat_toolkit_7formula_3CNF_37to_truthtable(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_36to_truthtable[] = "CNF.to_truthtable(self) -> Truthtable\n\n        Return the current CNF as a Truthtable by iterating over all possible\n        variable assignments.\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pw_11sat_toolkit_7formula_3CNF_37to_truthtable(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("to_truthtable (wrapper)", 0);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_36to_truthtable(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pf_11sat_toolkit_7formula_3CNF_36to_truthtable(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
+  size_t __pyx_v_i;
+  size_t __pyx_v_j;
+  __Pyx_memviewslice __pyx_v_truthtable_view = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_v_current_sol_view = { 0, 0, { 0 }, { 0 }, { 0 } };
+  PyObject *__pyx_v_truthtable = NULL;
+  PyObject *__pyx_v_current_sol = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
+  PyObject *__pyx_t_8 = NULL;
+  __Pyx_memviewslice __pyx_t_9 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  Py_ssize_t __pyx_t_10;
+  __pyx_t_11sat_toolkit_5types_uint64_t __pyx_t_11;
+  __pyx_t_11sat_toolkit_5types_uint64_t __pyx_t_12;
+  size_t __pyx_t_13;
+  long __pyx_t_14;
+  long __pyx_t_15;
+  size_t __pyx_t_16;
+  size_t __pyx_t_17;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("to_truthtable", 0);
+
+  /* "sat_toolkit/formula.pyx":750
+ *         cdef uint8_t[:] current_sol_view
+ * 
+ *         if self.nvars > 32:             # <<<<<<<<<<<<<<
+ *             raise ValueError('cannot find all solutions for CNF with more than 32 variables')
+ * 
+ */
+  __pyx_t_1 = ((__pyx_v_self->nvars > 32) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "sat_toolkit/formula.pyx":751
+ * 
+ *         if self.nvars > 32:
+ *             raise ValueError('cannot find all solutions for CNF with more than 32 variables')             # <<<<<<<<<<<<<<
+ * 
+ *         truthtable = np.empty((<uint64_t> 1) << self.nvars, np.uint8)
+ */
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 751, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 751, __pyx_L1_error)
+
+    /* "sat_toolkit/formula.pyx":750
+ *         cdef uint8_t[:] current_sol_view
+ * 
+ *         if self.nvars > 32:             # <<<<<<<<<<<<<<
+ *             raise ValueError('cannot find all solutions for CNF with more than 32 variables')
+ * 
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":753
+ *             raise ValueError('cannot find all solutions for CNF with more than 32 variables')
+ * 
+ *         truthtable = np.empty((<uint64_t> 1) << self.nvars, np.uint8)             # <<<<<<<<<<<<<<
+ *         current_sol = np.empty(1 + self.nvars, np.uint8)
+ * 
+ */
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 753, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 753, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = __Pyx_PyInt_From_unsigned_long((((__pyx_t_11sat_toolkit_5types_uint64_t)1) << __pyx_v_self->nvars)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 753, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 753, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 753, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_6);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_t_5 = NULL;
+  __pyx_t_7 = 0;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
+    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
+    if (likely(__pyx_t_5)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+      __Pyx_INCREF(__pyx_t_5);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_4, function);
+      __pyx_t_7 = 1;
+    }
+  }
+  #if CYTHON_FAST_PYCALL
+  if (PyFunction_Check(__pyx_t_4)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_6};
+    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+  } else
+  #endif
+  #if CYTHON_FAST_PYCCALL
+  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_6};
+    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+  } else
+  #endif
+  {
+    __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 753, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (__pyx_t_5) {
+      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
+    }
+    __Pyx_GIVEREF(__pyx_t_3);
+    PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
+    __Pyx_GIVEREF(__pyx_t_6);
+    PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_6);
+    __pyx_t_3 = 0;
+    __pyx_t_6 = 0;
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_v_truthtable = __pyx_t_2;
+  __pyx_t_2 = 0;
+
+  /* "sat_toolkit/formula.pyx":754
+ * 
+ *         truthtable = np.empty((<uint64_t> 1) << self.nvars, np.uint8)
+ *         current_sol = np.empty(1 + self.nvars, np.uint8)             # <<<<<<<<<<<<<<
+ * 
+ *         truthtable_view = truthtable
+ */
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 754, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 754, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_4 = __Pyx_PyInt_From_long((1 + __pyx_v_self->nvars)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 754, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 754, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_6);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_uint8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+  __pyx_t_6 = NULL;
+  __pyx_t_7 = 0;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
+    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
+    if (likely(__pyx_t_6)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
+      __Pyx_INCREF(__pyx_t_6);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_8, function);
+      __pyx_t_7 = 1;
+    }
+  }
+  #if CYTHON_FAST_PYCALL
+  if (PyFunction_Check(__pyx_t_8)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_t_3};
+    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  } else
+  #endif
+  #if CYTHON_FAST_PYCCALL
+  if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_4, __pyx_t_3};
+    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  } else
+  #endif
+  {
+    __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    if (__pyx_t_6) {
+      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6); __pyx_t_6 = NULL;
+    }
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_3);
+    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, __pyx_t_3);
+    __pyx_t_4 = 0;
+    __pyx_t_3 = 0;
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_v_current_sol = __pyx_t_2;
+  __pyx_t_2 = 0;
+
+  /* "sat_toolkit/formula.pyx":756
+ *         current_sol = np.empty(1 + self.nvars, np.uint8)
+ * 
+ *         truthtable_view = truthtable             # <<<<<<<<<<<<<<
+ *         current_sol_view = current_sol
+ *         current_sol_view[0] = 0
+ */
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_11sat_toolkit_5types_uint8_t(__pyx_v_truthtable, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 756, __pyx_L1_error)
+  __pyx_v_truthtable_view = __pyx_t_9;
+  __pyx_t_9.memview = NULL;
+  __pyx_t_9.data = NULL;
+
+  /* "sat_toolkit/formula.pyx":757
+ * 
+ *         truthtable_view = truthtable
+ *         current_sol_view = current_sol             # <<<<<<<<<<<<<<
+ *         current_sol_view[0] = 0
+ * 
+ */
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_11sat_toolkit_5types_uint8_t(__pyx_v_current_sol, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 757, __pyx_L1_error)
+  __pyx_v_current_sol_view = __pyx_t_9;
+  __pyx_t_9.memview = NULL;
+  __pyx_t_9.data = NULL;
+
+  /* "sat_toolkit/formula.pyx":758
+ *         truthtable_view = truthtable
+ *         current_sol_view = current_sol
+ *         current_sol_view[0] = 0             # <<<<<<<<<<<<<<
+ * 
+ *         for i in range((<uint64_t> 1) << self.nvars):
+ */
+  __pyx_t_10 = 0;
+  *((__pyx_t_11sat_toolkit_5types_uint8_t *) ( /* dim=0 */ (__pyx_v_current_sol_view.data + __pyx_t_10 * __pyx_v_current_sol_view.strides[0]) )) = 0;
+
+  /* "sat_toolkit/formula.pyx":760
+ *         current_sol_view[0] = 0
+ * 
+ *         for i in range((<uint64_t> 1) << self.nvars):             # <<<<<<<<<<<<<<
+ *             for j in range(1, self.nvars + 1):
+ *                 current_sol_view[j] = (i >> (j - 1)) & 1
+ */
+  __pyx_t_11 = (((__pyx_t_11sat_toolkit_5types_uint64_t)1) << __pyx_v_self->nvars);
+  __pyx_t_12 = __pyx_t_11;
+  for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
+    __pyx_v_i = __pyx_t_13;
+
+    /* "sat_toolkit/formula.pyx":761
+ * 
+ *         for i in range((<uint64_t> 1) << self.nvars):
+ *             for j in range(1, self.nvars + 1):             # <<<<<<<<<<<<<<
+ *                 current_sol_view[j] = (i >> (j - 1)) & 1
+ *             truthtable_view[i] = self._check_solution(current_sol_view)
+ */
+    __pyx_t_14 = (__pyx_v_self->nvars + 1);
+    __pyx_t_15 = __pyx_t_14;
+    for (__pyx_t_16 = 1; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
+      __pyx_v_j = __pyx_t_16;
+
+      /* "sat_toolkit/formula.pyx":762
+ *         for i in range((<uint64_t> 1) << self.nvars):
+ *             for j in range(1, self.nvars + 1):
+ *                 current_sol_view[j] = (i >> (j - 1)) & 1             # <<<<<<<<<<<<<<
+ *             truthtable_view[i] = self._check_solution(current_sol_view)
+ *             PyErr_CheckSignals()
+ */
+      __pyx_t_17 = __pyx_v_j;
+      *((__pyx_t_11sat_toolkit_5types_uint8_t *) ( /* dim=0 */ (__pyx_v_current_sol_view.data + __pyx_t_17 * __pyx_v_current_sol_view.strides[0]) )) = ((__pyx_v_i >> (__pyx_v_j - 1)) & 1);
+    }
+
+    /* "sat_toolkit/formula.pyx":763
+ *             for j in range(1, self.nvars + 1):
+ *                 current_sol_view[j] = (i >> (j - 1)) & 1
+ *             truthtable_view[i] = self._check_solution(current_sol_view)             # <<<<<<<<<<<<<<
+ *             PyErr_CheckSignals()
+ * 
+ */
+    __pyx_t_7 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_check_solution(__pyx_v_self, __pyx_v_current_sol_view); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 763, __pyx_L1_error)
+    __pyx_t_16 = __pyx_v_i;
+    *((__pyx_t_11sat_toolkit_5types_uint8_t *) ( /* dim=0 */ (__pyx_v_truthtable_view.data + __pyx_t_16 * __pyx_v_truthtable_view.strides[0]) )) = __pyx_t_7;
+
+    /* "sat_toolkit/formula.pyx":764
+ *                 current_sol_view[j] = (i >> (j - 1)) & 1
+ *             truthtable_view[i] = self._check_solution(current_sol_view)
+ *             PyErr_CheckSignals()             # <<<<<<<<<<<<<<
+ * 
+ *         return Truthtable.from_lut(truthtable)
+ */
+    __pyx_t_7 = PyErr_CheckSignals(); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 764, __pyx_L1_error)
+  }
+
+  /* "sat_toolkit/formula.pyx":766
+ *             PyErr_CheckSignals()
+ * 
+ *         return Truthtable.from_lut(truthtable)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_7formula_Truthtable), __pyx_n_s_from_lut); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 766, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __pyx_t_5 = NULL;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
+    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_8);
+    if (likely(__pyx_t_5)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
+      __Pyx_INCREF(__pyx_t_5);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_8, function);
+    }
+  }
+  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_5, __pyx_v_truthtable) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_truthtable);
+  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 766, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11sat_toolkit_7formula_Truthtable))))) __PYX_ERR(0, 766, __pyx_L1_error)
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_t_2);
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":741
+ *         return False
+ * 
+ *     def to_truthtable(self) -> Truthtable:             # <<<<<<<<<<<<<<
+ *         """
+ *         Return the current CNF as a Truthtable by iterating over all possible
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_8);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.to_truthtable", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __PYX_XDEC_MEMVIEW(&__pyx_v_truthtable_view, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_v_current_sol_view, 1);
+  __Pyx_XDECREF(__pyx_v_truthtable);
+  __Pyx_XDECREF(__pyx_v_current_sol);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":769
  * 
  * 
  *     cdef Clause get_clause(self, ssize_t idx):             # <<<<<<<<<<<<<<
  *         cdef size_t begin, end, i
  *         cdef size_t numclauses = self.start_indices.size()
  */
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_f_11sat_toolkit_9_cnf_util_3CNF_get_clause(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
+static struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_f_11sat_toolkit_7formula_3CNF_get_clause(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
   size_t __pyx_v_begin;
   size_t __pyx_v_end;
   size_t __pyx_v_numclauses;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v_result = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_result = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   std::vector<int> ::size_type __pyx_t_4;
   int *__pyx_t_5;
   struct __pyx_array_obj *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   __Pyx_memviewslice __pyx_t_8 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_clause", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":452
+  /* "sat_toolkit/formula.pyx":771
  *     cdef Clause get_clause(self, ssize_t idx):
  *         cdef size_t begin, end, i
  *         cdef size_t numclauses = self.start_indices.size()             # <<<<<<<<<<<<<<
  *         cdef Clause result
  * 
  */
   __pyx_v_numclauses = __pyx_v_self->start_indices.size();
 
-  /* "sat_toolkit/_cnf_util.pyx":455
+  /* "sat_toolkit/formula.pyx":774
  *         cdef Clause result
  * 
  *         if idx < 0:             # <<<<<<<<<<<<<<
  *             idx += numclauses
  *         if idx < 0 or <size_t> idx >= numclauses:
  */
   __pyx_t_1 = ((__pyx_v_idx < 0) != 0);
   if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":456
+    /* "sat_toolkit/formula.pyx":775
  * 
  *         if idx < 0:
  *             idx += numclauses             # <<<<<<<<<<<<<<
  *         if idx < 0 or <size_t> idx >= numclauses:
  *             raise IndexError('index out of range')
  */
     __pyx_v_idx = (__pyx_v_idx + __pyx_v_numclauses);
 
-    /* "sat_toolkit/_cnf_util.pyx":455
+    /* "sat_toolkit/formula.pyx":774
  *         cdef Clause result
  * 
  *         if idx < 0:             # <<<<<<<<<<<<<<
  *             idx += numclauses
  *         if idx < 0 or <size_t> idx >= numclauses:
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":457
+  /* "sat_toolkit/formula.pyx":776
  *         if idx < 0:
  *             idx += numclauses
  *         if idx < 0 or <size_t> idx >= numclauses:             # <<<<<<<<<<<<<<
  *             raise IndexError('index out of range')
  * 
  */
   __pyx_t_2 = ((__pyx_v_idx < 0) != 0);
@@ -10042,315 +13924,315 @@
     goto __pyx_L5_bool_binop_done;
   }
   __pyx_t_2 = ((((size_t)__pyx_v_idx) >= __pyx_v_numclauses) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L5_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":458
+    /* "sat_toolkit/formula.pyx":777
  *             idx += numclauses
  *         if idx < 0 or <size_t> idx >= numclauses:
  *             raise IndexError('index out of range')             # <<<<<<<<<<<<<<
  * 
  *         begin = self.start_indices[idx]
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 458, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 777, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 458, __pyx_L1_error)
+    __PYX_ERR(0, 777, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":457
+    /* "sat_toolkit/formula.pyx":776
  *         if idx < 0:
  *             idx += numclauses
  *         if idx < 0 or <size_t> idx >= numclauses:             # <<<<<<<<<<<<<<
  *             raise IndexError('index out of range')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":460
+  /* "sat_toolkit/formula.pyx":779
  *             raise IndexError('index out of range')
  * 
  *         begin = self.start_indices[idx]             # <<<<<<<<<<<<<<
  *         end = self.start_indices[idx + 1] if <size_t> idx + 1 < numclauses else self.clauses.size()
  *         result = Clause.from_memview((<int[:self.clauses.size()]> self.clauses.data())[begin:end - 1])
  */
   __pyx_v_begin = (__pyx_v_self->start_indices[__pyx_v_idx]);
 
-  /* "sat_toolkit/_cnf_util.pyx":461
+  /* "sat_toolkit/formula.pyx":780
  * 
  *         begin = self.start_indices[idx]
  *         end = self.start_indices[idx + 1] if <size_t> idx + 1 < numclauses else self.clauses.size()             # <<<<<<<<<<<<<<
  *         result = Clause.from_memview((<int[:self.clauses.size()]> self.clauses.data())[begin:end - 1])
  * 
  */
   if ((((((size_t)__pyx_v_idx) + 1) < __pyx_v_numclauses) != 0)) {
     __pyx_t_4 = (__pyx_v_self->start_indices[(__pyx_v_idx + 1)]);
   } else {
     __pyx_t_4 = __pyx_v_self->clauses.size();
   }
   __pyx_v_end = __pyx_t_4;
 
-  /* "sat_toolkit/_cnf_util.pyx":462
+  /* "sat_toolkit/formula.pyx":781
  *         begin = self.start_indices[idx]
  *         end = self.start_indices[idx + 1] if <size_t> idx + 1 < numclauses else self.clauses.size()
  *         result = Clause.from_memview((<int[:self.clauses.size()]> self.clauses.data())[begin:end - 1])             # <<<<<<<<<<<<<<
  * 
  *         return result
  */
   __pyx_t_5 = __pyx_v_self->clauses.data();
   if (!__pyx_t_5) {
     PyErr_SetString(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
-    __PYX_ERR(0, 462, __pyx_L1_error)
+    __PYX_ERR(0, 781, __pyx_L1_error)
   }
-  __pyx_t_7 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 462, __pyx_L1_error)
+  __pyx_t_7 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 781, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_self->clauses.size())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 462, __pyx_L1_error)
+  __pyx_t_3 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_self->clauses.size())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 781, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_6 = __pyx_array_new(__pyx_t_3, sizeof(int), PyBytes_AS_STRING(__pyx_t_7), (char *) "c", (char *) __pyx_t_5);
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 462, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 781, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetSlice(((PyObject *)__pyx_t_6), __pyx_v_begin, (__pyx_v_end - 1), NULL, NULL, NULL, 1, 1, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 462, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetSlice(((PyObject *)__pyx_t_6), __pyx_v_begin, (__pyx_v_end - 1), NULL, NULL, NULL, 1, 1, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 781, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_7, 0); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 462, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_7, 0); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 781, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = ((PyObject *)__pyx_f_11sat_toolkit_9_cnf_util_6Clause_from_memview(__pyx_t_8)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 462, __pyx_L1_error)
+  __pyx_t_7 = ((PyObject *)__pyx_f_11sat_toolkit_7formula_6Clause_from_memview(__pyx_t_8)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 781, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
-  __pyx_v_result = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_t_7);
+  __pyx_v_result = ((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_t_7);
   __pyx_t_7 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":464
+  /* "sat_toolkit/formula.pyx":783
  *         result = Clause.from_memview((<int[:self.clauses.size()]> self.clauses.data())[begin:end - 1])
  * 
  *         return result             # <<<<<<<<<<<<<<
  * 
- *     def __getitem__(self, ssize_t idx):
+ *     def __getitem__(self, ssize_t idx) -> Clause:
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_result));
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":450
+  /* "sat_toolkit/formula.pyx":769
  * 
  * 
  *     cdef Clause get_clause(self, ssize_t idx):             # <<<<<<<<<<<<<<
  *         cdef size_t begin, end, i
  *         cdef size_t numclauses = self.start_indices.size()
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(((PyObject *)__pyx_t_6));
   __Pyx_XDECREF(__pyx_t_7);
   __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.get_clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.get_clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_result);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":466
+/* "sat_toolkit/formula.pyx":785
  *         return result
  * 
- *     def __getitem__(self, ssize_t idx):             # <<<<<<<<<<<<<<
+ *     def __getitem__(self, ssize_t idx) -> Clause:             # <<<<<<<<<<<<<<
  *         return self.get_clause(idx)
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_27__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_idx); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_27__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_idx) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_39__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_idx); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_39__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_arg_idx) {
   Py_ssize_t __pyx_v_idx;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__getitem__ (wrapper)", 0);
   assert(__pyx_arg_idx); {
-    __pyx_v_idx = PyInt_AsSsize_t(__pyx_arg_idx); if (unlikely((__pyx_v_idx == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 466, __pyx_L3_error)
+    __pyx_v_idx = PyInt_AsSsize_t(__pyx_arg_idx); if (unlikely((__pyx_v_idx == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 785, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_26__getitem__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((Py_ssize_t)__pyx_v_idx));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_38__getitem__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((Py_ssize_t)__pyx_v_idx));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_26__getitem__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_38__getitem__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__getitem__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":467
+  /* "sat_toolkit/formula.pyx":786
  * 
- *     def __getitem__(self, ssize_t idx):
+ *     def __getitem__(self, ssize_t idx) -> Clause:
  *         return self.get_clause(idx)             # <<<<<<<<<<<<<<
  * 
- *     def __len__(self):
+ *     def __len__(self) -> int:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self->__pyx_vtab)->get_clause(__pyx_v_self, __pyx_v_idx)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 467, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->get_clause(__pyx_v_self, __pyx_v_idx)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 786, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":466
+  /* "sat_toolkit/formula.pyx":785
  *         return result
  * 
- *     def __getitem__(self, ssize_t idx):             # <<<<<<<<<<<<<<
+ *     def __getitem__(self, ssize_t idx) -> Clause:             # <<<<<<<<<<<<<<
  *         return self.get_clause(idx)
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":469
+/* "sat_toolkit/formula.pyx":788
  *         return self.get_clause(idx)
  * 
- *     def __len__(self):             # <<<<<<<<<<<<<<
+ *     def __len__(self) -> int:             # <<<<<<<<<<<<<<
  *         return self.start_indices.size()
  * 
  */
 
 /* Python wrapper */
-static Py_ssize_t __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_29__len__(PyObject *__pyx_v_self); /*proto*/
-static Py_ssize_t __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_29__len__(PyObject *__pyx_v_self) {
+static Py_ssize_t __pyx_pw_11sat_toolkit_7formula_3CNF_41__len__(PyObject *__pyx_v_self); /*proto*/
+static Py_ssize_t __pyx_pw_11sat_toolkit_7formula_3CNF_41__len__(PyObject *__pyx_v_self) {
   Py_ssize_t __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__len__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_28__len__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_40__len__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static Py_ssize_t __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_28__len__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
+static Py_ssize_t __pyx_pf_11sat_toolkit_7formula_3CNF_40__len__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
   Py_ssize_t __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__len__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":470
+  /* "sat_toolkit/formula.pyx":789
  * 
- *     def __len__(self):
+ *     def __len__(self) -> int:
  *         return self.start_indices.size()             # <<<<<<<<<<<<<<
  * 
- *     def __iter__(self):
+ *     def __iter__(self) -> Iterable[Clause]:
  */
   __pyx_r = __pyx_v_self->start_indices.size();
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":469
+  /* "sat_toolkit/formula.pyx":788
  *         return self.get_clause(idx)
  * 
- *     def __len__(self):             # <<<<<<<<<<<<<<
+ *     def __len__(self) -> int:             # <<<<<<<<<<<<<<
  *         return self.start_indices.size()
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_11sat_toolkit_9_cnf_util_3CNF_32generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+static PyObject *__pyx_gb_11sat_toolkit_7formula_3CNF_44generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "sat_toolkit/_cnf_util.pyx":472
+/* "sat_toolkit/formula.pyx":791
  *         return self.start_indices.size()
  * 
- *     def __iter__(self):             # <<<<<<<<<<<<<<
+ *     def __iter__(self) -> Iterable[Clause]:             # <<<<<<<<<<<<<<
  *         cdef size_t i = 0
  *         while i < self.start_indices.size():
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_31__iter__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_31__iter__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_43__iter__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_43__iter__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_30__iter__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_42__iter__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_30__iter__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *__pyx_cur_scope;
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_42__iter__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *__pyx_cur_scope;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__iter__", 0);
-  __pyx_cur_scope = (struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *)__pyx_tp_new_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__(__pyx_ptype_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *)__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_2___iter__(__pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_2___iter__, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 472, __pyx_L1_error)
+    __PYX_ERR(0, 791, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11sat_toolkit_9_cnf_util_3CNF_32generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_CNF___iter, __pyx_n_s_sat_toolkit__cnf_util); if (unlikely(!gen)) __PYX_ERR(0, 472, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11sat_toolkit_7formula_3CNF_44generator2, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_CNF___iter, __pyx_n_s_sat_toolkit_formula); if (unlikely(!gen)) __PYX_ERR(0, 791, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_gb_11sat_toolkit_9_cnf_util_3CNF_32generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_11sat_toolkit_7formula_3CNF_44generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *__pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *)__pyx_generator->closure);
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *__pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
@@ -10359,71 +14241,71 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L6_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 472, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 791, __pyx_L1_error)
 
-  /* "sat_toolkit/_cnf_util.pyx":473
+  /* "sat_toolkit/formula.pyx":792
  * 
- *     def __iter__(self):
+ *     def __iter__(self) -> Iterable[Clause]:
  *         cdef size_t i = 0             # <<<<<<<<<<<<<<
  *         while i < self.start_indices.size():
  *             yield self.get_clause(i)
  */
   __pyx_cur_scope->__pyx_v_i = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":474
- *     def __iter__(self):
+  /* "sat_toolkit/formula.pyx":793
+ *     def __iter__(self) -> Iterable[Clause]:
  *         cdef size_t i = 0
  *         while i < self.start_indices.size():             # <<<<<<<<<<<<<<
  *             yield self.get_clause(i)
  *             i += 1
  */
   while (1) {
     __pyx_t_1 = ((__pyx_cur_scope->__pyx_v_i < __pyx_cur_scope->__pyx_v_self->start_indices.size()) != 0);
     if (!__pyx_t_1) break;
 
-    /* "sat_toolkit/_cnf_util.pyx":475
+    /* "sat_toolkit/formula.pyx":794
  *         cdef size_t i = 0
  *         while i < self.start_indices.size():
  *             yield self.get_clause(i)             # <<<<<<<<<<<<<<
  *             i += 1
  * 
  */
-    __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->get_clause(__pyx_cur_scope->__pyx_v_self, __pyx_cur_scope->__pyx_v_i)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 475, __pyx_L1_error)
+    __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->get_clause(__pyx_cur_scope->__pyx_v_self, __pyx_cur_scope->__pyx_v_i)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 794, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from generator, yielding value */
     __pyx_generator->resume_label = 1;
     return __pyx_r;
     __pyx_L6_resume_from_yield:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 475, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 794, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":476
+    /* "sat_toolkit/formula.pyx":795
  *         while i < self.start_indices.size():
  *             yield self.get_clause(i)
  *             i += 1             # <<<<<<<<<<<<<<
  * 
- *     def __eq__(self, other):
+ *     def __reversed__(self) -> Iterable[Clause]:
  */
     __pyx_cur_scope->__pyx_v_i = (__pyx_cur_scope->__pyx_v_i + 1);
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "sat_toolkit/_cnf_util.pyx":472
+  /* "sat_toolkit/formula.pyx":791
  *         return self.start_indices.size()
  * 
- *     def __iter__(self):             # <<<<<<<<<<<<<<
+ *     def __iter__(self) -> Iterable[Clause]:             # <<<<<<<<<<<<<<
  *         cdef size_t i = 0
  *         while i < self.start_indices.size():
  */
 
   /* function exit code */
   PyErr_SetNone(PyExc_StopIteration);
   goto __pyx_L0;
@@ -10436,531 +14318,1562 @@
   __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
+static PyObject *__pyx_gb_11sat_toolkit_7formula_3CNF_47generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "sat_toolkit/_cnf_util.pyx":478
+/* "sat_toolkit/formula.pyx":797
  *             i += 1
  * 
- *     def __eq__(self, other):             # <<<<<<<<<<<<<<
+ *     def __reversed__(self) -> Iterable[Clause]:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ *         for i in reversed(range(self.start_indices.size())):
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_46__reversed__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_45__reversed__[] = "CNF.__reversed__(self) -> Iterable[Clause]";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_46__reversed__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__reversed__ (wrapper)", 0);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_45__reversed__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_45__reversed__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *__pyx_cur_scope;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__reversed__", 0);
+  __pyx_cur_scope = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *)__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__(__pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__, __pyx_empty_tuple, NULL);
+  if (unlikely(!__pyx_cur_scope)) {
+    __pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *)Py_None);
+    __Pyx_INCREF(Py_None);
+    __PYX_ERR(0, 797, __pyx_L1_error)
+  } else {
+    __Pyx_GOTREF(__pyx_cur_scope);
+  }
+  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
+  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
+  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
+  {
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11sat_toolkit_7formula_3CNF_47generator3, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_reversed_2, __pyx_n_s_CNF___reversed, __pyx_n_s_sat_toolkit_formula); if (unlikely(!gen)) __PYX_ERR(0, 797, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_cur_scope);
+    __Pyx_RefNannyFinishContext();
+    return (PyObject *) gen;
+  }
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__reversed__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_gb_11sat_toolkit_7formula_3CNF_47generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+{
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *__pyx_cur_scope = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *)__pyx_generator->closure);
+  PyObject *__pyx_r = NULL;
+  size_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__reversed__", 0);
+  switch (__pyx_generator->resume_label) {
+    case 0: goto __pyx_L3_first_run;
+    case 1: goto __pyx_L6_resume_from_yield;
+    default: /* CPython raises the right error here */
+    __Pyx_RefNannyFinishContext();
+    return NULL;
+  }
+  __pyx_L3_first_run:;
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 797, __pyx_L1_error)
+
+  /* "sat_toolkit/formula.pyx":799
+ *     def __reversed__(self) -> Iterable[Clause]:
+ *         cdef size_t i
+ *         for i in reversed(range(self.start_indices.size())):             # <<<<<<<<<<<<<<
+ *             yield self.get_clause(i)
+ * 
+ */
+  for (__pyx_t_1 = __pyx_cur_scope->__pyx_v_self->start_indices.size()-1 + 1; __pyx_t_1 >= 0 + 1; ) { __pyx_t_1-=1;
+    __pyx_cur_scope->__pyx_v_i = __pyx_t_1;
+
+    /* "sat_toolkit/formula.pyx":800
+ *         cdef size_t i
+ *         for i in reversed(range(self.start_indices.size())):
+ *             yield self.get_clause(i)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef int _compare_clause(self, size_t idx, Clause other) nogil except -1:
+ */
+    __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->get_clause(__pyx_cur_scope->__pyx_v_self, __pyx_cur_scope->__pyx_v_i)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 800, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_r = __pyx_t_2;
+    __pyx_t_2 = 0;
+    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
+    __Pyx_XGIVEREF(__pyx_r);
+    __Pyx_RefNannyFinishContext();
+    __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
+    /* return from generator, yielding value */
+    __pyx_generator->resume_label = 1;
+    return __pyx_r;
+    __pyx_L6_resume_from_yield:;
+    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 800, __pyx_L1_error)
+  }
+  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
+
+  /* "sat_toolkit/formula.pyx":797
+ *             i += 1
+ * 
+ *     def __reversed__(self) -> Iterable[Clause]:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ *         for i in reversed(range(self.start_indices.size())):
+ */
+
+  /* function exit code */
+  PyErr_SetNone(PyExc_StopIteration);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("__reversed__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
+  #if !CYTHON_USE_EXC_INFO_STACK
+  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
+  #endif
+  __pyx_generator->resume_label = -1;
+  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":802
+ *             yield self.get_clause(i)
+ * 
+ *     cdef int _compare_clause(self, size_t idx, Clause other) nogil except -1:             # <<<<<<<<<<<<<<
+ *         cdef size_t begin, end, i
+ *         cdef size_t numclauses = self.start_indices.size()
+ */
+
+static int __pyx_f_11sat_toolkit_7formula_3CNF__compare_clause(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, size_t __pyx_v_idx, struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_other) {
+  size_t __pyx_v_begin;
+  size_t __pyx_v_end;
+  size_t __pyx_v_i;
+  size_t __pyx_v_numclauses;
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  std::vector<int> ::size_type __pyx_t_3;
+  size_t __pyx_t_4;
+  size_t __pyx_t_5;
+  size_t __pyx_t_6;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_RefNannySetupContext("_compare_clause", 0);
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+
+  /* "sat_toolkit/formula.pyx":803
+ * 
+ *     cdef int _compare_clause(self, size_t idx, Clause other) nogil except -1:
+ *         cdef size_t begin, end, i             # <<<<<<<<<<<<<<
+ *         cdef size_t numclauses = self.start_indices.size()
+ * 
+ */
+  /*try:*/ {
+
+    /* "sat_toolkit/formula.pyx":804
+ *     cdef int _compare_clause(self, size_t idx, Clause other) nogil except -1:
+ *         cdef size_t begin, end, i
+ *         cdef size_t numclauses = self.start_indices.size()             # <<<<<<<<<<<<<<
+ * 
+ *         if idx >= numclauses:
+ */
+    __pyx_v_numclauses = __pyx_v_self->start_indices.size();
+
+    /* "sat_toolkit/formula.pyx":806
+ *         cdef size_t numclauses = self.start_indices.size()
+ * 
+ *         if idx >= numclauses:             # <<<<<<<<<<<<<<
+ *             with gil:
+ *                 raise IndexError('index out of range')
+ */
+    __pyx_t_1 = ((__pyx_v_idx >= __pyx_v_numclauses) != 0);
+    if (__pyx_t_1) {
+
+      /* "sat_toolkit/formula.pyx":807
+ * 
+ *         if idx >= numclauses:
+ *             with gil:             # <<<<<<<<<<<<<<
+ *                 raise IndexError('index out of range')
+ * 
+ */
+      {
+          #ifdef WITH_THREAD
+          PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+          #endif
+          /*try:*/ {
+
+            /* "sat_toolkit/formula.pyx":808
+ *         if idx >= numclauses:
+ *             with gil:
+ *                 raise IndexError('index out of range')             # <<<<<<<<<<<<<<
+ * 
+ *         begin = self.start_indices[idx]
+ */
+            __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 808, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_2);
+            __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+            __PYX_ERR(0, 808, __pyx_L8_error)
+          }
+
+          /* "sat_toolkit/formula.pyx":807
+ * 
+ *         if idx >= numclauses:
+ *             with gil:             # <<<<<<<<<<<<<<
+ *                 raise IndexError('index out of range')
+ * 
+ */
+          /*finally:*/ {
+            __pyx_L8_error: {
+              #ifdef WITH_THREAD
+              __Pyx_PyGILState_Release(__pyx_gilstate_save);
+              #endif
+              goto __pyx_L4_error;
+            }
+          }
+      }
+
+      /* "sat_toolkit/formula.pyx":806
+ *         cdef size_t numclauses = self.start_indices.size()
+ * 
+ *         if idx >= numclauses:             # <<<<<<<<<<<<<<
+ *             with gil:
+ *                 raise IndexError('index out of range')
+ */
+    }
+
+    /* "sat_toolkit/formula.pyx":810
+ *                 raise IndexError('index out of range')
+ * 
+ *         begin = self.start_indices[idx]             # <<<<<<<<<<<<<<
+ *         end = self.start_indices[idx + 1] if <size_t> idx + 1 < numclauses else self.clauses.size()
+ * 
+ */
+    __pyx_v_begin = (__pyx_v_self->start_indices[__pyx_v_idx]);
+
+    /* "sat_toolkit/formula.pyx":811
+ * 
+ *         begin = self.start_indices[idx]
+ *         end = self.start_indices[idx + 1] if <size_t> idx + 1 < numclauses else self.clauses.size()             # <<<<<<<<<<<<<<
+ * 
+ *         if end - 1 - begin != other.clause.size():
+ */
+    if ((((((size_t)__pyx_v_idx) + 1) < __pyx_v_numclauses) != 0)) {
+      __pyx_t_3 = (__pyx_v_self->start_indices[(__pyx_v_idx + 1)]);
+    } else {
+      __pyx_t_3 = __pyx_v_self->clauses.size();
+    }
+    __pyx_v_end = __pyx_t_3;
+
+    /* "sat_toolkit/formula.pyx":813
+ *         end = self.start_indices[idx + 1] if <size_t> idx + 1 < numclauses else self.clauses.size()
+ * 
+ *         if end - 1 - begin != other.clause.size():             # <<<<<<<<<<<<<<
+ *             return 0
+ * 
+ */
+    __pyx_t_1 = ((((__pyx_v_end - 1) - __pyx_v_begin) != __pyx_v_other->clause.size()) != 0);
+    if (__pyx_t_1) {
+
+      /* "sat_toolkit/formula.pyx":814
+ * 
+ *         if end - 1 - begin != other.clause.size():
+ *             return 0             # <<<<<<<<<<<<<<
+ * 
+ *         for i in range(end - 1 - begin):
+ */
+      __pyx_r = 0;
+      goto __pyx_L3_return;
+
+      /* "sat_toolkit/formula.pyx":813
+ *         end = self.start_indices[idx + 1] if <size_t> idx + 1 < numclauses else self.clauses.size()
+ * 
+ *         if end - 1 - begin != other.clause.size():             # <<<<<<<<<<<<<<
+ *             return 0
+ * 
+ */
+    }
+
+    /* "sat_toolkit/formula.pyx":816
+ *             return 0
+ * 
+ *         for i in range(end - 1 - begin):             # <<<<<<<<<<<<<<
+ *             if self.clauses[begin + i] != other.clause[i]:
+ *                 return 0
+ */
+    __pyx_t_4 = ((__pyx_v_end - 1) - __pyx_v_begin);
+    __pyx_t_5 = __pyx_t_4;
+    for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
+      __pyx_v_i = __pyx_t_6;
+
+      /* "sat_toolkit/formula.pyx":817
+ * 
+ *         for i in range(end - 1 - begin):
+ *             if self.clauses[begin + i] != other.clause[i]:             # <<<<<<<<<<<<<<
+ *                 return 0
+ * 
+ */
+      __pyx_t_1 = (((__pyx_v_self->clauses[(__pyx_v_begin + __pyx_v_i)]) != (__pyx_v_other->clause[__pyx_v_i])) != 0);
+      if (__pyx_t_1) {
+
+        /* "sat_toolkit/formula.pyx":818
+ *         for i in range(end - 1 - begin):
+ *             if self.clauses[begin + i] != other.clause[i]:
+ *                 return 0             # <<<<<<<<<<<<<<
+ * 
+ *         return 1
+ */
+        __pyx_r = 0;
+        goto __pyx_L3_return;
+
+        /* "sat_toolkit/formula.pyx":817
+ * 
+ *         for i in range(end - 1 - begin):
+ *             if self.clauses[begin + i] != other.clause[i]:             # <<<<<<<<<<<<<<
+ *                 return 0
+ * 
+ */
+      }
+    }
+
+    /* "sat_toolkit/formula.pyx":820
+ *                 return 0
+ * 
+ *         return 1             # <<<<<<<<<<<<<<
+ * 
+ *     def __contains__(self, Clause needle) -> bool:
+ */
+    __pyx_r = 1;
+    goto __pyx_L3_return;
+  }
+
+  /* "sat_toolkit/formula.pyx":803
+ * 
+ *     cdef int _compare_clause(self, size_t idx, Clause other) nogil except -1:
+ *         cdef size_t begin, end, i             # <<<<<<<<<<<<<<
+ *         cdef size_t numclauses = self.start_indices.size()
+ * 
+ */
+  /*finally:*/ {
+    __pyx_L3_return: {
+      #ifdef WITH_THREAD
+      __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+      #endif
+      goto __pyx_L0;
+    }
+    __pyx_L4_error: {
+      #ifdef WITH_THREAD
+      __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+      #endif
+      goto __pyx_L1_error;
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":802
+ *             yield self.get_clause(i)
+ * 
+ *     cdef int _compare_clause(self, size_t idx, Clause other) nogil except -1:             # <<<<<<<<<<<<<<
+ *         cdef size_t begin, end, i
+ *         cdef size_t numclauses = self.start_indices.size()
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF._compare_clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  __pyx_L0:;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":822
+ *         return 1
+ * 
+ *     def __contains__(self, Clause needle) -> bool:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ * 
+ */
+
+/* Python wrapper */
+static int __pyx_pw_11sat_toolkit_7formula_3CNF_49__contains__(PyObject *__pyx_v_self, PyObject *__pyx_v_needle); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_3CNF_49__contains__(PyObject *__pyx_v_self, PyObject *__pyx_v_needle) {
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__contains__ (wrapper)", 0);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_needle), __pyx_ptype_11sat_toolkit_7formula_Clause, 1, "needle", 0))) __PYX_ERR(0, 822, __pyx_L1_error)
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_48__contains__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_needle));
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_11sat_toolkit_7formula_3CNF_48__contains__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_needle) {
+  size_t __pyx_v_i;
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  std::vector<size_t> ::size_type __pyx_t_1;
+  std::vector<size_t> ::size_type __pyx_t_2;
+  size_t __pyx_t_3;
+  int __pyx_t_4;
+  int __pyx_t_5;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__contains__", 0);
+
+  /* "sat_toolkit/formula.pyx":825
+ *         cdef size_t i
+ * 
+ *         for i in range(self.start_indices.size()):             # <<<<<<<<<<<<<<
+ *             if self._compare_clause(i, needle):
+ *                 return True
+ */
+  __pyx_t_1 = __pyx_v_self->start_indices.size();
+  __pyx_t_2 = __pyx_t_1;
+  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
+    __pyx_v_i = __pyx_t_3;
+
+    /* "sat_toolkit/formula.pyx":826
+ * 
+ *         for i in range(self.start_indices.size()):
+ *             if self._compare_clause(i, needle):             # <<<<<<<<<<<<<<
+ *                 return True
+ * 
+ */
+    __pyx_t_4 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_compare_clause(__pyx_v_self, __pyx_v_i, __pyx_v_needle); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 826, __pyx_L1_error)
+    __pyx_t_5 = (__pyx_t_4 != 0);
+    if (__pyx_t_5) {
+
+      /* "sat_toolkit/formula.pyx":827
+ *         for i in range(self.start_indices.size()):
+ *             if self._compare_clause(i, needle):
+ *                 return True             # <<<<<<<<<<<<<<
+ * 
+ *     def count(self, Clause needle) -> bool:
+ */
+      __pyx_r = 1;
+      goto __pyx_L0;
+
+      /* "sat_toolkit/formula.pyx":826
+ * 
+ *         for i in range(self.start_indices.size()):
+ *             if self._compare_clause(i, needle):             # <<<<<<<<<<<<<<
+ *                 return True
+ * 
+ */
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":822
+ *         return 1
+ * 
+ *     def __contains__(self, Clause needle) -> bool:             # <<<<<<<<<<<<<<
+ *         cdef size_t i
+ * 
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__contains__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":829
+ *                 return True
+ * 
+ *     def count(self, Clause needle) -> bool:             # <<<<<<<<<<<<<<
+ *         cdef size_t i, count = 0
+ * 
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_51count(PyObject *__pyx_v_self, PyObject *__pyx_v_needle); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_50count[] = "CNF.count(self, Clause needle) -> bool";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_51count(PyObject *__pyx_v_self, PyObject *__pyx_v_needle) {
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("count (wrapper)", 0);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_needle), __pyx_ptype_11sat_toolkit_7formula_Clause, 1, "needle", 0))) __PYX_ERR(0, 829, __pyx_L1_error)
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_50count(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v_needle));
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_50count(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_needle) {
+  size_t __pyx_v_i;
+  size_t __pyx_v_count;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  std::vector<size_t> ::size_type __pyx_t_1;
+  std::vector<size_t> ::size_type __pyx_t_2;
+  size_t __pyx_t_3;
+  int __pyx_t_4;
+  int __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("count", 0);
+
+  /* "sat_toolkit/formula.pyx":830
+ * 
+ *     def count(self, Clause needle) -> bool:
+ *         cdef size_t i, count = 0             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_v_count = 0;
+
+  /* "sat_toolkit/formula.pyx":833
+ * 
+ * 
+ *         for i in range(self.start_indices.size()):             # <<<<<<<<<<<<<<
+ *             if self._compare_clause(i, needle):
+ *                 count += 1
+ */
+  __pyx_t_1 = __pyx_v_self->start_indices.size();
+  __pyx_t_2 = __pyx_t_1;
+  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
+    __pyx_v_i = __pyx_t_3;
+
+    /* "sat_toolkit/formula.pyx":834
+ * 
+ *         for i in range(self.start_indices.size()):
+ *             if self._compare_clause(i, needle):             # <<<<<<<<<<<<<<
+ *                 count += 1
+ *         return count
+ */
+    __pyx_t_4 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_compare_clause(__pyx_v_self, __pyx_v_i, __pyx_v_needle); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 834, __pyx_L1_error)
+    __pyx_t_5 = (__pyx_t_4 != 0);
+    if (__pyx_t_5) {
+
+      /* "sat_toolkit/formula.pyx":835
+ *         for i in range(self.start_indices.size()):
+ *             if self._compare_clause(i, needle):
+ *                 count += 1             # <<<<<<<<<<<<<<
+ *         return count
+ * 
+ */
+      __pyx_v_count = (__pyx_v_count + 1);
+
+      /* "sat_toolkit/formula.pyx":834
+ * 
+ *         for i in range(self.start_indices.size()):
+ *             if self._compare_clause(i, needle):             # <<<<<<<<<<<<<<
+ *                 count += 1
+ *         return count
+ */
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":836
+ *             if self._compare_clause(i, needle):
+ *                 count += 1
+ *         return count             # <<<<<<<<<<<<<<
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_count); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_6);
+  __pyx_r = __pyx_t_6;
+  __pyx_t_6 = 0;
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":829
+ *                 return True
+ * 
+ *     def count(self, Clause needle) -> bool:             # <<<<<<<<<<<<<<
+ *         cdef size_t i, count = 0
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.count", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":838
+ *         return count
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):             # <<<<<<<<<<<<<<
+ *         if idx < 0:
+ *             idx += self.start_indices.size()
+ */
+
+static size_t __pyx_f_11sat_toolkit_7formula_3CNF__get_slice_index(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_ssize_t __pyx_v_idx) {
+  size_t __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  __Pyx_RefNannySetupContext("_get_slice_index", 0);
+
+  /* "sat_toolkit/formula.pyx":839
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):
+ *         if idx < 0:             # <<<<<<<<<<<<<<
+ *             idx += self.start_indices.size()
+ *         if idx < 0:
+ */
+  __pyx_t_1 = ((__pyx_v_idx < 0) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":840
+ *     cdef size_t _get_slice_index(self, ssize_t idx):
+ *         if idx < 0:
+ *             idx += self.start_indices.size()             # <<<<<<<<<<<<<<
+ *         if idx < 0:
+ *             return 0
+ */
+    __pyx_v_idx = (__pyx_v_idx + __pyx_v_self->start_indices.size());
+
+    /* "sat_toolkit/formula.pyx":839
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):
+ *         if idx < 0:             # <<<<<<<<<<<<<<
+ *             idx += self.start_indices.size()
+ *         if idx < 0:
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":841
+ *         if idx < 0:
+ *             idx += self.start_indices.size()
+ *         if idx < 0:             # <<<<<<<<<<<<<<
+ *             return 0
+ *         if <size_t> idx >= self.start_indices.size():
+ */
+  __pyx_t_1 = ((__pyx_v_idx < 0) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":842
+ *             idx += self.start_indices.size()
+ *         if idx < 0:
+ *             return 0             # <<<<<<<<<<<<<<
+ *         if <size_t> idx >= self.start_indices.size():
+ *             return self.start_indices.size()
+ */
+    __pyx_r = 0;
+    goto __pyx_L0;
+
+    /* "sat_toolkit/formula.pyx":841
+ *         if idx < 0:
+ *             idx += self.start_indices.size()
+ *         if idx < 0:             # <<<<<<<<<<<<<<
+ *             return 0
+ *         if <size_t> idx >= self.start_indices.size():
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":843
+ *         if idx < 0:
+ *             return 0
+ *         if <size_t> idx >= self.start_indices.size():             # <<<<<<<<<<<<<<
+ *             return self.start_indices.size()
+ *         return <size_t> idx
+ */
+  __pyx_t_1 = ((((size_t)__pyx_v_idx) >= __pyx_v_self->start_indices.size()) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":844
+ *             return 0
+ *         if <size_t> idx >= self.start_indices.size():
+ *             return self.start_indices.size()             # <<<<<<<<<<<<<<
+ *         return <size_t> idx
+ * 
+ */
+    __pyx_r = __pyx_v_self->start_indices.size();
+    goto __pyx_L0;
+
+    /* "sat_toolkit/formula.pyx":843
+ *         if idx < 0:
+ *             return 0
+ *         if <size_t> idx >= self.start_indices.size():             # <<<<<<<<<<<<<<
+ *             return self.start_indices.size()
+ *         return <size_t> idx
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":845
+ *         if <size_t> idx >= self.start_indices.size():
+ *             return self.start_indices.size()
+ *         return <size_t> idx             # <<<<<<<<<<<<<<
+ * 
+ *     def index(self, Clause needle, start=None, end=None) -> size_t:
+ */
+  __pyx_r = ((size_t)__pyx_v_idx);
+  goto __pyx_L0;
+
+  /* "sat_toolkit/formula.pyx":838
+ *         return count
+ * 
+ *     cdef size_t _get_slice_index(self, ssize_t idx):             # <<<<<<<<<<<<<<
+ *         if idx < 0:
+ *             idx += self.start_indices.size()
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":847
+ *         return <size_t> idx
+ * 
+ *     def index(self, Clause needle, start=None, end=None) -> size_t:             # <<<<<<<<<<<<<<
+ *         """
+ *         Return zero-based index in the list of the first item whose value is
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_53index(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_52index[] = "CNF.index(self, Clause needle, start=None, end=None) -> size_t\n\n        Return zero-based index in the list of the first item whose value is\n        equal to needle. Raises a ValueError if there is no such item.\n\n        The optional arguments start and end are interpreted as in the slice\n        notation and are used to limit the search to a particular subsequence\n        of the list. The returned index is computed relative to the beginning\n        of the full sequence rather than the start argument.\n        ";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_53index(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_needle = 0;
+  PyObject *__pyx_v_start = 0;
+  PyObject *__pyx_v_end = 0;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("index (wrapper)", 0);
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_needle,&__pyx_n_s_start,&__pyx_n_s_end,0};
+    PyObject* values[3] = {0,0,0};
+    values[1] = ((PyObject *)Py_None);
+    values[2] = ((PyObject *)Py_None);
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      switch (pos_args) {
+        case  0:
+        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_needle)) != 0)) kw_args--;
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_start);
+          if (value) { values[1] = value; kw_args--; }
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_end);
+          if (value) { values[2] = value; kw_args--; }
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "index") < 0)) __PYX_ERR(0, 847, __pyx_L3_error)
+      }
+    } else {
+      switch (PyTuple_GET_SIZE(__pyx_args)) {
+        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+    }
+    __pyx_v_needle = ((struct __pyx_obj_11sat_toolkit_7formula_Clause *)values[0]);
+    __pyx_v_start = values[1];
+    __pyx_v_end = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("index", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 847, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.index", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_needle), __pyx_ptype_11sat_toolkit_7formula_Clause, 1, "needle", 0))) __PYX_ERR(0, 847, __pyx_L1_error)
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_52index(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), __pyx_v_needle, __pyx_v_start, __pyx_v_end);
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_52index(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v_needle, PyObject *__pyx_v_start, PyObject *__pyx_v_end) {
+  size_t __pyx_v_i;
+  size_t __pyx_v_start_idx;
+  size_t __pyx_v_end_idx;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int __pyx_t_2;
+  Py_ssize_t __pyx_t_3;
+  size_t __pyx_t_4;
+  size_t __pyx_t_5;
+  size_t __pyx_t_6;
+  int __pyx_t_7;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("index", 0);
+
+  /* "sat_toolkit/formula.pyx":858
+ *         """
+ * 
+ *         cdef size_t i, start_idx = 0, end_idx = self.start_indices.size()             # <<<<<<<<<<<<<<
+ *         if start is not None:
+ *             start_idx = self._get_slice_index(start)
+ */
+  __pyx_v_start_idx = 0;
+  __pyx_v_end_idx = __pyx_v_self->start_indices.size();
+
+  /* "sat_toolkit/formula.pyx":859
+ * 
+ *         cdef size_t i, start_idx = 0, end_idx = self.start_indices.size()
+ *         if start is not None:             # <<<<<<<<<<<<<<
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:
+ */
+  __pyx_t_1 = (__pyx_v_start != Py_None);
+  __pyx_t_2 = (__pyx_t_1 != 0);
+  if (__pyx_t_2) {
+
+    /* "sat_toolkit/formula.pyx":860
+ *         cdef size_t i, start_idx = 0, end_idx = self.start_indices.size()
+ *         if start is not None:
+ *             start_idx = self._get_slice_index(start)             # <<<<<<<<<<<<<<
+ *         if end is not None:
+ *             end_idx = self._get_slice_index(end)
+ */
+    __pyx_t_3 = PyInt_AsSsize_t(__pyx_v_start); if (unlikely((__pyx_t_3 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 860, __pyx_L1_error)
+    __pyx_v_start_idx = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_get_slice_index(__pyx_v_self, __pyx_t_3);
+
+    /* "sat_toolkit/formula.pyx":859
+ * 
+ *         cdef size_t i, start_idx = 0, end_idx = self.start_indices.size()
+ *         if start is not None:             # <<<<<<<<<<<<<<
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":861
+ *         if start is not None:
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:             # <<<<<<<<<<<<<<
+ *             end_idx = self._get_slice_index(end)
+ * 
+ */
+  __pyx_t_2 = (__pyx_v_end != Py_None);
+  __pyx_t_1 = (__pyx_t_2 != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":862
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:
+ *             end_idx = self._get_slice_index(end)             # <<<<<<<<<<<<<<
+ * 
+ *         for i in range(start_idx, end_idx):
+ */
+    __pyx_t_3 = PyInt_AsSsize_t(__pyx_v_end); if (unlikely((__pyx_t_3 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 862, __pyx_L1_error)
+    __pyx_v_end_idx = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_get_slice_index(__pyx_v_self, __pyx_t_3);
+
+    /* "sat_toolkit/formula.pyx":861
+ *         if start is not None:
+ *             start_idx = self._get_slice_index(start)
+ *         if end is not None:             # <<<<<<<<<<<<<<
+ *             end_idx = self._get_slice_index(end)
+ * 
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":864
+ *             end_idx = self._get_slice_index(end)
+ * 
+ *         for i in range(start_idx, end_idx):             # <<<<<<<<<<<<<<
+ *             if self._compare_clause(i, needle):
+ *                 return i
+ */
+  __pyx_t_4 = __pyx_v_end_idx;
+  __pyx_t_5 = __pyx_t_4;
+  for (__pyx_t_6 = __pyx_v_start_idx; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
+    __pyx_v_i = __pyx_t_6;
+
+    /* "sat_toolkit/formula.pyx":865
+ * 
+ *         for i in range(start_idx, end_idx):
+ *             if self._compare_clause(i, needle):             # <<<<<<<<<<<<<<
+ *                 return i
+ * 
+ */
+    __pyx_t_7 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_self->__pyx_vtab)->_compare_clause(__pyx_v_self, __pyx_v_i, __pyx_v_needle); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 865, __pyx_L1_error)
+    __pyx_t_1 = (__pyx_t_7 != 0);
+    if (__pyx_t_1) {
+
+      /* "sat_toolkit/formula.pyx":866
+ *         for i in range(start_idx, end_idx):
+ *             if self._compare_clause(i, needle):
+ *                 return i             # <<<<<<<<<<<<<<
+ * 
+ *         raise ValueError(f'{needle} is not in CNF')
+ */
+      __Pyx_XDECREF(__pyx_r);
+      __pyx_t_8 = __Pyx_PyInt_FromSize_t(__pyx_v_i); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_8);
+      __pyx_r = __pyx_t_8;
+      __pyx_t_8 = 0;
+      goto __pyx_L0;
+
+      /* "sat_toolkit/formula.pyx":865
+ * 
+ *         for i in range(start_idx, end_idx):
+ *             if self._compare_clause(i, needle):             # <<<<<<<<<<<<<<
+ *                 return i
+ * 
+ */
+    }
+  }
+
+  /* "sat_toolkit/formula.pyx":868
+ *                 return i
+ * 
+ *         raise ValueError(f'{needle} is not in CNF')             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_t_8 = __Pyx_PyObject_FormatSimple(((PyObject *)__pyx_v_needle), __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 868, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __pyx_t_9 = __Pyx_PyUnicode_Concat(__pyx_t_8, __pyx_kp_u_is_not_in_CNF); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 868, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_9);
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 868, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+  __Pyx_Raise(__pyx_t_8, 0, 0, 0);
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __PYX_ERR(0, 868, __pyx_L1_error)
+
+  /* "sat_toolkit/formula.pyx":847
+ *         return <size_t> idx
+ * 
+ *     def index(self, Clause needle, start=None, end=None) -> size_t:             # <<<<<<<<<<<<<<
+ *         """
+ *         Return zero-based index in the list of the first item whose value is
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(__pyx_t_9);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.index", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "sat_toolkit/formula.pyx":871
+ * 
+ * 
+ *     def __eq__(self, other) -> bool:             # <<<<<<<<<<<<<<
  *         if not isinstance(other, CNF):
  *             return False
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_34__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_34__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_55__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_55__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__eq__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_33__eq__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_other));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_54__eq__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_other));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_33__eq__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_other) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_c_other = 0;
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_54__eq__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_other) {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_c_other = 0;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   __Pyx_RefNannySetupContext("__eq__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":479
+  /* "sat_toolkit/formula.pyx":872
  * 
- *     def __eq__(self, other):
+ *     def __eq__(self, other) -> bool:
  *         if not isinstance(other, CNF):             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
-  __pyx_t_1 = __Pyx_TypeCheck(__pyx_v_other, __pyx_ptype_11sat_toolkit_9_cnf_util_CNF); 
+  __pyx_t_1 = __Pyx_TypeCheck(__pyx_v_other, __pyx_ptype_11sat_toolkit_7formula_CNF); 
   __pyx_t_2 = ((!(__pyx_t_1 != 0)) != 0);
   if (__pyx_t_2) {
 
-    /* "sat_toolkit/_cnf_util.pyx":480
- *     def __eq__(self, other):
+    /* "sat_toolkit/formula.pyx":873
+ *     def __eq__(self, other) -> bool:
  *         if not isinstance(other, CNF):
  *             return False             # <<<<<<<<<<<<<<
  * 
  *         cdef CNF c_other = <CNF> other
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":479
+    /* "sat_toolkit/formula.pyx":872
  * 
- *     def __eq__(self, other):
+ *     def __eq__(self, other) -> bool:
  *         if not isinstance(other, CNF):             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":482
+  /* "sat_toolkit/formula.pyx":875
  *             return False
  * 
  *         cdef CNF c_other = <CNF> other             # <<<<<<<<<<<<<<
  * 
  *         if self.nvars != c_other.nvars:
  */
   __pyx_t_3 = __pyx_v_other;
   __Pyx_INCREF(__pyx_t_3);
-  __pyx_v_c_other = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_t_3);
+  __pyx_v_c_other = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":484
+  /* "sat_toolkit/formula.pyx":877
  *         cdef CNF c_other = <CNF> other
  * 
  *         if self.nvars != c_other.nvars:             # <<<<<<<<<<<<<<
  *             return False
  *         if self.start_indices != c_other.start_indices:
  */
   __pyx_t_2 = ((__pyx_v_self->nvars != __pyx_v_c_other->nvars) != 0);
   if (__pyx_t_2) {
 
-    /* "sat_toolkit/_cnf_util.pyx":485
+    /* "sat_toolkit/formula.pyx":878
  * 
  *         if self.nvars != c_other.nvars:
  *             return False             # <<<<<<<<<<<<<<
  *         if self.start_indices != c_other.start_indices:
  *             return False
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":484
+    /* "sat_toolkit/formula.pyx":877
  *         cdef CNF c_other = <CNF> other
  * 
  *         if self.nvars != c_other.nvars:             # <<<<<<<<<<<<<<
  *             return False
  *         if self.start_indices != c_other.start_indices:
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":486
+  /* "sat_toolkit/formula.pyx":879
  *         if self.nvars != c_other.nvars:
  *             return False
  *         if self.start_indices != c_other.start_indices:             # <<<<<<<<<<<<<<
  *             return False
  *         if self.clauses != c_other.clauses:
  */
   __pyx_t_2 = ((__pyx_v_self->start_indices != __pyx_v_c_other->start_indices) != 0);
   if (__pyx_t_2) {
 
-    /* "sat_toolkit/_cnf_util.pyx":487
+    /* "sat_toolkit/formula.pyx":880
  *             return False
  *         if self.start_indices != c_other.start_indices:
  *             return False             # <<<<<<<<<<<<<<
  *         if self.clauses != c_other.clauses:
  *             return False
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":486
+    /* "sat_toolkit/formula.pyx":879
  *         if self.nvars != c_other.nvars:
  *             return False
  *         if self.start_indices != c_other.start_indices:             # <<<<<<<<<<<<<<
  *             return False
  *         if self.clauses != c_other.clauses:
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":488
+  /* "sat_toolkit/formula.pyx":881
  *         if self.start_indices != c_other.start_indices:
  *             return False
  *         if self.clauses != c_other.clauses:             # <<<<<<<<<<<<<<
  *             return False
  *         return True
  */
   __pyx_t_2 = ((__pyx_v_self->clauses != __pyx_v_c_other->clauses) != 0);
   if (__pyx_t_2) {
 
-    /* "sat_toolkit/_cnf_util.pyx":489
+    /* "sat_toolkit/formula.pyx":882
  *             return False
  *         if self.clauses != c_other.clauses:
  *             return False             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":488
+    /* "sat_toolkit/formula.pyx":881
  *         if self.start_indices != c_other.start_indices:
  *             return False
  *         if self.clauses != c_other.clauses:             # <<<<<<<<<<<<<<
  *             return False
  *         return True
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":490
+  /* "sat_toolkit/formula.pyx":883
  *         if self.clauses != c_other.clauses:
  *             return False
  *         return True             # <<<<<<<<<<<<<<
  * 
- *     def __repr__(self):
+ *     def __repr__(self) -> str:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(Py_True);
   __pyx_r = Py_True;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":478
- *             i += 1
+  /* "sat_toolkit/formula.pyx":871
+ * 
  * 
- *     def __eq__(self, other):             # <<<<<<<<<<<<<<
+ *     def __eq__(self, other) -> bool:             # <<<<<<<<<<<<<<
  *         if not isinstance(other, CNF):
  *             return False
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_c_other);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":492
+/* "sat_toolkit/formula.pyx":885
  *         return True
  * 
- *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *     def __repr__(self) -> str:             # <<<<<<<<<<<<<<
  *         return f'CNF over {self.nvars} variables with {self.start_indices.size()} clauses'
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_36__repr__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_36__repr__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_57__repr__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_57__repr__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_35__repr__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_56__repr__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_35__repr__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_56__repr__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   Py_ssize_t __pyx_t_2;
   Py_UCS4 __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":493
+  /* "sat_toolkit/formula.pyx":886
  * 
- *     def __repr__(self):
+ *     def __repr__(self) -> str:
  *         return f'CNF over {self.nvars} variables with {self.start_indices.size()} clauses'             # <<<<<<<<<<<<<<
  * 
- *     def __str__(self):
+ *     def __str__(self) -> str:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_CNF_over);
   __pyx_t_2 += 9;
   __Pyx_GIVEREF(__pyx_kp_u_CNF_over);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_CNF_over);
-  __pyx_t_4 = __Pyx_PyUnicode_From_int(__pyx_v_self->nvars, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyUnicode_From_int(__pyx_v_self->nvars, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u_variables_with);
   __pyx_t_2 += 16;
   __Pyx_GIVEREF(__pyx_kp_u_variables_with);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_variables_with);
-  __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_v_self->start_indices.size()); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_v_self->start_indices.size()); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u_clauses_2);
   __pyx_t_2 += 8;
   __Pyx_GIVEREF(__pyx_kp_u_clauses_2);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u_clauses_2);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":492
+  /* "sat_toolkit/formula.pyx":885
  *         return True
  * 
- *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *     def __repr__(self) -> str:             # <<<<<<<<<<<<<<
  *         return f'CNF over {self.nvars} variables with {self.start_indices.size()} clauses'
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":495
+/* "sat_toolkit/formula.pyx":888
  *         return f'CNF over {self.nvars} variables with {self.start_indices.size()} clauses'
  * 
- *     def __str__(self):             # <<<<<<<<<<<<<<
+ *     def __str__(self) -> str:             # <<<<<<<<<<<<<<
  *         return self.to_dimacs()
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_38__str__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_38__str__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_59__str__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_59__str__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__str__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_37__str__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_58__str__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_37__str__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_58__str__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__str__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":496
+  /* "sat_toolkit/formula.pyx":889
  * 
- *     def __str__(self):
+ *     def __str__(self) -> str:
  *         return self.to_dimacs()             # <<<<<<<<<<<<<<
  * 
  *     # pickle support
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_dimacs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 496, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_dimacs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 889, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 496, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 889, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":495
+  /* "sat_toolkit/formula.pyx":888
  *         return f'CNF over {self.nvars} variables with {self.start_indices.size()} clauses'
  * 
- *     def __str__(self):             # <<<<<<<<<<<<<<
+ *     def __str__(self) -> str:             # <<<<<<<<<<<<<<
  *         return self.to_dimacs()
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":499
+/* "sat_toolkit/formula.pyx":892
  * 
  *     # pickle support
  *     def __reduce__(self):             # <<<<<<<<<<<<<<
- *         return CNF, (np.array(self), self.nvars)
+ *         return CNF, (np.frombuffer(self), self.nvars)
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_40__reduce__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_39__reduce__[] = "CNF.__reduce__(self)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_40__reduce__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_61__reduce__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_60__reduce__[] = "CNF.__reduce__(self)";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_61__reduce__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__reduce__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_39__reduce__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_60__reduce__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_39__reduce__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_60__reduce__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__reduce__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":500
+  /* "sat_toolkit/formula.pyx":893
  *     # pickle support
  *     def __reduce__(self):
- *         return CNF, (np.array(self), self.nvars)             # <<<<<<<<<<<<<<
+ *         return CNF, (np.frombuffer(self), self.nvars)             # <<<<<<<<<<<<<<
  * 
- *     def equiv(self, CNF other):
+ *     def equiv(self, CNF other) -> bool:
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 500, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 893, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 500, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_frombuffer); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 893, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_self)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_self));
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 500, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 893, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->nvars); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 500, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->nvars); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 893, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 500, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 893, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 500, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 893, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF));
-  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF));
-  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF));
+  __Pyx_INCREF(((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF));
+  __Pyx_GIVEREF(((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF));
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
   __pyx_t_2 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":499
+  /* "sat_toolkit/formula.pyx":892
  * 
  *     # pickle support
  *     def __reduce__(self):             # <<<<<<<<<<<<<<
- *         return CNF, (np.array(self), self.nvars)
+ *         return CNF, (np.frombuffer(self), self.nvars)
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.__reduce__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__reduce__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":502
- *         return CNF, (np.array(self), self.nvars)
+/* "sat_toolkit/formula.pyx":895
+ *         return CNF, (np.frombuffer(self), self.nvars)
  * 
- *     def equiv(self, CNF other):             # <<<<<<<<<<<<<<
+ *     def equiv(self, CNF other) -> bool:             # <<<<<<<<<<<<<<
  *         """
  *         Check for logical eqivalence between self and other.
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_42equiv(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_41equiv[] = "CNF.equiv(self, CNF other)\n\n        Check for logical eqivalence between self and other.\n        Calls `espresso -Dverify` to perform the comparison.\n        ";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_42equiv(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_63equiv(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_62equiv[] = "CNF.equiv(self, CNF other) -> bool\n\n        Check for logical eqivalence between self and other.\n        Calls `espresso -Dverify` to perform the comparison.\n        ";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_63equiv(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("equiv (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_other), __pyx_ptype_11sat_toolkit_9_cnf_util_CNF, 1, "other", 0))) __PYX_ERR(0, 502, __pyx_L1_error)
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_41equiv(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_other));
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_other), __pyx_ptype_11sat_toolkit_7formula_CNF, 1, "other", 0))) __PYX_ERR(0, 895, __pyx_L1_error)
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_62equiv(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_other));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_41equiv(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_other) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_62equiv(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_other) {
+  int __pyx_v_ret_code;
   PyObject *__pyx_v_espresso = NULL;
-  PyObject *__pyx_v_ret_code = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -10968,115 +15881,125 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
   PyObject *__pyx_t_10 = NULL;
   int __pyx_t_11;
   int __pyx_t_12;
   PyObject *__pyx_t_13 = NULL;
+  PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("equiv", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":507
+  /* "sat_toolkit/formula.pyx":900
  *         Calls `espresso -Dverify` to perform the comparison.
  *         """
+ *         cdef int ret_code = 0             # <<<<<<<<<<<<<<
+ * 
+ *         if self.nvars != other.nvars:
+ */
+  __pyx_v_ret_code = 0;
+
+  /* "sat_toolkit/formula.pyx":902
+ *         cdef int ret_code = 0
+ * 
  *         if self.nvars != other.nvars:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
   __pyx_t_1 = ((__pyx_v_self->nvars != __pyx_v_other->nvars) != 0);
   if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":508
- *         """
+    /* "sat_toolkit/formula.pyx":903
+ * 
  *         if self.nvars != other.nvars:
  *             return False             # <<<<<<<<<<<<<<
  * 
  *         with sp.Popen(['espresso', '-Dverify'], stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":507
- *         Calls `espresso -Dverify` to perform the comparison.
- *         """
+    /* "sat_toolkit/formula.pyx":902
+ *         cdef int ret_code = 0
+ * 
  *         if self.nvars != other.nvars:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":510
+  /* "sat_toolkit/formula.pyx":905
  *             return False
  * 
  *         with sp.Popen(['espresso', '-Dverify'], stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:             # <<<<<<<<<<<<<<
  *             espresso.stdin.write(self.to_espresso())
  *             espresso.stdin.write(other.to_espresso(print_numvars = False))
  */
   /*with:*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sp); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sp); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_Popen); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_Popen); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_n_u_espresso);
     __Pyx_GIVEREF(__pyx_n_u_espresso);
     PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_u_espresso);
     __Pyx_INCREF(__pyx_kp_u_Dverify);
     __Pyx_GIVEREF(__pyx_kp_u_Dverify);
     PyList_SET_ITEM(__pyx_t_2, 1, __pyx_kp_u_Dverify);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_2);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
     __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_stdin, __pyx_t_6) < 0) __PYX_ERR(0, 510, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_stdin, __pyx_t_6) < 0) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_stdout, __pyx_t_5) < 0) __PYX_ERR(0, 510, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_stdout, __pyx_t_5) < 0) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_text, Py_True) < 0) __PYX_ERR(0, 510, __pyx_L1_error)
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 510, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_text, Py_True) < 0) __PYX_ERR(0, 905, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_7 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_exit); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 510, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_exit); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 905, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 510, __pyx_L4_error)
+    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 905, __pyx_L4_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 510, __pyx_L4_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 905, __pyx_L4_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = __pyx_t_2;
     __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     /*try:*/ {
       {
@@ -11086,41 +16009,41 @@
         __Pyx_XGOTREF(__pyx_t_8);
         __Pyx_XGOTREF(__pyx_t_9);
         __Pyx_XGOTREF(__pyx_t_10);
         /*try:*/ {
           __pyx_v_espresso = __pyx_t_4;
           __pyx_t_4 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":511
+          /* "sat_toolkit/formula.pyx":906
  * 
  *         with sp.Popen(['espresso', '-Dverify'], stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:
  *             espresso.stdin.write(self.to_espresso())             # <<<<<<<<<<<<<<
  *             espresso.stdin.write(other.to_espresso(print_numvars = False))
  *             espresso.stdin.close()
  */
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 511, __pyx_L8_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 906, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 511, __pyx_L8_error)
+          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 906, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_espresso); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 511, __pyx_L8_error)
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_espresso); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 906, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_3);
           __pyx_t_6 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
             __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
             if (likely(__pyx_t_6)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
               __Pyx_INCREF(__pyx_t_6);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_3, function);
             }
           }
           __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
           __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 511, __pyx_L8_error)
+          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 906, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_3 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
             __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
             if (likely(__pyx_t_3)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -11128,37 +16051,37 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_2, function);
             }
           }
           __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5);
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 511, __pyx_L8_error)
+          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 906, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":512
+          /* "sat_toolkit/formula.pyx":907
  *         with sp.Popen(['espresso', '-Dverify'], stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:
  *             espresso.stdin.write(self.to_espresso())
  *             espresso.stdin.write(other.to_espresso(print_numvars = False))             # <<<<<<<<<<<<<<
  *             espresso.stdin.close()
  * 
  */
-          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 512, __pyx_L8_error)
+          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 907, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 512, __pyx_L8_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 907, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_other), __pyx_n_s_to_espresso); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 512, __pyx_L8_error)
+          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_other), __pyx_n_s_to_espresso); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 907, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 512, __pyx_L8_error)
+          __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 907, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_3);
-          if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_print_numvars, Py_False) < 0) __PYX_ERR(0, 512, __pyx_L8_error)
-          __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 512, __pyx_L8_error)
+          if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_print_numvars, Py_False) < 0) __PYX_ERR(0, 907, __pyx_L8_error)
+          __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 907, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_3 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_3)) {
@@ -11167,236 +16090,233 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_3, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 512, __pyx_L8_error)
+          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 907, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":513
+          /* "sat_toolkit/formula.pyx":908
  *             espresso.stdin.write(self.to_espresso())
  *             espresso.stdin.write(other.to_espresso(print_numvars = False))
  *             espresso.stdin.close()             # <<<<<<<<<<<<<<
  * 
  *             ret_code = espresso.wait()
  */
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 513, __pyx_L8_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 908, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_close); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 513, __pyx_L8_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_close); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 908, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __pyx_t_5 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
             if (likely(__pyx_t_5)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
               __Pyx_INCREF(__pyx_t_5);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_6, function);
             }
           }
           __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 513, __pyx_L8_error)
+          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 908, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":515
+          /* "sat_toolkit/formula.pyx":910
  *             espresso.stdin.close()
  * 
  *             ret_code = espresso.wait()             # <<<<<<<<<<<<<<
  *             if ret_code not in [0, 1]:
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  */
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_wait); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 515, __pyx_L8_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_wait); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 910, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_t_5 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
             if (likely(__pyx_t_5)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
               __Pyx_INCREF(__pyx_t_5);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_6, function);
             }
           }
           __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 515, __pyx_L8_error)
+          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 910, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          __pyx_v_ret_code = __pyx_t_4;
-          __pyx_t_4 = 0;
+          __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 910, __pyx_L8_error)
+          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+          __pyx_v_ret_code = __pyx_t_11;
 
-          /* "sat_toolkit/_cnf_util.pyx":516
+          /* "sat_toolkit/formula.pyx":911
  * 
  *             ret_code = espresso.wait()
  *             if ret_code not in [0, 1]:             # <<<<<<<<<<<<<<
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  */
-          __Pyx_INCREF(__pyx_v_ret_code);
-          __pyx_t_4 = __pyx_v_ret_code;
-          __pyx_t_6 = __Pyx_PyInt_NeObjC(__pyx_t_4, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 516, __pyx_L8_error)
-          __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 516, __pyx_L8_error)
-          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (__pyx_t_11) {
-          } else {
-            __pyx_t_1 = __pyx_t_11;
-            goto __pyx_L15_bool_binop_done;
+          switch (__pyx_v_ret_code) {
+            case 0:
+            case 1:
+            __pyx_t_1 = 0;
+            break;
+            default:
+            __pyx_t_1 = 1;
+            break;
           }
-          __pyx_t_6 = __Pyx_PyInt_NeObjC(__pyx_t_4, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 516, __pyx_L8_error)
-          __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 516, __pyx_L8_error)
-          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          __pyx_t_1 = __pyx_t_11;
-          __pyx_L15_bool_binop_done:;
-          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          __pyx_t_11 = (__pyx_t_1 != 0);
-          if (unlikely(__pyx_t_11)) {
+          __pyx_t_12 = (__pyx_t_1 != 0);
+          if (unlikely(__pyx_t_12)) {
 
-            /* "sat_toolkit/_cnf_util.pyx":517
+            /* "sat_toolkit/formula.pyx":912
  *             ret_code = espresso.wait()
  *             if ret_code not in [0, 1]:
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))             # <<<<<<<<<<<<<<
  * 
  *             return ret_code == 0
  */
-            __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 517, __pyx_L8_error)
+            __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 912, __pyx_L8_error)
             __Pyx_GOTREF(__pyx_t_6);
-            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_CalledProcessError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 517, __pyx_L8_error)
+            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_CalledProcessError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 912, __pyx_L8_error)
             __Pyx_GOTREF(__pyx_t_5);
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-            __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_args); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 517, __pyx_L8_error)
+            __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_ret_code); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 912, __pyx_L8_error)
             __Pyx_GOTREF(__pyx_t_6);
-            __pyx_t_3 = PyUnicode_Join(__pyx_kp_u__8, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 517, __pyx_L8_error)
+            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_args); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 912, __pyx_L8_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-            __pyx_t_6 = NULL;
-            __pyx_t_12 = 0;
+            __pyx_t_2 = PyUnicode_Join(__pyx_kp_u__7, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 912, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_2);
+            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+            __pyx_t_3 = NULL;
+            __pyx_t_11 = 0;
             if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
-              __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
-              if (likely(__pyx_t_6)) {
+              __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
+              if (likely(__pyx_t_3)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
-                __Pyx_INCREF(__pyx_t_6);
+                __Pyx_INCREF(__pyx_t_3);
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_5, function);
-                __pyx_t_12 = 1;
+                __pyx_t_11 = 1;
               }
             }
             #if CYTHON_FAST_PYCALL
             if (PyFunction_Check(__pyx_t_5)) {
-              PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_ret_code, __pyx_t_3};
-              __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 517, __pyx_L8_error)
-              __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+              PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_6, __pyx_t_2};
+              __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 912, __pyx_L8_error)
+              __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
               __Pyx_GOTREF(__pyx_t_4);
-              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+              __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             } else
             #endif
             #if CYTHON_FAST_PYCCALL
             if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
-              PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_ret_code, __pyx_t_3};
-              __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 517, __pyx_L8_error)
-              __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+              PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_6, __pyx_t_2};
+              __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 912, __pyx_L8_error)
+              __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
               __Pyx_GOTREF(__pyx_t_4);
-              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+              __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             } else
             #endif
             {
-              __pyx_t_2 = PyTuple_New(2+__pyx_t_12); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 517, __pyx_L8_error)
-              __Pyx_GOTREF(__pyx_t_2);
-              if (__pyx_t_6) {
-                __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6); __pyx_t_6 = NULL;
+              __pyx_t_13 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 912, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_13);
+              if (__pyx_t_3) {
+                __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_3); __pyx_t_3 = NULL;
               }
-              __Pyx_INCREF(__pyx_v_ret_code);
-              __Pyx_GIVEREF(__pyx_v_ret_code);
-              PyTuple_SET_ITEM(__pyx_t_2, 0+__pyx_t_12, __pyx_v_ret_code);
-              __Pyx_GIVEREF(__pyx_t_3);
-              PyTuple_SET_ITEM(__pyx_t_2, 1+__pyx_t_12, __pyx_t_3);
-              __pyx_t_3 = 0;
-              __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 517, __pyx_L8_error)
+              __Pyx_GIVEREF(__pyx_t_6);
+              PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_11, __pyx_t_6);
+              __Pyx_GIVEREF(__pyx_t_2);
+              PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_11, __pyx_t_2);
+              __pyx_t_6 = 0;
+              __pyx_t_2 = 0;
+              __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_13, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 912, __pyx_L8_error)
               __Pyx_GOTREF(__pyx_t_4);
-              __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+              __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
             }
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_Raise(__pyx_t_4, 0, 0, 0);
             __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-            __PYX_ERR(0, 517, __pyx_L8_error)
+            __PYX_ERR(0, 912, __pyx_L8_error)
 
-            /* "sat_toolkit/_cnf_util.pyx":516
+            /* "sat_toolkit/formula.pyx":911
  * 
  *             ret_code = espresso.wait()
  *             if ret_code not in [0, 1]:             # <<<<<<<<<<<<<<
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  */
           }
 
-          /* "sat_toolkit/_cnf_util.pyx":519
+          /* "sat_toolkit/formula.pyx":914
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  *             return ret_code == 0             # <<<<<<<<<<<<<<
  * 
- *     def translate(self, new_vars):
+ *     def translate(self, mapping) -> CNF:
  */
           __Pyx_XDECREF(__pyx_r);
-          __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_v_ret_code, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 519, __pyx_L8_error)
+          __pyx_t_4 = __Pyx_PyBool_FromLong((__pyx_v_ret_code == 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 914, __pyx_L8_error)
           __Pyx_GOTREF(__pyx_t_4);
           __pyx_r = __pyx_t_4;
           __pyx_t_4 = 0;
           goto __pyx_L12_try_return;
 
-          /* "sat_toolkit/_cnf_util.pyx":510
+          /* "sat_toolkit/formula.pyx":905
  *             return False
  * 
  *         with sp.Popen(['espresso', '-Dverify'], stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:             # <<<<<<<<<<<<<<
  *             espresso.stdin.write(self.to_espresso())
  *             espresso.stdin.write(other.to_espresso(print_numvars = False))
  */
         }
         __pyx_L8_error:;
+        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         /*except:*/ {
-          __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.equiv", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_2) < 0) __PYX_ERR(0, 510, __pyx_L10_except_error)
+          __Pyx_AddTraceback("sat_toolkit.formula.CNF.equiv", __pyx_clineno, __pyx_lineno, __pyx_filename);
+          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_13) < 0) __PYX_ERR(0, 905, __pyx_L10_except_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_GOTREF(__pyx_t_5);
+          __Pyx_GOTREF(__pyx_t_13);
+          __pyx_t_2 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_5, __pyx_t_13); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 905, __pyx_L10_except_error)
           __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_3 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 510, __pyx_L10_except_error)
-          __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_3, NULL);
+          __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_2, NULL);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 510, __pyx_L10_except_error)
-          __Pyx_GOTREF(__pyx_t_13);
-          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_13);
-          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          if (__pyx_t_11 < 0) __PYX_ERR(0, 510, __pyx_L10_except_error)
-          __pyx_t_1 = ((!(__pyx_t_11 != 0)) != 0);
+          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 905, __pyx_L10_except_error)
+          __Pyx_GOTREF(__pyx_t_14);
+          __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_14);
+          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+          if (__pyx_t_12 < 0) __PYX_ERR(0, 905, __pyx_L10_except_error)
+          __pyx_t_1 = ((!(__pyx_t_12 != 0)) != 0);
           if (__pyx_t_1) {
             __Pyx_GIVEREF(__pyx_t_4);
             __Pyx_GIVEREF(__pyx_t_5);
-            __Pyx_XGIVEREF(__pyx_t_2);
-            __Pyx_ErrRestoreWithState(__pyx_t_4, __pyx_t_5, __pyx_t_2);
-            __pyx_t_4 = 0; __pyx_t_5 = 0; __pyx_t_2 = 0; 
-            __PYX_ERR(0, 510, __pyx_L10_except_error)
+            __Pyx_XGIVEREF(__pyx_t_13);
+            __Pyx_ErrRestoreWithState(__pyx_t_4, __pyx_t_5, __pyx_t_13);
+            __pyx_t_4 = 0; __pyx_t_5 = 0; __pyx_t_13 = 0; 
+            __PYX_ERR(0, 905, __pyx_L10_except_error)
           }
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+          __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
           goto __pyx_L9_exception_handled;
         }
         __pyx_L10_except_error:;
         __Pyx_XGIVEREF(__pyx_t_8);
         __Pyx_XGIVEREF(__pyx_t_9);
         __Pyx_XGIVEREF(__pyx_t_10);
         __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
@@ -11413,817 +16333,947 @@
         __Pyx_XGIVEREF(__pyx_t_10);
         __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
       }
     }
     /*finally:*/ {
       /*normal exit:*/{
         if (__pyx_t_7) {
-          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__15, NULL);
+          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 510, __pyx_L1_error)
+          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 905, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_10);
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         }
         goto __pyx_L7;
       }
       __pyx_L5_return: {
         __pyx_t_10 = __pyx_r;
         __pyx_r = 0;
         if (__pyx_t_7) {
-          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__15, NULL);
+          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 510, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 905, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         }
         __pyx_r = __pyx_t_10;
         __pyx_t_10 = 0;
         goto __pyx_L0;
       }
       __pyx_L7:;
     }
-    goto __pyx_L20;
+    goto __pyx_L18;
     __pyx_L4_error:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L1_error;
-    __pyx_L20:;
+    __pyx_L18:;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":502
- *         return CNF, (np.array(self), self.nvars)
+  /* "sat_toolkit/formula.pyx":895
+ *         return CNF, (np.frombuffer(self), self.nvars)
  * 
- *     def equiv(self, CNF other):             # <<<<<<<<<<<<<<
+ *     def equiv(self, CNF other) -> bool:             # <<<<<<<<<<<<<<
  *         """
  *         Check for logical eqivalence between self and other.
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.equiv", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_13);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.equiv", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_espresso);
-  __Pyx_XDECREF(__pyx_v_ret_code);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":521
+/* "sat_toolkit/formula.pyx":916
  *             return ret_code == 0
  * 
- *     def translate(self, new_vars):             # <<<<<<<<<<<<<<
- *         cdef np_vars = np.array(new_vars, np.int32)
- *         cdef int [::1] var_view = np_vars
+ *     def translate(self, mapping) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         Translate all variables in the CNF to a new index.
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_44translate(PyObject *__pyx_v_self, PyObject *__pyx_v_new_vars); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_43translate[] = "CNF.translate(self, new_vars)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_44translate(PyObject *__pyx_v_self, PyObject *__pyx_v_new_vars) {
-  PyObject *__pyx_r = 0;
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_65translate(PyObject *__pyx_v_self, PyObject *__pyx_v_mapping); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_3CNF_64translate[] = "CNF.translate(self, mapping) -> CNF\n\n        Translate all variables in the CNF to a new index.\n        The translation mapping is given by the mapping paramter.\n\n        Index 0 must always map to index 0 again.\n\n        :return: a new CNF with variables changed according to mapping parameter\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_3CNF_65translate(PyObject *__pyx_v_self, PyObject *__pyx_v_mapping) {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("translate (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_43translate(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_new_vars));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_64translate(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((PyObject *)__pyx_v_mapping));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_43translate(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, PyObject *__pyx_v_new_vars) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_3CNF_64translate(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, PyObject *__pyx_v_mapping) {
   PyObject *__pyx_v_np_vars = 0;
   __Pyx_memviewslice __pyx_v_var_view = { 0, 0, { 0 }, { 0 }, { 0 } };
   size_t __pyx_v_i;
   std::vector<int>  __pyx_v_new_clauses;
   int __pyx_v_var;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_res = 0;
-  PyObject *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_res = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
-  __Pyx_memviewslice __pyx_t_7 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  int __pyx_t_8;
-  Py_ssize_t __pyx_t_9;
+  PyObject *__pyx_t_5 = NULL;
+  __Pyx_memviewslice __pyx_t_6 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_7;
+  Py_ssize_t __pyx_t_8;
+  size_t __pyx_t_9;
   size_t __pyx_t_10;
   size_t __pyx_t_11;
   size_t __pyx_t_12;
-  size_t __pyx_t_13;
+  std::vector<int> ::size_type __pyx_t_13;
   std::vector<int> ::size_type __pyx_t_14;
-  std::vector<int> ::size_type __pyx_t_15;
-  long __pyx_t_16;
-  int *__pyx_t_17;
-  struct __pyx_array_obj *__pyx_t_18 = NULL;
-  __Pyx_memviewslice __pyx_t_19 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  long __pyx_t_15;
+  int *__pyx_t_16;
+  struct __pyx_array_obj *__pyx_t_17 = NULL;
+  __Pyx_memviewslice __pyx_t_18 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("translate", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":522
- * 
- *     def translate(self, new_vars):
- *         cdef np_vars = np.array(new_vars, np.int32)             # <<<<<<<<<<<<<<
+  /* "sat_toolkit/formula.pyx":925
+ *         :return: a new CNF with variables changed according to mapping parameter
+ *         """
+ *         cdef np_vars = np.array(mapping, copy=False, dtype=np.int32)             # <<<<<<<<<<<<<<
  *         cdef int [::1] var_view = np_vars
  *         cdef size_t i
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 522, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 925, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 925, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 522, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 925, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_INCREF(__pyx_v_mapping);
+  __Pyx_GIVEREF(__pyx_v_mapping);
+  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_mapping);
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 925, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 522, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 522, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_copy, Py_False) < 0) __PYX_ERR(0, 925, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 925, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 925, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 925, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 925, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = NULL;
-  __pyx_t_5 = 0;
-  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
-    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
-    if (likely(__pyx_t_2)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
-      __Pyx_INCREF(__pyx_t_2);
-      __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_3, function);
-      __pyx_t_5 = 1;
-    }
-  }
-  #if CYTHON_FAST_PYCALL
-  if (PyFunction_Check(__pyx_t_3)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_new_vars, __pyx_t_4};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  } else
-  #endif
-  #if CYTHON_FAST_PYCCALL
-  if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_new_vars, __pyx_t_4};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  } else
-  #endif
-  {
-    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 522, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    if (__pyx_t_2) {
-      __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2); __pyx_t_2 = NULL;
-    }
-    __Pyx_INCREF(__pyx_v_new_vars);
-    __Pyx_GIVEREF(__pyx_v_new_vars);
-    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_new_vars);
-    __Pyx_GIVEREF(__pyx_t_4);
-    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_t_4);
-    __pyx_t_4 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  }
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_v_np_vars = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __pyx_v_np_vars = __pyx_t_5;
+  __pyx_t_5 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":523
- *     def translate(self, new_vars):
- *         cdef np_vars = np.array(new_vars, np.int32)
+  /* "sat_toolkit/formula.pyx":926
+ *         """
+ *         cdef np_vars = np.array(mapping, copy=False, dtype=np.int32)
  *         cdef int [::1] var_view = np_vars             # <<<<<<<<<<<<<<
  *         cdef size_t i
  * 
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dc_int(__pyx_v_np_vars, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 523, __pyx_L1_error)
-  __pyx_v_var_view = __pyx_t_7;
-  __pyx_t_7.memview = NULL;
-  __pyx_t_7.data = NULL;
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dc_int(__pyx_v_np_vars, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 926, __pyx_L1_error)
+  __pyx_v_var_view = __pyx_t_6;
+  __pyx_t_6.memview = NULL;
+  __pyx_t_6.data = NULL;
 
-  /* "sat_toolkit/_cnf_util.pyx":526
+  /* "sat_toolkit/formula.pyx":929
  *         cdef size_t i
  * 
  *         if var_view.shape[0] != self.nvars + 1:             # <<<<<<<<<<<<<<
  *             raise ValueError('need to provide translation for all 1+{self.nvars} variables')
  *         if var_view[0] != 0:
  */
-  __pyx_t_8 = (((__pyx_v_var_view.shape[0]) != (__pyx_v_self->nvars + 1)) != 0);
-  if (unlikely(__pyx_t_8)) {
+  __pyx_t_7 = (((__pyx_v_var_view.shape[0]) != (__pyx_v_self->nvars + 1)) != 0);
+  if (unlikely(__pyx_t_7)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":527
+    /* "sat_toolkit/formula.pyx":930
  * 
  *         if var_view.shape[0] != self.nvars + 1:
  *             raise ValueError('need to provide translation for all 1+{self.nvars} variables')             # <<<<<<<<<<<<<<
  *         if var_view[0] != 0:
- *             raise ValueError('variable 0 must be mapped to 0')
+ *             raise ValueError('variable 0 must map to 0 again')
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 527, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 527, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__23, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 930, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __PYX_ERR(0, 930, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":526
+    /* "sat_toolkit/formula.pyx":929
  *         cdef size_t i
  * 
  *         if var_view.shape[0] != self.nvars + 1:             # <<<<<<<<<<<<<<
  *             raise ValueError('need to provide translation for all 1+{self.nvars} variables')
  *         if var_view[0] != 0:
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":528
+  /* "sat_toolkit/formula.pyx":931
  *         if var_view.shape[0] != self.nvars + 1:
  *             raise ValueError('need to provide translation for all 1+{self.nvars} variables')
  *         if var_view[0] != 0:             # <<<<<<<<<<<<<<
- *             raise ValueError('variable 0 must be mapped to 0')
- *         for i in range(1, <size_t> var_view.shape[0]):
+ *             raise ValueError('variable 0 must map to 0 again')
+ * 
  */
-  __pyx_t_9 = 0;
-  __pyx_t_8 = (((*((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_var_view.data) + __pyx_t_9)) ))) != 0) != 0);
-  if (unlikely(__pyx_t_8)) {
+  __pyx_t_8 = 0;
+  __pyx_t_7 = (((*((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_var_view.data) + __pyx_t_8)) ))) != 0) != 0);
+  if (unlikely(__pyx_t_7)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":529
+    /* "sat_toolkit/formula.pyx":932
  *             raise ValueError('need to provide translation for all 1+{self.nvars} variables')
  *         if var_view[0] != 0:
- *             raise ValueError('variable 0 must be mapped to 0')             # <<<<<<<<<<<<<<
+ *             raise ValueError('variable 0 must map to 0 again')             # <<<<<<<<<<<<<<
+ * 
  *         for i in range(1, <size_t> var_view.shape[0]):
- *             if var_view[i] == 0:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__18, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 529, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 529, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 932, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __PYX_ERR(0, 932, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":528
+    /* "sat_toolkit/formula.pyx":931
  *         if var_view.shape[0] != self.nvars + 1:
  *             raise ValueError('need to provide translation for all 1+{self.nvars} variables')
  *         if var_view[0] != 0:             # <<<<<<<<<<<<<<
- *             raise ValueError('variable 0 must be mapped to 0')
- *         for i in range(1, <size_t> var_view.shape[0]):
+ *             raise ValueError('variable 0 must map to 0 again')
+ * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":530
- *         if var_view[0] != 0:
- *             raise ValueError('variable 0 must be mapped to 0')
+  /* "sat_toolkit/formula.pyx":934
+ *             raise ValueError('variable 0 must map to 0 again')
+ * 
  *         for i in range(1, <size_t> var_view.shape[0]):             # <<<<<<<<<<<<<<
  *             if var_view[i] == 0:
  *                 raise ValueError('variable must not be mapped to 0')
  */
-  __pyx_t_10 = ((size_t)(__pyx_v_var_view.shape[0]));
-  __pyx_t_11 = __pyx_t_10;
-  for (__pyx_t_12 = 1; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
-    __pyx_v_i = __pyx_t_12;
+  __pyx_t_9 = ((size_t)(__pyx_v_var_view.shape[0]));
+  __pyx_t_10 = __pyx_t_9;
+  for (__pyx_t_11 = 1; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
+    __pyx_v_i = __pyx_t_11;
 
-    /* "sat_toolkit/_cnf_util.pyx":531
- *             raise ValueError('variable 0 must be mapped to 0')
+    /* "sat_toolkit/formula.pyx":935
+ * 
  *         for i in range(1, <size_t> var_view.shape[0]):
  *             if var_view[i] == 0:             # <<<<<<<<<<<<<<
  *                 raise ValueError('variable must not be mapped to 0')
  * 
  */
-    __pyx_t_13 = __pyx_v_i;
-    __pyx_t_8 = (((*((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_var_view.data) + __pyx_t_13)) ))) == 0) != 0);
-    if (unlikely(__pyx_t_8)) {
+    __pyx_t_12 = __pyx_v_i;
+    __pyx_t_7 = (((*((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_var_view.data) + __pyx_t_12)) ))) == 0) != 0);
+    if (unlikely(__pyx_t_7)) {
 
-      /* "sat_toolkit/_cnf_util.pyx":532
+      /* "sat_toolkit/formula.pyx":936
  *         for i in range(1, <size_t> var_view.shape[0]):
  *             if var_view[i] == 0:
  *                 raise ValueError('variable must not be mapped to 0')             # <<<<<<<<<<<<<<
  * 
  *         cdef vector[int] new_clauses
  */
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__19, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 532, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __PYX_ERR(0, 532, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 936, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __Pyx_Raise(__pyx_t_5, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __PYX_ERR(0, 936, __pyx_L1_error)
 
-      /* "sat_toolkit/_cnf_util.pyx":531
- *             raise ValueError('variable 0 must be mapped to 0')
+      /* "sat_toolkit/formula.pyx":935
+ * 
  *         for i in range(1, <size_t> var_view.shape[0]):
  *             if var_view[i] == 0:             # <<<<<<<<<<<<<<
  *                 raise ValueError('variable must not be mapped to 0')
  * 
  */
     }
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":535
+  /* "sat_toolkit/formula.pyx":939
  * 
  *         cdef vector[int] new_clauses
  *         new_clauses.resize(self.clauses.size())             # <<<<<<<<<<<<<<
  * 
  *         cdef int var
  */
   try {
     __pyx_v_new_clauses.resize(__pyx_v_self->clauses.size());
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 535, __pyx_L1_error)
+    __PYX_ERR(0, 939, __pyx_L1_error)
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":538
+  /* "sat_toolkit/formula.pyx":942
  * 
  *         cdef int var
  *         for i in range(self.clauses.size()):             # <<<<<<<<<<<<<<
  *             var = self.clauses[i]
  *             new_clauses[i] = var_view[abs(var)] * (1 if var > 0 else -1)
  */
-  __pyx_t_14 = __pyx_v_self->clauses.size();
-  __pyx_t_15 = __pyx_t_14;
-  for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_15; __pyx_t_10+=1) {
-    __pyx_v_i = __pyx_t_10;
+  __pyx_t_13 = __pyx_v_self->clauses.size();
+  __pyx_t_14 = __pyx_t_13;
+  for (__pyx_t_9 = 0; __pyx_t_9 < __pyx_t_14; __pyx_t_9+=1) {
+    __pyx_v_i = __pyx_t_9;
 
-    /* "sat_toolkit/_cnf_util.pyx":539
+    /* "sat_toolkit/formula.pyx":943
  *         cdef int var
  *         for i in range(self.clauses.size()):
  *             var = self.clauses[i]             # <<<<<<<<<<<<<<
  *             new_clauses[i] = var_view[abs(var)] * (1 if var > 0 else -1)
  * 
  */
     __pyx_v_var = (__pyx_v_self->clauses[__pyx_v_i]);
 
-    /* "sat_toolkit/_cnf_util.pyx":540
+    /* "sat_toolkit/formula.pyx":944
  *         for i in range(self.clauses.size()):
  *             var = self.clauses[i]
  *             new_clauses[i] = var_view[abs(var)] * (1 if var > 0 else -1)             # <<<<<<<<<<<<<<
  * 
  *         cdef CNF res = CNF.__new__(CNF)
  */
-    __pyx_t_5 = abs(__pyx_v_var); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
-    __pyx_t_9 = __pyx_t_5;
+    __pyx_t_8 = __pyx_f_11sat_toolkit_7formula_abs(__pyx_v_var);
     if (((__pyx_v_var > 0) != 0)) {
-      __pyx_t_16 = 1;
+      __pyx_t_15 = 1;
     } else {
-      __pyx_t_16 = -1L;
+      __pyx_t_15 = -1L;
     }
-    (__pyx_v_new_clauses[__pyx_v_i]) = ((*((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_var_view.data) + __pyx_t_9)) ))) * __pyx_t_16);
+    (__pyx_v_new_clauses[__pyx_v_i]) = ((*((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_var_view.data) + __pyx_t_8)) ))) * __pyx_t_15);
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":542
+  /* "sat_toolkit/formula.pyx":946
  *             new_clauses[i] = var_view[abs(var)] * (1 if var > 0 else -1)
  * 
  *         cdef CNF res = CNF.__new__(CNF)             # <<<<<<<<<<<<<<
  *         res._add_clauses(<int[:new_clauses.size()]> new_clauses.data())
  *         return res
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_11sat_toolkit_9_cnf_util_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 542, __pyx_L1_error)
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_t_1);
-  __pyx_t_1 = 0;
+  __pyx_t_5 = ((PyObject *)__pyx_tp_new_11sat_toolkit_7formula_CNF(((PyTypeObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 946, __pyx_L1_error)
+  __Pyx_GOTREF(((PyObject *)__pyx_t_5));
+  __pyx_v_res = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_t_5);
+  __pyx_t_5 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":543
+  /* "sat_toolkit/formula.pyx":947
  * 
  *         cdef CNF res = CNF.__new__(CNF)
  *         res._add_clauses(<int[:new_clauses.size()]> new_clauses.data())             # <<<<<<<<<<<<<<
  *         return res
  * 
  */
-  __pyx_t_17 = __pyx_v_new_clauses.data();
-  if (!__pyx_t_17) {
+  __pyx_t_16 = __pyx_v_new_clauses.data();
+  if (!__pyx_t_16) {
     PyErr_SetString(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
-    __PYX_ERR(0, 543, __pyx_L1_error)
+    __PYX_ERR(0, 947, __pyx_L1_error)
   }
-  __pyx_t_3 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 543, __pyx_L1_error)
+  __pyx_t_3 = __pyx_format_from_typeinfo(&__Pyx_TypeInfo_int); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 947, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_new_clauses.size())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 543, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_18 = __pyx_array_new(__pyx_t_1, sizeof(int), PyBytes_AS_STRING(__pyx_t_3), (char *) "c", (char *) __pyx_t_17);
-  if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 543, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_18);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_5 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_v_new_clauses.size())); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 947, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_17 = __pyx_array_new(__pyx_t_5, sizeof(int), PyBytes_AS_STRING(__pyx_t_3), (char *) "c", (char *) __pyx_t_16);
+  if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 947, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_17);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(((PyObject *)__pyx_t_18), PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 543, __pyx_L1_error)
-  __Pyx_DECREF(((PyObject *)__pyx_t_18)); __pyx_t_18 = 0;
-  ((struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_19);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_19, 1);
-  __pyx_t_19.memview = NULL;
-  __pyx_t_19.data = NULL;
+  __pyx_t_18 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(((PyObject *)__pyx_t_17), 0); if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 947, __pyx_L1_error)
+  __Pyx_DECREF(((PyObject *)__pyx_t_17)); __pyx_t_17 = 0;
+  __pyx_t_19 = ((struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF *)__pyx_v_res->__pyx_vtab)->_add_clauses(__pyx_v_res, __pyx_t_18); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
+  __PYX_XDEC_MEMVIEW(&__pyx_t_18, 1);
+  __pyx_t_18.memview = NULL;
+  __pyx_t_18.data = NULL;
 
-  /* "sat_toolkit/_cnf_util.pyx":544
+  /* "sat_toolkit/formula.pyx":948
  *         cdef CNF res = CNF.__new__(CNF)
  *         res._add_clauses(<int[:new_clauses.size()]> new_clauses.data())
  *         return res             # <<<<<<<<<<<<<<
  * 
  *     # buffer support
  */
-  __Pyx_XDECREF(__pyx_r);
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_res));
-  __pyx_r = ((PyObject *)__pyx_v_res);
+  __pyx_r = __pyx_v_res;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":521
+  /* "sat_toolkit/formula.pyx":916
  *             return ret_code == 0
  * 
- *     def translate(self, new_vars):             # <<<<<<<<<<<<<<
- *         cdef np_vars = np.array(new_vars, np.int32)
- *         cdef int [::1] var_view = np_vars
+ *     def translate(self, mapping) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         Translate all variables in the CNF to a new index.
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_6);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
-  __Pyx_XDECREF(((PyObject *)__pyx_t_18));
-  __PYX_XDEC_MEMVIEW(&__pyx_t_19, 1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.translate", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_5);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
+  __Pyx_XDECREF(((PyObject *)__pyx_t_17));
+  __PYX_XDEC_MEMVIEW(&__pyx_t_18, 1);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.translate", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_np_vars);
   __PYX_XDEC_MEMVIEW(&__pyx_v_var_view, 1);
   __Pyx_XDECREF((PyObject *)__pyx_v_res);
-  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":547
+/* "sat_toolkit/formula.pyx":951
  * 
  *     # buffer support
  *     def __getbuffer__(self, cython.Py_buffer *buffer, int flags):             # <<<<<<<<<<<<<<
- *         self.shape[0] = self.clauses.size()
- * 
+ *         if flags & PyBUF_WRITABLE:
+ *             raise ValueError('cannot provide a writable buffer for CNF')
  */
 
 /* Python wrapper */
-static CYTHON_UNUSED int __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_46__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer, int __pyx_v_flags); /*proto*/
-static CYTHON_UNUSED int __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_46__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer, int __pyx_v_flags) {
+static CYTHON_UNUSED int __pyx_pw_11sat_toolkit_7formula_3CNF_67__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer, int __pyx_v_flags); /*proto*/
+static CYTHON_UNUSED int __pyx_pw_11sat_toolkit_7formula_3CNF_67__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer, int __pyx_v_flags) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__getbuffer__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_45__getbuffer__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((Py_buffer *)__pyx_v_buffer), ((int)__pyx_v_flags));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_66__getbuffer__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((Py_buffer *)__pyx_v_buffer), ((int)__pyx_v_flags));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_45__getbuffer__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, Py_buffer *__pyx_v_buffer, CYTHON_UNUSED int __pyx_v_flags) {
+static int __pyx_pf_11sat_toolkit_7formula_3CNF_66__getbuffer__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_buffer *__pyx_v_buffer, int __pyx_v_flags) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
   if (__pyx_v_buffer == NULL) {
     PyErr_SetString(PyExc_BufferError, "PyObject_GetBuffer: view==NULL argument is obsolete");
     return -1;
   }
   __Pyx_RefNannySetupContext("__getbuffer__", 0);
   __pyx_v_buffer->obj = Py_None; __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(__pyx_v_buffer->obj);
 
-  /* "sat_toolkit/_cnf_util.pyx":548
+  /* "sat_toolkit/formula.pyx":952
  *     # buffer support
  *     def __getbuffer__(self, cython.Py_buffer *buffer, int flags):
+ *         if flags & PyBUF_WRITABLE:             # <<<<<<<<<<<<<<
+ *             raise ValueError('cannot provide a writable buffer for CNF')
+ * 
+ */
+  __pyx_t_1 = ((__pyx_v_flags & PyBUF_WRITABLE) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "sat_toolkit/formula.pyx":953
+ *     def __getbuffer__(self, cython.Py_buffer *buffer, int flags):
+ *         if flags & PyBUF_WRITABLE:
+ *             raise ValueError('cannot provide a writable buffer for CNF')             # <<<<<<<<<<<<<<
+ * 
+ *         self.shape[0] = self.clauses.size()
+ */
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 953, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 953, __pyx_L1_error)
+
+    /* "sat_toolkit/formula.pyx":952
+ *     # buffer support
+ *     def __getbuffer__(self, cython.Py_buffer *buffer, int flags):
+ *         if flags & PyBUF_WRITABLE:             # <<<<<<<<<<<<<<
+ *             raise ValueError('cannot provide a writable buffer for CNF')
+ * 
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":955
+ *             raise ValueError('cannot provide a writable buffer for CNF')
+ * 
  *         self.shape[0] = self.clauses.size()             # <<<<<<<<<<<<<<
+ *         self.view_count += 1
  * 
- *         buffer.buf = <char *>&(self.clauses[0])
  */
   (__pyx_v_self->shape[0]) = __pyx_v_self->clauses.size();
 
-  /* "sat_toolkit/_cnf_util.pyx":550
+  /* "sat_toolkit/formula.pyx":956
+ * 
  *         self.shape[0] = self.clauses.size()
+ *         self.view_count += 1             # <<<<<<<<<<<<<<
+ * 
+ *         buffer.buf = <char *>&(self.clauses[0])
+ */
+  __pyx_v_self->view_count = (__pyx_v_self->view_count + 1);
+
+  /* "sat_toolkit/formula.pyx":958
+ *         self.view_count += 1
  * 
  *         buffer.buf = <char *>&(self.clauses[0])             # <<<<<<<<<<<<<<
- *         buffer.format = 'i'                     # int
- *         buffer.internal = NULL                  # see References
+ * 
+ *         if (flags & PyBUF_FORMAT) == PyBUF_FORMAT:
  */
   __pyx_v_buffer->buf = ((char *)(&(__pyx_v_self->clauses[0])));
 
-  /* "sat_toolkit/_cnf_util.pyx":551
- * 
+  /* "sat_toolkit/formula.pyx":960
  *         buffer.buf = <char *>&(self.clauses[0])
- *         buffer.format = 'i'                     # int             # <<<<<<<<<<<<<<
- *         buffer.internal = NULL                  # see References
- *         buffer.itemsize = self.strides[0]
+ * 
+ *         if (flags & PyBUF_FORMAT) == PyBUF_FORMAT:             # <<<<<<<<<<<<<<
+ *             buffer.format = 'i'                     # int
+ *         else:
  */
-  __pyx_v_buffer->format = ((char *)"i");
+  __pyx_t_1 = (((__pyx_v_flags & PyBUF_FORMAT) == PyBUF_FORMAT) != 0);
+  if (__pyx_t_1) {
 
-  /* "sat_toolkit/_cnf_util.pyx":552
+    /* "sat_toolkit/formula.pyx":961
+ * 
+ *         if (flags & PyBUF_FORMAT) == PyBUF_FORMAT:
+ *             buffer.format = 'i'                     # int             # <<<<<<<<<<<<<<
+ *         else:
+ *             buffer.format = NULL
+ */
+    __pyx_v_buffer->format = ((char *)"i");
+
+    /* "sat_toolkit/formula.pyx":960
  *         buffer.buf = <char *>&(self.clauses[0])
- *         buffer.format = 'i'                     # int
- *         buffer.internal = NULL                  # see References             # <<<<<<<<<<<<<<
- *         buffer.itemsize = self.strides[0]
- *         buffer.len = self.shape[0] * self.strides[0]
+ * 
+ *         if (flags & PyBUF_FORMAT) == PyBUF_FORMAT:             # <<<<<<<<<<<<<<
+ *             buffer.format = 'i'                     # int
+ *         else:
+ */
+    goto __pyx_L4;
+  }
+
+  /* "sat_toolkit/formula.pyx":963
+ *             buffer.format = 'i'                     # int
+ *         else:
+ *             buffer.format = NULL             # <<<<<<<<<<<<<<
+ *         buffer.internal = NULL
+ *         buffer.itemsize = sizeof(int)
+ */
+  /*else*/ {
+    __pyx_v_buffer->format = NULL;
+  }
+  __pyx_L4:;
+
+  /* "sat_toolkit/formula.pyx":964
+ *         else:
+ *             buffer.format = NULL
+ *         buffer.internal = NULL             # <<<<<<<<<<<<<<
+ *         buffer.itemsize = sizeof(int)
+ *         buffer.len = self.shape[0] * sizeof(int)
  */
   __pyx_v_buffer->internal = NULL;
 
-  /* "sat_toolkit/_cnf_util.pyx":553
- *         buffer.format = 'i'                     # int
- *         buffer.internal = NULL                  # see References
- *         buffer.itemsize = self.strides[0]             # <<<<<<<<<<<<<<
- *         buffer.len = self.shape[0] * self.strides[0]
- *         buffer.ndim = 1
- */
-  __pyx_v_buffer->itemsize = (__pyx_v_self->strides[0]);
-
-  /* "sat_toolkit/_cnf_util.pyx":554
- *         buffer.internal = NULL                  # see References
- *         buffer.itemsize = self.strides[0]
- *         buffer.len = self.shape[0] * self.strides[0]             # <<<<<<<<<<<<<<
- *         buffer.ndim = 1
+  /* "sat_toolkit/formula.pyx":965
+ *             buffer.format = NULL
+ *         buffer.internal = NULL
+ *         buffer.itemsize = sizeof(int)             # <<<<<<<<<<<<<<
+ *         buffer.len = self.shape[0] * sizeof(int)
  *         buffer.obj = self
  */
-  __pyx_v_buffer->len = ((__pyx_v_self->shape[0]) * (__pyx_v_self->strides[0]));
+  __pyx_v_buffer->itemsize = (sizeof(int));
 
-  /* "sat_toolkit/_cnf_util.pyx":555
- *         buffer.itemsize = self.strides[0]
- *         buffer.len = self.shape[0] * self.strides[0]
- *         buffer.ndim = 1             # <<<<<<<<<<<<<<
+  /* "sat_toolkit/formula.pyx":966
+ *         buffer.internal = NULL
+ *         buffer.itemsize = sizeof(int)
+ *         buffer.len = self.shape[0] * sizeof(int)             # <<<<<<<<<<<<<<
  *         buffer.obj = self
  *         buffer.readonly = 1
  */
-  __pyx_v_buffer->ndim = 1;
+  __pyx_v_buffer->len = ((__pyx_v_self->shape[0]) * (sizeof(int)));
 
-  /* "sat_toolkit/_cnf_util.pyx":556
- *         buffer.len = self.shape[0] * self.strides[0]
- *         buffer.ndim = 1
+  /* "sat_toolkit/formula.pyx":967
+ *         buffer.itemsize = sizeof(int)
+ *         buffer.len = self.shape[0] * sizeof(int)
  *         buffer.obj = self             # <<<<<<<<<<<<<<
  *         buffer.readonly = 1
- *         buffer.shape = &self.shape[0]
+ *         if (flags & PyBUF_ND) == PyBUF_ND:
  */
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
   __Pyx_GOTREF(__pyx_v_buffer->obj);
   __Pyx_DECREF(__pyx_v_buffer->obj);
   __pyx_v_buffer->obj = ((PyObject *)__pyx_v_self);
 
-  /* "sat_toolkit/_cnf_util.pyx":557
- *         buffer.ndim = 1
+  /* "sat_toolkit/formula.pyx":968
+ *         buffer.len = self.shape[0] * sizeof(int)
  *         buffer.obj = self
  *         buffer.readonly = 1             # <<<<<<<<<<<<<<
- *         buffer.shape = &self.shape[0]
- *         buffer.strides = &self.strides[0]
+ *         if (flags & PyBUF_ND) == PyBUF_ND:
+ *             buffer.ndim = 1
  */
   __pyx_v_buffer->readonly = 1;
 
-  /* "sat_toolkit/_cnf_util.pyx":558
+  /* "sat_toolkit/formula.pyx":969
  *         buffer.obj = self
  *         buffer.readonly = 1
- *         buffer.shape = &self.shape[0]             # <<<<<<<<<<<<<<
- *         buffer.strides = &self.strides[0]
- *         buffer.suboffsets = NULL                # for pointer arrays only
+ *         if (flags & PyBUF_ND) == PyBUF_ND:             # <<<<<<<<<<<<<<
+ *             buffer.ndim = 1
+ *             buffer.shape = &self.shape[0]
  */
-  __pyx_v_buffer->shape = ((Py_ssize_t *)(&(__pyx_v_self->shape[0])));
+  __pyx_t_1 = (((__pyx_v_flags & PyBUF_ND) == PyBUF_ND) != 0);
+  if (__pyx_t_1) {
 
-  /* "sat_toolkit/_cnf_util.pyx":559
+    /* "sat_toolkit/formula.pyx":970
  *         buffer.readonly = 1
- *         buffer.shape = &self.shape[0]
- *         buffer.strides = &self.strides[0]             # <<<<<<<<<<<<<<
- *         buffer.suboffsets = NULL                # for pointer arrays only
- *         self.view_count += 1
+ *         if (flags & PyBUF_ND) == PyBUF_ND:
+ *             buffer.ndim = 1             # <<<<<<<<<<<<<<
+ *             buffer.shape = &self.shape[0]
+ *         else:
  */
-  __pyx_v_buffer->strides = ((Py_ssize_t *)(&(__pyx_v_self->strides[0])));
+    __pyx_v_buffer->ndim = 1;
 
-  /* "sat_toolkit/_cnf_util.pyx":560
- *         buffer.shape = &self.shape[0]
- *         buffer.strides = &self.strides[0]
- *         buffer.suboffsets = NULL                # for pointer arrays only             # <<<<<<<<<<<<<<
- *         self.view_count += 1
+    /* "sat_toolkit/formula.pyx":971
+ *         if (flags & PyBUF_ND) == PyBUF_ND:
+ *             buffer.ndim = 1
+ *             buffer.shape = &self.shape[0]             # <<<<<<<<<<<<<<
+ *         else:
+ *             buffer.ndim = 0
+ */
+    __pyx_v_buffer->shape = ((Py_ssize_t *)(&(__pyx_v_self->shape[0])));
+
+    /* "sat_toolkit/formula.pyx":969
+ *         buffer.obj = self
+ *         buffer.readonly = 1
+ *         if (flags & PyBUF_ND) == PyBUF_ND:             # <<<<<<<<<<<<<<
+ *             buffer.ndim = 1
+ *             buffer.shape = &self.shape[0]
+ */
+    goto __pyx_L5;
+  }
+
+  /* "sat_toolkit/formula.pyx":973
+ *             buffer.shape = &self.shape[0]
+ *         else:
+ *             buffer.ndim = 0             # <<<<<<<<<<<<<<
+ *             buffer.shape = NULL
  * 
  */
-  __pyx_v_buffer->suboffsets = NULL;
+  /*else*/ {
+    __pyx_v_buffer->ndim = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":561
- *         buffer.strides = &self.strides[0]
+    /* "sat_toolkit/formula.pyx":974
+ *         else:
+ *             buffer.ndim = 0
+ *             buffer.shape = NULL             # <<<<<<<<<<<<<<
+ * 
+ *         if (flags & PyBUF_STRIDES) == PyBUF_STRIDES:
+ */
+    __pyx_v_buffer->shape = NULL;
+  }
+  __pyx_L5:;
+
+  /* "sat_toolkit/formula.pyx":976
+ *             buffer.shape = NULL
+ * 
+ *         if (flags & PyBUF_STRIDES) == PyBUF_STRIDES:             # <<<<<<<<<<<<<<
+ *             buffer.strides = &buffer.itemsize
+ *         else:
+ */
+  __pyx_t_1 = (((__pyx_v_flags & PyBUF_STRIDES) == PyBUF_STRIDES) != 0);
+  if (__pyx_t_1) {
+
+    /* "sat_toolkit/formula.pyx":977
+ * 
+ *         if (flags & PyBUF_STRIDES) == PyBUF_STRIDES:
+ *             buffer.strides = &buffer.itemsize             # <<<<<<<<<<<<<<
+ *         else:
+ *             buffer.strides = NULL
+ */
+    __pyx_v_buffer->strides = (&__pyx_v_buffer->itemsize);
+
+    /* "sat_toolkit/formula.pyx":976
+ *             buffer.shape = NULL
+ * 
+ *         if (flags & PyBUF_STRIDES) == PyBUF_STRIDES:             # <<<<<<<<<<<<<<
+ *             buffer.strides = &buffer.itemsize
+ *         else:
+ */
+    goto __pyx_L6;
+  }
+
+  /* "sat_toolkit/formula.pyx":979
+ *             buffer.strides = &buffer.itemsize
+ *         else:
+ *             buffer.strides = NULL             # <<<<<<<<<<<<<<
+ * 
  *         buffer.suboffsets = NULL                # for pointer arrays only
- *         self.view_count += 1             # <<<<<<<<<<<<<<
+ */
+  /*else*/ {
+    __pyx_v_buffer->strides = NULL;
+  }
+  __pyx_L6:;
+
+  /* "sat_toolkit/formula.pyx":981
+ *             buffer.strides = NULL
+ * 
+ *         buffer.suboffsets = NULL                # for pointer arrays only             # <<<<<<<<<<<<<<
  * 
  *     def __releasebuffer__(self, Py_buffer *buffer):
  */
-  __pyx_v_self->view_count = (__pyx_v_self->view_count + 1);
+  __pyx_v_buffer->suboffsets = NULL;
 
-  /* "sat_toolkit/_cnf_util.pyx":547
+  /* "sat_toolkit/formula.pyx":951
  * 
  *     # buffer support
  *     def __getbuffer__(self, cython.Py_buffer *buffer, int flags):             # <<<<<<<<<<<<<<
- *         self.shape[0] = self.clauses.size()
- * 
+ *         if flags & PyBUF_WRITABLE:
+ *             raise ValueError('cannot provide a writable buffer for CNF')
  */
 
   /* function exit code */
   __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.__getbuffer__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  if (__pyx_v_buffer->obj != NULL) {
+    __Pyx_GOTREF(__pyx_v_buffer->obj);
+    __Pyx_DECREF(__pyx_v_buffer->obj); __pyx_v_buffer->obj = 0;
+  }
+  goto __pyx_L2;
+  __pyx_L0:;
   if (__pyx_v_buffer->obj == Py_None) {
     __Pyx_GOTREF(__pyx_v_buffer->obj);
     __Pyx_DECREF(__pyx_v_buffer->obj); __pyx_v_buffer->obj = 0;
   }
+  __pyx_L2:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":563
- *         self.view_count += 1
+/* "sat_toolkit/formula.pyx":983
+ *         buffer.suboffsets = NULL                # for pointer arrays only
  * 
  *     def __releasebuffer__(self, Py_buffer *buffer):             # <<<<<<<<<<<<<<
+ *         buffer.buf = NULL;
  *         self.view_count -= 1
- * 
  */
 
 /* Python wrapper */
-static CYTHON_UNUSED void __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_48__releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer); /*proto*/
-static CYTHON_UNUSED void __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_48__releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer) {
+static CYTHON_UNUSED void __pyx_pw_11sat_toolkit_7formula_3CNF_69__releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer); /*proto*/
+static CYTHON_UNUSED void __pyx_pw_11sat_toolkit_7formula_3CNF_69__releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__releasebuffer__ (wrapper)", 0);
-  __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_47__releasebuffer__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self), ((Py_buffer *)__pyx_v_buffer));
+  __pyx_pf_11sat_toolkit_7formula_3CNF_68__releasebuffer__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self), ((Py_buffer *)__pyx_v_buffer));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-static void __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_47__releasebuffer__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self, CYTHON_UNUSED Py_buffer *__pyx_v_buffer) {
+static void __pyx_pf_11sat_toolkit_7formula_3CNF_68__releasebuffer__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self, Py_buffer *__pyx_v_buffer) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__releasebuffer__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":564
+  /* "sat_toolkit/formula.pyx":984
+ * 
+ *     def __releasebuffer__(self, Py_buffer *buffer):
+ *         buffer.buf = NULL;             # <<<<<<<<<<<<<<
+ *         self.view_count -= 1
  * 
+ */
+  __pyx_v_buffer->buf = NULL;
+
+  /* "sat_toolkit/formula.pyx":985
  *     def __releasebuffer__(self, Py_buffer *buffer):
+ *         buffer.buf = NULL;
  *         self.view_count -= 1             # <<<<<<<<<<<<<<
  * 
- * cdef class Truthtable:
+ * collections.abc.Sequence.register(CNF)
  */
   __pyx_v_self->view_count = (__pyx_v_self->view_count - 1);
 
-  /* "sat_toolkit/_cnf_util.pyx":563
- *         self.view_count += 1
+  /* "sat_toolkit/formula.pyx":983
+ *         buffer.suboffsets = NULL                # for pointer arrays only
  * 
  *     def __releasebuffer__(self, Py_buffer *buffer):             # <<<<<<<<<<<<<<
+ *         buffer.buf = NULL;
  *         self.view_count -= 1
- * 
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "sat_toolkit/_cnf_util.pyx":126
- *     Therefore, indices start with 1.
+/* "sat_toolkit/formula.pyx":234
+ *     CNF([1, -2, 0, 2, 3, 0]).
  *     """
  *     cdef readonly vector[int] clauses             # <<<<<<<<<<<<<<
  *     cdef readonly vector[size_t] start_indices
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_7clauses_1__get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_7clauses_1__get__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_7clauses_1__get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_7clauses_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_7clauses___get__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_7clauses___get__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_7clauses___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_7clauses___get__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_vector_to_py_int(__pyx_v_self->clauses); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 126, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_vector_to_py_int(__pyx_v_self->clauses); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.clauses.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.clauses.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":127
+/* "sat_toolkit/formula.pyx":235
  *     """
  *     cdef readonly vector[int] clauses
  *     cdef readonly vector[size_t] start_indices             # <<<<<<<<<<<<<<
  * 
  *     cdef readonly int nvars
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_13start_indices_1__get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_13start_indices_1__get__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_13start_indices_1__get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_13start_indices_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_13start_indices___get__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_13start_indices___get__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_13start_indices___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_13start_indices___get__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_vector_to_py_size_t(__pyx_v_self->start_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 127, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_vector_to_py_size_t(__pyx_v_self->start_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.start_indices.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.start_indices.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":129
+/* "sat_toolkit/formula.pyx":237
  *     cdef readonly vector[size_t] start_indices
  * 
  *     cdef readonly int nvars             # <<<<<<<<<<<<<<
  * 
  *     #used for the buffer support
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_5nvars_1__get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_5nvars_1__get__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_5nvars_1__get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3CNF_5nvars_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_3CNF_5nvars___get__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_3CNF_5nvars___get__(((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_3CNF_5nvars___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_3CNF_5nvars___get__(struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->nvars); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 129, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->nvars); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.CNF.nvars.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.CNF.nvars.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":581
+/* "sat_toolkit/formula.pyx":1005
  *     INIT_INDEX_SET = object()
  * 
  *     def __init__(self, init_key, numbits, on_set, dc_set):             # <<<<<<<<<<<<<<
  *         if init_key is not self.INIT_INDEX_SET:
  *             raise ValueError('use .from_lut or .from_indices')
  */
 
 /* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_init_key = 0;
   PyObject *__pyx_v_numbits = 0;
   PyObject *__pyx_v_on_set = 0;
   PyObject *__pyx_v_dc_set = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -12253,31 +17303,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_init_key)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_numbits)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 1); __PYX_ERR(0, 581, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 1); __PYX_ERR(0, 1005, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_on_set)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 2); __PYX_ERR(0, 581, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 2); __PYX_ERR(0, 1005, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dc_set)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 3); __PYX_ERR(0, 581, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 3); __PYX_ERR(0, 1005, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 581, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1005, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -12286,28 +17336,28 @@
     __pyx_v_init_key = values[0];
     __pyx_v_numbits = values[1];
     __pyx_v_on_set = values[2];
     __pyx_v_dc_set = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 581, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1005, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable___init__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), __pyx_v_init_key, __pyx_v_numbits, __pyx_v_on_set, __pyx_v_dc_set);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable___init__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), __pyx_v_init_key, __pyx_v_numbits, __pyx_v_on_set, __pyx_v_dc_set);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable___init__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_init_key, PyObject *__pyx_v_numbits, PyObject *__pyx_v_on_set, PyObject *__pyx_v_dc_set) {
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable___init__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_init_key, PyObject *__pyx_v_numbits, PyObject *__pyx_v_on_set, PyObject *__pyx_v_dc_set) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_t_3;
   Py_ssize_t __pyx_t_4;
   int __pyx_t_5;
@@ -12315,221 +17365,221 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":582
+  /* "sat_toolkit/formula.pyx":1006
  * 
  *     def __init__(self, init_key, numbits, on_set, dc_set):
  *         if init_key is not self.INIT_INDEX_SET:             # <<<<<<<<<<<<<<
  *             raise ValueError('use .from_lut or .from_indices')
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_INIT_INDEX_SET); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 582, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_INIT_INDEX_SET); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = (__pyx_v_init_key != __pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (unlikely(__pyx_t_3)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":583
+    /* "sat_toolkit/formula.pyx":1007
  *     def __init__(self, init_key, numbits, on_set, dc_set):
  *         if init_key is not self.INIT_INDEX_SET:
  *             raise ValueError('use .from_lut or .from_indices')             # <<<<<<<<<<<<<<
  * 
  *         if len(on_set.shape) != 1 or (dc_set is not None and len(dc_set.shape) != 1):
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__20, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 583, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__27, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1007, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 583, __pyx_L1_error)
+    __PYX_ERR(0, 1007, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":582
+    /* "sat_toolkit/formula.pyx":1006
  * 
  *     def __init__(self, init_key, numbits, on_set, dc_set):
  *         if init_key is not self.INIT_INDEX_SET:             # <<<<<<<<<<<<<<
  *             raise ValueError('use .from_lut or .from_indices')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":585
+  /* "sat_toolkit/formula.pyx":1009
  *             raise ValueError('use .from_lut or .from_indices')
  * 
  *         if len(on_set.shape) != 1 or (dc_set is not None and len(dc_set.shape) != 1):             # <<<<<<<<<<<<<<
  *             raise ValueError('parameters must be one dimensional')
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_on_set, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 585, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_on_set, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 585, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1009, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_2 = ((__pyx_t_4 != 1) != 0);
   if (!__pyx_t_2) {
   } else {
     __pyx_t_3 = __pyx_t_2;
     goto __pyx_L5_bool_binop_done;
   }
   __pyx_t_2 = (__pyx_v_dc_set != Py_None);
   __pyx_t_5 = (__pyx_t_2 != 0);
   if (__pyx_t_5) {
   } else {
     __pyx_t_3 = __pyx_t_5;
     goto __pyx_L5_bool_binop_done;
   }
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dc_set, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 585, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dc_set, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 585, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1009, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_5 = ((__pyx_t_4 != 1) != 0);
   __pyx_t_3 = __pyx_t_5;
   __pyx_L5_bool_binop_done:;
   if (unlikely(__pyx_t_3)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":586
+    /* "sat_toolkit/formula.pyx":1010
  * 
  *         if len(on_set.shape) != 1 or (dc_set is not None and len(dc_set.shape) != 1):
  *             raise ValueError('parameters must be one dimensional')             # <<<<<<<<<<<<<<
  * 
  *         self.numbits = numbits
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 586, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1010, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 586, __pyx_L1_error)
+    __PYX_ERR(0, 1010, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":585
+    /* "sat_toolkit/formula.pyx":1009
  *             raise ValueError('use .from_lut or .from_indices')
  * 
  *         if len(on_set.shape) != 1 or (dc_set is not None and len(dc_set.shape) != 1):             # <<<<<<<<<<<<<<
  *             raise ValueError('parameters must be one dimensional')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":588
+  /* "sat_toolkit/formula.pyx":1012
  *             raise ValueError('parameters must be one dimensional')
  * 
  *         self.numbits = numbits             # <<<<<<<<<<<<<<
  *         self.on_set = np.sort(on_set)
  *         self.dc_set = np.sort(dc_set)
  */
-  __pyx_t_6 = __Pyx_PyInt_As_unsigned_long(__pyx_v_numbits); if (unlikely((__pyx_t_6 == (unsigned long)-1) && PyErr_Occurred())) __PYX_ERR(0, 588, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_As_unsigned_long(__pyx_v_numbits); if (unlikely((__pyx_t_6 == (unsigned long)-1) && PyErr_Occurred())) __PYX_ERR(0, 1012, __pyx_L1_error)
   __pyx_v_self->numbits = __pyx_t_6;
 
-  /* "sat_toolkit/_cnf_util.pyx":589
+  /* "sat_toolkit/formula.pyx":1013
  * 
  *         self.numbits = numbits
  *         self.on_set = np.sort(on_set)             # <<<<<<<<<<<<<<
  *         self.dc_set = np.sort(dc_set)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 589, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_sort); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 589, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_sort); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_7 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
     if (likely(__pyx_t_7)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
       __Pyx_INCREF(__pyx_t_7);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_8, function);
     }
   }
   __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_7, __pyx_v_on_set) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_on_set);
   __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->on_set);
   __Pyx_DECREF(__pyx_v_self->on_set);
   __pyx_v_self->on_set = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":590
+  /* "sat_toolkit/formula.pyx":1014
  *         self.numbits = numbits
  *         self.on_set = np.sort(on_set)
  *         self.dc_set = np.sort(dc_set)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 590, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_sort); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 590, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_sort); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_1 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, __pyx_v_dc_set) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_dc_set);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 590, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v_self->dc_set);
   __Pyx_DECREF(__pyx_v_self->dc_set);
   __pyx_v_self->dc_set = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":581
+  /* "sat_toolkit/formula.pyx":1005
  *     INIT_INDEX_SET = object()
  * 
  *     def __init__(self, init_key, numbits, on_set, dc_set):             # <<<<<<<<<<<<<<
  *         if init_key is not self.INIT_INDEX_SET:
  *             raise ValueError('use .from_lut or .from_indices')
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":594
+/* "sat_toolkit/formula.pyx":1018
  * 
  *     @classmethod
- *     def from_lut(cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None):             # <<<<<<<<<<<<<<
+ *     def from_lut(cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None) -> Truthtable:             # <<<<<<<<<<<<<<
  *         """
  *         Creates a Truthtable from a lookup table (LUT).
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_3from_lut(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_2from_lut[] = "Truthtable.from_lut(type cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None)\n\n        Creates a Truthtable from a lookup table (LUT).\n\n        :param on_lut: specifies where the Truthtable should be on, i.e., 1\n        :param dc_lut: specifies where the value of the Truthtable can be ignored, this allows for better optimization, defaults to None\n\n        :return: Truthtable with on_set and dc_set initialized according to parameters\n        :rtype: Truthtable\n        ";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_3from_lut(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pw_11sat_toolkit_7formula_10Truthtable_3from_lut(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_10Truthtable_2from_lut[] = "Truthtable.from_lut(type cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None) -> Truthtable\n\n        Creates a Truthtable from a lookup table (LUT).\n\n        :param on_lut: specifies where the Truthtable should be on, i.e., 1\n        :param dc_lut: specifies where the value of the Truthtable can be ignored, this allows for better optimization, defaults to None\n\n        :return: Truthtable with on_set and dc_set initialized according to parameters\n        :rtype: Truthtable\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pw_11sat_toolkit_7formula_10Truthtable_3from_lut(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_on_lut = 0;
   PyObject *__pyx_v_dc_lut = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  PyObject *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("from_lut (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_on_lut,&__pyx_n_s_dc_lut,0};
     PyObject* values[2] = {0,0};
     values[1] = ((PyObject *)Py_None);
     if (unlikely(__pyx_kwds)) {
@@ -12552,15 +17602,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dc_lut);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_lut") < 0)) __PYX_ERR(0, 594, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_lut") < 0)) __PYX_ERR(0, 1018, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
@@ -12568,33 +17618,33 @@
       }
     }
     __pyx_v_on_lut = values[0];
     __pyx_v_dc_lut = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("from_lut", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 594, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("from_lut", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1018, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.from_lut", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.from_lut", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_2from_lut(((PyTypeObject*)__pyx_v_cls), __pyx_v_on_lut, __pyx_v_dc_lut);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_2from_lut(((PyTypeObject*)__pyx_v_cls), __pyx_v_on_lut, __pyx_v_dc_lut);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_2from_lut(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_on_lut, PyObject *__pyx_v_dc_lut) {
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pf_11sat_toolkit_7formula_10Truthtable_2from_lut(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_on_lut, PyObject *__pyx_v_dc_lut) {
   PyObject *__pyx_v_numvals = NULL;
   PyObject *__pyx_v_numbits = NULL;
   PyObject *__pyx_v_on_set = NULL;
   PyObject *__pyx_v_dc_set = NULL;
-  PyObject *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   Py_ssize_t __pyx_t_3;
   int __pyx_t_4;
   int __pyx_t_5;
   PyObject *__pyx_t_6 = NULL;
@@ -12605,387 +17655,387 @@
   int __pyx_t_11;
   PyObject *__pyx_t_12 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("from_lut", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":604
+  /* "sat_toolkit/formula.pyx":1028
  *         :rtype: Truthtable
  *         """
  *         if len(on_lut.shape) != 1 or (dc_lut is not None and len(dc_lut.shape) != 1):             # <<<<<<<<<<<<<<
  *             raise ValueError('parameters must be one dimensional')
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_on_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 604, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_on_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1028, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 604, __pyx_L1_error)
+  __pyx_t_3 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1028, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_4 = ((__pyx_t_3 != 1) != 0);
   if (!__pyx_t_4) {
   } else {
     __pyx_t_1 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_4 = (__pyx_v_dc_lut != Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
   } else {
     __pyx_t_1 = __pyx_t_5;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_dc_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 604, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_dc_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1028, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 604, __pyx_L1_error)
+  __pyx_t_3 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1028, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_5 = ((__pyx_t_3 != 1) != 0);
   __pyx_t_1 = __pyx_t_5;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":605
+    /* "sat_toolkit/formula.pyx":1029
  *         """
  *         if len(on_lut.shape) != 1 or (dc_lut is not None and len(dc_lut.shape) != 1):
  *             raise ValueError('parameters must be one dimensional')             # <<<<<<<<<<<<<<
  * 
  *         if dc_lut is not None and on_lut.shape != dc_lut.shape:
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 605, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1029, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 605, __pyx_L1_error)
+    __PYX_ERR(0, 1029, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":604
+    /* "sat_toolkit/formula.pyx":1028
  *         :rtype: Truthtable
  *         """
  *         if len(on_lut.shape) != 1 or (dc_lut is not None and len(dc_lut.shape) != 1):             # <<<<<<<<<<<<<<
  *             raise ValueError('parameters must be one dimensional')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":607
+  /* "sat_toolkit/formula.pyx":1031
  *             raise ValueError('parameters must be one dimensional')
  * 
  *         if dc_lut is not None and on_lut.shape != dc_lut.shape:             # <<<<<<<<<<<<<<
  *             raise ValueError('parameters must have the same shape')
  * 
  */
   __pyx_t_5 = (__pyx_v_dc_lut != Py_None);
   __pyx_t_4 = (__pyx_t_5 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_1 = __pyx_t_4;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_on_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 607, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_on_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1031, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dc_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 607, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dc_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1031, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyObject_RichCompare(__pyx_t_2, __pyx_t_6, Py_NE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 607, __pyx_L1_error)
+  __pyx_t_7 = PyObject_RichCompare(__pyx_t_2, __pyx_t_6, Py_NE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1031, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 607, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1031, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_1 = __pyx_t_4;
   __pyx_L8_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":608
+    /* "sat_toolkit/formula.pyx":1032
  * 
  *         if dc_lut is not None and on_lut.shape != dc_lut.shape:
  *             raise ValueError('parameters must have the same shape')             # <<<<<<<<<<<<<<
  * 
  *         numvals = on_lut.shape[0]
  */
-    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 608, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1032, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 608, __pyx_L1_error)
+    __PYX_ERR(0, 1032, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":607
+    /* "sat_toolkit/formula.pyx":1031
  *             raise ValueError('parameters must be one dimensional')
  * 
  *         if dc_lut is not None and on_lut.shape != dc_lut.shape:             # <<<<<<<<<<<<<<
  *             raise ValueError('parameters must have the same shape')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":610
+  /* "sat_toolkit/formula.pyx":1034
  *             raise ValueError('parameters must have the same shape')
  * 
  *         numvals = on_lut.shape[0]             # <<<<<<<<<<<<<<
  *         if (numvals & (numvals - 1)) != 0 or numvals == 0:
  *             raise ValueError('length parameter must be a power of 2')
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_on_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 610, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_on_lut, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1034, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 610, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1034, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_numvals = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":611
+  /* "sat_toolkit/formula.pyx":1035
  * 
  *         numvals = on_lut.shape[0]
  *         if (numvals & (numvals - 1)) != 0 or numvals == 0:             # <<<<<<<<<<<<<<
  *             raise ValueError('length parameter must be a power of 2')
  * 
  */
-  __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_numvals, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_numvals, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_And(__pyx_v_numvals, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_And(__pyx_v_numvals, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyInt_NeObjC(__pyx_t_7, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_NeObjC(__pyx_t_7, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   if (!__pyx_t_4) {
   } else {
     __pyx_t_1 = __pyx_t_4;
     goto __pyx_L11_bool_binop_done;
   }
-  __pyx_t_6 = __Pyx_PyInt_EqObjC(__pyx_v_numvals, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_EqObjC(__pyx_v_numvals, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_1 = __pyx_t_4;
   __pyx_L11_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":612
+    /* "sat_toolkit/formula.pyx":1036
  *         numvals = on_lut.shape[0]
  *         if (numvals & (numvals - 1)) != 0 or numvals == 0:
  *             raise ValueError('length parameter must be a power of 2')             # <<<<<<<<<<<<<<
  * 
  *         numbits = numvals.bit_length() - 1
  */
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__23, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 612, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__30, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1036, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 612, __pyx_L1_error)
+    __PYX_ERR(0, 1036, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":611
+    /* "sat_toolkit/formula.pyx":1035
  * 
  *         numvals = on_lut.shape[0]
  *         if (numvals & (numvals - 1)) != 0 or numvals == 0:             # <<<<<<<<<<<<<<
  *             raise ValueError('length parameter must be a power of 2')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":614
+  /* "sat_toolkit/formula.pyx":1038
  *             raise ValueError('length parameter must be a power of 2')
  * 
  *         numbits = numvals.bit_length() - 1             # <<<<<<<<<<<<<<
  * 
  *         if dc_lut is not None and np.any(on_lut & dc_lut):
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_numvals, __pyx_n_s_bit_length); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 614, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_numvals, __pyx_n_s_bit_length); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1038, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 614, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1038, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 614, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1038, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_numbits = __pyx_t_7;
   __pyx_t_7 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":616
+  /* "sat_toolkit/formula.pyx":1040
  *         numbits = numvals.bit_length() - 1
  * 
  *         if dc_lut is not None and np.any(on_lut & dc_lut):             # <<<<<<<<<<<<<<
  *             raise ValueError('on_lut and dc_lut must be distinct')
  * 
  */
   __pyx_t_4 = (__pyx_v_dc_lut != Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
   } else {
     __pyx_t_1 = __pyx_t_5;
     goto __pyx_L14_bool_binop_done;
   }
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 616, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_any); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 616, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_any); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_And(__pyx_v_on_lut, __pyx_v_dc_lut); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 616, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_And(__pyx_v_on_lut, __pyx_v_dc_lut); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_7 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_8, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_6);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 616, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 616, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1040, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_1 = __pyx_t_5;
   __pyx_L14_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":617
+    /* "sat_toolkit/formula.pyx":1041
  * 
  *         if dc_lut is not None and np.any(on_lut & dc_lut):
  *             raise ValueError('on_lut and dc_lut must be distinct')             # <<<<<<<<<<<<<<
  * 
  *         on_set, = np.where(on_lut)
  */
-    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 617, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__31, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1041, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 617, __pyx_L1_error)
+    __PYX_ERR(0, 1041, __pyx_L1_error)
 
-    /* "sat_toolkit/_cnf_util.pyx":616
+    /* "sat_toolkit/formula.pyx":1040
  *         numbits = numvals.bit_length() - 1
  * 
  *         if dc_lut is not None and np.any(on_lut & dc_lut):             # <<<<<<<<<<<<<<
  *             raise ValueError('on_lut and dc_lut must be distinct')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":619
+  /* "sat_toolkit/formula.pyx":1043
  *             raise ValueError('on_lut and dc_lut must be distinct')
  * 
  *         on_set, = np.where(on_lut)             # <<<<<<<<<<<<<<
  *         dc_set, = np.where(dc_lut) if dc_lut is not None else (np.array([], int),)
  *         return cls(cls.INIT_INDEX_SET, numbits, on_set, dc_set)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 619, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1043, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_where); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 619, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_where); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1043, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_7 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_2, __pyx_v_on_lut) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_on_lut);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 619, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1043, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_7))) || (PyList_CheckExact(__pyx_t_7))) {
     PyObject* sequence = __pyx_t_7;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 1)) {
       if (size > 1) __Pyx_RaiseTooManyValuesError(1);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 619, __pyx_L1_error)
+      __PYX_ERR(0, 1043, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
     } else {
       __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
     }
     __Pyx_INCREF(__pyx_t_6);
     #else
-    __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 619, __pyx_L1_error)
+    __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1043, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     #endif
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_2 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 619, __pyx_L1_error)
+    __pyx_t_2 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1043, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_9 = Py_TYPE(__pyx_t_2)->tp_iternext;
     index = 0; __pyx_t_6 = __pyx_t_9(__pyx_t_2); if (unlikely(!__pyx_t_6)) goto __pyx_L16_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_6);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_2), 1) < 0) __PYX_ERR(0, 619, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_2), 1) < 0) __PYX_ERR(0, 1043, __pyx_L1_error)
     __pyx_t_9 = NULL;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     goto __pyx_L17_unpacking_done;
     __pyx_L16_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_9 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 619, __pyx_L1_error)
+    __PYX_ERR(0, 1043, __pyx_L1_error)
     __pyx_L17_unpacking_done:;
   }
   __pyx_v_on_set = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":620
+  /* "sat_toolkit/formula.pyx":1044
  * 
  *         on_set, = np.where(on_lut)
  *         dc_set, = np.where(dc_lut) if dc_lut is not None else (np.array([], int),)             # <<<<<<<<<<<<<<
  *         return cls(cls.INIT_INDEX_SET, numbits, on_set, dc_set)
  * 
  */
   __pyx_t_1 = (__pyx_v_dc_lut != Py_None);
   if ((__pyx_t_1 != 0)) {
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_where); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 620, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_where); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_8, function);
       }
     }
     __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_2, __pyx_v_dc_lut) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_dc_lut);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 620, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_t_7 = __pyx_t_6;
     __pyx_t_6 = 0;
   } else {
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 620, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 620, __pyx_L1_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_10 = NULL;
     __pyx_t_11 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_10)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -12994,180 +18044,181 @@
         __Pyx_DECREF_SET(__pyx_t_2, function);
         __pyx_t_11 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_8, ((PyObject *)(&PyInt_Type))};
-      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 620, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1044, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_8, ((PyObject *)(&PyInt_Type))};
-      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 620, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1044, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     } else
     #endif
     {
-      __pyx_t_12 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 620, __pyx_L1_error)
+      __pyx_t_12 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1044, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       if (__pyx_t_10) {
         __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10); __pyx_t_10 = NULL;
       }
       __Pyx_GIVEREF(__pyx_t_8);
       PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_t_8);
       __Pyx_INCREF(((PyObject *)(&PyInt_Type)));
       __Pyx_GIVEREF(((PyObject *)(&PyInt_Type)));
       PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, ((PyObject *)(&PyInt_Type)));
       __pyx_t_8 = 0;
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 620, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1044, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_t_7 = __pyx_t_2;
     __pyx_t_2 = 0;
   }
   if ((likely(PyTuple_CheckExact(__pyx_t_7))) || (PyList_CheckExact(__pyx_t_7))) {
     PyObject* sequence = __pyx_t_7;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 1)) {
       if (size > 1) __Pyx_RaiseTooManyValuesError(1);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 620, __pyx_L1_error)
+      __PYX_ERR(0, 1044, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
     } else {
       __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
     }
     __Pyx_INCREF(__pyx_t_2);
     #else
-    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_6 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 620, __pyx_L1_error)
+    __pyx_t_6 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_9 = Py_TYPE(__pyx_t_6)->tp_iternext;
     index = 0; __pyx_t_2 = __pyx_t_9(__pyx_t_6); if (unlikely(!__pyx_t_2)) goto __pyx_L18_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_2);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_6), 1) < 0) __PYX_ERR(0, 620, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_6), 1) < 0) __PYX_ERR(0, 1044, __pyx_L1_error)
     __pyx_t_9 = NULL;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L19_unpacking_done;
     __pyx_L18_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_9 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 620, __pyx_L1_error)
+    __PYX_ERR(0, 1044, __pyx_L1_error)
     __pyx_L19_unpacking_done:;
   }
   __pyx_v_dc_set = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":621
+  /* "sat_toolkit/formula.pyx":1045
  *         on_set, = np.where(on_lut)
  *         dc_set, = np.where(dc_lut) if dc_lut is not None else (np.array([], int),)
  *         return cls(cls.INIT_INDEX_SET, numbits, on_set, dc_set)             # <<<<<<<<<<<<<<
  * 
  *     @classmethod
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_INIT_INDEX_SET); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 621, __pyx_L1_error)
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_INIT_INDEX_SET); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 621, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_7);
   __Pyx_INCREF(__pyx_v_numbits);
   __Pyx_GIVEREF(__pyx_v_numbits);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_numbits);
   __Pyx_INCREF(__pyx_v_on_set);
   __Pyx_GIVEREF(__pyx_v_on_set);
   PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_on_set);
   __Pyx_INCREF(__pyx_v_dc_set);
   __Pyx_GIVEREF(__pyx_v_dc_set);
   PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_v_dc_set);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_2, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 621, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_2, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_r = __pyx_t_7;
+  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_11sat_toolkit_7formula_Truthtable))))) __PYX_ERR(0, 1045, __pyx_L1_error)
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_t_7);
   __pyx_t_7 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":594
+  /* "sat_toolkit/formula.pyx":1018
  * 
  *     @classmethod
- *     def from_lut(cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None):             # <<<<<<<<<<<<<<
+ *     def from_lut(cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None) -> Truthtable:             # <<<<<<<<<<<<<<
  *         """
  *         Creates a Truthtable from a lookup table (LUT).
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_8);
   __Pyx_XDECREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_12);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.from_lut", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.from_lut", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_numvals);
   __Pyx_XDECREF(__pyx_v_numbits);
   __Pyx_XDECREF(__pyx_v_on_set);
   __Pyx_XDECREF(__pyx_v_dc_set);
-  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":624
+/* "sat_toolkit/formula.pyx":1048
  * 
  *     @classmethod
- *     def from_indices(cls, numbits: int, on_indices: np.array, dc_indices = np.array([], dtype=int)):             # <<<<<<<<<<<<<<
+ *     def from_indices(cls, numbits: int, on_indices: np.array, dc_indices = np.array([], dtype=int)) -> Truthtable:             # <<<<<<<<<<<<<<
  *         """
  *         Creates a Truthtable from the set of indices with value 1 and optionally indices where the value can be ignored.
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_5from_indices(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_4from_indices[] = "Truthtable.from_indices(type cls, numbits: int, on_indices: np.array, dc_indices=np.array([], dtype=int))\n\n        Creates a Truthtable from the set of indices with value 1 and optionally indices where the value can be ignored.\n\n        :param numbits: number of input bits for the Truthtable\n        :param on_indices: set of indices where the Truthtable should be on, i.e., 1\n        :param dc_indices: set of indices where the Truthtable value can be ignored, this allows for better optimization, defaults to []\n\n        :return: Truthtable with on_set and dc_set initialized according to parameters\n        :rtype: Truthtable\n        ";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_5from_indices(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pw_11sat_toolkit_7formula_10Truthtable_5from_indices(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_10Truthtable_4from_indices[] = "Truthtable.from_indices(type cls, numbits: int, on_indices: np.array, dc_indices=np.array([], dtype=int)) -> Truthtable\n\n        Creates a Truthtable from the set of indices with value 1 and optionally indices where the value can be ignored.\n\n        :param numbits: number of input bits for the Truthtable\n        :param on_indices: set of indices where the Truthtable should be on, i.e., 1\n        :param dc_indices: set of indices where the Truthtable value can be ignored, this allows for better optimization, defaults to []\n\n        :return: Truthtable with on_set and dc_set initialized according to parameters\n        :rtype: Truthtable\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pw_11sat_toolkit_7formula_10Truthtable_5from_indices(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_numbits = 0;
   PyObject *__pyx_v_on_indices = 0;
   PyObject *__pyx_v_dc_indices = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  PyObject *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("from_indices (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_numbits,&__pyx_n_s_on_indices,&__pyx_n_s_dc_indices,0};
     PyObject* values[3] = {0,0,0};
-    values[2] = __pyx_k__25;
+    values[2] = __pyx_k__32;
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
@@ -13182,25 +18233,25 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_numbits)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_on_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("from_indices", 0, 2, 3, 1); __PYX_ERR(0, 624, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("from_indices", 0, 2, 3, 1); __PYX_ERR(0, 1048, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dc_indices);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_indices") < 0)) __PYX_ERR(0, 624, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "from_indices") < 0)) __PYX_ERR(0, 1048, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -13210,100 +18261,101 @@
     }
     __pyx_v_numbits = values[0];
     __pyx_v_on_indices = values[1];
     __pyx_v_dc_indices = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("from_indices", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 624, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("from_indices", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1048, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.from_indices", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.from_indices", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_4from_indices(((PyTypeObject*)__pyx_v_cls), __pyx_v_numbits, __pyx_v_on_indices, __pyx_v_dc_indices);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_4from_indices(((PyTypeObject*)__pyx_v_cls), __pyx_v_numbits, __pyx_v_on_indices, __pyx_v_dc_indices);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_4from_indices(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_numbits, PyObject *__pyx_v_on_indices, PyObject *__pyx_v_dc_indices) {
-  PyObject *__pyx_r = NULL;
+static struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_pf_11sat_toolkit_7formula_10Truthtable_4from_indices(PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_numbits, PyObject *__pyx_v_on_indices, PyObject *__pyx_v_dc_indices) {
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("from_indices", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":635
+  /* "sat_toolkit/formula.pyx":1059
  *         :rtype: Truthtable
  *         """
  *         return cls(cls.INIT_INDEX_SET, numbits, on_indices, dc_indices)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_INIT_INDEX_SET); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 635, __pyx_L1_error)
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_INIT_INDEX_SET); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1059, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1059, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_INCREF(__pyx_v_numbits);
   __Pyx_GIVEREF(__pyx_v_numbits);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_numbits);
   __Pyx_INCREF(__pyx_v_on_indices);
   __Pyx_GIVEREF(__pyx_v_on_indices);
   PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_on_indices);
   __Pyx_INCREF(__pyx_v_dc_indices);
   __Pyx_GIVEREF(__pyx_v_dc_indices);
   PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_v_dc_indices);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 635, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_v_cls), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1059, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_r = __pyx_t_1;
+  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_11sat_toolkit_7formula_Truthtable))))) __PYX_ERR(0, 1059, __pyx_L1_error)
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":624
+  /* "sat_toolkit/formula.pyx":1048
  * 
  *     @classmethod
- *     def from_indices(cls, numbits: int, on_indices: np.array, dc_indices = np.array([], dtype=int)):             # <<<<<<<<<<<<<<
+ *     def from_indices(cls, numbits: int, on_indices: np.array, dc_indices = np.array([], dtype=int)) -> Truthtable:             # <<<<<<<<<<<<<<
  *         """
  *         Creates a Truthtable from the set of indices with value 1 and optionally indices where the value can be ignored.
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.from_indices", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.from_indices", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":638
+/* "sat_toolkit/formula.pyx":1062
  * 
  * 
- *     def _write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False):             # <<<<<<<<<<<<<<
+ *     def _write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False) -> None:             # <<<<<<<<<<<<<<
  *         i_list = range(1 << self.numbits)
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_6_write[] = "Truthtable._write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_7_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_10Truthtable_6_write[] = "Truthtable._write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False) -> None";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_7_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_io = 0;
   PyObject *__pyx_v_espresso = 0;
   PyObject *__pyx_v_invert = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -13342,15 +18394,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_invert);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_write") < 0)) __PYX_ERR(0, 638, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_write") < 0)) __PYX_ERR(0, 1062, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -13361,39 +18413,39 @@
     }
     __pyx_v_io = values[0];
     __pyx_v_espresso = values[1];
     __pyx_v_invert = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_write", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 638, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_write", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1062, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable._write", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable._write", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6_write(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), __pyx_v_io, __pyx_v_espresso, __pyx_v_invert);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6_write(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), __pyx_v_io, __pyx_v_espresso, __pyx_v_invert);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":651
+/* "sat_toolkit/formula.pyx":1075
  *             io.write(f'.phase {not invert:b}\n')
  * 
  *         def sorted_contains(a, v):             # <<<<<<<<<<<<<<
  *             idx = np.searchsorted(a, v)
  *             return idx < len(a) and a[idx] == v
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6_write_1sorted_contains(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_11sat_toolkit_9_cnf_util_10Truthtable_6_write_1sorted_contains = {"sorted_contains", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6_write_1sorted_contains, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6_write_1sorted_contains(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_6_write_1sorted_contains(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_11sat_toolkit_7formula_10Truthtable_6_write_1sorted_contains = {"sorted_contains", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_10Truthtable_6_write_1sorted_contains, METH_VARARGS|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_6_write_1sorted_contains(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_a = 0;
   PyObject *__pyx_v_v = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
@@ -13417,45 +18469,45 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sorted_contains", 1, 2, 2, 1); __PYX_ERR(0, 651, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sorted_contains", 1, 2, 2, 1); __PYX_ERR(0, 1075, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sorted_contains") < 0)) __PYX_ERR(0, 651, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sorted_contains") < 0)) __PYX_ERR(0, 1075, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_a = values[0];
     __pyx_v_v = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sorted_contains", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 651, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sorted_contains", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1075, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable._write.sorted_contains", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable._write.sorted_contains", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6_write_sorted_contains(__pyx_self, __pyx_v_a, __pyx_v_v);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6_write_sorted_contains(__pyx_self, __pyx_v_a, __pyx_v_v);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6_write_sorted_contains(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_a, PyObject *__pyx_v_v) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_6_write_sorted_contains(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_a, PyObject *__pyx_v_v) {
   PyObject *__pyx_v_idx = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_t_4;
@@ -13463,24 +18515,24 @@
   Py_ssize_t __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("sorted_contains", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":652
+  /* "sat_toolkit/formula.pyx":1076
  * 
  *         def sorted_contains(a, v):
  *             idx = np.searchsorted(a, v)             # <<<<<<<<<<<<<<
  *             return idx < len(a) and a[idx] == v
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 652, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1076, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_searchsorted); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 652, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_searchsorted); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1076, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
@@ -13490,113 +18542,113 @@
       __Pyx_DECREF_SET(__pyx_t_3, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_a, __pyx_v_v};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 652, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_a, __pyx_v_v};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 652, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 652, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1076, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_2) {
       __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2); __pyx_t_2 = NULL;
     }
     __Pyx_INCREF(__pyx_v_a);
     __Pyx_GIVEREF(__pyx_v_a);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_a);
     __Pyx_INCREF(__pyx_v_v);
     __Pyx_GIVEREF(__pyx_v_v);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_v);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 652, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_idx = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":653
+  /* "sat_toolkit/formula.pyx":1077
  *         def sorted_contains(a, v):
  *             idx = np.searchsorted(a, v)
  *             return idx < len(a) and a[idx] == v             # <<<<<<<<<<<<<<
  * 
  *         for i in i_list:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_6 = PyObject_Length(__pyx_v_a); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 653, __pyx_L1_error)
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 653, __pyx_L1_error)
+  __pyx_t_6 = PyObject_Length(__pyx_v_a); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1077, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1077, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyObject_RichCompare(__pyx_v_idx, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 653, __pyx_L1_error)
+  __pyx_t_5 = PyObject_RichCompare(__pyx_v_idx, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1077, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 653, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1077, __pyx_L1_error)
   if (__pyx_t_7) {
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   } else {
     __Pyx_INCREF(__pyx_t_5);
     __pyx_t_1 = __pyx_t_5;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_a, __pyx_v_idx); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 653, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_a, __pyx_v_idx); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1077, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = PyObject_RichCompare(__pyx_t_5, __pyx_v_v, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 653, __pyx_L1_error)
+  __pyx_t_3 = PyObject_RichCompare(__pyx_t_5, __pyx_v_v, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1077, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_t_3);
   __pyx_t_1 = __pyx_t_3;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_L3_bool_binop_done:;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":651
+  /* "sat_toolkit/formula.pyx":1075
  *             io.write(f'.phase {not invert:b}\n')
  * 
  *         def sorted_contains(a, v):             # <<<<<<<<<<<<<<
  *             idx = np.searchsorted(a, v)
  *             return idx < len(a) and a[idx] == v
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable._write.sorted_contains", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable._write.sorted_contains", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_idx);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":638
+/* "sat_toolkit/formula.pyx":1062
  * 
  * 
- *     def _write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False):             # <<<<<<<<<<<<<<
+ *     def _write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False) -> None:             # <<<<<<<<<<<<<<
  *         i_list = range(1 << self.numbits)
  * 
  */
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6_write(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_io, PyObject *__pyx_v_espresso, PyObject *__pyx_v_invert) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_6_write(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_io, PyObject *__pyx_v_espresso, PyObject *__pyx_v_invert) {
   PyObject *__pyx_v_i_list = NULL;
   PyObject *__pyx_v_sorted_contains = 0;
   PyObject *__pyx_v_i = NULL;
   PyObject *__pyx_v_on = NULL;
   PyObject *__pyx_v_dc = NULL;
   PyObject *__pyx_v_desc = NULL;
   PyObject *__pyx_r = NULL;
@@ -13616,133 +18668,133 @@
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_write", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":639
+  /* "sat_toolkit/formula.pyx":1063
  * 
- *     def _write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False):
+ *     def _write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False) -> None:
  *         i_list = range(1 << self.numbits)             # <<<<<<<<<<<<<<
  * 
  *         if espresso:
  */
-  __pyx_t_1 = __Pyx_PyInt_From_unsigned_long((1 << __pyx_v_self->numbits)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_unsigned_long((1 << __pyx_v_self->numbits)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1063, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1063, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_i_list = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":641
+  /* "sat_toolkit/formula.pyx":1065
  *         i_list = range(1 << self.numbits)
  * 
  *         if espresso:             # <<<<<<<<<<<<<<
  *             i_list = np.concatenate((self.on_set, self.dc_set), axis=0)
  *             i_list.sort()
  */
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_espresso); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 641, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_espresso); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1065, __pyx_L1_error)
   if (__pyx_t_3) {
 
-    /* "sat_toolkit/_cnf_util.pyx":642
+    /* "sat_toolkit/formula.pyx":1066
  * 
  *         if espresso:
  *             i_list = np.concatenate((self.on_set, self.dc_set), axis=0)             # <<<<<<<<<<<<<<
  *             i_list.sort()
  *             io.write(f'.i {self.numbits}\n')
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 642, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1066, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_concatenate); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 642, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_concatenate); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1066, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 642, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1066, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_v_self->on_set);
     __Pyx_GIVEREF(__pyx_v_self->on_set);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_self->on_set);
     __Pyx_INCREF(__pyx_v_self->dc_set);
     __Pyx_GIVEREF(__pyx_v_self->dc_set);
     PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_self->dc_set);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1066, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_2);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
     __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 642, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1066, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 642, __pyx_L1_error)
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 642, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 1066, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1066, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF_SET(__pyx_v_i_list, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":643
+    /* "sat_toolkit/formula.pyx":1067
  *         if espresso:
  *             i_list = np.concatenate((self.on_set, self.dc_set), axis=0)
  *             i_list.sort()             # <<<<<<<<<<<<<<
  *             io.write(f'.i {self.numbits}\n')
  *             io.write(f'.o 1\n')
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_i_list, __pyx_n_s_sort); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 643, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_i_list, __pyx_n_s_sort); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1067, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 643, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1067, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":644
+    /* "sat_toolkit/formula.pyx":1068
  *             i_list = np.concatenate((self.on_set, self.dc_set), axis=0)
  *             i_list.sort()
  *             io.write(f'.i {self.numbits}\n')             # <<<<<<<<<<<<<<
  *             io.write(f'.o 1\n')
  *             io.write(f'.p {len(i_list)}\n')
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 644, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1068, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 644, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1068, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_6 = 0;
     __pyx_t_7 = 127;
     __Pyx_INCREF(__pyx_kp_u_i);
     __pyx_t_6 += 3;
     __Pyx_GIVEREF(__pyx_kp_u_i);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_i);
-    __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 644, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1068, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_1, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 644, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_1, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1068, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
     __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_8);
     __pyx_t_8 = 0;
-    __Pyx_INCREF(__pyx_kp_u__13);
+    __Pyx_INCREF(__pyx_kp_u__17);
     __pyx_t_6 += 1;
-    __Pyx_GIVEREF(__pyx_kp_u__13);
-    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u__13);
-    __pyx_t_8 = __Pyx_PyUnicode_Join(__pyx_t_4, 3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 644, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__17);
+    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u__17);
+    __pyx_t_8 = __Pyx_PyUnicode_Join(__pyx_t_4, 3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1068, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -13750,74 +18802,74 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_8);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 644, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1068, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":645
+    /* "sat_toolkit/formula.pyx":1069
  *             i_list.sort()
  *             io.write(f'.i {self.numbits}\n')
  *             io.write(f'.o 1\n')             # <<<<<<<<<<<<<<
  *             io.write(f'.p {len(i_list)}\n')
  * 
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 645, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1069, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_8 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_8);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_8, __pyx_kp_u_o_1) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_o_1);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 645, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1069, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":646
+    /* "sat_toolkit/formula.pyx":1070
  *             io.write(f'.i {self.numbits}\n')
  *             io.write(f'.o 1\n')
  *             io.write(f'.p {len(i_list)}\n')             # <<<<<<<<<<<<<<
  * 
  *             # this parameter is important so espresso minimizes the inverted function
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 646, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1070, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 646, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1070, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_6 = 0;
     __pyx_t_7 = 127;
     __Pyx_INCREF(__pyx_kp_u_p);
     __pyx_t_6 += 3;
     __Pyx_GIVEREF(__pyx_kp_u_p);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_kp_u_p);
-    __pyx_t_9 = PyObject_Length(__pyx_v_i_list); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 646, __pyx_L1_error)
-    __pyx_t_4 = __Pyx_PyUnicode_From_Py_ssize_t(__pyx_t_9, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 646, __pyx_L1_error)
+    __pyx_t_9 = PyObject_Length(__pyx_v_i_list); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1070, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_From_Py_ssize_t(__pyx_t_9, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1070, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_4);
     __pyx_t_4 = 0;
-    __Pyx_INCREF(__pyx_kp_u__13);
+    __Pyx_INCREF(__pyx_kp_u__17);
     __pyx_t_6 += 1;
-    __Pyx_GIVEREF(__pyx_kp_u__13);
-    PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_kp_u__13);
-    __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_8, 3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 646, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__17);
+    PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_kp_u__17);
+    __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_8, 3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1070, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_t_8 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -13825,52 +18877,52 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_8, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 646, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1070, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":649
+    /* "sat_toolkit/formula.pyx":1073
  * 
  *             # this parameter is important so espresso minimizes the inverted function
  *             io.write(f'.phase {not invert:b}\n')             # <<<<<<<<<<<<<<
  * 
  *         def sorted_contains(a, v):
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 649, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 649, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_6 = 0;
     __pyx_t_7 = 127;
     __Pyx_INCREF(__pyx_kp_u_phase);
     __pyx_t_6 += 7;
     __Pyx_GIVEREF(__pyx_kp_u_phase);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_phase);
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_invert); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 649, __pyx_L1_error)
-    __pyx_t_8 = __Pyx_PyBool_FromLong((!__pyx_t_3)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 649, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_invert); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1073, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyBool_FromLong((!__pyx_t_3)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_1 = __Pyx_PyObject_Format(__pyx_t_8, __pyx_n_u_b); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 649, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Format(__pyx_t_8, __pyx_n_u_b); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_7;
     __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
     __pyx_t_1 = 0;
-    __Pyx_INCREF(__pyx_kp_u__13);
+    __Pyx_INCREF(__pyx_kp_u__17);
     __pyx_t_6 += 1;
-    __Pyx_GIVEREF(__pyx_kp_u__13);
-    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u__13);
-    __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_4, 3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 649, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__17);
+    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u__17);
+    __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_4, 3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -13878,193 +18930,193 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 649, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":641
+    /* "sat_toolkit/formula.pyx":1065
  *         i_list = range(1 << self.numbits)
  * 
  *         if espresso:             # <<<<<<<<<<<<<<
  *             i_list = np.concatenate((self.on_set, self.dc_set), axis=0)
  *             i_list.sort()
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":651
+  /* "sat_toolkit/formula.pyx":1075
  *             io.write(f'.phase {not invert:b}\n')
  * 
  *         def sorted_contains(a, v):             # <<<<<<<<<<<<<<
  *             idx = np.searchsorted(a, v)
  *             return idx < len(a) and a[idx] == v
  */
-  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_11sat_toolkit_9_cnf_util_10Truthtable_6_write_1sorted_contains, 0, __pyx_n_s_write_locals_sorted_contains, NULL, __pyx_n_s_sat_toolkit__cnf_util, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 651, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_11sat_toolkit_7formula_10Truthtable_6_write_1sorted_contains, 0, __pyx_n_s_write_locals_sorted_contains, NULL, __pyx_n_s_sat_toolkit_formula, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1075, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_v_sorted_contains = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":655
+  /* "sat_toolkit/formula.pyx":1079
  *             return idx < len(a) and a[idx] == v
  * 
  *         for i in i_list:             # <<<<<<<<<<<<<<
  *             on, dc = sorted_contains(self.on_set, i), sorted_contains(self.dc_set, i)
  *             desc = '-' if dc else f'{on:b}'
  */
   if (likely(PyList_CheckExact(__pyx_v_i_list)) || PyTuple_CheckExact(__pyx_v_i_list)) {
     __pyx_t_5 = __pyx_v_i_list; __Pyx_INCREF(__pyx_t_5); __pyx_t_6 = 0;
     __pyx_t_10 = NULL;
   } else {
-    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_i_list); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 655, __pyx_L1_error)
+    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_i_list); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1079, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 655, __pyx_L1_error)
+    __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1079, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_10)) {
       if (likely(PyList_CheckExact(__pyx_t_5))) {
         if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_2); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 655, __pyx_L1_error)
+        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_2); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 1079, __pyx_L1_error)
         #else
-        __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 655, __pyx_L1_error)
+        __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1079, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         #endif
       } else {
         if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_2); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 655, __pyx_L1_error)
+        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_2); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 1079, __pyx_L1_error)
         #else
-        __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 655, __pyx_L1_error)
+        __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1079, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         #endif
       }
     } else {
       __pyx_t_2 = __pyx_t_10(__pyx_t_5);
       if (unlikely(!__pyx_t_2)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 655, __pyx_L1_error)
+          else __PYX_ERR(0, 1079, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_2);
     }
     __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":656
+    /* "sat_toolkit/formula.pyx":1080
  * 
  *         for i in i_list:
  *             on, dc = sorted_contains(self.on_set, i), sorted_contains(self.dc_set, i)             # <<<<<<<<<<<<<<
  *             desc = '-' if dc else f'{on:b}'
  *             io.write(f'{i:0{self.numbits}b} {desc}\n')
  */
     __pyx_t_2 = __pyx_v_self->on_set;
     __Pyx_INCREF(__pyx_t_2);
-    __pyx_t_1 = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6_write_sorted_contains(__pyx_v_sorted_contains, __pyx_t_2, __pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 656, __pyx_L1_error)
+    __pyx_t_1 = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6_write_sorted_contains(__pyx_v_sorted_contains, __pyx_t_2, __pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1080, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = __pyx_v_self->dc_set;
     __Pyx_INCREF(__pyx_t_2);
-    __pyx_t_4 = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6_write_sorted_contains(__pyx_v_sorted_contains, __pyx_t_2, __pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 656, __pyx_L1_error)
+    __pyx_t_4 = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6_write_sorted_contains(__pyx_v_sorted_contains, __pyx_t_2, __pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1080, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF_SET(__pyx_v_on, __pyx_t_1);
     __pyx_t_1 = 0;
     __Pyx_XDECREF_SET(__pyx_v_dc, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":657
+    /* "sat_toolkit/formula.pyx":1081
  *         for i in i_list:
  *             on, dc = sorted_contains(self.on_set, i), sorted_contains(self.dc_set, i)
  *             desc = '-' if dc else f'{on:b}'             # <<<<<<<<<<<<<<
  *             io.write(f'{i:0{self.numbits}b} {desc}\n')
  * 
  */
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_dc); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 657, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_dc); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1081, __pyx_L1_error)
     if (__pyx_t_3) {
-      __Pyx_INCREF(__pyx_kp_u__28);
-      __pyx_t_4 = __pyx_kp_u__28;
+      __Pyx_INCREF(__pyx_kp_u__35);
+      __pyx_t_4 = __pyx_kp_u__35;
     } else {
-      __pyx_t_1 = __Pyx_PyObject_Format(__pyx_v_on, __pyx_n_u_b); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 657, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Format(__pyx_v_on, __pyx_n_u_b); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1081, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __pyx_t_4 = __pyx_t_1;
       __pyx_t_1 = 0;
     }
     __Pyx_XDECREF_SET(__pyx_v_desc, ((PyObject*)__pyx_t_4));
     __pyx_t_4 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":658
+    /* "sat_toolkit/formula.pyx":1082
  *             on, dc = sorted_contains(self.on_set, i), sorted_contains(self.dc_set, i)
  *             desc = '-' if dc else f'{on:b}'
  *             io.write(f'{i:0{self.numbits}b} {desc}\n')             # <<<<<<<<<<<<<<
  * 
  *         # ensure that we write some PLA description
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_9 = 0;
     __pyx_t_7 = 127;
-    __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_11 = 0;
     __pyx_t_12 = 127;
     __Pyx_INCREF(__pyx_kp_u_0);
     __pyx_t_11 += 1;
     __Pyx_GIVEREF(__pyx_kp_u_0);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_kp_u_0);
-    __pyx_t_13 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyObject_FormatSimple(__pyx_t_13, __pyx_empty_unicode); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyObject_FormatSimple(__pyx_t_13, __pyx_empty_unicode); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_12 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_14) > __pyx_t_12) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_14) : __pyx_t_12;
     __pyx_t_11 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_14);
     PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14);
     __pyx_t_14 = 0;
     __Pyx_INCREF(__pyx_n_u_b);
     __pyx_t_11 += 1;
     __Pyx_GIVEREF(__pyx_n_u_b);
     PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_n_u_b);
-    __pyx_t_14 = __Pyx_PyUnicode_Join(__pyx_t_8, 3, __pyx_t_11, __pyx_t_12); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyUnicode_Join(__pyx_t_8, 3, __pyx_t_11, __pyx_t_12); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Format(__pyx_v_i, __pyx_t_14); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Format(__pyx_v_i, __pyx_t_14); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
     __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
     __pyx_t_9 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_8);
     __pyx_t_8 = 0;
-    __Pyx_INCREF(__pyx_kp_u__8);
+    __Pyx_INCREF(__pyx_kp_u__7);
     __pyx_t_9 += 1;
-    __Pyx_GIVEREF(__pyx_kp_u__8);
-    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_kp_u__8);
-    __pyx_t_8 = __Pyx_PyUnicode_Unicode(__pyx_v_desc); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__7);
+    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_kp_u__7);
+    __pyx_t_8 = __Pyx_PyUnicode_Unicode(__pyx_v_desc); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
     __pyx_t_9 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_t_8);
     __pyx_t_8 = 0;
-    __Pyx_INCREF(__pyx_kp_u__13);
+    __Pyx_INCREF(__pyx_kp_u__17);
     __pyx_t_9 += 1;
-    __Pyx_GIVEREF(__pyx_kp_u__13);
-    PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_kp_u__13);
-    __pyx_t_8 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_9, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__17);
+    PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_kp_u__17);
+    __pyx_t_8 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_9, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
@@ -14072,55 +19124,55 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_8);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 658, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1082, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":655
+    /* "sat_toolkit/formula.pyx":1079
  *             return idx < len(a) and a[idx] == v
  * 
  *         for i in i_list:             # <<<<<<<<<<<<<<
  *             on, dc = sorted_contains(self.on_set, i), sorted_contains(self.dc_set, i)
  *             desc = '-' if dc else f'{on:b}'
  */
   }
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":661
+  /* "sat_toolkit/formula.pyx":1085
  * 
  *         # ensure that we write some PLA description
  *         if len(i_list) == 0:             # <<<<<<<<<<<<<<
  *             io.write('-' * self.numbits + ' 0\n')
  * 
  */
-  __pyx_t_6 = PyObject_Length(__pyx_v_i_list); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 661, __pyx_L1_error)
+  __pyx_t_6 = PyObject_Length(__pyx_v_i_list); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1085, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_6 == 0) != 0);
   if (__pyx_t_3) {
 
-    /* "sat_toolkit/_cnf_util.pyx":662
+    /* "sat_toolkit/formula.pyx":1086
  *         # ensure that we write some PLA description
  *         if len(i_list) == 0:
  *             io.write('-' * self.numbits + ' 0\n')             # <<<<<<<<<<<<<<
  * 
  *         if espresso:
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 662, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1086, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1086, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = PyNumber_Multiply(__pyx_kp_u__28, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 662, __pyx_L1_error)
+    __pyx_t_8 = PyNumber_Multiply(__pyx_kp_u__35, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1086, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyNumber_Add(__pyx_t_8, __pyx_kp_u_0_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Add(__pyx_t_8, __pyx_kp_u_0_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1086, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_t_8 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -14128,77 +19180,77 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_8, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 662, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1086, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":661
+    /* "sat_toolkit/formula.pyx":1085
  * 
  *         # ensure that we write some PLA description
  *         if len(i_list) == 0:             # <<<<<<<<<<<<<<
  *             io.write('-' * self.numbits + ' 0\n')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":664
+  /* "sat_toolkit/formula.pyx":1088
  *             io.write('-' * self.numbits + ' 0\n')
  * 
  *         if espresso:             # <<<<<<<<<<<<<<
  *             io.write(f'.end\n')
  * 
  */
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_espresso); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 664, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_espresso); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1088, __pyx_L1_error)
   if (__pyx_t_3) {
 
-    /* "sat_toolkit/_cnf_util.pyx":665
+    /* "sat_toolkit/formula.pyx":1089
  * 
  *         if espresso:
  *             io.write(f'.end\n')             # <<<<<<<<<<<<<<
  * 
- *     def to_espresso(self, phase='cnf'):
+ *     def to_espresso(self, phase='cnf') -> str:
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 665, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_io, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1089, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_1 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_1)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_1);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
-    __pyx_t_5 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_1, __pyx_kp_u_end) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u_end);
+    __pyx_t_5 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_1, __pyx_kp_u_end_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u_end_2);
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 665, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1089, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":664
+    /* "sat_toolkit/formula.pyx":1088
  *             io.write('-' * self.numbits + ' 0\n')
  * 
  *         if espresso:             # <<<<<<<<<<<<<<
  *             io.write(f'.end\n')
  * 
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":638
+  /* "sat_toolkit/formula.pyx":1062
  * 
  * 
- *     def _write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False):             # <<<<<<<<<<<<<<
+ *     def _write(self, io: io.TextIOBase, espresso: bool = False, invert: bool = False) -> None:             # <<<<<<<<<<<<<<
  *         i_list = range(1 << self.numbits)
  * 
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -14206,40 +19258,40 @@
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_8);
   __Pyx_XDECREF(__pyx_t_13);
   __Pyx_XDECREF(__pyx_t_14);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable._write", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable._write", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_i_list);
   __Pyx_XDECREF(__pyx_v_sorted_contains);
   __Pyx_XDECREF(__pyx_v_i);
   __Pyx_XDECREF(__pyx_v_on);
   __Pyx_XDECREF(__pyx_v_dc);
   __Pyx_XDECREF(__pyx_v_desc);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":667
+/* "sat_toolkit/formula.pyx":1091
  *             io.write(f'.end\n')
  * 
- *     def to_espresso(self, phase='cnf'):             # <<<<<<<<<<<<<<
+ *     def to_espresso(self, phase='cnf') -> str:             # <<<<<<<<<<<<<<
  *         """
  *         return the truthtable in espresso format
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_9to_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_8to_espresso[] = "Truthtable.to_espresso(self, phase=u'cnf')\n\n        return the truthtable in espresso format\n\n        :param phase: wether to minimize the off_set ('cnf'/0) or on_set ('dnf'/1)\n\n        :return: Truthtable with on_set and dc_set initialized according to parameters\n        :rtype: Truthtable\n        ";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_9to_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_9to_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_10Truthtable_8to_espresso[] = "Truthtable.to_espresso(self, phase=u'cnf') -> str\n\n        return the truthtable in espresso format\n\n        :param phase: wether to minimize the off_set ('cnf'/0) or on_set ('dnf'/1)\n\n        :return: Truthtable with on_set and dc_set initialized according to parameters\n        :rtype: Truthtable\n        ";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_9to_espresso(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_phase = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("to_espresso (wrapper)", 0);
@@ -14261,42 +19313,42 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_phase_2);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "to_espresso") < 0)) __PYX_ERR(0, 667, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "to_espresso") < 0)) __PYX_ERR(0, 1091, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_phase = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("to_espresso", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 667, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("to_espresso", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1091, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.to_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.to_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_8to_espresso(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), __pyx_v_phase);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_8to_espresso(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), __pyx_v_phase);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_8to_espresso(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_phase) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_8to_espresso(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_phase) {
   int __pyx_v_invert;
   PyObject *__pyx_v_res = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
@@ -14306,162 +19358,162 @@
   int __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("to_espresso", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":676
+  /* "sat_toolkit/formula.pyx":1100
  *         :rtype: Truthtable
  *         """
  *         if phase == 'cnf' or phase == '0' or phase == 0:             # <<<<<<<<<<<<<<
  *             invert = True
  *         elif phase == 'dnf' or phase == '1' or phase == 1:
  */
-  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_phase, __pyx_n_u_cnf, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 676, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_phase, __pyx_n_u_cnf, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1100, __pyx_L1_error)
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_phase, __pyx_kp_u_0, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 676, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_phase, __pyx_kp_u_0, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1100, __pyx_L1_error)
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_phase, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 676, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_phase, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 676, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1100, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "sat_toolkit/_cnf_util.pyx":677
+    /* "sat_toolkit/formula.pyx":1101
  *         """
  *         if phase == 'cnf' or phase == '0' or phase == 0:
  *             invert = True             # <<<<<<<<<<<<<<
  *         elif phase == 'dnf' or phase == '1' or phase == 1:
  *             invert = False
  */
     __pyx_v_invert = 1;
 
-    /* "sat_toolkit/_cnf_util.pyx":676
+    /* "sat_toolkit/formula.pyx":1100
  *         :rtype: Truthtable
  *         """
  *         if phase == 'cnf' or phase == '0' or phase == 0:             # <<<<<<<<<<<<<<
  *             invert = True
  *         elif phase == 'dnf' or phase == '1' or phase == 1:
  */
     goto __pyx_L3;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":678
+  /* "sat_toolkit/formula.pyx":1102
  *         if phase == 'cnf' or phase == '0' or phase == 0:
  *             invert = True
  *         elif phase == 'dnf' or phase == '1' or phase == 1:             # <<<<<<<<<<<<<<
  *             invert = False
  *         else:
  */
-  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_phase, __pyx_n_u_dnf, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 678, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_phase, __pyx_n_u_dnf, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1102, __pyx_L1_error)
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L7_bool_binop_done;
   }
-  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_phase, __pyx_kp_u_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 678, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_phase, __pyx_kp_u_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1102, __pyx_L1_error)
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L7_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_phase, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 678, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_phase, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 678, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_1 = __pyx_t_2;
   __pyx_L7_bool_binop_done:;
   if (likely(__pyx_t_1)) {
 
-    /* "sat_toolkit/_cnf_util.pyx":679
+    /* "sat_toolkit/formula.pyx":1103
  *             invert = True
  *         elif phase == 'dnf' or phase == '1' or phase == 1:
  *             invert = False             # <<<<<<<<<<<<<<
  *         else:
  *             raise ValueError('invalid value for `phase`')
  */
     __pyx_v_invert = 0;
 
-    /* "sat_toolkit/_cnf_util.pyx":678
+    /* "sat_toolkit/formula.pyx":1102
  *         if phase == 'cnf' or phase == '0' or phase == 0:
  *             invert = True
  *         elif phase == 'dnf' or phase == '1' or phase == 1:             # <<<<<<<<<<<<<<
  *             invert = False
  *         else:
  */
     goto __pyx_L3;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":681
+  /* "sat_toolkit/formula.pyx":1105
  *             invert = False
  *         else:
  *             raise ValueError('invalid value for `phase`')             # <<<<<<<<<<<<<<
  * 
  *         res = io.StringIO()
  */
   /*else*/ {
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 681, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1105, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 681, __pyx_L1_error)
+    __PYX_ERR(0, 1105, __pyx_L1_error)
   }
   __pyx_L3:;
 
-  /* "sat_toolkit/_cnf_util.pyx":683
+  /* "sat_toolkit/formula.pyx":1107
  *             raise ValueError('invalid value for `phase`')
  * 
  *         res = io.StringIO()             # <<<<<<<<<<<<<<
  *         self._write(res, True, invert)
  *         return res.getvalue()
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_io); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 683, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_io); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_StringIO); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 683, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_StringIO); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 683, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_res = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":684
+  /* "sat_toolkit/formula.pyx":1108
  * 
  *         res = io.StringIO()
  *         self._write(res, True, invert)             # <<<<<<<<<<<<<<
  *         return res.getvalue()
  * 
  */
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 684, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_invert); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 684, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_invert); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_6 = NULL;
   __pyx_t_7 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -14470,455 +19522,456 @@
       __Pyx_DECREF_SET(__pyx_t_5, function);
       __pyx_t_7 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_5)) {
     PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_res, Py_True, __pyx_t_4};
-    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 684, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1108, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
     PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_res, Py_True, __pyx_t_4};
-    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 684, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1108, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else
   #endif
   {
-    __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 684, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1108, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_res);
     __Pyx_GIVEREF(__pyx_v_res);
     PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_v_res);
     __Pyx_INCREF(Py_True);
     __Pyx_GIVEREF(Py_True);
     PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, Py_True);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 684, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1108, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":685
+  /* "sat_toolkit/formula.pyx":1109
  *         res = io.StringIO()
  *         self._write(res, True, invert)
  *         return res.getvalue()             # <<<<<<<<<<<<<<
  * 
- *     def __repr__(self):
+ *     def __repr__(self) -> str:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_res, __pyx_n_s_getvalue); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 685, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_res, __pyx_n_s_getvalue); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 685, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_r = __pyx_t_3;
+  if (!(likely(PyUnicode_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 1109, __pyx_L1_error)
+  __pyx_r = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":667
+  /* "sat_toolkit/formula.pyx":1091
  *             io.write(f'.end\n')
  * 
- *     def to_espresso(self, phase='cnf'):             # <<<<<<<<<<<<<<
+ *     def to_espresso(self, phase='cnf') -> str:             # <<<<<<<<<<<<<<
  *         """
  *         return the truthtable in espresso format
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.to_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.to_espresso", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_res);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":687
+/* "sat_toolkit/formula.pyx":1111
  *         return res.getvalue()
  * 
- *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *     def __repr__(self) -> str:             # <<<<<<<<<<<<<<
  *         result = io.StringIO()
  *         result.write("Truthtable\n")
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_11__repr__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_11__repr__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_11__repr__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_11__repr__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_10__repr__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_10__repr__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_10__repr__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_10__repr__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self) {
   PyObject *__pyx_v_result = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":688
+  /* "sat_toolkit/formula.pyx":1112
  * 
- *     def __repr__(self):
+ *     def __repr__(self) -> str:
  *         result = io.StringIO()             # <<<<<<<<<<<<<<
  *         result.write("Truthtable\n")
  *         self._write(result)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_io); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 688, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_io); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1112, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_StringIO); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 688, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_StringIO); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1112, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 688, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1112, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_result = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":689
- *     def __repr__(self):
+  /* "sat_toolkit/formula.pyx":1113
+ *     def __repr__(self) -> str:
  *         result = io.StringIO()
  *         result.write("Truthtable\n")             # <<<<<<<<<<<<<<
  *         self._write(result)
  *         return result.getvalue()
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_result, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 689, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_result, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_n_u_Truthtable) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_n_u_Truthtable);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 689, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":690
+  /* "sat_toolkit/formula.pyx":1114
  *         result = io.StringIO()
  *         result.write("Truthtable\n")
  *         self._write(result)             # <<<<<<<<<<<<<<
  *         return result.getvalue()
  * 
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 690, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1114, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_result) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_result);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 690, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1114, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":691
+  /* "sat_toolkit/formula.pyx":1115
  *         result.write("Truthtable\n")
  *         self._write(result)
  *         return result.getvalue()             # <<<<<<<<<<<<<<
  * 
- *     def __eq__(self, other):
+ *     def __eq__(self, other) -> bool:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_result, __pyx_n_s_getvalue); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 691, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_result, __pyx_n_s_getvalue); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1115, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 691, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1115, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":687
+  /* "sat_toolkit/formula.pyx":1111
  *         return res.getvalue()
  * 
- *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *     def __repr__(self) -> str:             # <<<<<<<<<<<<<<
  *         result = io.StringIO()
  *         result.write("Truthtable\n")
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":693
+/* "sat_toolkit/formula.pyx":1117
  *         return result.getvalue()
  * 
- *     def __eq__(self, other):             # <<<<<<<<<<<<<<
+ *     def __eq__(self, other) -> bool:             # <<<<<<<<<<<<<<
  *         if self.numbits != other.numbits:
  *             return False
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_13__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_13__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_13__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_13__eq__(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__eq__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_12__eq__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v_other));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_12__eq__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v_other));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_12__eq__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_other) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_12__eq__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_other) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__eq__", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":694
+  /* "sat_toolkit/formula.pyx":1118
  * 
- *     def __eq__(self, other):
+ *     def __eq__(self, other) -> bool:
  *         if self.numbits != other.numbits:             # <<<<<<<<<<<<<<
  *             return False
  *         if not np.all(self.on_set == other.on_set):
  */
-  __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 694, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_numbits); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 694, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_numbits); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_2, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 694, __pyx_L1_error)
+  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_2, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1118, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 694, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1118, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if (__pyx_t_4) {
 
-    /* "sat_toolkit/_cnf_util.pyx":695
- *     def __eq__(self, other):
+    /* "sat_toolkit/formula.pyx":1119
+ *     def __eq__(self, other) -> bool:
  *         if self.numbits != other.numbits:
  *             return False             # <<<<<<<<<<<<<<
  *         if not np.all(self.on_set == other.on_set):
  *             return False
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":694
+    /* "sat_toolkit/formula.pyx":1118
  * 
- *     def __eq__(self, other):
+ *     def __eq__(self, other) -> bool:
  *         if self.numbits != other.numbits:             # <<<<<<<<<<<<<<
  *             return False
  *         if not np.all(self.on_set == other.on_set):
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":696
+  /* "sat_toolkit/formula.pyx":1120
  *         if self.numbits != other.numbits:
  *             return False
  *         if not np.all(self.on_set == other.on_set):             # <<<<<<<<<<<<<<
  *             return False
  *         if self.dc_set is None and other.dc_set is not None:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 696, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_all); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 696, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_all); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_on_set); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 696, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_on_set); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyObject_RichCompare(__pyx_v_self->on_set, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 696, __pyx_L1_error)
+  __pyx_t_5 = PyObject_RichCompare(__pyx_v_self->on_set, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 696, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 696, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_6 = ((!__pyx_t_4) != 0);
   if (__pyx_t_6) {
 
-    /* "sat_toolkit/_cnf_util.pyx":697
+    /* "sat_toolkit/formula.pyx":1121
  *             return False
  *         if not np.all(self.on_set == other.on_set):
  *             return False             # <<<<<<<<<<<<<<
  *         if self.dc_set is None and other.dc_set is not None:
  *             return False
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":696
+    /* "sat_toolkit/formula.pyx":1120
  *         if self.numbits != other.numbits:
  *             return False
  *         if not np.all(self.on_set == other.on_set):             # <<<<<<<<<<<<<<
  *             return False
  *         if self.dc_set is None and other.dc_set is not None:
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":698
+  /* "sat_toolkit/formula.pyx":1122
  *         if not np.all(self.on_set == other.on_set):
  *             return False
  *         if self.dc_set is None and other.dc_set is not None:             # <<<<<<<<<<<<<<
  *             return False
  *         if other.dc_set is None and self.dc_set is not None:
  */
   __pyx_t_4 = (__pyx_v_self->dc_set == Py_None);
   __pyx_t_7 = (__pyx_t_4 != 0);
   if (__pyx_t_7) {
   } else {
     __pyx_t_6 = __pyx_t_7;
     goto __pyx_L6_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_dc_set); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 698, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_dc_set); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_7 = (__pyx_t_3 != Py_None);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_4 = (__pyx_t_7 != 0);
   __pyx_t_6 = __pyx_t_4;
   __pyx_L6_bool_binop_done:;
   if (__pyx_t_6) {
 
-    /* "sat_toolkit/_cnf_util.pyx":699
+    /* "sat_toolkit/formula.pyx":1123
  *             return False
  *         if self.dc_set is None and other.dc_set is not None:
  *             return False             # <<<<<<<<<<<<<<
  *         if other.dc_set is None and self.dc_set is not None:
  *             return False
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":698
+    /* "sat_toolkit/formula.pyx":1122
  *         if not np.all(self.on_set == other.on_set):
  *             return False
  *         if self.dc_set is None and other.dc_set is not None:             # <<<<<<<<<<<<<<
  *             return False
  *         if other.dc_set is None and self.dc_set is not None:
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":700
+  /* "sat_toolkit/formula.pyx":1124
  *         if self.dc_set is None and other.dc_set is not None:
  *             return False
  *         if other.dc_set is None and self.dc_set is not None:             # <<<<<<<<<<<<<<
  *             return False
  *         if not np.all(self.dc_set == other.dc_set):
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_dc_set); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 700, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_dc_set); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = (__pyx_t_3 == Py_None);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_7 = (__pyx_t_4 != 0);
   if (__pyx_t_7) {
   } else {
     __pyx_t_6 = __pyx_t_7;
@@ -14926,150 +19979,150 @@
   }
   __pyx_t_7 = (__pyx_v_self->dc_set != Py_None);
   __pyx_t_4 = (__pyx_t_7 != 0);
   __pyx_t_6 = __pyx_t_4;
   __pyx_L9_bool_binop_done:;
   if (__pyx_t_6) {
 
-    /* "sat_toolkit/_cnf_util.pyx":701
+    /* "sat_toolkit/formula.pyx":1125
  *             return False
  *         if other.dc_set is None and self.dc_set is not None:
  *             return False             # <<<<<<<<<<<<<<
  *         if not np.all(self.dc_set == other.dc_set):
  *             return False
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":700
+    /* "sat_toolkit/formula.pyx":1124
  *         if self.dc_set is None and other.dc_set is not None:
  *             return False
  *         if other.dc_set is None and self.dc_set is not None:             # <<<<<<<<<<<<<<
  *             return False
  *         if not np.all(self.dc_set == other.dc_set):
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":702
+  /* "sat_toolkit/formula.pyx":1126
  *         if other.dc_set is None and self.dc_set is not None:
  *             return False
  *         if not np.all(self.dc_set == other.dc_set):             # <<<<<<<<<<<<<<
  *             return False
  *         return True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_all); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_all); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_dc_set); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_dc_set); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_RichCompare(__pyx_v_self->dc_set, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __pyx_t_2 = PyObject_RichCompare(__pyx_v_self->dc_set, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_1)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 702, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_4 = ((!__pyx_t_6) != 0);
   if (__pyx_t_4) {
 
-    /* "sat_toolkit/_cnf_util.pyx":703
+    /* "sat_toolkit/formula.pyx":1127
  *             return False
  *         if not np.all(self.dc_set == other.dc_set):
  *             return False             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "sat_toolkit/_cnf_util.pyx":702
+    /* "sat_toolkit/formula.pyx":1126
  *         if other.dc_set is None and self.dc_set is not None:
  *             return False
  *         if not np.all(self.dc_set == other.dc_set):             # <<<<<<<<<<<<<<
  *             return False
  *         return True
  */
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":704
+  /* "sat_toolkit/formula.pyx":1128
  *         if not np.all(self.dc_set == other.dc_set):
  *             return False
  *         return True             # <<<<<<<<<<<<<<
  * 
  *     def to_cnf(self, espresso_args: List[str] = []) -> CNF:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(Py_True);
   __pyx_r = Py_True;
   goto __pyx_L0;
 
-  /* "sat_toolkit/_cnf_util.pyx":693
+  /* "sat_toolkit/formula.pyx":1117
  *         return result.getvalue()
  * 
- *     def __eq__(self, other):             # <<<<<<<<<<<<<<
+ *     def __eq__(self, other) -> bool:             # <<<<<<<<<<<<<<
  *         if self.numbits != other.numbits:
  *             return False
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.__eq__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":706
+/* "sat_toolkit/formula.pyx":1130
  *         return True
  * 
  *     def to_cnf(self, espresso_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses espresso to convert the Truthtable to a minimized CNF.
  */
 
 /* Python wrapper */
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_15to_cnf(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_14to_cnf[] = "Truthtable.to_cnf(self, espresso_args: List[str] = []) -> CNF\n\n        Uses espresso to convert the Truthtable to a minimized CNF.\n\n        The resulting CNF will be indexed by [1, self.numbits], where index 1\n        corresponds to the least significant bit in the truthtable index.\n\n        :param espresso_args: extra parameters given when calling espresso, defaults to []\n\n        :return: CNF minimized by espresso\n        :rtype: CNF\n        ";
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_15to_cnf(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_10Truthtable_15to_cnf(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_10Truthtable_14to_cnf[] = "Truthtable.to_cnf(self, espresso_args: List[str] = []) -> CNF\n\n        Uses espresso to convert the Truthtable to a minimized CNF.\n\n        The resulting CNF will be indexed by [1, self.numbits], where index 1\n        corresponds to the least significant bit in the truthtable index.\n\n        :param espresso_args: extra parameters given when calling espresso, defaults to []\n\n        :return: CNF minimized by espresso\n        :rtype: CNF\n        ";
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pw_11sat_toolkit_7formula_10Truthtable_15to_cnf(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_espresso_args = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = 0;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("to_cnf (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_espresso_args,0};
     PyObject* values[1] = {0};
-    values[0] = __pyx_k__30;
+    values[0] = __pyx_k__37;
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
@@ -15080,131 +20133,131 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_espresso_args);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "to_cnf") < 0)) __PYX_ERR(0, 706, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "to_cnf") < 0)) __PYX_ERR(0, 1130, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_espresso_args = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("to_cnf", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 706, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("to_cnf", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1130, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.to_cnf", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.to_cnf", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_14to_cnf(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), __pyx_v_espresso_args);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_14to_cnf(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), __pyx_v_espresso_args);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_14to_cnf(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_espresso_args) {
+static struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_pf_11sat_toolkit_7formula_10Truthtable_14to_cnf(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_espresso_args) {
   PyObject *__pyx_v_espresso = NULL;
   PyObject *__pyx_v_cnf = NULL;
   PyObject *__pyx_v_ret_code = NULL;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_r = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
   int __pyx_t_10;
   int __pyx_t_11;
   PyObject *__pyx_t_12 = NULL;
   int __pyx_t_13;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *__pyx_t_14 = NULL;
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("to_cnf", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":718
+  /* "sat_toolkit/formula.pyx":1142
  *         :rtype: CNF
  *         """
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:             # <<<<<<<<<<<<<<
  *             self._write(espresso.stdin, True, True)
  *             espresso.stdin.close()
  */
   /*with:*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Popen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Popen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_n_u_espresso);
     __Pyx_GIVEREF(__pyx_n_u_espresso);
     PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_espresso);
-    __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_espresso_args); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_espresso_args); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
     __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdin, __pyx_t_5) < 0) __PYX_ERR(0, 718, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdin, __pyx_t_5) < 0) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdout, __pyx_t_4) < 0) __PYX_ERR(0, 718, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stdout, __pyx_t_4) < 0) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_text, Py_True) < 0) __PYX_ERR(0, 718, __pyx_L1_error)
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 718, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_text, Py_True) < 0) __PYX_ERR(0, 1142, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 718, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 718, __pyx_L3_error)
+    __pyx_t_1 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1142, __pyx_L3_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 718, __pyx_L3_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1142, __pyx_L3_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = __pyx_t_3;
     __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     /*try:*/ {
       {
@@ -15214,24 +20267,24 @@
         __Pyx_XGOTREF(__pyx_t_7);
         __Pyx_XGOTREF(__pyx_t_8);
         __Pyx_XGOTREF(__pyx_t_9);
         /*try:*/ {
           __pyx_v_espresso = __pyx_t_1;
           __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":719
+          /* "sat_toolkit/formula.pyx":1143
  *         """
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:
  *             self._write(espresso.stdin, True, True)             # <<<<<<<<<<<<<<
  *             espresso.stdin.close()
  * 
  */
-          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 719, __pyx_L7_error)
+          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1143, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 719, __pyx_L7_error)
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1143, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_3);
           __pyx_t_2 = NULL;
           __pyx_t_10 = 0;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
             __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
             if (likely(__pyx_t_2)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -15240,107 +20293,107 @@
               __Pyx_DECREF_SET(__pyx_t_4, function);
               __pyx_t_10 = 1;
             }
           }
           #if CYTHON_FAST_PYCALL
           if (PyFunction_Check(__pyx_t_4)) {
             PyObject *__pyx_temp[4] = {__pyx_t_2, __pyx_t_3, Py_True, Py_True};
-            __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 719, __pyx_L7_error)
+            __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1143, __pyx_L7_error)
             __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
             __Pyx_GOTREF(__pyx_t_1);
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           } else
           #endif
           #if CYTHON_FAST_PYCCALL
           if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
             PyObject *__pyx_temp[4] = {__pyx_t_2, __pyx_t_3, Py_True, Py_True};
-            __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 719, __pyx_L7_error)
+            __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1143, __pyx_L7_error)
             __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
             __Pyx_GOTREF(__pyx_t_1);
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           } else
           #endif
           {
-            __pyx_t_5 = PyTuple_New(3+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 719, __pyx_L7_error)
+            __pyx_t_5 = PyTuple_New(3+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1143, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_5);
             if (__pyx_t_2) {
               __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2); __pyx_t_2 = NULL;
             }
             __Pyx_GIVEREF(__pyx_t_3);
             PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_10, __pyx_t_3);
             __Pyx_INCREF(Py_True);
             __Pyx_GIVEREF(Py_True);
             PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_10, Py_True);
             __Pyx_INCREF(Py_True);
             __Pyx_GIVEREF(Py_True);
             PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_10, Py_True);
             __pyx_t_3 = 0;
-            __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 719, __pyx_L7_error)
+            __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1143, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_1);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           }
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":720
+          /* "sat_toolkit/formula.pyx":1144
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:
  *             self._write(espresso.stdin, True, True)
  *             espresso.stdin.close()             # <<<<<<<<<<<<<<
  * 
  *             cnf = CNF.from_espresso(espresso.stdout.read())
  */
-          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 720, __pyx_L7_error)
+          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1144, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_close); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 720, __pyx_L7_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_close); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1144, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_4 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_4)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
               __Pyx_INCREF(__pyx_t_4);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 720, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1144, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":722
+          /* "sat_toolkit/formula.pyx":1146
  *             espresso.stdin.close()
  * 
  *             cnf = CNF.from_espresso(espresso.stdout.read())             # <<<<<<<<<<<<<<
  * 
  *             ret_code = espresso.wait()
  */
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF), __pyx_n_s_from_espresso); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 722, __pyx_L7_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF), __pyx_n_s_from_espresso); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1146, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 722, __pyx_L7_error)
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1146, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_read); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 722, __pyx_L7_error)
+          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_read); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1146, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_3 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
             __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
             if (likely(__pyx_t_3)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
               __Pyx_INCREF(__pyx_t_3);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_2, function);
             }
           }
           __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 722, __pyx_L7_error)
+          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1146, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_2 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_2)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -15348,75 +20401,75 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
           __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 722, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1146, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __pyx_v_cnf = __pyx_t_1;
           __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":724
+          /* "sat_toolkit/formula.pyx":1148
  *             cnf = CNF.from_espresso(espresso.stdout.read())
  * 
  *             ret_code = espresso.wait()             # <<<<<<<<<<<<<<
  *             if ret_code != 0:
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  */
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_wait); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 724, __pyx_L7_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_wait); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1148, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_5);
           __pyx_t_4 = NULL;
           if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_4)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
               __Pyx_INCREF(__pyx_t_4);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 724, __pyx_L7_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1148, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __pyx_v_ret_code = __pyx_t_1;
           __pyx_t_1 = 0;
 
-          /* "sat_toolkit/_cnf_util.pyx":725
+          /* "sat_toolkit/formula.pyx":1149
  * 
  *             ret_code = espresso.wait()
  *             if ret_code != 0:             # <<<<<<<<<<<<<<
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  */
-          __pyx_t_1 = __Pyx_PyInt_NeObjC(__pyx_v_ret_code, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 725, __pyx_L7_error)
+          __pyx_t_1 = __Pyx_PyInt_NeObjC(__pyx_v_ret_code, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1149, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 725, __pyx_L7_error)
+          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1149, __pyx_L7_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           if (unlikely(__pyx_t_11)) {
 
-            /* "sat_toolkit/_cnf_util.pyx":726
+            /* "sat_toolkit/formula.pyx":1150
  *             ret_code = espresso.wait()
  *             if ret_code != 0:
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))             # <<<<<<<<<<<<<<
  * 
  *             return cnf
  */
-            __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 726, __pyx_L7_error)
+            __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1150, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_5);
-            __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_CalledProcessError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 726, __pyx_L7_error)
+            __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_CalledProcessError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1150, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_4);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_args); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 726, __pyx_L7_error)
+            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_espresso, __pyx_n_s_args); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1150, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_5);
-            __pyx_t_2 = PyUnicode_Join(__pyx_kp_u__8, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 726, __pyx_L7_error)
+            __pyx_t_2 = PyUnicode_Join(__pyx_kp_u__7, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1150, __pyx_L7_error)
             __Pyx_GOTREF(__pyx_t_2);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
             __pyx_t_5 = NULL;
             __pyx_t_10 = 0;
             if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
               __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
               if (likely(__pyx_t_5)) {
@@ -15426,108 +20479,108 @@
                 __Pyx_DECREF_SET(__pyx_t_4, function);
                 __pyx_t_10 = 1;
               }
             }
             #if CYTHON_FAST_PYCALL
             if (PyFunction_Check(__pyx_t_4)) {
               PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_ret_code, __pyx_t_2};
-              __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 726, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1150, __pyx_L7_error)
               __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             } else
             #endif
             #if CYTHON_FAST_PYCCALL
             if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
               PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_ret_code, __pyx_t_2};
-              __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 726, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1150, __pyx_L7_error)
               __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             } else
             #endif
             {
-              __pyx_t_3 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 726, __pyx_L7_error)
+              __pyx_t_3 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1150, __pyx_L7_error)
               __Pyx_GOTREF(__pyx_t_3);
               if (__pyx_t_5) {
                 __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5); __pyx_t_5 = NULL;
               }
               __Pyx_INCREF(__pyx_v_ret_code);
               __Pyx_GIVEREF(__pyx_v_ret_code);
               PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_10, __pyx_v_ret_code);
               __Pyx_GIVEREF(__pyx_t_2);
               PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_10, __pyx_t_2);
               __pyx_t_2 = 0;
-              __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 726, __pyx_L7_error)
+              __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1150, __pyx_L7_error)
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             }
             __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
             __Pyx_Raise(__pyx_t_1, 0, 0, 0);
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-            __PYX_ERR(0, 726, __pyx_L7_error)
+            __PYX_ERR(0, 1150, __pyx_L7_error)
 
-            /* "sat_toolkit/_cnf_util.pyx":725
+            /* "sat_toolkit/formula.pyx":1149
  * 
  *             ret_code = espresso.wait()
  *             if ret_code != 0:             # <<<<<<<<<<<<<<
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  */
           }
 
-          /* "sat_toolkit/_cnf_util.pyx":728
+          /* "sat_toolkit/formula.pyx":1152
  *                 raise sp.CalledProcessError(ret_code, ' '.join(espresso.args))
  * 
  *             return cnf             # <<<<<<<<<<<<<<
  */
           __Pyx_XDECREF(((PyObject *)__pyx_r));
-          if (!(likely(((__pyx_v_cnf) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_cnf, __pyx_ptype_11sat_toolkit_9_cnf_util_CNF))))) __PYX_ERR(0, 728, __pyx_L7_error)
+          if (!(likely(((__pyx_v_cnf) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_cnf, __pyx_ptype_11sat_toolkit_7formula_CNF))))) __PYX_ERR(0, 1152, __pyx_L7_error)
           __Pyx_INCREF(__pyx_v_cnf);
-          __pyx_r = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)__pyx_v_cnf);
+          __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)__pyx_v_cnf);
           goto __pyx_L11_try_return;
 
-          /* "sat_toolkit/_cnf_util.pyx":718
+          /* "sat_toolkit/formula.pyx":1142
  *         :rtype: CNF
  *         """
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:             # <<<<<<<<<<<<<<
  *             self._write(espresso.stdin, True, True)
  *             espresso.stdin.close()
  */
         }
         __pyx_L7_error:;
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         /*except:*/ {
-          __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.to_cnf", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_4, &__pyx_t_3) < 0) __PYX_ERR(0, 718, __pyx_L9_except_error)
+          __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.to_cnf", __pyx_clineno, __pyx_lineno, __pyx_filename);
+          if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_4, &__pyx_t_3) < 0) __PYX_ERR(0, 1142, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_2 = PyTuple_Pack(3, __pyx_t_1, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 718, __pyx_L9_except_error)
+          __pyx_t_2 = PyTuple_Pack(3, __pyx_t_1, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1142, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_2);
           __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_2, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-          if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 718, __pyx_L9_except_error)
+          if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1142, __pyx_L9_except_error)
           __Pyx_GOTREF(__pyx_t_12);
           __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_12);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          if (__pyx_t_11 < 0) __PYX_ERR(0, 718, __pyx_L9_except_error)
+          if (__pyx_t_11 < 0) __PYX_ERR(0, 1142, __pyx_L9_except_error)
           __pyx_t_13 = ((!(__pyx_t_11 != 0)) != 0);
           if (__pyx_t_13) {
             __Pyx_GIVEREF(__pyx_t_1);
             __Pyx_GIVEREF(__pyx_t_4);
             __Pyx_XGIVEREF(__pyx_t_3);
             __Pyx_ErrRestoreWithState(__pyx_t_1, __pyx_t_4, __pyx_t_3);
             __pyx_t_1 = 0; __pyx_t_4 = 0; __pyx_t_3 = 0; 
-            __PYX_ERR(0, 718, __pyx_L9_except_error)
+            __PYX_ERR(0, 1142, __pyx_L9_except_error)
           }
           __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           goto __pyx_L8_exception_handled;
         }
         __pyx_L9_except_error:;
@@ -15548,29 +20601,29 @@
         __Pyx_XGIVEREF(__pyx_t_9);
         __Pyx_ExceptionReset(__pyx_t_7, __pyx_t_8, __pyx_t_9);
       }
     }
     /*finally:*/ {
       /*normal exit:*/{
         if (__pyx_t_6) {
-          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 718, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1142, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         }
         goto __pyx_L6;
       }
       __pyx_L4_return: {
         __pyx_t_14 = __pyx_r;
         __pyx_r = 0;
         if (__pyx_t_6) {
-          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__15, NULL);
+          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__19, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 718, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1142, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         }
         __pyx_r = __pyx_t_14;
         __pyx_t_14 = 0;
         goto __pyx_L0;
       }
@@ -15579,64 +20632,64 @@
     goto __pyx_L17;
     __pyx_L3_error:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L1_error;
     __pyx_L17:;
   }
 
-  /* "sat_toolkit/_cnf_util.pyx":706
+  /* "sat_toolkit/formula.pyx":1130
  *         return True
  * 
  *     def to_cnf(self, espresso_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses espresso to convert the Truthtable to a minimized CNF.
  */
 
   /* function exit code */
-  __pyx_r = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_r = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)Py_None); __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.to_cnf", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.to_cnf", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_espresso);
   __Pyx_XDECREF(__pyx_v_cnf);
   __Pyx_XDECREF(__pyx_v_ret_code);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":575
+/* "sat_toolkit/formula.pyx":999
  *     The OFF set is the complement of the two sets.
  *     """
  *     cdef public on_set             # <<<<<<<<<<<<<<
  *     cdef public dc_set
  *     cdef public uint64_t numbits
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_1__get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_1__get__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_1__get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set___get__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set___get__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set___get__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__", 0);
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->on_set);
   __pyx_r = __pyx_v_self->on_set;
   goto __pyx_L0;
@@ -15645,27 +20698,27 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_2__set__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v_value));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set_2__set__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v_value));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_2__set__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_value) {
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set_2__set__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__", 0);
   __Pyx_INCREF(__pyx_v_value);
   __Pyx_GIVEREF(__pyx_v_value);
   __Pyx_GOTREF(__pyx_v_self->on_set);
   __Pyx_DECREF(__pyx_v_self->on_set);
@@ -15674,27 +20727,27 @@
   /* function exit code */
   __pyx_r = 0;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_5__del__(PyObject *__pyx_v_self); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_5__del__(PyObject *__pyx_v_self) {
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_5__del__(PyObject *__pyx_v_self); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_5__del__(PyObject *__pyx_v_self) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__del__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_4__del__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set_4__del__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_4__del__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self) {
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_6on_set_4__del__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__del__", 0);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   __Pyx_GOTREF(__pyx_v_self->on_set);
   __Pyx_DECREF(__pyx_v_self->on_set);
@@ -15702,36 +20755,36 @@
 
   /* function exit code */
   __pyx_r = 0;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":576
+/* "sat_toolkit/formula.pyx":1000
  *     """
  *     cdef public on_set
  *     cdef public dc_set             # <<<<<<<<<<<<<<
  *     cdef public uint64_t numbits
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_1__get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_1__get__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_1__get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set___get__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set___get__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set___get__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__", 0);
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->dc_set);
   __pyx_r = __pyx_v_self->dc_set;
   goto __pyx_L0;
@@ -15740,27 +20793,27 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_2__set__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v_value));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set_2__set__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v_value));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_2__set__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_value) {
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set_2__set__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__", 0);
   __Pyx_INCREF(__pyx_v_value);
   __Pyx_GIVEREF(__pyx_v_value);
   __Pyx_GOTREF(__pyx_v_self->dc_set);
   __Pyx_DECREF(__pyx_v_self->dc_set);
@@ -15769,27 +20822,27 @@
   /* function exit code */
   __pyx_r = 0;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_5__del__(PyObject *__pyx_v_self); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_5__del__(PyObject *__pyx_v_self) {
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_5__del__(PyObject *__pyx_v_self); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_5__del__(PyObject *__pyx_v_self) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__del__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_4__del__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set_4__del__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_4__del__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self) {
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_6dc_set_4__del__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__del__", 0);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   __Pyx_GOTREF(__pyx_v_self->dc_set);
   __Pyx_DECREF(__pyx_v_self->dc_set);
@@ -15797,117 +20850,117 @@
 
   /* function exit code */
   __pyx_r = 0;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "sat_toolkit/_cnf_util.pyx":577
+/* "sat_toolkit/formula.pyx":1001
  *     cdef public on_set
  *     cdef public dc_set
  *     cdef public uint64_t numbits             # <<<<<<<<<<<<<<
  * 
  *     INIT_INDEX_SET = object()
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_1__get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_1__get__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_7numbits_1__get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_7numbits_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_7numbits___get__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_7numbits___get__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_7numbits___get__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_7numbits___get__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 577, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_unsigned_long(__pyx_v_self->numbits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1001, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.numbits.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.numbits.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
-static int __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_7numbits_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
+static int __pyx_pw_11sat_toolkit_7formula_10Truthtable_7numbits_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_2__set__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v_value));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_7numbits_2__set__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v_value));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_2__set__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v_value) {
+static int __pyx_pf_11sat_toolkit_7formula_10Truthtable_7numbits_2__set__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __pyx_t_11sat_toolkit_5types_uint64_t __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
-  __pyx_t_1 = __Pyx_PyInt_As_unsigned_long(__pyx_v_value); if (unlikely((__pyx_t_1 == (unsigned long)-1) && PyErr_Occurred())) __PYX_ERR(0, 577, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_As_unsigned_long(__pyx_v_value); if (unlikely((__pyx_t_1 == (unsigned long)-1) && PyErr_Occurred())) __PYX_ERR(0, 1001, __pyx_L1_error)
   __pyx_v_self->numbits = __pyx_t_1;
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.numbits.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.numbits.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
  *     cdef tuple state
  *     cdef object _dict
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_17__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_16__reduce_cython__[] = "Truthtable.__reduce_cython__(self)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_17__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_17__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_10Truthtable_16__reduce_cython__[] = "Truthtable.__reduce_cython__(self)";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_17__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_16__reduce_cython__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_16__reduce_cython__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_16__reduce_cython__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_16__reduce_cython__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self) {
   PyObject *__pyx_v_state = 0;
   PyObject *__pyx_v__dict = 0;
   int __pyx_v_use_setstate;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
@@ -16123,15 +21176,15 @@
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_state);
   __Pyx_XDECREF(__pyx_v__dict);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
@@ -16141,43 +21194,43 @@
  *     else:
  *         return __pyx_unpickle_Truthtable, (type(self), 0xb9e22c6, state)
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
  *     __pyx_unpickle_Truthtable__set_state(self, __pyx_state)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_19__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_18__setstate_cython__[] = "Truthtable.__setstate_cython__(self, __pyx_state)";
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_19__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_19__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_10Truthtable_18__setstate_cython__[] = "Truthtable.__setstate_cython__(self, __pyx_state)";
+static PyObject *__pyx_pw_11sat_toolkit_7formula_10Truthtable_19__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_18__setstate_cython__(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_10Truthtable_18__setstate_cython__(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_10Truthtable_18__setstate_cython__(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_10Truthtable_18__setstate_cython__(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Truthtable, (type(self), 0xb9e22c6, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Truthtable__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
   if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
-  __pyx_t_1 = __pyx_f_11sat_toolkit_9_cnf_util___pyx_unpickle_Truthtable__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11sat_toolkit_7formula___pyx_unpickle_Truthtable__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Truthtable, (type(self), 0xb9e22c6, state)
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
@@ -16185,33 +21238,33 @@
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.Truthtable.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.Truthtable.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "(tree fragment)":1
  * def __pyx_unpickle_Clause(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_1__pyx_unpickle_Clause(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause[] = "__pyx_unpickle_Clause(__pyx_type, long __pyx_checksum, __pyx_state)";
-static PyMethodDef __pyx_mdef_11sat_toolkit_9_cnf_util_1__pyx_unpickle_Clause = {"__pyx_unpickle_Clause", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_1__pyx_unpickle_Clause, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause};
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_1__pyx_unpickle_Clause(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_1__pyx_unpickle_Clause(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula___pyx_unpickle_Clause[] = "__pyx_unpickle_Clause(__pyx_type, long __pyx_checksum, __pyx_state)";
+static PyMethodDef __pyx_mdef_11sat_toolkit_7formula_1__pyx_unpickle_Clause = {"__pyx_unpickle_Clause", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_1__pyx_unpickle_Clause, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula___pyx_unpickle_Clause};
+static PyObject *__pyx_pw_11sat_toolkit_7formula_1__pyx_unpickle_Clause(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v___pyx_type = 0;
   long __pyx_v___pyx_checksum;
   PyObject *__pyx_v___pyx_state = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -16265,26 +21318,26 @@
     __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
     __pyx_v___pyx_state = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
   __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Clause", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.__pyx_unpickle_Clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.__pyx_unpickle_Clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula___pyx_unpickle_Clause(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula___pyx_unpickle_Clause(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_v___pyx_PickleError = 0;
   PyObject *__pyx_v___pyx_result = 0;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_t_3;
@@ -16301,15 +21354,15 @@
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xab15654, 0x9d96e17, 0x4c5c891):             # <<<<<<<<<<<<<<
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xab15654, 0x9d96e17, 0x4c5c891) = (clause))" % __pyx_checksum)
  */
   __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__31, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__38, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
     /* "(tree fragment)":5
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xab15654, 0x9d96e17, 0x4c5c891):
@@ -16377,15 +21430,15 @@
   /* "(tree fragment)":7
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xab15654, 0x9d96e17, 0x4c5c891) = (clause))" % __pyx_checksum)
  *     __pyx_result = Clause.__new__(__pyx_type)             # <<<<<<<<<<<<<<
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Clause__set_state(<Clause> __pyx_result, __pyx_state)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_Clause), __pyx_n_s_new); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 7, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_7formula_Clause), __pyx_n_s_new); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 7, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_5);
@@ -16416,15 +21469,15 @@
  *     __pyx_result = Clause.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Clause__set_state(<Clause> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Clause__set_state(Clause __pyx_result, tuple __pyx_state):
  */
     if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
-    __pyx_t_4 = __pyx_f_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause__set_state(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
+    __pyx_t_4 = __pyx_f_11sat_toolkit_7formula___pyx_unpickle_Clause__set_state(((struct __pyx_obj_11sat_toolkit_7formula_Clause *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xab15654, 0x9d96e17, 0x4c5c891) = (clause))" % __pyx_checksum)
  *     __pyx_result = Clause.__new__(__pyx_type)
  *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
@@ -16453,15 +21506,15 @@
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.__pyx_unpickle_Clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.__pyx_unpickle_Clause", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v___pyx_PickleError);
   __Pyx_XDECREF(__pyx_v___pyx_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
@@ -16471,15 +21524,15 @@
  *         __pyx_unpickle_Clause__set_state(<Clause> __pyx_result, __pyx_state)
  *     return __pyx_result
  * cdef __pyx_unpickle_Clause__set_state(Clause __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
  *     __pyx_result.clause = __pyx_state[0]
  *     if len(__pyx_state) > 1 and hasattr(__pyx_result, '__dict__'):
  */
 
-static PyObject *__pyx_f_11sat_toolkit_9_cnf_util___pyx_unpickle_Clause__set_state(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_f_11sat_toolkit_7formula___pyx_unpickle_Clause__set_state(struct __pyx_obj_11sat_toolkit_7formula_Clause *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   std::vector<int>  __pyx_t_1;
   int __pyx_t_2;
   Py_ssize_t __pyx_t_3;
   int __pyx_t_4;
   int __pyx_t_5;
@@ -16578,33 +21631,33 @@
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.__pyx_unpickle_Clause__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.__pyx_unpickle_Clause__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "(tree fragment)":1
  * def __pyx_unpickle_Truthtable(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3__pyx_unpickle_Truthtable(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11sat_toolkit_9_cnf_util_2__pyx_unpickle_Truthtable[] = "__pyx_unpickle_Truthtable(__pyx_type, long __pyx_checksum, __pyx_state)";
-static PyMethodDef __pyx_mdef_11sat_toolkit_9_cnf_util_3__pyx_unpickle_Truthtable = {"__pyx_unpickle_Truthtable", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3__pyx_unpickle_Truthtable, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_2__pyx_unpickle_Truthtable};
-static PyObject *__pyx_pw_11sat_toolkit_9_cnf_util_3__pyx_unpickle_Truthtable(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3__pyx_unpickle_Truthtable(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_11sat_toolkit_7formula_2__pyx_unpickle_Truthtable[] = "__pyx_unpickle_Truthtable(__pyx_type, long __pyx_checksum, __pyx_state)";
+static PyMethodDef __pyx_mdef_11sat_toolkit_7formula_3__pyx_unpickle_Truthtable = {"__pyx_unpickle_Truthtable", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3__pyx_unpickle_Truthtable, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_2__pyx_unpickle_Truthtable};
+static PyObject *__pyx_pw_11sat_toolkit_7formula_3__pyx_unpickle_Truthtable(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v___pyx_type = 0;
   long __pyx_v___pyx_checksum;
   PyObject *__pyx_v___pyx_state = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -16658,26 +21711,26 @@
     __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
     __pyx_v___pyx_state = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
   __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Truthtable", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.__pyx_unpickle_Truthtable", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.__pyx_unpickle_Truthtable", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_11sat_toolkit_9_cnf_util_2__pyx_unpickle_Truthtable(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);
+  __pyx_r = __pyx_pf_11sat_toolkit_7formula_2__pyx_unpickle_Truthtable(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_11sat_toolkit_9_cnf_util_2__pyx_unpickle_Truthtable(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_pf_11sat_toolkit_7formula_2__pyx_unpickle_Truthtable(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_v___pyx_PickleError = 0;
   PyObject *__pyx_v___pyx_result = 0;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_t_3;
@@ -16694,15 +21747,15 @@
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb9e22c6, 0x4062f4b, 0x8299fc5):             # <<<<<<<<<<<<<<
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb9e22c6, 0x4062f4b, 0x8299fc5) = (dc_set, numbits, on_set))" % __pyx_checksum)
  */
   __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__32, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__39, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
     /* "(tree fragment)":5
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb9e22c6, 0x4062f4b, 0x8299fc5):
@@ -16770,15 +21823,15 @@
   /* "(tree fragment)":7
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb9e22c6, 0x4062f4b, 0x8299fc5) = (dc_set, numbits, on_set))" % __pyx_checksum)
  *     __pyx_result = Truthtable.__new__(__pyx_type)             # <<<<<<<<<<<<<<
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Truthtable__set_state(<Truthtable> __pyx_result, __pyx_state)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable), __pyx_n_s_new); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 7, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_11sat_toolkit_7formula_Truthtable), __pyx_n_s_new); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 7, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_5);
@@ -16809,15 +21862,15 @@
  *     __pyx_result = Truthtable.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Truthtable__set_state(<Truthtable> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Truthtable__set_state(Truthtable __pyx_result, tuple __pyx_state):
  */
     if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
-    __pyx_t_4 = __pyx_f_11sat_toolkit_9_cnf_util___pyx_unpickle_Truthtable__set_state(((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
+    __pyx_t_4 = __pyx_f_11sat_toolkit_7formula___pyx_unpickle_Truthtable__set_state(((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb9e22c6, 0x4062f4b, 0x8299fc5) = (dc_set, numbits, on_set))" % __pyx_checksum)
  *     __pyx_result = Truthtable.__new__(__pyx_type)
  *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
@@ -16846,15 +21899,15 @@
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.__pyx_unpickle_Truthtable", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.__pyx_unpickle_Truthtable", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v___pyx_PickleError);
   __Pyx_XDECREF(__pyx_v___pyx_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
@@ -16864,15 +21917,15 @@
  *         __pyx_unpickle_Truthtable__set_state(<Truthtable> __pyx_result, __pyx_state)
  *     return __pyx_result
  * cdef __pyx_unpickle_Truthtable__set_state(Truthtable __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
  *     __pyx_result.dc_set = __pyx_state[0]; __pyx_result.numbits = __pyx_state[1]; __pyx_result.on_set = __pyx_state[2]
  *     if len(__pyx_state) > 3 and hasattr(__pyx_result, '__dict__'):
  */
 
-static PyObject *__pyx_f_11sat_toolkit_9_cnf_util___pyx_unpickle_Truthtable__set_state(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_f_11sat_toolkit_7formula___pyx_unpickle_Truthtable__set_state(struct __pyx_obj_11sat_toolkit_7formula_Truthtable *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   __pyx_t_11sat_toolkit_5types_uint64_t __pyx_t_2;
   int __pyx_t_3;
   Py_ssize_t __pyx_t_4;
   int __pyx_t_5;
@@ -16993,15 +22046,15 @@
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("sat_toolkit._cnf_util.__pyx_unpickle_Truthtable__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula.__pyx_unpickle_Truthtable__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
@@ -17456,15 +22509,15 @@
     /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if itemsize <= 0:
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__33, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 134, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 134, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 134, __pyx_L1_error)
 
     /* "View.MemoryView":133
  *         self.itemsize = itemsize
@@ -17488,15 +22541,15 @@
     /* "View.MemoryView":137
  * 
  *         if itemsize <= 0:
  *             raise ValueError("itemsize <= 0 for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if not isinstance(format, bytes):
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__34, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 137, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__41, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 137, __pyx_L1_error)
 
     /* "View.MemoryView":136
  *             raise ValueError("Empty shape tuple for cython.array")
@@ -17615,15 +22668,15 @@
     /* "View.MemoryView":149
  * 
  *         if not self._shape:
  *             raise MemoryError("unable to allocate shape and strides.")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__35, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 149, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__42, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 149, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 149, __pyx_L1_error)
 
     /* "View.MemoryView":148
  *         self._strides = self._shape + self.ndim
@@ -17889,15 +22942,15 @@
       /* "View.MemoryView":177
  *             self.data = <char *>malloc(self.len)
  *             if not self.data:
  *                 raise MemoryError("unable to allocate array data.")             # <<<<<<<<<<<<<<
  * 
  *             if self.dtype_is_object:
  */
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 177, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__43, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 177, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_Raise(__pyx_t_10, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __PYX_ERR(1, 177, __pyx_L1_error)
 
       /* "View.MemoryView":176
  * 
@@ -18133,15 +23186,15 @@
     /* "View.MemoryView":193
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         if not (flags & bufmode):
  *             raise ValueError("Can only create a buffer that is contiguous in memory.")             # <<<<<<<<<<<<<<
  *         info.buf = self.data
  *         info.len = self.len
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 193, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__44, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 193, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 193, __pyx_L1_error)
 
     /* "View.MemoryView":192
  *         elif self.mode == u"fortran":
@@ -18867,15 +23920,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__38, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__45, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -18923,15 +23976,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__46, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -20652,15 +25705,15 @@
     /* "View.MemoryView":420
  *     def __setitem__(memoryview self, object index, object value):
  *         if self.view.readonly:
  *             raise TypeError("Cannot assign to read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         have_slices, index = _unellipsify(index, self.view.ndim)
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 420, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__47, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 420, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __PYX_ERR(1, 420, __pyx_L1_error)
 
     /* "View.MemoryView":419
  * 
@@ -21700,15 +26753,15 @@
       /* "View.MemoryView":497
  *             result = struct.unpack(self.view.format, bytesitem)
  *         except struct.error:
  *             raise ValueError("Unable to convert item to object")             # <<<<<<<<<<<<<<
  *         else:
  *             if len(self.view.format) == 1:
  */
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__41, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 497, __pyx_L5_except_error)
+      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__48, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 497, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_Raise(__pyx_t_6, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __PYX_ERR(1, 497, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
@@ -22062,15 +27115,15 @@
     /* "View.MemoryView":522
  *     def __getbuffer__(self, Py_buffer *info, int flags):
  *         if flags & PyBUF_WRITABLE and self.view.readonly:
  *             raise ValueError("Cannot create writable memory view from read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         if flags & PyBUF_ND:
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__42, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 522, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__49, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 522, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 522, __pyx_L1_error)
 
     /* "View.MemoryView":521
  *     @cname('getbuffer')
@@ -22611,15 +27664,15 @@
     /* "View.MemoryView":572
  *         if self.view.strides == NULL:
  * 
  *             raise ValueError("Buffer view does not expose strides")             # <<<<<<<<<<<<<<
  * 
  *         return tuple([stride for stride in self.view.strides[:self.view.ndim]])
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__43, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 572, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__50, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 572, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __PYX_ERR(1, 572, __pyx_L1_error)
 
     /* "View.MemoryView":570
  *     @property
@@ -22728,15 +27781,15 @@
  *             return (-1,) * self.view.ndim             # <<<<<<<<<<<<<<
  * 
  *         return tuple([suboffset for suboffset in self.view.suboffsets[:self.view.ndim]])
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->view.ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 579, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyNumber_Multiply(__pyx_tuple__44, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 579, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Multiply(__pyx_tuple__51, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 579, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
     /* "View.MemoryView":578
@@ -23766,15 +28819,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__45, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__52, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -23822,15 +28875,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__46, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__53, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -24179,17 +29232,17 @@
  *             else:
  */
         __pyx_t_8 = PyObject_Length(__pyx_v_tup); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(1, 684, __pyx_L1_error)
         __pyx_t_7 = PyList_New(1 * ((((__pyx_v_ndim - __pyx_t_8) + 1)<0) ? 0:((__pyx_v_ndim - __pyx_t_8) + 1))); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 684, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         { Py_ssize_t __pyx_temp;
           for (__pyx_temp=0; __pyx_temp < ((__pyx_v_ndim - __pyx_t_8) + 1); __pyx_temp++) {
-            __Pyx_INCREF(__pyx_slice__47);
-            __Pyx_GIVEREF(__pyx_slice__47);
-            PyList_SET_ITEM(__pyx_t_7, __pyx_temp, __pyx_slice__47);
+            __Pyx_INCREF(__pyx_slice__12);
+            __Pyx_GIVEREF(__pyx_slice__12);
+            PyList_SET_ITEM(__pyx_t_7, __pyx_temp, __pyx_slice__12);
           }
         }
         __pyx_t_9 = __Pyx_PyList_Extend(__pyx_v_result, __pyx_t_7); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 684, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
         /* "View.MemoryView":685
  *             if not seen_ellipsis:
@@ -24214,15 +29267,15 @@
  *                 seen_ellipsis = True
  *             else:
  *                 result.append(slice(None))             # <<<<<<<<<<<<<<
  *             have_slices = True
  *         else:
  */
       /*else*/ {
-        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_result, __pyx_slice__47); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 687, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_result, __pyx_slice__12); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 687, __pyx_L1_error)
       }
       __pyx_L7:;
 
       /* "View.MemoryView":688
  *             else:
  *                 result.append(slice(None))
  *             have_slices = True             # <<<<<<<<<<<<<<
@@ -24354,17 +29407,17 @@
  * 
  *     return have_slices or nslices, tuple(result)
  */
     __pyx_t_3 = PyList_New(1 * ((__pyx_v_nslices<0) ? 0:__pyx_v_nslices)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 698, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     { Py_ssize_t __pyx_temp;
       for (__pyx_temp=0; __pyx_temp < __pyx_v_nslices; __pyx_temp++) {
-        __Pyx_INCREF(__pyx_slice__47);
-        __Pyx_GIVEREF(__pyx_slice__47);
-        PyList_SET_ITEM(__pyx_t_3, __pyx_temp, __pyx_slice__47);
+        __Pyx_INCREF(__pyx_slice__12);
+        __Pyx_GIVEREF(__pyx_slice__12);
+        PyList_SET_ITEM(__pyx_t_3, __pyx_temp, __pyx_slice__12);
       }
     }
     __pyx_t_9 = __Pyx_PyList_Extend(__pyx_v_result, __pyx_t_3); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 698, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
     /* "View.MemoryView":697
  * 
@@ -24483,15 +29536,15 @@
       /* "View.MemoryView":705
  *     for suboffset in suboffsets[:ndim]:
  *         if suboffset >= 0:
  *             raise ValueError("Indirect dimensions not supported")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__48, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 705, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__54, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 705, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_Raise(__pyx_t_5, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __PYX_ERR(1, 705, __pyx_L1_error)
 
       /* "View.MemoryView":704
  * cdef assert_direct_dimensions(Py_ssize_t *suboffsets, int ndim):
@@ -24591,15 +29644,15 @@
  *     cdef _memoryviewslice memviewsliceobj
  * 
  *     assert memview.view.ndim > 0             # <<<<<<<<<<<<<<
  * 
  *     if isinstance(memview, _memoryviewslice):
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
-  if (unlikely(!Py_OptimizeFlag)) {
+  if (unlikely(__pyx_assertions_enabled())) {
     if (unlikely(!((__pyx_v_memview->view.ndim > 0) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
       __PYX_ERR(1, 724, __pyx_L1_error)
     }
   }
   #endif
 
@@ -26667,15 +31720,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__49, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__55, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -26723,15 +31776,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__50, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__56, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -30000,15 +35053,15 @@
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb068931, 0x82a3537, 0x6ae9995):             # <<<<<<<<<<<<<<
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)
  */
   __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__51, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__57, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
     /* "(tree fragment)":5
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb068931, 0x82a3537, 0x6ae9995):
@@ -30345,15 +35398,15 @@
  * 
  *     if type.typegroup == 'S':
  *         assert type.fields != NULL             # <<<<<<<<<<<<<<
  *         assert type.fields.type != NULL
  * 
  */
     #ifndef CYTHON_WITHOUT_ASSERTIONS
-    if (unlikely(!Py_OptimizeFlag)) {
+    if (unlikely(__pyx_assertions_enabled())) {
       if (unlikely(!((__pyx_v_type->fields != NULL) != 0))) {
         PyErr_SetNone(PyExc_AssertionError);
         __PYX_ERR(1, 1471, __pyx_L1_error)
       }
     }
     #endif
 
@@ -30361,15 +35414,15 @@
  *     if type.typegroup == 'S':
  *         assert type.fields != NULL
  *         assert type.fields.type != NULL             # <<<<<<<<<<<<<<
  * 
  *         if type.flags & __PYX_BUF_FLAGS_PACKED_STRUCT:
  */
     #ifndef CYTHON_WITHOUT_ASSERTIONS
-    if (unlikely(!Py_OptimizeFlag)) {
+    if (unlikely(__pyx_assertions_enabled())) {
       if (unlikely(!((__pyx_v_type->fields->type != NULL) != 0))) {
         PyErr_SetNone(PyExc_AssertionError);
         __PYX_ERR(1, 1472, __pyx_L1_error)
       }
     }
     #endif
 
@@ -30386,16 +35439,16 @@
       /* "BufferFormatFromTypeInfo":1475
  * 
  *         if type.flags & __PYX_BUF_FLAGS_PACKED_STRUCT:
  *             alignment = b'^'             # <<<<<<<<<<<<<<
  *         else:
  *             alignment = b''
  */
-      __Pyx_INCREF(__pyx_kp_b__52);
-      __pyx_v_alignment = __pyx_kp_b__52;
+      __Pyx_INCREF(__pyx_kp_b__58);
+      __pyx_v_alignment = __pyx_kp_b__58;
 
       /* "BufferFormatFromTypeInfo":1474
  *         assert type.fields.type != NULL
  * 
  *         if type.flags & __PYX_BUF_FLAGS_PACKED_STRUCT:             # <<<<<<<<<<<<<<
  *             alignment = b'^'
  *         else:
@@ -30407,16 +35460,16 @@
  *             alignment = b'^'
  *         else:
  *             alignment = b''             # <<<<<<<<<<<<<<
  * 
  *         parts = [b"T{"]
  */
     /*else*/ {
-      __Pyx_INCREF(__pyx_kp_b__53);
-      __pyx_v_alignment = __pyx_kp_b__53;
+      __Pyx_INCREF(__pyx_kp_b__59);
+      __pyx_v_alignment = __pyx_kp_b__59;
     }
     __pyx_L4:;
 
     /* "BufferFormatFromTypeInfo":1479
  *             alignment = b''
  * 
  *         parts = [b"T{"]             # <<<<<<<<<<<<<<
@@ -30467,23 +35520,23 @@
       /* "BufferFormatFromTypeInfo":1484
  *         while field.type:
  *             part = format_from_typeinfo(field.type)
  *             parts.append(part + b':' + field.name + b':')             # <<<<<<<<<<<<<<
  *             field += 1
  * 
  */
-      __pyx_t_2 = PyNumber_Add(__pyx_v_part, __pyx_kp_b__54); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1484, __pyx_L1_error)
+      __pyx_t_2 = PyNumber_Add(__pyx_v_part, __pyx_kp_b__60); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1484, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_field->name); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 1484, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_t_5 = PyNumber_Add(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 1484, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = PyNumber_Add(__pyx_t_5, __pyx_kp_b__54); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 1484, __pyx_L1_error)
+      __pyx_t_4 = PyNumber_Add(__pyx_t_5, __pyx_kp_b__60); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 1484, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_parts, __pyx_t_4); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(1, 1484, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
       /* "BufferFormatFromTypeInfo":1485
  *             part = format_from_typeinfo(field.type)
@@ -30500,15 +35553,15 @@
  * 
  *         result = alignment.join(parts) + b'}'             # <<<<<<<<<<<<<<
  *     else:
  *         fmt = __Pyx_TypeInfoToFormat(type)
  */
     __pyx_t_4 = __Pyx_PyBytes_Join(__pyx_v_alignment, __pyx_v_parts); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 1487, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyNumber_Add(__pyx_t_4, __pyx_kp_b__55); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 1487, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_t_4, __pyx_kp_b__61); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 1487, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     if (!(likely(PyBytes_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_5)->tp_name), 0))) __PYX_ERR(1, 1487, __pyx_L1_error)
     __pyx_v_result = ((PyObject*)__pyx_t_5);
     __pyx_t_5 = 0;
 
     /* "BufferFormatFromTypeInfo":1470
@@ -30568,15 +35621,15 @@
       /* "BufferFormatFromTypeInfo":1492
  *         if type.arraysize[0]:
  *             extents = [unicode(type.arraysize[i]) for i in range(type.ndim)]
  *             result = (u"(%s)" % u','.join(extents)).encode('ascii') + fmt.string             # <<<<<<<<<<<<<<
  *         else:
  *             result = fmt.string
  */
-      __pyx_t_5 = PyUnicode_Join(__pyx_kp_u__56, __pyx_v_extents); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 1492, __pyx_L1_error)
+      __pyx_t_5 = PyUnicode_Join(__pyx_kp_u__62, __pyx_v_extents); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 1492, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __pyx_t_2 = PyUnicode_Format(__pyx_kp_u_s_2, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1492, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_t_5 = PyUnicode_AsASCIIString(((PyObject*)__pyx_t_2)); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 1492, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
@@ -30648,133 +35701,158 @@
   __Pyx_XDECREF(__pyx_v_alignment);
   __Pyx_XDECREF(__pyx_v_parts);
   __Pyx_XDECREF(__pyx_v_extents);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_Clause __pyx_vtable_11sat_toolkit_9_cnf_util_Clause;
+static struct __pyx_vtabstruct_11sat_toolkit_7formula_Clause __pyx_vtable_11sat_toolkit_7formula_Clause;
 
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util_Clause(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *p;
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula_Clause(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *p;
   PyObject *o;
   if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
     o = (*t->tp_alloc)(t, 0);
   } else {
     o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
   }
   if (unlikely(!o)) return 0;
-  p = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)o);
-  p->__pyx_vtab = __pyx_vtabptr_11sat_toolkit_9_cnf_util_Clause;
+  p = ((struct __pyx_obj_11sat_toolkit_7formula_Clause *)o);
+  p->__pyx_vtab = __pyx_vtabptr_11sat_toolkit_7formula_Clause;
   new((void*)&(p->clause)) std::vector<int> ();
   return o;
 }
 
-static void __pyx_tp_dealloc_11sat_toolkit_9_cnf_util_Clause(PyObject *o) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *)o;
+static void __pyx_tp_dealloc_11sat_toolkit_7formula_Clause(PyObject *o) {
+  struct __pyx_obj_11sat_toolkit_7formula_Clause *p = (struct __pyx_obj_11sat_toolkit_7formula_Clause *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !__Pyx_PyObject_GC_IsFinalized(o))) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   __Pyx_call_destructor(p->clause);
   (*Py_TYPE(o)->tp_free)(o);
 }
-static PyObject *__pyx_sq_item_11sat_toolkit_9_cnf_util_Clause(PyObject *o, Py_ssize_t i) {
+static PyObject *__pyx_sq_item_11sat_toolkit_7formula_Clause(PyObject *o, Py_ssize_t i) {
   PyObject *r;
   PyObject *x = PyInt_FromSsize_t(i); if(!x) return 0;
   r = Py_TYPE(o)->tp_as_mapping->mp_subscript(o, x);
   Py_DECREF(x);
   return r;
 }
 
-static PyObject *__pyx_getprop_11sat_toolkit_9_cnf_util_6Clause_maxvar(PyObject *o, CYTHON_UNUSED void *x) {
-  return __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_6maxvar_1__get__(o);
+static PyObject *__pyx_tp_richcompare_11sat_toolkit_7formula_Clause(PyObject *o1, PyObject *o2, int op) {
+  switch (op) {
+    case Py_EQ: {
+      return __pyx_pw_11sat_toolkit_7formula_6Clause_23__eq__(o1, o2);
+    }
+    case Py_NE: {
+      PyObject *ret;
+      ret = __pyx_pw_11sat_toolkit_7formula_6Clause_23__eq__(o1, o2);
+      if (likely(ret && ret != Py_NotImplemented)) {
+        int b = __Pyx_PyObject_IsTrue(ret); Py_DECREF(ret);
+        if (unlikely(b < 0)) return NULL;
+        ret = (b) ? Py_False : Py_True;
+        Py_INCREF(ret);
+      }
+      return ret;
+    }
+    default: {
+      return __Pyx_NewRef(Py_NotImplemented);
+    }
+  }
+}
+
+static PyObject *__pyx_getprop_11sat_toolkit_7formula_6Clause_maxvar(PyObject *o, CYTHON_UNUSED void *x) {
+  return __pyx_pw_11sat_toolkit_7formula_6Clause_6maxvar_1__get__(o);
 }
 
-static PyMethodDef __pyx_methods_11sat_toolkit_9_cnf_util_Clause[] = {
-  {"apply_to_variables", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_3apply_to_variables, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_6Clause_2apply_to_variables},
-  {"__reduce_cython__", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_14__reduce_cython__, METH_NOARGS, __pyx_doc_11sat_toolkit_9_cnf_util_6Clause_13__reduce_cython__},
-  {"__setstate_cython__", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_6Clause_16__setstate_cython__, METH_O, __pyx_doc_11sat_toolkit_9_cnf_util_6Clause_15__setstate_cython__},
+static PyMethodDef __pyx_methods_11sat_toolkit_7formula_Clause[] = {
+  {"to_linear_constraint", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_6Clause_3to_linear_constraint, METH_O, __pyx_doc_11sat_toolkit_7formula_6Clause_2to_linear_constraint},
+  {"__reversed__", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_6Clause_16__reversed__, METH_NOARGS, __pyx_doc_11sat_toolkit_7formula_6Clause_15__reversed__},
+  {"count", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_6Clause_19count, METH_O, __pyx_doc_11sat_toolkit_7formula_6Clause_18count},
+  {"index", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_6Clause_21index, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_6Clause_20index},
+  {"__reduce_cython__", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_6Clause_25__reduce_cython__, METH_NOARGS, __pyx_doc_11sat_toolkit_7formula_6Clause_24__reduce_cython__},
+  {"__setstate_cython__", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_6Clause_27__setstate_cython__, METH_O, __pyx_doc_11sat_toolkit_7formula_6Clause_26__setstate_cython__},
   {0, 0, 0, 0}
 };
 
-static struct PyGetSetDef __pyx_getsets_11sat_toolkit_9_cnf_util_Clause[] = {
-  {(char *)"maxvar", __pyx_getprop_11sat_toolkit_9_cnf_util_6Clause_maxvar, 0, (char *)0, 0},
+static struct PyGetSetDef __pyx_getsets_11sat_toolkit_7formula_Clause[] = {
+  {(char *)"maxvar", __pyx_getprop_11sat_toolkit_7formula_6Clause_maxvar, 0, (char *)0, 0},
   {0, 0, 0, 0, 0}
 };
 
 static PySequenceMethods __pyx_tp_as_sequence_Clause = {
-  __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_9__len__, /*sq_length*/
+  __pyx_pw_11sat_toolkit_7formula_6Clause_9__len__, /*sq_length*/
   0, /*sq_concat*/
   0, /*sq_repeat*/
-  __pyx_sq_item_11sat_toolkit_9_cnf_util_Clause, /*sq_item*/
+  __pyx_sq_item_11sat_toolkit_7formula_Clause, /*sq_item*/
   0, /*sq_slice*/
   0, /*sq_ass_item*/
   0, /*sq_ass_slice*/
-  0, /*sq_contains*/
+  __pyx_pw_11sat_toolkit_7formula_6Clause_11__contains__, /*sq_contains*/
   0, /*sq_inplace_concat*/
   0, /*sq_inplace_repeat*/
 };
 
 static PyMappingMethods __pyx_tp_as_mapping_Clause = {
-  __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_9__len__, /*mp_length*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_7__getitem__, /*mp_subscript*/
+  __pyx_pw_11sat_toolkit_7formula_6Clause_9__len__, /*mp_length*/
+  __pyx_pw_11sat_toolkit_7formula_6Clause_7__getitem__, /*mp_subscript*/
   0, /*mp_ass_subscript*/
 };
 
-static PyTypeObject __pyx_type_11sat_toolkit_9_cnf_util_Clause = {
+static PyTypeObject __pyx_type_11sat_toolkit_7formula_Clause = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util.Clause", /*tp_name*/
-  sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause), /*tp_basicsize*/
+  "sat_toolkit.formula.Clause", /*tp_name*/
+  sizeof(struct __pyx_obj_11sat_toolkit_7formula_Clause), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_11sat_toolkit_9_cnf_util_Clause, /*tp_dealloc*/
+  __pyx_tp_dealloc_11sat_toolkit_7formula_Clause, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
   0, /*tp_setattr*/
   #if PY_MAJOR_VERSION < 3
   0, /*tp_compare*/
   #endif
   #if PY_MAJOR_VERSION >= 3
   0, /*tp_as_async*/
   #endif
-  __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_5__repr__, /*tp_repr*/
+  __pyx_pw_11sat_toolkit_7formula_6Clause_5__repr__, /*tp_repr*/
   0, /*tp_as_number*/
   &__pyx_tp_as_sequence_Clause, /*tp_as_sequence*/
   &__pyx_tp_as_mapping_Clause, /*tp_as_mapping*/
   0, /*tp_hash*/
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
   "Clause(clause)", /*tp_doc*/
   0, /*tp_traverse*/
   0, /*tp_clear*/
-  0, /*tp_richcompare*/
+  __pyx_tp_richcompare_11sat_toolkit_7formula_Clause, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_11__iter__, /*tp_iter*/
+  __pyx_pw_11sat_toolkit_7formula_6Clause_13__iter__, /*tp_iter*/
   0, /*tp_iternext*/
-  __pyx_methods_11sat_toolkit_9_cnf_util_Clause, /*tp_methods*/
+  __pyx_methods_11sat_toolkit_7formula_Clause, /*tp_methods*/
   0, /*tp_members*/
-  __pyx_getsets_11sat_toolkit_9_cnf_util_Clause, /*tp_getset*/
+  __pyx_getsets_11sat_toolkit_7formula_Clause, /*tp_getset*/
   0, /*tp_base*/
   0, /*tp_dict*/
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   0, /*tp_dictoffset*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_6Clause_1__init__, /*tp_init*/
+  __pyx_pw_11sat_toolkit_7formula_6Clause_1__init__, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_11sat_toolkit_9_cnf_util_Clause, /*tp_new*/
+  __pyx_tp_new_11sat_toolkit_7formula_Clause, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -30785,134 +35863,204 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
-static struct __pyx_vtabstruct_11sat_toolkit_9_cnf_util_CNF __pyx_vtable_11sat_toolkit_9_cnf_util_CNF;
+static struct __pyx_vtabstruct_11sat_toolkit_7formula_CNF __pyx_vtable_11sat_toolkit_7formula_CNF;
 
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util_CNF(PyTypeObject *t, PyObject *a, PyObject *k) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *p;
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula_CNF(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *p;
   PyObject *o;
   if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
     o = (*t->tp_alloc)(t, 0);
   } else {
     o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
   }
   if (unlikely(!o)) return 0;
-  p = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)o);
-  p->__pyx_vtab = __pyx_vtabptr_11sat_toolkit_9_cnf_util_CNF;
+  p = ((struct __pyx_obj_11sat_toolkit_7formula_CNF *)o);
+  p->__pyx_vtab = __pyx_vtabptr_11sat_toolkit_7formula_CNF;
   new((void*)&(p->clauses)) std::vector<int> ();
   new((void*)&(p->start_indices)) std::vector<size_t> ();
-  if (unlikely(__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_3__cinit__(o, a, k) < 0)) goto bad;
+  if (unlikely(__pyx_pw_11sat_toolkit_7formula_3CNF_3__cinit__(o, __pyx_empty_tuple, NULL) < 0)) goto bad;
   return o;
   bad:
   Py_DECREF(o); o = 0;
   return NULL;
 }
 
-static void __pyx_tp_dealloc_11sat_toolkit_9_cnf_util_CNF(PyObject *o) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *)o;
+static void __pyx_tp_dealloc_11sat_toolkit_7formula_CNF(PyObject *o) {
+  struct __pyx_obj_11sat_toolkit_7formula_CNF *p = (struct __pyx_obj_11sat_toolkit_7formula_CNF *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !__Pyx_PyObject_GC_IsFinalized(o))) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   __Pyx_call_destructor(p->clauses);
   __Pyx_call_destructor(p->start_indices);
   (*Py_TYPE(o)->tp_free)(o);
 }
-static PyObject *__pyx_sq_item_11sat_toolkit_9_cnf_util_CNF(PyObject *o, Py_ssize_t i) {
+static PyObject *__pyx_sq_item_11sat_toolkit_7formula_CNF(PyObject *o, Py_ssize_t i) {
   PyObject *r;
   PyObject *x = PyInt_FromSsize_t(i); if(!x) return 0;
   r = Py_TYPE(o)->tp_as_mapping->mp_subscript(o, x);
   Py_DECREF(x);
   return r;
 }
 
-static PyObject *__pyx_tp_richcompare_11sat_toolkit_9_cnf_util_CNF(PyObject *o1, PyObject *o2, int op) {
+static PyObject *__pyx_tp_richcompare_11sat_toolkit_7formula_CNF(PyObject *o1, PyObject *o2, int op) {
   switch (op) {
     case Py_EQ: {
-      return __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_34__eq__(o1, o2);
+      return __pyx_pw_11sat_toolkit_7formula_3CNF_55__eq__(o1, o2);
     }
     case Py_NE: {
       PyObject *ret;
-      ret = __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_34__eq__(o1, o2);
+      ret = __pyx_pw_11sat_toolkit_7formula_3CNF_55__eq__(o1, o2);
       if (likely(ret && ret != Py_NotImplemented)) {
         int b = __Pyx_PyObject_IsTrue(ret); Py_DECREF(ret);
         if (unlikely(b < 0)) return NULL;
         ret = (b) ? Py_False : Py_True;
         Py_INCREF(ret);
       }
       return ret;
     }
     default: {
       return __Pyx_NewRef(Py_NotImplemented);
     }
   }
 }
 
-static PyObject *__pyx_getprop_11sat_toolkit_9_cnf_util_3CNF_clauses(PyObject *o, CYTHON_UNUSED void *x) {
-  return __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_7clauses_1__get__(o);
+static PyObject *__pyx_getprop_11sat_toolkit_7formula_3CNF_clauses(PyObject *o, CYTHON_UNUSED void *x) {
+  return __pyx_pw_11sat_toolkit_7formula_3CNF_7clauses_1__get__(o);
 }
 
-static PyObject *__pyx_getprop_11sat_toolkit_9_cnf_util_3CNF_start_indices(PyObject *o, CYTHON_UNUSED void *x) {
-  return __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_13start_indices_1__get__(o);
+static PyObject *__pyx_getprop_11sat_toolkit_7formula_3CNF_start_indices(PyObject *o, CYTHON_UNUSED void *x) {
+  return __pyx_pw_11sat_toolkit_7formula_3CNF_13start_indices_1__get__(o);
 }
 
-static PyObject *__pyx_getprop_11sat_toolkit_9_cnf_util_3CNF_nvars(PyObject *o, CYTHON_UNUSED void *x) {
-  return __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_5nvars_1__get__(o);
-}
-
-static PyMethodDef __pyx_methods_11sat_toolkit_9_cnf_util_CNF[] = {
-  {"from_dimacs", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_5from_dimacs, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_4from_dimacs},
-  {"from_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_7from_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_6from_espresso},
-  {"add_clauses", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_9add_clauses, METH_O, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_8add_clauses},
-  {"add_clause", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_11add_clause, METH_O, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_10add_clause},
-  {"logical_or", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_13logical_or, METH_O, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_12logical_or},
-  {"implied_by", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_15implied_by, METH_O, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_14implied_by},
-  {"to_dimacs", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_17to_dimacs, METH_NOARGS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_16to_dimacs},
-  {"to_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_19to_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_18to_espresso},
-  {"minimize_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_21minimize_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_20minimize_espresso},
-  {"_minimize_dimacs", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_23_minimize_dimacs, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_22_minimize_dimacs},
-  {"minimize_lingeling", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_25minimize_lingeling, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_24minimize_lingeling},
-  {"__reduce__", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_40__reduce__, METH_NOARGS, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_39__reduce__},
-  {"equiv", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_42equiv, METH_O, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_41equiv},
-  {"translate", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_3CNF_44translate, METH_O, __pyx_doc_11sat_toolkit_9_cnf_util_3CNF_43translate},
+static PyObject *__pyx_getprop_11sat_toolkit_7formula_3CNF_nvars(PyObject *o, CYTHON_UNUSED void *x) {
+  return __pyx_pw_11sat_toolkit_7formula_3CNF_5nvars_1__get__(o);
+}
+
+static PyMethodDef __pyx_methods_11sat_toolkit_7formula_CNF[] = {
+  {"from_dimacs", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_5from_dimacs, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_4from_dimacs},
+  {"from_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_7from_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_6from_espresso},
+  {"create_all_zero", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_9create_all_zero, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_8create_all_zero},
+  {"create_all_equal", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_11create_all_equal, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_10create_all_equal},
+  {"create_xor", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_13create_xor, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_12create_xor},
+  {"add_clauses", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_15add_clauses, METH_O, __pyx_doc_11sat_toolkit_7formula_3CNF_14add_clauses},
+  {"add_clause", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_17add_clause, METH_O, __pyx_doc_11sat_toolkit_7formula_3CNF_16add_clause},
+  {"logical_or", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_21logical_or, METH_O, __pyx_doc_11sat_toolkit_7formula_3CNF_20logical_or},
+  {"implied_by", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_23implied_by, METH_O, __pyx_doc_11sat_toolkit_7formula_3CNF_22implied_by},
+  {"to_dimacs", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_25to_dimacs, METH_NOARGS, __pyx_doc_11sat_toolkit_7formula_3CNF_24to_dimacs},
+  {"to_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_27to_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_26to_espresso},
+  {"minimize_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_29minimize_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_28minimize_espresso},
+  {"_minimize_dimacs", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_31_minimize_dimacs, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_30_minimize_dimacs},
+  {"minimize_lingeling", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_33minimize_lingeling, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_32minimize_lingeling},
+  {"check_solution", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_35check_solution, METH_O, __pyx_doc_11sat_toolkit_7formula_3CNF_34check_solution},
+  {"to_truthtable", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_37to_truthtable, METH_NOARGS, __pyx_doc_11sat_toolkit_7formula_3CNF_36to_truthtable},
+  {"__reversed__", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_46__reversed__, METH_NOARGS, __pyx_doc_11sat_toolkit_7formula_3CNF_45__reversed__},
+  {"count", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_51count, METH_O, __pyx_doc_11sat_toolkit_7formula_3CNF_50count},
+  {"index", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_3CNF_53index, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_3CNF_52index},
+  {"__reduce__", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_61__reduce__, METH_NOARGS, __pyx_doc_11sat_toolkit_7formula_3CNF_60__reduce__},
+  {"equiv", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_63equiv, METH_O, __pyx_doc_11sat_toolkit_7formula_3CNF_62equiv},
+  {"translate", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_3CNF_65translate, METH_O, __pyx_doc_11sat_toolkit_7formula_3CNF_64translate},
   {0, 0, 0, 0}
 };
 
-static struct PyGetSetDef __pyx_getsets_11sat_toolkit_9_cnf_util_CNF[] = {
-  {(char *)"clauses", __pyx_getprop_11sat_toolkit_9_cnf_util_3CNF_clauses, 0, (char *)0, 0},
-  {(char *)"start_indices", __pyx_getprop_11sat_toolkit_9_cnf_util_3CNF_start_indices, 0, (char *)0, 0},
-  {(char *)"nvars", __pyx_getprop_11sat_toolkit_9_cnf_util_3CNF_nvars, 0, (char *)0, 0},
+static struct PyGetSetDef __pyx_getsets_11sat_toolkit_7formula_CNF[] = {
+  {(char *)"clauses", __pyx_getprop_11sat_toolkit_7formula_3CNF_clauses, 0, (char *)0, 0},
+  {(char *)"start_indices", __pyx_getprop_11sat_toolkit_7formula_3CNF_start_indices, 0, (char *)0, 0},
+  {(char *)"nvars", __pyx_getprop_11sat_toolkit_7formula_3CNF_nvars, 0, (char *)0, 0},
   {0, 0, 0, 0, 0}
 };
 
+static PyNumberMethods __pyx_tp_as_number_CNF = {
+  0, /*nb_add*/
+  0, /*nb_subtract*/
+  0, /*nb_multiply*/
+  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
+  0, /*nb_divide*/
+  #endif
+  0, /*nb_remainder*/
+  0, /*nb_divmod*/
+  0, /*nb_power*/
+  0, /*nb_negative*/
+  0, /*nb_positive*/
+  0, /*nb_absolute*/
+  0, /*nb_nonzero*/
+  0, /*nb_invert*/
+  0, /*nb_lshift*/
+  0, /*nb_rshift*/
+  0, /*nb_and*/
+  0, /*nb_xor*/
+  0, /*nb_or*/
+  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
+  0, /*nb_coerce*/
+  #endif
+  0, /*nb_int*/
+  #if PY_MAJOR_VERSION < 3
+  0, /*nb_long*/
+  #else
+  0, /*reserved*/
+  #endif
+  0, /*nb_float*/
+  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
+  0, /*nb_oct*/
+  #endif
+  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
+  0, /*nb_hex*/
+  #endif
+  __pyx_pw_11sat_toolkit_7formula_3CNF_19__iadd__, /*nb_inplace_add*/
+  0, /*nb_inplace_subtract*/
+  0, /*nb_inplace_multiply*/
+  #if PY_MAJOR_VERSION < 3 || (CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x03050000)
+  0, /*nb_inplace_divide*/
+  #endif
+  0, /*nb_inplace_remainder*/
+  0, /*nb_inplace_power*/
+  0, /*nb_inplace_lshift*/
+  0, /*nb_inplace_rshift*/
+  0, /*nb_inplace_and*/
+  0, /*nb_inplace_xor*/
+  0, /*nb_inplace_or*/
+  0, /*nb_floor_divide*/
+  0, /*nb_true_divide*/
+  0, /*nb_inplace_floor_divide*/
+  0, /*nb_inplace_true_divide*/
+  0, /*nb_index*/
+  #if PY_VERSION_HEX >= 0x03050000
+  0, /*nb_matrix_multiply*/
+  #endif
+  #if PY_VERSION_HEX >= 0x03050000
+  0, /*nb_inplace_matrix_multiply*/
+  #endif
+};
+
 static PySequenceMethods __pyx_tp_as_sequence_CNF = {
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_29__len__, /*sq_length*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_41__len__, /*sq_length*/
   0, /*sq_concat*/
   0, /*sq_repeat*/
-  __pyx_sq_item_11sat_toolkit_9_cnf_util_CNF, /*sq_item*/
+  __pyx_sq_item_11sat_toolkit_7formula_CNF, /*sq_item*/
   0, /*sq_slice*/
   0, /*sq_ass_item*/
   0, /*sq_ass_slice*/
-  0, /*sq_contains*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_49__contains__, /*sq_contains*/
   0, /*sq_inplace_concat*/
   0, /*sq_inplace_repeat*/
 };
 
 static PyMappingMethods __pyx_tp_as_mapping_CNF = {
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_29__len__, /*mp_length*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_27__getitem__, /*mp_subscript*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_41__len__, /*mp_length*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_39__getitem__, /*mp_subscript*/
   0, /*mp_ass_subscript*/
 };
 
 static PyBufferProcs __pyx_tp_as_buffer_CNF = {
   #if PY_MAJOR_VERSION < 3
   0, /*bf_getreadbuffer*/
   #endif
@@ -30921,67 +36069,67 @@
   #endif
   #if PY_MAJOR_VERSION < 3
   0, /*bf_getsegcount*/
   #endif
   #if PY_MAJOR_VERSION < 3
   0, /*bf_getcharbuffer*/
   #endif
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_46__getbuffer__, /*bf_getbuffer*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_48__releasebuffer__, /*bf_releasebuffer*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_67__getbuffer__, /*bf_getbuffer*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_69__releasebuffer__, /*bf_releasebuffer*/
 };
 
-static PyTypeObject __pyx_type_11sat_toolkit_9_cnf_util_CNF = {
+static PyTypeObject __pyx_type_11sat_toolkit_7formula_CNF = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util.CNF", /*tp_name*/
-  sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF), /*tp_basicsize*/
+  "sat_toolkit.formula.CNF", /*tp_name*/
+  sizeof(struct __pyx_obj_11sat_toolkit_7formula_CNF), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_11sat_toolkit_9_cnf_util_CNF, /*tp_dealloc*/
+  __pyx_tp_dealloc_11sat_toolkit_7formula_CNF, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
   0, /*tp_setattr*/
   #if PY_MAJOR_VERSION < 3
   0, /*tp_compare*/
   #endif
   #if PY_MAJOR_VERSION >= 3
   0, /*tp_as_async*/
   #endif
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_36__repr__, /*tp_repr*/
-  0, /*tp_as_number*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_57__repr__, /*tp_repr*/
+  &__pyx_tp_as_number_CNF, /*tp_as_number*/
   &__pyx_tp_as_sequence_CNF, /*tp_as_sequence*/
   &__pyx_tp_as_mapping_CNF, /*tp_as_mapping*/
   0, /*tp_hash*/
   0, /*tp_call*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_38__str__, /*tp_str*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_59__str__, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   &__pyx_tp_as_buffer_CNF, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
-  "CNF(clauses=None, nvars=-1)\n\n    Class for storing and manipulating CNF formulas.\n    The CNF is represented in a format closely related to the DIMACS format.\n    Therefore, indices start with 1.\n    ", /*tp_doc*/
+  "CNF(clauses=None, nvars=-1)\n\n    Class for storing and manipulating CNF formulas.\n\n    The CNF is represented in a format closely related to the DIMACS format.\n    A CNF is conjuction (logical AND) of clauses.\n    Each clause (logical AND) is a list of variables that ends with a 0.\n    A positive number indicates the presence of a variable in the clause while\n    a negative number indicates the presence of the negated varaible in the\n    clause.\n\n    For example, the CNF (x1 or not x2) and (x2 or x3) can be represented as\n    CNF([1, -2, 0, 2, 3, 0]).\n    ", /*tp_doc*/
   0, /*tp_traverse*/
   0, /*tp_clear*/
-  __pyx_tp_richcompare_11sat_toolkit_9_cnf_util_CNF, /*tp_richcompare*/
+  __pyx_tp_richcompare_11sat_toolkit_7formula_CNF, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_31__iter__, /*tp_iter*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_43__iter__, /*tp_iter*/
   0, /*tp_iternext*/
-  __pyx_methods_11sat_toolkit_9_cnf_util_CNF, /*tp_methods*/
+  __pyx_methods_11sat_toolkit_7formula_CNF, /*tp_methods*/
   0, /*tp_members*/
-  __pyx_getsets_11sat_toolkit_9_cnf_util_CNF, /*tp_getset*/
+  __pyx_getsets_11sat_toolkit_7formula_CNF, /*tp_getset*/
   0, /*tp_base*/
   0, /*tp_dict*/
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   0, /*tp_dictoffset*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_1__init__, /*tp_init*/
+  __pyx_pw_11sat_toolkit_7formula_3CNF_1__init__, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_11sat_toolkit_9_cnf_util_CNF, /*tp_new*/
+  __pyx_tp_new_11sat_toolkit_7formula_CNF, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -30992,200 +36140,309 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util_Truthtable(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *p;
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula_Truthtable(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *p;
   PyObject *o;
   if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
     o = (*t->tp_alloc)(t, 0);
   } else {
     o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
   }
   if (unlikely(!o)) return 0;
-  p = ((struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)o);
+  p = ((struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)o);
   p->on_set = Py_None; Py_INCREF(Py_None);
   p->dc_set = Py_None; Py_INCREF(Py_None);
   return o;
 }
 
-static void __pyx_tp_dealloc_11sat_toolkit_9_cnf_util_Truthtable(PyObject *o) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)o;
+static void __pyx_tp_dealloc_11sat_toolkit_7formula_Truthtable(PyObject *o) {
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *p = (struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !__Pyx_PyObject_GC_IsFinalized(o)) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   PyObject_GC_UnTrack(o);
   Py_CLEAR(p->on_set);
   Py_CLEAR(p->dc_set);
   (*Py_TYPE(o)->tp_free)(o);
 }
 
-static int __pyx_tp_traverse_11sat_toolkit_9_cnf_util_Truthtable(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_11sat_toolkit_7formula_Truthtable(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)o;
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *p = (struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)o;
   if (p->on_set) {
     e = (*v)(p->on_set, a); if (e) return e;
   }
   if (p->dc_set) {
     e = (*v)(p->dc_set, a); if (e) return e;
   }
   return 0;
 }
 
-static int __pyx_tp_clear_11sat_toolkit_9_cnf_util_Truthtable(PyObject *o) {
+static int __pyx_tp_clear_11sat_toolkit_7formula_Truthtable(PyObject *o) {
   PyObject* tmp;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable *)o;
+  struct __pyx_obj_11sat_toolkit_7formula_Truthtable *p = (struct __pyx_obj_11sat_toolkit_7formula_Truthtable *)o;
   tmp = ((PyObject*)p->on_set);
   p->on_set = Py_None; Py_INCREF(Py_None);
   Py_XDECREF(tmp);
   tmp = ((PyObject*)p->dc_set);
   p->dc_set = Py_None; Py_INCREF(Py_None);
   Py_XDECREF(tmp);
   return 0;
 }
 
-static PyObject *__pyx_tp_richcompare_11sat_toolkit_9_cnf_util_Truthtable(PyObject *o1, PyObject *o2, int op) {
+static PyObject *__pyx_tp_richcompare_11sat_toolkit_7formula_Truthtable(PyObject *o1, PyObject *o2, int op) {
   switch (op) {
     case Py_EQ: {
-      return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_13__eq__(o1, o2);
+      return __pyx_pw_11sat_toolkit_7formula_10Truthtable_13__eq__(o1, o2);
     }
     case Py_NE: {
       PyObject *ret;
-      ret = __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_13__eq__(o1, o2);
+      ret = __pyx_pw_11sat_toolkit_7formula_10Truthtable_13__eq__(o1, o2);
       if (likely(ret && ret != Py_NotImplemented)) {
         int b = __Pyx_PyObject_IsTrue(ret); Py_DECREF(ret);
         if (unlikely(b < 0)) return NULL;
         ret = (b) ? Py_False : Py_True;
         Py_INCREF(ret);
       }
       return ret;
     }
     default: {
       return __Pyx_NewRef(Py_NotImplemented);
     }
   }
 }
 
-static PyObject *__pyx_getprop_11sat_toolkit_9_cnf_util_10Truthtable_on_set(PyObject *o, CYTHON_UNUSED void *x) {
-  return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_1__get__(o);
+static PyObject *__pyx_getprop_11sat_toolkit_7formula_10Truthtable_on_set(PyObject *o, CYTHON_UNUSED void *x) {
+  return __pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_1__get__(o);
 }
 
-static int __pyx_setprop_11sat_toolkit_9_cnf_util_10Truthtable_on_set(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
+static int __pyx_setprop_11sat_toolkit_7formula_10Truthtable_on_set(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
   if (v) {
-    return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_3__set__(o, v);
+    return __pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_3__set__(o, v);
   }
   else {
-    return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6on_set_5__del__(o);
+    return __pyx_pw_11sat_toolkit_7formula_10Truthtable_6on_set_5__del__(o);
   }
 }
 
-static PyObject *__pyx_getprop_11sat_toolkit_9_cnf_util_10Truthtable_dc_set(PyObject *o, CYTHON_UNUSED void *x) {
-  return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_1__get__(o);
+static PyObject *__pyx_getprop_11sat_toolkit_7formula_10Truthtable_dc_set(PyObject *o, CYTHON_UNUSED void *x) {
+  return __pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_1__get__(o);
 }
 
-static int __pyx_setprop_11sat_toolkit_9_cnf_util_10Truthtable_dc_set(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
+static int __pyx_setprop_11sat_toolkit_7formula_10Truthtable_dc_set(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
   if (v) {
-    return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_3__set__(o, v);
+    return __pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_3__set__(o, v);
   }
   else {
-    return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_6dc_set_5__del__(o);
+    return __pyx_pw_11sat_toolkit_7formula_10Truthtable_6dc_set_5__del__(o);
   }
 }
 
-static PyObject *__pyx_getprop_11sat_toolkit_9_cnf_util_10Truthtable_numbits(PyObject *o, CYTHON_UNUSED void *x) {
-  return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_1__get__(o);
+static PyObject *__pyx_getprop_11sat_toolkit_7formula_10Truthtable_numbits(PyObject *o, CYTHON_UNUSED void *x) {
+  return __pyx_pw_11sat_toolkit_7formula_10Truthtable_7numbits_1__get__(o);
 }
 
-static int __pyx_setprop_11sat_toolkit_9_cnf_util_10Truthtable_numbits(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
+static int __pyx_setprop_11sat_toolkit_7formula_10Truthtable_numbits(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
   if (v) {
-    return __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7numbits_3__set__(o, v);
+    return __pyx_pw_11sat_toolkit_7formula_10Truthtable_7numbits_3__set__(o, v);
   }
   else {
     PyErr_SetString(PyExc_NotImplementedError, "__del__");
     return -1;
   }
 }
 
-static PyMethodDef __pyx_methods_11sat_toolkit_9_cnf_util_Truthtable[] = {
-  {"from_lut", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_3from_lut, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_2from_lut},
-  {"from_indices", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_5from_indices, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_4from_indices},
-  {"_write", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_7_write, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_6_write},
-  {"to_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_9to_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_8to_espresso},
-  {"to_cnf", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_15to_cnf, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_14to_cnf},
-  {"__reduce_cython__", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_17__reduce_cython__, METH_NOARGS, __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_16__reduce_cython__},
-  {"__setstate_cython__", (PyCFunction)__pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_19__setstate_cython__, METH_O, __pyx_doc_11sat_toolkit_9_cnf_util_10Truthtable_18__setstate_cython__},
+static PyMethodDef __pyx_methods_11sat_toolkit_7formula_Truthtable[] = {
+  {"from_lut", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_10Truthtable_3from_lut, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_10Truthtable_2from_lut},
+  {"from_indices", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_10Truthtable_5from_indices, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_10Truthtable_4from_indices},
+  {"_write", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_10Truthtable_7_write, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_10Truthtable_6_write},
+  {"to_espresso", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_10Truthtable_9to_espresso, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_10Truthtable_8to_espresso},
+  {"to_cnf", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11sat_toolkit_7formula_10Truthtable_15to_cnf, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11sat_toolkit_7formula_10Truthtable_14to_cnf},
+  {"__reduce_cython__", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_10Truthtable_17__reduce_cython__, METH_NOARGS, __pyx_doc_11sat_toolkit_7formula_10Truthtable_16__reduce_cython__},
+  {"__setstate_cython__", (PyCFunction)__pyx_pw_11sat_toolkit_7formula_10Truthtable_19__setstate_cython__, METH_O, __pyx_doc_11sat_toolkit_7formula_10Truthtable_18__setstate_cython__},
   {0, 0, 0, 0}
 };
 
-static struct PyGetSetDef __pyx_getsets_11sat_toolkit_9_cnf_util_Truthtable[] = {
-  {(char *)"on_set", __pyx_getprop_11sat_toolkit_9_cnf_util_10Truthtable_on_set, __pyx_setprop_11sat_toolkit_9_cnf_util_10Truthtable_on_set, (char *)"on_set: object", 0},
-  {(char *)"dc_set", __pyx_getprop_11sat_toolkit_9_cnf_util_10Truthtable_dc_set, __pyx_setprop_11sat_toolkit_9_cnf_util_10Truthtable_dc_set, (char *)"dc_set: object", 0},
-  {(char *)"numbits", __pyx_getprop_11sat_toolkit_9_cnf_util_10Truthtable_numbits, __pyx_setprop_11sat_toolkit_9_cnf_util_10Truthtable_numbits, (char *)"numbits: 'uint64_t'", 0},
+static struct PyGetSetDef __pyx_getsets_11sat_toolkit_7formula_Truthtable[] = {
+  {(char *)"on_set", __pyx_getprop_11sat_toolkit_7formula_10Truthtable_on_set, __pyx_setprop_11sat_toolkit_7formula_10Truthtable_on_set, (char *)"on_set: object", 0},
+  {(char *)"dc_set", __pyx_getprop_11sat_toolkit_7formula_10Truthtable_dc_set, __pyx_setprop_11sat_toolkit_7formula_10Truthtable_dc_set, (char *)"dc_set: object", 0},
+  {(char *)"numbits", __pyx_getprop_11sat_toolkit_7formula_10Truthtable_numbits, __pyx_setprop_11sat_toolkit_7formula_10Truthtable_numbits, (char *)"numbits: 'uint64_t'", 0},
   {0, 0, 0, 0, 0}
 };
 
-static PyTypeObject __pyx_type_11sat_toolkit_9_cnf_util_Truthtable = {
+static PyTypeObject __pyx_type_11sat_toolkit_7formula_Truthtable = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util.Truthtable", /*tp_name*/
-  sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util_Truthtable), /*tp_basicsize*/
+  "sat_toolkit.formula.Truthtable", /*tp_name*/
+  sizeof(struct __pyx_obj_11sat_toolkit_7formula_Truthtable), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_11sat_toolkit_9_cnf_util_Truthtable, /*tp_dealloc*/
+  __pyx_tp_dealloc_11sat_toolkit_7formula_Truthtable, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
   0, /*tp_setattr*/
   #if PY_MAJOR_VERSION < 3
   0, /*tp_compare*/
   #endif
   #if PY_MAJOR_VERSION >= 3
   0, /*tp_as_async*/
   #endif
-  __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_11__repr__, /*tp_repr*/
+  __pyx_pw_11sat_toolkit_7formula_10Truthtable_11__repr__, /*tp_repr*/
   0, /*tp_as_number*/
   0, /*tp_as_sequence*/
   0, /*tp_as_mapping*/
   0, /*tp_hash*/
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   "Truthtable(init_key, numbits, on_set, dc_set)\n\n    A boolean function represented as a truth table.\n    The truth table is stored using a table for the ON set and the DC set of the function.\n    The ON set denotes where the value of the function is 1/true, while the DC set\n    denotes where the value of the function is left unspecified.\n    The DC set allows more efficient CNF representations when optimizing with espresso.\n    The OFF set is the complement of the two sets.\n    ", /*tp_doc*/
-  __pyx_tp_traverse_11sat_toolkit_9_cnf_util_Truthtable, /*tp_traverse*/
-  __pyx_tp_clear_11sat_toolkit_9_cnf_util_Truthtable, /*tp_clear*/
-  __pyx_tp_richcompare_11sat_toolkit_9_cnf_util_Truthtable, /*tp_richcompare*/
+  __pyx_tp_traverse_11sat_toolkit_7formula_Truthtable, /*tp_traverse*/
+  __pyx_tp_clear_11sat_toolkit_7formula_Truthtable, /*tp_clear*/
+  __pyx_tp_richcompare_11sat_toolkit_7formula_Truthtable, /*tp_richcompare*/
+  0, /*tp_weaklistoffset*/
+  0, /*tp_iter*/
+  0, /*tp_iternext*/
+  __pyx_methods_11sat_toolkit_7formula_Truthtable, /*tp_methods*/
+  0, /*tp_members*/
+  __pyx_getsets_11sat_toolkit_7formula_Truthtable, /*tp_getset*/
+  0, /*tp_base*/
+  0, /*tp_dict*/
+  0, /*tp_descr_get*/
+  0, /*tp_descr_set*/
+  0, /*tp_dictoffset*/
+  __pyx_pw_11sat_toolkit_7formula_10Truthtable_1__init__, /*tp_init*/
+  0, /*tp_alloc*/
+  __pyx_tp_new_11sat_toolkit_7formula_Truthtable, /*tp_new*/
+  0, /*tp_free*/
+  0, /*tp_is_gc*/
+  0, /*tp_bases*/
+  0, /*tp_mro*/
+  0, /*tp_cache*/
+  0, /*tp_subclasses*/
+  0, /*tp_weaklist*/
+  0, /*tp_del*/
+  0, /*tp_version_tag*/
+  #if PY_VERSION_HEX >= 0x030400a1
+  0, /*tp_finalize*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
+  0, /*tp_vectorcall*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
+  0, /*tp_print*/
+  #endif
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
+  0, /*tp_pypy_flags*/
+  #endif
+};
+
+static struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *__pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct____iter__[8];
+static int __pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct____iter__ = 0;
+
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct____iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  PyObject *o;
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct____iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__)))) {
+    o = (PyObject*)__pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct____iter__[--__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct____iter__];
+    memset(o, 0, sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__));
+    (void) PyObject_INIT(o, t);
+    PyObject_GC_Track(o);
+  } else {
+    o = (*t->tp_alloc)(t, 0);
+    if (unlikely(!o)) return 0;
+  }
+  return o;
+}
+
+static void __pyx_tp_dealloc_11sat_toolkit_7formula___pyx_scope_struct____iter__(PyObject *o) {
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *p = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *)o;
+  PyObject_GC_UnTrack(o);
+  Py_CLEAR(p->__pyx_v_self);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct____iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__)))) {
+    __pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct____iter__[__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct____iter__++] = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *)o);
+  } else {
+    (*Py_TYPE(o)->tp_free)(o);
+  }
+}
+
+static int __pyx_tp_traverse_11sat_toolkit_7formula___pyx_scope_struct____iter__(PyObject *o, visitproc v, void *a) {
+  int e;
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *p = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__ *)o;
+  if (p->__pyx_v_self) {
+    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
+  }
+  return 0;
+}
+
+static PyTypeObject __pyx_type_11sat_toolkit_7formula___pyx_scope_struct____iter__ = {
+  PyVarObject_HEAD_INIT(0, 0)
+  "sat_toolkit.formula.__pyx_scope_struct____iter__", /*tp_name*/
+  sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct____iter__), /*tp_basicsize*/
+  0, /*tp_itemsize*/
+  __pyx_tp_dealloc_11sat_toolkit_7formula___pyx_scope_struct____iter__, /*tp_dealloc*/
+  #if PY_VERSION_HEX < 0x030800b4
+  0, /*tp_print*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b4
+  0, /*tp_vectorcall_offset*/
+  #endif
+  0, /*tp_getattr*/
+  0, /*tp_setattr*/
+  #if PY_MAJOR_VERSION < 3
+  0, /*tp_compare*/
+  #endif
+  #if PY_MAJOR_VERSION >= 3
+  0, /*tp_as_async*/
+  #endif
+  0, /*tp_repr*/
+  0, /*tp_as_number*/
+  0, /*tp_as_sequence*/
+  0, /*tp_as_mapping*/
+  0, /*tp_hash*/
+  0, /*tp_call*/
+  0, /*tp_str*/
+  0, /*tp_getattro*/
+  0, /*tp_setattro*/
+  0, /*tp_as_buffer*/
+  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
+  0, /*tp_doc*/
+  __pyx_tp_traverse_11sat_toolkit_7formula___pyx_scope_struct____iter__, /*tp_traverse*/
+  0, /*tp_clear*/
+  0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
-  __pyx_methods_11sat_toolkit_9_cnf_util_Truthtable, /*tp_methods*/
+  0, /*tp_methods*/
   0, /*tp_members*/
-  __pyx_getsets_11sat_toolkit_9_cnf_util_Truthtable, /*tp_getset*/
+  0, /*tp_getset*/
   0, /*tp_base*/
   0, /*tp_dict*/
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   0, /*tp_dictoffset*/
-  __pyx_pw_11sat_toolkit_9_cnf_util_10Truthtable_1__init__, /*tp_init*/
+  0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_11sat_toolkit_9_cnf_util_Truthtable, /*tp_new*/
+  __pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct____iter__, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -31196,62 +36453,62 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *__pyx_freelist_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__[8];
-static int __pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ = 0;
+static struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *__pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__[8];
+static int __pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ = 0;
 
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__)))) {
-    o = (PyObject*)__pyx_freelist_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__[--__pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__];
-    memset(o, 0, sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__)))) {
+    o = (PyObject*)__pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__[--__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__];
+    memset(o, 0, sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   return o;
 }
 
-static void __pyx_tp_dealloc_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__(PyObject *o) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *)o;
+static void __pyx_tp_dealloc_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__(PyObject *o) {
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *p = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *)o;
   PyObject_GC_UnTrack(o);
   Py_CLEAR(p->__pyx_v_self);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__)))) {
-    __pyx_freelist_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__[__pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__++] = ((struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__)))) {
+    __pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__[__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__++] = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ *)o;
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *p = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ *)o;
   if (p->__pyx_v_self) {
     e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
   }
   return 0;
 }
 
-static PyTypeObject __pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ = {
+static PyTypeObject __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util.__pyx_scope_struct____iter__", /*tp_name*/
-  sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__), /*tp_basicsize*/
+  "sat_toolkit.formula.__pyx_scope_struct_1___reversed__", /*tp_name*/
+  sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__, /*tp_dealloc*/
+  __pyx_tp_dealloc_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -31270,15 +36527,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__, /*tp_traverse*/
+  __pyx_tp_traverse_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -31286,15 +36543,15 @@
   0, /*tp_base*/
   0, /*tp_dict*/
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   0, /*tp_dictoffset*/
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__, /*tp_new*/
+  __pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -31305,62 +36562,62 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
-static struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *__pyx_freelist_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__[8];
-static int __pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ = 0;
+static struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *__pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_2___iter__[8];
+static int __pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ = 0;
 
-static PyObject *__pyx_tp_new_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_2___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__)))) {
-    o = (PyObject*)__pyx_freelist_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__[--__pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__];
-    memset(o, 0, sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__)))) {
+    o = (PyObject*)__pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_2___iter__[--__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_2___iter__];
+    memset(o, 0, sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   return o;
 }
 
-static void __pyx_tp_dealloc_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__(PyObject *o) {
-  struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *)o;
+static void __pyx_tp_dealloc_11sat_toolkit_7formula___pyx_scope_struct_2___iter__(PyObject *o) {
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *p = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *)o;
   PyObject_GC_UnTrack(o);
   Py_CLEAR(p->__pyx_v_self);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__)))) {
-    __pyx_freelist_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__[__pyx_freecount_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__++] = ((struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__)))) {
+    __pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_2___iter__[__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_2___iter__++] = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_11sat_toolkit_7formula___pyx_scope_struct_2___iter__(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *p = (struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ *)o;
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *p = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ *)o;
   if (p->__pyx_v_self) {
     e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
   }
   return 0;
 }
 
-static PyTypeObject __pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ = {
+static PyTypeObject __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util.__pyx_scope_struct_1___iter__", /*tp_name*/
-  sizeof(struct __pyx_obj_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__), /*tp_basicsize*/
+  "sat_toolkit.formula.__pyx_scope_struct_2___iter__", /*tp_name*/
+  sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_2___iter__), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__, /*tp_dealloc*/
+  __pyx_tp_dealloc_11sat_toolkit_7formula___pyx_scope_struct_2___iter__, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -31379,15 +36636,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__, /*tp_traverse*/
+  __pyx_tp_traverse_11sat_toolkit_7formula___pyx_scope_struct_2___iter__, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -31395,15 +36652,15 @@
   0, /*tp_base*/
   0, /*tp_dict*/
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   0, /*tp_dictoffset*/
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__, /*tp_new*/
+  __pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_2___iter__, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -31414,15 +36671,124 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
+  0, /*tp_pypy_flags*/
+  #endif
+};
+
+static struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *__pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__[8];
+static int __pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ = 0;
+
+static PyObject *__pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  PyObject *o;
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__)))) {
+    o = (PyObject*)__pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__[--__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__];
+    memset(o, 0, sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__));
+    (void) PyObject_INIT(o, t);
+    PyObject_GC_Track(o);
+  } else {
+    o = (*t->tp_alloc)(t, 0);
+    if (unlikely(!o)) return 0;
+  }
+  return o;
+}
+
+static void __pyx_tp_dealloc_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__(PyObject *o) {
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *p = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *)o;
+  PyObject_GC_UnTrack(o);
+  Py_CLEAR(p->__pyx_v_self);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__)))) {
+    __pyx_freelist_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__[__pyx_freecount_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__++] = ((struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *)o);
+  } else {
+    (*Py_TYPE(o)->tp_free)(o);
+  }
+}
+
+static int __pyx_tp_traverse_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__(PyObject *o, visitproc v, void *a) {
+  int e;
+  struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *p = (struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ *)o;
+  if (p->__pyx_v_self) {
+    e = (*v)(((PyObject *)p->__pyx_v_self), a); if (e) return e;
+  }
+  return 0;
+}
+
+static PyTypeObject __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ = {
+  PyVarObject_HEAD_INIT(0, 0)
+  "sat_toolkit.formula.__pyx_scope_struct_3___reversed__", /*tp_name*/
+  sizeof(struct __pyx_obj_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__), /*tp_basicsize*/
+  0, /*tp_itemsize*/
+  __pyx_tp_dealloc_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__, /*tp_dealloc*/
+  #if PY_VERSION_HEX < 0x030800b4
+  0, /*tp_print*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b4
+  0, /*tp_vectorcall_offset*/
+  #endif
+  0, /*tp_getattr*/
+  0, /*tp_setattr*/
+  #if PY_MAJOR_VERSION < 3
+  0, /*tp_compare*/
+  #endif
+  #if PY_MAJOR_VERSION >= 3
+  0, /*tp_as_async*/
+  #endif
+  0, /*tp_repr*/
+  0, /*tp_as_number*/
+  0, /*tp_as_sequence*/
+  0, /*tp_as_mapping*/
+  0, /*tp_hash*/
+  0, /*tp_call*/
+  0, /*tp_str*/
+  0, /*tp_getattro*/
+  0, /*tp_setattro*/
+  0, /*tp_as_buffer*/
+  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
+  0, /*tp_doc*/
+  __pyx_tp_traverse_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__, /*tp_traverse*/
+  0, /*tp_clear*/
+  0, /*tp_richcompare*/
+  0, /*tp_weaklistoffset*/
+  0, /*tp_iter*/
+  0, /*tp_iternext*/
+  0, /*tp_methods*/
+  0, /*tp_members*/
+  0, /*tp_getset*/
+  0, /*tp_base*/
+  0, /*tp_dict*/
+  0, /*tp_descr_get*/
+  0, /*tp_descr_set*/
+  0, /*tp_dictoffset*/
+  0, /*tp_init*/
+  0, /*tp_alloc*/
+  __pyx_tp_new_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__, /*tp_new*/
+  0, /*tp_free*/
+  0, /*tp_is_gc*/
+  0, /*tp_bases*/
+  0, /*tp_mro*/
+  0, /*tp_cache*/
+  0, /*tp_subclasses*/
+  0, /*tp_weaklist*/
+  0, /*tp_del*/
+  0, /*tp_version_tag*/
+  #if PY_VERSION_HEX >= 0x030400a1
+  0, /*tp_finalize*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
+  0, /*tp_vectorcall*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
+  0, /*tp_print*/
+  #endif
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_array __pyx_vtable_array;
 
 static PyObject *__pyx_tp_new_array(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_array_obj *p;
@@ -31443,15 +36809,15 @@
   Py_DECREF(o); o = 0;
   return NULL;
 }
 
 static void __pyx_tp_dealloc_array(PyObject *o) {
   struct __pyx_array_obj *p = (struct __pyx_array_obj *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !__Pyx_PyObject_GC_IsFinalized(o))) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   {
     PyObject *etype, *eval, *etb;
     PyErr_Fetch(&etype, &eval, &etb);
     __Pyx_SET_REFCNT(o, Py_REFCNT(o) + 1);
@@ -31541,15 +36907,15 @@
   #endif
   __pyx_array_getbuffer, /*bf_getbuffer*/
   0, /*bf_releasebuffer*/
 };
 
 static PyTypeObject __pyx_type___pyx_array = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util.array", /*tp_name*/
+  "sat_toolkit.formula.array", /*tp_name*/
   sizeof(struct __pyx_array_obj), /*tp_basicsize*/
   0, /*tp_itemsize*/
   __pyx_tp_dealloc_array, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
@@ -31606,15 +36972,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_MemviewEnum_obj *p;
   PyObject *o;
@@ -31628,15 +36994,15 @@
   p->name = Py_None; Py_INCREF(Py_None);
   return o;
 }
 
 static void __pyx_tp_dealloc_Enum(PyObject *o) {
   struct __pyx_MemviewEnum_obj *p = (struct __pyx_MemviewEnum_obj *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !__Pyx_PyObject_GC_IsFinalized(o)) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   PyObject_GC_UnTrack(o);
   Py_CLEAR(p->name);
   (*Py_TYPE(o)->tp_free)(o);
 }
@@ -31663,15 +37029,15 @@
   {"__reduce_cython__", (PyCFunction)__pyx_pw___pyx_MemviewEnum_1__reduce_cython__, METH_NOARGS, 0},
   {"__setstate_cython__", (PyCFunction)__pyx_pw___pyx_MemviewEnum_3__setstate_cython__, METH_O, 0},
   {0, 0, 0, 0}
 };
 
 static PyTypeObject __pyx_type___pyx_MemviewEnum = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util.Enum", /*tp_name*/
+  "sat_toolkit.formula.Enum", /*tp_name*/
   sizeof(struct __pyx_MemviewEnum_obj), /*tp_basicsize*/
   0, /*tp_itemsize*/
   __pyx_tp_dealloc_Enum, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
@@ -31728,15 +37094,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_memoryview __pyx_vtable_memoryview;
 
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryview_obj *p;
@@ -31759,15 +37125,15 @@
   Py_DECREF(o); o = 0;
   return NULL;
 }
 
 static void __pyx_tp_dealloc_memoryview(PyObject *o) {
   struct __pyx_memoryview_obj *p = (struct __pyx_memoryview_obj *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !__Pyx_PyObject_GC_IsFinalized(o)) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   PyObject_GC_UnTrack(o);
   {
     PyObject *etype, *eval, *etb;
     PyErr_Fetch(&etype, &eval, &etb);
@@ -31927,15 +37293,15 @@
   #endif
   __pyx_memoryview_getbuffer, /*bf_getbuffer*/
   0, /*bf_releasebuffer*/
 };
 
 static PyTypeObject __pyx_type___pyx_memoryview = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util.memoryview", /*tp_name*/
+  "sat_toolkit.formula.memoryview", /*tp_name*/
   sizeof(struct __pyx_memoryview_obj), /*tp_basicsize*/
   0, /*tp_itemsize*/
   __pyx_tp_dealloc_memoryview, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
@@ -31992,15 +37358,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct__memoryviewslice __pyx_vtable__memoryviewslice;
 
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryviewslice_obj *p;
@@ -32012,15 +37378,15 @@
   p->from_slice.memview = NULL;
   return o;
 }
 
 static void __pyx_tp_dealloc__memoryviewslice(PyObject *o) {
   struct __pyx_memoryviewslice_obj *p = (struct __pyx_memoryviewslice_obj *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !__Pyx_PyObject_GC_IsFinalized(o)) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   PyObject_GC_UnTrack(o);
   {
     PyObject *etype, *eval, *etb;
     PyErr_Fetch(&etype, &eval, &etb);
@@ -32068,15 +37434,15 @@
 static struct PyGetSetDef __pyx_getsets__memoryviewslice[] = {
   {(char *)"base", __pyx_getprop___pyx_memoryviewslice_base, 0, (char *)0, 0},
   {0, 0, 0, 0, 0}
 };
 
 static PyTypeObject __pyx_type___pyx_memoryviewslice = {
   PyVarObject_HEAD_INIT(0, 0)
-  "sat_toolkit._cnf_util._memoryviewslice", /*tp_name*/
+  "sat_toolkit.formula._memoryviewslice", /*tp_name*/
   sizeof(struct __pyx_memoryviewslice_obj), /*tp_basicsize*/
   0, /*tp_itemsize*/
   __pyx_tp_dealloc__memoryviewslice, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
@@ -32141,15 +37507,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
@@ -32180,35 +37546,42 @@
     "__pyx_ctuple_int",
     "__pyx_ctuple_int__and_Py_ssize_t",
     "__pyx_ctuple_int__and_Py_ssize_t__and_Py_ssize_t",
     "__pyx_ctuple_int__and_Py_ssize_t__and_Py_ssize_t_struct",
     "__pyx_ctuple_int__and_Py_ssize_t_struct",
     "__pyx_ctuple_int_struct",
     "__pyx_ctuple_long",
+    "__pyx_ctuple_long__and_long",
     "__pyx_ctuple_long__and_long__and_long",
     "__pyx_ctuple_long__and_long__and_long_struct",
+    "__pyx_ctuple_long__and_long_struct",
     "__pyx_ctuple_long__and_size_t",
     "__pyx_ctuple_long__and_size_t_struct",
     "__pyx_ctuple_long_struct",
     "__pyx_ctuple_size_t",
+    "__pyx_ctuple_size_t__and_size_t",
+    "__pyx_ctuple_size_t__and_size_t_struct",
     "__pyx_ctuple_size_t_struct",
     "__pyx_ctuple_std__in_vector__lAngint__rAng",
     "__pyx_ctuple_std__in_vector__lAngint__rAng__in_size_type",
     "__pyx_ctuple_std__in_vector__lAngint__rAng__in_size_type_struct",
     "__pyx_ctuple_std__in_vector__lAngint__rAng_struct",
     "__pyx_ctuple_std__in_vector__lAngsize_t__rAng__in_size_type",
     "__pyx_ctuple_std__in_vector__lAngsize_t__rAng__in_size_type_struct",
     "__pyx_ctuple_unsigned__space_int",
     "__pyx_ctuple_unsigned__space_int_struct",
     "__pyx_memoryview",
-    "__pyx_scope_struct_1___iter__",
+    "__pyx_scope_struct_1___reversed__",
+    "__pyx_scope_struct_2___iter__",
+    "__pyx_scope_struct_3___reversed__",
     "__pyx_scope_struct____iter__",
     "__pyx_typeinfo_string",
     "_memoryviewslice",
     "array",
+    "cvarray",
     "fmt_buf",
     "int16_t",
     "int32_t",
     "int64_t",
     "int8_t",
     "memoryview",
     "uint16_t",
@@ -32264,15 +37637,15 @@
     strided = o;
   }
   else {
     if (PyObject_SetAttr(__pyx_m, py_name, o) < 0) goto bad;
   }
   return 0;
   __pyx_L2_error:;
-  __Pyx_AddTraceback("sat_toolkit._cnf_util", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("sat_toolkit.formula", __pyx_clineno, __pyx_lineno, __pyx_filename);
   bad:
   return -1;
 }
 
 static int
 __Pyx_import_all_from(PyObject *locals, PyObject *v)
 {
@@ -32379,25 +37752,25 @@
 }
 
 
 
 #if PY_MAJOR_VERSION >= 3
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
-static int __pyx_pymod_exec__cnf_util(PyObject* module); /*proto*/
+static int __pyx_pymod_exec_formula(PyObject* module); /*proto*/
 static PyModuleDef_Slot __pyx_moduledef_slots[] = {
   {Py_mod_create, (void*)__pyx_pymod_create},
-  {Py_mod_exec, (void*)__pyx_pymod_exec__cnf_util},
+  {Py_mod_exec, (void*)__pyx_pymod_exec_formula},
   {0, NULL}
 };
 #endif
 
 static struct PyModuleDef __pyx_moduledef = {
     PyModuleDef_HEAD_INIT,
-    "_cnf_util",
+    "formula",
     0, /* m_doc */
   #if CYTHON_PEP489_MULTI_PHASE_INIT
     0, /* m_size */
   #else
     -1, /* m_size */
   #endif
     __pyx_methods /* m_methods */,
@@ -32425,24 +37798,28 @@
   {&__pyx_kp_u_0, __pyx_k_0, sizeof(__pyx_k_0), 0, 1, 0, 0},
   {&__pyx_kp_u_0_2, __pyx_k_0_2, sizeof(__pyx_k_0_2), 0, 1, 0, 0},
   {&__pyx_kp_u_1, __pyx_k_1, sizeof(__pyx_k_1), 0, 1, 0, 0},
   {&__pyx_n_s_ASCII, __pyx_k_ASCII, sizeof(__pyx_k_ASCII), 0, 0, 1, 1},
   {&__pyx_kp_s_Buffer_view_does_not_expose_stri, __pyx_k_Buffer_view_does_not_expose_stri, sizeof(__pyx_k_Buffer_view_does_not_expose_stri), 0, 0, 1, 0},
   {&__pyx_n_s_BytesIO, __pyx_k_BytesIO, sizeof(__pyx_k_BytesIO), 0, 0, 1, 1},
   {&__pyx_n_s_CNF, __pyx_k_CNF, sizeof(__pyx_k_CNF), 0, 0, 1, 1},
+  {&__pyx_n_u_CNF, __pyx_k_CNF, sizeof(__pyx_k_CNF), 0, 1, 0, 1},
   {&__pyx_n_s_CNF___iter, __pyx_k_CNF___iter, sizeof(__pyx_k_CNF___iter), 0, 0, 1, 1},
+  {&__pyx_n_s_CNF___reversed, __pyx_k_CNF___reversed, sizeof(__pyx_k_CNF___reversed), 0, 0, 1, 1},
   {&__pyx_kp_u_CNF_over, __pyx_k_CNF_over, sizeof(__pyx_k_CNF_over), 0, 1, 0, 0},
   {&__pyx_n_s_CalledProcessError, __pyx_k_CalledProcessError, sizeof(__pyx_k_CalledProcessError), 0, 0, 1, 1},
   {&__pyx_kp_s_Can_only_create_a_buffer_that_is, __pyx_k_Can_only_create_a_buffer_that_is, sizeof(__pyx_k_Can_only_create_a_buffer_that_is), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_assign_to_read_only_memor, __pyx_k_Cannot_assign_to_read_only_memor, sizeof(__pyx_k_Cannot_assign_to_read_only_memor), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_create_writable_memory_vi, __pyx_k_Cannot_create_writable_memory_vi, sizeof(__pyx_k_Cannot_create_writable_memory_vi), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_index_with_type_s, __pyx_k_Cannot_index_with_type_s, sizeof(__pyx_k_Cannot_index_with_type_s), 0, 0, 1, 0},
   {&__pyx_kp_u_Clause, __pyx_k_Clause, sizeof(__pyx_k_Clause), 0, 1, 0, 0},
   {&__pyx_n_s_Clause_2, __pyx_k_Clause_2, sizeof(__pyx_k_Clause_2), 0, 0, 1, 1},
+  {&__pyx_n_u_Clause_2, __pyx_k_Clause_2, sizeof(__pyx_k_Clause_2), 0, 1, 0, 1},
   {&__pyx_n_s_Clause___iter, __pyx_k_Clause___iter, sizeof(__pyx_k_Clause___iter), 0, 0, 1, 1},
+  {&__pyx_n_s_Clause___reversed, __pyx_k_Clause___reversed, sizeof(__pyx_k_Clause___reversed), 0, 0, 1, 1},
   {&__pyx_kp_u_Dverify, __pyx_k_Dverify, sizeof(__pyx_k_Dverify), 0, 1, 0, 0},
   {&__pyx_n_s_Ellipsis, __pyx_k_Ellipsis, sizeof(__pyx_k_Ellipsis), 0, 0, 1, 1},
   {&__pyx_kp_s_Empty_shape_tuple_for_cython_arr, __pyx_k_Empty_shape_tuple_for_cython_arr, sizeof(__pyx_k_Empty_shape_tuple_for_cython_arr), 0, 0, 1, 0},
   {&__pyx_n_s_INIT_INDEX_SET, __pyx_k_INIT_INDEX_SET, sizeof(__pyx_k_INIT_INDEX_SET), 0, 0, 1, 1},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0_2, __pyx_k_Incompatible_checksums_0x_x_vs_0_2, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0_2), 0, 0, 1, 0},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0_3, __pyx_k_Incompatible_checksums_0x_x_vs_0_3, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0_3), 0, 0, 1, 0},
@@ -32457,138 +37834,168 @@
   {&__pyx_kp_u_None, __pyx_k_None, sizeof(__pyx_k_None), 0, 1, 0, 0},
   {&__pyx_kp_u_O, __pyx_k_O, sizeof(__pyx_k_O), 0, 1, 0, 0},
   {&__pyx_n_b_O_2, __pyx_k_O_2, sizeof(__pyx_k_O_2), 0, 0, 0, 1},
   {&__pyx_kp_s_Out_of_bounds_on_buffer_access_a, __pyx_k_Out_of_bounds_on_buffer_access_a, sizeof(__pyx_k_Out_of_bounds_on_buffer_access_a), 0, 0, 1, 0},
   {&__pyx_n_s_PIPE, __pyx_k_PIPE, sizeof(__pyx_k_PIPE), 0, 0, 1, 1},
   {&__pyx_n_s_PickleError, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
   {&__pyx_n_s_Popen, __pyx_k_Popen, sizeof(__pyx_k_Popen), 0, 0, 1, 1},
+  {&__pyx_n_s_Sequence, __pyx_k_Sequence, sizeof(__pyx_k_Sequence), 0, 0, 1, 1},
   {&__pyx_n_s_StringIO, __pyx_k_StringIO, sizeof(__pyx_k_StringIO), 0, 0, 1, 1},
   {&__pyx_kp_u_T, __pyx_k_T, sizeof(__pyx_k_T), 0, 1, 0, 0},
+  {&__pyx_n_s_TYPE_CHECKING, __pyx_k_TYPE_CHECKING, sizeof(__pyx_k_TYPE_CHECKING), 0, 0, 1, 1},
   {&__pyx_kp_b_T_2, __pyx_k_T_2, sizeof(__pyx_k_T_2), 0, 0, 0, 0},
   {&__pyx_n_u_Truthtable, __pyx_k_Truthtable, sizeof(__pyx_k_Truthtable), 0, 1, 0, 1},
   {&__pyx_n_s_Truthtable_2, __pyx_k_Truthtable_2, sizeof(__pyx_k_Truthtable_2), 0, 0, 1, 1},
+  {&__pyx_n_u_Truthtable_2, __pyx_k_Truthtable_2, sizeof(__pyx_k_Truthtable_2), 0, 1, 0, 1},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
   {&__pyx_kp_s_Unable_to_convert_item_to_object, __pyx_k_Unable_to_convert_item_to_object, sizeof(__pyx_k_Unable_to_convert_item_to_object), 0, 0, 1, 0},
   {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
   {&__pyx_n_s_View_MemoryView, __pyx_k_View_MemoryView, sizeof(__pyx_k_View_MemoryView), 0, 0, 1, 1},
-  {&__pyx_kp_u__13, __pyx_k__13, sizeof(__pyx_k__13), 0, 1, 0, 0},
-  {&__pyx_kp_u__28, __pyx_k__28, sizeof(__pyx_k__28), 0, 1, 0, 0},
+  {&__pyx_kp_u__17, __pyx_k__17, sizeof(__pyx_k__17), 0, 1, 0, 0},
   {&__pyx_kp_u__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 1, 0, 0},
-  {&__pyx_kp_b__52, __pyx_k__52, sizeof(__pyx_k__52), 0, 0, 0, 0},
-  {&__pyx_kp_b__53, __pyx_k__53, sizeof(__pyx_k__53), 0, 0, 0, 0},
-  {&__pyx_kp_b__54, __pyx_k__54, sizeof(__pyx_k__54), 0, 0, 0, 0},
-  {&__pyx_kp_b__55, __pyx_k__55, sizeof(__pyx_k__55), 0, 0, 0, 0},
-  {&__pyx_kp_u__56, __pyx_k__56, sizeof(__pyx_k__56), 0, 1, 0, 0},
-  {&__pyx_n_s__57, __pyx_k__57, sizeof(__pyx_k__57), 0, 0, 1, 1},
-  {&__pyx_kp_u__6, __pyx_k__6, sizeof(__pyx_k__6), 0, 1, 0, 0},
-  {&__pyx_n_s__60, __pyx_k__60, sizeof(__pyx_k__60), 0, 0, 1, 1},
-  {&__pyx_kp_u__8, __pyx_k__8, sizeof(__pyx_k__8), 0, 1, 0, 0},
+  {&__pyx_kp_u__35, __pyx_k__35, sizeof(__pyx_k__35), 0, 1, 0, 0},
+  {&__pyx_kp_u__5, __pyx_k__5, sizeof(__pyx_k__5), 0, 1, 0, 0},
+  {&__pyx_kp_b__58, __pyx_k__58, sizeof(__pyx_k__58), 0, 0, 0, 0},
+  {&__pyx_kp_b__59, __pyx_k__59, sizeof(__pyx_k__59), 0, 0, 0, 0},
+  {&__pyx_kp_b__60, __pyx_k__60, sizeof(__pyx_k__60), 0, 0, 0, 0},
+  {&__pyx_kp_b__61, __pyx_k__61, sizeof(__pyx_k__61), 0, 0, 0, 0},
+  {&__pyx_kp_u__62, __pyx_k__62, sizeof(__pyx_k__62), 0, 1, 0, 0},
+  {&__pyx_n_s__63, __pyx_k__63, sizeof(__pyx_k__63), 0, 0, 1, 1},
+  {&__pyx_n_s__66, __pyx_k__66, sizeof(__pyx_k__66), 0, 0, 1, 1},
+  {&__pyx_kp_u__7, __pyx_k__7, sizeof(__pyx_k__7), 0, 1, 0, 0},
   {&__pyx_n_s_a, __pyx_k_a, sizeof(__pyx_k_a), 0, 0, 1, 1},
+  {&__pyx_n_s_abc, __pyx_k_abc, sizeof(__pyx_k_abc), 0, 0, 1, 1},
   {&__pyx_n_s_add_clause, __pyx_k_add_clause, sizeof(__pyx_k_add_clause), 0, 0, 1, 1},
+  {&__pyx_n_s_add_clauses, __pyx_k_add_clauses, sizeof(__pyx_k_add_clauses), 0, 0, 1, 1},
   {&__pyx_n_s_all, __pyx_k_all, sizeof(__pyx_k_all), 0, 0, 1, 1},
+  {&__pyx_n_s_all_2, __pyx_k_all_2, sizeof(__pyx_k_all_2), 0, 0, 1, 1},
+  {&__pyx_kp_u_all_elements_in_solution_must_be, __pyx_k_all_elements_in_solution_must_be, sizeof(__pyx_k_all_elements_in_solution_must_be), 0, 1, 0, 0},
+  {&__pyx_kp_u_all_indices_must_be_nonzero, __pyx_k_all_indices_must_be_nonzero, sizeof(__pyx_k_all_indices_must_be_nonzero), 0, 1, 0, 0},
   {&__pyx_n_s_allocate_buffer, __pyx_k_allocate_buffer, sizeof(__pyx_k_allocate_buffer), 0, 0, 1, 1},
   {&__pyx_n_s_any, __pyx_k_any, sizeof(__pyx_k_any), 0, 0, 1, 1},
   {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
+  {&__pyx_n_s_arg, __pyx_k_arg, sizeof(__pyx_k_arg), 0, 0, 1, 1},
   {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
   {&__pyx_n_s_array, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
   {&__pyx_n_s_axis, __pyx_k_axis, sizeof(__pyx_k_axis), 0, 0, 1, 1},
   {&__pyx_n_u_b, __pyx_k_b, sizeof(__pyx_k_b), 0, 1, 0, 1},
   {&__pyx_n_s_base, __pyx_k_base, sizeof(__pyx_k_base), 0, 0, 1, 1},
   {&__pyx_n_s_bit_length, __pyx_k_bit_length, sizeof(__pyx_k_bit_length), 0, 0, 1, 1},
   {&__pyx_n_s_bits, __pyx_k_bits, sizeof(__pyx_k_bits), 0, 0, 1, 1},
   {&__pyx_n_s_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 0, 1, 1},
   {&__pyx_n_u_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 1, 0, 1},
   {&__pyx_kp_u_cannot_alter_while_referenced_by, __pyx_k_cannot_alter_while_referenced_by, sizeof(__pyx_k_cannot_alter_while_referenced_by), 0, 1, 0, 0},
+  {&__pyx_kp_u_cannot_find_all_solutions_for_CN, __pyx_k_cannot_find_all_solutions_for_CN, sizeof(__pyx_k_cannot_find_all_solutions_for_CN), 0, 1, 0, 0},
+  {&__pyx_kp_u_cannot_provide_a_writable_buffer, __pyx_k_cannot_provide_a_writable_buffer, sizeof(__pyx_k_cannot_provide_a_writable_buffer), 0, 1, 0, 0},
   {&__pyx_kp_u_cannot_use_0_as_part_of_clause, __pyx_k_cannot_use_0_as_part_of_clause, sizeof(__pyx_k_cannot_use_0_as_part_of_clause), 0, 1, 0, 0},
   {&__pyx_kp_u_cannot_use_0_in_clause, __pyx_k_cannot_use_0_in_clause, sizeof(__pyx_k_cannot_use_0_in_clause), 0, 1, 0, 0},
   {&__pyx_n_s_class, __pyx_k_class, sizeof(__pyx_k_class), 0, 0, 1, 1},
   {&__pyx_n_s_clause, __pyx_k_clause, sizeof(__pyx_k_clause), 0, 0, 1, 1},
   {&__pyx_n_s_clauses, __pyx_k_clauses, sizeof(__pyx_k_clauses), 0, 0, 1, 1},
   {&__pyx_kp_u_clauses_2, __pyx_k_clauses_2, sizeof(__pyx_k_clauses_2), 0, 1, 0, 0},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
   {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
   {&__pyx_n_u_cnf, __pyx_k_cnf, sizeof(__pyx_k_cnf), 0, 1, 0, 1},
+  {&__pyx_n_s_collections, __pyx_k_collections, sizeof(__pyx_k_collections), 0, 0, 1, 1},
   {&__pyx_n_s_concatenate, __pyx_k_concatenate, sizeof(__pyx_k_concatenate), 0, 0, 1, 1},
   {&__pyx_kp_s_contiguous_and_direct, __pyx_k_contiguous_and_direct, sizeof(__pyx_k_contiguous_and_direct), 0, 0, 1, 0},
   {&__pyx_kp_s_contiguous_and_indirect, __pyx_k_contiguous_and_indirect, sizeof(__pyx_k_contiguous_and_indirect), 0, 0, 1, 0},
+  {&__pyx_n_s_copy, __pyx_k_copy, sizeof(__pyx_k_copy), 0, 0, 1, 1},
   {&__pyx_n_s_count_nonzero, __pyx_k_count_nonzero, sizeof(__pyx_k_count_nonzero), 0, 0, 1, 1},
+  {&__pyx_n_s_create_all_equal, __pyx_k_create_all_equal, sizeof(__pyx_k_create_all_equal), 0, 0, 1, 1},
+  {&__pyx_n_s_create_all_zero, __pyx_k_create_all_zero, sizeof(__pyx_k_create_all_zero), 0, 0, 1, 1},
+  {&__pyx_n_s_create_xor, __pyx_k_create_xor, sizeof(__pyx_k_create_xor), 0, 0, 1, 1},
+  {&__pyx_kp_u_create_xor_only_supports_positiv, __pyx_k_create_xor_only_supports_positiv, sizeof(__pyx_k_create_xor_only_supports_positiv), 0, 1, 0, 0},
   {&__pyx_n_s_dataclass, __pyx_k_dataclass, sizeof(__pyx_k_dataclass), 0, 0, 1, 1},
   {&__pyx_n_s_dataclasses, __pyx_k_dataclasses, sizeof(__pyx_k_dataclasses), 0, 0, 1, 1},
   {&__pyx_n_s_dc_indices, __pyx_k_dc_indices, sizeof(__pyx_k_dc_indices), 0, 0, 1, 1},
   {&__pyx_n_s_dc_lut, __pyx_k_dc_lut, sizeof(__pyx_k_dc_lut), 0, 0, 1, 1},
   {&__pyx_n_s_dc_set, __pyx_k_dc_set, sizeof(__pyx_k_dc_set), 0, 0, 1, 1},
   {&__pyx_n_s_dict, __pyx_k_dict, sizeof(__pyx_k_dict), 0, 0, 1, 1},
   {&__pyx_n_s_dimacs, __pyx_k_dimacs, sizeof(__pyx_k_dimacs), 0, 0, 1, 1},
   {&__pyx_kp_u_dimacs_2, __pyx_k_dimacs_2, sizeof(__pyx_k_dimacs_2), 0, 1, 0, 0},
   {&__pyx_n_u_dnf, __pyx_k_dnf, sizeof(__pyx_k_dnf), 0, 1, 0, 1},
   {&__pyx_n_s_dtype, __pyx_k_dtype, sizeof(__pyx_k_dtype), 0, 0, 1, 1},
   {&__pyx_n_s_dtype_is_object, __pyx_k_dtype_is_object, sizeof(__pyx_k_dtype_is_object), 0, 0, 1, 1},
+  {&__pyx_n_s_empty, __pyx_k_empty, sizeof(__pyx_k_empty), 0, 0, 1, 1},
   {&__pyx_n_s_encode, __pyx_k_encode, sizeof(__pyx_k_encode), 0, 0, 1, 1},
-  {&__pyx_kp_u_end, __pyx_k_end, sizeof(__pyx_k_end), 0, 1, 0, 0},
+  {&__pyx_n_s_end, __pyx_k_end, sizeof(__pyx_k_end), 0, 0, 1, 1},
+  {&__pyx_kp_u_end_2, __pyx_k_end_2, sizeof(__pyx_k_end_2), 0, 1, 0, 0},
   {&__pyx_n_s_enter, __pyx_k_enter, sizeof(__pyx_k_enter), 0, 0, 1, 1},
   {&__pyx_n_s_enumerate, __pyx_k_enumerate, sizeof(__pyx_k_enumerate), 0, 0, 1, 1},
   {&__pyx_n_s_error, __pyx_k_error, sizeof(__pyx_k_error), 0, 0, 1, 1},
   {&__pyx_n_s_espresso, __pyx_k_espresso, sizeof(__pyx_k_espresso), 0, 0, 1, 1},
   {&__pyx_n_u_espresso, __pyx_k_espresso, sizeof(__pyx_k_espresso), 0, 1, 0, 1},
   {&__pyx_n_s_espresso_args, __pyx_k_espresso_args, sizeof(__pyx_k_espresso_args), 0, 0, 1, 1},
   {&__pyx_n_s_exit, __pyx_k_exit, sizeof(__pyx_k_exit), 0, 0, 1, 1},
   {&__pyx_kp_u_expected_1, __pyx_k_expected_1, sizeof(__pyx_k_expected_1), 0, 1, 0, 0},
   {&__pyx_kp_u_explicitly_given_nvars_too_small, __pyx_k_explicitly_given_nvars_too_small, sizeof(__pyx_k_explicitly_given_nvars_too_small), 0, 1, 0, 0},
   {&__pyx_n_s_extra_args, __pyx_k_extra_args, sizeof(__pyx_k_extra_args), 0, 0, 1, 1},
   {&__pyx_n_s_f, __pyx_k_f, sizeof(__pyx_k_f), 0, 0, 1, 1},
-  {&__pyx_n_s_false_op, __pyx_k_false_op, sizeof(__pyx_k_false_op), 0, 0, 1, 1},
   {&__pyx_kp_u_file_format_error, __pyx_k_file_format_error, sizeof(__pyx_k_file_format_error), 0, 1, 0, 0},
   {&__pyx_kp_u_file_format_error_in_line, __pyx_k_file_format_error_in_line, sizeof(__pyx_k_file_format_error_in_line), 0, 1, 0, 0},
   {&__pyx_n_s_flags, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 0, 1, 1},
   {&__pyx_n_s_format, __pyx_k_format, sizeof(__pyx_k_format), 0, 0, 1, 1},
   {&__pyx_n_s_fortran, __pyx_k_fortran, sizeof(__pyx_k_fortran), 0, 0, 1, 1},
   {&__pyx_n_u_fortran, __pyx_k_fortran, sizeof(__pyx_k_fortran), 0, 1, 0, 1},
   {&__pyx_n_s_from_dimacs, __pyx_k_from_dimacs, sizeof(__pyx_k_from_dimacs), 0, 0, 1, 1},
   {&__pyx_n_s_from_espresso, __pyx_k_from_espresso, sizeof(__pyx_k_from_espresso), 0, 0, 1, 1},
   {&__pyx_n_s_from_indices, __pyx_k_from_indices, sizeof(__pyx_k_from_indices), 0, 0, 1, 1},
   {&__pyx_n_s_from_lut, __pyx_k_from_lut, sizeof(__pyx_k_from_lut), 0, 0, 1, 1},
+  {&__pyx_n_s_frombuffer, __pyx_k_frombuffer, sizeof(__pyx_k_frombuffer), 0, 0, 1, 1},
   {&__pyx_n_s_fromstring, __pyx_k_fromstring, sizeof(__pyx_k_fromstring), 0, 0, 1, 1},
   {&__pyx_n_s_getstate, __pyx_k_getstate, sizeof(__pyx_k_getstate), 0, 0, 1, 1},
   {&__pyx_n_s_getvalue, __pyx_k_getvalue, sizeof(__pyx_k_getvalue), 0, 0, 1, 1},
   {&__pyx_kp_s_got_differing_extents_in_dimensi, __pyx_k_got_differing_extents_in_dimensi, sizeof(__pyx_k_got_differing_extents_in_dimensi), 0, 0, 1, 0},
   {&__pyx_kp_u_got_unexpected_value_for_product, __pyx_k_got_unexpected_value_for_product, sizeof(__pyx_k_got_unexpected_value_for_product), 0, 1, 0, 0},
   {&__pyx_kp_u_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 1, 0, 0},
   {&__pyx_n_s_i_2, __pyx_k_i_2, sizeof(__pyx_k_i_2), 0, 0, 1, 1},
   {&__pyx_n_s_id, __pyx_k_id, sizeof(__pyx_k_id), 0, 0, 1, 1},
   {&__pyx_n_s_idx, __pyx_k_idx, sizeof(__pyx_k_idx), 0, 0, 1, 1},
   {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
   {&__pyx_kp_u_index_out_of_range, __pyx_k_index_out_of_range, sizeof(__pyx_k_index_out_of_range), 0, 1, 0, 0},
+  {&__pyx_n_s_indices, __pyx_k_indices, sizeof(__pyx_k_indices), 0, 0, 1, 1},
   {&__pyx_n_s_init_key, __pyx_k_init_key, sizeof(__pyx_k_init_key), 0, 0, 1, 1},
   {&__pyx_n_s_int32, __pyx_k_int32, sizeof(__pyx_k_int32), 0, 0, 1, 1},
   {&__pyx_kp_u_invalid_value_for_phase, __pyx_k_invalid_value_for_phase, sizeof(__pyx_k_invalid_value_for_phase), 0, 1, 0, 0},
   {&__pyx_n_s_invert, __pyx_k_invert, sizeof(__pyx_k_invert), 0, 0, 1, 1},
   {&__pyx_n_s_io, __pyx_k_io, sizeof(__pyx_k_io), 0, 0, 1, 1},
+  {&__pyx_kp_u_is_not_in_CNF, __pyx_k_is_not_in_CNF, sizeof(__pyx_k_is_not_in_CNF), 0, 1, 0, 0},
+  {&__pyx_kp_u_is_not_in_Clause, __pyx_k_is_not_in_Clause, sizeof(__pyx_k_is_not_in_Clause), 0, 1, 0, 0},
   {&__pyx_n_s_itemsize, __pyx_k_itemsize, sizeof(__pyx_k_itemsize), 0, 0, 1, 1},
   {&__pyx_kp_s_itemsize_0_for_cython_array, __pyx_k_itemsize_0_for_cython_array, sizeof(__pyx_k_itemsize_0_for_cython_array), 0, 0, 1, 0},
   {&__pyx_n_s_iter, __pyx_k_iter, sizeof(__pyx_k_iter), 0, 0, 1, 1},
   {&__pyx_n_s_join, __pyx_k_join, sizeof(__pyx_k_join), 0, 0, 1, 1},
+  {&__pyx_n_s_l, __pyx_k_l, sizeof(__pyx_k_l), 0, 0, 1, 1},
   {&__pyx_kp_u_last_clause_not_terminated_with, __pyx_k_last_clause_not_terminated_with, sizeof(__pyx_k_last_clause_not_terminated_with), 0, 1, 0, 0},
+  {&__pyx_n_s_length, __pyx_k_length, sizeof(__pyx_k_length), 0, 0, 1, 1},
   {&__pyx_kp_u_length_parameter_must_be_a_power, __pyx_k_length_parameter_must_be_a_power, sizeof(__pyx_k_length_parameter_must_be_a_power), 0, 1, 0, 0},
+  {&__pyx_n_s_lhs, __pyx_k_lhs, sizeof(__pyx_k_lhs), 0, 0, 1, 1},
+  {&__pyx_kp_u_lhs_and_rhs_must_have_the_same_l, __pyx_k_lhs_and_rhs_must_have_the_same_l, sizeof(__pyx_k_lhs_and_rhs_must_have_the_same_l), 0, 1, 0, 0},
   {&__pyx_n_s_line, __pyx_k_line, sizeof(__pyx_k_line), 0, 0, 1, 1},
   {&__pyx_n_s_line_py, __pyx_k_line_py, sizeof(__pyx_k_line_py), 0, 0, 1, 1},
   {&__pyx_n_u_lingeling, __pyx_k_lingeling, sizeof(__pyx_k_lingeling), 0, 1, 0, 1},
   {&__pyx_n_u_lingeling_2, __pyx_k_lingeling_2, sizeof(__pyx_k_lingeling_2), 0, 1, 0, 1},
   {&__pyx_n_s_logical_or, __pyx_k_logical_or, sizeof(__pyx_k_logical_or), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_mask, __pyx_k_mask, sizeof(__pyx_k_mask), 0, 0, 1, 1},
   {&__pyx_n_s_memview, __pyx_k_memview, sizeof(__pyx_k_memview), 0, 0, 1, 1},
   {&__pyx_n_s_minimize_dimacs, __pyx_k_minimize_dimacs, sizeof(__pyx_k_minimize_dimacs), 0, 0, 1, 1},
   {&__pyx_n_s_mode, __pyx_k_mode, sizeof(__pyx_k_mode), 0, 0, 1, 1},
+  {&__pyx_kp_u_must_provide_at_least_one_argume, __pyx_k_must_provide_at_least_one_argume, sizeof(__pyx_k_must_provide_at_least_one_argume), 0, 1, 0, 0},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
   {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
   {&__pyx_n_s_ndim, __pyx_k_ndim, sizeof(__pyx_k_ndim), 0, 0, 1, 1},
   {&__pyx_kp_u_need_to_provide_translation_for, __pyx_k_need_to_provide_translation_for, sizeof(__pyx_k_need_to_provide_translation_for), 0, 1, 0, 0},
+  {&__pyx_n_s_needle, __pyx_k_needle, sizeof(__pyx_k_needle), 0, 0, 1, 1},
   {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
   {&__pyx_kp_s_no_default___reduce___due_to_non, __pyx_k_no_default___reduce___due_to_non, sizeof(__pyx_k_no_default___reduce___due_to_non), 0, 0, 1, 0},
   {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
+  {&__pyx_n_s_num_args, __pyx_k_num_args, sizeof(__pyx_k_num_args), 0, 0, 1, 1},
+  {&__pyx_n_s_num_xors, __pyx_k_num_xors, sizeof(__pyx_k_num_xors), 0, 0, 1, 1},
   {&__pyx_n_s_numbits, __pyx_k_numbits, sizeof(__pyx_k_numbits), 0, 0, 1, 1},
   {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
   {&__pyx_n_s_nvars, __pyx_k_nvars, sizeof(__pyx_k_nvars), 0, 0, 1, 1},
   {&__pyx_kp_u_o, __pyx_k_o, sizeof(__pyx_k_o), 0, 1, 0, 0},
   {&__pyx_kp_u_o_1, __pyx_k_o_1, sizeof(__pyx_k_o_1), 0, 1, 0, 0},
   {&__pyx_n_s_obj, __pyx_k_obj, sizeof(__pyx_k_obj), 0, 0, 1, 1},
   {&__pyx_n_s_object, __pyx_k_object, sizeof(__pyx_k_object), 0, 0, 1, 1},
@@ -32598,14 +38005,15 @@
   {&__pyx_n_s_on_set, __pyx_k_on_set, sizeof(__pyx_k_on_set), 0, 0, 1, 1},
   {&__pyx_n_s_open, __pyx_k_open, sizeof(__pyx_k_open), 0, 0, 1, 1},
   {&__pyx_n_s_optlevel, __pyx_k_optlevel, sizeof(__pyx_k_optlevel), 0, 0, 1, 1},
   {&__pyx_n_s_outfile, __pyx_k_outfile, sizeof(__pyx_k_outfile), 0, 0, 1, 1},
   {&__pyx_kp_u_p, __pyx_k_p, sizeof(__pyx_k_p), 0, 1, 0, 0},
   {&__pyx_kp_u_p_cnf, __pyx_k_p_cnf, sizeof(__pyx_k_p_cnf), 0, 1, 0, 0},
   {&__pyx_n_s_pack, __pyx_k_pack, sizeof(__pyx_k_pack), 0, 0, 1, 1},
+  {&__pyx_n_s_packed_args, __pyx_k_packed_args, sizeof(__pyx_k_packed_args), 0, 0, 1, 1},
   {&__pyx_kp_u_parameters_must_be_one_dimension, __pyx_k_parameters_must_be_one_dimension, sizeof(__pyx_k_parameters_must_be_one_dimension), 0, 1, 0, 0},
   {&__pyx_kp_u_parameters_must_have_the_same_sh, __pyx_k_parameters_must_have_the_same_sh, sizeof(__pyx_k_parameters_must_have_the_same_sh), 0, 1, 0, 0},
   {&__pyx_kp_u_phase, __pyx_k_phase, sizeof(__pyx_k_phase), 0, 1, 0, 0},
   {&__pyx_n_s_phase_2, __pyx_k_phase_2, sizeof(__pyx_k_phase_2), 0, 0, 1, 1},
   {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
   {&__pyx_n_s_prefix, __pyx_k_prefix, sizeof(__pyx_k_prefix), 0, 0, 1, 1},
   {&__pyx_n_s_print_numvars, __pyx_k_print_numvars, sizeof(__pyx_k_print_numvars), 0, 0, 1, 1},
@@ -32615,33 +38023,42 @@
   {&__pyx_n_s_pyx_result, __pyx_k_pyx_result, sizeof(__pyx_k_pyx_result), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_state, __pyx_k_pyx_state, sizeof(__pyx_k_pyx_state), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_type, __pyx_k_pyx_type, sizeof(__pyx_k_pyx_type), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_unpickle_Clause, __pyx_k_pyx_unpickle_Clause, sizeof(__pyx_k_pyx_unpickle_Clause), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_unpickle_Enum, __pyx_k_pyx_unpickle_Enum, sizeof(__pyx_k_pyx_unpickle_Enum), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_unpickle_Truthtable, __pyx_k_pyx_unpickle_Truthtable, sizeof(__pyx_k_pyx_unpickle_Truthtable), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
+  {&__pyx_n_s_r, __pyx_k_r, sizeof(__pyx_k_r), 0, 0, 1, 1},
   {&__pyx_n_u_r, __pyx_k_r, sizeof(__pyx_k_r), 0, 1, 0, 1},
   {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
   {&__pyx_n_s_read, __pyx_k_read, sizeof(__pyx_k_read), 0, 0, 1, 1},
   {&__pyx_n_s_reduce, __pyx_k_reduce, sizeof(__pyx_k_reduce), 0, 0, 1, 1},
   {&__pyx_n_s_reduce_cython, __pyx_k_reduce_cython, sizeof(__pyx_k_reduce_cython), 0, 0, 1, 1},
   {&__pyx_n_s_reduce_ex, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
+  {&__pyx_n_s_register, __pyx_k_register, sizeof(__pyx_k_register), 0, 0, 1, 1},
   {&__pyx_n_s_res, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
+  {&__pyx_n_s_reversed, __pyx_k_reversed, sizeof(__pyx_k_reversed), 0, 0, 1, 1},
+  {&__pyx_n_s_reversed_2, __pyx_k_reversed_2, sizeof(__pyx_k_reversed_2), 0, 0, 1, 1},
+  {&__pyx_n_s_rhs, __pyx_k_rhs, sizeof(__pyx_k_rhs), 0, 0, 1, 1},
+  {&__pyx_kp_u_right_hand_side_must_be_0_or_1_n, __pyx_k_right_hand_side_must_be_0_or_1_n, sizeof(__pyx_k_right_hand_side_must_be_0_or_1_n), 0, 1, 0, 0},
+  {&__pyx_n_s_rstrip, __pyx_k_rstrip, sizeof(__pyx_k_rstrip), 0, 0, 1, 1},
   {&__pyx_kp_u_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 1, 0, 0},
   {&__pyx_kp_u_s_2, __pyx_k_s_2, sizeof(__pyx_k_s_2), 0, 1, 0, 0},
-  {&__pyx_n_s_sat_toolkit__cnf_util, __pyx_k_sat_toolkit__cnf_util, sizeof(__pyx_k_sat_toolkit__cnf_util), 0, 0, 1, 1},
-  {&__pyx_kp_s_sat_toolkit__cnf_util_pyx, __pyx_k_sat_toolkit__cnf_util_pyx, sizeof(__pyx_k_sat_toolkit__cnf_util_pyx), 0, 0, 1, 0},
+  {&__pyx_n_s_sat_toolkit_formula, __pyx_k_sat_toolkit_formula, sizeof(__pyx_k_sat_toolkit_formula), 0, 0, 1, 1},
+  {&__pyx_kp_s_sat_toolkit_formula_pyx, __pyx_k_sat_toolkit_formula_pyx, sizeof(__pyx_k_sat_toolkit_formula_pyx), 0, 0, 1, 0},
   {&__pyx_n_s_searchsorted, __pyx_k_searchsorted, sizeof(__pyx_k_searchsorted), 0, 0, 1, 1},
   {&__pyx_n_s_send, __pyx_k_send, sizeof(__pyx_k_send), 0, 0, 1, 1},
   {&__pyx_n_s_sep, __pyx_k_sep, sizeof(__pyx_k_sep), 0, 0, 1, 1},
   {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
   {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_shape, __pyx_k_shape, sizeof(__pyx_k_shape), 0, 0, 1, 1},
   {&__pyx_n_s_sign, __pyx_k_sign, sizeof(__pyx_k_sign), 0, 0, 1, 1},
   {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
+  {&__pyx_n_s_solution_len, __pyx_k_solution_len, sizeof(__pyx_k_solution_len), 0, 0, 1, 1},
+  {&__pyx_kp_u_solution_of_length, __pyx_k_solution_of_length, sizeof(__pyx_k_solution_of_length), 0, 1, 0, 0},
   {&__pyx_n_s_sort, __pyx_k_sort, sizeof(__pyx_k_sort), 0, 0, 1, 1},
   {&__pyx_n_s_sorted_contains, __pyx_k_sorted_contains, sizeof(__pyx_k_sorted_contains), 0, 0, 1, 1},
   {&__pyx_n_s_sp, __pyx_k_sp, sizeof(__pyx_k_sp), 0, 0, 1, 1},
   {&__pyx_n_s_split, __pyx_k_split, sizeof(__pyx_k_split), 0, 0, 1, 1},
   {&__pyx_n_s_start, __pyx_k_start, sizeof(__pyx_k_start), 0, 0, 1, 1},
   {&__pyx_n_s_start_indices, __pyx_k_start_indices, sizeof(__pyx_k_start_indices), 0, 0, 1, 1},
   {&__pyx_n_s_staticmethod, __pyx_k_staticmethod, sizeof(__pyx_k_staticmethod), 0, 0, 1, 1},
@@ -32649,599 +38066,718 @@
   {&__pyx_n_s_stdout, __pyx_k_stdout, sizeof(__pyx_k_stdout), 0, 0, 1, 1},
   {&__pyx_n_s_step, __pyx_k_step, sizeof(__pyx_k_step), 0, 0, 1, 1},
   {&__pyx_n_s_stop, __pyx_k_stop, sizeof(__pyx_k_stop), 0, 0, 1, 1},
   {&__pyx_kp_s_strided_and_direct, __pyx_k_strided_and_direct, sizeof(__pyx_k_strided_and_direct), 0, 0, 1, 0},
   {&__pyx_kp_s_strided_and_direct_or_indirect, __pyx_k_strided_and_direct_or_indirect, sizeof(__pyx_k_strided_and_direct_or_indirect), 0, 0, 1, 0},
   {&__pyx_kp_s_strided_and_indirect, __pyx_k_strided_and_indirect, sizeof(__pyx_k_strided_and_indirect), 0, 0, 1, 0},
   {&__pyx_kp_s_stringsource, __pyx_k_stringsource, sizeof(__pyx_k_stringsource), 0, 0, 1, 0},
-  {&__pyx_n_s_strip, __pyx_k_strip, sizeof(__pyx_k_strip), 0, 0, 1, 1},
   {&__pyx_n_s_struct, __pyx_k_struct, sizeof(__pyx_k_struct), 0, 0, 1, 1},
   {&__pyx_n_s_subprocess, __pyx_k_subprocess, sizeof(__pyx_k_subprocess), 0, 0, 1, 1},
   {&__pyx_n_s_suffix, __pyx_k_suffix, sizeof(__pyx_k_suffix), 0, 0, 1, 1},
   {&__pyx_n_s_sys, __pyx_k_sys, sizeof(__pyx_k_sys), 0, 0, 1, 1},
   {&__pyx_n_s_tempfile, __pyx_k_tempfile, sizeof(__pyx_k_tempfile), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {&__pyx_n_s_text, __pyx_k_text, sizeof(__pyx_k_text), 0, 0, 1, 1},
   {&__pyx_n_s_throw, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
   {&__pyx_n_s_timeout, __pyx_k_timeout, sizeof(__pyx_k_timeout), 0, 0, 1, 1},
   {&__pyx_n_s_to_dimacs, __pyx_k_to_dimacs, sizeof(__pyx_k_to_dimacs), 0, 0, 1, 1},
   {&__pyx_n_s_to_espresso, __pyx_k_to_espresso, sizeof(__pyx_k_to_espresso), 0, 0, 1, 1},
-  {&__pyx_kp_u_too_few_variables_supplied_need, __pyx_k_too_few_variables_supplied_need, sizeof(__pyx_k_too_few_variables_supplied_need), 0, 1, 0, 0},
-  {&__pyx_n_s_true_op, __pyx_k_true_op, sizeof(__pyx_k_true_op), 0, 0, 1, 1},
+  {&__pyx_kp_u_too_few_variables_supplied, __pyx_k_too_few_variables_supplied, sizeof(__pyx_k_too_few_variables_supplied), 0, 1, 0, 0},
+  {&__pyx_kp_u_too_short_for_CNF_with, __pyx_k_too_short_for_CNF_with, sizeof(__pyx_k_too_short_for_CNF_with), 0, 1, 0, 0},
   {&__pyx_n_s_typing, __pyx_k_typing, sizeof(__pyx_k_typing), 0, 0, 1, 1},
+  {&__pyx_n_s_uint8, __pyx_k_uint8, sizeof(__pyx_k_uint8), 0, 0, 1, 1},
   {&__pyx_kp_s_unable_to_allocate_array_data, __pyx_k_unable_to_allocate_array_data, sizeof(__pyx_k_unable_to_allocate_array_data), 0, 0, 1, 0},
   {&__pyx_kp_s_unable_to_allocate_shape_and_str, __pyx_k_unable_to_allocate_shape_and_str, sizeof(__pyx_k_unable_to_allocate_shape_and_str), 0, 0, 1, 0},
   {&__pyx_n_s_unpack, __pyx_k_unpack, sizeof(__pyx_k_unpack), 0, 0, 1, 1},
   {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
   {&__pyx_kp_u_use_from_lut_or_from_indices, __pyx_k_use_from_lut_or_from_indices, sizeof(__pyx_k_use_from_lut_or_from_indices), 0, 1, 0, 0},
   {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
   {&__pyx_n_s_val, __pyx_k_val, sizeof(__pyx_k_val), 0, 0, 1, 1},
   {&__pyx_kp_u_var_must_not_be_zero, __pyx_k_var_must_not_be_zero, sizeof(__pyx_k_var_must_not_be_zero), 0, 1, 0, 0},
-  {&__pyx_kp_u_variable_0_must_be_mapped_to_0, __pyx_k_variable_0_must_be_mapped_to_0, sizeof(__pyx_k_variable_0_must_be_mapped_to_0), 0, 1, 0, 0},
+  {&__pyx_kp_u_variable_0_must_map_to_0_again, __pyx_k_variable_0_must_map_to_0_again, sizeof(__pyx_k_variable_0_must_map_to_0_again), 0, 1, 0, 0},
   {&__pyx_kp_u_variable_must_not_be_mapped_to_0, __pyx_k_variable_must_not_be_mapped_to_0, sizeof(__pyx_k_variable_must_not_be_mapped_to_0), 0, 1, 0, 0},
-  {&__pyx_n_s_variables, __pyx_k_variables, sizeof(__pyx_k_variables), 0, 0, 1, 1},
+  {&__pyx_kp_u_variables, __pyx_k_variables, sizeof(__pyx_k_variables), 0, 1, 0, 0},
   {&__pyx_kp_u_variables_with, __pyx_k_variables_with, sizeof(__pyx_k_variables_with), 0, 1, 0, 0},
   {&__pyx_n_s_wait, __pyx_k_wait, sizeof(__pyx_k_wait), 0, 0, 1, 1},
   {&__pyx_n_s_where, __pyx_k_where, sizeof(__pyx_k_where), 0, 0, 1, 1},
   {&__pyx_n_s_write, __pyx_k_write, sizeof(__pyx_k_write), 0, 0, 1, 1},
   {&__pyx_n_s_write_2, __pyx_k_write_2, sizeof(__pyx_k_write_2), 0, 0, 1, 1},
   {&__pyx_n_s_write_locals_sorted_contains, __pyx_k_write_locals_sorted_contains, sizeof(__pyx_k_write_locals_sorted_contains), 0, 0, 1, 1},
   {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_staticmethod = __Pyx_GetBuiltinName(__pyx_n_s_staticmethod); if (!__pyx_builtin_staticmethod) __PYX_ERR(0, 184, __pyx_L1_error)
-  __pyx_builtin_object = __Pyx_GetBuiltinName(__pyx_n_s_object); if (!__pyx_builtin_object) __PYX_ERR(0, 579, __pyx_L1_error)
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 52, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 62, __pyx_L1_error)
-  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 108, __pyx_L1_error)
-  __pyx_builtin_open = __Pyx_GetBuiltinName(__pyx_n_s_open); if (!__pyx_builtin_open) __PYX_ERR(0, 422, __pyx_L1_error)
+  __pyx_builtin_staticmethod = __Pyx_GetBuiltinName(__pyx_n_s_staticmethod); if (!__pyx_builtin_staticmethod) __PYX_ERR(0, 283, __pyx_L1_error)
+  __pyx_builtin_object = __Pyx_GetBuiltinName(__pyx_n_s_object); if (!__pyx_builtin_object) __PYX_ERR(0, 1003, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 68, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 78, __pyx_L1_error)
+  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_builtin_reversed = __Pyx_GetBuiltinName(__pyx_n_s_reversed); if (!__pyx_builtin_reversed) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 213, __pyx_L1_error)
+  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_builtin_open = __Pyx_GetBuiltinName(__pyx_n_s_open); if (!__pyx_builtin_open) __PYX_ERR(0, 673, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 149, __pyx_L1_error)
-  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(1, 152, __pyx_L1_error)
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 2, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(1, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(1, 615, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "sat_toolkit/_cnf_util.pyx":52
+  /* "sat_toolkit/formula.pyx":68
  *         for c in clause:
  *             if c == 0:
  *                 raise ValueError('cannot use 0 as part of clause')             # <<<<<<<<<<<<<<
  *             self.clause.push_back(c)
  *         self.clause.shrink_to_fit()
  */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_cannot_use_0_as_part_of_clause); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_cannot_use_0_as_part_of_clause); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "sat_toolkit/_cnf_util.pyx":75
+  /* "sat_toolkit/formula.pyx":102
  * 
- *         if <size_t> len(variables) < self._maxvar() + 1:
- *             raise ValueError(f'too few variables supplied (need to include dummy variable for 0)')             # <<<<<<<<<<<<<<
+ *         if <size_t> len(variables) < self._maxvar():
+ *             raise IndexError(f'too few variables supplied')             # <<<<<<<<<<<<<<
  * 
- *         res = [None] * (<ssize_t> self.clause.size())
+ *         for i in range(self.clause.size()):
  */
-  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_too_few_variables_supplied_need); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 75, __pyx_L1_error)
+  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_too_few_variables_supplied); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__2);
   __Pyx_GIVEREF(__pyx_tuple__2);
 
-  /* "sat_toolkit/_cnf_util.pyx":108
+  /* "sat_toolkit/formula.pyx":135
  *             idx += self.clause.size()
  *         if idx < 0 or <size_t> idx >= self.clause.size():
  *             raise IndexError('index out of range')             # <<<<<<<<<<<<<<
- *         return self.clause[idx]
+ *         return <size_t> idx
  * 
  */
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_u_index_out_of_range); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_u_index_out_of_range); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__4);
   __Pyx_GIVEREF(__pyx_tuple__4);
 
-  /* "sat_toolkit/_cnf_util.pyx":173
+  /* "sat_toolkit/formula.pyx":272
  *         off = -1
  *         if (sscanf(buf, "p cnf %d %zd\n%zn", &nvars, &nclauses, &off) or 1) and off == -1ULL:
  *             raise ValueError('file format error')             # <<<<<<<<<<<<<<
  *         buf += off
  * 
  */
-  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_u_file_format_error); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 173, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__7);
-  __Pyx_GIVEREF(__pyx_tuple__7);
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_file_format_error); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__6);
+  __Pyx_GIVEREF(__pyx_tuple__6);
+
+  /* "sat_toolkit/formula.pyx":355
+ *             val = indices[i]
+ *             if val == 0:
+ *                 raise ValueError('all indices must be nonzero')             # <<<<<<<<<<<<<<
+ *             clauses[2*i] = -val
+ * 
+ */
+  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_u_all_indices_must_be_nonzero); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__8);
+  __Pyx_GIVEREF(__pyx_tuple__8);
 
-  /* "sat_toolkit/_cnf_util.pyx":245
+  /* "sat_toolkit/formula.pyx":373
+ *         length = lhs.shape[0]
+ *         if rhs.shape[0] != length:
+ *             raise ValueError('lhs and rhs must have the same length')             # <<<<<<<<<<<<<<
+ * 
+ *         clauses.resize(length * 6)
+ */
+  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_lhs_and_rhs_must_have_the_same_l); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 373, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__9);
+  __Pyx_GIVEREF(__pyx_tuple__9);
+
+  /* "sat_toolkit/formula.pyx":416
+ *             for col in range(num_inputs):
+ *                 if packed_args[row, col] <= 0:
+ *                     raise ValueError("create_xor only supports positive indexes")             # <<<<<<<<<<<<<<
+ * 
+ *             rhs = packed_args[row, num_inputs]
+ */
+  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_u_create_xor_only_supports_positiv); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 416, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__10);
+  __Pyx_GIVEREF(__pyx_tuple__10);
+
+  /* "sat_toolkit/formula.pyx":449
+ * 
+ *         if num_args < 1:
+ *             raise ValueError('must provide at least one argument')             # <<<<<<<<<<<<<<
+ * 
+ *         num_xors = len(args[0])
+ */
+  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_u_must_provide_at_least_one_argume); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 449, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__11);
+  __Pyx_GIVEREF(__pyx_tuple__11);
+
+  /* "sat_toolkit/formula.pyx":456
+ * 
+ *         for i, arg in enumerate(args):
+ *             packed_args[:, i] = arg             # <<<<<<<<<<<<<<
+ * 
+ *         if rhs is not None:
+ */
+  __pyx_slice__12 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__12)) __PYX_ERR(0, 456, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_slice__12);
+  __Pyx_GIVEREF(__pyx_slice__12);
+
+  /* "sat_toolkit/formula.pyx":470
  * 
  *         if self.view_count > 0:
  *             raise ValueError('cannot alter while referenced by buffer')             # <<<<<<<<<<<<<<
  * 
  *         l = clauses.shape[0]
  */
-  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_cannot_alter_while_referenced_by); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 245, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__9);
-  __Pyx_GIVEREF(__pyx_tuple__9);
+  __pyx_tuple__13 = PyTuple_Pack(1, __pyx_kp_u_cannot_alter_while_referenced_by); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 470, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__13);
+  __Pyx_GIVEREF(__pyx_tuple__13);
 
-  /* "sat_toolkit/_cnf_util.pyx":249
+  /* "sat_toolkit/formula.pyx":474
  *         l = clauses.shape[0]
  *         if l > 0 and clauses[l - 1] != 0:
  *             raise ValueError('last clause not terminated with 0')             # <<<<<<<<<<<<<<
  * 
  *         old_len = self.clauses.size()
  */
-  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_u_last_clause_not_terminated_with); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 249, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__10);
-  __Pyx_GIVEREF(__pyx_tuple__10);
+  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_kp_u_last_clause_not_terminated_with); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 474, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__14);
+  __Pyx_GIVEREF(__pyx_tuple__14);
 
-  /* "sat_toolkit/_cnf_util.pyx":275
- *         np_clause[:clause_len - 1] = clause
+  /* "sat_toolkit/formula.pyx":509
+ *         np_clause[:clause_len] = clause
  *         if np.count_nonzero(np_clause) != clause_len:
  *             raise ValueError('cannot use 0 in clause')             # <<<<<<<<<<<<<<
  *         self._add_clauses(np_clause)
  * 
  */
-  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_u_cannot_use_0_in_clause); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 275, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__11);
-  __Pyx_GIVEREF(__pyx_tuple__11);
+  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_kp_u_cannot_use_0_in_clause); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__15);
+  __Pyx_GIVEREF(__pyx_tuple__15);
 
-  /* "sat_toolkit/_cnf_util.pyx":286
+  /* "sat_toolkit/formula.pyx":525
  *         """
  *         if var == 0:
  *             raise ValueError("var must not be zero")             # <<<<<<<<<<<<<<
  * 
  *         cdef vector[int] new_clauses
  */
-  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_kp_u_var_must_not_be_zero); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 286, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__12);
-  __Pyx_GIVEREF(__pyx_tuple__12);
+  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_u_var_must_not_be_zero); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 525, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__16);
+  __Pyx_GIVEREF(__pyx_tuple__16);
 
-  /* "sat_toolkit/_cnf_util.pyx":390
+  /* "sat_toolkit/formula.pyx":641
  *         cdef int ret_code
  * 
  *         with sp.Popen(['espresso'] + espresso_args, stdin=sp.PIPE, stdout=sp.PIPE, text=True) as espresso:             # <<<<<<<<<<<<<<
  *             espresso.stdin.write(self.to_espresso())
  *             espresso.stdin.close()
  */
-  __pyx_tuple__15 = PyTuple_Pack(3, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 390, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__15);
-  __Pyx_GIVEREF(__pyx_tuple__15);
+  __pyx_tuple__19 = PyTuple_Pack(3, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 641, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__19);
+  __Pyx_GIVEREF(__pyx_tuple__19);
 
-  /* "sat_toolkit/_cnf_util.pyx":527
+  /* "sat_toolkit/formula.pyx":704
+ *         for i in range(solution_len):
+ *            if solution[i] not in [0, 1]:
+ *                raise ValueError(f'all elements in solution must be in [0, 1]')             # <<<<<<<<<<<<<<
+ * 
+ *         return self._check_solution(solution)
+ */
+  __pyx_tuple__21 = PyTuple_Pack(1, __pyx_kp_u_all_elements_in_solution_must_be); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 704, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__21);
+  __Pyx_GIVEREF(__pyx_tuple__21);
+
+  /* "sat_toolkit/formula.pyx":751
+ * 
+ *         if self.nvars > 32:
+ *             raise ValueError('cannot find all solutions for CNF with more than 32 variables')             # <<<<<<<<<<<<<<
+ * 
+ *         truthtable = np.empty((<uint64_t> 1) << self.nvars, np.uint8)
+ */
+  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_kp_u_cannot_find_all_solutions_for_CN); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(0, 751, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__22);
+  __Pyx_GIVEREF(__pyx_tuple__22);
+
+  /* "sat_toolkit/formula.pyx":930
  * 
  *         if var_view.shape[0] != self.nvars + 1:
  *             raise ValueError('need to provide translation for all 1+{self.nvars} variables')             # <<<<<<<<<<<<<<
  *         if var_view[0] != 0:
- *             raise ValueError('variable 0 must be mapped to 0')
+ *             raise ValueError('variable 0 must map to 0 again')
  */
-  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_u_need_to_provide_translation_for); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 527, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__17);
-  __Pyx_GIVEREF(__pyx_tuple__17);
+  __pyx_tuple__23 = PyTuple_Pack(1, __pyx_kp_u_need_to_provide_translation_for); if (unlikely(!__pyx_tuple__23)) __PYX_ERR(0, 930, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__23);
+  __Pyx_GIVEREF(__pyx_tuple__23);
 
-  /* "sat_toolkit/_cnf_util.pyx":529
+  /* "sat_toolkit/formula.pyx":932
  *             raise ValueError('need to provide translation for all 1+{self.nvars} variables')
  *         if var_view[0] != 0:
- *             raise ValueError('variable 0 must be mapped to 0')             # <<<<<<<<<<<<<<
+ *             raise ValueError('variable 0 must map to 0 again')             # <<<<<<<<<<<<<<
+ * 
  *         for i in range(1, <size_t> var_view.shape[0]):
- *             if var_view[i] == 0:
  */
-  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_kp_u_variable_0_must_be_mapped_to_0); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 529, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__18);
-  __Pyx_GIVEREF(__pyx_tuple__18);
+  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_u_variable_0_must_map_to_0_again); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__24);
+  __Pyx_GIVEREF(__pyx_tuple__24);
 
-  /* "sat_toolkit/_cnf_util.pyx":532
+  /* "sat_toolkit/formula.pyx":936
  *         for i in range(1, <size_t> var_view.shape[0]):
  *             if var_view[i] == 0:
  *                 raise ValueError('variable must not be mapped to 0')             # <<<<<<<<<<<<<<
  * 
  *         cdef vector[int] new_clauses
  */
-  __pyx_tuple__19 = PyTuple_Pack(1, __pyx_kp_u_variable_must_not_be_mapped_to_0); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 532, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__19);
-  __Pyx_GIVEREF(__pyx_tuple__19);
+  __pyx_tuple__25 = PyTuple_Pack(1, __pyx_kp_u_variable_must_not_be_mapped_to_0); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(0, 936, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__25);
+  __Pyx_GIVEREF(__pyx_tuple__25);
+
+  /* "sat_toolkit/formula.pyx":953
+ *     def __getbuffer__(self, cython.Py_buffer *buffer, int flags):
+ *         if flags & PyBUF_WRITABLE:
+ *             raise ValueError('cannot provide a writable buffer for CNF')             # <<<<<<<<<<<<<<
+ * 
+ *         self.shape[0] = self.clauses.size()
+ */
+  __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_u_cannot_provide_a_writable_buffer); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 953, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__26);
+  __Pyx_GIVEREF(__pyx_tuple__26);
 
-  /* "sat_toolkit/_cnf_util.pyx":583
+  /* "sat_toolkit/formula.pyx":1007
  *     def __init__(self, init_key, numbits, on_set, dc_set):
  *         if init_key is not self.INIT_INDEX_SET:
  *             raise ValueError('use .from_lut or .from_indices')             # <<<<<<<<<<<<<<
  * 
  *         if len(on_set.shape) != 1 or (dc_set is not None and len(dc_set.shape) != 1):
  */
-  __pyx_tuple__20 = PyTuple_Pack(1, __pyx_kp_u_use_from_lut_or_from_indices); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 583, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__20);
-  __Pyx_GIVEREF(__pyx_tuple__20);
+  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_kp_u_use_from_lut_or_from_indices); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 1007, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__27);
+  __Pyx_GIVEREF(__pyx_tuple__27);
 
-  /* "sat_toolkit/_cnf_util.pyx":586
+  /* "sat_toolkit/formula.pyx":1010
  * 
  *         if len(on_set.shape) != 1 or (dc_set is not None and len(dc_set.shape) != 1):
  *             raise ValueError('parameters must be one dimensional')             # <<<<<<<<<<<<<<
  * 
  *         self.numbits = numbits
  */
-  __pyx_tuple__21 = PyTuple_Pack(1, __pyx_kp_u_parameters_must_be_one_dimension); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 586, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__21);
-  __Pyx_GIVEREF(__pyx_tuple__21);
+  __pyx_tuple__28 = PyTuple_Pack(1, __pyx_kp_u_parameters_must_be_one_dimension); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 1010, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__28);
+  __Pyx_GIVEREF(__pyx_tuple__28);
 
-  /* "sat_toolkit/_cnf_util.pyx":608
+  /* "sat_toolkit/formula.pyx":1032
  * 
  *         if dc_lut is not None and on_lut.shape != dc_lut.shape:
  *             raise ValueError('parameters must have the same shape')             # <<<<<<<<<<<<<<
  * 
  *         numvals = on_lut.shape[0]
  */
-  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_kp_u_parameters_must_have_the_same_sh); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(0, 608, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__22);
-  __Pyx_GIVEREF(__pyx_tuple__22);
+  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_u_parameters_must_have_the_same_sh); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 1032, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__29);
+  __Pyx_GIVEREF(__pyx_tuple__29);
 
-  /* "sat_toolkit/_cnf_util.pyx":612
+  /* "sat_toolkit/formula.pyx":1036
  *         numvals = on_lut.shape[0]
  *         if (numvals & (numvals - 1)) != 0 or numvals == 0:
  *             raise ValueError('length parameter must be a power of 2')             # <<<<<<<<<<<<<<
  * 
  *         numbits = numvals.bit_length() - 1
  */
-  __pyx_tuple__23 = PyTuple_Pack(1, __pyx_kp_u_length_parameter_must_be_a_power); if (unlikely(!__pyx_tuple__23)) __PYX_ERR(0, 612, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__23);
-  __Pyx_GIVEREF(__pyx_tuple__23);
+  __pyx_tuple__30 = PyTuple_Pack(1, __pyx_kp_u_length_parameter_must_be_a_power); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 1036, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__30);
+  __Pyx_GIVEREF(__pyx_tuple__30);
 
-  /* "sat_toolkit/_cnf_util.pyx":617
+  /* "sat_toolkit/formula.pyx":1041
  * 
  *         if dc_lut is not None and np.any(on_lut & dc_lut):
  *             raise ValueError('on_lut and dc_lut must be distinct')             # <<<<<<<<<<<<<<
  * 
  *         on_set, = np.where(on_lut)
  */
-  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_u_on_lut_and_dc_lut_must_be_distin); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 617, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__24);
-  __Pyx_GIVEREF(__pyx_tuple__24);
+  __pyx_tuple__31 = PyTuple_Pack(1, __pyx_kp_u_on_lut_and_dc_lut_must_be_distin); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 1041, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__31);
+  __Pyx_GIVEREF(__pyx_tuple__31);
 
-  /* "sat_toolkit/_cnf_util.pyx":651
+  /* "sat_toolkit/formula.pyx":1075
  *             io.write(f'.phase {not invert:b}\n')
  * 
  *         def sorted_contains(a, v):             # <<<<<<<<<<<<<<
  *             idx = np.searchsorted(a, v)
  *             return idx < len(a) and a[idx] == v
  */
-  __pyx_tuple__26 = PyTuple_Pack(3, __pyx_n_s_a, __pyx_n_s_v, __pyx_n_s_idx); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 651, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__26);
-  __Pyx_GIVEREF(__pyx_tuple__26);
-  __pyx_codeobj__27 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit__cnf_util_pyx, __pyx_n_s_sorted_contains, 651, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__27)) __PYX_ERR(0, 651, __pyx_L1_error)
+  __pyx_tuple__33 = PyTuple_Pack(3, __pyx_n_s_a, __pyx_n_s_v, __pyx_n_s_idx); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 1075, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__33);
+  __Pyx_GIVEREF(__pyx_tuple__33);
+  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit_formula_pyx, __pyx_n_s_sorted_contains, 1075, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 1075, __pyx_L1_error)
 
-  /* "sat_toolkit/_cnf_util.pyx":681
+  /* "sat_toolkit/formula.pyx":1105
  *             invert = False
  *         else:
  *             raise ValueError('invalid value for `phase`')             # <<<<<<<<<<<<<<
  * 
  *         res = io.StringIO()
  */
-  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_u_invalid_value_for_phase); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 681, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__29);
-  __Pyx_GIVEREF(__pyx_tuple__29);
+  __pyx_tuple__36 = PyTuple_Pack(1, __pyx_kp_u_invalid_value_for_phase); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 1105, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__36);
+  __Pyx_GIVEREF(__pyx_tuple__36);
 
   /* "(tree fragment)":4
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xab15654, 0x9d96e17, 0x4c5c891):             # <<<<<<<<<<<<<<
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xab15654, 0x9d96e17, 0x4c5c891) = (clause))" % __pyx_checksum)
  */
-  __pyx_tuple__31 = PyTuple_Pack(3, __pyx_int_179394132, __pyx_int_165244439, __pyx_int_80070801); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__31);
-  __Pyx_GIVEREF(__pyx_tuple__31);
-  __pyx_tuple__32 = PyTuple_Pack(3, __pyx_int_194912966, __pyx_int_67514187, __pyx_int_136945605); if (unlikely(!__pyx_tuple__32)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__32);
-  __Pyx_GIVEREF(__pyx_tuple__32);
+  __pyx_tuple__38 = PyTuple_Pack(3, __pyx_int_179394132, __pyx_int_165244439, __pyx_int_80070801); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__38);
+  __Pyx_GIVEREF(__pyx_tuple__38);
+  __pyx_tuple__39 = PyTuple_Pack(3, __pyx_int_194912966, __pyx_int_67514187, __pyx_int_136945605); if (unlikely(!__pyx_tuple__39)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__39);
+  __Pyx_GIVEREF(__pyx_tuple__39);
 
   /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if itemsize <= 0:
  */
-  __pyx_tuple__33 = PyTuple_Pack(1, __pyx_kp_s_Empty_shape_tuple_for_cython_arr); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(1, 134, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__33);
-  __Pyx_GIVEREF(__pyx_tuple__33);
+  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_kp_s_Empty_shape_tuple_for_cython_arr); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(1, 134, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__40);
+  __Pyx_GIVEREF(__pyx_tuple__40);
 
   /* "View.MemoryView":137
  * 
  *         if itemsize <= 0:
  *             raise ValueError("itemsize <= 0 for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if not isinstance(format, bytes):
  */
-  __pyx_tuple__34 = PyTuple_Pack(1, __pyx_kp_s_itemsize_0_for_cython_array); if (unlikely(!__pyx_tuple__34)) __PYX_ERR(1, 137, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__34);
-  __Pyx_GIVEREF(__pyx_tuple__34);
+  __pyx_tuple__41 = PyTuple_Pack(1, __pyx_kp_s_itemsize_0_for_cython_array); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(1, 137, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__41);
+  __Pyx_GIVEREF(__pyx_tuple__41);
 
   /* "View.MemoryView":149
  * 
  *         if not self._shape:
  *             raise MemoryError("unable to allocate shape and strides.")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__35 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_shape_and_str); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(1, 149, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__35);
-  __Pyx_GIVEREF(__pyx_tuple__35);
+  __pyx_tuple__42 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_shape_and_str); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(1, 149, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__42);
+  __Pyx_GIVEREF(__pyx_tuple__42);
 
   /* "View.MemoryView":177
  *             self.data = <char *>malloc(self.len)
  *             if not self.data:
  *                 raise MemoryError("unable to allocate array data.")             # <<<<<<<<<<<<<<
  * 
  *             if self.dtype_is_object:
  */
-  __pyx_tuple__36 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_array_data); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(1, 177, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__36);
-  __Pyx_GIVEREF(__pyx_tuple__36);
+  __pyx_tuple__43 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_array_data); if (unlikely(!__pyx_tuple__43)) __PYX_ERR(1, 177, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__43);
+  __Pyx_GIVEREF(__pyx_tuple__43);
 
   /* "View.MemoryView":193
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         if not (flags & bufmode):
  *             raise ValueError("Can only create a buffer that is contiguous in memory.")             # <<<<<<<<<<<<<<
  *         info.buf = self.data
  *         info.len = self.len
  */
-  __pyx_tuple__37 = PyTuple_Pack(1, __pyx_kp_s_Can_only_create_a_buffer_that_is); if (unlikely(!__pyx_tuple__37)) __PYX_ERR(1, 193, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__37);
-  __Pyx_GIVEREF(__pyx_tuple__37);
+  __pyx_tuple__44 = PyTuple_Pack(1, __pyx_kp_s_Can_only_create_a_buffer_that_is); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(1, 193, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__44);
+  __Pyx_GIVEREF(__pyx_tuple__44);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__38 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__38);
-  __Pyx_GIVEREF(__pyx_tuple__38);
+  __pyx_tuple__45 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__45)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__45);
+  __Pyx_GIVEREF(__pyx_tuple__45);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__39 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__39)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__39);
-  __Pyx_GIVEREF(__pyx_tuple__39);
+  __pyx_tuple__46 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__46)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__46);
+  __Pyx_GIVEREF(__pyx_tuple__46);
 
   /* "View.MemoryView":420
  *     def __setitem__(memoryview self, object index, object value):
  *         if self.view.readonly:
  *             raise TypeError("Cannot assign to read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         have_slices, index = _unellipsify(index, self.view.ndim)
  */
-  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_kp_s_Cannot_assign_to_read_only_memor); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(1, 420, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__40);
-  __Pyx_GIVEREF(__pyx_tuple__40);
+  __pyx_tuple__47 = PyTuple_Pack(1, __pyx_kp_s_Cannot_assign_to_read_only_memor); if (unlikely(!__pyx_tuple__47)) __PYX_ERR(1, 420, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__47);
+  __Pyx_GIVEREF(__pyx_tuple__47);
 
   /* "View.MemoryView":497
  *             result = struct.unpack(self.view.format, bytesitem)
  *         except struct.error:
  *             raise ValueError("Unable to convert item to object")             # <<<<<<<<<<<<<<
  *         else:
  *             if len(self.view.format) == 1:
  */
-  __pyx_tuple__41 = PyTuple_Pack(1, __pyx_kp_s_Unable_to_convert_item_to_object); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(1, 497, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__41);
-  __Pyx_GIVEREF(__pyx_tuple__41);
+  __pyx_tuple__48 = PyTuple_Pack(1, __pyx_kp_s_Unable_to_convert_item_to_object); if (unlikely(!__pyx_tuple__48)) __PYX_ERR(1, 497, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__48);
+  __Pyx_GIVEREF(__pyx_tuple__48);
 
   /* "View.MemoryView":522
  *     def __getbuffer__(self, Py_buffer *info, int flags):
  *         if flags & PyBUF_WRITABLE and self.view.readonly:
  *             raise ValueError("Cannot create writable memory view from read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         if flags & PyBUF_ND:
  */
-  __pyx_tuple__42 = PyTuple_Pack(1, __pyx_kp_s_Cannot_create_writable_memory_vi); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(1, 522, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__42);
-  __Pyx_GIVEREF(__pyx_tuple__42);
+  __pyx_tuple__49 = PyTuple_Pack(1, __pyx_kp_s_Cannot_create_writable_memory_vi); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(1, 522, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__49);
+  __Pyx_GIVEREF(__pyx_tuple__49);
 
   /* "View.MemoryView":572
  *         if self.view.strides == NULL:
  * 
  *             raise ValueError("Buffer view does not expose strides")             # <<<<<<<<<<<<<<
  * 
  *         return tuple([stride for stride in self.view.strides[:self.view.ndim]])
  */
-  __pyx_tuple__43 = PyTuple_Pack(1, __pyx_kp_s_Buffer_view_does_not_expose_stri); if (unlikely(!__pyx_tuple__43)) __PYX_ERR(1, 572, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__43);
-  __Pyx_GIVEREF(__pyx_tuple__43);
+  __pyx_tuple__50 = PyTuple_Pack(1, __pyx_kp_s_Buffer_view_does_not_expose_stri); if (unlikely(!__pyx_tuple__50)) __PYX_ERR(1, 572, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__50);
+  __Pyx_GIVEREF(__pyx_tuple__50);
 
   /* "View.MemoryView":579
  *     def suboffsets(self):
  *         if self.view.suboffsets == NULL:
  *             return (-1,) * self.view.ndim             # <<<<<<<<<<<<<<
  * 
  *         return tuple([suboffset for suboffset in self.view.suboffsets[:self.view.ndim]])
  */
-  __pyx_tuple__44 = PyTuple_New(1); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(1, 579, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__44);
+  __pyx_tuple__51 = PyTuple_New(1); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(1, 579, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__51);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
-  PyTuple_SET_ITEM(__pyx_tuple__44, 0, __pyx_int_neg_1);
-  __Pyx_GIVEREF(__pyx_tuple__44);
+  PyTuple_SET_ITEM(__pyx_tuple__51, 0, __pyx_int_neg_1);
+  __Pyx_GIVEREF(__pyx_tuple__51);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__45 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__45)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__45);
-  __Pyx_GIVEREF(__pyx_tuple__45);
+  __pyx_tuple__52 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__52)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__52);
+  __Pyx_GIVEREF(__pyx_tuple__52);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__46 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__46)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__46);
-  __Pyx_GIVEREF(__pyx_tuple__46);
-
-  /* "View.MemoryView":684
- *         if item is Ellipsis:
- *             if not seen_ellipsis:
- *                 result.extend([slice(None)] * (ndim - len(tup) + 1))             # <<<<<<<<<<<<<<
- *                 seen_ellipsis = True
- *             else:
- */
-  __pyx_slice__47 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__47)) __PYX_ERR(1, 684, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_slice__47);
-  __Pyx_GIVEREF(__pyx_slice__47);
+  __pyx_tuple__53 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__53)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__53);
+  __Pyx_GIVEREF(__pyx_tuple__53);
 
   /* "View.MemoryView":705
  *     for suboffset in suboffsets[:ndim]:
  *         if suboffset >= 0:
  *             raise ValueError("Indirect dimensions not supported")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__48 = PyTuple_Pack(1, __pyx_kp_s_Indirect_dimensions_not_supporte); if (unlikely(!__pyx_tuple__48)) __PYX_ERR(1, 705, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__48);
-  __Pyx_GIVEREF(__pyx_tuple__48);
+  __pyx_tuple__54 = PyTuple_Pack(1, __pyx_kp_s_Indirect_dimensions_not_supporte); if (unlikely(!__pyx_tuple__54)) __PYX_ERR(1, 705, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__54);
+  __Pyx_GIVEREF(__pyx_tuple__54);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__49 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__49);
-  __Pyx_GIVEREF(__pyx_tuple__49);
+  __pyx_tuple__55 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__55)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__55);
+  __Pyx_GIVEREF(__pyx_tuple__55);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__50 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__50)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__50);
-  __Pyx_GIVEREF(__pyx_tuple__50);
-  __pyx_tuple__51 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__51);
-  __Pyx_GIVEREF(__pyx_tuple__51);
+  __pyx_tuple__56 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__56)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__56);
+  __Pyx_GIVEREF(__pyx_tuple__56);
+  __pyx_tuple__57 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__57)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__57);
+  __Pyx_GIVEREF(__pyx_tuple__57);
 
-  /* "sat_toolkit/_cnf_util.pyx":185
+  /* "sat_toolkit/formula.pyx":284
  * 
  *     @staticmethod
  *     def from_dimacs(dimacs: str) -> CNF:             # <<<<<<<<<<<<<<
  *         return CNF._from_dimacs(dimacs.encode())
  * 
  */
-  __pyx_tuple__58 = PyTuple_Pack(1, __pyx_n_s_dimacs); if (unlikely(!__pyx_tuple__58)) __PYX_ERR(0, 185, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__58);
-  __Pyx_GIVEREF(__pyx_tuple__58);
-  __pyx_codeobj__59 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__58, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit__cnf_util_pyx, __pyx_n_s_from_dimacs, 185, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__59)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_tuple__64 = PyTuple_Pack(1, __pyx_n_s_dimacs); if (unlikely(!__pyx_tuple__64)) __PYX_ERR(0, 284, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__64);
+  __Pyx_GIVEREF(__pyx_tuple__64);
+  __pyx_codeobj__65 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__64, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit_formula_pyx, __pyx_n_s_from_dimacs, 284, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__65)) __PYX_ERR(0, 284, __pyx_L1_error)
 
-  /* "sat_toolkit/_cnf_util.pyx":189
+  /* "sat_toolkit/formula.pyx":288
  * 
  *     @staticmethod
  *     def from_espresso(espresso: str) -> CNF:             # <<<<<<<<<<<<<<
  *         cdef vector[int] clauses
  *         cdef vector[size_t] start_indices
  */
-  __pyx_tuple__61 = PyTuple_Pack(14, __pyx_n_s_espresso, __pyx_n_s_clauses, __pyx_n_s_start_indices, __pyx_n_s_line, __pyx_n_s_val, __pyx_n_s_mask, __pyx_n_s_sign, __pyx_n_s_numbits, __pyx_n_s_i_2, __pyx_n_s_f, __pyx_n_s_line_py, __pyx_n_s__60, __pyx_n_s_bits, __pyx_n_s_res); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 189, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__61);
-  __Pyx_GIVEREF(__pyx_tuple__61);
-  __pyx_codeobj__62 = (PyObject*)__Pyx_PyCode_New(1, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__61, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit__cnf_util_pyx, __pyx_n_s_from_espresso, 189, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__62)) __PYX_ERR(0, 189, __pyx_L1_error)
+  __pyx_tuple__67 = PyTuple_Pack(14, __pyx_n_s_espresso, __pyx_n_s_clauses, __pyx_n_s_start_indices, __pyx_n_s_line, __pyx_n_s_val, __pyx_n_s_mask, __pyx_n_s_sign, __pyx_n_s_numbits, __pyx_n_s_i_2, __pyx_n_s_f, __pyx_n_s_line_py, __pyx_n_s__66, __pyx_n_s_bits, __pyx_n_s_res); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 288, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__67);
+  __Pyx_GIVEREF(__pyx_tuple__67);
+  __pyx_codeobj__68 = (PyObject*)__Pyx_PyCode_New(1, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__67, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit_formula_pyx, __pyx_n_s_from_espresso, 288, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__68)) __PYX_ERR(0, 288, __pyx_L1_error)
+
+  /* "sat_toolkit/formula.pyx":340
+ * 
+ *     @staticmethod
+ *     def create_all_zero(const int[:] indices not None) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         creates a CNF that asserts that all variables for the provided indices
+ */
+  __pyx_tuple__69 = PyTuple_Pack(6, __pyx_n_s_indices, __pyx_n_s_clauses, __pyx_n_s_i_2, __pyx_n_s_l, __pyx_n_s_val, __pyx_n_s_res); if (unlikely(!__pyx_tuple__69)) __PYX_ERR(0, 340, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__69);
+  __Pyx_GIVEREF(__pyx_tuple__69);
+  __pyx_codeobj__70 = (PyObject*)__Pyx_PyCode_New(1, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__69, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit_formula_pyx, __pyx_n_s_create_all_zero, 340, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__70)) __PYX_ERR(0, 340, __pyx_L1_error)
+
+  /* "sat_toolkit/formula.pyx":365
+ * 
+ *     @staticmethod
+ *     def create_all_equal(const int[:] lhs not None, const int[:] rhs not None) -> CNF:             # <<<<<<<<<<<<<<
+ *         "creates a CNF that asserts lhs[i] == rhs[i] for all i."
+ *         cdef vector[int] clauses
+ */
+  __pyx_tuple__71 = PyTuple_Pack(8, __pyx_n_s_lhs, __pyx_n_s_rhs, __pyx_n_s_clauses, __pyx_n_s_i_2, __pyx_n_s_length, __pyx_n_s_l, __pyx_n_s_r, __pyx_n_s_res); if (unlikely(!__pyx_tuple__71)) __PYX_ERR(0, 365, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__71);
+  __Pyx_GIVEREF(__pyx_tuple__71);
+  __pyx_codeobj__72 = (PyObject*)__Pyx_PyCode_New(2, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__71, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit_formula_pyx, __pyx_n_s_create_all_equal, 365, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__72)) __PYX_ERR(0, 365, __pyx_L1_error)
+
+  /* "sat_toolkit/formula.pyx":436
+ * 
+ *     @staticmethod
+ *     def create_xor(*args, rhs=None) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         creates a CNF specifying the xor of the arguments is equal to the right
+ */
+  __pyx_tuple__73 = PyTuple_Pack(7, __pyx_n_s_rhs, __pyx_n_s_args, __pyx_n_s_num_args, __pyx_n_s_num_xors, __pyx_n_s_i_2, __pyx_n_s_packed_args, __pyx_n_s_arg); if (unlikely(!__pyx_tuple__73)) __PYX_ERR(0, 436, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__73);
+  __Pyx_GIVEREF(__pyx_tuple__73);
+  __pyx_codeobj__74 = (PyObject*)__Pyx_PyCode_New(0, 1, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__73, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_sat_toolkit_formula_pyx, __pyx_n_s_create_xor, 436, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__74)) __PYX_ERR(0, 436, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Clause(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_tuple__63 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__63)) __PYX_ERR(1, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__63);
-  __Pyx_GIVEREF(__pyx_tuple__63);
-  __pyx_codeobj__64 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__63, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Clause, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__64)) __PYX_ERR(1, 1, __pyx_L1_error)
-  __pyx_tuple__65 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(1, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__65);
-  __Pyx_GIVEREF(__pyx_tuple__65);
-  __pyx_codeobj__66 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__65, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Truthtable, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__66)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_tuple__75 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__75)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__75);
+  __Pyx_GIVEREF(__pyx_tuple__75);
+  __pyx_codeobj__76 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__75, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Clause, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__76)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_tuple__77 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__77)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__77);
+  __Pyx_GIVEREF(__pyx_tuple__77);
+  __pyx_codeobj__78 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__77, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Truthtable, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__78)) __PYX_ERR(1, 1, __pyx_L1_error)
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
  */
-  __pyx_tuple__67 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct_or_indirect); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(1, 287, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__67);
-  __Pyx_GIVEREF(__pyx_tuple__67);
+  __pyx_tuple__79 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct_or_indirect); if (unlikely(!__pyx_tuple__79)) __PYX_ERR(1, 287, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__79);
+  __Pyx_GIVEREF(__pyx_tuple__79);
 
   /* "View.MemoryView":288
  * 
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default             # <<<<<<<<<<<<<<
  * cdef indirect = Enum("<strided and indirect>")
  * 
  */
-  __pyx_tuple__68 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct); if (unlikely(!__pyx_tuple__68)) __PYX_ERR(1, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__68);
-  __Pyx_GIVEREF(__pyx_tuple__68);
+  __pyx_tuple__80 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct); if (unlikely(!__pyx_tuple__80)) __PYX_ERR(1, 288, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__80);
+  __Pyx_GIVEREF(__pyx_tuple__80);
 
   /* "View.MemoryView":289
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__69 = PyTuple_Pack(1, __pyx_kp_s_strided_and_indirect); if (unlikely(!__pyx_tuple__69)) __PYX_ERR(1, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__69);
-  __Pyx_GIVEREF(__pyx_tuple__69);
+  __pyx_tuple__81 = PyTuple_Pack(1, __pyx_kp_s_strided_and_indirect); if (unlikely(!__pyx_tuple__81)) __PYX_ERR(1, 289, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__81);
+  __Pyx_GIVEREF(__pyx_tuple__81);
 
   /* "View.MemoryView":292
  * 
  * 
  * cdef contiguous = Enum("<contiguous and direct>")             # <<<<<<<<<<<<<<
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")
  * 
  */
-  __pyx_tuple__70 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_direct); if (unlikely(!__pyx_tuple__70)) __PYX_ERR(1, 292, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__70);
-  __Pyx_GIVEREF(__pyx_tuple__70);
+  __pyx_tuple__82 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_direct); if (unlikely(!__pyx_tuple__82)) __PYX_ERR(1, 292, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__82);
+  __Pyx_GIVEREF(__pyx_tuple__82);
 
   /* "View.MemoryView":293
  * 
  * cdef contiguous = Enum("<contiguous and direct>")
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__71 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_indirect); if (unlikely(!__pyx_tuple__71)) __PYX_ERR(1, 293, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__71);
-  __Pyx_GIVEREF(__pyx_tuple__71);
+  __pyx_tuple__83 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_indirect); if (unlikely(!__pyx_tuple__83)) __PYX_ERR(1, 293, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__83);
+  __Pyx_GIVEREF(__pyx_tuple__83);
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Enum(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_tuple__72 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__72)) __PYX_ERR(1, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__72);
-  __Pyx_GIVEREF(__pyx_tuple__72);
-  __pyx_codeobj__73 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__72, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Enum, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__73)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_tuple__84 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__84)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__84);
+  __Pyx_GIVEREF(__pyx_tuple__84);
+  __pyx_codeobj__85 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__84, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Enum, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__85)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
+  /* AssertionsEnabled.init */
+  __Pyx_init_assertions_enabled();
+
+if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1, __pyx_L1_error)
+
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_67514187 = PyInt_FromLong(67514187L); if (unlikely(!__pyx_int_67514187)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_80070801 = PyInt_FromLong(80070801L); if (unlikely(!__pyx_int_80070801)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_112105877 = PyInt_FromLong(112105877L); if (unlikely(!__pyx_int_112105877)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_136945605 = PyInt_FromLong(136945605L); if (unlikely(!__pyx_int_136945605)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -33296,68 +38832,91 @@
 static int __Pyx_modinit_type_init_code(void) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
   /*--- Type init code ---*/
-  __pyx_vtabptr_11sat_toolkit_9_cnf_util_Clause = &__pyx_vtable_11sat_toolkit_9_cnf_util_Clause;
-  __pyx_vtable_11sat_toolkit_9_cnf_util_Clause.from_memview = (struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *(*)(__Pyx_memviewslice))__pyx_f_11sat_toolkit_9_cnf_util_6Clause_from_memview;
-  __pyx_vtable_11sat_toolkit_9_cnf_util_Clause._maxvar = (size_t (*)(struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *))__pyx_f_11sat_toolkit_9_cnf_util_6Clause__maxvar;
-  if (PyType_Ready(&__pyx_type_11sat_toolkit_9_cnf_util_Clause) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_vtabptr_11sat_toolkit_7formula_Clause = &__pyx_vtable_11sat_toolkit_7formula_Clause;
+  __pyx_vtable_11sat_toolkit_7formula_Clause.from_memview = (struct __pyx_obj_11sat_toolkit_7formula_Clause *(*)(__Pyx_memviewslice))__pyx_f_11sat_toolkit_7formula_6Clause_from_memview;
+  __pyx_vtable_11sat_toolkit_7formula_Clause._maxvar = (size_t (*)(struct __pyx_obj_11sat_toolkit_7formula_Clause *))__pyx_f_11sat_toolkit_7formula_6Clause__maxvar;
+  __pyx_vtable_11sat_toolkit_7formula_Clause._get_absolute_index = (size_t (*)(struct __pyx_obj_11sat_toolkit_7formula_Clause *, Py_ssize_t))__pyx_f_11sat_toolkit_7formula_6Clause__get_absolute_index;
+  __pyx_vtable_11sat_toolkit_7formula_Clause._get_slice_index = (size_t (*)(struct __pyx_obj_11sat_toolkit_7formula_Clause *, Py_ssize_t))__pyx_f_11sat_toolkit_7formula_6Clause__get_slice_index;
+  if (PyType_Ready(&__pyx_type_11sat_toolkit_7formula_Clause) < 0) __PYX_ERR(0, 62, __pyx_L1_error)
+  #if PY_VERSION_HEX < 0x030800B1
+  __pyx_type_11sat_toolkit_7formula_Clause.tp_print = 0;
+  #endif
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_7formula_Clause.tp_dictoffset && __pyx_type_11sat_toolkit_7formula_Clause.tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_type_11sat_toolkit_7formula_Clause.tp_getattro = __Pyx_PyObject_GenericGetAttr;
+  }
+  if (__Pyx_SetVtable(__pyx_type_11sat_toolkit_7formula_Clause.tp_dict, __pyx_vtabptr_11sat_toolkit_7formula_Clause) < 0) __PYX_ERR(0, 62, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Clause_2, (PyObject *)&__pyx_type_11sat_toolkit_7formula_Clause) < 0) __PYX_ERR(0, 62, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11sat_toolkit_7formula_Clause) < 0) __PYX_ERR(0, 62, __pyx_L1_error)
+  __pyx_ptype_11sat_toolkit_7formula_Clause = &__pyx_type_11sat_toolkit_7formula_Clause;
+  __pyx_vtabptr_11sat_toolkit_7formula_CNF = &__pyx_vtable_11sat_toolkit_7formula_CNF;
+  __pyx_vtable_11sat_toolkit_7formula_CNF._from_dimacs = (struct __pyx_obj_11sat_toolkit_7formula_CNF *(*)(__Pyx_memviewslice))__pyx_f_11sat_toolkit_7formula_3CNF__from_dimacs;
+  __pyx_vtable_11sat_toolkit_7formula_CNF._create_xor = (struct __pyx_obj_11sat_toolkit_7formula_CNF *(*)(__Pyx_memviewslice))__pyx_f_11sat_toolkit_7formula_3CNF__create_xor;
+  __pyx_vtable_11sat_toolkit_7formula_CNF._add_clauses = (int (*)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, __Pyx_memviewslice))__pyx_f_11sat_toolkit_7formula_3CNF__add_clauses;
+  __pyx_vtable_11sat_toolkit_7formula_CNF._check_solution = (int (*)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, __Pyx_memviewslice))__pyx_f_11sat_toolkit_7formula_3CNF__check_solution;
+  __pyx_vtable_11sat_toolkit_7formula_CNF._check_solution_for_single_clause = (int (*)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, size_t, __Pyx_memviewslice))__pyx_f_11sat_toolkit_7formula_3CNF__check_solution_for_single_clause;
+  __pyx_vtable_11sat_toolkit_7formula_CNF.get_clause = (struct __pyx_obj_11sat_toolkit_7formula_Clause *(*)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, Py_ssize_t))__pyx_f_11sat_toolkit_7formula_3CNF_get_clause;
+  __pyx_vtable_11sat_toolkit_7formula_CNF._compare_clause = (int (*)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, size_t, struct __pyx_obj_11sat_toolkit_7formula_Clause *))__pyx_f_11sat_toolkit_7formula_3CNF__compare_clause;
+  __pyx_vtable_11sat_toolkit_7formula_CNF._get_slice_index = (size_t (*)(struct __pyx_obj_11sat_toolkit_7formula_CNF *, Py_ssize_t))__pyx_f_11sat_toolkit_7formula_3CNF__get_slice_index;
+  if (PyType_Ready(&__pyx_type_11sat_toolkit_7formula_CNF) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
-  __pyx_type_11sat_toolkit_9_cnf_util_Clause.tp_print = 0;
+  __pyx_type_11sat_toolkit_7formula_CNF.tp_print = 0;
   #endif
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_9_cnf_util_Clause.tp_dictoffset && __pyx_type_11sat_toolkit_9_cnf_util_Clause.tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_type_11sat_toolkit_9_cnf_util_Clause.tp_getattro = __Pyx_PyObject_GenericGetAttr;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_7formula_CNF.tp_dictoffset && __pyx_type_11sat_toolkit_7formula_CNF.tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_type_11sat_toolkit_7formula_CNF.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_11sat_toolkit_9_cnf_util_Clause.tp_dict, __pyx_vtabptr_11sat_toolkit_9_cnf_util_Clause) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Clause_2, (PyObject *)&__pyx_type_11sat_toolkit_9_cnf_util_Clause) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11sat_toolkit_9_cnf_util_Clause) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
-  __pyx_ptype_11sat_toolkit_9_cnf_util_Clause = &__pyx_type_11sat_toolkit_9_cnf_util_Clause;
-  __pyx_vtabptr_11sat_toolkit_9_cnf_util_CNF = &__pyx_vtable_11sat_toolkit_9_cnf_util_CNF;
-  __pyx_vtable_11sat_toolkit_9_cnf_util_CNF._from_dimacs = (struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *(*)(__Pyx_memviewslice))__pyx_f_11sat_toolkit_9_cnf_util_3CNF__from_dimacs;
-  __pyx_vtable_11sat_toolkit_9_cnf_util_CNF._add_clauses = (void (*)(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *, __Pyx_memviewslice))__pyx_f_11sat_toolkit_9_cnf_util_3CNF__add_clauses;
-  __pyx_vtable_11sat_toolkit_9_cnf_util_CNF.get_clause = (struct __pyx_obj_11sat_toolkit_9_cnf_util_Clause *(*)(struct __pyx_obj_11sat_toolkit_9_cnf_util_CNF *, Py_ssize_t))__pyx_f_11sat_toolkit_9_cnf_util_3CNF_get_clause;
-  if (PyType_Ready(&__pyx_type_11sat_toolkit_9_cnf_util_CNF) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_11sat_toolkit_7formula_CNF.tp_dict, __pyx_vtabptr_11sat_toolkit_7formula_CNF) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_CNF, (PyObject *)&__pyx_type_11sat_toolkit_7formula_CNF) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_ptype_11sat_toolkit_7formula_CNF = &__pyx_type_11sat_toolkit_7formula_CNF;
+  if (PyType_Ready(&__pyx_type_11sat_toolkit_7formula_Truthtable) < 0) __PYX_ERR(0, 990, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
-  __pyx_type_11sat_toolkit_9_cnf_util_CNF.tp_print = 0;
+  __pyx_type_11sat_toolkit_7formula_Truthtable.tp_print = 0;
   #endif
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_9_cnf_util_CNF.tp_dictoffset && __pyx_type_11sat_toolkit_9_cnf_util_CNF.tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_type_11sat_toolkit_9_cnf_util_CNF.tp_getattro = __Pyx_PyObject_GenericGetAttr;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_7formula_Truthtable.tp_dictoffset && __pyx_type_11sat_toolkit_7formula_Truthtable.tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_type_11sat_toolkit_7formula_Truthtable.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_11sat_toolkit_9_cnf_util_CNF.tp_dict, __pyx_vtabptr_11sat_toolkit_9_cnf_util_CNF) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_CNF, (PyObject *)&__pyx_type_11sat_toolkit_9_cnf_util_CNF) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
-  __pyx_ptype_11sat_toolkit_9_cnf_util_CNF = &__pyx_type_11sat_toolkit_9_cnf_util_CNF;
-  if (PyType_Ready(&__pyx_type_11sat_toolkit_9_cnf_util_Truthtable) < 0) __PYX_ERR(0, 566, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Truthtable_2, (PyObject *)&__pyx_type_11sat_toolkit_7formula_Truthtable) < 0) __PYX_ERR(0, 990, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11sat_toolkit_7formula_Truthtable) < 0) __PYX_ERR(0, 990, __pyx_L1_error)
+  __pyx_ptype_11sat_toolkit_7formula_Truthtable = &__pyx_type_11sat_toolkit_7formula_Truthtable;
+  if (PyType_Ready(&__pyx_type_11sat_toolkit_7formula___pyx_scope_struct____iter__) < 0) __PYX_ERR(0, 164, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
-  __pyx_type_11sat_toolkit_9_cnf_util_Truthtable.tp_print = 0;
+  __pyx_type_11sat_toolkit_7formula___pyx_scope_struct____iter__.tp_print = 0;
   #endif
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_9_cnf_util_Truthtable.tp_dictoffset && __pyx_type_11sat_toolkit_9_cnf_util_Truthtable.tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_type_11sat_toolkit_9_cnf_util_Truthtable.tp_getattro = __Pyx_PyObject_GenericGetAttr;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_7formula___pyx_scope_struct____iter__.tp_dictoffset && __pyx_type_11sat_toolkit_7formula___pyx_scope_struct____iter__.tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_type_11sat_toolkit_7formula___pyx_scope_struct____iter__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Truthtable_2, (PyObject *)&__pyx_type_11sat_toolkit_9_cnf_util_Truthtable) < 0) __PYX_ERR(0, 566, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11sat_toolkit_9_cnf_util_Truthtable) < 0) __PYX_ERR(0, 566, __pyx_L1_error)
-  __pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable = &__pyx_type_11sat_toolkit_9_cnf_util_Truthtable;
-  if (PyType_Ready(&__pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct____iter__ = &__pyx_type_11sat_toolkit_7formula___pyx_scope_struct____iter__;
+  if (PyType_Ready(&__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__) < 0) __PYX_ERR(0, 169, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
-  __pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__.tp_print = 0;
+  __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__.tp_print = 0;
   #endif
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__.tp_dictoffset && __pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__.tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__.tp_dictoffset && __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__.tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
-  __pyx_ptype_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__ = &__pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct____iter__;
-  if (PyType_Ready(&__pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__) < 0) __PYX_ERR(0, 472, __pyx_L1_error)
+  __pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__ = &__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_1___reversed__;
+  if (PyType_Ready(&__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_2___iter__) < 0) __PYX_ERR(0, 791, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
-  __pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__.tp_print = 0;
+  __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_2___iter__.tp_print = 0;
   #endif
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__.tp_dictoffset && __pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__.tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_2___iter__.tp_dictoffset && __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_2___iter__.tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_2___iter__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
-  __pyx_ptype_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__ = &__pyx_type_11sat_toolkit_9_cnf_util___pyx_scope_struct_1___iter__;
+  __pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_2___iter__ = &__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_2___iter__;
+  if (PyType_Ready(&__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__) < 0) __PYX_ERR(0, 797, __pyx_L1_error)
+  #if PY_VERSION_HEX < 0x030800B1
+  __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__.tp_print = 0;
+  #endif
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__.tp_dictoffset && __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__.tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_type_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  }
+  __pyx_ptype_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__ = &__pyx_type_11sat_toolkit_7formula___pyx_scope_struct_3___reversed__;
   __pyx_vtabptr_array = &__pyx_vtable_array;
   __pyx_vtable_array.get_memview = (PyObject *(*)(struct __pyx_array_obj *))__pyx_array_get_memview;
   if (PyType_Ready(&__pyx_type___pyx_array) < 0) __PYX_ERR(1, 106, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type___pyx_array.tp_print = 0;
   #endif
   if (__Pyx_SetVtable(__pyx_type___pyx_array.tp_dict, __pyx_vtabptr_array) < 0) __PYX_ERR(1, 106, __pyx_L1_error)
@@ -33410,18 +38969,44 @@
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static int __Pyx_modinit_type_import_code(void) {
   __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
+  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 9, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_36(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyTypeObject),
+  #else
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyHeapTypeObject),
+  #endif
+  __Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(2, 9, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 8, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_ptype_7cpython_4bool_bool = __Pyx_ImportType_0_29_36(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "bool", sizeof(PyBoolObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyBoolObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_7cpython_4bool_bool) __PYX_ERR(3, 8, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 15, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_ptype_7cpython_7complex_complex = __Pyx_ImportType_0_29_36(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "complex", sizeof(PyComplexObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyComplexObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_7cpython_7complex_complex) __PYX_ERR(4, 15, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_RefNannyFinishContext();
+  return -1;
 }
 
 static int __Pyx_modinit_variable_import_code(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_modinit_variable_import_code", 0);
   /*--- Variable import code ---*/
   __Pyx_RefNannyFinishContext();
@@ -33451,19 +39036,19 @@
 #else
 #define __Pyx_PyMODINIT_FUNC PyObject *
 #endif
 #endif
 
 
 #if PY_MAJOR_VERSION < 3
-__Pyx_PyMODINIT_FUNC init_cnf_util(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC init_cnf_util(void)
+__Pyx_PyMODINIT_FUNC initformula(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC initformula(void)
 #else
-__Pyx_PyMODINIT_FUNC PyInit__cnf_util(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC PyInit__cnf_util(void)
+__Pyx_PyMODINIT_FUNC PyInit_formula(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC PyInit_formula(void)
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 {
   return PyModuleDef_Init(&__pyx_moduledef);
 }
 static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
     #if PY_VERSION_HEX >= 0x030700A1
     static PY_INT64_T main_interpreter_id = -1;
@@ -33522,47 +39107,47 @@
     return module;
 bad:
     Py_XDECREF(module);
     return NULL;
 }
 
 
-static CYTHON_SMALL_CODE int __pyx_pymod_exec__cnf_util(PyObject *__pyx_pyinit_module)
+static CYTHON_SMALL_CODE int __pyx_pymod_exec_formula(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
-  __Pyx_memviewslice __pyx_t_3 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   static PyThread_type_lock __pyx_t_6[8];
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
-    PyErr_SetString(PyExc_RuntimeError, "Module '_cnf_util' has already been imported. Re-initialisation is not supported.");
+    PyErr_SetString(PyExc_RuntimeError, "Module 'formula' has already been imported. Re-initialisation is not supported.");
     return -1;
   }
   #elif PY_MAJOR_VERSION >= 3
   if (__pyx_m) return __Pyx_NewRef(__pyx_m);
   #endif
   #if CYTHON_REFNANNY
 __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
 if (!__Pyx_RefNanny) {
   PyErr_Clear();
   __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
   if (!__Pyx_RefNanny)
       Py_FatalError("failed to import 'refnanny' module");
 }
 #endif
-  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit__cnf_util(void)", 0);
+  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_formula(void)", 0);
   if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pxy_PyFrame_Initialize_Offsets
   __Pxy_PyFrame_Initialize_Offsets();
   #endif
   __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -33591,15 +39176,15 @@
   #endif
   /*--- Module creation code ---*/
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   __pyx_m = __pyx_pyinit_module;
   Py_INCREF(__pyx_m);
   #else
   #if PY_MAJOR_VERSION < 3
-  __pyx_m = Py_InitModule4("_cnf_util", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
+  __pyx_m = Py_InitModule4("formula", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
   #else
   __pyx_m = PyModule_Create(&__pyx_moduledef);
   #endif
   if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
   Py_INCREF(__pyx_d);
@@ -33609,371 +39194,568 @@
   Py_INCREF(__pyx_cython_runtime);
   if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  if (__pyx_module_is_main_sat_toolkit___cnf_util) {
+  if (__pyx_module_is_main_sat_toolkit__formula) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name_2, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   }
   #if PY_MAJOR_VERSION >= 3
   {
     PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
-    if (!PyDict_GetItemString(modules, "sat_toolkit._cnf_util")) {
-      if (unlikely(PyDict_SetItemString(modules, "sat_toolkit._cnf_util", __pyx_m) < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
+    if (!PyDict_GetItemString(modules, "sat_toolkit.formula")) {
+      if (unlikely(PyDict_SetItemString(modules, "sat_toolkit.formula", __pyx_m) < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
     }
   }
   #endif
   /*--- Builtin init code ---*/
   if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Global type/function init code ---*/
   (void)__Pyx_modinit_global_init_code();
   (void)__Pyx_modinit_variable_export_code();
   (void)__Pyx_modinit_function_export_code();
   if (unlikely(__Pyx_modinit_type_init_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
-  (void)__Pyx_modinit_type_import_code();
+  if (unlikely(__Pyx_modinit_type_import_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "sat_toolkit/_cnf_util.pyx":31
+  /* "sat_toolkit/formula.pyx":36
  * 
  * 
  * import io, sys             # <<<<<<<<<<<<<<
  * import numpy as np
  * import subprocess as sp
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_io, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 31, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_io, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_io, __pyx_t_1) < 0) __PYX_ERR(0, 31, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_io, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sys, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 31, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sys, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_1) < 0) __PYX_ERR(0, 31, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":32
+  /* "sat_toolkit/formula.pyx":37
  * 
  * import io, sys
  * import numpy as np             # <<<<<<<<<<<<<<
  * import subprocess as sp
  * from tempfile import NamedTemporaryFile
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":33
+  /* "sat_toolkit/formula.pyx":38
  * import io, sys
  * import numpy as np
  * import subprocess as sp             # <<<<<<<<<<<<<<
  * from tempfile import NamedTemporaryFile
- * from typing import *
+ * import collections
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_subprocess, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 33, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_subprocess, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 38, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sp, __pyx_t_1) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sp, __pyx_t_1) < 0) __PYX_ERR(0, 38, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":34
+  /* "sat_toolkit/formula.pyx":39
  * import numpy as np
  * import subprocess as sp
  * from tempfile import NamedTemporaryFile             # <<<<<<<<<<<<<<
- * from typing import *
+ * import collections
  * 
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_n_s_NamedTemporaryFile);
   __Pyx_GIVEREF(__pyx_n_s_NamedTemporaryFile);
   PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_NamedTemporaryFile);
-  __pyx_t_2 = __Pyx_Import(__pyx_n_s_tempfile, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_tempfile, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_NamedTemporaryFile); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_NamedTemporaryFile); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NamedTemporaryFile, __pyx_t_1) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NamedTemporaryFile, __pyx_t_1) < 0) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":35
+  /* "sat_toolkit/formula.pyx":40
  * import subprocess as sp
  * from tempfile import NamedTemporaryFile
- * from typing import *             # <<<<<<<<<<<<<<
+ * import collections             # <<<<<<<<<<<<<<
  * 
- * from dataclasses import dataclass
+ * from typing import TYPE_CHECKING
+ */
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_collections, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_collections, __pyx_t_2) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "sat_toolkit/formula.pyx":42
+ * import collections
+ * 
+ * from typing import TYPE_CHECKING             # <<<<<<<<<<<<<<
+ * if TYPE_CHECKING:
+ *     from typing import *
  */
-  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 35, __pyx_L1_error)
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 42, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(__pyx_n_s__57);
-  __Pyx_GIVEREF(__pyx_n_s__57);
-  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s__57);
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_typing, __pyx_t_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 35, __pyx_L1_error)
+  __Pyx_INCREF(__pyx_n_s_TYPE_CHECKING);
+  __Pyx_GIVEREF(__pyx_n_s_TYPE_CHECKING);
+  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_TYPE_CHECKING);
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_typing, __pyx_t_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 42, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__pyx_import_star(__pyx_t_1) < 0) __PYX_ERR(0, 35, __pyx_L1_error);
+  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_TYPE_CHECKING); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 42, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_TYPE_CHECKING, __pyx_t_2) < 0) __PYX_ERR(0, 42, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":37
- * from typing import *
+  /* "sat_toolkit/formula.pyx":43
  * 
- * from dataclasses import dataclass             # <<<<<<<<<<<<<<
+ * from typing import TYPE_CHECKING
+ * if TYPE_CHECKING:             # <<<<<<<<<<<<<<
+ *     from typing import *
  * 
- * cdef int startswith(const unsigned char[:] buf, const char *start) nogil:
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_TYPE_CHECKING); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (__pyx_t_3) {
+
+    /* "sat_toolkit/formula.pyx":44
+ * from typing import TYPE_CHECKING
+ * if TYPE_CHECKING:
+ *     from typing import *             # <<<<<<<<<<<<<<
+ * 
+ * from dataclasses import dataclass
+ */
+    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 44, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(__pyx_n_s__63);
+    __Pyx_GIVEREF(__pyx_n_s__63);
+    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s__63);
+    __pyx_t_2 = __Pyx_Import(__pyx_n_s_typing, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 44, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    if (__pyx_import_star(__pyx_t_2) < 0) __PYX_ERR(0, 44, __pyx_L1_error);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+    /* "sat_toolkit/formula.pyx":43
+ * 
+ * from typing import TYPE_CHECKING
+ * if TYPE_CHECKING:             # <<<<<<<<<<<<<<
+ *     from typing import *
+ * 
+ */
+  }
+
+  /* "sat_toolkit/formula.pyx":46
+ *     from typing import *
+ * 
+ * from dataclasses import dataclass             # <<<<<<<<<<<<<<
+ * 
+ * __all__ = ['Clause', 'CNF', 'Truthtable']
+ */
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_n_s_dataclass);
   __Pyx_GIVEREF(__pyx_n_s_dataclass);
-  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_dataclass);
-  __pyx_t_2 = __Pyx_Import(__pyx_n_s_dataclasses, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 37, __pyx_L1_error)
+  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_dataclass);
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_dataclasses, __pyx_t_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_dataclass); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dataclass, __pyx_t_2) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_dataclass); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
+
+  /* "sat_toolkit/formula.pyx":48
+ * from dataclasses import dataclass
+ * 
+ * __all__ = ['Clause', 'CNF', 'Truthtable']             # <<<<<<<<<<<<<<
+ * 
+ * cdef int startswith(const unsigned char[:] buf, const char *start) nogil:
+ */
+  __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 48, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dataclass, __pyx_t_1) < 0) __PYX_ERR(0, 37, __pyx_L1_error)
+  __Pyx_INCREF(__pyx_n_u_Clause_2);
+  __Pyx_GIVEREF(__pyx_n_u_Clause_2);
+  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_Clause_2);
+  __Pyx_INCREF(__pyx_n_u_CNF);
+  __Pyx_GIVEREF(__pyx_n_u_CNF);
+  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_CNF);
+  __Pyx_INCREF(__pyx_n_u_Truthtable_2);
+  __Pyx_GIVEREF(__pyx_n_u_Truthtable_2);
+  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_u_Truthtable_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_all_2, __pyx_t_1) < 0) __PYX_ERR(0, 48, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":139
- *         pass
+  /* "sat_toolkit/formula.pyx":217
+ *         return self.clause == other_clause.clause
+ * 
+ * collections.abc.Sequence.register(Clause)             # <<<<<<<<<<<<<<
+ * 
  * 
- *     def __cinit__(self, int[:] clauses = None, int nvars = -1):             # <<<<<<<<<<<<<<
- *         cdef ssize_t i, l = 0
- *         if clauses is not None:
  */
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(Py_None, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 139, __pyx_L1_error)
-  __pyx_k__5 = __pyx_t_3;
-  __pyx_t_3.memview = NULL;
-  __pyx_t_3.data = NULL;
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_collections); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 217, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_abc); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 217, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_Sequence); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 217, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_register); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 217, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_ptype_11sat_toolkit_7formula_Clause)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 217, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":185
+  /* "sat_toolkit/formula.pyx":284
  * 
  *     @staticmethod
  *     def from_dimacs(dimacs: str) -> CNF:             # <<<<<<<<<<<<<<
  *         return CNF._from_dimacs(dimacs.encode())
  * 
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_9_cnf_util_3CNF_5from_dimacs, NULL, __pyx_n_s_sat_toolkit__cnf_util); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 185, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF->tp_dict, __pyx_n_s_from_dimacs, __pyx_t_2) < 0) __PYX_ERR(0, 185, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  PyType_Modified(__pyx_ptype_11sat_toolkit_9_cnf_util_CNF);
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_7formula_3CNF_5from_dimacs, NULL, __pyx_n_s_sat_toolkit_formula); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 284, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_from_dimacs, __pyx_t_1) < 0) __PYX_ERR(0, 284, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
 
-  /* "sat_toolkit/_cnf_util.pyx":184
+  /* "sat_toolkit/formula.pyx":283
  *         return res
  * 
  *     @staticmethod             # <<<<<<<<<<<<<<
  *     def from_dimacs(dimacs: str) -> CNF:
  *         return CNF._from_dimacs(dimacs.encode())
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF, __pyx_n_s_from_dimacs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 185, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF, __pyx_n_s_from_dimacs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 284, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF->tp_dict, __pyx_n_s_from_dimacs, __pyx_t_1) < 0) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 283, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  PyType_Modified(__pyx_ptype_11sat_toolkit_9_cnf_util_CNF);
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_from_dimacs, __pyx_t_2) < 0) __PYX_ERR(0, 284, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
 
-  /* "sat_toolkit/_cnf_util.pyx":189
+  /* "sat_toolkit/formula.pyx":288
  * 
  *     @staticmethod
  *     def from_espresso(espresso: str) -> CNF:             # <<<<<<<<<<<<<<
  *         cdef vector[int] clauses
  *         cdef vector[size_t] start_indices
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_9_cnf_util_3CNF_7from_espresso, NULL, __pyx_n_s_sat_toolkit__cnf_util); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF->tp_dict, __pyx_n_s_from_espresso, __pyx_t_1) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  PyType_Modified(__pyx_ptype_11sat_toolkit_9_cnf_util_CNF);
+  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_7formula_3CNF_7from_espresso, NULL, __pyx_n_s_sat_toolkit_formula); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 288, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_from_espresso, __pyx_t_2) < 0) __PYX_ERR(0, 288, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
 
-  /* "sat_toolkit/_cnf_util.pyx":188
+  /* "sat_toolkit/formula.pyx":287
  *         return CNF._from_dimacs(dimacs.encode())
  * 
  *     @staticmethod             # <<<<<<<<<<<<<<
  *     def from_espresso(espresso: str) -> CNF:
  *         cdef vector[int] clauses
  */
-  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF, __pyx_n_s_from_espresso); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF, __pyx_n_s_from_espresso); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 288, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 287, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_from_espresso, __pyx_t_1) < 0) __PYX_ERR(0, 288, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
+
+  /* "sat_toolkit/formula.pyx":340
+ * 
+ *     @staticmethod
+ *     def create_all_zero(const int[:] indices not None) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         creates a CNF that asserts that all variables for the provided indices
+ */
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_7formula_3CNF_9create_all_zero, NULL, __pyx_n_s_sat_toolkit_formula); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 340, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_create_all_zero, __pyx_t_1) < 0) __PYX_ERR(0, 340, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
+
+  /* "sat_toolkit/formula.pyx":339
+ *         return res
+ * 
+ *     @staticmethod             # <<<<<<<<<<<<<<
+ *     def create_all_zero(const int[:] indices not None) -> CNF:
+ *         """
+ */
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF, __pyx_n_s_create_all_zero); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 340, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 339, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_create_all_zero, __pyx_t_2) < 0) __PYX_ERR(0, 340, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
+
+  /* "sat_toolkit/formula.pyx":365
+ * 
+ *     @staticmethod
+ *     def create_all_equal(const int[:] lhs not None, const int[:] rhs not None) -> CNF:             # <<<<<<<<<<<<<<
+ *         "creates a CNF that asserts lhs[i] == rhs[i] for all i."
+ *         cdef vector[int] clauses
+ */
+  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_7formula_3CNF_11create_all_equal, NULL, __pyx_n_s_sat_toolkit_formula); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 365, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_create_all_equal, __pyx_t_2) < 0) __PYX_ERR(0, 365, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
+
+  /* "sat_toolkit/formula.pyx":364
+ *         return res
+ * 
+ *     @staticmethod             # <<<<<<<<<<<<<<
+ *     def create_all_equal(const int[:] lhs not None, const int[:] rhs not None) -> CNF:
+ *         "creates a CNF that asserts lhs[i] == rhs[i] for all i."
+ */
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF, __pyx_n_s_create_all_equal); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 365, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 364, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_create_all_equal, __pyx_t_1) < 0) __PYX_ERR(0, 365, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
+
+  /* "sat_toolkit/formula.pyx":436
+ * 
+ *     @staticmethod
+ *     def create_xor(*args, rhs=None) -> CNF:             # <<<<<<<<<<<<<<
+ *         """
+ *         creates a CNF specifying the xor of the arguments is equal to the right
+ */
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_7formula_3CNF_13create_xor, NULL, __pyx_n_s_sat_toolkit_formula); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 436, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 188, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_create_xor, __pyx_t_1) < 0) __PYX_ERR(0, 436, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
+
+  /* "sat_toolkit/formula.pyx":435
+ *         return res
+ * 
+ *     @staticmethod             # <<<<<<<<<<<<<<
+ *     def create_xor(*args, rhs=None) -> CNF:
+ *         """
+ */
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF, __pyx_n_s_create_xor); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 436, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 435, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF->tp_dict, __pyx_n_s_from_espresso, __pyx_t_2) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_create_xor, __pyx_t_2) < 0) __PYX_ERR(0, 436, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  PyType_Modified(__pyx_ptype_11sat_toolkit_9_cnf_util_CNF);
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
 
-  /* "sat_toolkit/_cnf_util.pyx":278
+  /* "sat_toolkit/formula.pyx":512
  *         self._add_clauses(np_clause)
  * 
  *     append = add_clause             # <<<<<<<<<<<<<<
  * 
- *     def logical_or(self, int var) -> CNF:
+ *     def __iadd__(self, clauses) -> CNF:
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF, __pyx_n_s_add_clause); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 278, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF, __pyx_n_s_add_clause); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 512, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_CNF->tp_dict, __pyx_n_s_append, __pyx_t_2) < 0) __PYX_ERR(0, 278, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF->tp_dict, __pyx_n_s_append, __pyx_t_2) < 0) __PYX_ERR(0, 512, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  PyType_Modified(__pyx_ptype_11sat_toolkit_9_cnf_util_CNF);
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_CNF);
 
-  /* "sat_toolkit/_cnf_util.pyx":379
+  /* "sat_toolkit/formula.pyx":630
  *         return py_bytes.decode()
  * 
  *     def minimize_espresso(self, espresso_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses espresso to minimize the given CNF.
  */
-  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)
+  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_k__14 = __pyx_t_2;
+  __pyx_k__18 = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":425
+  /* "sat_toolkit/formula.pyx":676
  *             return CNF.from_dimacs(f.read())
  * 
  *     def minimize_lingeling(self, optlevel=None, timeout=0, extra_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses Lingeling to minimize the given CNF.
  */
-  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 425, __pyx_L1_error)
+  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 676, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_k__16 = __pyx_t_2;
+  __pyx_k__20 = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":579
+  /* "sat_toolkit/formula.pyx":987
+ *         self.view_count -= 1
+ * 
+ * collections.abc.Sequence.register(CNF)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_collections); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 987, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_abc); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 987, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Sequence); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 987, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_register); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 987, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_ptype_11sat_toolkit_7formula_CNF)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 987, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "sat_toolkit/formula.pyx":1003
  *     cdef public uint64_t numbits
  * 
  *     INIT_INDEX_SET = object()             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, init_key, numbits, on_set, dc_set):
  */
-  __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_builtin_object); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 579, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_builtin_object); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1003, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable->tp_dict, __pyx_n_s_INIT_INDEX_SET, __pyx_t_2) < 0) __PYX_ERR(0, 579, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_Truthtable->tp_dict, __pyx_n_s_INIT_INDEX_SET, __pyx_t_2) < 0) __PYX_ERR(0, 1003, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  PyType_Modified(__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable);
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_Truthtable);
 
-  /* "sat_toolkit/_cnf_util.pyx":594
+  /* "sat_toolkit/formula.pyx":1018
  * 
  *     @classmethod
- *     def from_lut(cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None):             # <<<<<<<<<<<<<<
+ *     def from_lut(cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None) -> Truthtable:             # <<<<<<<<<<<<<<
  *         """
  *         Creates a Truthtable from a lookup table (LUT).
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable, __pyx_n_s_from_lut); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11sat_toolkit_7formula_Truthtable, __pyx_n_s_from_lut); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1018, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "sat_toolkit/_cnf_util.pyx":593
+  /* "sat_toolkit/formula.pyx":1017
  * 
  * 
  *     @classmethod             # <<<<<<<<<<<<<<
- *     def from_lut(cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None):
+ *     def from_lut(cls, on_lut: np.ndarray, dc_lut: Optional[np.ndarray] = None) -> Truthtable:
  *         """
  */
-  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 593, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1017, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable->tp_dict, __pyx_n_s_from_lut, __pyx_t_1) < 0) __PYX_ERR(0, 594, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_Truthtable->tp_dict, __pyx_n_s_from_lut, __pyx_t_1) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  PyType_Modified(__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable);
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_Truthtable);
 
-  /* "sat_toolkit/_cnf_util.pyx":624
+  /* "sat_toolkit/formula.pyx":1048
  * 
  *     @classmethod
- *     def from_indices(cls, numbits: int, on_indices: np.array, dc_indices = np.array([], dtype=int)):             # <<<<<<<<<<<<<<
+ *     def from_indices(cls, numbits: int, on_indices: np.array, dc_indices = np.array([], dtype=int)) -> Truthtable:             # <<<<<<<<<<<<<<
  *         """
  *         Creates a Truthtable from the set of indices with value 1 and optionally indices where the value can be ignored.
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, ((PyObject *)(&PyInt_Type))) < 0) __PYX_ERR(0, 624, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 624, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, ((PyObject *)(&PyInt_Type))) < 0) __PYX_ERR(0, 1048, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_k__25 = __pyx_t_5;
+  __pyx_k__32 = __pyx_t_5;
   __Pyx_GIVEREF(__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":623
+  /* "sat_toolkit/formula.pyx":1047
  *         return cls(cls.INIT_INDEX_SET, numbits, on_set, dc_set)
  * 
  *     @classmethod             # <<<<<<<<<<<<<<
- *     def from_indices(cls, numbits: int, on_indices: np.array, dc_indices = np.array([], dtype=int)):
+ *     def from_indices(cls, numbits: int, on_indices: np.array, dc_indices = np.array([], dtype=int)) -> Truthtable:
  *         """
  */
-  __Pyx_GetNameInClass(__pyx_t_5, (PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable, __pyx_n_s_from_indices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_5, (PyObject *)__pyx_ptype_11sat_toolkit_7formula_Truthtable, __pyx_n_s_from_indices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 623, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1047, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable->tp_dict, __pyx_n_s_from_indices, __pyx_t_1) < 0) __PYX_ERR(0, 624, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11sat_toolkit_7formula_Truthtable->tp_dict, __pyx_n_s_from_indices, __pyx_t_1) < 0) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  PyType_Modified(__pyx_ptype_11sat_toolkit_9_cnf_util_Truthtable);
+  PyType_Modified(__pyx_ptype_11sat_toolkit_7formula_Truthtable);
 
-  /* "sat_toolkit/_cnf_util.pyx":706
+  /* "sat_toolkit/formula.pyx":1130
  *         return True
  * 
  *     def to_cnf(self, espresso_args: List[str] = []) -> CNF:             # <<<<<<<<<<<<<<
  *         """
  *         Uses espresso to convert the Truthtable to a minimized CNF.
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 706, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1130, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_k__30 = __pyx_t_1;
+  __pyx_k__37 = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Clause(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_9_cnf_util_1__pyx_unpickle_Clause, NULL, __pyx_n_s_sat_toolkit__cnf_util); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_7formula_1__pyx_unpickle_Clause, NULL, __pyx_n_s_sat_toolkit_formula); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Clause, __pyx_t_1) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":11
  *         __pyx_unpickle_Clause__set_state(<Clause> __pyx_result, __pyx_state)
  *     return __pyx_result
  * cdef __pyx_unpickle_Clause__set_state(Clause __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
  *     __pyx_result.clause = __pyx_state[0]
  *     if len(__pyx_state) > 1 and hasattr(__pyx_result, '__dict__'):
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_9_cnf_util_3__pyx_unpickle_Truthtable, NULL, __pyx_n_s_sat_toolkit__cnf_util); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11sat_toolkit_7formula_3__pyx_unpickle_Truthtable, NULL, __pyx_n_s_sat_toolkit_formula); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Truthtable, __pyx_t_1) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "sat_toolkit/_cnf_util.pyx":1
+  /* "sat_toolkit/formula.pyx":1
  * #cython: language_level=3, annotation_typing=True, embedsignature=True, boundscheck=False, wraparound=False, cdivision=True             # <<<<<<<<<<<<<<
  * #distutils: language = c++
  * cimport cython
  */
   __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -33995,71 +39777,71 @@
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__67, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 287, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__79, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 287, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(generic);
   __Pyx_DECREF_SET(generic, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":288
  * 
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default             # <<<<<<<<<<<<<<
  * cdef indirect = Enum("<strided and indirect>")
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__68, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 288, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__80, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 288, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(strided);
   __Pyx_DECREF_SET(strided, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":289
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__69, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 289, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__81, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 289, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(indirect);
   __Pyx_DECREF_SET(indirect, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":292
  * 
  * 
  * cdef contiguous = Enum("<contiguous and direct>")             # <<<<<<<<<<<<<<
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__70, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 292, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__82, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 292, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(contiguous);
   __Pyx_DECREF_SET(contiguous, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":293
  * 
  * cdef contiguous = Enum("<contiguous and direct>")
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__71, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 293, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__83, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(indirect_contiguous);
   __Pyx_DECREF_SET(indirect_contiguous, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":317
@@ -34134,24 +39916,23 @@
 
   /*--- Wrapped vars code ---*/
 
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_3, 1);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   if (__pyx_m) {
     if (__pyx_d) {
-      __Pyx_AddTraceback("init sat_toolkit._cnf_util", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      __Pyx_AddTraceback("init sat_toolkit.formula", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
     Py_CLEAR(__pyx_m);
   } else if (!PyErr_Occurred()) {
-    PyErr_SetString(PyExc_ImportError, "init sat_toolkit._cnf_util");
+    PyErr_SetString(PyExc_ImportError, "init sat_toolkit.formula");
   }
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   return (__pyx_m != NULL) ? 0 : -1;
   #elif PY_MAJOR_VERSION >= 3
   return __pyx_m;
@@ -34525,55 +40306,360 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
 
-/* ArgTypeTest */
-static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact)
-{
-    if (unlikely(!type)) {
-        PyErr_SetString(PyExc_SystemError, "Missing type object");
-        return 0;
+/* GetItemInt */
+static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
+    PyObject *r;
+    if (!j) return NULL;
+    r = PyObject_GetItem(o, j);
+    Py_DECREF(j);
+    return r;
+}
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
+                                                              CYTHON_NCP_UNUSED int wraparound,
+                                                              CYTHON_NCP_UNUSED int boundscheck) {
+#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    Py_ssize_t wrapped_i = i;
+    if (wraparound & unlikely(i < 0)) {
+        wrapped_i += PyList_GET_SIZE(o);
     }
-    else if (exact) {
-        #if PY_MAJOR_VERSION == 2
-        if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
-        #endif
+    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyList_GET_SIZE(o)))) {
+        PyObject *r = PyList_GET_ITEM(o, wrapped_i);
+        Py_INCREF(r);
+        return r;
     }
-    else {
-        if (likely(__Pyx_TypeCheck(obj, type))) return 1;
+    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
+#else
+    return PySequence_GetItem(o, i);
+#endif
+}
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
+                                                              CYTHON_NCP_UNUSED int wraparound,
+                                                              CYTHON_NCP_UNUSED int boundscheck) {
+#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    Py_ssize_t wrapped_i = i;
+    if (wraparound & unlikely(i < 0)) {
+        wrapped_i += PyTuple_GET_SIZE(o);
     }
-    PyErr_Format(PyExc_TypeError,
-        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
-        name, type->tp_name, Py_TYPE(obj)->tp_name);
-    return 0;
+    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyTuple_GET_SIZE(o)))) {
+        PyObject *r = PyTuple_GET_ITEM(o, wrapped_i);
+        Py_INCREF(r);
+        return r;
+    }
+    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
+#else
+    return PySequence_GetItem(o, i);
+#endif
+}
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
+                                                     CYTHON_NCP_UNUSED int wraparound,
+                                                     CYTHON_NCP_UNUSED int boundscheck) {
+#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
+    if (is_list || PyList_CheckExact(o)) {
+        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
+        if ((!boundscheck) || (likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o))))) {
+            PyObject *r = PyList_GET_ITEM(o, n);
+            Py_INCREF(r);
+            return r;
+        }
+    }
+    else if (PyTuple_CheckExact(o)) {
+        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
+        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
+            PyObject *r = PyTuple_GET_ITEM(o, n);
+            Py_INCREF(r);
+            return r;
+        }
+    } else {
+        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
+        if (likely(m && m->sq_item)) {
+            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
+                Py_ssize_t l = m->sq_length(o);
+                if (likely(l >= 0)) {
+                    i += l;
+                } else {
+                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
+                        return NULL;
+                    PyErr_Clear();
+                }
+            }
+            return m->sq_item(o, i);
+        }
+    }
+#else
+    if (is_list || PySequence_Check(o)) {
+        return PySequence_GetItem(o, i);
+    }
+#endif
+    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
+}
+
+/* JoinPyUnicode */
+static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
+                                      CYTHON_UNUSED Py_UCS4 max_char) {
+#if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    PyObject *result_uval;
+    int result_ukind;
+    Py_ssize_t i, char_pos;
+    void *result_udata;
+#if CYTHON_PEP393_ENABLED
+    result_uval = PyUnicode_New(result_ulength, max_char);
+    if (unlikely(!result_uval)) return NULL;
+    result_ukind = (max_char <= 255) ? PyUnicode_1BYTE_KIND : (max_char <= 65535) ? PyUnicode_2BYTE_KIND : PyUnicode_4BYTE_KIND;
+    result_udata = PyUnicode_DATA(result_uval);
+#else
+    result_uval = PyUnicode_FromUnicode(NULL, result_ulength);
+    if (unlikely(!result_uval)) return NULL;
+    result_ukind = sizeof(Py_UNICODE);
+    result_udata = PyUnicode_AS_UNICODE(result_uval);
+#endif
+    char_pos = 0;
+    for (i=0; i < value_count; i++) {
+        int ukind;
+        Py_ssize_t ulength;
+        void *udata;
+        PyObject *uval = PyTuple_GET_ITEM(value_tuple, i);
+        if (unlikely(__Pyx_PyUnicode_READY(uval)))
+            goto bad;
+        ulength = __Pyx_PyUnicode_GET_LENGTH(uval);
+        if (unlikely(!ulength))
+            continue;
+        if (unlikely(char_pos + ulength < 0))
+            goto overflow;
+        ukind = __Pyx_PyUnicode_KIND(uval);
+        udata = __Pyx_PyUnicode_DATA(uval);
+        if (!CYTHON_PEP393_ENABLED || ukind == result_ukind) {
+            memcpy((char *)result_udata + char_pos * result_ukind, udata, (size_t) (ulength * result_ukind));
+        } else {
+            #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030300F0 || defined(_PyUnicode_FastCopyCharacters)
+            _PyUnicode_FastCopyCharacters(result_uval, char_pos, uval, 0, ulength);
+            #else
+            Py_ssize_t j;
+            for (j=0; j < ulength; j++) {
+                Py_UCS4 uchar = __Pyx_PyUnicode_READ(ukind, udata, j);
+                __Pyx_PyUnicode_WRITE(result_ukind, result_udata, char_pos+j, uchar);
+            }
+            #endif
+        }
+        char_pos += ulength;
+    }
+    return result_uval;
+overflow:
+    PyErr_SetString(PyExc_OverflowError, "join() result is too long for a Python string");
+bad:
+    Py_DECREF(result_uval);
+    return NULL;
+#else
+    result_ulength++;
+    value_count++;
+    return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
+#endif
+}
+
+/* CIntToDigits */
+static const char DIGIT_PAIRS_10[2*10*10+1] = {
+    "00010203040506070809"
+    "10111213141516171819"
+    "20212223242526272829"
+    "30313233343536373839"
+    "40414243444546474849"
+    "50515253545556575859"
+    "60616263646566676869"
+    "70717273747576777879"
+    "80818283848586878889"
+    "90919293949596979899"
+};
+static const char DIGIT_PAIRS_8[2*8*8+1] = {
+    "0001020304050607"
+    "1011121314151617"
+    "2021222324252627"
+    "3031323334353637"
+    "4041424344454647"
+    "5051525354555657"
+    "6061626364656667"
+    "7071727374757677"
+};
+static const char DIGITS_HEX[2*16+1] = {
+    "0123456789abcdef"
+    "0123456789ABCDEF"
+};
+
+/* BuildPyUnicode */
+static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
+                                                int prepend_sign, char padding_char) {
+    PyObject *uval;
+    Py_ssize_t uoffset = ulength - clength;
+#if CYTHON_USE_UNICODE_INTERNALS
+    Py_ssize_t i;
+#if CYTHON_PEP393_ENABLED
+    void *udata;
+    uval = PyUnicode_New(ulength, 127);
+    if (unlikely(!uval)) return NULL;
+    udata = PyUnicode_DATA(uval);
+#else
+    Py_UNICODE *udata;
+    uval = PyUnicode_FromUnicode(NULL, ulength);
+    if (unlikely(!uval)) return NULL;
+    udata = PyUnicode_AS_UNICODE(uval);
+#endif
+    if (uoffset > 0) {
+        i = 0;
+        if (prepend_sign) {
+            __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, 0, '-');
+            i++;
+        }
+        for (; i < uoffset; i++) {
+            __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, i, padding_char);
+        }
+    }
+    for (i=0; i < clength; i++) {
+        __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, uoffset+i, chars[i]);
+    }
+#else
+    {
+        PyObject *sign = NULL, *padding = NULL;
+        uval = NULL;
+        if (uoffset > 0) {
+            prepend_sign = !!prepend_sign;
+            if (uoffset > prepend_sign) {
+                padding = PyUnicode_FromOrdinal(padding_char);
+                if (likely(padding) && uoffset > prepend_sign + 1) {
+                    PyObject *tmp;
+                    PyObject *repeat = PyInt_FromSsize_t(uoffset - prepend_sign);
+                    if (unlikely(!repeat)) goto done_or_error;
+                    tmp = PyNumber_Multiply(padding, repeat);
+                    Py_DECREF(repeat);
+                    Py_DECREF(padding);
+                    padding = tmp;
+                }
+                if (unlikely(!padding)) goto done_or_error;
+            }
+            if (prepend_sign) {
+                sign = PyUnicode_FromOrdinal('-');
+                if (unlikely(!sign)) goto done_or_error;
+            }
+        }
+        uval = PyUnicode_DecodeASCII(chars, clength, NULL);
+        if (likely(uval) && padding) {
+            PyObject *tmp = PyNumber_Add(padding, uval);
+            Py_DECREF(uval);
+            uval = tmp;
+        }
+        if (likely(uval) && sign) {
+            PyObject *tmp = PyNumber_Add(sign, uval);
+            Py_DECREF(uval);
+            uval = tmp;
+        }
+done_or_error:
+        Py_XDECREF(padding);
+        Py_XDECREF(sign);
+    }
+#endif
+    return uval;
+}
+
+/* CIntToPyUnicode */
+static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_int(int value, Py_ssize_t width, char padding_char, char format_char) {
+    char digits[sizeof(int)*3+2];
+    char *dpos, *end = digits + sizeof(int)*3+2;
+    const char *hex_digits = DIGITS_HEX;
+    Py_ssize_t length, ulength;
+    int prepend_sign, last_one_off;
+    int remaining;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const int neg_one = (int) -1, const_zero = (int) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+    if (format_char == 'X') {
+        hex_digits += 16;
+        format_char = 'x';
+    }
+    remaining = value;
+    last_one_off = 0;
+    dpos = end;
+    do {
+        int digit_pos;
+        switch (format_char) {
+        case 'o':
+            digit_pos = abs((int)(remaining % (8*8)));
+            remaining = (int) (remaining / (8*8));
+            dpos -= 2;
+            memcpy(dpos, DIGIT_PAIRS_8 + digit_pos * 2, 2);
+            last_one_off = (digit_pos < 8);
+            break;
+        case 'd':
+            digit_pos = abs((int)(remaining % (10*10)));
+            remaining = (int) (remaining / (10*10));
+            dpos -= 2;
+            memcpy(dpos, DIGIT_PAIRS_10 + digit_pos * 2, 2);
+            last_one_off = (digit_pos < 10);
+            break;
+        case 'x':
+            *(--dpos) = hex_digits[abs((int)(remaining % 16))];
+            remaining = (int) (remaining / 16);
+            break;
+        default:
+            assert(0);
+            break;
+        }
+    } while (unlikely(remaining != 0));
+    if (last_one_off) {
+        assert(*dpos == '0');
+        dpos++;
+    }
+    length = end - dpos;
+    ulength = length;
+    prepend_sign = 0;
+    if (!is_unsigned && value <= neg_one) {
+        if (padding_char == ' ' || width <= length + 1) {
+            *(--dpos) = '-';
+            ++length;
+        } else {
+            prepend_sign = 1;
+        }
+        ++ulength;
+    }
+    if (width > ulength) {
+        ulength = width;
+    }
+    if (ulength == 1) {
+        return PyUnicode_FromOrdinal(*dpos);
+    }
+    return __Pyx_PyUnicode_BuildFromAscii(ulength, dpos, (int) length, prepend_sign, padding_char);
 }
 
 /* PyCFunctionFastCall */
 #if CYTHON_FAST_PYCCALL
 static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
     PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
     PyCFunction meth = PyCFunction_GET_FUNCTION(func);
@@ -34710,43 +40796,14 @@
 done:
     Py_LeaveRecursiveCall();
     return result;
 }
 #endif
 #endif
 
-/* PyObjectCall2Args */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
-    PyObject *args, *result = NULL;
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyFunction_FastCall(function, args, 2);
-    }
-    #endif
-    #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyCFunction_FastCall(function, args, 2);
-    }
-    #endif
-    args = PyTuple_New(2);
-    if (unlikely(!args)) goto done;
-    Py_INCREF(arg1);
-    PyTuple_SET_ITEM(args, 0, arg1);
-    Py_INCREF(arg2);
-    PyTuple_SET_ITEM(args, 1, arg2);
-    Py_INCREF(function);
-    result = __Pyx_PyObject_Call(function, args, NULL);
-    Py_DECREF(args);
-    Py_DECREF(function);
-done:
-    return result;
-}
-
 /* PyObjectCallMethO */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
     PyObject *self, *result;
     PyCFunction cfunc;
     cfunc = PyCFunction_GET_FUNCTION(func);
     self = PyCFunction_GET_SELF(func);
@@ -34799,164 +40856,82 @@
     if (unlikely(!args)) return NULL;
     result = __Pyx_PyObject_Call(func, args, NULL);
     Py_DECREF(args);
     return result;
 }
 #endif
 
-/* SetItemInt */
-static int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
-    int r;
-    if (!j) return -1;
-    r = PyObject_SetItem(o, j, v);
-    Py_DECREF(j);
-    return r;
-}
-static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v, int is_list,
-                                               CYTHON_NCP_UNUSED int wraparound, CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
-    if (is_list || PyList_CheckExact(o)) {
-        Py_ssize_t n = (!wraparound) ? i : ((likely(i >= 0)) ? i : i + PyList_GET_SIZE(o));
-        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o)))) {
-            PyObject* old = PyList_GET_ITEM(o, n);
-            Py_INCREF(v);
-            PyList_SET_ITEM(o, n, v);
-            Py_DECREF(old);
-            return 1;
-        }
-    } else {
-        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
-        if (likely(m && m->sq_ass_item)) {
-            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
-                Py_ssize_t l = m->sq_length(o);
-                if (likely(l >= 0)) {
-                    i += l;
-                } else {
-                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
-                        return -1;
-                    PyErr_Clear();
-                }
-            }
-            return m->sq_ass_item(o, i, v);
-        }
+/* ExtTypeTest */
+static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
+    if (unlikely(!type)) {
+        PyErr_SetString(PyExc_SystemError, "Missing type object");
+        return 0;
     }
-#else
-#if CYTHON_COMPILING_IN_PYPY
-    if (is_list || (PySequence_Check(o) && !PyDict_Check(o)))
-#else
-    if (is_list || PySequence_Check(o))
-#endif
+    if (likely(__Pyx_TypeCheck(obj, type)))
+        return 1;
+    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
+                 Py_TYPE(obj)->tp_name, type->tp_name);
+    return 0;
+}
+
+/* GetTopmostException */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem *
+__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
+{
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
+           exc_info->previous_item != NULL)
     {
-        return PySequence_SetItem(o, i, v);
+        exc_info = exc_info->previous_item;
     }
-#endif
-    return __Pyx_SetItemInt_Generic(o, PyInt_FromSsize_t(i), v);
+    return exc_info;
 }
-
-/* WriteUnraisableException */
-static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
-                                  CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename,
-                                  int full_traceback, CYTHON_UNUSED int nogil) {
-    PyObject *old_exc, *old_val, *old_tb;
-    PyObject *ctx;
-    __Pyx_PyThreadState_declare
-#ifdef WITH_THREAD
-    PyGILState_STATE state;
-    if (nogil)
-        state = PyGILState_Ensure();
-    else state = (PyGILState_STATE)0;
 #endif
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
-    if (full_traceback) {
-        Py_XINCREF(old_exc);
-        Py_XINCREF(old_val);
-        Py_XINCREF(old_tb);
-        __Pyx_ErrRestore(old_exc, old_val, old_tb);
-        PyErr_PrintEx(1);
-    }
-    #if PY_MAJOR_VERSION < 3
-    ctx = PyString_FromString(name);
+
+/* SaveResetException */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
+    *type = exc_info->exc_type;
+    *value = exc_info->exc_value;
+    *tb = exc_info->exc_traceback;
     #else
-    ctx = PyUnicode_FromString(name);
+    *type = tstate->exc_type;
+    *value = tstate->exc_value;
+    *tb = tstate->exc_traceback;
     #endif
-    __Pyx_ErrRestore(old_exc, old_val, old_tb);
-    if (!ctx) {
-        PyErr_WriteUnraisable(Py_None);
-    } else {
-        PyErr_WriteUnraisable(ctx);
-        Py_DECREF(ctx);
-    }
-#ifdef WITH_THREAD
-    if (nogil)
-        PyGILState_Release(state);
-#endif
+    Py_XINCREF(*type);
+    Py_XINCREF(*value);
+    Py_XINCREF(*tb);
 }
-
-/* JoinPyUnicode */
-static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
-                                      CYTHON_UNUSED Py_UCS4 max_char) {
-#if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    PyObject *result_uval;
-    int result_ukind;
-    Py_ssize_t i, char_pos;
-    void *result_udata;
-#if CYTHON_PEP393_ENABLED
-    result_uval = PyUnicode_New(result_ulength, max_char);
-    if (unlikely(!result_uval)) return NULL;
-    result_ukind = (max_char <= 255) ? PyUnicode_1BYTE_KIND : (max_char <= 65535) ? PyUnicode_2BYTE_KIND : PyUnicode_4BYTE_KIND;
-    result_udata = PyUnicode_DATA(result_uval);
-#else
-    result_uval = PyUnicode_FromUnicode(NULL, result_ulength);
-    if (unlikely(!result_uval)) return NULL;
-    result_ukind = sizeof(Py_UNICODE);
-    result_udata = PyUnicode_AS_UNICODE(result_uval);
-#endif
-    char_pos = 0;
-    for (i=0; i < value_count; i++) {
-        int ukind;
-        Py_ssize_t ulength;
-        void *udata;
-        PyObject *uval = PyTuple_GET_ITEM(value_tuple, i);
-        if (unlikely(__Pyx_PyUnicode_READY(uval)))
-            goto bad;
-        ulength = __Pyx_PyUnicode_GET_LENGTH(uval);
-        if (unlikely(!ulength))
-            continue;
-        if (unlikely(char_pos + ulength < 0))
-            goto overflow;
-        ukind = __Pyx_PyUnicode_KIND(uval);
-        udata = __Pyx_PyUnicode_DATA(uval);
-        if (!CYTHON_PEP393_ENABLED || ukind == result_ukind) {
-            memcpy((char *)result_udata + char_pos * result_ukind, udata, (size_t) (ulength * result_ukind));
-        } else {
-            #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030300F0 || defined(_PyUnicode_FastCopyCharacters)
-            _PyUnicode_FastCopyCharacters(result_uval, char_pos, uval, 0, ulength);
-            #else
-            Py_ssize_t j;
-            for (j=0; j < ulength; j++) {
-                Py_UCS4 uchar = __Pyx_PyUnicode_READ(ukind, udata, j);
-                __Pyx_PyUnicode_WRITE(result_ukind, result_udata, char_pos+j, uchar);
-            }
-            #endif
-        }
-        char_pos += ulength;
-    }
-    return result_uval;
-overflow:
-    PyErr_SetString(PyExc_OverflowError, "join() result is too long for a Python string");
-bad:
-    Py_DECREF(result_uval);
-    return NULL;
-#else
-    result_ulength++;
-    value_count++;
-    return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
-#endif
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    tmp_type = exc_info->exc_type;
+    tmp_value = exc_info->exc_value;
+    tmp_tb = exc_info->exc_traceback;
+    exc_info->exc_type = type;
+    exc_info->exc_value = value;
+    exc_info->exc_traceback = tb;
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = type;
+    tstate->exc_value = value;
+    tstate->exc_traceback = tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
 }
+#endif
 
 /* PyErrExceptionMatches */
 #if CYTHON_FAST_THREAD_STATE
 static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
     Py_ssize_t i, n;
     n = PyTuple_GET_SIZE(tuple);
 #if PY_MAJOR_VERSION >= 3
@@ -34975,14 +40950,88 @@
     if (unlikely(!exc_type)) return 0;
     if (unlikely(PyTuple_Check(err)))
         return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
     return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
 }
 #endif
 
+/* GetException */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
+#endif
+{
+    PyObject *local_type, *local_value, *local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    local_type = tstate->curexc_type;
+    local_value = tstate->curexc_value;
+    local_tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+#else
+    PyErr_Fetch(&local_type, &local_value, &local_tb);
+#endif
+    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
+#if CYTHON_FAST_THREAD_STATE
+    if (unlikely(tstate->curexc_type))
+#else
+    if (unlikely(PyErr_Occurred()))
+#endif
+        goto bad;
+    #if PY_MAJOR_VERSION >= 3
+    if (local_tb) {
+        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
+            goto bad;
+    }
+    #endif
+    Py_XINCREF(local_tb);
+    Py_XINCREF(local_type);
+    Py_XINCREF(local_value);
+    *type = local_type;
+    *value = local_value;
+    *tb = local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    #if CYTHON_USE_EXC_INFO_STACK
+    {
+        _PyErr_StackItem *exc_info = tstate->exc_info;
+        tmp_type = exc_info->exc_type;
+        tmp_value = exc_info->exc_value;
+        tmp_tb = exc_info->exc_traceback;
+        exc_info->exc_type = local_type;
+        exc_info->exc_value = local_value;
+        exc_info->exc_traceback = local_tb;
+    }
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = local_type;
+    tstate->exc_value = local_value;
+    tstate->exc_traceback = local_tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+#else
+    PyErr_SetExcInfo(local_type, local_value, local_tb);
+#endif
+    return 0;
+bad:
+    *type = 0;
+    *value = 0;
+    *tb = 0;
+    Py_XDECREF(local_type);
+    Py_XDECREF(local_value);
+    Py_XDECREF(local_tb);
+    return -1;
+}
+
 /* GetAttr */
 static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *o, PyObject *n) {
 #if CYTHON_USE_TYPE_SLOTS
 #if PY_MAJOR_VERSION >= 3
     if (likely(PyUnicode_Check(n)))
 #else
     if (likely(PyString_Check(n)))
@@ -35064,14 +41113,150 @@
         return __Pyx_NewRef(result);
     }
     PyErr_Clear();
 #endif
     return __Pyx_GetBuiltinName(name);
 }
 
+/* PyObjectCall2Args */
+static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
+    PyObject *args, *result = NULL;
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(function)) {
+        PyObject *args[2] = {arg1, arg2};
+        return __Pyx_PyFunction_FastCall(function, args, 2);
+    }
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(function)) {
+        PyObject *args[2] = {arg1, arg2};
+        return __Pyx_PyCFunction_FastCall(function, args, 2);
+    }
+    #endif
+    args = PyTuple_New(2);
+    if (unlikely(!args)) goto done;
+    Py_INCREF(arg1);
+    PyTuple_SET_ITEM(args, 0, arg1);
+    Py_INCREF(arg2);
+    PyTuple_SET_ITEM(args, 1, arg2);
+    Py_INCREF(function);
+    result = __Pyx_PyObject_Call(function, args, NULL);
+    Py_DECREF(args);
+    Py_DECREF(function);
+done:
+    return result;
+}
+
+/* PyIntCompare */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_NeObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, CYTHON_UNUSED long inplace) {
+    if (op1 == op2) {
+        Py_RETURN_FALSE;
+    }
+    #if PY_MAJOR_VERSION < 3
+    if (likely(PyInt_CheckExact(op1))) {
+        const long b = intval;
+        long a = PyInt_AS_LONG(op1);
+        if (a != b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
+    }
+    #endif
+    #if CYTHON_USE_PYLONG_INTERNALS
+    if (likely(PyLong_CheckExact(op1))) {
+        int unequal;
+        unsigned long uintval;
+        Py_ssize_t size = Py_SIZE(op1);
+        const digit* digits = ((PyLongObject*)op1)->ob_digit;
+        if (intval == 0) {
+            if (size != 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
+        } else if (intval < 0) {
+            if (size >= 0)
+                Py_RETURN_TRUE;
+            intval = -intval;
+            size = -size;
+        } else {
+            if (size <= 0)
+                Py_RETURN_TRUE;
+        }
+        uintval = (unsigned long) intval;
+#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
+        if (uintval >> (PyLong_SHIFT * 4)) {
+            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
+                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
+        } else
+#endif
+#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
+        if (uintval >> (PyLong_SHIFT * 3)) {
+            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
+                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
+        } else
+#endif
+#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
+        if (uintval >> (PyLong_SHIFT * 2)) {
+            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
+                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
+        } else
+#endif
+#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
+        if (uintval >> (PyLong_SHIFT * 1)) {
+            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
+                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
+        } else
+#endif
+            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
+        if (unequal != 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
+    }
+    #endif
+    if (PyFloat_CheckExact(op1)) {
+        const long b = intval;
+        double a = PyFloat_AS_DOUBLE(op1);
+        if ((double)a != (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
+    }
+    return (
+        PyObject_RichCompare(op1, op2, Py_NE));
+}
+
+/* KeywordStringCheck */
+static int __Pyx_CheckKeywordStrings(
+    PyObject *kwdict,
+    const char* function_name,
+    int kw_allowed)
+{
+    PyObject* key = 0;
+    Py_ssize_t pos = 0;
+#if CYTHON_COMPILING_IN_PYPY
+    if (!kw_allowed && PyDict_Next(kwdict, &pos, &key, 0))
+        goto invalid_keyword;
+    return 1;
+#else
+    while (PyDict_Next(kwdict, &pos, &key, 0)) {
+        #if PY_MAJOR_VERSION < 3
+        if (unlikely(!PyString_Check(key)))
+        #endif
+            if (unlikely(!PyUnicode_Check(key)))
+                goto invalid_keyword_type;
+    }
+    if ((!kw_allowed) && unlikely(key))
+        goto invalid_keyword;
+    return 1;
+invalid_keyword_type:
+    PyErr_Format(PyExc_TypeError,
+        "%.200s() keywords must be strings", function_name);
+    return 0;
+#endif
+invalid_keyword:
+    PyErr_Format(PyExc_TypeError,
+    #if PY_MAJOR_VERSION < 3
+        "%.200s() got an unexpected keyword argument '%.200s'",
+        function_name, PyString_AsString(key));
+    #else
+        "%s() got an unexpected keyword argument '%U'",
+        function_name, key);
+    #endif
+    return 0;
+}
+
 /* MemviewSliceInit */
 static int
 __Pyx_init_memviewslice(struct __pyx_memoryview_obj *memview,
                         int ndim,
                         __Pyx_memviewslice *memviewslice,
                         int memview_is_new_reference)
 {
@@ -35196,189 +41381,33 @@
             PyGILState_Release(_gilstate);
         }
     } else {
         memslice->memview = NULL;
     }
 }
 
-/* CIntToDigits */
-static const char DIGIT_PAIRS_10[2*10*10+1] = {
-    "00010203040506070809"
-    "10111213141516171819"
-    "20212223242526272829"
-    "30313233343536373839"
-    "40414243444546474849"
-    "50515253545556575859"
-    "60616263646566676869"
-    "70717273747576777879"
-    "80818283848586878889"
-    "90919293949596979899"
-};
-static const char DIGIT_PAIRS_8[2*8*8+1] = {
-    "0001020304050607"
-    "1011121314151617"
-    "2021222324252627"
-    "3031323334353637"
-    "4041424344454647"
-    "5051525354555657"
-    "6061626364656667"
-    "7071727374757677"
-};
-static const char DIGITS_HEX[2*16+1] = {
-    "0123456789abcdef"
-    "0123456789ABCDEF"
-};
-
-/* BuildPyUnicode */
-static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
-                                                int prepend_sign, char padding_char) {
-    PyObject *uval;
-    Py_ssize_t uoffset = ulength - clength;
-#if CYTHON_USE_UNICODE_INTERNALS
-    Py_ssize_t i;
-#if CYTHON_PEP393_ENABLED
-    void *udata;
-    uval = PyUnicode_New(ulength, 127);
-    if (unlikely(!uval)) return NULL;
-    udata = PyUnicode_DATA(uval);
-#else
-    Py_UNICODE *udata;
-    uval = PyUnicode_FromUnicode(NULL, ulength);
-    if (unlikely(!uval)) return NULL;
-    udata = PyUnicode_AS_UNICODE(uval);
-#endif
-    if (uoffset > 0) {
-        i = 0;
-        if (prepend_sign) {
-            __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, 0, '-');
-            i++;
-        }
-        for (; i < uoffset; i++) {
-            __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, i, padding_char);
-        }
-    }
-    for (i=0; i < clength; i++) {
-        __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, uoffset+i, chars[i]);
-    }
-#else
-    {
-        PyObject *sign = NULL, *padding = NULL;
-        uval = NULL;
-        if (uoffset > 0) {
-            prepend_sign = !!prepend_sign;
-            if (uoffset > prepend_sign) {
-                padding = PyUnicode_FromOrdinal(padding_char);
-                if (likely(padding) && uoffset > prepend_sign + 1) {
-                    PyObject *tmp;
-                    PyObject *repeat = PyInt_FromSsize_t(uoffset - prepend_sign);
-                    if (unlikely(!repeat)) goto done_or_error;
-                    tmp = PyNumber_Multiply(padding, repeat);
-                    Py_DECREF(repeat);
-                    Py_DECREF(padding);
-                    padding = tmp;
-                }
-                if (unlikely(!padding)) goto done_or_error;
-            }
-            if (prepend_sign) {
-                sign = PyUnicode_FromOrdinal('-');
-                if (unlikely(!sign)) goto done_or_error;
-            }
-        }
-        uval = PyUnicode_DecodeASCII(chars, clength, NULL);
-        if (likely(uval) && padding) {
-            PyObject *tmp = PyNumber_Add(padding, uval);
-            Py_DECREF(uval);
-            uval = tmp;
-        }
-        if (likely(uval) && sign) {
-            PyObject *tmp = PyNumber_Add(sign, uval);
-            Py_DECREF(uval);
-            uval = tmp;
-        }
-done_or_error:
-        Py_XDECREF(padding);
-        Py_XDECREF(sign);
-    }
-#endif
-    return uval;
-}
-
-/* CIntToPyUnicode */
-static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_int(int value, Py_ssize_t width, char padding_char, char format_char) {
-    char digits[sizeof(int)*3+2];
-    char *dpos, *end = digits + sizeof(int)*3+2;
-    const char *hex_digits = DIGITS_HEX;
-    Py_ssize_t length, ulength;
-    int prepend_sign, last_one_off;
-    int remaining;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic push
-#pragma GCC diagnostic ignored "-Wconversion"
-#endif
-    const int neg_one = (int) -1, const_zero = (int) 0;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic pop
-#endif
-    const int is_unsigned = neg_one > const_zero;
-    if (format_char == 'X') {
-        hex_digits += 16;
-        format_char = 'x';
-    }
-    remaining = value;
-    last_one_off = 0;
-    dpos = end;
-    do {
-        int digit_pos;
-        switch (format_char) {
-        case 'o':
-            digit_pos = abs((int)(remaining % (8*8)));
-            remaining = (int) (remaining / (8*8));
-            dpos -= 2;
-            memcpy(dpos, DIGIT_PAIRS_8 + digit_pos * 2, 2);
-            last_one_off = (digit_pos < 8);
-            break;
-        case 'd':
-            digit_pos = abs((int)(remaining % (10*10)));
-            remaining = (int) (remaining / (10*10));
-            dpos -= 2;
-            memcpy(dpos, DIGIT_PAIRS_10 + digit_pos * 2, 2);
-            last_one_off = (digit_pos < 10);
-            break;
-        case 'x':
-            *(--dpos) = hex_digits[abs((int)(remaining % 16))];
-            remaining = (int) (remaining / 16);
-            break;
-        default:
-            assert(0);
-            break;
-        }
-    } while (unlikely(remaining != 0));
-    if (last_one_off) {
-        assert(*dpos == '0');
-        dpos++;
-    }
-    length = end - dpos;
-    ulength = length;
-    prepend_sign = 0;
-    if (!is_unsigned && value <= neg_one) {
-        if (padding_char == ' ' || width <= length + 1) {
-            *(--dpos) = '-';
-            ++length;
-        } else {
-            prepend_sign = 1;
-        }
-        ++ulength;
+/* ArgTypeTest */
+static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact)
+{
+    if (unlikely(!type)) {
+        PyErr_SetString(PyExc_SystemError, "Missing type object");
+        return 0;
     }
-    if (width > ulength) {
-        ulength = width;
+    else if (exact) {
+        #if PY_MAJOR_VERSION == 2
+        if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
+        #endif
     }
-    if (ulength == 1) {
-        return PyUnicode_FromOrdinal(*dpos);
+    else {
+        if (likely(__Pyx_TypeCheck(obj, type))) return 1;
     }
-    return __Pyx_PyUnicode_BuildFromAscii(ulength, dpos, (int) length, prepend_sign, padding_char);
+    PyErr_Format(PyExc_TypeError,
+        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
+        name, type->tp_name, Py_TYPE(obj)->tp_name);
+    return 0;
 }
 
 /* PyObjectCallNoArg */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
 #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(func)) {
@@ -35626,27 +41655,14 @@
     PyErr_Format(PyExc_TypeError,
         "'%.200s' object does not support slice %.10s",
         Py_TYPE(obj)->tp_name, value ? "assignment" : "deletion");
 bad:
     return -1;
 }
 
-/* ExtTypeTest */
-static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
-    if (unlikely(!type)) {
-        PyErr_SetString(PyExc_SystemError, "Missing type object");
-        return 0;
-    }
-    if (likely(__Pyx_TypeCheck(obj, type)))
-        return 1;
-    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
-                 Py_TYPE(obj)->tp_name, type->tp_name);
-    return 0;
-}
-
 /* decode_c_bytes */
 static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
          const char* cstring, Py_ssize_t length, Py_ssize_t start, Py_ssize_t stop,
          const char* encoding, const char* errors,
          PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
     if (unlikely((start < 0) | (stop < 0))) {
         if (start < 0) {
@@ -35666,142 +41682,87 @@
     if (decode_func) {
         return decode_func(cstring, length, errors);
     } else {
         return PyUnicode_Decode(cstring, length, encoding, errors);
     }
 }
 
-/* GetTopmostException */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem *
-__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
-{
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
-           exc_info->previous_item != NULL)
-    {
-        exc_info = exc_info->previous_item;
-    }
-    return exc_info;
-}
-#endif
-
-/* SaveResetException */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
-    *type = exc_info->exc_type;
-    *value = exc_info->exc_value;
-    *tb = exc_info->exc_traceback;
-    #else
-    *type = tstate->exc_type;
-    *value = tstate->exc_value;
-    *tb = tstate->exc_traceback;
-    #endif
-    Py_XINCREF(*type);
-    Py_XINCREF(*value);
-    Py_XINCREF(*tb);
-}
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    tmp_type = exc_info->exc_type;
-    tmp_value = exc_info->exc_value;
-    tmp_tb = exc_info->exc_traceback;
-    exc_info->exc_type = type;
-    exc_info->exc_value = value;
-    exc_info->exc_traceback = tb;
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = type;
-    tstate->exc_value = value;
-    tstate->exc_traceback = tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-#endif
-
-/* GetException */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
-#else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
-#endif
-{
-    PyObject *local_type, *local_value, *local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    local_type = tstate->curexc_type;
-    local_value = tstate->curexc_value;
-    local_tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-#else
-    PyErr_Fetch(&local_type, &local_value, &local_tb);
+/* CIntToPyUnicode */
+static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_Py_ssize_t(Py_ssize_t value, Py_ssize_t width, char padding_char, char format_char) {
+    char digits[sizeof(Py_ssize_t)*3+2];
+    char *dpos, *end = digits + sizeof(Py_ssize_t)*3+2;
+    const char *hex_digits = DIGITS_HEX;
+    Py_ssize_t length, ulength;
+    int prepend_sign, last_one_off;
+    Py_ssize_t remaining;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
 #endif
-    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
-#if CYTHON_FAST_THREAD_STATE
-    if (unlikely(tstate->curexc_type))
-#else
-    if (unlikely(PyErr_Occurred()))
+    const Py_ssize_t neg_one = (Py_ssize_t) -1, const_zero = (Py_ssize_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
 #endif
-        goto bad;
-    #if PY_MAJOR_VERSION >= 3
-    if (local_tb) {
-        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
-            goto bad;
+    const int is_unsigned = neg_one > const_zero;
+    if (format_char == 'X') {
+        hex_digits += 16;
+        format_char = 'x';
     }
-    #endif
-    Py_XINCREF(local_tb);
-    Py_XINCREF(local_type);
-    Py_XINCREF(local_value);
-    *type = local_type;
-    *value = local_value;
-    *tb = local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    #if CYTHON_USE_EXC_INFO_STACK
-    {
-        _PyErr_StackItem *exc_info = tstate->exc_info;
-        tmp_type = exc_info->exc_type;
-        tmp_value = exc_info->exc_value;
-        tmp_tb = exc_info->exc_traceback;
-        exc_info->exc_type = local_type;
-        exc_info->exc_value = local_value;
-        exc_info->exc_traceback = local_tb;
+    remaining = value;
+    last_one_off = 0;
+    dpos = end;
+    do {
+        int digit_pos;
+        switch (format_char) {
+        case 'o':
+            digit_pos = abs((int)(remaining % (8*8)));
+            remaining = (Py_ssize_t) (remaining / (8*8));
+            dpos -= 2;
+            memcpy(dpos, DIGIT_PAIRS_8 + digit_pos * 2, 2);
+            last_one_off = (digit_pos < 8);
+            break;
+        case 'd':
+            digit_pos = abs((int)(remaining % (10*10)));
+            remaining = (Py_ssize_t) (remaining / (10*10));
+            dpos -= 2;
+            memcpy(dpos, DIGIT_PAIRS_10 + digit_pos * 2, 2);
+            last_one_off = (digit_pos < 10);
+            break;
+        case 'x':
+            *(--dpos) = hex_digits[abs((int)(remaining % 16))];
+            remaining = (Py_ssize_t) (remaining / 16);
+            break;
+        default:
+            assert(0);
+            break;
+        }
+    } while (unlikely(remaining != 0));
+    if (last_one_off) {
+        assert(*dpos == '0');
+        dpos++;
     }
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = local_type;
-    tstate->exc_value = local_value;
-    tstate->exc_traceback = local_tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-#else
-    PyErr_SetExcInfo(local_type, local_value, local_tb);
-#endif
-    return 0;
-bad:
-    *type = 0;
-    *value = 0;
-    *tb = 0;
-    Py_XDECREF(local_type);
-    Py_XDECREF(local_value);
-    Py_XDECREF(local_tb);
-    return -1;
+    length = end - dpos;
+    ulength = length;
+    prepend_sign = 0;
+    if (!is_unsigned && value <= neg_one) {
+        if (padding_char == ' ' || width <= length + 1) {
+            *(--dpos) = '-';
+            ++length;
+        } else {
+            prepend_sign = 1;
+        }
+        ++ulength;
+    }
+    if (width > ulength) {
+        ulength = width;
+    }
+    if (ulength == 1) {
+        return PyUnicode_FromOrdinal(*dpos);
+    }
+    return __Pyx_PyUnicode_BuildFromAscii(ulength, dpos, (int) length, prepend_sign, padding_char);
 }
 
 /* SliceObject */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
         Py_ssize_t cstart, Py_ssize_t cstop,
         PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
         int has_cstart, int has_cstop, CYTHON_UNUSED int wraparound) {
@@ -35893,235 +41854,14 @@
     }
     PyErr_Format(PyExc_TypeError,
         "'%.200s' object is unsliceable", Py_TYPE(obj)->tp_name);
 bad:
     return NULL;
 }
 
-/* PyIntCompare */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_NeObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, CYTHON_UNUSED long inplace) {
-    if (op1 == op2) {
-        Py_RETURN_FALSE;
-    }
-    #if PY_MAJOR_VERSION < 3
-    if (likely(PyInt_CheckExact(op1))) {
-        const long b = intval;
-        long a = PyInt_AS_LONG(op1);
-        if (a != b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
-    }
-    #endif
-    #if CYTHON_USE_PYLONG_INTERNALS
-    if (likely(PyLong_CheckExact(op1))) {
-        int unequal;
-        unsigned long uintval;
-        Py_ssize_t size = Py_SIZE(op1);
-        const digit* digits = ((PyLongObject*)op1)->ob_digit;
-        if (intval == 0) {
-            if (size != 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
-        } else if (intval < 0) {
-            if (size >= 0)
-                Py_RETURN_TRUE;
-            intval = -intval;
-            size = -size;
-        } else {
-            if (size <= 0)
-                Py_RETURN_TRUE;
-        }
-        uintval = (unsigned long) intval;
-#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
-        if (uintval >> (PyLong_SHIFT * 4)) {
-            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
-                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
-        } else
-#endif
-#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
-        if (uintval >> (PyLong_SHIFT * 3)) {
-            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
-                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
-        } else
-#endif
-#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
-        if (uintval >> (PyLong_SHIFT * 2)) {
-            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
-                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
-        } else
-#endif
-#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
-        if (uintval >> (PyLong_SHIFT * 1)) {
-            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
-                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
-        } else
-#endif
-            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
-        if (unequal != 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
-    }
-    #endif
-    if (PyFloat_CheckExact(op1)) {
-        const long b = intval;
-        double a = PyFloat_AS_DOUBLE(op1);
-        if ((double)a != (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
-    }
-    return (
-        PyObject_RichCompare(op1, op2, Py_NE));
-}
-
-/* PyIntCompare */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, CYTHON_UNUSED long inplace) {
-    if (op1 == op2) {
-        Py_RETURN_TRUE;
-    }
-    #if PY_MAJOR_VERSION < 3
-    if (likely(PyInt_CheckExact(op1))) {
-        const long b = intval;
-        long a = PyInt_AS_LONG(op1);
-        if (a == b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
-    }
-    #endif
-    #if CYTHON_USE_PYLONG_INTERNALS
-    if (likely(PyLong_CheckExact(op1))) {
-        int unequal;
-        unsigned long uintval;
-        Py_ssize_t size = Py_SIZE(op1);
-        const digit* digits = ((PyLongObject*)op1)->ob_digit;
-        if (intval == 0) {
-            if (size == 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
-        } else if (intval < 0) {
-            if (size >= 0)
-                Py_RETURN_FALSE;
-            intval = -intval;
-            size = -size;
-        } else {
-            if (size <= 0)
-                Py_RETURN_FALSE;
-        }
-        uintval = (unsigned long) intval;
-#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
-        if (uintval >> (PyLong_SHIFT * 4)) {
-            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
-                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
-        } else
-#endif
-#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
-        if (uintval >> (PyLong_SHIFT * 3)) {
-            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
-                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
-        } else
-#endif
-#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
-        if (uintval >> (PyLong_SHIFT * 2)) {
-            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
-                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
-        } else
-#endif
-#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
-        if (uintval >> (PyLong_SHIFT * 1)) {
-            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
-                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
-        } else
-#endif
-            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
-        if (unequal == 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
-    }
-    #endif
-    if (PyFloat_CheckExact(op1)) {
-        const long b = intval;
-        double a = PyFloat_AS_DOUBLE(op1);
-        if ((double)a == (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
-    }
-    return (
-        PyObject_RichCompare(op1, op2, Py_EQ));
-}
-
-/* GetItemInt */
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
-    PyObject *r;
-    if (!j) return NULL;
-    r = PyObject_GetItem(o, j);
-    Py_DECREF(j);
-    return r;
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
-                                                              CYTHON_NCP_UNUSED int wraparound,
-                                                              CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    Py_ssize_t wrapped_i = i;
-    if (wraparound & unlikely(i < 0)) {
-        wrapped_i += PyList_GET_SIZE(o);
-    }
-    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyList_GET_SIZE(o)))) {
-        PyObject *r = PyList_GET_ITEM(o, wrapped_i);
-        Py_INCREF(r);
-        return r;
-    }
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-#else
-    return PySequence_GetItem(o, i);
-#endif
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
-                                                              CYTHON_NCP_UNUSED int wraparound,
-                                                              CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    Py_ssize_t wrapped_i = i;
-    if (wraparound & unlikely(i < 0)) {
-        wrapped_i += PyTuple_GET_SIZE(o);
-    }
-    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyTuple_GET_SIZE(o)))) {
-        PyObject *r = PyTuple_GET_ITEM(o, wrapped_i);
-        Py_INCREF(r);
-        return r;
-    }
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-#else
-    return PySequence_GetItem(o, i);
-#endif
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
-                                                     CYTHON_NCP_UNUSED int wraparound,
-                                                     CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
-    if (is_list || PyList_CheckExact(o)) {
-        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
-        if ((!boundscheck) || (likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o))))) {
-            PyObject *r = PyList_GET_ITEM(o, n);
-            Py_INCREF(r);
-            return r;
-        }
-    }
-    else if (PyTuple_CheckExact(o)) {
-        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
-        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
-            PyObject *r = PyTuple_GET_ITEM(o, n);
-            Py_INCREF(r);
-            return r;
-        }
-    } else {
-        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
-        if (likely(m && m->sq_item)) {
-            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
-                Py_ssize_t l = m->sq_length(o);
-                if (likely(l >= 0)) {
-                    i += l;
-                } else {
-                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
-                        return NULL;
-                    PyErr_Clear();
-                }
-            }
-            return m->sq_item(o, i);
-        }
-    }
-#else
-    if (is_list || PySequence_Check(o)) {
-        return PySequence_GetItem(o, i);
-    }
-#endif
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-}
-
 /* PyIntBinop */
 #if !CYTHON_COMPILING_IN_PYPY
 static PyObject* __Pyx_PyInt_SubtractObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
     (void)inplace;
     (void)zerodivision_check;
     #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_CheckExact(op1))) {
@@ -36238,14 +41978,81 @@
             PyFPE_END_PROTECT(result)
             return PyFloat_FromDouble(result);
     }
     return (inplace ? PyNumber_InPlaceSubtract : PyNumber_Subtract)(op1, op2);
 }
 #endif
 
+/* PyIntCompare */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, CYTHON_UNUSED long inplace) {
+    if (op1 == op2) {
+        Py_RETURN_TRUE;
+    }
+    #if PY_MAJOR_VERSION < 3
+    if (likely(PyInt_CheckExact(op1))) {
+        const long b = intval;
+        long a = PyInt_AS_LONG(op1);
+        if (a == b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
+    }
+    #endif
+    #if CYTHON_USE_PYLONG_INTERNALS
+    if (likely(PyLong_CheckExact(op1))) {
+        int unequal;
+        unsigned long uintval;
+        Py_ssize_t size = Py_SIZE(op1);
+        const digit* digits = ((PyLongObject*)op1)->ob_digit;
+        if (intval == 0) {
+            if (size == 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
+        } else if (intval < 0) {
+            if (size >= 0)
+                Py_RETURN_FALSE;
+            intval = -intval;
+            size = -size;
+        } else {
+            if (size <= 0)
+                Py_RETURN_FALSE;
+        }
+        uintval = (unsigned long) intval;
+#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
+        if (uintval >> (PyLong_SHIFT * 4)) {
+            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
+                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
+        } else
+#endif
+#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
+        if (uintval >> (PyLong_SHIFT * 3)) {
+            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
+                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
+        } else
+#endif
+#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
+        if (uintval >> (PyLong_SHIFT * 2)) {
+            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
+                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
+        } else
+#endif
+#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
+        if (uintval >> (PyLong_SHIFT * 1)) {
+            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
+                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
+        } else
+#endif
+            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
+        if (unequal == 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
+    }
+    #endif
+    if (PyFloat_CheckExact(op1)) {
+        const long b = intval;
+        double a = PyFloat_AS_DOUBLE(op1);
+        if ((double)a == (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
+    }
+    return (
+        PyObject_RichCompare(op1, op2, Py_EQ));
+}
+
 /* ObjectGetItem */
 #if CYTHON_USE_TYPE_SLOTS
 static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject* index) {
     PyObject *runerr = NULL;
     Py_ssize_t key_value;
     PySequenceMethods *m = Py_TYPE(obj)->tp_as_sequence;
     if (unlikely(!(m && m->sq_item))) {
@@ -36267,89 +42074,14 @@
     if (likely(m && m->mp_subscript)) {
         return m->mp_subscript(obj, key);
     }
     return __Pyx_PyObject_GetIndex(obj, key);
 }
 #endif
 
-/* CIntToPyUnicode */
-static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_Py_ssize_t(Py_ssize_t value, Py_ssize_t width, char padding_char, char format_char) {
-    char digits[sizeof(Py_ssize_t)*3+2];
-    char *dpos, *end = digits + sizeof(Py_ssize_t)*3+2;
-    const char *hex_digits = DIGITS_HEX;
-    Py_ssize_t length, ulength;
-    int prepend_sign, last_one_off;
-    Py_ssize_t remaining;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic push
-#pragma GCC diagnostic ignored "-Wconversion"
-#endif
-    const Py_ssize_t neg_one = (Py_ssize_t) -1, const_zero = (Py_ssize_t) 0;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic pop
-#endif
-    const int is_unsigned = neg_one > const_zero;
-    if (format_char == 'X') {
-        hex_digits += 16;
-        format_char = 'x';
-    }
-    remaining = value;
-    last_one_off = 0;
-    dpos = end;
-    do {
-        int digit_pos;
-        switch (format_char) {
-        case 'o':
-            digit_pos = abs((int)(remaining % (8*8)));
-            remaining = (Py_ssize_t) (remaining / (8*8));
-            dpos -= 2;
-            memcpy(dpos, DIGIT_PAIRS_8 + digit_pos * 2, 2);
-            last_one_off = (digit_pos < 8);
-            break;
-        case 'd':
-            digit_pos = abs((int)(remaining % (10*10)));
-            remaining = (Py_ssize_t) (remaining / (10*10));
-            dpos -= 2;
-            memcpy(dpos, DIGIT_PAIRS_10 + digit_pos * 2, 2);
-            last_one_off = (digit_pos < 10);
-            break;
-        case 'x':
-            *(--dpos) = hex_digits[abs((int)(remaining % 16))];
-            remaining = (Py_ssize_t) (remaining / 16);
-            break;
-        default:
-            assert(0);
-            break;
-        }
-    } while (unlikely(remaining != 0));
-    if (last_one_off) {
-        assert(*dpos == '0');
-        dpos++;
-    }
-    length = end - dpos;
-    ulength = length;
-    prepend_sign = 0;
-    if (!is_unsigned && value <= neg_one) {
-        if (padding_char == ' ' || width <= length + 1) {
-            *(--dpos) = '-';
-            ++length;
-        } else {
-            prepend_sign = 1;
-        }
-        ++ulength;
-    }
-    if (width > ulength) {
-        ulength = width;
-    }
-    if (ulength == 1) {
-        return PyUnicode_FromOrdinal(*dpos);
-    }
-    return __Pyx_PyUnicode_BuildFromAscii(ulength, dpos, (int) length, prepend_sign, padding_char);
-}
-
 /* PyObjectFormat */
 #if CYTHON_USE_UNICODE_WRITER
 static PyObject* __Pyx_PyObject_Format(PyObject* obj, PyObject* format_spec) {
     int ret;
     _PyUnicodeWriter writer;
     if (likely(PyFloat_CheckExact(obj))) {
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x03040000
@@ -36996,15 +42728,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
@@ -37802,14 +43537,93 @@
     Py_XDECREF(reduce_ex);
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
+/* TypeImport */
+#ifndef __PYX_HAVE_RT_ImportType_0_29_36
+#define __PYX_HAVE_RT_ImportType_0_29_36
+static PyTypeObject *__Pyx_ImportType_0_29_36(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_36 check_size)
+{
+    PyObject *result = 0;
+    char warning[200];
+    Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
+#ifdef Py_LIMITED_API
+    PyObject *py_basicsize;
+    PyObject *py_itemsize;
+#endif
+    result = PyObject_GetAttrString(module, class_name);
+    if (!result)
+        goto bad;
+    if (!PyType_Check(result)) {
+        PyErr_Format(PyExc_TypeError,
+            "%.200s.%.200s is not a type object",
+            module_name, class_name);
+        goto bad;
+    }
+#ifndef Py_LIMITED_API
+    basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
+#else
+    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
+    if (!py_basicsize)
+        goto bad;
+    basicsize = PyLong_AsSsize_t(py_basicsize);
+    Py_DECREF(py_basicsize);
+    py_basicsize = 0;
+    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
+#endif
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
+        PyErr_Format(PyExc_ValueError,
+            "%.200s.%.200s size changed, may indicate binary incompatibility. "
+            "Expected %zd from C header, got %zd from PyObject",
+            module_name, class_name, size, basicsize);
+        goto bad;
+    }
+    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_36 && (size_t)basicsize != size) {
+        PyErr_Format(PyExc_ValueError,
+            "%.200s.%.200s size changed, may indicate binary incompatibility. "
+            "Expected %zd from C header, got %zd from PyObject",
+            module_name, class_name, size, basicsize);
+        goto bad;
+    }
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_36 && (size_t)basicsize > size) {
+        PyOS_snprintf(warning, sizeof(warning),
+            "%s.%s size changed, may indicate binary incompatibility. "
+            "Expected %zd from C header, got %zd from PyObject",
+            module_name, class_name, size, basicsize);
+        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
+    }
+    return (PyTypeObject *)result;
+bad:
+    Py_XDECREF(result);
+    return NULL;
+}
+#endif
+
 /* GetNameInClass */
 static PyObject *__Pyx_GetGlobalNameAfterAttributeLookup(PyObject *name) {
     PyObject *result;
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         return NULL;
@@ -38095,29 +43909,29 @@
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
 
 #if PY_MAJOR_VERSION < 3
 static int __Pyx_GetBuffer(PyObject *obj, Py_buffer *view, int flags) {
     if (PyObject_CheckBuffer(obj)) return PyObject_GetBuffer(obj, view, flags);
-        if (__Pyx_TypeCheck(obj, __pyx_ptype_11sat_toolkit_9_cnf_util_CNF)) return __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_46__getbuffer__(obj, view, flags);
+        if (__Pyx_TypeCheck(obj, __pyx_ptype_11sat_toolkit_7formula_CNF)) return __pyx_pw_11sat_toolkit_7formula_3CNF_67__getbuffer__(obj, view, flags);
         if (__Pyx_TypeCheck(obj, __pyx_array_type)) return __pyx_array_getbuffer(obj, view, flags);
         if (__Pyx_TypeCheck(obj, __pyx_memoryview_type)) return __pyx_memoryview_getbuffer(obj, view, flags);
     PyErr_Format(PyExc_TypeError, "'%.200s' does not have the buffer interface", Py_TYPE(obj)->tp_name);
     return -1;
 }
 static void __Pyx_ReleaseBuffer(Py_buffer *view) {
     PyObject *obj = view->obj;
     if (!obj) return;
     if (PyObject_CheckBuffer(obj)) {
         PyBuffer_Release(view);
         return;
     }
     if ((0)) {}
-        else if (__Pyx_TypeCheck(obj, __pyx_ptype_11sat_toolkit_9_cnf_util_CNF)) __pyx_pw_11sat_toolkit_9_cnf_util_3CNF_48__releasebuffer__(obj, view);
+        else if (__Pyx_TypeCheck(obj, __pyx_ptype_11sat_toolkit_7formula_CNF)) __pyx_pw_11sat_toolkit_7formula_3CNF_69__releasebuffer__(obj, view);
     view->obj = NULL;
     Py_DECREF(obj);
 }
 #endif
 
 
 /* MemviewSliceIsContig */
@@ -38945,26 +44759,49 @@
     retval = -1;
 no_fail:
     __Pyx_RefNannyFinishContext();
     return retval;
 }
 
 /* ObjectToMemviewSlice */
-  static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_int(PyObject *obj, int writable_flag) {
+  static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(PyObject *obj, int writable_flag) {
     __Pyx_memviewslice result = { 0, 0, { 0 }, { 0 }, { 0 } };
     __Pyx_BufFmt_StackElem stack[1];
     int axes_specs[] = { (__Pyx_MEMVIEW_DIRECT | __Pyx_MEMVIEW_STRIDED) };
     int retcode;
     if (obj == Py_None) {
         result.memview = (struct __pyx_memoryview_obj *) Py_None;
         return result;
     }
     retcode = __Pyx_ValidateAndInit_memviewslice(axes_specs, 0,
                                                  PyBUF_RECORDS_RO | writable_flag, 1,
-                                                 &__Pyx_TypeInfo_int, stack,
+                                                 &__Pyx_TypeInfo_int__const__, stack,
+                                                 &result, obj);
+    if (unlikely(retcode == -1))
+        goto __pyx_fail;
+    return result;
+__pyx_fail:
+    result.memview = NULL;
+    result.data = NULL;
+    return result;
+}
+
+/* ObjectToMemviewSlice */
+  static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_11sat_toolkit_5types_uint8_t(PyObject *obj, int writable_flag) {
+    __Pyx_memviewslice result = { 0, 0, { 0 }, { 0 }, { 0 } };
+    __Pyx_BufFmt_StackElem stack[1];
+    int axes_specs[] = { (__Pyx_MEMVIEW_DIRECT | __Pyx_MEMVIEW_STRIDED) };
+    int retcode;
+    if (obj == Py_None) {
+        result.memview = (struct __pyx_memoryview_obj *) Py_None;
+        return result;
+    }
+    retcode = __Pyx_ValidateAndInit_memviewslice(axes_specs, 0,
+                                                 PyBUF_RECORDS_RO | writable_flag, 1,
+                                                 &__Pyx_TypeInfo_nn___pyx_t_11sat_toolkit_5types_uint8_t, stack,
                                                  &result, obj);
     if (unlikely(retcode == -1))
         goto __pyx_fail;
     return result;
 __pyx_fail:
     result.memview = NULL;
     result.data = NULL;
@@ -39018,72 +44855,72 @@
 }
 
 /* MemviewDtypeToObject */
   static CYTHON_INLINE PyObject *__pyx_memview_get_unsigned_char__const__(const char *itemp) {
     return (PyObject *) __Pyx_PyInt_From_unsigned_char(*(unsigned char const  *) itemp);
 }
 
-/* MemviewDtypeToObject */
-  static CYTHON_INLINE PyObject *__pyx_memview_get_int(const char *itemp) {
-    return (PyObject *) __Pyx_PyInt_From_int(*(int *) itemp);
-}
-static CYTHON_INLINE int __pyx_memview_set_int(const char *itemp, PyObject *obj) {
-    int value = __Pyx_PyInt_As_int(obj);
-    if ((value == (int)-1) && PyErr_Occurred())
-        return 0;
-    *(int *) itemp = value;
-    return 1;
-}
-
 /* ObjectToMemviewSlice */
-  static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(PyObject *obj, int writable_flag) {
+  static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_dc_int(PyObject *obj, int writable_flag) {
     __Pyx_memviewslice result = { 0, 0, { 0 }, { 0 }, { 0 } };
     __Pyx_BufFmt_StackElem stack[1];
-    int axes_specs[] = { (__Pyx_MEMVIEW_DIRECT | __Pyx_MEMVIEW_STRIDED) };
+    int axes_specs[] = { (__Pyx_MEMVIEW_DIRECT | __Pyx_MEMVIEW_CONTIG) };
     int retcode;
     if (obj == Py_None) {
         result.memview = (struct __pyx_memoryview_obj *) Py_None;
         return result;
     }
-    retcode = __Pyx_ValidateAndInit_memviewslice(axes_specs, 0,
-                                                 PyBUF_RECORDS_RO | writable_flag, 1,
-                                                 &__Pyx_TypeInfo_int__const__, stack,
+    retcode = __Pyx_ValidateAndInit_memviewslice(axes_specs, __Pyx_IS_C_CONTIG,
+                                                 (PyBUF_C_CONTIGUOUS | PyBUF_FORMAT) | writable_flag, 1,
+                                                 &__Pyx_TypeInfo_int, stack,
                                                  &result, obj);
     if (unlikely(retcode == -1))
         goto __pyx_fail;
     return result;
 __pyx_fail:
     result.memview = NULL;
     result.data = NULL;
     return result;
 }
 
 /* ObjectToMemviewSlice */
-  static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_dc_int(PyObject *obj, int writable_flag) {
+  static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_d_dc_int__const__(PyObject *obj, int writable_flag) {
     __Pyx_memviewslice result = { 0, 0, { 0 }, { 0 }, { 0 } };
     __Pyx_BufFmt_StackElem stack[1];
-    int axes_specs[] = { (__Pyx_MEMVIEW_DIRECT | __Pyx_MEMVIEW_CONTIG) };
+    int axes_specs[] = { (__Pyx_MEMVIEW_DIRECT | __Pyx_MEMVIEW_FOLLOW), (__Pyx_MEMVIEW_DIRECT | __Pyx_MEMVIEW_CONTIG) };
     int retcode;
     if (obj == Py_None) {
         result.memview = (struct __pyx_memoryview_obj *) Py_None;
         return result;
     }
     retcode = __Pyx_ValidateAndInit_memviewslice(axes_specs, __Pyx_IS_C_CONTIG,
-                                                 (PyBUF_C_CONTIGUOUS | PyBUF_FORMAT) | writable_flag, 1,
-                                                 &__Pyx_TypeInfo_int, stack,
+                                                 (PyBUF_C_CONTIGUOUS | PyBUF_FORMAT) | writable_flag, 2,
+                                                 &__Pyx_TypeInfo_int__const__, stack,
                                                  &result, obj);
     if (unlikely(retcode == -1))
         goto __pyx_fail;
     return result;
 __pyx_fail:
     result.memview = NULL;
     result.data = NULL;
     return result;
 }
 
+/* MemviewDtypeToObject */
+  static CYTHON_INLINE PyObject *__pyx_memview_get_int(const char *itemp) {
+    return (PyObject *) __Pyx_PyInt_From_int(*(int *) itemp);
+}
+static CYTHON_INLINE int __pyx_memview_set_int(const char *itemp, PyObject *obj) {
+    int value = __Pyx_PyInt_As_int(obj);
+    if ((value == (int)-1) && PyErr_Occurred())
+        return 0;
+    *(int *) itemp = value;
+    return 1;
+}
+
 /* MemviewSliceCopyTemplate */
   static __Pyx_memviewslice
 __pyx_memoryview_copy_new_contig(const __Pyx_memviewslice *from_mvs,
                                  const char *mode, int ndim,
                                  size_t sizeof_dtype, int contig_flag,
                                  int dtype_is_object)
 {
@@ -39241,15 +45078,15 @@
                         } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                             return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -39475,15 +45312,15 @@
                         } else if (8 * sizeof(unsigned long) >= 4 * PyLong_SHIFT) {
                             return (unsigned long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -39671,15 +45508,15 @@
                         } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                             return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -39911,15 +45748,15 @@
                         } else if (8 * sizeof(size_t) >= 4 * PyLong_SHIFT) {
                             return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -40047,14 +45884,52 @@
     return (size_t) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to size_t");
     return (size_t) -1;
 }
 
+/* CIntToPy */
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const long neg_one = (long) -1, const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(long) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(long) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
+#endif
+        }
+    } else {
+        if (sizeof(long) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
+#endif
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(long),
+                                     little, !is_unsigned);
+    }
+}
+
 /* CIntFromPy */
   static CYTHON_INLINE unsigned int __Pyx_PyInt_As_unsigned_int(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const unsigned int neg_one = (unsigned int) -1, const_zero = (unsigned int) 0;
@@ -40107,15 +45982,15 @@
                         } else if (8 * sizeof(unsigned int) >= 4 * PyLong_SHIFT) {
                             return (unsigned int) (((((((((unsigned int)digits[3]) << PyLong_SHIFT) | (unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -40319,52 +46194,14 @@
         int one = 1; int little = (int)*(unsigned char *)&one;
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(unsigned char),
                                      little, !is_unsigned);
     }
 }
 
-/* CIntToPy */
-  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic push
-#pragma GCC diagnostic ignored "-Wconversion"
-#endif
-    const long neg_one = (long) -1, const_zero = (long) 0;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic pop
-#endif
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(long) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(long) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(long) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(long),
-                                     little, !is_unsigned);
-    }
-}
-
 /* CIntFromPy */
   static CYTHON_INLINE char __Pyx_PyInt_As_char(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const char neg_one = (char) -1, const_zero = (char) 0;
@@ -40417,15 +46254,15 @@
                         } else if (8 * sizeof(char) >= 4 * PyLong_SHIFT) {
                             return (char) (((((((((char)digits[3]) << PyLong_SHIFT) | (char)digits[2]) << PyLong_SHIFT) | (char)digits[1]) << PyLong_SHIFT) | (char)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -41647,15 +47484,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_Generator_init(void) {
     __pyx_GeneratorType_type.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
     __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
     __pyx_GeneratorType = __Pyx_FetchCommonType(&__pyx_GeneratorType_type);
```

### Comparing `sat-toolkit-0.1.2/sat_toolkit/fmt.h` & `sat-toolkit-0.2.0/sat_toolkit/fmt.h`

 * *Files identical despite different names*

### Comparing `sat-toolkit-0.1.2/sat_toolkit.egg-info/PKG-INFO` & `sat-toolkit-0.2.0/sat_toolkit.egg-info/PKG-INFO`

 * *Files 20% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: sat-toolkit
-Version: 0.1.2
+Version: 0.2.0
 Summary: Tool for manipulating CNF formulas
 Home-page: https://github.com/fanosta/sat_toolkit
 Author: Marcel Nageler
 Author-email: marcel.nageler@iaik.tugraz.at
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
```

### Comparing `sat-toolkit-0.1.2/setup.py` & `sat-toolkit-0.2.0/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -16,15 +16,15 @@
 ]
 
 if USE_CYTHON:
     extensions = cythonize(extensions)
 
 setup(
     name='sat-toolkit',
-    version='0.1.2',
+    version='0.2.0',
     author='Marcel Nageler',
     author_email='marcel.nageler@iaik.tugraz.at',
     description='Tool for manipulating CNF formulas',
     long_description=long_description,
     long_description_content_type='text/markdown',
     url='https://github.com/fanosta/sat_toolkit',
     packages=find_packages(),
```


# Comparing `tmp/edx-enterprise-3.9.9.tar.gz` & `tmp/edx-enterprise-4.0.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/edx-enterprise-3.9.9.tar", last modified: Tue Oct 27 15:04:33 2020, max compression
+gzip compressed data, was "edx-enterprise-4.0.0.tar", last modified: Thu Jul 13 16:31:54 2023, max compression
```

## Comparing `edx-enterprise-3.9.9.tar` & `edx-enterprise-4.0.0.tar`

### file list

```diff
@@ -1,529 +1,767 @@
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/
--rw-rw-r--   0 travis    (2000) travis    (2000)    84110 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/CHANGELOG.rst
--rw-rw-r--   0 travis    (2000) travis    (2000)      500 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/MANIFEST.in
--rw-rw-r--   0 travis    (2000) travis    (2000)   116100 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/PKG-INFO
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/consent/
--rw-rw-r--   0 travis    (2000) travis    (2000)      247 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/urls.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/consent/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)     5431 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/migrations/0004_datasharingconsenttextoverrides.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3713 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2683 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/migrations/0002_migrate_to_new_data_sharing_consent.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      427 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/migrations/0003_historicaldatasharingconsent_history_change_reason.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/migrations/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/consent/api/
--rw-rw-r--   0 travis    (2000) travis    (2000)      256 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/api/urls.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      824 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/api/permissions.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/api/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/consent/api/v1/
--rw-rw-r--   0 travis    (2000) travis    (2000)      448 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/api/v1/urls.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/api/v1/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    11366 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/api/v1/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    15773 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      407 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3965 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/mixins.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      679 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2956 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/helpers.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      682 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/errors.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/consent/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     3485 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/consent/admin/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/edx_enterprise.egg-info/
--rw-rw-r--   0 travis    (2000) travis    (2000)   116100 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/edx_enterprise.egg-info/PKG-INFO
--rw-rw-r--   0 travis    (2000) travis    (2000)        1 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/edx_enterprise.egg-info/dependency_links.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)       65 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/edx_enterprise.egg-info/top_level.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)        1 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/edx_enterprise.egg-info/not-zip-safe
--rw-rw-r--   0 travis    (2000) travis    (2000)    23947 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/edx_enterprise.egg-info/SOURCES.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)      545 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/edx_enterprise.egg-info/requires.txt
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/templatetags/
--rw-rw-r--   0 travis    (2000) travis    (2000)     3667 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templatetags/enterprise.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templatetags/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    17586 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/signals.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2231 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/validators.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     7757 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/decorators.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/static/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/js/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1262 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/js/enterprise_login_page.js
--rw-rw-r--   0 travis    (2000) travis    (2000)     5143 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/js/manage_learners.js
--rw-rw-r--   0 travis    (2000) travis    (2000)     2368 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/js/program_enrollment_landing_page.js
--rw-rw-r--   0 travis    (2000) travis    (2000)     1404 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/js/course_modal.js
--rw-rw-r--   0 travis    (2000) travis    (2000)      890 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/js/enterprise_customer.js
--rw-rw-r--   0 travis    (2000) travis    (2000)     1293 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/js/enterprise_selection_page.js
--rw-rw-r--   0 travis    (2000) travis    (2000)     2839 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/js/grant_data_sharing_permissions.js
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/bundles/
--rw-rw-r--   0 travis    (2000) travis    (2000)    16059 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/bundles/main.style.css
--rw-rw-r--   0 travis    (2000) travis    (2000)      328 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/bundles/main-admin.style.css
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1444 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/static/enterprise/admin/enterprise_customer_catalog.js
--rw-rw-r--   0 travis    (2000) travis    (2000)     5894 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/rules.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2776 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/urls.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/templates/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/templatetags/
--rw-rw-r--   0 travis    (2000) travis    (2000)      227 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/templatetags/alert_messages.html
--rw-rw-r--   0 travis    (2000) travis    (2000)      313 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/templatetags/expand_button.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     5642 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/templatetags/course_modal.html
--rw-rw-r--   0 travis    (2000) travis    (2000)       77 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/templatetags/fa_icon.html
--rw-rw-r--   0 travis    (2000) travis    (2000)      443 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/_enterprise_customer_sidebar.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     1783 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_customer_select_form.html
--rw-rw-r--   0 travis    (2000) travis    (2000)      312 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_policy.html
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/emails/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1209 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/emails/user_notification.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     1060 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/emails/user_notification.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)     1238 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/grant_data_sharing_permissions.html
--rw-rw-r--   0 travis    (2000) travis    (2000)      614 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_top_paragraph.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     1573 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_customer_login_page.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     1123 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_decline_modal.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     4334 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_course_enrollment_page.html
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/widgets/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1594 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/widgets/segment-io-django.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     1311 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_policy_paragraph.html
--rw-rw-r--   0 travis    (2000) travis    (2000)      449 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_error_page_with_messages.html
--rw-rw-r--   0 travis    (2000) travis    (2000)    10275 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_program_enrollment_page.html
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1851 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/admin/clear_learners_data_sharing_consent.html
--rw-rw-r--   0 travis    (2000) travis    (2000)      239 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/admin/enterprise_course_enrollments_list.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     7410 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/admin/manage_learners.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     1839 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/admin/transmit_courses_metadata.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     2024 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/base.html
--rw-rw-r--   0 travis    (2000) travis    (2000)     1608 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_user_input.html
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/heartbeat/
--rw-rw-r--   0 travis    (2000) travis    (2000)     3979 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/heartbeat/checks.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      288 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/heartbeat/throttles.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1474 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/heartbeat/exceptions.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1886 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/heartbeat/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)       43 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/heartbeat/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      871 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/heartbeat/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4734 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/messages.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     5640 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/constants.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)      402 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0046_remove_unique_constraints.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1272 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0060_upgrade_django_simple_history.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2330 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0097_auto_20200619_1130.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3116 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0100_add_licensed_enterprise_course_enrollment.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      867 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0108_add_licensed_enrollment_is_revoked.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      518 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0069_auto_20190613_0607.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2936 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0024_enterprisecustomercatalog_historicalenterprisecustomercatalog.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      679 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0089_auto_20200305_0652.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1281 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0051_add_enterprise_slug.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      877 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0093_add_use_enterprise_catalog_flag.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      814 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0095_auto_20200507_1138.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1955 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0058_auto_20181212_0145.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      728 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0007_auto_20161109_1511.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      540 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0107_remove_branding_config_banner_fields.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      608 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0101_move_data_to_saved_for_later.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      861 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0059_add_code_management_portal_config.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1819 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0025_auto_20170828_1412.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      758 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0012_auto_20170125_1033.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      813 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0112_auto_20200914_0926.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      432 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0048_enterprisecustomeruser_active.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3009 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0111_pendingenterprisecustomeradminuser.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1307 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0020_auto_20170624_2316.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      459 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0063_systemwideenterpriserole_description.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1431 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0044_reporting_config_multiple_types.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1219 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0010_auto_20161222_1212.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      855 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0102_auto_20200708_1615.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      575 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0056_enterprisecustomerreportingconfiguration_pgp_encryption_key.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      687 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0040_auto_20180129_1428.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      317 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0054_merge_20180914_1511.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1685 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0008_auto_20161124_2355.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1210 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0028_link_enterprise_to_enrollment_template.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      511 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0029_auto_20170925_1909.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      803 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0099_auto_20200702_1537.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3647 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    57493 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0001_squashed_0092_auto_20200312_1650.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1384 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0027_remove_account_level_consent.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1406 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0081_UpdateEnterpriseEnrollmentSource.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    10636 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0016_auto_20170405_0647.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      998 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0034_auto_20171023_0727.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      969 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0031_auto_20171012_1249.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1025 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0073_enterprisecustomerreportingconfiguration_uuid.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      863 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0037_auto_20180110_0450.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      483 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0030_auto_20171005_1600.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      590 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0057_enterprisecustomerreportingconfiguration_enterprise_customer_catalogs.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      914 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0092_auto_20200312_1650.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1155 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0082_AddManagementEnterpriseEnrollmentSource.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      649 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0050_progress_v2.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      951 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0113_auto_20200914_2054.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2016 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0061_systemwideenterpriserole_systemwideenterpriseuserroleassignment.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2128 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0017_auto_20170508_1341.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      644 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0053_auto_20180911_0811.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      844 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0109_remove_use_enterprise_catalog_sample.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2995 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0032_reporting_model.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2484 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0036_sftp_reporting_support.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      861 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0015_auto_20170130_0003.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      689 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0087_auto_20200206_1151.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      917 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0052_create_unique_slugs.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1065 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0022_auto_20170720_1543.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2188 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0070_enterprise_catalog_query.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      883 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0068_remove_role_based_access_control_switch.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1164 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0005_pendingenterprisecustomeruser.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      432 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0085_enterprisecustomeruser_linked.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3119 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0115_enterpriseanalyticsuser_historicalenterpriseanalyticsuser.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3298 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0079_AddEnterpriseEnrollmentSource.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      958 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0021_auto_20170711_0712.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2349 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0088_auto_20200224_1341.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      903 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0039_auto_20180129_1034.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3889 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0071_historicalpendingenrollment_historicalpendingenterprisecustomeruser.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      809 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0035_auto_20171212_1129.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      479 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0084_auto_20200120_1137.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      520 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0080_auto_20191113_1708.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1461 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0076_auto_20190918_2037.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1405 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0094_add_use_enterprise_catalog_sample.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2318 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0043_auto_20180507_0138.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      922 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0067_add_role_based_access_control_switch.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      832 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0055_auto_20181015_1112.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1253 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0033_add_history_change_reason_field.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1044 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0062_add_system_wide_enterprise_roles.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1042 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0038_auto_20180122_1427.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      556 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0083_enterprisecustomerreportingconfiguration_include_date.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      939 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0042_replace_sensitive_sso_username.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      951 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0026_make_require_account_level_consent_nullable.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1218 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0096_enterprise_catalog_admin_role.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      881 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0077_auto_20191002_1529.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      468 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0006_auto_20161121_0241.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1252 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0065_add_enterprise_feature_roles.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      939 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0019_auto_20170606_1853.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     8445 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0014_enrollmentnotificationemailtemplate_historicalenrollmentnotificationemailtemplate.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      862 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0047_auto_20180517_0457.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      455 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0053_pendingenrollment_cohort_name.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      624 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0049_auto_20180531_0321.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1008 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0072_add_enterprise_report_config_feature_role.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2114 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0090_update_content_filter.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      803 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0023_audit_data_reporting_flag.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      844 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0074_auto_20190904_1143.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      811 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0098_auto_20200629_1756.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1374 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0106_move_branding_config_colors.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2204 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0064_enterprisefeaturerole_enterprisefeatureuserroleassignment.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      508 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0078_auto_20191107_1536.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      817 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0018_auto_20170511_1357.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      995 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0114_auto_20201020_0142.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      495 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0103_remove_marked_done.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      618 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0045_report_type_json.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1163 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0110_add_default_contract_discount.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      639 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0104_sync_query_field.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1391 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0003_auto_20161104_0937.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1412 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0086_auto_20200128_1726.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      934 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0066_add_system_wide_enterprise_operator_role.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      664 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0004_auto_20161114_0434.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3093 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0011_enterprisecustomerentitlement_historicalenterprisecustomerentitlement.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1471 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0002_enterprisecustomerbrandingconfiguration.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3295 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0013_auto_20170125_1157.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1373 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0075_auto_20190916_1030.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      664 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0091_add_sales_force_id_in_pendingenrollment.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1072 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0105_add_branding_config_color_fields.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      549 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0041_auto_20180212_1507.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4999 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/migrations/0009_auto_20161130_1651.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/api/
--rw-rw-r--   0 travis    (2000) travis    (2000)     2552 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/filters.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1350 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/pagination.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      203 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/urls.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1637 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/throttles.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3384 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/api/v1/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1918 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/v1/decorators.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1707 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/v1/urls.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      822 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/v1/permissions.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    35766 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/v1/serializers.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4371 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/v1/mixins.py
--rw-rw-r--   0 travis    (2000) travis    (2000)       65 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/v1/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    40370 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api/v1/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    44894 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    95933 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3160 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/middleware.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2076 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/tasks.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1855 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      156 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)   109156 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      208 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/errors.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/management/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/management/commands/
--rw-rw-r--   0 travis    (2000) travis    (2000)    12459 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/management/commands/seed_enterprise_devstack_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4358 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/management/commands/migrate_enterprise_catalogs.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     7791 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/management/commands/create_enterprise_course_enrollments.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1393 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/management/commands/save_enterprise_customer_users.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     8034 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/management/commands/assign_enterprise_user_roles.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2089 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/management/commands/create_missing_dsc_records.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/management/commands/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/management/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     5825 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/tpa_pipeline.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/settings/
--rw-rw-r--   0 travis    (2000) travis    (2000)     8736 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/settings/test.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/settings/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1617 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/views_error_codes.txt
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)      275 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/admin/widgets.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     9587 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/admin/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      838 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/admin/paginator.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3653 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/admin/actions.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    29811 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/admin/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    39968 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/admin/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    22724 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/admin/forms.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3383 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/forms.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise/api_client/
--rw-rw-r--   0 travis    (2000) travis    (2000)     4123 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api_client/enterprise.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    10316 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api_client/enterprise_catalog.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    16482 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api_client/discovery.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api_client/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4606 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api_client/ecommerce.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    19909 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise/api_client/lms.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      157 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/setup.cfg
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/requirements/
--rw-rw-r--   0 travis    (2000) travis    (2000)     7447 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/test.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)      910 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/dev.in
--rw-rw-r--   0 travis    (2000) travis    (2000)      403 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/doc.in
--rw-rw-r--   0 travis    (2000) travis    (2000)      249 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/travis.in
--rw-rw-r--   0 travis    (2000) travis    (2000)      388 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/js_test.in
--rw-rw-r--   0 travis    (2000) travis    (2000)    19658 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/edx-platform-constraints.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)     1110 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/travis.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)      809 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/base.in
--rw-rw-r--   0 travis    (2000) travis    (2000)     7635 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/doc.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)     7603 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/test-master.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)     1274 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/constraints.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)      704 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/test.in
--rw-rw-r--   0 travis    (2000) travis    (2000)     1292 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/js_test.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)      302 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/django.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)    15018 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/dev.txt
--rw-rw-r--   0 travis    (2000) travis    (2000)      125 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/requirements/test-master.in
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/degreed/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/degreed/transmitters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1259 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/transmitters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/transmitters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1050 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/transmitters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/degreed/exporters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     3104 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/exporters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/exporters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3050 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/exporters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)     3549 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0005_auto_20180807_1302.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      828 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0004_auto_20180306_1251.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      652 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0003_auto_20180109_0712.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     7351 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      775 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0006_upgrade_django_simple_history.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      960 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0002_auto_20180104_0103.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1137 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0007_auto_20190925_0730.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      812 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0008_auto_20191001_0742.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     9166 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      367 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      225 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     9290 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/client.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/degreed/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1691 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/degreed/admin/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/
--rw-rw-r--   0 travis    (2000) travis    (2000)      327 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/urls.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/transmitters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1306 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/transmitters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/transmitters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1107 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/transmitters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/exporters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     2636 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/exporters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/exporters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     5928 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/exporters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)      531 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0004_cornerstoneglobalconfiguration_languages.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      942 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0005_auto_20190925_0730.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      534 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0002_cornerstoneglobalconfiguration_subject_mapping.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     6879 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      824 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0006_auto_20191001_0742.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1366 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0003_auto_20190621_1000.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1120 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     8135 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      387 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      237 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4239 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3561 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/client.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1600 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/cornerstone/admin/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/
--rw-rw-r--   0 travis    (2000) travis    (2000)       98 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/constants.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/transmitters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     5084 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/transmitters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1208 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/transmitters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    11029 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/transmitters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/exporters/
--rw-rw-r--   0 travis    (2000) travis    (2000)    20821 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/exporters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1212 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/exporters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     6712 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/exporters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)      301 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0002_delete_enterpriseintegratedchannel.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1329 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      477 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0004_catalogtransmissionaudit_channel.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      495 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0007_auto_20190925_0730.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      309 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0006_delete_catalogtransmissionaudit.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2800 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0001_squashed_0007_auto_20190925_0730.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1440 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0005_auto_20180306_1251.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2555 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0003_catalogtransmissionaudit_learnerdatatransmissionaudit.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     9926 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     6359 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/tasks.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      372 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      303 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1089 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/unlink_inactive_sap_learners.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2190 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/transmit_learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1830 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/transmit_content_metadata.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4665 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2653 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/reset_sapsf_learner_transmissions.py
--rw-rw-r--   0 travis    (2000) travis    (2000)       81 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2230 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/integrated_channel/client.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1846 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/constants.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/transmitters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     2531 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/transmitters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/transmitters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4600 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/transmitters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/exporters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     7420 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/exporters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      803 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/exporters/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/exporters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     9693 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/exporters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)      684 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0012_auto_20180109_0712.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1660 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0003_auto_20170317_1402.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     7772 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0001_squashed_0022_auto_20200206_1046.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1012 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0010_move_audit_tables_to_base_integrated_channel.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      916 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0006_sapsuccessfactors_use_enterprise_enrollment_page_waffle_flag.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      676 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0015_auto_20180510_1259.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      622 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0014_drop_historical_table.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      521 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0005_historicalsapsuccessfactorsenterprisecustomerconfiguration_history_change_reason.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      610 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0017_sapsuccessfactorsglobalconfiguration_search_student_api_path.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     5802 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      530 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0016_sapsuccessfactorsenterprisecustomerconfiguration_additional_locales.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1732 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0002_auto_20170224_1545.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      877 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0019_auto_20190925_0730.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      917 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0009_sapsuccessfactors_remove_enterprise_enrollment_page_waffle_flag.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      434 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0007_remove_historicalsapsuccessfactorsenterprisecustomerconfiguration_history_change_reason.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      553 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0020_sapsuccessfactorsenterprisecustomerconfiguration_catalogs_to_transmit.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      562 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0021_sapsuccessfactorsenterprisecustomerconfiguration_show_total_hours.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      860 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0013_auto_20180306_1251.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      521 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0018_sapsuccessfactorsenterprisecustomerconfiguration_show_course_price.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      992 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0022_auto_20200206_1046.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      446 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0004_catalogtransmissionaudit_audit_summary.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4495 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0011_auto_20180104_0103.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      521 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0008_historicalsapsuccessfactorsenterprisecustomerconfiguration_history_change_reason.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     9854 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      422 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      234 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    13476 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/client.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     3222 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/sap_success_factors/admin/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/canvas/
--rw-rw-r--   0 travis    (2000) travis    (2000)      312 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/urls.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/canvas/transmitters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1244 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/transmitters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/transmitters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1002 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/transmitters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/canvas/exporters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     3064 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/exporters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/exporters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2605 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/exporters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/canvas/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)     6806 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      816 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0005_auto_20200909_1534.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1435 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0004_adding_learner_data_to_canvas.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1020 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0002_auto_20200806_1632.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      314 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0003_delete_canvasglobalconfiguration.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     6421 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      411 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      222 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4184 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    20416 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/client.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/canvas/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1110 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/canvas/admin/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/moodle/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/moodle/transmitters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1244 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/transmitters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/transmitters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     7255 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/transmitters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/moodle/exporters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     2873 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/exporters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/exporters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4484 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/exporters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/moodle/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)     6261 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1487 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/migrations/0002_moodlelearnerdatatransmissionaudit.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      865 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/migrations/0003_auto_20201006_1706.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     6769 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      362 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      222 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    13982 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/client.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/moodle/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1498 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/moodle/admin/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/xapi/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/xapi/statements/
--rw-rw-r--   0 travis    (2000) travis    (2000)     2273 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/statements/learner_course_completion.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2807 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/statements/base.py
--rw-rw-r--   0 travis    (2000) travis    (2000)       24 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/statements/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1504 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/statements/learner_course_enrollment.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      358 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/constants.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/xapi/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1874 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/migrations/0003_auto_20190807_1006.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1499 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      451 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/migrations/0004_auto_20190830_0710.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      863 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/migrations/0002_auto_20180726_0142.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     5085 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3529 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      303 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      193 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/xapi/management/
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/xapi/management/commands/
--rw-rw-r--   0 travis    (2000) travis    (2000)    13660 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/management/commands/send_course_completions.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    12186 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/management/commands/send_course_enrollments.py
--rw-rw-r--   0 travis    (2000) travis    (2000)       67 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/management/commands/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)       67 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/management/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1524 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/client.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/xapi/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1074 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/xapi/admin/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      411 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/exceptions.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/
--rw-rw-r--   0 travis    (2000) travis    (2000)      332 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/urls.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/transmitters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1304 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/transmitters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/transmitters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1046 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/transmitters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/exporters/
--rw-rw-r--   0 travis    (2000) travis    (2000)     2921 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/exporters/learner_data.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/exporters/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2519 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/exporters/content_metadata.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)     6057 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/migrations/0001_initial.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1982 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/migrations/0002_auto_20200930_1723.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      881 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/migrations/0004_blackboard_tx_chunk_size_default_1.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/migrations/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     1583 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/migrations/0003_blackboardlearnerdatatransmissionaudit.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     6882 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/models.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      502 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      234 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     5437 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    25739 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/client.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/admin/
--rw-rw-r--   0 travis    (2000) travis    (2000)     1116 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/blackboard/admin/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)    10668 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)       49 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/integrated_channels/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise_learner_portal/
--rw-rw-r--   0 travis    (2000) travis    (2000)      216 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/urls.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise_learner_portal/migrations/
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/migrations/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise_learner_portal/api/
--rw-rw-r--   0 travis    (2000) travis    (2000)      232 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/api/urls.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/api/__init__.py
-drwxrwxr-x   0 travis    (2000) travis    (2000)        0 2020-10-27 15:04:33.000000 edx-enterprise-3.9.9/enterprise_learner_portal/api/v1/
--rw-rw-r--   0 travis    (2000) travis    (2000)      403 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/api/v1/urls.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     3091 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/api/v1/serializers.py
--rw-rw-r--   0 travis    (2000) travis    (2000)        0 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/api/v1/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     4204 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/api/v1/views.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2402 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/utils.py
--rw-rw-r--   0 travis    (2000) travis    (2000)      246 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/apps.py
--rw-rw-r--   0 travis    (2000) travis    (2000)       67 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/enterprise_learner_portal/__init__.py
--rw-rw-r--   0 travis    (2000) travis    (2000)     2813 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/README.rst
--rwxrwxr-x   0 travis    (2000) travis    (2000)     4242 2020-10-27 14:59:54.000000 edx-enterprise-3.9.9/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.879406 edx-enterprise-4.0.0/
+-rw-r--r--   0 runner    (1001) docker     (123)   137250 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/CHANGELOG.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    35136 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)      510 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)   185995 2023-07-13 16:31:54.879406 edx-enterprise-4.0.0/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     2550 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/README.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.815406 edx-enterprise-4.0.0/consent/
+-rw-r--r--   0 runner    (1001) docker     (123)      623 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.815406 edx-enterprise-4.0.0/consent/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     3390 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/admin/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.815406 edx-enterprise-4.0.0/consent/api/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/api/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      772 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/api/permissions.py
+-rw-r--r--   0 runner    (1001) docker     (123)      216 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/api/urls.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.819406 edx-enterprise-4.0.0/consent/api/v1/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/api/v1/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      407 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/api/v1/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11310 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/api/v1/views.py
+-rw-r--r--   0 runner    (1001) docker     (123)      383 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)      658 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/errors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2868 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/helpers.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.819406 edx-enterprise-4.0.0/consent/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     3653 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/migrations/0001_initial.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2630 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/migrations/0002_migrate_to_new_data_sharing_consent.py
+-rw-r--r--   0 runner    (1001) docker     (123)      401 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/migrations/0003_historicaldatasharingconsent_history_change_reason.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5421 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/migrations/0004_datasharingconsenttextoverrides.py
+-rw-r--r--   0 runner    (1001) docker     (123)      669 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/migrations/0005_auto_20230707_0755.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4405 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/mixins.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15248 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)      207 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/consent/urls.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.819406 edx-enterprise-4.0.0/edx_enterprise.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)   185995 2023-07-13 16:31:53.000000 edx-enterprise-4.0.0/edx_enterprise.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    38833 2023-07-13 16:31:54.000000 edx-enterprise-4.0.0/edx_enterprise.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-13 16:31:53.000000 edx-enterprise-4.0.0/edx_enterprise.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-13 16:31:53.000000 edx-enterprise-4.0.0/edx_enterprise.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (123)      574 2023-07-13 16:31:53.000000 edx-enterprise-4.0.0/edx_enterprise.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       65 2023-07-13 16:31:53.000000 edx-enterprise-4.0.0/edx_enterprise.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.819406 edx-enterprise-4.0.0/enterprise/
+-rw-r--r--   0 runner    (1001) docker     (123)      124 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.823406 edx-enterprise-4.0.0/enterprise/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)    32944 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3505 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/admin/actions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30210 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/admin/forms.py
+-rw-r--r--   0 runner    (1001) docker     (123)      814 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/admin/paginator.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5129 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/admin/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36495 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/admin/views.py
+-rw-r--r--   0 runner    (1001) docker     (123)      251 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/admin/widgets.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.823406 edx-enterprise-4.0.0/enterprise/api/
+-rw-r--r--   0 runner    (1001) docker     (123)     1721 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5380 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/filters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1284 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/pagination.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2437 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/throttles.py
+-rw-r--r--   0 runner    (1001) docker     (123)      182 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3747 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.823406 edx-enterprise-4.0.0/enterprise/api/v1/
+-rw-r--r--   0 runner    (1001) docker     (123)       41 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1895 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/decorators.py
+-rw-r--r--   0 runner    (1001) docker     (123)      815 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/fields.py
+-rw-r--r--   0 runner    (1001) docker     (123)      739 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/permissions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    57862 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4418 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/urls.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.823406 edx-enterprise-4.0.0/enterprise/api/v1/views/
+-rw-r--r--   0 runner    (1001) docker     (123)       42 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2600 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/base_views.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5478 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/coupon_codes.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1159 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_catalog_query.py
+-rw-r--r--   0 runner    (1001) docker     (123)      954 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_course_enrollment.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19699 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_customer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3192 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_customer_branding_configuration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9987 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_customer_catalog.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6274 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_customer_invite_key.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6278 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_customer_reporting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1143 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_customer_user.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28693 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_subsidy_fulfillment.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4583 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/notifications.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4301 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/pending_enterprise_customer_user.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1340 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api/v1/views/plotly_auth.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/api_client/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api_client/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3573 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api_client/client.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15199 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api_client/discovery.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4828 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api_client/ecommerce.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4128 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api_client/enterprise.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14281 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api_client/enterprise_catalog.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20277 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/api_client/lms.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2298 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/apps.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/conf/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/conf/locale/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/conf/locale/en/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/conf/locale/en/LC_MESSAGES/
+-rw-r--r--   0 runner    (1001) docker     (123)    11981 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/conf/locale/en/LC_MESSAGES/django.po
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/config/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/config/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1820 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/config/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7497 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/constants.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8096 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/decorators.py
+-rw-r--r--   0 runner    (1001) docker     (123)      818 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/errors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4707 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/forms.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/heartbeat/
+-rw-r--r--   0 runner    (1001) docker     (123)       43 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/heartbeat/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4280 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/heartbeat/checks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1474 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/heartbeat/exceptions.py
+-rw-r--r--   0 runner    (1001) docker     (123)      288 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/heartbeat/throttles.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1820 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/heartbeat/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      871 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/heartbeat/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/locale/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/locale/en/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/locale/en/LC_MESSAGES/
+-rw-r--r--   0 runner    (1001) docker     (123)    41500 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/locale/en/LC_MESSAGES/django.po
+-rw-r--r--   0 runner    (1001) docker     (123)     1476 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/locale/en/LC_MESSAGES/djangojs.po
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/locale/eo/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/locale/eo/LC_MESSAGES/
+-rw-r--r--   0 runner    (1001) docker     (123)   104293 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/locale/eo/LC_MESSAGES/django.po
+-rw-r--r--   0 runner    (1001) docker     (123)     2039 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/locale/eo/LC_MESSAGES/djangojs.po
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/locale/es_419/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/locale/es_419/LC_MESSAGES/
+-rw-r--r--   0 runner    (1001) docker     (123)     7727 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/locale/es_419/LC_MESSAGES/django.mo
+-rw-r--r--   0 runner    (1001) docker     (123)    45236 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/locale/es_419/LC_MESSAGES/django.po
+-rw-r--r--   0 runner    (1001) docker     (123)      955 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/logging.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/management/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.827406 edx-enterprise-4.0.0/enterprise/management/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3108 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/backfill_learner_role_assignments.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3647 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/bulk_update_catalog_query_id.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7679 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/create_enterprise_course_enrollments.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2065 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/create_missing_dsc_records.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9317 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/email_drip_for_missing_dsc_records.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4206 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/ensure_singular_active_enterprise_customer_user.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2578 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/fix_dsc_records.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5075 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/migrate_enterprise_catalogs.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32481 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/monthly_impact_report.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7048 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/nudge_dormant_enrolled_enterprise_learners.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4125 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/revert_enrollment_objects.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1369 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/save_enterprise_customer_users.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14043 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/seed_enterprise_devstack_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4186 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/unlink_enterprise_customer_learners.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5887 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/update_config_last_errored_at.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11386 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/management/commands/update_role_assignments_with_customers.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4709 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/messages.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3160 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/middleware.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.835406 edx-enterprise-4.0.0/enterprise/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)      864 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0001_auto_20210111_1253.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52500 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0001_squashed_0092_auto_20200312_1650.py
+-rw-r--r--   0 runner    (1001) docker     (123)      903 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0093_add_use_enterprise_catalog_flag.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1379 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0094_add_use_enterprise_catalog_sample.py
+-rw-r--r--   0 runner    (1001) docker     (123)      814 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0095_auto_20200507_1138.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1218 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0096_enterprise_catalog_admin_role.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2330 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0097_auto_20200619_1130.py
+-rw-r--r--   0 runner    (1001) docker     (123)      811 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0098_auto_20200629_1756.py
+-rw-r--r--   0 runner    (1001) docker     (123)      803 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0099_auto_20200702_1537.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3116 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0100_add_licensed_enterprise_course_enrollment.py
+-rw-r--r--   0 runner    (1001) docker     (123)      608 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0101_move_data_to_saved_for_later.py
+-rw-r--r--   0 runner    (1001) docker     (123)      855 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0102_auto_20200708_1615.py
+-rw-r--r--   0 runner    (1001) docker     (123)      495 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0103_remove_marked_done.py
+-rw-r--r--   0 runner    (1001) docker     (123)      639 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0104_sync_query_field.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0105_add_branding_config_color_fields.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1374 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0106_move_branding_config_colors.py
+-rw-r--r--   0 runner    (1001) docker     (123)      540 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0107_remove_branding_config_banner_fields.py
+-rw-r--r--   0 runner    (1001) docker     (123)      867 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0108_add_licensed_enrollment_is_revoked.py
+-rw-r--r--   0 runner    (1001) docker     (123)      818 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0109_remove_use_enterprise_catalog_sample.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1163 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0110_add_default_contract_discount.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3009 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0111_pendingenterprisecustomeradminuser.py
+-rw-r--r--   0 runner    (1001) docker     (123)      813 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0112_auto_20200914_0926.py
+-rw-r--r--   0 runner    (1001) docker     (123)      951 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0113_auto_20200914_2054.py
+-rw-r--r--   0 runner    (1001) docker     (123)      995 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0114_auto_20201020_0142.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3119 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0115_enterpriseanalyticsuser_historicalenterpriseanalyticsuser.py
+-rw-r--r--   0 runner    (1001) docker     (123)      784 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0116_auto_20201116_0400.py
+-rw-r--r--   0 runner    (1001) docker     (123)      863 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0116_auto_20201208_1759.py
+-rw-r--r--   0 runner    (1001) docker     (123)      586 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0117_auto_20201215_0258.py
+-rw-r--r--   0 runner    (1001) docker     (123)      892 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0120_systemwiderole_applies_to_all_contexts.py
+-rw-r--r--   0 runner    (1001) docker     (123)      855 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0121_systemwiderole_add_ent_cust_field.py
+-rw-r--r--   0 runner    (1001) docker     (123)      544 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0122_remove_field_sync_enterprise_catalog_query.py
+-rw-r--r--   0 runner    (1001) docker     (123)      534 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0123_enterprisecustomeridentityprovider_default_provider.py
+-rw-r--r--   0 runner    (1001) docker     (123)      788 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0124_auto_20210301_1309.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1894 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0125_add_config_for_role_assign_backfill.py
+-rw-r--r--   0 runner    (1001) docker     (123)      648 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0126_auto_20210308_1522.py
+-rw-r--r--   0 runner    (1001) docker     (123)      430 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0127_enterprisecatalogquery_uuid.py
+-rw-r--r--   0 runner    (1001) docker     (123)      535 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0128_enterprisecatalogquery_generate_uuids.py
+-rw-r--r--   0 runner    (1001) docker     (123)      427 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0129_enterprisecatalogquery_uuid_unique.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1171 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0130_lms_customer_lp_search_help_text.py
+-rw-r--r--   0 runner    (1001) docker     (123)      827 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0131_auto_20210517_0924.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1345 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0132_auto_20210608_1921.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26436 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0133_auto_20210608_1931.py
+-rw-r--r--   0 runner    (1001) docker     (123)      567 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0134_enterprisecustomerreportingconfiguration_enable_compression.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3721 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0135_adminnotification_adminnotificationfilter_adminnotificationread.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4957 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0136_auto_20210629_2129.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16936 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0137_enrollment_email_update.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1300 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0138_bulkcatalogqueryupdatecommandconfiguration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1059 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0139_auto_20210803_1854.py
+-rw-r--r--   0 runner    (1001) docker     (123)      965 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0140_update_enrollment_sources.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1274 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0141_make_enterprisecatalogquery_title_unique.py
+-rw-r--r--   0 runner    (1001) docker     (123)      799 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0142_auto_20210907_2059.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2450 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0143_auto_20210908_0559.py
+-rw-r--r--   0 runner    (1001) docker     (123)      632 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0144_auto_20211011_1030.py
+-rw-r--r--   0 runner    (1001) docker     (123)      827 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0145_auto_20211013_1018.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4275 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0146_enterprise_customer_invite_key.py
+-rw-r--r--   0 runner    (1001) docker     (123)      793 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0147_auto_20211129_1949.py
+-rw-r--r--   0 runner    (1001) docker     (123)      853 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0148_auto_20211129_2114.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1630 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0149_invite_key_required_default_expiry_backfill.py
+-rw-r--r--   0 runner    (1001) docker     (123)      739 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0150_invite_key_expiry_required.py
+-rw-r--r--   0 runner    (1001) docker     (123)      843 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0151_add_is_active_to_invite_key.py
+-rw-r--r--   0 runner    (1001) docker     (123)      922 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0152_add_should_inactivate_other_customers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      872 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0153_add_enable_browse_and_request.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1598 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0154_alter_systemwideenterpriseuserroleassignment_unique_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)      799 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0155_add_is_relinkable_to_enterprise_customer_user.py
+-rw-r--r--   0 runner    (1001) docker     (123)      650 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0156_add_is_active_role_assignment.py
+-rw-r--r--   0 runner    (1001) docker     (123)      660 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0157_make_field_nullable_before_removal.py
+-rw-r--r--   0 runner    (1001) docker     (123)      531 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0158_remove_is_active_from_role_assignment.py
+-rw-r--r--   0 runner    (1001) docker     (123)      848 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0159_add_enable_learner_portal_offers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      889 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0160_add_enable_portal_learner_credit_management_screen.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1191 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0161_alter_enterprisecustomerreportingconfiguration_data_type.py
+-rw-r--r--   0 runner    (1001) docker     (123)      891 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0162_add_enable_executive_education_2U_fulfillment.py
+-rw-r--r--   0 runner    (1001) docker     (123)      980 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0163_auto_20220928_1611.py
+-rw-r--r--   0 runner    (1001) docker     (123)      727 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0164_enterprisecatalogquery_include_exec_ed_2u_courses.py
+-rw-r--r--   0 runner    (1001) docker     (123)      664 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0165_alter_enterprisecustomerreportingconfiguration_pgp_encryption_key.py
+-rw-r--r--   0 runner    (1001) docker     (123)      744 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0166_auto_20221209_0819.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11633 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0167_auto_20230209_2108.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1108 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0168_auto_20230222_1621.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1134 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0169_auto_20230222_1621.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1575 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0170_auto_20230301_1627.py
+-rw-r--r--   0 runner    (1001) docker     (123)      737 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0171_auto_20230503_1413.py
+-rw-r--r--   0 runner    (1001) docker     (123)      891 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0172_auto_20230517_1550.py
+-rw-r--r--   0 runner    (1001) docker     (123)      891 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0173_auto_20230531_1459.py
+-rw-r--r--   0 runner    (1001) docker     (123)      869 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/0174_auto_20230608_2041.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2063 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/migrations/unique_constraints_pending_users.py
+-rw-r--r--   0 runner    (1001) docker     (123)   134534 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4111 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/roles_api.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6743 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/rules.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.835406 edx-enterprise-4.0.0/enterprise/settings/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/settings/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9726 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/settings/test.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17784 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/signals.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/static/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/static/enterprise/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.835406 edx-enterprise-4.0.0/enterprise/static/enterprise/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     1444 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/admin/enterprise_customer_catalog.js
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.835406 edx-enterprise-4.0.0/enterprise/static/enterprise/bundles/
+-rw-r--r--   0 runner    (1001) docker     (123)      328 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/bundles/main-admin.style.css
+-rw-r--r--   0 runner    (1001) docker     (123)   295145 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/bundles/main.style.css
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.839406 edx-enterprise-4.0.0/enterprise/static/enterprise/js/
+-rw-r--r--   0 runner    (1001) docker     (123)     1404 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/js/course_modal.js
+-rw-r--r--   0 runner    (1001) docker     (123)      890 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/js/enterprise_customer.js
+-rw-r--r--   0 runner    (1001) docker     (123)     1262 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/js/enterprise_login_page.js
+-rw-r--r--   0 runner    (1001) docker     (123)     1293 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/js/enterprise_selection_page.js
+-rw-r--r--   0 runner    (1001) docker     (123)     2839 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/js/grant_data_sharing_permissions.js
+-rw-r--r--   0 runner    (1001) docker     (123)     5143 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/js/manage_learners.js
+-rw-r--r--   0 runner    (1001) docker     (123)     2368 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/static/enterprise/js/program_enrollment_landing_page.js
+-rw-r--r--   0 runner    (1001) docker     (123)     5380 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/tasks.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.811406 edx-enterprise-4.0.0/enterprise/templates/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.839406 edx-enterprise-4.0.0/enterprise/templates/enterprise/
+-rw-r--r--   0 runner    (1001) docker     (123)     1110 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_decline_modal.html
+-rw-r--r--   0 runner    (1001) docker     (123)      312 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_policy.html
+-rw-r--r--   0 runner    (1001) docker     (123)     1315 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_policy_paragraph.html
+-rw-r--r--   0 runner    (1001) docker     (123)      560 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_top_paragraph.html
+-rw-r--r--   0 runner    (1001) docker     (123)     1594 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_user_input.html
+-rw-r--r--   0 runner    (1001) docker     (123)      569 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/_enterprise_customer_sidebar.html
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.839406 edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     1851 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/clear_learners_data_sharing_consent.html
+-rw-r--r--   0 runner    (1001) docker     (123)      239 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/enterprise_course_enrollments_list.html
+-rw-r--r--   0 runner    (1001) docker     (123)     7410 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/manage_learners.html
+-rw-r--r--   0 runner    (1001) docker     (123)    12790 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/oauth_authorization_failed.html
+-rw-r--r--   0 runner    (1001) docker     (123)    27091 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/oauth_authorization_successful.html
+-rw-r--r--   0 runner    (1001) docker     (123)     1839 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/transmit_courses_metadata.html
+-rw-r--r--   0 runner    (1001) docker     (123)     1988 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/base.html
+-rw-r--r--   0 runner    (1001) docker     (123)     4310 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_course_enrollment_page.html
+-rw-r--r--   0 runner    (1001) docker     (123)     1611 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_customer_login_page.html
+-rw-r--r--   0 runner    (1001) docker     (123)     1784 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_customer_select_form.html
+-rw-r--r--   0 runner    (1001) docker     (123)      444 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_error_page_with_messages.html
+-rw-r--r--   0 runner    (1001) docker     (123)    10274 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_program_enrollment_page.html
+-rw-r--r--   0 runner    (1001) docker     (123)     1233 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/grant_data_sharing_permissions.html
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.839406 edx-enterprise-4.0.0/enterprise/templates/enterprise/templatetags/
+-rw-r--r--   0 runner    (1001) docker     (123)      227 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/templatetags/alert_messages.html
+-rw-r--r--   0 runner    (1001) docker     (123)     5532 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/templatetags/course_modal.html
+-rw-r--r--   0 runner    (1001) docker     (123)      313 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/templatetags/expand_button.html
+-rw-r--r--   0 runner    (1001) docker     (123)       77 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/templatetags/fa_icon.html
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.839406 edx-enterprise-4.0.0/enterprise/templates/enterprise/widgets/
+-rw-r--r--   0 runner    (1001) docker     (123)     1594 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templates/enterprise/widgets/segment-io-django.html
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.839406 edx-enterprise-4.0.0/enterprise/templatetags/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templatetags/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3635 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/templatetags/enterprise.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8698 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/tpa_pipeline.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2875 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)    84670 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2614 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/validators.py
+-rw-r--r--   0 runner    (1001) docker     (123)   112485 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/views.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1617 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise/views_error_codes.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.839406 edx-enterprise-4.0.0/enterprise_learner_portal/
+-rw-r--r--   0 runner    (1001) docker     (123)       67 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.839406 edx-enterprise-4.0.0/enterprise_learner_portal/api/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/api/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      231 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/api/urls.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/enterprise_learner_portal/api/v1/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/api/v1/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4779 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/api/v1/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      362 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/api/v1/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6076 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/api/v1/views.py
+-rw-r--r--   0 runner    (1001) docker     (123)      222 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/apps.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/enterprise_learner_portal/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      187 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1571 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/enterprise_learner_portal/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/
+-rw-r--r--   0 runner    (1001) docker     (123)       49 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1453 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      209 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/urls.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/blackboard/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/blackboard/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      990 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/blackboard/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      477 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/blackboard/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1157 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/blackboard/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/canvas/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/canvas/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      700 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/canvas/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      321 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/canvas/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)      712 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/canvas/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/cornerstone/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/cornerstone/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      613 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/cornerstone/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      335 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/cornerstone/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)      697 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/cornerstone/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      733 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      319 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)      689 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed2/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed2/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      622 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed2/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      323 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed2/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)      709 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/degreed2/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/logs/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/logs/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6811 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/logs/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      716 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/logs/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8332 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/logs/views.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2196 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/mixins.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/moodle/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/moodle/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      647 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/moodle/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      311 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/moodle/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)      682 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/moodle/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.843406 edx-enterprise-4.0.0/integrated_channels/api/v1/sap_success_factors/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/sap_success_factors/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      843 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/sap_success_factors/serializers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      359 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/sap_success_factors/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)      763 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/sap_success_factors/views.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1038 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6417 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/api/v1/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.847406 edx-enterprise-4.0.0/integrated_channels/blackboard/
+-rw-r--r--   0 runner    (1001) docker     (123)      178 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.847406 edx-enterprise-4.0.0/integrated_channels/blackboard/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     4519 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      556 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40081 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/client.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.847406 edx-enterprise-4.0.0/integrated_channels/blackboard/exporters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/exporters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3845 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/exporters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6096 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/exporters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.847406 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)    18816 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0001_initial_squashed_0014_alter_blackboardlearnerassessmentdatatransmissionaudit_enterprise_course_enrollment_id.py
+-rw-r--r--   0 runner    (1001) docker     (123)      853 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0002_auto_20220302_2231.py
+-rw-r--r--   0 runner    (1001) docker     (123)      614 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0003_alter_blackboardlearnerdatatransmissionaudit_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2549 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0004_auto_20220324_1550.py
+-rw-r--r--   0 runner    (1001) docker     (123)      670 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0005_auto_20220325_1757.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4115 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0006_auto_20220405_2311.py
+-rw-r--r--   0 runner    (1001) docker     (123)      787 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0007_auto_20220523_1625.py
+-rw-r--r--   0 runner    (1001) docker     (123)      839 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0008_auto_20220913_2018.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1095 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0009_auto_20220929_1720.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1555 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0010_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)      651 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0011_auto_20221031_1855.py
+-rw-r--r--   0 runner    (1001) docker     (123)      652 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0012_move_and_recrete_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1542 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0013_alter_blackboardlearnerdatatransmissionaudit_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4016 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0014_auto_20230105_2122.py
+-rw-r--r--   0 runner    (1001) docker     (123)      828 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0015_auto_20230112_2002.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12915 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.847406 edx-enterprise-4.0.0/integrated_channels/blackboard/transmitters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/transmitters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1004 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/transmitters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2307 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/transmitters/learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)      291 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8769 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/blackboard/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.847406 edx-enterprise-4.0.0/integrated_channels/canvas/
+-rw-r--r--   0 runner    (1001) docker     (123)      166 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.847406 edx-enterprise-4.0.0/integrated_channels/canvas/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     4078 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      387 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)    38929 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/client.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.847406 edx-enterprise-4.0.0/integrated_channels/canvas/exporters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/exporters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4895 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/exporters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6151 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/exporters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.851406 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     6806 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0001_initial.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1020 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0002_auto_20200806_1632.py
+-rw-r--r--   0 runner    (1001) docker     (123)      314 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0003_delete_canvasglobalconfiguration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1435 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0004_adding_learner_data_to_canvas.py
+-rw-r--r--   0 runner    (1001) docker     (123)      816 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0005_auto_20200909_1534.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1729 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0006_canvaslearnerassessmentdatatransmissionaudit.py
+-rw-r--r--   0 runner    (1001) docker     (123)      969 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0007_auto_20210222_2225.py
+-rw-r--r--   0 runner    (1001) docker     (123)      849 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0008_auto_20210707_0815.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1159 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0009_auto_20210708_1639.py
+-rw-r--r--   0 runner    (1001) docker     (123)      823 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0010_auto_20210909_1536.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1045 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0011_auto_20210923_1727.py
+-rw-r--r--   0 runner    (1001) docker     (123)      657 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0012_alter_canvasenterprisecustomerconfiguration_enterprise_customer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1548 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0013_auto_20211221_1535.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4671 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0014_auto_20220126_1837.py
+-rw-r--r--   0 runner    (1001) docker     (123)      967 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0015_auto_20220127_1605.py
+-rw-r--r--   0 runner    (1001) docker     (123)      745 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0016_auto_20220131_1539.py
+-rw-r--r--   0 runner    (1001) docker     (123)      751 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0017_auto_20220302_2231.py
+-rw-r--r--   0 runner    (1001) docker     (123)      602 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0018_alter_canvaslearnerdatatransmissionaudit_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2690 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0019_auto_20220324_1550.py
+-rw-r--r--   0 runner    (1001) docker     (123)      658 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0020_auto_20220325_1757.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4043 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0021_auto_20220405_2311.py
+-rw-r--r--   0 runner    (1001) docker     (123)      775 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0022_auto_20220523_1625.py
+-rw-r--r--   0 runner    (1001) docker     (123)      827 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0023_auto_20220913_2018.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1083 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0024_auto_20220929_1720.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1527 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0025_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)      639 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0026_auto_20221031_1855.py
+-rw-r--r--   0 runner    (1001) docker     (123)      636 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0027_move_and_recrete_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1487 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0028_alter_canvaslearnerdatatransmissionaudit_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3960 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0029_auto_20230105_2122.py
+-rw-r--r--   0 runner    (1001) docker     (123)      816 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0030_auto_20230112_2002.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10942 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.851406 edx-enterprise-4.0.0/integrated_channels/canvas/transmitters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/transmitters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      964 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/transmitters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2196 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/transmitters/learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)      271 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8396 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5288 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/canvas/views.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1109 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/catalog_service_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.851406 edx-enterprise-4.0.0/integrated_channels/cornerstone/
+-rw-r--r--   0 runner    (1001) docker     (123)      181 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.851406 edx-enterprise-4.0.0/integrated_channels/cornerstone/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     4321 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      363 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4754 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/client.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.851406 edx-enterprise-4.0.0/integrated_channels/cornerstone/exporters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/exporters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8266 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/exporters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3632 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/exporters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.855406 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     6846 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0001_initial.py
+-rw-r--r--   0 runner    (1001) docker     (123)      510 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0002_cornerstoneglobalconfiguration_subject_mapping.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1342 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0003_auto_20190621_1000.py
+-rw-r--r--   0 runner    (1001) docker     (123)      507 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0004_cornerstoneglobalconfiguration_languages.py
+-rw-r--r--   0 runner    (1001) docker     (123)      918 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0005_auto_20190925_0730.py
+-rw-r--r--   0 runner    (1001) docker     (123)      800 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0006_auto_20191001_0742.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1174 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0007_auto_20210708_1446.py
+-rw-r--r--   0 runner    (1001) docker     (123)      838 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0008_auto_20210909_1536.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1060 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0009_auto_20210923_1727.py
+-rw-r--r--   0 runner    (1001) docker     (123)      690 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0010_cornerstonecoursekey.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1539 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0011_auto_20211103_1855.py
+-rw-r--r--   0 runner    (1001) docker     (123)      667 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0012_alter_cornerstoneenterprisecustomerconfiguration_enterprise_customer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2494 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0013_auto_20220126_1837.py
+-rw-r--r--   0 runner    (1001) docker     (123)      760 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0014_auto_20220131_1539.py
+-rw-r--r--   0 runner    (1001) docker     (123)      766 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0015_auto_20220302_2231.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1671 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0016_auto_20220324_1550.py
+-rw-r--r--   0 runner    (1001) docker     (123)      437 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0017_alter_cornerstonelearnerdatatransmissionaudit_course_completed.py
+-rw-r--r--   0 runner    (1001) docker     (123)      717 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0018_auto_20220325_1757.py
+-rw-r--r--   0 runner    (1001) docker     (123)      689 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0019_auto_20220405_2311.py
+-rw-r--r--   0 runner    (1001) docker     (123)      790 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0020_auto_20220523_1625.py
+-rw-r--r--   0 runner    (1001) docker     (123)      535 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0021_cornerstonelearnerdatatransmissionaudit_friendly_status_message.py
+-rw-r--r--   0 runner    (1001) docker     (123)      773 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0022_cornerstonelearnerdatatransmissionaudit_api_record.py
+-rw-r--r--   0 runner    (1001) docker     (123)      917 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0023_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)      654 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0024_auto_20221031_1855.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1514 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0025_alter_cornerstonelearnerdatatransmissionaudit_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4030 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0026_auto_20230105_2122.py
+-rw-r--r--   0 runner    (1001) docker     (123)      831 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0027_auto_20230112_2002.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10239 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.855406 edx-enterprise-4.0.0/integrated_channels/cornerstone/transmitters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/transmitters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1992 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/transmitters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1190 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/transmitters/learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)      285 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/urls.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3021 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6441 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/cornerstone/views.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.855406 edx-enterprise-4.0.0/integrated_channels/degreed/
+-rw-r--r--   0 runner    (1001) docker     (123)      169 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.855406 edx-enterprise-4.0.0/integrated_channels/degreed/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     4023 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      343 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10205 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/client.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.855406 edx-enterprise-4.0.0/integrated_channels/degreed/exporters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/exporters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2952 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/exporters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3935 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/exporters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.859406 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     7339 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0001_initial.py
+-rw-r--r--   0 runner    (1001) docker     (123)      934 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0002_auto_20180104_0103.py
+-rw-r--r--   0 runner    (1001) docker     (123)      626 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0003_auto_20180109_0712.py
+-rw-r--r--   0 runner    (1001) docker     (123)      802 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0004_auto_20180306_1251.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3523 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0005_auto_20180807_1302.py
+-rw-r--r--   0 runner    (1001) docker     (123)      751 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0006_upgrade_django_simple_history.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1113 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0007_auto_20190925_0730.py
+-rw-r--r--   0 runner    (1001) docker     (123)      788 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0008_auto_20191001_0742.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5444 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0009_auto_20210119_1546.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1162 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0010_auto_20210708_1446.py
+-rw-r--r--   0 runner    (1001) docker     (123)      826 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0011_auto_20210909_1536.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1048 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0012_auto_20210923_1727.py
+-rw-r--r--   0 runner    (1001) docker     (123)      659 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0013_alter_degreedenterprisecustomerconfiguration_enterprise_customer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6984 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0014_auto_20220126_1837.py
+-rw-r--r--   0 runner    (1001) docker     (123)      748 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0015_auto_20220131_1539.py
+-rw-r--r--   0 runner    (1001) docker     (123)      754 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0016_auto_20220302_2231.py
+-rw-r--r--   0 runner    (1001) docker     (123)      562 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0017_alter_degreedlearnerdatatransmissionaudit_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2891 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0018_auto_20220324_1550.py
+-rw-r--r--   0 runner    (1001) docker     (123)      661 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0019_auto_20220325_1757.py
+-rw-r--r--   0 runner    (1001) docker     (123)      677 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0020_auto_20220405_2311.py
+-rw-r--r--   0 runner    (1001) docker     (123)      778 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0021_auto_20220523_1625.py
+-rw-r--r--   0 runner    (1001) docker     (123)      527 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0022_degreedlearnerdatatransmissionaudit_friendly_status_message.py
+-rw-r--r--   0 runner    (1001) docker     (123)      761 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0023_degreedlearnerdatatransmissionaudit_api_record.py
+-rw-r--r--   0 runner    (1001) docker     (123)      897 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0024_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)      642 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0025_auto_20221031_1855.py
+-rw-r--r--   0 runner    (1001) docker     (123)      640 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0026_move_and_recrete_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1496 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0027_alter_degreedlearnerdatatransmissionaudit_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3974 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0028_auto_20230105_2122.py
+-rw-r--r--   0 runner    (1001) docker     (123)      819 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0029_auto_20230112_2002.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9755 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.859406 edx-enterprise-4.0.0/integrated_channels/degreed/transmitters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/transmitters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      987 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/transmitters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1151 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed/transmitters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.859406 edx-enterprise-4.0.0/integrated_channels/degreed2/
+-rw-r--r--   0 runner    (1001) docker     (123)      196 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.859406 edx-enterprise-4.0.0/integrated_channels/degreed2/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     3543 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      506 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19696 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/client.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.859406 edx-enterprise-4.0.0/integrated_channels/degreed2/exporters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/exporters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5466 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/exporters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4013 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/exporters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.863406 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     8137 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0001_initial.py
+-rw-r--r--   0 runner    (1001) docker     (123)      933 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0002_auto_20211101_2021.py
+-rw-r--r--   0 runner    (1001) docker     (123)      661 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0003_alter_degreed2enterprisecustomerconfiguration_enterprise_customer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5500 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0004_auto_20220126_1837.py
+-rw-r--r--   0 runner    (1001) docker     (123)      751 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0005_auto_20220131_1539.py
+-rw-r--r--   0 runner    (1001) docker     (123)      855 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0006_auto_20220214_1627.py
+-rw-r--r--   0 runner    (1001) docker     (123)      757 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0007_auto_20220302_2231.py
+-rw-r--r--   0 runner    (1001) docker     (123)      505 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0008_degreed2learnerdatatransmissionaudit_course_completed.py
+-rw-r--r--   0 runner    (1001) docker     (123)      567 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0009_alter_degreed2learnerdatatransmissionaudit_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2905 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0010_auto_20220324_1550.py
+-rw-r--r--   0 runner    (1001) docker     (123)      664 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0011_auto_20220325_1757.py
+-rw-r--r--   0 runner    (1001) docker     (123)      680 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0012_auto_20220405_2311.py
+-rw-r--r--   0 runner    (1001) docker     (123)      781 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0013_auto_20220523_1625.py
+-rw-r--r--   0 runner    (1001) docker     (123)      529 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0014_degreed2learnerdatatransmissionaudit_friendly_status_message.py
+-rw-r--r--   0 runner    (1001) docker     (123)      764 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0015_degreed2learnerdatatransmissionaudit_api_record.py
+-rw-r--r--   0 runner    (1001) docker     (123)      902 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0016_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)      645 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0017_auto_20221031_1855.py
+-rw-r--r--   0 runner    (1001) docker     (123)      643 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0018_move_and_recrete_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1505 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0019_alter_degreed2learnerdatatransmissionaudit_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3988 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0020_auto_20230105_2122.py
+-rw-r--r--   0 runner    (1001) docker     (123)      822 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0021_auto_20230112_2002.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7365 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.863406 edx-enterprise-4.0.0/integrated_channels/degreed2/transmitters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/transmitters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1038 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/transmitters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1183 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/degreed2/transmitters/learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)      387 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/exceptions.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.863406 edx-enterprise-4.0.0/integrated_channels/integrated_channel/
+-rw-r--r--   0 runner    (1001) docker     (123)      247 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.863406 edx-enterprise-4.0.0/integrated_channels/integrated_channel/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     2322 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      348 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)      775 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/channel_settings.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3656 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/client.py
+-rw-r--r--   0 runner    (1001) docker     (123)      138 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/constants.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.863406 edx-enterprise-4.0.0/integrated_channels/integrated_channel/exporters/
+-rw-r--r--   0 runner    (1001) docker     (123)     1188 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/exporters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32507 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/exporters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)    39607 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/exporters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.863406 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/
+-rw-r--r--   0 runner    (1001) docker     (123)       81 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.863406 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)     6532 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1495 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/backfill_course_end_dates.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3566 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/backfill_missing_csod_foreign_keys.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6981 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/backfill_missing_foreign_keys.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2375 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/backfill_remote_action_timestamps.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2408 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/cleanup_duplicate_assignment_records.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1077 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/mark_orphaned_content_metadata_audits.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2296 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/reset_csod_remote_deleted_at.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2583 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/reset_sapsf_learner_transmissions.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2004 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/transmit_content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2356 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/transmit_learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2397 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/transmit_subsection_learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1065 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/unlink_inactive_sap_learners.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1839 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/update_content_transmission_catalogs.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.867406 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     2359 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0001_squashed_0007_auto_20190925_0730.py
+-rw-r--r--   0 runner    (1001) docker     (123)      463 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0002_learnerdatatransmissionaudit_subsection_id.py
+-rw-r--r--   0 runner    (1001) docker     (123)      576 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0003_contentmetadataitemtransmission_content_last_changed.py
+-rw-r--r--   0 runner    (1001) docker     (123)      566 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0004_contentmetadataitemtransmission_enterprise_customer_catalog_uuid.py
+-rw-r--r--   0 runner    (1001) docker     (123)      493 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0005_auto_20211005_1052.py
+-rw-r--r--   0 runner    (1001) docker     (123)      497 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0006_contentmetadataitemtransmission_deleted_at.py
+-rw-r--r--   0 runner    (1001) docker     (123)      353 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0007_delete_learnerdatatransmissionaudit.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1772 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0008_genericlearnerdatatransmissionaudit.py
+-rw-r--r--   0 runner    (1001) docker     (123)      689 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0009_auto_20220325_1757.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2613 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0010_genericenterprisecustomerpluginconfiguration.py
+-rw-r--r--   0 runner    (1001) docker     (123)      483 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0011_contentmetadataitemtransmission_plugin_configuration_id.py
+-rw-r--r--   0 runner    (1001) docker     (123)      412 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0012_alter_contentmetadataitemtransmission_unique_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)      723 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0013_auto_20220405_2311.py
+-rw-r--r--   0 runner    (1001) docker     (123)      518 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0014_genericenterprisecustomerpluginconfiguration_dry_run_mode_enabled.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1845 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0015_auto_20220718_2113.py
+-rw-r--r--   0 runner    (1001) docker     (123)      466 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0016_contentmetadataitemtransmission_content_title.py
+-rw-r--r--   0 runner    (1001) docker     (123)      517 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0016_contentmetadataitemtransmission_marked_for.py
+-rw-r--r--   0 runner    (1001) docker     (123)      561 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0017_contentmetadataitemtransmission_friendly_status_message.py
+-rw-r--r--   0 runner    (1001) docker     (123)      575 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0018_genericlearnerdatatransmissionaudit_friendly_status_message.py
+-rw-r--r--   0 runner    (1001) docker     (123)      361 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0019_merge_20220928_1842.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2146 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0020_auto_20220929_1712.py
+-rw-r--r--   0 runner    (1001) docker     (123)      376 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0021_remove_contentmetadataitemtransmission_api_response_body.py
+-rw-r--r--   0 runner    (1001) docker     (123)      550 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0022_alter_contentmetadataitemtransmission_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)      914 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0023_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)      450 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0024_genericenterprisecustomerpluginconfiguration_deleted_at.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2139 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0025_auto_20230105_2122.py
+-rw-r--r--   0 runner    (1001) docker     (123)      532 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0026_genericenterprisecustomerpluginconfiguration_last_modified_at.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1522 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0027_orphanedcontenttransmissions.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1689 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0028_alter_contentmetadataitemtransmission_unique_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32216 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19415 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/tasks.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.867406 edx-enterprise-4.0.0/integrated_channels/integrated_channel/transmitters/
+-rw-r--r--   0 runner    (1001) docker     (123)     1213 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/transmitters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10831 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/transmitters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23829 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/integrated_channel/transmitters/learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4940 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/lms_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.867406 edx-enterprise-4.0.0/integrated_channels/moodle/
+-rw-r--r--   0 runner    (1001) docker     (123)      166 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.867406 edx-enterprise-4.0.0/integrated_channels/moodle/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     3702 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      338 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17097 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/client.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.867406 edx-enterprise-4.0.0/integrated_channels/moodle/exporters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/exporters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4731 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/exporters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3789 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/exporters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.871406 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     6261 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0001_initial.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1487 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0002_moodlelearnerdatatransmissionaudit.py
+-rw-r--r--   0 runner    (1001) docker     (123)      865 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0003_auto_20201006_1706.py
+-rw-r--r--   0 runner    (1001) docker     (123)      849 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0004_auto_20201105_1921.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1159 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0005_auto_20210708_1446.py
+-rw-r--r--   0 runner    (1001) docker     (123)      823 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0006_auto_20210909_1536.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1045 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0007_auto_20210923_1727.py
+-rw-r--r--   0 runner    (1001) docker     (123)      657 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0008_alter_moodleenterprisecustomerconfiguration_enterprise_customer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5766 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0009_auto_20220126_1837.py
+-rw-r--r--   0 runner    (1001) docker     (123)      745 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0010_auto_20220131_1539.py
+-rw-r--r--   0 runner    (1001) docker     (123)      751 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0011_auto_20220302_2231.py
+-rw-r--r--   0 runner    (1001) docker     (123)      602 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0012_alter_moodlelearnerdatatransmissionaudit_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2501 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0013_auto_20220324_1550.py
+-rw-r--r--   0 runner    (1001) docker     (123)      658 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0014_auto_20220325_1757.py
+-rw-r--r--   0 runner    (1001) docker     (123)      674 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0015_auto_20220405_2311.py
+-rw-r--r--   0 runner    (1001) docker     (123)      775 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0016_auto_20220523_1625.py
+-rw-r--r--   0 runner    (1001) docker     (123)      525 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0017_moodlelearnerdatatransmissionaudit_friendly_status_message.py
+-rw-r--r--   0 runner    (1001) docker     (123)      758 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0018_moodlelearnerdatatransmissionaudit_api_record.py
+-rw-r--r--   0 runner    (1001) docker     (123)      892 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0019_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)      639 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0020_auto_20221031_1855.py
+-rw-r--r--   0 runner    (1001) docker     (123)      636 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0021_move_and_recrete_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1555 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0022_auto_20221220_1527.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1469 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0023_alter_moodlelearnerdatatransmissionaudit_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3960 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0024_auto_20230105_2122.py
+-rw-r--r--   0 runner    (1001) docker     (123)      816 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0025_auto_20230112_2002.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7559 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.871406 edx-enterprise-4.0.0/integrated_channels/moodle/transmitters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/transmitters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1434 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/transmitters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1143 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/moodle/transmitters/learner_data.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.871406 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/
+-rw-r--r--   0 runner    (1001) docker     (123)      178 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.871406 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     5887 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      398 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17361 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/client.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1822 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/constants.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.871406 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/exporters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/exporters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10887 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/exporters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9815 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/exporters/learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)      779 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/exporters/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.875406 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     7500 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0001_squashed_0022_auto_20200206_1046_squashed_0011_alter_sapsuccessfactorslearnerdatatransmissionaudit_enterprise_course_enrollment_id.py
+-rw-r--r--   0 runner    (1001) docker     (123)      623 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0002_alter_sapsuccessfactorsenterprisecustomerconfiguration_display_name.py
+-rw-r--r--   0 runner    (1001) docker     (123)      514 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0003_alter_sapsuccessfactorslearnerdatatransmissionaudit_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2623 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0004_auto_20220324_1550_squashed_0006_auto_20220330_1157.py
+-rw-r--r--   0 runner    (1001) docker     (123)      556 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0005_sapsuccessfactorsenterprisecustomerconfiguration_dry_run_mode_enabled.py
+-rw-r--r--   0 runner    (1001) docker     (123)      600 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0006_sapsuccessfactorslearnerdatatransmissionaudit_friendly_status_message.py
+-rw-r--r--   0 runner    (1001) docker     (123)      793 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0007_sapsuccessfactorslearnerdatatransmissionaudit_api_record.py
+-rw-r--r--   0 runner    (1001) docker     (123)      949 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0008_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)      455 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0009_sapsuccessfactorsenterprisecustomerconfiguration_deleted_at.py
+-rw-r--r--   0 runner    (1001) docker     (123)      709 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0010_move_and_recrete_completed_timestamp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1566 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0011_alter_sapsuccessfactorslearnerdatatransmissionaudit_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2175 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0012_auto_20230105_2122.py
+-rw-r--r--   0 runner    (1001) docker     (123)      537 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0013_sapsuccessfactorsenterprisecustomerconfiguration_last_modified_at.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11568 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.875406 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/transmitters/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/transmitters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      899 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/transmitters/content_metadata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2624 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/sap_success_factors/transmitters/learner_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17708 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.875406 edx-enterprise-4.0.0/integrated_channels/xapi/
+-rw-r--r--   0 runner    (1001) docker     (123)      136 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.875406 edx-enterprise-4.0.0/integrated_channels/xapi/admin/
+-rw-r--r--   0 runner    (1001) docker     (123)     2534 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/admin/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      279 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/apps.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1499 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/client.py
+-rw-r--r--   0 runner    (1001) docker     (123)      358 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/constants.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.875406 edx-enterprise-4.0.0/integrated_channels/xapi/management/
+-rw-r--r--   0 runner    (1001) docker     (123)       67 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/management/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.875406 edx-enterprise-4.0.0/integrated_channels/xapi/management/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)       67 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/management/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13631 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/management/commands/send_course_completions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12122 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/management/commands/send_course_enrollments.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.875406 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/
+-rw-r--r--   0 runner    (1001) docker     (123)     1494 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0001_initial.py
+-rw-r--r--   0 runner    (1001) docker     (123)      837 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0002_auto_20180726_0142.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1845 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0003_auto_20190807_1006.py
+-rw-r--r--   0 runner    (1001) docker     (123)      427 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0004_auto_20190830_0710.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1801 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0005_auto_20220324_1550.py
+-rw-r--r--   0 runner    (1001) docker     (123)      652 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0006_auto_20220325_1757.py
+-rw-r--r--   0 runner    (1001) docker     (123)      668 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0007_auto_20220405_2311.py
+-rw-r--r--   0 runner    (1001) docker     (123)      521 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0008_xapilearnerdatatransmissionaudit_friendly_status_message.py
+-rw-r--r--   0 runner    (1001) docker     (123)      752 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0009_xapilearnerdatatransmissionaudit_api_record.py
+-rw-r--r--   0 runner    (1001) docker     (123)      882 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0010_auto_20221021_0159.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1451 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0011_alter_xapilearnerdatatransmissionaudit_index_together.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3061 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.875406 edx-enterprise-4.0.0/integrated_channels/xapi/statements/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/statements/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2781 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/statements/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2210 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/statements/learner_course_completion.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1441 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/statements/learner_course_enrollment.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5028 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/integrated_channels/xapi/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-13 16:31:54.879406 edx-enterprise-4.0.0/requirements/
+-rw-r--r--   0 runner    (1001) docker     (123)      838 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/base.in
+-rw-r--r--   0 runner    (1001) docker     (123)      147 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/celery50.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      205 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/ci.in
+-rw-r--r--   0 runner    (1001) docker     (123)      627 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/ci.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1574 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/common_constraints.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1077 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/constraints.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      910 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/dev.in
+-rw-r--r--   0 runner    (1001) docker     (123)    20535 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/dev.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       15 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/django.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      336 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/doc.in
+-rw-r--r--   0 runner    (1001) docker     (123)    10297 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/doc.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    27934 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/edx-platform-constraints.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      145 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/js_test.in
+-rw-r--r--   0 runner    (1001) docker     (123)     2098 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/js_test.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      125 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/test-master.in
+-rw-r--r--   0 runner    (1001) docker     (123)    10721 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/test-master.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      642 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/test.in
+-rw-r--r--   0 runner    (1001) docker     (123)     9810 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/requirements/test.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      157 2023-07-13 16:31:54.879406 edx-enterprise-4.0.0/setup.cfg
+-rwxr-xr-x   0 runner    (1001) docker     (123)     4028 2023-07-13 16:30:39.000000 edx-enterprise-4.0.0/setup.py
```

### filetype from file(1)

```diff
@@ -1 +1 @@
-POSIX tar archive (GNU)
+POSIX tar archive
```

### Comparing `edx-enterprise-3.9.9/PKG-INFO` & `edx-enterprise-4.0.0/PKG-INFO`

 * *Files 23% similar despite different names*

```diff
@@ -1,40 +1,36 @@
 Metadata-Version: 1.1
 Name: edx-enterprise
-Version: 3.9.9
+Version: 4.0.0
 Summary: Your project description goes here
-Home-page: https://github.com/edx/edx-enterprise
+Home-page: https://github.com/openedx/edx-enterprise
 Author: edX
 Author-email: oscm@edx.org
 License: AGPL 3.0
 Description: enterprise
         ==========
         
         .. image:: https://img.shields.io/pypi/v/edx-enterprise.svg
             :target: https://pypi.python.org/pypi/edx-enterprise/
             :alt: PyPI
         
-        .. image:: https://travis-ci.org/edx/edx-enterprise.svg?branch=master
-            :target: https://travis-ci.org/edx/edx-enterprise
-            :alt: Travis
-        
         .. image:: http://codecov.io/github/edx/edx-enterprise/coverage.svg?branch=master
             :target: http://codecov.io/github/edx/edx-enterprise?branch=master
             :alt: Codecov
         
         .. image:: https://readthedocs.org/projects/open-edx-enterprise-service-documentation/badge/?version=latest
             :target: http://open-edx-enterprise-service-documentation.readthedocs.io/en/latest/
             :alt: Documentation
         
         .. image:: https://img.shields.io/pypi/pyversions/edx-enterprise.svg
             :target: https://pypi.python.org/pypi/edx-enterprise/
             :alt: Supported Python versions
         
         .. image:: https://img.shields.io/github/license/edx/edx-enterprise.svg
-            :target: https://github.com/edx/edx-enterprise/blob/master/LICENSE.txt
+            :target: https://github.com/openedx/edx-enterprise/blob/master/LICENSE.txt
             :alt: License
         
         The ``Open edx Enterprise Service`` app provides enterprise features to the Open
         edX platform.  The majority of these features are structured around the concept
         of an ``Enterprise Customer``, which is an organization or a group of people
         that "consumes" courses published on the Open edX platform.
         
@@ -52,24 +48,21 @@
         Please see ``LICENSE.txt`` for details.
         
         How To Contribute
         -----------------
         
         Contributions are very welcome.
         
-        Please read `How To Contribute <https://github.com/edx/edx-platform/blob/master/CONTRIBUTING.rst>`_ for details.
-        
-        Even though they were written with ``edx-platform`` in mind, the guidelines
-        should be followed for Open edX code in general.
+        Please read `How To Contribute <https://github.com/openedx/.github/blob/master/CONTRIBUTING.md>`_ for details.
         
         A Pull Request Description Template can be found at`PULL_REQUEST_TEMPLATE.md`_ - this
         template is automatically applied when you open a pull request from GitHub.  Please
         make sure to include this template if submitting a pull request via other channels.
         
-        .. _PULL_REQUEST_TEMPLATE.md: https://github.com/edx/edx-enterprise/blob/master/.github/PULL_REQUEST_TEMPLATE_TEMPLATE.md
+        .. _PULL_REQUEST_TEMPLATE.md: https://github.com/openedx/edx-enterprise/blob/master/.github/PULL_REQUEST_TEMPLATE_TEMPLATE.md
         
         After submitting a pull request, please use the Github "Reviewers" widget to add
         relevant reviewers and track review process.
         
         Reporting Security Issues
         -------------------------
         
@@ -77,15 +70,15 @@
         
         Getting Help
         ------------
         
         Have a question about this repository, or about Open edX in general?  Please
         refer to this `list of resources`_ if you need any assistance.
         
-        .. _list of resources: https://open.edx.org/getting-help
+        .. _list of resources: https://openedx.org/getting-help
         
         
         Change Log
         ==========
         
         ..
            All enhancements and patches to edx-enterprise will be documented
@@ -96,15 +89,2154 @@
            the package is published.
         
            This project adheres to Semantic Versioning (http://semver.org/).
         
         .. There should always be an "Unreleased" section for changes pending release.
         
         Unreleased
-        -----------
+        ----------
+        [3.69.1]
+        --------
+        fix: content metadata exporter sanitizing content to delete
+        
+        [3.69.0]
+        --------
+        refactor: Replaced the deprecated `NullBooleanField` with `BooleanField(null=True)`
+        
+        [3.68.1]
+        --------
+        fix: pick first object from CourseDetails
+        
+        [3.68.0]
+        --------
+        feat: add more metadata into `EnterpriseCourseEnrollmentView`
+        
+        [3.67.7]
+        --------
+        feat: marking orphaned content audits when catalogs are deleted
+        
+        [3.67.6]
+        --------
+        chore: fixing doc string linter errors
+        
+        [3.67.5]
+        --------
+        chore: better formatting of the enterprise api views
+        
+        [3.67.4]
+        --------
+        feat: add button to update customer modified time
+        
+        [3.67.3]
+        --------
+        feat: adding managent command to clear error state
+        
+        [3.67.2]
+        --------
+        fix: fixing name of table used by model fetching method
+        
+        [3.67.1]
+        --------
+        chore: more orphaned content transmission logging
+        
+        [4.0.0]
+        -------
+        feat!: upgraded to Node v18, added .nvmrc and updated workflows.
+        
+        [3.67.0]
+        --------
+        fix: compare lowered input email address to lowered auth user record email address during bulk enrollment.
+        
+        [3.66.8]
+        --------
+        fix: optional x-request-id logging
+        
+        [3.66.7]
+        --------
+        feat: optional x-request-id logging
+        
+        [3.66.6]
+        --------
+        * feat: increase the throttle limit of service users for EnterpriseCustomerViewSet
+        * Switch from ``edx-sphinx-theme`` to ``sphinx-book-theme`` since the former is
+          deprecated
+        
+        [3.66.5]
+        --------
+        chore: set default expiration_date for EnterpriseCustomerInviteKey
+        
+        [3.66.4]
+        --------
+        feat: add more logging in the bulk enrollment flow
+        
+        [3.66.3]
+        --------
+        fix: prevent org_id param addition to exec-ed course home url when auth_org_id is not present
+        
+        [3.66.2]
+        --------
+        chore: unique constraint on transmission audits to prevent duplicates
+        
+        [3.66.1]
+        --------
+        fix: Fixed url encoding issue with org_id in executive education course url
+        
+        [3.66.0]
+        --------
+        feat: Added org_id for executive education courses landing page
+        
+        [3.65.4]
+        --------
+        fix: swapping enterprise unenrolled bool to timestamp and minor code cleanup
+        
+        [3.65.2]
+        --------
+        feat: extending the enterprise fulfillment api serializer to contain more info
+        
+        [3.65.1]
+        --------
+        fix: making sure unenrollment is saved while revoking fulfillment
+        
+        [3.65.0]
+        --------
+        feat: new enterprise endpoint to surface filterable unenrolled subsidized enrollments
+        
+        [3.64.1]
+        --------
+        fix: Reverted course_run_url for Executive Education courses
+        
+        [3.64.0]
+        --------
+        feat: Updated course_run_url for Executive Education courses
+        
+        [3.63.0]
+        --------
+        feat: Hooking enterprise enrollments up to platform signals to write unenrollment records.
+              New field `unenrolled` on enterprise enrollments to track enrollment status, defaults to `None`.
+        
+        [3.62.7]
+        --------
+        feat: include obsolete attribute in degreed content transmissions
+        
+        [3.62.6]
+        --------
+        chore: adding better logging to the remove dup audit management command
+        
+        [3.62.5]
+        --------
+        feat: include auth_org_id in enterprise customer api
+        
+        [3.62.4]
+        --------
+        fix: duplicate records reading queryset length then splicing
+        
+        [3.62.3]
+        --------
+        feat: Add idempotent catalog creation endpoint
+        
+        [3.62.2]
+        --------
+        fix: management command fix- reading queryset length in a mysql supported way
+        
+        [3.62.1]
+        --------
+        feat: new management command to remove duplicate transmission audits
+        
+        [3.62.0]
+        --------
+        feat: Add 'auth_org_id' field to EnterpriseCustomer for Auth0 integration
+        
+        [3.61.16]
+        ---------
+        feat: Q filtering to enterprise customer basic list
+        
+        [3.61.15]
+        ---------
+        feat: Add customer catalog write only viewset
+        
+        [3.61.14]
+        ---------
+        fix: Integrated channels metadata exporter now considers failed update audits as existing records
+        
+        [3.61.13]
+        ---------
+        feat: expands pagination page size from enterprise catalog query view
+        
+        [3.61.12]
+        ---------
+        chore: remove codecov from requirements as it removed from PyPi and is breaking CI when trying to install the package. Pinned ``pip-tools`` and ``tox`` in ``common_constraints.txt`` due to dependency resolution issues with ``click`` and ``filelock``.
+        
+        [3.61.11]
+        ---------
+        feat: include owners and longer descriptions for degreed2 content metadata transmissions
+        
+        [3.61.10]
+        ---------
+        feat: new tagging orphaned content tast for integrated channels
+        
+        [3.61.9]
+        --------
+        feat: Serialize and create a viewset for enterpriseCatalogQuery as readonly
+        
+        [3.61.8]
+        --------
+        feat: added enterprise fulfillment viewset
+        
+        [3.61.7]
+        --------
+        feat: surfacing subsized enrollment uuid value in the bulk enrollment endpoint
+        
+        [3.61.6]
+        --------
+        feat: Add user_id support to enroll_learners_in_courses endpoint
+        
+        [3.61.5]
+        --------
+        fix: Ensure `EnterpriseCustomerBrandingConfigurationSerializer` returns correct logo URL on stage/production after `settings.DEFAULT_FILE_STORAGE` changed to use `storages.backends.s3boto3.S3Boto3Storage` instead of `storages.backends.s3boto.S3BotoStorage`.
+        
+        [3.61.4]
+        --------
+        fix: impoved admin screen for system wide enterprise role assignments
+        
+        [3.61.3]
+        --------
+        chore: cleanup squashed migration files
+        
+        [3.61.2]
+        --------
+        fix: migrating uuid and updating column constraints
+        
+        [3.61.1]
+        --------
+        fix: allowing for uuid column migration to be non-unique
+        
+        [3.61.0]
+        --------
+        feat: enterprise entitlements and subsidy based fulfillment models heirarchy rework
+        
+        [3.60.21]
+        ---------
+        feat: django admin bulk action to clear remote_deleted_at on ContentMetadataItemTransmission records
+        
+        [3.60.20]
+        ---------
+        fix: changing api client to parse grades api response body
+        
+        [3.60.19]
+        ---------
+        fix: applied validatoins on report delivery_method
+        
+        [3.60.18]
+        ---------
+        fix: checking for response attr in http exception handling
+        
+        [3.60.17]
+        ---------
+        fix: making backend generated fields read only on django admin
+        
+        [3.60.16]
+        ---------
+        fix: adding backoff and retry logic to the grades api client
+        
+        [3.60.15]
+        ---------
+        feat: allowing manage learners form enroll learners using exec ed modes
+        
+        [3.60.14]
+        ---------
+        feat: adding exec ed course mode to enterprise
+        
+        [3.60.13]
+        ---------
+        fix: handle file compression check and test
+        
+        [3.60.12]
+        ---------
+        feat: adding last modified timestamp to single LMS config endpoints
+        
+        [3.60.11]
+        ---------
+        fix: integrations log TypeErrors
+        
+        [3.60.10]
+        ---------
+        fix: making moodle client return value match other channels
+        
+        [3.60.9]
+        --------
+        fix: memoize synced_at datimes on config record
+        
+        [3.60.8]
+        --------
+        fix: failed content deletes and creates are never retried
+        
+        [3.60.7]
+        --------
+        fix: cleaning up serializer field inheritance
+        
+        [3.60.6]
+        --------
+        fix: password is required when pgp key is provided
+        
+        [3.60.5]
+        --------
+        fix: adding an index for performance, non-blocking syntax
+        
+        [3.60.4]
+        --------
+        fix: add back squashed migrations (fixes devstack provisioning)
+        
+        [3.60.3]
+        --------
+        feat: exec ed content is tagged and distinguishable from edx content
+        
+        [3.60.2]
+        --------
+        fix: sorting error reporting audits by all datetimes at once instead of three separate order bys
+        
+        [3.60.1]
+        --------
+        fix: adding an index for performance, testing syntax for no-lock
+        
+        [3.60.0]
+        --------
+        build: write an updated pylintrc and quiet a noisy logging statement
+        
+        [3.59.2]
+        --------
+        chore: allowing for page size specification in error reporting api
+        
+        [3.59.1]
+        --------
+        fix: cleaning up integrated channels inheritance column types
+        
+        [3.59.0]
+        --------
+        refactor: Removed unused code related to tableau.
+        
+        [3.58.18]
+        ---------
+        fix: internal service error fix for enterprise branding
+        
+        [3.58.17]
+        ---------
+        fix: fixed a bug that didn't allow admins to create an account or update password
+        
+        [3.58.16]
+        ---------
+        fix: fix bug that didn't allow admins to customize branding
+        
+        [3.58.15]
+        ---------
+        fix: catch update transmissions that failed and need to be resent
+        
+        [3.58.14]
+        ---------
+        feat: Add health check for canvas integrated channels
+        
+        [3.58.13]
+        ---------
+        feat: Add in learner and content sync time records to integrated channel configs
+        
+        [3.58.12]
+        ---------
+        fix: make integrated channels api response record field readonly in admin view
+        
+        [3.58.11]
+        ---------
+        fix: Added model field validation for pgp_encryption_key
+        
+        [3.58.10]
+        ---------
+        refactor: update enterprise manual reporting to make it generic
+        
+        [3.58.9]
+        --------
+        fix: Added validation for PGP encryption key entered by the user.
+        
+        [3.58.8]
+        --------
+        feat: integration sync reporting viewset improvements
+        
+        [3.58.7]
+        --------
+        feat: populate freindly_status_message in content and learner metadata api
+        
+        [3.58.6]
+        --------
+        chore: smarter canvas client update course behavior (course deleted)
+        
+        [3.58.5]
+        --------
+        feat: integrated channels customer configs soft delete support
+        
+        [3.58.4]
+        --------
+        chore: fixing api view that included unneeded values
+        
+        [3.58.3]
+        --------
+        feat: transmission audit admin view and api improvements
+        
+        [3.58.2]
+        --------
+        fix: integrated channels not picking up courses to update
+        
+        [3.58.1]
+        --------
+        feat: adding new variables to the learner transmission audit model
+        
+        [3.58.0]
+        --------
+        feat: Add a new endpoint to generate a signed token for plotly analytics.
+        
+        [3.57.3]
+        --------
+        feat: remove debug logging used to investigate missing CSOD deletes
+        
+        [3.57.2]
+        --------
+        feat: Added POST support for catalog query preview
+        
+        [3.57.1]
+        --------
+        fix: impoving transmission records by moving response body to new table
+        
+        [3.57.0]
+        ---------
+        * feat: adds an EnterpriseCatalogQuery.include_exec_ed_2u_courses field.
+          When True for an EnterpriseCatalogQuery record, this field indicates that
+          course content with type ``executive-education-2u`` should not be excluded from being associated with that record.
+          See related enterprise-catalog PR, which includes an ADR: https://github.com/openedx/enterprise-catalog/pull/507
+        
+        [3.56.16]
+        ---------
+        feat: integration sync status self service endpoints
+        
+        [3.56.15]
+        ---------
+        feat: tagging exported content records for transmission
+        
+        [3.56.14]
+        ---------
+        chore: add plugin_configuration_id to standard integration logging
+        
+        [3.56.13]
+        ---------
+        chore: smarter canvas client update course behavior
+        
+        [3.56.12]
+        ---------
+        chore: adding http status response code to content record django admin table
+        
+        [3.56.11]
+        ---------
+        chore: cleaning up Canvas client url construction
+        
+        [3.56.10]
+        ---------
+        fix: adhering to urljoin patterns in integrated channels API views
+        
+        [3.56.9]
+        --------
+        fix: properly truncate payload to resolve missing CSOD deletes
+        
+        [3.56.8]
+        --------
+        feat: add debug logging to investigate missing CSOD deletes
+        
+        [3.56.7]
+        --------
+        feat: add debug logging to investigate missing CSOD deletes
+        
+        [3.56.6]
+        --------
+        feat: expand utility of CSOD deleted_at reset job
+        
+        [3.56.5]
+        --------
+        fix: properly pass SAP client status back to content transmission records
+        
+        [3.56.4]
+        --------
+        fix: open redirect url whitelisting for data sharing conseent and change enterprise page
+        
+        [3.56.3]
+        --------
+        fix: replace id with uuid in branding logo file path
+        
+        [3.56.2]
+        --------
+        fix: refactor the way we send cornerstone content metadata deletes
+        
+        [3.56.1]
+        --------
+        fix: accounting for integrated Canvas instances that have no root account Ids.
+        
+        [3.56.0]
+        --------
+        feat: refactor content metadata jobs to save api call status
+        
+        [3.55.3]
+        --------
+        fix: accurately selecting content key values when filtering for existing content metadata transmission audits.
+        
+        [3.55.2]
+        --------
+        fix: integrated channels properly handling customers with multiple catalogs that have overlapping content.
+        
+        [3.55.1]
+        --------
+        fix: properly removing update transmission payloads from SAP transmissions before saving completed records.
+        
+        [3.55.0]
+        --------
+        feat: add `enable_executive_education_2U_fulfillment` to `EnterpriseCustomer`
+        
+        [3.54.2]
+        --------
+        fix: follow-on to cornerstone learner records foreign keys job
+        
+        [3.54.1]
+        --------
+        fix: create cornerstone learner audit records with new foreign keys
+        
+        [3.54.0]
+        --------
+        feat: Remove progress, progress_v2 option from reporting configs and move all v1, v2 to v3.
+        
+        [3.53.4]
+        --------
+        fix: update course run selection logic for SAP content exporter
+        
+        [3.53.3]
+        --------
+        feat: mark Cornerstone session token fields read-only in admin
+        
+        [3.53.2]
+        --------
+        feat: update data sharing consent request language
+        
+        [3.53.1]
+        --------
+        feat: Django Admin tweaks for integrations
+        
+        [3.53.0]
+        --------
+        feat: Added management command for weekly nudge to dormant enterprise learners
+        
+        [3.52.0]
+        --------
+        feat: add `enable_portal_learner_credit_management_screen` to `EnterpriseCustomer`
+        
+        [3.51.1]
+        --------
+        feat: basic integrated channels task concurrency control
+        
+        [3.51.0]
+        --------
+        feat: Added command for monthly impact report for enterprise administrators
+        
+        [3.50.0]
+        --------
+        feat: add `enable_learner_portal_offers` to `EnterpriseCustomer`
+        
+        [3.49.10]
+        ---------
+        fix: append backslash to ecommerce url and change `get` to `get_or_create` in `fulfill_pending_course_enrollments`
+        
+        [3.49.9]
+        --------
+        feat: add source query param in data sharing consent url
+        
+        [3.49.8]
+        --------
+        chore: add logs for dsc
+        
+        [3.49.7]
+        --------
+        fix: parsing improvements to incorrect learner completion completed-at dates
+        
+        [3.49.6]
+        --------
+        fix: incorrect learner completion completed-at dates
+        
+        [3.49.5]
+        --------
+        feat: add lms_user_id to serialized admin users
+        
+        [3.49.4]
+        --------
+        feat: add dry-run mode to integrated channels
+        
+        [3.49.3]
+        --------
+        fix: don't transmit schedule data to SAP if start or end date is empty
+        
+        [3.49.2]
+        --------
+        feat: improved channel logging
+        
+        [3.49.1]
+        --------
+        fix: add stricter validation on system wide role assignments
+        
+        [3.49.0]
+        --------
+        fix: Return None for context if a ``SystemWideEnterpriseUserRoleAssignment`` has no enterprise_customer and does not apply to all contexts.
+             We'll no longer fall back on granting context based on enterprise membership when there is no explicit context.
+        
+        [3.48.0]
+        --------
+        chore: add migration to remove is_active from role assignment model schema
+        
+        [3.47.2]
+        --------
+        chore: remove is_active field from role assignment model
+        
+        [3.47.1]
+        --------
+        chore: remove data-cleaning management commands. prepare for column-removal migration
+        
+        [3.47.0]
+        --------
+        temp: adding system wide role assignment field and management commands to clean data
+        
+        [3.46.6]
+        --------
+        fix: correctly handle multiple canvas and blackboard oauth configs
+        
+        [3.46.5]
+        --------
+        fix: degreed2 improperly tracking completion status
+        
+        [3.46.4]
+        --------
+        fix: Degreed2 estimated time to complete in hours
+        
+        [3.46.3]
+        --------
+        fix: update logic for parsing course price for SAP
+        
+        [3.46.2]
+        --------
+        fix: Degreed2 estimated time to complete in days
+        
+        [3.46.1]
+        --------
+        feat: admin view improvements
+        
+        [3.46.0]
+        --------
+        fix: modify signature of EmbargoApiClient.redirect_if_blocked
+        Make this signature match and use the same signature that
+        ``openedx.core.djangoapps.embargo.api.redirect_if_blocked()`` now uses.
+        
+        [3.44.4]
+        --------
+        fix: implement back-off and retry for degreed2
+        fix: drop tpa_hint param in redirects when no SSO
+        
+        [3.44.3]
+        --------
+        fix: Undoes revert of 3.44.0, while also ensuring that
+        ``SystemWideEnterpriseUserRoleAssignment.get_assignments()`` can handle and respect any null values returned
+        from ``get_context()``.
+        
+        [3.44.2]
+        --------
+        - feat: configure django admin for degreed2 audit records
+        - fix: Moodle client should accept treat duplicate course id on create as a success
+        
+        [3.44.1]
+        --------
+        fix: no-op version bump (skipping 3.44.0) to account for a revert:
+        https://github.com/openedx/edx-enterprise/pull/1534
+        
+        [3.44.0]
+        --------
+        fix: [REVERTED] override get_assignments() so that active enterprise uuids come first.
+        
+        Overrides the SystemWideEnterpriseUserRoleAssignment.get_assignments() method to return
+        a list of (role, context) assignments, where the first item in the list corresponds
+        to the currently active enterprise for the user.
+        
+        [3.43.1]
+        ---------
+        chore: replace enterprise customer drop-downs in django admin
+        
+        [3.43.0]
+        ---------
+        feat: allow admins to remove learners from org
+        
+        [3.42.5]
+        ---------
+        fix: improve guards on fk data backfill job
+        
+        [3.42.4]
+        ---------
+        feat: updated logic for completions in integrated channels
+        
+        [3.42.3]
+        ---------
+        feat: additional fk data backfill performance improvements
+        
+        [3.42.2]
+        ---------
+        feat: speed up fk data backfill
+        
+        [3.42.1]
+        ---------
+        feat: use new foreign keys on integrated channels audit models
+        
+        [3.42.0]
+        ---------
+        feat: add admin_users to ``EnterpriseCustomerSerializer``
+        
+        [3.41.13]
+        ---------
+        fix: remove backfill managment command arguments
+        
+        [3.41.12]
+        ---------
+        fix: Use enterprise customer uuid coming in request data
+        
+        [3.41.11]
+        ---------
+        fix: Add unique_together constraint in SystemWideEnterpriseUserRoleAssignment
+        
+        [3.41.10]
+        ---------
+        fix: Add management command to backfill missing audit record foreign keys.
+        
+        [3.41.9]
+        ---------
+        fix: Squash SAP Success Factors migrations to remove reference to ``PositiveIntegerField``.
+        
+        [3.41.8]
+        ---------
+        fix: Alter `enterprise_course_enrollment_id` field from `PositiveIntegerField` to `IntegerField` in `BlackboardLearnerAssessmentDataTransmissionAudit` and `SapSuccessFactorsLearnerDataTransmissionAudit`. This change
+        require to run migrations on mysql8.
+        
+        [3.41.7]
+        ---------
+        fix: add foreign keys to integrated channels audit models
+        
+        [3.41.6]
+        ---------
+        fix: making making degreed token base url optional
+        
+        [3.41.5]
+        ---------
+        feat: add missing logging for grades api results in integrated channels exporter
+        
+        [3.41.4]
+        ---------
+        feat: added html pages for oauth authorization success/failure
+        
+        [3.41.3]
+        ---------
+        fix: allow null completed_timestamp field for integrated channels learner audit models
+        
+        [3.41.2]
+        ---------
+        feat: setting customer identity provider config is_valid on first SSO login
+        
+        [3.41.0]
+        ---------
+        feat: Allow partial_update on `EnterpriseCustomerViewSet`
+        
+        [3.40.16]
+        ---------
+        fix: CSOD Learner Audit Django Admin Timeouts
+        
+        [3.40.15]
+        ---------
+        fix: Use correct completions URL for Degreed2
+        
+        [3.40.14]
+        ---------
+        fix: CornerstoneLearnerDataTransmissionAudit admin view timeout
+        
+        [3.40.13]
+        ---------
+        fix: Degreed2 Missing Learner Data Audit Records
+        
+        [3.40.12]
+        ---------
+        fix: Degreed2 Missing Learner Data Audit Records
+        
+        [3.40.11]
+        ---------
+        feat: New integrated channels Blackboard api endpoint to fetch global config creds
+        
+        [3.40.10]
+        ---------
+        feat: Add drafting functionality to save incorrect fields
+        
+        
+        [3.40.9]
+        ---------
+        feat: new integrated channels customer configs list view, new integrated channels config serializer `is_valid` field
+        
+        [3.40.8]
+        ---------
+        feat: add enable_browse_and_request field to `EnterpriseCustomer`
+        
+        [3.40.7]
+        ---------
+        fix: Broken Canvas oauth authorization url
+        
+        [3.40.6]
+        ---------
+        feat: SAPSF content metadata transmission now also sends course schedule
+        
+        [3.40.5]
+        ---------
+        feat: adding CornerstoneLearnerDataTransmissionAudit admin view
+        feat: log if-modified-since + content metadata for CSOD
+        
+        [3.40.4]
+        ---------
+        feat: support filtering by a list of user ids for `EnterpriseCustomerUserViewSet`
+        
+        [3.40.3]
+        ---------
+        feat: show field show_course_price in SAPSF Django admin form
+        
+        [3.40.2]
+        ---------
+        feat: override chunk size default to match channel capability
+        
+        [3.40.1]
+        ---------
+        chore: squash migrations for blackboard and sap_success_factor apps.
+        
+        [3.40.0]
+        ---------
+        fix: Alter `enterprise_course_enrollment_id` field from `PositiveIntegerField` to `IntegerField` in `BlackboardLearnerAssessmentDataTransmissionAudit` and `SapSuccessFactorsLearnerDataTransmissionAudit`. This change
+        require to run migrations on mysql8.
+        
+        [3.39.1]
+        ---------
+        fix: switching blackboard integrated channels from client based auth credentials to global creds
+        
+        [3.39.0]
+        ---------
+        fix: ensure `active` field on EnterpriseCustomerUser objects are set to `False` appropriately
+        feat: add management command to clean up `active` fields on EnterpriseCustomerUser objects
+        
+        [3.38.7]
+        ---------
+        feat: customer configs draft saving that makes all variables optional
+        feat: feat: Add field for Display name for LMS configs
+        
+        [3.39.0]
+        chore: dropped Django22, 30 and 31 support
+        
+        [3.38.6]
+        ---------
+        feat: add created to enterprise course enrollment serializer fields
+        
+        [3.38.5]
+        ---------
+        fix: update link_learners action to respond with error when payload is empty.
+        
+        [3.38.4]
+        ---------
+        fix: bugfix for Cornerstone missing completion records
+        
+        [3.38.3]
+        ---------
+        fix: more logging to debug missing completion records
+        
+        [3.38.2]
+        ---------
+        fix: Django Admin bugfix
+        
+        [3.38.1]
+        ---------
+        feat: New crud viewset for IC degreed2 configurations
+        
+        [3.38.0]
+        ---------
+        feat: Adds toggle_universal_link endpoint
+        
+        [3.37.0]
+        ---------
+        feat: Dependency upgrades
+        
+        [3.36.13]
+        ---------
+        fix: check if instance is an iterable rather than a list in ``EnterpriseCustomerUserReadOnlySerializer``
+        
+        [3.36.12]
+        ---------
+        feat: add enterprise role assignments to ``EnterpriseCustomerUserReadOnlySerializer``
+        
+        [3.36.11]
+        ---------
+        fix: Integrated channels Degreed2 exporter now handles invalid start/end date in content metadata item
+        
+        [3.36.10]
+        ---------
+        fix: add `basic_list` action to ``EnterpriseCustomerInviteKeyViewSet`` to return unpaginated set of invite keys.
+        
+        [3.36.9]
+        --------
+        feat: new oauth state for multi-lms-configuration
+        
+        [3.36.8]
+        --------
+        feat: allow more than 1 lms configuration per lms-kind
+        
+        [3.36.7]
+        --------
+        feat: update `enterprise_customer_invite_key` filter and serializer
+        
+        [3.36.6]
+        --------
+        feat: Show OAuth Auth link for Blackboard Admin
+        
+        [3.36.5]
+        --------
+        fix: add support for an ``enterprise_customer_invite_key`` UUID query parameter to be passed and handled by the ``EnterpriseProxyLoginView``
+        
+        [3.36.4]
+        --------
+        feat: OAuth Auth link for Blackboard Admin
+        
+        [3.36.3]
+        --------
+        feat: Integrated channels, grade send logic only logs instead of raising when enterprise_customer_user record is inactive
+        
+        [3.36.2]
+        --------
+        feat: add is_active on enterprise customer invite key
+        
+        [3.36.1]
+        --------
+        feat: improved integrated channel log consistency
+        
+        [3.36.0]
+        --------
+        feat: added view to link learners from a enterprise customer key
+        
+        [3.35.3]
+        --------
+        fix: require expiry date on ``EnterpriseCustomerInviteKey`` model
+        
+        [3.35.2]
+        --------
+        feat: reformat integrated channels logging to be more splunk friendly
+        
+        [3.35.1]
+        --------
+        docs: Updating help_text for universal_link field on EnterpriseCustomer model
+        
+        [3.35.0]
+        --------
+        feat: Adding universal_link field to EnterpriseCustomer model
+        
+        [3.34.2]
+        --------
+        feat: add try catch block to skip unfound courses
+        
+        [3.34.1]
+        --------
+        feat: add enterprise customer invite key model and viewset
+        
+        [3.34.0]
+        --------
+        feat: New management command to revert enrollment data
+        
+        [3.33.12]
+        ---------
+        feat: SAPSF integrated no longer considers grade change as a reason to retransmit completions.
+        
+        [3.33.11]
+        ---------
+        feat: New management command to backfill end dates on Canvas
+        
+        [3.33.10]
+        ---------
+        fix: incorrectly skipping completion transmissions
+        
+        [3.33.9]
+        ---------
+        feat: allow filtering enterprise learners by enterprise uuid and enterprise role
+        
+        [3.33.8]
+        ---------
+        fix: Moodle duplicate content metadata records detected
+        
+        [3.33.7]
+        ---------
+        fix: allow for records to be saved for integrated channels' content across catalogs
+        
+        [3.33.6]
+        ---------
+        fix: CSOD API session tokens bugfix
+        
+        [3.33.5]
+        ---------
+        fix: CSOD API session tokens are now saved to the customer's configuration instead of individual transmission audits
+        
+        [3.33.4]
+        ---------
+        feat: integrated channels only requests content metadata for courses that need updating
+        
+        [3.33.3]
+        ---------
+        feat: Change Bulk Enrollment Assignment Logic for Pending learners
+        
+        [3.33.2]
+        ---------
+        fix: no longer notify learners of already existing enrollments
+        
+        [3.33.1]
+        ---------
+        fix: Rename model field from key to client_id: Degreed2
+        
+        [3.33.0]
+        ---------
+        feat: New Integrated channel Degreed v2.
+        
+        [3.32.0]
+        ---------
+        feat: Added management command to fix DSC records having spaces instead of +.
+        
+        [3.31.1]
+        ---------
+        fix: pip-tools upgrade
+        
+        [3.31.0]
+        ---------
+        feat: new integrated channels content metadata transmitter flow
+        
+        [3.30.14]
+        ---------
+        fix: blackboard logging function was not returning desired string
+        
+        [3.30.13]
+        ---------
+        fix: properly weight blackboard grades
+        
+        [3.30.12]
+        ---------
+        * chore: update course enrollments through lms
+        
+        [3.30.11]
+        ---------
+        * docs: added adr for zero state browsing with universal link
+        
+        [3.30.10]
+        ---------
+        * fix: refactor moodle _post to use body params
+        
+        [3.30.9]
+        ---------
+        * chore: Don't expire courses that have been modified after given date
+        
+        [3.30.8]
+        ---------
+        * feat: Added a boolean in EnterpriseCustomer to specify whether labor market data should be available in learner portal
+        
+        [3.30.7]
+        ---------
+        * update admin banner notification text field with following changes
+        * increase max_length from 255 to 512
+        * update help text
+        * use textarea widget in django admin
+        
+        [3.30.6]
+        --------
+        * maint: Integrated channels detection system of catalog changes needed is now disabled via override.
+        
+        [3.30.5]
+        --------
+        * fix: Integrated channels data transforming generates json serializable fields.
+        
+        [3.30.4]
+        --------
+        * fix: Blackboard integrated channel now correctly synchronizes the one-and-only valid refresh_token
+        
+        [3.30.3]
+        --------
+        * fix: content_filter in django admin was broken after the jsonfield upgrade, so this contains fix for that
+        
+        [3.30.2]
+        --------
+        * fix: switch is_revoked to True on LicensedEnterpriseCourseEnrollment after license expiration
+        
+        [3.30.1]
+        --------
+        * Allowing management commands to optionally run on inactive Integrated Channel configurations
+        
+        [3.30.0]
+        ---------
+        * Switched back to ``jsonfield`` from ``jsonfield2``
+        
+        [3.29.0]
+        ---------
+        * Added api for fetching field choices from EnterpriseCustomerReportingConfiguration
+        
+        [3.28.24]
+        ---------
+        * Integrated channels Canvas: now fills in Start/end dates in description, and uses Course participation type
+        
+        [3.28.23]
+        ---------
+        * Fix cornerstone character limit bug with dict database table
+        
+        [3.28.22]
+        ---------
+        * fix: Adding error handling for role assignment backfill management command
+        
+        [3.28.21]
+        ---------
+        * bug: The exporter now properly handles instances when enterprise customer catalogs do no need updates.
+        
+        [3.28.20]
+        ---------
+        * feat: Added enterprise_learner role assignment backfill management command
+        
+        [3.28.19]
+        ---------
+        * fix: additional Moodle field changes
+        
+        [3.28.18]
+        ---------
+        * Added customer config based learner data transmission feature flag
+        
+        [3.28.17]
+        ---------
+        * Improve error logging in the Moodle integration
+        
+        [3.28.16]
+        ---------
+        * Fix import error used by bulk enrollment in utils
+        
+        [3.28.15]
+        ---------
+        * integrated channels: single learner assessment exporter logging is not helpful right now so improve it.
+        
+        [3.28.14]
+        ---------
+        * logging improvement when calling integrated channels extract_integration_id
+        
+        [3.28.13]
+        ---------
+        * fixes the way moodle queries for courses ENT-4806
+        
+        [3.28.12]
+        ---------
+        * Integrated channels automatically fill in current date for audit completions if date not available.
+        
+        [3.28.11]
+        ---------
+        * Create "enterprise_learner" role when ``EnterpriseCustomerUser`` records are re-linked.
+        * When ``EnterpriseCustomerUser`` records get deleted, also delete the "enterprise_admin" role specific to the relevant enterprise customer.
+        
+        [3.28.10]
+        ---------
+        * Integrated channel transmitter completions routine now logs as error, any status codes greater than or equal to 400
+        
+        [3.28.9]
+        ---------
+        * Include a ``failure_reason=dsc_denied`` to the DSC failure url when learner denies the DSC terms.
+        
+        [3.28.8]
+        ---------
+        * SAP integrated channel django form gets missing idp id field
+        
+        [3.28.7]
+        ---------
+        * Degreed integrated channel now uses idp_id explicitly when calling get_remote_id()
+        
+        [3.28.6]
+        ---------
+        * SAP integrated channel now uses idp_id explicitly when calling get_remote_id()
+        
+        [3.28.5]
+        ---------
+        * Fixed datetime issue in email_drip_for_missing_dsc_records.
+        
+        [3.28.4]
+        ---------
+        * Integrated channels: audit track completion status now based on incomplete non-gated content
+        
+        [3.28.3]
+        ---------
+        * Integrated channels: log response code and message if SAP post fails
+        
+        [3.28.2]
+        ---------
+        * Add `progress_v3` report type for enterprise reporting.
+        
+        [3.28.1]
+        ---------
+        * Inject a failure reason into the ``failure_url`` query params when a verified course mode
+          is not available for DSC-based enrollments.
+        
+        [3.28.0]
+        ---------
+        * Added support for Django 3.0, 3.1 and 3.2
+        
+        [3.27.27]
+        ---------
+        * Adds enterprise catalog query title as an optional attribute to create/update post requests on the catalog service.
+        
+        [3.27.26]
+        ---------
+        * Refactor data-sharing consent GET and POST handlers to not have too many statements,
+          because readability matters.
+        
+        [3.27.25]
+        ---------
+        * Blackboard Integrated channel oauth2 refresh token handling fixes.
+        
+        [3.27.24]
+        ---------
+        * Adding a new EnterpriseEnrollmentSource to be used for bulk enrollment.
+        
+        [3.27.23]
+        ---------
+        * Add logging of user id for troubleshooting in a couple of locations.
+        * Clean up pylint suppressions and rules using latest rules set by edx-lint.
+        
+        [3.27.22]
+        ---------
+        * Prevent failures on integrated channels delete requests when courses are not found.
+        
+        [3.27.21]
+        ---------
+        * Encode invalid course keys for CSOD customers
+        
+        [3.27.20]
+        ---------
+        * Handle content_last_modified not provided by enterprise catalog
+        
+        [3.27.19]
+        ---------
+        * Localize timezones on catalog modified min (not found) values
+        
+        [3.27.18]
+        ---------
+        * Integrated channels util functions needed to base64 urlsafe encode/decode course keys for use with some LMS systems like Cornerstone.
+        
+        [3.27.17]
+        ---------
+        * Integrated channels now checks and uses catalog modified times to determine if an update is needed before retrieving content metadata.
+        
+        [3.27.16]
+        ---------
+        * Making bulk catalog query ID update params optional
+        
+        [3.27.15]
+        ---------
+        * Added title field in ``AdminNotification`` table.
+        
+        [3.27.14]
+        ---------
+        * Adding the ability to specify parameters in the bulk catalog query ID updated management command.
+        
+        [3.27.13]
+        ---------
+        * Revert 'Start my course' links in bulk enrollment emails to courseware based links instead of learner portal.
+        
+        [3.27.12]
+        ---------
+        * Prevent django admin deletions of catalog queries. Added management command to bulk update catalogs of their query IDs
+        
+        [3.27.11]
+        ---------
+        * Avoid failure when an email send in the learners loop fails, for notify_enrolled_learners
+        
+        [3.27.10]
+        ---------
+        * Use celery tasks for emails sent using EnterpriseCustomer's notify_enrolled_learners method
+        
+        [3.27.9]
+        --------
+        * Fix SAP Course Completion payload format again.
+        
+        [3.27.8]
+        --------
+        * Fix SAP Course Completion payload format.
+        
+        [3.27.7]
+        --------
+        * Replace EnrollmentApiClient calls from Bulk enrollment with a newly minted python api call (non-REST) from edx-platform
+        
+        [3.27.6]
+        --------
+        * Filter available IDPs for Enterprise Customers by new boolean flag on ProviderConfig model.
+        
+        [3.27.5]
+        --------
+        * Removing CSOD Integrated Channel from the list of supported channels for the content metadata transmission task.
+        
+        [3.27.4]
+        --------
+        * Add pagination handling to integrated channels Blackboard client
+        
+        [3.27.3]
+        --------
+        * Adds flag to SAP Success Factors customer configuration to switch SAP endpoints for learner completion calls.
+        
+        [3.27.2]
+        --------
+        * Ensure deletion and unlinking of a ``EnterpriseCustomerUser`` record only deletes the ``enterprise_learner`` system-wide role for that
+          particular ``EnterpriseCustomerUser``, as opposed to all ``enterprise_learner`` roles associated with the user.
+        
+        [3.27.1]
+        --------
+        * Updates bulk enrollment email template.
+        
+        [3.27.0]
+        --------
+        * Added enterprise uuid support in course enrollment.  ERTE-5
+        
+        [3.26.23]
+        ---------
+        * Fix the way that ``page_size`` is passed as a param to the ``get_content_metadata`` endpoint.
+          Add a unit test for the ``EnterpriseCatalogApiClient.get_content_metadata()`` method, which
+          was previously untested.
+        
+        [3.26.22]
+        ---------
+        * Set the EnterpriseCatalogApiClient get_content_metadata request page_size parameter to 50; the enterprise-catalog
+          service has a default page_size of 10.  This change means that we'll make a smaller overall number of SELECTs
+          against the enterprise-catalog database.
+        
+        [3.26.21]
+        ---------
+        * Adds error handling and logging to the assignment deduplication management command.
+        
+        [3.26.20]
+        ---------
+        * Updates requirements and style changes to match the latest Pylint.
+        
+        [3.26.19]
+        ---------
+        * Updates to integrated channels catalogs to transmit help text.
+        
+        [3.26.18]
+        ---------
+        * Overriding default chunk size for SAP and Canvas integrations.
+        
+        [3.26.17]
+        ---------
+        * Adds Segment tracking for bulk enrollment method.
+        
+        [3.26.16]
+        ---------
+        * Added history tables for EnterpriseCustomerUser and SystemWideEnterpriseUserRoleAssignment.
+        
+        [3.26.15]
+        ---------
+        * Added management command to clean up duplicate transmitted assignments for the integrated channels.
+        
+        [3.26.14]
+        ---------
+        * Fixed issue with API version in Tableau client.
+        
+        [3.26.13]
+        ---------
+        * Fixed issue with CourseEnrollment receiver when learner has multiple enterprises.
+        
+        [3.26.12]
+        ---------
+        * Canvas integrated channel now supports create_or_update pattern for courses. Detects/logs deleted courses.
+        
+        [3.26.11]
+        ---------
+        * Removed ``ENABLE_MULTIPLE_USER_ENTERPRISES_FEATURE`` waffle switch
+        
+        [3.26.10]
+        ---------
+        * Fix forward for parameter rename changing the signals API in 3.26.7
+        
+        [3.26.9]
+        --------
+        * Added support to use default idp in Enterprise slug login if there are multiple.
+        
+        [3.26.8]
+        --------
+        * added support for redirecting user to default IDP, in case multiple IDPs's attached
+        
+        [3.26.7]
+        --------
+        * developer-only facing updates to standardize LMS Integrated Channels logging.
+        
+        [3.26.6]
+        --------
+        * added an update api call to assign tableau user roles
+        
+        [3.26.5]
+        --------
+        * fix: Bypass slumber's getattr definition when requesting enrollments for usernames starting with '_'
+          (because slumber will raise an AttributeError from getattr when requesting a resource that starts with '_').
+        
+        [3.26.4]
+        --------
+        * removed unnecessary call to ecom in bulk enrollment (process of assigning a license already accounts for this)
+        
+        [3.26.3]
+        --------
+        * added --skip-unlink param in unlink_enterprise_customer_learners command to just remove DSC records.
+        
+        [3.26.2]
+        ---------
+        * Added logs for enterprise users created in tableau.
+        
+        [3.26.1]
+        --------
+        * Added check to configure reports only for Catalog over SFTP.
+        
+        [3.26.0]
+        ---------
+        * Added support for admin scheduled banners that run from date x to date y.
+        
+        [3.25.2]
+        --------
+        * Log exception stack trace during DSC licensed-enrollment flow, so that
+          we can look at log messages and understand what exactly is failing.
+        
+        [3.25.1]
+        --------
+        * bug fix, properly handle API response pagination from Canvas.
+        
+        [3.25.0]
+        --------
+        * added management command to unlink learners from their enterprise and
+          deleting DSC and EnterpriseCourseEnrolment records.
+        
+        [3.24.0]
+        --------
+        * added ``enable_compression`` flag in EnterpriseCustomerReportConfiguration table.
+        
+        [3.23.12]
+        ---------
+        * Database based template system for enrollment emails, including support for Admin and Self enroll modes.
+          Admin mode for Bulk enrollment, existing enrollment emails still use the current template.
+        
+        [3.23.11]
+        ---------
+        * Log more specific information about HTTP client errors that are caught when using the LMS
+          enrollment API.  Also send an exception event to the monitoring service when this happens, even
+          though we handle the exception "gracefully".
+        
+        [3.23.10]
+        ---------
+        * Send long dsc url in missing DSC email as individual params.
+        
+        [3.23.9]
+        ---------
+        * Reduced the DSC url size to account for character limit in Segment event properties.
+        
+        [3.23.8]
+        ---------
+        * Remove hardcoded admin permission constraints for ContentMetadataItemTransmission integrated channel model.
+        
+        [3.23.7]
+        ---------
+        * Canvas integrated channel now 'concludes' course when sending deletion event, instead of 'delete'.
+        
+        [3.23.6]
+        ---------
+        * Optimised handling of conditions defining the absence of a DSC.
+        
+        [3.23.5]
+        ---------
+        * Added exception handling in consent missing email.
+        
+        [3.23.4]
+        ---------
+        * Added a check for enterprise DSC configuration in missing DSC drip.
+        
+        [3.23.3]
+        ---------
+        * Added a check for course access before sending Segment event for missing DSC.
+        
+        [3.23.2]
+        ---------
+        * Added new field reply_to in enterprise customer where learner's reply to enterprise emails will be delivered.
+        
+        * Removed migrations that have been merged into squashed migrations.
+        
+        [3.23.1]
+        ---------
+        * Fix: filter out EnterpriseCourseEnrollments without corresponding CourseEnrollment records in learner portal view.
+        
+        [3.23.0]
+        ---------
+        * Added support for ``--enrollment-before`` and ``--no-commit`` params in ``email_drip_for_missing_dsc_records`` command.
+        
+        [3.22.16]
+        ---------
+        * Fixed Segment json string issue for DSC email drip
+        
+        [3.22.15]
+        ---------
+        * Added additional Segment event properties for missing DSC drip email
+        
+        [3.22.14]
+        ---------
+        * Fixed timezone issue in comparison of course start datetime
+        
+        [3.22.13]
+        ---------
+        * Make enterprise customer uuid mandatory for `TableauAuthView`
+        
+        [3.22.12]
+        ---------
+        * Change the verbose name and help text for the ``enable_integrated_customer_learner_portal_search`` field on the ``EnterpriseCustomer`` model.
+        
+        [3.22.11]
+        ---------
+        * No longer call into the removed email_marketing platform djangoapp
+        
+        [3.22.10]
+        ---------
+        * Use Braze for sending data sharing consent drop emails, add the DSC link inside the drip email.
+        
+        [3.22.9]
+        --------
+        * Expose enterprise catalog uuids associated with an Enterprise Customer in the ``enterprise-customer`` API endpoint.
+        
+        [3.22.8]
+        --------
+        * Add dashboard admin rbac role permission on tableau auth view so that only
+          enterprise dashboard admins can access this view.
+        * Add support to generate tableau auth token based on incoming enterprise customer's uuid
+        
+        [3.22.7]
+        --------
+        * chore: upgrade edx-enterprise requirements
+        
+        [3.22.6]
+        --------
+        * Improves performance of enterprise role assignment admin page
+        * Deletes custom get_search_results() method, since ``enterprise_customer__name`` is now a viable search field
+        * Improves pagination by asking for an estimated row count from Mysql ``INFORMATION_SCHEMA.TABLES``
+        * Turns 1 + N query into 1 query via proper use of ``list_select_related``
+        
+        [3.22.5]
+        --------
+        * Fix: no longer stringifying `None` values passed to enterprise catalog creations calls
+        
+        [3.22.4]
+        --------
+        * Fix: learner_data exporter bug fix and refactor for cleaner enrollment filtering
+        
+        [3.22.3]
+        --------
+        * Feature: including EnterpriseCatalogQuery UUID field in request payload to enterprise-catalog on EnterpriseCatalog updates
+        
+        [3.22.2]
+        --------
+        * Feature: new UUID field on EnterpriseCatalogQuery model (and update to all existing query objects)
+        
+        [3.22.1]
+        --------
+        * Refactor: integrated channels learner exporter replace course api client
+        
+        [3.22.0]
+        --------
+        * Added a management command to send emails to learners with missing DSC
+        
+        [3.21.4]
+        --------
+        * allow searching of enterprise customer records with hyphenated uuid
+        * add typeahead search dropdown to imporve enterprise customer search on
+          enterprise reporting configuration
+        
+        [3.21.3]
+        --------
+        * When a learner is linked from manage learners page, in-activate learner's other enterprises
+        
+        [3.21.2]
+        --------
+        * Added support of multiple identity_providers in enterprise.models.get_remote_id.
+        
+        [3.21.1]
+        --------
+        * Added multiple identity_providers in EnterpriseCustomerApi
+        
+        [3.21.0]
+        --------
+        * Added the ability to link/unlink enterprise customer catalogs with enterprise reporting configuration via its API endpoint.
+        
+        [3.20.5]
+        --------
+        * Integrated channels learner_data module refactored to avoid making some LMS REST API calls
+        
+        [3.20.4]
+        --------
+        * Refactored code in `proxied_get()` to clean up duplicate logic.
+        
+        [3.20.3]
+        --------
+        
+        * Removing unused and out of date endpoints for Bulk Enrollment
+        
+        [3.20.2]
+        --------
+        * Allow licensed audit enrollment to have a path to upgrade into verified
+        
+        [3.20.1]
+        --------
+        * update edx-rbac to 1.4.2, plus a bunch of other version bumps.
+        
+        [3.20.0]
+        --------
+        * feat: add support for enterprise admins to create pending enterprise users
+        
+        [3.19.0]
+        --------
+        * feat: add support for creating multiple pending enterprise users
+        
+        [3.18.7]
+        --------
+        
+        * Refactored bulk enrollment serializer and bug fixes to the bulk enrollment endpoint.
+        
+        [3.18.6]
+        --------
+        
+        * fix: The update_role_assignments_with_customers command no longer updates records.  It only creates
+          new records, which helps de-risk the operation.
+        
+        [3.18.5]
+        --------
+        * fix: do not include unpublished courses when enrollment link resolves course_runs
+        
+        [3.18.4]
+        --------
+        
+        * fix: The update_role_assignments_with_customers command no longer deletes open assignments.  Allowing it to do so
+          left us prone to error when an explicit enterprise_customer_uuid arg is provided.  We should modify this command
+          in the future to perform deletions of open assignments as its only action, and it should only be invoked this way
+          after we have verified that all backfilled enterprise_customer fields on the assignments have been set correctly.
+        
+        [3.18.3]
+        --------
+        
+        * Adds the catalog admin role to ``roles_api.roles_by_name()``.
+        
+        [3.18.2]
+        --------
+        
+        * Removes course mode as a required parameter to the bulk subscription enrollment endpoint.
+        
+        [3.18.1]
+        --------
+        
+        * Adds bulk enterprise learner in bulk courses enrollment endpoint with pending user support.
+        
+        [3.18.0]
+        --------
+        
+        * Adds a management command to update all ``SystemWideEnterpriseUserRoleAssignment`` records in a way
+          that makes them more explicitly defined.
+        
+        [3.17.47]
+        ---------
+        
+        * Bug fix to remove a deprecated parameter that was causing bulk enrollments to fail.
+        
+        [3.17.46]
+        ---------
+        
+        * Made help text of sender_alias more generic.
+        
+        [3.17.45]
+        ---------
+        
+        * Fix bulk enrollment endpoint to process email_csv and email as well
+        
+        [3.17.44]
+        ---------
+        
+        * Replaced an LMS Enrollment API call with direct call the DB to avoid LMS rate limiting during integrated channels bulk jobs.
+        
+        [3.17.43]
+        ---------
+        
+        * Updated the default IDP priority of enterprises for social auth.
+        
+        [3.17.42]
+        ---------
+        
+        * Change canvas_course_id to BigInteger: Integrated Channels
+        
+        [3.17.41]
+        ---------
+        
+        * Upgrade django-ipware to version 3.0.2
+        
+        [3.17.40]
+        ---------
+        
+        * Read CSV files using `utf-8-sig` encoding to handle Byte Order Mark
+        
+        [3.17.39]
+        ---------
+        
+        * Rename `Owners` field to `Partners` for Cornerstone Integration
+        
+        [3.17.38]
+        
+        * Omitting assessment level reporting from integrated Canvas learners final grade to not have redundant reported points
+          between final grades and subsection grades.
+        
+        [3.17.37]
+        ---------
+        
+        * Refactor to only create an ``EnterpriseCourseEnrollment`` if we successfully create/update a ``CourseEnrollment`` record
+        
+        [3.17.36]
+        ---------
+        
+        * Properly filtering integrated channels that support assessment level reporting.
+        
+        [3.17.35]
+        ---------
+        
+        * Map "estimated_hours" to "credit_hours" in addition to "total_hours" in SAP.
+        
+        [3.17.34]
+        ---------
+        
+        * Removing temporary logs from integrated channels.
+        
+        [3.17.33]
+        ---------
+        
+        * Enable manually adding learners to multiple enterprises
+        
+        [3.17.32]
+        ---------
+        
+        * Adding the logic to select default provider in case an enterprise has multiple identity providers attached.
+        
+        [3.17.31]
+        ---------
+        
+        * Change moodle course title in exporter, to include edX text.
+        
+        [3.17.30]
+        ---------
+        
+        * Investigatory logging to track down Integrated Channels transmission issues.
+        
+        [3.17.29]
+        ---------
+        
+        * Prevent NoneType string concatenation when handling multiple enterprises logistration without redirects.
+        
+        [3.17.28]
+        ---------
+        
+        * Adds default field in enterprise customer identity provider table to select default IDP if there are more than one
+          IDPs attached with enterprise.
+        
+        [3.17.27]
+        ---------
+        
+        * Adding Logging to single learner assessment level reporting task.
+        
+        [3.17.26]
+        ---------
+        
+        * Updating docs to reflect method behaviors.
+        
+        [3.17.25]
+        ---------
+        
+        * Making failed SAP user remote ID retrievals log relevant context data.
+        
+        [3.17.24]
+        ---------
+        
+        * Making sure Canvas Integrated Channel properly url encodes user identifier fields.
+        
+        [3.17.23]
+        ---------
+        
+        * Fixing assessment level reporting audit retrieval.
+        
+        [3.17.22]
+        ---------
+        
+        * Adds content metadata item transmission table to Django Admin.
+        
+        [3.17.21]
+        ---------
+        
+        * Introduce and use a ``roles_api`` module and use the roles API in signal receivers
+          that need to create or delete role assignments.
+        * For created or updated learner and admin enterprise users, associate their user-role
+          with the ``enterprise_customer`` to which that user is linked.
+        * Install django-cache-memoize.
+        
+        [3.17.20]
+        ---------
+        
+        * Adds better exception handling to the SAP integrated channels.
+        * Adds better logging to the base transmission process in the integrated channels.
+        
+        [3.17.19]
+        ---------
+        
+        * Removes the sync_enterprise_catalog_query boolean field from the EnterpriseCustomerCatalog model.
+        * Adds migration to remove the sync_enterprise_catalog_query boolean field.
+        
+        [3.17.18]
+        ---------
+        
+        * Removes all references to the sync_enterprise_catalog_query boolean field from the EnterpriseCustomerCatalog model.
+        * Updates all conditional use of the sync_enterprise_catalog_query field to be True.
+        * A second PR will follow to remove the model field and perform the db migration (blue/green deployment safe).
+        
+        [3.17.17]
+        ---------
+        
+        * Added a catch all exception block to ensure login flow is not interrupted by analytics user sync.
+        
+        [3.17.16]
+        ---------
+        
+        * Include course mode for the user's ``student.CourseEnrollment`` in the ``EnterpriseCourseEnrollmentSerializer``.
+        
+        [3.17.15]
+        ---------
+        
+        * In ``SystemWideEnterpriseUserRoleAssignment``, Use either ``applies_to_all_contexts`` or ``enterprise_customer``
+          if they are True or non-null, respectively, in determining the result of ``get_context()``,
+          but continue to return list of all linked enterprise customer UUIDs if not, (which is the current behavior).
+          This is a small step on our journey to explicitly defining user-role assignments.
+        
+        [3.17.14]
+        ---------
+        
+        * On the ``SystemWideEnterpriseUserRoleAssignment`` model, adds an ``enterprise_customer`` FK (nullable)
+          and an ``applies_to_all`` boolean field (defaults to False) that indicates if the user has wildcard permissions.
+        * Updates the admin to show the "effective" customer in the detail view, and the explicit value in the list view.
+          The effective value is the deprecated way we currently determine role assignment -
+          by implicitly assigning the role on every customer to which the user is linked.
+        * In the detail view/form, the "Enterprise customer" dropdown contains only customers
+          to which the user is currently linked.
+        
+        [3.17.13]
+        ---------
+        
+        * added check to make sure enterprise user can only use linked IdP with their enterprise customer.
+        
+        [3.17.12]
+        ---------
+        
+        * Conditionally allows the deletion of individual ``EnterpriseCourseEnrollment`` and related
+          ``LicensedEnterpriseCourseEnrollment`` records via the Django Admin site, so that site admins can manually
+          delete enterprise enrollments that were created in error.
+          This is only allowed if a Django settings feature flag is set to ``True``.
+        
+        [3.17.11]
+        ---------
+        
+        * Apply edx-rbac migration to add ``applies_to_all_contexts`` field to ``SystemWideEnterpriseUserRoleAssignment``.
+        * Added endpoints for Cornerstone integrated channel.
+        
+        [3.17.10]
+        ---------
+        
+        * added home page logo for EnterpriseSelectionView and EnterpriseLoginView
+        
+        [3.17.9]
+        --------
+        
+        * Fix deprecation warning: ``third_party_auth`` should be imported as ``common.djangoapps.third_party_auth``.
+        
+        [3.17.8]
+        --------
+        
+        * Added new API endpoints for Degreed integrated channel.
+        
+        [3.17.7]
+        --------
+        
+        * Added new field ``sender_alias`` in enterprise customer which will be used in emails except of default alias.
+        
+        [3.17.6]
+        --------
+        
+        * Non-effectual code cleanup / refactor to remove some final pieces of duplication (canvas, blackboard).
+        
+        [3.17.5]
+        --------
+        
+        * Ensure enterprise course enrollments return valid course run statuses such that when a learner earns a passing certificate, the ``enterprise_course_enrollments`` API endpoint deems the course is complete even though the course itself may not have ended yet per the configured dates.
+        
+        [3.17.4]
+        --------
+        
+        * Add some info to the ``EnterpriseCourseEnrollment`` docstring, add ``is_active`` property to same.
+        
+        [3.17.3]
+        --------
+        
+        * Fixed unnessary integrated channel signal transmission on course completion to inactive customers by adding guard condition.
+        
+        [3.17.2]
+        --------
+        
+        * Stop listening for ``student.CourseEnrollment`` unenrollment signal, as introduced in 3.17.0
+        
+        [3.17.1]
+        --------
+        
+        * Add management command to process expired subscriptions and field on subscriptions to persist that the subscription expiration has been processed
+        
+        [3.17.0]
+        --------
+        
+        * Listen for ``student.CourseEnrollment`` unenrollment signal and delete associated
+          ``EnterpriseCourseEnrollment`` record if one exists (we will have a historical record of the deletion).
+        
+        [3.16.11]
+        ---------
+        
+        * Retrieve ``EnterpriseCustomerUser`` by both user_id and enterprise_customer to handle users who are pending for more than 1 enterprise.
+        
+        [3.16.10]
+        ---------
+        
+        * Forcing embedded enrollment links within integrated Blackboard courses to open new windows to avoid security alert
+          prompt.
+        
+        [3.16.9]
+        --------
+        
+        * Upgrade celery to 5.0.4
+        
+        [3.16.8]
+        --------
+        
+        * Added ClientError exception handling for SAPSuccessFactorsAPIClient.
+        
+        [3.16.7]
+        --------
+        
+        * Modify the learner portal enterprise_course_enrollments endpoint to include an ``is_enrollment_active``
+          key that indicates the status of the enterprise enrollment's related ``student.CourseEnrollment`.
+          Allow the endpoint to optionally accept an ``?is_active`` query param, so that clients may request
+          only active enrollments from it.
+        
+        [3.16.6]
+        --------
+        
+        * Improved error handling for SAP Success Factors OAuth2 response.
+        
+        [3.16.5]
+        --------
+        
+        * Refactoring title content metadata in integrated course creation within the Blackboard integrated channel.
+        
+        [3.16.4]
+        --------
+        
+        * Add SuccessFactors Customer Configuration API endpoint.
+        
+        [3.16.3]
+        --------
+        
+        * Update unique constraints for pending Enterprise learners/admins to support users who may be pending for more than 1 Enterprise.
+        * Fix ``handle_user_post_save`` to account for the potential of being a pending learner/admin for more than 1 Enterprise.
+        
+        [3.16.2]
+        --------
+        
+        * Refactor ``handle_user_post_save`` to be responsible for linking PendingEnterpriseCustomerUser records and granting admin permissions.
+        
+        [3.16.1]
+        --------
+        
+        * Adding backend support for admin portal Blackboard configuration.
+        
+        [3.16.0]
+        --------
+        
+        * Added the ability to enable multiple Identity Providers for a single enterprise customer.
+        
+        [3.15.0]
+        --------
+        
+        * Converted relation between enterprise customer and identity provider to a one-to-many.
+        
+        [3.14.1]
+        --------
+        * Adds new API for Canvas LMS configurations.
+        
+        [3.14.0]
+        --------
+        
+        * Rebranding update: Change fonts and colors, change mobile layout
+        
+        [3.13.12]
+        ---------
+        
+        * Adding decorators to missed integrated channel tasks.
+        
+        [3.13.11]
+        ---------
+        
+        * Add new API for external LMS configurations.
+        
+        [3.13.10]
+        ---------
+        
+        * Use logo from ``get_platform_logo_url`` in the legacy Django templates
+        
+        [3.13.9]
+        --------
+        
+        * Adding Blackboard support for assessment level reporting in the integrated channels.
+        
+        [3.13.8]
+        --------
+        
+        * Bug fix with course key lookup in the Canvas assessment level grade reporting flow.
+        
+        [3.13.7]
+        --------
+        
+        * Rebranding update: move to more robust ``get_platform_logo_url`` and update default branding colors.
+        
+        [3.13.6]
+        --------
+        
+        * Add log for enterprise enrollment page.
+        
+        [3.13.5]
+        --------
+        
+        * Fixed deprecation warnings related with drf methods (detail_route, list_route).
+        
+        [3.13.4]
+        --------
+        
+        * Empty sequence bugfix in catalog api.
+        
+        [3.13.3]
+        --------
+        
+        * Course end date bugfix.
+        
+        [3.13.2]
+        --------
+        
+        * Add course end date to course level metadata.
+        
+        [3.13.1]
+        --------
+        
+        * Base implementation of assessment level reporting for Integrated Channels.
+        
+        [3.13.0]
+        --------
+        
+        * Use full paths for edx-platform/common/djangoapps imports, as described in
+          `edx-platform ADR #7 <https://github.com/openedx/edx-platform/blob/master/docs/decisions/0007-sys-path-modification-removal.rst>`_.
+        
+        [3.12.4]
+        --------
+        
+        * Fix silent exception in catalog api call.
+        
+        [3.12.3]
+        --------
+        
+        * Add code_owner custom attribute for celery tasks.
+        
+        [3.12.2]
+        --------
+        
+        * Refresh catalog metadata on create and update
+        
+        [3.12.1]
+        --------
+        
+        * added support for grade, completion and course_structure type reports in enterprise report configurations. Added validation to allow these reports for Pearson enterprises only.
+        
+        [3.12.0]
+        --------
+        
+        * Support uploading a ``course_id`` column in the "Manage Learners" CSV bulk upload to allow manual enrollments in multiple courses at once.
+        
+        [3.11.1]
+        --------
+        
+        * Fixes the issue where user preference value can not be null.
+        
+        [3.11.0]
+        --------
+        
+        * Added spanish translations for data sharing consent page.
+        
+        [3.10.5]
+        --------
+        
+        * Update Moodle integration to single transmission to handle responses properly.
+        
+        [3.10.4]
+        --------
+        
+        * Remove hyphens from  enterprise_customer_uuid for admin user creation and tableau authentication.
+        
+        [3.10.3]
+        --------
+        
+        * Fix timout on update.
+        
+        [3.10.2]
+        --------
+        
+        * Updated the logic to clear enterprise learner language in a way that db lock does not happen.
+        
+        [3.10.1]
+        --------
+        
+        * change username with enterprise_customer_uuid for tableau trusted authentication and tableau user creation.
+        
+        [3.10.0]
+        --------
+        
+        * Tests only: upgrade to pytest 6+ and factoryboy 3+ to bring up to date with edx-platform.
+        
+        [3.9.13]
+        --------
+        
+        * Adding Blackboard customization to integrated channel content metadata creation.
+        
+        [3.9.12]
+        --------
+        
+        * change username with user_id for tableau trusted authentication and tableau user creation.
+        
+        [3.9.11]
+        --------
+        
+        * add logs to know if data sharing consent is failing because catalog does not contain the course
+        
+        [3.9.10]
+        --------
+        
+        * added POST enterprise-customer/<uuid>/enterprise_learner endpoint to mimic Manage Learners admin form functionality
         
         [3.9.9]
         --------
         
         * upgrade version to create new release on pypi.
         
         
@@ -1281,14 +3413,15 @@
         
         [2.0.19] - 2019-11-13
         ---------------------
         
         * Sorted results of enterprise-learner API by active flag in descending order so active enterprises are on the top
         
         [2.0.18] - 2019-11-13
+        
         ---------------------
         
         * Better handling when Integrated Channels return unexpected results
         
         
         [2.0.17] - 2019-11-08
         ---------------------
@@ -3566,14 +5699,13 @@
         * First release on PyPI.
         * Models and Django admin integration
         
 Keywords: Django edx
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: Framework :: Django
-Classifier: Framework :: Django :: 2.2
+Classifier: Framework :: Django :: 3.2
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3 or later (AGPLv3+)
 Classifier: Natural Language :: English
 Classifier: Programming Language :: Python :: 3
-Classifier: Programming Language :: Python :: 3.5
 Classifier: Programming Language :: Python :: 3.8
```

### Comparing `edx-enterprise-3.9.9/consent/migrations/0004_datasharingconsenttextoverrides.py` & `edx-enterprise-4.0.0/consent/migrations/0004_datasharingconsenttextoverrides.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,22 +1,21 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.12 on 2018-04-11 11:28
 
 
 import django.db.models.deletion
 import django.utils.timezone
 from django.db import migrations, models
 
 import model_utils.fields
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0041_auto_20180212_1507'),
+        ('enterprise', '0001_squashed_0092_auto_20200312_1650'),
         ('consent', '0003_historicaldatasharingconsent_history_change_reason'),
     ]
 
     operations = [
         migrations.CreateModel(
             name='DataSharingConsentTextOverrides',
             fields=[
```

### Comparing `edx-enterprise-3.9.9/consent/migrations/0001_initial.py` & `edx-enterprise-4.0.0/consent/migrations/0001_initial.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,24 +1,21 @@
-# -*- coding: utf-8 -*-
-
-
 import django.db.models.deletion
 import django.utils.timezone
 from django.conf import settings
 from django.db import migrations, models
 
 import model_utils.fields
 
 import consent.mixins
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0024_enterprisecustomercatalog_historicalenterprisecustomercatalog'),
+        ('enterprise', '0001_squashed_0092_auto_20200312_1650'),
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
     ]
 
     operations = [
         migrations.CreateModel(
             name='DataSharingConsent',
             fields=[
@@ -56,10 +53,10 @@
                 'ordering': ('-history_date', '-history_id'),
                 'get_latest_by': 'history_date',
                 'verbose_name': 'historical Data Sharing Consent Record',
             },
         ),
         migrations.AlterUniqueTogether(
             name='datasharingconsent',
-            unique_together=set([('enterprise_customer', 'username', 'course_id')]),
+            unique_together={('enterprise_customer', 'username', 'course_id')},
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/consent/migrations/0002_migrate_to_new_data_sharing_consent.py` & `edx-enterprise-4.0.0/consent/migrations/0002_migrate_to_new_data_sharing_consent.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Custom migration to transfer consent data from the ``enterprise`` application to the ``consent`` application's
 ``DataSharingConsent`` model.
 
 This migration only does anything significant when running forward. If you would like to do a backwards-migration,
 delete all new rows that were populated in the ``DataSharingConsent`` model's tables.
 (If you have new data in the tables that weren't migrated, use timestamps as you see fit).
@@ -43,15 +42,15 @@
         data_sharing_consent.save()
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         # Make sure enterprise models (source) are available.
-        ('enterprise', '0024_enterprisecustomercatalog_historicalenterprisecustomercatalog'),
+        ('enterprise', '0001_squashed_0092_auto_20200312_1650'),
         # Make sure consent models (target) are available.
         ('consent', '0001_initial'),
     ]
 
     operations = [
         migrations.RunPython(
             populate_data_sharing_consent,
```

### Comparing `edx-enterprise-3.9.9/consent/api/permissions.py` & `edx-enterprise-4.0.0/consent/api/permissions.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Permission classes for the Consent API.
 """
 
 from rest_framework import permissions
 
 from enterprise.utils import get_request_value
@@ -23,8 +22,8 @@
     indicated in the request body.
     """
 
     def has_permission(self, request, view):
         if request.user.is_staff:
             return True
 
-        return super(IsStaffOrUserInRequest, self).has_permission(request, view)
+        return super().has_permission(request, view)
```

### Comparing `edx-enterprise-3.9.9/consent/api/v1/views.py` & `edx-enterprise-4.0.0/consent/api/v1/views.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 A generic API for edX Enterprise's Consent application.
 """
 
 from logging import getLogger
 
 from edx_rest_framework_extensions.auth.jwt.authentication import JwtAuthentication
@@ -69,15 +68,15 @@
     permission_classes = (permissions.IsStaffOrUserInRequest,)
     authentication_classes = (JwtAuthentication, SessionAuthentication,)
     throttle_classes = (ServiceUserThrottle,)
 
     REQUIRED_PARAM_USERNAME = 'username'
     REQUIRED_PARAM_COURSE_ID = 'course_id'
     REQUIRED_PARAM_PROGRAM_UUID = 'program_uuid'
-    REQUIRED_PARAM_ENTERPRISE_CUSTOMER = 'enterprise_customer_uuid'  # pylint: disable=invalid-name
+    REQUIRED_PARAM_ENTERPRISE_CUSTOMER = 'enterprise_customer_uuid'
 
     CONSENT_EXISTS = 'exists'
     CONSENT_GRANTED = 'consent_provided'
     CONSENT_REQUIRED = 'consent_required'
 
     MISSING_REQUIRED_PARAMS_MSG = "Some required parameter(s) missing: {}"
```

### Comparing `edx-enterprise-3.9.9/consent/models.py` & `edx-enterprise-4.0.0/consent/models.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,35 +1,30 @@
-# -*- coding: utf-8 -*-
 """
 Models for edX Enterprise's Consent application.
 """
 
-import logging
 
-import six
-from opaque_keys import InvalidKeyError
-from opaque_keys.edx.keys import CourseKey
 from simple_history.models import HistoricalRecords
 
 from django.core.exceptions import ImproperlyConfigured
 from django.db import models
-from django.utils.encoding import python_2_unicode_compatible
 from django.utils.functional import lazy
 from django.utils.safestring import mark_safe
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from model_utils.models import TimeStampedModel
 
 from consent.errors import InvalidProxyConsent
 from consent.mixins import ConsentModelMixin
 from enterprise.api_client.discovery import get_course_catalog_api_service_client
+from enterprise.logging import getEnterpriseLogger
 from enterprise.models import EnterpriseCustomer
 
-mark_safe_lazy = lazy(mark_safe, six.text_type)  # pylint: disable=invalid-name
-LOGGER = logging.getLogger(__name__)
+mark_safe_lazy = lazy(mark_safe, str)
+LOGGER = getEnterpriseLogger(__name__)
 
 
 class DataSharingConsentQuerySet(models.query.QuerySet):
     """
     Customized QuerySets for the ``DataSharingConsent`` model.
 
     When searching for any ``DataSharingConsent`` object, if it doesn't exist, return a single
@@ -40,51 +35,44 @@
     def proxied_get(self, *args, **kwargs):
         """
         Perform the query and returns a single object matching the given keyword arguments.
 
         This customizes the queryset to return an instance of ``ProxyDataSharingConsent`` when
         the searched-for ``DataSharingConsent`` instance does not exist.
         """
-        # TODO: ENT-2010
         original_kwargs = kwargs.copy()
         if 'course_id' in kwargs:
             try:
-                # Check if we have a course ID or a course run ID
-                course_run_key = str(CourseKey.from_string(kwargs['course_id']))
-            except InvalidKeyError:
-                # The ID we have is for a course instead of a course run; fall through
-                # to the second check.
-                pass
-            else:
+                # Try to get the record for the course OR course run, depending on what we got in kwargs,
+                # course_id or course_run_id
+                return self.get(*args, **kwargs)
+            except DataSharingConsent.DoesNotExist:
+                # If here, either the record for course OR course run doesn't exist.
+                # Try one more time by modifying the query parameters to look for just a course record this time.
+                site = None
+                if 'enterprise_customer' in kwargs:
+                    site = kwargs['enterprise_customer'].site
+
                 try:
-                    # Try to get the record for the course run specifically
-                    return self.get(*args, **kwargs)
-                except DataSharingConsent.DoesNotExist:
-                    # A record for the course run didn't exist, so modify the query
-                    # parameters to look for just a course record on the second pass.
-
-                    site = None
-                    if 'enterprise_customer' in kwargs:
-                        site = kwargs['enterprise_customer'].site
-
-                    try:
-                        course_id = get_course_catalog_api_service_client(site=site).get_course_id(
-                            course_identifier=course_run_key
-                        )
-                        kwargs['course_id'] = course_id
-                    except ImproperlyConfigured:
-                        LOGGER.warning('CourseCatalogApiServiceClient is improperly configured.')
+                    course_id = get_course_catalog_api_service_client(site=site).get_course_id(
+                        course_identifier=kwargs['course_id']
+                    )
+                    kwargs['course_id'] = course_id
+                except ImproperlyConfigured:
+                    LOGGER.warning('CourseCatalogApiServiceClient is improperly configured.')
 
         try:
+            # Try to get the record of course
             return self.get(*args, **kwargs)
         except DataSharingConsent.DoesNotExist:
+            # If here, the record doesn't exist for course AND course run, so return a proxy record instead.
             return ProxyDataSharingConsent(**original_kwargs)
 
 
-class DataSharingConsentManager(models.Manager.from_queryset(DataSharingConsentQuerySet)):  # pylint: disable=no-member
+class DataSharingConsentManager(models.Manager.from_queryset(DataSharingConsentQuerySet)):
     """
     Model manager for :class:`.DataSharingConsent` model.
 
     Uses a QuerySet that returns a ``ProxyDataSharingConsent`` object when the searched-for
     ``DataSharingConsent`` object does not exist. Otherwise behaves the same as a normal manager.
     """
 
@@ -115,21 +103,21 @@
             child_consents=None,
             **kwargs
     ):
         """
         Initialize a proxy version of ``DataSharingConsent`` which behaves similarly but does not exist in the DB.
         """
         ec_keys = {}
-        for key in kwargs:
+        for key, value in kwargs.items():
             if str(key).startswith('enterprise_customer__'):
                 enterprise_customer_detail = key[len('enterprise_customer__'):]
-                ec_keys[enterprise_customer_detail] = kwargs[key]
+                ec_keys[enterprise_customer_detail] = value
 
         if ec_keys:
-            enterprise_customer = EnterpriseCustomer.objects.get(**ec_keys)  # pylint: disable=no-member
+            enterprise_customer = EnterpriseCustomer.objects.get(**ec_keys)
 
         self.enterprise_customer = enterprise_customer
         self.username = username
         self.course_id = course_id
         self.program_uuid = program_uuid
         self.granted = granted
         self._exists = exists
@@ -138,18 +126,18 @@
     @classmethod
     def from_children(cls, program_uuid, *children):
         """
         Build a ProxyDataSharingConsent using the details of the received consent records.
         """
         if not children or any(child is None for child in children):
             return None
-        granted = all((child.granted for child in children))
-        exists = any((child.exists for child in children))
-        usernames = set(child.username for child in children)
-        enterprises = set(child.enterprise_customer for child in children)
+        granted = all(child.granted for child in children)
+        exists = any(child.exists for child in children)
+        usernames = {child.username for child in children}
+        enterprises = {child.enterprise_customer for child in children}
         if not len(usernames) == len(enterprises) == 1:
             raise InvalidProxyConsent(
                 'Children used to create a bulk proxy consent object must '
                 'share a single common username and EnterpriseCustomer.'
             )
         username = children[0].username
         enterprise_customer = children[0].enterprise_customer
@@ -184,15 +172,15 @@
             defaults={
                 'granted': self.granted
             }
         )
         self._exists = consent.exists
         return consent
 
-    def save(self, *args, **kwargs):  # pylint: disable=unused-argument
+    def save(self, *args, **kwargs):
         """
         Synonym function for ``commit``.
         """
         return self.commit()
 
 
 class Consent(TimeStampedModel):
@@ -217,25 +205,25 @@
     )
     username = models.CharField(
         max_length=255,
         blank=False,
         null=False,
         help_text=_("Name of the user whose consent state is stored.")
     )
-    granted = models.NullBooleanField(help_text=_("Whether consent is granted."))
+    granted = models.BooleanField(null=True, help_text=_("Whether consent is granted."))
 
     @property
     def _exists(self):
         """
         Return whether the instance exists or not.
         """
         return bool(self.pk)
 
 
-class DataSharingConsent(ConsentModelMixin, Consent):  # pylint: disable=model-no-explicit-unicode
+class DataSharingConsent(ConsentModelMixin, Consent):
     """
     An abstract representation of Data Sharing Consent granted to an Enterprise for a course by a User.
 
     The model is used to store a persistent, historical consent state for users granting, not granting, or revoking
     data sharing consent to an Enterprise for a course.
 
     .. pii: The username field inherited from Consent contains PII.
@@ -259,15 +247,14 @@
         max_length=255,
         blank=False,
         help_text=_("Course key for which data sharing consent is granted.")
     )
     history = HistoricalRecords()
 
 
-@python_2_unicode_compatible
 class DataSharingConsentTextOverrides(TimeStampedModel):
     """
     Stores texts overrides for data sharing consent page.
 
     .. no_pii:
     """
```

### Comparing `edx-enterprise-3.9.9/consent/mixins.py` & `edx-enterprise-4.0.0/consent/mixins.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,19 +1,20 @@
-# -*- coding: utf-8 -*-
 """
 Mixins for edX Enterprise's Consent application.
 """
+import logging
 
-from django.contrib.auth.models import User
-from django.utils.encoding import python_2_unicode_compatible
+from django.contrib import auth
 
 from enterprise.models import EnterpriseCourseEnrollment
 
+LOGGER = logging.getLogger(__name__)
+User = auth.get_user_model()
+
 
-@python_2_unicode_compatible
 class ConsentModelMixin:
     """
     A mixin for Data Sharing Consent classes that require common, reusable functionality.
     """
 
     def __str__(self):
         """
@@ -33,24 +34,36 @@
 
     def consent_required(self):
         """
         Return a boolean value indicating whether a consent action must be taken.
         """
         children = getattr(self, '_child_consents', [])
         if children:
-            return any((child.consent_required() for child in children))
+            return any(child.consent_required() for child in children)
 
         if self.granted:
             return False
 
-        return bool(
+        required = bool(
             (self.enterprise_customer.enforces_data_sharing_consent('at_enrollment')) and
             (self.enterprise_customer.catalog_contains_course(self.course_id))
         )
 
+        if not required and self.enterprise_customer.enforces_data_sharing_consent('at_enrollment'):
+            LOGGER.info(
+                '[ENTERPRISE DSC] Consent not required becuase catalog does not contain course. '
+                'Course: [%s], Username: [%s], Enterprise: [%s], Exists: [%s]',
+                self.course_id,
+                self.username,
+                self.enterprise_customer.uuid,
+                self.exists,
+            )
+
+        return required
+
     @property
     def enterprise_enrollment_exists(self):
         """
         Determine whether there exists an EnterpriseCourseEnrollment related to this consent record.
         """
         if self.course_id:
             try:
```

### Comparing `edx-enterprise-3.9.9/consent/__init__.py` & `edx-enterprise-4.0.0/consent/__init__.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """edX Enterprise's Consent application.
 
 The consent application provides an API that enables the platform to prompt
 the user to consent to share data about their activity and performance in
 (a) particular course(s) with the enterprise customer that is (usually) subsidizing
 their enrollment in those courses. When users grant consent to share data, that
 agreement is recorded in the database in an easily auditable way.
@@ -10,8 +9,8 @@
 The goals of the Consent API is that it can be used to provide consent at any type
 of gate that an enterprise stands at.
 
 """
 
 __version__ = "0.1.0"
 
-default_app_config = "consent.apps.ConsentConfig"  # pylint: disable=invalid-name
+default_app_config = "consent.apps.ConsentConfig"
```

### Comparing `edx-enterprise-3.9.9/consent/helpers.py` & `edx-enterprise-4.0.0/consent/helpers.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Helper functions for the Consent application.
 """
 
 from django.apps import apps
 
 from consent.models import ProxyDataSharingConsent
@@ -16,15 +15,15 @@
 
     :param username: The user that grants consent
     :param enterprise_customer_uuid: The consent requester
     :param course_id (optional): A course ID to which consent may be related
     :param program_uuid (optional): A program to which consent may be related
     :return: The data sharing consent object, or None if the enterprise customer for the given UUID does not exist.
     """
-    EnterpriseCustomer = apps.get_model('enterprise', 'EnterpriseCustomer')  # pylint: disable=invalid-name
+    EnterpriseCustomer = apps.get_model('enterprise', 'EnterpriseCustomer')
     try:
         if course_id:
             return get_course_data_sharing_consent(username, course_id, enterprise_customer_uuid)
         return get_program_data_sharing_consent(username, program_uuid, enterprise_customer_uuid)
     except EnterpriseCustomer.DoesNotExist:
         return None
 
@@ -35,15 +34,15 @@
 
     :param username: The user that grants consent.
     :param course_id: The course for which consent is granted.
     :param enterprise_customer_uuid: The consent requester.
     :return: The data sharing consent object
     """
     # Prevent circular imports.
-    DataSharingConsent = apps.get_model('consent', 'DataSharingConsent')  # pylint: disable=invalid-name
+    DataSharingConsent = apps.get_model('consent', 'DataSharingConsent')
     return DataSharingConsent.objects.proxied_get(
         username=username,
         course_id=course_id,
         enterprise_customer__uuid=enterprise_customer_uuid
     )
```

### Comparing `edx-enterprise-3.9.9/consent/errors.py` & `edx-enterprise-4.0.0/consent/errors.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Errors thrown by the APIs in the Consent application.
 """
 
 
 class ConsentAPIRequestError(Exception):
     """There was a problem with a request to the Consent application's APIs."""
```

### Comparing `edx-enterprise-3.9.9/consent/admin/__init__.py` & `edx-enterprise-4.0.0/consent/admin/__init__.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,20 +1,19 @@
-# -*- coding: utf-8 -*-
 """
 Django admin integration for the Consent application.
 """
 
 from django_object_actions import DjangoObjectActions
 from simple_history.admin import SimpleHistoryAdmin
 
 from django.contrib import admin
 from django.http import HttpResponseRedirect
 from django.urls import reverse
 from django.utils.http import urlencode
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
 from consent.models import DataSharingConsent, DataSharingConsentTextOverrides
 
 
 @admin.register(DataSharingConsent)
 class DataSharingConsentAdmin(SimpleHistoryAdmin):
     """
@@ -91,21 +90,21 @@
             'next': '/admin',
             'failure_url': '/admin',
             'enterprise_customer_uuid': consent_page.enterprise_customer.uuid
         }
         url = reverse('grant_data_sharing_permissions') + '?{}'.format(urlencode(params))
         return HttpResponseRedirect(url)
 
-    def preview_as_course(self, request, consent_page):  # pylint: disable=unused-argument
+    def preview_as_course(self, request, consent_page):
         """
         Renders data sharing consent page in course context
         """
         return self.preview(consent_page, course_id='course-v1:edX+TestX+Test_Course')
 
-    def preview_as_program(self, request, consent_page):  # pylint: disable=unused-argument
+    def preview_as_program(self, request, consent_page):
         """
         Renders data sharing consent page in program context
         """
         return self.preview(consent_page, program_uuid='25c10a26-0b00-0000-bd06-7813546c29eb')
 
     preview_as_course.label = _("Preview (course)")
     preview_as_course.short_description = _(
```

### Comparing `edx-enterprise-3.9.9/edx_enterprise.egg-info/PKG-INFO` & `edx-enterprise-4.0.0/edx_enterprise.egg-info/PKG-INFO`

 * *Files 23% similar despite different names*

```diff
@@ -1,40 +1,36 @@
 Metadata-Version: 1.1
 Name: edx-enterprise
-Version: 3.9.9
+Version: 4.0.0
 Summary: Your project description goes here
-Home-page: https://github.com/edx/edx-enterprise
+Home-page: https://github.com/openedx/edx-enterprise
 Author: edX
 Author-email: oscm@edx.org
 License: AGPL 3.0
 Description: enterprise
         ==========
         
         .. image:: https://img.shields.io/pypi/v/edx-enterprise.svg
             :target: https://pypi.python.org/pypi/edx-enterprise/
             :alt: PyPI
         
-        .. image:: https://travis-ci.org/edx/edx-enterprise.svg?branch=master
-            :target: https://travis-ci.org/edx/edx-enterprise
-            :alt: Travis
-        
         .. image:: http://codecov.io/github/edx/edx-enterprise/coverage.svg?branch=master
             :target: http://codecov.io/github/edx/edx-enterprise?branch=master
             :alt: Codecov
         
         .. image:: https://readthedocs.org/projects/open-edx-enterprise-service-documentation/badge/?version=latest
             :target: http://open-edx-enterprise-service-documentation.readthedocs.io/en/latest/
             :alt: Documentation
         
         .. image:: https://img.shields.io/pypi/pyversions/edx-enterprise.svg
             :target: https://pypi.python.org/pypi/edx-enterprise/
             :alt: Supported Python versions
         
         .. image:: https://img.shields.io/github/license/edx/edx-enterprise.svg
-            :target: https://github.com/edx/edx-enterprise/blob/master/LICENSE.txt
+            :target: https://github.com/openedx/edx-enterprise/blob/master/LICENSE.txt
             :alt: License
         
         The ``Open edx Enterprise Service`` app provides enterprise features to the Open
         edX platform.  The majority of these features are structured around the concept
         of an ``Enterprise Customer``, which is an organization or a group of people
         that "consumes" courses published on the Open edX platform.
         
@@ -52,24 +48,21 @@
         Please see ``LICENSE.txt`` for details.
         
         How To Contribute
         -----------------
         
         Contributions are very welcome.
         
-        Please read `How To Contribute <https://github.com/edx/edx-platform/blob/master/CONTRIBUTING.rst>`_ for details.
-        
-        Even though they were written with ``edx-platform`` in mind, the guidelines
-        should be followed for Open edX code in general.
+        Please read `How To Contribute <https://github.com/openedx/.github/blob/master/CONTRIBUTING.md>`_ for details.
         
         A Pull Request Description Template can be found at`PULL_REQUEST_TEMPLATE.md`_ - this
         template is automatically applied when you open a pull request from GitHub.  Please
         make sure to include this template if submitting a pull request via other channels.
         
-        .. _PULL_REQUEST_TEMPLATE.md: https://github.com/edx/edx-enterprise/blob/master/.github/PULL_REQUEST_TEMPLATE_TEMPLATE.md
+        .. _PULL_REQUEST_TEMPLATE.md: https://github.com/openedx/edx-enterprise/blob/master/.github/PULL_REQUEST_TEMPLATE_TEMPLATE.md
         
         After submitting a pull request, please use the Github "Reviewers" widget to add
         relevant reviewers and track review process.
         
         Reporting Security Issues
         -------------------------
         
@@ -77,15 +70,15 @@
         
         Getting Help
         ------------
         
         Have a question about this repository, or about Open edX in general?  Please
         refer to this `list of resources`_ if you need any assistance.
         
-        .. _list of resources: https://open.edx.org/getting-help
+        .. _list of resources: https://openedx.org/getting-help
         
         
         Change Log
         ==========
         
         ..
            All enhancements and patches to edx-enterprise will be documented
@@ -96,15 +89,2154 @@
            the package is published.
         
            This project adheres to Semantic Versioning (http://semver.org/).
         
         .. There should always be an "Unreleased" section for changes pending release.
         
         Unreleased
-        -----------
+        ----------
+        [3.69.1]
+        --------
+        fix: content metadata exporter sanitizing content to delete
+        
+        [3.69.0]
+        --------
+        refactor: Replaced the deprecated `NullBooleanField` with `BooleanField(null=True)`
+        
+        [3.68.1]
+        --------
+        fix: pick first object from CourseDetails
+        
+        [3.68.0]
+        --------
+        feat: add more metadata into `EnterpriseCourseEnrollmentView`
+        
+        [3.67.7]
+        --------
+        feat: marking orphaned content audits when catalogs are deleted
+        
+        [3.67.6]
+        --------
+        chore: fixing doc string linter errors
+        
+        [3.67.5]
+        --------
+        chore: better formatting of the enterprise api views
+        
+        [3.67.4]
+        --------
+        feat: add button to update customer modified time
+        
+        [3.67.3]
+        --------
+        feat: adding managent command to clear error state
+        
+        [3.67.2]
+        --------
+        fix: fixing name of table used by model fetching method
+        
+        [3.67.1]
+        --------
+        chore: more orphaned content transmission logging
+        
+        [4.0.0]
+        -------
+        feat!: upgraded to Node v18, added .nvmrc and updated workflows.
+        
+        [3.67.0]
+        --------
+        fix: compare lowered input email address to lowered auth user record email address during bulk enrollment.
+        
+        [3.66.8]
+        --------
+        fix: optional x-request-id logging
+        
+        [3.66.7]
+        --------
+        feat: optional x-request-id logging
+        
+        [3.66.6]
+        --------
+        * feat: increase the throttle limit of service users for EnterpriseCustomerViewSet
+        * Switch from ``edx-sphinx-theme`` to ``sphinx-book-theme`` since the former is
+          deprecated
+        
+        [3.66.5]
+        --------
+        chore: set default expiration_date for EnterpriseCustomerInviteKey
+        
+        [3.66.4]
+        --------
+        feat: add more logging in the bulk enrollment flow
+        
+        [3.66.3]
+        --------
+        fix: prevent org_id param addition to exec-ed course home url when auth_org_id is not present
+        
+        [3.66.2]
+        --------
+        chore: unique constraint on transmission audits to prevent duplicates
+        
+        [3.66.1]
+        --------
+        fix: Fixed url encoding issue with org_id in executive education course url
+        
+        [3.66.0]
+        --------
+        feat: Added org_id for executive education courses landing page
+        
+        [3.65.4]
+        --------
+        fix: swapping enterprise unenrolled bool to timestamp and minor code cleanup
+        
+        [3.65.2]
+        --------
+        feat: extending the enterprise fulfillment api serializer to contain more info
+        
+        [3.65.1]
+        --------
+        fix: making sure unenrollment is saved while revoking fulfillment
+        
+        [3.65.0]
+        --------
+        feat: new enterprise endpoint to surface filterable unenrolled subsidized enrollments
+        
+        [3.64.1]
+        --------
+        fix: Reverted course_run_url for Executive Education courses
+        
+        [3.64.0]
+        --------
+        feat: Updated course_run_url for Executive Education courses
+        
+        [3.63.0]
+        --------
+        feat: Hooking enterprise enrollments up to platform signals to write unenrollment records.
+              New field `unenrolled` on enterprise enrollments to track enrollment status, defaults to `None`.
+        
+        [3.62.7]
+        --------
+        feat: include obsolete attribute in degreed content transmissions
+        
+        [3.62.6]
+        --------
+        chore: adding better logging to the remove dup audit management command
+        
+        [3.62.5]
+        --------
+        feat: include auth_org_id in enterprise customer api
+        
+        [3.62.4]
+        --------
+        fix: duplicate records reading queryset length then splicing
+        
+        [3.62.3]
+        --------
+        feat: Add idempotent catalog creation endpoint
+        
+        [3.62.2]
+        --------
+        fix: management command fix- reading queryset length in a mysql supported way
+        
+        [3.62.1]
+        --------
+        feat: new management command to remove duplicate transmission audits
+        
+        [3.62.0]
+        --------
+        feat: Add 'auth_org_id' field to EnterpriseCustomer for Auth0 integration
+        
+        [3.61.16]
+        ---------
+        feat: Q filtering to enterprise customer basic list
+        
+        [3.61.15]
+        ---------
+        feat: Add customer catalog write only viewset
+        
+        [3.61.14]
+        ---------
+        fix: Integrated channels metadata exporter now considers failed update audits as existing records
+        
+        [3.61.13]
+        ---------
+        feat: expands pagination page size from enterprise catalog query view
+        
+        [3.61.12]
+        ---------
+        chore: remove codecov from requirements as it removed from PyPi and is breaking CI when trying to install the package. Pinned ``pip-tools`` and ``tox`` in ``common_constraints.txt`` due to dependency resolution issues with ``click`` and ``filelock``.
+        
+        [3.61.11]
+        ---------
+        feat: include owners and longer descriptions for degreed2 content metadata transmissions
+        
+        [3.61.10]
+        ---------
+        feat: new tagging orphaned content tast for integrated channels
+        
+        [3.61.9]
+        --------
+        feat: Serialize and create a viewset for enterpriseCatalogQuery as readonly
+        
+        [3.61.8]
+        --------
+        feat: added enterprise fulfillment viewset
+        
+        [3.61.7]
+        --------
+        feat: surfacing subsized enrollment uuid value in the bulk enrollment endpoint
+        
+        [3.61.6]
+        --------
+        feat: Add user_id support to enroll_learners_in_courses endpoint
+        
+        [3.61.5]
+        --------
+        fix: Ensure `EnterpriseCustomerBrandingConfigurationSerializer` returns correct logo URL on stage/production after `settings.DEFAULT_FILE_STORAGE` changed to use `storages.backends.s3boto3.S3Boto3Storage` instead of `storages.backends.s3boto.S3BotoStorage`.
+        
+        [3.61.4]
+        --------
+        fix: impoved admin screen for system wide enterprise role assignments
+        
+        [3.61.3]
+        --------
+        chore: cleanup squashed migration files
+        
+        [3.61.2]
+        --------
+        fix: migrating uuid and updating column constraints
+        
+        [3.61.1]
+        --------
+        fix: allowing for uuid column migration to be non-unique
+        
+        [3.61.0]
+        --------
+        feat: enterprise entitlements and subsidy based fulfillment models heirarchy rework
+        
+        [3.60.21]
+        ---------
+        feat: django admin bulk action to clear remote_deleted_at on ContentMetadataItemTransmission records
+        
+        [3.60.20]
+        ---------
+        fix: changing api client to parse grades api response body
+        
+        [3.60.19]
+        ---------
+        fix: applied validatoins on report delivery_method
+        
+        [3.60.18]
+        ---------
+        fix: checking for response attr in http exception handling
+        
+        [3.60.17]
+        ---------
+        fix: making backend generated fields read only on django admin
+        
+        [3.60.16]
+        ---------
+        fix: adding backoff and retry logic to the grades api client
+        
+        [3.60.15]
+        ---------
+        feat: allowing manage learners form enroll learners using exec ed modes
+        
+        [3.60.14]
+        ---------
+        feat: adding exec ed course mode to enterprise
+        
+        [3.60.13]
+        ---------
+        fix: handle file compression check and test
+        
+        [3.60.12]
+        ---------
+        feat: adding last modified timestamp to single LMS config endpoints
+        
+        [3.60.11]
+        ---------
+        fix: integrations log TypeErrors
+        
+        [3.60.10]
+        ---------
+        fix: making moodle client return value match other channels
+        
+        [3.60.9]
+        --------
+        fix: memoize synced_at datimes on config record
+        
+        [3.60.8]
+        --------
+        fix: failed content deletes and creates are never retried
+        
+        [3.60.7]
+        --------
+        fix: cleaning up serializer field inheritance
+        
+        [3.60.6]
+        --------
+        fix: password is required when pgp key is provided
+        
+        [3.60.5]
+        --------
+        fix: adding an index for performance, non-blocking syntax
+        
+        [3.60.4]
+        --------
+        fix: add back squashed migrations (fixes devstack provisioning)
+        
+        [3.60.3]
+        --------
+        feat: exec ed content is tagged and distinguishable from edx content
+        
+        [3.60.2]
+        --------
+        fix: sorting error reporting audits by all datetimes at once instead of three separate order bys
+        
+        [3.60.1]
+        --------
+        fix: adding an index for performance, testing syntax for no-lock
+        
+        [3.60.0]
+        --------
+        build: write an updated pylintrc and quiet a noisy logging statement
+        
+        [3.59.2]
+        --------
+        chore: allowing for page size specification in error reporting api
+        
+        [3.59.1]
+        --------
+        fix: cleaning up integrated channels inheritance column types
+        
+        [3.59.0]
+        --------
+        refactor: Removed unused code related to tableau.
+        
+        [3.58.18]
+        ---------
+        fix: internal service error fix for enterprise branding
+        
+        [3.58.17]
+        ---------
+        fix: fixed a bug that didn't allow admins to create an account or update password
+        
+        [3.58.16]
+        ---------
+        fix: fix bug that didn't allow admins to customize branding
+        
+        [3.58.15]
+        ---------
+        fix: catch update transmissions that failed and need to be resent
+        
+        [3.58.14]
+        ---------
+        feat: Add health check for canvas integrated channels
+        
+        [3.58.13]
+        ---------
+        feat: Add in learner and content sync time records to integrated channel configs
+        
+        [3.58.12]
+        ---------
+        fix: make integrated channels api response record field readonly in admin view
+        
+        [3.58.11]
+        ---------
+        fix: Added model field validation for pgp_encryption_key
+        
+        [3.58.10]
+        ---------
+        refactor: update enterprise manual reporting to make it generic
+        
+        [3.58.9]
+        --------
+        fix: Added validation for PGP encryption key entered by the user.
+        
+        [3.58.8]
+        --------
+        feat: integration sync reporting viewset improvements
+        
+        [3.58.7]
+        --------
+        feat: populate freindly_status_message in content and learner metadata api
+        
+        [3.58.6]
+        --------
+        chore: smarter canvas client update course behavior (course deleted)
+        
+        [3.58.5]
+        --------
+        feat: integrated channels customer configs soft delete support
+        
+        [3.58.4]
+        --------
+        chore: fixing api view that included unneeded values
+        
+        [3.58.3]
+        --------
+        feat: transmission audit admin view and api improvements
+        
+        [3.58.2]
+        --------
+        fix: integrated channels not picking up courses to update
+        
+        [3.58.1]
+        --------
+        feat: adding new variables to the learner transmission audit model
+        
+        [3.58.0]
+        --------
+        feat: Add a new endpoint to generate a signed token for plotly analytics.
+        
+        [3.57.3]
+        --------
+        feat: remove debug logging used to investigate missing CSOD deletes
+        
+        [3.57.2]
+        --------
+        feat: Added POST support for catalog query preview
+        
+        [3.57.1]
+        --------
+        fix: impoving transmission records by moving response body to new table
+        
+        [3.57.0]
+        ---------
+        * feat: adds an EnterpriseCatalogQuery.include_exec_ed_2u_courses field.
+          When True for an EnterpriseCatalogQuery record, this field indicates that
+          course content with type ``executive-education-2u`` should not be excluded from being associated with that record.
+          See related enterprise-catalog PR, which includes an ADR: https://github.com/openedx/enterprise-catalog/pull/507
+        
+        [3.56.16]
+        ---------
+        feat: integration sync status self service endpoints
+        
+        [3.56.15]
+        ---------
+        feat: tagging exported content records for transmission
+        
+        [3.56.14]
+        ---------
+        chore: add plugin_configuration_id to standard integration logging
+        
+        [3.56.13]
+        ---------
+        chore: smarter canvas client update course behavior
+        
+        [3.56.12]
+        ---------
+        chore: adding http status response code to content record django admin table
+        
+        [3.56.11]
+        ---------
+        chore: cleaning up Canvas client url construction
+        
+        [3.56.10]
+        ---------
+        fix: adhering to urljoin patterns in integrated channels API views
+        
+        [3.56.9]
+        --------
+        fix: properly truncate payload to resolve missing CSOD deletes
+        
+        [3.56.8]
+        --------
+        feat: add debug logging to investigate missing CSOD deletes
+        
+        [3.56.7]
+        --------
+        feat: add debug logging to investigate missing CSOD deletes
+        
+        [3.56.6]
+        --------
+        feat: expand utility of CSOD deleted_at reset job
+        
+        [3.56.5]
+        --------
+        fix: properly pass SAP client status back to content transmission records
+        
+        [3.56.4]
+        --------
+        fix: open redirect url whitelisting for data sharing conseent and change enterprise page
+        
+        [3.56.3]
+        --------
+        fix: replace id with uuid in branding logo file path
+        
+        [3.56.2]
+        --------
+        fix: refactor the way we send cornerstone content metadata deletes
+        
+        [3.56.1]
+        --------
+        fix: accounting for integrated Canvas instances that have no root account Ids.
+        
+        [3.56.0]
+        --------
+        feat: refactor content metadata jobs to save api call status
+        
+        [3.55.3]
+        --------
+        fix: accurately selecting content key values when filtering for existing content metadata transmission audits.
+        
+        [3.55.2]
+        --------
+        fix: integrated channels properly handling customers with multiple catalogs that have overlapping content.
+        
+        [3.55.1]
+        --------
+        fix: properly removing update transmission payloads from SAP transmissions before saving completed records.
+        
+        [3.55.0]
+        --------
+        feat: add `enable_executive_education_2U_fulfillment` to `EnterpriseCustomer`
+        
+        [3.54.2]
+        --------
+        fix: follow-on to cornerstone learner records foreign keys job
+        
+        [3.54.1]
+        --------
+        fix: create cornerstone learner audit records with new foreign keys
+        
+        [3.54.0]
+        --------
+        feat: Remove progress, progress_v2 option from reporting configs and move all v1, v2 to v3.
+        
+        [3.53.4]
+        --------
+        fix: update course run selection logic for SAP content exporter
+        
+        [3.53.3]
+        --------
+        feat: mark Cornerstone session token fields read-only in admin
+        
+        [3.53.2]
+        --------
+        feat: update data sharing consent request language
+        
+        [3.53.1]
+        --------
+        feat: Django Admin tweaks for integrations
+        
+        [3.53.0]
+        --------
+        feat: Added management command for weekly nudge to dormant enterprise learners
+        
+        [3.52.0]
+        --------
+        feat: add `enable_portal_learner_credit_management_screen` to `EnterpriseCustomer`
+        
+        [3.51.1]
+        --------
+        feat: basic integrated channels task concurrency control
+        
+        [3.51.0]
+        --------
+        feat: Added command for monthly impact report for enterprise administrators
+        
+        [3.50.0]
+        --------
+        feat: add `enable_learner_portal_offers` to `EnterpriseCustomer`
+        
+        [3.49.10]
+        ---------
+        fix: append backslash to ecommerce url and change `get` to `get_or_create` in `fulfill_pending_course_enrollments`
+        
+        [3.49.9]
+        --------
+        feat: add source query param in data sharing consent url
+        
+        [3.49.8]
+        --------
+        chore: add logs for dsc
+        
+        [3.49.7]
+        --------
+        fix: parsing improvements to incorrect learner completion completed-at dates
+        
+        [3.49.6]
+        --------
+        fix: incorrect learner completion completed-at dates
+        
+        [3.49.5]
+        --------
+        feat: add lms_user_id to serialized admin users
+        
+        [3.49.4]
+        --------
+        feat: add dry-run mode to integrated channels
+        
+        [3.49.3]
+        --------
+        fix: don't transmit schedule data to SAP if start or end date is empty
+        
+        [3.49.2]
+        --------
+        feat: improved channel logging
+        
+        [3.49.1]
+        --------
+        fix: add stricter validation on system wide role assignments
+        
+        [3.49.0]
+        --------
+        fix: Return None for context if a ``SystemWideEnterpriseUserRoleAssignment`` has no enterprise_customer and does not apply to all contexts.
+             We'll no longer fall back on granting context based on enterprise membership when there is no explicit context.
+        
+        [3.48.0]
+        --------
+        chore: add migration to remove is_active from role assignment model schema
+        
+        [3.47.2]
+        --------
+        chore: remove is_active field from role assignment model
+        
+        [3.47.1]
+        --------
+        chore: remove data-cleaning management commands. prepare for column-removal migration
+        
+        [3.47.0]
+        --------
+        temp: adding system wide role assignment field and management commands to clean data
+        
+        [3.46.6]
+        --------
+        fix: correctly handle multiple canvas and blackboard oauth configs
+        
+        [3.46.5]
+        --------
+        fix: degreed2 improperly tracking completion status
+        
+        [3.46.4]
+        --------
+        fix: Degreed2 estimated time to complete in hours
+        
+        [3.46.3]
+        --------
+        fix: update logic for parsing course price for SAP
+        
+        [3.46.2]
+        --------
+        fix: Degreed2 estimated time to complete in days
+        
+        [3.46.1]
+        --------
+        feat: admin view improvements
+        
+        [3.46.0]
+        --------
+        fix: modify signature of EmbargoApiClient.redirect_if_blocked
+        Make this signature match and use the same signature that
+        ``openedx.core.djangoapps.embargo.api.redirect_if_blocked()`` now uses.
+        
+        [3.44.4]
+        --------
+        fix: implement back-off and retry for degreed2
+        fix: drop tpa_hint param in redirects when no SSO
+        
+        [3.44.3]
+        --------
+        fix: Undoes revert of 3.44.0, while also ensuring that
+        ``SystemWideEnterpriseUserRoleAssignment.get_assignments()`` can handle and respect any null values returned
+        from ``get_context()``.
+        
+        [3.44.2]
+        --------
+        - feat: configure django admin for degreed2 audit records
+        - fix: Moodle client should accept treat duplicate course id on create as a success
+        
+        [3.44.1]
+        --------
+        fix: no-op version bump (skipping 3.44.0) to account for a revert:
+        https://github.com/openedx/edx-enterprise/pull/1534
+        
+        [3.44.0]
+        --------
+        fix: [REVERTED] override get_assignments() so that active enterprise uuids come first.
+        
+        Overrides the SystemWideEnterpriseUserRoleAssignment.get_assignments() method to return
+        a list of (role, context) assignments, where the first item in the list corresponds
+        to the currently active enterprise for the user.
+        
+        [3.43.1]
+        ---------
+        chore: replace enterprise customer drop-downs in django admin
+        
+        [3.43.0]
+        ---------
+        feat: allow admins to remove learners from org
+        
+        [3.42.5]
+        ---------
+        fix: improve guards on fk data backfill job
+        
+        [3.42.4]
+        ---------
+        feat: updated logic for completions in integrated channels
+        
+        [3.42.3]
+        ---------
+        feat: additional fk data backfill performance improvements
+        
+        [3.42.2]
+        ---------
+        feat: speed up fk data backfill
+        
+        [3.42.1]
+        ---------
+        feat: use new foreign keys on integrated channels audit models
+        
+        [3.42.0]
+        ---------
+        feat: add admin_users to ``EnterpriseCustomerSerializer``
+        
+        [3.41.13]
+        ---------
+        fix: remove backfill managment command arguments
+        
+        [3.41.12]
+        ---------
+        fix: Use enterprise customer uuid coming in request data
+        
+        [3.41.11]
+        ---------
+        fix: Add unique_together constraint in SystemWideEnterpriseUserRoleAssignment
+        
+        [3.41.10]
+        ---------
+        fix: Add management command to backfill missing audit record foreign keys.
+        
+        [3.41.9]
+        ---------
+        fix: Squash SAP Success Factors migrations to remove reference to ``PositiveIntegerField``.
+        
+        [3.41.8]
+        ---------
+        fix: Alter `enterprise_course_enrollment_id` field from `PositiveIntegerField` to `IntegerField` in `BlackboardLearnerAssessmentDataTransmissionAudit` and `SapSuccessFactorsLearnerDataTransmissionAudit`. This change
+        require to run migrations on mysql8.
+        
+        [3.41.7]
+        ---------
+        fix: add foreign keys to integrated channels audit models
+        
+        [3.41.6]
+        ---------
+        fix: making making degreed token base url optional
+        
+        [3.41.5]
+        ---------
+        feat: add missing logging for grades api results in integrated channels exporter
+        
+        [3.41.4]
+        ---------
+        feat: added html pages for oauth authorization success/failure
+        
+        [3.41.3]
+        ---------
+        fix: allow null completed_timestamp field for integrated channels learner audit models
+        
+        [3.41.2]
+        ---------
+        feat: setting customer identity provider config is_valid on first SSO login
+        
+        [3.41.0]
+        ---------
+        feat: Allow partial_update on `EnterpriseCustomerViewSet`
+        
+        [3.40.16]
+        ---------
+        fix: CSOD Learner Audit Django Admin Timeouts
+        
+        [3.40.15]
+        ---------
+        fix: Use correct completions URL for Degreed2
+        
+        [3.40.14]
+        ---------
+        fix: CornerstoneLearnerDataTransmissionAudit admin view timeout
+        
+        [3.40.13]
+        ---------
+        fix: Degreed2 Missing Learner Data Audit Records
+        
+        [3.40.12]
+        ---------
+        fix: Degreed2 Missing Learner Data Audit Records
+        
+        [3.40.11]
+        ---------
+        feat: New integrated channels Blackboard api endpoint to fetch global config creds
+        
+        [3.40.10]
+        ---------
+        feat: Add drafting functionality to save incorrect fields
+        
+        
+        [3.40.9]
+        ---------
+        feat: new integrated channels customer configs list view, new integrated channels config serializer `is_valid` field
+        
+        [3.40.8]
+        ---------
+        feat: add enable_browse_and_request field to `EnterpriseCustomer`
+        
+        [3.40.7]
+        ---------
+        fix: Broken Canvas oauth authorization url
+        
+        [3.40.6]
+        ---------
+        feat: SAPSF content metadata transmission now also sends course schedule
+        
+        [3.40.5]
+        ---------
+        feat: adding CornerstoneLearnerDataTransmissionAudit admin view
+        feat: log if-modified-since + content metadata for CSOD
+        
+        [3.40.4]
+        ---------
+        feat: support filtering by a list of user ids for `EnterpriseCustomerUserViewSet`
+        
+        [3.40.3]
+        ---------
+        feat: show field show_course_price in SAPSF Django admin form
+        
+        [3.40.2]
+        ---------
+        feat: override chunk size default to match channel capability
+        
+        [3.40.1]
+        ---------
+        chore: squash migrations for blackboard and sap_success_factor apps.
+        
+        [3.40.0]
+        ---------
+        fix: Alter `enterprise_course_enrollment_id` field from `PositiveIntegerField` to `IntegerField` in `BlackboardLearnerAssessmentDataTransmissionAudit` and `SapSuccessFactorsLearnerDataTransmissionAudit`. This change
+        require to run migrations on mysql8.
+        
+        [3.39.1]
+        ---------
+        fix: switching blackboard integrated channels from client based auth credentials to global creds
+        
+        [3.39.0]
+        ---------
+        fix: ensure `active` field on EnterpriseCustomerUser objects are set to `False` appropriately
+        feat: add management command to clean up `active` fields on EnterpriseCustomerUser objects
+        
+        [3.38.7]
+        ---------
+        feat: customer configs draft saving that makes all variables optional
+        feat: feat: Add field for Display name for LMS configs
+        
+        [3.39.0]
+        chore: dropped Django22, 30 and 31 support
+        
+        [3.38.6]
+        ---------
+        feat: add created to enterprise course enrollment serializer fields
+        
+        [3.38.5]
+        ---------
+        fix: update link_learners action to respond with error when payload is empty.
+        
+        [3.38.4]
+        ---------
+        fix: bugfix for Cornerstone missing completion records
+        
+        [3.38.3]
+        ---------
+        fix: more logging to debug missing completion records
+        
+        [3.38.2]
+        ---------
+        fix: Django Admin bugfix
+        
+        [3.38.1]
+        ---------
+        feat: New crud viewset for IC degreed2 configurations
+        
+        [3.38.0]
+        ---------
+        feat: Adds toggle_universal_link endpoint
+        
+        [3.37.0]
+        ---------
+        feat: Dependency upgrades
+        
+        [3.36.13]
+        ---------
+        fix: check if instance is an iterable rather than a list in ``EnterpriseCustomerUserReadOnlySerializer``
+        
+        [3.36.12]
+        ---------
+        feat: add enterprise role assignments to ``EnterpriseCustomerUserReadOnlySerializer``
+        
+        [3.36.11]
+        ---------
+        fix: Integrated channels Degreed2 exporter now handles invalid start/end date in content metadata item
+        
+        [3.36.10]
+        ---------
+        fix: add `basic_list` action to ``EnterpriseCustomerInviteKeyViewSet`` to return unpaginated set of invite keys.
+        
+        [3.36.9]
+        --------
+        feat: new oauth state for multi-lms-configuration
+        
+        [3.36.8]
+        --------
+        feat: allow more than 1 lms configuration per lms-kind
+        
+        [3.36.7]
+        --------
+        feat: update `enterprise_customer_invite_key` filter and serializer
+        
+        [3.36.6]
+        --------
+        feat: Show OAuth Auth link for Blackboard Admin
+        
+        [3.36.5]
+        --------
+        fix: add support for an ``enterprise_customer_invite_key`` UUID query parameter to be passed and handled by the ``EnterpriseProxyLoginView``
+        
+        [3.36.4]
+        --------
+        feat: OAuth Auth link for Blackboard Admin
+        
+        [3.36.3]
+        --------
+        feat: Integrated channels, grade send logic only logs instead of raising when enterprise_customer_user record is inactive
+        
+        [3.36.2]
+        --------
+        feat: add is_active on enterprise customer invite key
+        
+        [3.36.1]
+        --------
+        feat: improved integrated channel log consistency
+        
+        [3.36.0]
+        --------
+        feat: added view to link learners from a enterprise customer key
+        
+        [3.35.3]
+        --------
+        fix: require expiry date on ``EnterpriseCustomerInviteKey`` model
+        
+        [3.35.2]
+        --------
+        feat: reformat integrated channels logging to be more splunk friendly
+        
+        [3.35.1]
+        --------
+        docs: Updating help_text for universal_link field on EnterpriseCustomer model
+        
+        [3.35.0]
+        --------
+        feat: Adding universal_link field to EnterpriseCustomer model
+        
+        [3.34.2]
+        --------
+        feat: add try catch block to skip unfound courses
+        
+        [3.34.1]
+        --------
+        feat: add enterprise customer invite key model and viewset
+        
+        [3.34.0]
+        --------
+        feat: New management command to revert enrollment data
+        
+        [3.33.12]
+        ---------
+        feat: SAPSF integrated no longer considers grade change as a reason to retransmit completions.
+        
+        [3.33.11]
+        ---------
+        feat: New management command to backfill end dates on Canvas
+        
+        [3.33.10]
+        ---------
+        fix: incorrectly skipping completion transmissions
+        
+        [3.33.9]
+        ---------
+        feat: allow filtering enterprise learners by enterprise uuid and enterprise role
+        
+        [3.33.8]
+        ---------
+        fix: Moodle duplicate content metadata records detected
+        
+        [3.33.7]
+        ---------
+        fix: allow for records to be saved for integrated channels' content across catalogs
+        
+        [3.33.6]
+        ---------
+        fix: CSOD API session tokens bugfix
+        
+        [3.33.5]
+        ---------
+        fix: CSOD API session tokens are now saved to the customer's configuration instead of individual transmission audits
+        
+        [3.33.4]
+        ---------
+        feat: integrated channels only requests content metadata for courses that need updating
+        
+        [3.33.3]
+        ---------
+        feat: Change Bulk Enrollment Assignment Logic for Pending learners
+        
+        [3.33.2]
+        ---------
+        fix: no longer notify learners of already existing enrollments
+        
+        [3.33.1]
+        ---------
+        fix: Rename model field from key to client_id: Degreed2
+        
+        [3.33.0]
+        ---------
+        feat: New Integrated channel Degreed v2.
+        
+        [3.32.0]
+        ---------
+        feat: Added management command to fix DSC records having spaces instead of +.
+        
+        [3.31.1]
+        ---------
+        fix: pip-tools upgrade
+        
+        [3.31.0]
+        ---------
+        feat: new integrated channels content metadata transmitter flow
+        
+        [3.30.14]
+        ---------
+        fix: blackboard logging function was not returning desired string
+        
+        [3.30.13]
+        ---------
+        fix: properly weight blackboard grades
+        
+        [3.30.12]
+        ---------
+        * chore: update course enrollments through lms
+        
+        [3.30.11]
+        ---------
+        * docs: added adr for zero state browsing with universal link
+        
+        [3.30.10]
+        ---------
+        * fix: refactor moodle _post to use body params
+        
+        [3.30.9]
+        ---------
+        * chore: Don't expire courses that have been modified after given date
+        
+        [3.30.8]
+        ---------
+        * feat: Added a boolean in EnterpriseCustomer to specify whether labor market data should be available in learner portal
+        
+        [3.30.7]
+        ---------
+        * update admin banner notification text field with following changes
+        * increase max_length from 255 to 512
+        * update help text
+        * use textarea widget in django admin
+        
+        [3.30.6]
+        --------
+        * maint: Integrated channels detection system of catalog changes needed is now disabled via override.
+        
+        [3.30.5]
+        --------
+        * fix: Integrated channels data transforming generates json serializable fields.
+        
+        [3.30.4]
+        --------
+        * fix: Blackboard integrated channel now correctly synchronizes the one-and-only valid refresh_token
+        
+        [3.30.3]
+        --------
+        * fix: content_filter in django admin was broken after the jsonfield upgrade, so this contains fix for that
+        
+        [3.30.2]
+        --------
+        * fix: switch is_revoked to True on LicensedEnterpriseCourseEnrollment after license expiration
+        
+        [3.30.1]
+        --------
+        * Allowing management commands to optionally run on inactive Integrated Channel configurations
+        
+        [3.30.0]
+        ---------
+        * Switched back to ``jsonfield`` from ``jsonfield2``
+        
+        [3.29.0]
+        ---------
+        * Added api for fetching field choices from EnterpriseCustomerReportingConfiguration
+        
+        [3.28.24]
+        ---------
+        * Integrated channels Canvas: now fills in Start/end dates in description, and uses Course participation type
+        
+        [3.28.23]
+        ---------
+        * Fix cornerstone character limit bug with dict database table
+        
+        [3.28.22]
+        ---------
+        * fix: Adding error handling for role assignment backfill management command
+        
+        [3.28.21]
+        ---------
+        * bug: The exporter now properly handles instances when enterprise customer catalogs do no need updates.
+        
+        [3.28.20]
+        ---------
+        * feat: Added enterprise_learner role assignment backfill management command
+        
+        [3.28.19]
+        ---------
+        * fix: additional Moodle field changes
+        
+        [3.28.18]
+        ---------
+        * Added customer config based learner data transmission feature flag
+        
+        [3.28.17]
+        ---------
+        * Improve error logging in the Moodle integration
+        
+        [3.28.16]
+        ---------
+        * Fix import error used by bulk enrollment in utils
+        
+        [3.28.15]
+        ---------
+        * integrated channels: single learner assessment exporter logging is not helpful right now so improve it.
+        
+        [3.28.14]
+        ---------
+        * logging improvement when calling integrated channels extract_integration_id
+        
+        [3.28.13]
+        ---------
+        * fixes the way moodle queries for courses ENT-4806
+        
+        [3.28.12]
+        ---------
+        * Integrated channels automatically fill in current date for audit completions if date not available.
+        
+        [3.28.11]
+        ---------
+        * Create "enterprise_learner" role when ``EnterpriseCustomerUser`` records are re-linked.
+        * When ``EnterpriseCustomerUser`` records get deleted, also delete the "enterprise_admin" role specific to the relevant enterprise customer.
+        
+        [3.28.10]
+        ---------
+        * Integrated channel transmitter completions routine now logs as error, any status codes greater than or equal to 400
+        
+        [3.28.9]
+        ---------
+        * Include a ``failure_reason=dsc_denied`` to the DSC failure url when learner denies the DSC terms.
+        
+        [3.28.8]
+        ---------
+        * SAP integrated channel django form gets missing idp id field
+        
+        [3.28.7]
+        ---------
+        * Degreed integrated channel now uses idp_id explicitly when calling get_remote_id()
+        
+        [3.28.6]
+        ---------
+        * SAP integrated channel now uses idp_id explicitly when calling get_remote_id()
+        
+        [3.28.5]
+        ---------
+        * Fixed datetime issue in email_drip_for_missing_dsc_records.
+        
+        [3.28.4]
+        ---------
+        * Integrated channels: audit track completion status now based on incomplete non-gated content
+        
+        [3.28.3]
+        ---------
+        * Integrated channels: log response code and message if SAP post fails
+        
+        [3.28.2]
+        ---------
+        * Add `progress_v3` report type for enterprise reporting.
+        
+        [3.28.1]
+        ---------
+        * Inject a failure reason into the ``failure_url`` query params when a verified course mode
+          is not available for DSC-based enrollments.
+        
+        [3.28.0]
+        ---------
+        * Added support for Django 3.0, 3.1 and 3.2
+        
+        [3.27.27]
+        ---------
+        * Adds enterprise catalog query title as an optional attribute to create/update post requests on the catalog service.
+        
+        [3.27.26]
+        ---------
+        * Refactor data-sharing consent GET and POST handlers to not have too many statements,
+          because readability matters.
+        
+        [3.27.25]
+        ---------
+        * Blackboard Integrated channel oauth2 refresh token handling fixes.
+        
+        [3.27.24]
+        ---------
+        * Adding a new EnterpriseEnrollmentSource to be used for bulk enrollment.
+        
+        [3.27.23]
+        ---------
+        * Add logging of user id for troubleshooting in a couple of locations.
+        * Clean up pylint suppressions and rules using latest rules set by edx-lint.
+        
+        [3.27.22]
+        ---------
+        * Prevent failures on integrated channels delete requests when courses are not found.
+        
+        [3.27.21]
+        ---------
+        * Encode invalid course keys for CSOD customers
+        
+        [3.27.20]
+        ---------
+        * Handle content_last_modified not provided by enterprise catalog
+        
+        [3.27.19]
+        ---------
+        * Localize timezones on catalog modified min (not found) values
+        
+        [3.27.18]
+        ---------
+        * Integrated channels util functions needed to base64 urlsafe encode/decode course keys for use with some LMS systems like Cornerstone.
+        
+        [3.27.17]
+        ---------
+        * Integrated channels now checks and uses catalog modified times to determine if an update is needed before retrieving content metadata.
+        
+        [3.27.16]
+        ---------
+        * Making bulk catalog query ID update params optional
+        
+        [3.27.15]
+        ---------
+        * Added title field in ``AdminNotification`` table.
+        
+        [3.27.14]
+        ---------
+        * Adding the ability to specify parameters in the bulk catalog query ID updated management command.
+        
+        [3.27.13]
+        ---------
+        * Revert 'Start my course' links in bulk enrollment emails to courseware based links instead of learner portal.
+        
+        [3.27.12]
+        ---------
+        * Prevent django admin deletions of catalog queries. Added management command to bulk update catalogs of their query IDs
+        
+        [3.27.11]
+        ---------
+        * Avoid failure when an email send in the learners loop fails, for notify_enrolled_learners
+        
+        [3.27.10]
+        ---------
+        * Use celery tasks for emails sent using EnterpriseCustomer's notify_enrolled_learners method
+        
+        [3.27.9]
+        --------
+        * Fix SAP Course Completion payload format again.
+        
+        [3.27.8]
+        --------
+        * Fix SAP Course Completion payload format.
+        
+        [3.27.7]
+        --------
+        * Replace EnrollmentApiClient calls from Bulk enrollment with a newly minted python api call (non-REST) from edx-platform
+        
+        [3.27.6]
+        --------
+        * Filter available IDPs for Enterprise Customers by new boolean flag on ProviderConfig model.
+        
+        [3.27.5]
+        --------
+        * Removing CSOD Integrated Channel from the list of supported channels for the content metadata transmission task.
+        
+        [3.27.4]
+        --------
+        * Add pagination handling to integrated channels Blackboard client
+        
+        [3.27.3]
+        --------
+        * Adds flag to SAP Success Factors customer configuration to switch SAP endpoints for learner completion calls.
+        
+        [3.27.2]
+        --------
+        * Ensure deletion and unlinking of a ``EnterpriseCustomerUser`` record only deletes the ``enterprise_learner`` system-wide role for that
+          particular ``EnterpriseCustomerUser``, as opposed to all ``enterprise_learner`` roles associated with the user.
+        
+        [3.27.1]
+        --------
+        * Updates bulk enrollment email template.
+        
+        [3.27.0]
+        --------
+        * Added enterprise uuid support in course enrollment.  ERTE-5
+        
+        [3.26.23]
+        ---------
+        * Fix the way that ``page_size`` is passed as a param to the ``get_content_metadata`` endpoint.
+          Add a unit test for the ``EnterpriseCatalogApiClient.get_content_metadata()`` method, which
+          was previously untested.
+        
+        [3.26.22]
+        ---------
+        * Set the EnterpriseCatalogApiClient get_content_metadata request page_size parameter to 50; the enterprise-catalog
+          service has a default page_size of 10.  This change means that we'll make a smaller overall number of SELECTs
+          against the enterprise-catalog database.
+        
+        [3.26.21]
+        ---------
+        * Adds error handling and logging to the assignment deduplication management command.
+        
+        [3.26.20]
+        ---------
+        * Updates requirements and style changes to match the latest Pylint.
+        
+        [3.26.19]
+        ---------
+        * Updates to integrated channels catalogs to transmit help text.
+        
+        [3.26.18]
+        ---------
+        * Overriding default chunk size for SAP and Canvas integrations.
+        
+        [3.26.17]
+        ---------
+        * Adds Segment tracking for bulk enrollment method.
+        
+        [3.26.16]
+        ---------
+        * Added history tables for EnterpriseCustomerUser and SystemWideEnterpriseUserRoleAssignment.
+        
+        [3.26.15]
+        ---------
+        * Added management command to clean up duplicate transmitted assignments for the integrated channels.
+        
+        [3.26.14]
+        ---------
+        * Fixed issue with API version in Tableau client.
+        
+        [3.26.13]
+        ---------
+        * Fixed issue with CourseEnrollment receiver when learner has multiple enterprises.
+        
+        [3.26.12]
+        ---------
+        * Canvas integrated channel now supports create_or_update pattern for courses. Detects/logs deleted courses.
+        
+        [3.26.11]
+        ---------
+        * Removed ``ENABLE_MULTIPLE_USER_ENTERPRISES_FEATURE`` waffle switch
+        
+        [3.26.10]
+        ---------
+        * Fix forward for parameter rename changing the signals API in 3.26.7
+        
+        [3.26.9]
+        --------
+        * Added support to use default idp in Enterprise slug login if there are multiple.
+        
+        [3.26.8]
+        --------
+        * added support for redirecting user to default IDP, in case multiple IDPs's attached
+        
+        [3.26.7]
+        --------
+        * developer-only facing updates to standardize LMS Integrated Channels logging.
+        
+        [3.26.6]
+        --------
+        * added an update api call to assign tableau user roles
+        
+        [3.26.5]
+        --------
+        * fix: Bypass slumber's getattr definition when requesting enrollments for usernames starting with '_'
+          (because slumber will raise an AttributeError from getattr when requesting a resource that starts with '_').
+        
+        [3.26.4]
+        --------
+        * removed unnecessary call to ecom in bulk enrollment (process of assigning a license already accounts for this)
+        
+        [3.26.3]
+        --------
+        * added --skip-unlink param in unlink_enterprise_customer_learners command to just remove DSC records.
+        
+        [3.26.2]
+        ---------
+        * Added logs for enterprise users created in tableau.
+        
+        [3.26.1]
+        --------
+        * Added check to configure reports only for Catalog over SFTP.
+        
+        [3.26.0]
+        ---------
+        * Added support for admin scheduled banners that run from date x to date y.
+        
+        [3.25.2]
+        --------
+        * Log exception stack trace during DSC licensed-enrollment flow, so that
+          we can look at log messages and understand what exactly is failing.
+        
+        [3.25.1]
+        --------
+        * bug fix, properly handle API response pagination from Canvas.
+        
+        [3.25.0]
+        --------
+        * added management command to unlink learners from their enterprise and
+          deleting DSC and EnterpriseCourseEnrolment records.
+        
+        [3.24.0]
+        --------
+        * added ``enable_compression`` flag in EnterpriseCustomerReportConfiguration table.
+        
+        [3.23.12]
+        ---------
+        * Database based template system for enrollment emails, including support for Admin and Self enroll modes.
+          Admin mode for Bulk enrollment, existing enrollment emails still use the current template.
+        
+        [3.23.11]
+        ---------
+        * Log more specific information about HTTP client errors that are caught when using the LMS
+          enrollment API.  Also send an exception event to the monitoring service when this happens, even
+          though we handle the exception "gracefully".
+        
+        [3.23.10]
+        ---------
+        * Send long dsc url in missing DSC email as individual params.
+        
+        [3.23.9]
+        ---------
+        * Reduced the DSC url size to account for character limit in Segment event properties.
+        
+        [3.23.8]
+        ---------
+        * Remove hardcoded admin permission constraints for ContentMetadataItemTransmission integrated channel model.
+        
+        [3.23.7]
+        ---------
+        * Canvas integrated channel now 'concludes' course when sending deletion event, instead of 'delete'.
+        
+        [3.23.6]
+        ---------
+        * Optimised handling of conditions defining the absence of a DSC.
+        
+        [3.23.5]
+        ---------
+        * Added exception handling in consent missing email.
+        
+        [3.23.4]
+        ---------
+        * Added a check for enterprise DSC configuration in missing DSC drip.
+        
+        [3.23.3]
+        ---------
+        * Added a check for course access before sending Segment event for missing DSC.
+        
+        [3.23.2]
+        ---------
+        * Added new field reply_to in enterprise customer where learner's reply to enterprise emails will be delivered.
+        
+        * Removed migrations that have been merged into squashed migrations.
+        
+        [3.23.1]
+        ---------
+        * Fix: filter out EnterpriseCourseEnrollments without corresponding CourseEnrollment records in learner portal view.
+        
+        [3.23.0]
+        ---------
+        * Added support for ``--enrollment-before`` and ``--no-commit`` params in ``email_drip_for_missing_dsc_records`` command.
+        
+        [3.22.16]
+        ---------
+        * Fixed Segment json string issue for DSC email drip
+        
+        [3.22.15]
+        ---------
+        * Added additional Segment event properties for missing DSC drip email
+        
+        [3.22.14]
+        ---------
+        * Fixed timezone issue in comparison of course start datetime
+        
+        [3.22.13]
+        ---------
+        * Make enterprise customer uuid mandatory for `TableauAuthView`
+        
+        [3.22.12]
+        ---------
+        * Change the verbose name and help text for the ``enable_integrated_customer_learner_portal_search`` field on the ``EnterpriseCustomer`` model.
+        
+        [3.22.11]
+        ---------
+        * No longer call into the removed email_marketing platform djangoapp
+        
+        [3.22.10]
+        ---------
+        * Use Braze for sending data sharing consent drop emails, add the DSC link inside the drip email.
+        
+        [3.22.9]
+        --------
+        * Expose enterprise catalog uuids associated with an Enterprise Customer in the ``enterprise-customer`` API endpoint.
+        
+        [3.22.8]
+        --------
+        * Add dashboard admin rbac role permission on tableau auth view so that only
+          enterprise dashboard admins can access this view.
+        * Add support to generate tableau auth token based on incoming enterprise customer's uuid
+        
+        [3.22.7]
+        --------
+        * chore: upgrade edx-enterprise requirements
+        
+        [3.22.6]
+        --------
+        * Improves performance of enterprise role assignment admin page
+        * Deletes custom get_search_results() method, since ``enterprise_customer__name`` is now a viable search field
+        * Improves pagination by asking for an estimated row count from Mysql ``INFORMATION_SCHEMA.TABLES``
+        * Turns 1 + N query into 1 query via proper use of ``list_select_related``
+        
+        [3.22.5]
+        --------
+        * Fix: no longer stringifying `None` values passed to enterprise catalog creations calls
+        
+        [3.22.4]
+        --------
+        * Fix: learner_data exporter bug fix and refactor for cleaner enrollment filtering
+        
+        [3.22.3]
+        --------
+        * Feature: including EnterpriseCatalogQuery UUID field in request payload to enterprise-catalog on EnterpriseCatalog updates
+        
+        [3.22.2]
+        --------
+        * Feature: new UUID field on EnterpriseCatalogQuery model (and update to all existing query objects)
+        
+        [3.22.1]
+        --------
+        * Refactor: integrated channels learner exporter replace course api client
+        
+        [3.22.0]
+        --------
+        * Added a management command to send emails to learners with missing DSC
+        
+        [3.21.4]
+        --------
+        * allow searching of enterprise customer records with hyphenated uuid
+        * add typeahead search dropdown to imporve enterprise customer search on
+          enterprise reporting configuration
+        
+        [3.21.3]
+        --------
+        * When a learner is linked from manage learners page, in-activate learner's other enterprises
+        
+        [3.21.2]
+        --------
+        * Added support of multiple identity_providers in enterprise.models.get_remote_id.
+        
+        [3.21.1]
+        --------
+        * Added multiple identity_providers in EnterpriseCustomerApi
+        
+        [3.21.0]
+        --------
+        * Added the ability to link/unlink enterprise customer catalogs with enterprise reporting configuration via its API endpoint.
+        
+        [3.20.5]
+        --------
+        * Integrated channels learner_data module refactored to avoid making some LMS REST API calls
+        
+        [3.20.4]
+        --------
+        * Refactored code in `proxied_get()` to clean up duplicate logic.
+        
+        [3.20.3]
+        --------
+        
+        * Removing unused and out of date endpoints for Bulk Enrollment
+        
+        [3.20.2]
+        --------
+        * Allow licensed audit enrollment to have a path to upgrade into verified
+        
+        [3.20.1]
+        --------
+        * update edx-rbac to 1.4.2, plus a bunch of other version bumps.
+        
+        [3.20.0]
+        --------
+        * feat: add support for enterprise admins to create pending enterprise users
+        
+        [3.19.0]
+        --------
+        * feat: add support for creating multiple pending enterprise users
+        
+        [3.18.7]
+        --------
+        
+        * Refactored bulk enrollment serializer and bug fixes to the bulk enrollment endpoint.
+        
+        [3.18.6]
+        --------
+        
+        * fix: The update_role_assignments_with_customers command no longer updates records.  It only creates
+          new records, which helps de-risk the operation.
+        
+        [3.18.5]
+        --------
+        * fix: do not include unpublished courses when enrollment link resolves course_runs
+        
+        [3.18.4]
+        --------
+        
+        * fix: The update_role_assignments_with_customers command no longer deletes open assignments.  Allowing it to do so
+          left us prone to error when an explicit enterprise_customer_uuid arg is provided.  We should modify this command
+          in the future to perform deletions of open assignments as its only action, and it should only be invoked this way
+          after we have verified that all backfilled enterprise_customer fields on the assignments have been set correctly.
+        
+        [3.18.3]
+        --------
+        
+        * Adds the catalog admin role to ``roles_api.roles_by_name()``.
+        
+        [3.18.2]
+        --------
+        
+        * Removes course mode as a required parameter to the bulk subscription enrollment endpoint.
+        
+        [3.18.1]
+        --------
+        
+        * Adds bulk enterprise learner in bulk courses enrollment endpoint with pending user support.
+        
+        [3.18.0]
+        --------
+        
+        * Adds a management command to update all ``SystemWideEnterpriseUserRoleAssignment`` records in a way
+          that makes them more explicitly defined.
+        
+        [3.17.47]
+        ---------
+        
+        * Bug fix to remove a deprecated parameter that was causing bulk enrollments to fail.
+        
+        [3.17.46]
+        ---------
+        
+        * Made help text of sender_alias more generic.
+        
+        [3.17.45]
+        ---------
+        
+        * Fix bulk enrollment endpoint to process email_csv and email as well
+        
+        [3.17.44]
+        ---------
+        
+        * Replaced an LMS Enrollment API call with direct call the DB to avoid LMS rate limiting during integrated channels bulk jobs.
+        
+        [3.17.43]
+        ---------
+        
+        * Updated the default IDP priority of enterprises for social auth.
+        
+        [3.17.42]
+        ---------
+        
+        * Change canvas_course_id to BigInteger: Integrated Channels
+        
+        [3.17.41]
+        ---------
+        
+        * Upgrade django-ipware to version 3.0.2
+        
+        [3.17.40]
+        ---------
+        
+        * Read CSV files using `utf-8-sig` encoding to handle Byte Order Mark
+        
+        [3.17.39]
+        ---------
+        
+        * Rename `Owners` field to `Partners` for Cornerstone Integration
+        
+        [3.17.38]
+        
+        * Omitting assessment level reporting from integrated Canvas learners final grade to not have redundant reported points
+          between final grades and subsection grades.
+        
+        [3.17.37]
+        ---------
+        
+        * Refactor to only create an ``EnterpriseCourseEnrollment`` if we successfully create/update a ``CourseEnrollment`` record
+        
+        [3.17.36]
+        ---------
+        
+        * Properly filtering integrated channels that support assessment level reporting.
+        
+        [3.17.35]
+        ---------
+        
+        * Map "estimated_hours" to "credit_hours" in addition to "total_hours" in SAP.
+        
+        [3.17.34]
+        ---------
+        
+        * Removing temporary logs from integrated channels.
+        
+        [3.17.33]
+        ---------
+        
+        * Enable manually adding learners to multiple enterprises
+        
+        [3.17.32]
+        ---------
+        
+        * Adding the logic to select default provider in case an enterprise has multiple identity providers attached.
+        
+        [3.17.31]
+        ---------
+        
+        * Change moodle course title in exporter, to include edX text.
+        
+        [3.17.30]
+        ---------
+        
+        * Investigatory logging to track down Integrated Channels transmission issues.
+        
+        [3.17.29]
+        ---------
+        
+        * Prevent NoneType string concatenation when handling multiple enterprises logistration without redirects.
+        
+        [3.17.28]
+        ---------
+        
+        * Adds default field in enterprise customer identity provider table to select default IDP if there are more than one
+          IDPs attached with enterprise.
+        
+        [3.17.27]
+        ---------
+        
+        * Adding Logging to single learner assessment level reporting task.
+        
+        [3.17.26]
+        ---------
+        
+        * Updating docs to reflect method behaviors.
+        
+        [3.17.25]
+        ---------
+        
+        * Making failed SAP user remote ID retrievals log relevant context data.
+        
+        [3.17.24]
+        ---------
+        
+        * Making sure Canvas Integrated Channel properly url encodes user identifier fields.
+        
+        [3.17.23]
+        ---------
+        
+        * Fixing assessment level reporting audit retrieval.
+        
+        [3.17.22]
+        ---------
+        
+        * Adds content metadata item transmission table to Django Admin.
+        
+        [3.17.21]
+        ---------
+        
+        * Introduce and use a ``roles_api`` module and use the roles API in signal receivers
+          that need to create or delete role assignments.
+        * For created or updated learner and admin enterprise users, associate their user-role
+          with the ``enterprise_customer`` to which that user is linked.
+        * Install django-cache-memoize.
+        
+        [3.17.20]
+        ---------
+        
+        * Adds better exception handling to the SAP integrated channels.
+        * Adds better logging to the base transmission process in the integrated channels.
+        
+        [3.17.19]
+        ---------
+        
+        * Removes the sync_enterprise_catalog_query boolean field from the EnterpriseCustomerCatalog model.
+        * Adds migration to remove the sync_enterprise_catalog_query boolean field.
+        
+        [3.17.18]
+        ---------
+        
+        * Removes all references to the sync_enterprise_catalog_query boolean field from the EnterpriseCustomerCatalog model.
+        * Updates all conditional use of the sync_enterprise_catalog_query field to be True.
+        * A second PR will follow to remove the model field and perform the db migration (blue/green deployment safe).
+        
+        [3.17.17]
+        ---------
+        
+        * Added a catch all exception block to ensure login flow is not interrupted by analytics user sync.
+        
+        [3.17.16]
+        ---------
+        
+        * Include course mode for the user's ``student.CourseEnrollment`` in the ``EnterpriseCourseEnrollmentSerializer``.
+        
+        [3.17.15]
+        ---------
+        
+        * In ``SystemWideEnterpriseUserRoleAssignment``, Use either ``applies_to_all_contexts`` or ``enterprise_customer``
+          if they are True or non-null, respectively, in determining the result of ``get_context()``,
+          but continue to return list of all linked enterprise customer UUIDs if not, (which is the current behavior).
+          This is a small step on our journey to explicitly defining user-role assignments.
+        
+        [3.17.14]
+        ---------
+        
+        * On the ``SystemWideEnterpriseUserRoleAssignment`` model, adds an ``enterprise_customer`` FK (nullable)
+          and an ``applies_to_all`` boolean field (defaults to False) that indicates if the user has wildcard permissions.
+        * Updates the admin to show the "effective" customer in the detail view, and the explicit value in the list view.
+          The effective value is the deprecated way we currently determine role assignment -
+          by implicitly assigning the role on every customer to which the user is linked.
+        * In the detail view/form, the "Enterprise customer" dropdown contains only customers
+          to which the user is currently linked.
+        
+        [3.17.13]
+        ---------
+        
+        * added check to make sure enterprise user can only use linked IdP with their enterprise customer.
+        
+        [3.17.12]
+        ---------
+        
+        * Conditionally allows the deletion of individual ``EnterpriseCourseEnrollment`` and related
+          ``LicensedEnterpriseCourseEnrollment`` records via the Django Admin site, so that site admins can manually
+          delete enterprise enrollments that were created in error.
+          This is only allowed if a Django settings feature flag is set to ``True``.
+        
+        [3.17.11]
+        ---------
+        
+        * Apply edx-rbac migration to add ``applies_to_all_contexts`` field to ``SystemWideEnterpriseUserRoleAssignment``.
+        * Added endpoints for Cornerstone integrated channel.
+        
+        [3.17.10]
+        ---------
+        
+        * added home page logo for EnterpriseSelectionView and EnterpriseLoginView
+        
+        [3.17.9]
+        --------
+        
+        * Fix deprecation warning: ``third_party_auth`` should be imported as ``common.djangoapps.third_party_auth``.
+        
+        [3.17.8]
+        --------
+        
+        * Added new API endpoints for Degreed integrated channel.
+        
+        [3.17.7]
+        --------
+        
+        * Added new field ``sender_alias`` in enterprise customer which will be used in emails except of default alias.
+        
+        [3.17.6]
+        --------
+        
+        * Non-effectual code cleanup / refactor to remove some final pieces of duplication (canvas, blackboard).
+        
+        [3.17.5]
+        --------
+        
+        * Ensure enterprise course enrollments return valid course run statuses such that when a learner earns a passing certificate, the ``enterprise_course_enrollments`` API endpoint deems the course is complete even though the course itself may not have ended yet per the configured dates.
+        
+        [3.17.4]
+        --------
+        
+        * Add some info to the ``EnterpriseCourseEnrollment`` docstring, add ``is_active`` property to same.
+        
+        [3.17.3]
+        --------
+        
+        * Fixed unnessary integrated channel signal transmission on course completion to inactive customers by adding guard condition.
+        
+        [3.17.2]
+        --------
+        
+        * Stop listening for ``student.CourseEnrollment`` unenrollment signal, as introduced in 3.17.0
+        
+        [3.17.1]
+        --------
+        
+        * Add management command to process expired subscriptions and field on subscriptions to persist that the subscription expiration has been processed
+        
+        [3.17.0]
+        --------
+        
+        * Listen for ``student.CourseEnrollment`` unenrollment signal and delete associated
+          ``EnterpriseCourseEnrollment`` record if one exists (we will have a historical record of the deletion).
+        
+        [3.16.11]
+        ---------
+        
+        * Retrieve ``EnterpriseCustomerUser`` by both user_id and enterprise_customer to handle users who are pending for more than 1 enterprise.
+        
+        [3.16.10]
+        ---------
+        
+        * Forcing embedded enrollment links within integrated Blackboard courses to open new windows to avoid security alert
+          prompt.
+        
+        [3.16.9]
+        --------
+        
+        * Upgrade celery to 5.0.4
+        
+        [3.16.8]
+        --------
+        
+        * Added ClientError exception handling for SAPSuccessFactorsAPIClient.
+        
+        [3.16.7]
+        --------
+        
+        * Modify the learner portal enterprise_course_enrollments endpoint to include an ``is_enrollment_active``
+          key that indicates the status of the enterprise enrollment's related ``student.CourseEnrollment`.
+          Allow the endpoint to optionally accept an ``?is_active`` query param, so that clients may request
+          only active enrollments from it.
+        
+        [3.16.6]
+        --------
+        
+        * Improved error handling for SAP Success Factors OAuth2 response.
+        
+        [3.16.5]
+        --------
+        
+        * Refactoring title content metadata in integrated course creation within the Blackboard integrated channel.
+        
+        [3.16.4]
+        --------
+        
+        * Add SuccessFactors Customer Configuration API endpoint.
+        
+        [3.16.3]
+        --------
+        
+        * Update unique constraints for pending Enterprise learners/admins to support users who may be pending for more than 1 Enterprise.
+        * Fix ``handle_user_post_save`` to account for the potential of being a pending learner/admin for more than 1 Enterprise.
+        
+        [3.16.2]
+        --------
+        
+        * Refactor ``handle_user_post_save`` to be responsible for linking PendingEnterpriseCustomerUser records and granting admin permissions.
+        
+        [3.16.1]
+        --------
+        
+        * Adding backend support for admin portal Blackboard configuration.
+        
+        [3.16.0]
+        --------
+        
+        * Added the ability to enable multiple Identity Providers for a single enterprise customer.
+        
+        [3.15.0]
+        --------
+        
+        * Converted relation between enterprise customer and identity provider to a one-to-many.
+        
+        [3.14.1]
+        --------
+        * Adds new API for Canvas LMS configurations.
+        
+        [3.14.0]
+        --------
+        
+        * Rebranding update: Change fonts and colors, change mobile layout
+        
+        [3.13.12]
+        ---------
+        
+        * Adding decorators to missed integrated channel tasks.
+        
+        [3.13.11]
+        ---------
+        
+        * Add new API for external LMS configurations.
+        
+        [3.13.10]
+        ---------
+        
+        * Use logo from ``get_platform_logo_url`` in the legacy Django templates
+        
+        [3.13.9]
+        --------
+        
+        * Adding Blackboard support for assessment level reporting in the integrated channels.
+        
+        [3.13.8]
+        --------
+        
+        * Bug fix with course key lookup in the Canvas assessment level grade reporting flow.
+        
+        [3.13.7]
+        --------
+        
+        * Rebranding update: move to more robust ``get_platform_logo_url`` and update default branding colors.
+        
+        [3.13.6]
+        --------
+        
+        * Add log for enterprise enrollment page.
+        
+        [3.13.5]
+        --------
+        
+        * Fixed deprecation warnings related with drf methods (detail_route, list_route).
+        
+        [3.13.4]
+        --------
+        
+        * Empty sequence bugfix in catalog api.
+        
+        [3.13.3]
+        --------
+        
+        * Course end date bugfix.
+        
+        [3.13.2]
+        --------
+        
+        * Add course end date to course level metadata.
+        
+        [3.13.1]
+        --------
+        
+        * Base implementation of assessment level reporting for Integrated Channels.
+        
+        [3.13.0]
+        --------
+        
+        * Use full paths for edx-platform/common/djangoapps imports, as described in
+          `edx-platform ADR #7 <https://github.com/openedx/edx-platform/blob/master/docs/decisions/0007-sys-path-modification-removal.rst>`_.
+        
+        [3.12.4]
+        --------
+        
+        * Fix silent exception in catalog api call.
+        
+        [3.12.3]
+        --------
+        
+        * Add code_owner custom attribute for celery tasks.
+        
+        [3.12.2]
+        --------
+        
+        * Refresh catalog metadata on create and update
+        
+        [3.12.1]
+        --------
+        
+        * added support for grade, completion and course_structure type reports in enterprise report configurations. Added validation to allow these reports for Pearson enterprises only.
+        
+        [3.12.0]
+        --------
+        
+        * Support uploading a ``course_id`` column in the "Manage Learners" CSV bulk upload to allow manual enrollments in multiple courses at once.
+        
+        [3.11.1]
+        --------
+        
+        * Fixes the issue where user preference value can not be null.
+        
+        [3.11.0]
+        --------
+        
+        * Added spanish translations for data sharing consent page.
+        
+        [3.10.5]
+        --------
+        
+        * Update Moodle integration to single transmission to handle responses properly.
+        
+        [3.10.4]
+        --------
+        
+        * Remove hyphens from  enterprise_customer_uuid for admin user creation and tableau authentication.
+        
+        [3.10.3]
+        --------
+        
+        * Fix timout on update.
+        
+        [3.10.2]
+        --------
+        
+        * Updated the logic to clear enterprise learner language in a way that db lock does not happen.
+        
+        [3.10.1]
+        --------
+        
+        * change username with enterprise_customer_uuid for tableau trusted authentication and tableau user creation.
+        
+        [3.10.0]
+        --------
+        
+        * Tests only: upgrade to pytest 6+ and factoryboy 3+ to bring up to date with edx-platform.
+        
+        [3.9.13]
+        --------
+        
+        * Adding Blackboard customization to integrated channel content metadata creation.
+        
+        [3.9.12]
+        --------
+        
+        * change username with user_id for tableau trusted authentication and tableau user creation.
+        
+        [3.9.11]
+        --------
+        
+        * add logs to know if data sharing consent is failing because catalog does not contain the course
+        
+        [3.9.10]
+        --------
+        
+        * added POST enterprise-customer/<uuid>/enterprise_learner endpoint to mimic Manage Learners admin form functionality
         
         [3.9.9]
         --------
         
         * upgrade version to create new release on pypi.
         
         
@@ -1281,14 +3413,15 @@
         
         [2.0.19] - 2019-11-13
         ---------------------
         
         * Sorted results of enterprise-learner API by active flag in descending order so active enterprises are on the top
         
         [2.0.18] - 2019-11-13
+        
         ---------------------
         
         * Better handling when Integrated Channels return unexpected results
         
         
         [2.0.17] - 2019-11-08
         ---------------------
@@ -3566,14 +5699,13 @@
         * First release on PyPI.
         * Models and Django admin integration
         
 Keywords: Django edx
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: Framework :: Django
-Classifier: Framework :: Django :: 2.2
+Classifier: Framework :: Django :: 3.2
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3 or later (AGPLv3+)
 Classifier: Natural Language :: English
 Classifier: Programming Language :: Python :: 3
-Classifier: Programming Language :: Python :: 3.5
 Classifier: Programming Language :: Python :: 3.8
```

### Comparing `edx-enterprise-3.9.9/enterprise/templatetags/enterprise.py` & `edx-enterprise-4.0.0/enterprise/templatetags/enterprise.py`

 * *Files 4% similar despite different names*

```diff
@@ -3,15 +3,15 @@
 """
 
 from django import template
 from django.utils.safestring import mark_safe
 
 from enterprise.utils import strip_html_tags
 
-register = template.Library()  # pylint: disable=invalid-name
+register = template.Library()
 
 MESSAGE_ICONS = {
     'success': 'fa-check-circle',
     'info': 'fa-info-circle',
     'warning': 'fa-exclamation-triangle',
     'error': 'fa-times-circle',
 }
```

### Comparing `edx-enterprise-3.9.9/enterprise/signals.py` & `edx-enterprise-4.0.0/enterprise/signals.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,393 +1,391 @@
-# -*- coding: utf-8 -*-
 """
 Django signal handlers.
 """
 
 from logging import getLogger
 
-from django.core.exceptions import ObjectDoesNotExist
-from django.db import transaction
-from django.db.models.signals import post_delete, post_save, pre_delete, pre_save
+from django.db.models.signals import post_delete, post_save, pre_save
 from django.dispatch import receiver
 
+from enterprise import models, roles_api
+from enterprise.api import activate_admin_permissions
 from enterprise.api_client.enterprise_catalog import EnterpriseCatalogApiClient
-from enterprise.constants import ENTERPRISE_ADMIN_ROLE, ENTERPRISE_LEARNER_ROLE
 from enterprise.decorators import disable_for_loaddata
-from enterprise.models import (
-    EnterpriseAnalyticsUser,
-    EnterpriseCatalogQuery,
-    EnterpriseCustomerBrandingConfiguration,
-    EnterpriseCustomerCatalog,
-    EnterpriseCustomerUser,
-    PendingEnterpriseCustomerAdminUser,
-    PendingEnterpriseCustomerUser,
-    SystemWideEnterpriseRole,
-    SystemWideEnterpriseUserRoleAssignment,
-)
 from enterprise.tasks import create_enterprise_enrollment
 from enterprise.utils import (
     NotConnectedToOpenEdX,
-    create_tableau_user,
-    delete_tableau_user,
-    delete_tableau_user_by_id,
     get_default_catalog_content_filter,
-    track_enrollment,
+    localized_utcnow,
     unset_enterprise_learner_language,
+    unset_language_of_all_enterprise_learners,
 )
+from integrated_channels.blackboard.models import BlackboardEnterpriseCustomerConfiguration
+from integrated_channels.canvas.models import CanvasEnterpriseCustomerConfiguration
+from integrated_channels.cornerstone.models import CornerstoneEnterpriseCustomerConfiguration
+from integrated_channels.degreed2.models import Degreed2EnterpriseCustomerConfiguration
+from integrated_channels.degreed.models import DegreedEnterpriseCustomerConfiguration
+from integrated_channels.integrated_channel.tasks import mark_orphaned_content_metadata_audit
+from integrated_channels.moodle.models import MoodleEnterpriseCustomerConfiguration
+from integrated_channels.sap_success_factors.models import SAPSuccessFactorsEnterpriseCustomerConfiguration
 
 try:
-    from student.models import CourseEnrollment
+    from common.djangoapps.student.models import CourseEnrollment
+    from openedx_events.learning.signals import COURSE_UNENROLLMENT_COMPLETED
+
 except ImportError:
     CourseEnrollment = None
+    COURSE_UNENROLLMENT_COMPLETED = None
 
-logger = getLogger(__name__)  # pylint: disable=invalid-name
+logger = getLogger(__name__)
 _UNSAVED_FILEFIELD = 'unsaved_filefield'
+INTEGRATED_CHANNELS = [
+    BlackboardEnterpriseCustomerConfiguration,
+    CanvasEnterpriseCustomerConfiguration,
+    CornerstoneEnterpriseCustomerConfiguration,
+    DegreedEnterpriseCustomerConfiguration,
+    Degreed2EnterpriseCustomerConfiguration,
+    MoodleEnterpriseCustomerConfiguration,
+    SAPSuccessFactorsEnterpriseCustomerConfiguration,
+]
 
 
 @disable_for_loaddata
 def handle_user_post_save(sender, **kwargs):  # pylint: disable=unused-argument
     """
-    Handle User model changes - checks if pending enterprise customer user record exists and upgrades it to actual link.
+    Handle User model changes. Context: This signal runs any time a user logs in, including b2c users.
+
+    Steps:
+
+    1. Check for existing PendingEnterpriseCustomerUser(s) for user's email. If one
+       or more exists, create an EnterpriseCustomerUser record for each which will
+       ensure the user has the "enterprise_learner" role.
+
+    2. When we get a new EnterpriseCustomerUser record (or an existing record if
+       one existed), check if the PendingEnterpriseCustomerUser has any pending
+       course enrollments. If so, enroll the user in these courses.
 
-    If there are pending enrollments attached to the PendingEnterpriseCustomerUser, then this signal also takes the
-    newly-created users and enrolls them in the relevant courses.
+    3. Delete the PendingEnterpriseCustomerUser record as its no longer needed.
+
+    4. Using the newly created EnterpriseCustomerUser (or an existing record if one
+       existed), check if there is a PendingEnterpriseCustomerAdminUser. If so,
+       ensure the user has the "enterprise_admin" role.
     """
     created = kwargs.get("created", False)
     user_instance = kwargs.get("instance", None)
 
     if user_instance is None:
         return  # should never happen, but better safe than 500 error
 
-    try:
-        pending_ecu = PendingEnterpriseCustomerUser.objects.get(user_email=user_instance.email)
-    except PendingEnterpriseCustomerUser.DoesNotExist:
-        return  # nothing to do in this case
-
-    if not created:
-        # existing user changed his email to match one of pending link records - try linking him to EC
-        try:
-            existing_record = EnterpriseCustomerUser.objects.get(user_id=user_instance.id)
-            message_template = "User {user} have changed email to match pending Enterprise Customer link, " \
-                               "but was already linked to Enterprise Customer {enterprise_customer} - " \
-                               "deleting pending link record"
-            logger.info(message_template.format(
-                user=user_instance, enterprise_customer=existing_record.enterprise_customer
-            ))
-            pending_ecu.delete()
-            return
-        except EnterpriseCustomerUser.DoesNotExist:
-            pass  # everything ok - current user is not linked to other ECs
+    pending_ecus = models.PendingEnterpriseCustomerUser.objects.filter(user_email=user_instance.email)
 
-    enterprise_customer_user = EnterpriseCustomerUser.objects.create(
-        enterprise_customer=pending_ecu.enterprise_customer,
-        user_id=user_instance.id
-    )
-    pending_enrollments = list(pending_ecu.pendingenrollment_set.all())
-    if pending_enrollments:
-        def _complete_user_enrollment():
-            """
-            Complete an Enterprise User's enrollment.
-
-            EnterpriseCustomers may enroll users in courses before the users themselves
-            actually exist in the system; in such a case, the enrollment for each such
-            course is finalized when the user registers with the OpenEdX platform.
-            """
-            for enrollment in pending_enrollments:
-                enterprise_customer_user.enroll(
-                    enrollment.course_id,
-                    enrollment.course_mode,
-                    cohort=enrollment.cohort_name,
-                    source_slug=getattr(enrollment.source, 'slug', None),
-                    discount_percentage=enrollment.discount_percentage,
-                    sales_force_id=enrollment.sales_force_id,
-                )
-                track_enrollment('pending-admin-enrollment', user_instance.id, enrollment.course_id)
-            pending_ecu.delete()
-        transaction.on_commit(_complete_user_enrollment)
-    else:
+    # link PendingEnterpriseCustomerUser to the EnterpriseCustomer and fulfill pending enrollments
+    for pending_ecu in pending_ecus:
+        enterprise_customer_user = pending_ecu.link_pending_enterprise_user(
+            user=user_instance,
+            is_user_created=created,
+        )
+        pending_ecu.fulfill_pending_course_enrollments(enterprise_customer_user)
         pending_ecu.delete()
 
+    enterprise_customer_users = models.EnterpriseCustomerUser.objects.filter(user_id=user_instance.id)
+    for enterprise_customer_user in enterprise_customer_users:
+        # activate admin permissions for an existing EnterpriseCustomerUser(s), if applicable
+        activate_admin_permissions(enterprise_customer_user)
 
-@receiver(pre_save, sender=EnterpriseCustomerBrandingConfiguration)
+
+@receiver(pre_save, sender=models.EnterpriseCustomer)
+def update_lang_pref_of_all_learners(sender, instance, **kwargs):  # pylint: disable=unused-argument
+    """
+    Update the language preference of all the learners belonging to the enterprise customer.
+    Set the language preference to the value enterprise customer has used as the `default_language`.
+    """
+    # Unset the language preference when a new learner is linked with the enterprise customer.
+    # The middleware in the enterprise will handle the cases for setting a proper language for the learner.
+    if instance.default_language:
+        prev_state = models.EnterpriseCustomer.objects.filter(uuid=instance.uuid).first()
+        if prev_state is None or prev_state.default_language != instance.default_language:
+            # Unset the language preference of all the learners linked with the enterprise customer.
+            # The middleware in the enterprise will handle the cases for setting a proper language for the learner.
+            unset_language_of_all_enterprise_learners(instance)
+
+
+@receiver(pre_save, sender=models.EnterpriseCustomerBrandingConfiguration)
 def skip_saving_logo_file(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
     To avoid saving the logo image at an incorrect path, skip saving it.
     """
     if not instance.id and not hasattr(instance, _UNSAVED_FILEFIELD):
         setattr(instance, _UNSAVED_FILEFIELD, instance.logo)
         instance.logo = None
 
 
-@receiver(post_save, sender=EnterpriseCustomerBrandingConfiguration)
+@receiver(post_save, sender=models.EnterpriseCustomerBrandingConfiguration)
 def save_logo_file(sender, instance, **kwargs):            # pylint: disable=unused-argument
     """
     Now that the object is instantiated and instance.id exists, save the image at correct path and re-save the model.
     """
     if kwargs['created'] and hasattr(instance, _UNSAVED_FILEFIELD):
         instance.logo = getattr(instance, _UNSAVED_FILEFIELD)
         delattr(instance, _UNSAVED_FILEFIELD)
         instance.save()
 
 
-@receiver(post_save, sender=EnterpriseCustomerCatalog, dispatch_uid='default_content_filter')
+@receiver(post_save, sender=models.EnterpriseCustomerCatalog, dispatch_uid='default_content_filter')
 def default_content_filter(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
     Set default value for `EnterpriseCustomerCatalog.content_filter` if not already set.
     """
     if kwargs['created'] and not instance.content_filter:
         instance.content_filter = get_default_catalog_content_filter()
         instance.save()
 
 
-@receiver(post_save, sender=EnterpriseCustomerUser)
-def assign_or_delete_enterprise_admin_role(sender, instance, **kwargs):     # pylint: disable=unused-argument
-    """
-    Assign or delete enterprise_admin role for EnterpriseCustomerUser when updated.
-    Create third party analytics user.
-
-    This only occurs if a PendingEnterpriseCustomerAdminUser record exists.
-    """
-    if instance.user:
-        enterprise_admin_role, __ = SystemWideEnterpriseRole.objects.get_or_create(name=ENTERPRISE_ADMIN_ROLE)
-        try:
-            pending_enterprise_admin_user = PendingEnterpriseCustomerAdminUser.objects.get(
-                user_email=instance.user.email,
-                enterprise_customer=instance.enterprise_customer,
-            )
-        except PendingEnterpriseCustomerAdminUser.DoesNotExist:
-            pending_enterprise_admin_user = None
-
-        if kwargs['created'] and pending_enterprise_admin_user:
-            # EnterpriseCustomerUser record was created and a pending admin user
-            # exists, so assign the enterprise_admin role.
-            pending_enterprise_admin_user.activate_admin_permissions(
-                user=instance.user,
-                enterprise_customer=instance.enterprise_customer,
-            )
-            # Also create the Enterprise admin user in third party analytics application
-            create_tableau_user(instance.user.username, instance)
-        elif not kwargs['created'] and not instance.linked:
-            # EnterpriseCustomerUser record was updated but is not linked, so delete the enterprise_admin role.
-            try:
-                SystemWideEnterpriseUserRoleAssignment.objects.get(
-                    user=instance.user,
-                    role=enterprise_admin_role
-                ).delete()
-                # Also delete the Enterprise admin user in the third party analytics application
-                delete_tableau_user(instance)
-            except SystemWideEnterpriseUserRoleAssignment.DoesNotExist:
-                # Do nothing if no role assignment is present for the enterprise customer user.
-                pass
-        else:
-            logger.info(
-                'Could not assign or delete enterprise_admin role for user %s'
-                ' due to a PendingEnterpriseCustomerAdminUser record not existing'
-                ' or the user not being linked.',
-                instance.user.id,
-            )
-
-
-@receiver(post_delete, sender=EnterpriseCustomerUser)
+@receiver(post_delete, sender=models.EnterpriseCustomerUser)
 def delete_enterprise_admin_role_assignment(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
     Delete the associated enterprise admin role assignment record when deleting an EnterpriseCustomerUser record.
     """
     if instance.user:
-        enterprise_admin_role, __ = SystemWideEnterpriseRole.objects.get_or_create(name=ENTERPRISE_ADMIN_ROLE)
-        SystemWideEnterpriseUserRoleAssignment.objects.filter(
+        roles_api.delete_admin_role_assignment(
             user=instance.user,
-            role=enterprise_admin_role
-        ).delete()
+            enterprise_customer=instance.enterprise_customer,
+        )
 
 
-@receiver(post_save, sender=EnterpriseCustomerUser)
+@receiver(post_save, sender=models.EnterpriseCustomerUser)
 def assign_or_delete_enterprise_learner_role(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
-    Assign or delete enterprise_learner role for EnterpriseCustomerUser when updated.
+    Assign or delete enterprise_learner role for EnterpriseCustomerUser when created or updated.
 
     The enterprise_learner role is assigned when a new EnterpriseCustomerUser record is
     initially created and removed when a EnterpriseCustomerUser record is updated and
     unlinked (i.e., soft delete - see ENT-2538).
     """
-    if instance.user:
-        enterprise_learner_role, __ = SystemWideEnterpriseRole.objects.get_or_create(name=ENTERPRISE_LEARNER_ROLE)
-        if kwargs['created']:
-            # EnterpriseCustomerUser record was created, so assign the enterprise_learner role
-            SystemWideEnterpriseUserRoleAssignment.objects.get_or_create(
+    if not instance.user:
+        return
+
+    if kwargs['created']:
+        roles_api.assign_learner_role(
+            instance.user,
+            enterprise_customer=instance.enterprise_customer,
+        )
+    elif not kwargs['created']:
+        # EnterpriseCustomerUser record was updated
+        if instance.linked:
+            roles_api.assign_learner_role(
+                instance.user,
+                enterprise_customer=instance.enterprise_customer,
+            )
+        else:
+            roles_api.delete_learner_role_assignment(
                 user=instance.user,
-                role=enterprise_learner_role
+                enterprise_customer=instance.enterprise_customer,
             )
-        elif not kwargs['created'] and not instance.linked:
-            # EnterpriseCustomerUser record was updated but is not linked, so delete the enterprise_learner role
-            try:
-                SystemWideEnterpriseUserRoleAssignment.objects.get(
-                    user=instance.user,
-                    role=enterprise_learner_role
-                ).delete()
-            except SystemWideEnterpriseUserRoleAssignment.DoesNotExist:
-                # Do nothing if no role assignment is present for the enterprise customer user.
-                pass
 
 
-@receiver(post_delete, sender=EnterpriseCustomerUser)
+@receiver(post_delete, sender=models.EnterpriseCustomerUser)
 def delete_enterprise_learner_role_assignment(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
     Delete the associated enterprise learner role assignment record when deleting an EnterpriseCustomerUser record.
     """
-    if instance.user:
-        enterprise_learner_role, __ = SystemWideEnterpriseRole.objects.get_or_create(name=ENTERPRISE_LEARNER_ROLE)
-        try:
-            SystemWideEnterpriseUserRoleAssignment.objects.get(
-                user=instance.user,
-                role=enterprise_learner_role
-            ).delete()
-        except SystemWideEnterpriseUserRoleAssignment.DoesNotExist:
-            # Do nothing if no role assignment is present for the enterprise customer user.
-            pass
+    if not instance.user:
+        return
+
+    roles_api.delete_learner_role_assignment(
+        user=instance.user,
+        enterprise_customer=instance.enterprise_customer,
+    )
 
 
-@receiver(post_save, sender=EnterpriseCustomerUser)
+@receiver(post_save, sender=models.EnterpriseCustomerUser)
 def update_learner_language_preference(sender, instance, created, **kwargs):     # pylint: disable=unused-argument
     """
     Update the language preference of the learner.
     Set the language preference to the value enterprise customer has used as the `default_language`.
     """
     # Unset the language preference when a new learner is linked with the enterprise customer.
     # The middleware in the enterprise will handle the cases for setting a proper language for the learner.
     if created and instance.enterprise_customer.default_language:
         unset_enterprise_learner_language(instance)
 
 
-@receiver(pre_delete, sender=EnterpriseAnalyticsUser)
-def delete_enterprise_analytics_user(sender, instance, **kwargs):     # pylint: disable=unused-argument
-    """
-    Delete the associated enterprise analytics user in tableau.
-    """
-    if instance.analytics_user_id:
-        delete_tableau_user_by_id(instance.analytics_user_id)
-
-
-@receiver(post_save, sender=PendingEnterpriseCustomerAdminUser)
+@receiver(post_save, sender=models.PendingEnterpriseCustomerAdminUser)
 def create_pending_enterprise_admin_user(sender, instance, **kwargs):  # pylint: disable=unused-argument
     """
     Creates a PendingEnterpriseCustomerUser when a PendingEnterpriseCustomerAdminUser is created.
     """
-    PendingEnterpriseCustomerUser.objects.get_or_create(
+    models.PendingEnterpriseCustomerUser.objects.get_or_create(
         enterprise_customer=instance.enterprise_customer,
         user_email=instance.user_email,
     )
 
 
-@receiver(post_delete, sender=PendingEnterpriseCustomerAdminUser)
+@receiver(post_delete, sender=models.PendingEnterpriseCustomerAdminUser)
 def delete_pending_enterprise_admin_user(sender, instance, **kwargs):  # pylint: disable=unused-argument
     """
     Deletes a PendingEnterpriseCustomerUser when its associated PendingEnterpriseCustomerAdminUser is removed.
     """
-    PendingEnterpriseCustomerUser.objects.filter(
+    models.PendingEnterpriseCustomerUser.objects.filter(
         enterprise_customer=instance.enterprise_customer,
         user_email=instance.user_email,
     ).delete()
 
 
-@receiver(post_save, sender=EnterpriseCatalogQuery)
+@receiver(post_save, sender=models.EnterpriseCatalogQuery)
 def update_enterprise_catalog_query(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
     Sync data changes from Enterprise Catalog Query to the Enterprise Customer Catalog.
     """
     updated_content_filter = instance.content_filter
     logger.info(
         'Running update_enterprise_catalog_query for Catalog Query {} with updated_content_filter {}'.format(
             instance.pk,
             updated_content_filter
         )
     )
-    catalogs = instance.enterprise_customer_catalogs.filter(sync_enterprise_catalog_query=True)
+    catalogs = instance.enterprise_customer_catalogs.all()
 
     for catalog in catalogs:
         logger.info(
             'update_enterprise_catalog_query is updating catalog {} with the updated_content_filter.'.format(
                 catalog.uuid
             )
         )
         catalog.content_filter = updated_content_filter
-        catalog.save()
+        catalog.save()  # This save will trigger the update_enterprise_catalog_data() receiver below
 
 
-@receiver(post_save, sender=EnterpriseCustomerCatalog)
+@receiver(post_save, sender=models.EnterpriseCustomerCatalog)
 def update_enterprise_catalog_data(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
     Send data changes to Enterprise Catalogs to the Enterprise Catalog Service.
+
+    Additionally sends a request to update the catalog's metadata from discovery, and index any relevant content for
+    Algolia.
     """
     catalog_uuid = instance.uuid
+    catalog_query_uuid = str(instance.enterprise_catalog_query.uuid) if instance.enterprise_catalog_query else None
+    query_title = getattr(instance.enterprise_catalog_query, 'title', None)
+    include_exec_ed_2u_courses = getattr(instance.enterprise_catalog_query, 'include_exec_ed_2u_courses', False)
     try:
         catalog_client = EnterpriseCatalogApiClient()
         if kwargs['created']:
             response = catalog_client.get_enterprise_catalog(
                 catalog_uuid=catalog_uuid,
                 # Suppress 404 exception on create since we do not expect the catalog
                 # to exist yet in enterprise-catalog
                 should_raise_exception=False,
             )
         else:
             response = catalog_client.get_enterprise_catalog(catalog_uuid=catalog_uuid)
     except NotConnectedToOpenEdX as exc:
-        logger.exception('Unable to update Enterprise Catalog {}'.format(str(catalog_uuid)), exc)
+        logger.exception(
+            'Unable to update Enterprise Catalog {}'.format(str(catalog_uuid)), exc_info=exc
+        )
     else:
         if not response:
             # catalog with matching uuid does NOT exist in enterprise-catalog
             # service, so we should create a new catalog
             catalog_client.create_enterprise_catalog(
                 str(catalog_uuid),
                 str(instance.enterprise_customer.uuid),
                 instance.enterprise_customer.name,
                 instance.title,
                 instance.content_filter,
                 instance.enabled_course_modes,
                 instance.publish_audit_enrollment_urls,
+                catalog_query_uuid,
+                query_title,
+                include_exec_ed_2u_courses,
             )
         else:
             # catalog with matching uuid does exist in enterprise-catalog
             # service, so we should update the existing catalog
             update_fields = {
                 'enterprise_customer': str(instance.enterprise_customer.uuid),
                 'enterprise_customer_name': instance.enterprise_customer.name,
                 'title': instance.title,
                 'content_filter': instance.content_filter,
                 'enabled_course_modes': instance.enabled_course_modes,
                 'publish_audit_enrollment_urls': instance.publish_audit_enrollment_urls,
+                'catalog_query_uuid': catalog_query_uuid,
+                'query_title': query_title,
+                'include_exec_ed_2u_courses': include_exec_ed_2u_courses,
             }
             catalog_client.update_enterprise_catalog(catalog_uuid, **update_fields)
+        # Refresh catalog on all creates and updates
+        catalog_client.refresh_catalogs([instance])
 
 
-@receiver(post_delete, sender=EnterpriseCustomerCatalog)
+@receiver(post_delete, sender=models.EnterpriseCustomerCatalog)
 def delete_enterprise_catalog_data(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
     Send deletions of Enterprise Catalogs to the Enterprise Catalog Service.
     """
     catalog_uuid = instance.uuid
     try:
         catalog_client = EnterpriseCatalogApiClient()
         catalog_client.delete_enterprise_catalog(catalog_uuid)
     except NotConnectedToOpenEdX as exc:
-        logger.exception('Unable to delete Enterprise Catalog {}'.format(str(catalog_uuid)), exc)
+        logger.exception(
+            'Unable to delete Enterprise Catalog {}'.format(str(catalog_uuid)),
+            exc_info=exc
+        )
+
+    customer = instance.enterprise_customer
+    for channel in INTEGRATED_CHANNELS:
+        if channel.objects.filter(enterprise_customer=customer, active=True).exists():
+            logger.info(
+                f"Catalog {catalog_uuid} deletion is linked to an active integrated channels config, running the mark"
+                f"orphan content audits task"
+            )
+            mark_orphaned_content_metadata_audit.delay()
+            break
+
+
+def enterprise_unenrollment_receiver(sender, **kwargs):     # pylint: disable=unused-argument
+    """
+    Mark the EnterpriseCourseEnrollment object as unenrolled when a user unenrolls from a course.
+    """
+    enrollment = kwargs.get('enrollment')
+    enterprise_enrollment = models.EnterpriseCourseEnrollment.objects.filter(
+        course_id=enrollment.course.course_key,
+        enterprise_customer_user__user_id=enrollment.user.id,
+    ).first()
+    if enterprise_enrollment:
+        logger.info(
+            f"Marking EnterpriseCourseEnrollment as unenrolled for user {enrollment.user} and "
+            f"course {enrollment.course.course_key}"
+        )
+        enterprise_enrollment.unenrolled_at = localized_utcnow()
+        enterprise_enrollment.save()
 
 
 def create_enterprise_enrollment_receiver(sender, instance, **kwargs):     # pylint: disable=unused-argument
     """
     Watches for post_save signal for creates on the CourseEnrollment table.
 
     Spin off an async task to generate an EnterpriseCourseEnrollment if appropriate.
     """
     if kwargs.get('created') and instance.user:
         user_id = instance.user.id
-        try:
-            ecu = EnterpriseCustomerUser.objects.get(user_id=user_id)
-        except ObjectDoesNotExist:
+        # NOTE: there should be _at most_ 1 EnterpriseCustomerUser record  with `active=True`
+        active_ecus_for_user = models.EnterpriseCustomerUser.objects.filter(user_id=user_id, active=True)
+        ecu = active_ecus_for_user.first()
+        if not ecu:
+            # nothing to do here
             return
+        if len(active_ecus_for_user) > 1:
+            logger.warning(
+                'User %s has more than 1 active EnterpriseCustomerUser object. Continuing with course enrollment'
+                'for course %s but the enrollment may end up associated with an incorrect EnterpriseCustomerUser',
+                user_id,
+                instance.course_id,
+            )
         logger.info((
             "User %s is an EnterpriseCustomerUser. "
             "Spinning off task to check if course is within User's "
             "Enterprise's EnterpriseCustomerCatalog."
         ), user_id)
 
         create_enterprise_enrollment.delay(
@@ -395,7 +393,10 @@
             ecu.id,
         )
 
 
 # Don't connect this receiver if we dont have access to CourseEnrollment model
 if CourseEnrollment is not None:
     post_save.connect(create_enterprise_enrollment_receiver, sender=CourseEnrollment)
+
+if COURSE_UNENROLLMENT_COMPLETED is not None:
+    COURSE_UNENROLLMENT_COMPLETED.connect(enterprise_unenrollment_receiver)
```

### Comparing `edx-enterprise-3.9.9/enterprise/decorators.py` & `edx-enterprise-4.0.0/enterprise/decorators.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,17 @@
-# -*- coding: utf-8 -*-
 """
 Decorators for enterprise app.
 """
 
 import inspect
 import warnings
 from functools import wraps
+from urllib.parse import parse_qs, urlencode, urlparse, urlunparse
 
 from requests.utils import quote
-from six.moves.urllib.parse import parse_qs, urlencode, urlparse, urlunparse  # pylint: disable=import-error
 
 from django.http import Http404
 from django.shortcuts import redirect
 
 from enterprise.utils import get_enterprise_customer_or_404, get_identity_provider
 
 FRESH_LOGIN_PARAMETER = 'new_enterprise_login'
@@ -100,14 +99,15 @@
     the decorated view .
 
     If there is no enterprise in database against the kwarg `enterprise_uuid`
     or if the user is not authenticated then it will redirect the user to the
     enterprise-linked SSO login page.
 
     Usage::
+
         @enterprise_login_required()
         def my_view(request, enterprise_uuid):
             # Some functionality ...
 
         OR
 
         class MyView(View):
@@ -123,23 +123,29 @@
         Wrap the decorator.
         """
         if 'enterprise_uuid' not in kwargs:
             raise Http404
 
         enterprise_uuid = kwargs['enterprise_uuid']
         enterprise_customer = get_enterprise_customer_or_404(enterprise_uuid)
+        query_params = request.GET
+        tpa_hint_param = query_params.get('tpa_hint')
 
         # Now verify if the user is logged in. If user is not logged in then
         # send the user to the login screen to sign in with an
         # Enterprise-linked IdP and the pipeline will get them back here.
         if not request.user.is_authenticated:
             parsed_current_url = urlparse(request.get_full_path())
             parsed_query_string = parse_qs(parsed_current_url.query)
+            tpa_hint = enterprise_customer.get_tpa_hint(tpa_hint_param)
+            if tpa_hint:
+                parsed_query_string.update({
+                    'tpa_hint': tpa_hint,
+                })
             parsed_query_string.update({
-                'tpa_hint': enterprise_customer.identity_provider,
                 FRESH_LOGIN_PARAMETER: 'yes'
             })
             next_url = '{current_path}?{query_string}'.format(
                 current_path=quote(parsed_current_url.path),
                 query_string=urlencode(parsed_query_string, doseq=True)
             )
             return redirect(
@@ -167,14 +173,15 @@
     user who may have been previously logged in using the same
     browser window.
 
     This decorator should be used in conjunction with the
     enterprise_login_required decorator.
 
     Usage::
+
         @enterprise_login_required
         @force_fresh_session()
         def my_view(request, enterprise_uuid):
             # Some functionality ...
 
         OR
 
@@ -194,15 +201,19 @@
             # The enterprise_login_required decorator promises to set the fresh login URL
             # parameter for this URL when it was the agent that initiated the login process;
             # if that parameter isn't set, we can safely assume that the session is "stale";
             # that isn't necessarily an issue, though. Redirect the user to
             # log out and then come back here - the enterprise_login_required decorator will
             # then take effect prior to us arriving back here again.
             enterprise_customer = get_enterprise_customer_or_404(kwargs.get('enterprise_uuid'))
-            provider_id = enterprise_customer.identity_provider or ''
+            if not enterprise_customer.has_multiple_idps:
+                provider_id = enterprise_customer.identity_provider \
+                    if enterprise_customer.identity_provider else ''
+            else:
+                provider_id = ''
             sso_provider = get_identity_provider(provider_id)
             if sso_provider:
                 # Parse the current request full path, quote just the path portion,
                 # then reconstruct the full path string.
                 # The path and query portions should be the only non-empty strings here.
                 scheme, netloc, path, params, query, fragment = urlparse(request.get_full_path())
                 redirect_url = urlunparse((scheme, netloc, quote(path), params, query, fragment))
```

### Comparing `edx-enterprise-3.9.9/enterprise/static/enterprise/js/enterprise_login_page.js` & `edx-enterprise-4.0.0/enterprise/static/enterprise/js/enterprise_login_page.js`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/static/enterprise/js/manage_learners.js` & `edx-enterprise-4.0.0/enterprise/static/enterprise/js/manage_learners.js`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/static/enterprise/js/program_enrollment_landing_page.js` & `edx-enterprise-4.0.0/enterprise/static/enterprise/js/program_enrollment_landing_page.js`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/static/enterprise/js/course_modal.js` & `edx-enterprise-4.0.0/enterprise/static/enterprise/js/course_modal.js`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/static/enterprise/js/enterprise_customer.js` & `edx-enterprise-4.0.0/enterprise/static/enterprise/js/enterprise_customer.js`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/static/enterprise/js/enterprise_selection_page.js` & `edx-enterprise-4.0.0/enterprise/static/enterprise/js/enterprise_selection_page.js`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/static/enterprise/js/grant_data_sharing_permissions.js` & `edx-enterprise-4.0.0/enterprise/static/enterprise/js/grant_data_sharing_permissions.js`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/static/enterprise/admin/enterprise_customer_catalog.js` & `edx-enterprise-4.0.0/enterprise/static/enterprise/admin/enterprise_customer_catalog.js`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/rules.py` & `edx-enterprise-4.0.0/enterprise/rules.py`

 * *Files 3% similar despite different names*

```diff
@@ -8,20 +8,38 @@
 from edx_rest_framework_extensions.auth.jwt.authentication import get_decoded_jwt_from_auth
 from edx_rest_framework_extensions.auth.jwt.cookies import get_decoded_jwt
 
 from enterprise.constants import (
     ENTERPRISE_CATALOG_ADMIN_ROLE,
     ENTERPRISE_DASHBOARD_ADMIN_ROLE,
     ENTERPRISE_ENROLLMENT_API_ADMIN_ROLE,
+    ENTERPRISE_FULFILLMENT_OPERATOR_ROLE,
     ENTERPRISE_REPORTING_CONFIG_ADMIN_ROLE,
 )
 from enterprise.models import EnterpriseFeatureUserRoleAssignment
 
 
 @rules.predicate
+def has_implicit_access_to_fulfillments(user, obj):  # pylint: disable=unused-argument
+    """
+    Check if a requesting user has implicit access to the `ENTERPRISE_FULFILLMENT_OPERATOR_ROLE` feature role.
+
+    Params:
+        user: An ``auth.User`` instance.
+        obj: The string version of an ``EnterpriseCustomer.uuid``.
+
+    Returns:
+        boolean: whether the request user has access or not
+    """
+    request = crum.get_current_request()
+    decoded_jwt = get_decoded_jwt(request) or get_decoded_jwt_from_auth(request)
+    return request_user_has_implicit_access_via_jwt(decoded_jwt, ENTERPRISE_FULFILLMENT_OPERATOR_ROLE, obj)
+
+
+@rules.predicate
 def has_implicit_access_to_dashboard(user, obj):  # pylint: disable=unused-argument
     """
     Check that if request user has implicit access to `ENTERPRISE_DASHBOARD_ADMIN_ROLE` feature role.
 
     Params:
         user: An ``auth.User`` instance.
         obj: The string version of an ``EnterpriseCustomer.uuid``.
@@ -161,18 +179,21 @@
         user,
         ENTERPRISE_REPORTING_CONFIG_ADMIN_ROLE,
         EnterpriseFeatureUserRoleAssignment,
         obj,
     )
 
 
+# pylint: disable=unsupported-binary-operation
 rules.add_perm('enterprise.can_access_admin_dashboard',
                has_implicit_access_to_dashboard | has_explicit_access_to_dashboard)
 
 rules.add_perm('enterprise.can_view_catalog',
                has_implicit_access_to_catalog | has_explicit_access_to_catalog)
 
 rules.add_perm('enterprise.can_enroll_learners',
                has_implicit_access_to_enrollment_api | has_explicit_access_to_enrollment_api)
 
 rules.add_perm('enterprise.can_manage_reporting_config',
                has_implicit_access_to_reporting_api | has_explicit_access_to_reporting_api)
+
+rules.add_perm('enterprise.can_manage_enterprise_fulfillments', has_implicit_access_to_fulfillments)
```

### Comparing `edx-enterprise-3.9.9/enterprise/urls.py` & `edx-enterprise-4.0.0/enterprise/urls.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,103 +1,81 @@
-# -*- coding: utf-8 -*-
 """
 URLs for enterprise.
 """
 
 from django.conf import settings
-from django.conf.urls import include, url
+from django.conf.urls import include
+from django.urls import re_path
 
 from enterprise.constants import COURSE_KEY_URL_PATTERN
 from enterprise.heartbeat.views import heartbeat
 from enterprise.views import (
     EnterpriseLoginView,
     EnterpriseProxyLoginView,
     EnterpriseSelectionView,
     GrantDataSharingPermissions,
     RouterView,
 )
 
 ENTERPRISE_ROUTER = RouterView.as_view()
 
 urlpatterns = [
-    url(
-        r'^enterprise/grant_data_sharing_permissions',
-        GrantDataSharingPermissions.as_view(),
-        name='grant_data_sharing_permissions'
-    ),
-    url(
-        r'^enterprise/select/active',
-        EnterpriseSelectionView.as_view(),
-        name='enterprise_select_active'
-    ),
-    url(
-        r'^enterprise/login',
-        EnterpriseLoginView.as_view(),
-        name='enterprise_slug_login'
-    ),
-    url(
-        r'^enterprise/proxy-login',
-        EnterpriseProxyLoginView.as_view(),
-        name='enterprise_proxy_login'
-    ),
-    url(
+    re_path(r'^enterprise/grant_data_sharing_permissions', GrantDataSharingPermissions.as_view(),
+            name='grant_data_sharing_permissions'
+            ),
+    re_path(r'^enterprise/select/active', EnterpriseSelectionView.as_view(),
+            name='enterprise_select_active'
+            ),
+    re_path(r'^enterprise/login', EnterpriseLoginView.as_view(),
+            name='enterprise_slug_login'
+            ),
+    re_path(r'^enterprise/proxy-login', EnterpriseProxyLoginView.as_view(),
+            name='enterprise_proxy_login'
+            ),
+    re_path(
         r'^enterprise/handle_consent_enrollment/(?P<enterprise_uuid>[^/]+)/course/{}/$'.format(
             settings.COURSE_ID_PATTERN
         ),
         ENTERPRISE_ROUTER,
         name='enterprise_handle_consent_enrollment'
     ),
-    url(
+    re_path(
         r'^enterprise/(?P<enterprise_uuid>[^/]+)/course/{}/enroll/$'.format(COURSE_KEY_URL_PATTERN),
         ENTERPRISE_ROUTER,
         name='enterprise_course_enrollment_page'
     ),
-    url(
+    re_path(
         r'^enterprise/(?P<enterprise_uuid>[^/]+)/course/{}/enroll/$'.format(settings.COURSE_ID_PATTERN),
         ENTERPRISE_ROUTER,
         name='enterprise_course_run_enrollment_page'
     ),
-    url(
-        r'^enterprise/(?P<enterprise_uuid>[^/]+)/program/(?P<program_uuid>[^/]+)/enroll/$',
-        ENTERPRISE_ROUTER,
-        name='enterprise_program_enrollment_page'
-    ),
-    url(
-        r'^enterprise/api/',
-        include('enterprise.api.urls'),
-        name='enterprise_api'
-    ),
-    url(
-        r'^enterprise/heartbeat/',
-        heartbeat,
-        name='enterprise_heartbeat',
-    ),
+    re_path(r'^enterprise/(?P<enterprise_uuid>[^/]+)/program/(?P<program_uuid>[^/]+)/enroll/$', ENTERPRISE_ROUTER,
+            name='enterprise_program_enrollment_page'
+            ),
+    re_path(r'^enterprise/api/', include('enterprise.api.urls'),
+            name='enterprise_api'
+            ),
+    re_path(r'^enterprise/heartbeat/', heartbeat,
+            name='enterprise_heartbeat',
+            ),
 ]
 
 # Because ROOT_URLCONF points here, we are including the urls from the other apps here for now.
 urlpatterns += [
-    url(
-        r'',
-        include('consent.urls'),
-        name='consent'
-    ),
-    url(
-        r'^cornerstone/',
-        include('integrated_channels.cornerstone.urls'),
-        name='cornerstone'
-    ),
-    url(
-        r'^canvas/',
-        include('integrated_channels.canvas.urls'),
-        name='canvas',
-    ),
-    url(
-        r'^blackboard/',
-        include('integrated_channels.blackboard.urls'),
-        name='blackboard',
-    ),
-    url(
-        r'^enterprise_learner_portal/',
-        include('enterprise_learner_portal.urls'),
-        name='enterprise_learner_portal_api'
-    ),
+    re_path('', include('consent.urls'),
+            name='consent'
+            ),
+    re_path(r'^cornerstone/', include('integrated_channels.cornerstone.urls'),
+            name='cornerstone'
+            ),
+    re_path(r'^canvas/', include('integrated_channels.canvas.urls'),
+            name='canvas',
+            ),
+    re_path(r'^blackboard/', include('integrated_channels.blackboard.urls'),
+            name='blackboard',
+            ),
+    re_path(r'^enterprise_learner_portal/', include('enterprise_learner_portal.urls'),
+            name='enterprise_learner_portal_api'
+            ),
+    re_path(r'^integrated_channels/api/', include('integrated_channels.api.urls')
+            ),
 ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/templatetags/course_modal.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/templatetags/course_modal.html`

 * *Files 1% similar despite different names*

```diff
@@ -18,15 +18,15 @@
               <div class="organization">
                 <img src="{{ organization_logo }}" alt="{{ organization_name }}" />
               </div>
             {% endif %}
           </div>
         </header>
         <div class="details">
-          <ol>
+          <ul class="details-list">
             {% if premium_modes|length > 0 %}
               {% with course_mode=premium_modes.0 %}
                 {% if course_mode.original_price %}
                   <li>
                     <div class="detail-container">
                       <div class="detail-title-container">
                         <span class="icon fa fa-tag" aria-hidden="true"></span>
@@ -82,45 +82,39 @@
                   </div>
                   <div class="detail-value-container">
                     <span class="text">{{ course_duration }}</span>
                   </div>
                 </div>
               </li>
             {% endif %}
-          </ol>
+          </ul>
         </div>
         <div class="overview">
           {% if course_full_description %}
-            <div class="header-wrapper">
-              <h2>{{ course_full_description_text }}</h2>
-            </div>
+            <h2 class="h3">{{ course_full_description_text }}</h2>
             <div>{% autoescape off %}{{ course_full_description }}{% endautoescape %}</div>
           {% endif %}
           {% if expected_learning_items %}
-            <div class="header-wrapper">
-              <h2>{{ expected_learning_items_text }}</h2>
-            </div>
+            <h2 class="h3">{{ expected_learning_items_text }}</h2>
             <ul>
             {% for item in expected_learning_items %}
               <li>{{ item }}</li>
             {% endfor %}
             </ul>
           {% endif %}
           {% if staff %}
-            <div class="header-wrapper">
-              <h2>{{ staff_text }}</h2>
-            </div>
+            <h2 class="h3">{{ staff_text }}</h2>
             <div class="staff-container">
               {% for person in staff %}
-                <div class="row">
+                <div class="row no-gutters">
                   {% if person.profile_image_url %}
                     <img src="{{ person.profile_image_url }}" alt="{{ person.given_name }} {{ person.family_name }}" />
                   {% endif %}
                   <div class="col-7">
-                    <h2>{{ person.given_name }} {{ person.family_name }}</h2>
+                    <h3 class="h4">{{ person.given_name }} {{ person.family_name }}</h3>
                     {% if person.position %}
                       <p>{{ person.position.title }} at {{ person.position.organization_name }}</p>
                     {% endif %}
                     <p>{{ person.bio }}</p>
                   </div>
                 </div>
               {% endfor %}
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_customer_select_form.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_customer_select_form.html`

 * *Files 3% similar despite different names*

```diff
@@ -1,23 +1,23 @@
 
 {% extends 'enterprise/base.html' %}
 
-{% load i18n staticfiles enterprise %}
+{% load i18n static enterprise %}
 
 {% block extrahead %}
   <script type="text/javascript" src="{% static 'js/vendor/jquery.cookie.js' %}"></script>
   <script type="text/javascript" src="{% static 'enterprise/js/enterprise_selection_page.js' %}"></script>
 {% endblock %}
 
 {% block contents %}
   <main>
     <div class="enterprise-container">
       <div class="select-enterprise-container">
 
-          <h2 class="select-enterprise-title">{{ select_enterprise_message_title|safe }}</h2>
+          <h1 class="select-enterprise-title h2">{{ select_enterprise_message_title|safe }}</h1>
           <div class="select-enterprise-message">
             <p>{{ select_enterprise_message_subtitle|safe }}</p>
           </div>
 
           <form action="" method="POST" id="select-enterprise-form">
             {% csrf_token %}
 
@@ -25,15 +25,15 @@
               role="alert"
               aria-live="assertive"
               class="select-enterprise errorlist is-hidden"
               id="select-enterprise-form-error">
             </div>
 
             {% for field in form.visible_fields %}
-              <div>
+              <div class="form-group">
               {{ field.label_tag }}
               {{ field.errors }}
               {{ field }}
               {{ field.help_text }}
               </div>
             {% endfor %}
 
@@ -41,15 +41,15 @@
               <div>
               {{ hidden_field }}
               </div>
             {% endfor %}
 
             <button
               type="submit"
-              class="background-input select-enterprise-submit-button"
+              class="background-input btn btn-primary"
               id="select-enterprise-submit">
               {% trans "Continue" %}
             </button>
             <span id="activate-progress-icon" class="icon fa fa-spinner fa-spin is-hidden" aria-hidden="true"></span>
           </form>
 
       </div>
```

#### html2text {}

```diff
@@ -1,11 +1,11 @@
- {% extends 'enterprise/base.html' %} {% load i18n staticfiles enterprise %} {%
+ {% extends 'enterprise/base.html' %} {% load i18n static enterprise %} {%
 block extrahead %}
  {% endblock %} {% block contents %}
-***** {{ select_enterprise_message_title|safe }} *****
+****** {{ select_enterprise_message_title|safe }} ******
 {{ select_enterprise_message_subtitle|safe }}
 {% csrf_token %}
 {% for field in form.visible_fields %}
 {{ field.label_tag }} {{ field.errors }} {{ field }} {{ field.help_text }}
 {% endfor %} {% for hidden_field in form.hidden_fields %}
 {{ hidden_field }}
 {% endfor %}  {% trans "Continue" %}
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/grant_data_sharing_permissions.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/grant_data_sharing_permissions.html`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 {% extends 'enterprise/base.html' %}
 
-{% load i18n staticfiles enterprise %}
+{% load i18n static enterprise %}
 
 {% block extrahead %}
   <script type="text/javascript">
     var courseId;
     var programId;
     var successUrl = '{{ redirect_url|default:"null"|escapejs }}';
     var failureUrl = '{{ failure_url|default:"null"|escapejs }}';
```

#### html2text {}

```diff
@@ -1,6 +1,6 @@
-{% extends 'enterprise/base.html' %} {% load i18n staticfiles enterprise %} {%
-block extrahead %}
+{% extends 'enterprise/base.html' %} {% load i18n static enterprise %} {% block
+extrahead %}
  {% endblock %} {% block contents %}
 {% include "enterprise/_enterprise_customer_sidebar.html" %}
 {% include "enterprise/_data_sharing_policy.html" %}
 {% endblock %}
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_top_paragraph.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_top_paragraph.html`

 * *Files 11% similar despite different names*

```diff
@@ -1,18 +1,18 @@
-{% load i18n staticfiles enterprise %}
+{% load i18n static enterprise %}
 
 {% if text_override_available %}
   <div class="consent-message">
     {{ top_paragraph|only_safe_html }}
   </div>
 {% else %}
-  <h2 class="consent-title">{{ consent_message_header }}</h2>
+  <h2>{{ consent_message_header }}</h2>
   <div class="consent-message">
     {% autoescape off %}
-      <p>{{ consent_request_prompt|safe }} {{ policy_link_template }}</p>
+      <p>{{ consent_request_prompt|safe }}</p>
     {% endautoescape %}
     <p>{{ requested_permissions_header|safe }}
       <ul class="consent-items">
         {% for permission in requested_permissions %}
           <li>{{ permission }}</li>
         {% endfor %}
       </ul>
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_customer_login_page.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_customer_login_page.html`

 * *Files 15% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 
 {% extends 'enterprise/base.html' %}
 
-{% load i18n staticfiles enterprise %}
+{% load i18n static enterprise %}
 
 {% block extrahead %}
   <script type="text/javascript" src="{% static 'js/vendor/jquery.cookie.js' %}"></script>
   <script type="text/javascript" src="{% static 'enterprise/js/enterprise_login_page.js' %}"></script>
 {% endblock %}
 
 {% block contents %}
@@ -25,26 +25,27 @@
               role="alert"
               aria-live="assertive"
               class="enterprise-login errorlist is-hidden"
               id="enterprise-login-form-error">
             </div>
 
             {% for field in form.visible_fields %}
-              <div>
+              <div class="form-group">
+              {{ field.label_tag }}
               {{ field.errors }}
               {{ field }}
               {{ field.help_text }}
               </div>
             {% endfor %}
 
             <button
               type="submit"
-              class="background-input enterprise-login-submit-button"
+              class="background-input btn btn-primary"
               id="enterprise-login-submit">
-              {% trans "Login" %}
+              {% trans "Continue" %}
             </button>
             <span id="activate-progress-icon" class="icon fa fa-spinner fa-spin is-hidden" aria-hidden="true"></span>
           </form>
 
       </div>
     </div>
   </main>
```

#### html2text {}

```diff
@@ -1,10 +1,10 @@
- {% extends 'enterprise/base.html' %} {% load i18n staticfiles enterprise %} {%
+ {% extends 'enterprise/base.html' %} {% load i18n static enterprise %} {%
 block extrahead %}
  {% endblock %} {% block contents %}
 ***** {{ enterprise_login_title_message|safe }} *****
 {{ enterprise_login_subtitle_message|safe }}
 {% csrf_token %}
 {% for field in form.visible_fields %}
-{{ field.errors }} {{ field }} {{ field.help_text }}
-{% endfor %}  {% trans "Login" %}
+{{ field.label_tag }} {{ field.errors }} {{ field }} {{ field.help_text }}
+{% endfor %}  {% trans "Continue" %}
  {% endblock %}
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_decline_modal.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_decline_modal.html`

 * *Files 24% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load i18n staticfiles enterprise %}
+{% load i18n static enterprise %}
 
 <div id="consent-confirmation-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-header-text" aria-hidden="true" tabindex="-1">
   <div class="modal-dialog modal-md" role="document">
     <div id="consent-confirmation-modal-content" class="modal-content">
       <div class="modal-header">
         <button id="modal-close-button" type="button" class="close" data-dismiss="modal" aria-hidden="true" aria-label="{% trans "Close" %}">
           {% fa_icon 'times' %}
@@ -11,13 +11,13 @@
       <div class="modal-body">
         <header class="modal-header-wrapper">
           <h2 id="modal-header-text" class="modal-header-text">
             {{ confirmation_modal_header }}
           </h2>
         </header>
         <p>{{ confirmation_alert_prompt|only_safe_html }}</p>
-        <button class="consent-agreement-button" id="modal-no-consent-button">{{ confirmation_modal_affirm_decline_text }}</button>
-        <button class="failure-link" id="review-policy-link">{{ confirmation_modal_abort_decline_text }}</button>
+        <button class="btn btn-primary" id="modal-no-consent-button">{{ confirmation_modal_affirm_decline_text }}</button>
+        <button class="btn btn-link" id="review-policy-link">{{ confirmation_modal_abort_decline_text }}</button>
       </div>
     </div>
   </div>
-</div>
+</div>
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_course_enrollment_page.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_course_enrollment_page.html`

 * *Files 4% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 {% extends 'enterprise/base.html' %}
 
-{% load staticfiles enterprise %}
+{% load static enterprise %}
 
 {% block extrahead %}
   <script type="text/javascript" src="{% static 'enterprise/js/course_modal.js' %}"></script>
 {% endblock %}
 
 {% block contents %}
   <div class="enterprise-container">
-    <div class="row">
+    <div class="row no-gutters">
       <div class="col-3">
         {% include "enterprise/_enterprise_customer_sidebar.html" %}
       </div>
       <div class="col-7 border-left">
 
         {# Display success, error, warning or info messages #}
         {% alert_messages messages %}
 
         {% if course_enrollable %}
-          <h2 class="course-confirmation-title">{{ confirmation_text }}</h2>
+          <h2>{{ confirmation_text }}</h2>
         {% endif %}
 
         <div class="media">
           <div class="thumbnail">
             <img class="course-image" src="{{ course_image_uri }}" alt="{{ course_title }}"/>
           </div>
           <div class="media-content">
@@ -90,15 +90,15 @@
                       {{ course_mode.original_price }}
                     {% endif %}
                   </span>
                   <span class="description">{{ course_mode.description }}</span>
                 </label>
               </div>
               {% endfor %}
-              <button class="btn-confirm">{{ continue_link_text }}</button>
+              <button class="btn btn-primary">{{ continue_link_text }}</button>
             </form>
           {% endif %}
         {% endif %}
       </div>
     </div>
   </div>
   {% with index=0 %}
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-{% extends 'enterprise/base.html' %} {% load staticfiles enterprise %} {% block
+{% extends 'enterprise/base.html' %} {% load static enterprise %} {% block
 extrahead %}
  {% endblock %} {% block contents %}
 {% include "enterprise/_enterprise_customer_sidebar.html" %}
 {# Display success, error, warning or info messages #} {% alert_messages
 messages %} {% if course_enrollable %}
 ***** {{ confirmation_text }} *****
 {% endif %}
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/widgets/segment-io-django.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/widgets/segment-io-django.html`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_policy_paragraph.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_policy_paragraph.html`

 * *Files 5% similar despite different names*

```diff
@@ -1,11 +1,11 @@
-{% load i18n staticfiles enterprise %}
+{% load i18n static enterprise %}
 
 {% if policy_dropdown_header %}
-<button type="button" id="consent-policy-dropdown-bar" class="consent-policy-dropdown-bar background-input" aria-controls="consent-policy" aria-expanded="false">
+<button type="btn btn-primary" id="consent-policy-dropdown-bar" class="consent-policy-dropdown-bar background-input" aria-controls="consent-policy" aria-expanded="false">
   <span class="dropdown-text">{{ policy_dropdown_header }}</span>
   <span class="fa-stack fa-lg dropdown-icon-container" aria-hidden="true">
     <span id="consent-policy-dropdown-icon-surround" class="fa fa-circle fa-stack-2x" aria-hidden="true"></span>
     <span id="consent-policy-dropdown-icon" class="fa fa-chevron-right fa-stack-1x" aria-hidden="true"></span>
   </span>
 </button>
 {% endif %}
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/enterprise_program_enrollment_page.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/enterprise_program_enrollment_page.html`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 {% extends 'enterprise/base.html' %}
 
-{% load staticfiles enterprise %}
+{% load static enterprise %}
 
 {% block extrahead %}
   <script type="text/javascript" src="{% static 'enterprise/js/program_enrollment_landing_page.js' %}"></script>
   <script type="text/javascript" src="{% static 'enterprise/js/course_modal.js' %}"></script>
 {% endblock %}
 
 {% block contents %}
@@ -61,15 +61,15 @@
                 </div>
               {% endif %}
             </div>
 
             {% if is_learner_eligible_for_one_click_purchase %}
               <form method="POST">
                 <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" />
-                <button class="btn-confirm">{{ confirm_button_text }}</button>
+                <button class="btn btn-primary">{{ confirm_button_text }}</button>
               </form>
             {% endif %}
           </div>
 
           <div class="program-metadata-container">
 
             {# What you'll learn #}
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-{% extends 'enterprise/base.html' %} {% load staticfiles enterprise %} {% block
+{% extends 'enterprise/base.html' %} {% load static enterprise %} {% block
 extrahead %}
  {% endblock %} {% block contents %}
 [{{ program_type }}]
 ***** {{ program_type_description_header }} *****
 {{ program_type_description }}
 ***** {{ platform_description_header }} *****
 {{ platform_description }}
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/admin/clear_learners_data_sharing_consent.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/clear_learners_data_sharing_consent.html`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/admin/manage_learners.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/manage_learners.html`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/admin/transmit_courses_metadata.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/admin/transmit_courses_metadata.html`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/base.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/base.html`

 * *Files 8% similar despite different names*

```diff
@@ -1,23 +1,22 @@
-{% load theme_pipeline staticfiles %}
+{% load theme_pipeline static %}
 {% load configuration  %}
 
 <!DOCTYPE html>
 <!--[if lt IE 7]><html lang="{{ LANGUAGE_CODE|default:"en-us" }}" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
 <!--[if IE 7]>   <html lang="{{ LANGUAGE_CODE|default:"en-us" }}" class="no-js lt-ie9 lt-ie8"> <![endif]-->
 <!--[if IE 8]>   <html lang="{{ LANGUAGE_CODE|default:"en-us" }}" class="no-js lt-ie9"> <![endif]-->
 <!--[if gt IE 8]><!-->
 <html lang="{{ LANGUAGE_CODE|default:"en-us" }}" class="no-js"> <!--<![endif]-->
   <head>
   {% block title %}<title>{{ page_title }} | {{ platform_name }}</title>{% endblock %}
   <meta name="viewport" content="width=device-width, initial-scale=1"/>
   <link rel="icon" type="image/x-icon" href="{% favicon_path %}" />
     {% block styles %}
       {% stylesheet 'style-vendor' %}
-      {% stylesheet 'style-main-v2' %}
       <link rel="stylesheet" type="text/css" href="{% static 'css/vendor/font-awesome.css' %}"/>
       {# TODO: When we move to be a service, use the webpack loader's `render_bundle`. #}
       <link rel="stylesheet" type="text/css" href="{% static 'enterprise/bundles/main.style.css' %}"/>
     {% endblock %}
 
     {% block extrastyles %}{% endblock %}
 
@@ -30,15 +29,17 @@
     {% include "enterprise/widgets/segment-io-django.html" %}
   </head>
 
   <body>
     {% block header %}
       <header class="logo-container">
         <h1>
-          <a href="{{ LMS_ROOT_URL }}"><img class='header-logo' src="{% static 'images/logo.png' %}" alt="{{ header_logo_alt_text }}" /></a>
+          <a href="{{ LMS_ROOT_URL }}">
+            <img class='header-logo' src="{{ logo_url }}" alt="{{ header_logo_alt_text }}" />
+          </a>
           {% if tagline %}
             <span id="header-tagline">{{ tagline }}</span>
           {% endif %}
         </h1>
       </header>
       <hr class="pinstripe"/>
     {% endblock %}
```

#### html2text {}

```diff
@@ -1,15 +1,14 @@
-{% load theme_pipeline staticfiles %} {% load configurationââ%}
+{% load theme_pipeline static %} {% load configurationââ%}
 
  }}" class="no-js">
 {% block title %}
 {% endblock %}
 
- {% block styles %} {% stylesheet 'style-vendor' %} {% stylesheet 'style-main-
-v2' %}
+ {% block styles %} {% stylesheet 'style-vendor' %}
  {# TODO: When we move to be a service, use the webpack loader's
 `render_bundle`. #}
  {% endblock %} {% block extrastyles %}{% endblock %} {% block head %}
  {% endblock %} {% block extrahead %}{% endblock %} {% include "enterprise/
 widgets/segment-io-django.html" %}
 {% block header %}
 ****** [{{_header_logo_alt_text_}}] {% if tagline %} {{ tagline }} {% endif %}
```

### Comparing `edx-enterprise-3.9.9/enterprise/templates/enterprise/_data_sharing_user_input.html` & `edx-enterprise-4.0.0/enterprise/templates/enterprise/_data_sharing_user_input.html`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,18 @@
-{% load i18n staticfiles enterprise %}
+{% load i18n static enterprise %}
 
 <div class="consent-input-container login-register">
   <form name="data-sharing-consent" method="POST" id="data-sharing">
     {% csrf_token %}
     <input class="background-input data-consent-checkbox" type="checkbox" name="data_sharing_consent" id="data-consent-checkbox" value="True"/>
     <p class="agreement-text">
       <label for="data-consent-checkbox">{{ agreement_text }}</label>
     </p>
-    <button type="submit" class="background-input consent-agreement-button" id="consent-button" disabled>{{ continue_text }}</button>
-    <button type="button" class="failure-link background-input" id="failure-link" data-toggle="modal" data-target="#consent-confirmation-modal">
+    <button type="submit" class="background-input btn btn-primary" id="consent-button" disabled>{{ continue_text }}</button>
+    <button type="button" class="btn btn-link background-input" id="failure-link" data-toggle="modal" data-target="#consent-confirmation-modal">
       {{ abort_text }}
     </button>
     <input type="hidden" name="enterprise_customer_uuid" value="{{ enterprise_customer.uuid }}" />
     {% if course_specific and course_id %}
       <input type="hidden" name="course_id" value="{{ course_id }}" />
     {% endif %}
     {% if program_specific and program_uuid %}
```

### Comparing `edx-enterprise-3.9.9/enterprise/heartbeat/checks.py` & `edx-enterprise-4.0.0/enterprise/heartbeat/checks.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,14 +1,18 @@
 """
 Perform health checks om the services enterprise is dependant on.
 """
 import traceback
 
-from requests.exceptions import ConnectionError, Timeout  # pylint: disable=redefined-builtin
-from slumber.exceptions import HttpServerError, SlumberBaseException
+from requests.exceptions import (  # pylint: disable=redefined-builtin
+    ConnectionError,
+    HTTPError,
+    RequestException,
+    Timeout,
+)
 
 from enterprise.api_client.discovery import NoAuthDiscoveryClient
 from enterprise.api_client.ecommerce import NoAuthEcommerceClient
 from enterprise.api_client.enterprise_catalog import NoAuthEnterpriseCatalogClient
 from enterprise.api_client.lms import NoAuthLMSClient
 from enterprise.heartbeat.exceptions import (
     DiscoveryNotAvailable,
@@ -27,20 +31,22 @@
 
     Returns:
         (str, str): A tuple containing service name and a message.
     """
     client = NoAuthLMSClient()
     try:
         client.get_health()
-    except HttpServerError:
-        raise LMSNotAvailable('Service is down.', traceback.format_exc())
-    except (ConnectionError, Timeout):
-        raise LMSNotAvailable('Service is not accessible.', traceback.format_exc())
-    except SlumberBaseException:
-        raise LMSNotAvailable('An error occurred while checking service status.', traceback.format_exc())
+    except HTTPError as error:
+        raise LMSNotAvailable('Service is down.', traceback.format_exc()) from error
+    except (ConnectionError, Timeout) as error:
+        raise LMSNotAvailable('Service is not accessible.', traceback.format_exc()) from error
+    except RequestException as exception:
+        raise LMSNotAvailable(
+            'An error occurred while checking service status.', traceback.format_exc()
+        ) from exception
 
     return 'Learning Management System (LMS)', 'Service is up and running.'
 
 
 def check_ecommerce():
     """
     Check if E-Commerce service is up and running and accessible via API.
@@ -50,20 +56,22 @@
 
     Returns:
         (str, str): A tuple containing service name and a message.
     """
     client = NoAuthEcommerceClient()
     try:
         client.get_health()
-    except HttpServerError:
-        raise EcommerceNotAvailable('Service is down.', traceback.format_exc())
-    except (ConnectionError, Timeout):
-        raise EcommerceNotAvailable('Service is not accessible.', traceback.format_exc())
-    except SlumberBaseException:
-        raise EcommerceNotAvailable('An error occurred while checking service status.', traceback.format_exc())
+    except HTTPError as error:
+        raise EcommerceNotAvailable('Service is down.', traceback.format_exc()) from error
+    except (ConnectionError, Timeout) as error:
+        raise EcommerceNotAvailable('Service is not accessible.', traceback.format_exc()) from error
+    except RequestException as exception:
+        raise EcommerceNotAvailable(
+            'An error occurred while checking service status.', traceback.format_exc()
+        ) from exception
 
     return 'E-Commerce', 'Service is up and running.'
 
 
 def check_discovery():
     """
     Check if course discovery service is up and running and accessible via API.
@@ -73,20 +81,22 @@
 
     Returns:
         (str, str): A tuple containing service name and a message.
     """
     client = NoAuthDiscoveryClient()
     try:
         client.get_health()
-    except HttpServerError:
-        raise DiscoveryNotAvailable('Service is down.', traceback.format_exc())
-    except (ConnectionError, Timeout):
-        raise DiscoveryNotAvailable('Service is not accessible.', traceback.format_exc())
-    except SlumberBaseException:
-        raise DiscoveryNotAvailable('An error occurred while checking service status.', traceback.format_exc())
+    except HTTPError as error:
+        raise DiscoveryNotAvailable('Service is down.', traceback.format_exc()) from error
+    except (ConnectionError, Timeout) as error:
+        raise DiscoveryNotAvailable('Service is not accessible.', traceback.format_exc()) from error
+    except RequestException as exception:
+        raise DiscoveryNotAvailable(
+            'An error occurred while checking service status.', traceback.format_exc()
+        ) from exception
 
     return 'Course Discovery', 'Service is up and running.'
 
 
 def check_enterprise_catalog():
     """
     Check if enterprise catalog service is up and running and accessible via API.
@@ -96,15 +106,17 @@
 
     Returns:
         (str, str): A tuple containing service name and a message.
     """
     client = NoAuthEnterpriseCatalogClient()
     try:
         client.get_health()
-    except HttpServerError:
-        raise EnterpriseCatalogNotAvailable('Service is down.', traceback.format_exc())
-    except (ConnectionError, Timeout):
-        raise EnterpriseCatalogNotAvailable('Service is not accessible.', traceback.format_exc())
-    except SlumberBaseException:
-        raise EnterpriseCatalogNotAvailable('An error occurred while checking service status.', traceback.format_exc())
+    except HTTPError as error:
+        raise EnterpriseCatalogNotAvailable('Service is down.', traceback.format_exc()) from error
+    except (ConnectionError, Timeout) as error:
+        raise EnterpriseCatalogNotAvailable('Service is not accessible.', traceback.format_exc()) from error
+    except RequestException as exception:
+        raise EnterpriseCatalogNotAvailable(
+            'An error occurred while checking service status.', traceback.format_exc()
+        ) from exception
 
     return 'Enterprise Catalog', 'Service is up and running.'
```

### Comparing `edx-enterprise-3.9.9/enterprise/heartbeat/exceptions.py` & `edx-enterprise-4.0.0/enterprise/heartbeat/exceptions.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/heartbeat/utils.py` & `edx-enterprise-4.0.0/enterprise/heartbeat/utils.py`

 * *Files 9% similar despite different names*

```diff
@@ -17,16 +17,16 @@
 LOGGER = logging.getLogger(__name__)
 
 
 class Status:
     """
     Status constants for service health check.
     """
-    OK = u'OK'  # pylint: disable=invalid-name
-    UNAVAILABLE = u'UNAVAILABLE'  # pylint: disable=invalid-name
+    OK = 'OK'
+    UNAVAILABLE = 'UNAVAILABLE'
 
 
 def run_checks():
     """
     Run health checks on all the services and return the status of each service.
 
     Returns:
```

### Comparing `edx-enterprise-3.9.9/enterprise/heartbeat/views.py` & `edx-enterprise-4.0.0/enterprise/heartbeat/views.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/messages.py` & `edx-enterprise-4.0.0/enterprise/messages.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,15 +1,14 @@
-# -*- coding: utf-8 -*-
 """
 Utility functions for interfacing with the Django messages framework.
 """
 
 from django.conf import settings
 from django.contrib import messages
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
 from enterprise.utils import get_configuration_value
 
 
 def add_consent_declined_message(request, enterprise_customer, item):
     """
     Add a message to the Django messages store indicating that the user has declined data sharing consent.
```

### Comparing `edx-enterprise-3.9.9/enterprise/constants.py` & `edx-enterprise-4.0.0/enterprise/constants.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,15 +1,11 @@
-# -*- coding: utf-8 -*-
 """
 Enterprise Django application constants.
 """
-
-import json
-
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 # We listen to the User post_save signal in order to associate new users
 # with an EnterpriseCustomer when applicable. This it the unique identifier
 # used to ensure that signal receiver is only called once.
 USER_POST_SAVE_DISPATCH_UID = "user_post_save_upgrade_pending_enterprise_customer_user"
 
 # Data sharing consent messages
@@ -23,56 +19,71 @@
 )
 CONFIRMATION_ALERT_PROMPT_WARNING = _(
     'If you do not consent to share your course data, that information may be shared with '
     '{enterprise_customer_name}.'
 )
 WELCOME_TEXT = _('Welcome to {platform_name}.')
 ENTERPRISE_WELCOME_TEXT = _(
-    u'You have left the {strong_start}{enterprise_customer_name}{strong_end} website and are now on the '
+    'You have left the {strong_start}{enterprise_customer_name}{strong_end} website and are now on the '
     '{platform_name} site. {enterprise_customer_name} has partnered with {platform_name} to offer you '
     'high-quality, always available learning programs to help you advance your knowledge and career. '
     '{line_break}Please note that {platform_name} has a different {privacy_policy_link_start}Privacy Policy '
     '{privacy_policy_link_end} from {enterprise_customer_name}.'
 )
 
 COURSE_KEY_URL_PATTERN = r'(?P<course_key>[^/+]+(/|\+)[^/+]+)'
 
+MAX_INVITE_KEYS = 100
+
 
 class DefaultColors:
     """
     Class to group the default branding color codes.
     These color codes originated in the Enterprise Learner Portal.
     """
-    PRIMARY = '#1a337b'
-    SECONDARY = '#d7e3fc'
-    TERTIARY = '#007d88'
+    PRIMARY = '#2D494E'
+    SECONDARY = '#F2F0EF'
+    TERTIARY = '#D23228'
 
 
 class CourseModes:
     """
     Class to group modes that a course might have.
     """
 
     AUDIT = 'audit'
     CREDIT = 'credit'
     HONOR = 'honor'
     NO_ID_PROFESSIONAL = 'no-id-professional'
     PROFESSIONAL = 'professional'
     VERIFIED = 'verified'
+    UNPAID_EXECUTIVE_EDUCATION = 'unpaid-executive-education'
 
 
+BEST_MODE_ORDER = [
+    CourseModes.VERIFIED,
+    CourseModes.PROFESSIONAL,
+    CourseModes.NO_ID_PROFESSIONAL,
+    CourseModes.UNPAID_EXECUTIVE_EDUCATION,
+]
+
 # Course mode sorting based on slug
 COURSE_MODE_SORT_ORDER = [
     CourseModes.VERIFIED,
     CourseModes.PROFESSIONAL,
     CourseModes.NO_ID_PROFESSIONAL,
     CourseModes.AUDIT,
     CourseModes.HONOR,
+    CourseModes.UNPAID_EXECUTIVE_EDUCATION,
 ]
 
+EXEC_ED_COURSE_TYPE = "executive-education-2u"
+EXEC_ED_CONTENT_DESCRIPTION_TAG = ("This instructor-led Executive Education course is "
+                                   "presented by GetSmarter, an edX partner. ")
+
 # Course modes that should not be displayed to users.
 EXCLUDED_COURSE_MODES = [CourseModes.CREDIT]
 
 # Number of records to display in each paginated set.
 PAGE_SIZE = 25
 
 PROGRAM_TYPE_DESCRIPTION = {
@@ -93,16 +104,16 @@
         'are designed to provide a deep understanding of key subjects '
         'through a series of courses. Complete the series to earn a valuable '
         'XSeries Certificate that illustrates your achievement.'
     ),
 }
 
 ALLOWED_TAGS = [
-    u'a', u'abbr', u'acronym', u'b', u'blockquote', u'em', u'i',
-    u'li', u'ol', u'strong', u'ul', u'p', u'h1', u'h2',
+    'a', 'abbr', 'acronym', 'b', 'blockquote', 'em', 'i',
+    'li', 'ol', 'strong', 'ul', 'p', 'h1', 'h2',
 ]
 
 DEFAULT_CATALOG_CONTENT_FILTER = {
     'content_type': 'course',
     'partner': 'edx',
     'level_type': [
         'Introductory',
@@ -130,14 +141,18 @@
 ENTERPRISE_OPERATOR_ROLE = 'enterprise_openedx_operator'
 SYSTEM_ENTERPRISE_CATALOG_ADMIN_ROLE = 'enterprise_catalog_admin'
 
 ENTERPRISE_DASHBOARD_ADMIN_ROLE = 'dashboard_admin'
 ENTERPRISE_CATALOG_ADMIN_ROLE = 'catalog_admin'
 ENTERPRISE_ENROLLMENT_API_ADMIN_ROLE = 'enrollment_api_admin'
 ENTERPRISE_REPORTING_CONFIG_ADMIN_ROLE = 'reporting_config_admin'
+ENTERPRISE_FULFILLMENT_OPERATOR_ROLE = 'fulfillment_operator'
+
+# Tracking related
+PATHWAY_CUSTOMER_ADMIN_ENROLLMENT = 'customer-admin-enrollment'
 
 # context to give access to all resources
 ALL_ACCESS_CONTEXT = '*'
 
 # this constant should not be used anymore as it is marked for removal
 ENTERPRISE_ROLE_BASED_ACCESS_CONTROL_SWITCH = 'enterprise_role_based_access_control'
 
@@ -150,19 +165,52 @@
 
 # ContentFilter field types for validation.
 CONTENT_FILTER_FIELD_TYPES = {
     'key': {'type': list, 'subtype': str},
     'first_enrollable_paid_seat_price__lte': {'type': str}
 }
 
+# FEATURE flag that indicates if deletion of EnterpriseCourseEnrollment records via
+# the Django Admin site is allowed.
+ALLOW_ADMIN_ENTERPRISE_COURSE_ENROLLMENT_DELETION = 'ALLOW_ADMIN_ENTERPRISE_COURSE_ENROLLMENT_DELETION'
+
 
 def json_serialized_course_modes():
     """
     :return: serialized course modes.
     """
-    return json.dumps(COURSE_MODE_SORT_ORDER)
+    return COURSE_MODE_SORT_ORDER
 
 
 AVAILABLE_LANGUAGES = [
-    ('en', u'English'),
-    ('es-419', u'Español (Latinoamérica)'),  # Spanish (Latin America)
+    ('en', 'English'),
+    ('es-419', 'Español (Latinoamérica)'),  # Spanish (Latin America)
 ]
+
+LMS_API_DATETIME_FORMAT = '%Y-%m-%dT%H:%M:%SZ'
+LMS_API_DATETIME_FORMAT_WITHOUT_TIMEZONE = '%Y-%m-%dT%H:%M:%S'
+
+TRANSMISSION_MARK_CREATE = 'create'
+TRANSMISSION_MARK_UPDATE = 'update'
+TRANSMISSION_MARK_DELETE = 'delete'
+
+HTTP_STATUS_STRINGS = {
+    400: 'The request was invalid, check the fields you entered are correct.',
+    401: 'The request was unauthorized, check your credentials.',
+    403: 'The request was rejected because it did not have the rights to access the content.',
+    404: 'The requested resource was not found.',
+    408: 'The request timed out.',
+    429: 'The user has sent too many requests.',
+    500: 'An internal problem on our side interfered.',
+    503: 'The server is temporarily unavailable.',
+}
+
+IC_CREATE_ACTION = 'create'
+IC_UPDATE_ACTION = 'update'
+IC_DELETE_ACTION = 'delete'
+
+
+class FulfillmentTypes:
+    LICENSE = 'license'
+    LEARNER_CREDIT = 'learner_credit'
+    COUPON_CODE = 'coupon_code'
+    CHOICES = [(choice, choice.capitalize().replace('_', ' ')) for choice in (LICENSE, LEARNER_CREDIT, COUPON_CODE)]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0060_upgrade_django_simple_history.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0006_upgrade_django_simple_history.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,29 +1,21 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.15 on 2018-12-13 15:23
 # This is necessary because django-simple-history 2.6.0 changes the model
 
 
 import django.db.models.deletion
 from django.db import migrations, models
 
-import enterprise.models
-
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0059_add_code_management_portal_config'),
+        ('degreed', '0005_auto_20180807_1302'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='historicalenterprisecourseenrollment',
-            name='enterprise_customer_user',
-            field=models.ForeignKey(blank=True, db_constraint=False, help_text='The enterprise learner to which this enrollment is attached.', null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomerUser'),
-        ),
-        migrations.AlterField(
-            model_name='historicalenterprisecustomer',
-            name='customer_type',
-            field=models.ForeignKey(blank=True, db_constraint=False, default=enterprise.models.get_default_customer_type, help_text='Specifies enterprise customer type.', null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomerType', verbose_name='Customer Type'),
+            model_name='historicaldegreedenterprisecustomerconfiguration',
+            name='enterprise_customer',
+            field=models.ForeignKey(blank=True, db_constraint=False, help_text='Enterprise Customer associated with the configuration.', null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomer'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0097_auto_20200619_1130.py` & `edx-enterprise-4.0.0/enterprise/migrations/0097_auto_20200619_1130.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0100_add_licensed_enterprise_course_enrollment.py` & `edx-enterprise-4.0.0/enterprise/migrations/0100_add_licensed_enterprise_course_enrollment.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0108_add_licensed_enrollment_is_revoked.py` & `edx-enterprise-4.0.0/enterprise/migrations/0108_add_licensed_enrollment_is_revoked.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0069_auto_20190613_0607.py` & `edx-enterprise-4.0.0/enterprise/migrations/0104_sync_query_field.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,23 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.18 on 2019-06-13 11:07
+# Generated by Django 2.2.14 on 2020-07-28 18:52
 
-
-from django.db import migrations
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0068_remove_role_based_access_control_switch'),
+        ('enterprise', '0103_remove_marked_done'),
     ]
 
     operations = [
-        migrations.RemoveField(
-            model_name='enterprisecustomer',
-            name='catalog',
+        migrations.AddField(
+            model_name='enterprisecustomercatalog',
+            name='sync_enterprise_catalog_query',
+            field=models.BooleanField(default=False),
         ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomer',
-            name='catalog',
+        migrations.AddField(
+            model_name='historicalenterprisecustomercatalog',
+            name='sync_enterprise_catalog_query',
+            field=models.BooleanField(default=False),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0024_enterprisecustomercatalog_historicalenterprisecustomercatalog.py` & `edx-enterprise-4.0.0/enterprise/migrations/0115_enterpriseanalyticsuser_historicalenterpriseanalyticsuser.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,55 +1,54 @@
-# -*- coding: utf-8 -*-
+# Generated by Django 2.2.16 on 2020-10-20 12:07
 
-
-import uuid
-
-import django.db.models.deletion
-import django.utils.timezone
 from django.conf import settings
 from django.db import migrations, models
-
+import django.db.models.deletion
+import django.utils.timezone
 import model_utils.fields
+import simple_history.models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('enterprise', '0023_audit_data_reporting_flag'),
+        ('enterprise', '0114_auto_20201020_0142'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='EnterpriseCustomerCatalog',
+            name='HistoricalEnterpriseAnalyticsUser',
             fields=[
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, verbose_name='created', editable=False)),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, verbose_name='modified', editable=False)),
-                ('uuid', models.UUIDField(default=uuid.uuid4, serialize=False, editable=False, primary_key=True)),
-                ('query', models.TextField(help_text='Query to the course discovery service. Leave empty for all results.')),
-                ('enterprise_customer', models.ForeignKey(related_name='enterprise_customer_catalog', to='enterprise.EnterpriseCustomer', on_delete=django.db.models.deletion.CASCADE)),
+                ('id', models.IntegerField(auto_created=True, blank=True, db_index=True, verbose_name='ID')),
+                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
+                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
+                ('analytics_user_id', models.CharField(help_text='User id in the third party analytics system.', max_length=255)),
+                ('history_id', models.AutoField(primary_key=True, serialize=False)),
+                ('history_date', models.DateTimeField()),
+                ('history_change_reason', models.CharField(max_length=100, null=True)),
+                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
+                ('enterprise_customer_user', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomerUser')),
+                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
             ],
             options={
-                'verbose_name': 'Enterprise Customer Catalog',
-                'verbose_name_plural': 'Enterprise Customer Catalogs',
+                'verbose_name': 'historical enterprise analytics user',
+                'ordering': ('-history_date', '-history_id'),
+                'get_latest_by': 'history_date',
             },
+            bases=(simple_history.models.HistoricalChanges, models.Model),
         ),
         migrations.CreateModel(
-            name='HistoricalEnterpriseCustomerCatalog',
+            name='EnterpriseAnalyticsUser',
             fields=[
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, verbose_name='created', editable=False)),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, verbose_name='modified', editable=False)),
-                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, db_index=True)),
-                ('query', models.TextField(help_text='Query to the course discovery service. Leave empty for all results.')),
-                ('history_id', models.AutoField(serialize=False, primary_key=True)),
-                ('history_date', models.DateTimeField()),
-                ('history_type', models.CharField(max_length=1, choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')])),
-                ('enterprise_customer', models.ForeignKey(related_name='+', on_delete=django.db.models.deletion.DO_NOTHING, db_constraint=False, blank=True, to='enterprise.EnterpriseCustomer', null=True)),
-                ('history_user', models.ForeignKey(related_name='+', on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, null=True)),
+                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
+                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
+                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
+                ('analytics_user_id', models.CharField(help_text='User id in the third party analytics system.', max_length=255)),
+                ('enterprise_customer_user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomerUser')),
             ],
             options={
-                'ordering': ('-history_date', '-history_id'),
-                'get_latest_by': 'history_date',
-                'verbose_name': 'historical Enterprise Customer Catalog',
+                'ordering': ['created'],
+                'unique_together': {('enterprise_customer_user', 'analytics_user_id')},
             },
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0089_auto_20200305_0652.py` & `edx-enterprise-4.0.0/enterprise/migrations/0116_auto_20201116_0400.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,20 +1,18 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.28 on 2020-03-05 12:52
-
+# Generated by Django 2.2.16 on 2020-11-16 10:00
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0088_auto_20200224_1341'),
+        ('enterprise', '0115_enterpriseanalyticsuser_historicalenterpriseanalyticsuser'),
     ]
 
     operations = [
         migrations.AlterField(
             model_name='enterprisecustomerreportingconfiguration',
             name='data_type',
-            field=models.CharField(choices=[('progress', 'progress'), ('progress_v2', 'progress_v2'), ('catalog', 'catalog'), ('engagement', 'engagement')], default='progress', help_text='The type of data this report should contain.', max_length=20, verbose_name='Data Type'),
+            field=models.CharField(choices=[('progress', 'progress'), ('progress_v2', 'progress_v2'), ('catalog', 'catalog'), ('engagement', 'engagement'), ('grade', 'grade'), ('completion', 'completion'), ('course_structure', 'course_structure')], default='progress', help_text='The type of data this report should contain.', max_length=20, verbose_name='Data Type'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0051_add_enterprise_slug.py` & `edx-enterprise-4.0.0/enterprise/migrations/0170_auto_20230301_1627.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,35 +1,24 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.18 on 2023-03-01 16:27
 
 from django.db import migrations, models
-from django.utils.text import slugify
-
-
-def populate_slug(apps, schema_editor):
-    EnterpriseCustomer = apps.get_model('enterprise', 'EnterpriseCustomer')
-
-    enterprises = EnterpriseCustomer.objects.all()
-    for enterprise in enterprises:
-        enterprise.slug = slugify(enterprise.name)
-        enterprise.save()
+import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0050_progress_v2'),
+        ('enterprise', '0169_auto_20230222_1621'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='enterprisecustomer',
-            name='slug',
-            field=models.SlugField(default='default', help_text='A short string uniquely identifying this enterprise. Cannot contain spaces and should be a usable as a CSS class. Examples: "ubc", "mit-staging"', max_length=30, blank=True),
+        migrations.AlterField(
+            model_name='historicalsystemwideenterpriseuserroleassignment',
+            name='enterprise_customer',
+            field=models.ForeignKey(blank=True, db_constraint=False, help_text='The EnterpriseCustomer for which the role is assigned to for the provided user. Defaults to the first active Enterprise Customer that the user is linked to.If another Enterprise Customer object is desired, please first create the record then modify the enterprise customer field by using the drop down.', null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.enterprisecustomer'),
         ),
-        migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='slug',
-            field=models.SlugField(default='default', help_text='A short string uniquely identifying this enterprise. Cannot contain spaces and should be a usable as a CSS class. Examples: "ubc", "mit-staging"', max_length=30, blank=True),
+        migrations.AlterField(
+            model_name='systemwideenterpriseuserroleassignment',
+            name='enterprise_customer',
+            field=models.ForeignKey(blank=True, help_text='The EnterpriseCustomer for which the role is assigned to for the provided user. Defaults to the first active Enterprise Customer that the user is linked to.If another Enterprise Customer object is desired, please first create the record then modify the enterprise customer field by using the drop down.', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='system_wide_role_assignments', to='enterprise.enterprisecustomer'),
         ),
-        migrations.RunPython(populate_slug),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0093_add_use_enterprise_catalog_flag.py` & `edx-enterprise-4.0.0/enterprise/migrations/0093_add_use_enterprise_catalog_flag.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.28 on 2020-03-31 19:13
 
 
 from django.db import migrations
 
 from enterprise.constants import USE_ENTERPRISE_CATALOG
 
@@ -21,13 +20,14 @@
     Flag = apps.get_model('waffle', 'Flag')
     Flag.objects.filter(name=USE_ENTERPRISE_CATALOG).delete()
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0092_auto_20200312_1650'),
+        ('enterprise', '0001_squashed_0092_auto_20200312_1650'),
+        ('waffle', '0001_initial'),
     ]
 
     operations = [
         migrations.RunPython(create_flag, delete_flag)
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0095_auto_20200507_1138.py` & `edx-enterprise-4.0.0/enterprise/migrations/0095_auto_20200507_1138.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0007_auto_20161109_1511.py` & `edx-enterprise-4.0.0/enterprise/migrations/0114_auto_20201020_0142.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.10.2 on 2016-11-09 15:11
-
+# Generated by Django 2.2.16 on 2020-10-20 06:42
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0006_auto_20161121_0241'),
+        ('enterprise', '0113_auto_20200914_2054'),
     ]
 
     operations = [
         migrations.AddField(
             model_name='enterprisecustomer',
-            name='catalog',
-            field=models.PositiveIntegerField(help_text='Course catalog for the Enterprise Customer.', null=True),
+            name='default_language',
+            field=models.CharField(blank=True, choices=[('en', 'English'), ('es-419', 'Español (Latinoamérica)')], default=None, help_text='Specifies the default language for all the learners of this enterprise customer.', max_length=25, null=True),
         ),
         migrations.AddField(
             model_name='historicalenterprisecustomer',
-            name='catalog',
-            field=models.PositiveIntegerField(help_text='Course catalog for the Enterprise Customer.', null=True),
+            name='default_language',
+            field=models.CharField(blank=True, choices=[('en', 'English'), ('es-419', 'Español (Latinoamérica)')], default=None, help_text='Specifies the default language for all the learners of this enterprise customer.', max_length=25, null=True),
         ),
     ]
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0107_remove_branding_config_banner_fields.py` & `edx-enterprise-4.0.0/enterprise/migrations/0107_remove_branding_config_banner_fields.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0101_move_data_to_saved_for_later.py` & `edx-enterprise-4.0.0/enterprise/migrations/0101_move_data_to_saved_for_later.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0059_add_code_management_portal_config.py` & `edx-enterprise-4.0.0/enterprise/migrations/0147_auto_20211129_1949.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.15 on 2018-12-14 17:46
-
+# Generated by Django 2.2.19 on 2021-11-29 19:49
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0058_auto_20181212_0145'),
+        ('enterprise', '0146_enterprise_customer_invite_key'),
     ]
 
     operations = [
         migrations.AddField(
             model_name='enterprisecustomer',
-            name='enable_portal_code_management_screen',
-            field=models.BooleanField(default=False, help_text='Specifies whether to allow access to the code management screen in the admin portal.'),
+            name='enable_universal_link',
+            field=models.BooleanField(default=False, help_text='Specifies whether to allow univeral link generation in the admin portal.'),
         ),
         migrations.AddField(
             model_name='historicalenterprisecustomer',
-            name='enable_portal_code_management_screen',
-            field=models.BooleanField(default=False, help_text='Specifies whether to allow access to the code management screen in the admin portal.'),
+            name='enable_universal_link',
+            field=models.BooleanField(default=False, help_text='Specifies whether to allow univeral link generation in the admin portal.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0025_auto_20170828_1412.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0007_auto_20210708_1446.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,44 +1,23 @@
-# -*- coding: utf-8 -*-
-
-
-import jsonfield.fields
+# Generated by Django 2.2.20 on 2021-07-08 14:46
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0024_enterprisecustomercatalog_historicalenterprisecustomercatalog'),
+        ('cornerstone', '0006_auto_20191001_0742'),
     ]
 
     operations = [
-        migrations.RemoveField(
-            model_name='enterprisecustomercatalog',
-            name='query',
-        ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomercatalog',
-            name='query',
-        ),
-        migrations.AddField(
-            model_name='enterprisecustomercatalog',
-            name='content_filter',
-            field=jsonfield.fields.JSONField(default={}, help_text="Query parameters which will be used to filter the discovery service's search/all endpoint results, specified as a Json object. An empty Json object means that all available content items will be included in the catalog.", null=True, blank=True),
-        ),
-        migrations.AddField(
-            model_name='enterprisecustomercatalog',
-            name='title',
-            field=models.CharField(default='All Content', max_length=20),
-        ),
-        migrations.AddField(
-            model_name='historicalenterprisecustomercatalog',
-            name='content_filter',
-            field=jsonfield.fields.JSONField(default={}, help_text="Query parameters which will be used to filter the discovery service's search/all endpoint results, specified as a Json object. An empty Json object means that all available content items will be included in the catalog.", null=True, blank=True),
-        ),
-        migrations.AddField(
-            model_name='historicalenterprisecustomercatalog',
-            name='title',
-            field=models.CharField(default='All Content', max_length=20),
+        migrations.AlterField(
+            model_name='cornerstoneenterprisecustomerconfiguration',
+            name='catalogs_to_transmit',
+            field=models.TextField(blank=True, help_text='A comma-separated list of catalog UUIDs to transmit. If blank, all customer catalogs will be transmitted. If there are overlapping courses in the customer catalogs, the overlapping course metadata will be selected from the newest catalog.', null=True),
+        ),
+        migrations.AlterField(
+            model_name='historicalcornerstoneenterprisecustomerconfiguration',
+            name='catalogs_to_transmit',
+            field=models.TextField(blank=True, help_text='A comma-separated list of catalog UUIDs to transmit. If blank, all customer catalogs will be transmitted. If there are overlapping courses in the customer catalogs, the overlapping course metadata will be selected from the newest catalog.', null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0012_auto_20170125_1033.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0014_auto_20220131_1539.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.11 on 2022-01-31 15:39
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0011_enterprisecustomerentitlement_historicalenterprisecustomerentitlement'),
+        ('cornerstone', '0013_auto_20220126_1837'),
     ]
 
     operations = [
-        migrations.AlterField(
-            model_name='enterprisecustomer',
-            name='catalog',
-            field=models.PositiveIntegerField(help_text='Course catalog for the Enterprise Customer.', null=True, blank=True),
+        migrations.AddField(
+            model_name='cornerstoneenterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=30),
         ),
-        migrations.AlterField(
-            model_name='historicalenterprisecustomer',
-            name='catalog',
-            field=models.PositiveIntegerField(help_text='Course catalog for the Enterprise Customer.', null=True, blank=True),
+        migrations.AddField(
+            model_name='historicalcornerstoneenterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=30),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0112_auto_20200914_0926.py` & `edx-enterprise-4.0.0/enterprise/migrations/0112_auto_20200914_0926.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0111_pendingenterprisecustomeradminuser.py` & `edx-enterprise-4.0.0/enterprise/migrations/0111_pendingenterprisecustomeradminuser.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0020_auto_20170624_2316.py` & `edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0010_auto_20221021_0159.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,40 +1,43 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.10.7 on 2017-06-25 04:16
-
+# Generated by Django 3.2.16 on 2022-10-21 01:59
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0019_auto_20170606_1853'),
+        ('blackboard', '0009_auto_20220929_1720'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='historicalenrollmentnotificationemailtemplate',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+            model_name='blackboardlearnerassessmentdatatransmissionaudit',
+            name='content_title',
+            field=models.CharField(blank=True, default=None, max_length=255, null=True),
+        ),
+        migrations.AddField(
+            model_name='blackboardlearnerassessmentdatatransmissionaudit',
+            name='progress_status',
+            field=models.CharField(blank=True, max_length=255),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecourseenrollment',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+            model_name='blackboardlearnerassessmentdatatransmissionaudit',
+            name='user_email',
+            field=models.CharField(blank=True, max_length=255, null=True),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+            model_name='blackboardlearnerdatatransmissionaudit',
+            name='content_title',
+            field=models.CharField(blank=True, default=None, max_length=255, null=True),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomerentitlement',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+            model_name='blackboardlearnerdatatransmissionaudit',
+            name='progress_status',
+            field=models.CharField(blank=True, max_length=255),
         ),
         migrations.AddField(
-            model_name='historicaluserdatasharingconsentaudit',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+            model_name='blackboardlearnerdatatransmissionaudit',
+            name='user_email',
+            field=models.CharField(blank=True, max_length=255, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0044_reporting_config_multiple_types.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0008_alter_moodleenterprisecustomerconfiguration_enterprise_customer.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,33 +1,20 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.8 on 2021-12-20 17:24
 
 from django.db import migrations, models
+import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0043_auto_20180507_0138'),
+        ('enterprise', '0151_add_is_active_to_invite_key'),
+        ('moodle', '0007_auto_20210923_1727'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='enterprisecustomerreportingconfiguration',
+            model_name='moodleenterprisecustomerconfiguration',
             name='enterprise_customer',
-            field=models.ForeignKey(related_name='reporting_configurations', verbose_name='Enterprise Customer', to='enterprise.EnterpriseCustomer', on_delete=models.CASCADE),
-        ),
-        migrations.AddField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='data_type',
-            field=models.CharField(default='progress', help_text='The type of data this report should contain.', max_length=20, verbose_name='Data Type', choices=[('progress', 'progress'), ('catalog', 'catalog')]),
-        ),
-        migrations.AddField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='report_type',
-            field=models.CharField(default='csv', help_text='The type this report should be sent as, e.g. CSV.', max_length=20, verbose_name='Report Type', choices=[('csv', 'csv')]),
-        ),
-        migrations.AlterUniqueTogether(
-            name='enterprisecustomerreportingconfiguration',
-            unique_together=set([('enterprise_customer', 'data_type', 'report_type', 'delivery_method')]),
+            field=models.ForeignKey(help_text='Enterprise Customer associated with the configuration.', on_delete=django.db.models.deletion.CASCADE, to='enterprise.enterprisecustomer'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0010_auto_20161222_1212.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0001_initial.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,33 +1,28 @@
-# -*- coding: utf-8 -*-
-
-
-import django
 import django.utils.timezone
 from django.db import migrations, models
 
 import model_utils.fields
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0009_auto_20161130_1651'),
+        ('enterprise', '0001_squashed_0092_auto_20200312_1650'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='PendingEnrollment',
+            name='XAPILRSConfiguration',
             fields=[
-                ('id', models.AutoField(verbose_name='ID', serialize=False, auto_created=True, primary_key=True)),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, verbose_name='created', editable=False)),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, verbose_name='modified', editable=False)),
-                ('course_id', models.CharField(max_length=255)),
-                ('course_mode', models.CharField(max_length=25)),
-                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.PendingEnterpriseCustomerUser')),
+                ('id', models.AutoField(verbose_name='ID', primary_key=True, serialize=False, auto_created=True)),
+                ('created', model_utils.fields.AutoCreatedField(verbose_name='created', default=django.utils.timezone.now, editable=False)),
+                ('modified', model_utils.fields.AutoLastModifiedField(verbose_name='modified', default=django.utils.timezone.now, editable=False)),
+                ('version', models.CharField(help_text='Version of X-API.', default='1.0.1', max_length=16)),
+                ('endpoint', models.URLField(help_text='URL of the LRS.')),
+                ('key', models.CharField(help_text='Key of X-API LRS.', verbose_name='Client ID', max_length=255)),
+                ('secret', models.CharField(help_text='secret of X-API LRS.', verbose_name='Client Secret', max_length=255)),
+                ('active', models.BooleanField(help_text='Is this configuration active?')),
+                ('enterprise_customer', models.OneToOneField(to='enterprise.EnterpriseCustomer', help_text='Enterprise Customer associated with the configuration.', on_delete=models.CASCADE)),
             ],
         ),
-        migrations.AlterUniqueTogether(
-            name='pendingenrollment',
-            unique_together=set([('user', 'course_id')]),
-        ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0102_auto_20200708_1615.py` & `edx-enterprise-4.0.0/enterprise/migrations/0102_auto_20200708_1615.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0056_enterprisecustomerreportingconfiguration_pgp_encryption_key.py` & `edx-enterprise-4.0.0/enterprise/migrations/0134_enterprisecustomerreportingconfiguration_enable_compression.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,20 +1,18 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.15 on 2018-10-25 11:59
-
+# Generated by Django 2.2.20 on 2021-06-10 08:17
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0055_auto_20181015_1112'),
+        ('enterprise', '0133_auto_20210608_1931'),
     ]
 
     operations = [
         migrations.AddField(
             model_name='enterprisecustomerreportingconfiguration',
-            name='pgp_encryption_key',
-            field=models.TextField(blank=True, help_text='The key for encryption, if PGP encrypted file is required.', null=True, verbose_name='PGP Encryption Key'),
+            name='enable_compression',
+            field=models.BooleanField(default=True, help_text='Specifies whether report should be compressed. Without compression files will not be password protected or encrypted.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0040_auto_20180129_1428.py` & `edx-enterprise-4.0.0/enterprise/migrations/0122_remove_field_sync_enterprise_catalog_query.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,27 +1,21 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11 on 2018-01-29 20:28
-
+# Generated by Django 2.2.17 on 2021-02-02 17:47
 
 from django.db import migrations
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0039_auto_20180129_1034'),
+        ('enterprise', '0121_systemwiderole_add_ent_cust_field'),
     ]
 
     operations = [
         migrations.RemoveField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='initialization_vector',
-        ),
-        migrations.RemoveField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='password',
+            model_name='enterprisecustomercatalog',
+            name='sync_enterprise_catalog_query',
         ),
         migrations.RemoveField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='sftp_password',
+            model_name='historicalenterprisecustomercatalog',
+            name='sync_enterprise_catalog_query',
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0008_auto_20161124_2355.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0007_auto_20190925_0730.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,44 +1,29 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.10.3 on 2016-11-24 23:55
+# Generated by Django 1.11.23 on 2019-09-25 07:30
 
 
-import django.db.models.deletion
-import django.utils.timezone
 from django.db import migrations, models
 
-import model_utils.fields
-
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0007_auto_20161109_1511'),
+        ('degreed', '0006_upgrade_django_simple_history'),
     ]
 
     operations = [
-        migrations.CreateModel(
-            name='EnterpriseCustomerIdentityProvider',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('provider_id', models.SlugField(help_text='Slug field containing a unique identifier for the identity provider.', unique=True)),
-            ],
-            options={
-                'abstract': False,
-            },
-        ),
-        migrations.RemoveField(
-            model_name='enterprisecustomer',
-            name='identity_provider',
-        ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomer',
-            name='identity_provider',
+        migrations.AddField(
+            model_name='degreedenterprisecustomerconfiguration',
+            name='channel_worker_username',
+            field=models.CharField(blank=True, help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255, null=True),
         ),
         migrations.AddField(
-            model_name='enterprisecustomeridentityprovider',
-            name='enterprise_customer',
-            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='enterprise_customer_identity_provider', to='enterprise.EnterpriseCustomer'),
+            model_name='historicaldegreedenterprisecustomerconfiguration',
+            name='channel_worker_username',
+            field=models.CharField(blank=True, help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255, null=True),
+        ),
+        migrations.AlterField(
+            model_name='degreedlearnerdatatransmissionaudit',
+            name='enterprise_course_enrollment_id',
+            field=models.PositiveIntegerField(db_index=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0028_link_enterprise_to_enrollment_template.py` & `edx-enterprise-4.0.0/enterprise/migrations/0174_auto_20230608_2041.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,31 +1,24 @@
-# -*- coding: utf-8 -*-
+# Generated by Django 3.2.19 on 2023-06-08 20:41
 
-
-import django.db.models.deletion
 from django.db import migrations, models
+import enterprise.utils
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0027_remove_account_level_consent'),
+        ('enterprise', '0173_auto_20230531_1459'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='enrollmentnotificationemailtemplate',
-            name='enterprise_customer',
-            field=models.OneToOneField(related_name='enterprise_enrollment_template', default=None, to='enterprise.EnterpriseCustomer', on_delete=models.CASCADE),
-            preserve_default=False,
-        ),
-        migrations.AddField(
-            model_name='historicalenrollmentnotificationemailtemplate',
-            name='enterprise_customer',
-            field=models.ForeignKey(related_name='+', on_delete=django.db.models.deletion.DO_NOTHING, db_constraint=False, blank=True, to='enterprise.EnterpriseCustomer', null=True),
+        migrations.AlterField(
+            model_name='enterprisecustomerinvitekey',
+            name='expiration_date',
+            field=models.DateTimeField(default=enterprise.utils.get_default_invite_key_expiration_date, help_text='The key will no longer be valid after this date.'),
         ),
         migrations.AlterField(
-            model_name='enrollmentnotificationemailtemplate',
-            name='site',
-            field=models.OneToOneField(related_name='enterprise_enrollment_template', null=True, blank=True, to='sites.Site', on_delete=models.CASCADE),
+            model_name='historicalenterprisecustomerinvitekey',
+            name='expiration_date',
+            field=models.DateTimeField(default=enterprise.utils.get_default_invite_key_expiration_date, help_text='The key will no longer be valid after this date.'),
         ),
-]
+    ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0099_auto_20200702_1537.py` & `edx-enterprise-4.0.0/enterprise/migrations/0099_auto_20200702_1537.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0001_initial.py` & `edx-enterprise-4.0.0/enterprise/migrations/0135_adminnotification_adminnotificationfilter_adminnotificationread.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,75 +1,65 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.10.2 on 2016-10-21 11:55
-
-
-import uuid
+# Generated by Django 2.2.19 on 2021-06-14 15:02
 
+from django.db import migrations, models
 import django.db.models.deletion
 import django.utils.timezone
-from django.conf import settings
-from django.db import migrations, models
-
 import model_utils.fields
 
 
 class Migration(migrations.Migration):
 
-    initial = True
-
     dependencies = [
-        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
+        ('enterprise', '0134_enterprisecustomerreportingconfiguration_enable_compression'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='EnterpriseCustomer',
+            name='AdminNotificationFilter',
             fields=[
+                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
-                ('name', models.CharField(help_text='Enterprise Customer name.', max_length=255)),
-                ('active', models.BooleanField(default=True)),
+                ('filter', models.CharField(help_text='Filters to show banner notifications conditionally.', max_length=50, unique=True)),
             ],
             options={
-                'verbose_name': 'Enterprise Customer',
-                'verbose_name_plural': 'Enterprise Customers',
+                'verbose_name': 'Admin Notification Filter',
+                'verbose_name_plural': 'Admin Notification Filters',
+                'ordering': ('filter',),
             },
         ),
         migrations.CreateModel(
-            name='EnterpriseCustomerUser',
+            name='AdminNotification',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('user_id', models.PositiveIntegerField()),
-                ('enterprise_customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomer')),
+                ('text', models.CharField(help_text='Notification banner which will appear to enterprise admin on admin portal.', max_length=255)),
+                ('is_active', models.BooleanField(default=True)),
+                ('start_date', models.DateField(default=django.utils.timezone.now)),
+                ('expiration_date', models.DateField(default=django.utils.timezone.now)),
+                ('admin_notification_filter', models.ManyToManyField(blank=True, related_name='notification_filter', to='enterprise.AdminNotificationFilter')),
             ],
             options={
-                'verbose_name': 'Enterprise Customer User',
-                'verbose_name_plural': 'Enterprise Customer Users',
+                'verbose_name': 'Enterprise Customer Admin Notification',
+                'verbose_name_plural': 'Enterprise Customer Admin Notifications',
+                'ordering': ('start_date',),
             },
         ),
         migrations.CreateModel(
-            name='HistoricalEnterpriseCustomer',
+            name='AdminNotificationRead',
             fields=[
+                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('uuid', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
-                ('name', models.CharField(help_text='Enterprise Customer name.', max_length=255)),
-                ('active', models.BooleanField(default=True)),
-                ('history_id', models.AutoField(primary_key=True, serialize=False)),
-                ('history_date', models.DateTimeField()),
-                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
-                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
+                ('is_read', models.BooleanField(default=False)),
+                ('admin_notification', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.AdminNotification')),
+                ('enterprise_customer_user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomerUser')),
             ],
             options={
-                'ordering': ('-history_date', '-history_id'),
-                'get_latest_by': 'history_date',
-                'verbose_name': 'historical Enterprise Customer',
+                'verbose_name': 'Admin Notification Read',
+                'verbose_name_plural': 'Admin Notifications Read',
+                'ordering': ('is_read',),
+                'unique_together': {('enterprise_customer_user', 'admin_notification')},
             },
         ),
-        migrations.AlterUniqueTogether(
-            name='enterprisecustomeruser',
-            unique_together=set([('enterprise_customer', 'user_id')]),
-        ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0001_squashed_0092_auto_20200312_1650.py` & `edx-enterprise-4.0.0/enterprise/migrations/0001_squashed_0092_auto_20200312_1650.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.29 on 2020-04-11 18:27
 
 
 import collections
 import uuid
 
 import django_countries.fields
@@ -95,16 +94,14 @@
     EnterpriseFeatureRole.objects.filter(
         name__in=[ENTERPRISE_REPORTING_CONFIG_ADMIN_ROLE]
     ).delete()
 
 
 class Migration(migrations.Migration):
 
-    replaces = [('enterprise', '0001_initial'), ('enterprise', '0002_enterprisecustomerbrandingconfiguration'), ('enterprise', '0003_auto_20161104_0937'), ('enterprise', '0004_auto_20161114_0434'), ('enterprise', '0005_pendingenterprisecustomeruser'), ('enterprise', '0006_auto_20161121_0241'), ('enterprise', '0007_auto_20161109_1511'), ('enterprise', '0008_auto_20161124_2355'), ('enterprise', '0009_auto_20161130_1651'), ('enterprise', '0010_auto_20161222_1212'), ('enterprise', '0011_enterprisecustomerentitlement_historicalenterprisecustomerentitlement'), ('enterprise', '0012_auto_20170125_1033'), ('enterprise', '0013_auto_20170125_1157'), ('enterprise', '0014_enrollmentnotificationemailtemplate_historicalenrollmentnotificationemailtemplate'), ('enterprise', '0015_auto_20170130_0003'), ('enterprise', '0016_auto_20170405_0647'), ('enterprise', '0017_auto_20170508_1341'), ('enterprise', '0018_auto_20170511_1357'), ('enterprise', '0019_auto_20170606_1853'), ('enterprise', '0020_auto_20170624_2316'), ('enterprise', '0021_auto_20170711_0712'), ('enterprise', '0022_auto_20170720_1543'), ('enterprise', '0023_audit_data_reporting_flag'), ('enterprise', '0024_enterprisecustomercatalog_historicalenterprisecustomercatalog'), ('enterprise', '0025_auto_20170828_1412'), ('enterprise', '0026_make_require_account_level_consent_nullable'), ('enterprise', '0027_remove_account_level_consent'), ('enterprise', '0028_link_enterprise_to_enrollment_template'), ('enterprise', '0029_auto_20170925_1909'), ('enterprise', '0030_auto_20171005_1600'), ('enterprise', '0031_auto_20171012_1249'), ('enterprise', '0032_reporting_model'), ('enterprise', '0033_add_history_change_reason_field'), ('enterprise', '0034_auto_20171023_0727'), ('enterprise', '0035_auto_20171212_1129'), ('enterprise', '0036_sftp_reporting_support'), ('enterprise', '0037_auto_20180110_0450'), ('enterprise', '0038_auto_20180122_1427'), ('enterprise', '0039_auto_20180129_1034'), ('enterprise', '0040_auto_20180129_1428'), ('enterprise', '0041_auto_20180212_1507'), ('enterprise', '0042_replace_sensitive_sso_username'), ('enterprise', '0043_auto_20180507_0138'), ('enterprise', '0044_reporting_config_multiple_types'), ('enterprise', '0045_report_type_json'), ('enterprise', '0046_remove_unique_constraints'), ('enterprise', '0047_auto_20180517_0457'), ('enterprise', '0048_enterprisecustomeruser_active'), ('enterprise', '0049_auto_20180531_0321'), ('enterprise', '0050_progress_v2'), ('enterprise', '0051_add_enterprise_slug'), ('enterprise', '0052_create_unique_slugs'), ('enterprise', '0053_pendingenrollment_cohort_name'), ('enterprise', '0053_auto_20180911_0811'), ('enterprise', '0054_merge_20180914_1511'), ('enterprise', '0055_auto_20181015_1112'), ('enterprise', '0056_enterprisecustomerreportingconfiguration_pgp_encryption_key'), ('enterprise', '0057_enterprisecustomerreportingconfiguration_enterprise_customer_catalogs'), ('enterprise', '0058_auto_20181212_0145'), ('enterprise', '0059_add_code_management_portal_config'), ('enterprise', '0060_upgrade_django_simple_history'), ('enterprise', '0061_systemwideenterpriserole_systemwideenterpriseuserroleassignment'), ('enterprise', '0062_add_system_wide_enterprise_roles'), ('enterprise', '0063_systemwideenterpriserole_description'), ('enterprise', '0064_enterprisefeaturerole_enterprisefeatureuserroleassignment'), ('enterprise', '0065_add_enterprise_feature_roles'), ('enterprise', '0066_add_system_wide_enterprise_operator_role'), ('enterprise', '0067_add_role_based_access_control_switch'), ('enterprise', '0068_remove_role_based_access_control_switch'), ('enterprise', '0069_auto_20190613_0607'), ('enterprise', '0070_enterprise_catalog_query'), ('enterprise', '0071_historicalpendingenrollment_historicalpendingenterprisecustomeruser'), ('enterprise', '0072_add_enterprise_report_config_feature_role'), ('enterprise', '0073_enterprisecustomerreportingconfiguration_uuid'), ('enterprise', '0074_auto_20190904_1143'), ('enterprise', '0075_auto_20190916_1030'), ('enterprise', '0076_auto_20190918_2037'), ('enterprise', '0077_auto_20191002_1529'), ('enterprise', '0078_auto_20191107_1536'), ('enterprise', '0079_AddEnterpriseEnrollmentSource'), ('enterprise', '0080_auto_20191113_1708'), ('enterprise', '0081_UpdateEnterpriseEnrollmentSource'), ('enterprise', '0082_AddManagementEnterpriseEnrollmentSource'), ('enterprise', '0083_enterprisecustomerreportingconfiguration_include_date'), ('enterprise', '0084_auto_20200120_1137'), ('enterprise', '0085_enterprisecustomeruser_linked'), ('enterprise', '0086_auto_20200128_1726'), ('enterprise', '0087_auto_20200206_1151'), ('enterprise', '0088_auto_20200224_1341'), ('enterprise', '0089_auto_20200305_0652'), ('enterprise', '0090_update_content_filter'), ('enterprise', '0091_add_sales_force_id_in_pendingenrollment'), ('enterprise', '0092_auto_20200312_1650')]
-
     initial = True
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
         ('sites', '0002_alter_domain_unique'),
     ]
 
@@ -135,27 +132,14 @@
             options={
                 'verbose_name': 'Enterprise Catalog Query',
                 'verbose_name_plural': 'Enterprise Catalog Queries',
                 'ordering': ['created'],
             },
         ),
         migrations.CreateModel(
-            name='EnterpriseCourseEnrollment',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('course_id', models.CharField(help_text='The ID of the course in which the learner was enrolled.', max_length=255)),
-                ('marked_done', models.BooleanField(default=False, help_text='Specifies whether a user marked this course as completed in the learner portal.')),
-            ],
-            options={
-                'ordering': ['created'],
-            },
-        ),
-        migrations.CreateModel(
             name='EnterpriseCustomer',
             fields=[
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
                 ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                 ('name', models.CharField(help_text='Enterprise Customer name.', max_length=255)),
                 ('slug', models.SlugField(default='default', help_text='A short string uniquely identifying this enterprise. Cannot contain spaces and should be a usable as a CSS class. Examples: "ubc", "mit-staging"', max_length=30, unique=True)),
@@ -288,14 +272,28 @@
             options={
                 'verbose_name': 'Enterprise Customer Learner',
                 'verbose_name_plural': 'Enterprise Customer Learners',
                 'ordering': ['-active', '-modified'],
             },
         ),
         migrations.CreateModel(
+            name='EnterpriseCourseEnrollment',
+            fields=[
+                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
+                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
+                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
+                ('course_id', models.CharField(help_text='The ID of the course in which the learner was enrolled.', max_length=255)),
+                ('marked_done', models.BooleanField(default=False, help_text='Specifies whether a user marked this course as completed in the learner portal.')),
+                ('enterprise_customer_user', models.ForeignKey(help_text='The enterprise learner to which this enrollment is attached.', on_delete=django.db.models.deletion.CASCADE, related_name='enterprise_enrollments', to='enterprise.EnterpriseCustomerUser')),
+            ],
+            options={
+                'ordering': ['created'],
+            },
+        ),
+        migrations.CreateModel(
             name='EnterpriseEnrollmentSource',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
                 ('name', models.CharField(max_length=64)),
                 ('slug', models.SlugField(max_length=30, unique=True)),
@@ -560,38 +558,33 @@
         migrations.AddField(
             model_name='enterprisecustomer',
             name='site',
             field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enterprise_customers', to='sites.Site'),
         ),
         migrations.AddField(
             model_name='enterprisecourseenrollment',
-            name='enterprise_customer_user',
-            field=models.ForeignKey(help_text='The enterprise learner to which this enrollment is attached.', on_delete=django.db.models.deletion.CASCADE, related_name='enterprise_enrollments', to='enterprise.EnterpriseCustomerUser'),
-        ),
-        migrations.AddField(
-            model_name='enterprisecourseenrollment',
             name='source',
             field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to='enterprise.EnterpriseEnrollmentSource'),
         ),
         migrations.AddField(
             model_name='enrollmentnotificationemailtemplate',
             name='enterprise_customer',
             field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='enterprise_enrollment_template', to='enterprise.EnterpriseCustomer'),
         ),
         migrations.AlterUniqueTogether(
             name='pendingenrollment',
-            unique_together=set([('user', 'course_id')]),
+            unique_together={('user', 'course_id')},
         ),
         migrations.AlterUniqueTogether(
             name='enterprisecustomeruser',
-            unique_together=set([('enterprise_customer', 'user_id')]),
+            unique_together={('enterprise_customer', 'user_id')},
         ),
         migrations.AlterUniqueTogether(
             name='enterprisecourseenrollment',
-            unique_together=set([('enterprise_customer_user', 'course_id')]),
+            unique_together={('enterprise_customer_user', 'course_id')},
         ),
         migrations.RunPython(
             code=create_enterprise_roles,
             reverse_code=delete_enterprise_roles,
         ),
         migrations.RunPython(
             code=add_enterprise_enrollment_sources,
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0027_remove_account_level_consent.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0016_auto_20220324_1550.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,48 +1,48 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.12 on 2022-03-24 15:50
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0026_make_require_account_level_consent_nullable'),
+        ('cornerstone', '0015_auto_20220302_2231'),
     ]
 
     operations = [
-        migrations.RemoveField(
-            model_name='historicaluserdatasharingconsentaudit',
-            name='history_user',
-        ),
-        migrations.RemoveField(
-            model_name='historicaluserdatasharingconsentaudit',
-            name='user',
-        ),
-        migrations.RemoveField(
-            model_name='userdatasharingconsentaudit',
-            name='user',
-        ),
-        migrations.RemoveField(
-            model_name='enterprisecourseenrollment',
-            name='consent_granted',
-        ),
-        migrations.RemoveField(
-            model_name='enterprisecustomer',
-            name='require_account_level_consent',
-        ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecourseenrollment',
-            name='consent_granted',
-        ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomer',
-            name='require_account_level_consent',
-        ),
-        migrations.DeleteModel(
-            name='HistoricalUserDataSharingConsentAudit',
-        ),
-        migrations.DeleteModel(
-            name='UserDataSharingConsentAudit',
+        migrations.AddField(
+            model_name='cornerstonelearnerdatatransmissionaudit',
+            name='enterprise_customer_uuid',
+            field=models.UUIDField(blank=True, null=True),
+        ),
+        migrations.AddField(
+            model_name='cornerstonelearnerdatatransmissionaudit',
+            name='instructor_name',
+            field=models.CharField(blank=True, max_length=255),
+        ),
+        migrations.AddField(
+            model_name='cornerstonelearnerdatatransmissionaudit',
+            name='plugin_configuration_id',
+            field=models.PositiveIntegerField(blank=True, null=True),
+        ),
+        migrations.AddField(
+            model_name='cornerstonelearnerdatatransmissionaudit',
+            name='total_hours',
+            field=models.FloatField(blank=True, null=True),
+        ),
+        migrations.AlterField(
+            model_name='cornerstonelearnerdatatransmissionaudit',
+            name='completed_timestamp',
+            field=models.DateTimeField(blank=True, null=True),
+        ),
+        migrations.AlterField(
+            model_name='cornerstonelearnerdatatransmissionaudit',
+            name='course_completed',
+            field=models.BooleanField(default=True),
+        ),
+        migrations.AlterField(
+            model_name='cornerstonelearnerdatatransmissionaudit',
+            name='course_id',
+            field=models.CharField(max_length=255),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0073_enterprisecustomerreportingconfiguration_uuid.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0016_auto_20220302_2231.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,35 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.23 on 2019-08-19 16:46
-
-
-import uuid
+# Generated by Django 3.2.12 on 2022-03-02 22:31
 
 from django.db import migrations, models
 
 
-def create_uuid(apps, schema_editor):
-    reporting_config = apps.get_model('enterprise', 'EnterpriseCustomerReportingConfiguration')
-    for config in reporting_config.objects.all():
-        config.uuid = uuid.uuid4()
-        config.save()
-
-
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0072_add_enterprise_report_config_feature_role'),
+        ('degreed', '0015_auto_20220131_1539'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='uuid',
-            field=models.UUIDField(default=uuid.uuid4, blank=True, null=True),
+        migrations.AlterField(
+            model_name='degreedenterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=255),
         ),
-        migrations.RunPython(create_uuid, migrations.RunPython.noop),
         migrations.AlterField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='uuid',
-            field=models.UUIDField(default=uuid.uuid4, unique=True)
+            model_name='historicaldegreedenterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=255),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0037_auto_20180110_0450.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0012_alter_canvasenterprisecustomerconfiguration_enterprise_customer.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,24 +1,20 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.8 on 2021-12-20 17:24
 
 from django.db import migrations, models
+import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0036_sftp_reporting_support'),
+        ('enterprise', '0151_add_is_active_to_invite_key'),
+        ('canvas', '0011_auto_20210923_1727'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='enterprisecustomerentitlement',
-            name='entitlement_id',
-            field=models.PositiveIntegerField(help_text="Enterprise customer's entitlement id for relationship with e-commerce coupon.", unique=True, verbose_name='Seat Entitlement'),
-        ),
-        migrations.AlterField(
-            model_name='historicalenterprisecustomerentitlement',
-            name='entitlement_id',
-            field=models.PositiveIntegerField(help_text="Enterprise customer's entitlement id for relationship with e-commerce coupon.", verbose_name='Seat Entitlement', db_index=True),
+            model_name='canvasenterprisecustomerconfiguration',
+            name='enterprise_customer',
+            field=models.ForeignKey(help_text='Enterprise Customer associated with the configuration.', on_delete=django.db.models.deletion.CASCADE, to='enterprise.enterprisecustomer'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0057_enterprisecustomerreportingconfiguration_enterprise_customer_catalogs.py` & `edx-enterprise-4.0.0/enterprise/migrations/0124_auto_20210301_1309.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,20 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.15 on 2018-12-05 17:29
-
+# Generated by Django 2.2.19 on 2021-03-01 13:09
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0056_enterprisecustomerreportingconfiguration_pgp_encryption_key'),
+        ('enterprise', '0123_enterprisecustomeridentityprovider_default_provider'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='enterprise_customer_catalogs',
-            field=models.ManyToManyField(to='enterprise.EnterpriseCustomerCatalog', verbose_name='Enterprise Customer Catalogs'),
+        migrations.AlterField(
+            model_name='enterprisecustomer',
+            name='sender_alias',
+            field=models.CharField(blank=True, help_text='Specifies enterprise customized sender alias.', max_length=255, null=True),
+        ),
+        migrations.AlterField(
+            model_name='historicalenterprisecustomer',
+            name='sender_alias',
+            field=models.CharField(blank=True, help_text='Specifies enterprise customized sender alias.', max_length=255, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0092_auto_20200312_1650.py` & `edx-enterprise-4.0.0/enterprise/migrations/0098_auto_20200629_1756.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.27 on 2020-03-12 21:50
-
+# Generated by Django 2.2.13 on 2020-06-29 17:56
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0091_add_sales_force_id_in_pendingenrollment'),
+        ('enterprise', '0097_auto_20200619_1130'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomer',
-            name='enable_portal_subscription_management_screen',
-            field=models.BooleanField(default=False, help_text='Specifies whether to allow access to the subscription management screen in the admin portal.'),
+            model_name='enterprisecourseenrollment',
+            name='saved_for_later',
+            field=models.BooleanField(default=False, help_text='Specifies whether a user marked this course as saved for later in the learner portal.'),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='enable_portal_subscription_management_screen',
-            field=models.BooleanField(default=False, help_text='Specifies whether to allow access to the subscription management screen in the admin portal.'),
+            model_name='historicalenterprisecourseenrollment',
+            name='saved_for_later',
+            field=models.BooleanField(default=False, help_text='Specifies whether a user marked this course as saved for later in the learner portal.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0050_progress_v2.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0026_auto_20221031_1855.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,20 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.13 on 2018-05-31 09:36
-
+# Generated by Django 3.2.15 on 2022-10-31 18:55
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0049_auto_20180531_0321'),
+        ('canvas', '0025_auto_20221021_0159'),
     ]
 
     operations = [
-        migrations.AlterField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='data_type',
-            field=models.CharField(choices=[('progress', 'progress'), ('progress_v2', 'progress_v2'), ('catalog', 'catalog')], default='progress', help_text='The type of data this report should contain.', max_length=20, verbose_name='Data Type'),
+        migrations.AddField(
+            model_name='canvasenterprisecustomerconfiguration',
+            name='deleted_at',
+            field=models.DateTimeField(blank=True, null=True),
+        ),
+        migrations.AddField(
+            model_name='historicalcanvasenterprisecustomerconfiguration',
+            name='deleted_at',
+            field=models.DateTimeField(blank=True, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0113_auto_20200914_2054.py` & `edx-enterprise-4.0.0/enterprise/migrations/0113_auto_20200914_2054.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0061_systemwideenterpriserole_systemwideenterpriseuserroleassignment.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0003_auto_20190807_1006.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,46 +1,40 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.18 on 2019-03-06 21:44
+# Generated by Django 1.11.22 on 2019-08-07 10:06
 
 
 import django.db.models.deletion
 import django.utils.timezone
 from django.conf import settings
 from django.db import migrations, models
 
 import model_utils.fields
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('enterprise', '0060_upgrade_django_simple_history'),
+        ('xapi', '0002_auto_20180726_0142'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='SystemWideEnterpriseRole',
+            name='XAPILearnerDataTransmissionAudit',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('name', models.CharField(db_index=True, max_length=255, unique=True)),
+                ('enterprise_course_enrollment_id', models.PositiveIntegerField(blank=True, db_index=True, null=True)),
+                ('course_id', models.CharField(db_index=True, max_length=255)),
+                ('course_completed', models.BooleanField(default=False)),
+                ('completed_timestamp', models.DateTimeField(blank=True, null=True)),
+                ('grade', models.CharField(blank=True, max_length=255, null=True)),
+                ('status', models.CharField(max_length=100)),
+                ('error_message', models.TextField(blank=True)),
+                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='xapi_transmission_audit', to=settings.AUTH_USER_MODEL)),
             ],
-            options={
-                'abstract': False,
-            },
         ),
-        migrations.CreateModel(
-            name='SystemWideEnterpriseUserRoleAssignment',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('role', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.SystemWideEnterpriseRole')),
-                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
-            ],
-            options={
-                'abstract': False,
-            },
+        migrations.AlterUniqueTogether(
+            name='xapilearnerdatatransmissionaudit',
+            unique_together={('user', 'course_id')},
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0109_remove_use_enterprise_catalog_sample.py` & `edx-enterprise-4.0.0/enterprise/migrations/0109_remove_use_enterprise_catalog_sample.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,7 @@
-# -*- coding: utf-8 -*-
-
-
 from django.db import migrations
 
 from enterprise.constants import USE_ENTERPRISE_CATALOG
 
 
 def create_sample(apps, schema_editor):
     """Create the `use_enterprise_catalog` sample if it does not already exist."""
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0015_auto_20170130_0003.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0021_auto_20220523_1625.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
+# Generated by Django 3.2.12 on 2022-05-23 16:25
 
-
-import django
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0014_enrollmentnotificationemailtemplate_historicalenrollmentnotificationemailtemplate'),
+        ('degreed', '0020_auto_20220405_2311'),
     ]
 
     operations = [
-        migrations.AlterField(
-            model_name='enterprisecustomeruser',
-            name='enterprise_customer',
-            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomer', related_name='enterprise_customer_users'),
+        migrations.AddField(
+            model_name='degreedenterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
-        migrations.AlterField(
-            model_name='userdatasharingconsentaudit',
-            name='user',
-            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomerUser', related_name='data_sharing_consent'),
+        migrations.AddField(
+            model_name='historicaldegreedenterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0087_auto_20200206_1151.py` & `edx-enterprise-4.0.0/enterprise/migrations/0126_auto_20210308_1522.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.27 on 2020-02-06 11:51
-
+# Generated by Django 2.2.18 on 2021-03-08 21:22
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0086_auto_20200128_1726'),
+        ('enterprise', '0125_add_config_for_role_assign_backfill'),
     ]
 
     operations = [
         migrations.AddField(
             model_name='historicalpendingenrollment',
-            name='discount_percentage',
-            field=models.DecimalField(decimal_places=5, default=0.0, max_digits=8),
+            name='license_uuid',
+            field=models.UUIDField(blank=True, editable=False, null=True),
         ),
         migrations.AddField(
             model_name='pendingenrollment',
-            name='discount_percentage',
-            field=models.DecimalField(decimal_places=5, default=0.0, max_digits=8),
+            name='license_uuid',
+            field=models.UUIDField(blank=True, editable=False, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0070_enterprise_catalog_query.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0020_auto_20220929_1712.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,46 +1,45 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.22 on 2019-07-24 11:41
-
-
-import jsonfield.fields
+# Generated by Django 3.2.15 on 2022-09-29 17:12
+import logging
 
+from django.db import migrations, models
 import django.db.models.deletion
 import django.utils.timezone
-from django.db import migrations, models
-
 import model_utils.fields
 
+from integrated_channels.integrated_channel.management.commands import IntegratedChannelCommandMixin
+from integrated_channels.utils import batch_by_pk, generate_formatted_log
+
+LOGGER = logging.getLogger(__name__)
+
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0069_auto_20190613_0607'),
+        ('integrated_channel', '0019_merge_20220928_1842'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='EnterpriseCatalogQuery',
+            name='ApiResponseRecord',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('title', models.CharField(default='All Content', max_length=255)),
-                ('content_filter', jsonfield.fields.JSONField(blank=True, default={}, help_text="Query parameters which will be used to filter the discovery service's search/all endpoint results, specified as a JSON object. An empty JSON object means that all available content items will be included in the catalog.", null=True)),
+                ('status_code', models.PositiveIntegerField(blank=True, help_text='The most recent remote API call response HTTP status code', null=True)),
+                ('body', models.TextField(blank=True, help_text='The most recent remote API call response body', null=True)),
             ],
             options={
-                'ordering': ['created'],
-                'verbose_name': 'Enterprise Catalog Query',
-                'verbose_name_plural': 'Enterprise Catalog Queries',
+                'abstract': False,
             },
         ),
         migrations.AddField(
-            model_name='enterprisecustomercatalog',
-            name='enterprise_catalog_query',
-            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='enterprise_customer_catalogs', to='enterprise.EnterpriseCatalogQuery'),
+            model_name='contentmetadataitemtransmission',
+            name='api_record',
+            field=models.OneToOneField(blank=True, help_text='Data pertaining to the transmissions API request response.', null=True, on_delete=django.db.models.deletion.CASCADE, to='integrated_channel.apiresponserecord'),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomercatalog',
-            name='enterprise_catalog_query',
-            field=models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCatalogQuery'),
+            model_name='genericlearnerdatatransmissionaudit',
+            name='api_record',
+            field=models.OneToOneField(blank=True, help_text='Data pertaining to the transmissions API request response.', null=True, on_delete=django.db.models.deletion.CASCADE, to='integrated_channel.apiresponserecord'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0005_pendingenterprisecustomeruser.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0001_squashed_0007_auto_20190925_0730.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,32 +1,50 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.10.3 on 2016-11-15 04:26
+# Generated by Django 2.2.12 on 2020-04-21 20:42
 
+import jsonfield.fields
 
-import django.db.models.deletion
 import django.utils.timezone
 from django.db import migrations, models
 
 import model_utils.fields
 
 
 class Migration(migrations.Migration):
 
+    initial = True
+
     dependencies = [
-        ('enterprise', '0004_auto_20161114_0434'),
+        ('enterprise', '0094_add_use_enterprise_catalog_sample'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='PendingEnterpriseCustomerUser',
+            name='LearnerDataTransmissionAudit',
+            fields=[
+                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
+                ('enterprise_course_enrollment_id', models.PositiveIntegerField(db_index=True)),
+                ('course_id', models.CharField(max_length=255)),
+                ('course_completed', models.BooleanField(default=True)),
+                ('completed_timestamp', models.BigIntegerField()),
+                ('instructor_name', models.CharField(blank=True, max_length=255)),
+                ('grade', models.CharField(max_length=100)),
+                ('status', models.CharField(max_length=100)),
+                ('error_message', models.TextField(blank=True)),
+                ('created', models.DateTimeField(auto_now_add=True)),
+            ],
+        ),
+        migrations.CreateModel(
+            name='ContentMetadataItemTransmission',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('user_email', models.EmailField(max_length=254)),
+                ('integrated_channel_code', models.CharField(max_length=30)),
+                ('content_id', models.CharField(max_length=255)),
+                ('channel_metadata', jsonfield.fields.JSONField(dump_kwargs={'cls': jsonfield.encoder.JSONEncoder, 'separators': (',', ':')}, load_kwargs={})),
                 ('enterprise_customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomer')),
             ],
             options={
-                'abstract': False,
+                'unique_together': {('enterprise_customer', 'integrated_channel_code', 'content_id')},
             },
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0021_auto_20170711_0712.py` & `edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0002_auto_20211101_2021.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,34 +1,33 @@
-# -*- coding: utf-8 -*-
+# Generated by Django 3.2.8 on 2021-11-01 20:21
 
-
-from django.db import migrations, models
+from django.db import migrations
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0020_auto_20170624_2316'),
+        ('degreed2', '0001_initial'),
     ]
 
     operations = [
-        migrations.RemoveField(
-            model_name='historicalenrollmentnotificationemailtemplate',
-            name='history_change_reason',
-        ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecourseenrollment',
-            name='history_change_reason',
+        migrations.RenameField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            old_name='key',
+            new_name='client_id',
         ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomer',
-            name='history_change_reason',
+        migrations.RenameField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            old_name='secret',
+            new_name='client_secret',
         ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomerentitlement',
-            name='history_change_reason',
+        migrations.RenameField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            old_name='key',
+            new_name='client_id',
         ),
-        migrations.RemoveField(
-            model_name='historicaluserdatasharingconsentaudit',
-            name='history_change_reason',
+        migrations.RenameField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            old_name='secret',
+            new_name='client_secret',
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0088_auto_20200224_1341.py` & `edx-enterprise-4.0.0/enterprise/migrations/0143_auto_20210908_0559.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,43 +1,38 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.28 on 2020-02-24 19:41
-
+# Generated by Django 2.2.24 on 2021-09-08 10:59
 
 import collections
-
+from django.db import migrations
+import enterprise.constants
+import enterprise.validators
 import jsonfield.encoder
 import jsonfield.fields
 
-from django.db import migrations
-
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0087_auto_20200206_1151'),
+        ('enterprise', '0142_auto_20210907_2059'),
     ]
 
     operations = [
-        migrations.RemoveField(
-            model_name='enterprisecustomer',
-            name='learner_portal_hostname',
-        ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomer',
-            name='learner_portal_hostname',
-        ),
         migrations.AlterField(
-            model_name='enterprisecatalogquery',
+            model_name='enterprisecustomercatalog',
             name='content_filter',
-            field=jsonfield.fields.JSONField(blank=True, default={}, dump_kwargs={'cls': jsonfield.encoder.JSONEncoder, 'separators': (',', ':')}, help_text="Query parameters which will be used to filter the discovery service's search/all endpoint results, specified as a JSON object. An empty JSON object means that all available content items will be included in the catalog.", load_kwargs={'object_pairs_hook': collections.OrderedDict}, null=True),
+            field=jsonfield.fields.JSONField(blank=True, default={}, dump_kwargs={'cls': jsonfield.encoder.JSONEncoder, 'ensure_ascii': False, 'indent': 4, 'separators': (',', ':')}, help_text="Query parameters which will be used to filter the discovery service's search/all endpoint results, specified as a Json object. An empty Json object means that all available content items will be included in the catalog.", load_kwargs={'object_pairs_hook': collections.OrderedDict}, null=True, validators=[enterprise.validators.validate_content_filter_fields]),
         ),
         migrations.AlterField(
             model_name='enterprisecustomercatalog',
-            name='content_filter',
-            field=jsonfield.fields.JSONField(blank=True, default={}, dump_kwargs={'cls': jsonfield.encoder.JSONEncoder, 'separators': (',', ':')}, help_text="Query parameters which will be used to filter the discovery service's search/all endpoint results, specified as a Json object. An empty Json object means that all available content items will be included in the catalog.", load_kwargs={'object_pairs_hook': collections.OrderedDict}, null=True),
+            name='enabled_course_modes',
+            field=jsonfield.fields.JSONField(default=enterprise.constants.json_serialized_course_modes, help_text='Ordered list of enrollment modes which can be displayed to learners for course runs in this catalog.'),
         ),
         migrations.AlterField(
             model_name='historicalenterprisecustomercatalog',
             name='content_filter',
-            field=jsonfield.fields.JSONField(blank=True, default={}, dump_kwargs={'cls': jsonfield.encoder.JSONEncoder, 'separators': (',', ':')}, help_text="Query parameters which will be used to filter the discovery service's search/all endpoint results, specified as a Json object. An empty Json object means that all available content items will be included in the catalog.", load_kwargs={'object_pairs_hook': collections.OrderedDict}, null=True),
+            field=jsonfield.fields.JSONField(blank=True, default={}, dump_kwargs={'cls': jsonfield.encoder.JSONEncoder, 'ensure_ascii': False, 'indent': 4, 'separators': (',', ':')}, help_text="Query parameters which will be used to filter the discovery service's search/all endpoint results, specified as a Json object. An empty Json object means that all available content items will be included in the catalog.", load_kwargs={'object_pairs_hook': collections.OrderedDict}, null=True, validators=[enterprise.validators.validate_content_filter_fields]),
+        ),
+        migrations.AlterField(
+            model_name='historicalenterprisecustomercatalog',
+            name='enabled_course_modes',
+            field=jsonfield.fields.JSONField(default=enterprise.constants.json_serialized_course_modes, help_text='Ordered list of enrollment modes which can be displayed to learners for course runs in this catalog.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0039_auto_20180129_1034.py` & `edx-enterprise-4.0.0/enterprise/migrations/0138_bulkcatalogqueryupdatecommandconfiguration.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,25 +1,29 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11 on 2018-01-29 16:34
-
+# Generated by Django 2.2.24 on 2021-08-02 22:45
 
+from django.conf import settings
 from django.db import migrations, models
+import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0038_auto_20180122_1427'),
+        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
+        ('enterprise', '0137_enrollment_email_update'),
     ]
 
     operations = [
-        migrations.AlterField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='initialization_vector',
-            field=models.BinaryField(blank=True, help_text='This is the initialization vector used to encrypt the password using AESencr', max_length=32, null=True, verbose_name='Password Encryption Initialization Vector'),
-        ),
-        migrations.AlterField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='password',
-            field=models.BinaryField(blank=True, max_length=256, null=True, verbose_name='Password for the protected zip file.'),
+        migrations.CreateModel(
+            name='BulkCatalogQueryUpdateCommandConfiguration',
+            fields=[
+                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
+                ('change_date', models.DateTimeField(auto_now_add=True, verbose_name='Change date')),
+                ('enabled', models.BooleanField(default=False, verbose_name='Enabled')),
+                ('arguments', models.TextField(blank=True, default='', help_text="Arguments for the 'bulk_update_catalog_query_id' management command. Specify like '<old ID> <new ID>'")),
+                ('changed_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL, verbose_name='Changed by')),
+            ],
+            options={
+                'verbose_name': 'bulk_update_catalog_query_id argument',
+            },
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0071_historicalpendingenrollment_historicalpendingenterprisecustomeruser.py` & `edx-enterprise-4.0.0/enterprise/migrations/0136_auto_20210629_2129.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,67 +1,70 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.22 on 2019-07-26 04:53
+# Generated by Django 2.2.20 on 2021-06-29 21:29
 
-
-import simple_history.models
-
-import django.db.models.deletion
-import django.utils.timezone
 from django.conf import settings
 from django.db import migrations, models
-
+import django.db.models.deletion
+import django.utils.timezone
 import model_utils.fields
+import simple_history.models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('enterprise', '0070_enterprise_catalog_query'),
+        ('enterprise', '0135_adminnotification_adminnotificationfilter_adminnotificationread'),
     ]
 
     operations = [
+        migrations.AlterField(
+            model_name='systemwideenterpriseuserroleassignment',
+            name='role',
+            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='system_wide_role_assignments', to='enterprise.SystemWideEnterpriseRole'),
+        ),
         migrations.CreateModel(
-            name='HistoricalPendingEnrollment',
+            name='HistoricalSystemWideEnterpriseUserRoleAssignment',
             fields=[
                 ('id', models.IntegerField(auto_created=True, blank=True, db_index=True, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('course_id', models.CharField(max_length=255)),
-                ('course_mode', models.CharField(max_length=25)),
-                ('cohort_name', models.CharField(blank=True, max_length=255, null=True)),
+                ('applies_to_all_contexts', models.BooleanField(default=False, help_text='If true, indicates that the user is effectively assigned their role for any and all contexts. Defaults to False.')),
                 ('history_id', models.AutoField(primary_key=True, serialize=False)),
                 ('history_date', models.DateTimeField()),
                 ('history_change_reason', models.CharField(max_length=100, null=True)),
                 ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
+                ('enterprise_customer', models.ForeignKey(blank=True, db_constraint=False, help_text='The EnterpriseCustomer for which the role is assigned for the user.  If creating a new assignment, you must first provide a user email and role, then click "Save and continue editing" BEFORE selecting from this dropdown.', null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomer')),
                 ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
-                ('user', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.PendingEnterpriseCustomerUser')),
+                ('role', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.SystemWideEnterpriseRole')),
+                ('user', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL)),
             ],
             options={
+                'verbose_name': 'historical system wide enterprise user role assignment',
                 'ordering': ('-history_date', '-history_id'),
                 'get_latest_by': 'history_date',
-                'verbose_name': 'historical pending enrollment',
             },
             bases=(simple_history.models.HistoricalChanges, models.Model),
         ),
         migrations.CreateModel(
-            name='HistoricalPendingEnterpriseCustomerUser',
+            name='HistoricalEnterpriseCustomerUser',
             fields=[
                 ('id', models.IntegerField(auto_created=True, blank=True, db_index=True, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('user_email', models.EmailField(db_index=True, max_length=254)),
+                ('user_id', models.PositiveIntegerField(db_index=True)),
+                ('active', models.BooleanField(default=True)),
+                ('linked', models.BooleanField(default=True)),
                 ('history_id', models.AutoField(primary_key=True, serialize=False)),
                 ('history_date', models.DateTimeField()),
                 ('history_change_reason', models.CharField(max_length=100, null=True)),
                 ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                 ('enterprise_customer', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomer')),
                 ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
             ],
             options={
+                'verbose_name': 'historical Enterprise Customer Learner',
                 'ordering': ('-history_date', '-history_id'),
                 'get_latest_by': 'history_date',
-                'verbose_name': 'historical pending enterprise customer user',
             },
             bases=(simple_history.models.HistoricalChanges, models.Model),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0035_auto_20171212_1129.py` & `edx-enterprise-4.0.0/enterprise/migrations/0120_systemwiderole_applies_to_all_contexts.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 2.2.17 on 2021-01-22 19:41
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0034_auto_20171023_0727'),
+        ('enterprise', '0001_auto_20210111_1253'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomercatalog',
-            name='publish_audit_enrollment_urls',
-            field=models.BooleanField(default=False, help_text='Specifies whether courses should be published with direct-to-audit enrollment URLs.'),
+            model_name='enterprisefeatureuserroleassignment',
+            name='applies_to_all_contexts',
+            field=models.BooleanField(default=False, help_text='If true, indicates that the user is effectively assigned their role for any and all contexts. Defaults to False.'),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomercatalog',
-            name='publish_audit_enrollment_urls',
-            field=models.BooleanField(default=False, help_text='Specifies whether courses should be published with direct-to-audit enrollment URLs.'),
+            model_name='systemwideenterpriseuserroleassignment',
+            name='applies_to_all_contexts',
+            field=models.BooleanField(default=False, help_text='If true, indicates that the user is effectively assigned their role for any and all contexts. Defaults to False.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0080_auto_20191113_1708.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0012_alter_cornerstoneenterprisecustomerconfiguration_enterprise_customer.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,19 +1,20 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.25 on 2019-11-13 17:08
+# Generated by Django 3.2.8 on 2021-12-20 17:24
 
-
-from django.db import migrations
+from django.db import migrations, models
+import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0079_AddEnterpriseEnrollmentSource'),
+        ('enterprise', '0151_add_is_active_to_invite_key'),
+        ('cornerstone', '0011_auto_20211103_1855'),
     ]
 
     operations = [
-        migrations.AlterModelOptions(
-            name='enterprisecustomeruser',
-            options={'ordering': ['-active', '-modified'], 'verbose_name': 'Enterprise Customer Learner', 'verbose_name_plural': 'Enterprise Customer Learners'},
+        migrations.AlterField(
+            model_name='cornerstoneenterprisecustomerconfiguration',
+            name='enterprise_customer',
+            field=models.ForeignKey(help_text='Enterprise Customer associated with the configuration.', on_delete=django.db.models.deletion.CASCADE, to='enterprise.enterprisecustomer'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0076_auto_20190918_2037.py` & `edx-enterprise-4.0.0/enterprise/migrations/0169_auto_20230222_1621.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,35 +1,34 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.24 on 2019-09-18 20:37
-
+# Generated by Django 3.2.17 on 2023-02-21 18:38
 
 from django.db import migrations, models
+import uuid
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0075_auto_20190916_1030'),
+        ('enterprise', '0168_auto_20230222_1621'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='enterprisecustomer',
-            name='enable_portal_reporting_config_screen',
-            field=models.BooleanField(default=False, help_text='Specifies whether to allow access to the reporting configurations screen in the admin portal.'),
+        migrations.AlterField(
+            model_name='licensedenterprisecourseenrollment',
+            name='uuid',
+            field=models.UUIDField(default=uuid.uuid4, editable=False, unique=True)
         ),
-        migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='enable_portal_reporting_config_screen',
-            field=models.BooleanField(default=False, help_text='Specifies whether to allow access to the reporting configurations screen in the admin portal.'),
+        migrations.AlterField(
+            model_name='historicallearnercreditenterprisecourseenrollment',
+            name='uuid',
+            field=models.UUIDField(db_index=True, default=uuid.uuid4, editable=False),
         ),
         migrations.AlterField(
-            model_name='enterprisecustomer',
-            name='learner_portal_hostname',
-            field=models.CharField(blank=True, default='', help_text='Hostname of the enterprise learner portal, e.g. bestrun.edx.org.', max_length=255),
+            model_name='historicallicensedenterprisecourseenrollment',
+            name='uuid',
+            field=models.UUIDField(db_index=True, default=uuid.uuid4, editable=False),
         ),
         migrations.AlterField(
-            model_name='historicalenterprisecustomer',
-            name='learner_portal_hostname',
-            field=models.CharField(blank=True, default='', help_text='Hostname of the enterprise learner portal, e.g. bestrun.edx.org.', max_length=255),
+            model_name='learnercreditenterprisecourseenrollment',
+            name='uuid',
+            field=models.UUIDField(default=uuid.uuid4, editable=False, unique=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0094_add_use_enterprise_catalog_sample.py` & `edx-enterprise-4.0.0/enterprise/migrations/0094_add_use_enterprise_catalog_sample.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,10 +1,7 @@
-# -*- coding: utf-8 -*-
-
-
 from django.db import migrations
 
 from enterprise.constants import USE_ENTERPRISE_CATALOG
 
 
 def create_sample(apps, schema_editor):
     """Create the `use_enterprise_catalog` sample if it does not already exist."""
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0055_auto_20181015_1112.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0020_auto_20220523_1625.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.15 on 2018-10-15 16:12
-
+# Generated by Django 3.2.12 on 2022-05-23 16:25
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0054_merge_20180914_1511'),
+        ('cornerstone', '0019_auto_20220405_2311'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomer',
-            name='enable_autocohorting',
-            field=models.BooleanField(default=False, help_text='Specifies whether the customer is able to assign learners to cohorts upon enrollment.'),
+            model_name='cornerstoneenterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='enable_autocohorting',
-            field=models.BooleanField(default=False, help_text='Specifies whether the customer is able to assign learners to cohorts upon enrollment.'),
+            model_name='historicalcornerstoneenterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0033_add_history_change_reason_field.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0023_auto_20221021_0159.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,39 +1,28 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.16 on 2022-10-21 01:59
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0032_reporting_model'),
+        ('integrated_channel', '0022_alter_contentmetadataitemtransmission_index_together'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='historicalenrollmentnotificationemailtemplate',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
-        ),
-        migrations.AddField(
-            model_name='historicalenterprisecourseenrollment',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
-        ),
-        migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+            model_name='genericlearnerdatatransmissionaudit',
+            name='content_title',
+            field=models.CharField(blank=True, default=None, max_length=255, null=True),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomercatalog',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+            model_name='genericlearnerdatatransmissionaudit',
+            name='progress_status',
+            field=models.CharField(blank=True, max_length=255),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomerentitlement',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+            model_name='genericlearnerdatatransmissionaudit',
+            name='user_email',
+            field=models.CharField(blank=True, max_length=255, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0038_auto_20180122_1427.py` & `edx-enterprise-4.0.0/enterprise/migrations/0165_alter_enterprisecustomerreportingconfiguration_pgp_encryption_key.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,27 +1,19 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11 on 2018-01-22 20:27
+# Generated by Django 3.2.16 on 2022-11-22 10:09
 
-
-import fernet_fields.fields
-
-from django.db import migrations
+from django.db import migrations, models
+import enterprise.validators
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0037_auto_20180110_0450'),
+        ('enterprise', '0164_enterprisecatalogquery_include_exec_ed_2u_courses'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='decrypted_password',
-            field=fernet_fields.fields.EncryptedCharField(blank=True, help_text='This password will be used to secure the zip file. It will be encrypted when stored in the database.', max_length=256, null=True),
-        ),
-        migrations.AddField(
+        migrations.AlterField(
             model_name='enterprisecustomerreportingconfiguration',
-            name='decrypted_sftp_password',
-            field=fernet_fields.fields.EncryptedCharField(blank=True, help_text='If the delivery method is sftp, the password to use to securely access the host. The password will be encrypted when stored in the database.', max_length=256, null=True),
+            name='pgp_encryption_key',
+            field=models.TextField(blank=True, help_text='The key for encryption, if PGP encrypted file is required.', null=True, validators=[enterprise.validators.validate_pgp_key], verbose_name='PGP Encryption Key'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0083_enterprisecustomerreportingconfiguration_include_date.py` & `edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0007_auto_20220523_1625.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,20 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.25 on 2019-12-18 12:51
-
+# Generated by Django 3.2.12 on 2022-05-23 16:25
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0082_AddManagementEnterpriseEnrollmentSource'),
+        ('blackboard', '0006_auto_20220405_2311'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='include_date',
-            field=models.BooleanField(default=True, help_text='Include date in the report file name', verbose_name='Include Date'),
+            model_name='blackboardenterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
+        ),
+        migrations.AddField(
+            model_name='historicalblackboardenterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0042_replace_sensitive_sso_username.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0022_auto_20220523_1625.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.12 on 2018-04-12 08:34
-
+# Generated by Django 3.2.12 on 2022-05-23 16:25
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0041_auto_20180212_1507'),
+        ('canvas', '0021_auto_20220405_2311'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomer',
-            name='replace_sensitive_sso_username',
-            field=models.BooleanField(default=False, help_text='Specifies whether to replace the display of potentially sensitive SSO usernames with a more generic name, e.g. EnterpriseLearner.'),
+            model_name='canvasenterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='replace_sensitive_sso_username',
-            field=models.BooleanField(default=False, help_text='Specifies whether to replace the display of potentially sensitive SSO usernames with a more generic name, e.g. EnterpriseLearner.'),
+            model_name='historicalcanvasenterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0096_enterprise_catalog_admin_role.py` & `edx-enterprise-4.0.0/enterprise/migrations/0096_enterprise_catalog_admin_role.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0077_auto_20191002_1529.py` & `edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0013_auto_20220523_1625.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,33 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.24 on 2019-10-02 20:29
+# Generated by Django 3.2.12 on 2022-05-23 16:25
 
-
-from django.db import migrations
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0076_auto_20190918_2037'),
+        ('degreed2', '0012_auto_20220405_2311'),
     ]
 
     operations = [
-        migrations.RemoveField(
-            model_name='enterprisecustomerentitlement',
-            name='enterprise_customer',
-        ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomerentitlement',
-            name='enterprise_customer',
-        ),
-        migrations.RemoveField(
-            model_name='historicalenterprisecustomerentitlement',
-            name='history_user',
-        ),
-        migrations.DeleteModel(
-            name='EnterpriseCustomerEntitlement',
+        migrations.AddField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
-        migrations.DeleteModel(
-            name='HistoricalEnterpriseCustomerEntitlement',
+        migrations.AddField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0049_auto_20180531_0321.py` & `edx-enterprise-4.0.0/enterprise/migrations/0155_add_is_relinkable_to_enterprise_customer_user.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.12 on 2022-04-04 15:40
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0048_enterprisecustomeruser_active'),
+        ('enterprise', '0154_alter_systemwideenterpriseuserroleassignment_unique_together'),
     ]
 
     operations = [
-        migrations.AlterField(
-            model_name='enterprisecustomercatalog',
-            name='title',
-            field=models.CharField(default='All Content', max_length=255),
+        migrations.AddField(
+            model_name='enterprisecustomeruser',
+            name='is_relinkable',
+            field=models.BooleanField(default=True, help_text='When set to False, the user cannot be relinked to the enterprise.'),
         ),
-        migrations.AlterField(
-            model_name='historicalenterprisecustomercatalog',
-            name='title',
-            field=models.CharField(default='All Content', max_length=255),
+        migrations.AddField(
+            model_name='historicalenterprisecustomeruser',
+            name='is_relinkable',
+            field=models.BooleanField(default=True, help_text='When set to False, the user cannot be relinked to the enterprise.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0023_audit_data_reporting_flag.py` & `edx-enterprise-4.0.0/enterprise/migrations/0156_add_is_active_role_assignment.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 2.2.19 on 2022-05-12 14:10
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0022_auto_20170720_1543'),
+        ('enterprise', '0155_add_is_relinkable_to_enterprise_customer_user'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomer',
-            name='enable_audit_data_reporting',
-            field=models.BooleanField(default=False, help_text='Specifies whether to pass-back audit track enrollment data through an integrated channel.'),
+            model_name='historicalsystemwideenterpriseuserroleassignment',
+            name='is_active',
+            field=models.BooleanField(default=True),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='enable_audit_data_reporting',
-            field=models.BooleanField(default=False, help_text='Specifies whether to pass-back audit track enrollment data through an integrated channel.'),
+            model_name='systemwideenterpriseuserroleassignment',
+            name='is_active',
+            field=models.BooleanField(default=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0074_auto_20190904_1143.py` & `edx-enterprise-4.0.0/enterprise/migrations/0145_auto_20211013_1018.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.23 on 2019-09-04 16:43
-
+# Generated by Django 2.2.24 on 2021-10-13 10:18
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0073_enterprisecustomerreportingconfiguration_uuid'),
+        ('enterprise', '0144_auto_20211011_1030'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecourseenrollment',
-            name='marked_done',
-            field=models.BooleanField(default=False, help_text='Specifies whether a user marked this course as completed in the learner portal.'),
+            model_name='enterprisecustomer',
+            name='hide_labor_market_data',
+            field=models.BooleanField(default=False, help_text='Specifies whether the labor market data should be made known to the learner in learner portal.'),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecourseenrollment',
-            name='marked_done',
-            field=models.BooleanField(default=False, help_text='Specifies whether a user marked this course as completed in the learner portal.'),
+            model_name='historicalenterprisecustomer',
+            name='hide_labor_market_data',
+            field=models.BooleanField(default=False, help_text='Specifies whether the labor market data should be made known to the learner in learner portal.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0098_auto_20200629_1756.py` & `edx-enterprise-4.0.0/enterprise/migrations/0159_add_enable_learner_portal_offers.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,23 +1,23 @@
-# Generated by Django 2.2.13 on 2020-06-29 17:56
+# Generated by Django 3.2.12 on 2022-06-14 16:14
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0097_auto_20200619_1130'),
+        ('enterprise', '0158_remove_is_active_from_role_assignment'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecourseenrollment',
-            name='saved_for_later',
-            field=models.BooleanField(default=False, help_text='Specifies whether a user marked this course as saved for later in the learner portal.'),
+            model_name='enterprisecustomer',
+            name='enable_learner_portal_offers',
+            field=models.BooleanField(default=False, help_text='Specifies whether enterprise offers will be made known to learners in the learner portal.'),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecourseenrollment',
-            name='saved_for_later',
-            field=models.BooleanField(default=False, help_text='Specifies whether a user marked this course as saved for later in the learner portal.'),
+            model_name='historicalenterprisecustomer',
+            name='enable_learner_portal_offers',
+            field=models.BooleanField(default=False, help_text='Specifies whether enterprise offers will be made known to learners in the learner portal.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0106_move_branding_config_colors.py` & `edx-enterprise-4.0.0/enterprise/migrations/0106_move_branding_config_colors.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0064_enterprisefeaturerole_enterprisefeatureuserroleassignment.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0027_orphanedcontenttransmissions.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,50 +1,32 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.18 on 2019-03-25 19:31
-
+# Generated by Django 3.2.18 on 2023-03-31 18:14
 
+from django.db import migrations, models
 import django.db.models.deletion
 import django.utils.timezone
-from django.conf import settings
-from django.db import migrations, models
-
 import model_utils.fields
 
-import enterprise.models
-
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('enterprise', '0063_systemwideenterpriserole_description'),
+        ('integrated_channel', '0026_genericenterprisecustomerpluginconfiguration_last_modified_at'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='EnterpriseFeatureRole',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('name', models.CharField(db_index=True, max_length=255, unique=True)),
-                ('description', models.TextField(blank=True, null=True)),
-            ],
-            options={
-                'abstract': False,
-            },
-        ),
-        migrations.CreateModel(
-            name='EnterpriseFeatureUserRoleAssignment',
+            name='OrphanedContentTransmissions',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('role', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseFeatureRole')),
-                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
+                ('integrated_channel_code', models.CharField(max_length=30)),
+                ('plugin_configuration_id', models.PositiveIntegerField()),
+                ('content_id', models.CharField(max_length=255)),
+                ('resolved', models.BooleanField(default=False)),
+                ('transmission', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='orphaned_record', to='integrated_channel.contentmetadataitemtransmission')),
             ],
             options={
-                'abstract': False,
+                'index_together': {('integrated_channel_code', 'plugin_configuration_id', 'resolved')},
             },
-            bases=(models.Model, enterprise.models.EnterpriseRoleAssignmentContextMixin),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0018_auto_20170511_1357.py` & `edx-enterprise-4.0.0/enterprise/migrations/0148_auto_20211129_2114.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 2.2.19 on 2021-11-29 21:14
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0017_auto_20170508_1341'),
+        ('enterprise', '0147_auto_20211129_1949'),
     ]
 
     operations = [
-        migrations.AddField(
+        migrations.AlterField(
             model_name='enterprisecustomer',
-            name='enable_audit_enrollment',
-            field=models.BooleanField(default=False, help_text='Specifies whether the audit track enrollment option will be displayed in the course enrollment view.'),
+            name='enable_universal_link',
+            field=models.BooleanField(default=False, help_text='Specifies whether universal link generation is enabled for customer. Managed via admin portal settings UI.'),
         ),
-        migrations.AddField(
+        migrations.AlterField(
             model_name='historicalenterprisecustomer',
-            name='enable_audit_enrollment',
-            field=models.BooleanField(default=False, help_text='Specifies whether the audit track enrollment option will be displayed in the course enrollment view.'),
+            name='enable_universal_link',
+            field=models.BooleanField(default=False, help_text='Specifies whether universal link generation is enabled for customer. Managed via admin portal settings UI.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0045_report_type_json.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0002_alter_sapsuccessfactorsenterprisecustomerconfiguration_display_name.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,20 +1,18 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.13 on 2018-05-09 16:08
-
+# Generated by Django 3.2.12 on 2022-03-02 22:31
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0044_reporting_config_multiple_types'),
+        ('sap_success_factors', '0001_squashed_0022_auto_20200206_1046_squashed_0011_alter_sapsuccessfactorslearnerdatatransmissionaudit_enterprise_course_enrollment_id'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='enterprisecustomerreportingconfiguration',
-            name='report_type',
-            field=models.CharField(choices=[('csv', 'csv'), ('json', 'json')], default='csv', help_text='The type this report should be sent as, e.g. CSV.', max_length=20, verbose_name='Report Type'),
+            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=255),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0110_add_default_contract_discount.py` & `edx-enterprise-4.0.0/enterprise/migrations/0110_add_default_contract_discount.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0104_sync_query_field.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0003_auto_20180109_0712.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,23 +1,21 @@
-# Generated by Django 2.2.14 on 2020-07-28 18:52
-
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0103_remove_marked_done'),
+        ('degreed', '0002_auto_20180104_0103'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='enterprisecustomercatalog',
-            name='sync_enterprise_catalog_query',
-            field=models.BooleanField(default=False),
+        migrations.AlterField(
+            model_name='degreedenterprisecustomerconfiguration',
+            name='active',
+            field=models.BooleanField(help_text='Is this configuration active?'),
         ),
-        migrations.AddField(
-            model_name='historicalenterprisecustomercatalog',
-            name='sync_enterprise_catalog_query',
-            field=models.BooleanField(default=False),
+        migrations.AlterField(
+            model_name='historicaldegreedenterprisecustomerconfiguration',
+            name='active',
+            field=models.BooleanField(help_text='Is this configuration active?'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0003_auto_20161104_0937.py` & `edx-enterprise-4.0.0/enterprise/migrations/0105_add_branding_config_color_fields.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,36 +1,30 @@
-# -*- coding: utf-8 -*-
+# Generated by Django 2.2.14 on 2020-08-03 14:55
 
-
-import django
 from django.db import migrations, models
 
+import enterprise.validators
+
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sites', '0001_initial'),
-        ('enterprise', '0002_enterprisecustomerbrandingconfiguration'),
+        ('enterprise', '0104_sync_query_field'),
     ]
 
     operations = [
-        migrations.AlterModelOptions(
-            name='enterprisecustomerbrandingconfiguration',
-            options={'verbose_name': 'Branding Configuration', 'verbose_name_plural': 'Branding Configurations'},
-        ),
         migrations.AddField(
-            model_name='enterprisecustomer',
-            name='site',
-            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enterprise_customers', default=1, to='sites.Site'),
-            preserve_default=False,
+            model_name='enterprisecustomerbrandingconfiguration',
+            name='primary_color',
+            field=models.CharField(blank=True, max_length=7, null=True, validators=[enterprise.validators.validate_hex_color]),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='site',
-            field=models.ForeignKey(related_name='+', on_delete=django.db.models.deletion.DO_NOTHING, db_constraint=False, blank=True, to='sites.Site', null=True),
+            model_name='enterprisecustomerbrandingconfiguration',
+            name='secondary_color',
+            field=models.CharField(blank=True, max_length=7, null=True, validators=[enterprise.validators.validate_hex_color]),
         ),
-        migrations.AlterField(
+        migrations.AddField(
             model_name='enterprisecustomerbrandingconfiguration',
-            name='enterprise_customer',
-            field=models.OneToOneField(related_name='branding_configuration', on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomer'),
+            name='tertiary_color',
+            field=models.CharField(blank=True, max_length=7, null=True, validators=[enterprise.validators.validate_hex_color]),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0086_auto_20200128_1726.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0015_auto_20220718_2113.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,37 +1,43 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.27 on 2020-01-28 17:26
-
+# Generated by Django 3.2.12 on 2022-07-18 21:13
 
 from django.db import migrations, models
 
-import enterprise.validators
-
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0085_enterprisecustomeruser_linked'),
+        ('integrated_channel', '0014_genericenterprisecustomerpluginconfiguration_dry_run_mode_enabled'),
     ]
 
     operations = [
+        migrations.RenameField(
+            model_name='contentmetadataitemtransmission',
+            old_name='deleted_at',
+            new_name='remote_deleted_at'
+        ),
+        migrations.AlterField(
+            model_name='contentmetadataitemtransmission',
+            name='remote_deleted_at',
+            field=models.DateTimeField(blank=True, help_text='Date when the content transmission was deleted in the remote API', null=True),
+        ),
         migrations.AddField(
-            model_name='enterprisecustomer',
-            name='contact_email',
-            field=models.EmailField(blank=True, help_text='Email to be displayed as public point of contact for enterprise.', max_length=254, null=True),
+            model_name='contentmetadataitemtransmission',
+            name='api_response_body',
+            field=models.TextField(blank=True, help_text='The most recent remote API call response body', null=True),
         ),
         migrations.AddField(
-            model_name='enterprisecustomerbrandingconfiguration',
-            name='banner_background_color',
-            field=models.CharField(blank=True, max_length=7, null=True, validators=[enterprise.validators.validate_hex_color]),
+            model_name='contentmetadataitemtransmission',
+            name='api_response_status_code',
+            field=models.PositiveIntegerField(blank=True, help_text='The most recent remote API call response HTTP status code', null=True),
         ),
         migrations.AddField(
-            model_name='enterprisecustomerbrandingconfiguration',
-            name='banner_border_color',
-            field=models.CharField(blank=True, max_length=7, null=True, validators=[enterprise.validators.validate_hex_color]),
+            model_name='contentmetadataitemtransmission',
+            name='remote_created_at',
+            field=models.DateTimeField(blank=True, help_text='Date when the content transmission was created in the remote API', null=True),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='contact_email',
-            field=models.EmailField(blank=True, help_text='Email to be displayed as public point of contact for enterprise.', max_length=254, null=True),
+            model_name='contentmetadataitemtransmission',
+            name='remote_updated_at',
+            field=models.DateTimeField(blank=True, help_text='Date when the content transmission was last updated in the remote API', null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0004_auto_20161114_0434.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0020_auto_20220325_1757.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.10.2 on 2016-11-14 04:34
-
+# Generated by Django 3.2.12 on 2022-03-25 17:57
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0003_auto_20161104_0937'),
+        ('canvas', '0019_auto_20220324_1550'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomer',
-            name='identity_provider',
-            field=models.SlugField(blank=True, default=None, null=True),
+            model_name='canvaslearnerdatatransmissionaudit',
+            name='subsection_id',
+            field=models.CharField(blank=True, db_index=True, max_length=255, null=True),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='identity_provider',
-            field=models.SlugField(blank=True, default=None, null=True),
+            model_name='canvaslearnerdatatransmissionaudit',
+            name='subsection_name',
+            field=models.CharField(max_length=255, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0011_enterprisecustomerentitlement_historicalenterprisecustomerentitlement.py` & `edx-enterprise-4.0.0/enterprise/migrations/0146_enterprise_customer_invite_key.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,54 +1,68 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.10.2 on 2017-01-25 00:53
+# Generated by Django 2.2.24 on 2021-11-19 22:25
 
-
-import django.db.models.deletion
-import django.utils.timezone
 from django.conf import settings
 from django.db import migrations, models
-
+import django.db.models.deletion
+import django.utils.timezone
 import model_utils.fields
+import simple_history.models
+import uuid
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('enterprise', '0010_auto_20161222_1212'),
+        ('enterprise', '0145_auto_20211013_1018'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='EnterpriseCustomerEntitlement',
+            name='HistoricalEnterpriseCustomerInviteKey',
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('entitlement_id', models.PositiveIntegerField(help_text="Enterprise customer's entitlement id for relationship with e-commerce coupon.", unique=True)),
-                ('enterprise_customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enterprise_customer_entitlements', to='enterprise.EnterpriseCustomer')),
+                ('is_removed', models.BooleanField(default=False)),
+                ('uuid', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False)),
+                ('usage_limit', models.PositiveIntegerField(default=10000, help_text='The number of times this key can be used to link a learner.')),
+                ('expiration_date', models.DateTimeField(blank=True, help_text='The key will no longer be valid after this date.', null=True)),
+                ('history_id', models.AutoField(primary_key=True, serialize=False)),
+                ('history_date', models.DateTimeField()),
+                ('history_change_reason', models.CharField(max_length=100, null=True)),
+                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
+                ('enterprise_customer', models.ForeignKey(blank=True, db_constraint=False, help_text='The enterprise that can be linked using this key.', null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomer')),
+                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
             ],
             options={
-                'verbose_name': 'Enterprise Customer Entitlement',
-                'verbose_name_plural': 'Enterprise Customer Entitlements',
+                'verbose_name': 'historical enterprise customer invite key',
+                'ordering': ('-history_date', '-history_id'),
+                'get_latest_by': 'history_date',
             },
+            bases=(simple_history.models.HistoricalChanges, models.Model),
         ),
         migrations.CreateModel(
-            name='HistoricalEnterpriseCustomerEntitlement',
+            name='EnterpriseCustomerInviteKey',
             fields=[
-                ('id', models.IntegerField(auto_created=True, blank=True, db_index=True, verbose_name='ID')),
                 ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
                 ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('entitlement_id', models.PositiveIntegerField(db_index=True, help_text="Enterprise customer's entitlement id for relationship with e-commerce coupon.")),
-                ('history_id', models.AutoField(primary_key=True, serialize=False)),
-                ('history_date', models.DateTimeField()),
-                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
-                ('enterprise_customer', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomer')),
-                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
+                ('is_removed', models.BooleanField(default=False)),
+                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
+                ('usage_limit', models.PositiveIntegerField(default=10000, help_text='The number of times this key can be used to link a learner.')),
+                ('expiration_date', models.DateTimeField(blank=True, help_text='The key will no longer be valid after this date.', null=True)),
+                ('enterprise_customer', models.ForeignKey(help_text='The enterprise that can be linked using this key.', on_delete=django.db.models.deletion.CASCADE, related_name='invite_keys', to='enterprise.EnterpriseCustomer')),
             ],
             options={
-                'ordering': ('-history_date', '-history_id'),
-                'get_latest_by': 'history_date',
-                'verbose_name': 'historical Enterprise Customer Entitlement',
+                'abstract': False,
             },
         ),
+        migrations.AddField(
+            model_name='enterprisecustomeruser',
+            name='invite_key',
+            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='linked_enterprise_customer_users', to='enterprise.EnterpriseCustomerInviteKey'),
+        ),
+        migrations.AddField(
+            model_name='historicalenterprisecustomeruser',
+            name='invite_key',
+            field=models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomerInviteKey'),
+        ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0075_auto_20190916_1030.py` & `edx-enterprise-4.0.0/enterprise/migrations/0152_add_should_inactivate_other_customers.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,35 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.23 on 2019-09-16 15:30
-
+# Generated by Django 3.2.10 on 2022-02-01 16:08
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0074_auto_20190904_1143'),
+        ('enterprise', '0151_add_is_active_to_invite_key'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomer',
-            name='enable_learner_portal',
-            field=models.BooleanField(default=False, help_text='Specifies whether the enterprise learner portal site should be made known to the learner.'),
-        ),
-        migrations.AddField(
-            model_name='enterprisecustomer',
-            name='learner_portal_hostname',
-            field=models.CharField(blank=True, default='', help_text='Hostname of the enterprise learner portal.', max_length=255),
-        ),
-        migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='enable_learner_portal',
-            field=models.BooleanField(default=False, help_text='Specifies whether the enterprise learner portal site should be made known to the learner.'),
+            model_name='enterprisecustomeruser',
+            name='should_inactivate_other_customers',
+            field=models.BooleanField(default=True, help_text='When enabled along with `active`, all other linked enterprise customers for this user will be marked as inactive upon save.'),
         ),
         migrations.AddField(
-            model_name='historicalenterprisecustomer',
-            name='learner_portal_hostname',
-            field=models.CharField(blank=True, default='', help_text='Hostname of the enterprise learner portal.', max_length=255),
+            model_name='historicalenterprisecustomeruser',
+            name='should_inactivate_other_customers',
+            field=models.BooleanField(default=True, help_text='When enabled along with `active`, all other linked enterprise customers for this user will be marked as inactive upon save.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0091_add_sales_force_id_in_pendingenrollment.py` & `edx-enterprise-4.0.0/enterprise/migrations/0172_auto_20230517_1550.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.27 on 2020-03-11 08:08
-
+# Generated by Django 3.2.19 on 2023-05-17 15:50
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0090_update_content_filter'),
+        ('enterprise', '0171_auto_20230503_1413'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='historicalpendingenrollment',
-            name='sales_force_id',
-            field=models.CharField(blank=True, max_length=255, null=True),
+            model_name='enterprisecourseenrollment',
+            name='unenrolled',
+            field=models.BooleanField(blank=True, db_index=True, default=None, help_text="Specifies whether the enterprise course enrollment's course enrollment object was unenrolled.", null=True),
         ),
         migrations.AddField(
-            model_name='pendingenrollment',
-            name='sales_force_id',
-            field=models.CharField(blank=True, max_length=255, null=True),
+            model_name='historicalenterprisecourseenrollment',
+            name='unenrolled',
+            field=models.BooleanField(blank=True, db_index=True, default=None, help_text="Specifies whether the enterprise course enrollment's course enrollment object was unenrolled.", null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/migrations/0105_add_branding_config_color_fields.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0019_auto_20221021_0159.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,30 +1,28 @@
-# Generated by Django 2.2.14 on 2020-08-03 14:55
+# Generated by Django 3.2.16 on 2022-10-21 01:59
 
 from django.db import migrations, models
 
-import enterprise.validators
-
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0104_sync_query_field'),
+        ('moodle', '0018_moodlelearnerdatatransmissionaudit_api_record'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='enterprisecustomerbrandingconfiguration',
-            name='primary_color',
-            field=models.CharField(blank=True, max_length=7, null=True, validators=[enterprise.validators.validate_hex_color]),
+            model_name='moodlelearnerdatatransmissionaudit',
+            name='content_title',
+            field=models.CharField(blank=True, default=None, max_length=255, null=True),
         ),
         migrations.AddField(
-            model_name='enterprisecustomerbrandingconfiguration',
-            name='secondary_color',
-            field=models.CharField(blank=True, max_length=7, null=True, validators=[enterprise.validators.validate_hex_color]),
+            model_name='moodlelearnerdatatransmissionaudit',
+            name='progress_status',
+            field=models.CharField(blank=True, max_length=255),
         ),
         migrations.AddField(
-            model_name='enterprisecustomerbrandingconfiguration',
-            name='tertiary_color',
-            field=models.CharField(blank=True, max_length=7, null=True, validators=[enterprise.validators.validate_hex_color]),
+            model_name='moodlelearnerdatatransmissionaudit',
+            name='user_email',
+            field=models.CharField(blank=True, max_length=255, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/enterprise/api/pagination.py` & `edx-enterprise-4.0.0/enterprise/api/pagination.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,16 +1,15 @@
-# -*- coding: utf-8 -*-
 """
 Pagination helpers for enterprise api.
 """
 
 from collections import OrderedDict
+from urllib.parse import urlparse
 
 from rest_framework.response import Response
-from six.moves.urllib.parse import urlparse  # pylint: disable=import-error
 
 
 def get_paginated_response(data, request):
     """
     Update pagination links in course catalog data and return DRF Response.
 
     Arguments:
```

### Comparing `edx-enterprise-3.9.9/enterprise/api/throttles.py` & `edx-enterprise-4.0.0/enterprise/api/throttles.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,53 +1,90 @@
-# -*- coding: utf-8 -*-
 """
 Throttle classes for enterprise API.
 """
 
 from rest_framework.throttling import UserRateThrottle
 
 from enterprise.api.utils import get_service_usernames
 
 SERVICE_USER_SCOPE = 'service_user'
+HIGH_SERVICE_USER_SCOPE = 'high_service_user'
 
 
-class ServiceUserThrottle(UserRateThrottle):
+class BaseThrottle(UserRateThrottle):
     """
-    A throttle allowing the service user to override rate limiting.
+    Base throttle class with common functionality.
     """
 
     def allow_request(self, request, view):
         """
         Modify throttling for service users.
 
-        Updates throttling rate if the request is coming from the service user, and
-        defaults to UserRateThrottle's configured setting otherwise.
+        Updates throttling rate if the request is coming from the service user, and defaults to UserRateThrottle's
+        configured setting otherwise.
+
+        Updated throttling rate comes from `DEFAULT_THROTTLE_RATES` key in `REST_FRAMEWORK` setting. specific user
+        throttling is specified in `DEFAULT_THROTTLE_RATES` by it's corresponding key.
 
-        Updated throttling rate comes from `DEFAULT_THROTTLE_RATES` key in `REST_FRAMEWORK`
-        setting. service user throttling is specified in `DEFAULT_THROTTLE_RATES` by `service_user` key
+        .. code-block::
 
-        Example Setting:
-            ```
             REST_FRAMEWORK = {
-                ...
                 'DEFAULT_THROTTLE_RATES': {
-                    ...
-                    'service_user': '50/day'
+                    'service_user': '50/day',
+                    'high_service_user': '2000/minute',
                 }
             }
-            ```
         """
         service_users = get_service_usernames()
 
-        # User service user throttling rates for service user.
+        # Update throttle scope if the request user is a service user.
         if request.user.username in service_users:
             self.update_throttle_scope()
 
-        return super(ServiceUserThrottle, self).allow_request(request, view)
+        return super().allow_request(request, view)
+
+    def get_scope(self):
+        """
+        Get the scope of the throttle.
+
+        Raises:
+            NotImplementedError: Must be implemented by subclasses
+        """
+        raise NotImplementedError("Subclasses must implement get_scope.")
 
     def update_throttle_scope(self):
         """
-        Update throttle scope so that service user throttle rates are applied.
+        Update throttle scope based on the specific subclass.
         """
-        self.scope = SERVICE_USER_SCOPE
+        self.scope = self.get_scope()
         self.rate = self.get_rate()
         self.num_requests, self.duration = self.parse_rate(self.rate)
+
+
+class ServiceUserThrottle(BaseThrottle):
+    """
+    A throttle allowing the service user to override rate limiting.
+    """
+
+    def get_scope(self):
+        """
+        Get the scope of the throttle.
+
+        Returns:
+            str: The scope of the throttle.
+        """
+        return SERVICE_USER_SCOPE
+
+
+class HighServiceUserThrottle(BaseThrottle):
+    """
+    A throttle for high service users.
+    """
+
+    def get_scope(self):
+        """
+        Get the scope of the throttle.
+
+        Returns:
+            str: The scope of the throttle.
+        """
+        return HIGH_SERVICE_USER_SCOPE
```

### Comparing `edx-enterprise-3.9.9/enterprise/api/utils.py` & `edx-enterprise-4.0.0/enterprise/api/utils.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,17 +1,17 @@
-# -*- coding: utf-8 -*-
 """
 Utility functions for the Enterprise API.
 """
 
 from django.conf import settings
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
 from enterprise.models import (
     EnterpriseCustomerCatalog,
+    EnterpriseCustomerInviteKey,
     EnterpriseCustomerReportingConfiguration,
     EnterpriseCustomerUser,
 )
 
 SERVICE_USERNAMES = (
     'ECOMMERCE_SERVICE_WORKER_USERNAME',
     'ENTERPRISE_SERVICE_WORKER_USERNAME'
@@ -83,7 +83,18 @@
                          token_notes=notes)
     else:
         body_msg = _('{token_email} from {token_enterprise_name} has requested additional codes.'
                      ' Please reach out to them.').format(
                          token_email=email,
                          token_enterprise_name=enterprise_name)
     return body_msg
+
+
+def get_ent_cust_from_enterprise_customer_key(enterprise_customer_key):
+    """
+    Get the enterprise customer id given an enterprise customer key.
+    """
+
+    try:
+        return str(EnterpriseCustomerInviteKey.objects.get(uuid=enterprise_customer_key).enterprise_customer_id)
+    except EnterpriseCustomerInviteKey.DoesNotExist:
+        return None
```

### Comparing `edx-enterprise-3.9.9/enterprise/api/v1/decorators.py` & `edx-enterprise-4.0.0/enterprise/api/v1/decorators.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Decorators for Enterprise API views.
 """
 
 from functools import wraps
 
 from rest_framework.exceptions import ValidationError
@@ -14,14 +13,15 @@
 
     This decorator checks for the existence of at least one of the specified query
     parameters and passes the values as function parameters to the decorated view.
     If none of the specified query parameters are included in the request, a
     ValidationError is raised.
 
     Usage::
+
         @require_at_least_one_query_parameter('program_uuids', 'course_run_ids')
         def my_view(request, program_uuids, course_run_ids):
             # Some functionality ...
     """
     def outer_wrapper(view):
         """ Allow the passing of parameters to require_at_least_one_query_parameter. """
         @wraps(view)
```

### Comparing `edx-enterprise-3.9.9/enterprise/api/v1/serializers.py` & `edx-enterprise-4.0.0/enterprise/admin/__init__.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,916 +1,1017 @@
-# -*- coding: utf-8 -*-
 """
-Serializers for enterprise api version 1.
+Django admin integration for enterprise app.
 """
 
-import copy
-from logging import getLogger
-
-from edx_rest_api_client.exceptions import HttpClientError
-from rest_framework import serializers
-from rest_framework.settings import api_settings
-
-from django.contrib.auth.models import User
-from django.contrib.sites.models import Site
-from django.utils.translation import ugettext_lazy as _
-
-from enterprise import models, utils
-from enterprise.api_client.lms import ThirdPartyAuthApiClient
-from enterprise.constants import ENTERPRISE_PERMISSION_GROUPS, DefaultColors
-from enterprise.utils import (
-    CourseEnrollmentDowngradeError,
-    CourseEnrollmentPermissionError,
-    has_course_run_available_for_enrollment,
-    track_enrollment,
+import json
+import logging
+from urllib.parse import urlencode
+
+from config_models.admin import ConfigurationModelAdmin
+from django_object_actions import DjangoObjectActions
+from edx_rbac.admin import UserRoleAssignmentAdmin
+from simple_history.admin import SimpleHistoryAdmin
+
+from django.conf import settings
+from django.contrib import admin, auth
+from django.core.exceptions import MultipleObjectsReturned, ObjectDoesNotExist
+from django.core.paginator import Paginator
+from django.db import connection
+from django.db.models import Q
+from django.http import HttpResponseRedirect
+from django.urls import path, re_path, reverse
+from django.utils.html import format_html
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext as _
+
+from enterprise import constants
+from enterprise.admin.actions import export_as_csv_action, refresh_catalog
+from enterprise.admin.forms import (
+    AdminNotificationForm,
+    EnterpriseCustomerAdminForm,
+    EnterpriseCustomerCatalogAdminForm,
+    EnterpriseCustomerIdentityProviderAdminForm,
+    EnterpriseCustomerReportingConfigAdminForm,
+    EnterpriseFeatureUserRoleAssignmentForm,
+    SystemWideEnterpriseUserRoleAssignmentForm,
+)
+from enterprise.admin.utils import UrlNames
+from enterprise.admin.views import (
+    CatalogQueryPreviewView,
+    EnterpriseCustomerManageLearnerDataSharingConsentView,
+    EnterpriseCustomerManageLearnersView,
+    EnterpriseCustomerTransmitCoursesView,
+    TemplatePreviewView,
+)
+from enterprise.api_client.lms import CourseApiClient, EnrollmentApiClient
+from enterprise.config.models import UpdateRoleAssignmentsWithCustomersConfig
+from enterprise.models import (
+    AdminNotification,
+    AdminNotificationFilter,
+    AdminNotificationRead,
+    EnrollmentNotificationEmailTemplate,
+    EnterpriseCatalogQuery,
+    EnterpriseCourseEnrollment,
+    EnterpriseCustomer,
+    EnterpriseCustomerBrandingConfiguration,
+    EnterpriseCustomerCatalog,
+    EnterpriseCustomerIdentityProvider,
+    EnterpriseCustomerInviteKey,
+    EnterpriseCustomerReportingConfiguration,
+    EnterpriseCustomerType,
+    EnterpriseCustomerUser,
+    EnterpriseFeatureUserRoleAssignment,
+    PendingEnrollment,
+    PendingEnterpriseCustomerAdminUser,
+    PendingEnterpriseCustomerUser,
+    SystemWideEnterpriseUserRoleAssignment,
 )
+from enterprise.utils import discovery_query_url, get_all_field_names, get_default_catalog_content_filter
+
+try:
+    from enterprise.api_client.enterprise_catalog import EnterpriseCatalogApiClient
+except ImportError:
+    EnterpriseCatalogApiClient = None
+
+try:
+    from openedx.features.enterprise_support.admin.views import EnrollmentAttributeOverrideView
+except ImportError:
+    EnrollmentAttributeOverrideView = None
+User = auth.get_user_model()
 
-LOGGER = getLogger(__name__)
 
+logger = logging.getLogger(__name__)
 
-class ImmutableStateSerializer(serializers.Serializer):
+
+class EnterpriseCustomerBrandingConfigurationInline(admin.StackedInline):
     """
-    Base serializer for any serializer that inhibits state changing requests.
+    Django admin model for EnterpriseCustomerBrandingConfiguration.
+
+    The admin interface has the ability to edit models on the same page as a parent model. These are called inlines.
+    https://docs.djangoproject.com/en/1.8/ref/contrib/admin/#django.contrib.admin.StackedInline
     """
 
-    def create(self, validated_data):
-        """
-        Do not perform any operations for state changing requests.
-        """
+    model = EnterpriseCustomerBrandingConfiguration
+    can_delete = False
 
-    def update(self, instance, validated_data):
-        """
-        Do not perform any operations for state changing requests.
-        """
 
+class EnterpriseCustomerIdentityProviderInline(admin.StackedInline):
+    """
+    Django admin model for EnterpriseCustomerIdentityProvider.
+
+    The admin interface has the ability to edit models on the same page as a parent model. These are called inlines.
+    https://docs.djangoproject.com/en/1.8/ref/contrib/admin/#django.contrib.admin.StackedInline
+    """
+
+    model = EnterpriseCustomerIdentityProvider
+    form = EnterpriseCustomerIdentityProviderAdminForm
+    extra = 0
 
-class ResponsePaginationSerializer(ImmutableStateSerializer):
+
+class EnterpriseCustomerCatalogInline(admin.TabularInline):
     """
-    Serializer for responses that require pagination.
+    Django admin model for EnterpriseCustomerCatalog.
+    The admin interface has the ability to edit models on the same page as a parent model. These are called inlines.
+    https://docs.djangoproject.com/en/1.8/ref/contrib/admin/#django.contrib.admin.StackedInline
     """
 
-    count = serializers.IntegerField(read_only=True, help_text=_('Total count of items.'))
-    next = serializers.CharField(read_only=True, help_text=_('URL to fetch next page of items.'))
-    previous = serializers.CharField(read_only=True, help_text=_('URL to fetch previous page of items.'))
-    results = serializers.ListField(read_only=True, help_text=_('List of items.'))
+    model = EnterpriseCustomerCatalog
+    form = EnterpriseCustomerCatalogAdminForm
+    extra = 0
+    can_delete = False
+
+    def get_formset(self, request, obj=None, **kwargs):
+        formset = super().get_formset(request, obj, **kwargs)
+        formset.form.base_fields['content_filter'].initial = get_default_catalog_content_filter()
+        return formset
 
 
-class SiteSerializer(serializers.ModelSerializer):
+class PendingEnterpriseCustomerAdminUserInline(admin.TabularInline):
     """
-    Serializer for Site model.
+    Django admin inline model for PendingEnterpriseCustomerAdminUser.
     """
 
-    class Meta:
-        model = Site
-        fields = (
-            'domain', 'name',
-        )
+    model = PendingEnterpriseCustomerAdminUser
+    extra = 0
+    fieldsets = (
+        (None, {
+            'fields': ('user_email', 'get_admin_registration_url')
+        }),
+    )
+    readonly_fields = (
+        'get_admin_registration_url',
+    )
+
+    def get_admin_registration_url(self, obj):
+        """
+        Formats the ``admin_registration_url`` model property as an HTML link.
+        """
+        return format_html('<a href="{0}">{0}</a>'.format(obj.admin_registration_url))
+
+    get_admin_registration_url.short_description = 'Admin Registration Link'
 
 
-class UserSerializer(serializers.ModelSerializer):
+@admin.register(EnterpriseCustomerType)
+class EnterpriseCustomerTypeAdmin(admin.ModelAdmin):
     """
-    Serializer for User model.
+    Django admin model for EnterpriseCustomerType.
     """
 
     class Meta:
-        model = User
-        fields = (
-            'id', 'username', 'first_name', 'last_name', 'email', 'is_staff', 'is_active', 'date_joined'
-        )
+        model = EnterpriseCustomerType
+
+    fields = (
+        'name',
+    )
+
+    list_display = ('name', )
+    search_fields = ('name', )
 
 
-class EnterpriseCustomerBrandingConfigurationSerializer(serializers.ModelSerializer):
+@admin.register(EnterpriseCustomer)
+class EnterpriseCustomerAdmin(DjangoObjectActions, SimpleHistoryAdmin):
     """
-    Serializer for EnterpriseCustomerBrandingConfiguration model.
+    Django admin model for EnterpriseCustomer.
     """
+    list_display = (
+        'name',
+        'slug',
+        'customer_type',
+        'site',
+        'country',
+        'active',
+        'has_logo',
+        'enable_dsc',
+        'has_identity_provider',
+        'uuid',
+    )
+
+    list_filter = ('active',)
+    ordering = ('name',)
+    search_fields = ('name', 'uuid',)
+    inlines = [
+        EnterpriseCustomerBrandingConfigurationInline,
+        EnterpriseCustomerIdentityProviderInline,
+        EnterpriseCustomerCatalogInline,
+        PendingEnterpriseCustomerAdminUserInline,
+    ]
+
+    EXPORT_AS_CSV_FIELDS = ['name', 'active', 'site', 'uuid', 'identity_provider']
+
+    actions = [
+        export_as_csv_action('CSV Export', fields=EXPORT_AS_CSV_FIELDS),
+    ]
+
+    change_actions = ('manage_learners', 'manage_learners_data_sharing_consent', 'transmit_courses_metadata')
+
+    form = EnterpriseCustomerAdminForm
 
     class Meta:
-        model = models.EnterpriseCustomerBrandingConfiguration
-        fields = (
-            'enterprise_customer',
-            'enterprise_slug',
-            'logo',
-            'primary_color',
-            'secondary_color',
-            'tertiary_color',
+        model = EnterpriseCustomer
+
+    def get_search_results(self, request, queryset, search_term):
+        original_queryset = queryset
+        queryset, use_distinct = super().get_search_results(request, queryset, search_term)
+
+        # default admin search uses `__icontains` and it will return nothing if uuid
+        # contains hyphens even if that uuid has an associated record present in model
+        # for more details see https://code.djangoproject.com/ticket/29915
+        if not queryset:
+            queryset, use_distinct = super().get_search_results(
+                request, original_queryset, search_term.replace('-', '')
+            )
+
+        return queryset, use_distinct
+
+    def change_view(self, request, object_id, form_url='', extra_context=None):
+        catalog_uuid = EnterpriseCustomerCatalogAdminForm.get_catalog_preview_uuid(request.POST)
+        if catalog_uuid:
+            catalog_content_metadata_url = \
+                EnterpriseCatalogApiClient.get_content_metadata_url(catalog_uuid)
+            return HttpResponseRedirect(catalog_content_metadata_url)
+        return super().change_view(
+            request,
+            object_id,
+            form_url,
+            extra_context=extra_context
         )
 
-    enterprise_customer = serializers.SerializerMethodField()
-    enterprise_slug = serializers.SerializerMethodField()
-    logo = serializers.SerializerMethodField()
-    primary_color = serializers.SerializerMethodField()
-    secondary_color = serializers.SerializerMethodField()
-    tertiary_color = serializers.SerializerMethodField()
+    def get_form(self, request, obj=None, change=False, **kwargs):
+        """
+        Retrieve the appropriate form to use, saving the request user
+        into the form for use in loading catalog details
+        """
+        form = super().get_form(request, obj, change, **kwargs)
+        form.user = request.user
+        return form
+
+    def enable_dsc(self, instance):
+        """
+        Return True if data sharing consent is enabled for EnterpriseCustomer.
 
-    def get_enterprise_customer(self, obj):
+        Arguments:
+            instance (enterprise.models.EnterpriseCustomer): `EnterpriseCustomer` model instance
+        """
+        return instance.enable_data_sharing_consent
+
+    enable_dsc.boolean = True
+    enable_dsc.short_description = 'Enable DSC'
+
+    def has_logo(self, instance):
         """
-        Return a string representation of the associated enterprise customer's UUID.
+        Return True if EnterpriseCustomer has a logo.
+
+        Arguments:
+            instance (enterprise.models.EnterpriseCustomer): `EnterpriseCustomer` model instance
         """
-        return str(obj.enterprise_customer.uuid)
+        has_logo = False
+        if hasattr(instance, 'branding_configuration') and instance.branding_configuration.logo:
+            has_logo = True
+
+        return has_logo
+
+    has_logo.boolean = True
+    has_logo.short_description = 'Logo'
 
-    def get_enterprise_slug(self, obj):
+    def has_identity_provider(self, instance):
         """
-        Return the slug of the associated enterprise customer.
+        Return True if EnterpriseCustomer has related identity provider.
+
+        Arguments:
+            instance (enterprise.models.EnterpriseCustomer): `EnterpriseCustomer` model instance
         """
-        return obj.enterprise_customer.slug
+        return instance.has_identity_providers
 
-    def get_logo(self, obj):
+    has_identity_provider.boolean = True
+    has_identity_provider.short_description = 'Identity provider'
+
+    def manage_learners_data_sharing_consent(self, request, obj):
         """
-        Use EnterpriseCustomerBrandingConfiguration.safe_logo_url to return an absolute
-        URL for either the saved customer logo or the platform logo by default
+        Object tool handler method - redirects to "Clear Learners Data Sharing Consent" view
         """
-        return obj.safe_logo_url
+        # url names coming from get_urls are prefixed with 'admin' namespace
+        return HttpResponseRedirect(reverse("admin:" + UrlNames.MANAGE_LEARNERS_DSC, args=(obj.uuid,)))
+
+    manage_learners_data_sharing_consent.label = "Clear Data Sharing Consent"
+    manage_learners_data_sharing_consent.short_description = "Clear Data Sharing Consent for a Learner."
 
-    def get_primary_color(self, obj):
+    def manage_learners(self, request, obj):
         """
-        Return the primary color of the branding config OR the default primary color code
+        Object tool handler method - redirects to "Manage Learners" view
         """
-        return obj.primary_color if obj.primary_color else DefaultColors.PRIMARY
+        # url names coming from get_urls are prefixed with 'admin' namespace
+        manage_learners_url = reverse("admin:" + UrlNames.MANAGE_LEARNERS, args=(obj.uuid,))
+        return HttpResponseRedirect(manage_learners_url)
 
-    def get_secondary_color(self, obj):
+    manage_learners.label = "Manage Learners"
+    manage_learners.short_description = "Allows managing learners for this Enterprise Customer"
+
+    def transmit_courses_metadata(self, request, obj):
         """
-        Return the secondary color of the branding config OR the default secondary color code
+        Object tool handler method - redirects to `Transmit Courses Metadata` view.
         """
-        return obj.secondary_color if obj.secondary_color else DefaultColors.SECONDARY
+        # url names coming from get_urls are prefixed with 'admin' namespace
+        transmit_courses_metadata_url = reverse('admin:' + UrlNames.TRANSMIT_COURSES_METADATA, args=(obj.uuid,))
+        return HttpResponseRedirect(transmit_courses_metadata_url)
+
+    transmit_courses_metadata.label = 'Transmit Courses Metadata'
+    transmit_courses_metadata.short_description = 'Transmit courses metadata for this Enterprise Customer'
 
-    def get_tertiary_color(self, obj):
+    def get_urls(self):
         """
-        Return the tertiary color of the branding config OR the default tertiary color code
+        Returns the additional urls used by the custom object tools.
         """
-        return obj.tertiary_color if obj.tertiary_color else DefaultColors.TERTIARY
+        customer_urls = [
+            re_path(
+                r"^([^/]+)/manage_learners$",
+                self.admin_site.admin_view(EnterpriseCustomerManageLearnersView.as_view()),
+                name=UrlNames.MANAGE_LEARNERS
+            ),
+            re_path(
+                r"^([^/]+)/clear_learners_data_sharing_consent",
+                self.admin_site.admin_view(EnterpriseCustomerManageLearnerDataSharingConsentView.as_view()),
+                name=UrlNames.MANAGE_LEARNERS_DSC
+            ),
+            re_path(
+                r"^([^/]+)/transmit_courses_metadata",
+                self.admin_site.admin_view(EnterpriseCustomerTransmitCoursesView.as_view()),
+                name=UrlNames.TRANSMIT_COURSES_METADATA
+            )
+        ]
+        return customer_urls + super().get_urls()
 
 
-class EnterpriseCustomerSerializer(serializers.ModelSerializer):
+@admin.register(EnterpriseCustomerUser)
+class EnterpriseCustomerUserAdmin(admin.ModelAdmin):
     """
-    Serializer for EnterpriseCustomer model.
+    Django admin model for EnterpriseCustomerUser.
     """
 
     class Meta:
-        model = models.EnterpriseCustomer
-        fields = (
-            'uuid', 'name', 'slug', 'active', 'site', 'enable_data_sharing_consent',
-            'enforce_data_sharing_consent', 'branding_configuration',
-            'identity_provider', 'enable_audit_enrollment', 'replace_sensitive_sso_username',
-            'enable_portal_code_management_screen', 'sync_learner_profile_data', 'enable_audit_data_reporting',
-            'enable_learner_portal', 'enable_portal_reporting_config_screen',
-            'enable_portal_saml_configuration_screen', 'contact_email',
-            'enable_portal_subscription_management_screen', 'hide_course_original_price', 'enable_analytics_screen',
-            'enable_integrated_customer_learner_portal_search',
-        )
+        model = EnterpriseCustomerUser
+
+    fields = (
+        'user_id',
+        'enterprise_customer',
+        'user_email',
+        'username',
+        'created',
+        'enterprise_enrollments',
+        'other_enrollments',
+        'invite_key',
+        'active',
+        'should_inactivate_other_customers',
+    )
+
+    # Only include fields that are not database-backed; DB-backed fields
+    # are dynamically set as read only.
+    readonly_fields = (
+        'user_email',
+        'username',
+        'created',
+        'enterprise_enrollments',
+        'other_enrollments',
+    )
 
-    site = SiteSerializer()
-    branding_configuration = serializers.SerializerMethodField()
+    list_display = ('username', 'user_email', 'get_enterprise_customer')
+    search_fields = ('user_id',)
 
-    def get_branding_configuration(self, obj):
+    def get_enterprise_customer(self, obj):
         """
-        Return the serialized branding configuration object OR default object if null
+        Returns the name of enterprise customer linked with the enterprise customer user.
         """
-        return EnterpriseCustomerBrandingConfigurationSerializer(obj.safe_branding_configuration).data
+        return obj.enterprise_customer.name
+    get_enterprise_customer.short_description = 'Enterprise Customer'
 
+    def get_search_results(self, request, queryset, search_term):
+        search_term = search_term.strip()
+        use_distinct = False
+
+        if search_term:
+            queryset = EnterpriseCustomerUser.objects.filter(
+                user_id__in=User.objects.filter(
+                    Q(email__icontains=search_term) | Q(username__icontains=search_term)
+                )
+            )
+        else:
+            queryset, use_distinct = super().get_search_results(
+                request,
+                queryset,
+                search_term
+            )
 
-class EnterpriseCustomerBasicSerializer(serializers.ModelSerializer):
-    """
-    Serializer for EnterpriseCustomer model only for name and id fields.
-    """
+        return queryset, use_distinct
 
-    class Meta:
-        model = models.EnterpriseCustomer
-        fields = ('id', 'name')
+    def enterprise_enrollments(self, enterprise_customer_user):
+        """
+        Return a string representing a given EnterpriseCustomerUser's enterprise course enrollments
 
-    id = serializers.CharField(source='uuid')  # pylint: disable=invalid-name
+        Args:
+            enterprise_customer_user: The instance of EnterpriseCustomerUser
+                being rendered with this admin form.
+        """
+        enterprise_course_ids = self._get_enterprise_course_enrollments(enterprise_customer_user)
+        courses_string = mark_safe(self.get_enrolled_course_string(enterprise_course_ids))
+        return courses_string or 'None'
 
+    def other_enrollments(self, enterprise_customer_user):
+        """
+        Return a string representing a given EnterpriseCustomerUser's non-enterprise course enrollments
 
-class EnterpriseCourseEnrollmentReadOnlySerializer(serializers.ModelSerializer):
-    """
-    Serializer for EnterpriseCourseEnrollment model.
-    """
+        Args:
+            enterprise_customer_user: The instance of EnterpriseCustomerUser
+                being rendered with this admin form.
+        """
+        all_course_ids = self._get_all_enrollments(enterprise_customer_user)
+        enterprise_course_ids = self._get_enterprise_course_enrollments(enterprise_customer_user)
+        # remove overlapping enterprise enrollments from all enrollments
+        course_ids = set(all_course_ids) - set(enterprise_course_ids)
+        courses_string = mark_safe(self.get_enrolled_course_string(course_ids))
+        return courses_string or 'None'
 
-    class Meta:
-        model = models.EnterpriseCourseEnrollment
-        fields = (
-            'enterprise_customer_user', 'course_id'
-        )
+    def _get_enterprise_course_enrollments(self, enterprise_customer_user):
+        """
+        Return a list of course ids representing a given EnterpriseCustomerUser's enterprise course enrollments
 
+        Args:
+            enterprise_customer_user: The instance of EnterpriseCustomerUser
+                being rendered with this admin form.
+        """
+        enrollments = EnterpriseCourseEnrollment.objects.filter(enterprise_customer_user=enterprise_customer_user)
+        return [enrollment.course_id for enrollment in enrollments]
 
-class EnterpriseCourseEnrollmentWriteSerializer(serializers.ModelSerializer):
-    """
-    Serializer for writing to the EnterpriseCourseEnrollment model.
-    """
+    def _get_all_enrollments(self, enterprise_customer_user):
+        """
+        Return a list of course ids representing a given EnterpriseCustomerUser's course enrollments,
+        including both enterprise and non-enterprise course enrollments
 
-    class Meta:
-        model = models.EnterpriseCourseEnrollment
-        fields = (
-            'username', 'course_id',
-        )
+        Args:
+            enterprise_customer_user: The instance of EnterpriseCustomerUser
+                being rendered with this admin form.
+        """
+        enrollment_client = EnrollmentApiClient()
+        enrollments = enrollment_client.get_enrolled_courses(enterprise_customer_user.username)
+        return [enrollment['course_details']['course_id'] for enrollment in enrollments]
 
-    username = serializers.CharField(max_length=30)
-    enterprise_customer_user = None
+    def get_readonly_fields(self, request, obj=None):
+        """
+        Make all fields readonly when editing existing model.
+        """
+        readonly_fields = super().get_readonly_fields(request, obj=obj)
+        if obj:  # editing an existing object
+            return readonly_fields + tuple(get_all_field_names(self.model))
+        return readonly_fields
 
-    def validate_username(self, value):
+    def get_enrolled_course_string(self, course_ids):
         """
-        Verify that the username has a matching user, and that the user has an associated EnterpriseCustomerUser.
+        Get an HTML string representing the courses the user is enrolled in.
         """
-        try:
-            user = User.objects.get(username=value)
-        except User.DoesNotExist:
-            error_message = ('[Enterprise API] The username for creating an EnterpriseCourseEnrollment'
-                             ' record does not exist. User: {}').format(value)
-            LOGGER.error(error_message)
-            raise serializers.ValidationError("User does not exist")
-
-        try:
-            enterprise_customer_user = models.EnterpriseCustomerUser.objects.get(user_id=user.pk)
-        except models.EnterpriseCustomerUser.DoesNotExist:
-            error_message = '[Enterprise API] User has no EnterpriseCustomerUser. User: {}'.format(value)
-            LOGGER.error(error_message)
-            raise serializers.ValidationError("User has no EnterpriseCustomerUser")
-
-        self.enterprise_customer_user = enterprise_customer_user
-        return value
-
-    def save(self):  # pylint: disable=arguments-differ
-        """
-        Save the model with the found EnterpriseCustomerUser.
-        """
-        course_id = self.validated_data['course_id']
-
-        __, created = models.EnterpriseCourseEnrollment.objects.get_or_create(
-            enterprise_customer_user=self.enterprise_customer_user,
-            course_id=course_id,
-            defaults={
-                'source': models.EnterpriseEnrollmentSource.get_source(
-                    models.EnterpriseEnrollmentSource.OFFER_REDEMPTION
-                )
-            }
+        courses_client = CourseApiClient()
+        course_details = []
+        for course_id in course_ids:
+            name = courses_client.get_course_details(course_id)['name']
+            course_details.append({'course_id': course_id, 'course_name': name})
+        template = '<a href="{url}">{course_name}</a>'
+        joiner = '<br/>'
+        return joiner.join(
+            template.format(
+                url=reverse('about_course', args=[course['course_id']]),
+                course_name=course['course_name'],
+            )
+            for course in course_details
         )
-        if created:
-            track_enrollment('rest-api-enrollment', self.enterprise_customer_user.user_id, course_id)
 
 
-class LicensedEnterpriseCourseEnrollmentReadOnlySerializer(serializers.ModelSerializer):
+@admin.register(PendingEnterpriseCustomerUser)
+class PendingEnterpriseCustomerUserAdmin(admin.ModelAdmin):
     """
-    Serializer for LicensedEnterpriseCourseEnrollment model.
+    Django admin model for PendingEnterpriseCustomerUser
     """
 
-    enterprise_course_enrollment = EnterpriseCourseEnrollmentReadOnlySerializer(read_only=True)
-
     class Meta:
-        model = models.LicensedEnterpriseCourseEnrollment
-        fields = (
-            'enterprise_course_enrollment', 'license_uuid'
-        )
+        model = PendingEnterpriseCustomerUser
 
+    fields = (
+        'user_email',
+        'enterprise_customer',
+        'created'
+    )
 
-class EnterpriseCustomerCatalogSerializer(serializers.ModelSerializer):
+    readonly_fields = (
+        'user_email',
+        'enterprise_customer',
+        'created'
+    )
+
+
+@admin.register(PendingEnterpriseCustomerAdminUser)
+class PendingEnterpriseCustomerAdminUserAdmin(admin.ModelAdmin):
     """
-    Serializer for the ``EnterpriseCustomerCatalog`` model.
+    Django admin model for PendingEnterpriseCustomerAdminUser
     """
 
     class Meta:
-        model = models.EnterpriseCustomerCatalog
-        fields = (
-            'uuid', 'title', 'enterprise_customer',
-        )
+        model = PendingEnterpriseCustomerAdminUser
+
+    fields = (
+        'user_email',
+        'enterprise_customer',
+        'get_admin_registration_url',
+    )
 
+    readonly_fields = (
+        'get_admin_registration_url',
+    )
 
-class EnterpriseCustomerCatalogDetailSerializer(EnterpriseCustomerCatalogSerializer):
-    """
-    Serializer for the ``EnterpriseCustomerCatalog`` model which includes
-    the catalog's discovery service search query results.
-    """
+    list_display = (
+        'user_email',
+        'get_enterprise_customer',
+        'get_admin_registration_url',
+    )
+
+    search_fields = (
+        'user_email',
+        'enterprise_customer__name',
+    )
 
-    def to_representation(self, instance):
+    def get_enterprise_customer(self, obj):
         """
-        Serialize the EnterpriseCustomerCatalog object.
+        Returns the name of the associated EnterpriseCustomer.
+        """
+        return obj.enterprise_customer.name
 
-        Arguments:
-            instance (EnterpriseCustomerCatalog): The EnterpriseCustomerCatalog to serialize.
+    get_enterprise_customer.short_description = 'Enterprise Customer'
 
-        Returns:
-            dict: The EnterpriseCustomerCatalog converted to a dict.
+    def get_admin_registration_url(self, obj):
         """
-        request = self.context['request']
-        enterprise_customer = instance.enterprise_customer
+        Formats the ``admin_registration_url`` model property as an HTML link.
+        """
+        return format_html('<a href="{0}">{0}</a>'.format(obj.admin_registration_url))
 
-        representation = super(EnterpriseCustomerCatalogDetailSerializer, self).to_representation(instance)
-
-        # Retrieve the EnterpriseCustomerCatalog search results from the discovery service.
-        paginated_content = instance.get_paginated_content(request.GET)
-        count = paginated_content['count']
-        search_results = paginated_content['results']
-
-        for item in search_results:
-            content_type = item['content_type']
-            marketing_url = item.get('marketing_url')
-            if marketing_url:
-                item['marketing_url'] = utils.update_query_parameters(
-                    marketing_url, utils.get_enterprise_utm_context(enterprise_customer)
-                )
-            # Add the Enterprise enrollment URL to each content item returned from the discovery service.
-            if content_type == 'course':
-                item['enrollment_url'] = instance.get_course_enrollment_url(item['key'])
-                item['active'] = has_course_run_available_for_enrollment(item['course_runs'])
-            if content_type == 'courserun':
-                item['enrollment_url'] = instance.get_course_run_enrollment_url(item['key'])
-            if content_type == 'program':
-                item['enrollment_url'] = instance.get_program_enrollment_url(item['uuid'])
-
-        # Build pagination URLs
-        previous_url = None
-        next_url = None
-        page = int(request.GET.get('page', '1'))
-        request_uri = request.build_absolute_uri()
-        if paginated_content['previous']:
-            previous_url = utils.update_query_parameters(request_uri, {'page': page - 1})
-        if paginated_content['next']:
-            next_url = utils.update_query_parameters(request_uri, {'page': page + 1})
-
-        representation['count'] = count
-        representation['previous'] = previous_url
-        representation['next'] = next_url
-        representation['results'] = search_results
-
-        return representation
-
-
-class EnterpriseCustomerUserReadOnlySerializer(serializers.ModelSerializer):
-    """
-    Serializer for EnterpriseCustomerUser model.
+    get_admin_registration_url.short_description = 'Admin Registration Link'
+
+
+@admin.register(EnrollmentNotificationEmailTemplate)
+class EnrollmentNotificationEmailTemplateAdmin(DjangoObjectActions, admin.ModelAdmin):
     """
+    Django admin for EnrollmentNotificationEmailTemplate model
+    """
+    change_actions = ("preview_as_course", "preview_as_program")
 
     class Meta:
-        model = models.EnterpriseCustomerUser
-        fields = (
-            'id', 'enterprise_customer', 'active', 'user_id', 'user', 'data_sharing_consent_records', 'groups'
-        )
+        model = EnrollmentNotificationEmailTemplate
 
-    user = UserSerializer()
-    enterprise_customer = EnterpriseCustomerSerializer()
-    data_sharing_consent_records = serializers.SerializerMethodField()
-    groups = serializers.SerializerMethodField()
-
-    def get_data_sharing_consent_records(self, obj):
+    def get_urls(self):
+        """
+        Returns the additional urls used by the custom object tools.
         """
-        Return serialization of EnterpriseCustomerUser.data_sharing_consent_records property.
+        preview_urls = [
+            re_path(
+                r"^([^/]+)/preview/([a-z]+)/$",
+                self.admin_site.admin_view(TemplatePreviewView.as_view()),
+                name=UrlNames.PREVIEW_EMAIL_TEMPLATE
+            )
+        ]
+        return preview_urls + super().get_urls()
 
-        Arguments:
-            EnterpriseCustomerUser: The EnterpriseCustomerUser.
+    def preview(self, obj, preview_type):
+        """
+        Object tool handler method - redirects to "Preview" view
+        """
+        # url names coming from get_urls are prefixed with 'admin' namespace
+        preview_url = reverse("admin:" + UrlNames.PREVIEW_EMAIL_TEMPLATE, args=(obj.pk, preview_type))
+        return HttpResponseRedirect(preview_url)
 
-        Returns:
-            list of dict: The serialized DataSharingConsent records associated with the EnterpriseCustomerUser.
+    def preview_as_course(self, request, obj):
+        """
+        Redirect to preview the HTML template in the context of a course.
         """
-        return [record.serialize() for record in obj.data_sharing_consent_records]
+        return self.preview(obj, 'course')
 
-    def get_groups(self, obj):
+    preview_as_course.label = _("Preview (course)")
+    preview_as_course.short_description = _(
+        "Preview the HTML template rendered in the context of a course enrollment."
+    )
+
+    def preview_as_program(self, request, obj):
         """
-        Return the enterprise related django groups that this user is a part of.
+        Redirect to preview the HTML template in the context of a program.
         """
-        if obj.user:
-            return [group.name for group in obj.user.groups.filter(name__in=ENTERPRISE_PERMISSION_GROUPS)]
-        return []
+        return self.preview(obj, 'program')
+
+    preview_as_program.label = _("Preview (program)")
+    preview_as_program.short_description = _(
+        "Preview the HTML template rendered in the context of a program enrollment."
+    )
 
 
-class EnterpriseCustomerUserWriteSerializer(serializers.ModelSerializer):
+@admin.register(EnterpriseCourseEnrollment)
+class EnterpriseCourseEnrollmentAdmin(admin.ModelAdmin):
     """
-    Serializer for writing to the EnterpriseCustomerUser model.
+    Django admin model for EnterpriseCourseEnrollment
     """
 
     class Meta:
-        model = models.EnterpriseCustomerUser
-        fields = (
-            'enterprise_customer', 'username', 'active'
-        )
+        model = EnterpriseCourseEnrollment
+
+    readonly_fields = (
+        'enterprise_customer_user',
+        'course_id',
+        'saved_for_later',
+        'license_uuid',
+    )
+
+    list_display = (
+        'enterprise_customer_user',
+        'course_id',
+        'saved_for_later',
+        'unenrolled_at',
+    )
 
-    username = serializers.CharField(max_length=30)
-    active = serializers.BooleanField(required=False, default=True)
-    user = None
+    change_list_template = "enterprise/admin/enterprise_course_enrollments_list.html"
+    search_fields = ('enterprise_customer_user__user_id', 'course_id',)
 
-    def validate_username(self, value):
+    def license_uuid(self, obj):
         """
-        Verify that the username has a matching user.
+        Return the subscription license UUID (if any exists)  associated with this enrollment.
         """
-        try:
-            self.user = User.objects.get(username=value)
-        except User.DoesNotExist:
-            error_message = ('[Enterprise API] Saving to EnterpriseCustomerUser failed'
-                             ' due to non-existing user. User: {}').format(value)
-            LOGGER.error(error_message)
-            raise serializers.ValidationError("User does not exist")
+        return str(obj.license.license_uuid)
 
-        return value
+    def has_add_permission(self, request):
+        """
+        Disable add permission for EnterpriseCourseEnrollment.
+        """
+        return False
 
-    def save(self):  # pylint: disable=arguments-differ
+    def has_delete_permission(self, request, obj=None):
         """
-        Save the EnterpriseCustomerUser.
+        Disable deletion for EnterpriseCourseEnrollment.
         """
-        enterprise_customer = self.validated_data['enterprise_customer']
-        active = self.validated_data.get('active', True)
-        defaults = {'active': active}
+        features = getattr(settings, 'FEATURES', {})
+        return features.get(constants.ALLOW_ADMIN_ENTERPRISE_COURSE_ENROLLMENT_DELETION, False)
 
-        __, created = models.EnterpriseCustomerUser.objects.update_or_create(
-            user_id=self.user.pk,
-            enterprise_customer=enterprise_customer,
-            defaults=defaults,
-        )
-        if not created and active:
-            # if learner has activated enterprise we need to de-activate other enterprises learner is linked to
-            models.EnterpriseCustomerUser.inactivate_other_customers(self.user.pk, enterprise_customer)
+    def changelist_view(self, request, extra_context=None):
+        """
+        Override to conditionally show the button.
+        """
+        extra_context = extra_context or {}
+        extra_context['attr_override_button'] = bool(EnrollmentAttributeOverrideView)
+        return super().changelist_view(request, extra_context=extra_context)
+
+    def get_urls(self):
+        """
+        Append `Enrollment Attribute Override` view url with default urls
+        """
+        custom_urls = []
+        if EnrollmentAttributeOverrideView:
+            custom_urls = [
+                path('override_attributes/', self.admin_site.admin_view(EnrollmentAttributeOverrideView.as_view()),
+                     name='enterprise_override_attributes'
+                     ),
+            ]
 
+        return custom_urls + super().get_urls()
 
-class PendingEnterpriseCustomerUserSerializer(serializers.ModelSerializer):
+
+@admin.register(PendingEnrollment)
+class PendingEnrollmentAdmin(admin.ModelAdmin):
     """
-    Serializer for writing to the PendingEnterpriseCustomerUser model.
+    Django admin model for PendingEnrollment
     """
 
     class Meta:
-        model = models.PendingEnterpriseCustomerUser
-        fields = (
-            'enterprise_customer', 'user_email'
-        )
+        model = PendingEnrollment
+
+    readonly_fields = (
+        'user',
+        'course_id',
+        'course_mode',
+    )
 
-    def validate(self, attrs):
+    list_display = (
+        'user',
+        'course_id',
+        'course_mode',
+    )
+
+    search_fields = ('user__user_email', 'course_id',)
+
+    def has_add_permission(self, request):
         """
-        Validate if the EnterpriseCustomerUser record already exists.
+        Disable add permission for PendingEnrollment.
         """
-        enterprise_customer = attrs.get('enterprise_customer')
-        user_email = attrs.get('user_email')
-        try:
-            user = User.objects.get(email=user_email)
-            models.EnterpriseCustomerUser.objects.get(
-                user_id=user.pk,
-                enterprise_customer=enterprise_customer
-            )
-        except (User.DoesNotExist, models.EnterpriseCustomerUser.DoesNotExist):
-            pass
-        else:
-            raise serializers.ValidationError('EnterpriseCustomerUser record already exists')
-
-        return attrs
+        return False
 
-    def save(self):  # pylint: disable=arguments-differ
+    def has_delete_permission(self, request, obj=None):
         """
-        Save the PendingEnterpriseCustomerUser, or EnterpriseCustomerUser
-        if a user with the validated_email already exists.
+        Disable deletion for PendingEnrollment.
         """
-        enterprise_customer = self.validated_data['enterprise_customer']
-        user_email = self.validated_data['user_email']
-        try:
-            user = User.objects.get(email=user_email)
-            defaults = {'active': user.is_active}
-            __, created = models.EnterpriseCustomerUser.objects.update_or_create(
-                user_id=user.pk,
-                enterprise_customer=enterprise_customer,
-                defaults=defaults,
-            )
-        except User.DoesNotExist:
-            __, created = models.PendingEnterpriseCustomerUser.objects.update_or_create(
-                user_email=user_email,
-                enterprise_customer=enterprise_customer,
-            )
-        return created
+        return False
 
 
-class CourseDetailSerializer(ImmutableStateSerializer):
+@admin.register(EnterpriseCatalogQuery)
+class EnterpriseCatalogQueryAdmin(admin.ModelAdmin):
     """
-    Serializer for course data retrieved from the discovery service course detail API endpoint.
-
-    This serializer updates the course and course run data with the EnterpriseCustomer-specific enrollment page URL
-    for the given course and course runs.
+    Django admin model for EnterpriseCatalogQuery.
     """
 
-    def to_representation(self, instance):
+    class Meta:
+        model = EnterpriseCatalogQuery
+
+    def get_urls(self):
+        """
+        Returns the additional urls used by the custom object tools.
         """
-        Return the updated course data dictionary.
+        preview_urls = [
+            re_path(
+                r"^([^/]+)/preview/$",
+                self.admin_site.admin_view(CatalogQueryPreviewView.as_view()),
+                name=UrlNames.PREVIEW_QUERY_RESULT
+            )
+        ]
+        return preview_urls + super().get_urls()
 
-        Arguments:
-            instance (dict): The course data.
+    list_display = (
+        'title',
+        'discovery_query_url',
+        'include_exec_ed_2u_courses',
+    )
 
-        Returns:
-            dict: The updated course data.
+    def discovery_query_url(self, obj):
         """
-        updated_course = copy.deepcopy(instance)
-        enterprise_customer_catalog = self.context['enterprise_customer_catalog']
-        updated_course['enrollment_url'] = enterprise_customer_catalog.get_course_enrollment_url(
-            updated_course['key']
+        Return discovery url for preview.
+        """
+        url = reverse("admin:" + UrlNames.PREVIEW_QUERY_RESULT, args=(obj.pk,))
+        return format_html(
+            '<a href="{url}" target="_blank">Preview</a>',
+            url=url
         )
-        for course_run in updated_course['course_runs']:
-            course_run['enrollment_url'] = enterprise_customer_catalog.get_course_run_enrollment_url(
-                course_run['key']
-            )
-        return updated_course
 
+    def has_delete_permission(self, request, obj=None):
+        return False
+
+    readonly_fields = ('discovery_query_url', 'uuid')
+    discovery_query_url.allow_tags = True
+    discovery_query_url.short_description = 'Preview Catalog Courses'
 
-class CourseRunDetailSerializer(ImmutableStateSerializer):
-    """
-    Serializer for course run data retrieved from the discovery service course_run detail API endpoint.
 
-    This serializer updates the course run data with the EnterpriseCustomer-specific enrollment page URL
-    for the given course run.
+@admin.register(EnterpriseCustomerCatalog)
+class EnterpriseCustomerCatalogAdmin(admin.ModelAdmin):
     """
+    Django admin model for EnterpriseCustomerCatalog.
+    """
+    ordering = ('enterprise_customer__name', 'title')
+    actions = [refresh_catalog]
 
-    def to_representation(self, instance):
-        """
-        Return the updated course run data dictionary.
+    class Meta:
+        model = EnterpriseCustomerCatalog
 
-        Arguments:
-            instance (dict): The course run data.
+    class Media:
+        js = ('enterprise/admin/enterprise_customer_catalog.js',)
 
-        Returns:
-            dict: The updated course run data.
-        """
-        updated_course_run = copy.deepcopy(instance)
-        enterprise_customer_catalog = self.context['enterprise_customer_catalog']
-        updated_course_run['enrollment_url'] = enterprise_customer_catalog.get_course_run_enrollment_url(
-            updated_course_run['key']
-        )
-        return updated_course_run
+    list_display = (
+        'uuid_nowrap',
+        'enterprise_customer',
+        'title',
+        'preview_catalog_url',
+    )
 
+    search_fields = (
+        'uuid',
+        'title',
+        'enterprise_customer__name',
+        'enterprise_customer__uuid',
+    )
 
-class ProgramDetailSerializer(ImmutableStateSerializer):
-    """
-    Serializer for program data retrieved from the discovery service program detail API endpoint.
+    fields = (
+        'title',
+        'enterprise_customer',
+        'enterprise_catalog_query',
+        'content_filter',
+        'enabled_course_modes',
+        'publish_audit_enrollment_urls',
+    )
 
-    This serializer updates the program data and child course run data with EnterpriseCustomer-specific
-    enrollment page URLs for the given content types.
-    """
+    def preview_catalog_url(self, obj):
+        """
+        Return enterprise catalog url for preview.
+        """
+        catalog_content_metadata_url = \
+            EnterpriseCatalogApiClient.get_content_metadata_url(obj.uuid)
+        return format_html(
+            '<a href="{url}" target="_blank">Preview</a>',
+            url=catalog_content_metadata_url
+        )
 
-    def to_representation(self, instance):
+    readonly_fields = ('preview_catalog_url',)
+    preview_catalog_url.short_description = 'Preview Catalog Courses'
+
+    def uuid_nowrap(self, obj):
+        """
+        Inject html for disabling wrap for uuid
         """
-        Return the updated program data dictionary.
+        return format_html('<span style="white-space: nowrap;">{uuid}</span>'.format(uuid=obj.uuid))
+    uuid_nowrap.short_description = 'UUID'
 
-        Arguments:
-            instance (dict): The program data.
+    def get_form(self, request, obj=None, change=False, **kwargs):
+        form = super().get_form(request, obj, change, **kwargs)
+        form.base_fields['content_filter'].initial = get_default_catalog_content_filter()
+        return form
 
-        Returns:
-            dict: The updated program data.
+    def get_actions(self, request):
         """
-        updated_program = copy.deepcopy(instance)
-        enterprise_customer_catalog = self.context['enterprise_customer_catalog']
-        updated_program['enrollment_url'] = enterprise_customer_catalog.get_program_enrollment_url(
-            updated_program['uuid']
-        )
-        for course in updated_program['courses']:
-            course['enrollment_url'] = enterprise_customer_catalog.get_course_enrollment_url(course['key'])
-            for course_run in course['course_runs']:
-                course_run['enrollment_url'] = enterprise_customer_catalog.get_course_run_enrollment_url(
-                    course_run['key']
-                )
-        return updated_program
+        Disallow the delete selected action as that does not send a DELETE request to enterprise-catalog
+        """
+        actions = super().get_actions(request)
+        if 'delete_selected' in actions:
+            del actions['delete_selected']
+        return actions
 
 
-class EnterpriseCustomerReportingConfigurationSerializer(serializers.ModelSerializer):
+@admin.register(EnterpriseCustomerReportingConfiguration)
+class EnterpriseCustomerReportingConfigurationAdmin(admin.ModelAdmin):
     """
-    Serializer for EnterpriseCustomerReportingConfiguration model.
+    Django admin model for EnterpriseCustomerReportingConfiguration.
     """
-    class Meta:
-        model = models.EnterpriseCustomerReportingConfiguration
-        fields = (
-            'enterprise_customer', 'enterprise_customer_id', 'active', 'delivery_method', 'email', 'frequency',
-            'day_of_month', 'day_of_week', 'hour_of_day', 'include_date', 'encrypted_password', 'sftp_hostname',
-            'sftp_port', 'sftp_username', 'encrypted_sftp_password', 'sftp_file_path', 'data_type', 'report_type',
-            'pgp_encryption_key', 'enterprise_customer_catalogs', 'uuid'
-        )
 
-    encrypted_password = serializers.CharField(required=False, allow_blank=False, read_only=False)
-    encrypted_sftp_password = serializers.CharField(required=False, allow_blank=False, read_only=False)
-    enterprise_customer = EnterpriseCustomerSerializer(read_only=True)
-    enterprise_customer_id = serializers.PrimaryKeyRelatedField(
-        queryset=models.EnterpriseCustomer.objects.all(),  # pylint: disable=no-member
-        source='enterprise_customer',
-        write_only=True
-    )
-    enterprise_customer_catalogs = EnterpriseCustomerCatalogSerializer(many=True, read_only=True)
-    email = serializers.ListField(
-        default=[],
-        child=serializers.EmailField()
+    list_display = (
+        "enterprise_customer",
+        "active",
+        "delivery_method",
+        "frequency",
+        "data_type",
+        "report_type",
     )
 
-    def validate(self, data):  # pylint: disable=arguments-differ
-        delivery_method = data.get('delivery_method')
-        if not delivery_method and self.instance:
-            delivery_method = self.instance.delivery_method
+    list_filter = ("active",)
+    search_fields = ("enterprise_customer__name", "email")
+    autocomplete_fields = ['enterprise_customer']
+    ordering = ('enterprise_customer__name',)
+
+    form = EnterpriseCustomerReportingConfigAdminForm
 
-        # in case of email delivery, email field should be populated with valid email(s)
-        if delivery_method == models.EnterpriseCustomerReportingConfiguration.DELIVERY_METHOD_EMAIL:
-            if 'email' in data and not bool(data['email']):
-                raise serializers.ValidationError({'email': ['This field is required']})
+    class Meta:
+        model = EnterpriseCustomerReportingConfiguration
 
-        return data
+    def get_fields(self, request, obj=None):
+        """
+        Return the fields that should be displayed on the admin form.
+        """
+        fields = list(super().get_fields(request, obj))
+        if obj:
+            # Exclude password fields when we are editing an existing model.
+            return [f for f in fields if f not in {'decrypted_password', 'decrypted_sftp_password'}]
 
+        return fields
 
-# pylint: disable=abstract-method
-class EnterpriseCustomerCourseEnrollmentsListSerializer(serializers.ListSerializer):
-    """
-    Serializes a list of enrollment requests.
 
-    Meant to be used in conjunction with EnterpriseCustomerCourseEnrollmentsSerializer.
+class BigTableMysqlPaginator(Paginator):
     """
+    A paginator that uses INFORMATION_SCHEMA.TABLES to estimate
+    the total number of rows in a table.
+    """
+    ARBITRARILY_LARGE_NUMBER = 10000000
 
-    def to_internal_value(self, data):
+    # pylint: disable=attribute-defined-outside-init
+    @property
+    def count(self):  # pylint: disable=invalid-overridden-method
         """
-        This implements the same relevant logic as ListSerializer except that if one or more items fail validation,
-        processing for other items that did not fail will continue.
+        Returns the number of items in the object list (possibly an estimate).
         """
+        query = self.object_list.query
 
-        if not isinstance(data, list):
-            message = self.error_messages['not_a_list'].format(
-                input_type=type(data).__name__
-            )
-            raise serializers.ValidationError({
-                api_settings.NON_FIELD_ERRORS_KEY: [message]
-            })
+        if query.where:
+            return super().count
+        if not getattr(self, '_whole_table_count', None):
+            try:
+                with connection.cursor() as cursor:
+                    cursor.execute(
+                        'SELECT TABLE_ROWS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = %s',
+                        [query.model._meta.db_table]
+                    )
+                    self._whole_table_count = int(cursor.fetchone()[0])
+            except Exception:  # pylint: disable=broad-except
+                logger.exception(
+                    'Cannot get count estimate for %s from INFORMATION_SCHEMA.TABLES',
+                    query.model,
+                )
+                self._whole_table_count = self.ARBITRARILY_LARGE_NUMBER
+        return self._whole_table_count
 
-        ret = []
 
-        for item in data:
-            try:
-                validated = self.child.run_validation(item)
-            except serializers.ValidationError as exc:
-                ret.append(exc.detail)
-            else:
-                ret.append(validated)
+@admin.register(SystemWideEnterpriseUserRoleAssignment)
+class SystemWideEnterpriseUserRoleAssignmentAdmin(UserRoleAssignmentAdmin):
+    """
+    Django admin model for SystemWideEnterpriseUserRoleAssignment.
+    """
 
-        return ret
+    paginator = BigTableMysqlPaginator
+    show_full_result_count = False
 
-    def create(self, validated_data):
-        """
-        This selectively calls the child create method based on whether or not validation failed for each payload.
-        """
-        ret = []
-        for attrs in validated_data:
-            if 'non_field_errors' not in attrs and not any(isinstance(attrs[field], list) for field in attrs):
-                ret.append(self.child.create(attrs))
-            else:
-                ret.append(attrs)
+    fields = ('user', 'role', 'enterprise_customer', 'applies_to_all_contexts')
 
-        return ret
+    list_display = ('user', 'role', 'enterprise_customer', 'applies_to_all_contexts')
+    # This tells Django to use select_related() in retrieving the list of objects on the change list page.
+    # It should save some queries
+    list_select_related = (
+        'user',
+        'role',
+        'enterprise_customer',
+    )
+    list_per_page = 25
 
-    def to_representation(self, data):
-        """
-        This selectively calls to_representation on each result that was processed by create.
-        """
-        return [
-            self.child.to_representation(item) if 'detail' in item else item for item in data
-        ]
+    search_fields = ('user__email', 'role__name', 'enterprise_customer__name')
+
+    form = SystemWideEnterpriseUserRoleAssignmentForm
+
+    class Meta:
+        model = SystemWideEnterpriseUserRoleAssignment
 
 
-# pylint: disable=abstract-method
-class EnterpriseCustomerCourseEnrollmentsSerializer(serializers.Serializer):
-    """Serializes enrollment information for a collection of students/emails.
-
-    This is mainly useful for implementing validation when performing enrollment operations.
+@admin.register(EnterpriseFeatureUserRoleAssignment)
+class EnterpriseFeatureUserRoleAssignmentAdmin(UserRoleAssignmentAdmin):
     """
+    Django admin model for EnterpriseFeatureUserRoleAssignment.
+    """
+
+    form = EnterpriseFeatureUserRoleAssignmentForm
 
     class Meta:
-        list_serializer_class = EnterpriseCustomerCourseEnrollmentsListSerializer
-
-    lms_user_id = serializers.CharField(required=False, write_only=True)
-    tpa_user_id = serializers.CharField(required=False, write_only=True)
-    user_email = serializers.EmailField(required=False, write_only=True)
-    course_run_id = serializers.CharField(required=True, write_only=True)
-    cohort = serializers.CharField(required=False, write_only=True)
-    course_mode = serializers.ChoiceField(
-        choices=(
-            ('audit', 'audit'),
-            ('verified', 'verified'),
-            ('professional', 'professional')
-        ),
-        required=True,
-        write_only=True,
-    )
-    email_students = serializers.BooleanField(default=False, required=False, write_only=True)
-    detail = serializers.CharField(read_only=True)
-    is_active = serializers.BooleanField(required=False, default=True, write_only=True)
-
-    def create(self, validated_data):
-        """
-        Perform the enrollment for existing enterprise customer users, or create the pending objects for new users.
-        """
-        enterprise_customer = self.context.get('enterprise_customer')
-        lms_user = validated_data.get('lms_user_id')
-        tpa_user = validated_data.get('tpa_user_id')
-        user_email = validated_data.get('user_email')
-        course_run_id = validated_data.get('course_run_id')
-        course_mode = validated_data.get('course_mode')
-        cohort = validated_data.get('cohort')
-        email_students = validated_data.get('email_students')
-        is_active = validated_data.get('is_active')
-        discount = enterprise_customer.default_contract_discount or 0
-        LOGGER.info(
-            "[Enrollment-API] Received a call with the following parameters. lms_user: [{lms_user}], "
-            "tpa_user: [{tpa_user}], user_email: {user_email}, course_run_id: {course_run_id}, "
-            "course_mode: {course_mode}, is_active: {is_active}, discount: {discount}".format(
-                lms_user=lms_user.id if lms_user else None,
-                tpa_user=tpa_user.id if tpa_user else None,
-                user_email=user_email.id if isinstance(user_email, models.EnterpriseCustomerUser) else user_email,
-                course_run_id=course_run_id,
-                course_mode=course_mode,
-                is_active=is_active,
-                discount=discount
-            )
-        )
+        model = EnterpriseFeatureUserRoleAssignment
 
-        enterprise_customer_user = lms_user or tpa_user or user_email
 
-        if isinstance(enterprise_customer_user, models.EnterpriseCustomerUser):
-            validated_data['enterprise_customer_user'] = enterprise_customer_user
-            try:
-                if is_active:
-                    LOGGER.info(
-                        "[Enrollment-API] Enrolling the enterprise learner [{learner_id}] in course [{course_run_id}] "
-                        "in [{course_mode}] mode".format(
-                            learner_id=enterprise_customer_user.id,
-                            course_run_id=course_run_id,
-                            course_mode=course_mode
-                        )
-                    )
-                    enterprise_customer_user.enroll(
-                        course_run_id,
-                        course_mode,
-                        cohort=cohort,
-                        source_slug=models.EnterpriseEnrollmentSource.API,
-                        discount_percentage=discount
-                    )
-                else:
-                    LOGGER.info(
-                        "[Enrollment-API] Un-enrolling the enterprise learner [{learner_id}] in course "
-                        "[{course_run_id}]".format(
-                            learner_id=enterprise_customer_user.id,
-                            course_run_id=course_run_id,
-                        )
-                    )
-                    enterprise_customer_user.unenroll(course_run_id)
-            except (CourseEnrollmentDowngradeError, CourseEnrollmentPermissionError, HttpClientError) as exc:
-                error_message = (
-                    '[Enterprise API] An exception occurred while enrolling the user.'
-                    ' EnterpriseCustomer: {enterprise_customer}, LmsUser: {lms_user}, TpaUser: {tpa_user},'
-                    ' UserEmail: {user_email}, CourseRun: {course_run_id}, CourseMode {course_mode}, Message: {exc}.'
-                ).format(
-                    enterprise_customer=enterprise_customer,
-                    lms_user=lms_user,
-                    tpa_user=tpa_user,
-                    user_email=user_email,
-                    course_run_id=course_run_id,
-                    course_mode=course_mode,
-                    exc=str(exc)
-                )
-                LOGGER.error(error_message)
-                validated_data['detail'] = str(exc)
-                return validated_data
+admin.site.register(UpdateRoleAssignmentsWithCustomersConfig, ConfigurationModelAdmin)
 
-            if is_active:
-                track_enrollment('enterprise-customer-enrollment-api', enterprise_customer_user.user_id, course_run_id)
-        else:
-            if is_active:
-                LOGGER.info(
-                    "[Enrollment-API] Creating the pending enrollment for [{email}] in course [{course_run_id}] "
-                    "in [{course_mode}] mode".format(
-                        email=user_email,
-                        course_run_id=course_run_id,
-                        course_mode=course_mode
-                    )
-                )
-                enterprise_customer_user = enterprise_customer.enroll_user_pending_registration(
-                    user_email,
-                    course_mode,
-                    course_run_id,
-                    cohort=cohort,
-                    enrollment_source=models.EnterpriseEnrollmentSource.get_source(
-                        models.EnterpriseEnrollmentSource.API
-                    ),
-                    discount=discount
-                )
-            else:
-                LOGGER.info(
-                    "[Enrollment-API] Removing the pending enrollment for [{email}] in course [{course_run_id}]".format(
-                        email=user_email,
-                        course_run_id=course_run_id
-                    )
-                )
-                enterprise_customer.clear_pending_registration(user_email, course_run_id)
 
-        if email_students:
-            enterprise_customer.notify_enrolled_learners(
-                self.context.get('request_user'),
-                course_run_id,
-                [enterprise_customer_user]
-            )
+@admin.register(AdminNotificationRead)
+class AdminNotificationReadAdmin(admin.ModelAdmin):
+    """
+    Django admin for AdminNotificationRead model.
+    """
 
-        validated_data['detail'] = 'success'
-        LOGGER.info(
-            "[Enrollment-API] Returning success for a call with the following parameters. lms_user: [{lms_user}], "
-            "tpa_user: [{tpa_user}], user_email: {user_email}, course_run_id: {course_run_id}, "
-            "course_mode: {course_mode}, is_active: {is_active}".format(
-                lms_user=lms_user.id if lms_user else None,
-                tpa_user=tpa_user.id if tpa_user else None,
-                user_email=user_email.id if isinstance(user_email, models.EnterpriseCustomerUser) else user_email,
-                course_run_id=course_run_id,
-                course_mode=course_mode,
-                is_active=is_active
-            )
-        )
+    model = AdminNotificationRead
+    list_display = ('id', 'enterprise_customer_user', 'admin_notification', 'is_read', 'created', 'modified')
 
-        return validated_data
 
-    def validate_lms_user_id(self, value):
-        """
-        Validates the lms_user_id, if is given, to see if there is an existing EnterpriseCustomerUser for it.
-        """
-        enterprise_customer = self.context.get('enterprise_customer')
+@admin.register(AdminNotification)
+class AdminNotificationAdmin(admin.ModelAdmin):
+    """
+    Django admin for AdminNotification model.
+    """
 
-        try:
-            # Ensure the given user is associated with the enterprise.
-            return models.EnterpriseCustomerUser.objects.get(
-                user_id=value,
-                enterprise_customer=enterprise_customer
-            )
-        except models.EnterpriseCustomerUser.DoesNotExist:
-            pass
+    model = AdminNotification
+    form = AdminNotificationForm
+    list_display = ('id', 'title', 'text', 'is_active', 'start_date', 'expiration_date', 'created', 'modified')
+    filter_horizontal = ('admin_notification_filter',)
 
-        return None
 
-    def validate_tpa_user_id(self, value):
-        """
-        Validates the tpa_user_id, if is given, to see if there is an existing EnterpriseCustomerUser for it.
+@admin.register(AdminNotificationFilter)
+class AdminNotificationFilterAdmin(admin.ModelAdmin):
+    """
+    Django admin for AdminNotificationFilter model.
+    """
 
-        It first uses the third party auth api to find the associated username to do the lookup.
-        """
-        enterprise_customer = self.context.get('enterprise_customer')
+    model = AdminNotificationFilter
+    list_display = ('id', 'filter', 'created', 'modified')
 
-        try:
-            tpa_client = ThirdPartyAuthApiClient(self.context['request_user'])
-            username = tpa_client.get_username_from_remote_id(
-                enterprise_customer.identity_provider, value
-            )
-            user = User.objects.get(username=username)
-            return models.EnterpriseCustomerUser.objects.get(
-                user_id=user.id,
-                enterprise_customer=enterprise_customer
-            )
-        except (models.EnterpriseCustomerUser.DoesNotExist, User.DoesNotExist):
-            pass
 
-        return None
+@admin.register(EnterpriseCustomerInviteKey)
+class EnterpriseCustomerInviteKeyAdmin(admin.ModelAdmin):
+    """
+    Django admin model for EnterpriseCustomerInviteKey.
+    """
+
+    fields = (
+        'enterprise_customer',
+        'usage_count',
+        'usage_limit',
+        'expiration_date',
+        'is_active',
+    )
 
-    def validate_user_email(self, value):
-        """
-        Validates the user_email, if given, to see if an existing EnterpriseCustomerUser exists for it.
+    readonly_fields = ('uuid', 'usage_count')
 
-        If it does not, it does not fail validation, unlike for the other field validation methods above.
-        """
-        enterprise_customer = self.context.get('enterprise_customer')
+    list_display = (
+        'uuid',
+        'enterprise_customer_id',
+        'usage_limit',
+        'expiration_date',
+        'is_active',
+    )
 
-        try:
-            user = User.objects.get(email=value)
-            return models.EnterpriseCustomerUser.objects.get(
-                user_id=user.id,
-                enterprise_customer=enterprise_customer
-            )
-        except (models.EnterpriseCustomerUser.DoesNotExist, User.DoesNotExist):
-            pass
+    list_filter = ('is_active',)
 
-        return value
+    search_fields = (
+        'uuid__startswith',
+        'enterprise_customer__name__startswith',
+    )
 
-    def validate_course_run_id(self, value):
-        """
-        Validates that the course run id is part of the Enterprise Customer's catalog.
-        """
-        enterprise_customer = self.context.get('enterprise_customer')
-
-        if not enterprise_customer.catalog_contains_course(value):
-            error_message = ('[Enterprise API] The course run id is not in the catalog for the Enterprise Customer.'
-                             ' EnterpriseCustomer: {enterprise_uuid}, EnterpriseName: {enterprise_name},'
-                             ' CourseRun: {course_run_id}').format(
-                                 course_run_id=value,
-                                 enterprise_uuid=enterprise_customer.uuid,
-                                 enterprise_name=enterprise_customer.name)
-            LOGGER.warning(error_message)
-            raise serializers.ValidationError(
-                'The course run id {course_run_id} is not in the catalog '
-                'for Enterprise Customer {enterprise_customer}'.format(
-                    course_run_id=value,
-                    enterprise_customer=enterprise_customer.name,
-                )
-            )
+    class Meta:
+        model = EnterpriseCustomerInviteKey
 
-        return value
+    def get_readonly_fields(self, request, obj=None):
+        readonly_fields = super().get_readonly_fields(request, obj=obj)
 
-    def validate(self, data):  # pylint: disable=arguments-differ
-        """
-        Validate that at least one of the user identifier fields has been passed in.
-        """
-        lms_user_id = data.get('lms_user_id')
-        tpa_user_id = data.get('tpa_user_id')
-        user_email = data.get('user_email')
-        if not lms_user_id and not tpa_user_id and not user_email:
-            error_message = ('[Enterprise API] ID missing for mapping to an EnterpriseCustomerUser.'
-                             ' LmsUser: {lms_user_id}, TpaUser: {tpa_user_id}, UserEmail: {user_email}').format(
-                                 lms_user_id=lms_user_id,
-                                 tpa_user_id=tpa_user_id,
-                                 user_email=user_email)
-            LOGGER.error(error_message)
-            raise serializers.ValidationError(
-                'At least one of the following fields must be specified and map to an EnterpriseCustomerUser: '
-                'lms_user_id, tpa_user_id, user_email'
-            )
+        if not obj or not obj.is_active:
+            return readonly_fields + ('is_active',)
 
-        return data
+        return readonly_fields
```

### Comparing `edx-enterprise-3.9.9/enterprise/api/v1/views.py` & `edx-enterprise-4.0.0/enterprise/admin/views.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,928 +1,897 @@
-# -*- coding: utf-8 -*-
 """
-Views for enterprise api version 1 endpoint.
+Custom Django Admin views used in enterprise app.
 """
 
-from logging import getLogger
-from smtplib import SMTPException
+import datetime
+import logging
 
-import requests
-from django_filters.rest_framework import DjangoFilterBackend
-from edx_rbac.decorators import permission_required
-from edx_rest_framework_extensions.auth.jwt.authentication import JwtAuthentication
-from rest_framework import filters, generics, permissions, status, viewsets
-from rest_framework.authentication import SessionAuthentication
-from rest_framework.decorators import action, detail_route, list_route
-from rest_framework.exceptions import NotFound, ValidationError
-from rest_framework.permissions import IsAuthenticated
-from rest_framework.renderers import JSONRenderer
 from rest_framework.response import Response
-from rest_framework.status import HTTP_200_OK, HTTP_400_BAD_REQUEST, HTTP_404_NOT_FOUND, HTTP_500_INTERNAL_SERVER_ERROR
 from rest_framework.views import APIView
-from rest_framework_xml.renderers import XMLRenderer
-from six.moves.urllib.parse import quote_plus, unquote  # pylint: disable=import-error,ungrouped-imports
 
-from django.apps import apps
 from django.conf import settings
-from django.core import mail
-from django.http import Http404
-from django.shortcuts import get_object_or_404
-from django.utils.decorators import method_decorator
-from django.utils.translation import ugettext as _
-
-from enterprise import models
-from enterprise.api.filters import (
-    EnterpriseCustomerUserFilterBackend,
-    EnterpriseLinkedUserFilterBackend,
-    UserFilterBackend,
+from django.contrib import admin, auth, messages
+from django.contrib.auth import get_permission_codename
+from django.core.exceptions import ValidationError
+from django.core.management import call_command
+from django.db import transaction
+from django.db.models import Q
+from django.http import HttpResponse, HttpResponseRedirect, JsonResponse
+from django.shortcuts import get_object_or_404, render
+from django.urls import reverse
+from django.utils.translation import gettext as _
+from django.utils.translation import ngettext
+from django.views.generic import View
+
+from enterprise.admin.forms import (
+    ManageLearnersDataSharingConsentForm,
+    ManageLearnersForm,
+    TransmitEnterpriseCoursesForm,
 )
-from enterprise.api.throttles import ServiceUserThrottle
-from enterprise.api.utils import (
-    create_message_body,
-    get_ent_cust_from_report_config_uuid,
-    get_enterprise_customer_from_catalog_id,
-    get_enterprise_customer_from_user_id,
+from enterprise.admin.utils import (
+    UrlNames,
+    email_or_username__to__email,
+    paginated_list,
+    parse_csv,
+    split_usernames_and_emails,
+)
+from enterprise.api_client.discovery import get_course_catalog_api_service_client
+from enterprise.api_client.ecommerce import EcommerceApiClient
+from enterprise.constants import PAGE_SIZE
+from enterprise.errors import LinkUserToEnterpriseError
+from enterprise.models import (
+    EnrollmentNotificationEmailTemplate,
+    EnterpriseCatalogQuery,
+    EnterpriseCustomer,
+    EnterpriseCustomerUser,
+    PendingEnterpriseCustomerUser,
+)
+from enterprise.utils import (
+    ValidationMessages,
+    delete_data_sharing_consent,
+    enroll_users_in_course,
+    get_ecommerce_worker_user,
+    validate_course_exists_for_enterprise,
+    validate_email_to_link,
 )
-from enterprise.api.v1 import serializers
-from enterprise.api.v1.decorators import require_at_least_one_query_parameter
-from enterprise.api.v1.permissions import IsInEnterpriseGroup
-from enterprise.api_client.lms import EnrollmentApiClient
-from enterprise.constants import COURSE_KEY_URL_PATTERN
-from enterprise.errors import CodesAPIRequestError
-from enterprise.utils import NotConnectedToOpenEdX, get_request_value
-from enterprise_learner_portal.utils import CourseRunProgressStatuses, get_course_run_status
 
+# Only create manual enrollments if running in edx-platform
 try:
-    from course_modes.models import CourseMode
-    from lms.djangoapps.certificates.api import get_certificate_for_user
-    from openedx.core.djangoapps.content.course_overviews.api import get_course_overviews
+    from common.djangoapps.student.api import create_manual_enrollment_audit
 except ImportError:
-    get_course_overviews = None
-    get_certificate_for_user = None
-    CourseMode = None
+    create_manual_enrollment_audit = None
+User = auth.get_user_model()
 
+LOG = logging.getLogger(__name__)
 
-LOGGER = getLogger(__name__)
 
-
-class EnterpriseViewSet:
-    """
-    Base class for all Enterprise view sets.
+class TemplatePreviewView(View):
     """
+    Renders a given NotificationTemplate object to HTML for online viewing.
+    """
+    view_type_contexts = {
+        "course": {
+            "enrolled_in": {
+                "name": "OpenEdX Demo Course",
+                "url": "http://example.com/courses/edx-demo-course",
+                "type": "course",
+                "start": datetime.datetime.strptime('2016-01-01', '%Y-%m-%d')
+            },
+            "organization_name": "OpenEdX",
+        },
+        "program": {
+            "enrolled_in": {
+                "name": "OpenEdX Demo Program",
+                "url": "http://example.com/programs/edx-demo-program",
+                "type": "program",
+                "branding": "MicroMasters",
+                "start": datetime.datetime.strptime('2016-01-01', '%Y-%m-%d')
+            },
+            "organization_name": "OpenEdX",
+        },
+    }
+
+    def get(self, request, template_id, view_type):
+        """
+        Render the given template with the stock data.
+        """
+        template = get_object_or_404(EnrollmentNotificationEmailTemplate, pk=template_id)
+        if view_type not in self.view_type_contexts:
+            return HttpResponse(status=404)
+        base_context = self.view_type_contexts[view_type].copy()
+        base_context.update({'user_name': self.get_user_name(request)})
+        return HttpResponse(template.render_html_template(base_context), content_type='text/html')
 
-    permission_classes = (permissions.IsAuthenticated,)
-    authentication_classes = (JwtAuthentication, SessionAuthentication,)
-    throttle_classes = (ServiceUserThrottle,)
-
-    def ensure_data_exists(self, request, data, error_message=None):
+    @staticmethod
+    def get_user_name(request):
         """
-        Ensure that the wrapped API client's response brings us valid data. If not, raise an error and log it.
+        Get a human-readable name for the user.
         """
-        if not data:
-            error_message = (
-                error_message or "Unable to fetch API response from endpoint '{}'.".format(request.get_full_path())
-            )
-            LOGGER.error(error_message)
-            raise NotFound(error_message)
+        return request.user.first_name or request.user.username
 
 
-class EnterpriseWrapperApiViewSet(EnterpriseViewSet, viewsets.ViewSet):
+class CatalogQueryPreviewView(APIView):
     """
-    Base class for attribute and method definitions common to all view sets which wrap external APIs.
+    Renders a search/all response from Discovery for a particular catalog query.
     """
 
+    def get(self, request, catalog_query_id):
+        """
+        Render the response for a particular catalog query.
+        """
+        enterprise_catalog_query = get_object_or_404(EnterpriseCatalogQuery, pk=catalog_query_id)
+        return Response(self.get_response_from_discovery(request, enterprise_catalog_query))
 
-class EnterpriseModelViewSet(EnterpriseViewSet):
-    """
-    Base class for attribute and method definitions common to all view sets.
-    """
-
-    filter_backends = (filters.OrderingFilter, DjangoFilterBackend, UserFilterBackend,)
-    permission_classes = (permissions.IsAuthenticated, permissions.DjangoModelPermissions,)
-    USER_ID_FILTER = 'id'
+    @staticmethod
+    def get_response_from_discovery(request, catalog_query):
+        """
+        POST a query to Discovery's search/all endpoint and return the results.
+        """
+        response = get_course_catalog_api_service_client().get_catalog_results(
+            catalog_query.content_filter,
+            traverse_pagination=True
+        )
+        return response
 
 
-class EnterpriseReadOnlyModelViewSet(EnterpriseModelViewSet, viewsets.ReadOnlyModelViewSet):
+class BaseEnterpriseCustomerView(View):
     """
-    Base class for all read only Enterprise model view sets.
+    Base class for Enterprise Customer views.
     """
+    template = None
 
+    @staticmethod
+    def _get_admin_context(request, customer):
+        """
+        Build common admin context.
+        """
+        opts = customer._meta
+        codename = get_permission_codename('change', opts)
+        has_change_permission = request.user.has_perm('{}.{}'.format(opts.app_label, codename))
+        return {
+            'has_change_permission': has_change_permission,
+            'opts': opts
+        }
 
-class EnterpriseReadWriteModelViewSet(EnterpriseModelViewSet, viewsets.ModelViewSet):
-    """
-    Base class for all read/write Enterprise model view sets.
-    """
-
-    permission_classes = (permissions.IsAuthenticated, permissions.DjangoModelPermissions,)
+    def _get_view_context(self, request, customer_uuid):
+        """
+        Return the default context parameters
+        """
+        return {
+            'enterprise_customer': EnterpriseCustomer.objects.get(uuid=customer_uuid)
+        }
 
+    def _build_context(self, request, customer_uuid):
+        """
+        Build common context parts used by different handlers in this view.
+        """
+        context = self._get_view_context(request, customer_uuid)
+        context.update(admin.site.each_context(request))
+        context.update(self._get_admin_context(request, context['enterprise_customer']))
+        return context
 
-class EnterpriseCustomerViewSet(EnterpriseReadWriteModelViewSet):
-    """
-    API views for the ``enterprise-customer`` API endpoint.
-    """
+    def get_form_view(self, request, customer_uuid, additional_context=None):
+        """
+        render the form with appropriate context.
+        """
+        context = self._build_context(request, customer_uuid)
+        context.update(additional_context)
+        return render(request, self.template, context)
 
-    queryset = models.EnterpriseCustomer.active_customers.all()
-    serializer_class = serializers.EnterpriseCustomerSerializer
-    filter_backends = EnterpriseReadWriteModelViewSet.filter_backends + (EnterpriseLinkedUserFilterBackend,)
 
-    USER_ID_FILTER = 'enterprise_customer_users__user_id'
-    FIELDS = (
-        'uuid', 'slug', 'name', 'active', 'site', 'enable_data_sharing_consent',
-        'enforce_data_sharing_consent',
-    )
-    filterset_fields = FIELDS
-    ordering_fields = FIELDS
+class EnterpriseCustomerManageLearnerDataSharingConsentView(BaseEnterpriseCustomerView):
+    """
+    Manage Learners Data Sharing Consent View.
 
-    def get_serializer_class(self):
-        if self.action == 'basic_list':
-            return serializers.EnterpriseCustomerBasicSerializer
-        return self.serializer_class
+    Allows to request the DSC from a learner for a specific course.
+    """
+    template = 'enterprise/admin/clear_learners_data_sharing_consent.html'
 
-    @list_route()
-    # pylint: disable=invalid-name,unused-argument
-    def basic_list(self, request, *arg, **kwargs):
-        """
-            Enterprise Customer's Basic data list without pagination
+    class ContextParameters:
         """
-        startswith = request.GET.get('startswith')
-        queryset = self.get_queryset().order_by('name')
-        if startswith:
-            queryset = queryset.filter(name__istartswith=startswith)
-        serializer = self.get_serializer(queryset, many=True)
-        return Response(serializer.data)
-
-    @method_decorator(require_at_least_one_query_parameter('course_run_ids', 'program_uuids'))
-    @detail_route()
-    @permission_required('enterprise.can_view_catalog', fn=lambda request, pk, course_run_ids, program_uuids: pk)
-    # pylint: disable=invalid-name,unused-argument
-    def contains_content_items(self, request, pk, course_run_ids, program_uuids):
+        Namespace-style class for custom context parameters.
         """
-        Return whether or not the specified content is available to the EnterpriseCustomer.
+        ENTERPRISE_CUSTOMER = 'enterprise_customer'
+        MANAGE_LEARNERS_DSC_FORM = 'manage_learners_data_sharing_consent_form'
 
-        Multiple course_run_ids and/or program_uuids query parameters can be sent to this view to check
-        for their existence in the EnterpriseCustomerCatalogs associated with this EnterpriseCustomer.
-        At least one course run key or program UUID value must be included in the request.
+    def get(self, request, customer_uuid):
         """
-        enterprise_customer = self.get_object()
+        Handle GET request - render "Request a DSC from Learner" form.
 
-        # Maintain plus characters in course key.
-        course_run_ids = [unquote(quote_plus(course_run_id)) for course_run_id in course_run_ids]
-
-        contains_content_items = False
-        for catalog in enterprise_customer.enterprise_customer_catalogs.all():
-            contains_course_runs = not course_run_ids or catalog.contains_courses(course_run_ids)
-            contains_program_uuids = not program_uuids or catalog.contains_programs(program_uuids)
-            if contains_course_runs and contains_program_uuids:
-                contains_content_items = True
-                break
-
-        return Response({'contains_content_items': contains_content_items})
+        Arguments:
+            request (django.http.request.HttpRequest): Request instance
+            customer_uuid (str): Enterprise Customer UUID
 
-    @detail_route(methods=['post'], permission_classes=[permissions.IsAuthenticated])
-    @permission_required('enterprise.can_enroll_learners', fn=lambda request, pk: pk)
-    # pylint: disable=invalid-name,unused-argument
-    def course_enrollments(self, request, pk):
+        Returns:
+            django.http.response.HttpResponse: HttpResponse
         """
-        Creates a course enrollment for an EnterpriseCustomerUser.
-        """
-        enterprise_customer = self.get_object()
-        serializer = serializers.EnterpriseCustomerCourseEnrollmentsSerializer(
-            data=request.data,
-            many=True,
-            context={
-                'enterprise_customer': enterprise_customer,
-                'request_user': request.user,
+        return self.get_form_view(
+            request,
+            customer_uuid,
+            additional_context={
+                self.ContextParameters.MANAGE_LEARNERS_DSC_FORM: ManageLearnersDataSharingConsentForm()
             }
         )
-        if serializer.is_valid():
-            serializer.save()
-            return Response(serializer.data, status=HTTP_200_OK)
-
-        return Response(serializer.errors, status=HTTP_400_BAD_REQUEST)
 
-    @method_decorator(require_at_least_one_query_parameter('permissions'))
-    @list_route(permission_classes=[permissions.IsAuthenticated, IsInEnterpriseGroup])
-    def with_access_to(self, request, *args, **kwargs):  # pylint: disable=invalid-name,unused-argument
-        """
-        Returns the list of enterprise customers the user has a specified group permission access to.
+    def post(self, request, customer_uuid):
         """
-        self.queryset = self.queryset.order_by('name')
-        enterprise_id = self.request.query_params.get('enterprise_id', None)
-        enterprise_slug = self.request.query_params.get('enterprise_slug', None)
-        enterprise_name = self.request.query_params.get('search', None)
+        Handle POST request - handle form submissions.
 
-        if enterprise_id is not None:
-            self.queryset = self.queryset.filter(uuid=enterprise_id)
-        elif enterprise_slug is not None:
-            self.queryset = self.queryset.filter(slug=enterprise_slug)
-        elif enterprise_name is not None:
-            self.queryset = self.queryset.filter(name__icontains=enterprise_name)
-        return self.list(request, *args, **kwargs)
-
-    @list_route()
-    @permission_required('enterprise.can_access_admin_dashboard')
-    def dashboard_list(self, request, *args, **kwargs):  # pylint: disable=invalid-name,unused-argument
-        """
-        Supports listing dashboard enterprises for frontend-app-admin-portal.
+        Arguments:
+            request (django.http.request.HttpRequest): Request instance
+            customer_uuid (str): Enterprise Customer UUID
         """
-        self.queryset = self.queryset.order_by('name')
-        enterprise_id = self.request.query_params.get('enterprise_id', None)
-        enterprise_slug = self.request.query_params.get('enterprise_slug', None)
-        enterprise_name = self.request.query_params.get('search', None)
+        manage_learners_dsc_form = ManageLearnersDataSharingConsentForm(
+            request.POST,
+            enterprise_customer=EnterpriseCustomer.objects.get(uuid=customer_uuid)
+        )
 
-        if enterprise_id is not None:
-            self.queryset = self.queryset.filter(uuid=enterprise_id)
-        elif enterprise_slug is not None:
-            self.queryset = self.queryset.filter(slug=enterprise_slug)
-        elif enterprise_name is not None:
-            self.queryset = self.queryset.filter(name__icontains=enterprise_name)
-        return self.list(request, *args, **kwargs)
+        # check that form data is well-formed
+        if manage_learners_dsc_form.is_valid():
+            delete_data_sharing_consent(
+                manage_learners_dsc_form.cleaned_data[ManageLearnersDataSharingConsentForm.Fields.COURSE],
+                customer_uuid,
+                manage_learners_dsc_form.cleaned_data[ManageLearnersDataSharingConsentForm.Fields.EMAIL_OR_USERNAME]
+            )
+            messages.success(request, _("Successfully requested the Data Sharing consent from learner."))
+            return HttpResponseRedirect(reverse("admin:" + UrlNames.MANAGE_LEARNERS_DSC, args=(customer_uuid,)))
+
+        return self.get_form_view(
+            request,
+            customer_uuid,
+            additional_context={
+                self.ContextParameters.MANAGE_LEARNERS_DSC_FORM: manage_learners_dsc_form
+            }
+        )
 
 
-class EnterpriseCourseEnrollmentViewSet(EnterpriseReadWriteModelViewSet):
+class EnterpriseCustomerTransmitCoursesView(BaseEnterpriseCustomerView):
     """
-    API views for the ``enterprise-course-enrollment`` API endpoint.
+    Transmit courses view.
+
+    Allows transmitting of courses metadata for provided enterprise.
     """
+    template = 'enterprise/admin/transmit_courses_metadata.html'
 
-    queryset = models.EnterpriseCourseEnrollment.objects.all()
+    class ContextParameters:
+        """
+        Namespace-style class for custom context parameters.
+        """
+        ENTERPRISE_CUSTOMER = 'enterprise_customer'
+        TRANSMIT_COURSES_METADATA_FORM = 'transmit_courses_metadata_form'
 
-    USER_ID_FILTER = 'enterprise_customer_user__user_id'
-    FIELDS = (
-        'enterprise_customer_user', 'course_id'
-    )
-    filterset_fields = FIELDS
-    ordering_fields = FIELDS
+    def get(self, request, customer_uuid):
+        """
+        Handle GET request - render "Transmit courses metadata" form.
 
-    def get_serializer_class(self):
+        Arguments:
+            request (django.http.request.HttpRequest): Request instance
+            customer_uuid (str): Enterprise Customer UUID
+
+        Returns:
+            django.http.response.HttpResponse: HttpResponse
         """
-        Use a special serializer for any requests that aren't read-only.
+        return self.get_form_view(
+            request,
+            customer_uuid,
+            additional_context={
+                self.ContextParameters.TRANSMIT_COURSES_METADATA_FORM: TransmitEnterpriseCoursesForm()
+            }
+        )
+
+    def post(self, request, customer_uuid):
         """
-        if self.request.method in ('GET',):
-            return serializers.EnterpriseCourseEnrollmentReadOnlySerializer
-        return serializers.EnterpriseCourseEnrollmentWriteSerializer
+        Handle POST request - handle form submissions.
 
+        Arguments:
+            request (django.http.request.HttpRequest): Request instance
+            customer_uuid (str): Enterprise Customer UUID
+        """
+        transmit_courses_metadata_form = TransmitEnterpriseCoursesForm(request.POST)
 
-class EnrollmentModificationException(Exception):
-    """
-    An exception that represents an error when modifying the state
-    of an enrollment via the EnrollmentApiClient.
-    """
+        # check that form data is well-formed
+        if transmit_courses_metadata_form.is_valid():
+            channel_worker_username = transmit_courses_metadata_form.cleaned_data['channel_worker_username']
+
+            # call `transmit_content_metadata` management command to trigger
+            # transmission of enterprise courses metadata
+            call_command(
+                'transmit_content_metadata',
+                '--catalog_user', channel_worker_username,
+                enterprise_customer=customer_uuid
+            )
+
+            # Redirect to GET
+            return HttpResponseRedirect('')
+
+        return self.get_form_view(
+            request,
+            customer_uuid,
+            additional_context={
+                self.ContextParameters.TRANSMIT_COURSES_METADATA_FORM: transmit_courses_metadata_form
+            }
+        )
 
 
-class LicensedEnterpriseCourseEnrollmentViewSet(EnterpriseWrapperApiViewSet):
-    """
-    API views for the ``licensed-enterprise-course-enrollment`` API endpoint.
+class EnterpriseCustomerManageLearnersView(BaseEnterpriseCustomerView):
     """
+    Manage Learners view.
 
-    queryset = models.LicensedEnterpriseCourseEnrollment.objects.all()
-    serializer_class = serializers.LicensedEnterpriseCourseEnrollmentReadOnlySerializer
+    Lists learners linked to chosen Enterprise Customer and allows adding and deleting them.
+    """
+    template = "enterprise/admin/manage_learners.html"
 
-    class RevocationStatus:
+    class ContextParameters:
         """
-        Defines statuses related to enrollment states during the revocation process.
+        Namespace-style class for custom context parameters.
         """
-        COURSE_COMPLETED = 'course already completed'
-        MOVED_TO_AUDIT = 'moved to audit'
-        UNENROLLED = 'unenrolled'
-        UNENROLL_FAILED = 'unenroll_user_from_course returned false.'
+        ENTERPRISE_CUSTOMER = "enterprise_customer"
+        LEARNERS = "learners"
+        PENDING_LEARNERS = "pending_learners"
+        MANAGE_LEARNERS_FORM = "manage_learners_form"
+        SEARCH_KEYWORD = "search_keyword"
+        ENROLLMENT_URL = 'ENROLLMENT_API_ROOT_URL'
 
-    @staticmethod
-    def _validate_license_revoke_data(request_data):
-        """
-        Ensures the request data contains the necessary information.
+    def _get_view_context(self, request, customer_uuid):
+        enterprise_customer = EnterpriseCustomer.objects.get(uuid=customer_uuid)
+        search_keyword = self.get_search_keyword(request)
+        linked_learners = self.get_enterprise_customer_user_queryset(request, search_keyword, customer_uuid)
+        pending_linked_learners = self.get_pending_users_queryset(search_keyword, customer_uuid)
 
-        Arguments:
-            request_data (dict): A dictionary of data passed to the request
+        context = {
+            self.ContextParameters.ENTERPRISE_CUSTOMER: enterprise_customer,
+            self.ContextParameters.PENDING_LEARNERS: pending_linked_learners,
+            self.ContextParameters.LEARNERS: linked_learners,
+            self.ContextParameters.SEARCH_KEYWORD: search_keyword or '',
+            self.ContextParameters.ENROLLMENT_URL: settings.LMS_ENROLLMENT_API_PATH,
+        }
+        return context
+
+    def get_search_keyword(self, request):
         """
-        user_id = request_data.get('user_id')
-        enterprise_id = request_data.get('enterprise_id')
+        Retrieve the search querystring from the GET parameters.
+        """
+        return request.GET.get('q', None)
 
-        if not user_id or not enterprise_id:
-            msg = 'user_id and enterprise_id must be provided.'
-            return Response(msg, status=status.HTTP_400_BAD_REQUEST)
+    def get_enterprise_customer_user_queryset(self, request, search_keyword, customer_uuid, page_size=PAGE_SIZE):
+        """
+        Get the list of EnterpriseCustomerUsers we want to render.
 
-        return None
+        Arguments:
+            request (HttpRequest): HTTP Request instance.
+            search_keyword (str): The keyword to search for in users' email addresses and usernames.
+            customer_uuid (str): A unique identifier to filter down to only users linked to a
+            particular EnterpriseCustomer.
+            page_size (int): Number of learners displayed in each paginated set.
+        """
+        page = request.GET.get('page', 1)
+        learners = EnterpriseCustomerUser.objects.filter(enterprise_customer__uuid=customer_uuid)
+        user_ids = learners.values_list('user_id', flat=True)
+        matching_users = User.objects.filter(pk__in=user_ids)
+        if search_keyword is not None:
+            matching_users = matching_users.filter(
+                Q(email__icontains=search_keyword) | Q(username__icontains=search_keyword)
+            )
+        matching_user_ids = matching_users.values_list('pk', flat=True)
+        learners = learners.filter(user_id__in=matching_user_ids)
+        return paginated_list(learners, page, page_size)
 
-    @staticmethod
-    def _has_user_completed_course_run(enterprise_enrollment, course_overview):
+    def get_pending_users_queryset(self, search_keyword, customer_uuid):
         """
-        Returns True if the user who is enrolled in the given course has already
-        completed this course, false otherwise.  The course may be "completed"
-        if the user earned a certificate, or if the course run has ended.
+        Get the list of PendingEnterpriseCustomerUsers we want to render.
 
         Args:
-            enterprise_enrollment (EnterpriseCourseEnrollment): The enrollment object for which we check
-                if the associated user has completed the given course.
-            course_overview (CourseOverview): The course overview of which we are checking completion.  We need this
-                to check certificate status.  It's a model defined in edx-platform.
-        """
-        certificate_info = get_certificate_for_user(
-            enterprise_enrollment.enterprise_customer_user.username,
-            course_overview.get('id'),
-        ) or {}
-        course_run_status = get_course_run_status(
-            course_overview,
-            certificate_info,
-            enterprise_enrollment,
+            search_keyword (str): The keyword to search for in pending users' email addresses.
+            customer_uuid (str): A unique identifier to filter down to only pending users
+            linked to a particular EnterpriseCustomer.
+        """
+        queryset = PendingEnterpriseCustomerUser.objects.filter(
+            enterprise_customer__uuid=customer_uuid
         )
 
-        return course_run_status == CourseRunProgressStatuses.COMPLETED
+        if search_keyword is not None:
+            queryset = queryset.filter(user_email__icontains=search_keyword)
 
-    def _enrollments_by_course_for_licensed_user(self, enterprise_customer_user):
-        """
-        Helper method to return a dictionary mapping course ids to EnterpriseCourseEnrollments
-        for each licensed enrollment associated with the given enterprise user.
+        return queryset
 
-        Args:
-            enterprise_customer_user (EnterpriseCustomerUser): The user for which we are fetching enrollments.
+    @classmethod
+    def _handle_singular(cls, request, enterprise_customer, manage_learners_form):
         """
-        licensed_enrollments = models.LicensedEnterpriseCourseEnrollment.enrollments_for_user(
-            enterprise_customer_user
-        )
-        return {
-            enrollment.enterprise_course_enrollment.course_id: enrollment.enterprise_course_enrollment
-            for enrollment in licensed_enrollments
-        }
+        Link single user by email or username.
 
-    def _revoke_enrollment(self, enrollment_api_client, enterprise_enrollment, course_overview):
+        Arguments:
+            enterprise_customer (EnterpriseCustomer): learners will be linked to this Enterprise Customer instance
+            manage_learners_form (ManageLearnersForm): bound ManageLearners form instance
         """
-        Helper method that switches the given enrollment to audit track, or, if
-        no audit track exists for the given course, deletes the enrollment.
-        Will do nothing if the user has already "completed" the course run.
+        form_field_value = manage_learners_form.cleaned_data[ManageLearnersForm.Fields.EMAIL_OR_USERNAME]
+        email = email_or_username__to__email(form_field_value)
+        try:
+            validate_email_to_link(
+                email,
+                enterprise_customer,
+                form_field_value,
+                ValidationMessages.INVALID_EMAIL_OR_USERNAME,
+                raise_exception=False,
+            )
+            EnterpriseCustomerUser.all_objects.link_user(enterprise_customer, email)
+            return [email]
+        except (ValidationError, LinkUserToEnterpriseError) as exc:
+            manage_learners_form.add_error(ManageLearnersForm.Fields.EMAIL_OR_USERNAME, exc)
+            return None
 
-        Args:
-            enrollment_api_client (EnrollmentApiClient): The client with which we make requests to modify enrollments.
-            enterprise_enrollment (EnterpriseCourseEnrollment): The enterprise enrollment which we attempt to revoke.
-            course_overview (CourseOverview): The course overview object associated with the enrollment. Used
-                to check for course completion.
-        """
-        course_run_id = course_overview.get('id')
-        enterprise_customer_user = enterprise_enrollment.enterprise_customer_user
-        audit_mode = CourseMode.AUDIT
-        enterprise_id = enterprise_customer_user.enterprise_customer.uuid
-
-        log_message_kwargs = {
-            'user': enterprise_customer_user.username,
-            'enterprise': enterprise_id,
-            'course_id': course_run_id,
-            'mode': audit_mode,
-        }
+    def _handle_bulk_upload_errors(self, manage_learners_form, errors):
+        """
+        Handles adding errors to the ``manager_learners_form``.
 
-        if self._has_user_completed_course_run(enterprise_enrollment, course_overview):
-            LOGGER.info(
-                'License revocation: not updating enrollment in {course_id} for User {user} '
-                'in Enterprise {enterprise}, course is already complete.'.format(**log_message_kwargs)
-            )
-            return self.RevocationStatus.COURSE_COMPLETED
+        Arguments:
+            manage_learners_form (ManageLearnersForm): bound ManageLearners form instance
+            errors (list): List of validation errors from parsing the uploaded CSV.
+        """
+        manage_learners_form.add_error(
+            ManageLearnersForm.Fields.GENERAL_ERRORS, ValidationMessages.BULK_LINK_FAILED
+        )
+        for error in errors:
+            manage_learners_form.add_error(ManageLearnersForm.Fields.BULK_UPLOAD, error)
 
-        if CourseMode.mode_for_course(course_run_id, audit_mode):
-            try:
-                enrollment_api_client.update_course_enrollment_mode_for_user(
-                    username=enterprise_customer_user.username,
-                    course_id=course_run_id,
-                    mode=audit_mode,
-                )
-                LOGGER.info(
-                    'License revocation: updated LMS enrollment for User {user} and Enterprise {enterprise} '
-                    'in Course {course_id} to Course Mode {mode}.'.format(**log_message_kwargs)
-                )
-                return self.RevocationStatus.MOVED_TO_AUDIT
-            except Exception as exc:  # pylint: disable=broad-except
-                msg = (
-                    'License revocation: unable to update LMS enrollment for User {user} and Enterprise {enterprise} '
-                    'in Course {course_id} to Course Mode {mode} because: {reason}'.format(
-                        reason=str(exc),
-                        **log_message_kwargs
-                    )
-                )
-                LOGGER.error('{msg}: {exc}'.format(msg=msg, exc=exc))
-                raise EnrollmentModificationException(msg)
-            finally:
-                enterprise_enrollment.license.revoke()
-        else:
-            try:
-                successfully_unenrolled = enrollment_api_client.unenroll_user_from_course(
-                    username=enterprise_customer_user.username,
-                    course_id=course_run_id,
-                )
-                if not successfully_unenrolled:
-                    raise Exception(self.RevocationStatus.UNENROLL_FAILED)
+    def _process_bulk_upload_data(
+            self,
+            request,
+            enterprise_customer,
+            emails,
+            already_linked_emails,
+            duplicate_emails,
+    ):
+        """
+        Processes the parsed data from bulk csv upload, adding the appropriate success and warning messages.
 
-                LOGGER.info(
-                    'License revocation: successfully unenrolled User {user}, in Enterprise {enterprise} '
-                    'from Course {course_id} that contains no audit mode.'.format(**log_message_kwargs)
+        Arguments:
+            request: A request instance
+            enterprise_customer (EnterpriseCustomer): An instance of an EnterpriseCustomer record.
+            emails (list): List of valid, non-duplicate emails.
+            already_linked_emails (list): List of emails that are already linked with the EnterpriseCustomer.
+            duplicate_emails (list): List of emails that are duplicate entries.
+
+        Returns: List of processable email addresses.
+        """
+        count = len(emails)
+        messages.success(request, ngettext(
+            "{count} new learner was added to {enterprise_customer_name}.",
+            "{count} new learners were added to {enterprise_customer_name}.",
+            count
+        ).format(count=count, enterprise_customer_name=enterprise_customer.name))
+        this_customer_linked_emails = [
+            email for email, customer in already_linked_emails if customer == enterprise_customer
+        ]
+        other_customer_linked_emails = [
+            email for email, __ in already_linked_emails if email not in this_customer_linked_emails
+        ]
+        if this_customer_linked_emails:
+            messages.warning(
+                request,
+                _(
+                    "The following learners were already associated with this Enterprise "
+                    "Customer: {list_of_emails}"
+                ).format(
+                    list_of_emails=", ".join(this_customer_linked_emails)
                 )
-                return self.RevocationStatus.UNENROLLED
-            except Exception as exc:  # pylint: disable=broad-except
-                msg = (
-                    'License revocation: unable to unenroll User {user} in Enterprise {enterprise} '
-                    'from Course {course_id}  because: {reason}'.format(
-                        reason=str(exc),
-                        **log_message_kwargs
-                    )
+            )
+        if other_customer_linked_emails:
+            messages.warning(
+                request,
+                _(
+                    "The following learners are already associated with "
+                    "another Enterprise Customer. These learners were not "
+                    "added to {enterprise_customer_name}: {list_of_emails}"
+                ).format(
+                    enterprise_customer_name=enterprise_customer.name,
+                    list_of_emails=", ".join(other_customer_linked_emails),
                 )
-                LOGGER.error('{msg}: {exc}'.format(msg=msg, exc=exc))
-                raise EnrollmentModificationException(msg)
-            finally:
-                enterprise_enrollment.license.revoke()
-
-    @action(methods=['post'], detail=False)
-    @permission_required('enterprise.can_access_admin_dashboard', fn=lambda request: request.data.get('enterprise_id'))
-    def license_revoke(self, request, *args, **kwargs):
-        """
-        Changes the mode for a user's licensed enterprise course enrollments to the "audit" course mode,
-        or unenroll the user if no audit mode exists for a given course.
-
-        Will return a response with status 200 if no errors were encountered while modifying the course enrollment,
-        or a 422 if any errors were encountered.  The content of the response is of the form:
-
-        {
-            'course-v1:puppies': {'success': true, 'message': 'unenrolled'},
-            'course-v1:birds': {'success': true, 'message': 'moved to audit'},
-            'course-v1:kittens': {'success': true, 'message': 'course already completed'},
-            'course-v1:snakes': {'success': false, 'message': 'unenroll_user_from_course returned false'},
-            'course-v1:lizards': {'success': false, 'message': 'Some other exception'},
-        }
-
-        The first four messages are the values of constants that a client may expect to receive and parse accordingly.
-        """
-        if not all([get_course_overviews, get_certificate_for_user, CourseMode]):
-            raise NotConnectedToOpenEdX(
-                _('To use this endpoint, this package must be '
-                  'installed in an Open edX environment.')
             )
-
-        request_data = request.data.copy()
-        invalid_response = self._validate_license_revoke_data(request_data)
-        if invalid_response:
-            return invalid_response
-
-        user_id = request_data.get('user_id')
-        enterprise_id = request_data.get('enterprise_id')
-
-        enterprise_customer_user = get_object_or_404(
-            models.EnterpriseCustomerUser,
-            user_id=user_id,
-            enterprise_customer=enterprise_id,
-        )
-        enrollments_by_course_id = self._enrollments_by_course_for_licensed_user(enterprise_customer_user)
-
-        enrollment_api_client = EnrollmentApiClient()
-
-        revocation_results = {}
-        any_failures = False
-        for course_overview in get_course_overviews(list(enrollments_by_course_id.keys())):
-            course_id = str(course_overview.get('id'))
-            enterprise_enrollment = enrollments_by_course_id.get(course_id)
-            try:
-                revocation_status = self._revoke_enrollment(
-                    enrollment_api_client, enterprise_enrollment, course_overview
+        if duplicate_emails:
+            messages.warning(
+                request,
+                _(
+                    "The following duplicate email addresses were not added: "
+                    "{list_of_emails}"
+                ).format(
+                    list_of_emails=", ".join(duplicate_emails)
                 )
-                revocation_results[course_id] = {'success': True, 'message': revocation_status}
-            except EnrollmentModificationException as exc:
-                revocation_results[course_id] = {'success': False, 'message': str(exc)}
-                any_failures = True
-
-        status_code = status.HTTP_200_OK if not any_failures else status.HTTP_422_UNPROCESSABLE_ENTITY
-        return Response(revocation_results, status=status_code)
-
-
-class EnterpriseCustomerUserViewSet(EnterpriseReadWriteModelViewSet):
-    """
-    API views for the ``enterprise-learner`` API endpoint.
-    """
-
-    queryset = models.EnterpriseCustomerUser.objects.all()
-    filter_backends = (filters.OrderingFilter, DjangoFilterBackend, EnterpriseCustomerUserFilterBackend)
-
-    FIELDS = (
-        'enterprise_customer', 'user_id', 'active',
-    )
-    filterset_fields = FIELDS
-    ordering_fields = FIELDS
+            )
+        # Build a list of all the emails that we can act on further; that is,
+        # emails that we either linked to this customer, or that were linked already.
+        all_processable_emails = list(emails) + this_customer_linked_emails
+        return all_processable_emails
 
-    def get_serializer_class(self):
-        """
-        Use a flat serializer for any requests that aren't read-only.
+    @classmethod
+    def _handle_bulk_upload(cls, enterprise_customer, manage_learners_form, request, email_list=None):
         """
-        if self.request.method in ('GET',):
-            return serializers.EnterpriseCustomerUserReadOnlySerializer
-        return serializers.EnterpriseCustomerUserWriteSerializer
-
-
-class PendingEnterpriseCustomerUserViewSet(EnterpriseReadWriteModelViewSet):
-    """
-    API views for the ``pending-enterprise-learner`` API endpoint.
-    """
+        Bulk link users by email.
 
-    queryset = models.PendingEnterpriseCustomerUser.objects.all()
-    filter_backends = (filters.OrderingFilter, DjangoFilterBackend)
-    serializer_class = serializers.PendingEnterpriseCustomerUserSerializer
-    permission_classes = (permissions.IsAuthenticated, permissions.IsAdminUser)
-
-    FIELDS = (
-        'enterprise_customer', 'user_email',
-    )
-    filterset_fields = FIELDS
-    ordering_fields = FIELDS
-
-    def create(self, request, *args, **kwargs):
-        serializer = self.get_serializer(data=request.data)
-        try:
-            serializer.is_valid(raise_exception=True)
-        except ValidationError as validation_error:
-            return_status = None
-            if 'user_email' in serializer.errors:
-                for error in serializer.errors['user_email']:
-                    # This error indicates that a PendingEnterpriseCustomerUser already exists.
-                    if error.code == 'unique':
-                        return_status = status.HTTP_204_NO_CONTENT
-                        break
-            elif 'non_field_errors' in serializer.errors:
-                for error in serializer.errors['non_field_errors']:
-                    # This error indicates that an EnterpriseCustomerUser already exists.
-                    if str(error) == 'EnterpriseCustomerUser record already exists':
-                        return_status = status.HTTP_204_NO_CONTENT
-                        break
-
-            if not return_status:
-                raise validation_error
+        Arguments:
+            enterprise_customer (EnterpriseCustomer): learners will be linked to this Enterprise Customer instance
+            manage_learners_form (ManageLearnersForm): bound ManageLearners form instance
+            request (django.http.request.HttpRequest): HTTP Request instance
+            email_list (iterable): A list of pre-processed email addresses to handle using the form
+        """
+        errors = []
+        emails = set()
+        course_id_with_emails = {}
+        already_linked_emails = []
+        duplicate_emails = []
+        csv_file = manage_learners_form.cleaned_data[ManageLearnersForm.Fields.BULK_UPLOAD]
+        if email_list:
+            parsed_csv = [{ManageLearnersForm.CsvColumns.EMAIL: email} for email in email_list]
         else:
-            created = serializer.save()
-            return_status = status.HTTP_201_CREATED if created else status.HTTP_204_NO_CONTENT
-        headers = self.get_success_headers(serializer.data)
-        return Response(serializer.data, status=return_status, headers=headers)
-
-
-class EnterpriseCustomerBrandingConfigurationViewSet(EnterpriseReadOnlyModelViewSet):
-    """
-    API views for the ``enterprise-customer-branding`` API endpoint.
-    """
-
-    queryset = models.EnterpriseCustomerBrandingConfiguration.objects.all()
-    serializer_class = serializers.EnterpriseCustomerBrandingConfigurationSerializer
-
-    USER_ID_FILTER = 'enterprise_customer__enterprise_customer_users__user_id'
-    FIELDS = (
-        'enterprise_customer__slug',
-    )
-    filterset_fields = FIELDS
-    ordering_fields = FIELDS
-    lookup_field = 'enterprise_customer__slug'
+            parsed_csv = parse_csv(csv_file, expected_columns={ManageLearnersForm.CsvColumns.EMAIL})
 
+        try:
+            for index, row in enumerate(parsed_csv):
+                email = row[ManageLearnersForm.CsvColumns.EMAIL]
+                course_id = row.get(ManageLearnersForm.CsvColumns.COURSE_ID, None)  # optional column
+                course_details = None
+                try:
+                    already_linked = validate_email_to_link(email, enterprise_customer, raise_exception=False)
+                    if course_id:
+                        course_details = validate_course_exists_for_enterprise(enterprise_customer, course_id)
+                except ValidationError as exc:
+                    message = _("Error at line {line}: {message}\n").format(line=index + 1, message=exc)
+                    errors.append(message)
+                else:
+                    if already_linked:
+                        already_linked_emails.append((email, already_linked.enterprise_customer))
+                    elif email in emails:
+                        duplicate_emails.append(email)
+                    else:
+                        emails.add(email)
+
+                    # course column exists for row, is a valid course id, and exists in the enterprise's catalog(s).
+                    if course_details:
+                        if course_details['course_id'] not in course_id_with_emails:
+                            course_id_with_emails[course_details['course_id']] = {email}
+                        else:
+                            course_id_with_emails[course_details['course_id']].add(email)
+        except ValidationError as exc:
+            errors.append(exc)
 
-class EnterpriseCustomerCatalogViewSet(EnterpriseReadOnlyModelViewSet):
-    """
-    API Views for performing search through course discovery at the ``enterprise_catalogs`` API endpoint.
-    """
-    queryset = models.EnterpriseCustomerCatalog.objects.all()
+        # do the actual linking if there are no errors at this point:
+        if not errors:
+            try:
+                with transaction.atomic():
+                    for email in emails:
+                        EnterpriseCustomerUser.all_objects.link_user(enterprise_customer, email)
+            except LinkUserToEnterpriseError as exc:
+                errors.append(exc)
+
+        if errors:
+            cls._handle_bulk_upload_errors(cls, manage_learners_form=manage_learners_form, errors=errors)
+            # There were validation errors, so prevent any further action.
+            return [], {}
+
+        # Process the bulk uploaded data:
+        processable_emails = cls._process_bulk_upload_data(
+            cls,
+            request=request,
+            enterprise_customer=enterprise_customer,
+            emails=emails,
+            already_linked_emails=already_linked_emails,
+            duplicate_emails=duplicate_emails,
+        )
+        return processable_emails, course_id_with_emails
 
-    USER_ID_FILTER = 'enterprise_customer__enterprise_customer_users__user_id'
-    FIELDS = (
-        'uuid', 'enterprise_customer',
-    )
-    filterset_fields = FIELDS
-    ordering_fields = FIELDS
-    renderer_classes = (JSONRenderer, XMLRenderer,)
+    @classmethod
+    def send_messages(cls, http_request, message_requests):
+        """
+        Deduplicate any outgoing message requests, and send the remainder.
 
-    @permission_required('enterprise.can_view_catalog', fn=lambda request, *args, **kwargs: None)
-    def list(self, request, *args, **kwargs):
-        return super(EnterpriseCustomerCatalogViewSet, self).list(request, *args, **kwargs)  # pylint: disable=no-member
+        Args:
+            http_request: The HTTP request in whose response we want to embed the messages
+            message_requests: A list of undeduplicated messages in the form of tuples of message type
+                and text- for example, ('error', 'Something went wrong')
+        """
+        deduplicated_messages = set(message_requests)
+        for msg_type, text in deduplicated_messages:
+            message_function = getattr(messages, msg_type)
+            message_function(http_request, text)
 
-    @permission_required(
-        'enterprise.can_view_catalog',
-        fn=lambda request, *args, **kwargs: get_enterprise_customer_from_catalog_id(kwargs['pk']))
-    def retrieve(self, request, *args, **kwargs):
-        return super(EnterpriseCustomerCatalogViewSet, self).retrieve(request, *args, **kwargs)
+    @classmethod
+    def get_success_enrollment_message(cls, users, enrolled_in):
+        """
+        Create message for the users who were enrolled in a course.
 
-    def get_serializer_class(self):
-        view_action = getattr(self, 'action', None)
-        if view_action == 'retrieve':
-            return serializers.EnterpriseCustomerCatalogDetailSerializer
-        return serializers.EnterpriseCustomerCatalogSerializer
+        Args:
+            users: An iterable of users who were successfully enrolled
+            enrolled_in (str): A string identifier for the course the users were enrolled in
 
-    @method_decorator(require_at_least_one_query_parameter('course_run_ids', 'program_uuids'))
-    @detail_route()
-    # pylint: disable=invalid-name,unused-argument
-    def contains_content_items(self, request, pk, course_run_ids, program_uuids):
+        Returns:
+            tuple: A 2-tuple containing a message type and message text
         """
-        Return whether or not the EnterpriseCustomerCatalog contains the specified content.
+        enrolled_count = len(users)
+        return (
+            'success',
+            ngettext(
+                '{enrolled_count} learner was enrolled in {enrolled_in}.',
+                '{enrolled_count} learners were enrolled in {enrolled_in}.',
+                enrolled_count,
+            ).format(
+                enrolled_count=enrolled_count,
+                enrolled_in=enrolled_in,
+            )
+        )
 
-        Multiple course_run_ids and/or program_uuids query parameters can be sent to this view to check
-        for their existence in the EnterpriseCustomerCatalog. At least one course run key
-        or program UUID value must be included in the request.
+    @classmethod
+    def get_failed_enrollment_message(cls, users, enrolled_in):
         """
-        enterprise_customer_catalog = self.get_object()
+        Create message for the users who were not able to be enrolled in a course.
 
-        # Maintain plus characters in course key.
-        course_run_ids = [unquote(quote_plus(course_run_id)) for course_run_id in course_run_ids]
+        Args:
+            users: An iterable of users who were not successfully enrolled
+            enrolled_in (str): A string identifier for the course with which enrollment was attempted
 
-        contains_content_items = True
-        if course_run_ids:
-            contains_content_items = enterprise_customer_catalog.contains_courses(course_run_ids)
-        if program_uuids:
-            contains_content_items = (
-                contains_content_items and
-                enterprise_customer_catalog.contains_programs(program_uuids)
+        Returns:
+        tuple: A 2-tuple containing a message type and message text
+        """
+        failed_emails = [user.email for user in users]
+        return (
+            'error',
+            _(
+                'The following learners could not be enrolled in {enrolled_in}: {user_list}'
+            ).format(
+                enrolled_in=enrolled_in,
+                user_list=', '.join(failed_emails),
             )
+        )
 
-        return Response({'contains_content_items': contains_content_items})
-
-    @detail_route(url_path='courses/{}'.format(COURSE_KEY_URL_PATTERN))
-    @permission_required(
-        'enterprise.can_view_catalog',
-        fn=lambda request, pk, course_key: get_enterprise_customer_from_catalog_id(pk))
-    def course_detail(self, request, pk, course_key):  # pylint: disable=invalid-name,unused-argument
+    @classmethod
+    def get_pending_enrollment_message(cls, pending_users, enrolled_in):
         """
-        Return the metadata for the specified course.
+        Create message for the users who were enrolled in a course.
 
-        The course needs to be included in the specified EnterpriseCustomerCatalog
-        in order for metadata to be returned from this endpoint.
+        Args:
+            users: An iterable of PendingEnterpriseCustomerUsers who were successfully linked with a pending enrollment
+            enrolled_in (str): A string identifier for the course the pending users were linked to
+
+        Returns:
+            tuple: A 2-tuple containing a message type and message text
         """
-        enterprise_customer_catalog = self.get_object()
-        course = enterprise_customer_catalog.get_course(course_key)
-        if not course:
-            error_message = _(
-                '[Enterprise API] CourseKey not found in the Catalog. Course: {course_key}, Catalog: {catalog_id}'
+        pending_emails = [pending_user.user_email for pending_user in pending_users]
+        return (
+            'warning',
+            _(
+                "The following learners do not have an account on "
+                "{platform_name}. They have not been enrolled in "
+                "{enrolled_in}. When these learners create an account, they will "
+                "be enrolled automatically: {pending_email_list}"
             ).format(
-                course_key=course_key,
-                catalog_id=enterprise_customer_catalog.uuid,
+                platform_name=settings.PLATFORM_NAME,
+                enrolled_in=enrolled_in,
+                pending_email_list=', '.join(pending_emails),
             )
-            LOGGER.warning(error_message)
-            raise Http404
+        )
 
-        context = self.get_serializer_context()
-        context['enterprise_customer_catalog'] = enterprise_customer_catalog
-        serializer = serializers.CourseDetailSerializer(course, context=context)
-        return Response(serializer.data)
-
-    @detail_route(url_path='course_runs/{}'.format(settings.COURSE_ID_PATTERN))
-    @permission_required(
-        'enterprise.can_view_catalog',
-        fn=lambda request, pk, course_id: get_enterprise_customer_from_catalog_id(pk))
-    def course_run_detail(self, request, pk, course_id):  # pylint: disable=invalid-name,unused-argument
-        """
-        Return the metadata for the specified course run.
-
-        The course run needs to be included in the specified EnterpriseCustomerCatalog
-        in order for metadata to be returned from this endpoint.
-        """
-        enterprise_customer_catalog = self.get_object()
-        course_run = enterprise_customer_catalog.get_course_run(course_id)
-        if not course_run:
-            error_message = _(
-                '[Enterprise API] CourseRun not found in the Catalog. CourseRun: {course_id}, Catalog: {catalog_id}'
-            ).format(
+    @classmethod
+    def _enroll_users(
+            cls,
+            request,
+            enterprise_customer,
+            emails,
+            mode,
+            course_id=None,
+            notify=True,
+            enrollment_reason=None,
+            sales_force_id=None,
+            discount=0.0
+    ):
+        """
+        Enroll the users with the given email addresses to the course.
+
+        Args:
+            cls (type): The EnterpriseCustomerManageLearnersView class itself
+            request: The HTTP request the enrollment is being created by
+            enterprise_customer: The instance of EnterpriseCustomer whose attached users we're enrolling
+            emails: An iterable of strings containing email addresses to enroll in a course
+            mode: The enrollment mode the users will be enrolled in the course with
+            course_id: The ID of the course in which we want to enroll
+            notify: Whether to notify (by email) the users that have been enrolled
+        """
+        pending_messages = []
+        paid_modes = ['verified', 'professional']
+
+        succeeded, pending, failed = enroll_users_in_course(
+            enterprise_customer=enterprise_customer,
+            course_id=course_id,
+            course_mode=mode,
+            emails=sorted(emails),
+            enrollment_requester=request.user,
+            enrollment_reason=enrollment_reason,
+            discount=discount,
+            sales_force_id=sales_force_id,
+        )
+        all_successes = succeeded + pending
+        if notify:
+            enterprise_customer.notify_enrolled_learners(
+                catalog_api_user=request.user,
                 course_id=course_id,
-                catalog_id=enterprise_customer_catalog.uuid,
+                users=all_successes,
             )
-            LOGGER.warning(error_message)
-            raise Http404
+        if succeeded:
+            pending_messages.append(cls.get_success_enrollment_message(succeeded, course_id))
+        if failed:
+            pending_messages.append(cls.get_failed_enrollment_message(failed, course_id))
+        if pending:
+            pending_messages.append(cls.get_pending_enrollment_message(pending, course_id))
+
+        if mode in paid_modes:
+            # Create an order to track the manual enrollments of non-pending accounts
+            enrollments = [{
+                "lms_user_id": success.id,
+                "email": success.email,
+                "username": success.username,
+                "course_run_key": course_id,
+                "discount_percentage": float(discount),
+                "enterprise_customer_name": enterprise_customer.name,
+                "enterprise_customer_uuid": str(enterprise_customer.uuid),
+                "mode": mode,
+                "sales_force_id": sales_force_id,
+            } for success in succeeded]
+            EcommerceApiClient(get_ecommerce_worker_user()).create_manual_enrollment_orders(enrollments)
+        cls.send_messages(request, pending_messages)
 
-        context = self.get_serializer_context()
-        context['enterprise_customer_catalog'] = enterprise_customer_catalog
-        serializer = serializers.CourseRunDetailSerializer(course_run, context=context)
-        return Response(serializer.data)
-
-    @detail_route(url_path='programs/(?P<program_uuid>[^/]+)')
-    @permission_required(
-        'enterprise.can_view_catalog',
-        fn=lambda request, pk, program_uuid: get_enterprise_customer_from_catalog_id(pk))
-    def program_detail(self, request, pk, program_uuid):  # pylint: disable=invalid-name,unused-argument
-        """
-        Return the metadata for the specified program.
-
-        The program needs to be included in the specified EnterpriseCustomerCatalog
-        in order for metadata to be returned from this endpoint.
-        """
-        enterprise_customer_catalog = self.get_object()
-        program = enterprise_customer_catalog.get_program(program_uuid)
-        if not program:
-            error_message = _(
-                '[Enterprise API] Program not found in the Catalog. Program: {program_uuid}, Catalog: {catalog_id}'
-            ).format(
-                program_uuid=program_uuid,
-                catalog_id=enterprise_customer_catalog.uuid,
-            )
-            LOGGER.warning(error_message)
-            raise Http404
+    def get(self, request, customer_uuid):
+        """
+        Handle GET request - render linked learners list and "Link learner" form.
 
-        context = self.get_serializer_context()
-        context['enterprise_customer_catalog'] = enterprise_customer_catalog
-        serializer = serializers.ProgramDetailSerializer(program, context=context)
-        return Response(serializer.data)
-
-
-class EnterpriseCustomerReportingConfigurationViewSet(EnterpriseReadWriteModelViewSet):
-    """
-    API views for the ``enterprise-customer-reporting`` API endpoint.
-    """
-
-    queryset = models.EnterpriseCustomerReportingConfiguration.objects.all()
-    serializer_class = serializers.EnterpriseCustomerReportingConfigurationSerializer
-    lookup_field = 'uuid'
-    permission_classes = [permissions.IsAuthenticated]
-
-    USER_ID_FILTER = 'enterprise_customer__enterprise_customer_users__user_id'
-    FIELDS = (
-        'enterprise_customer',
-    )
-    filterset_fields = FIELDS
-    ordering_fields = FIELDS
-
-    @permission_required(
-        'enterprise.can_manage_reporting_config',
-        fn=lambda request, *args, **kwargs: get_ent_cust_from_report_config_uuid(kwargs['uuid']))
-    def retrieve(self, request, *args, **kwargs):
-        # pylint: disable=no-member
-        return super(EnterpriseCustomerReportingConfigurationViewSet, self).retrieve(request, *args, **kwargs)
-
-    @permission_required(
-        'enterprise.can_manage_reporting_config',
-        fn=lambda request, *args, **kwargs: get_enterprise_customer_from_user_id(request.user.id))
-    def list(self, request, *args, **kwargs):
-        # pylint: disable=no-member
-        return super(EnterpriseCustomerReportingConfigurationViewSet, self).list(request, *args, **kwargs)
-
-    @permission_required(
-        'enterprise.can_manage_reporting_config',
-        fn=lambda request, *args, **kwargs: get_enterprise_customer_from_user_id(request.user.id))
-    def create(self, request, *args, **kwargs):
-        config_data = request.data.copy()
-        config_data['enterprise_customer_id'] = get_enterprise_customer_from_user_id(request.user.id)
-        serializer = self.get_serializer(data=config_data)
-        serializer.is_valid(raise_exception=True)
-        serializer.save()
-
-        return Response(serializer.data, status=status.HTTP_201_CREATED)
-
-    @permission_required(
-        'enterprise.can_manage_reporting_config',
-        fn=lambda request, *args, **kwargs: get_ent_cust_from_report_config_uuid(kwargs['uuid']))
-    def update(self, request, *args, **kwargs):
-        # pylint: disable=no-member
-        return super(EnterpriseCustomerReportingConfigurationViewSet, self).update(request, *args, **kwargs)
-
-    @permission_required(
-        'enterprise.can_manage_reporting_config',
-        fn=lambda request, *args, **kwargs: get_ent_cust_from_report_config_uuid(kwargs['uuid']))
-    def partial_update(self, request, *args, **kwargs):
-        # pylint: disable=no-member
-        return super(EnterpriseCustomerReportingConfigurationViewSet, self).partial_update(request, *args, **kwargs)
-
-    @permission_required(
-        'enterprise.can_manage_reporting_config',
-        fn=lambda request, *args, **kwargs: get_ent_cust_from_report_config_uuid(kwargs['uuid']))
-    def destroy(self, request, *args, **kwargs):
-        # pylint: disable=no-member
-        return super(EnterpriseCustomerReportingConfigurationViewSet, self).destroy(request, *args, **kwargs)
-
-
-class CatalogQueryView(APIView):
-    """
-    View for enterprise catalog query.
-    This will be called from django admin tool to populate `content_filter` field of `EnterpriseCustomerCatalog` model.
-    """
-    authentication_classes = [SessionAuthentication]
-    permission_classes = [permissions.IsAuthenticated, permissions.IsAdminUser]
-    http_method_names = ['get']
+        Arguments:
+            request (django.http.request.HttpRequest): Request instance
+            customer_uuid (str): Enterprise Customer UUID
 
-    def get(self, request, catalog_query_id):
+        Returns:
+            django.http.response.HttpResponse: HttpResponse
         """
-        API endpoint for fetching an enterprise catalog query.
-        """
-        try:
-            catalog_query = models.EnterpriseCatalogQuery.objects.get(pk=catalog_query_id)
-        except models.EnterpriseCatalogQuery.DoesNotExist:
-            return Response({"detail": "Could not find enterprise catalog query."}, status=HTTP_404_NOT_FOUND)
-        return Response(catalog_query.content_filter, status=HTTP_200_OK)
-
+        enterprise_customer = EnterpriseCustomer.objects.get(uuid=customer_uuid)
+        manage_learners_form = ManageLearnersForm(user=request.user, enterprise_customer=enterprise_customer)
 
-class CouponCodesView(APIView):
-    """
-    API to request coupon codes.
-    """
-    permission_classes = (permissions.IsAuthenticated,)
-    authentication_classes = (JwtAuthentication, SessionAuthentication,)
-    throttle_classes = (ServiceUserThrottle,)
+        return self.get_form_view(
+            request,
+            customer_uuid,
+            additional_context={
+                self.ContextParameters.MANAGE_LEARNERS_FORM: manage_learners_form
+            }
+        )
 
-    REQUIRED_PARAM_EMAIL = 'email'
-    REQUIRED_PARAM_ENTERPRISE_NAME = 'enterprise_name'
-    OPTIONAL_PARAM_NUMBER_OF_CODES = 'number_of_codes'
-    OPTIONAL_PARAM_NOTES = 'notes'
+    def post(self, request, customer_uuid):
+        """
+        Handle POST request - handle form submissions.
 
-    MISSING_REQUIRED_PARAMS_MSG = "Some required parameter(s) missing: {}"
+        Arguments:
+            request (django.http.request.HttpRequest): Request instance
+            customer_uuid (str): Enterprise Customer UUID
 
-    def get_required_query_params(self, request):
+        Returns:
+            django.http.response.HttpResponse: HttpResponse
         """
-        Gets ``email``, ``enterprise_name``, ``number_of_codes``, and ``notes``,
-        which are the relevant parameters for this API endpoint.
+        enterprise_customer = EnterpriseCustomer.objects.get(uuid=customer_uuid)
+        manage_learners_form = ManageLearnersForm(
+            request.POST,
+            request.FILES,
+            user=request.user,
+            enterprise_customer=enterprise_customer
+        )
+        course_id_with_emails = {}
 
-        :param request: The request to this endpoint.
-        :return: The ``email``, ``enterprise_name``, ``number_of_codes`` and ``notes`` from the request.
-        """
-        email = get_request_value(request, self.REQUIRED_PARAM_EMAIL, '')
-        enterprise_name = get_request_value(request, self.REQUIRED_PARAM_ENTERPRISE_NAME, '')
-        number_of_codes = get_request_value(request, self.OPTIONAL_PARAM_NUMBER_OF_CODES, '')
-        notes = get_request_value(request, self.OPTIONAL_PARAM_NOTES, '')
-        if not (email and enterprise_name):
-            raise CodesAPIRequestError(
-                self.get_missing_params_message([
-                    (self.REQUIRED_PARAM_EMAIL, bool(email)),
-                    (self.REQUIRED_PARAM_ENTERPRISE_NAME, bool(enterprise_name)),
-                ])
-            )
-        return email, enterprise_name, number_of_codes, notes
+        # initial form validation - check that form data is well-formed
+        if manage_learners_form.is_valid():
+            email_field_as_bulk_input = split_usernames_and_emails(
+                manage_learners_form.cleaned_data[ManageLearnersForm.Fields.EMAIL_OR_USERNAME]
+            )
+            is_bulk_entry = len(email_field_as_bulk_input) > 1
+            # The form is valid. Call the appropriate helper depending on the mode:
+            mode = manage_learners_form.cleaned_data[ManageLearnersForm.Fields.MODE]
+            if mode == ManageLearnersForm.Modes.MODE_SINGULAR and not is_bulk_entry:
+                linked_learners = self._handle_singular(request, enterprise_customer, manage_learners_form)
+            elif mode == ManageLearnersForm.Modes.MODE_SINGULAR:
+                linked_learners, __ = self._handle_bulk_upload(
+                    enterprise_customer,
+                    manage_learners_form,
+                    request,
+                    email_list=email_field_as_bulk_input
+                )
+            else:
+                linked_learners, course_id_with_emails = self._handle_bulk_upload(
+                    enterprise_customer,
+                    manage_learners_form,
+                    request,
+                )
 
-    def get_missing_params_message(self, parameter_state):
-        """
-        Get a user-friendly message indicating a missing parameter for the API endpoint.
-        """
-        params = ', '.join(name for name, present in parameter_state if not present)
-        return self.MISSING_REQUIRED_PARAMS_MSG.format(params)
+        # _handle_form might add form errors, so we check if it is still valid
+        if manage_learners_form.is_valid():
+            # If we aren't installed in Open edX, blank out enrollment reason so downstream methods don't attempt to
+            # create audit items
+            if create_manual_enrollment_audit is not None:
+                manual_enrollment_reason = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.REASON)
+            else:
+                manual_enrollment_reason = None
+                LOG.exception(
+                    "To create enrollment audits for enterprise learners, "
+                    "this package must be installed in an Open edX environment."
+                )
+
+            notification_type = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.NOTIFY)
+            notify = notification_type == ManageLearnersForm.NotificationTypes.BY_EMAIL
+            discount = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.DISCOUNT)
+            sales_force_id = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.SALES_FORCE_ID)
+            course_mode = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.COURSE_MODE)
+            course_id = None
+
+            if not course_id_with_emails:
+                course_details = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.COURSE) or {}
+                course_id = course_details.get('course_id')
+                if course_id and linked_learners:
+                    self._enroll_users(
+                        request=request,
+                        enterprise_customer=enterprise_customer,
+                        emails=linked_learners,
+                        mode=course_mode,
+                        course_id=course_id,
+                        notify=notify,
+                        enrollment_reason=manual_enrollment_reason,
+                        sales_force_id=sales_force_id,
+                        discount=discount
+                    )
+            else:
+                for course_id, emails in course_id_with_emails.items():
+                    emails_to_enroll = emails
+                    if emails_to_enroll:
+                        self._enroll_users(
+                            request=request,
+                            enterprise_customer=enterprise_customer,
+                            emails=list(emails_to_enroll),
+                            mode=course_mode,
+                            course_id=course_id,
+                            notify=notify,
+                            enrollment_reason=manual_enrollment_reason,
+                            sales_force_id=sales_force_id,
+                            discount=discount
+                        )
+
+            # Redirect to GET if everything went smooth.
+            manage_learners_url = reverse("admin:" + UrlNames.MANAGE_LEARNERS, args=(customer_uuid,))
+            search_keyword = self.get_search_keyword(request)
+            if search_keyword:
+                manage_learners_url = manage_learners_url + "?q=" + search_keyword
+            return HttpResponseRedirect(manage_learners_url)
+
+        # if something went wrong - display bound form on the page
+        return self.get_form_view(
+            request,
+            customer_uuid,
+            additional_context={
+                self.ContextParameters.MANAGE_LEARNERS_FORM: manage_learners_form
+            }
+        )
 
-    @permission_required('enterprise.can_access_admin_dashboard')
-    def post(self, request):
+    def delete(self, request, customer_uuid):
         """
-        POST /enterprise/api/v1/request_codes
+        Handle DELETE request - handle unlinking learner.
 
-        Requires a JSON object of the following format:
-        >>> {
-        >>>     "email": "bob@alice.com",
-        >>>     "enterprise_name": "IBM",
-        >>>     "number_of_codes": "50",
-        >>>     "notes": "Help notes for codes request",
-        >>> }
+        Arguments:
+            request (django.http.request.HttpRequest): Request instance
+            customer_uuid (str): Enterprise Customer UUID
 
-        Keys:
-        *email*
-            Email of the customer who has requested more codes.
-        *enterprise_name*
-            The name of the enterprise requesting more codes.
-        *number_of_codes*
-            The number of codes requested.
-        *notes*
-            Help notes related to codes request.
+        Returns:
+            django.http.response.HttpResponse: HttpResponse
         """
+        # TODO: pylint acts stupid - find a way around it without suppressing
+        enterprise_customer = EnterpriseCustomer.objects.get(uuid=customer_uuid)
+        email_to_unlink = request.GET["unlink_email"]
         try:
-            email, enterprise_name, number_of_codes, notes = self.get_required_query_params(request)
-        except CodesAPIRequestError as invalid_request:
-            return Response({'error': str(invalid_request)}, status=HTTP_400_BAD_REQUEST)
-
-        subject_line = _('Code Management - Request for Codes by {token_enterprise_name}').format(
-            token_enterprise_name=enterprise_name
-        )
-        body_msg = create_message_body(email, enterprise_name, number_of_codes, notes)
-        app_config = apps.get_app_config("enterprise")
-        from_email_address = app_config.enterprise_integrations_email
-        cs_email = app_config.customer_success_email
-        data = {
-            self.REQUIRED_PARAM_EMAIL: email,
-            self.REQUIRED_PARAM_ENTERPRISE_NAME: enterprise_name,
-            self.OPTIONAL_PARAM_NUMBER_OF_CODES: number_of_codes,
-            self.OPTIONAL_PARAM_NOTES: notes,
-        }
-        try:
-            messages_sent = mail.send_mail(
-                subject_line,
-                body_msg,
-                from_email_address,
-                [cs_email],
-                fail_silently=False
-            )
-            LOGGER.info('[Enterprise API] Coupon code request emails sent: %s', messages_sent)
-            return Response(data, status=HTTP_200_OK)
-        except SMTPException:
-            error_message = _(
-                '[Enterprise API] Failure in sending e-mail to support.'
-                ' SupportEmail: {token_cs_email}, UserEmail: {token_email}, EnterpriseName: {token_enterprise_name}'
-            ).format(
-                token_cs_email=cs_email,
-                token_email=email,
-                token_enterprise_name=enterprise_name
-            )
-            LOGGER.error(error_message)
-            return Response(
-                {'error': str('Request codes email could not be sent')},
-                status=HTTP_500_INTERNAL_SERVER_ERROR
-            )
-
+            EnterpriseCustomerUser.objects.unlink_user(
+                enterprise_customer=enterprise_customer,
+                user_email=email_to_unlink,
+            )
+        except (EnterpriseCustomerUser.DoesNotExist, PendingEnterpriseCustomerUser.DoesNotExist):
+            message = _("Email {email} is not associated with Enterprise "
+                        "Customer {ec_name}").format(
+                            email=email_to_unlink, ec_name=enterprise_customer.name)
+            # pylint: disable=http-response-with-content-type-json
+            return HttpResponse(message, content_type="application/json", status=404)
 
-class TableauAuthViewSet(generics.GenericAPIView):
-    """
-    API to authenticate user with Tableau.
-    """
-    permission_classes = (IsAuthenticated,)
-
-    def get(self, request):
-        """
-        Get the auth token against logged in user from tableau
-        """
-        url = settings.TABLEAU_URL + '/trusted'
-        payload = {'username': request.user.username}
-        files = []
-        headers = {
-            'Content-Type': 'application/x-www-form-urlencoded'
-        }
-        response = requests.request("POST", url, headers=headers, data=payload, files=files)
-        return Response(data=response.text)
+        return JsonResponse({})
```

### Comparing `edx-enterprise-3.9.9/enterprise/models.py` & `edx-enterprise-4.0.0/enterprise/utils.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,2551 +1,2308 @@
-# -*- coding: utf-8 -*-
 """
-Database models for enterprise.
+Utility functions for enterprise app.
 """
-
-import collections
+import datetime
 import json
 import os
-from decimal import Decimal
-from logging import getLogger
-from uuid import uuid4
-
-import six
-from django_countries.fields import CountryField
-from edx_rbac.models import UserRole, UserRoleAssignment
+import re
+from urllib.parse import parse_qs, quote, urlencode, urljoin, urlparse, urlsplit, urlunsplit
+from uuid import UUID, uuid4
+
+import bleach
+import pytz
+from edx_django_utils.cache import TieredCache
+from edx_django_utils.cache import get_cache_key as get_django_cache_key
 from edx_rest_api_client.exceptions import HttpClientError
-from fernet_fields import EncryptedCharField
-from jsonfield.encoder import JSONEncoder
-from jsonfield.fields import JSONField
-from multi_email_field.fields import MultiEmailField
-from simple_history.models import HistoricalRecords
-from six.moves.urllib.parse import urljoin  # pylint: disable=import-error,ungrouped-imports
 
 from django.apps import apps
 from django.conf import settings
-from django.contrib.auth.models import User
-from django.contrib.sites.models import Site
+from django.contrib import auth
 from django.core import mail
-from django.core.exceptions import NON_FIELD_ERRORS, ObjectDoesNotExist, ValidationError
-from django.core.files.storage import default_storage
-from django.core.validators import MaxValueValidator, MinValueValidator
-from django.db import IntegrityError, models
-from django.template import Context, Template
+from django.core.exceptions import ObjectDoesNotExist, ValidationError
+from django.core.validators import validate_email
+from django.db import utils
+from django.db.models.query import QuerySet
+from django.forms.models import model_to_dict
+from django.http import Http404
+from django.shortcuts import get_object_or_404
 from django.urls import reverse
-from django.utils.encoding import force_bytes, force_text, python_2_unicode_compatible
-from django.utils.functional import cached_property, lazy
-from django.utils.http import urlquote
-from django.utils.safestring import mark_safe
-from django.utils.translation import ugettext
-from django.utils.translation import ugettext_lazy as _
-
-from model_utils.models import TimeStampedModel
-
-from enterprise import utils
-from enterprise.api_client.discovery import CourseCatalogApiClient, get_course_catalog_api_service_client
-from enterprise.api_client.ecommerce import EcommerceApiClient
-from enterprise.api_client.enterprise_catalog import EnterpriseCatalogApiClient
-from enterprise.api_client.lms import EnrollmentApiClient, ThirdPartyAuthApiClient, parse_lms_api_datetime
+from django.utils import timezone
+from django.utils.dateparse import parse_datetime
+from django.utils.html import format_html
+from django.utils.text import slugify
+from django.utils.translation import gettext as _
+from django.utils.translation import ngettext
+
 from enterprise.constants import (
-    ALL_ACCESS_CONTEXT,
-    AVAILABLE_LANGUAGES,
-    ENTERPRISE_ADMIN_ROLE,
-    ENTERPRISE_OPERATOR_ROLE,
-    DefaultColors,
-    json_serialized_course_modes,
-)
-from enterprise.utils import (
-    CourseEnrollmentDowngradeError,
-    CourseEnrollmentPermissionError,
-    NotConnectedToOpenEdX,
-    get_configuration_value,
-    get_ecommerce_worker_user,
-    get_enterprise_worker_user,
-    get_platform_logo_url,
-)
-from enterprise.validators import (
-    validate_content_filter_fields,
-    validate_hex_color,
-    validate_image_extension,
-    validate_image_size,
+    ALLOWED_TAGS,
+    BEST_MODE_ORDER,
+    DEFAULT_CATALOG_CONTENT_FILTER,
+    LMS_API_DATETIME_FORMAT,
+    LMS_API_DATETIME_FORMAT_WITHOUT_TIMEZONE,
+    PATHWAY_CUSTOMER_ADMIN_ENROLLMENT,
+    PROGRAM_TYPE_DESCRIPTION,
+    CourseModes,
 )
+from enterprise.logging import getEnterpriseLogger
+
+try:
+    from openedx.features.enterprise_support.enrollments.utils import lms_enroll_user_in_course
+except ImportError:
+    lms_enroll_user_in_course = None
+
+try:
+    from openedx.core.djangoapps.course_groups.models import CourseUserGroup
+    from openedx.core.djangoapps.enrollments.errors import CourseEnrollmentError
+except ImportError:
+    CourseUserGroup = None
+    CourseEnrollmentError = None
+
+try:
+    from common.djangoapps.course_modes.models import CourseMode
+except ImportError:
+    CourseMode = None
+
+try:
+    from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
+except ImportError:
+    configuration_helpers = None
+
+try:
+    from openedx.core.djangoapps.catalog.models import CatalogIntegration
+except ImportError:
+    CatalogIntegration = None
+
+try:
+    from lms.djangoapps.branding.api import get_logo_url
+except ImportError:
+    get_logo_url = None
+
+try:
+    from lms.djangoapps.branding.api import get_url
+except ImportError:
+    get_url = None
+
+try:
+    from social_django.models import UserSocialAuth
+except ImportError:
+    UserSocialAuth = None
 
+# Only create manual enrollments if running in edx-platform
 try:
-    from lms.djangoapps.email_marketing.tasks import update_user
+    from common.djangoapps.student.api import (
+        UNENROLLED_TO_ALLOWEDTOENROLL,
+        UNENROLLED_TO_ENROLLED,
+        create_manual_enrollment_audit,
+    )
 except ImportError:
-    update_user = None
+    create_manual_enrollment_audit = None
+    UNENROLLED_TO_ENROLLED = None
+    UNENROLLED_TO_ALLOWEDTOENROLL = None
 
-LOGGER = getLogger(__name__)
 
-mark_safe_lazy = lazy(mark_safe, six.text_type)  # pylint: disable=invalid-name
+# For use with email templates
+SELF_ENROLL_EMAIL_TEMPLATE_TYPE = 'SELF_ENROLL'
+ADMIN_ENROLL_EMAIL_TEMPLATE_TYPE = 'ADMIN_ENROLL'
 
+LOGGER = getEnterpriseLogger(__name__)
 
-class EnterpriseCustomerManager(models.Manager):
+User = auth.get_user_model()
+
+try:
+    from common.djangoapps.third_party_auth.provider import Registry
+except ImportError as exception:
+    LOGGER.debug("Could not import Registry from common.djangoapps.third_party_auth.provider")
+    LOGGER.debug(exception)
+    Registry = None
+
+try:
+    from common.djangoapps.track import segment
+except ImportError as exception:
+    LOGGER.debug("Could not import segment from common.djangoapps.track")
+    LOGGER.debug(exception)
+    segment = None
+
+try:
+    from openedx.core.djangoapps.user_api.models import UserPreference
+except ImportError:
+    UserPreference = None
+
+try:
+    from openedx.core.djangoapps.lang_pref import LANGUAGE_KEY
+except ImportError:
+    LANGUAGE_KEY = 'pref-lang'
+
+
+class ValidationMessages:
     """
-    Model manager for :class:`.EnterpriseCustomer` model.
+    Namespace class for validation messages.
+    """
+
+    # Keep this alphabetically sorted
+    BOTH_FIELDS_SPECIFIED = _(
+        "Either \"Email or Username\" or \"CSV bulk upload\" must be specified, "
+        "but both were.")
+    BULK_LINK_FAILED = _(
+        "Error: Learners could not be added. Correct the following errors.")
+    COURSE_MODE_INVALID_FOR_COURSE = _(
+        "Enrollment track {course_mode} is not available for course {course_id}.")
+    COURSE_WITHOUT_COURSE_MODE = _(
+        "Select a course enrollment track for the given course(s).")
+    INVALID_COURSE_ID = _(
+        "Could not retrieve details for the course ID {course_id}. Specify "
+        "a valid ID.")
+    BOTH_COURSE_FIELDS_SPECIFIED = _(
+        "Either \"CSV bulk upload\" or a singular course ID may be used for manual enrollments, "
+        "but not both together."
+    )
+    INVALID_EMAIL = _(
+        "{argument} does not appear to be a valid email address.")
+    INVALID_EMAIL_OR_USERNAME = _(
+        "{argument} does not appear to be a valid email address or known "
+        "username")
+    MISSING_EXPECTED_COLUMNS = _(
+        "Expected a CSV file with [{expected_columns}] columns, but found "
+        "[{actual_columns}] columns instead."
+    )
+    MISSING_REASON = _(
+        "Reason field is required but was not filled."
+    )
+    NO_FIELDS_SPECIFIED = _(
+        "Either \"Email or Username\" or \"CSV bulk upload\" must be "
+        "specified, but neither were.")
+    USER_ALREADY_REGISTERED = _(
+        "User with email address {email} is already registered with Enterprise "
+        "Customer {ec_name}")
+    USER_NOT_LINKED = _("User is not linked with Enterprise Customer")
+    USER_NOT_EXIST = _("User with email address {email} doesn't exist.")
+    COURSE_NOT_EXIST_IN_CATALOG = _("Course ID {course_id} doesn't exist in Enterprise Customer's Catalog")
+    INVALID_CHANNEL_WORKER = _(
+        'Enterprise channel worker user with the username "{channel_worker_username}" was not found.'
+    )
+    INVALID_ENCODING = _(
+        "Unable to parse CSV file. Please make sure it is a CSV 'utf-8' encoded file."
+    )
+    INVALID_DISCOUNT = _(
+        'Discount percentage should be from 0 to 100.'
+    )
 
-    Filters out inactive Enterprise Customers, otherwise works the same as default model manager.
+
+class NotConnectedToOpenEdX(Exception):
     """
+    Exception to raise when not connected to OpenEdX.
 
-    # This manager filters out some records, hence according to the Django docs it must not be used
-    # for related field access. Although False is default value, it still makes sense to set it explicitly
-    # https://docs.djangoproject.com/en/1.10/topics/db/managers/#base-managers
-    use_for_related_fields = False
+    In general, this exception shouldn't be raised, because this package is
+    designed to be installed directly inside an existing OpenEdX platform.
+    """
 
-    def get_queryset(self):
+    def __init__(self, *args, **kwargs):
         """
-        Return a new QuerySet object. Filters out inactive Enterprise Customers.
+        Log a warning and initialize the exception.
         """
-        return super(EnterpriseCustomerManager, self).get_queryset().filter(active=True)
+        LOGGER.warning('edx-enterprise unexpectedly failed as if not installed in an OpenEdX platform')
+        super().__init__(*args, **kwargs)
 
 
-@python_2_unicode_compatible
-class EnterpriseCustomerType(TimeStampedModel):
+class CourseCatalogApiError(Exception):
+    """
+    Exception to raise when we we received data from Course Catalog but it contained an error.
     """
-    Enterprise Customer Types are used to differentiate Enterprise learners.
 
-    .. no_pii:
+
+class CourseEnrollmentDowngradeError(Exception):
+    """
+    Exception to raise when an enrollment attempts to enroll the user in an unpaid mode when they are in a paid mode.
     """
 
-    class Meta:
-        app_label = 'enterprise'
-        verbose_name = _('Enterprise Customer Type')
-        verbose_name_plural = _('Enterprise Customer Types')
-        ordering = ['name']
 
-    name = models.CharField(
-        max_length=25,
-        blank=False,
-        help_text=_(
-            'Specifies enterprise customer type.'
-        )
-    )
+class CourseEnrollmentPermissionError(Exception):
+    """
+    Exception to raise when an enterprise attempts to use enrollment features it's not configured to use.
+    """
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return self.name
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+def get_social_auth_from_idp(idp, user=None, user_idp_id=None):
+    """
+    Return social auth entry of user for given enterprise IDP.
+
+    idp (EnterpriseCustomerIdentityProvider): EnterpriseCustomerIdentityProvider Object
+    user (User): User Object
+    user_idp_id (str): User id of user in third party LMS
+    """
+
+    if idp:
+        tpa_provider = get_identity_provider(idp.provider_id)
+        filter_kwargs = {
+            'provider': tpa_provider.backend_name,
+            'uid__contains': tpa_provider.provider_id[5:]
+        }
+        if user_idp_id:
+            provider_slug = tpa_provider.provider_id[5:]
+            social_auth_uid = '{}:{}'.format(provider_slug, user_idp_id)
+            filter_kwargs['uid'] = social_auth_uid
+        else:
+            filter_kwargs['user'] = user
 
+        user_social_auth = UserSocialAuth.objects.select_related('user').filter(**filter_kwargs).first()
 
-def get_default_customer_type():
+        return user_social_auth if user_social_auth else None
+
+    return None
+
+
+def get_user_valid_idp(user, enterprise_customer):
     """
-    Get default enterprise customer type id to use when creating a new EnterpriseCustomer model.
+    Return the default idp if it has user social auth record else it
+    will return any idp with valid user social auth record
+
+    user (User): user object
+    enterprise_customer (EnterpriseCustomer): EnterpriseCustomer object
     """
-    enterprise_customer_type, __ = EnterpriseCustomerType.objects.get_or_create(
-        name='Enterprise'
-    )
-    return enterprise_customer_type.id
+    valid_identity_provider = None
 
+    # If default idp provider has UserSocialAuth record then it has the highest priority.
+    if get_social_auth_from_idp(enterprise_customer.default_provider_idp, user=user):
+        valid_identity_provider = enterprise_customer.default_provider_idp
+    else:
+        for idp in enterprise_customer.identity_providers:
+            if get_social_auth_from_idp(idp, user=user):
+                valid_identity_provider = idp
+                break
+    return valid_identity_provider
 
-@python_2_unicode_compatible
-class EnterpriseCustomer(TimeStampedModel):
+
+def get_identity_provider(provider_id):
     """
-    Enterprise Customer is an organization or a group of people that "consumes" courses.
+    Get Identity Provider with given id.
 
-    Users associated with an Enterprise Customer take courses on the edX platform.
+    Return:
+        Instance of ProviderConfig or None.
+    """
+    try:
+        return Registry and Registry.get(provider_id)
+    except ValueError:
+        return None
 
-    Enterprise Customer might be providing certain benefits to their members, like discounts to paid course
-    enrollments, and also might request (or require) sharing learner results with them.
 
-    Fields:
-        uuid (UUIDField, PRIMARY KEY): Enterprise Customer code - used to reference this Enterprise Customer in
-            other parts of the system (SSO, ecommerce, analytics etc.).
-        name (:class:`django.db.models.CharField`): Enterprise Customer name.
-        active (:class:`django.db.models.BooleanField`): used to mark inactive Enterprise Customers - implements
-            "soft delete" pattern.
+def get_idp_choices():
+    """
+    Get a list of identity providers choices for enterprise customer.
 
-    .. no_pii:
+    Return:
+        A list of choices of all identity providers, None if it can not get any available identity provider.
     """
 
-    class Meta:
-        app_label = 'enterprise'
-        verbose_name = _("Enterprise Customer")
-        verbose_name_plural = _("Enterprise Customers")
-        ordering = ['created']
+    first = [("", "-" * 7)]
+    if Registry:
+        return first + [(idp.provider_id, idp.name) for idp in Registry.enabled() if not idp.disable_for_enterprise_sso]
+    return None
 
-    objects = models.Manager()
-    active_customers = EnterpriseCustomerManager()
 
-    uuid = models.UUIDField(primary_key=True, default=uuid4, editable=False)
-    name = models.CharField(max_length=255, blank=False, null=False, help_text=_("Enterprise Customer name."))
-    slug = models.SlugField(
-        max_length=30, unique=True, default='default',
-        help_text=(
-            'A short string uniquely identifying this enterprise. '
-            'Cannot contain spaces and should be a usable as a CSS class. Examples: "ubc", "mit-staging"'
-        )
-    )
-    active = models.BooleanField(default=True)
-    country = CountryField(null=True)
-    hide_course_original_price = models.BooleanField(
-        default=False,
-        help_text=_(
-            "Specify whether display the course original price on enterprise course landing page or not."
-        )
-    )
-    history = HistoricalRecords()
-    site = models.ForeignKey(
-        Site,
-        related_name="enterprise_customers",
-        on_delete=models.deletion.CASCADE
-    )
-
-    AT_ENROLLMENT = 'at_enrollment'
-    EXTERNALLY_MANAGED = 'externally_managed'
-    DATA_SHARING_CONSENT_CHOICES = (
-        (AT_ENROLLMENT, 'At Enrollment'),
-        (EXTERNALLY_MANAGED, 'Managed externally')
-    )
-
-    enable_data_sharing_consent = models.BooleanField(
-        default=False,
-        help_text=_(
-            "Specifies whether data sharing consent is enabled or disabled "
-            "for learners signing in through this enterprise customer. If "
-            "disabled, consent will not be requested, and eligible data will "
-            "not be shared."
-        )
-    )
+def get_all_field_names(model, excluded=None):
+    """
+    Return all fields' names from a model. Filter out the field names present in `excluded`.
 
-    enforce_data_sharing_consent = models.CharField(
-        max_length=25,
-        blank=False,
-        choices=DATA_SHARING_CONSENT_CHOICES,
-        default=AT_ENROLLMENT,
-        help_text=_(
-            "Specifies whether data sharing consent is optional, is required "
-            "at login, or is required at enrollment."
-        )
-    )
+    According to `Django documentation`_, ``get_all_field_names`` should become some monstrosity with chained
+    iterable ternary nested in a list comprehension. For now, a simpler version of iterating over fields and
+    getting their names work, but we might have to switch to full version in future.
 
-    enable_audit_enrollment = models.BooleanField(
-        default=False,
-        help_text=_(
-            "Specifies whether the audit track enrollment option will be displayed in the course enrollment view."
-        )
-    )
+    .. _Django documentation: https://docs.djangoproject.com/en/1.8/ref/models/meta/
+    """
+    excluded_fields = excluded or []
+    return [f.name for f in model._meta.get_fields() if f.name not in excluded_fields]
 
-    enable_audit_data_reporting = models.BooleanField(
-        default=False,
-        help_text=_(
-            "Specifies whether to pass-back audit track enrollment data through an integrated channel."
-        )
-    )
 
-    replace_sensitive_sso_username = models.BooleanField(
-        default=False,
-        help_text=_(
-            "Specifies whether to replace the display of potentially sensitive SSO usernames "
-            "with a more generic name, e.g. EnterpriseLearner."
-        )
-    )
+def get_oauth2authentication_class():
+    """
+    Return oauth2 authentication class to authenticate REST APIs with Bearer token.
+    """
+    try:
+        # pylint: disable=import-outside-toplevel
+        from openedx.core.lib.api.authentication import OAuth2AuthenticationAllowInactiveUser as OAuth2Authentication
+    except ImportError:
+        return None
 
-    # This setting is a temporary fix to hide the cohort API.
-    # It should be removed/refactored once there's a better model for organization-wide settings
-    # in edx-platform.
-    enable_autocohorting = models.BooleanField(
-        default=False,
-        help_text=_(
-            "Specifies whether the customer is able to assign learners to cohorts upon enrollment."
-        )
-    )
-    customer_type = models.ForeignKey(
-        EnterpriseCustomerType,
-        verbose_name=_('Customer Type'),
-        default=get_default_customer_type,
-        help_text=_(
-            'Specifies enterprise customer type.'
-        ), on_delete=models.CASCADE
-    )
+    return OAuth2Authentication
 
-    enable_portal_code_management_screen = models.BooleanField(  # pylint: disable=invalid-name
-        default=False,
-        help_text=_("Specifies whether to allow access to the code management screen in the admin portal.")
-    )
 
-    enable_portal_reporting_config_screen = models.BooleanField(  # pylint: disable=invalid-name
-        default=False,
-        help_text=_("Specifies whether to allow access to the reporting configurations screen in the admin portal.")
-    )
+def get_catalog_admin_url(catalog_id):
+    """
+    Get url to catalog details admin page.
 
-    enable_portal_subscription_management_screen = models.BooleanField(  # pylint: disable=invalid-name
-        default=False,
-        help_text=_("Specifies whether to allow access to the subscription management screen in the admin portal.")
-    )
+    Arguments:
+        catalog_id (int): Catalog id for which to return catalog details url.
 
-    enable_portal_saml_configuration_screen = models.BooleanField(  # pylint: disable=invalid-name
-        default=False,
-        help_text=_("Specifies whether to allow access to the saml configuration screen in the admin portal")
-    )
+    Returns:
+         URL pointing to catalog details admin page for the give catalog id.
 
-    enable_learner_portal = models.BooleanField(
-        default=False,
-        help_text=_("Specifies whether the enterprise learner portal site should be made known to the learner.")
-    )
+    Example:
+        >>> get_catalog_admin_url_template(2)
+        "http://localhost:18381/admin/catalogs/catalog/2/change/"
 
-    enable_integrated_customer_learner_portal_search = models.BooleanField(  # pylint: disable=invalid-name
-        default=True,
-        help_text=_(
-            "Specifies whether a learner for an integrated channel customer can navigate the enterprise learner "
-            "portal site using the main menu."
-        )
-    )
+    """
+    return get_catalog_admin_url_template().format(catalog_id=catalog_id)
 
-    enable_analytics_screen = models.BooleanField(  # pylint: disable=invalid-name
-        default=False,
-        help_text=_("Specifies whether to allow access to the analytics screen in the admin portal.")
-    )
-
-    enable_slug_login = models.BooleanField(
-        default=False,
-        help_text=_("Specifies whether the learner should be able to login through enterprise's slug login")
-    )
-
-    contact_email = models.EmailField(
-        null=True,
-        blank=True,
-        help_text=_("Email to be displayed as public point of contact for enterprise.")
-    )
-
-    default_contract_discount = models.DecimalField(
-        null=True,
-        blank=True,
-        max_digits=8,
-        decimal_places=5,
-        help_text=_(
-            "Specifies the discount percent used for enrollments from the enrollment API "
-            "where capturing the discount per order is not possible. "
-            "This is passed to ecommerce when creating orders for financial data reporting."
-        )
-    )
-    default_language = models.CharField(
-        max_length=25,
-        null=True,
-        blank=True,
-        choices=AVAILABLE_LANGUAGES,
-        default=None,
-        help_text=_(
-            "Specifies the default language for all the learners of this enterprise customer."
-        )
-    )
 
-    @property
-    def identity_provider(self):
-        """
-        Return the unique slug for the identity provider associated with this enterprise customer.
+def get_catalog_admin_url_template(mode='change'):
+    """
+    Get template of catalog admin url.
 
-        Returns `None` if enterprise customer does not have any identity provider.
-        """
-        try:
-            # pylint: disable=no-member
-            return self.enterprise_customer_identity_provider and self.enterprise_customer_identity_provider.provider_id
-        except ObjectDoesNotExist:
-            return None
+    URL template will contain a placeholder '{catalog_id}' for catalog id.
+    Arguments:
+        mode e.g. change/add.
 
-    @property
-    def sync_learner_profile_data(self):
-        """
-        Return the sync_learner_profile data flag for the identity provider associated with this enterprise customer.
+    Returns:
+        A string containing template for catalog url.
 
-        Returns False if enterprise customer does not have any identity provider.
-        """
-        try:
-            # pylint: disable=no-member
-            return (
-                self.enterprise_customer_identity_provider and
-                self.enterprise_customer_identity_provider.sync_learner_profile_data
-            )
-        except ObjectDoesNotExist:
-            return False
+    Example:
+        >>> get_catalog_admin_url_template('change')
+        "http://localhost:18381/admin/catalogs/catalog/{catalog_id}/change/"
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        # pylint: disable=no-member
-        return "<EnterpriseCustomer {code:x}: {name}>".format(code=self.uuid.time_low, name=self.name)
+    """
+    api_base_url = getattr(settings, "COURSE_CATALOG_API_URL", "")
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    # Extract FQDN (Fully Qualified Domain Name) from API URL.
+    match = re.match(r"^(?P<fqdn>(?:https?://)?[^/]+)", api_base_url)
 
-    def enforces_data_sharing_consent(self, enforcement_location):
-        """
-        Determine whether the enterprise customer enforce data sharing consent at the given point.
+    if not match:
+        return ""
 
-        Args:
-            enforcement_location (str): the point where to see data sharing consent state.
-            argument can either be 'at_enrollment' or 'externally_managed'
-        """
-        return self.requests_data_sharing_consent and self.enforce_data_sharing_consent == enforcement_location
+    # Return matched FQDN from catalog api url appended with catalog admin path
+    if mode == 'change':
+        return match.group("fqdn").rstrip("/") + "/admin/catalogs/catalog/{catalog_id}/change/"
+    if mode == 'add':
+        return match.group("fqdn").rstrip("/") + "/admin/catalogs/catalog/add/"
+    return None
 
-    @property
-    def requests_data_sharing_consent(self):
-        """
-        Determine whether the enterprise customer has enabled the data sharing consent request.
-        """
-        return self.enable_data_sharing_consent and self.enforce_data_sharing_consent != self.EXTERNALLY_MANAGED
 
-    @property
-    def enables_audit_data_reporting(self):
-        """
-        Determine whether the enterprise customer has enabled the ability to report/pass-back audit track data.
-        """
-        return self.enable_audit_enrollment and self.enable_audit_data_reporting
+def get_notification_subject_line(course_name, template_configuration=None):
+    """
+    Get a subject line for a notification email.
 
-    @property
-    def serialized(self):
-        """Return a serialized version of this customer."""
-        from enterprise.api.v1 import serializers  # pylint: disable=import-outside-toplevel
-        return serializers.EnterpriseCustomerSerializer(self).data
+    The method is designed to fail in a "smart" way; if we can't render a
+    database-backed subject line template, then we'll fall back to a template
+    saved in the Django settings; if we can't render _that_ one, then we'll
+    fall through to a friendly string written into the code.
 
-    @property
-    def safe_branding_configuration(self):
-        """
-        Return the associated EnterpriseCustomerBrandingConfiguration object OR default branding config
+    One example of a failure case in which we want to fall back to a stock template
+    would be if a site admin entered a subject line string that contained a template
+    tag that wasn't available, causing a KeyError to be raised.
 
-        This function should always be used to access the customer's branding_configuration and prevent
-        uncaught RelatedObjectDoesNotExist exceptions when accessed directly.
-        """
-        try:
-            branding_config = self.branding_configuration  # pylint: disable=no-member
-        except EnterpriseCustomerBrandingConfiguration.DoesNotExist:
-            branding_config = self._get_default_branding_configuration()
-        return branding_config
+    Arguments:
+        course_name (str): Course name to be rendered into the string
+        template_configuration: A database-backed object with a stored subject line template
 
-    def _get_default_branding_configuration(self):
-        """
-        Return the default EnterpriseCustomerBrandingConfiguration object
-        """
-        return EnterpriseCustomerBrandingConfiguration(
-            enterprise_customer=self,
-            primary_color=DefaultColors.PRIMARY,
-            secondary_color=DefaultColors.SECONDARY,
-            tertiary_color=DefaultColors.TERTIARY,
-        )
+    """
+    stock_subject_template = _('You\'ve been enrolled in {course_name}!')
+    default_subject_template = getattr(
+        settings,
+        'ENTERPRISE_ENROLLMENT_EMAIL_DEFAULT_SUBJECT_LINE',
+        stock_subject_template,
+    )
+    if template_configuration is not None and template_configuration.subject_line:
+        final_subject_template = template_configuration.subject_line
+    else:
+        final_subject_template = default_subject_template
 
-    def get_data_sharing_consent_text_overrides(self, published_only=True):
-        """
-        Return DataSharingConsentTextOverrides associated with this instance.
-        """
-        # pylint: disable=invalid-name
-        DataSharingConsentTextOverrides = apps.get_model('consent', 'DataSharingConsentTextOverrides')
-        queryset = DataSharingConsentTextOverrides.objects.filter(enterprise_customer=self)
-        if published_only:
-            queryset = queryset.filter(published=True)
-        return queryset.first()
+    try:
+        return final_subject_template.format(course_name=course_name)
+    except KeyError:
+        pass
 
-    def get_course_enrollment_url(self, course_key):
-        """
-        Return enterprise landing page url for the given course.
+    try:
+        return default_subject_template.format(course_name=course_name)
+    except KeyError:
+        return stock_subject_template.format(course_name=course_name)
 
-        Arguments:
-            course_key (str): The course key for the course to be displayed.
-        Returns:
-            (str): Enterprise landing page url.
-        """
-        url = urljoin(
-            get_configuration_value('LMS_ROOT_URL', settings.LMS_ROOT_URL),
-            reverse(
-                'enterprise_course_enrollment_page',
-                kwargs={'enterprise_uuid': self.uuid, 'course_key': course_key}
-            )
-        )
-        return utils.update_query_parameters(url, utils.get_enterprise_utm_context(self))
 
-    def get_course_run_enrollment_url(self, course_run_key):
-        """
-        Return enterprise landing page url for the given course.
+def find_enroll_email_template(enterprise_customer, template_type):
+    """
+    Find email template from the template database represented by EnrollmentNotificationEmailTemplate model.
 
-        Arguments:
-            course_run_key (str): The course run id for the course to be displayed.
-        Returns:
-            (str): Enterprise landing page url.
-        """
-        url = urljoin(
-            get_configuration_value('LMS_ROOT_URL', settings.LMS_ROOT_URL),
-            reverse(
-                'enterprise_course_run_enrollment_page',
-                kwargs={'enterprise_uuid': self.uuid, 'course_id': course_run_key}
-            )
-        )
-        return utils.update_query_parameters(url, utils.get_enterprise_utm_context(self))
+    Arguments:
+        - enterprise_customer (EnterpriseCustomer): the customer model
+        - template_type (str): type of template to fetch, must be one of:
+              enterprise.utils.SELF_ENROLL_EMAIL_TEMPLATE_TYPE, or
+              enterprise.utils.ADMIN_ENROLL_EMAIL_TEMPLATE_TYPE
 
-    def get_program_enrollment_url(self, program_uuid):
-        """
-        Return enterprise landing page url for the given program.
+    Returns:
+      Customer specific template if found.
+      Default template for the given type if found.
+      None if neither default template, nor per customer template found.
+    """
+    enrollment_template = apps.get_model('enterprise', 'EnrollmentNotificationEmailTemplate')
 
-        Arguments:
-            program_uuid (str): The program UUID.
-        Returns:
-            (str): Enterprise program landing page url.
-        """
-        url = urljoin(
-            get_configuration_value('LMS_ROOT_URL', settings.LMS_ROOT_URL),
-            reverse(
-                'enterprise_program_enrollment_page',
-                kwargs={'enterprise_uuid': self.uuid, 'program_uuid': program_uuid}
-            )
-        )
-        return utils.update_query_parameters(url, utils.get_enterprise_utm_context(self))
+    if not enterprise_customer:
+        raise ValueError('Must provide a enterprise_customer argument')
 
-    def catalog_contains_course(self, course_run_id):
-        """
-        Determine if the specified course run is contained in enterprise customer catalogs.
+    if not template_type:
+        raise ValueError('Must provide a template_type argument')
 
-        Arguments:
-            course_run_id (str): The string ID of the course or course run in question
+    # first try customer specific template for this type
+    try:
+        enterprise_template_config = enrollment_template.objects.filter(
+            enterprise_customer=enterprise_customer,
+            template_type=template_type,
+        ).first()
+    except (ObjectDoesNotExist, AttributeError):
+        enterprise_template_config = None
 
-        Returns:
-            bool: Whether the enterprise catalog includes the given course run.
-        """
-        if EnterpriseCatalogApiClient().enterprise_contains_content_items(self.uuid, [course_run_id]):
-            return True
+    if not enterprise_template_config:
+        # use the fallback template instead
+        enterprise_template_config = enrollment_template.objects.filter(
+            enterprise_customer=None,
+            template_type=template_type,
+        ).first()
 
-        return False
+    return enterprise_template_config
 
-    def enroll_user_pending_registration(self, email, course_mode, *course_ids, **kwargs):
-        """
-        Create pending enrollments for the user in any number of courses, which will take effect on registration.
 
-        Args:
-            email: The email address for the pending link to be created
-            course_mode: The mode with which the eventual enrollment should be created
-            *course_ids: An iterable containing any number of course IDs to eventually enroll the user in.
-            cohort (optional): name of cohort to assign
-        Returns:
-            The PendingEnterpriseCustomerUser attached to the email address
-        """
-        pending_ecu, __ = PendingEnterpriseCustomerUser.objects.get_or_create(
-            enterprise_customer=self,
-            user_email=email
-        )
-        for course_id in course_ids:
-            PendingEnrollment.objects.update_or_create(
-                user=pending_ecu,
-                course_id=course_id,
-                defaults={
-                    'course_mode': course_mode,
-                    'cohort_name': kwargs.get('cohort', None),
-                    'source': kwargs.get('enrollment_source', None),
-                    'discount_percentage': Decimal(kwargs.get('discount', 0.0)).quantize(Decimal('0.00001')),
-                    'sales_force_id': kwargs.get('sales_force_id', None),
-                }
-            )
-        return pending_ecu
+def is_pending_user(user):
+    """
+    Returns true if pending_user attributes are detected
+    """
+    return hasattr(user, 'user_email') and not hasattr(user, 'first_name')
 
-    def clear_pending_registration(self, email, *course_ids):
-        """
-        Clear pending enrollments for the user in the given courses.
 
-        Args:
-            email: The email address which may have previously been used.
-            course_ids: An iterable containing any number of course IDs.
-        """
-        try:
-            pending_ecu = PendingEnterpriseCustomerUser.objects.get(user_email=email, enterprise_customer=self)
-        except PendingEnterpriseCustomerUser.DoesNotExist:
-            pass
-        else:
-            PendingEnrollment.objects.filter(user=pending_ecu, course_id__in=course_ids).delete()
+def get_learner_portal_url(enterprise_customer):
+    """
+    Learner portal url for enterprise_customer
+    """
+    return get_configuration_value_for_site(
+        enterprise_customer.site,
+        'ENTERPRISE_LEARNER_PORTAL_BASE_URL',
+        settings.ENTERPRISE_LEARNER_PORTAL_BASE_URL
+    )
 
-    def notify_enrolled_learners(self, catalog_api_user, course_id, users):
-        """
-        Notify learners about a course in which they've been enrolled.
 
-        Args:
-            catalog_api_user: The user for calling the Catalog API
-            course_id: The specific course the learners were enrolled in
-            users: An iterable of the users or pending users who were enrolled
-        """
-        course_details = CourseCatalogApiClient(catalog_api_user, self.site).get_course_run(course_id)
-        if not course_details:
-            LOGGER.warning(
-                ugettext("Course details were not found for course key {} - Course Catalog API returned nothing. "
-                         "Proceeding with enrollment, but notifications won't be sent").format(course_id)
-            )
-            return
+def serialize_notification_content(
+    enterprise_customer,
+    course_details,
+    course_id,
+    users,
+    admin_enrollment=False,
+    activation_links=None,
+):
+    """
+    Prepare serializable contents to send emails with (if using tasks to send emails)
 
-        course_path = urlquote(
-            '/courses/{course_id}/course/?tpa_hint={tpa_hint}'.format(
-                course_id=course_id,
-                tpa_hint=self.identity_provider,
+    Arguments:
+        enterprise_customer (enterprise.models.EnterpriseCustomer)
+        course_details (dict): With at least 'title', 'start' and 'course' keys
+           (usually obtained via CourseCatalogApiClient)
+        course_id (str)
+        users (list): list of users to enroll (each user should be a User or PendingEnterpriseCustomerUser)
+        activation_links (dict): a dictionary map of unactivated license user emails to license activation links
+
+    Returns: A list of dictionary objects that are of the form::
+
+      {
+        "user": user
+        "enrolled_in": {
+            'name': course_name,
+            'url': destination_url,
+            'type': 'course',
+            'start': course_start,
+        },
+        "dashboard_url": dashboard_url,
+        "enterprise_customer_uuid": self.uuid,
+        "admin_enrollment": admin_enrollment,
+      }
+
+    where user is one of
+      - 1: { 'first_name': name, 'username': user_name, 'email': email } (dict of User object)
+      - 2: { 'user_email' : user_email } (dict of PendingEnterpriseCustomerUser object)
+    """
+    dashboard_url = None
+    course_name = course_details.get('title')
+    course_path = '/courses/{course_id}/course'.format(course_id=course_id)
+    params = {}
+
+    if admin_enrollment:
+        dashboard_url = get_learner_portal_url(enterprise_customer)
+
+    # add tpa_hint if there is only one IdP attached with enterprise_customer
+    if enterprise_customer.has_single_idp:
+        params = {'tpa_hint': enterprise_customer.identity_providers.first().provider_id}
+    elif enterprise_customer.has_multiple_idps and enterprise_customer.default_provider_idp:
+        params = {'tpa_hint': enterprise_customer.default_provider_idp.provider_id}
+    course_path = quote("{}?{}".format(course_path, urlencode(params)))
+
+    lms_root_url = get_configuration_value_for_site(
+        enterprise_customer.site,
+        'LMS_ROOT_URL',
+        settings.LMS_ROOT_URL
+    )
+
+    try:
+        course_start = parse_lms_api_datetime(course_details.get('start'))
+    except (TypeError, ValueError):
+        course_start = None
+        LOGGER.exception(
+            'None or empty value passed as course start date.\nCourse Details:\n{course_details}'.format(
+                course_details=course_details,
             )
         )
-        lms_root_url = utils.get_configuration_value_for_site(
-            self.site,
-            'LMS_ROOT_URL',
-            settings.LMS_ROOT_URL
-        )
-        destination_url = '{site}/{login_or_register}?next={course_path}'.format(
-            site=lms_root_url,
-            login_or_register='{login_or_register}',  # We don't know the value at this time
-            course_path=course_path
-        )
-        course_name = course_details.get('title')
 
-        try:
-            course_start = parse_lms_api_datetime(course_details.get('start'))
-        except (TypeError, ValueError):
-            course_start = None
-            LOGGER.exception(
-                'None or empty value passed as course start date.\nCourse Details:\n{course_details}'.format(
-                    course_details=course_details,
-                )
+    email_items = []
+    for user in users:
+        user_dict = model_to_dict(user, fields=['first_name', 'username', 'user_email', 'email'])
+        if 'email' in user_dict:
+            user_email = user_dict['email']
+        elif 'user_email' in user_dict:
+            user_email = user_dict['user_email']
+        else:
+            raise TypeError(_('`user` must have one of either `email` or `user_email`.'))
+        login_or_register = 'register' if is_pending_user(user) else 'login'
+        # if we have an activation link for a license, use that rather than the course URL
+        if activation_links is not None and activation_links.get(user_email) is not None:
+            destination_url = activation_links.get(user_email)
+        else:
+            destination_url = '{site}/{login_or_register}?next={course_path}'.format(
+                site=lms_root_url,
+                login_or_register=login_or_register,
+                course_path=course_path
             )
+        email_items.append({
+            "user": user_dict,
+            "enrolled_in": {
+                'name': course_name,
+                'url': destination_url,
+                'type': 'course',
+                'start': course_start,
+            },
+            "dashboard_url": dashboard_url,
+            "enterprise_customer_uuid": enterprise_customer.uuid,
+            "admin_enrollment": admin_enrollment,
+        })
+    return email_items
+
+
+def send_email_notification_message(
+        user,
+        enrolled_in,
+        dashboard_url,
+        enterprise_customer_uuid,
+        email_connection=None,
+        admin_enrollment=False,
+):
+    """
+    Send an email notifying a user about their enrollment in a course.
 
-        with mail.get_connection() as email_conn:
-            for user in users:
-                login_or_register = 'register' if isinstance(user, PendingEnterpriseCustomerUser) else 'login'
-                destination_url = destination_url.format(login_or_register=login_or_register)
-                utils.send_email_notification_message(
-                    user=user,
-                    enrolled_in={
-                        'name': course_name,
-                        'url': destination_url,
-                        'type': 'course',
-                        'start': course_start,
-                    },
-                    enterprise_customer=self,
-                    email_connection=email_conn
-                )
-
+    Arguments:
+        user: a dict with either of the following forms:
+              - 1: { 'first_name': name, 'username': user_name, 'email': email } (similar to a User object)
+              - 2: { 'user_email' : user_email } (similar to a PendingEnterpriseCustomerUser object)
+
+        enrolled_in (dict): The dictionary contains details of the enrollable object
+            (either course or program) that the user enrolled in. This MUST contain
+            a `name` key, and MAY contain the other following keys::
+
+                - url: A human-friendly link to the enrollable's home page
+
+                - type: Either `course` or `program` at present
+
+                - branding: A special name for what the enrollable "is"; for example,
+                    "MicroMasters" would be the branding for a "MicroMasters Program"
+
+                - start: A datetime object indicating when the enrollable will be available.
+
+        dashboard_url: link to enterprise customer's unique homepage for user
+
+        enterprise_customer_uuid: The EnterpriseCustomer uuid that the enrollment was created using.
+
+        email_connection: An existing Django email connection that can be used without
+            creating a new connection for each individual message
+
+        admin_enrollment: If true, uses admin enrollment template instead of default ones.
+    """
+    if 'first_name' in user and 'username' in user:
+        # PendingEnterpriseCustomerUsers don't have usernames or real names. We should
+        # template slightly differently to make sure weird stuff doesn't happen.
+        user_name = user['first_name']
+        if not user_name:
+            user_name = user['username']
+    else:
+        user_name = None
+
+    # User-like dicts have an `email` attribute; PendingEnterpriseCustomerUser-like have `user_email`.
+    if 'email' in user:
+        user_email = user['email']
+    elif 'user_email' in user:
+        user_email = user['user_email']
+    else:
+        raise TypeError(_('`user` must have one of either `email` or `user_email`.'))
+
+    enterprise_customer = get_enterprise_customer(enterprise_customer_uuid)
+    msg_context = {
+        'user_name': user_name,
+        'enrolled_in': enrolled_in,
+        'dashboard_url': dashboard_url,
+        'organization_name': enterprise_customer.name,
+    }
+
+    if admin_enrollment:
+        template_type = ADMIN_ENROLL_EMAIL_TEMPLATE_TYPE
+    else:
+        template_type = SELF_ENROLL_EMAIL_TEMPLATE_TYPE
+
+    enterprise_template_config = find_enroll_email_template(enterprise_customer, template_type)
+
+    if not enterprise_template_config:
+        LOGGER.warning(
+            'Cannot find email templates for %s, template_type: %s. '
+            'Not sending notification email.',
+            enterprise_customer.name, template_type
+        )
+        return None
 
-class EnterpriseCustomerUserManager(models.Manager):
-    """
-    Model manager for :class:`.EnterpriseCustomerUser` entity.
+    plain_msg, html_msg = enterprise_template_config.render_all_templates(msg_context)
 
-    This class should contain methods that create, modify or query :class:`.EnterpriseCustomerUser` entities.
-    """
+    subject_line = get_notification_subject_line(enrolled_in['name'], enterprise_template_config)
 
-    def __init__(self, *args, **kwargs):
-        """
-        Initialize custom manager.
+    from_email_address = get_configuration_value_for_site(
+        enterprise_customer.site,
+        'DEFAULT_FROM_EMAIL',
+        default=settings.DEFAULT_FROM_EMAIL
+    )
 
-        kwargs:
-            linked_only (Bool): create a manager with linked learners only if True else all(linked and unlinked) records
-        """
-        self.linked_only = kwargs.pop('linked_only', True)
-        super(EnterpriseCustomerUserManager, self).__init__(*args, **kwargs)
+    return mail.send_mail(
+        subject_line,
+        plain_msg,
+        from_email_address,
+        [user_email],
+        html_message=html_msg,
+        connection=email_connection
+    )
 
-    def get_queryset(self):
-        """
-        Return linked or unlinked learners based on how the manager is created.
-        """
-        if self.linked_only:
-            return super(EnterpriseCustomerUserManager, self).get_queryset().filter(linked=True)
 
-        return super(EnterpriseCustomerUserManager, self).get_queryset()
+def enterprise_customer_model():
+    """
+    Returns the ``EnterpriseCustomer`` class.
+    """
+    return apps.get_model('enterprise', 'EnterpriseCustomer')
 
-    def get(self, **kwargs):
-        """
-        Overridden get method to return the first element in case of learner with multiple enterprises.
 
-        Raises EnterpriseCustomerUser.DoesNotExist if no records are found.
-        """
-        fetched_object = self.get_queryset().filter(**kwargs).first()
-        if fetched_object:
-            return fetched_object
-        raise EnterpriseCustomerUser.DoesNotExist
+def enterprise_enrollment_source_model():
+    """
+    Returns the ``EnterpriseEnrollmentSource`` class.
+    """
+    return apps.get_model('enterprise', 'EnterpriseEnrollmentSource')
 
-    def get_link_by_email(self, user_email):
-        """
-        Return link by email.
-        """
-        try:
-            user = User.objects.get(email=user_email)
-            try:
-                return self.get(user_id=user.id)
-            except EnterpriseCustomerUser.DoesNotExist:
-                pass
-        except User.DoesNotExist:
-            pass
 
-        try:
-            return PendingEnterpriseCustomerUser.objects.get(user_email=user_email)
-        except PendingEnterpriseCustomerUser.DoesNotExist:
-            pass
+def enterprise_customer_user_model():
+    """
+    Returns the ``EnterpriseCustomerUser`` class.
+    """
+    return apps.get_model('enterprise', 'EnterpriseCustomerUser')
 
-        return None
 
-    def link_user(self, enterprise_customer, user_email):
-        """
-        Link user email to Enterprise Customer.
+def enterprise_course_enrollment_model():
+    """
+    Returns the ``EnterpriseCourseEnrollment`` class.
+    """
+    return apps.get_model('enterprise', 'EnterpriseCourseEnrollment')
 
-        If :class:`django.contrib.auth.models.User` instance with specified email does not exist,
-        :class:`.PendingEnterpriseCustomerUser` instance is created instead.
-        """
-        try:
-            existing_user = User.objects.get(email=user_email)
-            self.get_or_create(enterprise_customer=enterprise_customer, user_id=existing_user.id)
-        except User.DoesNotExist:
-            PendingEnterpriseCustomerUser.objects.get_or_create(enterprise_customer=enterprise_customer,
-                                                                user_email=user_email)
 
-    def unlink_user(self, enterprise_customer, user_email):
-        """
-        Unlink user email from Enterprise Customer.
+def licensed_enterprise_course_enrollment_model():
+    """
+    returns the ``LicensedEnterpriseCourseEnrollment`` class.
+    """
+    return apps.get_model('enterprise', 'LicensedEnterpriseCourseEnrollment')
 
-        If :class:`django.contrib.auth.models.User` instance with specified email does not exist,
-        :class:`.PendingEnterpriseCustomerUser` instance is deleted instead.
 
-        Raises EnterpriseCustomerUser.DoesNotExist if instance of :class:`django.contrib.auth.models.User` with
-        specified email exists and corresponding :class:`.EnterpriseCustomerUser` instance does not.
+def subsidized_enterprise_course_enrollment_model():
+    """
+    returns the ``LearnerCreditEnterpriseCourseEnrollment`` class.
+    """
+    return apps.get_model('enterprise', 'LearnerCreditEnterpriseCourseEnrollment')
 
-        Raises PendingEnterpriseCustomerUser.DoesNotExist exception if instance of
-        :class:`django.contrib.auth.models.User` with specified email exists and corresponding
-        :class:`.PendingEnterpriseCustomerUser` instance does not.
-        """
-        try:
-            existing_user = User.objects.get(email=user_email)
-            # not capturing DoesNotExist intentionally to signal to view that link does not exist
-            link_record = self.get(enterprise_customer=enterprise_customer, user_id=existing_user.id)
-            link_record.linked = False
-            link_record.save()
-
-            if update_user:
-                # Remove the SailThru flags for enterprise learner.
-                update_user.delay(
-                    sailthru_vars={
-                        'is_enterprise_learner': False,
-                        'enterprise_name': None,
-                    },
-                    email=user_email
-                )
 
-        except User.DoesNotExist:
-            # not capturing DoesNotExist intentionally to signal to view that link does not exist
-            pending_link = PendingEnterpriseCustomerUser.objects.get(
-                enterprise_customer=enterprise_customer, user_email=user_email
-            )
-            pending_link.delete()
+def enterprise_customer_invite_key_model():
+    """
+    Returns the ``EnterpriseCustomerInviteKey`` class.
+    """
+    return apps.get_model('enterprise', 'EnterpriseCustomerInviteKey')
 
-        LOGGER.info(
-            'Enterprise learner {%s} successfully unlinked from Enterprise Customer {%s}',
-            user_email,
-            enterprise_customer.name
-        )
 
+def get_enterprise_customer(uuid):
+    """
+    Get the ``EnterpriseCustomer`` instance associated with ``uuid``.
 
-@python_2_unicode_compatible
-class EnterpriseCustomerUser(TimeStampedModel):
+    :param uuid: The universally unique ID of the enterprise customer.
+    :return: The ``EnterpriseCustomer`` instance, or ``None`` if it doesn't exist.
     """
-    Model that keeps track of user - enterprise customer affinity.
+    EnterpriseCustomer = enterprise_customer_model()
+    try:
+        return EnterpriseCustomer.objects.get(uuid=uuid)
+    except (EnterpriseCustomer.DoesNotExist, ValidationError):
+        return None
 
-    Fields:
-        enterprise_customer (ForeignKey[:class:`.EnterpriseCustomer`]): enterprise customer
-        user_id (:class:`django.db.models.IntegerField`): user identifier
 
-    .. no_pii:
+def get_enterprise_uuids_for_user_and_course(auth_user, course_run_id, is_customer_active=None):
     """
+    Get the ``EnterpriseCustomer`` UUID(s) associated with a user and a course id``.
 
-    enterprise_customer = models.ForeignKey(
-        EnterpriseCustomer,
-        blank=False,
-        null=False,
-        related_name='enterprise_customer_users',
-        on_delete=models.deletion.CASCADE
-    )
-    user_id = models.PositiveIntegerField(null=False, blank=False, db_index=True)
-    active = models.BooleanField(default=True)
-    linked = models.BooleanField(default=True)
+    Some users are associated with an enterprise customer via `EnterpriseCustomerUser` model,
+        1. if given user is enrolled in a specific course via an enterprise customer enrollment,
+           return related enterprise customers as a list.
+        2. otherwise return empty list.
 
-    objects = EnterpriseCustomerUserManager()
-    all_objects = EnterpriseCustomerUserManager(linked_only=False)
+    Arguments:
+        auth_user (contrib.auth.User): Django User
+        course_run_id (str): Course Run to lookup an enrollment against.
+        active: (boolean or None): Filter flag for returning active, inactive, or all uuids
 
-    class Meta:
-        app_label = 'enterprise'
-        verbose_name = _("Enterprise Customer Learner")
-        verbose_name_plural = _("Enterprise Customer Learners")
-        unique_together = (("enterprise_customer", "user_id"),)
-        ordering = ['-active', '-modified']
+    Returns:
+        (list of str): enterprise customer uuids associated with the current user and course run or None
 
-    def save(self, *args, **kwargs):  # pylint: disable=arguments-differ
-        """
-        Override to handle creation of EnterpriseCustomerUser records.
+    """
+    return enterprise_course_enrollment_model().get_enterprise_uuids_with_user_and_course(
+        auth_user.id,
+        course_run_id,
+        is_customer_active=is_customer_active,
+    )
 
-        This is needed because of soft deletion of EnterpriseCustomerUser records.
-        This will handle all of get_or_create/update_or_create/create methods.
-        """
-        if self.pk is None:
-            # We are trying to create a new object but it may be possible that an existing unlinked
-            # record exists, so if an existing record exists then just update that with linked=True
-            try:
-                existing = EnterpriseCustomerUser.all_objects.get(
-                    enterprise_customer=self.enterprise_customer,
-                    user_id=self.user_id,
-                    linked=False
-                )
-                self.linked = True
-                # An existing record has been found so update auto primary key with primay key of existing record
-                self.pk = existing.pk  # pylint: disable=invalid-name
-                # Update the kwargs so that Django will update the existing record instead of creating a new one
-                kwargs = dict(kwargs, **{'force_insert': False, 'force_update': True})
-            except EnterpriseCustomerUser.DoesNotExist:
-                # No existing record found so do nothing and proceed with normal operation
-                pass
 
-        return super(EnterpriseCustomerUser, self).save(*args, **kwargs)
+def get_enterprise_customer_for_user(auth_user):
+    """
+    Return first found enterprise customer instance for given user.
 
-    @property
-    def user(self):
-        """
-        Return User associated with this instance.
+    Some users are associated with an enterprise customer via `EnterpriseCustomerUser` model,
+        1. if given user is associated with any enterprise customer, return first enterprise customer.
+        2. otherwise return `None`.
 
-        Return :class:`django.contrib.auth.models.User` instance associated with this
-        :class:`EnterpriseCustomerUser` instance via email.
-        """
-        try:
-            return User.objects.get(pk=self.user_id)
-        except User.DoesNotExist:
-            return None
+    Arguments:
+        auth_user (contrib.auth.User): Django User
 
-    @property
-    def user_email(self):
-        """
-        Return linked user email.
-        """
-        if self.user is not None:
-            return self.user.email
-        return None
+    Returns:
+        (EnterpriseCustomer): enterprise customer associated with the current user.
 
-    @property
-    def username(self):
-        """
-        Return linked user's username.
-        """
-        if self.user is not None:
-            return self.user.username
+    """
+    EnterpriseCustomerUser = apps.get_model('enterprise', 'EnterpriseCustomerUser')
+    try:
+        return EnterpriseCustomerUser.objects.get(user_id=auth_user.id).enterprise_customer
+    except EnterpriseCustomerUser.DoesNotExist:
         return None
 
-    @property
-    def data_sharing_consent_records(self):
-        """
-        Return the DataSharingConsent records associated with this EnterpriseCustomerUser.
-
-        Returns:
-            QuerySet (DataSharingConsent): The filtered DataSharingConsent QuerySet.
-        """
-        DataSharingConsent = apps.get_model('consent', 'DataSharingConsent')  # pylint: disable=invalid-name
-        return DataSharingConsent.objects.filter(
-            enterprise_customer=self.enterprise_customer,
-            username=self.username
-        )
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<EnterpriseCustomerUser {ID}>: {enterprise_name} - {user_id}".format(
-            ID=self.id,
-            enterprise_name=self.enterprise_customer.name,
-            user_id=self.user_id,
-        )
+def get_enterprise_customer_user(user_id, enterprise_uuid):
+    """
+    Return the object for EnterpriseCustomerUser.
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    Arguments:
+        user_id (str): user identifier
+        enterprise_uuid (UUID): Universally unique identifier for the enterprise customer.
 
-    def get_remote_id(self):
-        """
-        Retrieve the SSO provider's identifier for this user from the LMS Third Party API.
+    Returns:
+        (EnterpriseCustomerUser): enterprise customer user record
 
-        Returns None if:
-        * the user doesn't exist, or
-        * the associated EnterpriseCustomer has no identity_provider, or
-        * the remote identity is not found.
-        """
-        user = self.user
-        identity_provider = self.enterprise_customer.identity_provider
-        if user and identity_provider:
-            enterprise_worker = get_enterprise_worker_user()
-            client = ThirdPartyAuthApiClient(enterprise_worker)
-            return client.get_remote_id(self.enterprise_customer.identity_provider, user.username)
+    """
+    EnterpriseCustomerUser = apps.get_model('enterprise', 'EnterpriseCustomerUser')
+    try:
+        return EnterpriseCustomerUser.objects.get(
+            enterprise_customer__uuid=enterprise_uuid,
+            user_id=user_id
+        )
+    except EnterpriseCustomerUser.DoesNotExist:
         return None
 
-    def enroll(self, course_run_id, mode, cohort=None, source_slug=None, discount_percentage=0.0, sales_force_id=None):
-        """
-        Enroll a user into a course track, and register an enterprise course enrollment.
-        """
-        enrollment_api_client = EnrollmentApiClient()
-        # Check to see if the user's already enrolled and we have an enterprise course enrollment to track it.
-        course_enrollment = enrollment_api_client.get_course_enrollment(self.username, course_run_id) or {}
-        enrolled_in_course = course_enrollment and course_enrollment.get('is_active', False)
-
-        audit_modes = getattr(settings, 'ENTERPRISE_COURSE_ENROLLMENT_AUDIT_MODES', ['audit', 'honor'])
-        paid_modes = ['verified', 'professional']
-        is_upgrading = mode in paid_modes and course_enrollment.get('mode') in audit_modes
 
-        if enrolled_in_course and is_upgrading:
-            LOGGER.info(
-                "[Enroll] Trying to upgrade the enterprise user [{learner_id}] in course [{course_run_id}] in "
-                "[{mode}] mode".format(
-                    learner_id=self.id,
-                    course_run_id=course_run_id,
-                    mode=mode
-                )
-            )
-        if not enrolled_in_course:
-            LOGGER.info(
-                "[Enroll] Trying to enroll the enterprise user [{learner_id}] in course [{course_run_id}] in "
-                "[{mode}] mode".format(
-                    learner_id=self.id,
-                    course_run_id=course_run_id,
-                    mode=mode
-                )
-            )
+def get_course_track_selection_url(course_run, query_parameters):
+    """
+    Return track selection url for the given course.
 
-        if not enrolled_in_course or is_upgrading:
-            if cohort and not self.enterprise_customer.enable_autocohorting:
-                raise CourseEnrollmentPermissionError("Auto-cohorting is not enabled for this enterprise")
-
-            try:
-                enterprise_course_enrollment, created = EnterpriseCourseEnrollment.objects.get_or_create(
-                    enterprise_customer_user=self,
-                    course_id=course_run_id,
-                    defaults={
-                        'source': EnterpriseEnrollmentSource.get_source(source_slug)
-                    }
-                )
-            except IntegrityError:
-                # Added to try and fix ENT-2463. This can happen if the user is already a part of the enterprise
-                # because of the following:
-                # 1. (non-enterprise) CourseEnrollment data is created
-                # 2. An async task to is signaled to run after CourseEnrollment creation
-                #    (create_enterprise_enrollment_receiver)
-                # 3. Both async task and the code in the try block run `get_or_create` on
-                # `EnterpriseCourseEnrollment`
-                # 4. A race condition happens and it tries to create the same data twice
-                # Catching will allow us to continue and ensure we can still create an order for this enrollment.
-                LOGGER.exception("IntegrityError on attempt at EnterpriseCourseEnrollment for user with id [%s] "
-                                 "and course id [%s]", self.user_id, course_run_id)
-            # Directly enroll into the specified track.
-            # This should happen after we create the EnterpriseCourseEnrollment
-            succeeded = True
-            LOGGER.info(
-                "[Enroll] Calling LMS enrollment API for user [username] in course [course_run_id] in mode "
-                "[mode]".format(
-                    username=self.username,
-                    course_run_id=course_run_id,
-                    mode=mode
-                )
-            )
-            try:
-                enrollment_api_client.enroll_user_in_course(self.username, course_run_id, mode, cohort=cohort)
-            except HttpClientError as exc:
-                succeeded = False
-                if created:
-                    enterprise_course_enrollment.delete()
-                default_message = 'No error message provided'
-                try:
-                    error_message = json.loads(exc.content.decode()).get('message', default_message)
-                except ValueError:
-                    error_message = default_message
-                LOGGER.exception(
-                    'Error while enrolling user %(user)s: %(message)s',
-                    dict(user=self.user_id, message=error_message)
-                )
-            if succeeded:
-                utils.track_event(self.user_id, 'edx.bi.user.enterprise.enrollment.course', {
-                    'category': 'enterprise',
-                    'label': course_run_id,
-                    'enterprise_customer_uuid': str(self.enterprise_customer.uuid),
-                    'enterprise_customer_name': self.enterprise_customer.name,
-                    'mode': mode,
-                    'cohort': cohort,
-                    'is_upgrading': is_upgrading,
-                })
-                LOGGER.info(
-                    "[Enroll] LMS enrollment API succeeded for user [username] in course [course_run_id] in mode "
-                    "[mode]".format(
-                        username=self.username,
-                        course_run_id=course_run_id,
-                        mode=mode
-                    )
-                )
-                if mode in paid_modes:
-                    # create an ecommerce order for the course enrollment
-                    self.create_order_for_enrollment(course_run_id, discount_percentage, mode, sales_force_id)
-        elif enrolled_in_course and course_enrollment.get('mode') in paid_modes and mode in audit_modes:
-            # This enrollment is attempting to "downgrade" the user from a paid track they are already in.
-            raise CourseEnrollmentDowngradeError(
-                'The user is already enrolled in the course {course_run_id} in {current_mode} mode '
-                'and cannot be enrolled in {given_mode} mode'.format(
-                    course_run_id=course_run_id,
-                    current_mode=course_enrollment.get('mode'),
-                    given_mode=mode,
-                )
-            )
+    Arguments:
+        course_run (dict): A dictionary containing course run metadata.
+        query_parameters (dict): A dictionary containing query parameters to be added to course selection url.
 
-    def unenroll(self, course_run_id):
-        """
-        Unenroll a user from a course track.
-        """
-        enrollment_api_client = EnrollmentApiClient()
-        if enrollment_api_client.unenroll_user_from_course(self.username, course_run_id):
-            EnterpriseCourseEnrollment.objects.filter(enterprise_customer_user=self, course_id=course_run_id).delete()
-            return True
-        return False
+    Raises:
+        (KeyError): Raised when course run dict does not have 'key' key.
 
-    def update_session(self, request):
-        """
-        Update the session of a request for this learner.
-        """
-        request.session['enterprise_customer'] = self.enterprise_customer.serialized
+    Returns:
+        (str): Course track selection url.
 
-    def create_order_for_enrollment(self, course_run_id, discount_percentage, mode, sales_force_id):
-        """
-        Create an order on the Ecommerce side for tracking the course enrollment of a enterprise customer user.
-        """
-        LOGGER.info("Creating order for enterprise learner with id [%s] for enrollment in course with id: [%s], "
-                    "[percentage discount] [%s] and [sales_force_id] [%s]",
-                    self.user_id,
-                    course_run_id,
-                    discount_percentage,
-                    sales_force_id)
-        # get instance of the EcommerceApiClient and attempt to create order
-        ecommerce_service_worker = get_ecommerce_worker_user()
-        failure_log_msg = 'Could not create order for enterprise learner with id [%s] for enrollment in course with ' \
-                          'id [%s]. Reason: [%s]'
-        if ecommerce_service_worker is not None:
-            try:
-                ecommerce_api_client = EcommerceApiClient(ecommerce_service_worker)
-            except NotConnectedToOpenEdX as exc:
-                LOGGER.exception(failure_log_msg, self.user_id, course_run_id, str(exc))
-            else:
-                # pull data needed for creating the order
-                course_enrollments = [{
-                    'lms_user_id': self.user_id,
-                    'username': self.username,
-                    'email': self.user_email,
-                    'course_run_key': course_run_id,
-                    'mode': mode,
-                    "enterprise_customer_name": self.enterprise_customer.name,
-                    "enterprise_customer_uuid": str(self.enterprise_customer.uuid),
-                    "discount_percentage": float(discount_percentage),
-                    "sales_force_id": sales_force_id,
-                }]
-                ecommerce_api_client.create_manual_enrollment_orders(course_enrollments)
-        else:
-            LOGGER.warning(failure_log_msg, self.user_id, course_run_id, 'Failed to retrieve a valid ecommerce worker.')
+    """
+    try:
+        course_root = reverse('course_modes_choose', kwargs={'course_id': course_run['key']})
+    except KeyError:
+        LOGGER.exception(
+            "KeyError while parsing course run data.\nCourse Run: \n[%s]", course_run,
+        )
+        raise
 
-    @classmethod
-    def inactivate_other_customers(cls, user_id, enterprise_customer):
-        """
-        Inactive all the enterprise customers of given user except the given enterprise_customer.
-        """
-        EnterpriseCustomerUser.objects.filter(
-            user_id=user_id
-        ).exclude(enterprise_customer=enterprise_customer).update(active=False)
+    url = '{}{}'.format(
+        settings.LMS_ROOT_URL,
+        course_root
+    )
+    course_run_url = update_query_parameters(url, query_parameters)
+
+    return course_run_url
 
 
-@python_2_unicode_compatible
-class PendingEnterpriseCustomerUser(TimeStampedModel):
-    # pylint: disable=line-too-long
+def update_query_parameters(url, query_parameters):
     """
-    Model that stores "future members" of enterprise customer.
+    Return url with updated query parameters.
 
-    Fields:
-        enterprise_customer (ForeignKey[:class:`.EnterpriseCustomer`]): enterprise customer
-        user_email (:class:`django.db.models.EmailField`): user email
+    Arguments:
+        url (str): Original url whose query parameters need to be updated.
+        query_parameters (dict): A dictionary containing query parameters to be added to course selection url.
 
-    .. pii: The user_email field contains PII, but locally deleted via enterprise.signals.handle_user_post_save when the learner registers a new account.  As an additional safety measure, we also delete this row (if found) during user retirement.
-    .. pii_types: email_address
-    .. pii_retirement: local_api, consumer_api
-    """  # pylint: enable=line-too-long
+    Returns:
+        (slug): slug identifier for the identity provider that can be used for identity verification of
+            users associated the enterprise customer of the given user.
 
-    enterprise_customer = models.ForeignKey(EnterpriseCustomer, blank=False, null=False, on_delete=models.CASCADE)
-    user_email = models.EmailField(null=False, blank=False, unique=True)
-    history = HistoricalRecords()
+    """
+    scheme, netloc, path, query_string, fragment = urlsplit(url)
+    url_params = parse_qs(query_string)
 
-    class Meta:
-        app_label = 'enterprise'
-        ordering = ['created']
+    # Update url query parameters
+    url_params.update(query_parameters)
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<PendingEnterpriseCustomerUser {ID}>: {enterprise_name} - {user_email}".format(
-            ID=self.id,
-            enterprise_name=self.enterprise_customer.name,
-            user_email=self.user_email,
-        )
-
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    return urlunsplit(
+        (scheme, netloc, path, urlencode(sorted(url_params.items()), doseq=True), fragment),
+    )
 
 
-@python_2_unicode_compatible
-class EnterpriseEnrollmentSource(TimeStampedModel):
+def filter_audit_course_modes(enterprise_customer, course_modes):
     """
-    Define a Name and Source for all Enterprise Enrollment Sources.
+    Filter audit course modes out if the enterprise customer has not enabled the 'Enable audit enrollment' flag.
+
+    Arguments:
+        enterprise_customer: The EnterpriseCustomer that the enrollment was created using.
+        course_modes: iterable with dictionaries containing a required 'mode' key
 
-    .. no_pii:
     """
+    audit_modes = getattr(settings, 'ENTERPRISE_COURSE_ENROLLMENT_AUDIT_MODES', ['audit'])
+    if not enterprise_customer.enable_audit_enrollment:
+        return [course_mode for course_mode in course_modes if course_mode['mode'] not in audit_modes]
+    return course_modes
 
-    MANUAL = 'manual'
-    API = 'enterprise_api'
-    ENROLLMENT_URL = 'enrollment_url'
-    OFFER_REDEMPTION = 'offer_redemption'
-    ENROLLMENT_TASK = 'enrollment_task'
-    MANAGEMENT_COMMAND = 'management_command'
 
-    name = models.CharField(max_length=64)
-    slug = models.SlugField(max_length=30, unique=True)
+def get_enterprise_customer_or_404(enterprise_uuid):
+    """
+    Given an EnterpriseCustomer UUID, return the corresponding EnterpriseCustomer or raise a 404.
 
-    @classmethod
-    def get_source(cls, source_slug):
-        """
-        Retrieve the source based on the Slug provided.
-        """
-        try:
-            return cls.objects.get(slug=source_slug)
-        except EnterpriseEnrollmentSource.DoesNotExist:
-            return None
+    Arguments:
+        enterprise_uuid (str): The UUID (in string form) of the EnterpriseCustomer to fetch.
 
-    def __str__(self):
-        """
-        Create string representation of the source.
-        """
-        return "Enrollment Source: {name}, Slug: {slug}".format(name=self.name, slug=self.slug)
+    Returns:
+        (EnterpriseCustomer): The EnterpriseCustomer given the UUID.
+
+    """
+    EnterpriseCustomer = enterprise_customer_model()
+    try:
+        enterprise_uuid = UUID(enterprise_uuid)
+        return EnterpriseCustomer.objects.get(uuid=enterprise_uuid)
+    except (TypeError, ValueError, EnterpriseCustomer.DoesNotExist) as no_customer_error:
+        LOGGER.error('Unable to find enterprise customer for UUID: [%s]', enterprise_uuid)
+        raise Http404 from no_customer_error
 
 
-@python_2_unicode_compatible
-class PendingEnrollment(TimeStampedModel):
+def get_enterprise_customer_by_slug_or_404(slug):
     """
-    Track future enrollments for PendingEnterpriseCustomerUser.
+    Given an EnterpriseCustomer slug, return the corresponding EnterpriseCustomer or raise a 404.
 
-    Store a course ID, an intended enrollment mode, and a link to a PendingEnterpriseCustomerUser;
-    when the PendingEnterpriseCustomerUser is converted to a full EnterpriseCustomerUser, API
-    calls will be made to enroll the newly-created user in whatever courses have been added.
+    Arguments:
+        slug (str): The unique slug (a string) identifying the customer.
 
-    .. no_pii:
+    Returns:
+        (EnterpriseCustomer): The EnterpriseCustomer given the slug.
     """
+    return get_object_or_404(
+        enterprise_customer_model(),
+        slug=slug,
+    )
 
-    user = models.ForeignKey(PendingEnterpriseCustomerUser, null=False, on_delete=models.deletion.CASCADE)
-    course_id = models.CharField(max_length=255, blank=False,)
-    course_mode = models.CharField(max_length=25, blank=False)
-    cohort_name = models.CharField(max_length=255, blank=True, null=True)
-    discount_percentage = models.DecimalField(default=0.0, max_digits=8, decimal_places=5)
-    sales_force_id = models.CharField(max_length=255, blank=True, null=True)
-    history = HistoricalRecords()
-    source = models.ForeignKey(EnterpriseEnrollmentSource, blank=False, null=True, on_delete=models.SET_NULL)
 
-    class Meta:
-        app_label = 'enterprise'
-        unique_together = (("user", "course_id"),)
-        ordering = ['created']
+def get_enterprise_customer_by_invite_key_or_404(invite_key_uuid):
+    """
+    Given an EnterpriseCustomerInviteKey UUID, return the corresponding EnterpriseCustomer or raise a 404.
 
-    def __str__(self):
-        """
-        Create string representation of the enrollment.
-        """
-        return '<PendingEnrollment for email {} in course with ID {}>'.format(self.user.user_email, self.course_id)
+    Arguments:
+        invite_key_uuid (str): The UUID identifying an EnterpriseCustomerInviteKey.
 
-    def __repr__(self):
-        """
-        Return string representation of the enrollment.
-        """
-        return self.__str__()
+    Returns:
+        (EnterpriseCustomer): The EnterpriseCustomer given the EnterpriseCustomerInviteKey UUID.
+    """
+    customer_invite_key = get_object_or_404(
+        enterprise_customer_invite_key_model(),
+        uuid=invite_key_uuid,
+    )
+    return customer_invite_key.enterprise_customer
 
 
-def logo_path(instance, filename):
+def clean_html_for_template_rendering(text):
     """
-    Delete the file if it already exist and returns the enterprise customer logo image path.
+    Given html text that will be rendered as a variable in a template, strip out characters that impact rendering.
 
     Arguments:
-        instance (:class:`.EnterpriseCustomerBrandingConfiguration`): EnterpriseCustomerBrandingConfiguration object
-        filename (str): file to upload
+        text (str): The text to clean.
 
     Returns:
-        path: path of image file e.g. enterprise/branding/<model.id>/<model_id>_logo.<ext>.lower()
+        (str): The cleaned text.
+    """
+    # Sometimes there are random new lines between tags that don't render nicely.
+    return text.replace('>\\n<', '><')
 
+
+def get_cache_key(**kwargs):
     """
-    extension = os.path.splitext(filename)[1].lower()
-    instance_id = str(instance.id)
-    fullname = os.path.join("enterprise/branding/", instance_id, instance_id + "_logo" + extension)
-    if default_storage.exists(fullname):
-        default_storage.delete(fullname)
-    return fullname
+    Wrapper method on edx_django_utils get_cache_key utility.
+    """
+    return get_django_cache_key(**kwargs)
 
 
-@python_2_unicode_compatible
-class EnterpriseCustomerBrandingConfiguration(TimeStampedModel):
+def traverse_pagination(response, client, api_url):
     """
-    Model that keeps track of enterprise branding configurations e.g. enterprise customer logo.
+    Traverse a paginated API response.
 
-    Fields:
-        enterprise_customer (ForeignKey[EnterpriseCustomer]): enterprise customer
-        logo (ImageField): enterprise customer image
-
-    .. no_pii:
-    """
-
-    enterprise_customer = models.OneToOneField(
-        EnterpriseCustomer,
-        blank=False,
-        null=False,
-        related_name="branding_configuration",
-        on_delete=models.deletion.CASCADE
-    )
-    logo = models.ImageField(
-        upload_to=logo_path,
-        help_text=_(u"Logo images must be in .png format."),
-        null=True, blank=True, max_length=255,
-        validators=[validate_image_extension, validate_image_size]
-    )
-    primary_color = models.CharField(
-        null=True,
-        blank=True,
-        max_length=7,
-        validators=[validate_hex_color],
-    )
-    secondary_color = models.CharField(
-        null=True,
-        blank=True,
-        max_length=7,
-        validators=[validate_hex_color],
-    )
-    tertiary_color = models.CharField(
-        null=True,
-        blank=True,
-        max_length=7,
-        validators=[validate_hex_color],
-    )
-
-    class Meta:
-        """Meta class for this Django model."""
-
-        app_label = 'enterprise'
-        verbose_name = _("Branding Configuration")
-        verbose_name_plural = _("Branding Configurations")
-        ordering = ['created']
+    Extracts and concatenates "results" (list of dict) returned by DRF-powered
+    APIs.
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<EnterpriseCustomerBrandingConfiguration {ID}>: {enterprise_name}".format(
-            ID=self.id,
-            enterprise_name=self.enterprise_customer.name,
-        )
+    Arguments:
+        response (Dict): Current response dict from service API;
+        client (requests.Session): either the OAuthAPIClient (from edx_rest_api_client) or requests.Session object;
+        api_url (str): API endpoint URL to call.
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    Returns:
+        list of dict.
 
-    @property
-    def safe_logo_url(self):
-        """
-        Returns an absolute URL for the branding configuration logo OR the platform logo absolute URL
-        """
-        if not self.logo:
-            return get_platform_logo_url()
+    """
+    results = response.get('results', [])
 
-        # AWS S3 storage is used in stage/production environments but file system
-        # storage is used in devstack environment
-        if settings.DEFAULT_FILE_STORAGE == 'storages.backends.s3boto.S3BotoStorage':
-            media_base_url = 'https://' + settings.AWS_S3_CUSTOM_DOMAIN
-        else:
-            media_base_url = settings.LMS_ROOT_URL + settings.MEDIA_URL
+    next_page = response.get('next')
+    while next_page:
+        querystring = parse_qs(urlparse(next_page).query, keep_blank_values=True)
+        response = client.get(api_url, params=querystring)
+        response.raise_for_status()
+        response = response.json()
+        results += response.get('results', [])
+        next_page = response.get('next')
 
-        return urljoin(
-            media_base_url,
-            str(self.logo)
-        )
+    return results
 
 
-@python_2_unicode_compatible
-class EnterpriseCustomerIdentityProvider(TimeStampedModel):
+def ungettext_min_max(singular, plural, range_text, min_val, max_val):
     """
-    EnterpriseCustomerIdentityProvider is a One to One relationship between Enterprise Customer and Identity Provider.
+    Return grammatically correct, translated text based off of a minimum and maximum value.
+
+    Example:
+        min = 1, max = 1, singular = '{} hour required for this course', plural = '{} hours required for this course'
+        output = '1 hour required for this course'
+
+        min = 2, max = 2, singular = '{} hour required for this course', plural = '{} hours required for this course'
+        output = '2 hours required for this course'
 
-    There should be a link between an enterprise customer and its Identity Provider. This relationship has
-    following constraints
-        1. An enterprise customer may or may not have an identity provider.
-        2. An enterprise customer can not have more than one identity providers.
-        3. Enterprise customer site should match with identity provider's site. (i.e. same domain names)
+        min = 2, max = 4, range_text = '{}-{} hours required for this course'
+        output = '2-4 hours required for this course'
 
-    Fields:
-        enterprise_customer (ForeignKey[EnterpriseCustomer]): enterprise customer
-        provider_id (:class:`django.db.models.SlugField`): The provider_id string of the identity provider.
+        min = None, max = 2, plural = '{} hours required for this course'
+        output = '2 hours required for this course'
 
-    .. no_pii:
+    Expects ``range_text`` to already have a translation function called on it.
+
+    Returns:
+        ``None`` if both of the input values are ``None``.
+        ``singular`` formatted if both are equal or one of the inputs, but not both, are ``None``, and the value is 1.
+        ``plural`` formatted if both are equal or one of its inputs, but not both, are ``None``, and the value is > 1.
+        ``range_text`` formatted if min != max and both are valid values.
     """
+    if min_val is None and max_val is None:
+        return None
+    if min_val == max_val or min_val is None or max_val is None:
+        # pylint: disable=translation-of-non-string
+        return ngettext(singular, plural, min_val or max_val).format(min_val or max_val)
+    return range_text.format(min_val, max_val)
 
-    enterprise_customer = models.OneToOneField(
-        EnterpriseCustomer,
-        blank=False,
-        null=False,
-        related_name="enterprise_customer_identity_provider", on_delete=models.CASCADE
-    )
-    provider_id = models.SlugField(
-        null=False,
-        blank=False,
-        unique=True,
-        help_text="Slug field containing a unique identifier for the identity provider.",
-    )
 
-    class Meta:
-        app_label = 'enterprise'
-        ordering = ['created']
+def format_price(price, currency='$'):
+    """
+    Format the price to have the appropriate currency and digits..
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<EnterpriseCustomerIdentityProvider {provider_id}>: {enterprise_name}".format(
-            provider_id=self.provider_id,
-            enterprise_name=self.enterprise_customer.name,
-        )
+    :param price: The price amount.
+    :param currency: The currency for the price.
+    :return: A formatted price string, i.e. '$10', '$10.52'.
+    """
+    if int(price) == price:
+        return '{}{}'.format(currency, int(price))
+    return '{}{:0.2f}'.format(currency, price)
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
 
-    @property
-    def identity_provider(self):
-        """
-        Associated identity provider instance.
-        """
-        identity_provider = utils.get_identity_provider(self.provider_id)
-        return identity_provider
+def get_configuration_value_for_site(site, key, default=None):
+    """
+    Get the site configuration value for a key, unless a site configuration does not exist for that site.
 
-    @property
-    def provider_name(self):
-        """
-        Readable name for the identity provider.
-        """
-        identity_provider = self.identity_provider
-        return identity_provider and identity_provider.name
+    Useful for testing when no Site Configuration exists in edx-enterprise or if a site in LMS doesn't have
+    a configuration tied to it.
 
-    @property
-    def sync_learner_profile_data(self):
-        """
-        Return bool indicating if data received from the identity provider shoudl be synced to the edX profile.
-        """
-        identity_provider = self.identity_provider
-        return identity_provider is not None and identity_provider.sync_learner_profile_data
+    :param site: A Site model object
+    :param key: The name of the value to retrieve
+    :param default: The default response if there's no key in site config or settings
+    :return: The value located at that key in the site configuration or settings file.
+    """
+    if hasattr(site, 'configuration'):
+        return site.configuration.get_value(key, default)
+    return default
 
 
-class EnterpriseCourseEnrollmentManager(models.Manager):
+def get_configuration_value(val_name, default=None, **kwargs):
     """
-    Model manager for `EnterpriseCourseEnrollment`.
+    Get a configuration value, or fall back to ``default`` if it doesn't exist.
+
+    Also takes a `type` argument to guide which particular upstream method to
+    use when trying to retrieve a value.  Current types include:
+
+        - `url` to specifically get a URL.
     """
+    if kwargs.get('type') == 'url':
+        return get_url(val_name) or default if callable(get_url) else default
+    return configuration_helpers.get_value(val_name, default, **kwargs) if configuration_helpers else default
 
-    def get_queryset(self):
-        """
-        Override to return only those enrollment records for which learner is linked to an enterprise.
-        """
-        return super(
-            EnterpriseCourseEnrollmentManager, self
-        ).get_queryset().select_related('enterprise_customer_user').filter(enterprise_customer_user__linked=True)
 
+def get_request_value(request, key, default=None):
+    """
+    Get the value in the request, either through query parameters or posted data, from a key.
 
-@python_2_unicode_compatible
-class EnterpriseCourseEnrollment(TimeStampedModel):
+    :param request: The request from which the value should be gotten.
+    :param key: The key to use to get the desired value.
+    :param default: The backup value to use in case the input key cannot help us get the value.
+    :return: The value we're looking for.
     """
-    Store information about the enrollment of a user in a course.
+    if request.method in ['GET', 'DELETE']:
+        return request.query_params.get(key, request.data.get(key, default))
+    return request.data.get(key, request.query_params.get(key, default))
 
-    This model is the central source of truth for information about
-    whether a particular user, linked to a particular EnterpriseCustomer,
-    has been enrolled in a course, and is the repository for any other
-    relevant metadata about such an enrollment.
 
-    .. no_pii:
+def get_program_type_description(program_type):
     """
+    Get the pre-set description associated with this program type.
 
-    objects = EnterpriseCourseEnrollmentManager()
+    :param program_type: The type of the program. Should be one of:
 
-    class Meta:
-        unique_together = (('enterprise_customer_user', 'course_id',),)
-        app_label = 'enterprise'
-        ordering = ['created']
+    * "MicroMasters Certificate"
+    * "Professional Certificate"
+    * "XSeries Certificate"
 
-    enterprise_customer_user = models.ForeignKey(
-        EnterpriseCustomerUser,
-        blank=False,
-        null=False,
-        related_name='enterprise_enrollments',
-        on_delete=models.deletion.CASCADE,
-        help_text=_(
-            "The enterprise learner to which this enrollment is attached."
-        )
-    )
-    course_id = models.CharField(
-        max_length=255,
-        blank=False,
-        help_text=_(
-            "The ID of the course in which the learner was enrolled."
-        )
-    )
-    saved_for_later = models.BooleanField(
-        default=False,
-        blank=False,
-        help_text=_(
-            "Specifies whether a user marked this course as saved for later in the learner portal."
-        )
-    )
-    history = HistoricalRecords()
-    source = models.ForeignKey(
-        EnterpriseEnrollmentSource,
-        blank=False,
-        null=True,
-        on_delete=models.SET_NULL
-    )
+    :return: The description associated with the program type. If none exists, then the empty string.
+    """
+    return PROGRAM_TYPE_DESCRIPTION.get(program_type, '')
 
-    @property
-    def audit_reporting_disabled(self):
-        """
-        Specify whether audit track data reporting is disabled for this enrollment.
 
-        * If the enterprise customer associated with this enrollment enables audit track data reporting,
-          simply return False.
-        * If the enterprise customer associated with this enrollment does not enable audit track data reporting,
-          return True if we are dealing with an audit enrollment, and False otherwise.
+def get_enterprise_utm_context(enterprise_customer):
+    """
+    Get the UTM context for the enterprise.
+    """
+    return {
+        'utm_medium': 'enterprise',
+        'utm_source': slugify(enterprise_customer.name)
+    }
 
-        :return: True if audit track data reporting is disabled, False otherwise.
-        """
-        if not self.enterprise_customer_user.enterprise_customer.enables_audit_data_reporting:
-            return self.is_audit_enrollment
 
-        # Since audit data reporting is enabled, we always return False here.
-        return False
+def track_event(user_id, event_name, properties):
+    """
+    Emit a track event to segment (and forwarded to GA) for some parts of the Enterprise workflows.
+    """
+    # Only call the endpoint if the import was successful.
+    if segment:
+        segment.track(user_id, event_name, properties)
 
-    @property
-    def is_audit_enrollment(self):
-        """
-        Specify whether the course enrollment associated with this ``EnterpriseCourseEnrollment`` is in audit mode.
 
-        :return: Whether the course enrollment mode is of an audit type.
-        """
-        course_enrollment_api = EnrollmentApiClient()
-        course_enrollment = course_enrollment_api.get_course_enrollment(
-            self.enterprise_customer_user.username,
-            self.course_id
-        )
-        audit_modes = getattr(settings, 'ENTERPRISE_COURSE_ENROLLMENT_AUDIT_MODES', ['audit', 'honor'])
-        return course_enrollment and course_enrollment.get('mode') in audit_modes
+def track_enrollment(pathway, user_id, course_run_id, url_path=None):
+    """
+    Emit a track event for enterprise course enrollment.
+    """
+    track_event(user_id, 'edx.bi.user.enterprise.onboarding', {
+        'pathway': pathway,
+        'url_path': url_path,
+        'course_run_id': course_run_id,
+    })
 
-    @property
-    def license(self):
-        """
-        Returns the license associated with this enterprise course enrollment if one exists.
-        """
-        try:
-            associated_license = self.licensed_with  # pylint: disable=no-member
-        except LicensedEnterpriseCourseEnrollment.DoesNotExist:
-            associated_license = None
-        return associated_license
 
-    @classmethod
-    def get_enterprise_course_enrollment_id(cls, user, course_id, enterprise_customer):
-        """
-        Return the EnterpriseCourseEnrollment object for a given user in given course_id.
-        """
-        enterprise_course_enrollment_id = None
-        try:
-            enterprise_course_enrollment_id = cls.objects.get(
-                enterprise_customer_user=EnterpriseCustomerUser.objects.get(
-                    enterprise_customer=enterprise_customer,
-                    user_id=user.id
-                ),
-                course_id=course_id
-            ).id
-        except ObjectDoesNotExist:
-            LOGGER.info(
-                'EnterpriseCourseEnrollment entry not found for user: {username}, course: {course_id}, '
-                'enterprise_customer: {enterprise_customer_name}'.format(
-                    username=user.username,
-                    course_id=course_id,
-                    enterprise_customer_name=enterprise_customer.name
-                )
-            )
-        return enterprise_course_enrollment_id
+def track_enterprise_user_linked(user_id, enterprise_customer_key, enterprise_customer_id, created_new_ent_user):
+    """
+    Emit a track event when user is linked to an enterprise
+    """
+    track_event(user_id, 'edx.bi.user.enterprise.onboarding', {
+        'pathway': 'enterprise-user-linked',
+        'enterprise_customer_key': enterprise_customer_key,
+        'enterprise_customer_id': enterprise_customer_id,
+        'created_new_enterprise_user': created_new_ent_user,
+    })
 
-    def __str__(self):
-        """
-        Create string representation of the enrollment.
-        """
-        return '<EnterpriseCourseEnrollment for user {} in course with ID {}>'.format(
-            self.enterprise_customer_user.user.username,
-            self.course_id
-        )
 
-    def __repr__(self):
-        """
-        Return string representation of the enrollment.
-        """
-        return self.__str__()
+def parse_datetime_handle_invalid(datetime_value):
+    """
+    Return the parsed version of a datetime string. If the string is invalid, return None.
+    """
+    if not datetime_value:
+        return None
+    try:
+        if not isinstance(datetime_value, datetime.datetime):
+            datetime_value = parse_datetime(datetime_value)
+        if not datetime_value:
+            return None
+        return datetime_value.replace(tzinfo=pytz.UTC)
+    except TypeError:
+        return None
 
 
-class LicensedEnterpriseCourseEnrollment(TimeStampedModel):
+def get_advertised_course_run(course):
+    """
+    Find the advertised course run for a given course
+    Arguments:
+        course (dict): course dict
+    Returns:
+        dict: a course_run or None
     """
-    An Enterprise Course Enrollment that is enrolled via a license.
+    advertised_course_run_uuid = course.get('advertised_course_run_uuid')
+    if advertised_course_run_uuid:
+        for course_run in course.get('course_runs', []):
+            if advertised_course_run_uuid == course_run.get('uuid'):
+                return course_run
+    return None
 
-    .. no_pii:
+
+def is_course_run_active(course_run):
     """
+    Checks whether a course run is active. That is, whether the course run is published,
+    enrollable, and marketable.
+    Arguments:
+        course_run (dict): The metadata about a course run.
+    Returns:
+        bool: True if course run is "active"
+    """
+    is_published = is_course_run_published(course_run)
+    is_enrollable = course_run.get('is_enrollable', False)
+    is_marketable = course_run.get('is_marketable', False)
 
-    license_uuid = models.UUIDField(
-        primary_key=False,
-        editable=False,
-        null=False
-    )
+    return is_published and is_enrollable and is_marketable
 
-    enterprise_course_enrollment = models.OneToOneField(
-        EnterpriseCourseEnrollment,
-        blank=False,
-        null=False,
-        related_name='licensed_with',
-        on_delete=models.deletion.CASCADE,
-        help_text=_(
-            "The course enrollment the associated license is for."
-        )
-    )
 
-    is_revoked = models.BooleanField(
-        default=False,
-        help_text=_(
-            "Whether the licensed enterprise course enrollment is revoked, e.g., when a user's license is revoked."
+def get_course_run_duration_info(course_run):
+    """
+    Return course run's duration(str) info.
+    """
+    duration_info = ''
+    min_effort = course_run.get('min_effort')
+    max_effort = course_run.get('max_effort')
+    weeks_to_complete = course_run.get('weeks_to_complete')
+    if min_effort and max_effort and weeks_to_complete:
+        duration_info = "{min_effort}-{max_effort} hours a week for {weeks_to_complete} weeks. ".format(
+            min_effort=str(min_effort),
+            max_effort=str(max_effort),
+            weeks_to_complete=str(weeks_to_complete)
         )
-    )
+    return duration_info
 
-    history = HistoricalRecords()
 
-    @classmethod
-    def enrollments_for_user(cls, enterprise_customer_user):
-        """
-        Returns a QuerySet of LicensedEnterpriseCourseEnrollments, along with their associated (hydrated)
-        enterprise enrollments, users, and customers.
-        """
-        return cls.objects.filter(
-            enterprise_course_enrollment__enterprise_customer_user=enterprise_customer_user
-        ).select_related(
-            'enterprise_course_enrollment',
-            'enterprise_course_enrollment__enterprise_customer_user',
-            'enterprise_course_enrollment__enterprise_customer_user__enterprise_customer',
-        )
+def get_duration_of_course_or_courserun(content_metadata_item):
+    """
+    Returns duration start, end dates given a piece of content_metadata item
+    If course item, extracts start, end dates of closest course run based on current timestamp
 
-    def revoke(self):
-        """
-        Marks this object as revoked and marks the associated EnterpriseCourseEnrollment
-        as "saved for later".  This object and the associated EnterpriseCourseEnrollment are both saved.
-        """
-        self.is_revoked = True
-        self.enterprise_course_enrollment.saved_for_later = True
-        self.enterprise_course_enrollment.save()
-        self.save()
-
-
-@python_2_unicode_compatible
-class EnterpriseCatalogQuery(TimeStampedModel):
-    """
-    Stores a re-usable catalog query.
-
-    This stored catalog query used in `EnterpriseCustomerCatalog` objects to build catalog's content_filter field.
-    This is a saved instance of `content_filter` that can be re-used accross different catalogs.
-
-    .. no_pii:
-    """
-
-    title = models.CharField(
-        default='All Content',
-        max_length=255,
-        blank=False,
-        null=False
-    )
-    content_filter = JSONField(
-        default={},
-        blank=True,
-        null=True,
-        load_kwargs={'object_pairs_hook': collections.OrderedDict},
-        dump_kwargs={'indent': 4, 'cls': JSONEncoder, 'separators': (',', ':')},
-        help_text=_(
-            "Query parameters which will be used to filter the discovery service's search/all endpoint results, "
-            "specified as a JSON object. An empty JSON object means that all available content items will be "
-            "included in the catalog."
-        ),
-        validators=[validate_content_filter_fields]
-    )
-
-    class Meta:
-        verbose_name = _("Enterprise Catalog Query")
-        verbose_name_plural = _("Enterprise Catalog Queries")
-        app_label = 'enterprise'
-        ordering = ['created']
+    Returns:
+        duration: in days or 0
+        start: start field of closest course run item, or None
+        end: end field of closest course run item, or None
+    """
+    start = None
+    end = None
+    if content_metadata_item.get('content_type') == 'courserun':
+        start = content_metadata_item.get('start')
+        end = content_metadata_item.get('end')
+    elif content_metadata_item.get('content_type') == 'course':
+        course_runs = content_metadata_item.get('course_runs')
+        if course_runs:
+            course_run = get_closest_course_run(course_runs)
+            if course_run:
+                start = course_run.get('start')
+                end = course_run.get('end')
+    if not start:
+        return 0, None, None
+    start_date = parse_datetime_handle_invalid(start)
+    end_date = parse_datetime_handle_invalid(end)
+    if not start_date or not end_date:
+        return 0, None, None
+    return (end_date - start_date).days, start, end
+
+
+def is_course_run_enrollable(course_run):
+    """
+    Return true if the course run is enrollable, false otherwise.
+
+    We look for the following criteria:
+
+    1. end date is greater than a reasonably-defined enrollment window, or undefined.
+        A reasonably-defined enrollment window is 1 day before course run end date.
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<EnterpriseCatalogQuery '{title}' >".format(title=self.title)
+    2. enrollment_start is less than now, or undefined.
+
+    3. enrollment_end is greater than now, or undefined.
+    """
+    # Check if the course run is unpublished (sometimes these sneak through)
+    if not is_course_run_published(course_run):
+        return False
+
+    now = datetime.datetime.now(pytz.UTC)
+    reasonable_enrollment_window = now + datetime.timedelta(days=1)
+    end = parse_datetime_handle_invalid(course_run.get('end'))
+    enrollment_start = parse_datetime_handle_invalid(course_run.get('enrollment_start'))
+    enrollment_end = parse_datetime_handle_invalid(course_run.get('enrollment_end'))
+    return (not end or end > reasonable_enrollment_window) and \
+           (not enrollment_start or enrollment_start < now) and \
+           (not enrollment_end or enrollment_end > now)
 
 
-@python_2_unicode_compatible
-class EnterpriseCustomerCatalog(TimeStampedModel):
+def is_course_run_available_for_enrollment(course_run):
     """
-    Store catalog information from course discovery specifically for Enterprises.
+    Check if a course run is available for enrollment.
+    """
+    # If the course run is Archived, it's not available for enrollment
+    if course_run['availability'] not in ['Current', 'Starting Soon', 'Upcoming']:
+        return False
 
-    We use this model to consolidate course catalog information, which includes
-    information about catalogs, courses, programs, and possibly more in the
-    future, as the course discovery service evolves.
-
-    .. no_pii:
-    """
-
-    uuid = models.UUIDField(
-        primary_key=True,
-        default=uuid4,
-        editable=False
-    )
-    title = models.CharField(
-        default='All Content',
-        max_length=255,
-        blank=False,
-        null=False
-    )
-    enterprise_customer = models.ForeignKey(
-        EnterpriseCustomer,
-        blank=False,
-        null=False,
-        related_name='enterprise_customer_catalogs',
-        on_delete=models.deletion.CASCADE
-    )
-    sync_enterprise_catalog_query = models.BooleanField(
-        default=False
-    )
-    enterprise_catalog_query = models.ForeignKey(
-        EnterpriseCatalogQuery,
-        blank=True,
-        null=True,
-        related_name='enterprise_customer_catalogs',
-        on_delete=models.deletion.SET_NULL
-    )
-    content_filter = JSONField(
-        default={},
-        blank=True,
-        null=True,
-        load_kwargs={'object_pairs_hook': collections.OrderedDict},
-        dump_kwargs={'indent': 4, 'cls': JSONEncoder, 'separators': (',', ':')},
-        help_text=_(
-            "Query parameters which will be used to filter the discovery service's search/all endpoint results, "
-            "specified as a Json object. An empty Json object means that all available content items will be "
-            "included in the catalog."
-        ),
-        validators=[validate_content_filter_fields]
-    )
-    enabled_course_modes = JSONField(
-        default=json_serialized_course_modes,
-        help_text=_('Ordered list of enrollment modes which can be displayed to learners for course runs in'
-                    ' this catalog.'),
-    )
-    publish_audit_enrollment_urls = models.BooleanField(
-        default=False,
-        help_text=_(
-            "Specifies whether courses should be published with direct-to-audit enrollment URLs."
-        )
-    )
+    # If the course run is not "enrollable", it's not available for enrollment
+    if not is_course_run_enrollable(course_run):
+        return False
 
-    history = HistoricalRecords()
+    return True
 
-    class Meta:
-        verbose_name = _("Enterprise Customer Catalog")
-        verbose_name_plural = _("Enterprise Customer Catalogs")
-        app_label = 'enterprise'
-        ordering = ['created']
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return (
-            "<EnterpriseCustomerCatalog '{title}' "
-            "with UUID '{uuid}' "
-            "for EnterpriseCustomer {enterprise_customer_name}>".format(
-                title=self.title,
-                uuid=self.uuid,
-                enterprise_customer_name=self.enterprise_customer.name
-            )
-        )
+def has_course_run_available_for_enrollment(course_runs):
+    """
+        Iterates over all course runs to check if there any course run that is available for enrollment.
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    Argument:
+        course_runs: list of course runs
 
-    def get_content_filter(self):
-        """
-        Return content filter of the linked catalog query otherwise content filter of catalog itself.
-        """
-        return self.enterprise_catalog_query.content_filter if self.enterprise_catalog_query else self.content_filter
+    Returns:
+        True if found else false
+    """
+    for course_run in course_runs:
+        if is_course_run_available_for_enrollment(course_run):
+            return True
+    return False
 
-    @cached_property
-    def content_filter_ids(self):
-        """
-        Return the list of any content IDs specified in the catalog's content filter.
-        """
-        content_filter = self.get_content_filter()
-        return set(content_filter.get('key', []) + content_filter.get('uuid', []))
 
-    def get_paginated_content(self, query_parameters):
-        """
-        Return paginated discovery service search results without expired course runs.
+def get_last_course_run_end_date(course_runs):
+    """
+    Returns the end date of the course run that falls at the end.
+    """
+    latest_end_date = None
+    if course_runs:
+        try:
+            latest_end_date = max(course_run.get('end') for course_run in course_runs if
+                                  parse_datetime_handle_invalid(course_run.get('end')) is not None)
+        except ValueError:
+            latest_end_date = None
+    return latest_end_date
 
-        Arguments:
-            query_parameters (dict): Additional query parameters to add to the search API call, e.g. page.
-        Returns:
-            dict: The paginated discovery service search results.
-        """
-        query_params = query_parameters.copy()
-        # exclude_expired_course_run query_param is added to remove the expired course run
-        query_params["exclude_expired_course_run"] = True
-        results = []
-        content_filter_query = self.get_content_filter().copy()
-        catalog_client = get_course_catalog_api_service_client(self.enterprise_customer.site)
-        search_results = catalog_client.get_catalog_results(content_filter_query, query_params.dict())
-        for content in search_results['results']:
-            if content['content_type'] == 'courserun' and content['has_enrollable_seats']:
-                results.append(content)
-            elif content['content_type'] == 'course':
-                results.append(content)
-            elif content['content_type'] == 'program' and content['is_program_eligible_for_one_click_purchase']:
-                results.append(content)
-
-        response = {
-            'count': search_results['count'],
-            'next': search_results['next'],
-            'previous': search_results['previous'],
-            'results': results,
-        }
 
-        return response
+def is_course_run_upgradeable(course_run):
+    """
+    Return true if the course run has a verified seat with an unexpired upgrade deadline, false otherwise.
+    """
+    now = datetime.datetime.now(pytz.UTC)
+    for seat in course_run.get('seats', []):
+        if seat.get('type') == 'verified':
+            upgrade_deadline = parse_datetime_handle_invalid(seat.get('upgrade_deadline'))
+            return not upgrade_deadline or upgrade_deadline > now
+    return False
 
-    def _filter_members(self, content_id_field_name, content_id_values):
-        """
-        Filter the given list of content_id_values, returning only those that are members of the catalog.
 
-        A content ID is the unique identifier for a content metadata entity, e.g. course, course run, program.
+def is_course_run_published(course_run):
+    """
+    Return True if the course run's status value is "published".
+    """
+    if course_run:
+        if course_run.get('status') == 'published':
+            return True
+    return False
 
-        Arguments:
-            content_id_field_name (str): The name of the field on the catalog content item
-                                         that stores the item's unique identifier, e.g. "key", "uuid".
-            content_id_values (list): If provided, return only the content IDs that are members of this list
-                                      and members of the catalog.
 
-        Returns:
-            list: The list of content IDs that are members of the catalog.
-        """
-        updated_content_filter = self.get_content_filter().copy()
-        updated_content_filter[content_id_field_name] = content_id_values
-        response = get_course_catalog_api_service_client(self.enterprise_customer.site).get_catalog_results(
-            updated_content_filter,
-            traverse_pagination=True
-        )
-        results = response.get('results', [])
-        return {x[content_id_field_name] for x in results}
+def get_course_run_start(course_run, default=None):
+    """
+    Return the given course run's start date as a datetime.
+    """
+    return parse_datetime_handle_invalid(course_run.get('start')) or default
 
-    def contains_courses(self, content_ids):
-        """
-        Return True if this catalog contains the given courses else False.
 
-        The content_ids parameter should be a list containing course keys
-        and/or course run ids.
-        """
-        # Translate any provided course run IDs to course keys.
-        catalog_client = get_course_catalog_api_service_client(self.enterprise_customer.site)
-        course_keys = {catalog_client.get_course_id(k) for k in content_ids}
-
-        # Remove `None` from set of course_keys if present
-        course_keys = course_keys.difference({None})
-
-        content_ids_in_catalog = self.content_filter_ids
-        if not content_ids_in_catalog:
-            content_ids_in_catalog = self._filter_members('key', list(course_keys)) if course_keys else set()
-
-        return bool(
-            (content_ids and set(content_ids).issubset(content_ids_in_catalog)) or
-            (course_keys and course_keys.issubset(content_ids_in_catalog))
-        )
+def get_closest_course_run(course_runs):
+    """
+    Return course run with start date closest to now.
+    """
+    if len(course_runs) == 1:
+        return course_runs[0]
 
-    def contains_programs(self, program_uuids):
-        """
-        Return true if this catalog contains the given programs.
-        """
-        content_ids_in_catalog = self.content_filter_ids
-        if not content_ids_in_catalog:
-            content_ids_in_catalog = self._filter_members('uuid', program_uuids)
+    now = datetime.datetime.now(pytz.UTC)
+    # course runs with no start date should be considered last.
+    never = now - datetime.timedelta(days=3650)
+    return min(course_runs, key=lambda x: abs(get_course_run_start(x, never) - now))
 
-        return bool(program_uuids and set(program_uuids).issubset(content_ids_in_catalog))
 
-    def get_course(self, course_key):
-        """
-        Get all of the metadata for the given course.
+def get_active_course_runs(course, users_all_enrolled_courses):
+    """
+    Return active course runs (user is enrolled in) of the given course.
 
-        Arguments:
-            course_key (str): The course key which identifies the course.
+    This function will return the course_runs of 'course' which have
+    active enrollment by looking into 'users_all_enrolled_courses'
+    """
+    # User's all course_run ids in which he has enrolled.
+    enrolled_course_run_ids = [
+        enrolled_course_run['course_details']['course_id'] for enrolled_course_run in users_all_enrolled_courses
+        if enrolled_course_run['is_active'] and enrolled_course_run.get('course_details')
+    ]
+    return [course_run for course_run in course['course_runs'] if course_run['key'] in enrolled_course_run_ids]
 
-        Return:
-            dict: The course metadata.
-        """
-        if not EnterpriseCatalogApiClient().contains_content_items(self.uuid, [course_key]):
-            return None
 
-        return get_course_catalog_api_service_client(self.enterprise_customer.site).get_course_details(course_key)
+def is_course_run_about_to_end(current_course_run):
+    """
+    Return False if end - now > course run's weeks to complete otherwise True.
+    """
+    about_to_end = True
+    now = datetime.datetime.now(pytz.UTC)
+    if current_course_run:
+        end_date = parse_datetime_handle_invalid(current_course_run.get('end'))
+        weeks_to_complete = current_course_run.get('weeks_to_complete') or 0
+        if end_date and (end_date - now).days > weeks_to_complete * 7:
+            about_to_end = False
+    return about_to_end
 
-    def get_course_run(self, course_run_id):
-        """
-        Get all of the metadata for the given course run.
 
-        Arguments:
-            course_run_id (str): The course run key which identifies the course run.
+def get_current_course_run(course, users_active_course_runs):
+    """
+    Return the current course run on the following conditions:
 
-        Return:
-            dict: The course run metadata.
-        """
-        if not EnterpriseCatalogApiClient().contains_content_items(self.uuid, [course_run_id]):
-            return None
+    - If user has active course runs (already enrolled) then return course run with closest start date
 
-        return get_course_catalog_api_service_client(self.enterprise_customer.site).get_course_run(course_run_id)
+    Otherwise it will check the following logic:
 
-    def get_course_and_course_run(self, course_run_id):
-        """
-        Get course data and all of the metadata for the given course run.
+    - Course run is enrollable (see is_course_run_enrollable)
 
-        Arguments:
-            course_run_id (str): The course run key which identifies the course run.
+    - Course run has a verified seat and the upgrade deadline has not expired.
 
-        Returns:
-            tuple(course, course_run): The course and course run metadata.
+    - If no enrollable/upgradeable course runs, then select all the course runs.
 
-        Raises:
-            ImproperlyConfigured: Missing or invalid catalog integration.
+    - After filtering the course runs checks whether the filtered course run is about to close or not
+      if yes then return the next course run or the current one.
+    """
+    current_course_run = None
+    filtered_course_runs = []
+    all_course_runs = course['course_runs']
 
-        """
-        if not EnterpriseCatalogApiClient().contains_content_items(self.uuid, [course_run_id]):
-            return None, None
+    if users_active_course_runs:
+        current_course_run = get_closest_course_run(users_active_course_runs)
+    else:
+        for course_run in all_course_runs:
+            if is_course_run_enrollable(course_run) and is_course_run_upgradeable(course_run):
+                filtered_course_runs.append(course_run)
 
-        return get_course_catalog_api_service_client(
-            self.enterprise_customer.site
-        ).get_course_and_course_run(course_run_id)
+        if not filtered_course_runs:
+            # Consider all published runs if there were not any enrollable/upgradeable ones.
+            filtered_course_runs = [course_run for course_run in all_course_runs
+                                    if course_run['status'] == 'published']
 
-    def get_program(self, program_uuid):
-        """
-        Get all of the metadata for the given program.
+        if filtered_course_runs:
+            current_course_runs = [
+                course_run for course_run in filtered_course_runs if course_run['availability'] == 'Current'
+            ]
+            current_course_run = current_course_runs[0] if current_course_runs else None
+            if is_course_run_about_to_end(current_course_run):
+                starting_soon_course_runs = [
+                    course_run for course_run in filtered_course_runs if course_run['availability'] == 'Starting Soon'
+                ] or filtered_course_runs
+                current_course_run = get_closest_course_run(starting_soon_course_runs)
+    return current_course_run
 
-        Arguments:
-            program_uuid (str): The program UUID which identifies the program.
 
-        Return:
-            dict: The program metadata.
-        """
-        if not EnterpriseCatalogApiClient().contains_content_items(self.uuid, [program_uuid]):
-            return None
+def strip_html_tags(text, allowed_tags=None):
+    """
+    Strip all tags from a string except those tags provided in `allowed_tags` parameter.
 
-        return get_course_catalog_api_service_client(self.enterprise_customer.site).get_program_by_uuid(program_uuid)
+    Args:
+        text (str): string to strip html tags from
+        allowed_tags (list): allowed list of html tags
 
-    def get_course_enrollment_url(self, course_key):
-        """
-        Return enterprise course enrollment page url with the catalog information for the given course.
+    Returns: a string without html tags
+    """
+    if text is None:
+        return None
+    if allowed_tags is None:
+        allowed_tags = ALLOWED_TAGS
+    return bleach.clean(text, tags=allowed_tags, attributes=['id', 'class', 'style', 'href', 'title'], strip=True)
+
+
+def get_content_metadata_item_id(content_metadata_item):
+    """
+    Return the unique identifier given a content metadata item dictionary.
+    """
+    if content_metadata_item['content_type'] == 'program':
+        return content_metadata_item['uuid']
+    return content_metadata_item['key']
+
+
+def get_default_catalog_content_filter():
+    """
+    Return default enterprise customer catalog content filter.
+    """
+    return settings.ENTERPRISE_CUSTOMER_CATALOG_DEFAULT_CONTENT_FILTER or DEFAULT_CATALOG_CONTENT_FILTER
+
+
+def get_language_code(language):
+    """
+    Return IETF language tag of given language name.
+
+    - if language is not found in the language map then `en-US` is returned.
+
+    Args:
+        language (str): string language name
+
+    Returns: a language tag (two-letter language code - two letter country code if applicable)
+    """
+    language_map = {
+        "Afrikaans": "af",
+        "Arabic": "ar-AE",
+        "Belarusian": "be",
+        "Bulgarian": "bg-BG",
+        "Catalan": "ca",
+        "Czech": "cs-CZ",
+        "Danish": "da-DK",
+        "German": "de-DE",
+        "Greek": "el-GR",
+        "English": "en-US",
+        "Spanish": "es-ES",
+        "Estonian": "et",
+        "Basque (Basque)": "eu",
+        "Farsi": "fa",
+        "Finnish": "fi-FI",
+        "French": "fr-FR",
+        "Hebrew": "he-IL",
+        "Hindi": "hi",
+        "Croatian": "hr",
+        "Hungarian": "hu-HU",
+        "Indonesian": "id-ID",
+        "Icelandic": "is",
+        "Italian": "it-IT",
+        "Japanese": "ja-JP",
+        "Korean": "ko-KR",
+        "Lithuanian": "lt-LT",
+        "Malay": "ms-MY",
+        "Maltese": "mt",
+        "Dutch": "nl-NL",
+        "Norwegian": "nb-NO",
+        "Polish": "pl-PL",
+        "Portuguese": "pt-BR",
+        "Romanian": "ro-RO",
+        "Russian": "ru-RU",
+        "Sanskrit": "sa",
+        "Sorbian": "sb",
+        "Slovak": "sk-SK",
+        "Slovenian": "sl-SI",
+        "Swedish": "sv-SE",
+        "Swahili": "sw",
+        "Tamil": "ta",
+        "Thai": "th-TH",
+        "Turkish": "tr-TR",
+        "Tsonga": "ts",
+        "Tatar": "tt",
+        "Ukrainian": "uk",
+        "Urdu": "ur",
+        "Uzbek": "uz-UZ",
+        "Vietnamese": "vi",
+        "Xhosa": "xh",
+        "Yiddish": "yi",
+        "Chinese - Mandarin": "zh-CMN",
+        "Chinese - China": "zh-CN",
+        "Chinese - Simplified": "zh-Hans",
+        "Chinese - Traditional": "zh-Hant",
+        "Chinese - Hong Kong SAR": "zh-HK",
+        "Chinese - Macau SAR": "zh-MO",
+        "Chinese - Singapore": "zh-SG",
+        "Chinese - Taiwan": "zh-TW",
+        "Zulu": "zu",
+    }
+    return language_map.get(language, "en-US")
+
+
+def get_enterprise_worker_user():
+    """
+    Return the user object of enterprise worker user.
+    """
+    return _get_service_worker(settings.ENTERPRISE_SERVICE_WORKER_USERNAME)
+
+
+def get_ecommerce_worker_user():
+    """
+    Return the user object of ecommerce worker user.
+    """
+    return _get_service_worker(settings.ECOMMERCE_SERVICE_WORKER_USERNAME)
+
+
+def _get_service_worker(service_worker_username):
+    """
+    Retrieve the specified service worker object. If user cannot be found then returns None.
+    """
+    try:
+        return User.objects.get(username=service_worker_username)
+    except User.DoesNotExist:
+        return None
 
-        Arguments:
-            course_key (str): The course key for the course to be displayed.
 
-        Returns:
-            (str): Enterprise landing page url.
-        """
-        url = self.enterprise_customer.get_course_enrollment_url(course_key)
-        if self.publish_audit_enrollment_urls:
-            url = utils.update_query_parameters(url, {'audit': 'true'})
+def discovery_query_url(content_filter, html_format=True):
+    """
+    Return discovery url for preview.
+    """
+    if CatalogIntegration is None:
+        raise NotConnectedToOpenEdX(
+            _(
+                'To get a CatalogIntegration object, this package must be '
+                'installed in an Open edX environment.'
+            )
+        )
+    discovery_root_url = CatalogIntegration.current().get_internal_api_url()
+    disc_url = '{discovery_root_url}{search_all_endpoint}?{query_string}'.format(
+        discovery_root_url=discovery_root_url,
+        search_all_endpoint='search/all/',
+        query_string=urlencode(content_filter, doseq=True)
+    )
+    if html_format:
+        return format_html(
+            '<a href="{url}" target="_blank">Preview</a>',
+            url=disc_url
+        )
+    return disc_url
 
-        return utils.update_query_parameters(url, {'catalog': self.uuid})
 
-    def get_course_run_enrollment_url(self, course_run_key):
-        """
-        Return enterprise course enrollment page url with the catalog information for the given course.
+def delete_data_sharing_consent(course_id, customer_uuid, user_email):
+    """
+    Delete the DSC records from the DB for given learner, course and customer, also its cache.
+    """
+    # Deleting the DSC record.
+    user = User.objects.get(email=user_email)
+    enterprise_customer_user = get_enterprise_customer_user(user.id, customer_uuid)
+    enterprise_customer_user.data_sharing_consent_records.filter(course_id=course_id).delete()
 
-        Arguments:
-            course_run_key (str): The course run id for the course to be displayed.
+    # Deleting the DCS cache
+    consent_cache_key = get_cache_key(type='data_sharing_consent_needed', user_id=user.id, course_id=course_id)
+    TieredCache.delete_all_tiers(consent_cache_key)
 
-        Returns:
-            (str): Enterprise landing page url.
-        """
-        url = self.enterprise_customer.get_course_run_enrollment_url(course_run_key)
-        if self.publish_audit_enrollment_urls:
-            url = utils.update_query_parameters(url, {'audit': 'true'})
 
-        return utils.update_query_parameters(url, {'catalog': self.uuid})
+def validate_email_to_link(email, enterprise_customer, raw_email=None, message_template=None, raise_exception=True):
+    """
+    Validate email to be linked to Enterprise Customer.
 
-    def get_program_enrollment_url(self, program_uuid):
-        """
-        Return enterprise program enrollment page url with the catalog information for the given program.
+    Performs two checks:
+        * Checks that email is valid
+        * Checks that it is not already linked to the provided Enterprise Customer
 
-        Arguments:
-            program_uuid (str): The program UUID.
+    Arguments:
+        email (str): user email to link
+        enterprise_customer (EnterpriseCustomer): the enterprise customer to link the email to
+        raw_email (str): raw value as it was passed by user - used in error message.
+        message_template (str): Validation error template string.
+        raise_exception (bool): whether to raise an exception when an email is invalidated
 
-        Returns:
-            (str): Enterprise program landing page url.
-        """
-        url = self.enterprise_customer.get_program_enrollment_url(program_uuid)
-        if self.publish_audit_enrollment_urls:
-            url = utils.update_query_parameters(url, {'audit': 'true'})
+    Raises:
+        ValidationError: if email is invalid or already linked to Enterprise Customer.
 
-        return utils.update_query_parameters(url, {'catalog': self.uuid})
+    Returns:
+        bool: Whether or not there is an existing record with the same email address.
+    """
+    raw_email = raw_email if raw_email is not None else email
+    message_template = message_template if message_template is not None else ValidationMessages.INVALID_EMAIL
+    try:
+        validate_email(email)
+    except ValidationError as validation_error:
+        raise ValidationError(message_template.format(argument=raw_email)) from validation_error
+
+    existing_record = enterprise_customer_user_model().objects.get_link_by_email(email, enterprise_customer)
+    if existing_record and raise_exception:
+        raise ValidationError(ValidationMessages.USER_ALREADY_REGISTERED.format(
+            email=email, ec_name=existing_record.enterprise_customer.name
+        ))
+    return existing_record or False
+
+
+def get_idiff_list(list_a, list_b):
+    """
+    Returns a list containing lower case difference of list_b and list_a after case insensitive comparison.
+
+    Args:
+        list_a: list of strings
+        list_b: list of string
 
-    def save(self, *args, **kwargs):  # pylint: disable=arguments-differ
-        """
-        Saves this ``EnterpriseCatalogQuery``.
+    Returns:
+        List of unique lower case strings computed by subtracting list_b from list_a.
+    """
+    lower_list_a = [element.lower() for element in list_a]
+    lower_list_b = [element.lower() for element in list_b]
+    return list(set(lower_list_a) - set(lower_list_b))
 
-        Copies the ``content_filter`` of a related CatalogQuery into this
-        instance's ``content_filter`` if syncing is allowed.
-        """
-        if self.enterprise_catalog_query and self.sync_enterprise_catalog_query:
-            content_filter_from_query = self.enterprise_catalog_query.content_filter
-            self.content_filter = content_filter_from_query
-        super().save(*args, **kwargs)
-
-
-@python_2_unicode_compatible
-class EnrollmentNotificationEmailTemplate(TimeStampedModel):
-    """
-    Store optional templates to use when emailing users about course enrollment events.
-
-    .. no_pii:
-    """
-
-    class Meta:
-        app_label = 'enterprise'
-        ordering = ['created']
-
-    BODY_HELP_TEXT = mark_safe_lazy(_(
-        'Fill in a standard Django template that, when rendered, produces the email you want '
-        'sent to newly-enrolled Enterprise Customer learners. The following variables may be available:\n'
-        '<ul><li>user_name: A human-readable name for the person being emailed. Be sure to '
-        'handle the case where this is not defined, as it may be missing in some cases. '
-        'It may also be a username, if the learner hasn\'t configured their "real" name in the system.</li>'
-        '    <li>organization_name: The name of the organization sponsoring the enrollment.</li>'
-        '    <li>enrolled_in: Details of the course or program that was enrolled in. It may contain:'
-        '    <ul><li>name: The name of the enrollable item (e.g., "Demo Course").</li>'
-        '        <li>url: A link to the homepage of the enrolled-in item.</li>'
-        '        <li>branding: A custom branding name for the enrolled-in item. For example, '
-        'the branding of a MicroMasters program would be "MicroMasters".</li>'
-        '     <li>start: The date the enrolled-in item becomes available. Render this to text using the Django `date`'
-        ' template filter (see <a href="https://docs.djangoproject.com/en/1.8/ref/templates/'
-        'builtins/#date">the Django documentation</a>).</li>'
-        '<li>type: Whether the enrolled-in item is a course, a program, or something else.</li></ul></ul>'
-    ))
-
-    SUBJECT_HELP_TEXT = _(
-        'Enter a string that can be used to generate a dynamic subject line for notification emails. The '
-        'placeholder {course_name} will be replaced with the name of the course or program that was enrolled in.'
-    )
-
-    plaintext_template = models.TextField(blank=True, help_text=BODY_HELP_TEXT)
-    html_template = models.TextField(blank=True, help_text=BODY_HELP_TEXT)
-    subject_line = models.CharField(max_length=100, blank=True, help_text=SUBJECT_HELP_TEXT)
-    enterprise_customer = models.OneToOneField(
-        EnterpriseCustomer,
-        related_name="enterprise_enrollment_template",
-        on_delete=models.deletion.CASCADE
-    )
-    history = HistoricalRecords()
 
-    def render_html_template(self, kwargs):
-        """
-        Render just the HTML template and return it as a string.
-        """
-        return self.render_template(mark_safe(self.html_template), kwargs)
+def get_users_by_email(emails):
+    """
+    Accept a list of emails, and separate them into users that exist on OpenEdX and users who don't.
 
-    def render_plaintext_template(self, kwargs):
-        """
-        Render just the plaintext template and return it as a string.
-        """
-        return self.render_template(self.plaintext_template, kwargs)
+    Args:
+        emails: An iterable of email addresses to split between existing and nonexisting
 
-    def render_all_templates(self, kwargs):
-        """
-        Render both templates and return both.
-        """
-        return self.render_plaintext_template(kwargs), self.render_html_template(kwargs)
+    Returns:
+        users: Queryset of users who exist in the OpenEdX platform and who were in the list of email addresses
+        unregistered_emails: List of unique emails which were in the original list, but do not yet exist as users
+    """
+    users = User.objects.filter(email__in=emails)
+    present_emails = users.values_list('email', flat=True)
+    unregistered_emails = get_idiff_list(emails, present_emails)
+    return users, unregistered_emails
 
-    def render_template(self, template_text, kwargs):
-        """
-        Create a template from the DB-backed text and render it.
-        """
-        template = Template(template_text)
-        context = Context(kwargs)
-        return template.render(context)
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return '<EnrollmentNotificationEmailTemplate for EnterpriseCustomer with UUID {}>'.format(
-            self.enterprise_customer.uuid
-        )
+def is_user_enrolled(user, course_id, course_mode, enrollment_client=None):
+    """
+    Query the enrollment API and determine if a learner is enrolled in a given course run track.
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    Args:
+        user: The user whose enrollment needs to be checked
+        course_mode: The mode with which the enrollment should be checked
+        course_id: course id of the course where enrollment should be checked.
+        enrollment_client: An optional EnrollmentAPIClient if it's already been instantiated and should be passed in.
 
+    Returns:
+        Boolean: Whether or not enrollment exists
 
-@python_2_unicode_compatible
-class EnterpriseCustomerReportingConfiguration(TimeStampedModel):
     """
-    The Enterprise's configuration for sending automated data reports securely via email to the Enterprise Admin.
+    if not enrollment_client:
+        from enterprise.api_client.lms import EnrollmentApiClient  # pylint: disable=import-outside-toplevel
+        enrollment_client = EnrollmentApiClient()
+    try:
+        enrollments = enrollment_client.get_course_enrollment(user.username, course_id)
+        if enrollments and course_mode == enrollments.get('mode'):
+            return True
+    except HttpClientError as exc:
+        LOGGER.error(
+            'Error while checking enrollment status of user %(user)s: %(message)s',
+            {'user': user.username, 'message': str(exc)},
+        )
+    except KeyError as exc:
+        LOGGER.warning(
+            'Error while parsing enrollment data of user %(user)s: %(message)s',
+            {'user': user.username, 'message': str(exc)},
+        )
+    return False
 
-    .. no_pii:
-    """
-
-    FREQUENCY_TYPE_DAILY = 'daily'
-    FREQUENCY_TYPE_MONTHLY = 'monthly'
-    FREQUENCY_TYPE_WEEKLY = 'weekly'
-    FREQUENCY_CHOICES = (
-        (FREQUENCY_TYPE_DAILY, FREQUENCY_TYPE_DAILY),
-        (FREQUENCY_TYPE_MONTHLY, FREQUENCY_TYPE_MONTHLY),
-        (FREQUENCY_TYPE_WEEKLY, FREQUENCY_TYPE_WEEKLY),
-    )
-
-    DELIVERY_METHOD_EMAIL = 'email'
-    DELIVERY_METHOD_SFTP = 'sftp'
-    DELIVERY_METHOD_CHOICES = (
-        (DELIVERY_METHOD_EMAIL, DELIVERY_METHOD_EMAIL),
-        (DELIVERY_METHOD_SFTP, DELIVERY_METHOD_SFTP),
-    )
-
-    DATA_TYPE_PROGRESS = 'progress'  # Refers to gathering progress data from Vertica (to be deprecated)
-    DATA_TYPE_PROGRESS_V2 = 'progress_v2'  # Refers to gathering progress data from the Analytics Data API
-    DATA_TYPE_CATALOG = 'catalog'
-    DATA_TYPE_ENGAGEMENT = 'engagement'  # Refers to gathering engagement data from the Analytics Data API
-    DATA_TYPE_CHOICES = (
-        (DATA_TYPE_PROGRESS, DATA_TYPE_PROGRESS),
-        (DATA_TYPE_PROGRESS_V2, DATA_TYPE_PROGRESS_V2),
-        (DATA_TYPE_CATALOG, DATA_TYPE_CATALOG),
-        (DATA_TYPE_ENGAGEMENT, DATA_TYPE_ENGAGEMENT),
-    )
-
-    REPORT_TYPE_CSV = 'csv'
-    REPORT_TYPE_JSON = 'json'
-    REPORT_TYPE_CHOICES = (
-        (REPORT_TYPE_CSV, REPORT_TYPE_CSV),
-        (REPORT_TYPE_JSON, REPORT_TYPE_JSON),
-    )
-
-    DAYS_OF_WEEK = (
-        (0, 'Monday'),
-        (1, 'Tuesday'),
-        (2, 'Wednesday'),
-        (3, 'Thursday'),
-        (4, 'Friday'),
-        (5, 'Saturday'),
-        (6, 'Sunday'),
-    )
-    uuid = models.UUIDField(default=uuid4, unique=True)
-    enterprise_customer = models.ForeignKey(
-        EnterpriseCustomer,
-        related_name="reporting_configurations",
-        on_delete=models.deletion.CASCADE,
-        blank=False,
-        null=False,
-        verbose_name=_("Enterprise Customer")
-    )
-    active = models.BooleanField(blank=False, null=False, verbose_name=_("Active"))
-    include_date = models.BooleanField(blank=False, default=True, null=False, verbose_name=_("Include Date"),
-                                       help_text=_('Include date in the report file name'))
-    delivery_method = models.CharField(
-        max_length=20,
-        choices=DELIVERY_METHOD_CHOICES,
-        blank=False,
-        default=DELIVERY_METHOD_EMAIL,
-        verbose_name=_("Delivery Method"),
-        help_text=_("The method in which the data should be sent.")
-    )
-    pgp_encryption_key = models.TextField(
-        null=True,
-        blank=True,
-        verbose_name=_("PGP Encryption Key"),
-        help_text=_('The key for encryption, if PGP encrypted file is required.')
-    )
-    data_type = models.CharField(
-        max_length=20,
-        choices=DATA_TYPE_CHOICES,
-        blank=False,
-        default=DATA_TYPE_PROGRESS,
-        verbose_name=_("Data Type"),
-        help_text=_("The type of data this report should contain.")
-    )
-    report_type = models.CharField(
-        max_length=20,
-        choices=REPORT_TYPE_CHOICES,
-        blank=False,
-        default=REPORT_TYPE_CSV,
-        verbose_name=_("Report Type"),
-        help_text=_("The type this report should be sent as, e.g. CSV.")
-    )
-    email = MultiEmailField(
-        blank=True,
-        verbose_name=_("Email"),
-        help_text=_("The email(s), one per line, where the report should be sent.")
-    )
-    frequency = models.CharField(
-        max_length=20,
-        choices=FREQUENCY_CHOICES,
-        blank=False,
-        default=FREQUENCY_TYPE_MONTHLY,
-        verbose_name=_("Frequency"),
-        help_text=_("The frequency interval (daily, weekly, or monthly) that the report should be sent."),
-    )
-    day_of_month = models.SmallIntegerField(
-        blank=True,
-        null=True,
-        verbose_name=_("Day of Month"),
-        help_text=_("The day of the month to send the report. "
-                    "This field is required and only valid when the frequency is monthly."),
-        validators=[MinValueValidator(1), MaxValueValidator(31)]
-    )
-    day_of_week = models.SmallIntegerField(
-        blank=True,
-        null=True,
-        choices=DAYS_OF_WEEK,
-        verbose_name=_("Day of Week"),
-        help_text=_("The day of the week to send the report. "
-                    "This field is required and only valid when the frequency is weekly."),
-    )
-    hour_of_day = models.SmallIntegerField(
-        verbose_name=_("Hour of Day"),
-        help_text=_("The hour of the day to send the report, in Eastern Standard Time (EST). "
-                    "This is required for all frequency settings."),
-        validators=[MinValueValidator(0), MaxValueValidator(23)]
-    )
-    decrypted_password = EncryptedCharField(
-        max_length=256,
-        blank=True,
-        null=True,
-        help_text=_("This password will be used to secure the zip file. "
-                    "It will be encrypted when stored in the database."),
-    )
-    sftp_hostname = models.CharField(
-        max_length=256,
-        blank=True,
-        null=True,
-        verbose_name=_("SFTP Host name"),
-        help_text=_("If the delivery method is sftp, the host to deliver the report to.")
-    )
-    sftp_port = models.PositiveIntegerField(
-        blank=True,
-        null=True,
-        verbose_name=_("SFTP Port"),
-        help_text=_("If the delivery method is sftp, the port on the host to connect to."),
-        default=22,
-    )
-    sftp_username = models.CharField(
-        max_length=256,
-        blank=True,
-        null=True,
-        verbose_name=_("SFTP username"),
-        help_text=_("If the delivery method is sftp, the username to use to securely access the host.")
-    )
-    decrypted_sftp_password = EncryptedCharField(
-        max_length=256,
-        blank=True,
-        null=True,
-        help_text=_("If the delivery method is sftp, the password to use to securely access the host. "
-                    "The password will be encrypted when stored in the database."),
-    )
-    sftp_file_path = models.CharField(
-        max_length=256,
-        blank=True,
-        null=True,
-        verbose_name=_("SFTP file path"),
-        help_text=_("If the delivery method is sftp, the path on the host to deliver the report to.")
-    )
-    enterprise_customer_catalogs = models.ManyToManyField(
-        EnterpriseCustomerCatalog,
-        verbose_name=_("Enterprise Customer Catalogs"),
-    )
-
-    class Meta:
-        app_label = 'enterprise'
-        ordering = ['created']
 
-    @property
-    def encrypted_password(self):
-        """
-        Return encrypted password as a string.
+def enroll_user(enterprise_customer, user, course_mode, *course_ids, **kwargs):
+    """
+    Enroll a single user in any number of courses using a particular course mode.
 
-        The data is encrypted in the DB at rest, but is unencrypted in the app when retrieved through the
-        decrypted_password field. This method will encrypt the password again before sending.
-        """
-        if self.decrypted_password:
-            return force_text(
-                self._meta.get_field('decrypted_password').fernet.encrypt(
-                    force_bytes(self.decrypted_password)
+    Args:
+        enterprise_customer: The EnterpriseCustomer model object which is sponsoring the enrollment
+        user: The user model object who needs to be enrolled in the course
+        course_mode: The string representation of the mode with which the enrollment should be created
+        *course_ids: An iterable containing any number of course IDs to eventually enroll the user in.
+        kwargs: Should contain enrollment_client if it's already been instantiated and should be passed in.
+
+    Returns:
+        Boolean: Whether or not enrollment succeeded for all courses specified
+    """
+    enrollment_client = kwargs.pop('enrollment_client', None)
+    if not enrollment_client:
+        from enterprise.api_client.lms import EnrollmentApiClient  # pylint: disable=import-outside-toplevel
+        enrollment_client = EnrollmentApiClient()
+    enterprise_customer_user, __ = enterprise_customer_user_model().objects.get_or_create(
+        enterprise_customer=enterprise_customer,
+        user_id=user.id
+    )
+    succeeded = True
+    for course_id in course_ids:
+        try:
+            enrollment_client.enroll_user_in_course(
+                user.username,
+                course_id,
+                course_mode,
+                enterprise_uuid=str(enterprise_customer_user.enterprise_customer.uuid)
+            )
+        except HttpClientError as exc:
+            # Check if user is already enrolled then we should ignore exception
+            if is_user_enrolled(user, course_id, course_mode):
+                succeeded = True
+            else:
+                succeeded = False
+                default_message = 'No error message provided'
+                try:
+                    error_message = json.loads(exc.content.decode()).get('message', default_message)
+                except ValueError:
+                    error_message = default_message
+                LOGGER.error(
+                    'Error while enrolling user %(user)s: %(message)s',
+                    {'user': user.username, 'message': error_message},
                 )
+        if succeeded:
+            __, created = enterprise_course_enrollment_model().objects.get_or_create(
+                enterprise_customer_user=enterprise_customer_user,
+                course_id=course_id,
+                defaults={
+                    'source': enterprise_enrollment_source_model().get_source(
+                        enterprise_enrollment_source_model().MANUAL
+                    )
+                }
             )
-        return self.decrypted_password
-
-    @encrypted_password.setter
-    def encrypted_password(self, value):
-        """
-        Set the encrypted password.
-        """
-        self.decrypted_password = value
+            if created:
+                track_enrollment('admin-enrollment', user.id, course_id)
+    return succeeded
+
+
+def customer_admin_enroll_user_with_status(
+        enterprise_customer,
+        user,
+        course_mode,
+        course_id,
+        enrollment_source=None,
+        license_uuid=None,
+        transaction_id=None,
+):
+    """
+    For use with bulk enrollment, or any use case of admin enrolling a user
+
+    Enroll a single user in a course using a particular course mode, indicating it's a
+    customer_admin enrolling a user (such as bulk enrollment). Return a status based on whether the enrollment existed
+    before attempting to enroll.
+
+    TODO: The `enroll_user` function above, used by Django admin, for example, should also be
+    rewired to use this new ability, but for now it still uses enrollment client.
+
+    Args:
+        enterprise_customer: The EnterpriseCustomer model object which is sponsoring the enrollment
+        user: The user model object who needs to be enrolled in the course
+        course_mode: The string representation of the mode with which the enrollment should be created
+        course_id: An opaque course_id to enroll in
+        enrollment_source: Source of enrollment, used for tracking enrollments
+        license_uuid: UUID of associated license with the enrollment, used to create a mapping between licenses and
+            enrollments
+        transaction_id: UUID of associated ledgered transaction if this enrollment is subsidized via learner credit 2.
 
-    @property
-    def encrypted_sftp_password(self):
-        """
-        Return encrypted SFTP password as a string.
+    Returns:
+        succeeded (Boolean): Whether or not the enrollment succeeded for the course specified
+        created (Boolean): Whether or not the enrollment existed prior to calling method
+    """
+    enterprise_customer_user, __ = enterprise_customer_user_model().objects.get_or_create(
+        enterprise_customer=enterprise_customer,
+        user_id=user.id
+    )
+    succeeded = False
+    new_enrollment = False
+    enterprise_fulfillment_source_uuid = None
+    try:
+        # enrolls a user in a course per LMS flow, but this method does not create enterprise records yet so we need to
+        # create it immediately after calling lms_enroll_user_in_course. lms_enroll_user_in_course can return None if
+        # Enrollment already exists, does not fail in this case.
+        new_enrollment = lms_enroll_user_in_course(
+            user.username,
+            course_id,
+            course_mode,
+            enterprise_customer.uuid,
+            is_active=True,
+        )
+        succeeded = True
+        LOGGER.info("Successfully enrolled user %s in course %s", user.id, course_id)
+    except (CourseEnrollmentError, CourseUserGroup.DoesNotExist) as error:
+        LOGGER.exception("Failed to enroll user %s in course %s", user.id, course_id, exc_info=error)
+    if succeeded:
+        # If we have a provided enrollment source, use that. Otherwise default to manual.
+        if enrollment_source:
+            source = enrollment_source
+        else:
+            source = enterprise_enrollment_source_model().get_source(
+                enterprise_enrollment_source_model().MANUAL
+            )
 
-        The data is encrypted in the DB at rest, but is unencrypted in the app when retrieved through the
-        decrypted_password field. This method will encrypt the password again before sending.
-        """
-        if self.decrypted_sftp_password:
-            return force_text(
-                self._meta.get_field('decrypted_sftp_password').fernet.encrypt(
-                    force_bytes(self.decrypted_sftp_password)
+        obj, created = enterprise_course_enrollment_model().objects.get_or_create(
+            enterprise_customer_user=enterprise_customer_user,
+            course_id=course_id,
+            defaults={
+                'source': source
+            }
+        )
+        if transaction_id:
+            subsidy_enrollment_obj, subsidy_enrollment_created = \
+                subsidized_enterprise_course_enrollment_model().objects.get_or_create(
+                    enterprise_course_enrollment=obj,
+                    defaults={"transaction_id": transaction_id},
                 )
+            LOGGER.info(
+                "Transaction reference record %s fetched for transaction %s, was_created=%s",
+                subsidy_enrollment_obj.uuid, transaction_id, subsidy_enrollment_created,
             )
-        return self.decrypted_sftp_password
-
-    @encrypted_sftp_password.setter
-    def encrypted_sftp_password(self, value):
-        """
-        Set the encrypted SFTP password.
-        """
-        self.decrypted_sftp_password = value
+            if not subsidy_enrollment_created:
+                subsidy_enrollment_obj.reactivate(transaction_id=transaction_id)
+            enterprise_fulfillment_source_uuid = subsidy_enrollment_obj.uuid
+        if license_uuid:
+            licensed_enrollment_obj, __ = licensed_enterprise_course_enrollment_model().objects.get_or_create(
+                license_uuid=license_uuid,
+                enterprise_course_enrollment=obj,
+            )
+            LOGGER.info(
+                "Licensed enrollment reference record %s fetched for license %s",
+                licensed_enrollment_obj.uuid, license_uuid,
+            )
+            enterprise_fulfillment_source_uuid = licensed_enrollment_obj.uuid
+        if created:
+            # Note: this tracking event only caters to bulk enrollment right now.
+            track_enrollment(PATHWAY_CUSTOMER_ADMIN_ENROLLMENT, user.id, course_id)
+    else:
+        LOGGER.warning("Failed to enroll user %s in course %s", user.id, course_id)
+    # If new_enrollment is None then the enrollment already existed
+    created = bool(new_enrollment)
+    return succeeded, created, enterprise_fulfillment_source_uuid
+
+
+def customer_admin_enroll_user(enterprise_customer, user, course_mode, course_id, enrollment_source=None):
+    """
+    For use with bulk enrollment, or any use case of admin enrolling a user
+
+    Enroll a single user in a course using a particular course mode, indicating it's a
+    customer_admin enrolling a user (such as bulk enrollment)
+
+    Args:
+        enterprise_customer: The EnterpriseCustomer model object which is sponsoring the enrollment
+        user: The user model object who needs to be enrolled in the course
+        course_mode: The string representation of the mode with which the enrollment should be created
+        course_id: An opaque course_id to enroll in
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<EnterpriseCustomerReportingConfiguration for Enterprise {enterprise_name}>".format(
-            enterprise_name=self.enterprise_customer.name
+    Returns:
+        succeeded (Boolean): Whether or not enrollment succeeded for the course specified
+    """
+    succeeded, __, __ = customer_admin_enroll_user_with_status(
+        enterprise_customer,
+        user,
+        course_mode,
+        course_id,
+        enrollment_source
+    )
+    return succeeded
+
+
+def get_create_ent_enrollment(
+        course_id,
+        enterprise_customer_user,
+        enterprise_enrollment_source,
+        license_uuid=None,
+):
+    """
+    Get or Create the Enterprise Course Enrollment.
+
+    If ``license_uuid`` present, will also create a LicensedEnterpriseCourseEnrollment record.
+    """
+    if enterprise_enrollment_source is not None:
+        source = enterprise_enrollment_source
+    else:
+        raise TypeError("Failed to create enterprise enrollment for {user} in course {course}: "
+                        "Enterprise enrollment source is not defined".format(
+                            user=enterprise_customer_user.user_id,
+                            course=course_id,
+                        )
+                        )
+    # Create the Enterprise backend database records for this course
+    # enrollment
+    enterprise_course_enrollment, created = enterprise_course_enrollment_model().objects.get_or_create(
+        enterprise_customer_user=enterprise_customer_user,
+        course_id=course_id,
+        defaults={
+            'source': source
+        }
+    )
+    if license_uuid and not enterprise_course_enrollment.license:
+        LOGGER.info(
+            'LicensedEnterpriseCourseEnrollment being created with following info: '
+            'License UUID: {license_uuid}, '
+            'EnterpriseCourseEnrollment: {enterprise_course_enrollment_uuid}'.format(
+                license_uuid=license_uuid,
+                enterprise_course_enrollment_uuid=enterprise_course_enrollment,
+            )
         )
+        licensed_enterprise_course_enrollment_model().objects.create(
+            license_uuid=license_uuid,
+            enterprise_course_enrollment=enterprise_course_enrollment,
+        )
+    return enterprise_course_enrollment, created
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
-
-    def clean(self):
-        """
-        Override of clean method to perform additional validation on frequency and day_of_month/day_of week.
-        """
-        validation_errors = {}
 
-        # Check that the frequency selections make sense.
-        if self.frequency == self.FREQUENCY_TYPE_DAILY:
-            self.day_of_month = None
-            self.day_of_week = None
-        elif self.frequency == self.FREQUENCY_TYPE_WEEKLY:
-            if self.day_of_week is None or self.day_of_week == '':
-                validation_errors['day_of_week'] = _('Day of week must be set if the frequency is weekly.')
-            self.day_of_month = None
-        elif self.frequency == self.FREQUENCY_TYPE_MONTHLY:
-            if not self.day_of_month:
-                validation_errors['day_of_month'] = _('Day of month must be set if the frequency is monthly.')
-            self.day_of_week = None
-        else:
-            validation_errors[NON_FIELD_ERRORS] = _('Frequency must be set to either daily, weekly, or monthly.')
+def enroll_subsidy_users_in_courses(enterprise_customer, subsidy_users_info, discount=100.00):
+    """
+    Takes a list of licensed learner data and enrolls each learner in the requested courses.
 
-        # Check that fields related to the delivery method make sense.
-        if self.delivery_method == self.DELIVERY_METHOD_EMAIL:
-            if not self.email:
-                validation_errors['email'] = _(
-                    'Email(s) must be set if the delivery method is email.'
-                )
-            if not self.decrypted_password:
-                validation_errors['decrypted_password'] = _(
-                    'Decrypted password must be set if the delivery method is email.'
-                )
-        elif self.delivery_method == self.DELIVERY_METHOD_SFTP:
-            if not self.sftp_hostname:
-                validation_errors['sftp_hostname'] = _('SFTP Hostname must be set if the delivery method is sftp.')
-            if not self.sftp_username:
-                validation_errors['sftp_username'] = _('SFTP username must be set if the delivery method is sftp.')
-            if not self.sftp_file_path:
-                validation_errors['sftp_file_path'] = _('SFTP File Path must be set if the delivery method is sftp.')
-            if not self.decrypted_sftp_password:
-                validation_errors['decrypted_sftp_password'] = _(
-                    'Decrypted SFTP password must be set if the delivery method is SFTP.'
-                )
+    Args:
+        enterprise_customer: The EnterpriseCustomer (object) which is sponsoring the enrollment
+        subsidy_users_info (list of dict):
+            Each element contains information necessary to create a enterprise enrollment from a subsidy for a specific
+            learner in a specified course run. Required fields:
 
-        if validation_errors:
-            raise ValidationError(validation_errors)
+            * 'user_id' OR 'email': Either unique identifier describing the user to enroll.
+            * 'course_run_key': The course to enroll into.
+            * 'course_mode': The course mode.
+            * 'license_uuid' OR 'transaction_id': ID of either accepted form of subsidy.
 
+            Example::
 
-class EnterpriseRoleAssignmentContextMixin:
-    """
-    Mixin for RoleAssignment models related to enterprises.
+                licensed_users_info: [
+                    {
+                        'email': 'newuser@test.com',
+                        'course_run_key': 'course-v1:edX+DemoX+Demo_Course',
+                        'course_mode': 'verified',
+                        'license_uuid': '5b77bdbade7b4fcb838f8111b68e18ae'
+                    },
+                    {
+                        'email': 'newuser2@test.com',
+                        'course_run_key': 'course-v2:edX+FunX+Fun_Course',
+                        'course_mode': 'unpaid-executive-education',
+                        'transaction_id': '84kdbdbade7b4fcb838f8asjke8e18ae',
+                    },
+                    {
+                        'user_id': 1234,
+                        'course_run_key': 'course-v1:edX+SadX+Sad_Course',
+                        'course_mode': 'unpaid-executive-education',
+                        'transaction_id': '3a5312d722564db0a16e3d81f53a3718',
+                    },
+                ]
+        discount: (int) the discount offered to the learner for their enrollment. Subscription based enrollments
+            default to 100
+
+    Expected Return Values::
+
+        Results: {
+            successes:
+                [{ 'user_id': <lms_user_id>, 'email': <email>, 'course_run_key': <key>, 'user': <user object> } ... ],
+            pending:
+                [{ 'user_id': <lms_user_id>, 'email': <email>, 'course_run_key': <key>, 'user': <user object> } ... ],
+            failures:
+                [{ 'user_id': <lms_user_id>, 'email': <email>, 'course_run_key': <key> } ... ]
+        }
     """
+    results = {
+        'successes': [],
+        'pending': [],
+        'failures': [],
+    }
+    for subsidy_user_info in subsidy_users_info:
+        user_id = subsidy_user_info.get('user_id')
+        user_email = subsidy_user_info['email'].strip().lower() if 'email' in subsidy_user_info else None
+        course_mode = subsidy_user_info.get('course_mode')
+        course_run_key = subsidy_user_info.get('course_run_key')
+        license_uuid = subsidy_user_info.get('license_uuid')
+        transaction_id = subsidy_user_info.get('transaction_id')
+        activation_link = subsidy_user_info.get('activation_link')
+
+        if user_id and user_email:
+            user = User.objects.filter(id=subsidy_user_info['user_id']).first()
+            # If either the provided user_id does not match an existing user, or the provided email does not match that
+            # of the existing user, fail.
+            if not user or not user.email or user_email != user.email.lower():
+                results['failures'].append({'user_id': user_id, 'email': user_email, 'course_run_key': course_run_key})
+                continue
+        elif user_id and not user_email:
+            user = User.objects.filter(id=subsidy_user_info['user_id']).first()
+        elif not user_id and user_email:
+            user = User.objects.filter(email=subsidy_user_info['email']).first()
+        elif not user_id and not user_email:
+            # Neither 'user_id', nor 'email' were supplied for the current user info, but at least one is required.
+            results['failures'].append({'course_run_key': course_run_key})
+            continue
 
-    @property
-    def enterprise_customer_uuids(self):
-        """Get the enterprise customer uuids linked to the user."""
-        enterprise_users = EnterpriseCustomerUser.objects.filter(user_id=self.user.id)
-        if not enterprise_users:
-            LOGGER.warning(
-                'User {} has a {} of "{}" but is not linked to an enterprise. (ID: {})'.format(
-                    self.user.id,
-                    self.__class__,
-                    self.role.name,
-                    self.id
-                ))
-            return None
+        try:
+            if user:
+                enrollment_source = enterprise_enrollment_source_model().get_source(
+                    enterprise_enrollment_source_model().CUSTOMER_ADMIN
+                )
+                succeeded, created, source_uuid = customer_admin_enroll_user_with_status(
+                    enterprise_customer,
+                    user,
+                    course_mode,
+                    course_run_key,
+                    enrollment_source,
+                    license_uuid,
+                    transaction_id
+                )
+                if succeeded:
+                    success_dict = {
+                        'user': user,
+                        'user_id': user.id,
+                        'email': user.email,
+                        'course_run_key': course_run_key,
+                        'created': created,
+                        'activation_link': activation_link,
+                    }
 
-        return [str(enterprise_user.enterprise_customer.uuid) for enterprise_user in enterprise_users]
+                    if source_uuid:
+                        success_dict['enterprise_fulfillment_source_uuid'] = source_uuid
+                    results['successes'].append(success_dict)
+                else:
+                    results['failures'].append(
+                        {'user_id': user.id, 'email': user.email, 'course_run_key': course_run_key}
+                    )
+            else:
+                pending_user, new_enrollments = enterprise_customer.enroll_user_pending_registration_with_status(
+                    user_email,
+                    course_mode,
+                    course_run_key,
+                    enrollment_source=enterprise_enrollment_source_model().get_source(
+                        enterprise_enrollment_source_model().CUSTOMER_ADMIN
+                    ),
+                    discount=discount,
+                    license_uuid=license_uuid
+                )
+                results['pending'].append({
+                    'user': pending_user,
+                    'email': user_email,
+                    'course_run_key': course_run_key,
+                    'created': new_enrollments[course_run_key],
+                    'activation_link': activation_link,
+                })
+        except utils.IntegrityError:
+            LOGGER.exception("IntegrityError enrolling user %s in course run %s", user_id, course_run_key)
+            results['failures'].append({'user_id': user_id, 'email': user_email, 'course_run_key': course_run_key})
+            continue
+
+    return results
+
+
+def enroll_users_in_course(
+        enterprise_customer,
+        course_id,
+        course_mode,
+        emails,
+        enrollment_requester=None,
+        enrollment_reason=None,
+        discount=0.0,
+        sales_force_id=None,
+):
+    """
+    Enroll existing users in a course, and create a pending enrollment for nonexisting users.
+
+    Args:
+        enterprise_customer: The EnterpriseCustomer which is sponsoring the enrollment
+        course_id (str): The unique identifier of the course in which we're enrolling
+        course_mode (str): The mode with which we're enrolling in the course
+        emails: An iterable of email addresses which need to be enrolled
+        enrollment_requester (User): Admin user who is requesting the enrollment.
+        enrollment_reason (str): A reason for enrollment.
+        discount (Decimal): Percentage discount for enrollment.
+        sales_force_id (str): Salesforce opportunity id.
 
-    def get_context(self):
-        """
-        Return the context for this role assignment class. A list is returned in case of user with multiple contexts.
-        """
-        return self.enterprise_customer_uuids
+    Returns:
+        successes: A list of users who were successfully enrolled in the course.
 
+        pending: A list of PendingEnterpriseCustomerUsers who were successfully
+            linked and had pending enrollments created for them in the database.
 
-@python_2_unicode_compatible
-class SystemWideEnterpriseRole(UserRole):
+        failures: A list of users who could not be enrolled in the course.
     """
-    System wide user role definitions specific to Enterprise.
+    existing_users, unregistered_emails = get_users_by_email(emails)
 
-    .. no_pii:
-    """
+    successes = []
+    pending = []
+    failures = []
+
+    for user in existing_users:
+        succeeded = enroll_user(enterprise_customer, user, course_mode, course_id)
+        if succeeded:
+            successes.append(user)
+            if enrollment_requester and enrollment_reason:
+                create_manual_enrollment_audit(
+                    enrollment_requester,
+                    user.email,
+                    UNENROLLED_TO_ENROLLED,
+                    enrollment_reason,
+                    course_id,
+                )
+        else:
+            failures.append(user)
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<SystemWideEnterpriseRole {role}>".format(role=self.name)
+    for email in unregistered_emails:
+        pending_user = enterprise_customer.enroll_user_pending_registration(
+            email,
+            course_mode,
+            course_id,
+            enrollment_source=enterprise_enrollment_source_model().get_source(
+                enterprise_enrollment_source_model().MANUAL
+            ),
+            discount=discount,
+            sales_force_id=sales_force_id,
+        )
+        pending.append(pending_user)
+        if enrollment_requester and enrollment_reason:
+            create_manual_enrollment_audit(
+                enrollment_requester,
+                email,
+                UNENROLLED_TO_ALLOWEDTOENROLL,
+                enrollment_reason,
+                course_id,
+            )
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    return successes, pending, failures
 
 
-@python_2_unicode_compatible
-class SystemWideEnterpriseUserRoleAssignment(EnterpriseRoleAssignmentContextMixin, UserRoleAssignment):
+def is_valid_url(url):
     """
-    Model to map users to a SystemWideEnterpriseRole.
-
-    .. no_pii:
+    Return where the specified URL is a valid absolute url.
     """
+    try:
+        result = urlparse(url)
+        return all([result.scheme, result.netloc])
+    except ValueError:
+        return False
 
-    role_class = SystemWideEnterpriseRole
 
-    def get_context(self):
-        """
-        Return the context for this role assignment class.
-        """
-        # do not add enterprise id for `enterprise_openedx_operator` role
-        if self.role.name == ENTERPRISE_OPERATOR_ROLE:  # pylint: disable=no-member
-            return [ALL_ACCESS_CONTEXT]
+def get_platform_logo_url():
+    """
+    Return an absolute URL of the platform logo using the branding api.
+    """
+    logo_url = get_logo_url() if get_logo_url else None
+    if not logo_url:
+        return None
 
-        return super(SystemWideEnterpriseUserRoleAssignment, self).get_context()
+    is_abs_url = is_valid_url(logo_url)
+    if is_abs_url:
+        return logo_url
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<SystemWideEnterpriseUserRoleAssignment for User {user} assigned to role {role}>".format(
-            user=self.user.id,
-            role=self.role.name  # pylint: disable=no-member
-        )
-
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    return urljoin(settings.LMS_ROOT_URL, logo_url)
 
 
-@python_2_unicode_compatible
-class EnterpriseFeatureRole(UserRole):
+def unset_language_of_all_enterprise_learners(enterprise_customer):
     """
-    Enterprise-specific feature role definitions.
+    Unset the language preference of all the learners belonging to the given enterprise customer.
 
-    .. no_pii:
+    Arguments:
+        enterprise_customer (EnterpriseCustomer): Instance of the enterprise customer.
     """
+    if UserPreference:
+        user_ids = list(enterprise_customer.enterprise_customer_users.values_list('user_id', flat=True))
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<EnterpriseFeatureRole {role}>".format(role=self.name)
-
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+        UserPreference.objects.filter(
+            key=LANGUAGE_KEY,
+            user_id__in=user_ids
+        ).update(
+            value=''
+        )
 
 
-@python_2_unicode_compatible
-class EnterpriseFeatureUserRoleAssignment(EnterpriseRoleAssignmentContextMixin, UserRoleAssignment):
+def unset_enterprise_learner_language(enterprise_customer_user):
     """
-    Model to map users to an EnterpriseFeatureRole.
+    Unset the language preference of the given enterprise learners.
 
-    .. no_pii:
+    Arguments:
+        enterprise_customer_user (EnterpriseCustomerUser): Instance of the enterprise customer user.
     """
+    if UserPreference:
+        UserPreference.objects.update_or_create(
+            key=LANGUAGE_KEY,
+            user_id=enterprise_customer_user.user_id,
+            defaults={'value': ''}
+        )
 
-    role_class = EnterpriseFeatureRole
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<EnterpriseFeatureUserRoleAssignment for User {user} assigned to role {role}>".format(
-            user=self.user.id,
-            role=self.role.name  # pylint: disable=no-member
-        )
+def validate_course_exists_for_enterprise(enterprise_customer, course_id, **kwargs):
+    """
+    Validates that a specified course id exists within the LMS and within the enterprise_customer's catalog(s).
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    Arguments:
+        enterprise_customer (EnterpriseCustomer): Instance of the enterprise customer.
+        course_id (string): The unique identifier of a course.
+        kwargs: Should contain enrollment_client if it's already been instantiated and is passed in.
+    """
+    enrollment_client = kwargs.pop('enrollment_client', None)
+    if not enrollment_client:
+        from enterprise.api_client.lms import EnrollmentApiClient  # pylint: disable=import-outside-toplevel
+        enrollment_client = EnrollmentApiClient()
+    course_details = enrollment_client.get_course_details(course_id)
+    if not course_details:
+        raise ValidationError(ValidationMessages.INVALID_COURSE_ID.format(course_id=course_id))
+    if not enterprise_customer.catalog_contains_course(course_id):
+        raise ValidationError(ValidationMessages.COURSE_NOT_EXIST_IN_CATALOG.format(course_id=course_id))
+    return course_details or False
 
 
-class PendingEnterpriseCustomerAdminUser(TimeStampedModel):
+def batch(iterable, batch_size=1):
     """
-    Model for pending enterprise admin users.
+    Break up an iterable into equal-sized batches.
 
-    .. pii: The user_email field contains PII, but locally deleted via
-    enterprise.signals.assign_or_delete_enterprise_admin_role when the
-    admin registers a new account.
-    .. pii_types: email_address
-    .. pii_retirement: local_api, consumer_api
+    Arguments:
+        iterable (e.g. list): an iterable to batch
+        batch_size (int): the size of each batch. Defaults to 1.
+    Returns:
+        generator: iterates through each batch of an iterable
     """
+    if isinstance(iterable, QuerySet):
+        iterable_len = iterable.count()
+    else:
+        iterable_len = len(iterable)
+    for index in range(0, iterable_len, batch_size):
+        yield iterable[index:min(index + batch_size, iterable_len)]
 
-    enterprise_customer = models.ForeignKey(
-        EnterpriseCustomer,
-        blank=False,
-        null=False,
-        on_delete=models.CASCADE,
-    )
-    user_email = models.EmailField(null=False, blank=False)
-    history = HistoricalRecords()
 
-    class Meta:
-        app_label = 'enterprise'
-        ordering = ['created']
-        unique_together = (('enterprise_customer', 'user_email'),)
+def get_best_mode_from_course_key(course_key):
+    """
+    Helper method to retrieve a list of enrollments for a given course and select the one most applicable to enroll an
+    enterprise learner in.
+    """
+    course_modes = [mode.slug for mode in CourseMode.objects.filter(course_id=course_key)]
+    if best_mode := [mode for mode in BEST_MODE_ORDER if mode in course_modes]:
+        return best_mode[0]
+    return CourseModes.AUDIT
 
-    @cached_property
-    def admin_registration_url(self):
-        """
-        Returns a URL to be used by a pending enterprise admin user to register their account.
-        """
-        registration_url = '{}/{}/admin/register'.format(
-            settings.ENTERPRISE_ADMIN_PORTAL_BASE_URL,
-            self.enterprise_customer.slug
-        )
-        return registration_url
 
-    @classmethod
-    def activate_admin_permissions(cls, user, enterprise_customer):
-        """
-        Activates admin permissions for an existing PendingEnterpriseCustomerAdminUser.
+def parse_lms_api_datetime(datetime_string, datetime_format=LMS_API_DATETIME_FORMAT):
+    """
+    Parse a received datetime into a timezone-aware, Python datetime object.
 
-        Specifically, the "enterprise_admin" system-wide role is assigned to the user and
-        the PendingEnterpriseCustomerAdminUser record is removed.
+    Arguments:
+        datetime_string: A string to be parsed.
+        datetime_format: A datetime format string to be used for parsing
 
-        Arguments:
-            user: a User instance
-            enterprise_customer: An EnterpriseCustomer instance
-        """
+    """
+    if isinstance(datetime_string, datetime.datetime):
+        date_time = datetime_string
+    else:
         try:
-            pending_admin_user = PendingEnterpriseCustomerAdminUser.objects.get(
-                user_email=user.email,
-                enterprise_customer=enterprise_customer,
-            )
-        except PendingEnterpriseCustomerAdminUser.DoesNotExist:
-            LOGGER.error(
-                'Unable to activate admin permissions as no PendingEnterpriseCustomerAdminUser'
-                ' records exist for user %s', user.id,
-            )
-            return
+            date_time = datetime.datetime.strptime(datetime_string, datetime_format)
+        except ValueError:
+            date_time = datetime.datetime.strptime(datetime_string, LMS_API_DATETIME_FORMAT_WITHOUT_TIMEZONE)
+
+    # If the datetime format didn't include a timezone, then set to UTC.
+    # Note that if we're using the default LMS_API_DATETIME_FORMAT, it ends in 'Z',
+    # which denotes UTC for ISO-8661.
+    if date_time.tzinfo is None:
+        date_time = date_time.replace(tzinfo=timezone.utc)
+    return date_time
 
-        # create enterprise_admin role and delete pending admin user record
-        enterprise_admin_role, __ = SystemWideEnterpriseRole.objects.get_or_create(name=ENTERPRISE_ADMIN_ROLE)
-        SystemWideEnterpriseUserRoleAssignment.objects.get_or_create(user=user, role=enterprise_admin_role)
-        pending_admin_user.delete()
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<PendingEnterpriseCustomerAdminUser {id}>: {enterprise_name} - {user_email}".format(
-            id=self.id,
-            enterprise_name=self.enterprise_customer.name,
-            user_email=self.user_email,
-        )
-
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+def localized_utcnow():
+    """Helper function to return localized utcnow()."""
+    return pytz.UTC.localize(datetime.datetime.utcnow())  # pylint: disable=no-value-for-parameter
 
 
-class EnterpriseAnalyticsUser(TimeStampedModel):
+def logo_path(instance, filename):
     """
-    Model for analytics users.
+    Returns the enterprise customer logo image path.
+
+    Arguments:
+        instance (:class:`.EnterpriseCustomerBrandingConfiguration`): EnterpriseCustomerBrandingConfiguration object
+        filename (str): file to upload
+
+    Returns:
+        path: path of image file e.g. enterprise/branding/<enterprise_uuid>/logo_<uuid>.<ext>.lower()
 
-     .. no_pii:
     """
-    enterprise_customer_user = models.ForeignKey(
-        EnterpriseCustomerUser,
-        blank=False,
-        null=False,
-        on_delete=models.CASCADE
-    )
-    analytics_user_id = models.CharField(
-        max_length=255,
-        blank=False,
-        null=False,
-        help_text=_("User id in the third party analytics system."))
-    history = HistoricalRecords()
+    extension = os.path.splitext(filename)[1].lower()
+    generated_uuid = str(uuid4())
+    fullname = os.path.join("enterprise/branding/" + str(instance.enterprise_customer.uuid) +
+                            "/logo_" + generated_uuid + extension)
+    return fullname
 
-    class Meta:
-        app_label = 'enterprise'
-        ordering = ['created']
-        unique_together = (('enterprise_customer_user', 'analytics_user_id'),)
 
-    def __str__(self):
-        """
-        Return human-readable string representation.
-        """
-        return "<EnterpriseAnalyticsUser {id}>: {enterprise_customer_user} - {analytics_user_id}".format(
-            id=self.id,
-            enterprise_customer_user=self.enterprise_customer_user.id,
-            analytics_user_id=self.analytics_user_id,
-        )
+def get_default_invite_key_expiration_date():
+    """
+    Returns the default expiration date for an invite key.
 
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+    The default expiration date is 365 days from the current date.
+    """
+    return localized_utcnow() + datetime.timedelta(days=365)
```

### Comparing `edx-enterprise-3.9.9/enterprise/middleware.py` & `edx-enterprise-4.0.0/enterprise/middleware.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/apps.py` & `edx-enterprise-4.0.0/enterprise/apps.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Enterprise Django application initialization.
 """
 
 from django.apps import AppConfig, apps
 from django.conf import settings
 
@@ -20,27 +19,38 @@
     customer_success_email = getattr(settings, 'ENTERPRISE_CUSTOMER_SUCCESS_EMAIL', 'customersuccess@edx.org')
     enterprise_integrations_email = getattr(
         settings,
         'ENTERPRISE_INTEGRATIONS_EMAIL',
         'enterprise-integrations@edx.org'
     )
 
+    backend_service_edx_oauth2_key = getattr(
+        settings, "ENTERPRISE_BACKEND_SERVICE_EDX_OAUTH2_KEY", "enterprise-backend-service-key"
+    )
+    backend_service_edx_oauth2_secret = getattr(
+        settings, "ENTERPRISE_BACKEND_SERVICE_EDX_OAUTH2_SECRET", "enterprise-backend-service-secret"
+    )
+    backend_service_edx_oauth2_provider_url = getattr(
+        settings, "ENTERPRISE_BACKEND_SERVICE_EDX_OAUTH2_PROVIDER_URL", "http://127.0.0.1:8000/oauth2"
+    )
+
     @property
     def auth_user_model(self):
         """
         Return User model for django.contrib.auth.
         """
         return apps.get_app_config("auth").get_model("User")
 
     def ready(self):
         """
         Perform other one-time initialization steps.
         """
         from enterprise.signals import handle_user_post_save  # pylint: disable=import-outside-toplevel
-        from django.db.models.signals import pre_migrate, post_save  # pylint: disable=import-outside-toplevel
+
+        from django.db.models.signals import post_save, pre_migrate  # pylint: disable=C0415, # isort:skip
 
         post_save.connect(handle_user_post_save, sender=self.auth_user_model, dispatch_uid=USER_POST_SAVE_DISPATCH_UID)
         pre_migrate.connect(self._disconnect_user_post_save_for_migrations)
 
     def _disconnect_user_post_save_for_migrations(self, sender, **kwargs):  # pylint: disable=unused-argument
         """
         Handle pre_migrate signal - disconnect User post_save handler.
```

### Comparing `edx-enterprise-3.9.9/enterprise/views.py` & `edx-enterprise-4.0.0/enterprise/views.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,37 +1,41 @@
-# -*- coding: utf-8 -*-
 """
 User-facing views for the Enterprise app.
 """
 
 import datetime
+import json
 import re
-from logging import getLogger
+from collections import namedtuple
+from urllib.parse import parse_qs, urlencode, urljoin, urlsplit, urlunsplit
 from uuid import UUID
 
 import pytz
-import waffle
+import waffle  # pylint: disable=invalid-django-waffle-import
 from dateutil.parser import parse
-from ipware.ip import get_ip
+from edx_django_utils import monitoring
+from edx_rest_api_client.exceptions import HttpClientError
 from opaque_keys import InvalidKeyError
 from opaque_keys.edx.keys import CourseKey
-from six.moves.urllib.parse import parse_qs, urlencode, urljoin, urlsplit, urlunsplit  # pylint: disable=import-error
 
+from django.apps import apps
 from django.conf import settings
 from django.contrib.auth.decorators import login_required
 from django.core.exceptions import ImproperlyConfigured, PermissionDenied
 from django.db import IntegrityError, transaction
 from django.http import Http404, JsonResponse
 from django.shortcuts import redirect, render
 from django.urls import reverse
 from django.utils.decorators import method_decorator
+from django.utils.encoding import iri_to_uri
+from django.utils.http import url_has_allowed_host_and_scheme
 from django.utils.text import slugify
 from django.utils.translation import get_language_from_request
-from django.utils.translation import ugettext as _
-from django.utils.translation import ungettext
+from django.utils.translation import gettext as _
+from django.utils.translation import ngettext
 from django.views.generic import View
 from django.views.generic.edit import FormView
 
 from consent.helpers import get_data_sharing_consent
 from consent.models import DataSharingConsent
 from enterprise import constants, messages
 from enterprise.api.v1.serializers import EnterpriseCustomerUserWriteSerializer
@@ -43,37 +47,41 @@
     ENTERPRISE_LOGIN_SUBTITLE,
     ENTERPRISE_LOGIN_TITLE,
     ENTERPRISE_SELECT_SUBTITLE,
     ERROR_MESSAGE_FOR_SLUG_LOGIN,
     EnterpriseLoginForm,
     EnterpriseSelectionForm,
 )
+from enterprise.logging import getEnterpriseLogger
 from enterprise.models import (
     EnterpriseCourseEnrollment,
     EnterpriseCustomerCatalog,
     EnterpriseCustomerUser,
     EnterpriseEnrollmentSource,
-    LicensedEnterpriseCourseEnrollment,
 )
 from enterprise.utils import (
     CourseEnrollmentDowngradeError,
     CourseEnrollmentPermissionError,
     NotConnectedToOpenEdX,
     clean_html_for_template_rendering,
     filter_audit_course_modes,
     format_price,
     get_active_course_runs,
+    get_best_mode_from_course_key,
     get_configuration_value,
+    get_create_ent_enrollment,
     get_current_course_run,
+    get_enterprise_customer_by_invite_key_or_404,
     get_enterprise_customer_by_slug_or_404,
-    get_enterprise_customer_idp,
     get_enterprise_customer_or_404,
     get_enterprise_customer_user,
+    get_platform_logo_url,
     get_program_type_description,
     is_course_run_enrollable,
+    localized_utcnow,
     track_enrollment,
     ungettext_min_max,
     update_query_parameters,
 )
 from integrated_channels.cornerstone.utils import create_cornerstone_learner_data
 
 try:
@@ -92,59 +100,142 @@
     user_authn_cookies = None
 
 try:
     from openedx.features.enterprise_support.utils import get_provider_login_url
 except ImportError:
     get_provider_login_url = None
 
-LOGGER = getLogger(__name__)
+LOGGER = getEnterpriseLogger(__name__)
 BASKET_URL = urljoin(settings.ECOMMERCE_PUBLIC_URL_ROOT, '/basket/add/')
 LMS_DASHBOARD_URL = urljoin(settings.LMS_ROOT_URL, '/dashboard')
 LMS_PROGRAMS_DASHBOARD_URL = urljoin(settings.LMS_ROOT_URL, '/dashboard/programs/{uuid}')
 LMS_START_PREMIUM_COURSE_FLOW_URL = urljoin(settings.LMS_ROOT_URL, '/verify_student/start-flow/{course_id}/')
 LMS_COURSEWARE_URL = urljoin(settings.LMS_ROOT_URL, '/courses/{course_id}/courseware')
 LMS_LOGIN_URL = urljoin(settings.LMS_ROOT_URL, '/login')
 ENTERPRISE_GENERAL_ERROR_PAGE = 'enterprise/enterprise_error_page_with_messages.html'
 
+# Constants used for logging errors that occur during
+# the Data-sharing consent flow
+CATALOG_API_CONFIG_ERROR_CODE = 'ENTGDS004'
+CUSTOMER_DOES_NOT_EXIST_ERROR_CODE = 'ENTGDS008'
+CONTENT_ID_DOES_NOT_EXIST_ERROR_CODE = 'ENTGDS000'
+LICENSED_ENROLLMENT_ERROR_CODE = 'ENTGDS100'
+NO_CONSENT_RECORD_ERROR_CODE = 'ENTGDS0002'
+REDIRECT_URLS_MISSING_ERROR_CODE = 'ENTGDS003'
+COURSE_MODE_DOES_NOT_EXIST_ERROR_CODE = 'ENTHCE000'
+ROUTER_VIEW_NO_COURSE_ID_ERROR_CODE = 'ENTRV000'
+VERIFIED_MODE_UNAVAILABLE_ERROR_CODE = 'ENTGDS110'
+ENROLLMENT_INTEGRITY_ERROR_CODE = 'ENTGDS009'
+
+DSC_ERROR_MESSAGES_BY_CODE = {
+    CATALOG_API_CONFIG_ERROR_CODE: 'Course catalog api configuration error.',
+    CUSTOMER_DOES_NOT_EXIST_ERROR_CODE: 'No record found for Enterprise customer.',
+    CONTENT_ID_DOES_NOT_EXIST_ERROR_CODE: 'The course or program with the given id does not exist.',
+    LICENSED_ENROLLMENT_ERROR_CODE: 'Failed to enroll licensed learner into course.',
+    NO_CONSENT_RECORD_ERROR_CODE: 'There is no consent record, or consent is not required.',
+    REDIRECT_URLS_MISSING_ERROR_CODE: 'Required request values missing for action to be carried out.',
+    COURSE_MODE_DOES_NOT_EXIST_ERROR_CODE: 'Course_modes for course not found.',
+    ROUTER_VIEW_NO_COURSE_ID_ERROR_CODE: 'In Router View, could not find course run with given id.',
+    VERIFIED_MODE_UNAVAILABLE_ERROR_CODE: 'The [verified] course mode is expired or otherwise unavailable',
+    ENROLLMENT_INTEGRITY_ERROR_CODE: 'IntegrityError while creating EnterpriseCourseEnrollment.',
+}
+
+
+def _log_error_message(error_code, exception=None, logger_method=LOGGER.error, **kwargs):
+    """
+    Helper to log standardized error messages about DSC API failures.
+    """
+    error_message = DSC_ERROR_MESSAGES_BY_CODE[error_code]
+    log_message = (
+        '[Enterprise DSC API] {error_message} '
+        'error_code: {error_code}, '
+        'exception: {exception}'
+    ).format(error_message=error_message, error_code=error_code, exception=exception)
+
+    for key, value in kwargs.items():
+        log_message += ', {key}: {value}'.format(key=key, value=value)
+
+    logger_method(log_message)
+    return log_message
+
+
+# The query param used to indicate some reason for enrollment failure;
+# added to the `failure_url` that can be redirected to during the
+# DSC enrollment flow.
+FAILED_ENROLLMENT_REASON_QUERY_PARAM = 'failure_reason'
+
+
+class VerifiedModeUnavailableException(Exception):
+    """
+    Exception that indicates the verified enrollment mode
+    has expired or is otherwise unavaible for a course run.
+    """
+
+
+FailedEnrollmentReason = namedtuple(
+    'FailedEnrollmentReason',
+    ['enrollment_client_error', 'failure_reason_message']
+)
+
+
+VERIFIED_MODE_UNAVAILABLE = FailedEnrollmentReason(
+    enrollment_client_error='The [verified] course mode is expired or otherwise unavailable',
+    failure_reason_message='verified_mode_unavailable',
+)
+DSC_DENIED = FailedEnrollmentReason(
+    enrollment_client_error='Data Sharing Consent terms must be accepted in order to enroll',
+    failure_reason_message='dsc_denied',
+)
+
+
+def get_safe_redirect_url(url, requires_https=None):
+    """
+    Ensure that the URL which is going to be used for redirection exists in whitelist.
+    """
+    redirect_whitelist = set(getattr(settings, 'LOGIN_REDIRECT_WHITELIST', []))
+    if url_has_allowed_host_and_scheme(url, allowed_hosts=redirect_whitelist, require_https=requires_https):
+        return iri_to_uri(url)
+    return None
+
 
 def verify_edx_resources():
     """
     Ensure that all necessary resources to render the view are present.
     """
     required_methods = {
         'ProgramDataExtender': ProgramDataExtender,
     }
 
-    for method in required_methods:
-        if required_methods[method] is None:
+    for key, method in required_methods.items():
+        if method is None:
             raise NotConnectedToOpenEdX(
                 _("The following method from the Open edX platform is necessary for this view but isn't available.")
-                + "\nUnavailable: {method}".format(method=method)
+                + "\nUnavailable: {method}".format(method=key)
             )
 
 
 def get_global_context(request, enterprise_customer=None):
     """
     Get the set of variables that are needed by default across views.
     """
     platform_name = get_configuration_value("PLATFORM_NAME", settings.PLATFORM_NAME)
-    # pylint: disable=no-member
     context = {
         'enterprise_customer': enterprise_customer,
         'LMS_SEGMENT_KEY': settings.LMS_SEGMENT_KEY,
         'LANGUAGE_CODE': get_language_from_request(request),
         'tagline': get_configuration_value("ENTERPRISE_TAGLINE", settings.ENTERPRISE_TAGLINE),
         'platform_description': get_configuration_value(
             "PLATFORM_DESCRIPTION",
             settings.PLATFORM_DESCRIPTION,
         ),
         'LMS_ROOT_URL': settings.LMS_ROOT_URL,
         'platform_name': platform_name,
         'header_logo_alt_text': _('{platform_name} home page').format(platform_name=platform_name),
         'welcome_text': constants.WELCOME_TEXT.format(platform_name=platform_name),
+        'logo_url': get_platform_logo_url(),
     }
 
     if enterprise_customer is not None:
         context.update({
             'enterprise_welcome_text': constants.ENTERPRISE_WELCOME_TEXT.format(
                 enterprise_customer_name=enterprise_customer.name,
                 platform_name=platform_name,
@@ -170,62 +261,48 @@
     """
     if waffle.switch_is_active('local_currency') and get_localized_price_text:
         return get_localized_price_text(price, request)
 
     return format_price(price)
 
 
-def render_page_with_error_code_message(request, context_data, error_code, log_message):
+def render_page_with_error_code_message(request, context_data, error_code, exception=None, **kwargs):
     """
     Return a 404 page with specified error_code after logging error and adding message to django messages.
     """
-    LOGGER.error(log_message)
+    _log_error_message(error_code, exception=exception, **kwargs)
     messages.add_generic_error_message_with_code(request, error_code)
     return render(
         request,
         ENTERPRISE_GENERAL_ERROR_PAGE,
         context=context_data,
         status=404,
     )
 
 
-def get_create_ent_enrollment(
-        course_id,
-        enterprise_customer_user,
-        license_uuid=None,
-):
-    """
-    Get or Create the Enterprise Course Enrollment.
-
-    If ``license_uuid`` present, will also create a LicensedEnterpriseCourseEnrollment record.
-    """
-    source = EnterpriseEnrollmentSource.get_source(EnterpriseEnrollmentSource.ENROLLMENT_URL)
-    # Create the Enterprise backend database records for this course
-    # enrollment
-    enterprise_course_enrollment, created = EnterpriseCourseEnrollment.objects.get_or_create(
-        enterprise_customer_user=enterprise_customer_user,
-        course_id=course_id,
-        defaults={
-            'source': source
-        }
-    )
-    if license_uuid and not enterprise_course_enrollment.license:
-        LOGGER.info(
-            'LicensedEnterpriseCourseEnrollment being created with following info: '
-            'License UUID: {license_uuid}, '
-            'EnterpriseCourseEnrollment: {enterprise_course_enrollment_uuid}'.format(
-                license_uuid=license_uuid,
-                enterprise_course_enrollment_uuid=enterprise_course_enrollment,
-            )
-        )
-        LicensedEnterpriseCourseEnrollment.objects.create(
-            license_uuid=license_uuid,
-            enterprise_course_enrollment=enterprise_course_enrollment,
-        )
-    return enterprise_course_enrollment, created
+def should_upgrade_to_licensed_enrollment(consent_record, license_uuid):
+    """
+    In the event that a learner did enroll into audit from B2C and they consented
+    on the data sharing consent page, we want to upgrade their audit enrollment
+    into verified when they view the course in the learner portal and hit
+    the DSC GET endpoint again.
+    """
+    return consent_record is not None and consent_record.granted and license_uuid
+
+
+def add_reason_to_failure_url(base_failure_url, failure_reason):
+    """
+    Adds a query param to the given ``base_failure_url`` indicating
+    why an enrollment has failed.
+    """
+    (scheme, netloc, path, query, fragment) = list(urlsplit(base_failure_url))
+    query_dict = parse_qs(query)
+    query_dict[FAILED_ENROLLMENT_REASON_QUERY_PARAM] = failure_reason
+    new_query = urlencode(query_dict, doseq=True)
+    return urlunsplit((scheme, netloc, path, new_query, fragment))
 
 
 class NonAtomicView(View):
     """
     A base class view for views that disable atomicity in requests.
     """
 
@@ -236,51 +313,39 @@
 
         Since we have settings.ATOMIC_REQUESTS enabled, Django wraps all view functions in an atomic transaction, so
         they can be rolled back if anything fails.
 
         However, we need to be able to save data in the middle of get/post(), so that it's available for calls to
         external APIs.  To allow this, we need to disable atomicity at the top dispatch level.
         """
-        return super(NonAtomicView, self).dispatch(request, *args, **kwargs)
+        return super().dispatch(request, *args, **kwargs)
 
 
 class GrantDataSharingPermissions(View):
     """
     Provide a form and form handler for data sharing consent.
 
     View handles the case in which we get to the "verify consent" step, but consent
     hasn't yet been provided - this view contains a GET view that provides a form for
     consent to be provided, and a POST view that consumes said form.
     """
-
     preview_mode = False
 
     def course_or_program_exist(self, course_id, program_uuid):
         """
         Return whether the input course or program exist.
         """
         try:
             course_exists = course_id and get_course_catalog_api_service_client().get_course_id(course_id)
             program_exists = program_uuid and get_course_catalog_api_service_client().program_exists(program_uuid)
             return course_exists or program_exists
-        except ImproperlyConfigured as error:
-            error_code = 'ENTGDS004'
-            log_message = (
-                '[Enterprise DSC API] Course catalog api configuration error. '
-                'Course: {course_id}, '
-                'Program: {program_uuid}, '
-                'ErrorCode: {error_code}, '
-                'Message: {message}'.format(
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    error_code=error_code,
-                    message=error,
-                )
+        except ImproperlyConfigured as exc:
+            _log_error_message(
+                CATALOG_API_CONFIG_ERROR_CODE, exception=exc, course_id=course_id, program_uuid=program_uuid,
             )
-            LOGGER.error(log_message)
             return False
 
     def get_default_context(self, enterprise_customer, platform_name):
         """
         Get the set of variables that will populate the template by default.
         """
         context_data = {
@@ -300,16 +365,16 @@
             'agreement_text': _(
                 'I agree to allow {platform_name} to share data about my enrollment, completion and performance in all '
                 '{platform_name} courses and programs where my enrollment is sponsored by {enterprise_customer_name}.'
             ).format(
                 enterprise_customer_name=enterprise_customer.name,
                 platform_name=platform_name,
             ),
-            'continue_text': _('Yes, continue'),
-            'abort_text': _('No, take me back.'),
+            'continue_text': _('Continue'),
+            'abort_text': _('Decline and go back'),
             'policy_dropdown_header': _('Data Sharing Policy'),
             'sharable_items_header': _(
                 'Enrollment, completion, and performance data that may be shared with {enterprise_customer_name} '
                 '(or its designee) for these courses and programs are limited to the following:'
             ).format(
                 enterprise_customer_name=enterprise_customer.name
             ),
@@ -361,16 +426,21 @@
                 platform_name=platform_name,
             ),
             'sharable_items_note_header': _('Please note'),
             'sharable_items_notes': [
                 _('If you decline to consent, that fact may be shared with {enterprise_customer_name}.').format(
                     enterprise_customer_name=enterprise_customer.name
                 ),
+                _(
+                    'Any version of this Data Sharing Policy in a language other than English is provided '
+                    'for convenience and you understand and agree that the English language version will '
+                    'control if there is any conflict.'
+                )
             ],
-            'confirmation_modal_header': _('Are you aware...'),
+            'confirmation_modal_header': _('Are you sure you want to decline?'),
             'confirmation_modal_affirm_decline_text': _('I decline'),
             'confirmation_modal_abort_decline_text': _('View the data sharing policy'),
             'policy_link_template': _('View the {start_link}data sharing policy{end_link}.').format(
                 start_link='<a href="#consent-policy-dropdown-bar" class="policy-dropdown-link background-input" '
                            'id="policy-dropdown-link">',
                 end_link='</a>',
             ),
@@ -463,32 +533,20 @@
         """
         context_data = {}
         if course_id:
             context_data.update({'course_id': course_id, 'course_specific': True})
             if not self.preview_mode:
                 try:
                     catalog_api_client = get_course_catalog_api_service_client(enterprise_customer.site)
-                except ImproperlyConfigured as error:
-                    error_code = 'ENTGDS004'
-                    log_message = (
-                        '[Enterprise DSC API] Course catalog api configuration error. '
-                        'Course: {course_id}, '
-                        'Program: {program_uuid}, '
-                        'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                        'ErrorCode: {error_code}, '
-                        'Message: {message}'.format(
-                            course_id=course_id,
-                            program_uuid=program_uuid,
-                            enterprise_customer_uuid=enterprise_customer.uuid,
-                            error_code=error_code,
-                            message=error,
-                        )
+                except ImproperlyConfigured as exc:
+                    _log_error_message(
+                        CATALOG_API_CONFIG_ERROR_CODE, exception=exc, course_id=course_id,
+                        program_uuid=program_uuid, enterprise_customer_uuid=enterprise_customer.uuid,
                     )
-                    LOGGER.error(log_message)
-                    raise Http404
+                    raise Http404 from exc
 
                 course_start_date = ''
 
                 if self.is_course_run_id(course_id):
                     course_run_details = catalog_api_client.get_course_run(course_id)
                     if course_run_details['start']:
                         course_start_date = parse(course_run_details['start']).strftime('%B %d, %Y')
@@ -527,24 +585,26 @@
         Return a dict of data for the language on the page.
         """
         item = 'course' if course_id else 'program'
         # Translators: bold_start and bold_end are HTML tags for specifying enterprise name in bold text.
         context_data = {
             'consent_request_prompt': _(
                 'To access this {item}, you must first consent to share your learning achievements '
-                'with {bold_start}{enterprise_customer_name}{bold_end}.'
+                'with {bold_start}{enterprise_customer_name}{bold_end}. '
+                'If you decline now, you will be redirected to the previous page.'
             ).format(
                 enterprise_customer_name=enterprise_customer.name,
                 bold_start='<b>',
                 bold_end='</b>',
                 item=item,
             ),
             'confirmation_alert_prompt': _(
-                'In order to start this {item} and use your discount, {bold_start}you must{bold_end} consent '
-                'to share your {item} data with {enterprise_customer_name}.'
+                'To access this {item} and use your discount, you {bold_start}must{bold_end} consent '
+                'to sharing your {item} data with {enterprise_customer_name}. '
+                'If you decline now, you will be redirected to the previous page.'
             ).format(
                 enterprise_customer_name=enterprise_customer.name,
                 bold_start='<b>',
                 bold_end='</b>',
                 item=item,
             ),
             'redirect_url': success_url,
@@ -563,27 +623,38 @@
             published_only=published_only
         )
         if enterprise_consent_page:
             context_data.update(self.get_context_from_db(enterprise_consent_page, platform_name, item, context_data))
         else:
             context_data.update(self.get_default_context(enterprise_customer, platform_name))
 
+        if request.GET.get('left_sidebar_text_override') is not None:
+            # Allows sidebar text to be overridden by calling API
+            context_data.update({'workflow_text_override_available': True,
+                                 'workflow_left_sidebar_text': request.GET.get('left_sidebar_text_override')
+                                 })
+
         return context_data
 
     @staticmethod
     def create_enterprise_course_enrollment(request, enterprise_customer, course_id, license_uuid=None):
         """Create EnterpriseCustomerUser and EnterpriseCourseEnrollment record if not already exists."""
-        enterprise_customer_user, __ = EnterpriseCustomerUser.objects.get_or_create(
+        enterprise_customer_user, __ = EnterpriseCustomerUser.objects.update_or_create(
             enterprise_customer=enterprise_customer,
-            user_id=request.user.id
+            user_id=request.user.id,
+            defaults={'active': True},
+        )
+        enterprise_enrollment_source = EnterpriseEnrollmentSource.get_source(
+            EnterpriseEnrollmentSource.ENROLLMENT_URL,
         )
         enterprise_customer_user.update_session(request)
         __, created = get_create_ent_enrollment(
             course_id,
             enterprise_customer_user,
+            enterprise_enrollment_source,
             license_uuid=license_uuid,
         )
         if created:
             track_enrollment('data-consent-page-enrollment', request.user.id, course_id, request.path)
 
     def _enroll_learner_in_course(
             self,
@@ -599,268 +670,225 @@
 
         # EnterpriseCourseEnrollment will be created when the user will select a course run.
         # A CourseEnrollment record will be created and on the post signal of the CourseEnrollment,
         # an EnterpriseCourseEnrollment record will also get created.
         if course_id and self.is_course_run_id(course_id):
             if license_uuid:
                 enrollment_api_client = EnrollmentApiClient()
-                course_modes = [mode['slug'] for mode in enrollment_api_client.get_course_modes(course_id)]
-                LOGGER.info(
-                    'Retrieved Course Modes for Course {course_id}: {course_modes}'.format(
-                        course_id=course_id,
-                        course_modes=course_modes
-                    )
+                existing_enrollment = enrollment_api_client.get_course_enrollment(
+                    request.user.username, course_id
                 )
-                course_mode = 'verified' if 'verified' in course_modes \
-                    else 'professional' if 'professional' in course_modes \
-                    else 'no-id-professional' if 'no-id-professional' in course_modes \
-                    else 'audit'
-                try:
-                    enrollment_api_client.enroll_user_in_course(
-                        request.user.username,
-                        course_id,
-                        course_mode
-                    )
+                if (
+                        not existing_enrollment or
+                        existing_enrollment.get('mode') == constants.CourseModes.AUDIT or
+                        existing_enrollment.get('is_active') is False
+                ):
+                    course_mode = get_best_mode_from_course_key(course_id)
                     LOGGER.info(
-                        'Created LMS enrollment for User {user} in Course {course_id} '
-                        'with License {license_uuid} in Course Mode {course_mode}.'.format(
-                            user=request.user.username,
+                        'Retrieved Course Mode: {course_modes} for Course {course_id}'.format(
                             course_id=course_id,
-                            license_uuid=license_uuid,
-                            course_mode=course_mode
+                            course_modes=course_mode
                         )
                     )
-                except Exception as exc:  # pylint: disable=broad-except
-                    LOGGER.error(
-                        'Unable to create an LMS enrollment from the DSC view: {exc}'.format(
-                            exc=exc
+                    try:
+                        enrollment_api_client.enroll_user_in_course(
+                            request.user.username,
+                            course_id,
+                            course_mode
                         )
-                    )
-                    raise
+                        LOGGER.info(
+                            'Created LMS enrollment for User {user} in Course {course_id} '
+                            'with License {license_uuid} in Course Mode {course_mode}.'.format(
+                                user=request.user.username,
+                                course_id=course_id,
+                                license_uuid=license_uuid,
+                                course_mode=course_mode
+                            )
+                        )
+                    except HttpClientError as exc:
+                        monitoring.record_exception()
+
+                        default_message = 'No error message provided'
+                        try:
+                            error_message = json.loads(exc.content.decode()).get('message', default_message)
+                        except ValueError:
+                            error_message = default_message
+                        LOGGER.exception(
+                            'Client Error while enrolling user %(user)s in %(course)s via enrollment API: %(message)s',
+                            {
+                                'user': request.user.username,
+                                'course': course_id,
+                                'message': error_message,
+                            }
+                        )
+                        if VERIFIED_MODE_UNAVAILABLE.enrollment_client_error in error_message:
+                            raise VerifiedModeUnavailableException(error_message) from exc
+                        raise Exception(error_message) from exc
             try:
                 self.create_enterprise_course_enrollment(request, enterprise_customer, course_id, license_uuid)
-            except IntegrityError:
-                error_code = 'ENTGDS009'
-                log_message = (
-                    '[Enterprise DSC API] IntegrityError while creating EnterpriseCourseEnrollment.'
-                    'Course: {course_id}, '
-                    'Program: {program_uuid}, '
-                    'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                    'User: {user_id}, '
-                    'License UUID: {license_uuid}, '
-                    'ErrorCode: {error_code}'.format(
-                        course_id=course_id,
-                        program_uuid=program_uuid,
-                        enterprise_customer_uuid=enterprise_customer.uuid,
-                        user_id=request.user.id,
-                        license_uuid=license_uuid,
-                        error_code=error_code,
-                    )
+            except IntegrityError as exc:
+                _log_error_message(
+                    ENROLLMENT_INTEGRITY_ERROR_CODE, exception=exc,
+                    course_id=course_id, program_uuid=program_uuid,
+                    enterprise_customer_uuid=enterprise_customer.uuid,
+                    user_id=request.user.id, license_uuid=license_uuid,
                 )
-                LOGGER.exception(log_message)
+
+    def _do_enrollment_and_redirect(
+        self, request, enterprise_customer,
+        course_id, program_uuid, license_uuid,
+        success_url, failure_url, consent_record=None, consent_provided=True,
+    ):
+        """
+        Helper to enroll a learner into a course, handle an expected error about
+        verified course modes not being available, and return an appropriate
+        redirect url.
+        """
+        error_message_kwargs = {
+            'course_id': course_id,
+            'program_uuid': program_uuid,
+            'enterprise_customer_uuid': enterprise_customer.uuid,
+            'user_id': request.user.id,
+            'license_uuid': license_uuid,
+        }
+        try:
+            self._enroll_learner_in_course(
+                request=request,
+                enterprise_customer=enterprise_customer,
+                course_id=course_id,
+                program_uuid=program_uuid,
+                license_uuid=license_uuid,
+            )
+            if consent_record:
+                consent_record.granted = consent_provided
+                consent_record.save()
+            return redirect(success_url)
+        except VerifiedModeUnavailableException as exc:
+            _log_error_message(
+                error_code=VERIFIED_MODE_UNAVAILABLE_ERROR_CODE,
+                exception=exc,
+                **error_message_kwargs,
+            )
+            return redirect(
+                add_reason_to_failure_url(
+                    failure_url,
+                    VERIFIED_MODE_UNAVAILABLE.failure_reason_message,
+                )
+            )
+        except Exception as exc:  # pylint: disable=broad-except
+            _log_error_message(
+                error_code=LICENSED_ENROLLMENT_ERROR_CODE,
+                exception=exc,
+                **error_message_kwargs,
+            )
+            return redirect(failure_url)
 
     @method_decorator(login_required)
-    def get(self, request):  # pylint: disable=too-many-statements
+    def get(self, request):
         """
         Render a form to collect user input about data sharing consent.
         """
         enterprise_customer_uuid = request.GET.get('enterprise_customer_uuid')
         success_url = request.GET.get('next')
         failure_url = request.GET.get('failure_url')
         course_id = request.GET.get('course_id')
         program_uuid = request.GET.get('program_uuid', '')
         license_uuid = request.GET.get('license_uuid')
         self.preview_mode = bool(request.GET.get('preview_mode', False))
+        source = request.GET.get('source', 'unknown')
+
+        LOGGER.info(
+            f'[ENTERPRISE CONSENT PAGE] Request received. Source: [{source}], User: [{request.user}], '
+            f'Course: [{course_id}], Enterprise: [{enterprise_customer_uuid}]'
+        )
 
         # Get enterprise_customer to start in case we need to render a custom 404 page
         # Then go through other business logic to determine (and potentially overwrite) the enterprise customer
         try:
             enterprise_customer = get_enterprise_customer_or_404(enterprise_customer_uuid)
         except Http404:
-            error_code = 'ENTGDS008'
-            log_message = (
-                '[Enterprise DSC API] No record found for Enterprise customer. '
-                'Course: {course_id}, '
-                'Program: {program_uuid}, '
-                'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                'User: {user_id}, '
-                'ErrorCode: {error_code}'.format(
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    enterprise_customer_uuid=enterprise_customer_uuid,
-                    user_id=request.user.id,
-                    error_code=error_code,
-                )
+            _log_error_message(
+                CUSTOMER_DOES_NOT_EXIST_ERROR_CODE, course_id=course_id, program_uuid=program_uuid,
+                enterprise_customer_uuid=enterprise_customer_uuid, user_id=request.user.id,
             )
-            LOGGER.error(log_message)
             raise
 
         context_data = get_global_context(request, enterprise_customer)
 
         if not self.preview_mode:
             if not self.course_or_program_exist(course_id, program_uuid):
-                error_code = 'ENTGDS000'
-                log_message = (
-                    '[Enterprise DSC API] The course or program with a given id does not exist. '
-                    'Course: {course_id}, '
-                    'Program: {program_uuid}, '
-                    'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                    'User: {user_id}, '
-                    'ErrorCode: {error_code} '.format(
-                        course_id=course_id,
-                        program_uuid=program_uuid,
-                        enterprise_customer_uuid=enterprise_customer_uuid,
-                        user_id=request.user.id,
-                        error_code=error_code,
-                    )
+                return render_page_with_error_code_message(
+                    request, context_data, error_code=CONTENT_ID_DOES_NOT_EXIST_ERROR_CODE,
+                    course_id=course_id, program_uuid=program_uuid,
+                    enterprise_customer_uuid=enterprise_customer_uuid, user_id=request.user.id,
                 )
-                return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
-            # If DSC is entirely disabled proceed to enroll the learner in the course
-            if not enterprise_customer.requests_data_sharing_consent:
-                try:
-                    self._enroll_learner_in_course(
-                        request=request,
-                        enterprise_customer=enterprise_customer,
-                        course_id=course_id,
-                        program_uuid=program_uuid,
-                        license_uuid=license_uuid)
-                    return redirect(success_url)
-                except Exception:  # pylint: disable=broad-except
-                    return redirect(failure_url)
-            # Otherwise determine the learner's consent status
             try:
                 consent_record = get_data_sharing_consent(
                     request.user.username,
                     enterprise_customer_uuid,
                     program_uuid=program_uuid,
                     course_id=course_id
                 )
-            except ImproperlyConfigured as error:
-                error_code = 'ENTGDS004'
-                log_message = (
-                    '[Enterprise DSC API] Course catalog api configuration error. '
-                    'Course: {course_id}, '
-                    'Program: {program_uuid}, '
-                    'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                    'User: {user_id}, '
-                    'ErrorCode: {error_code}, '
-                    'Message: {message}'.format(
-                        course_id=course_id,
-                        program_uuid=program_uuid,
-                        enterprise_customer_uuid=enterprise_customer_uuid,
-                        user_id=request.user.id,
-                        error_code=error_code,
-                        message=error,
-                    )
-                )
-                return render_page_with_error_code_message(request, context_data, error_code, log_message)
-
-            try:
                 consent_required = consent_record.consent_required()
             except AttributeError:
                 consent_required = None
-            except ImproperlyConfigured as error:
-                error_code = 'ENTGDS004'
-                log_message = (
-                    '[Enterprise DSC API] Course catalog api configuration error. '
-                    'Course: {course_id}, '
-                    'Program: {program_uuid}, '
-                    'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                    'User: {user_id}, '
-                    'ErrorCode: {error_code}, '
-                    'Message: {message}'.format(
-                        course_id=course_id,
-                        program_uuid=program_uuid,
-                        enterprise_customer_uuid=enterprise_customer_uuid,
-                        user_id=request.user.id,
-                        error_code=error_code,
-                        message=error,
-                    )
+            except ImproperlyConfigured as exc:
+                return render_page_with_error_code_message(
+                    request, context_data, error_code=CATALOG_API_CONFIG_ERROR_CODE, exception=exc,
+                    course_id=course_id, program_uuid=program_uuid,
+                    enterprise_customer_uuid=enterprise_customer_uuid, user_id=request.user.id
+                )
+
+            if (
+                not enterprise_customer.requests_data_sharing_consent or
+                should_upgrade_to_licensed_enrollment(consent_record, license_uuid)
+            ):
+                return self._do_enrollment_and_redirect(
+                    request, enterprise_customer,
+                    course_id, program_uuid, license_uuid,
+                    success_url, failure_url,
                 )
-                return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
             if consent_record is None or not consent_required:
-                error_code = 'ENTGDS002'
-                log_message = (
-                    '[Enterprise DSC API] There is no consent record, or consent is not required. '
-                    'Course: {course_id}, '
-                    'Program: {program_uuid}, '
-                    'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                    'User: {user_id}, '
-                    'ErrorCode: {error_code}, '
-                    'Context: {context}'.format(
-                        course_id=course_id,
-                        program_uuid=program_uuid,
-                        enterprise_customer_uuid=enterprise_customer_uuid,
-                        user_id=request.user.id,
-                        error_code=error_code,
-                        context={
-                            'consent_record': consent_record,
-                            'consent_required': consent_required,
-                        },
-                    )
+                _log_error_message(
+                    NO_CONSENT_RECORD_ERROR_CODE, logger_method=LOGGER.info,
+                    course_id=course_id, program_uuid=program_uuid, user_id=request.user.id,
+                    enterprise_customer_uuid=enterprise_customer_uuid,
+                    consent_record=consent_record, consent_required=consent_required,
                 )
-                LOGGER.info(log_message)
                 redirect_url = success_url if success_url else LMS_DASHBOARD_URL
                 return redirect(redirect_url)
             enterprise_customer = consent_record.enterprise_customer
         elif not request.user.is_staff:
             raise PermissionDenied()
 
         # Retrieve context data again now that enterprise_customer logic has been run
         context_data = get_global_context(request, enterprise_customer)
 
         if not (success_url and failure_url):
-            error_code = 'ENTGDS003'
-            log_message = (
-                '[Enterprise DSC API] Required request values missing for action to be carried out. '
-                'Course: {course_id}, '
-                'Program: {program_uuid}, '
-                'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                'User: {user_id}, '
-                'ErrorCode: {error_code}, '
-                'Context: {context}'.format(
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    enterprise_customer_uuid=enterprise_customer_uuid,
-                    user_id=request.user.id,
-                    error_code=error_code,
-                    context={
-                        'success_url': success_url,
-                        'failure_url': failure_url,
-                    },
-                )
+            return render_page_with_error_code_message(
+                request, context_data, REDIRECT_URLS_MISSING_ERROR_CODE,
+                course_id=course_id, enterprise_customer_uuid=enterprise_customer_uuid,
+                user_id=request.user.id, success_url=success_url, failure_url=failure_url,
             )
-            return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
         try:
             updated_context_dict = self.get_course_or_program_context(
                 enterprise_customer,
                 course_id=course_id,
                 program_uuid=program_uuid
             )
             context_data.update(updated_context_dict)
         except Http404:
-            error_code = 'ENTGDS004'
-            log_message = (
-                '[Enterprise DSC API] Course catalog api configuration error. '
-                'Course: {course_id}, '
-                'Program: {program_uuid}, '
-                'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                'User: {user_id}, '
-                'ErrorCode: {error_code}'.format(
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    enterprise_customer_uuid=enterprise_customer_uuid,
-                    user_id=request.user.id,
-                    error_code=error_code,
-                )
+            return render_page_with_error_code_message(
+                request, context_data, CATALOG_API_CONFIG_ERROR_CODE,
+                course_id=course_id, program_uuid=program_uuid,
+                enterprise_customer_uuid=enterprise_customer_uuid, user_id=request.user.id,
             )
-            return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
         context_data.update(self.get_page_language_context_data(
             course_id=course_id,
             enterprise_customer=enterprise_customer,
             success_url=success_url,
             failure_url=failure_url,
             license_uuid=license_uuid,
@@ -871,140 +899,94 @@
         return render(request, 'enterprise/grant_data_sharing_permissions.html', context=context_data)
 
     @method_decorator(login_required)
     def post(self, request):
         """
         Process the above form.
         """
-        enterprise_uuid = request.POST.get('enterprise_customer_uuid')
+        enterprise_customer_uuid = request.POST.get('enterprise_customer_uuid')
         success_url = request.POST.get('redirect_url')
         failure_url = request.POST.get('failure_url')
         course_id = request.POST.get('course_id', '')
         program_uuid = request.POST.get('program_uuid', '')
         license_uuid = request.POST.get('license_uuid')
 
         try:
-            enterprise_customer = get_enterprise_customer_or_404(enterprise_uuid)
+            enterprise_customer = get_enterprise_customer_or_404(enterprise_customer_uuid)
         except Http404:
-            error_code = 'ENTGDS008'
-            log_message = (
-                '[Enterprise DSC API] No record found for Enterprise customer. '
-                'Course: {course_id}, '
-                'Program: {program_uuid}, '
-                'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                'User: {user_id}, '
-                'ErrorCode: {error_code}'.format(
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    enterprise_customer_uuid=enterprise_uuid,
-                    user_id=request.user.id,
-                    error_code=error_code,
-                )
+            _log_error_message(
+                CUSTOMER_DOES_NOT_EXIST_ERROR_CODE, course_id=course_id, program_uuid=program_uuid,
+                enterprise_customer_uuid=enterprise_customer_uuid, user_id=request.user.id,
             )
-            LOGGER.error(log_message)
             raise
 
         context_data = get_global_context(request, enterprise_customer)
 
+        success_url = get_safe_redirect_url(success_url)
+        failure_url = get_safe_redirect_url(failure_url)
         if not (success_url and failure_url):
-            error_code = 'ENTGDS005'
-            log_message = (
-                '[Enterprise DSC API] Required request values missing for action to be carried out. '
-                'Course: {course_id}, '
-                'Program: {program_uuid}, '
-                'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                'User: {user_id}, '
-                'ErrorCode: {error_code}, '
-                'Context: {context}'.format(
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    enterprise_customer_uuid=enterprise_uuid,
-                    user_id=request.user.id,
-                    error_code=error_code,
-                    context={
-                        'success_url': success_url,
-                        'failure_url': failure_url,
-                    },
-                )
+            return render_page_with_error_code_message(
+                request, context_data, REDIRECT_URLS_MISSING_ERROR_CODE,
+                course_id=course_id, enterprise_customer_uuid=enterprise_customer_uuid,
+                user_id=request.user.id, success_url=success_url, failure_url=failure_url,
             )
-            return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
         if not self.course_or_program_exist(course_id, program_uuid):
-            error_code = 'ENTGDS006'
-            log_message = (
-                '[Enterprise DSC API] The course or program with a given id does not exist. '
-                'Course: {course_id}, '
-                'Program: {program_uuid}, '
-                'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                'User: {user_id}, '
-                'ErrorCode: {error_code}'.format(
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    enterprise_customer_uuid=enterprise_uuid,
-                    user_id=request.user.id,
-                    error_code=error_code,
-                )
+            return render_page_with_error_code_message(
+                request, context_data, error_code=CONTENT_ID_DOES_NOT_EXIST_ERROR_CODE,
+                course_id=course_id, program_uuid=program_uuid,
+                enterprise_customer_uuid=enterprise_customer_uuid, user_id=request.user.id,
             )
-            return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
         consent_record = get_data_sharing_consent(
             request.user.username,
-            enterprise_uuid,
+            enterprise_customer_uuid,
             program_uuid=program_uuid,
             course_id=course_id
         )
         if consent_record is None:
-            error_code = 'ENTGDS007'
-            log_message = (
-                '[Enterprise DSC API] There is no consent record, or consent is not required. '
-                'Course: {course_id}, '
-                'Program: {program_uuid}, '
-                'EnterpriseCustomer: {enterprise_customer_uuid}, '
-                'User: {user_id}, '
-                'ErrorCode: {error_code}'.format(
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    enterprise_customer_uuid=enterprise_uuid,
-                    user_id=request.user.id,
-                    error_code=error_code,
-                )
+            return render_page_with_error_code_message(
+                request, context_data, error_code=NO_CONSENT_RECORD_ERROR_CODE,
+                course_id=course_id, program_uuid=program_uuid,
+                enterprise_customer_uuid=enterprise_customer_uuid, user_id=request.user.id
             )
-            return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
         defer_creation = request.POST.get('defer_creation')
         consent_provided = bool(request.POST.get('data_sharing_consent', False))
         if defer_creation is None and consent_record.consent_required() and consent_provided:
-            try:
-                self._enroll_learner_in_course(
-                    request=request,
-                    enterprise_customer=enterprise_customer,
-                    course_id=course_id,
-                    program_uuid=program_uuid,
-                    license_uuid=license_uuid)
-                consent_record.granted = consent_provided
-                consent_record.save()
-            except Exception:  # pylint: disable=broad-except
-                return redirect(failure_url)
-
-        return redirect(success_url if consent_provided else failure_url)
+            return self._do_enrollment_and_redirect(
+                request, enterprise_customer,
+                course_id, program_uuid, license_uuid,
+                success_url, failure_url, consent_record=consent_record,
+            )
+        if consent_provided:
+            return redirect(success_url)
+
+        return redirect(
+            add_reason_to_failure_url(
+                failure_url,
+                DSC_DENIED.failure_reason_message,
+            )
+        )
 
 
 class EnterpriseLoginView(FormView):
     """
     Allow an enterprise learner to login by enterprise customer's slug login.
     """
 
     form_class = EnterpriseLoginForm
     template_name = 'enterprise/enterprise_customer_login_page.html'
 
     def get_context_data(self, **kwargs):
         """Return the context data needed to render the view."""
-        context_data = super(EnterpriseLoginView, self).get_context_data(**kwargs)
+        context_data = super().get_context_data(**kwargs)
+        context_data.update(get_global_context(self.request))
         context_data.update({
-            'page_title': _(u'Enterprise Slug Login'),
+            'page_title': _('Enterprise Slug Login'),
             'enterprise_login_title_message': ENTERPRISE_LOGIN_TITLE,
             'enterprise_login_subtitle_message': ENTERPRISE_LOGIN_SUBTITLE,
         })
         return context_data
 
     def form_invalid(self, form):
         """
@@ -1022,15 +1004,15 @@
         if not get_provider_login_url:
             return JsonResponse({'errors': [ERROR_MESSAGE_FOR_SLUG_LOGIN]}, status=400)
 
         return JsonResponse(
             {
                 "url": get_provider_login_url(
                     self.request,
-                    get_enterprise_customer_idp(form.cleaned_data['enterprise_slug']).provider_id
+                    form.cleaned_data['provider_id'],
                 )
             }
         )
 
 
 class EnterpriseProxyLoginView(View):
     """
@@ -1044,37 +1026,47 @@
         redirect_to = LMS_LOGIN_URL
         (scheme, netloc, path, query, fragment) = list(urlsplit(redirect_to))
         query_dict = parse_qs(query)
         query_params = request.GET
 
         # Return 404 response if enterprise_slug not present or invalid
         enterprise_slug = query_params.get('enterprise_slug')
-        enterprise_customer = get_enterprise_customer_by_slug_or_404(enterprise_slug)
+        enterprise_invite_key = query_params.get('enterprise_customer_invite_key')
+        if not enterprise_slug and not enterprise_invite_key:
+            raise Http404
+
+        if enterprise_slug:
+            enterprise_customer = get_enterprise_customer_by_slug_or_404(enterprise_slug)
+        else:
+            enterprise_customer = get_enterprise_customer_by_invite_key_or_404(enterprise_invite_key)
 
         # Add the next param to the redirect's query parameters
         next_param = query_params.get('next')
         if next_param:
             query_dict['next'] = next_param
         else:
             # Default redirect is to the Learner Portal for the given Enterprise
             learner_portal_base_url = get_configuration_value(
                 'ENTERPRISE_LEARNER_PORTAL_BASE_URL',
-                settings.ENTERPRISE_LEARNER_PORTAL_BASE_URL
+                settings.ENTERPRISE_LEARNER_PORTAL_BASE_URL,
             )
-            query_dict['next'] = learner_portal_base_url + '/' + enterprise_slug
+            query_dict['next'] = f"{learner_portal_base_url}/{enterprise_customer.slug}"
+
+        tpa_hint_param = query_params.get('tpa_hint')
+        tpa_hint = enterprise_customer.get_tpa_hint(tpa_hint_param)
 
-        if enterprise_customer.identity_provider:
+        if tpa_hint:
             # Add the tpa_hint to the redirect's 'next' query parameter
             # Redirect will be to the Enterprise Customer's TPA provider
-            tpa_hint = enterprise_customer.identity_provider
             tpa_next_param = {
                 'tpa_hint': tpa_hint,
             }
             query_dict['next'] = update_query_parameters(str(query_dict['next']), tpa_next_param)
         else:
+            # If there's no linked IDP
             # Add Enterprise Customer UUID and proxy_login to the redirect's query parameters
             # Redirect will be to the edX Logistration with Enterprise Proxy Login sidebar
             query_dict['enterprise_customer'] = [str(enterprise_customer.uuid)]
             query_dict['proxy_login'] = [True]
 
         new_query = urlencode(query_dict, doseq=True)
         new_redirect_to = urlunsplit((scheme, netloc, path, new_query, fragment))
@@ -1088,37 +1080,38 @@
     """
 
     form_class = EnterpriseSelectionForm
     template_name = 'enterprise/enterprise_customer_select_form.html'
 
     def get_initial(self):
         """Return the initial data to use for forms on this view."""
-        initial = super(EnterpriseSelectionView, self).get_initial()
+        initial = super().get_initial()
         enterprises = EnterpriseCustomerUser.objects.filter(
             user_id=self.request.user.id
         ).values_list(
             'enterprise_customer__uuid', 'enterprise_customer__name'
         )
         initial.update({
             'enterprises': [(str(uuid), name) for uuid, name in enterprises],
-            'success_url': self.request.GET.get('success_url'),
+            'success_url': get_safe_redirect_url(self.request.GET.get('success_url')),
             'user_id': self.request.user.id
         })
         LOGGER.info(
             '[Enterprise Selection Page] Request recieved. SuccessURL: %s',
             self.request.GET.get('success_url')
         )
         return initial
 
     def get_context_data(self, **kwargs):
         """Return the context data needed to render the view."""
-        context_data = super(EnterpriseSelectionView, self).get_context_data(**kwargs)
+        context_data = super().get_context_data(**kwargs)
+        context_data.update(get_global_context(self.request))
         context_data.update({
-            'page_title': _(u'Select Organization'),
-            'select_enterprise_message_title': _(u'Select an organization'),
+            'page_title': _('Select Organization'),
+            'select_enterprise_message_title': _('Select an organization'),
             'select_enterprise_message_subtitle': ENTERPRISE_SELECT_SUBTITLE,
         })
         return context_data
 
     def form_invalid(self, form):
         """
         If the form is invalid then return the errors.
@@ -1188,65 +1181,66 @@
         enrollment_api_client = EnrollmentApiClient()
         course_modes = enrollment_api_client.get_course_modes(course_id)
 
         # Verify that the request user belongs to the enterprise against the
         # provided `enterprise_uuid`.
         enterprise_customer = get_enterprise_customer_or_404(enterprise_uuid)
         enterprise_customer_user = get_enterprise_customer_user(request.user.id, enterprise_customer.uuid)
+        enterprise_enrollment_source = EnterpriseEnrollmentSource.get_source(
+            EnterpriseEnrollmentSource.ENROLLMENT_URL)
 
         if not course_modes:
             context_data = get_global_context(request, enterprise_customer)
-            error_code = 'ENTHCE000'
-            log_message = (
-                '[Enterprise Enrollment] Course_modes for course not found. '
-                'Course: {course_id}, '
-                'EnterpriseCatalog: {enterprise_catalog_uuid}, '
-                'ErrorCode: {error_code}, '
-                'User: {userid}'.format(
-                    userid=request.user.id,
-                    enterprise_catalog_uuid=enterprise_catalog_uuid,
-                    course_id=course_id,
-                    error_code=error_code
-                )
+            return render_page_with_error_code_message(
+                request, context_data, error_code=COURSE_MODE_DOES_NOT_EXIST_ERROR_CODE,
+                user_id=request.user.id, enterprise_catalog_uuid=enterprise_catalog_uuid,
+                course_id=course_id,
             )
-            return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
         selected_course_mode = None
         for course_mode in course_modes:
             if course_mode['slug'] == enrollment_course_mode:
                 selected_course_mode = course_mode
                 break
 
         if not selected_course_mode:
             return redirect(LMS_DASHBOARD_URL)
 
         # Create the Enterprise backend database records for this course
         # enrollment
         __, created = get_create_ent_enrollment(
             course_id,
-            enterprise_customer_user
+            enterprise_customer_user,
+            enterprise_enrollment_source
         )
         if created:
             track_enrollment('course-landing-page-enrollment', request.user.id, course_id, request.get_full_path())
 
         DataSharingConsent.objects.update_or_create(
             username=enterprise_customer_user.username,
             course_id=course_id,
             enterprise_customer=enterprise_customer_user.enterprise_customer,
             defaults={
                 'granted': True
             },
         )
 
-        audit_modes = getattr(settings, 'ENTERPRISE_COURSE_ENROLLMENT_AUDIT_MODES', ['audit', 'honor'])
+        audit_modes = getattr(
+            settings,
+            'ENTERPRISE_COURSE_ENROLLMENT_AUDIT_MODES',
+            [constants.CourseModes.AUDIT, constants.CourseModes.HONOR]
+        )
         if selected_course_mode['slug'] in audit_modes:
             # In case of Audit course modes enroll the learner directly through
             # enrollment API client and redirect the learner to dashboard.
             enrollment_api_client.enroll_user_in_course(
-                request.user.username, course_id, selected_course_mode['slug']
+                request.user.username,
+                course_id,
+                selected_course_mode['slug'],
+                enterprise_uuid=str(enterprise_customer_user.enterprise_customer.uuid)
             )
 
             return redirect(LMS_COURSEWARE_URL.format(course_id=course_id))
 
         # redirect the enterprise learner to the ecommerce flow in LMS
         # Note: LMS start flow automatically detects the paid mode
         premium_flow = LMS_START_PREMIUM_COURSE_FLOW_URL.format(course_id=course_id)
@@ -1443,15 +1437,15 @@
             # display the generic error message.
             return enterprise_customer, course, course_run, course_modes
 
         modes = self.get_available_course_modes(request, course_run_id, enterprise_catalog)
         audit_modes = getattr(
             settings,
             'ENTERPRISE_COURSE_ENROLLMENT_AUDIT_MODES',
-            ['audit', 'honor']
+            [constants.CourseModes.AUDIT, constants.CourseModes.HONOR]
         )
 
         for mode in modes:
             if mode['min_price']:
                 price_text = get_price_text(mode['min_price'], request)
             else:
                 price_text = _('FREE')
@@ -1514,15 +1508,15 @@
                 course_start_date = parse(course_run['start']).strftime('%B %d, %Y')
                 now = datetime.datetime.now(pytz.UTC)
                 course_in_future = parse(course_run['start']) > now
             if course_run['start'] and course_run['end'] and course_run['weeks_to_complete']:
                 course_end_date = parse(course_run['end']).strftime('%B %d, %Y')
                 weeks_to_complete = course_run['weeks_to_complete']
                 course_duration = _('{num_weeks}, starting on {start_date} and ending at {end_date}').format(
-                    num_weeks=ungettext(
+                    num_weeks=ngettext(
                         '{} week',
                         '{} weeks',
                         weeks_to_complete
                     ).format(weeks_to_complete),
                     start_date=course_start_date,
                     end_date=course_end_date,
                 )
@@ -1584,14 +1578,30 @@
                     strong_start='<strong>',
                     strong_end='</strong>',
                 ),
                 'hide_course_original_price': enterprise_customer.hide_course_original_price
             })
             html_template_for_rendering = 'enterprise/enterprise_course_enrollment_page.html'
 
+            LOGGER.info(
+                '[ENTERPRISE ENROLLMENT PAGE] Context Data. Data: [%s]',
+                {
+                    'enterprise_customer_name': enterprise_customer.name,
+                    'user': request.user.username,
+                    'course': course.get('key'),
+                    'course_run': course_run.get('key'),
+                    'course_enrollable': course_enrollable,
+                    'course_start_date': course_start_date,
+                    'course_modes': course_modes,
+                    'premium_modes': premium_modes,
+                    'catalog': enterprise_catalog_uuid,
+                    'hide_course_original_price': enterprise_customer.hide_course_original_price
+                }
+            )
+
         context_data.update({
             'page_title': _('Confirm your course'),
             'confirmation_text': _('Confirm your course'),
             'starts_at_text': _('Starts'),
             'view_course_details_text': _('View Course Details'),
             'select_mode_text': _('Please select one:'),
             'price_text': _('Price'),
@@ -1615,26 +1625,26 @@
             request, enterprise_uuid, course_id
         )
         enrollment_source = EnterpriseEnrollmentSource.get_source(
             EnterpriseEnrollmentSource.ENROLLMENT_URL
         )
 
         # Create a link between the user and the enterprise customer if it does not already exist.
-        enterprise_customer_user, __ = EnterpriseCustomerUser.objects.get_or_create(
+        enterprise_customer_user, __ = EnterpriseCustomerUser.objects.update_or_create(
             enterprise_customer=enterprise_customer,
-            user_id=request.user.id
+            user_id=request.user.id,
+            defaults={'active': True},
         )
         enterprise_customer_user.update_session(request)
 
         data_sharing_consent = DataSharingConsent.objects.proxied_get(
             username=enterprise_customer_user.username,
             course_id=course_id,
             enterprise_customer=enterprise_customer
         )
-
         try:
             enterprise_course_enrollment = EnterpriseCourseEnrollment.objects.get(
                 enterprise_customer_user__enterprise_customer=enterprise_customer,
                 enterprise_customer_user__user_id=request.user.id,
                 course_id=course_id
             )
 
@@ -1667,30 +1677,56 @@
             enterprise_customer.uuid,
             course_id=course_id
         ).consent_required()
         if not selected_course_mode.get('premium') and not user_consent_needed:
             # For the audit course modes (audit, honor), where DSC is not
             # required, enroll the learner directly through enrollment API
             # client and redirect the learner to LMS courseware page.
-            if not enterprise_course_enrollment:
-                # Create the Enterprise backend database records for this course enrollment.
-                EnterpriseCourseEnrollment.objects.create(
-                    enterprise_customer_user=enterprise_customer_user,
-                    course_id=course_id,
-                    source=enrollment_source
-                )
-                track_enrollment('course-landing-page-enrollment', request.user.id, course_id, request.get_full_path())
-
+            succeeded = True
             client = EnrollmentApiClient()
-            client.enroll_user_in_course(
-                request.user.username,
-                course_id,
-                selected_course_mode_name,
-                cohort=cohort_name
-            )
+            try:
+                client.enroll_user_in_course(
+                    request.user.username,
+                    course_id,
+                    selected_course_mode_name,
+                    cohort=cohort_name,
+                    enterprise_uuid=str(enterprise_customer.uuid)
+                )
+            except HttpClientError as exc:
+                succeeded = False
+                default_message = 'No error message provided'
+                try:
+                    error_message = json.loads(exc.content.decode()).get('message', default_message)
+                except ValueError:
+                    error_message = default_message
+                LOGGER.exception(
+                    'Error while enrolling user %(user)s: %(message)s',
+                    {'user': self.user_id, 'message': error_message},
+                )
+            if succeeded:
+                try:
+                    # Create the Enterprise backend database records for this course enrollment.
+                    __, created = EnterpriseCourseEnrollment.objects.get_or_create(
+                        enterprise_customer_user=enterprise_customer_user,
+                        course_id=course_id,
+                        defaults={
+                            'source': enrollment_source
+                        }
+                    )
+                    if created:
+                        track_enrollment(
+                            'course-landing-page-enrollment', request.user.id,
+                            course_id, request.get_full_path(),
+                        )
+                except IntegrityError:
+                    LOGGER.exception(
+                        "[ENTERPRISE ENROLLMENT PAGE] IntegrityError on attempt at EnterpriseCourseEnrollment "
+                        "for enterprise customer user with id [%s] and course id [%s]",
+                        enterprise_customer_user.user_id, course_id,
+                    )
 
             return redirect(LMS_COURSEWARE_URL.format(course_id=course_id))
 
         if user_consent_needed:
             # For the audit course modes (audit, honor) or for the premium
             # course modes (Verified, Prof Ed) where DSC is required, redirect
             # the learner to course specific DSC with enterprise UUID from
@@ -1765,15 +1801,19 @@
             * No enterprise customer uuid kwarg `enterprise_uuid` in request.
             * No enterprise customer found against the enterprise customer
                 uuid `enterprise_uuid` in the request kwargs.
             * No course is found in database against the provided `course_id`.
 
         """
         # Check to see if access to the course run is restricted for this user.
-        embargo_url = EmbargoApiClient.redirect_if_blocked([course_id], request.user, get_ip(request), request.path)
+        embargo_url = EmbargoApiClient.redirect_if_blocked(
+            request=request,
+            course_run_ids=[course_id],
+            user=request.user,
+        )
         if embargo_url:
             return redirect(embargo_url)
 
         enterprise_customer, course, course_run, modes = self.get_base_details(
             request, enterprise_uuid, course_id
         )
         enterprise_customer_user = get_enterprise_customer_user(request.user.id, enterprise_uuid)
@@ -1887,15 +1927,15 @@
             'course_effort': ungettext_min_max(
                 '{} hour per week',
                 '{} hours per week',
                 '{}-{} hours per week',
                 course_run_details['min_effort'] or None,
                 course_run_details['max_effort'] or None,
             ) or '',
-            'weeks_to_complete': ungettext(
+            'weeks_to_complete': ngettext(
                 '{} week',
                 '{} weeks',
                 weeks_to_complete
             ).format(weeks_to_complete) if weeks_to_complete else '',
         })
         return course, None
 
@@ -1985,15 +2025,15 @@
             # We're enrolled in the program if we have certificate-eligible enrollment in even 1 of its courses.
             extended_course_run = extended_course['course_runs'][0]
             if extended_course_run['is_enrolled'] and extended_course_run['upgrade_url'] is None:
                 program_details['enrolled_in_program'] = True
                 enrollment_count += 1
 
         # We're certificate eligible for the program if we have certificate-eligible enrollment in all of its courses.
-        program_details['certificate_eligible_for_program'] = (enrollment_count == len(program_details['courses']))
+        program_details['certificate_eligible_for_program'] = enrollment_count == len(program_details['courses'])
         program_details['type_details'] = program_type
         return program_details, None
 
     def get_enterprise_program_enrollment_page(self, request, enterprise_customer, program_details):
         """
         Render Enterprise-specific program enrollment page.
         """
@@ -2004,15 +2044,15 @@
         program_title = program_details['title']
         program_type_details = program_details['type_details']
         program_type = program_type_details['name']
 
         # Make any modifications for singular/plural-dependent text.
         program_courses = program_details['courses']
         course_count = len(program_courses)
-        course_count_text = ungettext(
+        course_count_text = ngettext(
             '{count} Course',
             '{count} Courses',
             course_count,
         ).format(count=course_count)
         effort_info_text = ungettext_min_max(
             '{} hour per week, per course',
             '{} hours per week, per course',
@@ -2143,15 +2183,19 @@
             return redirect(LMS_PROGRAMS_DASHBOARD_URL.format(uuid=program_uuid))
 
         # Check to see if access to any of the course runs in the program are restricted for this user.
         course_run_ids = []
         for course in program_details['courses']:
             for course_run in course['course_runs']:
                 course_run_ids.append(course_run['key'])
-        embargo_url = EmbargoApiClient.redirect_if_blocked(course_run_ids, request.user, get_ip(request), request.path)
+        embargo_url = EmbargoApiClient.redirect_if_blocked(
+            request=request,
+            course_run_ids=course_run_ids,
+            user=request.user,
+        )
         if embargo_url:
             return redirect(embargo_url)
 
         return self.get_enterprise_program_enrollment_page(request, enterprise_customer, program_details)
 
     @method_decorator(enterprise_login_required)
     def post(self, request, enterprise_uuid, program_uuid):
@@ -2159,17 +2203,18 @@
         Process a submitted track selection form for the enterprise.
         """
         verify_edx_resources()
 
         # Create a link between the user and the enterprise customer if it does not already exist.
         enterprise_customer = get_enterprise_customer_or_404(enterprise_uuid)
         with transaction.atomic():
-            enterprise_customer_user, __ = EnterpriseCustomerUser.objects.get_or_create(
+            enterprise_customer_user, __ = EnterpriseCustomerUser.objects.update_or_create(
                 enterprise_customer=enterprise_customer,
-                user_id=request.user.id
+                user_id=request.user.id,
+                defaults={'active': True},
             )
             enterprise_customer_user.update_session(request)
 
         context_data = get_global_context(request, enterprise_customer)
         program_details, error_code = self.get_program_details(request, program_uuid, enterprise_customer)
         if error_code:
             return render(
@@ -2215,15 +2260,14 @@
 
 
 class RouterView(NonAtomicView):
     """
     A router or gateway view for managing Enterprise workflows.
     """
 
-    # pylint: disable=invalid-name
     COURSE_ENROLLMENT_VIEW_URL = '/enterprise/{}/course/{}/enroll/'
     PROGRAM_ENROLLMENT_VIEW_URL = '/enterprise/{}/program/{}/enroll/'
     HANDLE_CONSENT_ENROLLMENT_VIEW_URL = '/enterprise/handle_consent_enrollment/{}/course/{}/'
     VIEWS = {
         COURSE_ENROLLMENT_VIEW_URL: CourseEnrollmentView,
         PROGRAM_ENROLLMENT_VIEW_URL: ProgramEnrollmentView,
         HANDLE_CONSENT_ENROLLMENT_VIEW_URL: HandleConsentEnrollment,
@@ -2254,16 +2298,16 @@
         :param user:
         :param enterprise_customer:
         :param course_key:
         :return: course_run_id
         """
         try:
             course = get_course_catalog_api_service_client(enterprise_customer.site).get_course_details(course_key)
-        except ImproperlyConfigured:
-            raise Http404
+        except ImproperlyConfigured as error:
+            raise Http404 from error
 
         users_all_enrolled_courses = EnrollmentApiClient().get_enrolled_courses(user.username)
         users_active_course_runs = get_active_course_runs(
             course,
             users_all_enrolled_courses
         ) if users_all_enrolled_courses else []
         course_run = get_current_course_run(course, users_active_course_runs)
@@ -2282,18 +2326,18 @@
         - The user's being routed to the course enrollment landing page.
         - The customer's catalog contains the course in question.
         - The audit track is an available mode for the course.
         """
         course_identifier = course_key if course_key else resource_id
 
         # Return it in one big statement to utilize short-circuiting behavior. Avoid the API call if possible.
-        return request.GET.get('audit') and \
+        return request.GET.get(constants.CourseModes.AUDIT) and \
             request.path == self.COURSE_ENROLLMENT_VIEW_URL.format(enterprise_customer.uuid, course_identifier) and \
             enterprise_customer.catalog_contains_course(resource_id) and \
-            EnrollmentApiClient().has_course_mode(resource_id, 'audit')
+            EnrollmentApiClient().has_course_mode(resource_id, constants.CourseModes.AUDIT)
 
     def redirect(self, request, *args, **kwargs):
         """
         Redirects to the appropriate view depending on where the user came from.
         """
         enterprise_customer_uuid, course_run_id, course_key, program_uuid = RouterView.get_path_variables(**kwargs)
         resource_id = course_key or course_run_id or program_uuid
@@ -2309,93 +2353,110 @@
     @method_decorator(enterprise_login_required)
     @method_decorator(force_fresh_session)
     def get(self, request, *args, **kwargs):
         """
         Run some custom GET logic for Enterprise workflows before routing the user through existing views.
 
         In particular, before routing to existing views:
+
         - If the requested resource is a course, find the current course run for that course,
           and make that course run the requested resource instead.
+
         - Look to see whether a request is eligible for direct audit enrollment, and if so, directly enroll the user.
         """
         enterprise_customer_uuid, course_run_id, course_key, program_uuid = RouterView.get_path_variables(**kwargs)
         enterprise_customer = get_enterprise_customer_or_404(enterprise_customer_uuid)
         if course_key:
             try:
                 course_run_id = RouterView.get_course_run_id(request.user, enterprise_customer, course_key)
             except Http404:
                 context_data = get_global_context(request, enterprise_customer)
-                error_code = 'ENTRV000'
-                log_message = (
-                    'Could not find course run with id {course_run_id} '
-                    'for course key {course_key} and program_uuid {program_uuid} '
-                    'for enterprise_customer_uuid {enterprise_customer_uuid} '
-                    'Returned error code {error_code} to user {userid}'.format(
-                        course_key=course_key,
-                        course_run_id=course_run_id,
-                        enterprise_customer_uuid=enterprise_customer_uuid,
-                        error_code=error_code,
-                        userid=request.user.id,
-                        program_uuid=program_uuid,
-                    )
+                return render_page_with_error_code_message(
+                    request, context_data, error_code=ROUTER_VIEW_NO_COURSE_ID_ERROR_CODE,
+                    course_key=course_key, course_run_id=course_run_id, program_uuid=program_uuid,
+                    enterprise_customer_uuid=enterprise_customer_uuid, user_id=request.user.id,
                 )
-                return render_page_with_error_code_message(request, context_data, error_code, log_message)
             kwargs['course_id'] = course_run_id
 
-        # Enrollments through Cornerstone have some params in querystring, need to store those params if exists.
-        if course_key:
-            create_cornerstone_learner_data(request, course_key)
+            CornerstoneEnterpriseCustomerConfiguration = apps.get_model(
+                'cornerstone',
+                'CornerstoneEnterpriseCustomerConfiguration'
+            )
+            with transaction.atomic():
+                # The presense of a sessionToken and subdomain param indicates a Cornerstone redirect
+                # We need to store this sessionToken for api access
+                csod_session_token = request.GET.get('sessionToken')
+                csod_subdomain = request.GET.get("subdomain")
+                if csod_session_token and csod_subdomain:
+                    LOGGER.info(
+                        f'integrated_channel=CSOD, '
+                        f'integrated_channel_enterprise_customer_uuid={enterprise_customer.uuid}, '
+                        f'integrated_channel_lms_user={request.user.id}, '
+                        f'integrated_channel_course_key={course_key}, '
+                        'enrollment redirect'
+                    )
+                    cornerstone_customer_configuration = \
+                        CornerstoneEnterpriseCustomerConfiguration.get_by_customer_and_subdomain(
+                            enterprise_customer=enterprise_customer,
+                            customer_subdomain=csod_subdomain
+                        )
+                    if cornerstone_customer_configuration:
+                        cornerstone_customer_configuration.session_token = csod_session_token
+                        cornerstone_customer_configuration.session_token_modified = localized_utcnow()
+                        cornerstone_customer_configuration.save()
+                        create_cornerstone_learner_data(request, cornerstone_customer_configuration, course_key)
+                    else:
+                        LOGGER.error(
+                            f'integrated_channel=CSOD, '
+                            f'integrated_channel_enterprise_customer_uuid={enterprise_customer.uuid}, '
+                            f'integrated_channel_lms_user={request.user.id}, '
+                            f'integrated_channel_course_key={course_key}, '
+                            f'unable to find cornerstone config matching subdomain {request.GET.get("subdomain")}'
+                        )
 
         # Ensure that the link is saved to the database prior to making some call in a downstream view
         # which may need to know that the user belongs to an enterprise customer.
         with transaction.atomic():
-            enterprise_customer_user, __ = EnterpriseCustomerUser.objects.get_or_create(
+            enterprise_customer_user, __ = EnterpriseCustomerUser.objects.update_or_create(
                 enterprise_customer=enterprise_customer,
-                user_id=request.user.id
+                user_id=request.user.id,
+                defaults={'active': True},
             )
             enterprise_customer_user.update_session(request)
 
         # Directly enroll in audit mode if the request in question has full direct audit enrollment eligibility.
         resource_id = course_run_id or program_uuid
         if self.eligible_for_direct_audit_enrollment(request, enterprise_customer, resource_id, course_key):
             try:
-                enterprise_customer_user.enroll(resource_id, 'audit', cohort=request.GET.get('cohort', None))
+                enterprise_customer_user.enroll(
+                    resource_id,
+                    constants.CourseModes.AUDIT,
+                    cohort=request.GET.get('cohort', None)
+                )
                 track_enrollment('direct-audit-enrollment', request.user.id, resource_id, request.get_full_path())
             except (CourseEnrollmentDowngradeError, CourseEnrollmentPermissionError):
                 pass
             # The courseware view logic will check for DSC requirements, and route to the DSC page if necessary.
             return redirect(LMS_COURSEWARE_URL.format(course_id=resource_id))
 
         return self.redirect(request, *args, **kwargs)
 
     @method_decorator(enterprise_login_required)
     def post(self, request, *args, **kwargs):
         """
         Run some custom POST logic for Enterprise workflows before routing the user through existing views.
         """
-        # pylint: disable=unused-variable
         enterprise_customer_uuid, course_run_id, course_key, program_uuid = RouterView.get_path_variables(**kwargs)
         enterprise_customer = get_enterprise_customer_or_404(enterprise_customer_uuid)
 
         if course_key:
             context_data = get_global_context(request, enterprise_customer)
             try:
                 kwargs['course_id'] = RouterView.get_course_run_id(request.user, enterprise_customer, course_key)
             except Http404:
-                error_code = 'ENTRV001'
-                log_message = (
-                    'Could not find course run with id {course_run_id} '
-                    'for course key {course_key} and '
-                    'for enterprise_customer_uuid {enterprise_customer_uuid} '
-                    'and program {program_uuid}. '
-                    'Returned error code {error_code} to user {userid}'.format(
-                        course_key=course_key,
-                        course_run_id=course_run_id,
-                        enterprise_customer_uuid=enterprise_customer_uuid,
-                        error_code=error_code,
-                        userid=request.user.id,
-                        program_uuid=program_uuid,
-                    )
+                return render_page_with_error_code_message(
+                    request, context_data, error_code=ROUTER_VIEW_NO_COURSE_ID_ERROR_CODE,
+                    course_key=course_key, course_run_id=course_run_id, program_uuid=program_uuid,
+                    enterprise_customer_uuid=enterprise_customer_uuid, userid=request.user.id,
                 )
-                return render_page_with_error_code_message(request, context_data, error_code, log_message)
 
         return self.redirect(request, *args, **kwargs)
```

### Comparing `edx-enterprise-3.9.9/enterprise/management/commands/seed_enterprise_devstack_data.py` & `edx-enterprise-4.0.0/enterprise/management/commands/seed_enterprise_devstack_data.py`

 * *Files 4% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 Management command for assigning enterprise roles to existing enterprise users.
 """
 
 import json
 import logging
 import textwrap
 
-from django.contrib.auth.models import Group, User
+from django.contrib import auth
 from django.contrib.sites.models import Site
 from django.core.management.base import BaseCommand
 from django.db.utils import IntegrityError
 from django.utils.text import slugify
 
 from enterprise.constants import (
     ENTERPRISE_ADMIN_ROLE,
@@ -30,20 +30,21 @@
     EnterpriseFeatureRole,
     EnterpriseFeatureUserRoleAssignment,
     SystemWideEnterpriseRole,
     SystemWideEnterpriseUserRoleAssignment,
 )
 
 try:
-    from student.models import UserProfile
+    from common.djangoapps.student.models import UserProfile
 except ImportError:
     UserProfile = None
 
 LOGGER = logging.getLogger(__name__)
-
+User = auth.get_user_model()
+Group = auth.models.Group
 CATALOG_CONTENT_FILTER = {
     'content_type': 'courserun',
 }
 
 
 class Command(BaseCommand):
     """
@@ -72,27 +73,28 @@
     def _get_default_site(self):
         """ Gets or creates the default devstack site example.com """
         site = Site.objects.get_or_create(name='example.com')
         return site
 
     def _create_enterprise_customer(self, name, site):
         """ Gets or creates an EnterpriseCustomer """
-        enterprise_customer, __ = EnterpriseCustomer.objects.get_or_create(  # pylint: disable=no-member
+        enterprise_customer, __ = EnterpriseCustomer.objects.get_or_create(
             name=name,
             site_id=site.id,
             slug=slugify(name),
             country='US',
             defaults={
                 'country': 'US',
                 'enable_learner_portal': True,
                 'enable_data_sharing_consent': True,
                 'enable_portal_code_management_screen': True,
                 'enable_portal_reporting_config_screen': True,
                 'enable_portal_saml_configuration_screen': True,
                 'enable_portal_subscription_management_screen': True,
+                'enable_portal_lms_configurations_screen': True,
             },
         )
         return enterprise_customer
 
     def _create_catalog_for_enterprise(self, enterprise_customer):
         """ Gets or creates a catalog for an EnterpriseCustomer """
         catalog, __ = EnterpriseCustomerCatalog.objects.get_or_create(
@@ -106,15 +108,15 @@
         """ Ensures the `ENTERPRISE_DATA_API_ACCESS_GROUP` is created """
         Group.objects.get_or_create(name=ENTERPRISE_DATA_API_ACCESS_GROUP)
 
     def _create_enterprise_enrollment_api_group(self):
         """ Ensures the `ENTERPRISE_ENROLLMENT_API_ACCESS_GROUP` is created """
         Group.objects.get_or_create(name=ENTERPRISE_ENROLLMENT_API_ACCESS_GROUP)
 
-    def _create_enterprise_user(self, username, role):
+    def _create_enterprise_user(self, username, role, enterprise_customer=None, applies_to_all_contexts=False):
         """
         Creates a new user with the specified `username` and `role` (e.g.,
         'enterprise_learner'). The newly created user is added to the
         appropriate Django groups (e.g., data api access) and creates
         system-wide and feature role assignments.
         """
         valid_roles = [
@@ -134,15 +136,20 @@
             except IntegrityError:
                 # If a user we attempt to create in this method already exists but with
                 # slightly different parameters, we will attempt to use the existing user.
                 user = User.objects.get(username=username)
             if user:
                 self._add_name_to_user_profile(user)
                 self._add_user_to_groups(user=user, role=role)
-                self._create_system_wide_role_assignment(user=user, role=role)
+                self._create_system_wide_role_assignment(
+                    user=user,
+                    role=role,
+                    enterprise_customer=enterprise_customer,
+                    applies_to_all_contexts=applies_to_all_contexts,
+                )
                 self._create_feature_role_assignments(user=user, role=role)
                 return {
                     "user": user,
                     "role": role,
                 }
         else:
             LOGGER.warning('\nUser not created. Role %s not recognized.', role)
@@ -163,23 +170,26 @@
         if role == ENTERPRISE_LEARNER_ROLE:
             return
         data_api_group = Group.objects.get(name=ENTERPRISE_DATA_API_ACCESS_GROUP)
         data_api_group.user_set.add(user)
         enrollment_api_group = Group.objects.get(name=ENTERPRISE_ENROLLMENT_API_ACCESS_GROUP)
         enrollment_api_group.user_set.add(user)
 
-    def _create_system_wide_role_assignment(self, user, role):
+    def _create_system_wide_role_assignment(self, user, role, enterprise_customer, applies_to_all_contexts=False):
         """
         Gets or creates a system-wide role assignment for the specified user and role
         """
         system_role, __ = SystemWideEnterpriseRole.objects.get_or_create(name=role)
         kwargs = {
             'user': user,
             'role': system_role,
+            'applies_to_all_contexts': applies_to_all_contexts,
         }
+        if enterprise_customer is not None:
+            kwargs['enterprise_customer'] = enterprise_customer
         # We use filter() here, because the model does not currently enforce uniqueness on (user, role).
         if not SystemWideEnterpriseUserRoleAssignment.objects.filter(**kwargs).exists():
             SystemWideEnterpriseUserRoleAssignment.objects.create(**kwargs)
 
     def _create_feature_role_assignments(self, user, role):
         """
         Gets or creates a feature role assignment for the specified user and role
@@ -200,28 +210,27 @@
             )
 
     def _create_enterprise_customer_user(self, username, enterprise_customer):
         """
         Gets or creates an EnterpriseCustomerUser associated with an EnterpriseCustomer
         """
         user, __ = User.objects.get_or_create(username=username)
-        enterprise_customer_user, __ = EnterpriseCustomerUser.objects.get_or_create(
+        enterprise_customer_user, __ = EnterpriseCustomerUser.objects.update_or_create(
             user_id=user.pk,
             enterprise_customer=enterprise_customer,
+            defaults={'active': True},
         )
         return enterprise_customer_user
 
-    def _create_enterprise(self, enterprise_name, enterprise_users):
+    def _create_enterprise_linked_data(self, enterprise_users, enterprise_customer):
         """
-        Creates an enterprise and its associated data, including the
-        EnterpriseCustomer, an enterprise catalog, and initial users of
+        Creates enterprise data for a given EnterpriseCustomer
+        including an enterprise catalog and initial users of
         varying roles.
         """
-        site, __ = self._get_default_site()
-        enterprise_customer = self._create_enterprise_customer(site=site, name=enterprise_name)
         enterprise_catalog = self._create_catalog_for_enterprise(
             enterprise_customer=enterprise_customer
         )
         enterprise_linked_users = []
         for enterprise_user in enterprise_users:
             enterprise_user_obj = self._create_enterprise_customer_user(
                 username=enterprise_user['user'].username,
@@ -248,55 +257,79 @@
             '\nEnsuring enterprise-related Django groups (%s, %s) exist...',
             ENTERPRISE_DATA_API_ACCESS_GROUP,
             ENTERPRISE_ENROLLMENT_API_ACCESS_GROUP,
         )
         self._create_enterprise_data_api_group()
         self._create_enterprise_enrollment_api_group()
 
+        LOGGER.info('\nCreating a new enterprise customer...')
+        site, __ = self._get_default_site()
+        enterprise_customer = self._create_enterprise_customer(site=site, name=enterprise_name)
+
         LOGGER.info('\nCreating enterprise users and assigning roles...')
         # Create one of each enterprise user type (i.e., learner, admin, operator)
         enterprise_users = [
             self._create_enterprise_user(
-                username=ENTERPRISE_LEARNER_ROLE,
+                username="{}_{}".format(ENTERPRISE_LEARNER_ROLE, slug),
                 role=ENTERPRISE_LEARNER_ROLE,
+                enterprise_customer=enterprise_customer
+            ),
+            self._create_enterprise_user(
+                username="{}_{}".format(ENTERPRISE_ADMIN_ROLE, slug),
+                role=ENTERPRISE_ADMIN_ROLE,
+                enterprise_customer=enterprise_customer
+
             ),
+            # Creates a super admin who has the admin role on all enterprises.
             self._create_enterprise_user(
                 username=ENTERPRISE_ADMIN_ROLE,
                 role=ENTERPRISE_ADMIN_ROLE,
+                applies_to_all_contexts=True,
             ),
             self._create_enterprise_user(
                 username=ENTERPRISE_OPERATOR_ROLE,
-                role=ENTERPRISE_OPERATOR_ROLE
+                role=ENTERPRISE_OPERATOR_ROLE,
+                applies_to_all_contexts=True,
             ),
-            # Make all of the service workers enterprise_openedx_operators
+            # Make all of the service workers enterprise_openedx_operators for all enterprises
             self._create_enterprise_user(
                 username='license_manager_worker',
                 role=ENTERPRISE_OPERATOR_ROLE,
+                applies_to_all_contexts=True,
             ),
             self._create_enterprise_user(
                 username='enterprise_catalog_worker',
                 role=ENTERPRISE_OPERATOR_ROLE,
+                applies_to_all_contexts=True,
             ),
             self._create_enterprise_user(
                 username='enterprise_worker',
                 role=ENTERPRISE_OPERATOR_ROLE,
+                applies_to_all_contexts=True,
+            ),
+            self._create_enterprise_user(
+                username='ecommerce_worker',
+                role=ENTERPRISE_OPERATOR_ROLE,
+                applies_to_all_contexts=True,
             ),
         ]
         # Add a couple more learners!
         for i in range(2):
             enterprise_users.append(self._create_enterprise_user(
                 username='{slug}_learner_{index}'.format(
                     slug=slug,
                     index=i + 1,
                 ),
-                role=ENTERPRISE_LEARNER_ROLE
+                role=ENTERPRISE_LEARNER_ROLE,
+                enterprise_customer=enterprise_customer
             ))
 
-        LOGGER.info('\nCreating a new enterprise...')
-        enterprise = self._create_enterprise(enterprise_name=enterprise_name, enterprise_users=enterprise_users)
+        LOGGER.info('\nCreating enterprise data...')
+        enterprise = self._create_enterprise_linked_data(
+            enterprise_users=enterprise_users, enterprise_customer=enterprise_customer)
 
         # generate a json serializable list of linked enterprise users
         enterprise_linked_users = []
         for item in enterprise['enterprise_linked_users']:
             ecu = item['enterprise_customer_user']
             enterprise_linked_users.append({
                 'user_id': ecu.user_id,
```

### Comparing `edx-enterprise-3.9.9/enterprise/management/commands/migrate_enterprise_catalogs.py` & `edx-enterprise-4.0.0/enterprise/management/commands/migrate_enterprise_catalogs.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,22 +1,22 @@
-# -*- coding: utf-8 -*-
 """
 Django management command for migrating EnterpriseCustomerCatalog data to new service.
 """
 
 import logging
 
-from django.contrib.auth.models import User
+from django.contrib import auth
 from django.core.management.base import BaseCommand, CommandError
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
 from enterprise.api_client.enterprise_catalog import EnterpriseCatalogApiClient
 from enterprise.models import EnterpriseCustomerCatalog
 
 LOGGER = logging.getLogger(__name__)
+User = auth.get_user_model()
 
 
 class Command(BaseCommand):
     """
     Migrate EnterpriseCustomerCatalog data to new Enterprise Catalog service.
     """
     help = 'Migrate EnterpriseCustomerCatalog data to new Enterprise Catalog service.'
@@ -31,22 +31,24 @@
         )
         parser.add_argument(
             '--catalog_uuids',
             dest='catalog_uuids',
             metavar='ENT_CATALOG_UUIDS',
             help=_('Comma separated list of uuids of enterprise catalogs to migrate.'),
         )
-        super(Command, self).add_arguments(parser)
+        super().add_arguments(parser)
 
     def handle(self, *args, **options):
         api_username = options['api_user']
         try:
             user = User.objects.get(username=api_username)
-        except User.DoesNotExist:
-            raise CommandError(_('A user with the username {username} was not found.').format(username=api_username))
+        except User.DoesNotExist as user_exception:
+            raise CommandError(
+                _('A user with the username {username} was not found.').format(username=api_username)
+            ) from user_exception
 
         client = EnterpriseCatalogApiClient(user=user)
 
         catalog_uuids_string = options.get('catalog_uuids')
         if catalog_uuids_string:
             catalog_uuids_list = catalog_uuids_string.split(',')
             queryset = EnterpriseCustomerCatalog.objects.filter(uuid__in=catalog_uuids_list)
@@ -58,36 +60,46 @@
             try:
                 response = client.get_enterprise_catalog(
                     catalog_uuid=enterprise_catalog.uuid,
                     # Suppress 404 exception since we do not expect the catalog to exist
                     # in enterprise-catalog if it is a new catalog
                     should_raise_exception=False,
                 )
+                catalog_query = enterprise_catalog.enterprise_catalog_query
+                catalog_query_uuid = str(catalog_query.uuid) if catalog_query else None
+                query_title = getattr(catalog_query, 'title', None)
+                include_exec_ed_2u_courses = getattr(catalog_query, 'include_exec_ed_2u_courses', False)
                 if not response:
                     # catalog with matching uuid does NOT exist in enterprise-catalog
                     # service, so we should create a new catalog
                     client.create_enterprise_catalog(
                         str(enterprise_catalog.uuid),
                         str(enterprise_catalog.enterprise_customer.uuid),
                         enterprise_catalog.enterprise_customer.name,
                         enterprise_catalog.title,
                         enterprise_catalog.content_filter,
                         enterprise_catalog.enabled_course_modes,
                         enterprise_catalog.publish_audit_enrollment_urls,
+                        catalog_query_uuid,
+                        query_title,
+                        include_exec_ed_2u_courses,
                     )
                 else:
                     # catalog with matching uuid does exist in enterprise-catalog
                     # service, so we should update the existing catalog
                     update_fields = {
                         'enterprise_customer': str(enterprise_catalog.enterprise_customer.uuid),
                         'enterprise_customer_name': enterprise_catalog.enterprise_customer.name,
                         'title': enterprise_catalog.title,
                         'content_filter': enterprise_catalog.content_filter,
                         'enabled_course_modes': enterprise_catalog.enabled_course_modes,
                         'publish_audit_enrollment_urls': enterprise_catalog.publish_audit_enrollment_urls,
+                        'catalog_query_uuid': catalog_query_uuid,
+                        'query_title': query_title,
+                        'include_exec_ed_2u_courses': include_exec_ed_2u_courses,
                     }
                     client.update_enterprise_catalog(
                         str(enterprise_catalog.uuid),
                         **update_fields,
                     )
                 LOGGER.info('Successfully migrated Enterprise Catalog {}'.format(enterprise_catalog.uuid))
             except Exception:  # pylint: disable=broad-except
```

### Comparing `edx-enterprise-3.9.9/enterprise/management/commands/create_enterprise_course_enrollments.py` & `edx-enterprise-4.0.0/enterprise/management/commands/create_enterprise_course_enrollments.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Django management command for creating EnterpriseCourseEnrollment records.
 """
 
 import logging
 
 from django.core.management import BaseCommand
@@ -54,15 +53,14 @@
             LOGGER.info(
                 'Trying to create the enrollment for user [%s] in course [%s] for enterprise customer [%s]',
                 user_id,
                 course_run_id,
                 enterprise_customer_uuid
             )
 
-            # pylint: disable=no-member
             enterprise_customer = EnterpriseCustomer.objects.get(uuid=enterprise_customer_uuid)
 
             try:
                 LOGGER.info(
                     'Checking whether course [%s] exists in enterprise customer [%s] - [%s] catalog',
                     course_run_id,
                     enterprise_customer_uuid,
@@ -84,15 +82,14 @@
                     user_id=user_id
                 )
 
                 # This is an extra check for preventing the exception.
                 # We already have implemented the solution for this (soft deletion).
                 if enterprise_customer_user.exists():
                     enterprise_customer_user = enterprise_customer_user.first()
-                    # pylint: disable=no-member
                     __, created = EnterpriseCourseEnrollment.objects.get_or_create(
                         enterprise_customer_user=enterprise_customer_user,
                         course_id=course_run_id,
                         defaults={
                             'source': EnterpriseEnrollmentSource.get_source(
                                 EnterpriseEnrollmentSource.MANAGEMENT_COMMAND
                             )
```

### Comparing `edx-enterprise-3.9.9/enterprise/management/commands/save_enterprise_customer_users.py` & `edx-enterprise-4.0.0/enterprise/management/commands/save_enterprise_customer_users.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Django management command for saving EnterpriseCustomerUser models.
 """
 
 import logging
 
 from django.core.management import BaseCommand
```

### Comparing `edx-enterprise-3.9.9/enterprise/management/commands/create_missing_dsc_records.py` & `edx-enterprise-4.0.0/enterprise/management/commands/create_missing_dsc_records.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Django management command for creating DataSharingConsent records.
 """
 import csv
 import logging
 
 from django.core.management import BaseCommand
```

### Comparing `edx-enterprise-3.9.9/enterprise/settings/test.py` & `edx-enterprise-4.0.0/enterprise/settings/test.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,24 +1,25 @@
-# -*- coding: utf-8 -*-
 """
 These settings are here to use during tests, because django requires them.
 
 In a real-world use case, apps in this project are installed into other
 Django applications, so these settings will not be used.
 """
 
+import os
 from os.path import abspath, dirname, join
 
 from celery import Celery
 
 from enterprise.constants import (
     ENTERPRISE_ADMIN_ROLE,
     ENTERPRISE_CATALOG_ADMIN_ROLE,
     ENTERPRISE_DASHBOARD_ADMIN_ROLE,
     ENTERPRISE_ENROLLMENT_API_ADMIN_ROLE,
+    ENTERPRISE_FULFILLMENT_OPERATOR_ROLE,
     ENTERPRISE_OPERATOR_ROLE,
 )
 
 
 def here(*args):
     """
     Return the absolute path to a directory from this file.
@@ -30,24 +31,25 @@
     """
     Return the absolute path to some file from the project's root.
     """
     return abspath(join(abspath(here('../..')), *args))
 
 
 DATABASES = {
-    "default": {
-        "ENGINE": "django.db.backends.sqlite3",
-        "NAME": "default.db",
-        "USER": "",
-        "PASSWORD": "",
-        "HOST": "",
-        "PORT": "",
-    }
+    'default': {
+        'ENGINE': os.environ.get('DB_ENGINE', 'django.db.backends.sqlite3'),
+        'NAME': os.environ.get('DB_NAME', 'default.db'),
+        'USER': os.environ.get('DB_USER', ''),
+        'PASSWORD': os.environ.get('DB_PASSWORD', ''),
+        'HOST': os.environ.get('DB_HOST', ''),
+        'PORT': os.environ.get('DB_PORT', ''),
+    },
 }
 
+
 INSTALLED_APPS = (
     "django.contrib.auth",
     "django.contrib.contenttypes",
     "django.contrib.sites",
     "django.contrib.sessions",
     "django.contrib.admin",  # only used in DEBUG mode
     "django.contrib.messages",
@@ -55,14 +57,15 @@
     "waffle",
 
     "enterprise",
     "consent",
     "integrated_channels.integrated_channel",
     "integrated_channels.cornerstone",
     "integrated_channels.degreed",
+    "integrated_channels.degreed2",
     "integrated_channels.canvas",
     "integrated_channels.blackboard",
     "integrated_channels.moodle",
     "integrated_channels.sap_success_factors",
     "integrated_channels.xapi",
     "edx_rbac",
     "rules.apps.AutodiscoverRulesConfig",
@@ -143,32 +146,34 @@
 
 ENTERPRISE_API_CACHE_TIMEOUT = 60
 
 ENTERPRISE_SUPPORT_URL = "http://foo"
 
 ENTERPRISE_TAGLINE = "High-quality online learning opportunities from the world's best universities"
 
-OAUTH_ID_TOKEN_EXPIRATION = 60*60  # in seconds
+OAUTH_ID_TOKEN_EXPIRATION = 60 * 60  # in seconds
 
 EMAIL_BACKEND = 'django.core.mail.backends.locmem.EmailBackend'
 
 DEFAULT_FROM_EMAIL = 'course_staff@example.com'
 
 USER_THROTTLE_RATE = '190/minute'
 SERVICE_USER_THROTTLE_RATE = '200/minute'
+SERVICE_USER_HIGH_THROTTLE_RATE = '200/minute'
 REST_FRAMEWORK = {
     'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
     'PAGE_SIZE': 10,
     'URL_FORMAT_OVERRIDE': None,
     'DEFAULT_THROTTLE_CLASSES': (
         'rest_framework.throttling.UserRateThrottle',
     ),
     'DEFAULT_THROTTLE_RATES': {
         'user': USER_THROTTLE_RATE,
         'service_user': SERVICE_USER_THROTTLE_RATE,
+        'high_service_user': SERVICE_USER_HIGH_THROTTLE_RATE,
     },
     'DATETIME_FORMAT': '%Y-%m-%dT%H:%M:%SZ',
 }
 
 # URL for the server that django client listens to by default.
 TEST_SERVER = "http://testserver"
 ALLOWED_HOSTS = ["testserver.enterprise"]
@@ -177,14 +182,15 @@
 # Defines the usernames of service users who should be throttled
 # at a higher rate than normal users.
 ENTERPRISE_ALL_SERVICE_USERNAMES = [
     'ecommerce_worker',
     'enterprise_worker',
     'license_manager_worker',
     'enterprise_catalog_worker',
+    'enterprise_subsidy_worker',
 ]
 
 ECOMMERCE_SERVICE_WORKER_USERNAME = 'ecommerce_worker'
 ENTERPRISE_SERVICE_WORKER_USERNAME = 'enterprise_worker'
 
 ENTERPRISE_CUSTOMER_LOGO_IMAGE_SIZE = 512   # Enterprise logo image size limit in KB's
 
@@ -192,14 +198,16 @@
 
 # These are standard regexes for pulling out info like course_ids, usage_ids, etc.
 COURSE_KEY_PATTERN = r'(?P<course_key_string>[^/+]+(/|\+)[^/+]+(/|\+)[^/?]+)'
 COURSE_ID_PATTERN = COURSE_KEY_PATTERN.replace('course_key_string', 'course_id')
 
 USE_TZ = True
 
+TIME_ZONE = 'UTC'
+
 MKTG_URLS = {}
 
 ENTERPRISE_CUSTOMER_CATALOG_DEFAULT_CONTENT_FILTER = {
     'content_type': 'course',
     'partner': 'edx',
     'level_type': [
         'Introductory',
@@ -210,29 +218,29 @@
         'Current',
         'Starting Soon',
         'Upcoming'
     ],
     'status': 'published'
 }
 
-TABLEAU_URL = 'http://localhost'
-TABLEAU_ADMIN_USER = 'edx'
-TABLEAU_ADMIN_USER_PASSWORD = 'edx'
+SNOWFLAKE_SERVICE_USER = 'TEST@EDX.ORG'
+SNOWFLAKE_SERVICE_USER_PASSWORD = 'secret'
 
 # For testing edx-rbac rules. This is not the actual value of the setting in prod.
 SYSTEM_TO_FEATURE_ROLE_MAPPING = {
     ENTERPRISE_ADMIN_ROLE: [
         ENTERPRISE_DASHBOARD_ADMIN_ROLE,
         ENTERPRISE_CATALOG_ADMIN_ROLE,
         ENTERPRISE_ENROLLMENT_API_ADMIN_ROLE
     ],
     ENTERPRISE_OPERATOR_ROLE: [
         ENTERPRISE_DASHBOARD_ADMIN_ROLE,
         ENTERPRISE_CATALOG_ADMIN_ROLE,
-        ENTERPRISE_ENROLLMENT_API_ADMIN_ROLE
+        ENTERPRISE_ENROLLMENT_API_ADMIN_ROLE,
+        ENTERPRISE_FULFILLMENT_OPERATOR_ROLE,
     ],
 }
 
 LOGGING = {
     'version': 1,
     'disable_existing_loggers': False,
     'handlers': {
@@ -272,15 +280,15 @@
         }
     }
 }
 EVENT_TRACKING_PROCESSORS = []
 
 #################################### CELERY ####################################
 
-app = Celery('enterprise')  # pylint: disable=invalid-name
+app = Celery('enterprise')
 app.conf.task_protocol = 1
 app.config_from_object('django.conf:settings')
 
 CELERY_ALWAYS_EAGER = True
 
 CLEAR_REQUEST_CACHE_ON_TASK_COMPLETION = False
 
@@ -315,7 +323,24 @@
 
 
 INTEGRATED_CHANNELS_API_CHUNK_TRANSMISSION_LIMIT = {
     'SAP': 1,
 }
 
 LANGUAGE_COOKIE = 'openedx-language-preference'
+
+ENTERPRISE_BACKEND_SERVICE_EDX_OAUTH2_PROVIDER_URL = f'{LMS_INTERNAL_ROOT_URL}/oauth2'
+ENTERPRISE_BACKEND_SERVICE_EDX_OAUTH2_KEY = 'test_backend_oauth2_key'
+ENTERPRISE_BACKEND_SERVICE_EDX_OAUTH2_SECRET = 'test_backend_oauth2_secret'
+
+ECOMMERCE_API_URL = 'https://ecommerce.example.com/api/v2/'
+
+LOGIN_REDIRECT_WHITELIST = [
+    'success.url',
+    'failure.url',
+    'google.com',
+    'facebook.com'
+]
+
+ENTERPRISE_PLOTLY_SECRET = "I am a secret"
+ENTERPRISE_MANUAL_REPORTING_CUSTOMER_UUIDS = ['12aacfee8ffa4cb3bed1059565a57f06',]
+EXEC_ED_LANDING_PAGE = 'https://www.edx-external.com/account'
```

### Comparing `edx-enterprise-3.9.9/enterprise/views_error_codes.txt` & `edx-enterprise-4.0.0/enterprise/views_error_codes.txt`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/enterprise/admin/paginator.py` & `edx-enterprise-4.0.0/enterprise/admin/paginator.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Custom paginator to implement smart pagination.
 """
 
 from django.core.paginator import Paginator
```

### Comparing `edx-enterprise-3.9.9/enterprise/admin/actions.py` & `edx-enterprise-4.0.0/enterprise/admin/actions.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,16 +1,14 @@
-# -*- coding: utf-8 -*-
 """
 Custom `Django Admin actions`_ used in enterprise app.
 
 .. _Django Admin actions: https://docs.djangoproject.com/en/1.8/ref/contrib/admin/actions/
 """
 
 import unicodecsv
-from six import string_types
 
 from django.contrib import messages
 from django.http import HttpResponse
 from django.utils.safestring import mark_safe
 
 from enterprise.api_client.enterprise_catalog import EnterpriseCatalogApiClient
 
@@ -21,15 +19,15 @@
 
     Arguments:
         description (string): action description
         fields ([string]): list of model fields to include
         header (bool): whether or not to output the column names as the first row
     """
     # adapted from https://gist.github.com/mgerring/3645889
-    def export_as_csv(modeladmin, request, queryset):  # pylint: disable=unused-argument
+    def export_as_csv(modeladmin, request, queryset):
         """
         Export model fields to CSV.
         """
         opts = modeladmin.model._meta
 
         if not fields:
             field_names = [field.name for field in opts.fields]
@@ -50,35 +48,35 @@
                 field = getattr(obj, field_name)
                 if callable(field):
                     value = field()
                 else:
                     value = field
                 if value is None:
                     row.append("[Not Set]")
-                elif not value and isinstance(value, string_types):
+                elif not value and isinstance(value, str):
                     row.append("[Empty]")
                 else:
                     row.append(value)
             writer.writerow(row)
         return response
 
     export_as_csv.short_description = description
     return export_as_csv
 
 
-def refresh_catalog(self, request, queryset):  # pylint: disable=unused-argument
+def refresh_catalog(self, request, queryset):
     """
     Kicks off background running tasks for refreshing catalogs
     """
     catalog_client = EnterpriseCatalogApiClient(user=request.user)
     refreshed_catalogs, failed_to_refresh_catalogs = catalog_client.refresh_catalogs(queryset)
 
     # display catalog and task ids that were successfully started refreshing
     updated_message = ''
-    if refreshed_catalogs.items():
+    if refreshed_catalogs:
         updated_message = '<b>The following catalogs are being refreshed:</b><ul>'
         for uuid, task_id in refreshed_catalogs.items():
             updated_message = updated_message + '<li>' + str(uuid) + ' with task id: ' + str(task_id) + '</li>'
         updated_message = updated_message + '</ul>'
 
     # display catalog ids that failed to start refreshing
     if failed_to_refresh_catalogs:
@@ -87,10 +85,10 @@
             updated_message = updated_message + '<li class="error">' + str(failed_catalog_uuid) + '</li>'
         updated_message = updated_message + '</ul>'
 
     # Info level based on how successful refreshing catalogs was overall
     level = messages.INFO
     if failed_to_refresh_catalogs:
         level = messages.ERROR
-        if refreshed_catalogs.items():
+        if refreshed_catalogs:
             level = messages.WARNING
     self.message_user(request, mark_safe(updated_message), level=level)
```

### Comparing `edx-enterprise-3.9.9/enterprise/admin/views.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/exporters/learner_data.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,973 +1,858 @@
-# -*- coding: utf-8 -*-
 """
-Custom Django Admin views used in enterprise app.
+Assist integrated channels with retrieving learner completion data.
+
+Module contains resources for integrated pipelines to retrieve all the
+grade and completion data for enrollments belonging to a particular
+enterprise customer.
 """
 
-import datetime
-import json
-import logging
-
-from edx_rest_api_client.exceptions import HttpClientError
-
-from django.conf import settings
-from django.contrib import admin, messages
-from django.contrib.auth import get_permission_codename
-from django.contrib.auth.models import User
-from django.core.exceptions import ValidationError
-from django.core.management import call_command
-from django.db.models import Q
-from django.http import HttpResponse, HttpResponseRedirect, JsonResponse
-from django.shortcuts import get_object_or_404, render
-from django.urls import reverse
-from django.utils.translation import ugettext as _
-from django.utils.translation import ungettext
-from django.views.generic import View
-
-from enterprise.admin.forms import (
-    ManageLearnersDataSharingConsentForm,
-    ManageLearnersForm,
-    TransmitEnterpriseCoursesForm,
-)
-from enterprise.admin.utils import (
-    UrlNames,
-    ValidationMessages,
-    email_or_username__to__email,
-    get_idiff_list,
-    paginated_list,
-    parse_csv,
-    split_usernames_and_emails,
-    validate_email_to_link,
-)
-from enterprise.api_client.ecommerce import EcommerceApiClient
-from enterprise.api_client.lms import EnrollmentApiClient
-from enterprise.constants import PAGE_SIZE
-from enterprise.models import (
-    EnrollmentNotificationEmailTemplate,
-    EnterpriseCourseEnrollment,
-    EnterpriseCustomer,
-    EnterpriseCustomerUser,
-    EnterpriseEnrollmentSource,
-    PendingEnterpriseCustomerUser,
-)
-from enterprise.utils import delete_data_sharing_consent, get_ecommerce_worker_user, track_enrollment
+from datetime import datetime
+from logging import getLogger
 
-# Only create manual enrollments if running in edx-platform
-try:
-    from student.api import (
-        create_manual_enrollment_audit,
-        UNENROLLED_TO_ENROLLED,
-        UNENROLLED_TO_ALLOWEDTOENROLL,
-    )
-except ImportError:
-    create_manual_enrollment_audit = None
+from opaque_keys import InvalidKeyError
+from requests.exceptions import HTTPError
 
-MANUAL_ENROLLMENT_ROLE = "Learner"
+from django.apps import apps
+from django.contrib import auth
+from django.utils import timezone
+from django.utils.dateparse import parse_datetime
 
+from integrated_channels.integrated_channel.channel_settings import ChannelSettingsMixin
 
-class TemplatePreviewView(View):
-    """
-    Renders a given NotificationTemplate object to HTML for online viewing.
-    """
-    view_type_contexts = {
-        "course": {
-            "enrolled_in": {
-                "name": "OpenEdX Demo Course",
-                "url": "http://example.com/courses/edx-demo-course",
-                "type": "course",
-                "start": datetime.datetime.strptime('2016-01-01', '%Y-%m-%d')
-            },
-            "organization_name": "OpenEdX",
-        },
-        "program": {
-            "enrolled_in": {
-                "name": "OpenEdX Demo Program",
-                "url": "http://example.com/programs/edx-demo-program",
-                "type": "program",
-                "branding": "MicroMasters",
-                "start": datetime.datetime.strptime('2016-01-01', '%Y-%m-%d')
-            },
-            "organization_name": "OpenEdX",
-        },
-    }
-
-    def get(self, request, template_id, view_type):
-        """
-        Render the given template with the stock data.
-        """
-        template = get_object_or_404(EnrollmentNotificationEmailTemplate, pk=template_id)
-        if view_type not in self.view_type_contexts:
-            return HttpResponse(status=404)
-        base_context = self.view_type_contexts[view_type].copy()
-        base_context.update({'user_name': self.get_user_name(request)})
-        return HttpResponse(template.render_html_template(base_context), content_type='text/html')
+try:
+    from openedx.core.djangoapps.content.course_overviews.models import CourseOverview
+except ImportError:
+    CourseOverview = None
+from consent.models import DataSharingConsent
+from enterprise.api_client.lms import GradesApiClient
+from enterprise.models import EnterpriseCourseEnrollment
+from integrated_channels.catalog_service_utils import get_course_id_for_enrollment
+from integrated_channels.integrated_channel.exporters import Exporter
+from integrated_channels.lms_utils import (
+    get_completion_summary,
+    get_course_certificate,
+    get_course_details,
+    get_persistent_grade,
+    get_single_user_grade,
+)
+from integrated_channels.utils import (
+    generate_formatted_log,
+    is_already_transmitted,
+    is_course_completed,
+    parse_datetime_to_epoch_millis,
+)
 
-    @staticmethod
-    def get_user_name(request):
-        """
-        Get a human-readable name for the user.
-        """
-        return request.user.first_name or request.user.username
+LOGGER = getLogger(__name__)
+User = auth.get_user_model()
 
 
-class BaseEnterpriseCustomerView(View):
+class LearnerExporter(ChannelSettingsMixin, Exporter):
     """
-    Base class for Enterprise Customer views.
+    Base class for exporting learner completion data to integrated channels.
     """
-    template = None
 
-    @staticmethod
-    def _get_admin_context(request, customer):
-        """
-        Build common admin context.
-        """
-        opts = customer._meta
-        codename = get_permission_codename('change', opts)
-        has_change_permission = request.user.has_perm('%s.%s' % (opts.app_label, codename))
-        return {
-            'has_change_permission': has_change_permission,
-            'opts': opts
-        }
+    GRADE_AUDIT = 'Audit'
+    GRADE_PASSING = 'Pass'
+    GRADE_FAILING = 'Fail'
+    GRADE_INCOMPLETE = 'In Progress'
 
-    def _get_view_context(self, request, customer_uuid):
+    def __init__(self, user, enterprise_configuration):
         """
-        Return the default context parameters
-        """
-        return {
-            'enterprise_customer': EnterpriseCustomer.objects.get(uuid=customer_uuid)  # pylint: disable=no-member
-        }
+        Store the data needed to export the learner data to the integrated channel.
 
-    def _build_context(self, request, customer_uuid):
-        """
-        Build common context parts used by different handlers in this view.
-        """
-        context = self._get_view_context(request, customer_uuid)
-        context.update(admin.site.each_context(request))
-        context.update(self._get_admin_context(request, context['enterprise_customer']))
-        return context
+        Arguments:
 
-    def get_form_view(self, request, customer_uuid, additional_context=None):
-        """
-        render the form with appropriate context.
+        * ``user``: User instance with access to the Grades API for the Enterprise Customer's courses.
+        * ``enterprise_configuration``: EnterpriseCustomerPluginConfiguration instance for the current channel.
         """
-        context = self._build_context(request, customer_uuid)
-        context.update(additional_context)
-        return render(request, self.template, context)
+        # The Grades API and Certificates API clients require an OAuth2 access token,
+        # so cache the client to allow the token to be reused. Cache other clients for
+        # general reuse.
+        self.grades_api = None
+        self.certificates_api = None
+        self.course_api = None
+        self.course_enrollment_api = None
 
+        super().__init__(user, enterprise_configuration)
 
-class EnterpriseCustomerManageLearnerDataSharingConsentView(BaseEnterpriseCustomerView):
-    """
-    Manage Learners Data Sharing Consent View.
-
-    Allows to request the DSC from a learner for a specific course.
-    """
-    template = 'enterprise/admin/clear_learners_data_sharing_consent.html'
-
-    class ContextParameters:
+    @property
+    def grade_passing(self):
         """
-        Namespace-style class for custom context parameters.
+        Returns the string used for a passing grade.
         """
-        ENTERPRISE_CUSTOMER = 'enterprise_customer'
-        MANAGE_LEARNERS_DSC_FORM = 'manage_learners_data_sharing_consent_form'
+        return self.GRADE_PASSING
 
-    def get(self, request, customer_uuid):
+    @property
+    def grade_failing(self):
         """
-        Handle GET request - render "Request a DSC from Learner" form.
-
-        Arguments:
-            request (django.http.request.HttpRequest): Request instance
-            customer_uuid (str): Enterprise Customer UUID
-
-        Returns:
-            django.http.response.HttpResponse: HttpResponse
+        Returns the string used for a failing grade.
         """
-        return self.get_form_view(
-            request,
-            customer_uuid,
-            additional_context={
-                self.ContextParameters.MANAGE_LEARNERS_DSC_FORM: ManageLearnersDataSharingConsentForm()
-            }
-        )
+        return self.GRADE_FAILING
 
-    def post(self, request, customer_uuid):
+    @property
+    def grade_incomplete(self):
         """
-        Handle POST request - handle form submissions.
-
-        Arguments:
-            request (django.http.request.HttpRequest): Request instance
-            customer_uuid (str): Enterprise Customer UUID
+        Returns the string used for an incomplete course grade.
         """
-        manage_learners_dsc_form = ManageLearnersDataSharingConsentForm(
-            request.POST,
-            enterprise_customer=EnterpriseCustomer.objects.get(uuid=customer_uuid)
-        )
-
-        # check that form data is well-formed
-        if manage_learners_dsc_form.is_valid():
-            delete_data_sharing_consent(
-                manage_learners_dsc_form.cleaned_data[ManageLearnersDataSharingConsentForm.Fields.COURSE],
-                customer_uuid,
-                manage_learners_dsc_form.cleaned_data[ManageLearnersDataSharingConsentForm.Fields.EMAIL_OR_USERNAME]
-            )
-            messages.success(request, _("Successfully requested the Data Sharing consent from learner."))
-            return HttpResponseRedirect(reverse("admin:" + UrlNames.MANAGE_LEARNERS_DSC, args=(customer_uuid,)))
-
-        return self.get_form_view(
-            request,
-            customer_uuid,
-            additional_context={
-                self.ContextParameters.MANAGE_LEARNERS_DSC_FORM: manage_learners_dsc_form
-            }
-        )
-
-
-class EnterpriseCustomerTransmitCoursesView(BaseEnterpriseCustomerView):
-    """
-    Transmit courses view.
-
-    Allows transmitting of courses metadata for provided enterprise.
-    """
-    template = 'enterprise/admin/transmit_courses_metadata.html'
+        return self.GRADE_INCOMPLETE
 
-    class ContextParameters:
+    @property
+    def grade_audit(self):
         """
-        Namespace-style class for custom context parameters.
+        Returns the string used for an audit course grade.
         """
-        ENTERPRISE_CUSTOMER = 'enterprise_customer'
-        TRANSMIT_COURSES_METADATA_FORM = 'transmit_courses_metadata_form'
+        return self.GRADE_AUDIT
 
-    def get(self, request, customer_uuid):
+    def bulk_assessment_level_export(self):
         """
-        Handle GET request - render "Transmit courses metadata" form.
+        Collect assessment level learner data for the ``EnterpriseCustomer`` where data sharing consent is granted.
 
-        Arguments:
-            request (django.http.request.HttpRequest): Request instance
-            customer_uuid (str): Enterprise Customer UUID
+        Yields a ``LearnerDataTransmissionAudit`` for each subsection in a course under an enrollment, containing:
 
-        Returns:
-            django.http.response.HttpResponse: HttpResponse
+        * ``enterprise_course_enrollment_id``: The id reference to the ``EnterpriseCourseEnrollment`` object.
+        * ``course_id``: The string ID of the course under the enterprise enrollment.
+        * ``subsection_id``: The string ID of the subsection within the course.
+        * ``grade``: string grade recorded for the learner in the course.
         """
-        return self.get_form_view(
-            request,
-            customer_uuid,
-            additional_context={
-                self.ContextParameters.TRANSMIT_COURSES_METADATA_FORM: TransmitEnterpriseCoursesForm()
-            }
-        )
+        enrollment_queryset = EnterpriseCourseEnrollment.objects.select_related(
+            'enterprise_customer_user'
+        ).filter(
+            enterprise_customer_user__enterprise_customer=self.enterprise_customer,
+            enterprise_customer_user__active=True,
+        ).order_by('course_id')
 
-    def post(self, request, customer_uuid):
-        """
-        Handle POST request - handle form submissions.
+        # Create a record of each subsection from every enterprise enrollment
+        for enterprise_enrollment in enrollment_queryset:
+            if not LearnerExporter.has_data_sharing_consent(enterprise_enrollment):
+                continue
 
-        Arguments:
-            request (django.http.request.HttpRequest): Request instance
-            customer_uuid (str): Enterprise Customer UUID
-        """
-        transmit_courses_metadata_form = TransmitEnterpriseCoursesForm(request.POST)
+            assessment_grade_data = self._collect_assessment_grades_data(enterprise_enrollment)
 
-        # check that form data is well-formed
-        if transmit_courses_metadata_form.is_valid():
-            channel_worker_username = transmit_courses_metadata_form.cleaned_data['channel_worker_username']
-
-            # call `transmit_content_metadata` management command to trigger
-            # transmission of enterprise courses metadata
-            call_command(
-                'transmit_content_metadata',
-                '--catalog_user', channel_worker_username,
-                enterprise_customer=customer_uuid
+            records = self.get_learner_assessment_data_records(
+                enterprise_enrollment=enterprise_enrollment,
+                assessment_grade_data=assessment_grade_data,
             )
+            if records:
+                # There are some cases where we won't receive a record from the above
+                # method; right now, that should only happen if we have an Enterprise-linked
+                # user for the integrated channel, and transmission of that user's
+                # data requires an upstream user identifier that we don't have (due to a
+                # failure of SSO or similar). In such a case, `get_learner_data_record`
+                # would return None, and we'd simply skip yielding it here.
+                yield from records
 
-            # Redirect to GET
-            return HttpResponseRedirect('')
-
-        return self.get_form_view(
-            request,
-            customer_uuid,
-            additional_context={
-                self.ContextParameters.TRANSMIT_COURSES_METADATA_FORM: transmit_courses_metadata_form
-            }
-        )
-
+    def single_assessment_level_export(self, **kwargs):
+        """
+        Collect an assessment level learner data for the ``EnterpriseCustomer`` where data sharing consent is
+        granted.
 
-class EnterpriseCustomerManageLearnersView(BaseEnterpriseCustomerView):
-    """
-    Manage Learners view.
+        Yields a ``LearnerDataTransmissionAudit`` for each subsection of the course that the learner is enrolled in,
+        containing:
 
-    Lists learners linked to chosen Enterprise Customer and allows adding and deleting them.
-    """
-    template = "enterprise/admin/manage_learners.html"
+        * ``enterprise_course_enrollment_id``: The id reference to the ``EnterpriseCourseEnrollment`` object.
+        * ``course_id``: The string ID of the course under the enterprise enrollment.
+        * ``subsection_id``: The string ID of the subsection within the course.
+        * ``grade``: string grade recorded for the learner in the course.
+        * ``learner_to_transmit``: REQUIRED User object, representing the learner whose data is being exported.
 
-    class ContextParameters:
         """
-        Namespace-style class for custom context parameters.
-        """
-        ENTERPRISE_CUSTOMER = "enterprise_customer"
-        LEARNERS = "learners"
-        PENDING_LEARNERS = "pending_learners"
-        MANAGE_LEARNERS_FORM = "manage_learners_form"
-        SEARCH_KEYWORD = "search_keyword"
-        ENROLLMENT_URL = 'ENROLLMENT_API_ROOT_URL'
+        lms_user_for_filter = kwargs.get('learner_to_transmit')
+        TransmissionAudit = kwargs.get('TransmissionAudit', None)
+        course_run_id = kwargs.get('course_run_id', None)
+        grade = kwargs.get('grade', None)
+        subsection_id = kwargs.get('subsection_id')
+        enrollment_queryset = EnterpriseCourseEnrollment.objects.select_related(
+            'enterprise_customer_user'
+        ).filter(
+            enterprise_customer_user__active=True,
+            enterprise_customer_user__user_id=lms_user_for_filter.id,
+            course_id=course_run_id,
+        ).order_by('course_id')
 
-    def _get_view_context(self, request, customer_uuid):
-        enterprise_customer = EnterpriseCustomer.objects.get(uuid=customer_uuid)  # pylint: disable=no-member
-        search_keyword = self.get_search_keyword(request)
-        linked_learners = self.get_enterprise_customer_user_queryset(request, search_keyword, customer_uuid)
-        pending_linked_learners = self.get_pending_users_queryset(search_keyword, customer_uuid)
+        # We are transmitting for an enrollment, so grab just the one.
+        enterprise_enrollment = enrollment_queryset.first()
 
-        context = {
-            self.ContextParameters.ENTERPRISE_CUSTOMER: enterprise_customer,
-            self.ContextParameters.PENDING_LEARNERS: pending_linked_learners,
-            self.ContextParameters.LEARNERS: linked_learners,
-            self.ContextParameters.SEARCH_KEYWORD: search_keyword or '',
-            self.ContextParameters.ENROLLMENT_URL: settings.LMS_ENROLLMENT_API_PATH,
-        }
-        return context
+        if not enterprise_enrollment:
+            LOGGER.info(generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                lms_user_for_filter,
+                course_run_id,
+                'Either qualifying enrollments not found for learner, or, '
+                'enterprise_customer_user record is inactive. Skipping transmit assessment grades.'
+            ))
+            return
 
-    def get_search_keyword(self, request):
-        """
-        Retrieve the search querystring from the GET parameters.
-        """
-        return request.GET.get('q', None)
+        already_transmitted = is_already_transmitted(
+            TransmissionAudit,
+            enterprise_enrollment.id,
+            self.enterprise_configuration.id,
+            grade,
+            subsection_id,
+            detect_grade_updated=self.INCLUDE_GRADE_FOR_COMPLETION_AUDIT_CHECK,
+        )
 
-    def get_enterprise_customer_user_queryset(self, request, search_keyword, customer_uuid, page_size=PAGE_SIZE):
-        """
-        Get the list of EnterpriseCustomerUsers we want to render.
+        if not (TransmissionAudit and already_transmitted) and LearnerExporter.has_data_sharing_consent(
+                enterprise_enrollment):
 
-        Arguments:
-            request (HttpRequest): HTTP Request instance.
-            search_keyword (str): The keyword to search for in users' email addresses and usernames.
-            customer_uuid (str): A unique identifier to filter down to only users linked to a
-            particular EnterpriseCustomer.
-            page_size (int): Number of learners displayed in each paginated set.
-        """
-        page = request.GET.get('page', 1)
-        learners = EnterpriseCustomerUser.objects.filter(enterprise_customer__uuid=customer_uuid)
-        user_ids = learners.values_list('user_id', flat=True)
-        matching_users = User.objects.filter(pk__in=user_ids)
-        if search_keyword is not None:
-            matching_users = matching_users.filter(
-                Q(email__icontains=search_keyword) | Q(username__icontains=search_keyword)
+            assessment_grade_data = self._collect_assessment_grades_data(enterprise_enrollment)
+
+            records = self.get_learner_assessment_data_records(
+                enterprise_enrollment=enterprise_enrollment,
+                assessment_grade_data=assessment_grade_data,
             )
-        matching_user_ids = matching_users.values_list('pk', flat=True)
-        learners = learners.filter(user_id__in=matching_user_ids)
-        return paginated_list(learners, page, page_size)
+            if records:
+                # There are some cases where we won't receive a record from the above
+                # method; right now, that should only happen if we have an Enterprise-linked
+                # user for the integrated channel, and transmission of that user's
+                # data requires an upstream user identifier that we don't have (due to a
+                # failure of SSO or similar). In such a case, `get_learner_data_record`
+                # would return None, and we'd simply skip yielding it here.
+                yield from records
 
-    def get_pending_users_queryset(self, search_keyword, customer_uuid):
+    @staticmethod
+    def has_data_sharing_consent(enterprise_enrollment):
         """
-        Get the list of PendingEnterpriseCustomerUsers we want to render.
-
-        Args:
-            search_keyword (str): The keyword to search for in pending users' email addresses.
-            customer_uuid (str): A unique identifier to filter down to only pending users
-            linked to a particular EnterpriseCustomer.
+        Helper method to determine whether an enrollment has data sharing consent or not.
         """
-        queryset = PendingEnterpriseCustomerUser.objects.filter(
-            enterprise_customer__uuid=customer_uuid
+        consent = DataSharingConsent.objects.proxied_get(
+            username=enterprise_enrollment.enterprise_customer_user.username,
+            course_id=enterprise_enrollment.course_id,
+            enterprise_customer=enterprise_enrollment.enterprise_customer_user.enterprise_customer
         )
+        if consent.granted and not enterprise_enrollment.audit_reporting_disabled:
+            return True
 
-        if search_keyword is not None:
-            queryset = queryset.filter(user_email__icontains=search_keyword)
-
-        return queryset
-
-    @classmethod
-    def _handle_singular(cls, request, enterprise_customer, manage_learners_form):
-        """
-        Link single user by email or username.
+        return False
 
-        Arguments:
-            enterprise_customer (EnterpriseCustomer): learners will be linked to this Enterprise Customer instance
-            manage_learners_form (ManageLearnersForm): bound ManageLearners form instance
+    def _determine_enrollments_permitted(
+            self,
+            lms_user_for_filter,
+            course_run_id,
+            channel_name,
+            skip_transmitted,
+            TransmissionAudit,
+            grade,
+    ):
         """
-        form_field_value = manage_learners_form.cleaned_data[ManageLearnersForm.Fields.EMAIL_OR_USERNAME]
-        email = email_or_username__to__email(form_field_value)
-        try:
-            existing_record = validate_email_to_link(email, form_field_value, ValidationMessages.
-                                                     INVALID_EMAIL_OR_USERNAME, True)
-        except ValidationError as exc:
-            manage_learners_form.add_error(ManageLearnersForm.Fields.EMAIL_OR_USERNAME, exc)
+        Determines which enrollments can be safely transmitted after checking
+        * enrollments that are already transmitted
+        * enrollments that are permitted to be transmitted by selecting enrollments for which:
+        *    - data sharing consent is granted
+        *    - audit_reporting is enabled (via enterprise level switch)
+        """
+        enrollments_to_process = self.get_enrollments_to_process(
+            lms_user_for_filter,
+            course_run_id,
+            channel_name,
+        )
+
+        if TransmissionAudit and skip_transmitted:
+            untransmitted_enrollments = self._filter_out_pre_transmitted_enrollments(
+                enrollments_to_process,
+                channel_name,
+                grade,
+                TransmissionAudit
+            )
         else:
-            if isinstance(existing_record, PendingEnterpriseCustomerUser) and existing_record.enterprise_customer \
-                    != enterprise_customer:
-                messages.warning(
-                    request,
-                    ValidationMessages.PENDING_USER_ALREADY_LINKED.format(
-                        user_email=email,
-                        ec_name=existing_record.enterprise_customer.name
-                    )
-                )
-                return None
-            EnterpriseCustomerUser.objects.link_user(enterprise_customer, email)
-            return [email]
-
-    @classmethod
-    def _handle_bulk_upload(cls, enterprise_customer, manage_learners_form, request, email_list=None):
-        """
-        Bulk link users by email.
+            untransmitted_enrollments = enrollments_to_process
 
-        Arguments:
-            enterprise_customer (EnterpriseCustomer): learners will be linked to this Enterprise Customer instance
-            manage_learners_form (ManageLearnersForm): bound ManageLearners form instance
-            request (django.http.request.HttpRequest): HTTP Request instance
-            email_list (iterable): A list of pre-processed email addresses to handle using the form
-        """
-        errors = []
-        emails = set()
-        already_linked_emails = []
-        duplicate_emails = []
-        csv_file = manage_learners_form.cleaned_data[ManageLearnersForm.Fields.BULK_UPLOAD]
-        if email_list:
-            parsed_csv = [{ManageLearnersForm.CsvColumns.EMAIL: email} for email in email_list]
+        # filter out enrollments which don't allow integrated_channels grade transmit
+        enrollments_permitted = set()
+        for enrollment in untransmitted_enrollments:
+            if (not LearnerExporter.has_data_sharing_consent(enrollment) or
+                    enrollment.audit_reporting_disabled):
+                continue
+            enrollments_permitted.add(enrollment)
+        return enrollments_permitted
+
+    def export_unique_courses(self):
+        """
+        Retrieve and export all unique course ID's from an enterprise customer's learner enrollments.
+        """
+        enrollment_queryset = EnterpriseCourseEnrollment.objects.select_related(
+            'enterprise_customer_user'
+        ).filter(
+            enterprise_customer_user__enterprise_customer=self.enterprise_customer,
+            enterprise_customer_user__active=True,
+        ).order_by('course_id')
+        return {get_course_id_for_enrollment(enrollment) for enrollment in enrollment_queryset}
+
+    def get_grades_summary(
+        self,
+        course_details,
+        enterprise_enrollment,
+        channel_name,
+        incomplete_count=None,
+    ):
+        '''
+        Fetch grades info using either certificate api, or grades api.
+        Note: This logic is going to be refactored, so that audit enrollments are treated separately
+        - For audit enrollments, currently will fetch using grades api,
+        - For non audit, it still calls grades api if pacing !=instructor otherwise calls certificate api
+        This pacing logic needs cleanup for a more accurate piece of logic since pacing should not be relevant
+
+        Returns: tuple with values:
+            completed_date_from_api, grade_from_api, is_passing_from_api, grade_percent, passed_timestamp
+        '''
+        is_audit_enrollment = enterprise_enrollment.is_audit_enrollment
+        lms_user_id = enterprise_enrollment.enterprise_customer_user.user_id
+        enterprise_customer_uuid = enterprise_enrollment.enterprise_customer_user.enterprise_customer.uuid
+        course_id = enterprise_enrollment.course_id
+
+        if is_audit_enrollment:
+            completed_date_from_api, grade_from_api, is_passing_from_api, grade_percent, passed_timestamp = \
+                self.collect_grades_data(enterprise_enrollment, course_details, channel_name)
+            if incomplete_count == 0 and completed_date_from_api is None:
+                LOGGER.info(generate_formatted_log(
+                    channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                    'Setting completed_date to now() for audit course with all non-gated content done.'
+                ))
+                completed_date_from_api = timezone.now()
         else:
-            parsed_csv = parse_csv(csv_file, expected_columns={ManageLearnersForm.CsvColumns.EMAIL})
-
-        try:
-            for index, row in enumerate(parsed_csv):
-                email = row[ManageLearnersForm.CsvColumns.EMAIL]
-                try:
-                    already_linked = validate_email_to_link(email, ignore_existing=True)
-                except ValidationError as exc:
-                    message = _("Error at line {line}: {message}\n").format(line=index + 1, message=exc)
-                    errors.append(message)
+            completed_date_from_api, grade_from_api, is_passing_from_api, grade_percent, passed_timestamp = \
+                self.collect_certificate_data(enterprise_enrollment, channel_name)
+            LOGGER.info(generate_formatted_log(
+                channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                f'collect_certificate_data finished with CompletedDate: {completed_date_from_api},'
+                f' Grade: {grade_from_api}, IsPassing: {is_passing_from_api},'
+                f' Passed timestamp: {passed_timestamp}'
+            ))
+            if completed_date_from_api is None:
+                # means we cannot find a cert for this learner
+                # we will try getting grades info using the alternative api in this case
+                # if that also does not exist then we have nothing to report
+                completed_date_from_api, grade_from_api, is_passing_from_api, grade_percent, passed_timestamp = \
+                    self.collect_grades_data(enterprise_enrollment, course_details, channel_name)
+                LOGGER.info(generate_formatted_log(
+                    channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                    f'No certificate found, obtained grading data from grades api.'
+                    f' CompletedDate: {completed_date_from_api},'
+                    f' Grade: {grade_from_api}, IsPassing: {is_passing_from_api},'
+                    f' Passed timestamp: {passed_timestamp}'
+                ))
+
+        return completed_date_from_api, grade_from_api, is_passing_from_api, grade_percent, passed_timestamp
+
+    def get_incomplete_content_count(self, enterprise_enrollment, channel_name):
+        '''
+        Fetch incomplete content count using completion blocks LMS api
+        Will return None for non audit enrollment (but this does not have to be the case necessarily)
+        '''
+        incomplete_count = None
+        is_audit_enrollment = enterprise_enrollment.is_audit_enrollment
+
+        # The decision to not get incomplete count for non audit enrollments can be questioned
+        # Right now we don't use this number for non audit. But this condition can be just removed
+        # if we decide we need this for non audit enrollments too
+        if not is_audit_enrollment:
+            return incomplete_count
+        lms_user_id = enterprise_enrollment.enterprise_customer_user.user_id
+        enterprise_customer_uuid = enterprise_enrollment.enterprise_customer_user.enterprise_customer.uuid
+        course_id = enterprise_enrollment.course_id
+
+        user = User.objects.get(pk=lms_user_id)
+        completion_summary = get_completion_summary(course_id, user)
+        incomplete_count = completion_summary.get('incomplete_count')
+        LOGGER.info(
+            generate_formatted_log(
+                channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                f'Incomplete count for audit enrollment is {incomplete_count}'
+            ))
+
+        return incomplete_count
+
+    def export(self, **kwargs):
+        """
+        Collect learner data for the ``EnterpriseCustomer`` where data sharing consent is granted.
+        If BOTH learner_to_transmit and course_run_id are present, collected data returned is narrowed to
+        that learner and course. If either param is absent or None, ALL data will be collected.
+
+        Yields a learner data object for each enrollment, containing:
+
+        * ``enterprise_enrollment``: ``EnterpriseCourseEnrollment`` object.
+        * ``user_email``: PII User/learner email string
+        * ``content_title``: Course title string
+        * ``completed_date``: datetime instance containing the course/enrollment completion date; None if not complete.
+          "Course completion" occurs for instructor-paced courses when course certificates are issued, and
+          for self-paced courses, when the course end date is passed, or when the learner achieves a passing grade.
+          Currently unused as it gets overridden from the grader data.
+        * ``grade``: string grade recorded for the learner in the course.
+        * ``learner_to_transmit``: OPTIONAL User, filters exported data
+        * ``course_run_id``: OPTIONAL Course key string, filters exported data
+
+        """
+        channel_name = kwargs.get('app_label')
+        lms_user_for_filter = kwargs.get('learner_to_transmit', None)
+        course_run_id = kwargs.get('course_run_id', None)
+        grade = kwargs.get('grade', None)
+        skip_transmitted = kwargs.get('skip_transmitted', True)
+        TransmissionAudit = kwargs.get('TransmissionAudit', None)
+
+        # Fetch the consenting enrollment data, including the enterprise_customer_user.
+        # Order by the course_id, to avoid fetching course API data more than we have to.
+        enrollments_permitted = self._determine_enrollments_permitted(
+            lms_user_for_filter,
+            course_run_id,
+            channel_name,
+            skip_transmitted,
+            TransmissionAudit,
+            grade,
+        )
+        enrollment_ids_to_export = [enrollment.id for enrollment in enrollments_permitted]
+
+        for enterprise_enrollment in enrollments_permitted:
+            lms_user_id = enterprise_enrollment.enterprise_customer_user.user_id
+            user_email = enterprise_enrollment.enterprise_customer_user.user_email
+            enterprise_customer_uuid = enterprise_enrollment.enterprise_customer_user.enterprise_customer.uuid
+            course_id = enterprise_enrollment.course_id
+
+            course_details, error_message = LearnerExporterUtility.get_course_details_by_id(course_id)
+
+            if course_details is None:
+                # Course not found, so we have nothing to report.
+                LOGGER.error(generate_formatted_log(
+                    channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                    f'get_course_details returned None for EnterpriseCourseEnrollment {enterprise_enrollment.pk}'
+                    f', error_message: {error_message}'
+                ))
+                continue
+
+            # For audit courses, check if 100% completed
+            # which we define as: no non-gated content is remaining
+            incomplete_count = self.get_incomplete_content_count(enterprise_enrollment, channel_name)
+
+            (
+                completed_date_from_api, grade_from_api,
+                is_passing_from_api, grade_percent, passed_timestamp
+            ) = self.get_grades_summary(
+                course_details,
+                enterprise_enrollment,
+                channel_name,
+                incomplete_count,
+            )
+
+            if completed_date_from_api:
+                if is_passing_from_api:
+                    progress_status = 'Passed'
                 else:
-                    if already_linked:
-                        already_linked_emails.append((email, already_linked.enterprise_customer))
-                    elif email in emails:
-                        duplicate_emails.append(email)
-                    else:
-                        emails.add(email)
-        except ValidationError as exc:
-            errors.append(exc)
-
-        if errors:
-            manage_learners_form.add_error(
-                ManageLearnersForm.Fields.GENERAL_ERRORS, ValidationMessages.BULK_LINK_FAILED
-            )
-            for error in errors:
-                manage_learners_form.add_error(ManageLearnersForm.Fields.BULK_UPLOAD, error)
-            return None
-
-        # There were no errors. Now do the actual linking:
-        for email in emails:
-            EnterpriseCustomerUser.objects.link_user(enterprise_customer, email)
-
-        # Report what happened:
-        count = len(emails)
-        messages.success(request, ungettext(
-            "{count} new learner was added to {enterprise_customer_name}.",
-            "{count} new learners were added to {enterprise_customer_name}.",
-            count
-        ).format(count=count, enterprise_customer_name=enterprise_customer.name))
-        this_customer_linked_emails = [
-            email for email, customer in already_linked_emails if customer == enterprise_customer
-        ]
-        other_customer_linked_emails = [
-            email for email, __ in already_linked_emails if email not in this_customer_linked_emails
-        ]
-        if this_customer_linked_emails:
-            messages.warning(
-                request,
-                _(
-                    "The following learners were already associated with this Enterprise "
-                    "Customer: {list_of_emails}"
-                ).format(
-                    list_of_emails=", ".join(this_customer_linked_emails)
-                )
-            )
-        if other_customer_linked_emails:
-            messages.warning(
-                request,
-                _(
-                    "The following learners are already associated with "
-                    "another Enterprise Customer. These learners were not "
-                    "added to {enterprise_customer_name}: {list_of_emails}"
-                ).format(
-                    enterprise_customer_name=enterprise_customer.name,
-                    list_of_emails=", ".join(other_customer_linked_emails),
-                )
-            )
-        if duplicate_emails:
-            messages.warning(
-                request,
-                _(
-                    "The following duplicate email addresses were not added: "
-                    "{list_of_emails}"
-                ).format(
-                    list_of_emails=", ".join(duplicate_emails)
-                )
-            )
-        # Build a list of all the emails that we can act on further; that is,
-        # emails that we either linked to this customer, or that were linked already.
-        all_processable_emails = list(emails) + this_customer_linked_emails
-
-        return all_processable_emails
-
-    @classmethod
-    def enroll_user(cls, enterprise_customer, user, course_mode, *course_ids):
-        """
-        Enroll a single user in any number of courses using a particular course mode.
-
-        Args:
-            enterprise_customer: The EnterpriseCustomer which is sponsoring the enrollment
-            user: The user who needs to be enrolled in the course
-            course_mode: The mode with which the enrollment should be created
-            *course_ids: An iterable containing any number of course IDs to eventually enroll the user in.
+                    progress_status = 'Failed'
+            else:
+                progress_status = 'In Progress'
 
-        Returns:
-            Boolean: Whether or not enrollment succeeded for all courses specified
-        """
-        enterprise_customer_user, __ = EnterpriseCustomerUser.objects.get_or_create(
-            enterprise_customer=enterprise_customer,
-            user_id=user.id
-        )
-        enrollment_client = EnrollmentApiClient()
-        succeeded = True
-        for course_id in course_ids:
-            try:
-                enrollment_client.enroll_user_in_course(user.username, course_id, course_mode)
-            except HttpClientError as exc:
-                # Check if user is already enrolled then we should ignore exception
-                if cls.is_user_enrolled(user, course_id, course_mode):
-                    succeeded = True
-                else:
-                    succeeded = False
-                    default_message = 'No error message provided'
+            # Apply the Source of Truth for Grades
+            # Note: Only completed records are transmitted by the completion transmitter
+            #       therefore even non complete grading/cert records are exported here.
+            records = self.get_learner_data_records(
+                enterprise_enrollment=enterprise_enrollment,
+                user_email=user_email,
+                completed_date=completed_date_from_api,
+                grade=grade_from_api,
+                content_title=course_details.display_name,
+                progress_status=progress_status,
+                course_completed=is_course_completed(
+                    enterprise_enrollment,
+                    is_passing_from_api,
+                    incomplete_count,
+                    passed_timestamp,
+                ),
+                grade_percent=grade_percent,
+            )
+
+            if records:
+                # There are some cases where we won't receive a record from the above
+                # method; right now, that should only happen if we have an Enterprise-linked
+                # user for the integrated channel, and transmission of that user's
+                # data requires an upstream user identifier that we don't have (due to a
+                # failure of SSO or similar). In such a case, `get_learner_data_record`
+                # would return None, and we'd simply skip yielding it here.
+                for record in records:
+                    # Because we export a course and course run under the same enrollment, we can only remove the
+                    # enrollment from the list of enrollments to export, once.
                     try:
-                        error_message = json.loads(exc.content.decode()).get('message', default_message)
+                        enrollment_ids_to_export.pop(enrollment_ids_to_export.index(enterprise_enrollment.id))
                     except ValueError:
-                        error_message = default_message
-                    logging.error(
-                        'Error while enrolling user %(user)s: %(message)s',
-                        dict(user=user.username, message=error_message)
-                    )
-            if succeeded:
-                __, created = EnterpriseCourseEnrollment.objects.get_or_create(
-                    enterprise_customer_user=enterprise_customer_user,
-                    course_id=course_id,
-                    defaults={
-                        'source': EnterpriseEnrollmentSource.get_source(EnterpriseEnrollmentSource.MANUAL)
-                    }
-                )
-                if created:
-                    track_enrollment('admin-enrollment', user.id, course_id)
-        return succeeded
-
-    @classmethod
-    def is_user_enrolled(cls, user, course_id, course_mode):
-        """
-        Query the enrollment API and determine if a learner is enrolled in a given course run track.
+                        pass
 
-        Args:
-            user: The user whose enrollment needs to be checked
-            course_mode: The mode with which the enrollment should be checked
-            course_id: course id of the course where enrollment should be checked.
-
-        Returns:
-            Boolean: Whether or not enrollment exists
+                    yield record
 
+        LOGGER.info(generate_formatted_log(
+            channel_name, None, lms_user_for_filter, course_run_id,
+            f'export finished. Did not export records for EnterpriseCourseEnrollment objects: '
+            f' {enrollment_ids_to_export}.'
+        ))
+
+    def _filter_out_pre_transmitted_enrollments(
+            self,
+            enrollments_to_process,
+            channel_name,
+            grade,
+            transmission_audit
+    ):
         """
-        enrollment_client = EnrollmentApiClient()
-        try:
-            enrollments = enrollment_client.get_course_enrollment(user.username, course_id)
-            if enrollments and course_mode == enrollments.get('mode'):
-                return True
-        except HttpClientError as exc:
-            logging.error(
-                'Error while checking enrollment status of user %(user)s: %(message)s',
-                dict(user=user.username, message=str(exc))
-            )
-        except KeyError as exc:
-            logging.warning(
-                'Error while parsing enrollment data of user %(user)s: %(message)s',
-                dict(user=user.username, message=str(exc))
-            )
-        return False
-
-    @classmethod
-    def get_users_by_email(cls, emails):
-        """
-        Accept a list of emails, and separate them into users that exist on OpenEdX and users who don't.
-
-        Args:
-            emails: An iterable of email addresses to split between existing and nonexisting
-
-        Returns:
-            users: Queryset of users who exist in the OpenEdX platform and who were in the list of email addresses
-            unregistered_emails: List of unique emails which were in the original list, but do not yet exist as users
+        Given an enrollments_to_process, returns only enrollments that are not already transmitted
         """
-        users = User.objects.filter(email__in=emails)
-        present_emails = users.values_list('email', flat=True)
-        unregistered_emails = get_idiff_list(emails, present_emails)
-        return users, unregistered_emails
-
-    @classmethod
-    def enroll_users_in_course(
-            cls,
-            enterprise_customer,
-            course_id,
-            course_mode,
-            emails,
-            enrollment_requester=None,
-            enrollment_reason=None,
-            discount=0.0,
-            sales_force_id=None,
+        included_enrollments = set()
+        for enterprise_enrollment in enrollments_to_process:
+            lms_user_id = enterprise_enrollment.enterprise_customer_user.user_id
+            enterprise_customer_uuid = enterprise_enrollment.enterprise_customer_user.enterprise_customer.uuid
+            course_id = enterprise_enrollment.course_id
+
+            if transmission_audit and \
+                    is_already_transmitted(
+                        transmission_audit,
+                        enterprise_enrollment.id,
+                        self.enterprise_configuration.id,
+                        grade,
+                        detect_grade_updated=self.INCLUDE_GRADE_FOR_COMPLETION_AUDIT_CHECK,
+                    ):
+                # We've already sent a completion status for this enrollment
+                LOGGER.info(generate_formatted_log(
+                    channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                    'Skipping export of previously sent enterprise enrollment. '
+                    'EnterpriseCourseEnrollment: {enterprise_enrollment_id}'.format(
+                        enterprise_enrollment_id=enterprise_enrollment.id
+                    )))
+                continue
+            included_enrollments.add(enterprise_enrollment)
+        return included_enrollments
+
+    def get_enrollments_to_process(self, lms_user_for_filter, course_run_id, channel_name):
+        """
+        Fetches list of EnterpriseCourseEnrollments ordered by course_id.
+        List is filtered by learner and course_run_id if both are provided
+
+        lms_user_for_filter: If None, data for ALL courses and learners will be returned
+        course_run_id: If None, data for ALL courses and learners will be returned
+
+        """
+        enrollment_queryset = EnterpriseCourseEnrollment.objects.select_related(
+            'enterprise_customer_user'
+        ).filter(
+            enterprise_customer_user__enterprise_customer=self.enterprise_customer,
+            enterprise_customer_user__active=True,
+        )
+        if lms_user_for_filter and course_run_id:
+            enrollment_queryset = enrollment_queryset.filter(
+                course_id=course_run_id,
+                enterprise_customer_user__user_id=lms_user_for_filter.id,
+            )
+            LOGGER.info(generate_formatted_log(
+                channel_name, self.enterprise_customer.uuid, lms_user_for_filter, course_run_id,
+                'get_enrollments_to_process run for single learner and course.'))
+        enrollment_queryset = enrollment_queryset.order_by('course_id')
+        # return resolved list instead of queryset
+        return list(enrollment_queryset)
+
+    def get_learner_assessment_data_records(
+            self,
+            enterprise_enrollment,
+            assessment_grade_data
     ):
         """
-        Enroll existing users in a course, and create a pending enrollment for nonexisting users.
-
-        Args:
-            enterprise_customer: The EnterpriseCustomer which is sponsoring the enrollment
-            course_id (str): The unique identifier of the course in which we're enrolling
-            course_mode (str): The mode with which we're enrolling in the course
-            emails: An iterable of email addresses which need to be enrolled
-            enrollment_requester (User): Admin user who is requesting the enrollment.
-            enrollment_reason (str): A reason for enrollment.
-            discount (Decimal): Percentage discount for enrollment.
-            sales_force_id (str): Salesforce opportunity id.
-
-        Returns:
-            successes: A list of users who were successfully enrolled in the course
-            pending: A list of PendingEnterpriseCustomerUsers who were successfully linked and had
-                pending enrollments created for them in the database
-            failures: A list of users who could not be enrolled in the course
-        """
-        existing_users, unregistered_emails = cls.get_users_by_email(emails)
-
-        successes = []
-        pending = []
-        failures = []
-
-        for user in existing_users:
-            succeeded = cls.enroll_user(enterprise_customer, user, course_mode, course_id)
-            if succeeded:
-                successes.append(user)
-                if enrollment_requester and enrollment_reason:
-                    create_manual_enrollment_audit(
-                        enrollment_requester,
-                        user.email,
-                        UNENROLLED_TO_ENROLLED,
-                        enrollment_reason,
-                        course_id,
-                        role=MANUAL_ENROLLMENT_ROLE,
-                    )
-            else:
-                failures.append(user)
+        Generate a learner assessment data transmission audit with fields properly filled in.
+        Returns a list of LearnerDataTransmissionAudit objects.
 
-        for email in unregistered_emails:
-            pending_user = enterprise_customer.enroll_user_pending_registration(
-                email,
-                course_mode,
-                course_id,
-                enrollment_source=EnterpriseEnrollmentSource.get_source(EnterpriseEnrollmentSource.MANUAL),
-                discount=discount,
-                sales_force_id=sales_force_id,
+        enterprise_enrollment: the ``EnterpriseCourseEnrollment`` object we are getting a learner's data for.
+        assessment_grade_data: A dict with keys corresponding to different edX course subsections.
+        See _collect_assessment_grades_data for the formatted data returned as the value for a given key.
+        """
+        TransmissionAudit = apps.get_model('integrated_channel', 'GenericLearnerDataTransmissionAudit')
+        user_subsection_audits = []
+        # Create an audit for each of the subsections in the course data.
+        for subsection_data in assessment_grade_data.values():
+            subsection_percent_grade = subsection_data.get('grade')
+            subsection_id = subsection_data.get('subsection_id')
+            # Sanity check for a grade to report
+            if not subsection_percent_grade or not subsection_id:
+                continue
+
+            user_subsection_audits.append(TransmissionAudit(
+                plugin_configuration_id=self.enterprise_configuration.id,
+                enterprise_customer_uuid=self.enterprise_configuration.enterprise_customer.uuid,
+                enterprise_course_enrollment_id=enterprise_enrollment.id,
+                course_id=enterprise_enrollment.course_id,
+                subsection_id=subsection_id,
+                grade=subsection_percent_grade,
+            ))
+
+        return user_subsection_audits
+
+    def get_learner_data_records(
+            self,
+            enterprise_enrollment,
+            completed_date=None,
+            grade=None,
+            course_completed=False,
+            grade_percent=None,
+            content_title=None,
+            user_email=None,
+            progress_status=None,
+
+    ):  # pylint: disable=unused-argument
+        """
+        Generate a learner data transmission audit with fields properly filled in.
+        """
+        TransmissionAudit = apps.get_model('integrated_channel', 'GenericLearnerDataTransmissionAudit')
+        completed_timestamp = None
+        if completed_date is not None:
+            completed_timestamp = parse_datetime_to_epoch_millis(completed_date)
+        # We return two records here, one with the course key and one with the course run id, to account for
+        # uncertainty about the type of content (course vs. course run) that was sent to the integrated channel.
+        return [
+            TransmissionAudit(
+                plugin_configuration_id=self.enterprise_configuration.id,
+                enterprise_customer_uuid=self.enterprise_configuration.enterprise_customer.uuid,
+                enterprise_course_enrollment_id=enterprise_enrollment.id,
+                course_id=get_course_id_for_enrollment(enterprise_enrollment),
+                course_completed=course_completed,
+                completed_timestamp=completed_timestamp,
+                grade=grade,
+                user_email=user_email,
+                content_title=content_title,
+                progress_status=progress_status,
+            ),
+            TransmissionAudit(
+                plugin_configuration_id=self.enterprise_configuration.id,
+                enterprise_customer_uuid=self.enterprise_configuration.enterprise_customer.uuid,
+                enterprise_course_enrollment_id=enterprise_enrollment.id,
+                course_id=enterprise_enrollment.course_id,
+                course_completed=course_completed,
+                completed_timestamp=completed_timestamp,
+                grade=grade,
+                user_email=user_email,
+                content_title=content_title,
+                progress_status=progress_status,
             )
-            pending.append(pending_user)
-            if enrollment_requester and enrollment_reason:
-                create_manual_enrollment_audit(
-                    enrollment_requester,
-                    email,
-                    UNENROLLED_TO_ALLOWEDTOENROLL,
-                    enrollment_reason,
-                    course_id,
-                    role=MANUAL_ENROLLMENT_ROLE,
-                )
-
-        return successes, pending, failures
+        ]
 
-    @classmethod
-    def send_messages(cls, http_request, message_requests):
+    def collect_certificate_data(self, enterprise_enrollment, channel_name):
         """
-        Deduplicate any outgoing message requests, and send the remainder.
+        Collect the learner completion data from the course certificate.
 
-        Args:
-            http_request: The HTTP request in whose response we want to embed the messages
-            message_requests: A list of undeduplicated messages in the form of tuples of message type
-                and text- for example, ('error', 'Something went wrong')
-        """
-        deduplicated_messages = set(message_requests)
-        for msg_type, text in deduplicated_messages:
-            message_function = getattr(messages, msg_type)
-            message_function(http_request, text)
+        Used for Instructor-paced courses.
 
-    @classmethod
-    def get_success_enrollment_message(cls, users, enrolled_in):
-        """
-        Create message for the users who were enrolled in a course.
+        If no certificate is found, then returns the completed_date = None, grade = In Progress, on the idea that a
+        certificate will eventually be generated.
 
         Args:
-            users: An iterable of users who were successfully enrolled
-            enrolled_in (str): A string identifier for the course the users were enrolled in
-
-        Returns:
-            tuple: A 2-tuple containing a message type and message text
-        """
-        enrolled_count = len(users)
-        return (
-            'success',
-            ungettext(
-                '{enrolled_count} learner was enrolled in {enrolled_in}.',
-                '{enrolled_count} learners were enrolled in {enrolled_in}.',
-                enrolled_count,
-            ).format(
-                enrolled_count=enrolled_count,
-                enrolled_in=enrolled_in,
-            )
-        )
-
-    @classmethod
-    def get_failed_enrollment_message(cls, users, enrolled_in):
-        """
-        Create message for the users who were not able to be enrolled in a course.
+            enterprise_enrollment (EnterpriseCourseEnrollment): the enterprise enrollment record for which we need to
+            collect completion/grade data,
+            channel_name: labeled for relevant integrated channel this is being called for to enhance logging.
+
+        Returns:
+            completed_date: Date the course was completed, this is None if course has not been completed.
+            grade: Current grade in the course.
+            percent_grade: The current percent grade in the course.
+            is_passing: Boolean indicating if the grade is a passing grade or not.
+            passed_timestamp: Timestamp when learner obtained passing grade.
+        """
+
+        course_id = enterprise_enrollment.course_id
+        lms_user_id = enterprise_enrollment.enterprise_customer_user.user_id
+        enterprise_customer_uuid = enterprise_enrollment.enterprise_customer_user.enterprise_customer.uuid
+        user = User.objects.get(pk=lms_user_id)
+        passed_timestamp = None
+
+        completed_date = None
+        grade = self.grade_incomplete
+        is_passing = False
+        percent_grade = None
 
-        Args:
-            users: An iterable of users who were not successfully enrolled
-            enrolled_in (str): A string identifier for the course with which enrollment was attempted
+        try:
+            certificate = get_course_certificate(course_id, user)
+        except InvalidKeyError:
+            certificate = None
+            LOGGER.error(generate_formatted_log(
+                channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                'get_course_certificate failed. Certificate fetch failed due to invalid course_id for'
+                f' EnterpriseCourseEnrollment: {enterprise_enrollment}. Data export will continue without grade.'
+            ))
+
+        if not certificate:
+            return completed_date, grade, is_passing, percent_grade, passed_timestamp
+
+        LOGGER.info(generate_formatted_log(
+            channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+            f'get_course_certificate certificate={certificate}'
+        ))
+
+        # get_certificate_for_user has an optional formatting argument which defaults to True
+        # edx-platform/blob/6b9eb122dd5b018cfeffc120a70e503b2c159c0b/lms/djangoapps/certificates/api.py#L128
+        # when True, the certifiate's `created_date` is transformed into just `created`
+        completed_date = certificate.get('created', None)
+        # guard against the default formatting argument changing
+        if not completed_date:
+            completed_date = certificate.get('created_date', None)
+        if completed_date:
+            completed_date = parse_datetime(str(completed_date))
+
+        # also get passed_timestamp which is used to line up completion logic with analytics
+        persistent_grade = get_persistent_grade(course_id, user)
+        passed_timestamp = persistent_grade.passed_timestamp if persistent_grade is not None else None
+
+        if (not completed_date) and passed_timestamp:
+            LOGGER.info(generate_formatted_log(
+                channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                'get_course_certificate misisng created/created_date, '
+                'but there is a passed_timestamp so using that'
+            ))
+            completed_date = datetime.fromtimestamp((passed_timestamp / 1000), tz=timezone.utc)
+        elif not completed_date and not passed_timestamp:
+            LOGGER.info(generate_formatted_log(
+                channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                'get_course_certificate misisng created/created_date, '
+                'no passed_timestamp so defaulting to timezone.now(), '
+                f'certificate={certificate}'
+            ))
+            completed_date = timezone.now()
+
+        # For consistency with _collect_grades_data, we only care about Pass/Fail grades. This could change.
+        is_passing = certificate.get('is_passing')
+        percent_grade = certificate.get('grade')
+        grade = self.grade_passing if is_passing else self.grade_failing
 
-        Returns:
-        tuple: A 2-tuple containing a message type and message text
-        """
-        failed_emails = [user.email for user in users]
-        return (
-            'error',
-            _(
-                'The following learners could not be enrolled in {enrolled_in}: {user_list}'
-            ).format(
-                enrolled_in=enrolled_in,
-                user_list=', '.join(failed_emails),
-            )
-        )
+        return completed_date, grade, is_passing, percent_grade, passed_timestamp
 
-    @classmethod
-    def get_pending_enrollment_message(cls, pending_users, enrolled_in):
+    def _collect_assessment_grades_data(self, enterprise_enrollment):
         """
-        Create message for the users who were enrolled in a course.
+        Collect a learner's assessment level grade data using an enterprise enrollment, from the Grades API.
 
         Args:
-            users: An iterable of PendingEnterpriseCustomerUsers who were successfully linked with a pending enrollment
-            enrolled_in (str): A string identifier for the course the pending users were linked to
-
+            enterprise_enrollment (EnterpriseCourseEnrollment): the enterprise enrollment record for which we need to
+            collect subsection grades data
         Returns:
-            tuple: A 2-tuple containing a message type and message text
-        """
-        pending_emails = [pending_user.user_email for pending_user in pending_users]
-        return (
-            'warning',
-            _(
-                "The following learners do not have an account on "
-                "{platform_name}. They have not been enrolled in "
-                "{enrolled_in}. When these learners create an account, they will "
-                "be enrolled automatically: {pending_email_list}"
-            ).format(
-                platform_name=settings.PLATFORM_NAME,
-                enrolled_in=enrolled_in,
-                pending_email_list=', '.join(pending_emails),
-            )
-        )
+            Dict:
+                {
+                    [subsection name]: {
+                        'grade_category': category,
+                        'grade': percent grade,
+                        'assessment_label': label,
+                        'grade_point_score': points earned on the assignment,
+                        'grade_points_possible': max possible points on the assignment,
+                        'subsection_id': subsection module ID
+                    }
 
-    @classmethod
-    def _enroll_users(
-            cls,
-            request,
-            enterprise_customer,
-            emails,
-            mode,
-            course_id=None,
-            notify=True,
-            enrollment_reason=None,
-            sales_force_id=None,
-            discount=0.0
-    ):
+                    ...
+                }
         """
-        Enroll the users with the given email addresses to the course.
-
-        Args:
-            cls (type): The EnterpriseCustomerManageLearnersView class itself
-            request: The HTTP request the enrollment is being created by
-            enterprise_customer: The instance of EnterpriseCustomer whose attached users we're enrolling
-            emails: An iterable of strings containing email addresses to enroll in a course
-            mode: The enrollment mode the users will be enrolled in the course with
-            course_id: The ID of the course in which we want to enroll
-            notify: Whether to notify (by email) the users that have been enrolled
-        """
-        pending_messages = []
-        paid_modes = ['verified', 'professional']
-
-        succeeded, pending, failed = cls.enroll_users_in_course(
-            enterprise_customer=enterprise_customer,
-            course_id=course_id,
-            course_mode=mode,
-            emails=emails,
-            enrollment_requester=request.user,
-            enrollment_reason=enrollment_reason,
-            discount=discount,
-            sales_force_id=sales_force_id,
-        )
-        all_successes = succeeded + pending
-        if notify:
-            enterprise_customer.notify_enrolled_learners(
-                catalog_api_user=request.user,
-                course_id=course_id,
-                users=all_successes,
-            )
-        if succeeded:
-            pending_messages.append(cls.get_success_enrollment_message(succeeded, course_id))
-        if failed:
-            pending_messages.append(cls.get_failed_enrollment_message(failed, course_id))
-        if pending:
-            pending_messages.append(cls.get_pending_enrollment_message(pending, course_id))
-
-        if mode in paid_modes:
-            # Create an order to track the manual enrollments of non-pending accounts
-            enrollments = [{
-                "lms_user_id": success.id,
-                "email": success.email,
-                "username": success.username,
-                "course_run_key": course_id,
-                "discount_percentage": float(discount),
-                "enterprise_customer_name": enterprise_customer.name,
-                "enterprise_customer_uuid": str(enterprise_customer.uuid),
-                "mode": mode,
-                "sales_force_id": sales_force_id,
-            } for success in succeeded]
-            EcommerceApiClient(get_ecommerce_worker_user()).create_manual_enrollment_orders(enrollments)
-        cls.send_messages(request, pending_messages)
+        if self.grades_api is None:
+            self.grades_api = GradesApiClient(self.user)
 
-    def get(self, request, customer_uuid):
-        """
-        Handle GET request - render linked learners list and "Link learner" form.
+        course_id = enterprise_enrollment.course_id
+        username = enterprise_enrollment.enterprise_customer_user.user.username
+        try:
+            assessment_grades_data = self.grades_api.get_course_assessment_grades(course_id, username)
+        except HTTPError as err:
+            if err.response and err.response.status_code == 404:
+                return {}
+            raise err
+
+        assessment_grades = {}
+        for grade in assessment_grades_data:
+            if not grade.get('attempted'):
+                continue
+            assessment_grades[grade.get('subsection_name')] = {
+                'grade_category': grade.get('category'),
+                'grade': grade.get('percent'),
+                'assessment_label': grade.get('label'),
+                'grade_point_score': grade.get('score_earned'),
+                'grade_points_possible': grade.get('score_possible'),
+                'subsection_id': grade.get('module_id')
+            }
 
-        Arguments:
-            request (django.http.request.HttpRequest): Request instance
-            customer_uuid (str): Enterprise Customer UUID
+        return assessment_grades
 
-        Returns:
-            django.http.response.HttpResponse: HttpResponse
+    def collect_grades_data(self, enterprise_enrollment, course_details, channel_name):
         """
-        enterprise_customer = EnterpriseCustomer.objects.get(uuid=customer_uuid)  # pylint: disable=no-member
-        manage_learners_form = ManageLearnersForm(user=request.user, enterprise_customer=enterprise_customer)
+        Collect the learner completion data from the Grades API.
 
-        return self.get_form_view(
-            request,
-            customer_uuid,
-            additional_context={
-                self.ContextParameters.MANAGE_LEARNERS_FORM: manage_learners_form
-            }
-        )
+        Used for self-paced courses.
 
-    def post(self, request, customer_uuid):
-        """
-        Handle POST request - handle form submissions.
+        Args:
+            enterprise_enrollment (EnterpriseCourseEnrollment): the enterprise enrollment record for which we need to
+            collect completion/grade data
+            course_details (CourseOverview): the course details for the course in the enterprise enrollment record.
+            channel_name: Integrated channel name for improved logging.
+
+        Returns:
+            completed_date: Date the course was completed, None if course has not been completed.
+            grade: Current grade in the course.
+            is_passing: Boolean indicating if the grade is a passing grade or not.
+            percent_grade: a number between 0 and 100
+            passed_timestamp: Timestamp when learner obtained passing grade.
+        """
+
+        course_id = enterprise_enrollment.course_id
+        lms_user_id = enterprise_enrollment.enterprise_customer_user.user_id
+        user = User.objects.get(pk=lms_user_id)
+        enterprise_customer_uuid = enterprise_enrollment.enterprise_customer_user.enterprise_customer.uuid
+
+        grades_data = get_single_user_grade(course_id, user)
+
+        if grades_data is None:
+            LOGGER.warning(generate_formatted_log(
+                channel_name, enterprise_customer_uuid, lms_user_id, course_id,
+                f'No grade found for '
+                f'EnterpriseCourseEnrollment: {enterprise_enrollment}.'
+            ))
+            # if enrollment found, but no grades, we can safely mark as incomplete/in progress
+            return None, LearnerExporter.GRADE_INCOMPLETE, None, None, None
+
+        # also get passed_timestamp which is used to line up completion logic with analytics
+        persistent_grade = get_persistent_grade(course_id, user)
+        passed_timestamp = persistent_grade.passed_timestamp if persistent_grade is not None else None
+
+        # Prepare to process the course end date and pass/fail grade
+        course_end_date = course_details.end
+        now = timezone.now()
+        is_passing = grades_data.passed
+
+        # We can consider a course complete if:
+        # * the course's end date has passed
+        if course_end_date is not None and course_end_date < now:
+            completed_date = course_end_date
+            grade = self.grade_passing if is_passing else self.grade_failing
+            grade = self.grade_audit if enterprise_enrollment.is_audit_enrollment else grade
+
+        # * Or, the learner has a passing grade (as of now)
+        elif is_passing:
+            completed_date = now
+            grade = self.grade_passing
 
-        Arguments:
-            request (django.http.request.HttpRequest): Request instance
-            customer_uuid (str): Enterprise Customer UUID
+        # Otherwise, the course is still in progress
+        else:
+            completed_date = None
+            grade = self.grade_incomplete
 
-        Returns:
-            django.http.response.HttpResponse: HttpResponse
-        """
-        enterprise_customer = EnterpriseCustomer.objects.get(uuid=customer_uuid)  # pylint: disable=no-member
-        manage_learners_form = ManageLearnersForm(
-            request.POST,
-            request.FILES,
-            user=request.user,
-            enterprise_customer=enterprise_customer
-        )
+        percent_grade = grades_data.percent
 
-        # initial form validation - check that form data is well-formed
-        if manage_learners_form.is_valid():
-            email_field_as_bulk_input = split_usernames_and_emails(
-                manage_learners_form.cleaned_data[ManageLearnersForm.Fields.EMAIL_OR_USERNAME]
-            )
-            is_bulk_entry = len(email_field_as_bulk_input) > 1
-            # The form is valid. Call the appropriate helper depending on the mode:
-            mode = manage_learners_form.cleaned_data[ManageLearnersForm.Fields.MODE]
-            if mode == ManageLearnersForm.Modes.MODE_SINGULAR and not is_bulk_entry:
-                linked_learners = self._handle_singular(request, enterprise_customer, manage_learners_form)
-            elif mode == ManageLearnersForm.Modes.MODE_SINGULAR:
-                linked_learners = self._handle_bulk_upload(
-                    enterprise_customer,
-                    manage_learners_form,
-                    request,
-                    email_list=email_field_as_bulk_input
-                )
-            else:
-                linked_learners = self._handle_bulk_upload(enterprise_customer, manage_learners_form, request)
+        return completed_date, grade, is_passing, percent_grade, passed_timestamp
 
-        # _handle_form might add form errors, so we check if it is still valid
-        if manage_learners_form.is_valid():
-            course_details = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.COURSE)
-
-            # If we aren't installed in Open edX, blank out enrollment reason so downstream methods don't attempt to
-            # create audit items
-            if create_manual_enrollment_audit is not None:
-                manual_enrollment_reason = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.REASON)
-            else:
-                manual_enrollment_reason = None
-                logging.exception(
-                    "To create enrollment audits for enterprise learners, "
-                    "this package must be installed in an Open edX environment."
-                )
-
-            notification_type = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.NOTIFY)
-            notify = notification_type == ManageLearnersForm.NotificationTypes.BY_EMAIL
-            discount = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.DISCOUNT)
-            sales_force_id = manage_learners_form.cleaned_data.get(ManageLearnersForm.Fields.SALES_FORCE_ID)
-            course_id = course_details['course_id'] if course_details else None
-
-            if course_id:
-                course_mode = manage_learners_form.cleaned_data[ManageLearnersForm.Fields.COURSE_MODE]
-                if linked_learners:
-                    self._enroll_users(
-                        request=request,
-                        enterprise_customer=enterprise_customer,
-                        emails=linked_learners,
-                        mode=course_mode,
-                        course_id=course_id,
-                        notify=notify,
-                        enrollment_reason=manual_enrollment_reason,
-                        sales_force_id=sales_force_id,
-                        discount=discount
-                    )
-
-            # Redirect to GET if everything went smooth.
-            manage_learners_url = reverse("admin:" + UrlNames.MANAGE_LEARNERS, args=(customer_uuid,))
-            search_keyword = self.get_search_keyword(request)
-            if search_keyword:
-                manage_learners_url = manage_learners_url + "?q=" + search_keyword
-            return HttpResponseRedirect(manage_learners_url)
-
-        # if something went wrong - display bound form on the page
-        return self.get_form_view(
-            request,
-            customer_uuid,
-            additional_context={
-                self.ContextParameters.MANAGE_LEARNERS_FORM: manage_learners_form
-            }
-        )
 
-    def delete(self, request, customer_uuid):
-        """
-        Handle DELETE request - handle unlinking learner.
+class LearnerExporterUtility:
+    """ Utility class namespace for accessing Django objects in a common way. """
 
-        Arguments:
-            request (django.http.request.HttpRequest): Request instance
-            customer_uuid (str): Enterprise Customer UUID
+    @staticmethod
+    def lms_user_id_for_ent_course_enrollment_id(enterprise_course_enrollment_id):
+        """ Returns the ID of the LMS User for the EnterpriseCourseEnrollment id passed in
+        or None if EnterpriseCourseEnrollment not found """
+        try:
+            return EnterpriseCourseEnrollment.objects.get(
+                id=enterprise_course_enrollment_id).enterprise_customer_user.user_id
+        except EnterpriseCourseEnrollment.DoesNotExist:
+            return None
 
-        Returns:
-            django.http.response.HttpResponse: HttpResponse
-        """
-        # TODO: pylint acts stupid - find a way around it without suppressing
-        enterprise_customer = EnterpriseCustomer.objects.get(uuid=customer_uuid)  # pylint: disable=no-member
-        email_to_unlink = request.GET["unlink_email"]
+    @staticmethod
+    def get_course_details_by_id(course_id):
+        '''
+        Convenience method to fetch course details or None (if not found)
+        '''
+        course_details = None
+        error_message = None
         try:
-            EnterpriseCustomerUser.objects.unlink_user(
-                enterprise_customer=enterprise_customer, user_email=email_to_unlink
-            )
-        except (EnterpriseCustomerUser.DoesNotExist, PendingEnterpriseCustomerUser.DoesNotExist):
-            message = _("Email {email} is not associated with Enterprise "
-                        "Customer {ec_name}").format(
-                            email=email_to_unlink, ec_name=enterprise_customer.name)
-            # pylint: disable=http-response-with-content-type-json
-            return HttpResponse(message, content_type="application/json", status=404)
+            course_details = get_course_details(course_id)
+        except (InvalidKeyError, CourseOverview.DoesNotExist):
+            error_message = f'get_course_details failed for course_id {course_id}'
 
-        return JsonResponse({})
+        return course_details, error_message
```

### Comparing `edx-enterprise-3.9.9/enterprise/admin/forms.py` & `edx-enterprise-4.0.0/enterprise/admin/forms.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,50 +1,50 @@
-# -*- coding: utf-8 -*-
 """
 Forms to be used in the enterprise djangoapp.
 """
 
 import re
 from logging import getLogger
+from uuid import UUID
 
+from config_models.admin import ConfigurationModelAdmin
 from edx_rbac.admin.forms import UserRoleAssignmentAdminForm
 
 from django import forms
 from django.conf import settings
-from django.contrib.auth.models import User
+from django.contrib import admin, auth
 from django.core.exceptions import ValidationError
+from django.db.models import Q
 from django.db.models.fields import BLANK_CHOICE_DASH
 from django.urls import reverse
 from django.utils.safestring import mark_safe
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
 from enterprise import utils
-from enterprise.admin.utils import (
-    ValidationMessages,
-    email_or_username__to__email,
-    split_usernames_and_emails,
-    validate_email_to_link,
-)
+from enterprise.admin.utils import email_or_username__to__email, split_usernames_and_emails
 from enterprise.admin.widgets import SubmitInput
-from enterprise.api_client.lms import EnrollmentApiClient
 from enterprise.models import (
+    AdminNotification,
+    BulkCatalogQueryUpdateCommandConfiguration,
     EnterpriseCustomer,
     EnterpriseCustomerCatalog,
     EnterpriseCustomerIdentityProvider,
     EnterpriseCustomerReportingConfiguration,
     EnterpriseFeatureUserRoleAssignment,
     SystemWideEnterpriseUserRoleAssignment,
 )
+from enterprise.utils import ValidationMessages, validate_email_to_link
 
 try:
-    from third_party_auth.models import SAMLProviderConfig as saml_provider_configuration
+    from common.djangoapps.third_party_auth.models import SAMLProviderConfig as saml_provider_configuration
 except ImportError:
     saml_provider_configuration = None
 
-logger = getLogger(__name__)  # pylint: disable=invalid-name
+logger = getLogger(__name__)
+User = auth.get_user_model()
 
 
 class ManageLearnersForm(forms.Form):
     """
     Form to manage learner additions.
     """
     email_or_username = forms.CharField(
@@ -55,15 +55,17 @@
         label=_(
             "To add multiple learners, upload a .csv file that contains a "
             "column of email addresses."
         ),
         required=False,
         help_text=_(
             "The .csv file must have a column of email addresses, indicated "
-            "by the heading 'email' in the first row."
+            "by the heading 'email' in the first row. Optionally, the .csv file may contain "
+            "a column of course run keys, indicated by the heading 'course_id' in the first row, to "
+            "enroll learners in multiple courses."
         )
     )
     course = forms.CharField(
         label=_("Enroll these learners in this course"), required=False,
         help_text=_("To enroll learners in a course, enter a course ID."),
     )
     course_mode = forms.ChoiceField(
@@ -71,14 +73,15 @@
         choices=BLANK_CHOICE_DASH + [
             ("audit", _("Audit")),
             ("verified", _("Verified")),
             ("professional", _("Professional Education")),
             ("no-id-professional", _("Professional Education (no ID)")),
             ("credit", _("Credit")),
             ("honor", _("Honor")),
+            ("unpaid-executive-education", _("Unpaid Executive Education")),
         ],
     )
     reason = forms.CharField(label=_("Reason for manual enrollment"), required=False)
     sales_force_id = forms.CharField(label=_("Salesforce Opportunity ID"), required=False)
     discount = forms.DecimalField(
         label=_("Discount percentage for manual enrollment"),
         help_text=_("Discount percentage should be from 0 to 100"),
@@ -129,28 +132,29 @@
         DISCOUNT = "discount"
 
     class CsvColumns:
         """
         Namespace class for CSV column names.
         """
         EMAIL = "email"
+        COURSE_ID = "course_id"
 
     def __init__(self, *args, **kwargs):
         """
         Initializes form: puts current user and enterprise_customer into a
         field for later access.
 
         Arguments:
             user (django.contrib.auth.models.User): current user
             enterprise_customer (enterprise.models.EnterpriseCustomer): current customer
         """
         user = kwargs.pop('user', None)
         self._user = user
         self._enterprise_customer = kwargs.pop('enterprise_customer', None)
-        super(ManageLearnersForm, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
 
     def clean_email_or_username(self):
         """
         Clean email form field
 
         Returns:
             str: the cleaned value, converted to an email address (or an empty string)
@@ -163,25 +167,27 @@
 
         email = email_or_username__to__email(email_or_username)
         bulk_entry = len(split_usernames_and_emails(email)) > 1
         if bulk_entry:
             for email in split_usernames_and_emails(email):
                 validate_email_to_link(
                     email,
+                    self._enterprise_customer,
                     None,
                     ValidationMessages.INVALID_EMAIL_OR_USERNAME,
-                    ignore_existing=True
+                    raise_exception=False,
                 )
             email = email_or_username
         else:
             validate_email_to_link(
                 email,
+                self._enterprise_customer,
                 email_or_username,
                 ValidationMessages.INVALID_EMAIL_OR_USERNAME,
-                ignore_existing=True
+                raise_exception=False,
             )
 
         return email
 
     def clean_discount(self):
         """
         Verify that discount value should be from 0 to 100.
@@ -194,19 +200,16 @@
     def clean_course(self):
         """
         Verify course ID and retrieve course details.
         """
         course_id = self.cleaned_data[self.Fields.COURSE].strip()
         if not course_id:
             return None
-
-        client = EnrollmentApiClient()
-        course_details = client.get_course_details(course_id)
-        if not course_details:
-            raise ValidationError(ValidationMessages.INVALID_COURSE_ID.format(course_id=course_id))
+        enterprise_customer = utils.get_enterprise_customer(self._enterprise_customer.uuid)
+        course_details = utils.validate_course_exists_for_enterprise(enterprise_customer, course_id)
         return course_details
 
     def clean_reason(self):
         """
         Clean the reason for enrollment field
         """
         return self.cleaned_data.get(self.Fields.REASON).strip()
@@ -220,15 +223,15 @@
     def clean(self):
         """
         Clean fields that depend on each other.
 
         In this case, the form can be used to link single user or bulk link multiple users. These are mutually
         exclusive modes, so this method checks that only one field is passed.
         """
-        cleaned_data = super(ManageLearnersForm, self).clean()
+        cleaned_data = super().clean()
 
         # Here we take values from `data` (and not `cleaned_data`) as we need raw values - field clean methods
         # might "invalidate" the value and set it to None, while all we care here is if it was provided at all or not
         email_or_username = self.data.get(self.Fields.EMAIL_OR_USERNAME, None)
         bulk_upload_csv = self.files.get(self.Fields.BULK_UPLOAD, None)
 
         if not email_or_username and not bulk_upload_csv:
@@ -241,22 +244,41 @@
             mode = self.Modes.MODE_SINGULAR
         else:
             mode = self.Modes.MODE_BULK
 
         cleaned_data[self.Fields.MODE] = mode
         cleaned_data[self.Fields.NOTIFY] = self.clean_notify()
 
+        self._validate_bulk_upload()
         self._validate_course()
         self._validate_reason()
 
         return cleaned_data
 
+    def _validate_bulk_upload(self):
+        """
+        Verify that when a csv file contains a "course_id" column, there is not a singular course ID
+        specified. Also verify that a course mode is specified, which is applied to all enrollments.
+        """
+        bulk_upload_csv = self.cleaned_data.get(self.Fields.BULK_UPLOAD)
+        if bulk_upload_csv:
+            bulk_csv_contents = bulk_upload_csv.read()
+            csv_column_names = bulk_csv_contents.decode('utf-8').split('\n', 1)[0].split(',')
+            if self.CsvColumns.COURSE_ID in csv_column_names:
+                # course id column exists in csv, so validate conditionally required fields
+                if self.cleaned_data.get(self.Fields.COURSE):
+                    raise ValidationError(ValidationMessages.BOTH_COURSE_FIELDS_SPECIFIED)
+                if not self.cleaned_data.get(self.Fields.COURSE_MODE):
+                    raise ValidationError(ValidationMessages.COURSE_WITHOUT_COURSE_MODE)
+                if not self.cleaned_data.get(self.Fields.REASON):
+                    raise ValidationError(ValidationMessages.MISSING_REASON)
+
     def _validate_course(self):
         """
-        Verify that the selected mode is valid for the given course .
+        Verify that the selected mode is valid for the given course.
         """
         # Verify that the selected mode is valid for the given course .
         course_details = self.cleaned_data.get(self.Fields.COURSE)
         if course_details:
             course_mode = self.cleaned_data.get(self.Fields.COURSE_MODE)
             if not course_mode:
                 raise ValidationError(ValidationMessages.COURSE_WITHOUT_COURSE_MODE)
@@ -306,29 +328,25 @@
         """
         Initializes form with current enterprise customer.
 
         Arguments:
             enterprise_customer (enterprise.models.EnterpriseCustomer): current customer
         """
         self._enterprise_customer = kwargs.pop('enterprise_customer', None)
-        super(ManageLearnersDataSharingConsentForm, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
 
     def clean_course(self):
         """
         Verify course ID has an associated course in LMS.
         """
         course_id = self.cleaned_data[self.Fields.COURSE].strip()
-        client = EnrollmentApiClient()
-        # Checks whether a course exist in lms with the given course id.
-        if not client.get_course_details(course_id):
-            raise ValidationError(ValidationMessages.INVALID_COURSE_ID.format(course_id=course_id))
-
-        # Checks whether a course exists in customer catalog.
-        if not self.is_course_in_catalog(course_id):
-            raise ValidationError(ValidationMessages.COURSE_NOT_EXIST_IN_CATALOG)
+        if not course_id:
+            return None
+        enterprise_customer = utils.get_enterprise_customer(self._enterprise_customer.uuid)
+        utils.validate_course_exists_for_enterprise(enterprise_customer, course_id)
         return course_id
 
     def clean_email_or_username(self):
         """
         Verify email_or_username has associated user in our database.
         """
         email_or_username = self.cleaned_data[self.Fields.EMAIL_OR_USERNAME].strip()
@@ -362,35 +380,45 @@
     Alternate form for the EnterpriseCustomer admin page.
     """
     class Meta:
         model = EnterpriseCustomer
         fields = (
             "name",
             "slug",
+            "auth_org_id",
             "country",
             "active",
             "customer_type",
             "site",
             "enable_data_sharing_consent",
             "enforce_data_sharing_consent",
             "enable_audit_enrollment",
             "enable_audit_data_reporting",
             "replace_sensitive_sso_username",
             "hide_course_original_price",
             "enable_portal_code_management_screen",
             "enable_portal_subscription_management_screen",
             "enable_learner_portal",
+            "enable_learner_portal_offers",
+            "enable_portal_learner_credit_management_screen",
+            "enable_executive_education_2U_fulfillment",
+            "hide_labor_market_data",
             "enable_integrated_customer_learner_portal_search",
             "enable_analytics_screen",
             "enable_portal_reporting_config_screen",
             "enable_portal_saml_configuration_screen",
+            "enable_portal_lms_configurations_screen",
+            "enable_universal_link",
+            "enable_browse_and_request",
             "enable_slug_login",
             "contact_email",
             "default_contract_discount",
             "default_language",
+            "sender_alias",
+            "reply_to",
         )
 
 
 class EnterpriseCustomerCatalogAdminForm(forms.ModelForm):
     """
         form for EnterpriseCustomerCatalogAdmin class.
     """
@@ -398,15 +426,15 @@
         model = EnterpriseCustomerCatalog
         fields = "__all__"
 
     preview_button = forms.Field(required=False, label='Actions', widget=SubmitInput(attrs={'value': _('Preview')}),
                                  help_text=_("Hold Ctrl when clicking on button to open Preview in new tab"))
 
     @staticmethod
-    def get_catalog_preview_uuid(post_data):  # pylint: disable=invalid-name
+    def get_catalog_preview_uuid(post_data):
         """
         Return the uuid of the catalog the preview button was clicked on
         There must be only one preview button in the POST data.
 
         e.g: 'enterprise_customer_catalogs-0-preview_button'
         """
         preview_button_expression = re.compile(r'enterprise_customer_catalogs-\d+-preview_button')
@@ -435,15 +463,15 @@
 
     def __init__(self, *args, **kwargs):
         """
         Initialize the form.
 
         Substitutes CharField with TypedChoiceField for the provider_id field.
         """
-        super(EnterpriseCustomerIdentityProviderAdminForm, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
         idp_choices = utils.get_idp_choices()
         help_text = ''
         if saml_provider_configuration:
             provider_id = self.instance.provider_id
             url = reverse('admin:{}_{}_add'.format(
                 saml_provider_configuration._meta.app_label,
                 saml_provider_configuration._meta.model_name))
@@ -468,15 +496,15 @@
 
     def clean(self):
         """
         Final validations of model fields.
 
         1. Validate that selected site for enterprise customer matches with the selected identity provider's site.
         """
-        super(EnterpriseCustomerIdentityProviderAdminForm, self).clean()
+        super().clean()
 
         provider_id = self.cleaned_data.get('provider_id', None)
         enterprise_customer = self.cleaned_data.get('enterprise_customer', None)
 
         if provider_id is None or enterprise_customer is None:
             # field validation for either provider_id or enterprise_customer has already raised
             # a validation error.
@@ -505,14 +533,27 @@
                     "provider to '{enterprise_customer_site}'."
                 ).format(
                     enterprise_customer_site=enterprise_customer.site,
                     identity_provider_site=identity_provider.site,
                 ),
             )
 
+        # There should be always one default provider in case an enterprise has multiple providers.
+        identity_provider_total_forms = int(self.data.get('enterprise_customer_identity_providers-TOTAL_FORMS'))
+        default_provider_values = []
+        for form_num in range(identity_provider_total_forms):
+            default_provider_values.append(
+                self.data.get('enterprise_customer_identity_providers-{}-default_provider'.format(form_num))
+            )
+        providers_marked_default = default_provider_values.count('on')
+        if providers_marked_default > 1:
+            raise ValidationError('Please select only one default provider.')
+        if identity_provider_total_forms > 1 and providers_marked_default == 0:
+            raise ValidationError('Please select one default provider.')
+
 
 class EnterpriseCustomerReportingConfigAdminForm(forms.ModelForm):
     """
     Alternate form for the EnterpriseCustomerReportingConfiguration admin page.
 
     This form uses the PasswordInput widget to obscure passwords as they are
     being entered by the user.
@@ -526,14 +567,15 @@
         model = EnterpriseCustomerReportingConfiguration
         fields = (
             "enterprise_customer",
             "active",
             "data_type",
             "report_type",
             "delivery_method",
+            "enable_compression",
             "pgp_encryption_key",
             "frequency",
             "day_of_month",
             "day_of_week",
             "hour_of_day",
             "include_date",
             "email",
@@ -550,16 +592,28 @@
             'decrypted_sftp_password': forms.widgets.PasswordInput(),
         }
 
     def clean(self):
         """
         Override of clean method to perform additional validation
         """
-        cleaned_data = super(EnterpriseCustomerReportingConfigAdminForm, self).clean()
+        cleaned_data = super().clean()
         report_customer = cleaned_data.get('enterprise_customer')
+        data_type = cleaned_data.get('data_type')
+
+        if data_type in EnterpriseCustomerReportingConfiguration.MANUAL_REPORTS \
+                and report_customer.uuid not in map(UUID, settings.ENTERPRISE_MANUAL_REPORTING_CUSTOMER_UUIDS):
+            message = _(
+                '"{data_type}" data type is not supported for enterprise '
+                'customer "{enterprise_customer.name}". Please select a different data type.',
+            ).format(
+                enterprise_customer=report_customer,
+                data_type=data_type,
+            )
+            self.add_error('data_type', message)
 
         # Check that any selected catalogs are tied to the selected enterprise.
         invalid_catalogs = [
             '{} ({})'.format(catalog.title, catalog.uuid)
             for catalog in cleaned_data.get('enterprise_customer_catalogs')
             if catalog.enterprise_customer != report_customer
         ]
@@ -570,14 +624,24 @@
                 'customer {enterprise_customer}: {invalid_catalogs}',
             ).format(
                 enterprise_customer=report_customer,
                 invalid_catalogs=invalid_catalogs,
             )
             self.add_error('enterprise_customer_catalogs', message)
 
+        # Check delivery_method validity while updating report
+        create_report = self.instance.pk is not None
+        if create_report:
+            error = (self.instance.validate_delivery_method(
+                self.instance.uuid,
+                cleaned_data.get('delivery_method')
+            ))
+            if error:
+                self.add_error('delivery_method', error.get('delivery_method'))
+
 
 class TransmitEnterpriseCoursesForm(forms.Form):
     """
     Form to transmit courses metadata for enterprise customers.
     """
     channel_worker_username = forms.CharField(
         label=_('Enter enterprise channel worker username.'),
@@ -591,35 +655,135 @@
         Returns:
             str: the cleaned value of channel user username for transmitting courses metadata.
         """
         channel_worker_username = self.cleaned_data['channel_worker_username'].strip()
 
         try:
             User.objects.get(username=channel_worker_username)
-        except User.DoesNotExist:
+        except User.DoesNotExist as error:
             raise ValidationError(
                 ValidationMessages.INVALID_CHANNEL_WORKER.format(
                     channel_worker_username=channel_worker_username
                 )
-            )
+            ) from error
 
         return channel_worker_username
 
 
 class SystemWideEnterpriseUserRoleAssignmentForm(UserRoleAssignmentAdminForm):
     """
     Form for SystemWideEnterpriseUserRoleAssignments.
     """
 
     class Meta:
         model = SystemWideEnterpriseUserRoleAssignment
-        fields = ['user', 'role']
+        fields = [
+            'user',
+            'role',
+            'enterprise_customer',
+            'applies_to_all_contexts',
+        ]
+
+    def __init__(self, *args, **kwargs):
+        """
+        Modifies the enterprise_customer queryset to only include
+        EnterpriseCustomer instances to which the user for this instance
+        of a SystemWideEnterpriseUserRoleAssignment is linked.
+        """
+        super().__init__(*args, **kwargs)
+        try:
+            self.fields['enterprise_customer'].queryset = EnterpriseCustomer.objects.filter(
+                enterprise_customer_users__user_id=self.instance.user.id,
+            )
+        except SystemWideEnterpriseUserRoleAssignment.user.RelatedObjectDoesNotExist:
+            self.fields['enterprise_customer'].queryset = EnterpriseCustomer.objects.none()
+
+    def clean(self):
+        """
+        Ensure that the form's enterprise customer value defaults to the first active, linked enterprise customer
+        by the provided user
+        """
+        cleaned_data = super().clean()
+        user = cleaned_data.get('user')
+        enterprise_customer = cleaned_data.get('enterprise_customer')
+        applies_to_all_contexts = cleaned_data.get('applies_to_all_contexts', False)
+        if not enterprise_customer and not applies_to_all_contexts:
+            default_ent_customer = EnterpriseCustomer.objects.filter(
+                enterprise_customer_users__user_id=user.id, active=True
+            ).first()
+
+            if not default_ent_customer:
+                message = _(
+                    'User specified is not linked to an active Enterprise Customer. '
+                    'Select `Applies to all contexts` or choose a different user.',
+                )
+                logger.exception(message)
+                raise ValidationError(message)
+            cleaned_data['enterprise_customer'] = default_ent_customer
+        return cleaned_data
 
 
 class EnterpriseFeatureUserRoleAssignmentForm(UserRoleAssignmentAdminForm):
     """
     Form for EnterpriseFeatureUserRoleAssignments.
     """
 
     class Meta:
         model = EnterpriseFeatureUserRoleAssignment
         fields = ['user', 'role']
+
+
+class AdminNotificationForm(forms.ModelForm):
+    """
+    Alternate form for AdminNotification.
+    """
+
+    class Meta:
+        model = AdminNotification
+        fields = '__all__'
+        widgets = {
+            'text': forms.Textarea(attrs={'cols': 80, 'rows': 5}),
+        }
+
+    def clean(self):
+        """
+        1. `start_date` and `expiration_date` are mandatory.
+        2. `start_date` must always come before the `expiration_date`.
+        3.  There must be only one admin notification in a date range.
+        """
+        cleaned_data = super().clean()
+
+        start_date = cleaned_data.get('start_date', None)
+        expiration_date = cleaned_data.get('expiration_date', None)
+
+        if start_date is None or expiration_date is None:
+            # Start and expiration dates are mandatory.
+            raise ValidationError('Start and expiration dates are mandatory.')
+
+        if expiration_date < start_date:
+            # `start_date` must always come before the `expiration_date`
+            raise ValidationError({'expiration_date': ['Expiration date should be after start date.']})
+        # pylint: disable=unsupported-binary-operation
+        admin_notification = AdminNotification.objects.filter(
+            Q(start_date__range=(start_date, expiration_date)) |
+            Q(expiration_date__range=(start_date, expiration_date)) |
+            Q(start_date__lt=start_date, expiration_date__gt=expiration_date)
+        ).exclude(
+            pk=self.instance.id
+        ).exists()
+
+        if admin_notification:
+            # This should not happen, as there can be only one admin notification instance in a particular date range.
+            message = _(
+                'Please select different date range. There is another notification scheduled in this date range.',
+            )
+            logger.exception(message)
+
+            raise ValidationError(message)
+        return cleaned_data
+
+
+@admin.register(BulkCatalogQueryUpdateCommandConfiguration)
+class BulkCatalogQueryUpdateCommandConfigurationAdmin(ConfigurationModelAdmin):
+    """
+    Admin form for the BulkCatalogQueryUpdateCommandConfiguration model
+    """
```

### Comparing `edx-enterprise-3.9.9/enterprise/forms.py` & `edx-enterprise-4.0.0/enterprise/forms.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,90 +1,120 @@
-# -*- coding: utf-8 -*-
 """
 User-facing forms for the Enterprise app.
 """
 
+import logging
+
 from django import forms
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
 from enterprise.models import EnterpriseCustomer, EnterpriseCustomerUser
-from enterprise.utils import get_enterprise_customer_idp
+
+LOGGER = logging.getLogger(__name__)
 
 ENTERPRISE_SELECT_SUBTITLE = _(
-    u'You have access to multiple organizations. Select the organization that you will use '
+    'You have access to multiple organizations. Select the organization that you will use '
     'to sign up for courses. If you want to change organizations, sign out and sign back in.'
 )
-ENTERPRISE_LOGIN_TITLE = _(u'Enter the organization name')
+ENTERPRISE_LOGIN_TITLE = _('Enter the organization name')
 ENTERPRISE_LOGIN_SUBTITLE = _(
-    u'Have an account through your company, school, or organization? Enter your organization’s name below to sign in.'
+    'Have an account through your company, school, or organization? Enter your organization’s name below to sign in.'
 )
 ERROR_MESSAGE_FOR_SLUG_LOGIN = _(
     "The attempt to login with this organization name was not successful. Please try again, or contact our support."
 )
 
 
 class EnterpriseSelectionForm(forms.Form):
     """
     Enterprise Selection Form.
     """
 
-    enterprise = forms.ChoiceField(choices=(), label='Organization')
+    enterprise = forms.ChoiceField(
+        choices=(),
+        label='Organization',
+        widget=forms.Select(
+            attrs={'class': 'form-control', 'type': 'select'}
+        ))
     success_url = forms.CharField(widget=forms.HiddenInput(), required=False)
 
     def __init__(self, *args, **kwargs):
         """
         Initialize form.
         """
-        super(EnterpriseSelectionForm, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
         initial = kwargs['initial']
         self._user_id = kwargs['initial'].pop('user_id')
         self.fields['enterprise'].choices = initial['enterprises']
         self.fields['success_url'].initial = initial['success_url']
 
     def clean(self):
         """
         Validate POST data.
         """
-        cleaned_data = super(EnterpriseSelectionForm, self).clean()
+        cleaned_data = super().clean()
         enterprise = cleaned_data.get('enterprise')
 
         try:
-            EnterpriseCustomer.objects.get(uuid=enterprise)  # pylint: disable=no-member
-        except EnterpriseCustomer.DoesNotExist:
-            raise forms.ValidationError(_("Enterprise not found"))
+            EnterpriseCustomer.objects.get(uuid=enterprise)
+        except EnterpriseCustomer.DoesNotExist as no_customer_error:
+            raise forms.ValidationError(_("Enterprise not found")) from no_customer_error
 
         # verify that learner is really a member of selected enterprise
         if not EnterpriseCustomerUser.objects.filter(enterprise_customer=enterprise, user_id=self._user_id).exists():
             raise forms.ValidationError(_("Wrong Enterprise"))
 
         return cleaned_data
 
 
 class EnterpriseLoginForm(forms.Form):
     """
     Enterprise Slug Login Form.
     """
 
-    enterprise_slug = forms.CharField(label='Company Name')
+    enterprise_slug = forms.CharField(
+        label='Organization name',
+        widget=forms.TextInput(
+            attrs={'class': 'form-control'}
+        )
+    )
 
     def clean(self):
         """
         Validate POST data.
         """
-        cleaned_data = super(EnterpriseLoginForm, self).clean()
+        cleaned_data = super().clean()
         enterprise_slug = cleaned_data['enterprise_slug']
 
         # verify that given slug has any associated enterprise customer.
         try:
             enterprise_customer = EnterpriseCustomer.objects.get(slug=enterprise_slug)
-        except EnterpriseCustomer.DoesNotExist:
-            raise forms.ValidationError(ERROR_MESSAGE_FOR_SLUG_LOGIN)
+        except EnterpriseCustomer.DoesNotExist as no_customer_error:
+            LOGGER.error("[Enterprise Slug Login] Not found enterprise: {}".format(enterprise_slug))
+            raise forms.ValidationError(ERROR_MESSAGE_FOR_SLUG_LOGIN) from no_customer_error
 
         # verify that enterprise customer has enabled the slug login feature.
         if not enterprise_customer.enable_slug_login:
+            LOGGER.error("[Enterprise Slug Login] slug login not enabled for enterprise: {}".format(enterprise_slug))
+            raise forms.ValidationError(ERROR_MESSAGE_FOR_SLUG_LOGIN)
+
+        # verify that there is IDP attached to the enterprise customer.
+        if enterprise_customer.has_single_idp:
+            enterprise_customer_idp = enterprise_customer.identity_providers.first()
+        elif enterprise_customer.has_multiple_idps:
+            enterprise_customer_idp = enterprise_customer.default_provider_idp
+            if not enterprise_customer_idp:
+                LOGGER.error(
+                    "[Enterprise Slug Login] No default IDP found for enterprise: {}".format(enterprise_slug))
+                raise forms.ValidationError(ERROR_MESSAGE_FOR_SLUG_LOGIN)
+        else:
+            LOGGER.error("[Enterprise Slug Login] No IDP linked for enterprise: {}".format(enterprise_slug))
             raise forms.ValidationError(ERROR_MESSAGE_FOR_SLUG_LOGIN)
 
         # verify that a valid idp is linked to the enterprise customer.
-        enterprise_customer_idp = get_enterprise_customer_idp(enterprise_slug)
-        if enterprise_customer_idp is None or enterprise_customer_idp.identity_provider is None:
+        if enterprise_customer_idp.identity_provider is None:
+            LOGGER.error("[Enterprise Slug Login] enterprise_customer linked to idp is not in the Registry class for "
+                         "enterprise: {}".format(enterprise_slug))
             raise forms.ValidationError(ERROR_MESSAGE_FOR_SLUG_LOGIN)
+
+        cleaned_data['provider_id'] = enterprise_customer_idp.provider_id
         return cleaned_data
```

### Comparing `edx-enterprise-3.9.9/enterprise/api_client/enterprise.py` & `edx-enterprise-4.0.0/enterprise/api_client/enterprise.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,34 +1,34 @@
-# -*- coding: utf-8 -*-
 """
 Client for communicating with the Enterprise API.
 """
 
 from collections import OrderedDict
 from logging import getLogger
+from urllib.parse import urljoin
 
 from django.conf import settings
 from django.core.cache import cache
 
 from enterprise import utils
-from enterprise.api_client.lms import JwtLmsApiClient
+from enterprise.api_client.client import UserAPIClient
 
 LOGGER = getLogger(__name__)
 
 
-class EnterpriseApiClient(JwtLmsApiClient):
+class EnterpriseApiClient(UserAPIClient):
     """
-    Object builds an API client to make calls to the Enterprise API.
+    The API client to make calls to the Enterprise API.
     """
 
-    API_BASE_URL = settings.LMS_INTERNAL_ROOT_URL + '/enterprise/api/v1/'
+    API_BASE_URL = urljoin(f"{settings.LMS_INTERNAL_ROOT_URL}/", "enterprise/api/v1/")
     APPEND_SLASH = True
 
-    ENTERPRISE_CUSTOMER_ENDPOINT = 'enterprise-customer'  # pylint: disable=invalid-name
-    ENTERPRISE_CUSTOMER_CATALOGS_ENDPOINT = 'enterprise_catalogs'  # pylint: disable=invalid-name
+    ENTERPRISE_CUSTOMER_ENDPOINT = 'enterprise-customer'
+    ENTERPRISE_CUSTOMER_CATALOGS_ENDPOINT = 'enterprise_catalogs'
 
     DEFAULT_VALUE_SAFEGUARD = object()
 
     def get_content_metadata(self, enterprise_customer, enterprise_catalogs=None):
         """
         Return all content metadata contained in the catalogs associated with the EnterpriseCustomer.
 
@@ -51,15 +51,15 @@
 
             for item in response['results']:
                 content_id = utils.get_content_metadata_item_id(item)
                 content_metadata[content_id] = item
 
         return list(content_metadata.values())
 
-    @JwtLmsApiClient.refresh_token
+    @UserAPIClient.refresh_token
     def _load_data(
             self,
             resource,
             detail_resource=None,
             resource_id=None,
             querystring=None,
             traverse_pagination=False,
@@ -84,19 +84,20 @@
             querystring=querystring,
             traverse_pagination=traverse_pagination,
             resource_id=resource_id
         )
         response = cache.get(cache_key)
         if not response:
             # Response is not cached, so make a call.
-            endpoint = getattr(self.client, resource)(resource_id)
-            endpoint = getattr(endpoint, detail_resource) if detail_resource else endpoint
-            response = endpoint.get(**querystring)
+            api_url = self.get_api_url(f"{resource}/{resource_id}/{detail_resource if detail_resource else ''}")
+            response = self.client.get(api_url, params=querystring)
+            response.raise_for_status()
+            response = response.json()
             if traverse_pagination:
-                results = utils.traverse_pagination(response, endpoint)
+                results = utils.traverse_pagination(response, self.client, api_url)
                 response = {
                     'count': len(results),
                     'next': 'None',
                     'previous': 'None',
                     'results': results,
                 }
             if response:
```

### Comparing `edx-enterprise-3.9.9/enterprise/api_client/enterprise_catalog.py` & `edx-enterprise-4.0.0/enterprise/api/v1/views/enterprise_customer_catalog.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,248 +1,219 @@
-# -*- coding: utf-8 -*-
 """
-Client for communicating with the Enterprise API.
+Write views for the ``enterprise-customer-catalog`` API endpoint.
 """
+from urllib.parse import quote_plus, unquote
 
-import json
-from collections import OrderedDict
-from logging import getLogger
-
-from edx_rest_api_client.client import EdxRestApiClient
-from requests.exceptions import ConnectionError, Timeout  # pylint: disable=redefined-builtin
-from slumber.exceptions import HttpNotFoundError, SlumberBaseException
+from edx_rbac.decorators import permission_required
+from rest_framework import permissions, status
+from rest_framework.decorators import action
+from rest_framework.renderers import JSONRenderer
+from rest_framework.response import Response
+from rest_framework_xml.renderers import XMLRenderer
 
 from django.conf import settings
+from django.http import Http404
+from django.utils.decorators import method_decorator
+from django.utils.translation import gettext as _
+
+from enterprise import models
+from enterprise.api.utils import get_enterprise_customer_from_catalog_id
+from enterprise.api.v1 import serializers
+from enterprise.api.v1.decorators import require_at_least_one_query_parameter
+from enterprise.api.v1.views.base_views import EnterpriseReadOnlyModelViewSet, EnterpriseWriteOnlyModelViewSet
+from enterprise.constants import COURSE_KEY_URL_PATTERN
+from enterprise.logging import getEnterpriseLogger
 
-from enterprise import utils
-from enterprise.api_client.lms import JwtLmsApiClient
+LOGGER = getEnterpriseLogger(__name__)
 
-LOGGER = getLogger(__name__)
 
-
-class EnterpriseCatalogApiClient(JwtLmsApiClient):
+class EnterpriseCustomerCatalogWriteViewSet(EnterpriseWriteOnlyModelViewSet):
     """
-    Object builds an API client to make calls to the Enterprise Catalog API.
+    API write only views for the ``enterprise-customer-catalog`` API endpoint.
     """
-
-    API_BASE_URL = settings.ENTERPRISE_CATALOG_INTERNAL_ROOT_URL + '/api/v1/'
-    ENTERPRISE_CATALOG_ENDPOINT = 'enterprise-catalogs'
-    GET_CONTENT_METADATA_ENDPOINT = ENTERPRISE_CATALOG_ENDPOINT + '/{}/get_content_metadata'
-    REFRESH_CATALOG_ENDPOINT = ENTERPRISE_CATALOG_ENDPOINT + '/{}/refresh_metadata'
-    ENTERPRISE_CUSTOMER_ENDPOINT = 'enterprise-customer'
-    APPEND_SLASH = True
-
-    def __init__(self, user=None):
-        user = user if user else utils.get_enterprise_worker_user()
-        super(EnterpriseCatalogApiClient, self).__init__(user)
-
-    @JwtLmsApiClient.refresh_token
-    def create_enterprise_catalog(
-            self,
-            catalog_uuid,
-            enterprise_id,
-            enterprise_name,
-            title,
-            content_filter,
-            enabled_course_modes,
-            publish_audit_enrollment_urls):
-        """Creates an enterprise catalog."""
-        endpoint = getattr(self.client, self.ENTERPRISE_CATALOG_ENDPOINT)
-        post_data = {
-            'uuid': catalog_uuid,
-            'title': title,
-            'enterprise_customer': enterprise_id,
-            'enterprise_customer_name': enterprise_name,
-            'content_filter': content_filter,
-            'enabled_course_modes': enabled_course_modes,
-            'publish_audit_enrollment_urls': json.dumps(publish_audit_enrollment_urls),
-        }
-        try:
-            LOGGER.info(
-                'Creating Enterprise Catalog %s in the Enterprise Catalog Service with params: %s',
-                catalog_uuid,
-                json.dumps(post_data)
-            )
-            return endpoint.post(post_data)
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
-            LOGGER.exception(
-                'Failed to create EnterpriseCustomer Catalog [%s] in enterprise-catalog due to: [%s]',
-                catalog_uuid, str(exc)
-            )
-            return {}
-
-    @JwtLmsApiClient.refresh_token
-    def get_enterprise_catalog(self, catalog_uuid, should_raise_exception=True):
-        """
-        Gets an enterprise catalog.
-
-        Arguments:
-            catalog_uuid (uuid): The uuid of an EnterpriseCatalog instance
-            should_raise_exception (bool): Whether an exception should be logged if
-                a catalog does not yet exist in enterprise-catalog. Defaults to True.
-
-        Returns:
-            dict: a dictionary representing an enterprise catalog
-        """
-        endpoint = getattr(self.client, self.ENTERPRISE_CATALOG_ENDPOINT)(catalog_uuid)
-        try:
-            return endpoint.get()
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
-            if should_raise_exception:
-                LOGGER.exception(
-                    'Failed to get EnterpriseCustomer Catalog [%s] in enterprise-catalog due to: [%s]',
-                    catalog_uuid, str(exc)
-                )
-            return {}
-
-    @staticmethod
-    def get_content_metadata_url(uuid):
-        """
-        Get the url for the preview information for an enterprise catalog
-        """
-        return EnterpriseCatalogApiClient.API_BASE_URL + \
-            EnterpriseCatalogApiClient.GET_CONTENT_METADATA_ENDPOINT.format(uuid)
-
-    @JwtLmsApiClient.refresh_token
-    def update_enterprise_catalog(self, catalog_uuid, **kwargs):
-        """Updates an enterprise catalog."""
-        endpoint = getattr(self.client, self.ENTERPRISE_CATALOG_ENDPOINT)(catalog_uuid)
-        try:
-            LOGGER.info(
-                'Updating Enterprise Catalog %s in the Enterprise Catalog Service with params: %s',
-                catalog_uuid,
-                json.dumps(kwargs)
-            )
-            return endpoint.put(kwargs)
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
-            LOGGER.exception(
-                'Failed to update EnterpriseCustomer Catalog [%s] in enterprise-catalog due to: [%s]',
-                catalog_uuid, str(exc)
-            )
-            return {}
-
-    @JwtLmsApiClient.refresh_token
-    def delete_enterprise_catalog(self, catalog_uuid):
-        """Deletes an enterprise catalog."""
-        endpoint = getattr(self.client, self.ENTERPRISE_CATALOG_ENDPOINT)(catalog_uuid)
-        try:
-            return endpoint.delete()
-        except HttpNotFoundError:
-            LOGGER.warning(
-                'Deleted EnterpriseCustomerCatalog [%s] that was not in enterprise-catalog',
-                catalog_uuid
-            )
-            return {}
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
-            LOGGER.exception(
-                'Failed to delete EnterpriseCustomer Catalog [%s] in enterprise-catalog due to: [%s]',
-                catalog_uuid, str(exc)
-            )
-            return {}
-
-    @JwtLmsApiClient.refresh_token
-    def get_content_metadata(self, enterprise_customer, enterprise_catalogs=None):
-        """
-        Return all content metadata contained in the catalogs associated with the EnterpriseCustomer.
-
-        Arguments:
-            enterprise_customer (EnterpriseCustomer): The EnterpriseCustomer to return content metadata for.
-            enterprise_catalogs (EnterpriseCustomerCatalog): Optional list of EnterpriseCustomerCatalog objects.
-
-        Returns:
-            list: List of dicts containing content metadata.
-        """
-        content_metadata = OrderedDict()
-        enterprise_customer_catalogs = enterprise_catalogs or enterprise_customer.enterprise_customer_catalogs.all()
-
-        for enterprise_customer_catalog in enterprise_customer_catalogs:
-            catalog_uuid = enterprise_customer_catalog.uuid
-            endpoint = getattr(self.client, self.GET_CONTENT_METADATA_ENDPOINT.format(catalog_uuid))
-            try:
-                response = endpoint.get()
-                for item in utils.traverse_pagination(response, endpoint):
-                    content_id = utils.get_content_metadata_item_id(item)
-                    content_metadata[content_id] = item
-            except (SlumberBaseException, ConnectionError, Timeout) as exc:
-                LOGGER.exception(
-                    'Failed to get content metadata for Catalog [%s] in enterprise-catalog due to: [%s]',
-                    catalog_uuid, str(exc)
-                )
-
-        return list(content_metadata.values())
-
-    @JwtLmsApiClient.refresh_token
-    def refresh_catalogs(self, enterprise_catalogs):
-        """
-        Kicks off async tasks to refresh catalogs so recent changes will populate to production without needing to wait
-        for the daily jobs to run
-
-        Arguments:
-            enterprise_catalogs (EnterpriseCustomerCatalog): List of EnterpriseCustomerCatalog objects to refresh
-
-        Returns:
-            Dict: Dict of async task ids for each catalog id
-        """
-        refreshed_catalogs = {}
-        failed_to_refresh_catalogs = []
-        for enterprise_customer_catalog in enterprise_catalogs:
-            catalog_uuid = enterprise_customer_catalog.uuid
-            endpoint = getattr(self.client, self.REFRESH_CATALOG_ENDPOINT.format(catalog_uuid))
-            try:
-                response = endpoint.post()
-                refreshed_catalogs[catalog_uuid] = response['async_task_id']
-            except (SlumberBaseException, ConnectionError, Timeout) as exc:
-                LOGGER.exception(
-                    'Failed to refresh catalog data for catalog [%s] in enterprise-catalog due to: [%s]',
-                    catalog_uuid, str(exc)
-                )
-                failed_to_refresh_catalogs.append(catalog_uuid)
-
-        return refreshed_catalogs, failed_to_refresh_catalogs
-
-    @JwtLmsApiClient.refresh_token
-    def contains_content_items(self, catalog_uuid, content_ids):
-        """
-        Checks whether an enterprise catalog contains the given content
-
-        The enterprise catalog endpoint does not differentiate between course_run_ids and program_uuids so they can
-        be used interchangeably. The two query parameters are left in for backwards compatability with edx-enterprise.
-        """
-        query_params = {'course_run_ids': content_ids}
-        endpoint = getattr(self.client, self.ENTERPRISE_CATALOG_ENDPOINT)(catalog_uuid)
-        return endpoint.contains_content_items.get(**query_params)['contains_content_items']
-
-    @JwtLmsApiClient.refresh_token
-    def enterprise_contains_content_items(self, enterprise_uuid, content_ids):
-        """
-        Checks whether an enterprise customer has any catalogs that contain the provided content ids.
-
-        The endpoint does not differentiate between course_run_ids and program_uuids so they can be used
-        interchangeably. The two query parameters are left in for backwards compatability with edx-enterprise.
-        """
-        query_params = {'course_run_ids': content_ids}
-        endpoint = getattr(self.client, self.ENTERPRISE_CUSTOMER_ENDPOINT)(enterprise_uuid)
-        return endpoint.contains_content_items.get(**query_params)['contains_content_items']
+    queryset = models.EnterpriseCustomerCatalog.objects.all()
+    permission_classes = (permissions.IsAdminUser,)
+    serializer_class = serializers.EnterpriseCustomerCatalogWriteOnlySerializer
+
+    def create(self, request, *args, **kwargs):
+        """
+        Creates a new EnterpriseCustomerCatalog and returns the created object.
+
+        If an EnterpriseCustomerCatalog already exists for the given enterprise_customer and enterprise_catalog_query,
+        returns the existing object.
+
+        URL: /enterprise/api/v1/enterprise-customer-catalog/
+
+        Method: POST
+
+        Payload::
+
+          {
+            "title":  string - Title of the catalog,
+            "enterprise_customer": string - UUID of an existing enterprise customer,
+            "enterprise_catalog_query": string - id of an existing enterprise catalog query,
+          }
+
+        Returns 201 if a new EnterpriseCustomerCatalog was created, 200 if an existing EnterpriseCustomerCatalog was
+        """
+
+        enterprise_customer_uuid = request.data.get('enterprise_customer')
+        enterprise_catalog_query_id = request.data.get('enterprise_catalog_query')
+        enterprise_customer_catalog_list = models.EnterpriseCustomerCatalog.objects.filter(
+            enterprise_customer=enterprise_customer_uuid)
+        for catalog in enterprise_customer_catalog_list:
+            catalog_query = catalog.enterprise_catalog_query
+            if catalog_query is not None and catalog_query.id == int(enterprise_catalog_query_id):
+                serialized_customer_catalog = serializers.EnterpriseCustomerCatalogWriteOnlySerializer(
+                    catalog)
+                LOGGER.info(
+                    'EnterpriseCustomerCatalog already exists for enterprise_customer_uuid: %s '
+                    'and enterprise_catalog_query_id: %s, using existing catalog: %s',
+                    enterprise_customer_uuid, enterprise_catalog_query_id, catalog.uuid)
+                return Response(serialized_customer_catalog.data, status=status.HTTP_200_OK)
+        LOGGER.info(
+            'Creating new EnterpriseCustomerCatalog for enterprise_customer_uuid: %s '
+            'and enterprise_catalog_query_id: %s',
+            enterprise_customer_uuid, enterprise_catalog_query_id)
+        return super().create(request, *args, **kwargs)
 
 
-class NoAuthEnterpriseCatalogClient:
+class EnterpriseCustomerCatalogViewSet(EnterpriseReadOnlyModelViewSet):
     """
-    Class to build a enterprise catalog client to make calls to the discovery service.
+    API Views for performing search through course discovery at the ``enterprise_catalogs`` API endpoint.
     """
+    queryset = models.EnterpriseCustomerCatalog.objects.all()
 
-    API_BASE_URL = settings.ENTERPRISE_CATALOG_INTERNAL_ROOT_URL
-    APPEND_SLASH = False
-
-    def __init__(self):
-        """
-        Create an enterprise catalog client.
-        """
-        self.client = EdxRestApiClient(self.API_BASE_URL, append_slash=self.APPEND_SLASH)
-
-    def get_health(self):
-        """
-        Retrieve health details for enterprise catalog service.
-
-        Returns:
-            dict: Response containing enterprise catalog service health.
-        """
-        return self.client.health.get()
+    USER_ID_FILTER = 'enterprise_customer__enterprise_customer_users__user_id'
+    FIELDS = (
+        'uuid', 'enterprise_customer',
+    )
+    filterset_fields = FIELDS
+    ordering_fields = FIELDS
+    renderer_classes = (JSONRenderer, XMLRenderer,)
+
+    @permission_required('enterprise.can_view_catalog', fn=lambda request, *args, **kwargs: None)
+    def list(self, request, *args, **kwargs):
+        return super().list(request, *args, **kwargs)
+
+    @permission_required(
+        'enterprise.can_view_catalog',
+        fn=lambda request, *args, **kwargs: get_enterprise_customer_from_catalog_id(kwargs['pk']))
+    def retrieve(self, request, *args, **kwargs):
+        return super().retrieve(request, *args, **kwargs)
+
+    def get_serializer_class(self):
+        view_action = getattr(self, 'action', None)
+        if view_action == 'retrieve':
+            return serializers.EnterpriseCustomerCatalogDetailSerializer
+        return serializers.EnterpriseCustomerCatalogSerializer
+
+    @method_decorator(require_at_least_one_query_parameter('course_run_ids', 'program_uuids'))
+    @action(detail=True)
+    # pylint: disable=unused-argument
+    def contains_content_items(self, request, pk, course_run_ids, program_uuids):
+        """
+        Return whether or not the EnterpriseCustomerCatalog contains the specified content.
+
+        Multiple course_run_ids and/or program_uuids query parameters can be sent to this view to check
+        for their existence in the EnterpriseCustomerCatalog. At least one course run key
+        or program UUID value must be included in the request.
+        """
+        enterprise_customer_catalog = self.get_object()
+
+        # Maintain plus characters in course key.
+        course_run_ids = [unquote(quote_plus(course_run_id)) for course_run_id in course_run_ids]
+
+        contains_content_items = True
+        if course_run_ids:
+            contains_content_items = enterprise_customer_catalog.contains_courses(course_run_ids)
+        if program_uuids:
+            contains_content_items = (
+                contains_content_items and
+                enterprise_customer_catalog.contains_programs(program_uuids)
+            )
+
+        return Response({'contains_content_items': contains_content_items})
+
+    @action(detail=True, url_path='courses/{}'.format(COURSE_KEY_URL_PATTERN))
+    @permission_required(
+        'enterprise.can_view_catalog',
+        fn=lambda request, pk, course_key: get_enterprise_customer_from_catalog_id(pk))
+    def course_detail(self, request, pk, course_key):  # pylint: disable=unused-argument
+        """
+        Return the metadata for the specified course.
+
+        The course needs to be included in the specified EnterpriseCustomerCatalog
+        in order for metadata to be returned from this endpoint.
+        """
+        enterprise_customer_catalog = self.get_object()
+        course = enterprise_customer_catalog.get_course(course_key)
+        if not course:
+            error_message = _(
+                '[Enterprise API] CourseKey not found in the Catalog. Course: {course_key}, Catalog: {catalog_id}'
+            ).format(
+                course_key=course_key,
+                catalog_id=enterprise_customer_catalog.uuid,
+            )
+            LOGGER.warning(error_message)
+            raise Http404
+
+        context = self.get_serializer_context()
+        context['enterprise_customer_catalog'] = enterprise_customer_catalog
+        serializer = serializers.CourseDetailSerializer(course, context=context)
+        return Response(serializer.data)
+
+    @action(detail=True, url_path='course_runs/{}'.format(settings.COURSE_ID_PATTERN))
+    @permission_required(
+        'enterprise.can_view_catalog',
+        fn=lambda request, pk, course_id: get_enterprise_customer_from_catalog_id(pk))
+    def course_run_detail(self, request, pk, course_id):  # pylint: disable=unused-argument
+        """
+        Return the metadata for the specified course run.
+
+        The course run needs to be included in the specified EnterpriseCustomerCatalog
+        in order for metadata to be returned from this endpoint.
+        """
+        enterprise_customer_catalog = self.get_object()
+        course_run = enterprise_customer_catalog.get_course_run(course_id)
+        if not course_run:
+            error_message = _(
+                '[Enterprise API] CourseRun not found in the Catalog. CourseRun: {course_id}, Catalog: {catalog_id}'
+            ).format(
+                course_id=course_id,
+                catalog_id=enterprise_customer_catalog.uuid,
+            )
+            LOGGER.warning(error_message)
+            raise Http404
+
+        context = self.get_serializer_context()
+        context['enterprise_customer_catalog'] = enterprise_customer_catalog
+        serializer = serializers.CourseRunDetailSerializer(course_run, context=context)
+        return Response(serializer.data)
+
+    @action(detail=True, url_path='programs/(?P<program_uuid>[^/]+)')
+    @permission_required(
+        'enterprise.can_view_catalog',
+        fn=lambda request, pk, program_uuid: get_enterprise_customer_from_catalog_id(pk))
+    def program_detail(self, request, pk, program_uuid):  # pylint: disable=unused-argument
+        """
+        Return the metadata for the specified program.
+
+        The program needs to be included in the specified EnterpriseCustomerCatalog
+        in order for metadata to be returned from this endpoint.
+        """
+        enterprise_customer_catalog = self.get_object()
+        program = enterprise_customer_catalog.get_program(program_uuid)
+        if not program:
+            error_message = _(
+                '[Enterprise API] Program not found in the Catalog. Program: {program_uuid}, Catalog: {catalog_id}'
+            ).format(
+                program_uuid=program_uuid,
+                catalog_id=enterprise_customer_catalog.uuid,
+            )
+            LOGGER.warning(error_message)
+            raise Http404
+
+        context = self.get_serializer_context()
+        context['enterprise_customer_catalog'] = enterprise_customer_catalog
+        serializer = serializers.ProgramDetailSerializer(program, context=context)
+        return Response(serializer.data)
```

### Comparing `edx-enterprise-3.9.9/enterprise/api_client/discovery.py` & `edx-enterprise-4.0.0/enterprise/api_client/discovery.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,150 +1,130 @@
-# -*- coding: utf-8 -*-
 """
 Utilities to get details from the course catalog API.
 """
 
 from logging import getLogger
 
-from edx_rest_api_client.client import EdxRestApiClient
-from edx_rest_api_client.exceptions import SlumberBaseException
 from opaque_keys import InvalidKeyError
 from opaque_keys.edx.keys import CourseKey
-from requests.exceptions import ConnectionError, Timeout  # pylint: disable=redefined-builtin
+from requests.exceptions import ConnectionError, RequestException, Timeout  # pylint: disable=redefined-builtin
 
 from django.conf import settings
 from django.core.cache import cache
 from django.core.exceptions import ImproperlyConfigured, ObjectDoesNotExist
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from enterprise import utils
+from enterprise.api_client.client import NoAuthAPIClient, UserAPIClient
 from enterprise.utils import NotConnectedToOpenEdX, get_configuration_value_for_site
 
 try:
     import cPickle as pickle
 except ImportError:
     import pickle
 
 try:
-    from openedx.core.djangoapps.oauth_dispatch import jwt as JwtBuilder
-except ImportError:
-    JwtBuilder = None
-
-try:
     from openedx.core.djangoapps.catalog.models import CatalogIntegration
 except ImportError:
     CatalogIntegration = None
 
 try:
-    from openedx.core.lib.edx_api_utils import get_edx_api_data
+    from openedx.core.lib.edx_api_utils import get_api_data
 except ImportError:
-    get_edx_api_data = None
+    get_api_data = None
 
 
 LOGGER = getLogger(__name__)
 
 
-def course_discovery_api_client(user, catalog_url):
-    """
-    Return a Course Discovery API client setup with authentication for the specified user.
-    """
-    if JwtBuilder is None:
-        raise NotConnectedToOpenEdX(
-            _("To get a Catalog API client, this package must be "
-              "installed in an Open edX environment.")
-        )
-
-    jwt = JwtBuilder.create_jwt_for_user(user)
-    return EdxRestApiClient(catalog_url, jwt=jwt)
-
-
-class CourseCatalogApiClient:
+class CourseCatalogApiClient(UserAPIClient):
     """
-    Object builds an API client to make calls to the Catalog API.
+    The API client to make calls to the Catalog API.
     """
+    APPEND_SLASH = True
 
     SEARCH_ALL_ENDPOINT = 'search/all/'
     CATALOGS_COURSES_ENDPOINT = 'catalogs/{}/courses/'
     COURSES_ENDPOINT = 'courses'
     COURSE_RUNS_ENDPOINT = 'course_runs'
     PROGRAMS_ENDPOINT = 'programs'
     PROGRAM_TYPES_ENDPOINT = 'program_types'
 
     DEFAULT_VALUE_SAFEGUARD = object()
 
     def __init__(self, user, site=None):
         """
-        Create an Course Catalog API client setup with authentication for the specified user.
-
-        This method retrieves an authenticated API client that can be used
-        to access the course catalog API. It raises an exception to be caught at
-        a higher level if the package doesn't have OpenEdX resources available.
+        Check required services are up and running, instantiate the client.
         """
         if CatalogIntegration is None:
             raise NotConnectedToOpenEdX(
                 _("To get a CatalogIntegration object, this package must be "
                   "installed in an Open edX environment.")
             )
-        if get_edx_api_data is None:
+        if get_api_data is None:
             raise NotConnectedToOpenEdX(
                 _("To parse a Catalog API response, this package must be "
                   "installed in an Open edX environment.")
             )
 
-        self.user = user
-        self.catalog_url = get_configuration_value_for_site(
+        self.API_BASE_URL = get_configuration_value_for_site(  # pylint: disable=invalid-name
             site,
             'COURSE_CATALOG_API_URL',
             settings.COURSE_CATALOG_API_URL
         )
-        self.client = course_discovery_api_client(user, self.catalog_url)
+        super().__init__(user)
 
-    @staticmethod
-    def traverse_pagination(response, endpoint, content_filter_query, query_params):
+    def traverse_pagination(self, response, api_url, content_filter_query, query_params):
         """
         Traverse a paginated API response and extracts and concatenates "results" returned by API.
 
         Arguments:
             response (dict): API response object.
-            endpoint (Slumber.Resource): API endpoint object.
+            api_url (str): API endpoint path.
             content_filter_query (dict): query parameters used to filter catalog results.
             query_params (dict): query parameters used to paginate results.
 
         Returns:
             list: all the results returned by the API.
         """
         results = response.get('results', [])
 
         page = 1
         while response.get('next'):
             page += 1
-            response = endpoint().post(content_filter_query, **dict(query_params, page=page))
+            response = self.client.post(api_url, data=content_filter_query, params=dict(query_params, page=page))
+            response.raise_for_status()
+            response = response.json()
             results += response.get('results', [])
 
         return results
 
+    @UserAPIClient.refresh_token
     def get_catalog_results_from_discovery(self, content_filter_query, query_params=None, traverse_pagination=False):
         """
-            Return results from the discovery service's search/all endpoint."""
-
-        endpoint = getattr(self.client, self.SEARCH_ALL_ENDPOINT)
-        response = endpoint().post(data=content_filter_query, **query_params)
+        Return results from the discovery service's search/all endpoint.
+        """
+        api_url = self.get_api_url(self.SEARCH_ALL_ENDPOINT)
+        response = self.client.post(api_url, data=content_filter_query, params=query_params)
+        response.raise_for_status()
+        response = response.json()
         if traverse_pagination:
-            response['results'] = self.traverse_pagination(response, endpoint, content_filter_query, query_params)
+            response['results'] = self.traverse_pagination(response, api_url, content_filter_query, query_params)
             response['next'] = response['previous'] = None
         return response
 
     def get_catalog_results(self, content_filter_query, query_params=None, traverse_pagination=False):
         """
-            Return results from the cache or discovery service's search/all endpoint.
+        Return results from the cache or discovery service's search/all endpoint.
+
         Arguments:
             content_filter_query (dict): query parameters used to filter catalog results.
             query_params (dict): query parameters used to paginate results.
             traverse_pagination (bool): True to return all results, False to return the paginated response.
-                                        Defaults to False.
+                Defaults to False.
 
         Returns:
             dict: Paginated response or all the records.
         """
         query_params = query_params or {}
 
         try:
@@ -179,23 +159,22 @@
             else:
                 LOGGER.info(
                     'ENT-2390-2 | Got search/all/ data from the cache with '
                     'content_filter_query %s and query_params %s',
                     content_filter_query,
                     query_params,
                 )
-        except Exception as ex:  # pylint: disable=broad-except
+        except Exception as ex:
             LOGGER.exception(
                 'Attempted to call course-discovery search/all/ endpoint with the following parameters: '
                 'content_filter_query: %s, query_params: %s, traverse_pagination: %s. '
-                'Failed to retrieve data from the catalog API. content -- [%s]',
+                'Failed to retrieve data from the catalog API.',
                 content_filter_query,
                 query_params,
                 traverse_pagination,
-                getattr(ex, 'content', '')
             )
             # We need to bubble up failures when we encounter them instead of masking them!
             raise ex
 
         return response
 
     def get_course_id(self, course_identifier):
@@ -359,38 +338,39 @@
         """
         return self._load_data(
             self.PROGRAM_TYPES_ENDPOINT,
             resource_id=slug,
             default=None,
         )
 
+    @UserAPIClient.refresh_token
     def _load_data(self, resource, default=DEFAULT_VALUE_SAFEGUARD, **kwargs):
         """
         Load data from API client.
 
         Arguments:
             resource(string): type of resource to load
             default(any): value to return if API query returned empty result. Sensible values: [], {}, None etc.
 
         Returns:
             dict: Deserialized response from Course Catalog API
 
         """
         default_val = default if default != self.DEFAULT_VALUE_SAFEGUARD else {}
         try:
-            return get_edx_api_data(
+            return get_api_data(
                 api_config=CatalogIntegration.current(),
                 resource=resource,
-                api=self.client,
+                api_client=self.client,
+                base_api_url=self.API_BASE_URL,
                 **kwargs
             ) or default_val
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
+        except (RequestException, ConnectionError, Timeout):
             LOGGER.exception(
-                'Failed to load data from resource [%s] with kwargs [%s] due to: [%s]',
-                resource, kwargs, str(exc)
+                'Failed to load data from resource [%s] with kwargs [%s].', resource, kwargs
             )
             return default_val
 
 
 def get_course_catalog_api_service_client(site=None):
     """
     Returns an instance of the CourseCatalogApiServiceClient
@@ -420,46 +400,28 @@
                   "installed in an Open edX environment.")
             )
 
         catalog_integration = CatalogIntegration.current()
         if catalog_integration.enabled:
             try:
                 user = catalog_integration.get_service_user()
-                super(CourseCatalogApiServiceClient, self).__init__(user, site)
-            except ObjectDoesNotExist:
-                raise ImproperlyConfigured(_("The configured CatalogIntegration service user does not exist."))
+                super().__init__(user, site)
+            except ObjectDoesNotExist as error:
+                raise ImproperlyConfigured(
+                    _("The configured CatalogIntegration service user does not exist.")
+                ) from error
         else:
             raise ImproperlyConfigured(_("There is no active CatalogIntegration."))
 
-    @classmethod
-    def program_exists(cls, program_uuid):
+    def program_exists(self, program_uuid):
         """
         Get whether the program exists or not.
         """
-        try:
-            return bool(cls().get_program_by_uuid(program_uuid))
-        except ImproperlyConfigured:
-            return False
+        return bool(self.get_program_by_uuid(program_uuid))
 
 
-class NoAuthDiscoveryClient:
+class NoAuthDiscoveryClient(NoAuthAPIClient):
     """
     Class to build a course discovery client to make calls to the discovery service.
     """
-
     API_BASE_URL = settings.COURSE_CATALOG_URL_ROOT
     APPEND_SLASH = False
-
-    def __init__(self):
-        """
-        Create a course discovery client.
-        """
-        self.client = EdxRestApiClient(self.API_BASE_URL, append_slash=self.APPEND_SLASH)
-
-    def get_health(self):
-        """
-        Retrieve health details for course discovery service.
-
-        Returns:
-            dict: Response containing course discovery service health.
-        """
-        return self.client.health.get()
```

### Comparing `edx-enterprise-3.9.9/enterprise/api_client/ecommerce.py` & `edx-enterprise-4.0.0/enterprise/api_client/ecommerce.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,131 +1,127 @@
-# -*- coding: utf-8 -*-
 """
 Client for communicating with the E-Commerce API.
 """
 
 import logging
+from urllib.parse import urljoin
 
-from edx_rest_api_client.client import EdxRestApiClient
-from requests.exceptions import ConnectionError, Timeout  # pylint: disable=redefined-builtin
-from slumber.exceptions import SlumberBaseException
+from requests.exceptions import ConnectionError, RequestException, Timeout  # pylint: disable=redefined-builtin
 
 from django.conf import settings
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
+from enterprise.api_client.client import NoAuthAPIClient
 from enterprise.utils import NotConnectedToOpenEdX, format_price
 
 try:
-    from openedx.core.djangoapps.commerce.utils import ecommerce_api_client
+    from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
 except ImportError:
-    ecommerce_api_client = None
+    configuration_helpers = None
+
+try:
+    from openedx.core.djangoapps.commerce.utils import get_ecommerce_api_client
+except ImportError:
+    get_ecommerce_api_client = None
 
 LOGGER = logging.getLogger(__name__)
 
 
 class EcommerceApiClient:
     """
-    Object builds an API client to make calls to the E-Commerce API.
+    The API client to make calls to the E-Commerce API.
     """
-
     def __init__(self, user):
         """
-        Create an E-Commerce API client, authenticated with the API token from Django settings.
+        Create an E-Commerce API client, authenticated with the API token.
 
         This method retrieves an authenticated API client that can be used
         to access the ecommerce API. It raises an exception to be caught at
         a higher level if the package doesn't have OpenEdX resources available.
         """
-        if ecommerce_api_client is None:
+        if get_ecommerce_api_client is None or configuration_helpers is None:
             raise NotConnectedToOpenEdX(
                 _('To get a ecommerce_api_client, this package must be '
                   'installed in an Open edX environment.')
             )
 
         self.user = user
-        self.client = ecommerce_api_client(user)
+        self.client = get_ecommerce_api_client(user)
+        self.API_BASE_URL = configuration_helpers.get_value(  # pylint: disable=invalid-name
+            'ECOMMERCE_API_URL', settings.ECOMMERCE_API_URL
+        )
 
     def get_course_final_price(self, mode, currency='$', enterprise_catalog_uuid=None):
         """
         Get course mode's SKU discounted price after applying any entitlement available for this user.
 
         Returns:
             str: Discounted price of the course mode.
-
         """
+        api_url = urljoin(f"{self.API_BASE_URL}/", "baskets/calculate/")
         try:
-            price_details = self.client.baskets.calculate.get(
-                sku=[mode['sku']],
-                username=self.user.username,
-                catalog=enterprise_catalog_uuid,
+            response = self.client.get(
+                api_url,
+                params={
+                    "sku": [mode['sku']],
+                    "username": self.user.username,
+                    "catalog": enterprise_catalog_uuid,
+                }
             )
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
+            response.raise_for_status()
+            price_details = response.json()
+        except (RequestException, ConnectionError, Timeout) as exc:
             LOGGER.exception('Failed to get price details for sku %s due to: %s', mode['sku'], str(exc))
             price_details = {}
         price = price_details.get('total_incl_tax', mode['min_price'])
         if price != mode['min_price']:
             return format_price(price, currency)
         return mode['original_price']
 
     def create_manual_enrollment_orders(self, enrollments):
         """
         Calls ecommerce to create orders for the manual enrollments passed in.
 
-        `enrollments` should be a list of enrollments with the following format:
-        {
-            "lms_user_id": <int>,
-            "username": <str>,
-            "email": <str>,
-            "course_run_key": <str>
-        }
+        `enrollments` should be a list of enrollments with the following format::
+
+            {
+                "lms_user_id": <int>,
+                "username": <str>,
+                "email": <str>,
+                "course_run_key": <str>
+            }
 
-        Since `student.CourseEnrollment` lives in LMS, we're just passing around dicts of the relevant information.
+        Since `student.CourseEnrollment` lives in LMS, we're just passing
+        around dicts of the relevant information.
         """
+        api_url = urljoin(f"{self.API_BASE_URL}/", "manual_course_enrollment_order/")
         try:
-            order_response = self.client.manual_course_enrollment_order.post(
-                {
-                    "enrollments": enrollments
-                }
-            )
+            response = self.client.post(api_url, json={"enrollments": enrollments})
+            response.raise_for_status()
+            order_response = response.json()
             order_creations = order_response["orders"]
             successful_creations = [order for order in order_creations if order["status"] == "success"]
             failed_creations = [order for order in order_creations if order["status"] == "failure"]
             if successful_creations:
                 LOGGER.info(
                     "Successfully created orders for the following manual enrollments. %s",
                     successful_creations
                 )
             if failed_creations:
                 LOGGER.error(
                     "Failed to created orders for the following manual enrollments. %s",
                     failed_creations
                 )
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
+        except (RequestException, ConnectionError, Timeout) as exc:
             LOGGER.exception(
                 "Failed to create order for manual enrollments for the following enrollments: %s. Reason: %s",
                 enrollments,
                 str(exc)
             )
 
 
-class NoAuthEcommerceClient:
+class NoAuthEcommerceClient(NoAuthAPIClient):
     """
-    Class to build an E-Commerce client to make calls to the E-Commerce.
+    The E-Commerce API client without authentication.
     """
-
     API_BASE_URL = settings.ECOMMERCE_PUBLIC_URL_ROOT
     APPEND_SLASH = False
-
-    def __init__(self):
-        """
-        Create an E-Commerce client.
-        """
-        self.client = EdxRestApiClient(self.API_BASE_URL, append_slash=self.APPEND_SLASH)
-
-    def get_health(self):
-        """
-        Retrieve health details for E-Commerce service.
-
-        Returns:
-            dict: Response containing E-Commerce service health.
-        """
-        return self.client.health.get()
```

### Comparing `edx-enterprise-3.9.9/enterprise/api_client/lms.py` & `edx-enterprise-4.0.0/enterprise/api_client/lms.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,164 +1,83 @@
-# -*- coding: utf-8 -*-
 """
 Utilities to get details from the course catalog API.
 """
 
-import datetime
 import logging
-from functools import wraps
-from time import time
+import time
+from urllib.parse import urljoin
 
-from edx_rest_api_client.client import EdxRestApiClient
 from opaque_keys.edx.keys import CourseKey
-from requests.exceptions import ConnectionError, Timeout  # pylint: disable=redefined-builtin
-from slumber.exceptions import HttpNotFoundError, SlumberBaseException
+from requests.exceptions import (  # pylint: disable=redefined-builtin
+    ConnectionError,
+    HTTPError,
+    RequestException,
+    Timeout,
+)
 
 from django.conf import settings
-from django.utils import timezone
 
+from enterprise.api_client.client import BackendServiceAPIClient, NoAuthAPIClient, UserAPIClient
 from enterprise.constants import COURSE_MODE_SORT_ORDER, EXCLUDED_COURSE_MODES
-from enterprise.utils import NotConnectedToOpenEdX, get_enterprise_worker_user
 
 try:
     from openedx.core.djangoapps.embargo import api as embargo_api
 except ImportError:
     embargo_api = None
 
-try:
-    from openedx.core.djangoapps.oauth_dispatch import jwt as JwtBuilder
-except ImportError:
-    JwtBuilder = None
-
 
 LOGGER = logging.getLogger(__name__)
-LMS_API_DATETIME_FORMAT = '%Y-%m-%dT%H:%M:%SZ'
-LMS_API_DATETIME_FORMAT_WITHOUT_TIMEZONE = '%Y-%m-%dT%H:%M:%S'
-
-
-class NoAuthenticationLmsApiClient:
-    """
-    Object builds an API client to make calls to the edxapp LMS API.
-
-    Authentication is not required.
-    """
-
-    API_BASE_URL = settings.LMS_INTERNAL_ROOT_URL + '/api/'
-    APPEND_SLASH = False
-
-    def __init__(self):
-        """
-        Create an LMS API client.
-        """
-        self.client = EdxRestApiClient(self.API_BASE_URL, append_slash=self.APPEND_SLASH)
-
-
-class JwtLmsApiClient:
-    """
-    LMS client authenticates using a JSON Web Token (JWT) for the given user.
-    """
-
-    API_BASE_URL = settings.LMS_INTERNAL_ROOT_URL + '/api/'
-    APPEND_SLASH = False
-
-    def __init__(self, user, expires_in=settings.OAUTH_ID_TOKEN_EXPIRATION):
-        """
-        Connect to the REST API.
-        """
-        self.user = user
-        self.expires_in = expires_in
-        self.expires_at = 0
-        self.client = None
-
-    def connect(self):
-        """
-        Connect to the REST API, authenticating with a JWT for the current user.
-        """
-        if JwtBuilder is None:
-            raise NotConnectedToOpenEdX("This package must be installed in an OpenEdX environment.")
-
-        now = int(time())
-        jwt = JwtBuilder.create_jwt_for_user(self.user)
-        self.client = EdxRestApiClient(
-            self.API_BASE_URL, append_slash=self.APPEND_SLASH, jwt=jwt,
-        )
-        self.expires_at = now + self.expires_in
-
-    def token_expired(self):
-        """
-        Return True if the JWT token has expired, False if not.
-        """
-        return int(time()) > self.expires_at
-
-    @staticmethod
-    def refresh_token(func):
-        """
-        Use this method decorator to ensure the JWT token is refreshed when needed.
-        """
-        @wraps(func)
-        def inner(self, *args, **kwargs):
-            """
-            Before calling the wrapped function, we check if the JWT token is expired, and if so, re-connect.
-            """
-            if self.token_expired():
-                self.connect()
-            return func(self, *args, **kwargs)
-        return inner
 
 
 class EmbargoApiClient:
     """
     Client interface for using the edx-platform embargo API.
     """
 
     @staticmethod
-    def redirect_if_blocked(course_run_ids, user=None, ip_address=None, url=None):
+    def redirect_if_blocked(request, course_run_ids, user=None):
         """
         Return redirect to embargo error page if the given user is blocked.
         """
         for course_run_id in course_run_ids:
             redirect_url = embargo_api.redirect_if_blocked(
-                CourseKey.from_string(course_run_id),
+                request=request,
+                course_key=CourseKey.from_string(course_run_id),
                 user=user,
-                ip_address=ip_address,
-                url=url
             )
             if redirect_url:
                 return redirect_url
         return None
 
 
-class EnrollmentApiClient(JwtLmsApiClient):
+class EnrollmentApiClient(BackendServiceAPIClient):
     """
-    Object builds an API client to make calls to the Enrollment API.
+    The API client to make calls to the Enrollment API.
     """
 
     API_BASE_URL = settings.ENTERPRISE_ENROLLMENT_API_URL
 
-    def __init__(self, user=None):
-        user = user if user else get_enterprise_worker_user()
-        super(EnrollmentApiClient, self).__init__(user)
-
-    @JwtLmsApiClient.refresh_token
     def get_course_details(self, course_id):
         """
         Query the Enrollment API for the course details of the given course_id.
 
         Args:
             course_id (str): The string value of the course's unique identifier
 
         Returns:
             dict: A dictionary containing details about the course, in an enrollment context (allowed modes, etc.)
         """
+        api_url = self.get_api_url(f"course/{course_id}")
         try:
-            return self.client.course(course_id).get()
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
+            response = self.client.get(api_url)
+            response.raise_for_status()
+            return response.json()
+        except (RequestException, ConnectionError, Timeout):
             LOGGER.exception(
-                'Failed to retrieve course enrollment details for course [%s] due to: [%s]',
-                course_id, str(exc)
+                'Failed to retrieve course enrollment details for course [%s].', course_id
             )
             return {}
 
     def _sort_course_modes(self, modes):
         """
         Sort the course mode dictionaries by slug according to the COURSE_MODE_SORT_ORDER constant.
 
@@ -176,15 +95,14 @@
             sorting_slugs_size = len(sorting_slugs)
             if mode['slug'] in sorting_slugs:
                 return sorting_slugs_size - sorting_slugs.index(mode['slug'])
             return 0
         # Sort slug weights in descending order
         return sorted(modes, key=slug_weight, reverse=True)
 
-    @JwtLmsApiClient.refresh_token
     def get_course_modes(self, course_id):
         """
         Query the Enrollment API for the specific course modes that are available for the given course_id.
 
         Arguments:
             course_id (str): The string value of the course's unique identifier
 
@@ -192,131 +110,143 @@
             list: A list of course mode dictionaries.
 
         """
         details = self.get_course_details(course_id)
         modes = details.get('course_modes', [])
         return self._sort_course_modes([mode for mode in modes if mode['slug'] not in EXCLUDED_COURSE_MODES])
 
-    @JwtLmsApiClient.refresh_token
     def has_course_mode(self, course_run_id, mode):
         """
         Query the Enrollment API to see whether a course run has a given course mode available.
 
         Arguments:
             course_run_id (str): The string value of the course run's unique identifier
 
         Returns:
             bool: Whether the course run has the given mode avaialble for enrollment.
 
         """
         course_modes = self.get_course_modes(course_run_id)
         return any(course_mode for course_mode in course_modes if course_mode['slug'] == mode)
 
-    @JwtLmsApiClient.refresh_token
-    def enroll_user_in_course(self, username, course_id, mode, cohort=None):
+    def enroll_user_in_course(self, username, course_id, mode, cohort=None, enterprise_uuid=None):
         """
         Call the enrollment API to enroll the user in the course specified by course_id.
 
         Args:
             username (str): The username by which the user goes on the OpenEdX platform
             course_id (str): The string value of the course's unique identifier
             mode (str): The enrollment mode which should be used for the enrollment
             cohort (str): Add the user to this named cohort
+            enterprise_uuid (str): Add course enterprise uuid
 
         Returns:
             dict: A dictionary containing details of the enrollment, including course details, mode, username, etc.
 
         """
-        return self.client.enrollment.post(
-            {
+        api_url = self.get_api_url("enrollment")
+        response = self.client.post(
+            api_url,
+            json={
                 'user': username,
                 'course_details': {'course_id': course_id},
                 'is_active': True,
                 'mode': mode,
                 'cohort': cohort,
+                'enterprise_uuid': str(enterprise_uuid)
             }
         )
+        response.raise_for_status()
+        return response.json()
 
-    @JwtLmsApiClient.refresh_token
     def unenroll_user_from_course(self, username, course_id):
         """
         Call the enrollment API to unenroll the user in the course specified by course_id.
         Args:
             username (str): The username by which the user goes on the OpenEdx platform
             course_id (str): The string value of the course's unique identifier
         Returns:
             bool: Whether the unenrollment succeeded
         """
         enrollment = self.get_course_enrollment(username, course_id)
         if enrollment and enrollment['is_active']:
-            response = self.client.enrollment.post({
-                'user': username,
-                'course_details': {'course_id': course_id},
-                'is_active': False,
-                'mode': enrollment['mode']
-            })
-            return not response['is_active']
+            api_url = self.get_api_url("enrollment")
+            response = self.client.post(
+                api_url,
+                json={
+                    'user': username,
+                    'course_details': {'course_id': course_id},
+                    'is_active': False,
+                    'mode': enrollment['mode']
+                }
+            )
+            response.raise_for_status()
+            return not response.json()['is_active']
 
         return False
 
-    @JwtLmsApiClient.refresh_token
     def update_course_enrollment_mode_for_user(self, username, course_id, mode):
         """
         Call the enrollment API to update a user's course enrollment to the specified mode, e.g. "audit".
 
         Args:
             username (str): The username by which the user goes on the OpenEdx platform
             course_id (str): The string value of the course's unique identifier
             mode (str): The string value of the course mode, e.g. "audit"
 
         Returns:
             dict: A dictionary containing details of the enrollment, including course details, mode, username, etc.
         """
-        return self.client.enrollment.post({
-            'user': username,
-            'course_details': {'course_id': course_id},
-            'mode': mode,
-        })
+        api_url = self.get_api_url("enrollment")
+        response = self.client.post(
+            api_url,
+            json={
+                'user': username,
+                'course_details': {'course_id': course_id},
+                'mode': mode,
+            }
+        )
+        response.raise_for_status()
+        return response.json()
 
-    @JwtLmsApiClient.refresh_token
     def get_course_enrollment(self, username, course_id):
         """
         Query the enrollment API to get information about a single course enrollment.
 
         Args:
             username (str): The username by which the user goes on the OpenEdX platform
             course_id (str): The string value of the course's unique identifier
 
         Returns:
             dict: A dictionary containing details of the enrollment, including course details, mode, username, etc.
 
         """
-        endpoint = getattr(
-            self.client.enrollment,
-            '{username},{course_id}'.format(username=username, course_id=course_id)
-        )
+        username_course_string = '{username},{course_id}'.format(username=username, course_id=course_id)
+        api_url = self.get_api_url(f"enrollment/{username_course_string}")
+
         try:
-            result = endpoint.get()
-        except HttpNotFoundError:
+            response = self.client.get(api_url)
+            response.raise_for_status()
+        except HTTPError as err:
             # This enrollment data endpoint returns a 404 if either the username or course_id specified isn't valid
-            LOGGER.error(
-                'Course enrollment details not found for invalid username or course; username=[%s], course=[%s]',
-                username,
-                course_id
-            )
+            if err.response.status_code == 404:
+                LOGGER.error(
+                    'Course enrollment details not found for invalid username or course; username=[%s], course=[%s]',
+                    username,
+                    course_id
+                )
             return None
         # This enrollment data endpoint returns an empty string if the username and course_id is valid, but there's
         # no matching enrollment found
-        if not result:
+        if not response.content:
             LOGGER.info('Failed to find course enrollment details for user [%s] and course [%s]', username, course_id)
             return None
 
-        return result
+        return response.json()
 
-    @JwtLmsApiClient.refresh_token
     def is_enrolled(self, username, course_run_id):
         """
         Query the enrollment API and determine if a learner is enrolled in a course run.
 
         Args:
             username (str): The username by which the user goes on the OpenEdX platform
             course_run_id (str): The string value of the course's unique identifier
@@ -324,76 +254,81 @@
         Returns:
             bool: Indicating whether the user is enrolled in the course run. Returns False under any errors.
 
         """
         enrollment = self.get_course_enrollment(username, course_run_id)
         return enrollment is not None and enrollment.get('is_active', False)
 
-    @JwtLmsApiClient.refresh_token
     def get_enrolled_courses(self, username):
         """
         Query the enrollment API to get a list of the courses a user is enrolled in.
 
         Args:
             username (str): The username by which the user goes on the OpenEdX platform
 
         Returns:
             list: A list of course objects, along with relevant user-specific enrollment details.
 
         """
-        return self.client.enrollment.get(user=username)
+        api_url = self.get_api_url("enrollment")
+        response = self.client.get(api_url, params={"user": username})
+        response.raise_for_status()
+        return response.json()
 
 
-class CourseApiClient(NoAuthenticationLmsApiClient):
+class CourseApiClient(NoAuthAPIClient):
     """
-    Object builds an API client to make calls to the Course API.
+    The API client to make calls to the Course API.
     """
 
-    API_BASE_URL = settings.LMS_INTERNAL_ROOT_URL + '/api/courses/v1/'
+    API_BASE_URL = urljoin(f"{settings.LMS_INTERNAL_ROOT_URL}/", "api/courses/v1/")
     APPEND_SLASH = True
 
     def get_course_details(self, course_id):
         """
         Retrieve all available details about a course.
 
         Args:
             course_id (str): The course ID identifying the course for which to retrieve details.
 
         Returns:
             dict: Contains keys identifying those course details available from the courses API (e.g., name).
         """
+        api_url = self.get_api_url(f"courses/{course_id}")
         try:
-            return self.client.courses(course_id).get()
-        except (SlumberBaseException, ConnectionError, Timeout) as exc:
-            LOGGER.exception('Details not found for course [%s] due to: [%s]', course_id, str(exc))
+            response = self.client.get(api_url)
+            response.raise_for_status()
+            return response.json()
+        except (RequestException, ConnectionError, Timeout):
+            LOGGER.exception('Details not found for course [%s].', course_id)
             return None
 
 
-class ThirdPartyAuthApiClient(JwtLmsApiClient):
+class ThirdPartyAuthApiClient(UserAPIClient):
     """
-    Object builds an API client to make calls to the Third Party Auth API.
+    The API client to make calls to the Third Party Auth API.
     """
 
-    API_BASE_URL = settings.LMS_INTERNAL_ROOT_URL + '/api/third_party_auth/v0/'
+    API_BASE_URL = urljoin(f"{settings.LMS_INTERNAL_ROOT_URL}/", "api/third_party_auth/v0/")
 
-    @JwtLmsApiClient.refresh_token
+    @UserAPIClient.refresh_token
     def get_remote_id(self, identity_provider, username):
         """
         Retrieve the remote identifier for the given username.
 
         Args:
         * ``identity_provider`` (str): identifier slug for the third-party authentication service used during SSO.
         * ``username`` (str): The username ID identifying the user for which to retrieve the remote name.
 
         Returns:
             string or None: the remote name of the given user.  None if not found.
         """
         return self._get_results(identity_provider, 'username', username, 'remote_id')
 
-    @JwtLmsApiClient.refresh_token
+    @UserAPIClient.refresh_token
     def get_username_from_remote_id(self, identity_provider, remote_id):
         """
         Retrieve the remote identifier for the given username.
 
         Args:
         * ``identity_provider`` (str): identifier slug for the third-party authentication service used during SSO.
         * ``remote_id`` (str): The remote id identifying the user for which to retrieve the usernamename.
@@ -403,150 +338,194 @@
         """
         return self._get_results(identity_provider, 'remote_id', remote_id, 'username')
 
     def _get_results(self, identity_provider, param_name, param_value, result_field_name):
         """
         Calls the third party auth api endpoint to get the mapping between usernames and remote ids.
         """
+        api_url = self.get_api_url(f"providers/{identity_provider}/users")
         try:
             kwargs = {param_name: param_value}
-            returned = self.client.providers(identity_provider).users.get(**kwargs)
-            results = returned.get('results', [])
-        except HttpNotFoundError:
-            LOGGER.error(
-                'username not found for third party provider={provider}, {querystring_param}={id}'.format(
-                    provider=identity_provider,
-                    querystring_param=param_name,
-                    id=param_value
+            response = self.client.get(api_url, params=kwargs)
+            response.raise_for_status()
+            results = response.json().get('results', [])
+        except HTTPError as err:
+            if err.response.status_code == 404:
+                LOGGER.error(
+                    'Username not found for third party provider={%s}, {%s}={%s}',
+                    identity_provider,
+                    param_name,
+                    param_value
                 )
-            )
-            results = []
+                results = []
+            else:
+                raise
 
         for row in results:
             if row.get(param_name) == param_value:
                 return row.get(result_field_name)
         return None
 
 
-class GradesApiClient(JwtLmsApiClient):
+class GradesApiClient(UserAPIClient):
     """
-    Object builds an API client to make calls to the LMS Grades API.
+    The API client to make calls to the LMS Grades API.
 
     Note that this API client requires a JWT token, and so it keeps its token alive.
     """
 
-    API_BASE_URL = settings.LMS_INTERNAL_ROOT_URL + '/api/grades/v1/'
+    MAX_RETRIES = getattr(settings, "ENTERPRISE_DEGREED2_MAX_RETRIES", 4)
+    API_BASE_URL = urljoin(f"{settings.LMS_INTERNAL_ROOT_URL}/", "api/grades/v1/")
     APPEND_SLASH = True
 
-    @JwtLmsApiClient.refresh_token
+    def _calculate_backoff(self, attempt_count):
+        """
+        Calculate the seconds to sleep based on attempt_count
+        """
+        return (self.BACKOFF_FACTOR * (2 ** (attempt_count - 1)))
+
+    @UserAPIClient.refresh_token
     def get_course_grade(self, course_id, username):
         """
         Retrieve the grade for the given username for the given course_id.
 
         Args:
         * ``course_id`` (str): The string value of the course's unique identifier
         * ``username`` (str): The username ID identifying the user for which to retrieve the grade.
 
         Raises:
 
-        HttpNotFoundError if no grade found for the given user+course.
+        HTTPError if no grade found for the given user+course.
 
         Returns:
 
         a dict containing:
 
         * ``username``: A string representation of a user's username passed in the request.
         * ``course_key``: A string representation of a Course ID.
         * ``passed``: Boolean representing whether the course has been passed according the course's grading policy.
         * ``percent``: A float representing the overall grade for the course
         * ``letter_grade``: A letter grade as defined in grading_policy (e.g. 'A' 'B' 'C' for 6.002x) or None
 
         """
-        results = self.client.courses(course_id).get(username=username)
-        for row in results:
+        api_url = self.get_api_url(f"courses/{course_id}")
+        response = self.client.get(api_url, params={"username": username})
+        response.raise_for_status()
+        for row in response.json():
             if row.get('username') == username:
                 return row
 
-        raise HttpNotFoundError('No grade record found for course={}, username={}'.format(course_id, username))
+        raise HTTPError(f'No grade record found for course={course_id}, username={username}')
+
+    @UserAPIClient.refresh_token
+    def get_course_assessment_grades(self, course_id, username):
+        """
+        Retrieve the assessment grades for the given username for the given course_id.
 
+        Args:
+        * ``course_id`` (str): The string value of the course's unique identifier
+        * ``username`` (str): The username ID identifying the user for which to retrieve the grade.
 
-class CertificatesApiClient(JwtLmsApiClient):
+        Raises:
+
+        HTTPError if no grade found for the given user+course.
+
+        Returns:
+
+        a list of dicts containing:
+
+        * ``attempted``: A boolean representing whether the learner has attempted the subsection yet.
+        * ``subsection_name``: String representation of the subsection's name.
+        * ``category``: String representation of the subsection's category.
+        * ``label``: String representation of the subsection's label.
+        * ``score_possible``: The total amount of points that the learner could have earned on the subsection.
+        * ``score_earned``: The total amount of points that the learner earned on the subsection.
+        * ``percent``: A float representing the overall grade for the course.
+        * ``module_id``: The ID of the subsection.
+        """
+        attempts = 0
+        while True:
+            attempts = attempts + 1
+            api_url = self.get_api_url(f"gradebook/{course_id}")
+            try:
+                response = self.client.get(api_url, params={"username": username}, timeout=40)
+                response.raise_for_status()
+                break
+            except Timeout as to_exception:
+                if attempts <= self.MAX_RETRIES:
+                    sleep_seconds = self._calculate_backoff(attempts)
+                    LOGGER.warning(
+                        f"[ATTEMPT: {attempts}] Request to the LMS grades API timeouted out with "
+                        f"exception: {to_exception}, backing off for {sleep_seconds} seconds and retrying"
+                    )
+                    time.sleep(sleep_seconds)
+                else:
+                    LOGGER.warning(
+                        f"Requests to the grades API has reached the max number of retries [{self.MAX_RETRIES}], "
+                        f"attempting to retrieve grade data for learner: {username} under course {course_id}"
+                    )
+                    raise to_exception
+
+        results = response.json()
+        if results.get('username') == username:
+            return results.get('section_breakdown')
+
+        raise HTTPError(f"No assessment grade record found for course={course_id}, username={username}")
+
+
+class CertificatesApiClient(UserAPIClient):
     """
-    Object builds an API client to make calls to the LMS Certificates API.
+    The API client to make calls to the LMS Certificates API.
 
     Note that this API client requires a JWT token, and so it keeps its token alive.
     """
-
-    API_BASE_URL = settings.LMS_INTERNAL_ROOT_URL + '/api/certificates/v0/'
+    API_BASE_URL = urljoin(f"{settings.LMS_INTERNAL_ROOT_URL}/", "api/certificates/v0/")
     APPEND_SLASH = True
 
-    @JwtLmsApiClient.refresh_token
+    @UserAPIClient.refresh_token
     def get_course_certificate(self, course_id, username):
         """
         Retrieve the certificate for the given username for the given course_id.
 
         Args:
         * ``course_id`` (str): The string value of the course's unique identifier
         * ``username`` (str): The username ID identifying the user for which to retrieve the certificate
 
-        Raises:
-
-        HttpNotFoundError if no certificate found for the given user+course.
-
         Returns:
 
         a dict containing:
 
         * ``username``: A string representation of an user's username passed in the request.
         * ``course_id``: A string representation of a Course ID.
         * ``certificate_type``: A string representation of the certificate type.
-        * ``created_date`: Datetime the certificate was created (tz-aware).
+        * ``created_date``: Datetime the certificate was created (tz-aware).
         * ``status``: A string representation of the certificate status.
         * ``is_passing``: True if the certificate has a passing status, False if not.
         * ``download_url``: A string representation of the certificate url.
         * ``grade``: A string representation of a float for the user's course grade.
 
         """
-        return self.client.certificates(username).courses(course_id).get()
+        api_url = self.get_api_url(f"certificates/{username}/courses/{course_id}")
+        response = self.client.get(api_url)
+        response.raise_for_status()
+        return response.json()
 
 
-class NoAuthLMSClient(NoAuthenticationLmsApiClient):
+class NoAuthLMSClient(NoAuthAPIClient):
     """
-    Class to build an LMS client to make calls to the LMS.
+    The LMS API client to make calls to the LMS without authentication.
     """
 
     API_BASE_URL = settings.LMS_INTERNAL_ROOT_URL
     APPEND_SLASH = False
 
     def get_health(self):
         """
         Retrieve health details for LMS service.
 
         Returns:
             dict: Response containing LMS service health.
         """
-        return self.client.heartbeat.get()
-
-
-def parse_lms_api_datetime(datetime_string, datetime_format=LMS_API_DATETIME_FORMAT):
-    """
-    Parse a received datetime into a timezone-aware, Python datetime object.
-
-    Arguments:
-        datetime_string: A string to be parsed.
-        datetime_format: A datetime format string to be used for parsing
-
-    """
-    if isinstance(datetime_string, datetime.datetime):
-        date_time = datetime_string
-    else:
-        try:
-            date_time = datetime.datetime.strptime(datetime_string, datetime_format)
-        except ValueError:
-            date_time = datetime.datetime.strptime(datetime_string, LMS_API_DATETIME_FORMAT_WITHOUT_TIMEZONE)
-
-    # If the datetime format didn't include a timezone, then set to UTC.
-    # Note that if we're using the default LMS_API_DATETIME_FORMAT, it ends in 'Z',
-    # which denotes UTC for ISO-8661.
-    if date_time.tzinfo is None:
-        date_time = date_time.replace(tzinfo=timezone.utc)
-    return date_time
+        api_url = self.get_api_url("heartbeat")
+        response = self.client.get(api_url)
+        response.raise_for_status()
+        return response.json()
```

### Comparing `edx-enterprise-3.9.9/requirements/test.txt` & `edx-enterprise-4.0.0/requirements/test.txt`

 * *Files 26% similar despite different names*

```diff
@@ -1,99 +1,413 @@
 #
-# This file is autogenerated by pip-compile
-# To update, run:
+# This file is autogenerated by pip-compile with Python 3.8
+# by the following command:
 #
 #    make upgrade
 #
-amqp==2.6.1               # via -r requirements/test-master.txt, kombu
-aniso8601==8.0.0          # via -r requirements/test-master.txt, edx-tincan-py35
-attrs==20.2.0             # via pytest
-billiard==3.6.3.0         # via -r requirements/test-master.txt, celery
-bleach==3.2.1             # via -r requirements/test-master.txt
-celery==4.4.7             # via -c requirements/constraints.txt, -r requirements/test-master.txt
-certifi==2020.6.20        # via -r requirements/test-master.txt, requests
-cffi==1.14.3              # via -r requirements/test-master.txt, cryptography
-chardet==3.0.4            # via -r requirements/test-master.txt, requests
-click==7.1.2              # via -r requirements/test-master.txt, code-annotations
-code-annotations==0.9.0   # via -r requirements/test-master.txt
-coverage==5.3             # via pytest-cov
-cryptography==3.1.1       # via -r requirements/test-master.txt, django-fernet-fields, pyjwt
-ddt==1.3.1                # via -r requirements/test.in
-defusedxml==0.6.0         # via -r requirements/test-master.txt, djangorestframework-xml
-diff-cover==4.0.1         # via -r requirements/test.in
-django-config-models==2.0.3  # via -r requirements/test-master.txt
-django-countries==5.5     # via -r requirements/test-master.txt
-django-crum==0.7.7        # via -r requirements/test-master.txt, edx-rbac
-django-fernet-fields==0.6  # via -r requirements/test-master.txt
-django-filter==2.4.0      # via -r requirements/test-master.txt
-django-ipware==2.1.0      # via -r requirements/test-master.txt
-django-model-utils==4.0.0  # via -r requirements/test-master.txt, -r requirements/test.in, edx-rbac
-django-multi-email-field==0.6.2  # via -r requirements/test-master.txt
-django-object-actions==3.0.1  # via -r requirements/test-master.txt
-django-simple-history==2.12.0  # via -r requirements/test-master.txt
-django-waffle==2.0.0      # via -r requirements/test-master.txt, edx-django-utils, edx-drf-extensions
-djangorestframework-xml==2.0.0  # via -r requirements/test-master.txt
-djangorestframework==3.9.4  # via -r requirements/test-master.txt, django-config-models, drf-jwt, edx-drf-extensions, rest-condition
-drf-jwt==1.17.2           # via -r requirements/test-master.txt, edx-drf-extensions
-edx-django-utils==3.8.0   # via -r requirements/test-master.txt, django-config-models, edx-drf-extensions, edx-rest-api-client
-edx-drf-extensions==6.2.0  # via -r requirements/test-master.txt, edx-rbac
-edx-opaque-keys[django]==2.1.1  # via -r requirements/test-master.txt, edx-drf-extensions
-edx-rbac==1.3.3           # via -r requirements/test-master.txt
-edx-rest-api-client==5.2.1  # via -r requirements/test-master.txt
-edx-tincan-py35==0.0.9    # via -r requirements/test-master.txt
-factory-boy==2.12.0       # via -c requirements/constraints.txt, -r requirements/test.in
-faker==4.14.0             # via factory-boy
-freezegun==0.3.14         # via -c requirements/constraints.txt, -r requirements/test.in
-future==0.18.2            # via -r requirements/test-master.txt, pyjwkest
-idna==2.10                # via -r requirements/test-master.txt, requests
-importlib-metadata==2.0.0  # via -r requirements/test-master.txt, kombu, path, pluggy, pytest
-inflect==3.0.2            # via -c requirements/constraints.txt, jinja2-pluralize
-jinja2-pluralize==0.3.0   # via diff-cover
-jinja2==2.11.2            # via -r requirements/test-master.txt, code-annotations, diff-cover, jinja2-pluralize
-jsondiff==1.2.0           # via -r requirements/test-master.txt
-jsonfield2==3.0.3         # via -c requirements/constraints.txt, -r requirements/test-master.txt
-kombu==4.6.11             # via -r requirements/test-master.txt, celery
-markupsafe==1.1.1         # via -r requirements/test-master.txt, jinja2
-mock==3.0.5               # via -c requirements/constraints.txt, -r requirements/test.in
-more-itertools==8.5.0     # via -r requirements/test-master.txt, pytest, zipp
-newrelic==5.20.1.150      # via -r requirements/test-master.txt, edx-django-utils
-packaging==20.4           # via -r requirements/test-master.txt, bleach, pytest
-path.py==12.5.0           # via -r requirements/test-master.txt
-path==13.1.0              # via -r requirements/test-master.txt, path.py
-pbr==5.5.1                # via -r requirements/test-master.txt, stevedore
-pillow==7.2.0             # via -r requirements/test-master.txt
-pluggy==0.13.1            # via diff-cover, pytest
-psutil==5.7.2             # via -r requirements/test-master.txt, edx-django-utils
-py==1.9.0                 # via pytest, pytest-catchlog
-pycparser==2.20           # via -r requirements/test-master.txt, cffi
-pycryptodomex==3.9.8      # via -r requirements/test-master.txt, pyjwkest
-pygments==2.7.1           # via diff-cover
-pyjwkest==1.4.2           # via -r requirements/test-master.txt, edx-drf-extensions
-pyjwt[crypto]==1.7.1      # via -r requirements/test-master.txt, drf-jwt, edx-rest-api-client
-pymongo==3.10.1           # via -r requirements/test-master.txt, edx-opaque-keys
-pyparsing==2.4.7          # via -r requirements/test-master.txt, packaging
-pytest-catchlog==1.2.2    # via -r requirements/test.in
-pytest-cov==2.10.1        # via -r requirements/test.in
-pytest-django==4.0.0      # via -r requirements/test.in
-pytest==5.4.3             # via -c requirements/constraints.txt, pytest-catchlog, pytest-cov, pytest-django
-python-dateutil==2.4.0    # via -r requirements/test-master.txt, edx-drf-extensions, faker, freezegun
-python-slugify==4.0.1     # via -r requirements/test-master.txt, code-annotations
-pytz==2020.1              # via -r requirements/test-master.txt, celery, django, edx-tincan-py35
-pyyaml==5.3.1             # via -r requirements/test-master.txt, code-annotations
-requests==2.24.0          # via -r requirements/test-master.txt, edx-drf-extensions, edx-rest-api-client, pyjwkest, responses, slumber, tableauserverclient
-responses==0.10.15        # via -c requirements/constraints.txt, -r requirements/test.in
-rest-condition==1.0.3     # via -r requirements/test-master.txt, edx-drf-extensions
-rules==2.2                # via -r requirements/test-master.txt
-semantic-version==2.8.5   # via -r requirements/test-master.txt, edx-drf-extensions
-six==1.15.0               # via -r requirements/test-master.txt, bleach, cryptography, django-countries, django-simple-history, edx-drf-extensions, edx-opaque-keys, edx-rbac, freezegun, mock, packaging, pyjwkest, python-dateutil, responses, stevedore
-slumber==0.7.1            # via -r requirements/test-master.txt, edx-rest-api-client
-sqlparse==0.4.1           # via -r requirements/test-master.txt, django
-stevedore==1.32.0         # via -r requirements/test-master.txt, code-annotations, edx-django-utils, edx-opaque-keys
-tableauserverclient==0.13  # via -r requirements/test-master.txt
-testfixtures==6.15.0      # via -r requirements/test-master.txt, -r requirements/test.in
-text-unidecode==1.3       # via -r requirements/test-master.txt, faker, python-slugify
-unicodecsv==0.14.1        # via -r requirements/test-master.txt
-urllib3==1.25.11          # via -r requirements/test-master.txt, requests
-vine==1.3.0               # via -r requirements/test-master.txt, amqp, celery
-wcwidth==0.2.5            # via pytest
-webencodings==0.5.1       # via -r requirements/test-master.txt, bleach
-zipp==1.0.0               # via -c requirements/constraints.txt, -r requirements/test-master.txt, importlib-metadata
+    # via
+    #   -r requirements/test-master.txt
+    #   kombu
+aniso8601==9.0.1
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-tincan-py35
+asgiref==3.6.0
+    # via
+    #   -r requirements/test-master.txt
+    #   django
+    #   django-countries
+asn1crypto==1.5.1
+    # via
+    #   -r requirements/test-master.txt
+    #   oscrypto
+    #   snowflake-connector-python
+attrs==23.1.0
+    # via pytest
+    # via
+    #   -r requirements/test-master.txt
+    #   celery
+bleach[css]==6.0.0
+    # via -r requirements/test-master.txt
+    # via
+    #   -c requirements/constraints.txt
+    #   -r requirements/test-master.txt
+certifi==2022.12.7
+    # via
+    #   -r requirements/test-master.txt
+    #   requests
+    #   snowflake-connector-python
+cffi==1.15.1
+    # via
+    #   -r requirements/test-master.txt
+    #   cryptography
+    #   pynacl
+    #   snowflake-connector-python
+chardet==5.1.0
+    # via diff-cover
+charset-normalizer==2.0.12
+    # via
+    #   -r requirements/test-master.txt
+    #   requests
+    #   snowflake-connector-python
+    # via
+    #   -r requirements/test-master.txt
+    #   celery
+    #   click-didyoumean
+    #   click-plugins
+    #   click-repl
+    #   code-annotations
+    #   edx-django-utils
+    # via
+    #   -r requirements/test-master.txt
+    #   celery
+click-plugins==1.1.1
+    # via
+    #   -r requirements/test-master.txt
+    #   celery
+    # via
+    #   -r requirements/test-master.txt
+    #   celery
+code-annotations==1.3.0
+    # via -r requirements/test-master.txt
+coverage[toml]==7.2.3
+    # via pytest-cov
+cryptography==38.0.4
+    # via
+    #   -r requirements/test-master.txt
+    #   django-fernet-fields
+    #   pgpy
+    #   pyjwt
+    #   pyopenssl
+    #   snowflake-connector-python
+ddt==1.3.1
+    # via -r requirements/test.in
+defusedxml==0.7.1
+    # via
+    #   -r requirements/test-master.txt
+    #   djangorestframework-xml
+diff-cover==7.5.0
+    # via -r requirements/test.in
+    # via
+    #   -c requirements/common_constraints.txt
+    #   -r requirements/test-master.txt
+    #   django-config-models
+    #   django-crum
+    #   django-fernet-fields
+    #   django-filter
+    #   django-model-utils
+    #   django-multi-email-field
+    #   djangorestframework
+    #   drf-jwt
+    #   edx-django-utils
+    #   edx-drf-extensions
+    #   edx-rbac
+    #   jsonfield
+django-cache-memoize==0.1.10
+    # via -r requirements/test-master.txt
+django-config-models==2.3.0
+    # via -r requirements/test-master.txt
+django-countries==7.5.1
+    # via -r requirements/test-master.txt
+django-crum==0.7.9
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-django-utils
+    #   edx-rbac
+django-fernet-fields==0.6
+    # via -r requirements/test-master.txt
+django-filter==23.1
+    # via -r requirements/test-master.txt
+django-ipware==4.0.2
+    # via -r requirements/test-master.txt
+django-model-utils==4.3.1
+    # via
+    #   -r requirements/test-master.txt
+    #   -r requirements/test.in
+    #   edx-rbac
+django-multi-email-field==0.6.2
+    # via -r requirements/test-master.txt
+django-object-actions==4.1.0
+    # via -r requirements/test-master.txt
+django-simple-history==3.0.0
+    # via
+    #   -c requirements/common_constraints.txt
+    #   -r requirements/test-master.txt
+django-waffle==3.0.0
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-django-utils
+    #   edx-drf-extensions
+djangorestframework==3.12.4
+    # via
+    #   -r requirements/test-master.txt
+    #   django-config-models
+    #   drf-jwt
+    #   edx-drf-extensions
+djangorestframework-xml==2.0.0
+    # via -r requirements/test-master.txt
+drf-jwt==1.19.2
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-drf-extensions
+edx-django-utils==5.4.0
+    # via
+    #   -r requirements/test-master.txt
+    #   django-config-models
+    #   edx-drf-extensions
+    #   edx-rest-api-client
+edx-drf-extensions==8.6.0
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-rbac
+edx-opaque-keys[django]==2.3.0
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-drf-extensions
+edx-rbac==1.7.0
+    # via -r requirements/test-master.txt
+edx-rest-api-client==5.5.0
+    # via -r requirements/test-master.txt
+edx-tincan-py35==1.0.0
+    # via -r requirements/test-master.txt
+factory-boy==3.2.1
+    # via
+    #   -c requirements/constraints.txt
+    #   -r requirements/test.in
+faker==18.4.0
+    # via factory-boy
+filelock==3.11.0
+    # via
+    #   -r requirements/test-master.txt
+    #   snowflake-connector-python
+freezegun==0.3.14
+    # via
+    #   -c requirements/constraints.txt
+    #   -r requirements/test.in
+future==0.18.3
+    # via
+    #   -r requirements/test-master.txt
+    #   pyjwkest
+idna==3.4
+    # via
+    #   -r requirements/test-master.txt
+    #   requests
+    #   snowflake-connector-python
+iniconfig==2.0.0
+    # via pytest
+jinja2==3.1.2
+    # via
+    #   -r requirements/test-master.txt
+    #   code-annotations
+    #   diff-cover
+jsondiff==2.0.0
+    # via -r requirements/test-master.txt
+jsonfield==3.1.0
+    # via -r requirements/test-master.txt
+    # via
+    #   -r requirements/test-master.txt
+    #   celery
+markupsafe==2.1.2
+    # via
+    #   -r requirements/test-master.txt
+    #   jinja2
+mock==3.0.5
+    # via
+    #   -c requirements/constraints.txt
+    #   -r requirements/test.in
+newrelic==8.8.0
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-django-utils
+oscrypto==1.3.0
+    # via
+    #   -r requirements/test-master.txt
+    #   snowflake-connector-python
+packaging==23.1
+    # via
+    #   -r requirements/test-master.txt
+    #   pytest
+    #   snowflake-connector-python
+path==16.6.0
+    # via
+    #   -r requirements/test-master.txt
+    #   path-py
+path-py==12.5.0
+    # via -r requirements/test-master.txt
+pbr==5.11.1
+    # via
+    #   -r requirements/test-master.txt
+    #   stevedore
+pgpy==0.6.0
+    # via -r requirements/test-master.txt
+pillow==9.5.0
+    # via -r requirements/test-master.txt
+pluggy==1.0.0
+    # via
+    #   diff-cover
+    #   pytest
+    # via
+    #   -r requirements/test-master.txt
+    #   click-repl
+psutil==5.9.5
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-django-utils
+py==1.11.0
+    # via pytest
+pyasn1==0.4.8
+    # via
+    #   -r requirements/test-master.txt
+    #   pgpy
+pycparser==2.21
+    # via
+    #   -r requirements/test-master.txt
+    #   cffi
+pycryptodomex==3.17
+    # via
+    #   -r requirements/test-master.txt
+    #   pyjwkest
+    #   snowflake-connector-python
+pygments==2.15.0
+    # via diff-cover
+pyjwkest==1.4.2
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-drf-extensions
+pyjwt[crypto]==2.6.0
+    # via
+    #   -r requirements/test-master.txt
+    #   drf-jwt
+    #   edx-drf-extensions
+    #   edx-rest-api-client
+    #   snowflake-connector-python
+pymongo==3.13.0
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-opaque-keys
+pynacl==1.5.0
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-django-utils
+pyopenssl==22.0.0
+    # via
+    #   -r requirements/test-master.txt
+    #   snowflake-connector-python
+pytest==6.2.5
+    # via
+    #   -c requirements/constraints.txt
+    #   pytest-cov
+    #   pytest-django
+pytest-cov==4.0.0
+    # via -r requirements/test.in
+pytest-django==4.5.2
+    # via -r requirements/test.in
+python-dateutil==2.8.2
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-drf-extensions
+    #   faker
+    #   freezegun
+python-slugify==8.0.1
+    # via
+    #   -r requirements/test-master.txt
+    #   code-annotations
+pytz==2022.7.1
+    # via
+    #   -r requirements/test-master.txt
+    #   celery
+    #   django
+    #   edx-tincan-py35
+    #   snowflake-connector-python
+pyyaml==6.0
+    # via
+    #   -r requirements/test-master.txt
+    #   code-annotations
+requests==2.28.2
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-drf-extensions
+    #   edx-rest-api-client
+    #   pyjwkest
+    #   responses
+    #   slumber
+    #   snowflake-connector-python
+responses==0.10.15
+    # via
+    #   -c requirements/constraints.txt
+    #   -r requirements/test.in
+rules==3.3
+    # via -r requirements/test-master.txt
+semantic-version==2.10.0
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-drf-extensions
+six==1.16.0
+    # via
+    #   -r requirements/test-master.txt
+    #   bleach
+    #   click-repl
+    #   edx-drf-extensions
+    #   edx-rbac
+    #   freezegun
+    #   mock
+    #   pyjwkest
+    #   python-dateutil
+    #   responses
+slumber==0.7.1
+    # via
+    #   -r requirements/test-master.txt
+    #   edx-rest-api-client
+snowflake-connector-python==3.0.2
+    # via -r requirements/test-master.txt
+sqlparse==0.4.3
+    # via
+    #   -r requirements/test-master.txt
+    #   django
+stevedore==5.0.0
+    # via
+    #   -r requirements/test-master.txt
+    #   code-annotations
+    #   edx-django-utils
+    #   edx-opaque-keys
+testfixtures==7.1.0
+    # via
+    #   -r requirements/test-master.txt
+    #   -r requirements/test.in
+text-unidecode==1.3
+    # via
+    #   -r requirements/test-master.txt
+    #   python-slugify
+tinycss2==1.1.1
+    # via
+    #   -r requirements/test-master.txt
+    #   bleach
+toml==0.10.2
+    # via pytest
+tomli==2.0.1
+    # via coverage
+typing-extensions==4.5.0
+    # via
+    #   -r requirements/test-master.txt
+    #   django-countries
+    #   snowflake-connector-python
+unicodecsv==0.14.1
+    # via -r requirements/test-master.txt
+urllib3==1.26.15
+    # via
+    #   -r requirements/test-master.txt
+    #   requests
+    #   snowflake-connector-python
+    # via
+    #   -r requirements/test-master.txt
+    #   amqp
+    #   celery
+    #   kombu
+wcwidth==0.2.6
+    # via
+    #   -r requirements/test-master.txt
+    #   prompt-toolkit
+webencodings==0.5.1
+    # via
+    #   -r requirements/test-master.txt
+    #   bleach
+    #   tinycss2
```

### Comparing `edx-enterprise-3.9.9/requirements/dev.in` & `edx-enterprise-4.0.0/requirements/dev.in`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/requirements/constraints.txt` & `edx-enterprise-4.0.0/requirements/constraints.txt`

 * *Files 26% similar despite different names*

```diff
@@ -4,39 +4,34 @@
 # that will be applied if a package is needed.
 #
 # When pinning something here, please provide an explanation of why.  Ideally,
 # link to other information that will help people in the future to remove the
 # pin when possible.  Writing an issue against the offending project and
 # linking to it here is good.
 
+# Common constraints for edx repos
+-c common_constraints.txt
 
-# inflect has dropped support for python 3.5 after 3.0.2
-inflect==3.0.2
-
-# zip has dropped support for python 3.5 after 1.0.0
-zipp==1.0.0
-
-#jsonfield2 version 3.1.0 drops support for python3.5
-jsonfield2==3.0.3
 
 # mock has dropped support for python 3.5 after 3.0.5
 mock==3.0.5
-
-# sphinx has dropped support for python 3.5, latest version requires at least python3.6
-# see https://www.sphinx-doc.org/en/master/intro.html#prerequisites
-sphinx==2.4.1
-
+ 
 # freezegun>0.3.14 requires python-dateutil>2.8.1 to pass the tests which is a dependency of edx-platform
 # and edx-drf-extensions.
 freezegun==0.3.14
 
 # version 0.10.16 is having version conflict in make upgrade
 responses<0.10.16
 
-# version 3.0 is causing test failures
-factory-boy<3.0
+factory-boy<4.0
 
 # pytest version 6.0 causing test failures
-pytest<6.0
+pytest<7.0
+
+# pinning it to latest release.
+celery==5.0.4
+
+# pip-tools>=6.11.0 requires click>=8.0.0, which is not yet compatible.
+pip-tools<6.11.0
 
-# Python 3.5 is dropped in version 5.0
-celery<5.0
+# tox>=4.4.11 require filelock>=3.10.7, which is not yet compatible.
+tox<4
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/transmitters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/transmitters/learner_data.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Class for transmitting learner data to Degreed.
 """
 
 from integrated_channels.degreed.client import DegreedAPIClient
 from integrated_channels.integrated_channel.transmitters.learner_data import LearnerTransmitter
 
@@ -13,23 +12,23 @@
     sent to Degreed.
     """
 
     def __init__(self, enterprise_configuration, client=DegreedAPIClient):
         """
         By default, use the ``DegreedAPIClient`` for learner data transmission to Degreed.
         """
-        super(DegreedLearnerTransmitter, self).__init__(
+        super().__init__(
             enterprise_configuration=enterprise_configuration,
             client=client
         )
 
     def transmit(self, payload, **kwargs):
         """
         Send a completion status call to Degreed using the client.
 
         Args:
-            payload: The learner completion data payload to send to Degreed
+            payload: The learner exporter for Degreed
         """
         kwargs['app_label'] = 'degreed'
         kwargs['model_name'] = 'DegreedLearnerDataTransmissionAudit'
         kwargs['remote_user_id'] = 'degreed_user_email'
-        super(DegreedLearnerTransmitter, self).transmit(payload, **kwargs)
+        super().transmit(payload, **kwargs)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/transmitters/content_metadata.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/transmitters/content_metadata.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Class for transmitting content metadata to Degreed.
 """
 
 from integrated_channels.degreed.client import DegreedAPIClient
 from integrated_channels.integrated_channel.transmitters.content_metadata import ContentMetadataTransmitter
 
@@ -12,15 +11,15 @@
     This transmitter transmits exported content metadata to Degreed.
     """
 
     def __init__(self, enterprise_configuration, client=DegreedAPIClient):
         """
         Use the ``DegreedAPIClient`` for content metadata transmission to Degreed.
         """
-        super(DegreedContentMetadataTransmitter, self).__init__(
+        super().__init__(
             enterprise_configuration=enterprise_configuration,
             client=client
         )
 
     def _prepare_items_for_transmission(self, channel_metadata_items):
         return {
             'courses': channel_metadata_items,
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/exporters/content_metadata.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/exporters/content_metadata.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,22 +1,21 @@
-# -*- coding: utf-8 -*-
 """
 Content metadata exporter for Degreed.
 """
 
 from logging import getLogger
 
 from enterprise.utils import get_closest_course_run, get_course_run_duration_info
 from integrated_channels.integrated_channel.exporters.content_metadata import ContentMetadataExporter
 from integrated_channels.utils import get_image_url, strip_html_tags
 
 LOGGER = getLogger(__name__)
 
 
-class DegreedContentMetadataExporter(ContentMetadataExporter):  # pylint: disable=abstract-method
+class DegreedContentMetadataExporter(ContentMetadataExporter):
     """
     Degreed implementation of ContentMetadataExporter.
     """
 
     CHUNK_PAGE_LENGTH = 1000
     SHORT_STRING_LIMIT = 255
     LONG_STRING_LIMIT = 2000
@@ -38,15 +37,15 @@
         depending on availability and length limits.
         """
         course_runs = content_metadata_item.get('course_runs')
         duration_info = get_course_run_duration_info(
             get_closest_course_run(course_runs)
         ) if course_runs else ''
         full_description = content_metadata_item.get('full_description') or ''
-        if full_description and 0 < len(full_description + duration_info) <= self.LONG_STRING_LIMIT:     # pylint: disable=len-as-condition
+        if full_description and 0 < len(full_description + duration_info) <= self.LONG_STRING_LIMIT:
             description = full_description
         else:
             description = content_metadata_item.get('short_description') or content_metadata_item.get('title') or ''
         if description:
             description = "{duration_info}{description}".format(duration_info=duration_info, description=description)
         return strip_html_tags(description)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0005_auto_20180807_1302.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0005_auto_20180807_1302.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,7 @@
-# -*- coding: utf-8 -*-
-
-
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         ('degreed', '0004_auto_20180306_1251'),
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0004_auto_20180306_1251.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0004_auto_20180306_1251.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,10 +1,7 @@
-# -*- coding: utf-8 -*-
-
-
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         ('degreed', '0003_auto_20180109_0712'),
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0003_auto_20180109_0712.py` & `edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0007_auto_20220302_2231.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.12 on 2022-03-02 22:31
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('degreed', '0002_auto_20180104_0103'),
+        ('degreed2', '0006_auto_20220214_1627'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='degreedenterprisecustomerconfiguration',
-            name='active',
-            field=models.BooleanField(help_text='Is this configuration active?'),
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=255),
         ),
         migrations.AlterField(
-            model_name='historicaldegreedenterprisecustomerconfiguration',
-            name='active',
-            field=models.BooleanField(help_text='Is this configuration active?'),
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=255),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0001_initial.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0001_initial.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,22 +1,19 @@
-# -*- coding: utf-8 -*-
-
-
 import django.db.models.deletion
 import django.utils.timezone
 from django.conf import settings
 from django.db import migrations, models
 
 import model_utils.fields
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0034_auto_20171023_0727'),
+        ('enterprise', '0001_squashed_0092_auto_20200312_1650'),
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
     ]
 
     operations = [
         migrations.CreateModel(
             name='DegreedEnterpriseCustomerConfiguration',
             fields=[
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0006_upgrade_django_simple_history.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0013_alter_degreedenterprisecustomerconfiguration_enterprise_customer.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,22 +1,20 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.15 on 2018-12-13 15:23
-# This is necessary because django-simple-history 2.6.0 changes the model
+# Generated by Django 3.2.8 on 2021-12-20 17:24
 
-
-import django.db.models.deletion
 from django.db import migrations, models
+import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('degreed', '0005_auto_20180807_1302'),
+        ('enterprise', '0151_add_is_active_to_invite_key'),
+        ('degreed', '0012_auto_20210923_1727'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='historicaldegreedenterprisecustomerconfiguration',
+            model_name='degreedenterprisecustomerconfiguration',
             name='enterprise_customer',
-            field=models.ForeignKey(blank=True, db_constraint=False, help_text='Enterprise Customer associated with the configuration.', null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomer'),
+            field=models.ForeignKey(help_text='Enterprise Customer associated with the configuration.', on_delete=django.db.models.deletion.CASCADE, to='enterprise.enterprisecustomer'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0002_auto_20180104_0103.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0002_auto_20180104_0103.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,10 +1,7 @@
-# -*- coding: utf-8 -*-
-
-
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         ('degreed', '0001_initial'),
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0007_auto_20190925_0730.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0005_auto_20190925_0730.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,30 +1,24 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.23 on 2019-09-25 07:30
 
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('degreed', '0006_upgrade_django_simple_history'),
+        ('cornerstone', '0004_cornerstoneglobalconfiguration_languages'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='degreedenterprisecustomerconfiguration',
+            model_name='cornerstoneenterprisecustomerconfiguration',
             name='channel_worker_username',
             field=models.CharField(blank=True, help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255, null=True),
         ),
         migrations.AddField(
-            model_name='historicaldegreedenterprisecustomerconfiguration',
+            model_name='historicalcornerstoneenterprisecustomerconfiguration',
             name='channel_worker_username',
             field=models.CharField(blank=True, help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255, null=True),
         ),
-        migrations.AlterField(
-            model_name='degreedlearnerdatatransmissionaudit',
-            name='enterprise_course_enrollment_id',
-            field=models.PositiveIntegerField(db_index=True),
-        ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/migrations/0008_auto_20191001_0742.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0008_auto_20191001_0742.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.23 on 2019-10-01 07:42
 
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/models.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/models.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,32 +1,32 @@
-# -*- coding: utf-8 -*-
 """
 Database models for Enterprise Integrated Channel Degreed.
 """
 
 import json
 from logging import getLogger
 
 from config_models.models import ConfigurationModel
 from simple_history.models import HistoricalRecords
 
 from django.db import models
-from django.utils.encoding import python_2_unicode_compatible
 
 from integrated_channels.degreed.exporters.content_metadata import DegreedContentMetadataExporter
 from integrated_channels.degreed.exporters.learner_data import DegreedLearnerExporter
 from integrated_channels.degreed.transmitters.content_metadata import DegreedContentMetadataTransmitter
 from integrated_channels.degreed.transmitters.learner_data import DegreedLearnerTransmitter
-from integrated_channels.integrated_channel.models import EnterpriseCustomerPluginConfiguration
+from integrated_channels.integrated_channel.models import (
+    EnterpriseCustomerPluginConfiguration,
+    LearnerDataTransmissionAudit,
+)
+from integrated_channels.utils import is_valid_url
 
 LOGGER = getLogger(__name__)
 
 
-# pylint: disable=feature-toggle-needs-doc
-@python_2_unicode_compatible
 class DegreedGlobalConfiguration(ConfigurationModel):
     """
     The global configuration for integrating with Degreed.
 
     .. no_pii:
     """
 
@@ -63,69 +63,74 @@
     def __repr__(self):
         """
         Return uniquely identifying string representation.
         """
         return self.__str__()
 
 
-@python_2_unicode_compatible
 class DegreedEnterpriseCustomerConfiguration(EnterpriseCustomerPluginConfiguration):
     """
     The Enterprise-specific configuration we need for integrating with Degreed.
 
     .. no_pii:
     """
 
     key = models.CharField(
         max_length=255,
         blank=True,
+        default='',
         verbose_name="API Client ID",
         help_text=(
             "The API Client ID provided to edX by the enterprise customer to be used to make API "
             "calls to Degreed on behalf of the customer."
         )
     )
 
     secret = models.CharField(
         max_length=255,
         blank=True,
+        default='',
         verbose_name="API Client Secret",
         help_text=(
             "The API Client Secret provided to edX by the enterprise customer to be used to make API "
             "calls to Degreed on behalf of the customer."
         )
     )
 
     degreed_company_id = models.CharField(
         max_length=255,
         blank=True,
+        default='',
         verbose_name="Degreed Organization Code",
         help_text="The organization code provided to the enterprise customer by Degreed."
     )
 
     degreed_base_url = models.CharField(
         max_length=255,
         blank=True,
+        default='',
         verbose_name="Degreed Base URL",
         help_text="The base URL used for API requests to Degreed, i.e. https://degreed.com."
     )
 
     degreed_user_id = models.CharField(
         max_length=255,
         blank=True,
+        default='',
         verbose_name="Degreed User ID",
         help_text=(
             "The Degreed User ID provided to the content provider by Degreed. "
             "It is required for getting the OAuth access token."
         )
     )
 
     degreed_user_password = models.CharField(
         max_length=255,
         blank=True,
+        default='',
         verbose_name="Degreed User Password",
         help_text=(
             "The Degreed User Password provided to the content provider by Degreed. "
             "It is required for getting the OAuth access token."
         )
     )
 
@@ -137,14 +142,45 @@
     )
 
     history = HistoricalRecords()
 
     class Meta:
         app_label = 'degreed'
 
+    @property
+    def is_valid(self):
+        """
+        Returns whether or not the configuration is valid and ready to be activated
+
+        Args:
+            obj: The instance of DegreedEnterpriseCustomerConfiguration
+                being rendered with this admin form.
+        """
+        missing_items = {'missing': []}
+        incorrect_items = {'incorrect': []}
+        if not self.key:
+            missing_items.get('missing').append('key')
+        if not self.secret:
+            missing_items.get('missing').append('secret')
+        if not self.degreed_company_id:
+            missing_items.get('missing').append('degreed_company_id')
+        if not self.degreed_base_url:
+            missing_items.get('missing').append('degreed_base_url')
+        if not self.degreed_user_id:
+            missing_items.get('missing').append('degreed_user_id')
+        if not self.degreed_user_password:
+            missing_items.get('missing').append('degreed_user_password')
+        if not self.provider_id:
+            missing_items.get('missing').append('provider_id')
+        if not is_valid_url(self.degreed_base_url):
+            incorrect_items.get('incorrect').append('degreed_base_url')
+        if len(self.display_name) > 20:
+            incorrect_items.get('incorrect').append('display_name')
+        return missing_items, incorrect_items
+
     def __str__(self):
         """
         Return human-readable string representation.
         """
         return "<DegreedEnterpriseCustomerConfiguration for Enterprise {enterprise_name}>".format(
             enterprise_name=self.enterprise_customer.name
         )
@@ -183,63 +219,42 @@
     def get_content_metadata_exporter(self, user):
         """
         Return a ``DegreedContentMetadataExporter`` instance.
         """
         return DegreedContentMetadataExporter(user, self)
 
 
-@python_2_unicode_compatible
-class DegreedLearnerDataTransmissionAudit(models.Model):
+class DegreedLearnerDataTransmissionAudit(LearnerDataTransmissionAudit):
     """
     The payload we sent to Degreed at a given point in time for an enterprise course enrollment.
 
     .. pii: The degreed_user_email model field contains PII.
     .. pii_types: email_address
     .. pii_retirement: consumer_api
     """
 
     degreed_user_email = models.CharField(
         max_length=255,
         blank=False,
         null=False
     )
 
-    enterprise_course_enrollment_id = models.PositiveIntegerField(
-        blank=False,
-        null=False,
-        db_index=True
-    )
-
-    course_id = models.CharField(
-        max_length=255,
-        blank=False,
-        null=False,
-        help_text="The course run's key which is used to uniquely identify the course for Degreed."
-    )
-
-    course_completed = models.BooleanField(
-        default=True,
-        help_text="The learner's course completion status transmitted to Degreed."
-    )
-
-    completed_timestamp = models.CharField(
+    degreed_completed_timestamp = models.CharField(
         max_length=10,
+        blank=True,
+        null=True,
         help_text=(
             'Represents the Degreed representation of a timestamp: yyyy-mm-dd, '
             'which is always 10 characters.'
         )
     )
 
-    # Request-related information.
-    status = models.CharField(max_length=100, blank=False, null=False)
-    error_message = models.TextField(blank=True)
-    created = models.DateTimeField(auto_now_add=True)
-
     class Meta:
         app_label = 'degreed'
+        index_together = ['enterprise_customer_uuid', 'plugin_configuration_id']
 
     def __str__(self):
         """
         Return a human-readable string representation of the object.
         """
         return (
             '<DegreedLearnerDataTransmissionAudit {transmission_id} for enterprise enrollment {enrollment}, '
@@ -253,36 +268,31 @@
 
     def __repr__(self):
         """
         Return uniquely identifying string representation.
         """
         return self.__str__()
 
-    def serialize(self, *args, **kwargs):  # pylint: disable=unused-argument
+    def serialize(self, *args, **kwargs):
         """
         Return a JSON-serialized representation.
 
         Sort the keys so the result is consistent and testable.
 
         Can take the following keyword arguments:
             - `enterprise_configuration`: used to get the `degreed_company_id` to be sent in the payload.
 
         # TODO: When we refactor to use a serialization flow consistent with how course metadata
         # is serialized, remove the serialization here and make the learner data exporter handle the work.
         """
         enterprise_configuration = kwargs.get('enterprise_configuration')
         degreed_company_id = enterprise_configuration.degreed_company_id \
             if hasattr(enterprise_configuration, 'degreed_company_id') else ''
-        return json.dumps(self._payload_data(degreed_company_id), sort_keys=True)
-
-    def _payload_data(self, degreed_company_id):
-        """
-        Convert the audit record's fields into Degreed key/value pairs.
-        """
-        return {
+        json_payload = {
             'orgCode': degreed_company_id,
             'completions': [{
                 'email': self.degreed_user_email,
                 'id': self.course_id,
-                'completionDate': self.completed_timestamp,
+                'completionDate': self.degreed_completed_timestamp,
             }]
         }
+        return json.dumps(json_payload, sort_keys=True)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/degreed/client.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/client.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,22 +1,25 @@
-# -*- coding: utf-8 -*-
 """
 Client for connecting to Degreed.
 """
 
 import datetime
+import logging
 import time
+from urllib.parse import urljoin
 
 import requests
-from six.moves.urllib.parse import urljoin  # pylint: disable=import-error
 
 from django.apps import apps
 
 from integrated_channels.exceptions import ClientError
 from integrated_channels.integrated_channel.client import IntegratedChannelApiClient
+from integrated_channels.utils import generate_formatted_log
+
+LOGGER = logging.getLogger(__name__)
 
 
 class DegreedAPIClient(IntegratedChannelApiClient):
     """
     Client for connecting to Degreed.
 
     Specifically, this class supports obtaining access tokens and posting to the courses and
@@ -31,20 +34,48 @@
         """
         Instantiate a new client.
 
         Args:
             enterprise_configuration (DegreedEnterpriseCustomerConfiguration): An enterprise customers's
             configuration model for connecting with Degreed
         """
-        super(DegreedAPIClient, self).__init__(enterprise_configuration)
+        super().__init__(enterprise_configuration)
         self.global_degreed_config = apps.get_model('degreed', 'DegreedGlobalConfiguration').current()
         self.session = None
         self.expires_at = None
 
-    def create_course_completion(self, user_id, payload):  # pylint: disable=unused-argument
+    def create_assessment_reporting(self, user_id, payload):
+        """
+        Not implemented yet.
+        """
+        LOGGER.error(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                None,
+                "Degreed integrated channel does not yet support assessment reporting."
+            )
+        )
+
+    def cleanup_duplicate_assignment_records(self, courses):
+        """
+        Not implemented yet.
+        """
+        LOGGER.error(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                None,
+                "Degreed integrated channel does not yet support assignment deduplication."
+            )
+        )
+
+    def create_course_completion(self, user_id, payload):
         """
         Send a completion status payload to the Degreed Completion Status endpoint
 
         Args:
             user_id: Unused.
             payload: JSON encoded object (serialized from DegreedLearnerDataTransmissionAudit)
                 containing completion status fields per Degreed documentation.
@@ -59,15 +90,15 @@
                 self.enterprise_configuration.degreed_base_url,
                 self.global_degreed_config.completion_status_api_path
             ),
             payload,
             self.COMPLETION_PROVIDER_SCOPE
         )
 
-    def delete_course_completion(self, user_id, payload):  # pylint: disable=unused-argument
+    def delete_course_completion(self, user_id, payload):
         """
         Delete a completion status previously sent to the Degreed Completion Status endpoint
 
         Args:
             user_id: Unused.
             payload: JSON encoded object (serialized from DegreedLearnerDataTransmissionAudit)
                 containing the required completion status fields for deletion per Degreed documentation.
@@ -141,15 +172,15 @@
             )
         except requests.exceptions.RequestException as exc:
             raise ClientError(
                 'DegreedAPIClient request failed: {error} {message}'.format(
                     error=exc.__class__.__name__,
                     message=str(exc)
                 )
-            )
+            ) from exc
 
         if status_code >= 400:
             raise ClientError(
                 'DegreedAPIClient request failed with status {status_code}: {message}'.format(
                     status_code=status_code,
                     message=response_body
                 )
@@ -238,9 +269,9 @@
             headers={'Content-Type': 'application/x-www-form-urlencoded'}
         )
 
         try:
             data = response.json()
             expires_at = data['expires_in'] + int(time.time())
             return data['access_token'], datetime.datetime.utcfromtimestamp(expires_at)
-        except (KeyError, ValueError):
-            raise ClientError(response.text, response.status_code)
+        except (KeyError, ValueError) as error:
+            raise ClientError(response.text, response.status_code) from error
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/transmitters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/transmitters/learner_data.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Class for transmitting learner data to Cornerstone.
 """
 
 from integrated_channels.cornerstone.client import CornerstoneAPIClient
 from integrated_channels.integrated_channel.transmitters.learner_data import LearnerTransmitter
 
@@ -13,23 +12,23 @@
     sent to Cornerstone.
     """
 
     def __init__(self, enterprise_configuration, client=CornerstoneAPIClient):
         """
         By default, use the ``CornerstoneAPIClient`` for learner data transmission to Cornerstone.
         """
-        super(CornerstoneLearnerTransmitter, self).__init__(
+        super().__init__(
             enterprise_configuration=enterprise_configuration,
             client=client
         )
 
     def transmit(self, payload, **kwargs):
         """
         Send a completion status call to Cornerstone using the client.
 
         Args:
-            payload: The learner completion data payload to send to Cornerstone
+            payload: The learner exporter for Cornerstone
         """
         kwargs['app_label'] = 'cornerstone'
         kwargs['model_name'] = 'CornerstoneLearnerDataTransmissionAudit'
         kwargs['remote_user_id'] = 'user_guid'
-        super(CornerstoneLearnerTransmitter, self).transmit(payload, **kwargs)
+        super().transmit(payload, **kwargs)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/exporters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/exporters/learner_data.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,66 +1,76 @@
-# -*- coding: utf-8 -*-
 """
 Learner data exporter for Enterprise Integrated Channel Cornerstone.
 """
 
 from logging import getLogger
 
 from django.apps import apps
 
-from enterprise.api_client.discovery import get_course_catalog_api_service_client
+from integrated_channels.catalog_service_utils import get_course_id_for_enrollment
 from integrated_channels.integrated_channel.exporters.learner_data import LearnerExporter
+from integrated_channels.utils import generate_formatted_log
 
 LOGGER = getLogger(__name__)
 
 
 class CornerstoneLearnerExporter(LearnerExporter):
     """
     Class to provide a Cornerstone learner data transmission audit prepared for serialization.
     """
 
     def get_learner_data_records(
             self,
             enterprise_enrollment,
             completed_date=None,
             grade=None,
-            is_passing=False,
-            grade_percent=None
-    ):
+            course_completed=False,
+            **kwargs,
+    ):  # pylint: disable=arguments-differ
         """
         Return a CornerstoneLearnerDataTransmissionAudit with the given enrollment and course completion data.
 
-        If completed_date is None, then course completion has not been met.
-
         CornerstoneLearnerDataTransmissionAudit object should exit already if not then return None.
         """
-        course_completed = False
-        if completed_date is not None:
-            course_completed = True
 
-        CornerstoneLearnerDataTransmissionAudit = apps.get_model(  # pylint: disable=invalid-name
+        CornerstoneLearnerDataTransmissionAudit = apps.get_model(
             'cornerstone',
             'CornerstoneLearnerDataTransmissionAudit'
         )
 
-        course_catalog_client = get_course_catalog_api_service_client(
-            site=enterprise_enrollment.enterprise_customer_user.enterprise_customer.site
-        )
         try:
+            # get the proper internal representation of the course key
+            course_id = get_course_id_for_enrollment(enterprise_enrollment)
+            # because CornerstoneLearnerDataTransmissionAudit records are created with a click-through
+            # the internal edX course_id is always used on the CornerstoneLearnerDataTransmissionAudit records
+            # rather than the external_course_id mapped via CornerstoneCourseKey
             csod_learner_data_transmission = CornerstoneLearnerDataTransmissionAudit.objects.get(
                 user_id=enterprise_enrollment.enterprise_customer_user.user.id,
-                course_id=course_catalog_client.get_course_id(enterprise_enrollment.course_id),
+                course_id=course_id,
+                plugin_configuration_id=self.enterprise_configuration.id,
+                enterprise_customer_uuid=self.enterprise_configuration.enterprise_customer.uuid,
             )
             csod_learner_data_transmission.enterprise_course_enrollment_id = enterprise_enrollment.id
             csod_learner_data_transmission.grade = grade
             csod_learner_data_transmission.course_completed = course_completed
             csod_learner_data_transmission.completed_timestamp = completed_date
+
+            # Used for api error reporting
+            csod_learner_data_transmission.user_email = enterprise_enrollment.enterprise_customer_user.user_email
+
+            enterprise_customer = enterprise_enrollment.enterprise_customer_user.enterprise_customer
+            csod_learner_data_transmission.enterprise_customer_uuid = enterprise_customer.uuid
+            csod_learner_data_transmission.plugin_configuration_id = self.enterprise_configuration.id
             return [
                 csod_learner_data_transmission
             ]
         except CornerstoneLearnerDataTransmissionAudit.DoesNotExist:
-            LOGGER.info(
-                'No learner data was sent for user [%s] because Cornerstone user ID could not be found '
-                'for customer [%s]',
-                enterprise_enrollment.enterprise_customer_user.username,
-                enterprise_enrollment.enterprise_customer_user.enterprise_customer.name
-            )
+            LOGGER.info(generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                enterprise_enrollment.enterprise_customer_user.enterprise_customer.uuid,
+                enterprise_enrollment.enterprise_customer_user.user_id,
+                enterprise_enrollment.course_id,
+                ('get_learner_data_records finished. No learner data was sent for this LMS User Id because '
+                 'Cornerstone User ID not found for [{name}]'.format(
+                     name=enterprise_enrollment.enterprise_customer_user.enterprise_customer.name
+                 ))))
+            return None
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/exporters/content_metadata.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/exporters/content_metadata.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,73 +1,117 @@
-# -*- coding: utf-8 -*-
 """
 Content metadata exporter for Cornerstone.
 """
 
 import datetime
 from logging import getLogger
 
 import pytz
 
 from django.apps import apps
+from django.conf import settings
 
 from enterprise.utils import get_closest_course_run, get_language_code
+from integrated_channels.cornerstone.utils import convert_invalid_course_id
 from integrated_channels.integrated_channel.constants import ISO_8601_DATE_FORMAT
 from integrated_channels.integrated_channel.exporters.content_metadata import ContentMetadataExporter
 from integrated_channels.utils import (
     get_duration_from_estimated_hours,
     get_image_url,
     get_subjects_from_content_metadata,
 )
 
 LOGGER = getLogger(__name__)
 
 
-class CornerstoneContentMetadataExporter(ContentMetadataExporter):  # pylint: disable=abstract-method
+class CornerstoneContentMetadataExporter(ContentMetadataExporter):
     """
     Cornerstone implementation of ContentMetadataExporter.
     """
     LONG_STRING_LIMIT = 10000
     DEFAULT_SUBJECT = "Industry Specific"
     DEFAULT_LANGUAGE = "English"
-    DEFAULT_OWNER = {
+    DEFAULT_PARTNER = {
         "Name": "edX: edX Inc"
     }
     DATA_TRANSFORM_MAPPING = {
         'ID': 'key',
         'Title': 'title',
         'Description': 'description',
         'Thumbnail': 'image',
         'URL': 'enrollment_url',
         'IsActive': 'is_active',
         'LastModifiedUTC': 'modified',
         'Duration': 'estimated_hours',
-        'Owners': 'organizations',
+        'Partners': 'organizations',
         'Languages': 'languages',
         'Subjects': 'subjects',
     }
     SKIP_KEY_IF_NONE = True
+    MAX_PAYLOAD_COUNT = getattr(settings, "ENTERPRISE_CORNERSTONE_MAX_CONTENT_PAYLOAD_COUNT", 1000)
+
+    def export_for_web_polling(self, max_payload_count=MAX_PAYLOAD_COUNT):  # pylint: disable=unused-argument
+        """
+        Return the exported and transformed content metadata as a dictionary for CSDO web pull.
+        """
+        ContentMetadataItemTransmission = apps.get_model(
+            'integrated_channel',
+            'ContentMetadataItemTransmission'
+        )
+        create_payload = ContentMetadataItemTransmission.objects.filter(
+            marked_for='create',
+            enterprise_customer=self.enterprise_configuration.enterprise_customer,
+            plugin_configuration_id=self.enterprise_configuration.id,
+        )
+        update_payload = ContentMetadataItemTransmission.objects.filter(
+            marked_for='update',
+            enterprise_customer=self.enterprise_configuration.enterprise_customer,
+            plugin_configuration_id=self.enterprise_configuration.id,
+        )
+        delete_payload = ContentMetadataItemTransmission.objects.filter(
+            marked_for='delete',
+            enterprise_customer=self.enterprise_configuration.enterprise_customer,
+            plugin_configuration_id=self.enterprise_configuration.id,
+        )
+        created = {record.content_id: record for record in create_payload}
+        updated = {record.content_id: record for record in update_payload}
+        deleted = {record.content_id: record for record in delete_payload}
+        return created, updated, deleted
+
+    def transform_courserun_key(self, content_metadata_item):
+        """
+        Return the transformed version of the course run key by converting into a string of valid chars by encoding the
+        key with base 64. Because valid course run keys have already been transmitted as courses, and course keys are
+        used to uniquely identify edx courses, we only want to encode the invalid ones as they would have never been
+        created.
+        """
+        return convert_invalid_course_id(content_metadata_item.get('key'))
+
+    def transform_course_key(self, content_metadata_item):
+        """
+        Return the transformed version of the course key by converting into a string of valid chars by encoding the key
+        with base 64
+        """
+        return convert_invalid_course_id(content_metadata_item.get('key'))
 
     def transform_organizations(self, content_metadata_item):
         """
-        Return the transformed version of the course organizations
-        by converting each organization into cornerstone course owner object.
-        or default Owner if no owner found
+        Return the transformed version of the course organizations by converting each organization into cornerstone
+        course partner object. or default Partner if no partner found
         """
-        owners = []
+        partners = []
         for org in content_metadata_item.get('organizations') or []:
             org_name = org[:500] if org else ''
-            owners.append({"Name": org_name})
-        return owners or [self.DEFAULT_OWNER]
+            partners.append({"Name": org_name})
+        return partners or [self.DEFAULT_PARTNER]
 
     def transform_is_active(self, content_metadata_item):
         """
-        Return the transformed version of the course is_active status
-        by traversing course runs and setting IsActive to True if any of the course
-        runs have availability value set to `Current`, `Starting Soon` or `Upcoming`.
+        Return the transformed version of the course is_active status by traversing course runs and setting IsActive to
+        True if any of the course runs have availability value set to `Current`, `Starting Soon` or `Upcoming`.
         """
         is_active = False
         for course_run in content_metadata_item.get('course_runs', []):
             if course_run.get('availability') in ['Current', 'Starting Soon', 'Upcoming']:
                 is_active = True
                 break
         return is_active
@@ -103,44 +147,44 @@
         """
         return get_image_url(content_metadata_item)
 
     def transform_languages(self, content_metadata_item):
         """
         Return the languages supported by course or `English` as default if no languages found.
         """
-        CornerstoneGlobalConfiguration = apps.get_model(  # pylint: disable=invalid-name
+        CornerstoneGlobalConfiguration = apps.get_model(
             'cornerstone',
             'CornerstoneGlobalConfiguration'
         )
         languages_json = CornerstoneGlobalConfiguration.current().languages or {'Languages': []}
 
         languages = content_metadata_item.get('languages') or [self.DEFAULT_LANGUAGE]
         course_languages = [get_language_code(language) for language in languages]
         languages = set(languages_json['Languages']).intersection(set(course_languages))
         return list(languages) if languages else ['en-US']
 
     def transform_description(self, content_metadata_item):
         """
         Return the transformed version of the course description.
 
-        We choose one value out of the course's full description, short description, and title
-        depending on availability and length limits.
+        We choose one value out of the course's full description, short description, and title depending on availability
+        and length limits.
         """
         full_description = content_metadata_item.get('full_description') or ''
-        if 0 < len(full_description) <= self.LONG_STRING_LIMIT:  # pylint: disable=len-as-condition
+        if 0 < len(full_description) <= self.LONG_STRING_LIMIT:
             return full_description
         return content_metadata_item.get('short_description') or content_metadata_item.get('title') or ''
 
     def transform_subjects(self, content_metadata_item):
         """
         Return the transformed version of the course subject list or default value if no subject found.
         """
         subjects = []
         course_subjects = get_subjects_from_content_metadata(content_metadata_item)
-        CornerstoneGlobalConfiguration = apps.get_model(  # pylint: disable=invalid-name
+        CornerstoneGlobalConfiguration = apps.get_model(
             'cornerstone',
             'CornerstoneGlobalConfiguration'
         )
         subjects_mapping_dict = CornerstoneGlobalConfiguration.current().subject_mapping or {}
         for subject in course_subjects:
             for cornerstone_subject, edx_subjects in subjects_mapping_dict.items():
                 if subject.lower() in [edx_subject.lower() for edx_subject in edx_subjects]:
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0004_cornerstoneglobalconfiguration_languages.py` & `edx-enterprise-4.0.0/integrated_channels/blackboard/migrations/0011_auto_20221031_1855.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,22 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.23 on 2019-09-18 11:58
+# Generated by Django 3.2.15 on 2022-10-31 18:55
 
-
-import jsonfield.fields
-
-from django.db import migrations
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('cornerstone', '0003_auto_20190621_1000'),
+        ('blackboard', '0010_auto_20221021_0159'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='cornerstoneglobalconfiguration',
-            name='languages',
-            field=jsonfield.fields.JSONField(default={}, help_text='List of IETF language tags supported by cornerstone'),
+            model_name='blackboardenterprisecustomerconfiguration',
+            name='deleted_at',
+            field=models.DateTimeField(blank=True, null=True),
+        ),
+        migrations.AddField(
+            model_name='historicalblackboardenterprisecustomerconfiguration',
+            name='deleted_at',
+            field=models.DateTimeField(blank=True, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0005_auto_20190925_0730.py` & `edx-enterprise-4.0.0/enterprise/migrations/0157_make_field_nullable_before_removal.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.23 on 2019-09-25 07:30
-
+# Generated by Django 2.2.19 on 2022-05-16 20:03
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('cornerstone', '0004_cornerstoneglobalconfiguration_languages'),
+        ('enterprise', '0156_add_is_active_role_assignment'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='cornerstoneenterprisecustomerconfiguration',
-            name='channel_worker_username',
-            field=models.CharField(blank=True, help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255, null=True),
+        migrations.AlterField(
+            model_name='historicalsystemwideenterpriseuserroleassignment',
+            name='is_active',
+            field=models.BooleanField(default=True, null=True),
         ),
-        migrations.AddField(
-            model_name='historicalcornerstoneenterprisecustomerconfiguration',
-            name='channel_worker_username',
-            field=models.CharField(blank=True, help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255, null=True),
+        migrations.AlterField(
+            model_name='systemwideenterpriseuserroleassignment',
+            name='is_active',
+            field=models.BooleanField(default=True, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0002_cornerstoneglobalconfiguration_subject_mapping.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0003_alter_sapsuccessfactorslearnerdatatransmissionaudit_completed_timestamp.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,22 +1,18 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.20 on 2019-05-10 11:04
+# Generated by Django 3.2.12 on 2022-03-23 17:17
 
-
-import jsonfield.fields
-
-from django.db import migrations
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('cornerstone', '0001_initial'),
+        ('sap_success_factors', '0002_alter_sapsuccessfactorsenterprisecustomerconfiguration_display_name'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='cornerstoneglobalconfiguration',
-            name='subject_mapping',
-            field=jsonfield.fields.JSONField(default={}, help_text='Key/value mapping cornerstone subjects to edX subjects list'),
+        migrations.AlterField(
+            model_name='sapsuccessfactorslearnerdatatransmissionaudit',
+            name='completed_timestamp',
+            field=models.BigIntegerField(blank=True, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0001_initial.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0001_initial.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.20 on 2019-05-24 05:43
 
 
 import simple_history.models
 
 import django.db.models.deletion
 import django.utils.timezone
@@ -14,15 +13,15 @@
 
 class Migration(migrations.Migration):
 
     initial = True
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('enterprise', '0067_add_role_based_access_control_switch'),
+        ('enterprise', '0001_squashed_0092_auto_20200312_1650'),
     ]
 
     operations = [
         migrations.CreateModel(
             name='CornerstoneEnterpriseCustomerConfiguration',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
@@ -85,10 +84,10 @@
                 'get_latest_by': 'history_date',
                 'verbose_name': 'historical cornerstone enterprise customer configuration',
             },
             bases=(simple_history.models.HistoricalChanges, models.Model),
         ),
         migrations.AlterUniqueTogether(
             name='cornerstonelearnerdatatransmissionaudit',
-            unique_together=set([('user', 'course_id')]),
+            unique_together={('user', 'course_id')},
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0006_auto_20191001_0742.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0006_auto_20191001_0742.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.23 on 2019-10-01 07:42
 
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/migrations/0003_auto_20190621_1000.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0003_auto_20190621_1000.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 # Generated by Django 1.11.21 on 2019-06-21 10:00
 
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/models.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/models.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,37 +1,36 @@
-# -*- coding: utf-8 -*-
 """
 Database models for Enterprise Integrated Channel Cornerstone.
 """
 
 import json
 from logging import getLogger
 
 from config_models.models import ConfigurationModel
 from jsonfield import JSONField
 from simple_history.models import HistoricalRecords
 
-from django.contrib.auth.models import User
+from django.contrib import auth
 from django.db import models
-from django.utils.encoding import python_2_unicode_compatible
-from django.utils.translation import ugettext_lazy as _
-
-from model_utils.models import TimeStampedModel
+from django.utils.translation import gettext_lazy as _
 
 from integrated_channels.cornerstone.exporters.content_metadata import CornerstoneContentMetadataExporter
 from integrated_channels.cornerstone.exporters.learner_data import CornerstoneLearnerExporter
 from integrated_channels.cornerstone.transmitters.content_metadata import CornerstoneContentMetadataTransmitter
 from integrated_channels.cornerstone.transmitters.learner_data import CornerstoneLearnerTransmitter
-from integrated_channels.integrated_channel.models import EnterpriseCustomerPluginConfiguration
+from integrated_channels.integrated_channel.models import (
+    EnterpriseCustomerPluginConfiguration,
+    LearnerDataTransmissionAudit,
+)
+from integrated_channels.utils import is_valid_url
 
 LOGGER = getLogger(__name__)
+User = auth.get_user_model()
 
 
-# pylint: disable=feature-toggle-needs-doc
-@python_2_unicode_compatible
 class CornerstoneGlobalConfiguration(ConfigurationModel):
     """
     The global configuration for integrating with Cornerstone.
 
     .. no_pii:
     """
 
@@ -85,33 +84,68 @@
     def __repr__(self):
         """
         Return uniquely identifying string representation.
         """
         return self.__str__()
 
 
-@python_2_unicode_compatible
 class CornerstoneEnterpriseCustomerConfiguration(EnterpriseCustomerPluginConfiguration):
     """
     The Enterprise-specific configuration we need for integrating with Cornerstone.
 
     .. no_pii:
     """
     cornerstone_base_url = models.CharField(
         max_length=255,
         blank=True,
         verbose_name="Cornerstone Base URL",
         help_text=_("The base URL used for API requests to Cornerstone, i.e. https://portalName.csod.com")
     )
 
+    session_token = models.CharField(
+        max_length=255,
+        blank=True,
+        verbose_name="Cornerstone Session Token",
+        help_text=_(
+            "The most current session token provided for authorization to make API calls to the customer's instance"
+        )
+    )
+
+    session_token_modified = models.DateTimeField(
+        null=True,
+        blank=True,
+        help_text=_(
+            'Date time when session token was last provided'
+        )
+    )
+
     history = HistoricalRecords()
 
     class Meta:
         app_label = 'cornerstone'
 
+    @property
+    def is_valid(self):
+        """
+        Returns whether or not the configuration is valid and ready to be activated
+
+        Args:
+            obj: The instance of CornerstoneEnterpriseCustomerConfiguration
+                being rendered with this admin form.
+        """
+        missing_items = {'missing': []}
+        incorrect_items = {'incorrect': []}
+        if not self.cornerstone_base_url:
+            missing_items.get('missing').append('cornerstone_base_url')
+        if not is_valid_url(self.cornerstone_base_url):
+            incorrect_items.get('incorrect').append('cornerstone_base_url')
+        if len(self.display_name) > 20:
+            incorrect_items.get('incorrect').append('display_name')
+        return missing_items, incorrect_items
+
     def __str__(self):
         """
         Return human-readable string representation.
         """
         return "<CornerstoneEnterpriseCustomerConfiguration for Enterprise {enterprise_name}>".format(
             enterprise_name=self.enterprise_customer.name
         )
@@ -125,14 +159,29 @@
     @staticmethod
     def channel_code():
         """
         Returns an capitalized identifier for this channel class, unique among subclasses.
         """
         return 'CSOD'
 
+    @classmethod
+    def get_by_customer_and_subdomain(cls, enterprise_customer, customer_subdomain):
+        """
+        Get a specific config based on customer + subdomain pair, useful for "muddle of moodles"
+        """
+        # real prod data often has a config like `https://edx.csod.com` alongside `https://edx-stg.csod.com`
+        # if we just did a plain `icontains` using `edx` subdomain, we'd get the staging config too
+        # expanding the subdomain into a proper url prefix lets us get a more exact match.
+        # we require these urls be https
+        subdomain_formatted_as_url_prefix = f'https://{customer_subdomain}.'
+        return cls.objects.select_for_update().filter(
+            enterprise_customer=enterprise_customer,
+            cornerstone_base_url__icontains=subdomain_formatted_as_url_prefix,
+        ).first()
+
     def get_content_metadata_transmitter(self):
         """
         Return a ``CornerstoneContentMetadataTransmitter`` instance.
         """
         return CornerstoneContentMetadataTransmitter(self)
 
     def get_content_metadata_exporter(self, user):
@@ -150,71 +199,50 @@
     def get_learner_data_exporter(self, user):
         """
         Return a ``CornerstoneLearnerExporter`` instance.
         """
         return CornerstoneLearnerExporter(user, self)
 
 
-@python_2_unicode_compatible
-class CornerstoneLearnerDataTransmissionAudit(TimeStampedModel):
+class CornerstoneLearnerDataTransmissionAudit(LearnerDataTransmissionAudit):
     """
     The payload we sent to Cornerstone at a given point in time for an enterprise course enrollment.
 
     """
+
+    # TODO how is this set/used? should it be on the abstract class?
     user = models.ForeignKey(
         User,
         blank=False,
         null=False,
         related_name='cornerstone_transmission_audit',
         on_delete=models.CASCADE,
     )
 
+    # XXX this model has an opposite default from the base
+    course_completed = models.BooleanField(default=False)
+
     user_guid = models.CharField(
         max_length=255,
         blank=False,
         null=False
     )
 
-    enterprise_course_enrollment_id = models.PositiveIntegerField(
-        blank=True,
-        null=True,
-        db_index=True,
-    )
-
-    course_id = models.CharField(
-        max_length=255,
-        blank=False,
-        null=False,
-        help_text=_("The course run's key which is used to uniquely identify the course for Cornerstone.")
-    )
-
     session_token = models.CharField(max_length=255, null=False, blank=False)
     callback_url = models.CharField(max_length=255, null=False, blank=False)
     subdomain = models.CharField(max_length=255, null=False, blank=False)
 
-    course_completed = models.BooleanField(
-        default=False,
-        help_text=_("The learner's course completion status transmitted to Cornerstone.")
-    )
-
-    completed_timestamp = models.DateTimeField(
-        null=True,
-        blank=True,
-        help_text=_(
-            'Date time when user completed course'
-        )
-    )
+    # XXX non-standard
     grade = models.CharField(max_length=255, null=True, blank=True)
-    # Request-related information.
-    status = models.CharField(max_length=100, blank=True, null=True)
-    error_message = models.TextField(blank=True, null=True)
 
     class Meta:
         app_label = 'cornerstone'
+        # XXX non-standard
         unique_together = ("user", "course_id")
+        index_together = ['enterprise_customer_uuid', 'plugin_configuration_id']
 
     def __str__(self):
         """
         Return a human-readable string representation of the object.
         """
         return (
             '<CornerstoneLearnerDataTransmissionAudit {transmission_id} for enterprise enrollment {enrollment}, '
@@ -228,30 +256,57 @@
 
     def __repr__(self):
         """
         Return uniquely identifying string representation.
         """
         return self.__str__()
 
-    def serialize(self, *args, **kwargs):  # pylint: disable=unused-argument
+    def serialize(self, *args, **kwargs):
         """
         Return a JSON-serialized representation.
 
         Sort the keys so the result is consistent and testable.
         """
         data = {
             'courseId': self.course_id,
             'userGuid': self.user_guid,
             'callbackUrl': self.callback_url,
             'sessionToken': self.session_token,
             'status': 'Completed' if self.grade in ['Pass', 'Fail'] else 'In Progress',
             'completionDate':
+                # pylint: disable=E1123
                 self.completed_timestamp.replace(microsecond=0).isoformat() if self.completed_timestamp else None,
         }
         if self.grade != 'In Progress':
             data['successStatus'] = self.grade
         return json.dumps(
             {
                 "data": data
             },
             sort_keys=True
         )
+
+
+class CornerstoneCourseKey(models.Model):
+    """
+    Model for mapping long course keys to uuid's in order to comply with cornerstone's
+    50 character limit for course keys
+
+    .. no_pii:
+    """
+    internal_course_id = models.CharField(
+        primary_key=True,
+        max_length=255,
+        blank=False,
+        null=False,
+        help_text=_('This is the edX course key that is used as a unique identifier.')
+    )
+
+    external_course_id = models.CharField(
+        max_length=255,
+        blank=False,
+        null=False,
+        help_text=_('This is the course key that is being sent to our partners.')
+    )
+
+    class Meta:
+        app_label = 'cornerstone'
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/cornerstone/client.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/client.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,20 +1,24 @@
-# -*- coding: utf-8 -*-
 """
 Client for connecting to Cornerstone.
 """
 
 import base64
 import json
+import logging
 
 import requests
 
 from django.apps import apps
 
+from integrated_channels.cornerstone.utils import get_or_create_key_pair
 from integrated_channels.integrated_channel.client import IntegratedChannelApiClient
+from integrated_channels.utils import generate_formatted_log
+
+LOGGER = logging.getLogger(__name__)
 
 
 class CornerstoneAPIClient(IntegratedChannelApiClient):
     """
     Client for connecting to Cornerstone.
 
     Specifically, this class supports obtaining access tokens
@@ -25,53 +29,79 @@
         """
         Instantiate a new client.
 
         Args:
             enterprise_configuration (CornerstoneEnterpriseCustomerConfiguration): An enterprise customers's
             configuration model for connecting with Cornerstone
         """
-        super(CornerstoneAPIClient, self).__init__(enterprise_configuration)
+        super().__init__(enterprise_configuration)
         self.global_cornerstone_config = apps.get_model('cornerstone', 'CornerstoneGlobalConfiguration').current()
         self.session = None
         self.expires_at = None
 
     def create_content_metadata(self, serialized_data):
         """
         Create content metadata using the Cornerstone course content API.
         Since Cornerstone is following pull content model we don't need to implement this method
         """
+        return 200, ''
 
     def update_content_metadata(self, serialized_data):
         """
         Update content metadata using the Cornerstone course content API.
         Since Cornerstone is following pull content model we don't need to implement this method
         """
+        return 200, ''
 
     def delete_content_metadata(self, serialized_data):
         """
         Delete content metadata using the Cornerstone course content API.
         Since Cornerstone is following pull content model we don't need to implement this method
         """
+        return 200, ''
 
-    def delete_course_completion(self, user_id, payload):  # pylint: disable=unused-argument
+    def delete_course_completion(self, user_id, payload):
         """
         Delete a completion status previously sent to the Cornerstone Completion Status endpoint
         Cornerstone does not support this.
         """
+        return 200, ''
+
+    def cleanup_duplicate_assignment_records(self, courses):
+        """
+        Not implemented yet.
+        """
+        LOGGER.error(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                None,
+                "Cornerstone integrated channel does not yet support assignment deduplication."
+            )
+        )
 
-    def create_course_completion(self, user_id, payload):  # pylint: disable=unused-argument
+    def create_course_completion(self, user_id, payload):
         """
         Send a completion status payload to the Cornerstone Completion Status endpoint
 
         Raises:
             HTTPError: if we received a failure response code from Cornerstone
         """
         json_payload = json.loads(payload)
         callback_url = json_payload['data'].pop('callbackUrl')
-        session_token = json_payload['data'].pop('sessionToken')
+        session_token = self.enterprise_configuration.session_token
+        if not session_token:
+            session_token = json_payload['data'].pop('sessionToken')
+
+        # When exporting content metadata, we encode course keys that contain invalid chars or
+        # set them to uuids to comply with Cornerstone standards
+        course_id = json_payload['data'].get('courseId')
+        key_mapping = get_or_create_key_pair(course_id)
+        json_payload['data']['courseId'] = key_mapping.external_course_id
         url = '{base_url}{callback_url}{completion_path}?sessionToken={session_token}'.format(
             base_url=self.enterprise_configuration.cornerstone_base_url,
             callback_url=callback_url,
             completion_path=self.global_cornerstone_config.completion_status_api_path,
             session_token=session_token,
         )
 
@@ -81,17 +111,22 @@
             headers={
                 'Authorization': self.authorization_header,
                 'Content-Type': 'application/json'
             }
         )
         return response.status_code, response.text
 
+    def create_assessment_reporting(self, user_id, payload):
+        """
+        Not implemented yet
+        """
+
     @property
     def authorization_header(self):
         """
         Authorization header for authenticating requests to cornerstone progress API.
         """
         return 'Basic {}'.format(
-            base64.b64encode(u'{key}:{secret}'.format(
+            base64.b64encode('{key}:{secret}'.format(
                 key=self.global_cornerstone_config.key, secret=self.global_cornerstone_config.secret
             ).encode('utf-8')).decode()
         )
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/transmitters/__init__.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/transmitters/__init__.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Package for generic data transmitters which send serialized data to integrated channels.
 """
 
 
 class Transmitter:
     """
@@ -21,12 +20,12 @@
         Arguments:
             * enterprise_configuration - The configuration connecting an enterprise to an integrated channel.
             * client - The REST API client that'll transmit serialized data.
         """
         self.enterprise_configuration = enterprise_configuration
         self.client = client(enterprise_configuration) if client else None
 
-    def transmit(self, payload, **kwargs):
+    def transmit(self, create_payload, update_payload, delete_payload):
         """
         The abstract interface method for sending exported data to an integrated channel through its API client.
         """
         raise NotImplementedError('Implement in concrete subclass transmitter.')
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/exporters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/management/commands/send_course_completions.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,449 +1,324 @@
-# -*- coding: utf-8 -*-
 """
-Assist integrated channels with retrieving learner completion data.
-
-Module contains resources for integrated pipelines to retrieve all the
-grade and completion data for enrollments belonging to a particular
-enterprise customer.
+Send xAPI statements to the LRS configured via admin.
 """
 
 from logging import getLogger
 
-from slumber.exceptions import HttpNotFoundError
+from django.contrib import auth
+from django.core.management.base import BaseCommand, CommandError
 
-from django.apps import apps
-from django.utils import timezone
-from django.utils.dateparse import parse_datetime
-
-from consent.models import DataSharingConsent
-from enterprise.api_client.lms import CertificatesApiClient, CourseApiClient, GradesApiClient
-from enterprise.models import EnterpriseCourseEnrollment
-from integrated_channels.integrated_channel.exporters import Exporter
-from integrated_channels.utils import generate_formatted_log, is_already_transmitted, parse_datetime_to_epoch_millis
+from enterprise.api_client.discovery import get_course_catalog_api_service_client
+from enterprise.models import EnterpriseCourseEnrollment, EnterpriseCustomer, EnterpriseCustomerUser
+from enterprise.utils import NotConnectedToOpenEdX
+from integrated_channels.xapi.models import XAPILearnerDataTransmissionAudit, XAPILRSConfiguration
+from integrated_channels.xapi.utils import is_success_response, send_course_completion_statement
+
+try:
+    from lms.djangoapps.grades.models import PersistentCourseGrade
+except ImportError:
+    PersistentCourseGrade = None
+
+try:
+    from openedx.core.djangoapps.content.course_overviews.models import CourseOverview
+except ImportError:
+    CourseOverview = None
 
 LOGGER = getLogger(__name__)
+User = auth.get_user_model()
 
 
-class LearnerExporter(Exporter):
+class Command(BaseCommand):
     """
-    Base class for exporting learner completion data to integrated channels.
+    Send course completion xAPI statements to enterprise customers.
     """
 
-    GRADE_AUDIT = 'Audit'
-    GRADE_PASSING = 'Pass'
-    GRADE_FAILING = 'Fail'
-    GRADE_INCOMPLETE = 'In Progress'
-
-    def __init__(self, user, enterprise_configuration):
+    def add_arguments(self, parser):
         """
-        Store the data needed to export the learner data to the integrated channel.
-
-        Arguments:
-
-        * ``user``: User instance with access to the Grades API for the Enterprise Customer's courses.
-        * ``enterprise_configuration``: EnterpriseCustomerPluginConfiguration instance for the current channel.
+        Add required arguments to the parser.
         """
-        # The Grades API and Certificates API clients require an OAuth2 access token,
-        # so cache the client to allow the token to be reused. Cache other clients for
-        # general reuse.
-        self.grades_api = None
-        self.certificates_api = None
-        self.course_api = None
-        self.course_enrollment_api = None
-        super(LearnerExporter, self).__init__(user, enterprise_configuration)
-
-    @property
-    def grade_passing(self):
-        """
-        Returns the string used for a passing grade.
-        """
-        return self.GRADE_PASSING
-
-    @property
-    def grade_failing(self):
-        """
-        Returns the string used for a failing grade.
-        """
-        return self.GRADE_FAILING
-
-    @property
-    def grade_incomplete(self):
-        """
-        Returns the string used for an incomplete course grade.
-        """
-        return self.GRADE_INCOMPLETE
-
-    @property
-    def grade_audit(self):
-        """
-        Returns the string used for an audit course grade.
-        """
-        return self.GRADE_AUDIT
-
-    def export(self, **kwargs):  # pylint: disable=R0915
-        """
-        Collect learner data for the ``EnterpriseCustomer`` where data sharing consent is granted.
-
-        Yields a learner data object for each enrollment, containing:
-
-        * ``enterprise_enrollment``: ``EnterpriseCourseEnrollment`` object.
-        * ``completed_date``: datetime instance containing the course/enrollment completion date; None if not complete.
-          "Course completion" occurs for instructor-paced courses when course certificates are issued, and
-          for self-paced courses, when the course end date is passed, or when the learner achieves a passing grade.
-        * ``grade``: string grade recorded for the learner in the course.
-        """
-        channel_name = kwargs.get('app_label')
-        exporting_single_learner = False
-        learner_to_transmit = kwargs.get('learner_to_transmit', None)
-        course_run_id = kwargs.get('course_run_id', None)
-        completed_date = kwargs.get('completed_date', None)
-        is_passing = kwargs.get('is_passing', False)
-        grade = kwargs.get('grade', None)
-        skip_transmitted = kwargs.get('skip_transmitted', True)
-        TransmissionAudit = kwargs.get('TransmissionAudit', None)  # pylint: disable=invalid-name
-        # Fetch the consenting enrollment data, including the enterprise_customer_user.
-        # Order by the course_id, to avoid fetching course API data more than we have to.
-        generate_formatted_log(
-            'Starting Export. CompletedDate: {completed_date}, Course: {course_run}, '
-            'Grade: {grade}, IsPassing: {is_passing}, User: {user_id}'.format(
-                completed_date=completed_date,
-                course_run=course_run_id,
-                grade=grade,
-                is_passing=is_passing,
-                user_id=learner_to_transmit.id if learner_to_transmit else None
-            ),
-            channel_name=channel_name,
-            enterprise_customer_identifier=self.enterprise_customer.name
+        parser.add_argument(
+            '--days',
+            dest='days',
+            required=False,
+            type=int,
+            default=1,
+            help='Send xAPI analytics for learners who enrolled during last this number of days.'
         )
-        enrollment_queryset = EnterpriseCourseEnrollment.objects.select_related(
-            'enterprise_customer_user'
-        ).filter(
-            enterprise_customer_user__enterprise_customer=self.enterprise_customer,
-            enterprise_customer_user__active=True,
+        parser.add_argument(
+            '--enterprise_customer_uuid',
+            dest='enterprise_customer_uuid',
+            type=str,
+            required=False,
+            help='Send xAPI analytics for this enterprise customer only.'
         )
-        if learner_to_transmit and course_run_id:
-            enrollment_queryset = enrollment_queryset.filter(
-                course_id=course_run_id,
-                enterprise_customer_user__user_id=learner_to_transmit.id,
-            )
-            exporting_single_learner = True
-            generate_formatted_log(
-                'Exporting single learner. Course: {course_run}, User: {user_id}'.format(
-                    course_run=course_run_id,
-                    user_id=learner_to_transmit.id
-                ),
-                channel_name=channel_name,
-                enterprise_customer_identifier=self.enterprise_customer.name
-            )
-        enrollment_queryset = enrollment_queryset.order_by('course_id')
+        super().add_arguments(parser)
 
-        # Fetch course details from the Course API, and cache between calls.
-        course_details = None
+    @staticmethod
+    def parse_arguments(*args, **options):
+        """
+        Parse and validate arguments for the command.
 
-        generate_formatted_log(
-            'Beginning export of enrollments: {enrollments}.'.format(
-                enrollments=list(enrollment_queryset.values()),
-            ),
-            channel_name=channel_name,
-            enterprise_customer_identifier=self.enterprise_customer.name
-        )
+        Arguments:
+            *args: Positional arguments passed to the command
+            **options: Optional arguments passed to the command
 
-        for enterprise_enrollment in enrollment_queryset:
-            is_audit_enrollment = enterprise_enrollment.is_audit_enrollment
-            if TransmissionAudit and skip_transmitted and \
-                    is_already_transmitted(TransmissionAudit, enterprise_enrollment.id, grade):
-                # We've already sent a completion status for this enrollment
-                generate_formatted_log(
-                    'Skipping export of previously sent enterprise enrollment. '
-                    'EnterpriseEnrollment: {enterprise_enrollment_id}'.format(
-                        enterprise_enrollment_id=enterprise_enrollment.id
-                    ),
-                    channel_name=channel_name,
-                    enterprise_customer_identifier=self.enterprise_customer.name
+        Returns:
+            A tuple containing parsed values for
+            1. days (int): Integer showing number of days to lookup enterprise enrollments,
+                course completion etc and send to xAPI LRS
+            2. enterprise_customer_uuid (EnterpriseCustomer): Enterprise Customer if present then
+                send xAPI statements just for this enterprise.
+        """
+        days = options.get('days', 1)
+        enterprise_customer_uuid = options.get('enterprise_customer_uuid')
+        enterprise_customer = None
+
+        if enterprise_customer_uuid:
+            try:
+                enterprise_customer = EnterpriseCustomer.objects.get(uuid=enterprise_customer_uuid)
+            except EnterpriseCustomer.DoesNotExist as no_customer_error:
+                raise CommandError('Enterprise customer with uuid "{enterprise_customer_uuid}" does not exist.'.format(
+                    enterprise_customer_uuid=enterprise_customer_uuid
+                )) from no_customer_error
+
+        return days, enterprise_customer
+
+    def handle(self, *args, **options):
+        """
+        Send xAPI statements.
+        """
+        if not all((PersistentCourseGrade, CourseOverview)):
+            raise NotConnectedToOpenEdX("This package must be installed in an OpenEdX environment.")
+
+        days, enterprise_customer = self.parse_arguments(*args, **options)
+
+        if enterprise_customer:
+            try:
+                lrs_configuration = XAPILRSConfiguration.objects.get(
+                    active=True,
+                    enterprise_customer=enterprise_customer
                 )
-                continue
+            except XAPILRSConfiguration.DoesNotExist as no_config_exception:
+                raise CommandError('No xAPI Configuration found for "{enterprise_customer}"'.format(
+                    enterprise_customer=enterprise_customer.name
+                )) from no_config_exception
 
-            course_id = enterprise_enrollment.course_id
+            # Send xAPI analytics data to the configured LRS
+            self.send_xapi_statements(lrs_configuration, days)
+        else:
+            for lrs_configuration in XAPILRSConfiguration.objects.filter(active=True):
+                self.send_xapi_statements(lrs_configuration, days)
 
-            # Fetch course details from Courses API
-            # pylint: disable=unsubscriptable-object
-            if course_details:
-                generate_formatted_log(
-                    'Currently exporting for course: {curr_course}, '
-                    'but course details already found: {course_details}'.format(
-                        curr_course=course_id,
-                        course_details=course_details
-                    ),
-                    channel_name=channel_name,
-                    enterprise_customer_identifier=self.enterprise_customer.name
-                )
+    def send_xapi_statements(self, lrs_configuration, days):
+        """
+        Send xAPI analytics data of the enterprise learners to the given LRS.
 
-            if course_details is None or course_details['course_id'] != course_id:
-                if self.course_api is None:
-                    self.course_api = CourseApiClient()
-                course_details = self.course_api.get_course_details(course_id)
-                generate_formatted_log(
-                    'Successfully retrieved course details for course: {}'.format(
-                        course_id
-                    ),
-                    channel_name=channel_name,
-                    enterprise_customer_identifier=self.enterprise_customer.name
-                )
+        Arguments:
+            lrs_configuration (XAPILRSConfiguration): Configuration object containing LRS configurations
+                of the LRS where to send xAPI  learner analytics.
 
-            if course_details is None:
-                # Course not found, so we have nothing to report.
-                generate_formatted_log(
-                    'Course run details not found. EnterpriseEnrollment: {enterprise_enrollment_pk}, '
-                    'Course: {course_id}'.format(
-                        enterprise_enrollment_pk=enterprise_enrollment.pk,
-                        course_id=course_id
-                    ),
-                    channel_name=channel_name,
-                    enterprise_customer_identifier=self.enterprise_customer.name,
-                    is_error=True,
-                )
+            days (Numeric):  Deprecated.  Original implementation utilized a "days" parameter to limit
+                the number of enrollments transmitted, but this proved to be more problematic than helpful.
+        """
+        enterprise_course_enrollments = self.get_enterprise_course_enrollments(lrs_configuration.enterprise_customer)
+        enterprise_enrollment_ids = self.get_enterprise_enrollment_ids(enterprise_course_enrollments)
+        xapi_transmission_queryset = self.get_xapi_transmission_queryset(enterprise_enrollment_ids)
+        pertinent_enrollment_ids = self.get_pertinent_enrollment_ids(xapi_transmission_queryset)
+        pertinent_enrollments = self.get_pertinent_enrollments(enterprise_course_enrollments, pertinent_enrollment_ids)
+        enrollment_grades = self.get_course_completions(pertinent_enrollments)
+        users = self.prefetch_users(enrollment_grades)
+        course_overviews = self.prefetch_courses(enrollment_grades)
+        course_catalog_client = get_course_catalog_api_service_client(site=lrs_configuration.enterprise_customer.site)
+
+        for xapi_transmission in xapi_transmission_queryset:
+
+            object_type = self.get_object_type(xapi_transmission)
+
+            try:
+                course_grade = enrollment_grades[xapi_transmission.enterprise_course_enrollment_id]
+            except KeyError:
                 continue
 
-            consent = DataSharingConsent.objects.proxied_get(
-                username=enterprise_enrollment.enterprise_customer_user.username,
-                course_id=enterprise_enrollment.course_id,
-                enterprise_customer=enterprise_enrollment.enterprise_customer_user.enterprise_customer
+            user = users.get(course_grade.user_id)
+            courserun_id = str(course_grade.course_id)
+            course_overview = course_overviews.get(course_grade.course_id)
+            course_run_identifiers = course_catalog_client.get_course_run_identifiers(courserun_id)
+            course_overview.course_key = course_run_identifiers['course_key']
+            course_overview.course_uuid = course_run_identifiers['course_uuid']
+
+            default_error_message = 'Days argument has been deprecated.  Value: {days}'.format(days=days)
+            response_fields = {'status': 500, 'error_message': default_error_message}
+            response_fields = send_course_completion_statement(
+                lrs_configuration,
+                user,
+                course_overview,
+                course_grade,
+                object_type,
+                response_fields
             )
 
-            if not consent.granted or enterprise_enrollment.audit_reporting_disabled:
-                continue
-
-            # For instructor-paced and not audit courses, let the certificate determine course completion
-            if course_details.get('pacing') == 'instructor' and not is_audit_enrollment:
-                completed_date_from_api, grade_from_api, is_passing_from_api, grade_percent = \
-                    self._collect_certificate_data(enterprise_enrollment)
-                generate_formatted_log(
-                    'Received data from certificate api. CompletedDate: {completed_date}, Course: {course_id}, '
-                    'Enterprise: {enterprise}, Grade: {grade}, IsPassing: {is_passing}, User: {user_id}'.format(
-                        completed_date=completed_date_from_api,
-                        grade=grade_from_api,
-                        is_passing=is_passing_from_api,
-                        course_id=course_id,
-                        user_id=enterprise_enrollment.enterprise_customer_user.user_id,
-                        enterprise=enterprise_enrollment.enterprise_customer_user.enterprise_customer.slug
-                    ),
-                    channel_name=channel_name,
-                    enterprise_customer_identifier=self.enterprise_customer.name
-                )
-            # For self-paced courses, check the Grades API
-            else:
-                completed_date_from_api, grade_from_api, is_passing_from_api, grade_percent = \
-                    self._collect_grades_data(enterprise_enrollment, course_details, is_audit_enrollment)
-                generate_formatted_log(
-                    'Received data from grades api. CompletedDate: {completed_date}, Course: {course_id}, '
-                    'Enterprise: {enterprise}, Grade: {grade}, IsPassing: {is_passing}, User: {user_id}'.format(
-                        completed_date=completed_date_from_api,
-                        grade=grade_from_api,
-                        is_passing=is_passing_from_api,
-                        course_id=course_id,
-                        user_id=enterprise_enrollment.enterprise_customer_user.user_id,
-                        enterprise=enterprise_enrollment.enterprise_customer_user.enterprise_customer.slug
-                    ),
-                    channel_name=channel_name,
-                    enterprise_customer_identifier=self.enterprise_customer.name
+            if is_success_response(response_fields):
+                self.save_xapi_learner_data_transmission_audit(
+                    xapi_transmission,
+                    course_grade.percent_grade,
+                    1,
+                    course_grade.passed_timestamp,
+                    response_fields.get('status'),
+                    response_fields.get('error_message')
                 )
-            if exporting_single_learner and (grade != grade_from_api or is_passing != is_passing_from_api):
-                enterprise_user = enterprise_enrollment.enterprise_customer_user
-                generate_formatted_log(
-                    'Attempt to transmit conflicting data. '
-                    ' Course: {course_id}, Enterprise: {enterprise},'
-                    ' EnrollmentId: {enrollment_id},'
-                    ' Grade: {grade}, GradeAPI: {grade_api}, IsPassing: {is_passing},'
-                    ' IsPassingAPI: {is_passing_api}, User: {user_id}'.format(
-                        grade=grade,
-                        is_passing=is_passing,
-                        grade_api=grade_from_api,
-                        is_passing_api=is_passing_from_api,
-                        course_id=course_id,
-                        enrollment_id=enterprise_enrollment.id,
-                        user_id=enterprise_user.user_id,
-                        enterprise=enterprise_user.enterprise_customer.slug
-                    ),
-                    channel_name=channel_name,
-                    enterprise_customer_identifier=self.enterprise_customer.name,
-                    is_error=True
-                )
-            # Apply the Single Source of Truth for Grades
-            grade = grade_from_api
-            completed_date = completed_date_from_api
-            is_passing = is_passing_from_api
-            records = self.get_learner_data_records(
-                enterprise_enrollment=enterprise_enrollment,
-                completed_date=completed_date,
-                grade=grade,
-                is_passing=is_passing,
-                grade_percent=grade_percent
-            )
 
-            if records:
-                # There are some cases where we won't receive a record from the above
-                # method; right now, that should only happen if we have an Enterprise-linked
-                # user for the integrated channel, and transmission of that user's
-                # data requires an upstream user identifier that we don't have (due to a
-                # failure of SSO or similar). In such a case, `get_learner_data_record`
-                # would return None, and we'd simply skip yielding it here.
-                for record in records:
-                    yield record
-
-    def get_learner_data_records(
-            self,
-            enterprise_enrollment,
-            completed_date=None,
-            grade=None,
-            is_passing=False,
-            grade_percent=None  # pylint: disable=unused-argument
-    ):
-        """
-        Generate a learner data transmission audit with fields properly filled in.
-        """
-        # pylint: disable=invalid-name
-        LearnerDataTransmissionAudit = apps.get_model('integrated_channel', 'LearnerDataTransmissionAudit')
-        completed_timestamp = None
-        course_completed = False
-        if completed_date is not None:
-            completed_timestamp = parse_datetime_to_epoch_millis(completed_date)
-            course_completed = is_passing
-
-        return [
-            LearnerDataTransmissionAudit(
-                enterprise_course_enrollment_id=enterprise_enrollment.id,
-                course_id=enterprise_enrollment.course_id,
-                course_completed=course_completed,
-                completed_timestamp=completed_timestamp,
-                grade=grade,
-            )
-        ]
+    @staticmethod
+    def get_object_type(xapi_transmission):
+        """
+        Returns the object type for the xAPI transmission based on the course object identifier
+        """
+        object_type = 'course'
+        if 'course-v1' in xapi_transmission.course_id:
+            object_type = 'courserun'
+        return object_type
 
-    def _collect_certificate_data(self, enterprise_enrollment):
+    def get_enterprise_course_enrollments(self, enterprise_customer):
+        """
+        Retrieves the set of EnterpriseCourseEnrollment records for the specified EnterpriseCustomer
         """
-        Collect the learner completion data from the course certificate.
+        return EnterpriseCourseEnrollment.objects.filter(
+            enterprise_customer_user_id__enterprise_customer=enterprise_customer
+        )
 
-        Used for Instructor-paced courses.
+    def get_enterprise_enrollment_ids(self, enterprise_course_enrollments):
+        """
+        Extracts the identifiers from the provided EnterprsieCourseEnrollment queryset.
+        """
+        return enterprise_course_enrollments.values_list('id', flat=True)
 
-        If no certificate is found, then returns the completed_date = None, grade = In Progress, on the idea that a
-        certificate will eventually be generated.
+    @staticmethod
+    def get_xapi_transmission_queryset(enterprise_enrollment_ids):
+        """
+        Retrieves the xAPI transmission records for the specified list of EnterpriseCourseEnrollment identifiers
+        """
+        return XAPILearnerDataTransmissionAudit.objects.filter(
+            enterprise_course_enrollment_id__in=enterprise_enrollment_ids,
+            course_completed=0,
+        )
 
-        Args:
-            enterprise_enrollment (EnterpriseCourseEnrollment): the enterprise enrollment record for which we need to
-            collect completion/grade data
+    @staticmethod
+    def get_pertinent_enrollment_ids(xapi_transmission_queryset):
+        """
+        Returns the set of enterprise course enrollment identifiers from the
+        provided set of xAPI transmission records.
+        """
+        return xapi_transmission_queryset.values_list('enterprise_course_enrollment_id', flat=True)
+
+    def get_pertinent_enrollments(self, enterprise_course_enrollments, pertinent_enrollment_ids):
+        """
+        Returns the subset of enterprise course enrollments matching the list of provided identfiers
+        """
+        return enterprise_course_enrollments.filter(id__in=pertinent_enrollment_ids)
+
+    @staticmethod
+    def get_lms_user_id_from_enrollment(enterprise_course_enrollment):
+        """
+        Retrieves the corresponding User identifier for the specified EnterpriseCourseEnrollment record
+        """
+        return EnterpriseCustomerUser.objects.get(id=enterprise_course_enrollment.enterprise_customer_user_id).user_id
+
+    @staticmethod
+    def get_grade_record_for_enrollment(enterprise_course_enrollment):
+        """
+        Retrieves the corresponding PersistentCourseGrade record (if available)
+        for the specified EnterpriseCourseEnrollment record
+        """
+        lms_user_id = Command.get_lms_user_id_from_enrollment(enterprise_course_enrollment)
+        course_id = enterprise_course_enrollment.course_id
+        grade_records = PersistentCourseGrade.objects.filter(
+            user_id=lms_user_id,
+            course_id=course_id,
+            passed_timestamp__isnull=False
+        )
+        return grade_records.first()
+
+    @staticmethod
+    def get_course_completions(enterprise_course_enrollments):
+        """
+        Get course completions via PersistentCourseGrade for all the learners of given enterprise customer.
+
+        Arguments:
+            enterprise_customer (EnterpriseCustomer): Include Course enrollments for learners
+                of this enterprise customer.
+            days (int): Include course enrollment of this number of days.
+
+        Returns:
+            (list): A list of PersistentCourseGrade objects.
+
+        """
+        ece_grades = {}
+        for ece in enterprise_course_enrollments:
+            grade_record = Command.get_grade_record_for_enrollment(ece)
+            if grade_record is not None:
+                ece_grades.setdefault(ece.id, grade_record)
+        return ece_grades
+
+    @staticmethod
+    def prefetch_users(enrollment_grades):
+        """
+        Prefetch Users from the list of user_ids present in the persistent_course_grades.
+
+        Arguments:
+            enrollment_grades (list): A list of PersistentCourseGrade.
 
         Returns:
-            completed_date: Date the course was completed, this is None if course has not been completed.
-            grade: Current grade in the course.
-            percent_grade: The current percent grade in the course.
-            is_passing: Boolean indicating if the grade is a passing grade or not.
-        """
-
-        if self.certificates_api is None:
-            self.certificates_api = CertificatesApiClient(self.user)
-
-        course_id = enterprise_enrollment.course_id
-        username = enterprise_enrollment.enterprise_customer_user.user.username
-
-        try:
-            certificate = self.certificates_api.get_course_certificate(course_id, username)
-            completed_date = certificate.get('created_date')
-            if completed_date:
-                completed_date = parse_datetime(completed_date)
-            else:
-                completed_date = timezone.now()
-
-            # For consistency with _collect_grades_data, we only care about Pass/Fail grades. This could change.
-            is_passing = certificate.get('is_passing')
-            percent_grade = certificate.get('grade')
-            grade = self.grade_passing if is_passing else self.grade_failing
-
-        except HttpNotFoundError:
-            LOGGER.error('[Integrated Channel] Certificate data not found.'
-                         ' Course: {course_id}, EnterpriseEnrollment: {enterprise_enrollment},'
-                         ' Username: {username}'.format(
-                             course_id=course_id,
-                             username=username,
-                             enterprise_enrollment=enterprise_enrollment.pk))
-            completed_date = None
-            grade = self.grade_incomplete
-            is_passing = False
-            percent_grade = None
-
-        return completed_date, grade, is_passing, percent_grade
-
-    def _collect_grades_data(self, enterprise_enrollment, course_details, is_audit_enrollment):
-        """
-        Collect the learner completion data from the Grades API.
-
-        Used for self-paced courses.
-
-        Args:
-            enterprise_enrollment (EnterpriseCourseEnrollment): the enterprise enrollment record for which we need to
-            collect completion/grade data
-            course_details (dict): the course details for the course in the enterprise enrollment record.
+            (dict): A dictionary containing user_id to user mapping.
+        """
+        users = User.objects.filter(
+            id__in=[grade.user_id for grade in enrollment_grades.values()]
+        )
+        return {
+            user.id: user for user in users
+        }
+
+    def prefetch_courses(self, enrollment_grades):
+        """
+        Prefetch courses from the list of course_ids present in the persistent_course_grades.
+
+        Arguments:
+            persistent_course_grades (list): A list of PersistentCourseGrade.
 
         Returns:
-            completed_date: Date the course was completed, this is None if course has not been completed.
-            grade: Current grade in the course.
-            is_passing: Boolean indicating if the grade is a passing grade or not.
-        """
-        if self.grades_api is None:
-            self.grades_api = GradesApiClient(self.user)
-
-        course_id = enterprise_enrollment.course_id
-        username = enterprise_enrollment.enterprise_customer_user.user.username
-
-        try:
-            grades_data = self.grades_api.get_course_grade(course_id, username)
-
-        except HttpNotFoundError as error:
-            # Grade not found, so we have nothing to report.
-            if hasattr(error, 'response'):
-                response_content = error.response.json()  # pylint: disable=no-member
-                if response_content.get('error_code', '') == 'user_not_enrolled':
-                    # This means the user has an enterprise enrollment record but is not enrolled in the course yet
-                    LOGGER.info(
-                        '[Integrated Channel] User is not enrolled in the course.'
-                        ' Course: {course_id}, EnterpriseEnrollment: {enterprise_enrollment},'
-                        ' Username: {username}'.format(
-                            course_id=course_id,
-                            username=username,
-                            enterprise_enrollment=enterprise_enrollment.pk))
-                    return None, None, None, None
-
-            LOGGER.error('[Integrated Channel] Grades data not found.'
-                         ' Course: {course_id}, EnterpriseEnrollment: {enterprise_enrollment},'
-                         ' Username: {username}'.format(
-                             course_id=course_id,
-                             username=username,
-                             enterprise_enrollment=enterprise_enrollment.pk))
-            return None, None, None, None
-
-        # Prepare to process the course end date and pass/fail grade
-        course_end_date = course_details.get('end')
-        if course_end_date is not None:
-            course_end_date = parse_datetime(course_end_date)
-        now = timezone.now()
-        is_passing = grades_data.get('passed')
-
-        # We can consider a course complete if:
-        # * the course's end date has passed
-        if course_end_date is not None and course_end_date < now:
-            completed_date = course_end_date
-            grade = self.grade_passing if is_passing else self.grade_failing
-            grade = self.grade_audit if is_audit_enrollment else grade
-
-        # * Or, the learner has a passing grade (as of now)
-        elif is_passing:
-            completed_date = now
-            grade = self.grade_passing
+            (dict): A dictionary containing course_id to course_overview mapping.
+        """
+        return CourseOverview.get_from_ids(
+            [grade.course_id for grade in enrollment_grades.values()]
+        )
 
-        # Otherwise, the course is still in progress
-        else:
-            completed_date = None
-            grade = self.grade_incomplete
+    def save_xapi_learner_data_transmission_audit(self, xapi_transmission,
+                                                  course_grade, course_completed, completed_timestamp,
+                                                  status, error_message):
+        """
+        Capture interesting information about the xAPI enrollment (registration) event transmission.
 
-        percent_grade = grades_data.get('percent', None)
+        Arguments:
+            xapi_transmission (XAPILearnerDataTransmissionAudit): Transmission audit object being updated
+            course_grade (Numeric): Grade value for the enrollment
+            course_completed: (Boolean/Numeric): Whether or not the enrollment is considered complete.
+            completed_timestamp (Datetime): The point in time when completion occurred.
+            status (Numeric):  The response status code
+            error_message (String):  Information describing any error state provided by the caller
 
-        return completed_date, grade, is_passing, percent_grade
+        Returns:
+            None
+        """
+        xapi_transmission.course_completed = course_completed
+        xapi_transmission.completed_timestamp = completed_timestamp
+        xapi_transmission.grade = course_grade
+        xapi_transmission.status = status
+        xapi_transmission.error_message = error_message
+        xapi_transmission.save()
+
+        LOGGER.info(
+            "[Integrated Channel][xAPI] Successfully updated the XAPILearnerDataTransmissionAudit object with id: {id}"
+            ", user: {username} and course: {course_id}".format(
+                id=xapi_transmission.id,
+                username=xapi_transmission.user.username,
+                course_id=xapi_transmission.course_id
+            )
+        )
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/exporters/__init__.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/exporters/__init__.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Package for generic data exporters which serialize data to be transmitted to integrated channels.
 """
 
 
 class Exporter:
     """
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/migrations/0005_auto_20180306_1251.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0008_auto_20221021_0159.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,36 +1,28 @@
-# -*- coding: utf-8 -*-
+# Generated by Django 3.2.16 on 2022-10-21 01:59
 
-
-import jsonfield.fields
-
-import django.utils.timezone
 from django.db import migrations, models
 
-import model_utils.fields
-
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0041_auto_20180212_1507'),
-        ('integrated_channel', '0004_catalogtransmissionaudit_channel'),
+        ('sap_success_factors', '0007_sapsuccessfactorslearnerdatatransmissionaudit_api_record'),
     ]
 
     operations = [
-        migrations.CreateModel(
-            name='ContentMetadataItemTransmission',
-            fields=[
-                ('id', models.AutoField(verbose_name='ID', serialize=False, auto_created=True, primary_key=True)),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, verbose_name='created', editable=False)),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, verbose_name='modified', editable=False)),
-                ('integrated_channel_code', models.CharField(max_length=30)),
-                ('content_id', models.CharField(max_length=255)),
-                ('channel_metadata', jsonfield.fields.JSONField()),
-                ('enterprise_customer', models.ForeignKey(to='enterprise.EnterpriseCustomer', on_delete=models.CASCADE)),
-            ],
+        migrations.AddField(
+            model_name='sapsuccessfactorslearnerdatatransmissionaudit',
+            name='content_title',
+            field=models.CharField(blank=True, default=None, max_length=255, null=True),
+        ),
+        migrations.AddField(
+            model_name='sapsuccessfactorslearnerdatatransmissionaudit',
+            name='progress_status',
+            field=models.CharField(blank=True, max_length=255),
         ),
-        migrations.AlterUniqueTogether(
-            name='contentmetadataitemtransmission',
-            unique_together=set([('enterprise_customer', 'integrated_channel_code', 'content_id')]),
+        migrations.AddField(
+            model_name='sapsuccessfactorslearnerdatatransmissionaudit',
+            name='user_email',
+            field=models.CharField(blank=True, max_length=255, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/models.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/models.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,203 +1,311 @@
-# -*- coding: utf-8 -*-
 """
-Database models for Enterprise Integrated Channel.
+Database models for Enterprise Integrated Channel SAP SuccessFactors.
 """
 
 import json
-import logging
+from logging import getLogger
 
-from jsonfield.fields import JSONField
+from config_models.models import ConfigurationModel
 
-from django.contrib.auth.models import User
-from django.core.exceptions import ValidationError
 from django.db import models
-from django.utils.encoding import python_2_unicode_compatible
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
-from model_utils.models import TimeStampedModel
+from integrated_channels.exceptions import ClientError
+from integrated_channels.integrated_channel.models import (
+    EnterpriseCustomerPluginConfiguration,
+    LearnerDataTransmissionAudit,
+)
+from integrated_channels.sap_success_factors.exporters.content_metadata import SapSuccessFactorsContentMetadataExporter
+from integrated_channels.sap_success_factors.exporters.learner_data import (
+    SapSuccessFactorsLearnerExporter,
+    SapSuccessFactorsLearnerManger,
+)
+from integrated_channels.sap_success_factors.transmitters.content_metadata import (
+    SapSuccessFactorsContentMetadataTransmitter,
+)
+from integrated_channels.sap_success_factors.transmitters.learner_data import SapSuccessFactorsLearnerTransmitter
+from integrated_channels.utils import convert_comma_separated_string_to_list, is_valid_url
 
-from enterprise.models import EnterpriseCustomer, EnterpriseCustomerCatalog
-from integrated_channels.integrated_channel.exporters.content_metadata import ContentMetadataExporter
-from integrated_channels.integrated_channel.exporters.learner_data import LearnerExporter
-from integrated_channels.integrated_channel.transmitters.content_metadata import ContentMetadataTransmitter
-from integrated_channels.integrated_channel.transmitters.learner_data import LearnerTransmitter
-from integrated_channels.utils import convert_comma_separated_string_to_list
+LOGGER = getLogger(__name__)
 
-LOGGER = logging.getLogger(__name__)
 
+class SAPSuccessFactorsGlobalConfiguration(ConfigurationModel):
+    """
+    The global configuration for integrating with SuccessFactors.
 
-class EnterpriseCustomerPluginConfiguration(TimeStampedModel):
+    .. no_pii:
     """
-    Abstract base class for information related to integrating with external systems for an enterprise customer.
 
-    EnterpriseCustomerPluginConfiguration should be extended by configuration models in other integrated channel
-    apps to provide uniformity across different integrated channels.
+    completion_status_api_path = models.CharField(max_length=255)
+    course_api_path = models.CharField(max_length=255)
+    oauth_api_path = models.CharField(max_length=255)
+    search_student_api_path = models.CharField(max_length=255)
+    provider_id = models.CharField(max_length=100, default='EDX')
+
+    class Meta:
+        app_label = 'sap_success_factors'
 
-    The configuration provides default exporters and transmitters if the ``get_x_data_y`` methods aren't
-    overridden, where ``x`` and ``y`` are (learner, course) and (exporter, transmitter) respectively.
+    def __str__(self):
+        """
+        Return a human-readable string representation of the object.
+        """
+        return "<SAPSuccessFactorsGlobalConfiguration with id {id}>".format(id=self.id)
+
+    def __repr__(self):
+        """
+        Return uniquely identifying string representation.
+        """
+        return self.__str__()
+
+
+class SAPSuccessFactorsEnterpriseCustomerConfiguration(EnterpriseCustomerPluginConfiguration):
     """
+    The Enterprise-specific configuration we need for integrating with SuccessFactors.
 
-    enterprise_customer = models.OneToOneField(
-        EnterpriseCustomer,
-        blank=False,
-        null=False,
-        help_text=_("Enterprise Customer associated with the configuration."),
-        on_delete=models.deletion.CASCADE
-    )
+    .. no_pii:
+    """
 
-    active = models.BooleanField(
-        blank=False,
-        null=False,
-        help_text=_("Is this configuration active?"),
-    )
+    USER_TYPE_USER = 'user'
+    USER_TYPE_ADMIN = 'admin'
 
-    transmission_chunk_size = models.IntegerField(
-        default=500,
-        help_text=_("The maximum number of data items to transmit to the integrated channel with each request.")
+    USER_TYPE_CHOICES = (
+        (USER_TYPE_USER, 'User'),
+        (USER_TYPE_ADMIN, 'Admin'),
     )
 
-    channel_worker_username = models.CharField(
+    key = models.CharField(
+        max_length=255,
+        blank=True,
+        default='',
+        verbose_name="Client ID",
+        help_text=_("OAuth client identifier.")
+    )
+    sapsf_base_url = models.CharField(
         max_length=255,
         blank=True,
-        null=True,
-        help_text=_("Enterprise channel worker username to get JWT tokens for authenticating LMS APIs."),
+        default='',
+        verbose_name="SAP Base URL",
+        help_text=_("Base URL of success factors API.")
     )
-    catalogs_to_transmit = models.TextField(
+    sapsf_company_id = models.CharField(
+        max_length=255,
         blank=True,
-        null=True,
-        help_text=_("A comma-separated list of catalog UUIDs to transmit."),
+        default='',
+        verbose_name="SAP Company ID",
+        help_text=_("Success factors company identifier.")
+    )
+    sapsf_user_id = models.CharField(
+        max_length=255,
+        blank=True,
+        default='',
+        verbose_name="SAP User ID",
+        help_text=_("Success factors user identifier.")
+    )
+    secret = models.CharField(
+        max_length=255,
+        blank=True,
+        default='',
+        verbose_name="Client Secret",
+        help_text=_("OAuth client secret.")
+    )
+    user_type = models.CharField(
+        max_length=20,
+        choices=USER_TYPE_CHOICES,
+        default=USER_TYPE_USER,
+        verbose_name="SAP User Type",
+        help_text=_("Type of SAP User (admin or user).")
+    )
+    additional_locales = models.TextField(
+        blank=True,
+        default='',
+        verbose_name="Additional Locales",
+        help_text=_("A comma-separated list of additional locales.")
+    )
+    show_course_price = models.BooleanField(default=False)
+    transmit_total_hours = models.BooleanField(
+        default=False,
+        verbose_name=_("Transmit Total Hours"),
+        help_text=_("Include totalHours in the transmitted completion data")
+    )
+    prevent_self_submit_grades = models.BooleanField(
+        default=False,
+        verbose_name="Prevent Learner From Self-Submitting Grades",
+        help_text=_("When set to True, the integration will use the "
+                    "generic edX service user ('sapsf_user_id') "
+                    "defined in the SAP Customer Configuration for course completion.")
     )
 
-    class Meta:
-        abstract = True
+    # overriding base model field, to use chunk size 1 default
+    transmission_chunk_size = models.IntegerField(
+        default=1,
+        help_text=(
+            _("The maximum number of data items to transmit to the integrated channel "
+              "with each request.")
+        )
+    )
 
-    def clean(self):
-        invalid_uuids = []
-        for uuid in convert_comma_separated_string_to_list(self.catalogs_to_transmit):
-            try:
-                EnterpriseCustomerCatalog.objects.get(uuid=uuid, enterprise_customer=self.enterprise_customer)
-            except (EnterpriseCustomerCatalog.DoesNotExist, ValidationError):
-                invalid_uuids.append(str(uuid))
-        if invalid_uuids:
-            raise ValidationError(
-                {
-                    'catalogs_to_transmit': [
-                        "These are the invalid uuids: {invalid_uuids}".format(invalid_uuids=invalid_uuids)
-                    ]
-                }
-            )
+    def get_locales(self, default_locale=None):
+        """
+        Get the list of all(default + additional) locales
+
+        Args:
+            default_locale (str): Value of the default locale
+
+        Returns:
+            list: available locales
+        """
+        locales = []
+
+        if default_locale is None:
+            locales.append('English')
+        else:
+            locales.append(default_locale)
+
+        return set(
+            locales + convert_comma_separated_string_to_list(self.additional_locales)
+        )
+
+    class Meta:
+        app_label = 'sap_success_factors'
 
     @property
-    def channel_worker_user(self):
+    def is_valid(self):
         """
-        default worker username for channel
+        Returns whether or not the configuration is valid and ready to be activated
+
+        Args:
+            obj: The instance of SAPSuccessFactorsEnterpriseCustomerConfiguration
+                being rendered with this admin form.
+        """
+        missing_items = {'missing': []}
+        incorrect_items = {'incorrect': []}
+        if not self.key:
+            missing_items.get('missing').append('key')
+        if not self.sapsf_base_url:
+            missing_items.get('missing').append('sapsf_base_url')
+        if not self.sapsf_company_id:
+            missing_items.get('missing').append('sapsf_company_id')
+        if not self.sapsf_user_id:
+            missing_items.get('missing').append('sapsf_user_id')
+        if not self.secret:
+            missing_items.get('missing').append('secret')
+        if not is_valid_url(self.sapsf_base_url):
+            incorrect_items.get('incorrect').append('sapsf_base_url')
+        if len(self.display_name) > 20:
+            incorrect_items.get('incorrect').append('display_name')
+        return missing_items, incorrect_items
+
+    def __str__(self):
         """
-        worker_username = self.channel_worker_username if self.channel_worker_username else 'enterprise_channel_worker'
-        return User.objects.filter(username=worker_username).first()
+        Return human-readable string representation.
+        """
+        return "<SAPSuccessFactorsEnterpriseCustomerConfiguration for Enterprise {enterprise_name}>".format(
+            enterprise_name=self.enterprise_customer.name
+        )
 
-    @property
-    def customer_catalogs_to_transmit(self):
+    def __repr__(self):
         """
-        Return the list of EnterpriseCustomerCatalog objects.
+        Return uniquely identifying string representation.
         """
-        catalogs_list = []
-        if self.catalogs_to_transmit:
-            catalogs_list = EnterpriseCustomerCatalog.objects.filter(
-                uuid__in=convert_comma_separated_string_to_list(self.catalogs_to_transmit)
-            )
-        return catalogs_list
+        return self.__str__()
 
     @staticmethod
     def channel_code():
         """
         Returns an capitalized identifier for this channel class, unique among subclasses.
         """
-        raise NotImplementedError('Implemented in concrete subclass.')
+        return 'SAP'
 
-    def get_learner_data_exporter(self, user):
-        """
-        Returns the class that can serialize the learner course completion data to the integrated channel.
-        """
-        return LearnerExporter(user, self)
+    @property
+    def provider_id(self):
+        '''
+        Fetch ``provider_id`` from global configuration settings
+        '''
+        return SAPSuccessFactorsGlobalConfiguration.current().provider_id
 
     def get_learner_data_transmitter(self):
         """
-        Returns the class that can transmit the learner course completion data to the integrated channel.
+        Return a ``SapSuccessFactorsLearnerTransmitter`` instance.
         """
-        return LearnerTransmitter(self)
+        return SapSuccessFactorsLearnerTransmitter(self)
 
-    def get_content_metadata_exporter(self, user):
+    def get_learner_data_exporter(self, user):
         """
-        Returns a class that can retrieve and transform content metadata to the schema
-        expected by the integrated channel.
+        Return a ``SapSuccessFactorsLearnerDataExporter`` instance.
         """
-        return ContentMetadataExporter(user, self)
+        return SapSuccessFactorsLearnerExporter(user, self)
 
     def get_content_metadata_transmitter(self):
         """
-        Returns a class that can transmit the content metadata to the integrated channel.
+        Return a ``SapSuccessFactorsContentMetadataTransmitter`` instance.
         """
-        return ContentMetadataTransmitter(self)
+        return SapSuccessFactorsContentMetadataTransmitter(self)
 
-    def transmit_learner_data(self, user):
+    def get_content_metadata_exporter(self, user):
         """
-        Iterate over each learner data record and transmit it to the integrated channel.
+        Return a ``SapSuccessFactorsContentMetadataExporter`` instance.
         """
-        exporter = self.get_learner_data_exporter(user)
-        transmitter = self.get_learner_data_transmitter()
-        transmitter.transmit(exporter)
+        return SapSuccessFactorsContentMetadataExporter(user, self)
 
-    def transmit_single_learner_data(self, **kwargs):
+    def get_learner_manger(self):
         """
-        Iterate over single learner data record and transmit it to the integrated channel.
+        Return a ``SapSuccessFactorsLearnerManger`` instance.
         """
-        exporter = self.get_learner_data_exporter(self.channel_worker_user)
-        transmitter = self.get_learner_data_transmitter()
-        transmitter.transmit(exporter, **kwargs)
+        return SapSuccessFactorsLearnerManger(self)
 
-    def transmit_content_metadata(self, user):
+    def unlink_inactive_learners(self):
         """
-        Transmit content metadata to integrated channel.
+        Unlink inactive SAP learners form their related enterprises
         """
-        exporter = self.get_content_metadata_exporter(user)
-        transmitter = self.get_content_metadata_transmitter()
-        transmitter.transmit(exporter.export())
+        sap_learner_manager = self.get_learner_manger()
+        try:
+            sap_learner_manager.unlink_learners()
+        except ClientError as exc:
+            LOGGER.exception(
+                'Failed to unlink learners for integrated channel [%s] [%s] \nError: [%s]',
+                self.enterprise_customer.name,
+                self.channel_code(),
+                str(exc)
+            )
 
 
-@python_2_unicode_compatible
-class LearnerDataTransmissionAudit(models.Model):
+class SapSuccessFactorsLearnerDataTransmissionAudit(LearnerDataTransmissionAudit):
     """
-    The payload we send to an integrated channel  at a given point in time for an enterprise course enrollment.
+    The payload we sent to SuccessFactors at a given point in time for an enterprise course enrollment.
 
     .. no_pii:
     """
 
-    enterprise_course_enrollment_id = models.PositiveIntegerField(blank=False, null=False, db_index=True)
-    course_id = models.CharField(max_length=255, blank=False, null=False)
-    course_completed = models.BooleanField(default=True)
-    completed_timestamp = models.BigIntegerField()
-    instructor_name = models.CharField(max_length=255, blank=True)
+    sapsf_user_id = models.CharField(max_length=255, blank=False, null=False)
+
+    # XXX non-standard
     grade = models.CharField(max_length=100, blank=False, null=False)
-    status = models.CharField(max_length=100, blank=False, null=False)
-    error_message = models.TextField(blank=True)
-    created = models.DateTimeField(auto_now_add=True)
+    credit_hours = models.FloatField(null=True, blank=True)
+
+    sap_completed_timestamp = models.BigIntegerField(null=True, blank=True)
+
+    # override fields here otherwise multiple migrations created.
+    plugin_configuration_id = models.IntegerField(blank=True, null=True)
+    enterprise_course_enrollment_id = models.IntegerField(blank=True, null=True, db_index=True)
 
     class Meta:
-        app_label = 'integrated_channel'
+        app_label = 'sap_success_factors'
+        index_together = ['enterprise_customer_uuid', 'plugin_configuration_id']
 
     def __str__(self):
         """
         Return a human-readable string representation of the object.
         """
         return (
-            '<LearnerDataTransmissionAudit {transmission_id} for enterprise enrollment {enrollment}, '
-            'and course {course_id}>'.format(
+            '<SapSuccessFactorsLearnerDataTransmissionAudit {transmission_id} for enterprise enrollment '
+            '{enterprise_course_enrollment_id}, SAPSF user {sapsf_user_id}, and course {course_id}>'.format(
                 transmission_id=self.id,
-                enrollment=self.enterprise_course_enrollment_id,
+                enterprise_course_enrollment_id=self.enterprise_course_enrollment_id,
+                sapsf_user_id=self.sapsf_user_id,
                 course_id=self.course_id
             )
         )
 
     def __repr__(self):
         """
         Return uniquely identifying string representation.
@@ -205,69 +313,34 @@
         return self.__str__()
 
     @property
     def provider_id(self):
         """
         Fetch ``provider_id`` from global configuration settings
         """
-        return None
+        return SAPSuccessFactorsGlobalConfiguration.current().provider_id
 
-    def serialize(self, *args, **kwargs):  # pylint: disable=unused-argument
+    def serialize(self, *args, **kwargs):
         """
         Return a JSON-serialized representation.
 
         Sort the keys so the result is consistent and testable.
 
         # TODO: When we refactor to use a serialization flow consistent with how course metadata
         # is serialized, remove the serialization here and make the learner data exporter handle the work.
         """
         return json.dumps(self._payload_data(), sort_keys=True)
 
     def _payload_data(self):
         """
         Convert the audit record's fields into SAP SuccessFactors key/value pairs.
         """
-        return dict(
-            courseID=self.course_id,
-            courseCompleted="true" if self.course_completed else "false",
-            completedTimestamp=self.completed_timestamp,
-            grade=self.grade,
-        )
-
-
-@python_2_unicode_compatible
-class ContentMetadataItemTransmission(TimeStampedModel):
-    """
-    A content metadata item that has been transmitted to an integrated channel.
-
-    This model can be queried to find the content metadata items that have been
-    transmitted to an integrated channel. It is used to synchronize the content
-    metadata items available in an enterprise's catalog with the integrated channel.
-
-    .. no_pii:
-    """
-
-    enterprise_customer = models.ForeignKey(EnterpriseCustomer, on_delete=models.CASCADE)
-    integrated_channel_code = models.CharField(max_length=30)
-    content_id = models.CharField(max_length=255)
-    channel_metadata = JSONField()
-
-    class Meta:
-        unique_together = ('enterprise_customer', 'integrated_channel_code', 'content_id')
-
-    def __str__(self):
-        """
-        Return a human-readable string representation of the object.
-        """
-        return (
-            '<Content item {content_id} for Customer {customer} with Channel {channel}>'.format(
-                content_id=self.content_id,
-                customer=self.enterprise_customer,
-                channel=self.integrated_channel_code
-            )
-        )
-
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
+        return {
+            'userID': self.sapsf_user_id,
+            'courseID': self.course_id,
+            'providerID': self.provider_id,
+            'courseCompleted': 'true' if self.course_completed else 'false',
+            'completedTimestamp': self.sap_completed_timestamp,
+            'grade': self.grade,
+            'totalHours': self.total_hours,
+            'creditHours': self.credit_hours,
+        }
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/tasks.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/__init__.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,163 +1,161 @@
 """
-Celery tasks for integrated channel management commands.
+Enterprise Integrated Channel management commands.
 """
 
-import time
+from collections import OrderedDict
 
-from celery import shared_task
-from celery.utils.log import get_task_logger
+from django.core.management.base import CommandError
+from django.utils.translation import gettext as _
 
-from django.contrib.auth.models import User
-from django.utils import timezone
-
-from enterprise.utils import get_enterprise_customer_for_user
-from integrated_channels.integrated_channel.management.commands import (
-    INTEGRATED_CHANNEL_CHOICES,
-    IntegratedChannelCommandUtils,
-)
-from integrated_channels.utils import generate_formatted_log
-
-LOGGER = get_task_logger(__name__)
-
-
-@shared_task
-def transmit_content_metadata(username, channel_code, channel_pk):
-    """
-    Task to send content metadata to each linked integrated channel.
-
-    Arguments:
-        username (str): The username of the User to be used for making API requests to retrieve content metadata.
-        channel_code (str): Capitalized identifier for the integrated channel.
-        channel_pk (str): Primary key for identifying integrated channel.
-
-    """
-    start = time.time()
-    api_user = User.objects.get(username=username)
-    integrated_channel = INTEGRATED_CHANNEL_CHOICES[channel_code].objects.get(pk=channel_pk)
-    LOGGER.info('[Integrated Channel] Content metadata transmission started.'
-                ' Configuration: {configuration}'.format(configuration=integrated_channel))
-    try:
-        integrated_channel.transmit_content_metadata(api_user)
-    except Exception:  # pylint: disable=broad-except
-        LOGGER.exception(
-            '[Integrated Channel] Transmission of content metadata failed.'
-            ' ChannelCode: {channel_code}, ChannelId: {channel_id}, Username: {user}'.format(
-                user=username,
-                channel_code=channel_code,
-                channel_id=channel_pk
-            ))
-    duration = time.time() - start
-    LOGGER.info(
-        '[Integrated Channel] Content metadata transmission task finished. Configuration: {configuration},'
-        'Duration: {duration}'.format(
-            configuration=integrated_channel,
-            duration=duration
-        ))
-
-
-@shared_task
-def transmit_learner_data(username, channel_code, channel_pk):
-    """
-    Task to send learner data to each linked integrated channel.
-
-    Arguments:
-        username (str): The username of the User to be used for making API requests for learner data.
-        channel_code (str): Capitalized identifier for the integrated channel
-        channel_pk (str): Primary key for identifying integrated channel
+from enterprise.models import EnterpriseCustomer
+from integrated_channels.blackboard.models import BlackboardEnterpriseCustomerConfiguration
+from integrated_channels.canvas.models import CanvasEnterpriseCustomerConfiguration
+from integrated_channels.cornerstone.models import CornerstoneEnterpriseCustomerConfiguration
+from integrated_channels.degreed2.models import Degreed2EnterpriseCustomerConfiguration
+from integrated_channels.degreed.models import DegreedEnterpriseCustomerConfiguration
+from integrated_channels.moodle.models import MoodleEnterpriseCustomerConfiguration
+from integrated_channels.sap_success_factors.models import SAPSuccessFactorsEnterpriseCustomerConfiguration
+
+# Mapping between the channel code and the channel configuration class
+INTEGRATED_CHANNEL_CHOICES = OrderedDict([
+    (integrated_channel_class.channel_code(), integrated_channel_class)
+    for integrated_channel_class in (
+        BlackboardEnterpriseCustomerConfiguration,
+        CanvasEnterpriseCustomerConfiguration,
+        CornerstoneEnterpriseCustomerConfiguration,
+        DegreedEnterpriseCustomerConfiguration,
+        Degreed2EnterpriseCustomerConfiguration,
+        MoodleEnterpriseCustomerConfiguration,
+        SAPSuccessFactorsEnterpriseCustomerConfiguration,
+    )
+])
 
-    """
-    start = time.time()
-    api_user = User.objects.get(username=username)
-    integrated_channel = INTEGRATED_CHANNEL_CHOICES[channel_code].objects.get(pk=channel_pk)
-    generate_formatted_log(
-        'Batch processing learners for integrated channel. Configuration: {configuration}'.format(
-            configuration=integrated_channel,
-        ),
-        channel_name=channel_code,
-        enterprise_customer_identifier=api_user.username
+ASSESSMENT_LEVEL_REPORTING_INTEGRATED_CHANNEL_CHOICES = OrderedDict([
+    (integrated_channel_class.channel_code(), integrated_channel_class)
+    for integrated_channel_class in (
+        BlackboardEnterpriseCustomerConfiguration,
+        CanvasEnterpriseCustomerConfiguration,
     )
+])
 
-    # Note: learner data transmission code paths don't raise any uncaught exception, so we don't need a broad
-    # try-except block here.
-    integrated_channel.transmit_learner_data(api_user)
-
-    duration = time.time() - start
-    generate_formatted_log(
-        'Batch learner data transmission task finished. Configuration: {configuration},'
-        ' Duration: {duration}'.format(
-            configuration=integrated_channel,
-            duration=duration
-        ),
-        channel_name=channel_code,
-        enterprise_customer_identifier=api_user.username
+CONTENT_METADATA_JOB_INTEGRATED_CHANNEL_CHOICES = OrderedDict([
+    (integrated_channel_class.channel_code(), integrated_channel_class)
+    for integrated_channel_class in (
+        BlackboardEnterpriseCustomerConfiguration,
+        CanvasEnterpriseCustomerConfiguration,
+        CornerstoneEnterpriseCustomerConfiguration,
+        DegreedEnterpriseCustomerConfiguration,
+        Degreed2EnterpriseCustomerConfiguration,
+        MoodleEnterpriseCustomerConfiguration,
+        SAPSuccessFactorsEnterpriseCustomerConfiguration,
     )
+])
 
 
-@shared_task
-def transmit_single_learner_data(username, course_run_id):
+class IntegratedChannelCommandMixin:
     """
-    Task to send single learner data to each linked integrated channel.
-
-    Arguments:
-        username (str): The username of the learner whose data it should send.
-        course_run_id (str): The course run id of the course it should send data for.
+    Contains common functionality for the IntegratedChannel management commands.
     """
-    start = time.time()
-    user = User.objects.get(username=username)
-    LOGGER.info('[Integrated Channel] Single learner data transmission started.'
-                ' Course: {course_run}, Username: {username}'.format(
-                    course_run=course_run_id,
-                    username=username))
-    enterprise_customer = get_enterprise_customer_for_user(user)
-    channel_utils = IntegratedChannelCommandUtils()
-    # Transmit the learner data to each integrated channelStarting Export
-    for channel in channel_utils.get_integrated_channels(
-            {'channel': None, 'enterprise_customer': enterprise_customer.uuid}
-    ):
-        integrated_channel = INTEGRATED_CHANNEL_CHOICES[channel.channel_code()].objects.get(pk=channel.pk)
-        LOGGER.info(
-            '[Integrated Channel] Processing learner for transmission. Configuration: {configuration},'
-            ' User: {user_id}'.format(
-                configuration=integrated_channel,
-                user_id=user.id))
-        integrated_channel.transmit_single_learner_data(
-            learner_to_transmit=user,
-            course_run_id=course_run_id,
-            completed_date=timezone.now(),
-            grade='Pass',
-            is_passing=True
-        )
 
-    duration = time.time() - start
-    LOGGER.info(
-        '[Integrated Channel] Single learner data transmission task finished.'
-        ' Course: {course_run}, Duration: {duration}, Username: {username}'.format(
-            username=username,
-            course_run=course_run_id,
-            duration=duration))
+    def add_arguments(self, parser):
+        """
+        Adds the optional arguments: ``--enterprise_customer``, ``--channel``
+        """
+        parser.add_argument(
+            '--enterprise_customer',
+            dest='enterprise_customer',
+            default=None,
+            metavar='ENTERPRISE_CUSTOMER_UUID',
+            help=_('Transmit data for only this EnterpriseCustomer. '
+                   'Omit this option to transmit to all EnterpriseCustomers with active integrated channels.'),
+        )
+        parser.add_argument(
+            '--channel',
+            dest='channel',
+            default='',
+            metavar='INTEGRATED_CHANNEL',
+            help=_('Transmit data to this IntegrateChannel. '
+                   'Omit this option to transmit to all configured, active integrated channels.'),
+            choices=list(INTEGRATED_CHANNEL_CHOICES.keys()),
+        )
 
+    def get_integrated_channels(self, options):
+        """
+        Generates a list of active integrated channels for active customers, filtered from the given options.
+
+        Raises errors when invalid options are encountered.
+
+        Note: in order to retrieve in active configurations, the option `prevent_disabled_configurations` must be set to
+        false. For other available configurations, see ``add_arguments`` for all accepted options.
+        """
+        assessment_level_support = options.get('assessment_level_support', False)
+        content_metadata_job_support = options.get('content_metadata_job_support', False)
+        channel_classes = self.get_channel_classes(
+            options.get('channel'),
+            assessment_level_support=assessment_level_support,
+            content_metadata_job_support=content_metadata_job_support,
+        )
+        filter_kwargs = {
+            'enterprise_customer__active': True,
+        }
+        if options.get('prevent_disabled_configurations', True):
+            filter_kwargs['active'] = True
+
+        enterprise_customer = self.get_enterprise_customer(options.get('enterprise_customer'))
+
+        if enterprise_customer:
+            filter_kwargs['enterprise_customer'] = enterprise_customer
+
+        for channel_class in channel_classes:
+            yield from channel_class.objects.filter(**filter_kwargs)
+
+    @staticmethod
+    def get_enterprise_customer(uuid):
+        """
+        Returns the enterprise customer requested for the given uuid, None if not.
+
+        Raises CommandError if uuid is invalid.
+        """
+        if uuid is None:
+            return None
+        try:
+            return EnterpriseCustomer.active_customers.get(uuid=uuid)
+        except EnterpriseCustomer.DoesNotExist as no_customer_exception:
+            raise CommandError(
+                _('Enterprise customer {uuid} not found, or not active').format(uuid=uuid)
+            ) from no_customer_exception
+
+    @staticmethod
+    def get_channel_classes(channel_code, assessment_level_support=False, content_metadata_job_support=False):
+        """
+        Assemble a list of integrated channel classes to transmit to.
+
+        If a valid channel type was provided, use it.
+
+        Otherwise, use all the available channel types.
+        """
+        if assessment_level_support:
+            channel_choices = ASSESSMENT_LEVEL_REPORTING_INTEGRATED_CHANNEL_CHOICES
+        elif content_metadata_job_support:
+            channel_choices = CONTENT_METADATA_JOB_INTEGRATED_CHANNEL_CHOICES
+        else:
+            channel_choices = INTEGRATED_CHANNEL_CHOICES
+
+        if channel_code:
+            # Channel code is case-insensitive
+            channel_code = channel_code.upper()
+
+            if channel_code not in channel_choices:
+                raise CommandError(_('Invalid integrated channel: {channel}').format(channel=channel_code))
+
+            channel_classes = [channel_choices[channel_code]]
+        else:
+            channel_classes = list(channel_choices.values())
 
-@shared_task
-def unlink_inactive_learners(channel_code, channel_pk):
-    """
-    Task to unlink inactive learners of provided integrated channel.
+        return channel_classes
 
-    Arguments:
-        channel_code (str): Capitalized identifier for the integrated channel
-        channel_pk (str): Primary key for identifying integrated channel
 
+class IntegratedChannelCommandUtils(IntegratedChannelCommandMixin):
+    """
+    This is a wrapper class to avoid using mixin in methods
     """
-    start = time.time()
-    integrated_channel = INTEGRATED_CHANNEL_CHOICES[channel_code].objects.get(pk=channel_pk)
-    LOGGER.info('Processing learners to unlink inactive users using configuration: [%s]', integrated_channel)
-
-    # Note: learner data transmission code paths don't raise any uncaught exception, so we don't need a broad
-    # try-except block here.
-    integrated_channel.unlink_inactive_learners()
-
-    duration = time.time() - start
-    LOGGER.info(
-        'Unlink inactive learners task for integrated channel configuration [%s] took [%s] seconds',
-        integrated_channel,
-        duration
-    )
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/unlink_inactive_sap_learners.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/unlink_inactive_sap_learners.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Unlink inactive enterprise learners of SAP Success Factors from related EnterpriseCustomer(s).
 """
 
 from logging import getLogger
 
 from django.core.management.base import BaseCommand
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/transmit_learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/transmit_learner_data.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,19 +1,20 @@
-# -*- coding: utf-8 -*-
 """
 Transmits consenting enterprise learner data to the integrated channels.
 """
 
-from django.contrib.auth.models import User
+from django.contrib import auth
 from django.core.management.base import BaseCommand, CommandError
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
 from integrated_channels.integrated_channel.management.commands import IntegratedChannelCommandMixin
 from integrated_channels.integrated_channel.tasks import transmit_learner_data
 
+User = auth.get_user_model()
+
 
 class Command(IntegratedChannelCommandMixin, BaseCommand):
     """
     Management command which transmits learner course completion data to the IntegratedChannel(s) configured for the
     given EnterpriseCustomer.
 
     Collect the enterprise learner data for enrollments with data sharing consent, and transmit each to the
@@ -31,23 +32,27 @@
         parser.add_argument(
             '--api_user',
             dest='api_user',
             required=True,
             metavar='LMS_API_USERNAME',
             help=_('Username of a user authorized to fetch grades from the LMS API.'),
         )
-        super(Command, self).add_arguments(parser)
+        super().add_arguments(parser)
 
     def handle(self, *args, **options):
         """
         Transmit the learner data for the EnterpriseCustomer(s) to the active integration channels.
         """
         # Ensure that we were given an api_user name, and that User exists.
         api_username = options['api_user']
         try:
             User.objects.get(username=api_username)
-        except User.DoesNotExist:
-            raise CommandError(_('A user with the username {username} was not found.').format(username=api_username))
+        except User.DoesNotExist as no_user_error:
+            raise CommandError(
+                _('A user with the username {username} was not found.').format(username=api_username)
+            ) from no_user_error
 
         # Transmit the learner data to each integrated channel
         for integrated_channel in self.get_integrated_channels(options):
-            transmit_learner_data.delay(api_username, integrated_channel.channel_code(), integrated_channel.pk)
+            # NOTE pass arguments as named kwargs for use in lock key
+            transmit_learner_data.delay(
+                username=api_username, channel_code=integrated_channel.channel_code(), channel_pk=integrated_channel.pk)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/transmit_content_metadata.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/transmit_content_metadata.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,21 +1,21 @@
-# -*- coding: utf-8 -*-
 """
 Transmits information about an enterprise's course catalog to connected IntegratedChannels
 """
 
 from logging import getLogger
 
-from django.contrib.auth.models import User
+from django.contrib import auth
 from django.core.management.base import BaseCommand, CommandError
 
 from integrated_channels.integrated_channel.management.commands import IntegratedChannelCommandMixin
 from integrated_channels.integrated_channel.tasks import transmit_content_metadata
 
 LOGGER = getLogger(__name__)
+User = auth.get_user_model()
 
 
 class Command(IntegratedChannelCommandMixin, BaseCommand):
     """
     Transmit courseware data to the IntegratedChannel(s) linked to any or all EnterpriseCustomers.
     """
 
@@ -26,27 +26,29 @@
         parser.add_argument(
             '--catalog_user',
             dest='catalog_user',
             required=True,
             metavar='ENTERPRISE_CATALOG_API_USERNAME',
             help='Use this user to access the Course Catalog API.'
         )
-        super(Command, self).add_arguments(parser)
+        super().add_arguments(parser)
 
     def handle(self, *args, **options):
         """
         Transmit the courseware data for the EnterpriseCustomer(s) to the active integration channels.
         """
         username = options['catalog_user']
+        options['content_metadata_job_support'] = True
 
         # Before we do a whole bunch of database queries, make sure that the user we were passed exists.
         try:
             User.objects.get(username=username)
-        except User.DoesNotExist:
-            raise CommandError('A user with the username {} was not found.'.format(username))
+        except User.DoesNotExist as no_user_error:
+            raise CommandError('A user with the username {} was not found.'.format(username)) from no_user_error
 
         channels = self.get_integrated_channels(options)
 
         for channel in channels:
             channel_code = channel.channel_code()
             channel_pk = channel.pk
-            transmit_content_metadata.delay(username, channel_code, channel_pk)
+            # NOTE pass arguments as named kwargs for use in lock key
+            transmit_content_metadata.delay(username=username, channel_code=channel_code, channel_pk=channel_pk)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/management/commands/reset_sapsf_learner_transmissions.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/management/commands/reset_sapsf_learner_transmissions.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,16 +1,15 @@
-# -*- coding: utf-8 -*-
 """
 Reset SAPSF learner transmissions between two dates.
 """
 
 from django.apps import apps
 from django.core.management.base import BaseCommand
 from django.utils.dateparse import parse_datetime
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
 
 class Command(BaseCommand):
     """
     Management command which resets SAPSF learner course completion data between two dates.
     That would allow us to resend course completion data.
 
@@ -35,28 +34,28 @@
         parser.add_argument(
             '--end_datetime',
             dest='end_datetime',
             required=True,
             help=_('End date and time in YYYY-MM-DDTHH:MM:SSZ format.'),
         )
 
-        super(Command, self).add_arguments(parser)
+        super().add_arguments(parser)
 
     def handle(self, *args, **options):
         """
         Resets SAPSF learner course completion data between two dates.
         """
         start_datetime = parse_datetime(options['start_datetime'])
         end_datetime = parse_datetime(options['end_datetime'])
 
         if not start_datetime or not end_datetime:
             self.stdout.write(self.style.ERROR("FAILED: start or end dates times are not valid"))
             return
 
-        SapSuccessFactorsLearnerDataTransmissionAudit = apps.get_model(  # pylint: disable=invalid-name
+        SapSuccessFactorsLearnerDataTransmissionAudit = apps.get_model(
             'sap_success_factors',
             'SapSuccessFactorsLearnerDataTransmissionAudit'
         )
         enrollment_ids = SapSuccessFactorsLearnerDataTransmissionAudit.objects.filter(
             created__gte=start_datetime, created__lte=end_datetime
         ).values_list('enterprise_course_enrollment_id', flat=True)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/integrated_channel/client.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/client.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,12 +1,22 @@
-# -*- coding: utf-8 -*-
 """
 Base API client for integrated channels.
 """
 
+from enum import Enum
+
+
+class IntegratedChannelHealthStatus(Enum):
+    """
+    Health status list for Integrated Channels
+    """
+    HEALTHY = 'HEALTHY'
+    INVALID_CONFIG = 'INVALID_CONFIG'
+    CONNECTION_FAILURE = 'CONNECTION_FAILURE'
+
 
 class IntegratedChannelApiClient:
     """
     This is the interface to be implemented by API clients for integrated channels.
     """
 
     def __init__(self, enterprise_configuration):
@@ -56,7 +66,36 @@
         raise NotImplementedError()
 
     def delete_content_metadata(self, serialized_data):
         """
         Delete content metadata using the integrated channel's API.
         """
         raise NotImplementedError()
+
+    def create_assessment_reporting(self, user_id, payload):
+        """
+        Send a request to the integrated channel's grade API to update the assessment level reporting status for a user.
+        """
+        raise NotImplementedError()
+
+    def cleanup_duplicate_assignment_records(self, courses):
+        """
+        Delete duplicate assignments transmitted through the integrated channel's API.
+        """
+        raise NotImplementedError()
+
+    def health_check(self):
+        """Check integrated channel's config health
+
+        Returns: IntegratedChannelHealthStatus
+            HEALTHY if configuration is valid
+            INVALID_CONFIG if configuration is incomplete/invalid
+        """
+        is_valid = self.enterprise_configuration.is_valid
+        missing_fields = is_valid[0]
+        missing_ct = len(missing_fields['missing']) if 'missing' in missing_fields else 0
+        incorrect_fields = is_valid[1]
+        incorrect_ct = len(incorrect_fields['incorrect']) if 'incorrect' in incorrect_fields else 0
+        if missing_ct > 0 or incorrect_ct > 0:
+            return IntegratedChannelHealthStatus.INVALID_CONFIG
+        else:
+            return IntegratedChannelHealthStatus.HEALTHY
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/constants.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/constants.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Constants used by the SAPSuccessFactors integrated channel.
 """
 
 SUCCESSFACTORS_OCN_LANGUAGE_CODES = {
     "ms": {
         "_": "Malay"
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/transmitters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/transmitters/learner_data.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,62 +1,68 @@
-# -*- coding: utf-8 -*-
 """
 Class for transmitting learner data to SuccessFactors.
 """
 
 import logging
 
-import six
-
 from enterprise.models import EnterpriseCustomerUser
 from integrated_channels.integrated_channel.transmitters.learner_data import LearnerTransmitter
 from integrated_channels.sap_success_factors.client import SAPSuccessFactorsAPIClient
+from integrated_channels.utils import generate_formatted_log
 
 LOGGER = logging.getLogger(__name__)
 
 
 class SapSuccessFactorsLearnerTransmitter(LearnerTransmitter):
     """
     This endpoint is intended to receive learner data routed from the integrated_channel app that is ready to be
     sent to SuccessFactors.
     """
 
+    INCLUDE_GRADE_FOR_COMPLETION_AUDIT_CHECK = False
+
     def __init__(self, enterprise_configuration, client=SAPSuccessFactorsAPIClient):
         """
         By default, use the ``SAPSuccessFactorsAPIClient`` for learner data transmission to SAPSF.
         """
-        super(SapSuccessFactorsLearnerTransmitter, self).__init__(
+        super().__init__(
             enterprise_configuration=enterprise_configuration,
             client=client
         )
 
     def transmit(self, payload, **kwargs):
         """
         Send a completion status call to SAP SuccessFactors using the client.
 
         Args:
-            payload: The learner completion data payload to send to SAP SuccessFactors
+            payload: The learner data exporter for SAP SuccessFactors
         """
         kwargs['app_label'] = 'sap_success_factors'
         kwargs['model_name'] = 'SapSuccessFactorsLearnerDataTransmissionAudit'
         kwargs['remote_user_id'] = 'sapsf_user_id'
-        super(SapSuccessFactorsLearnerTransmitter, self).transmit(payload, **kwargs)
+        super().transmit(payload, **kwargs)
 
     def handle_transmission_error(self, learner_data, client_exception):
         """Handle the case where the employee on SAPSF's side is marked as inactive."""
         try:
-            sys_msg = six.text_type(client_exception.message)
+            sys_msg = str(client_exception.message)
+            ecu = EnterpriseCustomerUser.objects.get(
+                enterprise_enrollments__id=learner_data.enterprise_course_enrollment_id)
+
         except AttributeError:
             pass
         else:
             if sys_msg and 'user account is inactive' in sys_msg:
-                ecu = EnterpriseCustomerUser.objects.get(
-                    enterprise_enrollments__id=learner_data.enterprise_course_enrollment_id)
                 ecu.active = False
                 ecu.save()
                 LOGGER.warning(
-                    'User %s with ID %s and email %s is a former employee of %s '
-                    'and has been marked inactive in SAPSF. Now marking inactive internally.',
-                    ecu.username, ecu.user_id, ecu.user_email, ecu.enterprise_customer
+                    generate_formatted_log(
+                        self.enterprise_configuration.channel_code(),
+                        ecu.enterprise_customer.uuid,
+                        ecu.user_id,
+                        None,
+                        f'User with LMS ID {ecu.user_id}, ECU ID {ecu.id} is a '
+                        f'former employee of {ecu.enterprise_customer} '
+                        'and has been marked inactive in SAPSF. Now marking inactive internally.'
+                    )
                 )
                 return
-        super(SapSuccessFactorsLearnerTransmitter, self).handle_transmission_error(learner_data, client_exception)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/exporters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/blackboard/exporters/learner_data.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,169 +1,128 @@
-# -*- coding: utf-8 -*-
 """
-Learner data exporter for Enterprise Integrated Channel SAP SuccessFactors.
+Learner data exporter for Enterprise Integrated Channel Blackboard.
 """
 
 from logging import getLogger
 
-from requests import RequestException
-
 from django.apps import apps
 
-from enterprise.api_client.discovery import get_course_catalog_api_service_client
-from enterprise.models import EnterpriseCustomerUser, PendingEnterpriseCustomerUser
-from enterprise.tpa_pipeline import get_user_from_social_auth
-from enterprise.utils import get_identity_provider
-from integrated_channels.exceptions import ClientError
+from integrated_channels.catalog_service_utils import get_course_id_for_enrollment
 from integrated_channels.integrated_channel.exporters.learner_data import LearnerExporter
-from integrated_channels.sap_success_factors.client import SAPSuccessFactorsAPIClient
-from integrated_channels.utils import parse_datetime_to_epoch_millis
+from integrated_channels.utils import generate_formatted_log, parse_datetime_to_epoch_millis
 
 LOGGER = getLogger(__name__)
 
 
-class SapSuccessFactorsLearnerExporter(LearnerExporter):
+class BlackboardLearnerExporter(LearnerExporter):
     """
-    Class to provide a SAPSF learner data transmission audit prepared for serialization.
+    Class to provide a Blackboard learner data transmission audit prepared for serialization.
     """
 
     def get_learner_data_records(
             self,
             enterprise_enrollment,
             completed_date=None,
-            grade=None,
-            is_passing=False,
-            grade_percent=None
-    ):
+            course_completed=False,
+            **kwargs
+    ):  # pylint: disable=arguments-differ
         """
-        Return a SapSuccessFactorsLearnerDataTransmissionAudit with the given enrollment and course completion data.
-
-        If completed_date is None and the learner isn't passing, then course completion has not been met.
-
+        Return a BlackboardLearnerDataTransmissionAudit with the given enrollment and course completion data.
         If no remote ID can be found, return None.
         """
-        completed_timestamp = None
-        course_completed = False
+        enterprise_customer_user = enterprise_enrollment.enterprise_customer_user
+        if enterprise_customer_user.user_email is None:
+            LOGGER.debug(generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                enterprise_customer_user.enterprise_customer.uuid,
+                enterprise_customer_user.user_id,
+                None,
+                ('get_learner_data_records finished. No learner data was sent for this LMS User Id because '
+                 'Blackboard User ID not found for [{name}]'.format(
+                     name=enterprise_customer_user.enterprise_customer.name
+                 ))))
+            return None
+        percent_grade = kwargs.get('grade_percent', None)
+        blackboard_completed_timestamp = None
         if completed_date is not None:
-            completed_timestamp = parse_datetime_to_epoch_millis(completed_date)
-            course_completed = is_passing
-
-        sapsf_user_id = enterprise_enrollment.enterprise_customer_user.get_remote_id()
+            blackboard_completed_timestamp = parse_datetime_to_epoch_millis(completed_date)
 
-        if sapsf_user_id is not None:
-            SapSuccessFactorsLearnerDataTransmissionAudit = apps.get_model(  # pylint: disable=invalid-name
-                'sap_success_factors',
-                'SapSuccessFactorsLearnerDataTransmissionAudit'
-            )
-            # We return two records here, one with the course key and one with the course run id, to account for
-            # uncertainty about the type of content (course vs. course run) that was sent to the integrated channel.
-            course_catalog_client = get_course_catalog_api_service_client(
-                site=enterprise_enrollment.enterprise_customer_user.enterprise_customer.site
-            )
-            course_run = course_catalog_client.get_course_run(enterprise_enrollment.course_id)
-            total_hours = 0.0
-            if course_run and self.enterprise_configuration.transmit_total_hours:
-                total_hours = course_run.get("estimated_hours", 0.0)
-            return [
-                SapSuccessFactorsLearnerDataTransmissionAudit(
-                    enterprise_course_enrollment_id=enterprise_enrollment.id,
-                    sapsf_user_id=sapsf_user_id,
-                    course_id=course_catalog_client.get_course_id(enterprise_enrollment.course_id),
-                    course_completed=course_completed,
-                    completed_timestamp=completed_timestamp,
-                    grade=grade,
-                    total_hours=total_hours,
-                ),
-                SapSuccessFactorsLearnerDataTransmissionAudit(
-                    enterprise_course_enrollment_id=enterprise_enrollment.id,
-                    sapsf_user_id=sapsf_user_id,
-                    course_id=enterprise_enrollment.course_id,
-                    course_completed=course_completed,
-                    completed_timestamp=completed_timestamp,
-                    grade=grade,
-                    total_hours=total_hours,
-                ),
-            ]
-        LOGGER.debug(
-            '[Integrated Channel] No learner data was sent for user [%s] because an SAP SuccessFactors user ID'
-            ' could not be found.',
-            enterprise_enrollment.enterprise_customer_user.username
+        BlackboardLearnerDataTransmissionAudit = apps.get_model(
+            'blackboard',
+            'BlackboardLearnerDataTransmissionAudit'
         )
-        return None
-
-
-class SapSuccessFactorsLearnerManger:
-    """
-    Class to manage SAPSF learners data and their relation with enterprise.
-    """
-
-    def __init__(self, enterprise_configuration, client=SAPSuccessFactorsAPIClient):
-        """
-        Use the ``SAPSuccessFactorsAPIClient`` for content metadata transmission to SAPSF.
 
-        Arguments:
-            enterprise_configuration (required): SAPSF configuration connecting an enterprise to an integrated channel.
-            client: The REST API client that will fetch data from integrated channel.
-        """
-        self.enterprise_configuration = enterprise_configuration
-        self.client = client(enterprise_configuration) if client else None
-
-    def unlink_learners(self):
-        """
-        Iterate over each learner and unlink inactive SAP channel learners.
+        return [
+            BlackboardLearnerDataTransmissionAudit(
+                enterprise_course_enrollment_id=enterprise_enrollment.id,
+                blackboard_user_email=enterprise_customer_user.user_email,
+                user_email=enterprise_customer_user.user_email,
+                course_id=get_course_id_for_enrollment(enterprise_enrollment),
+                course_completed=course_completed,
+                grade=percent_grade,
+                completed_timestamp=completed_date,
+                blackboard_completed_timestamp=blackboard_completed_timestamp,
+                enterprise_customer_uuid=enterprise_customer_user.enterprise_customer.uuid,
+                plugin_configuration_id=self.enterprise_configuration.id,
+            )
+        ]
 
-        This method iterates over each enterprise learner and unlink learner
-        from the enterprise if the learner is marked inactive in the related
-        integrated channel.
+    def get_learner_assessment_data_records(
+            self,
+            enterprise_enrollment,
+            assessment_grade_data,
+    ):
         """
-        try:
-            sap_inactive_learners = self.client.get_inactive_sap_learners()
-        except RequestException as exc:
-            raise ClientError(
-                'SAPSuccessFactorsAPIClient request failed: {error} {message}'.format(
-                    error=exc.__class__.__name__,
-                    message=str(exc)
-                )
-            )
-        total_sap_inactive_learners = len(sap_inactive_learners) if sap_inactive_learners else 0
-        enterprise_customer = self.enterprise_configuration.enterprise_customer
-        LOGGER.info(
-            'Found [%d] SAP inactive learners for enterprise customer [%s]',
-            total_sap_inactive_learners, enterprise_customer.name
-        )
-        if not sap_inactive_learners:
+        Return a blackboardLearnerDataTransmissionAudit with the given enrollment and assessment level data.
+        If there is no subsection grade then something has gone horribly wrong and it is recommended to look at the
+        return value of platform's gradebook view.
+        If no remote ID (enterprise user's email) can be found, return None as that is used to match the learner with
+        their blackboard account.
+
+        Parameters:
+        -----------
+            enterprise_enrollment (EnterpriseCourseEnrollment object):  Django model containing the enterprise
+                customer, course ID, and enrollment source.
+            assessment_grade_data (Dict): learner data retrieved from platform's gradebook api.
+        """
+        if enterprise_enrollment.enterprise_customer_user.user_email is None:
+            # We need an email to find the user on blackboard.
+            LOGGER.debug(generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                enterprise_enrollment.enterprise_customer_user.enterprise_customer.uuid,
+                enterprise_enrollment.enterprise_customer_user.user_id,
+                enterprise_enrollment.course_id,
+                ('get_learner_assessment_data_records finished. No learner data was sent for this LMS User Id because'
+                 ' Blackboard User ID not found for [{name}]'.format(
+                     name=enterprise_enrollment.enterprise_customer_user.enterprise_customer.name
+                 ))))
             return None
 
-        provider_id = enterprise_customer.identity_provider
-        tpa_provider = get_identity_provider(provider_id)
-        if not tpa_provider:
-            LOGGER.info(
-                'Enterprise customer [%s] has no associated identity provider',
-                enterprise_customer.name
-            )
-            return None
+        BlackboardLearnerAssessmentDataTransmissionAudit = apps.get_model(
+            'blackboard',
+            'BlackboardLearnerAssessmentDataTransmissionAudit'
+        )
 
-        for sap_inactive_learner in sap_inactive_learners:
-            sap_student_id = sap_inactive_learner['studentID']
-            social_auth_user = get_user_from_social_auth(tpa_provider, sap_student_id)
-            if not social_auth_user:
-                LOGGER.info(
-                    'No social auth data found for inactive user with SAP student id [%s] of enterprise '
-                    'customer [%s] with identity provider [%s]',
-                    sap_student_id, enterprise_customer.name, tpa_provider.provider_id
-                )
+        user_subsection_audits = []
+        # Create an audit for each of the subsections exported.
+        for subsection_name, subsection_data in assessment_grade_data.items():
+            subsection_percent_grade = subsection_data.get('grade')
+            subsection_id = subsection_data.get('subsection_id')
+            # Sanity check for a grade to report
+            if not subsection_percent_grade or not subsection_id:
                 continue
 
-            try:
-                # Unlink user email from related Enterprise Customer
-                EnterpriseCustomerUser.objects.unlink_user(
-                    enterprise_customer=enterprise_customer,
-                    user_email=social_auth_user.email,
-                )
-            except (EnterpriseCustomerUser.DoesNotExist, PendingEnterpriseCustomerUser.DoesNotExist):
-                LOGGER.info(
-                    'Learner with email [%s] and SAP student id [%s] is not linked with enterprise [%s]',
-                    social_auth_user.email,
-                    sap_student_id,
-                    enterprise_customer.name
-                )
-        return None
+            transmission_audit = BlackboardLearnerAssessmentDataTransmissionAudit(
+                plugin_configuration_id=self.enterprise_configuration.id,
+                enterprise_customer_uuid=self.enterprise_configuration.enterprise_customer.uuid,
+                enterprise_course_enrollment_id=enterprise_enrollment.id,
+                blackboard_user_email=enterprise_enrollment.enterprise_customer_user.user_email,
+                course_id=get_course_id_for_enrollment(enterprise_enrollment),
+                subsection_id=subsection_id,
+                grade=subsection_percent_grade,
+                grade_point_score=subsection_data.get('grade_point_score'),
+                grade_points_possible=subsection_data.get('grade_points_possible'),
+                subsection_name=subsection_name
+            )
+            user_subsection_audits.append(transmission_audit)
+
+        return user_subsection_audits
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/exporters/utils.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/exporters/utils.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Utility functions for the SAP SuccessFactors integrated channel.
 """
 
 from logging import getLogger
 
 from integrated_channels.sap_success_factors.constants import SUCCESSFACTORS_OCN_LANGUAGE_CODES
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/exporters/content_metadata.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/exporters/content_metadata.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,33 +1,39 @@
-# -*- coding: utf-8 -*-
 """
 Content metadata exporter for SAP SuccessFactors.
 """
 
 from logging import getLogger
 
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
-from enterprise.api_client.lms import parse_lms_api_datetime
-from enterprise.utils import get_closest_course_run, is_course_run_available_for_enrollment
+from enterprise.constants import IC_DELETE_ACTION
+from enterprise.utils import (
+    get_advertised_course_run,
+    get_closest_course_run,
+    get_duration_of_course_or_courserun,
+    is_course_run_active,
+    is_course_run_available_for_enrollment,
+    parse_lms_api_datetime,
+)
 from enterprise.views import CourseEnrollmentView
 from integrated_channels.integrated_channel.exporters.content_metadata import ContentMetadataExporter
 from integrated_channels.sap_success_factors.exporters.utils import transform_language_code
 from integrated_channels.utils import (
     UNIX_MAX_DATE_STRING,
     UNIX_MIN_DATE_STRING,
     current_time_is_in_interval,
     get_image_url,
     parse_datetime_to_epoch_millis,
 )
 
 LOGGER = getLogger(__name__)
 
 
-class SapSuccessFactorsContentMetadataExporter(ContentMetadataExporter):  # pylint: disable=abstract-method
+class SapSuccessFactorsContentMetadataExporter(ContentMetadataExporter):
     """
     SAP SuccessFactors implementation of ContentMetadataExporter.
     """
 
     DATA_TRANSFORM_MAPPING = {
         'courseID': 'key',
         'providerID': 'provider_id',
@@ -43,19 +49,23 @@
 
     def transform_provider_id(self, content_metadata_item):  # pylint: disable=unused-argument
         """
         Return the provider ID from the integrated channel configuration.
         """
         return self.enterprise_configuration.provider_id
 
-    def transform_status(self, content_metadata_item):  # pylint: disable=unused-argument
+    def transform_for_action_status(self, _content_metadata_item, action):
         """
         Return the status of the content item.
         """
-        return 'ACTIVE'
+        # lets not overwrite something we've already tried to set INACTIVE
+        if action == IC_DELETE_ACTION:
+            return 'INACTIVE'
+        else:
+            return 'ACTIVE'
 
     def transform_title(self, content_metadata_item):
         """
         Return the title of the content item.
         """
         title_with_locales = []
 
@@ -75,25 +85,29 @@
 
         description = (
             content_metadata_item.get('full_description') or
             content_metadata_item.get('short_description') or
             content_metadata_item.get('title', '')
         )
 
-        course_runs = content_metadata_item.get('course_runs')
-        if course_runs:
-            closest_course_run = get_closest_course_run(course_runs)
+        course_run = get_advertised_course_run(content_metadata_item)
+
+        if not course_run:
+            course_runs = content_metadata_item.get('course_runs')
+            if course_runs:
+                course_run = get_closest_course_run(course_runs)
 
+        if course_run:
             # Include the course run start and end dates
-            date_str = self._get_course_run_start_end_str(closest_course_run)
+            date_str = self._get_course_run_start_end_str(course_run)
             if date_str:
                 description = date_str + description
 
             # Include the course pacing
-            course_pacing = CourseEnrollmentView.PACING_FORMAT.get(closest_course_run['pacing_type'], '')
+            course_pacing = CourseEnrollmentView.PACING_FORMAT.get(course_run['pacing_type'], '')
             if course_pacing:
                 pacing_desc = 'Pacing: {pacing_type}. '.format(
                     pacing_type=course_pacing
                 )
                 description = pacing_desc + description
 
         for locale in self.enterprise_configuration.get_locales():
@@ -119,41 +133,59 @@
         launch into from SAPSF. Currently, we only provide a single launch
         point for a content item.
         """
         return [{
             'providerID': self.enterprise_configuration.provider_id,
             'launchURL': content_metadata_item['enrollment_url'],
             'contentTitle': content_metadata_item['title'],
-            'contentID': self.get_content_id(content_metadata_item),
+            'contentID': self._get_content_id(content_metadata_item),
             'launchType': 3,  # This tells SAPSF to launch the course in a new browser window.
             'mobileEnabled': True,  # Always return True per ENT-1401
             'mobileLaunchURL': content_metadata_item['enrollment_url'],
         }]
 
     def transform_revision_number(self, content_metadata_item):  # pylint: disable=unused-argument
         """
         Return the revision number.
         """
         return 1
 
-    def transform_schedule(self, content_metadata_item):  # pylint: disable=unused-argument
+    def transform_schedule(self, content_metadata_item):
         """
         Return the schedule of the content item.
         """
-        return []
+        duration, start, end = get_duration_of_course_or_courserun(content_metadata_item)
+
+        # SAP will throw errors if we try to send an empty start or end date
+        if (not start or not end):
+            return []
+
+        return [{
+            'startDate': parse_datetime_to_epoch_millis(start) if start else '',
+            'endDate': parse_datetime_to_epoch_millis(end) if end else '',
+            'active': current_time_is_in_interval(start, end) if start else False,
+            'duration': f"{duration} days",
+        }]
 
     def transform_price(self, content_metadata_item):
         """
         Return the current course run's price.
         """
         price = 0.0
+
         if self.enterprise_configuration.show_course_price:
-            for course_run in content_metadata_item.get('course_runs', []):
-                if course_run['availability'] == 'Current':
-                    price = course_run.get('first_enrollable_paid_seat_price', 0.0) or 0.0
+            advertised_course_run = get_advertised_course_run(content_metadata_item)
+            if advertised_course_run and 'first_enrollable_paid_seat_price' in advertised_course_run:
+                price = advertised_course_run.get('first_enrollable_paid_seat_price') or 0.0
+            else:
+                for course_run in content_metadata_item.get('course_runs', []):
+                    if 'first_enrollable_paid_seat_price' in course_run and is_course_run_active(course_run):
+                        price = course_run.get('first_enrollable_paid_seat_price') or 0.0
+                        break
+
         return [
             {
                 "currency": "USD",
                 "value": price
             }
         ]
 
@@ -182,45 +214,14 @@
             title_with_locales.append({
                 'locale': locale,
                 'value': title
             })
 
         return title_with_locales
 
-    def _get_course_run_start_end_str(self, course_run):
-        """
-        Get the course run start and end as a descriptive string. Also include a note if enrollment is closed.
-        """
-        course_run_start = course_run.get('start')
-        course_run_end = course_run.get('end')
-        date_str = ''
-
-        if course_run_start:
-            date_str += '{starts}: {:%B %Y}'.format(
-                parse_lms_api_datetime(course_run_start),
-                starts=_('Starts')
-            )
-
-        if course_run_end:
-            if date_str:
-                date_str += ', '
-
-            date_str += '{ends}: {:%B %Y}. '.format(
-                parse_lms_api_datetime(course_run_end),
-                ends=_('Ends')
-            )
-        else:
-            if date_str:
-                date_str += '. '
-
-        if not is_course_run_available_for_enrollment(course_run):
-            date_str += 'Enrollment is closed. '
-
-        return date_str
-
     def transform_courserun_description(self, content_metadata_item):
         """
         Return the description of the courserun content item.
         """
         description_with_locales = []
         content_metadata_language_code = transform_language_code(content_metadata_item.get('content_language', ''))
         for locale in self.enterprise_configuration.get_locales(default_locale=content_metadata_language_code):
@@ -250,15 +251,46 @@
 
     def transform_program_key(self, content_metadata_item):
         """
         Return the identifier of the program content item.
         """
         return content_metadata_item['uuid']
 
-    def get_content_id(self, content_metadata_item):
+    def _get_content_id(self, content_metadata_item):
         """
         Return the id for the given content_metadata_item, `uuid` for programs or `key` for other content
         """
         content_id = content_metadata_item.get('key', '')
         if content_metadata_item['content_type'] == 'program':
             content_id = content_metadata_item.get('uuid', '')
         return content_id
+
+    def _get_course_run_start_end_str(self, course_run):
+        """
+        Get the course run start and end as a descriptive string. Also include a note if enrollment is closed.
+        """
+        course_run_start = course_run.get('start')
+        course_run_end = course_run.get('end')
+        date_str = ''
+
+        if course_run_start:
+            date_str += '{starts}: {:%B %Y}'.format(
+                parse_lms_api_datetime(course_run_start),
+                starts=_('Starts')
+            )
+
+        if course_run_end:
+            if date_str:
+                date_str += ', '
+
+            date_str += '{ends}: {:%B %Y}. '.format(
+                parse_lms_api_datetime(course_run_end),
+                ends=_('Ends')
+            )
+        else:
+            if date_str:
+                date_str += '. '
+
+        if not is_course_run_available_for_enrollment(course_run):
+            date_str += 'Enrollment is closed. '
+
+        return date_str
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0012_auto_20180109_0712.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0017_auto_20220302_2231.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.12 on 2022-03-02 22:31
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0011_auto_20180104_0103'),
+        ('canvas', '0016_auto_20220131_1539'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='historicalsapsuccessfactorsenterprisecustomerconfiguration',
-            name='active',
-            field=models.BooleanField(help_text='Is this configuration active?'),
+            model_name='canvasenterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=255),
         ),
         migrations.AlterField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='active',
-            field=models.BooleanField(help_text='Is this configuration active?'),
+            model_name='historicalcanvasenterprisecustomerconfiguration',
+            name='display_name',
+            field=models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=255),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0001_squashed_0022_auto_20200206_1046.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0001_squashed_0022_auto_20200206_1046_squashed_0011_alter_sapsuccessfactorslearnerdatatransmissionaudit_enterprise_course_enrollment_id.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,96 +1,79 @@
-# Generated by Django 2.2.12 on 2020-04-21 18:57
+# Generated by Django 3.2.11 on 2022-02-10 15:46
 
-import django.utils.timezone
 from django.conf import settings
 from django.db import migrations, models
-
+import django.db.models.deletion
+import django.utils.timezone
 import model_utils.fields
 
 
 class Migration(migrations.Migration):
 
-    replaces = [('sap_success_factors', '0001_initial'), ('sap_success_factors', '0002_auto_20170224_1545'), ('sap_success_factors', '0003_auto_20170317_1402'), ('sap_success_factors', '0004_catalogtransmissionaudit_audit_summary'), ('sap_success_factors', '0005_historicalsapsuccessfactorsenterprisecustomerconfiguration_history_change_reason'), ('sap_success_factors', '0006_sapsuccessfactors_use_enterprise_enrollment_page_waffle_flag'), ('sap_success_factors', '0007_remove_historicalsapsuccessfactorsenterprisecustomerconfiguration_history_change_reason'), ('sap_success_factors', '0008_historicalsapsuccessfactorsenterprisecustomerconfiguration_history_change_reason'), ('sap_success_factors', '0009_sapsuccessfactors_remove_enterprise_enrollment_page_waffle_flag'), ('sap_success_factors', '0010_move_audit_tables_to_base_integrated_channel'), ('sap_success_factors', '0011_auto_20180104_0103'), ('sap_success_factors', '0012_auto_20180109_0712'), ('sap_success_factors', '0013_auto_20180306_1251'), ('sap_success_factors', '0014_drop_historical_table'), ('sap_success_factors', '0015_auto_20180510_1259'), ('sap_success_factors', '0016_sapsuccessfactorsenterprisecustomerconfiguration_additional_locales'), ('sap_success_factors', '0017_sapsuccessfactorsglobalconfiguration_search_student_api_path'), ('sap_success_factors', '0018_sapsuccessfactorsenterprisecustomerconfiguration_show_course_price'), ('sap_success_factors', '0019_auto_20190925_0730'), ('sap_success_factors', '0020_sapsuccessfactorsenterprisecustomerconfiguration_catalogs_to_transmit'), ('sap_success_factors', '0021_sapsuccessfactorsenterprisecustomerconfiguration_show_total_hours'), ('sap_success_factors', '0022_auto_20200206_1046')]
-
-    initial = True
+    replaces = [('sap_success_factors', '0001_squashed_0022_auto_20200206_1046'), ('sap_success_factors', '0002_sapsuccessfactorslearnerdatatransmissionaudit_credit_hours'), ('sap_success_factors', '0003_auto_20210701_1556'), ('sap_success_factors', '0004_auto_20210708_1639'), ('sap_success_factors', '0005_sapsuccessfactorsenterprisecustomerconfiguration_prevent_learner_self_submit_grades'), ('sap_success_factors', '0006_sapsuccessfactorsenterprisecustomerconfiguration_idp_id'), ('sap_success_factors', '0007_sapsuccessfactorsenterprisecustomerconfiguration_disable_learner_data_transmissions'), ('sap_success_factors', '0008_alter_sapsuccessfactorsenterprisecustomerconfiguration_enterprise_customer'), ('sap_success_factors', '0009_auto_20220126_1837'), ('sap_success_factors', '0010_sapsuccessfactorsenterprisecustomerconfiguration_display_name'), ('sap_success_factors', '0011_alter_sapsuccessfactorslearnerdatatransmissionaudit_enterprise_course_enrollment_id')]
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
         ('enterprise', '0094_add_use_enterprise_catalog_sample'),
+        ('enterprise', '0151_add_is_active_to_invite_key'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='SapSuccessFactorsLearnerDataTransmissionAudit',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('sapsf_user_id', models.CharField(max_length=255)),
-                ('enterprise_course_enrollment_id', models.PositiveIntegerField(db_index=True)),
-                ('course_id', models.CharField(max_length=255)),
-                ('course_completed', models.BooleanField(default=True)),
-                ('instructor_name', models.CharField(blank=True, max_length=255)),
-                ('grade', models.CharField(max_length=100)),
-                ('total_hours', models.FloatField(blank=True, null=True)),
-                ('completed_timestamp', models.BigIntegerField()),
-                ('status', models.CharField(max_length=100)),
-                ('error_message', models.TextField(blank=True)),
-                ('created', models.DateTimeField(auto_now_add=True)),
-            ],
-        ),
-        migrations.CreateModel(
             name='SAPSuccessFactorsGlobalConfiguration',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('change_date', models.DateTimeField(auto_now_add=True, verbose_name='Change date')),
                 ('enabled', models.BooleanField(default=False, verbose_name='Enabled')),
                 ('completion_status_api_path', models.CharField(max_length=255)),
                 ('course_api_path', models.CharField(max_length=255)),
                 ('oauth_api_path', models.CharField(max_length=255)),
                 ('search_student_api_path', models.CharField(max_length=255)),
                 ('provider_id', models.CharField(default='EDX', max_length=100)),
-                ('changed_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.PROTECT,
-                                                 to=settings.AUTH_USER_MODEL, verbose_name='Changed by')),
+                ('changed_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL, verbose_name='Changed by')),
             ],
         ),
         migrations.CreateModel(
             name='SAPSuccessFactorsEnterpriseCustomerConfiguration',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False,
-                                                                verbose_name='created')),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False,
-                                                                      verbose_name='modified')),
+                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
+                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
                 ('active', models.BooleanField(help_text='Is this configuration active?')),
-                ('transmission_chunk_size', models.IntegerField(default=500,
-                                                                help_text='The maximum number of data items to transmit to the integrated channel with each request.')),
-                ('channel_worker_username', models.CharField(blank=True,
-                                                             help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.',
-                                                             max_length=255, null=True)),
-                ('catalogs_to_transmit',
-                 models.TextField(blank=True, help_text='A comma-separated list of catalog UUIDs to transmit.',
-                                  null=True)),
-                ('key',
-                 models.CharField(help_text='OAuth client identifier.', max_length=255, verbose_name='Client ID')),
-                ('sapsf_base_url', models.CharField(help_text='Base URL of success factors API.', max_length=255,
-                                                    verbose_name='SAP Base URL')),
-                ('sapsf_company_id', models.CharField(help_text='Success factors company identifier.', max_length=255,
-                                                      verbose_name='SAP Company ID')),
-                ('sapsf_user_id', models.CharField(help_text='Success factors user identifier.', max_length=255,
-                                                   verbose_name='SAP User ID')),
-                ('secret',
-                 models.CharField(help_text='OAuth client secret.', max_length=255, verbose_name='Client Secret')),
-                ('user_type', models.CharField(choices=[('user', 'User'), ('admin', 'Admin')], default='user',
-                                               help_text='Type of SAP User (admin or user).', max_length=20,
-                                               verbose_name='SAP User Type')),
-                ('additional_locales',
-                 models.TextField(blank=True, default='', help_text='A comma-separated list of additional locales.',
-                                  verbose_name='Additional Locales')),
+                ('transmission_chunk_size', models.IntegerField(default=1, help_text='The maximum number of data items to transmit to the integrated channel with each request.')),
+                ('channel_worker_username', models.CharField(blank=True, default='', help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255)),
+                ('catalogs_to_transmit', models.TextField(blank=True, default='', help_text='A comma-separated list of catalog UUIDs to transmit. If blank, all customer catalogs will be transmitted. If there are overlapping courses in the customer catalogs, the overlapping course metadata will be selected from the newest catalog.')),
+                ('key', models.CharField(blank=True, default='', help_text='OAuth client identifier.', max_length=255, verbose_name='Client ID')),
+                ('sapsf_base_url', models.CharField(blank=True, default='', help_text='Base URL of success factors API.', max_length=255, verbose_name='SAP Base URL')),
+                ('sapsf_company_id', models.CharField(blank=True, default='', help_text='Success factors company identifier.', max_length=255, verbose_name='SAP Company ID')),
+                ('sapsf_user_id', models.CharField(blank=True, default='', help_text='Success factors user identifier.', max_length=255, verbose_name='SAP User ID')),
+                ('secret', models.CharField(blank=True, default='', help_text='OAuth client secret.', max_length=255, verbose_name='Client Secret')),
+                ('user_type', models.CharField(choices=[('user', 'User'), ('admin', 'Admin')], default='user', help_text='Type of SAP User (admin or user).', max_length=20, verbose_name='SAP User Type')),
+                ('additional_locales', models.TextField(blank=True, default='', help_text='A comma-separated list of additional locales.', verbose_name='Additional Locales')),
                 ('show_course_price', models.BooleanField(default=False)),
-                ('transmit_total_hours',
-                 models.BooleanField(default=False, help_text='Include totalHours in the transmitted completion data',
-                                     verbose_name='Transmit Total Hours')),
-                ('enterprise_customer',
-                 models.OneToOneField(help_text='Enterprise Customer associated with the configuration.',
-                                      on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomer')),
+                ('transmit_total_hours', models.BooleanField(default=False, help_text='Include totalHours in the transmitted completion data', verbose_name='Transmit Total Hours')),
+                ('enterprise_customer', models.ForeignKey(help_text='Enterprise Customer associated with the configuration.', on_delete=django.db.models.deletion.CASCADE, to='enterprise.enterprisecustomer')),
+                ('prevent_self_submit_grades', models.BooleanField(default=False, help_text="When set to True, the integration will use the generic edX service user ('sapsf_user_id') defined in the SAP Customer Configuration for course completion.", verbose_name='Prevent Learner From Self-Submitting Grades')),
+                ('idp_id', models.CharField(blank=True, default='', help_text='If provided, will be used as IDP slug to locate remote id for learners', max_length=255)),
+                ('disable_learner_data_transmissions', models.BooleanField(default=False, help_text='When set to True, the configured customer will no longer receive learner data transmissions, both scheduled and signal based', verbose_name='Disable Learner Data Transmission')),
+                ('display_name', models.CharField(blank=True, default='', help_text='A configuration nickname.', max_length=30)),
+            ],
+        ),
+        migrations.CreateModel(
+            name='SapSuccessFactorsLearnerDataTransmissionAudit',
+            fields=[
+                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
+                ('sapsf_user_id', models.CharField(max_length=255)),
+                ('enterprise_course_enrollment_id', models.IntegerField(db_index=True)),
+                ('course_id', models.CharField(max_length=255)),
+                ('course_completed', models.BooleanField(default=True)),
+                ('instructor_name', models.CharField(blank=True, max_length=255)),
+                ('grade', models.CharField(max_length=100)),
+                ('total_hours', models.FloatField(blank=True, null=True)),
+                ('completed_timestamp', models.BigIntegerField()),
+                ('status', models.CharField(max_length=100)),
+                ('error_message', models.TextField(blank=True)),
+                ('created', models.DateTimeField(auto_now_add=True)),
+                ('credit_hours', models.FloatField(blank=True, null=True)),
             ],
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0015_auto_20180510_1259.py` & `edx-enterprise-4.0.0/enterprise/migrations/0166_auto_20221209_0819.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,25 +1,27 @@
-# -*- coding: utf-8 -*-
+# Generated by Django 3.2.16 on 2022-12-09 08:19
 
-
-from django.db import migrations, models
+from django.db import migrations
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0014_drop_historical_table'),
+        ('enterprise', '0165_alter_enterprisecustomerreportingconfiguration_pgp_encryption_key'),
     ]
 
     operations = [
         migrations.RemoveField(
-            model_name='historicalsapsuccessfactorsenterprisecustomerconfiguration',
-            name='enterprise_customer',
+            model_name='historicalenterpriseanalyticsuser',
+            name='enterprise_customer_user',
         ),
         migrations.RemoveField(
-            model_name='historicalsapsuccessfactorsenterprisecustomerconfiguration',
+            model_name='historicalenterpriseanalyticsuser',
             name='history_user',
         ),
         migrations.DeleteModel(
-            name='HistoricalSAPSuccessFactorsEnterpriseCustomerConfiguration',
+            name='EnterpriseAnalyticsUser',
+        ),
+        migrations.DeleteModel(
+            name='HistoricalEnterpriseAnalyticsUser',
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0005_historicalsapsuccessfactorsenterprisecustomerconfiguration_history_change_reason.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0004_auto_20201105_1921.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,20 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.10.7 on 2017-06-25 04:16
-
+# Generated by Django 2.2.16 on 2020-11-05 19:21
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0004_catalogtransmissionaudit_audit_summary'),
+        ('moodle', '0003_auto_20201006_1706'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='historicalsapsuccessfactorsenterprisecustomerconfiguration',
-            name='history_change_reason',
-            field=models.CharField(max_length=100, null=True),
+        migrations.AlterField(
+            model_name='historicalmoodleenterprisecustomerconfiguration',
+            name='transmission_chunk_size',
+            field=models.IntegerField(default=1, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
+        ),
+        migrations.AlterField(
+            model_name='moodleenterprisecustomerconfiguration',
+            name='transmission_chunk_size',
+            field=models.IntegerField(default=1, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0017_sapsuccessfactorsglobalconfiguration_search_student_api_path.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0017_alter_degreedlearnerdatatransmissionaudit_completed_timestamp.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,21 +1,18 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.15 on 2018-11-27 07:46
-
+# Generated by Django 3.2.12 on 2022-03-23 17:17
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0016_sapsuccessfactorsenterprisecustomerconfiguration_additional_locales'),
+        ('degreed', '0016_auto_20220302_2231'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='sapsuccessfactorsglobalconfiguration',
-            name='search_student_api_path',
-            field=models.CharField(default='learning/odatav4/searchStudent/v1/Students', max_length=255),
-            preserve_default=False,
+        migrations.AlterField(
+            model_name='degreedlearnerdatatransmissionaudit',
+            name='completed_timestamp',
+            field=models.CharField(blank=True, help_text='Represents the Degreed representation of a timestamp: yyyy-mm-dd, which is always 10 characters.', max_length=10, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0001_initial.py` & `edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0004_auto_20220126_1837.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,99 +1,83 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.9.12 on 2017-02-24 15:08
+# Generated by Django 3.2.11 on 2022-01-26 18:37
 
-
-import django.db.models.deletion
-import django.utils.timezone
-from django.conf import settings
 from django.db import migrations, models
 
-import model_utils.fields
-
 
 class Migration(migrations.Migration):
 
-    initial = True
-
     dependencies = [
-        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('enterprise', '0015_auto_20170130_0003'),
+        ('degreed2', '0003_alter_degreed2enterprisecustomerconfiguration_enterprise_customer'),
     ]
 
     operations = [
-        migrations.CreateModel(
-            name='CatalogTransmissionAudit',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('start', models.DateTimeField(blank=True, null=True, verbose_name='start')),
-                ('end', models.DateTimeField(blank=True, null=True, verbose_name='end')),
-                ('enterprise_customer_uuid', models.UUIDField()),
-                ('total_courses', models.PositiveIntegerField()),
-                ('status', models.CharField(max_length=100)),
-                ('error_message', models.TextField(blank=True)),
-            ],
-        ),
-        migrations.CreateModel(
-            name='HistoricalSAPSuccessFactorsEnterpriseCustomerConfiguration',
-            fields=[
-                ('id', models.IntegerField(auto_created=True, blank=True, db_index=True, verbose_name='ID')),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('active', models.BooleanField()),
-                ('sapsf_base_url', models.CharField(max_length=255)),
-                ('key', models.CharField(blank=True, max_length=255, verbose_name='Client ID')),
-                ('secret', models.CharField(blank=True, max_length=255, verbose_name='Client Secret')),
-                ('history_id', models.AutoField(primary_key=True, serialize=False)),
-                ('history_date', models.DateTimeField()),
-                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
-                ('enterprise_customer', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='enterprise.EnterpriseCustomer')),
-                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
-            ],
-            options={
-                'ordering': ('-history_date', '-history_id'),
-                'get_latest_by': 'history_date',
-                'verbose_name': 'historical sap success factors enterprise customer configuration',
-            },
-        ),
-        migrations.CreateModel(
-            name='LearnerDataTransmissionAudit',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('enterprise_course_enrollment_id', models.PositiveIntegerField()),
-                ('sapsf_user_id', models.CharField(max_length=255)),
-                ('course_id', models.CharField(max_length=255)),
-                ('course_completed', models.BooleanField(default=True)),
-                ('completed_timestamp', models.BigIntegerField()),
-                ('instructor_name', models.CharField(blank=True, max_length=255)),
-                ('grade', models.CharField(max_length=100)),
-                ('status', models.CharField(max_length=100)),
-                ('error_message', models.TextField(blank=True)),
-                ('created', models.DateTimeField(auto_now_add=True)),
-            ],
-        ),
-        migrations.CreateModel(
-            name='SAPSuccessFactorsEnterpriseCustomerConfiguration',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('created', model_utils.fields.AutoCreatedField(default=django.utils.timezone.now, editable=False, verbose_name='created')),
-                ('modified', model_utils.fields.AutoLastModifiedField(default=django.utils.timezone.now, editable=False, verbose_name='modified')),
-                ('active', models.BooleanField()),
-                ('sapsf_base_url', models.CharField(max_length=255)),
-                ('key', models.CharField(blank=True, max_length=255, verbose_name='Client ID')),
-                ('secret', models.CharField(blank=True, max_length=255, verbose_name='Client Secret')),
-                ('enterprise_customer', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to='enterprise.EnterpriseCustomer')),
-            ],
-        ),
-        migrations.CreateModel(
-            name='SAPSuccessFactorsGlobalConfiguration',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('change_date', models.DateTimeField(auto_now_add=True, verbose_name='Change date')),
-                ('enabled', models.BooleanField(default=False, verbose_name='Enabled')),
-                ('completion_status_api_path', models.CharField(max_length=255)),
-                ('course_api_path', models.CharField(max_length=255)),
-                ('oauth_api_path', models.CharField(max_length=255)),
-                ('provider_id', models.CharField(default='EDX', max_length=100)),
-                ('changed_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL, verbose_name='Changed by')),
-            ],
+        migrations.AlterField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='catalogs_to_transmit',
+            field=models.TextField(blank=True, default='', help_text='A comma-separated list of catalog UUIDs to transmit. If blank, all customer catalogs will be transmitted. If there are overlapping courses in the customer catalogs, the overlapping course metadata will be selected from the newest catalog.'),
+        ),
+        migrations.AlterField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='channel_worker_username',
+            field=models.CharField(blank=True, default='', help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255),
+        ),
+        migrations.AlterField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='client_id',
+            field=models.CharField(blank=True, default='', help_text='The API Client ID provided to edX by the enterprise customer to be used to make API calls to Degreed on behalf of the customer.', max_length=255, verbose_name='API Client ID'),
+        ),
+        migrations.AlterField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='client_secret',
+            field=models.CharField(blank=True, default='', help_text='The API Client Secret provided to edX by the enterprise customer to be used to make API calls to Degreed on behalf of the customer.', max_length=255, verbose_name='API Client Secret'),
+        ),
+        migrations.AlterField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='degreed_base_url',
+            field=models.CharField(blank=True, default='', help_text='The base URL used for API requests to Degreed, i.e. https://degreed.com.', max_length=255, verbose_name='Degreed Base URL'),
+        ),
+        migrations.AlterField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='degreed_token_fetch_base_url',
+            field=models.CharField(blank=True, default='', help_text='If provided, will be used as base url instead of degreed_base_url to fetch tokens', max_length=255, verbose_name='Degreed token fetch base url'),
+        ),
+        migrations.AlterField(
+            model_name='degreed2enterprisecustomerconfiguration',
+            name='idp_id',
+            field=models.CharField(blank=True, default='', help_text='If provided, will be used as IDP slug to locate remote id for learners', max_length=255),
+        ),
+        migrations.AlterField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='catalogs_to_transmit',
+            field=models.TextField(blank=True, default='', help_text='A comma-separated list of catalog UUIDs to transmit. If blank, all customer catalogs will be transmitted. If there are overlapping courses in the customer catalogs, the overlapping course metadata will be selected from the newest catalog.'),
+        ),
+        migrations.AlterField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='channel_worker_username',
+            field=models.CharField(blank=True, default='', help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255),
+        ),
+        migrations.AlterField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='client_id',
+            field=models.CharField(blank=True, default='', help_text='The API Client ID provided to edX by the enterprise customer to be used to make API calls to Degreed on behalf of the customer.', max_length=255, verbose_name='API Client ID'),
+        ),
+        migrations.AlterField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='client_secret',
+            field=models.CharField(blank=True, default='', help_text='The API Client Secret provided to edX by the enterprise customer to be used to make API calls to Degreed on behalf of the customer.', max_length=255, verbose_name='API Client Secret'),
+        ),
+        migrations.AlterField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='degreed_base_url',
+            field=models.CharField(blank=True, default='', help_text='The base URL used for API requests to Degreed, i.e. https://degreed.com.', max_length=255, verbose_name='Degreed Base URL'),
+        ),
+        migrations.AlterField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='degreed_token_fetch_base_url',
+            field=models.CharField(blank=True, default='', help_text='If provided, will be used as base url instead of degreed_base_url to fetch tokens', max_length=255, verbose_name='Degreed token fetch base url'),
+        ),
+        migrations.AlterField(
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
+            name='idp_id',
+            field=models.CharField(blank=True, default='', help_text='If provided, will be used as IDP slug to locate remote id for learners', max_length=255),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0016_sapsuccessfactorsenterprisecustomerconfiguration_additional_locales.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0026_genericenterprisecustomerpluginconfiguration_last_modified_at.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,19 +1,18 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 3.2.16 on 2023-01-12 20:02
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0015_auto_20180510_1259'),
+        ('integrated_channel', '0025_auto_20230105_2122'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='additional_locales',
-            field=models.TextField(default='', help_text='A comma-separated list of additional locales.', verbose_name='Additional Locales', blank=True),
+            model_name='genericenterprisecustomerpluginconfiguration',
+            name='last_modified_at',
+            field=models.DateTimeField(auto_now=True, help_text='The DateTime of the last change made to this configuration.', null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0002_auto_20170224_1545.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0012_auto_20230105_2122.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,45 +1,43 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.9.12 on 2017-02-24 15:45
-
+# Generated by Django 3.2.15 on 2023-01-05 21:22
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0001_initial'),
+        ('sap_success_factors', '0011_alter_sapsuccessfactorslearnerdatatransmissionaudit_index_together'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='historicalsapsuccessfactorsenterprisecustomerconfiguration',
-            name='sapsf_company_id',
-            field=models.CharField(blank=True, max_length=255, verbose_name='SAP Company ID'),
+            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
+            name='last_content_sync_attempted_at',
+            field=models.DateTimeField(blank=True, help_text='The DateTime of the most recent Content data record sync attempt', null=True),
         ),
         migrations.AddField(
-            model_name='historicalsapsuccessfactorsenterprisecustomerconfiguration',
-            name='sapsf_user_id',
-            field=models.CharField(blank=True, max_length=255, verbose_name='SAP User ID'),
+            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
+            name='last_content_sync_errored_at',
+            field=models.DateTimeField(blank=True, help_text='The DateTime of the most recent failure of a Content data record sync attempt', null=True),
         ),
         migrations.AddField(
             model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='sapsf_company_id',
-            field=models.CharField(blank=True, max_length=255, verbose_name='SAP Company ID'),
+            name='last_learner_sync_attempted_at',
+            field=models.DateTimeField(blank=True, help_text='The DateTime of the most recent Learner data record sync attempt', null=True),
         ),
         migrations.AddField(
             model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='sapsf_user_id',
-            field=models.CharField(blank=True, max_length=255, verbose_name='SAP User ID'),
+            name='last_learner_sync_errored_at',
+            field=models.DateTimeField(blank=True, help_text='The DateTime of the most recent failure of a Learner data record sync attempt', null=True),
         ),
-        migrations.AlterField(
-            model_name='historicalsapsuccessfactorsenterprisecustomerconfiguration',
-            name='sapsf_base_url',
-            field=models.CharField(max_length=255, verbose_name='SAP Base URL'),
+        migrations.AddField(
+            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
+            name='last_sync_attempted_at',
+            field=models.DateTimeField(blank=True, help_text='The DateTime of the most recent Content or Learner data record sync attempt', null=True),
         ),
-        migrations.AlterField(
+        migrations.AddField(
             model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='sapsf_base_url',
-            field=models.CharField(max_length=255, verbose_name='SAP Base URL'),
+            name='last_sync_errored_at',
+            field=models.DateTimeField(blank=True, help_text='The DateTime of the most recent failure of a Content or Learner data record sync attempt', null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0019_auto_20190925_0730.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0015_auto_20220127_1605.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,25 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.23 on 2019-09-25 07:30
-
+# Generated by Django 3.2.11 on 2022-01-27 16:05
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0018_sapsuccessfactorsenterprisecustomerconfiguration_show_course_price'),
+        ('canvas', '0014_auto_20220126_1837'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='channel_worker_username',
-            field=models.CharField(blank=True, help_text='Enterprise channel worker username to get JWT tokens for authenticating LMS APIs.', max_length=255, null=True),
+        migrations.AlterField(
+            model_name='canvasenterprisecustomerconfiguration',
+            name='canvas_account_id',
+            field=models.BigIntegerField(blank=True, help_text='Account number to use during api calls. Called account_id in canvas.  Required to create courses etc.', null=True, verbose_name='Canvas Account Number'),
         ),
         migrations.AlterField(
-            model_name='sapsuccessfactorslearnerdatatransmissionaudit',
-            name='enterprise_course_enrollment_id',
-            field=models.PositiveIntegerField(db_index=True),
+            model_name='historicalcanvasenterprisecustomerconfiguration',
+            name='canvas_account_id',
+            field=models.BigIntegerField(blank=True, help_text='Account number to use during api calls. Called account_id in canvas.  Required to create courses etc.', null=True, verbose_name='Canvas Account Number'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0020_sapsuccessfactorsenterprisecustomerconfiguration_catalogs_to_transmit.py` & `edx-enterprise-4.0.0/integrated_channels/integrated_channel/migrations/0014_genericenterprisecustomerpluginconfiguration_dry_run_mode_enabled.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,20 +1,18 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.23 on 2019-10-01 07:42
-
+# Generated by Django 3.2.12 on 2022-05-23 16:25
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0019_auto_20190925_0730'),
+        ('integrated_channel', '0013_auto_20220405_2311'),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='catalogs_to_transmit',
-            field=models.TextField(blank=True, help_text='A comma-separated list of catalog UUIDs to transmit.', null=True),
+            model_name='genericenterprisecustomerpluginconfiguration',
+            name='dry_run_mode_enabled',
+            field=models.BooleanField(default=False, help_text='Is this configuration in dry-run mode? (experimental)'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0021_sapsuccessfactorsenterprisecustomerconfiguration_show_total_hours.py` & `edx-enterprise-4.0.0/enterprise/migrations/0117_auto_20201215_0258.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,20 +1,19 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.27 on 2020-01-21 13:41
-
+# Generated by Django 2.2.17 on 2020-12-15 08:58
 
 from django.db import migrations, models
+import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0020_sapsuccessfactorsenterprisecustomerconfiguration_catalogs_to_transmit'),
+        ('enterprise', '0116_auto_20201208_1759'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='show_total_hours',
-            field=models.BooleanField(default=False, verbose_name='Show Total Hours'),
+        migrations.AlterField(
+            model_name='enterprisecustomeridentityprovider',
+            name='enterprise_customer',
+            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enterprise_customer_identity_providers', to='enterprise.EnterpriseCustomer'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0013_auto_20180306_1251.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0003_auto_20201006_1706.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# -*- coding: utf-8 -*-
-
+# Generated by Django 2.2.16 on 2020-10-06 17:06
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0012_auto_20180109_0712'),
+        ('moodle', '0002_moodlelearnerdatatransmissionaudit'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='historicalsapsuccessfactorsenterprisecustomerconfiguration',
+        migrations.AlterField(
+            model_name='historicalmoodleenterprisecustomerconfiguration',
             name='transmission_chunk_size',
-            field=models.IntegerField(default=500, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
+            field=models.IntegerField(default=4, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
         ),
-        migrations.AddField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
+        migrations.AlterField(
+            model_name='moodleenterprisecustomerconfiguration',
             name='transmission_chunk_size',
-            field=models.IntegerField(default=500, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
+            field=models.IntegerField(default=4, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0018_sapsuccessfactorsenterprisecustomerconfiguration_show_course_price.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0005_auto_20200909_1534.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,20 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.20 on 2019-07-02 13:09
-
+# Generated by Django 2.2.15 on 2020-09-09 15:34
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0017_sapsuccessfactorsglobalconfiguration_search_student_api_path'),
+        ('canvas', '0004_adding_learner_data_to_canvas'),
     ]
 
     operations = [
-        migrations.AddField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='show_course_price',
-            field=models.BooleanField(default=False),
+        migrations.AlterField(
+            model_name='canvaslearnerdatatransmissionaudit',
+            name='completed_timestamp',
+            field=models.CharField(help_text='Represents the canvas representation of a timestamp: yyyy-mm-dd, which is always 10 characters.', max_length=10),
+        ),
+        migrations.AlterField(
+            model_name='canvaslearnerdatatransmissionaudit',
+            name='course_completed',
+            field=models.BooleanField(default=False, help_text="The learner's course completion status transmitted to Canvas."),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/migrations/0022_auto_20200206_1046.py` & `edx-enterprise-4.0.0/integrated_channels/sap_success_factors/migrations/0010_move_and_recrete_completed_timestamp.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,29 +1,23 @@
-# -*- coding: utf-8 -*-
-# Generated by Django 1.11.27 on 2020-02-06 16:46
-
+# Generated by Django 3.2.15 on 2022-10-31 18:55
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('sap_success_factors', '0021_sapsuccessfactorsenterprisecustomerconfiguration_show_total_hours'),
+        ('sap_success_factors', '0009_sapsuccessfactorsenterprisecustomerconfiguration_deleted_at'),
     ]
 
     operations = [
-        migrations.RemoveField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='show_total_hours',
-        ),
-        migrations.AddField(
-            model_name='sapsuccessfactorsenterprisecustomerconfiguration',
-            name='transmit_total_hours',
-            field=models.BooleanField(default=False, help_text='Include totalHours in the transmitted completion data', verbose_name='Transmit Total Hours'),
+        migrations.RenameField(
+            model_name='sapsuccessfactorslearnerdatatransmissionaudit',
+            old_name='completed_timestamp',
+            new_name='sap_completed_timestamp',
         ),
         migrations.AddField(
             model_name='sapsuccessfactorslearnerdatatransmissionaudit',
-            name='total_hours',
-            field=models.FloatField(blank=True, null=True),
+            name='completed_timestamp',
+            field=models.DateTimeField(blank=True, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/sap_success_factors/models.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/models.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,296 +1,235 @@
-# -*- coding: utf-8 -*-
 """
-Database models for Enterprise Integrated Channel SAP SuccessFactors.
+Database models for Enterprise Integrated Channel Moodle.
 """
 
 import json
 from logging import getLogger
 
-from config_models.models import ConfigurationModel
+from simple_history.models import HistoricalRecords
 
 from django.db import models
-from django.utils.encoding import python_2_unicode_compatible
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
-from integrated_channels.exceptions import ClientError
-from integrated_channels.integrated_channel.models import EnterpriseCustomerPluginConfiguration
-from integrated_channels.sap_success_factors.exporters.content_metadata import SapSuccessFactorsContentMetadataExporter
-from integrated_channels.sap_success_factors.exporters.learner_data import (
-    SapSuccessFactorsLearnerExporter,
-    SapSuccessFactorsLearnerManger,
+from integrated_channels.integrated_channel.models import (
+    EnterpriseCustomerPluginConfiguration,
+    LearnerDataTransmissionAudit,
 )
-from integrated_channels.sap_success_factors.transmitters.content_metadata import (
-    SapSuccessFactorsContentMetadataTransmitter,
-)
-from integrated_channels.sap_success_factors.transmitters.learner_data import SapSuccessFactorsLearnerTransmitter
-from integrated_channels.utils import convert_comma_separated_string_to_list
+from integrated_channels.moodle.exporters.content_metadata import MoodleContentMetadataExporter
+from integrated_channels.moodle.exporters.learner_data import MoodleLearnerExporter
+from integrated_channels.moodle.transmitters.content_metadata import MoodleContentMetadataTransmitter
+from integrated_channels.moodle.transmitters.learner_data import MoodleLearnerTransmitter
+from integrated_channels.utils import is_valid_url
 
 LOGGER = getLogger(__name__)
 
 
-# pylint: disable=feature-toggle-needs-doc
-@python_2_unicode_compatible
-class SAPSuccessFactorsGlobalConfiguration(ConfigurationModel):
-    """
-    The global configuration for integrating with SuccessFactors.
-
-    .. no_pii:
-    """
-
-    completion_status_api_path = models.CharField(max_length=255)
-    course_api_path = models.CharField(max_length=255)
-    oauth_api_path = models.CharField(max_length=255)
-    search_student_api_path = models.CharField(max_length=255)
-    provider_id = models.CharField(max_length=100, default='EDX')
-
-    class Meta:
-        app_label = 'sap_success_factors'
-
-    def __str__(self):
-        """
-        Return a human-readable string representation of the object.
-        """
-        return "<SAPSuccessFactorsGlobalConfiguration with id {id}>".format(id=self.id)
-
-    def __repr__(self):
-        """
-        Return uniquely identifying string representation.
-        """
-        return self.__str__()
-
-
-@python_2_unicode_compatible
-class SAPSuccessFactorsEnterpriseCustomerConfiguration(EnterpriseCustomerPluginConfiguration):
+class MoodleEnterpriseCustomerConfiguration(EnterpriseCustomerPluginConfiguration):
     """
-    The Enterprise-specific configuration we need for integrating with SuccessFactors.
+    The Enterprise-specific configuration we need for integrating with Moodle.
 
     .. no_pii:
     """
 
-    USER_TYPE_USER = 'user'
-    USER_TYPE_ADMIN = 'admin'
-
-    USER_TYPE_CHOICES = (
-        (USER_TYPE_USER, 'User'),
-        (USER_TYPE_ADMIN, 'Admin'),
-    )
-
-    key = models.CharField(
+    moodle_base_url = models.CharField(
         max_length=255,
-        verbose_name="Client ID",
-        help_text=_("OAuth client identifier.")
+        blank=True,
+        verbose_name="Moodle Base URL",
+        help_text=_("The base URL used for API requests to Moodle")
     )
-    sapsf_base_url = models.CharField(
+
+    service_short_name = models.CharField(
         max_length=255,
-        verbose_name="SAP Base URL",
-        help_text=_("Base URL of success factors API.")
+        blank=True,
+        verbose_name="Webservice Short Name",
+        help_text=_(
+            "The short name for the Moodle webservice."
+        )
     )
-    sapsf_company_id = models.CharField(
-        max_length=255, verbose_name="SAP Company ID", help_text=_("Success factors company identifier.")
+
+    category_id = models.IntegerField(
+        blank=True,
+        null=True,
+        verbose_name="Category ID",
+        help_text=_(
+            "The category ID for what edX courses should be associated with."
+        )
     )
-    sapsf_user_id = models.CharField(
+
+    username = models.CharField(
         max_length=255,
-        verbose_name="SAP User ID",
-        help_text=_("Success factors user identifier.")
+        verbose_name="Webservice Username",
+        blank=True,
+        help_text=_(
+            "The API user's username used to obtain new tokens."
+        )
     )
-    secret = models.CharField(
+
+    password = models.CharField(
         max_length=255,
-        verbose_name="Client Secret",
-        help_text=_("OAuth client secret.")
-    )
-    user_type = models.CharField(
-        max_length=20,
-        choices=USER_TYPE_CHOICES,
-        default=USER_TYPE_USER,
-        verbose_name="SAP User Type",
-        help_text=_("Type of SAP User (admin or user).")
+        blank=True,
+        verbose_name="Webservice Password",
+        help_text=_(
+            "The API user's password used to obtain new tokens."
+        )
     )
-    additional_locales = models.TextField(
+
+    token = models.CharField(
+        max_length=255,
         blank=True,
-        default='',
-        verbose_name="Additional Locales",
-        help_text=_("A comma-separated list of additional locales.")
+        verbose_name="Webservice User Token",
+        help_text=_(
+            "The user's token for the Moodle webservice."
+        )
     )
-    show_course_price = models.BooleanField(default=False)
-    transmit_total_hours = models.BooleanField(
-        default=False,
-        verbose_name=_("Transmit Total Hours"),
-        help_text=_("Include totalHours in the transmitted completion data")
+
+    transmission_chunk_size = models.IntegerField(
+        default=1,
+        help_text=_("The maximum number of data items to transmit to the integrated channel with each request.")
     )
 
-    def get_locales(self, default_locale=None):
-        """
-        Get the list of all(default + additional) locales
+    grade_scale = models.IntegerField(
+        default=100,
+        verbose_name="Grade Scale",
+        help_text=_("The maximum grade points for the courses. Default: 100")
+    )
 
-        Args:
-            default_locale (str): Value of the default locale
+    grade_assignment_name = models.CharField(
+        default="(edX integration) Final Grade",
+        max_length=255,
+        verbose_name="Grade Assignment Name",
+        help_text=_(
+            "The name for the grade assigment created for the grade integration."
+        )
+    )
 
-        Returns:
-            list: available locales
-        """
-        locales = []
+    history = HistoricalRecords()
 
-        if default_locale is None:
-            locales.append('English')
-        else:
-            locales.append(default_locale)
+    class Meta:
+        app_label = 'moodle'
 
-        return set(
-            locales + convert_comma_separated_string_to_list(self.additional_locales)
-        )
+    @property
+    def is_valid(self):
+        """
+        Returns whether or not the configuration is valid and ready to be activated
 
-    class Meta:
-        app_label = 'sap_success_factors'
+        Args:
+            obj: The instance of MoodleEnterpriseCustomerConfiguration
+                being rendered with this admin form.
+        """
+        missing_items = {'missing': []}
+        incorrect_items = {'incorrect': []}
+        if not self.moodle_base_url:
+            missing_items.get('missing').append('moodle_base_url')
+        if not self.token and not (self.username and self.password):
+            missing_items.get('missing').append('token OR username and password')
+        if not self.service_short_name:
+            missing_items.get('missing').append('service_short_name')
+        if not is_valid_url(self.moodle_base_url):
+            incorrect_items.get('incorrect').append('moodle_base_url')
+        if len(self.display_name) > 20:
+            incorrect_items.get('incorrect').append('display_name')
+        return missing_items, incorrect_items
 
     def __str__(self):
         """
         Return human-readable string representation.
         """
-        return "<SAPSuccessFactorsEnterpriseCustomerConfiguration for Enterprise {enterprise_name}>".format(
+        return "<MoodleEnterpriseCustomerConfiguration for Enterprise {enterprise_name}>".format(
             enterprise_name=self.enterprise_customer.name
         )
 
     def __repr__(self):
         """
         Return uniquely identifying string representation.
         """
         return self.__str__()
 
     @staticmethod
     def channel_code():
         """
         Returns an capitalized identifier for this channel class, unique among subclasses.
         """
-        return 'SAP'
-
-    @property
-    def provider_id(self):
-        '''
-        Fetch ``provider_id`` from global configuration settings
-        '''
-        return SAPSuccessFactorsGlobalConfiguration.current().provider_id
-
-    def get_learner_data_transmitter(self):
-        """
-        Return a ``SapSuccessFactorsLearnerTransmitter`` instance.
-        """
-        return SapSuccessFactorsLearnerTransmitter(self)
+        return 'MOODLE'
 
     def get_learner_data_exporter(self, user):
-        """
-        Return a ``SapSuccessFactorsLearnerDataExporter`` instance.
-        """
-        return SapSuccessFactorsLearnerExporter(user, self)
+        return MoodleLearnerExporter(user, self)
 
-    def get_content_metadata_transmitter(self):
-        """
-        Return a ``SapSuccessFactorsContentMetadataTransmitter`` instance.
-        """
-        return SapSuccessFactorsContentMetadataTransmitter(self)
+    def get_learner_data_transmitter(self):
+        return MoodleLearnerTransmitter(self)
 
     def get_content_metadata_exporter(self, user):
-        """
-        Return a ``SapSuccessFactorsContentMetadataExporter`` instance.
-        """
-        return SapSuccessFactorsContentMetadataExporter(user, self)
+        return MoodleContentMetadataExporter(user, self)
 
-    def get_learner_manger(self):
-        """
-        Return a ``SapSuccessFactorsLearnerManger`` instance.
-        """
-        return SapSuccessFactorsLearnerManger(self)
-
-    def unlink_inactive_learners(self):
-        """
-        Unlink inactive SAP learners form their related enterprises
-        """
-        sap_learner_manager = self.get_learner_manger()
-        try:
-            sap_learner_manager.unlink_learners()
-        except ClientError as exc:
-            LOGGER.exception(
-                'Failed to unlink learners for integrated channel [%s] [%s] \nError: [%s]',
-                self.enterprise_customer.name,
-                self.channel_code(),
-                str(exc)
-            )
+    def get_content_metadata_transmitter(self):
+        return MoodleContentMetadataTransmitter(self)
 
 
-@python_2_unicode_compatible
-class SapSuccessFactorsLearnerDataTransmissionAudit(models.Model):
+class MoodleLearnerDataTransmissionAudit(LearnerDataTransmissionAudit):
     """
-    The payload we sent to SuccessFactors at a given point in time for an enterprise course enrollment.
+    The payload we send to Moodle at a given point in time for an enterprise course enrollment.
 
-    .. no_pii:
     """
+    moodle_user_email = models.EmailField(
+        max_length=255,
+        blank=False,
+        null=False,
+        help_text='The learner`s Moodle email. This must match the email on edX'
+    )
 
-    sapsf_user_id = models.CharField(max_length=255, blank=False, null=False)
-    enterprise_course_enrollment_id = models.PositiveIntegerField(blank=False, null=False, db_index=True)
-    course_id = models.CharField(max_length=255, blank=False, null=False)
-    course_completed = models.BooleanField(default=True)
-    instructor_name = models.CharField(max_length=255, blank=True)
-    grade = models.CharField(max_length=100, blank=False, null=False)
-    total_hours = models.FloatField(null=True, blank=True)
-
-    # We send a UNIX timestamp to SAPSF.
-    completed_timestamp = models.BigIntegerField()
-
-    # Request-related information.
-    status = models.CharField(max_length=100, blank=False, null=False)
-    error_message = models.TextField(blank=True)
-    created = models.DateTimeField(auto_now_add=True)
+    moodle_completed_timestamp = models.CharField(
+        null=True,
+        blank=True,
+        max_length=10,
+        help_text=(
+            'Represents the Moodle representation of a timestamp: yyyy-mm-dd, '
+            'which is always 10 characters. Can be left unset for audit transmissions.'
+        )
+    )
 
     class Meta:
-        app_label = 'sap_success_factors'
+        app_label = 'moodle'
+        index_together = ['enterprise_customer_uuid', 'plugin_configuration_id']
 
     def __str__(self):
         """
         Return a human-readable string representation of the object.
         """
         return (
-            '<SapSuccessFactorsLearnerDataTransmissionAudit {transmission_id} for enterprise enrollment '
-            '{enterprise_course_enrollment_id}, SAPSF user {sapsf_user_id}, and course {course_id}>'.format(
+            '<MoodleLearnerDataTransmissionAudit {transmission_id} for enterprise enrollment '
+            '{enterprise_course_enrollment_id}, Moodle user {moodle_user_email}, and course {course_id}>'.format(
                 transmission_id=self.id,
                 enterprise_course_enrollment_id=self.enterprise_course_enrollment_id,
-                sapsf_user_id=self.sapsf_user_id,
+                moodle_user_email=self.moodle_user_email,
                 course_id=self.course_id
             )
         )
 
     def __repr__(self):
         """
         Return uniquely identifying string representation.
         """
         return self.__str__()
 
-    @property
-    def provider_id(self):
-        """
-        Fetch ``provider_id`` from global configuration settings
-        """
-        return SAPSuccessFactorsGlobalConfiguration.current().provider_id
-
-    def serialize(self, *args, **kwargs):  # pylint: disable=unused-argument
+    def serialize(self, *args, **kwargs):
         """
         Return a JSON-serialized representation.
 
         Sort the keys so the result is consistent and testable.
 
         # TODO: When we refactor to use a serialization flow consistent with how course metadata
         # is serialized, remove the serialization here and make the learner data exporter handle the work.
         """
         return json.dumps(self._payload_data(), sort_keys=True)
 
     def _payload_data(self):
         """
-        Convert the audit record's fields into SAP SuccessFactors key/value pairs.
+        Convert the audit record's fields into Moodle key/value pairs.
         """
-        return dict(
-            userID=self.sapsf_user_id,
-            courseID=self.course_id,
-            providerID=self.provider_id,
-            courseCompleted="true" if self.course_completed else "false",
-            completedTimestamp=self.completed_timestamp,
-            grade=self.grade,
-            totalHours=self.total_hours,
-        )
+        return {
+            'userID': self.moodle_user_email,
+            'courseID': self.course_id,
+            'courseCompleted': 'true' if self.course_completed else 'false',
+            'completedTimestamp': self.moodle_completed_timestamp,
+            'grade': self.grade,
+            'totalHours': self.total_hours,
+        }
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/transmitters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/transmitters/learner_data.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Class for transmitting learner data to Canvas.
 """
 
 from integrated_channels.canvas.client import CanvasAPIClient
 from integrated_channels.integrated_channel.transmitters.learner_data import LearnerTransmitter
 
@@ -13,23 +12,47 @@
     sent to Canvas.
     """
 
     def __init__(self, enterprise_configuration, client=CanvasAPIClient):
         """
         By default, use the ``CanvasAPIClient`` for learner data transmission to Canvas.
         """
-        super(CanvasLearnerTransmitter, self).__init__(
+        super().__init__(
             enterprise_configuration=enterprise_configuration,
             client=client
         )
 
     def transmit(self, payload, **kwargs):
         """
         Send a completion status call to Canvas using the client.
 
         Args:
-            payload: The learner completion data payload to send to Canvas
+            payload: The learner exporter for Canvas
         """
         kwargs['app_label'] = 'canvas'
         kwargs['model_name'] = 'CanvasLearnerDataTransmissionAudit'
         kwargs['remote_user_id'] = 'canvas_user_email'
-        super(CanvasLearnerTransmitter, self).transmit(payload, **kwargs)
+        super().transmit(payload, **kwargs)
+
+    def single_learner_assessment_grade_transmit(self, exporter, **kwargs):
+        """
+        Send an assessment level grade update status call for a single enterprise learner to Canvas using the client.
+
+        Args:
+            payload: The learner completion data payload to send to Canvas
+        """
+        kwargs['app_label'] = 'canvas'
+        kwargs['model_name'] = 'CanvasLearnerAssessmentDataTransmissionAudit'
+        kwargs['remote_user_id'] = 'canvas_user_email'
+        super().single_learner_assessment_grade_transmit(exporter, **kwargs)
+
+    def assessment_level_transmit(self, exporter, **kwargs):
+        """
+        Send a bulk assessment level grade update status call to Canvas using the client.
+
+        Args:
+            payload: The learner completion data payload to send to Canvas
+        """
+        kwargs['app_label'] = 'canvas'
+        kwargs['model_name'] = 'CanvasLearnerAssessmentDataTransmissionAudit'
+        kwargs['remote_user_id'] = 'canvas_user_email'
+        super().assessment_level_transmit(exporter, **kwargs)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/transmitters/content_metadata.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/transmitters/content_metadata.py`

 * *Files 9% similar despite different names*

```diff
@@ -11,15 +11,15 @@
     This transmitter transmits exported content metadata to Canvas.
     """
 
     def __init__(self, enterprise_configuration, client=CanvasAPIClient):
         """
         Use the ``CanvasAPIClient`` for content metadata transmission to Canvas.
         """
-        super(CanvasContentMetadataTransmitter, self).__init__(
+        super().__init__(
             enterprise_configuration=enterprise_configuration,
             client=client
         )
 
     def _prepare_items_for_transmission(self, channel_metadata_items):
         # here is a hack right now to send only one item
         # we have to investigate how to handle multiple
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/exporters/content_metadata.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/exporters/content_metadata.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,71 +1,116 @@
 """
-Content metadata exporter for Canvas
+Content metadata exporter for Moodle
 """
-
+from datetime import timezone
 from logging import getLogger
 
+from dateutil.parser import parse
+
 from integrated_channels.integrated_channel.exporters.content_metadata import ContentMetadataExporter
 
 LOGGER = getLogger(__name__)
 
 
-class CanvasContentMetadataExporter(ContentMetadataExporter):
+class MoodleContentMetadataExporter(ContentMetadataExporter):
     """
-        Canvas implementation of ContentMetadataExporter.
+        Moodle implementation of ContentMetadataExporter.
     """
     DATA_TRANSFORM_MAPPING = {
-        'name': 'title',
-        'start_at': 'start',
-        'end_at': 'end',
-        'integration_id': 'key',
-        'syllabus_body': 'description',
-        'default_view': 'default_view',
-        'image_url': 'image_url',
-        'is_public': 'is_public',
-        'self_enrollment': 'self_enrollment',
-        'course_code': 'key',
+        'fullname': 'title',
+        'shortname': 'shortname',
+        'idnumber': 'key',
+        'summary': 'description',
+        'startdate': 'start',
+        'enddate': 'end',
+        'categoryid': 'categoryid',
     }
 
-    LONG_STRING_LIMIT = 2000
+    LONG_STRING_LIMIT = 1700  # Actual maximum value we can support for any individual course
+    SKIP_KEY_IF_NONE = True
+
+    def transform_shortname(self, content_metadata_item):
+        """
+        We're prefixing Title to the key to make shortname a little nicer in Moodle's UI.
+        But because we use key elsewhere, I mapped this to itself
+        so it doesn't override all "key" references
+        """
+        return '{} ({})'.format(
+            content_metadata_item.get('title'),
+            content_metadata_item.get('key')
+        )
+
+    def transform_title(self, content_metadata_item):
+        """
+        Returns the course title with all organizations (partners) appended in parantheses
+        Returned format is: courseTitle - via edX.org (Partner)
+        """
+        formatted_orgs = []
+        for org in content_metadata_item.get('organizations', []):
+            split_org = org.partition(': ')  # results in: ['first_part', 'delim', 'latter part']
+            if split_org[2] == '':  # Occurs when the delimiter isn't present in the string.
+                formatted_orgs.append(split_org[0])  # Returns the original string
+            else:
+                formatted_orgs.append(split_org[2])
+        if not formatted_orgs:
+            final_orgs = ''
+        else:
+            final_orgs = ' ({})'.format(', '.join(formatted_orgs))
+
+        edx_formatted_title = '{} - via edX.org'.format(content_metadata_item.get('title'))
+        return '{}{}'.format(
+            edx_formatted_title,
+            final_orgs
+        )
 
     def transform_description(self, content_metadata_item):
         """
-        Return the course description and enrollment url as Canvas' syllabus body attribute.
-        This will display in the Syllabus tab in Canvas.
+        Return the course description and enrollment url as Moodle' syllabus body attribute.
+        This will display in the Syllabus tab in Moodle.
         """
         enrollment_url = content_metadata_item.get('enrollment_url', None)
-        base_description = "<a href={enrollment_url}>Go to edX course page</a><br />".format(
+        base_description = '<a href={enrollment_url} target="_blank">Go to edX course page</a><br />'.format(
             enrollment_url=enrollment_url)
         full_description = content_metadata_item.get('full_description') or None
+        short_description = content_metadata_item.get('short_description') or None
         if full_description and len(full_description + enrollment_url) <= self.LONG_STRING_LIMIT:
             description = "{base_description}{full_description}".format(
                 base_description=base_description,
                 full_description=full_description
             )
-        else:
-            short_description = content_metadata_item.get(
-                'short_description', content_metadata_item.get('title', '')
-            )
+        elif short_description and len(short_description + enrollment_url) <= self.LONG_STRING_LIMIT:
+            short_description = content_metadata_item.get('short_description')
             description = "{base_description}{short_description}".format(
                 base_description=base_description, short_description=short_description
             )
+        else:
+            description = "{base_description}{title}".format(
+                base_description=base_description,
+                title=content_metadata_item.get('title', '')
+            )
 
         return description
 
-    def transform_default_view(self, content_metadata_item):  # pylint: disable=unused-argument
+    def transform_categoryid(self, content_metadata_item):  # pylint: disable=unused-argument
         """
-        Sets the Home page view in Canvas. We're using Syllabus.
+        Returns the Moodle category id configured in the model.
+        ID 1 is Miscellaneous and is the default/basic category.
         """
-        return 'syllabus'
+        return self.enterprise_configuration.category_id or 1
 
-    def transform_is_public(self, content_metadata_item):  # pylint: disable=unused-argument
+    def transform_start(self, content_metadata_item):
         """
-        Whether to make the course visible in the public Canvas index by default.
+        Converts start from ISO date string to int (required for Moodle's "startdate" field)
         """
-        return True
+        start_date = content_metadata_item.get('start', None)
+        if start_date:
+            return int(parse(start_date).replace(tzinfo=timezone.utc).timestamp())
+        return None
 
-    def transform_self_enrollment(self, content_metadata_item):  # pylint: disable=unused-argument
+    def transform_end(self, content_metadata_item):
         """
-        Whether to allow students to self enroll. Helps students enroll via link or enroll button.
+        Converts end from ISO date string to int (required for Moodle's "enddate" field)
         """
-        return True
+        end_date = content_metadata_item.get('end', None)
+        if end_date:
+            return int(parse(end_date).replace(tzinfo=timezone.utc).timestamp())
+        return None
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0001_initial.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0001_initial.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0005_auto_20200909_1534.py` & `edx-enterprise-4.0.0/integrated_channels/degreed/migrations/0024_auto_20221021_0159.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,23 +1,28 @@
-# Generated by Django 2.2.15 on 2020-09-09 15:34
+# Generated by Django 3.2.16 on 2022-10-21 01:59
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('canvas', '0004_adding_learner_data_to_canvas'),
+        ('degreed', '0023_degreedlearnerdatatransmissionaudit_api_record'),
     ]
 
     operations = [
-        migrations.AlterField(
-            model_name='canvaslearnerdatatransmissionaudit',
-            name='completed_timestamp',
-            field=models.CharField(help_text='Represents the canvas representation of a timestamp: yyyy-mm-dd, which is always 10 characters.', max_length=10),
+        migrations.AddField(
+            model_name='degreedlearnerdatatransmissionaudit',
+            name='content_title',
+            field=models.CharField(blank=True, default=None, max_length=255, null=True),
         ),
-        migrations.AlterField(
-            model_name='canvaslearnerdatatransmissionaudit',
-            name='course_completed',
-            field=models.BooleanField(default=False, help_text="The learner's course completion status transmitted to Canvas."),
+        migrations.AddField(
+            model_name='degreedlearnerdatatransmissionaudit',
+            name='progress_status',
+            field=models.CharField(blank=True, max_length=255),
+        ),
+        migrations.AddField(
+            model_name='degreedlearnerdatatransmissionaudit',
+            name='user_email',
+            field=models.CharField(blank=True, max_length=255, null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0004_adding_learner_data_to_canvas.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0004_adding_learner_data_to_canvas.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/migrations/0002_auto_20200806_1632.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0002_auto_20200806_1632.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/models.py` & `edx-enterprise-4.0.0/integrated_channels/degreed2/models.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,198 +1,223 @@
 # -*- coding: utf-8 -*-
 """
-Database models for Enterprise Integrated Channel Canvas.
+Database models for Enterprise Integrated Channel Degreed.
 """
 
 import json
 from logging import getLogger
 
 from simple_history.models import HistoricalRecords
 
 from django.db import models
-from django.utils.encoding import python_2_unicode_compatible
 
-from integrated_channels.canvas.exporters.content_metadata import CanvasContentMetadataExporter
-from integrated_channels.canvas.exporters.learner_data import CanvasLearnerExporter
-from integrated_channels.canvas.transmitters.content_metadata import CanvasContentMetadataTransmitter
-from integrated_channels.canvas.transmitters.learner_data import CanvasLearnerTransmitter
-from integrated_channels.integrated_channel.models import EnterpriseCustomerPluginConfiguration
+from integrated_channels.degreed2.exporters.content_metadata import Degreed2ContentMetadataExporter
+from integrated_channels.degreed2.exporters.learner_data import Degreed2LearnerExporter
+from integrated_channels.degreed2.transmitters.content_metadata import Degreed2ContentMetadataTransmitter
+from integrated_channels.degreed2.transmitters.learner_data import Degreed2LearnerTransmitter
+from integrated_channels.integrated_channel.models import (
+    EnterpriseCustomerPluginConfiguration,
+    LearnerDataTransmissionAudit,
+)
+from integrated_channels.utils import is_valid_url
 
 LOGGER = getLogger(__name__)
 
 
-@python_2_unicode_compatible
-class CanvasEnterpriseCustomerConfiguration(EnterpriseCustomerPluginConfiguration):
+class Degreed2EnterpriseCustomerConfiguration(EnterpriseCustomerPluginConfiguration):
     """
-    The Enterprise-specific configuration we need for integrating with Canvas.
-
-    Based on: https://canvas.instructure.com/doc/api/file.oauth.html#oauth2-flow-3
+    The Enterprise-specific configuration we need for integrating with Degreed2.
 
     .. no_pii:
     """
 
     client_id = models.CharField(
         max_length=255,
-        null=True,
+        blank=True,
+        default='',
         verbose_name="API Client ID",
         help_text=(
             "The API Client ID provided to edX by the enterprise customer to be used to make API "
-            "calls to Canvas on behalf of the customer."
+            "calls to Degreed on behalf of the customer."
         )
     )
 
     client_secret = models.CharField(
         max_length=255,
-        null=True,
+        blank=True,
+        default='',
         verbose_name="API Client Secret",
         help_text=(
-            "The API Client Secret provided to edX by the enterprise customer to be used to make "
-            " API calls to Canvas on behalf of the customer."
+            "The API Client Secret provided to edX by the enterprise customer to be used to make API "
+            "calls to Degreed on behalf of the customer."
         )
     )
 
-    canvas_account_id = models.IntegerField(
-        null=True,
-        verbose_name="Canvas Account Number",
-        help_text="Account number to use during api calls. Called account_id in canvas. "
-                  " Required to create courses etc."
-    )
-
-    canvas_base_url = models.CharField(
+    degreed_base_url = models.CharField(
         max_length=255,
-        null=True,
-        verbose_name="Canvas Base URL",
-        help_text="The base URL used for API requests to Canvas, i.e. https://instructure.com."
+        blank=True,
+        default='',
+        verbose_name="Degreed Base URL",
+        help_text="The base URL used for API requests to Degreed, i.e. https://degreed.com."
     )
 
-    refresh_token = models.CharField(
+    degreed_token_fetch_base_url = models.CharField(
         max_length=255,
         blank=True,
-        verbose_name="Oauth2 Refresh Token",
-        help_text="The refresh token provided by Canvas along with the access token request, used to "
-                  "re-request the access tokens over multiple client sessions."
+        default='',
+        verbose_name="Degreed token fetch base url",
+        help_text="If provided, will be used as base url instead of degreed_base_url to fetch tokens"
+    )
+
+    # overriding base model field, to use chunk size 1 default
+    transmission_chunk_size = models.IntegerField(
+        default=1,
+        help_text="The maximum number of data items to transmit to the integrated channel with each request."
     )
 
     history = HistoricalRecords()
 
     class Meta:
-        app_label = 'canvas'
+        app_label = 'degreed2'
+
+    @property
+    def is_valid(self):
+        """
+        Returns whether or not the configuration is valid and ready to be activated
+
+        Args:
+            obj: The instance of Degreed2EnterpriseCustomerConfiguration
+                being rendered with this admin form.
+        """
+        missing_items = {'missing': []}
+        incorrect_items = {'incorrect': []}
+
+        if not self.client_id:
+            missing_items.get('missing').append('client_id')
+        if not self.client_secret:
+            missing_items.get('missing').append('client_secret')
+        if not self.degreed_base_url:
+            missing_items.get('missing').append('degreed_base_url')
+        if not is_valid_url(self.degreed_token_fetch_base_url):
+            incorrect_items.get('incorrect').append('degreed_token_fetch_base_url')
+        if not is_valid_url(self.degreed_base_url):
+            incorrect_items.get('incorrect').append('degreed_base_url')
+        if len(self.display_name) > 20:
+            incorrect_items.get('incorrect').append('display_name')
+        return missing_items, incorrect_items
 
     def __str__(self):
         """
         Return human-readable string representation.
         """
-        return "<CanvasEnterpriseCustomerConfiguration for Enterprise {enterprise_name}>".format(
+        return "<Degreed2EnterpriseCustomerConfiguration for Enterprise {enterprise_name}>".format(
             enterprise_name=self.enterprise_customer.name
         )
 
     def __repr__(self):
         """
         Return uniquely identifying string representation.
         """
         return self.__str__()
 
     @staticmethod
     def channel_code():
         """
         Returns an capitalized identifier for this channel class, unique among subclasses.
         """
-        return 'CANVAS'
+        return 'DEGREED2'
 
     def get_learner_data_transmitter(self):
-        return CanvasLearnerTransmitter(self)
+        """
+        Return a ``DegreedLearnerTransmitter`` instance.
+        """
+        return Degreed2LearnerTransmitter(self)
 
     def get_learner_data_exporter(self, user):
-        return CanvasLearnerExporter(user, self)
-
-    def get_content_metadata_exporter(self, user):
-        return CanvasContentMetadataExporter(user, self)
+        """
+        Return a ``DegreedLearnerDataExporter`` instance.
+        """
+        return Degreed2LearnerExporter(user, self)
 
     def get_content_metadata_transmitter(self):
-        return CanvasContentMetadataTransmitter(self)
+        """
+        Return a ``DegreedContentMetadataTransmitter`` instance.
+        """
+        return Degreed2ContentMetadataTransmitter(self)
+
+    def get_content_metadata_exporter(self, user):
+        """
+        Return a ``DegreedContentMetadataExporter`` instance.
+        """
+        return Degreed2ContentMetadataExporter(user, self)
 
 
-@python_2_unicode_compatible
-class CanvasLearnerDataTransmissionAudit(models.Model):
+class Degreed2LearnerDataTransmissionAudit(LearnerDataTransmissionAudit):
     """
-    The payload we send to canvas at a given point in time for an enterprise course enrollment.
-    """
-    canvas_user_email = models.CharField(
-        max_length=255,
-        blank=False,
-        null=False
-    )
+    The payload we sent to Degreed2 at a given point in time for an enterprise course enrollment.
+    Ref: https://api.degreed.com/docs/#create-a-new-completion
 
-    enterprise_course_enrollment_id = models.PositiveIntegerField(
-        blank=False,
-        null=False,
-        db_index=True
-    )
+    .. pii: The degreed_user_email model field contains PII.
+    .. pii_types: email_address
+    .. pii_retirement: consumer_api
+    """
 
-    course_id = models.CharField(
+    degreed_user_email = models.CharField(
         max_length=255,
         blank=False,
         null=False,
-        help_text="The course run's key which is used to uniquely identify the course for Canvas."
-    )
-
-    course_completed = models.BooleanField(
-        default=False,
-        help_text="The learner's course completion status transmitted to Canvas."
+        help_text='Used as the user-id field when creating a completion',
     )
 
-    completed_timestamp = models.CharField(
-        max_length=10,
-        help_text=(
-            'Represents the canvas representation of a timestamp: yyyy-mm-dd, '
-            'which is always 10 characters.'
-        )
+    degreed_completed_timestamp = models.CharField(
+        null=True,
+        blank=True,
+        max_length=19,
+        help_text='yyyy-mm-ddTHH:MM:SS format. Can be left unset for audit records.',
     )
 
-    # Request-related information.
-    status = models.CharField(max_length=100, blank=False, null=False)
-    error_message = models.TextField(blank=True)
-    created = models.DateTimeField(auto_now_add=True)
-    grade = models.CharField(max_length=255, null=True, blank=True)
-
     class Meta:
-        app_label = 'canvas'
+        app_label = 'degreed2'
+        index_together = ['enterprise_customer_uuid', 'plugin_configuration_id']
 
     def __str__(self):
+        """
+        Return a human-readable string representation of the object.
+        """
         return (
-            '<CanvasLearnerDataTransmissionAudit {transmission_id} for enterprise enrollment {enrollment}, '
-            'email {canvas_user_email}, and course {course_id}>'.format(
+            '<Degreed2LearnerDataTransmissionAudit {transmission_id} for enterprise enrollment {enrollment}, '
+            'email {degreed_user_email}, and course {course_id}>'.format(
                 transmission_id=self.id,
                 enrollment=self.enterprise_course_enrollment_id,
-                canvas_user_email=self.canvas_user_email,
+                degreed_user_email=self.degreed_user_email,
                 course_id=self.course_id
             )
         )
 
     def __repr__(self):
         """
         Return uniquely identifying string representation.
         """
         return self.__str__()
 
-    def serialize(self, *args, **kwargs):  # pylint: disable=unused-argument
+    def serialize(self, *args, **kwargs):
         """
         Return a JSON-serialized representation.
 
         Sort the keys so the result is consistent and testable.
 
-        # TODO: When we refactor to use a serialization flow consistent with how course metadata
-        # is serialized, remove the serialization here and make the learner data exporter handle the work.
-        """
-        return json.dumps(self._payload_data(), sort_keys=True)
-
-    def _payload_data(self):
-        """
-        Convert the audit record's fields into Canvas key/value pairs.
+        Can take the following keyword arguments:
+            - `enterprise_configuration`
         """
-        return dict(
-            userID=self.canvas_user_email,
-            courseID=self.course_id,
-            courseCompleted="true" if self.course_completed else "false",
-            completedTimestamp=self.completed_timestamp,
-            grade=self.grade,
-        )
+        json_payload = {
+            "data": {
+                "attributes": {
+                    "user-id": self.degreed_user_email,
+                    "user-identifier-type": "Email",
+                    "content-id": self.course_id,
+                    "content-id-type": "externalId",
+                    "content-type": "course",
+                    "completed-at": self.degreed_completed_timestamp,
+                }
+            }
+        }
+        return json.dumps(json_payload, sort_keys=True)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/canvas/client.py` & `edx-enterprise-4.0.0/integrated_channels/degreed2/client.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,484 +1,494 @@
 # -*- coding: utf-8 -*-
 """
-Client for connecting to Canvas.
+Client for connecting to Degreed2.
 """
+
 import json
-from datetime import datetime, timedelta
-from http import HTTPStatus
+import logging
+import time
 
 import requests
-from requests.utils import quote
-from six.moves.urllib.parse import urljoin  # pylint: disable=import-error
+from six.moves.urllib.parse import urljoin
 
 from django.apps import apps
+from django.conf import settings
+from django.http.request import QueryDict
 
 from integrated_channels.exceptions import ClientError
 from integrated_channels.integrated_channel.client import IntegratedChannelApiClient
+from integrated_channels.utils import generate_formatted_log, refresh_session_if_expired
+
+LOGGER = logging.getLogger(__name__)
 
 
-class CanvasAPIClient(IntegratedChannelApiClient):
+class Degreed2APIClient(IntegratedChannelApiClient):
     """
-    Client for connecting to Canvas.
+    Client for connecting to Degreed2.
 
-    Required Canvas auth credentials to instantiate a new client object.
-        -  canvas_base_url : the base url of the user's Canvas instance.
-        -  client_id : the ID associated with a Canvas developer key.
-        -  client_secret : the secret key associated with a Canvas developer key.
-        -  refresh_token : the refresh token token retrieved by the `oauth/complete`
-        endpoint after the user authorizes the use of their Canvas account.
-
-    Order of Operations:
-        Before the client can connect with an Enterprise user's Canvas account, the user will need to
-        follow these steps
-            - Create a developer key with their Canvas account
-            - Provide the ECS team with their developer key's client ID and secret.
-            - ECS will return a url for the user to visit which will prompt authorization and redirect when
-            the user hits the `confirm` button.
-            - The redirect will hit the `oauth/complete` endpoint which will use the passed oauth code
-            to request the Canvas oauth refresh token and save it to the Enterprise user's Canvas API config
-            - The refresh token is used at client instantiation to request the user's access token, this access
-            token is saved to the client's session and is used to make POST and DELETE requests to Canvas.
+    Specifically, this class supports obtaining access tokens and posting to the courses and
+    completion status endpoints.
     """
 
+    CONTENT_WRITE_SCOPE = "content:write"
+    ALL_DESIRED_SCOPES = "content:read,content:write,completions:write,completions:read"
+    SESSION_TIMEOUT = getattr(settings, "ENTERPRISE_DEGREED2_SESSION_TIMEOUT", 60)
+    MAX_RETRIES = getattr(settings, "ENTERPRISE_DEGREED2_MAX_RETRIES", 4)
+    BACKOFF_FACTOR = getattr(settings, "ENTERPRISE_DEGREED2_BACKOFF_FACTOR", 2)
+
     def __init__(self, enterprise_configuration):
         """
         Instantiate a new client.
 
         Args:
-            enterprise_configuration (CanvasEnterpriseCustomerConfiguration): An enterprise customers's
-            configuration model for connecting with Canvas
+            enterprise_configuration (Degreed2EnterpriseCustomerConfiguration): An enterprise customers's
+            configuration model for connecting with Degreed
         """
-        super(CanvasAPIClient, self).__init__(enterprise_configuration)
-        self.config = apps.get_app_config('canvas')
+        super().__init__(enterprise_configuration)
         self.session = None
         self.expires_at = None
-        self.course_create_url = CanvasAPIClient.course_create_endpoint(
-            self.enterprise_configuration.canvas_base_url,
-            self.enterprise_configuration.canvas_account_id
+        app_config = apps.get_app_config('degreed2')
+        self.oauth_api_path = app_config.oauth_api_path
+        self.courses_api_path = app_config.courses_api_path
+        self.completions_api_path = app_config.completions_api_path
+        # to log without having to pass channel_name, ent_customer_uuid each time
+        self.make_log_msg = lambda course_key, message, lms_user_id=None: generate_formatted_log(
+            self.enterprise_configuration.channel_code(),
+            self.enterprise_configuration.enterprise_customer.uuid,
+            lms_user_id,
+            course_key,
+            message,
         )
 
-    @staticmethod
-    def course_create_endpoint(canvas_base_url, canvas_account_id):
-        """
-        Returns endpoint to POST to for course creation
-        """
-        return '{}/api/v1/accounts/{}/courses'.format(
-            canvas_base_url,
-            canvas_account_id,
+    def get_oauth_url(self):
+        config = self.enterprise_configuration
+        base_url = config.degreed_token_fetch_base_url or config.degreed_base_url
+        return urljoin(base_url, self.oauth_api_path)
+
+    def get_courses_url(self):
+        return urljoin(self.enterprise_configuration.degreed_base_url, self.courses_api_path)
+
+    def get_completions_url(self):
+        return urljoin(self.enterprise_configuration.degreed_base_url, self.completions_api_path)
+
+    def create_assessment_reporting(self, user_id, payload):
+        """
+        Not implemented yet.
+        """
+        LOGGER.error(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                None,
+                "Degreed2 integrated channel does not yet support assessment reporting."
+            )
         )
 
-    @staticmethod
-    def course_update_endpoint(canvas_base_url, course_id):
+    def cleanup_duplicate_assignment_records(self, courses):
         """
-        Returns endpoint to PUT to for course update
+        Not implemented yet.
         """
-        return '{}/api/v1/courses/{}'.format(
-            canvas_base_url,
-            course_id,
+        LOGGER.error(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                None,
+                "Degreed2 integrated channel does not yet support assignment deduplication."
+            )
         )
 
-    def create_content_metadata(self, serialized_data):
-        self._create_session()
-
-        # step 1: create the course
-        status_code, response_text = self._post(self.course_create_url, serialized_data)
-        created_course_id = json.loads(response_text)['id']
-
-        # step 2: upload image_url and any other details
-        self._update_course_details(created_course_id, serialized_data)
-
-        return status_code, response_text
-
-    def update_content_metadata(self, serialized_data):
-        self._create_session()
-
-        integration_id = self._extract_integration_id(serialized_data)
-        course_id = self._get_course_id_from_integration_id(integration_id)
+    def create_course_completion(self, user_id, payload):
+        """
+        Completions status for a learner
+        Ref: https://api.degreed.com/docs/#create-a-new-completion
 
-        url = CanvasAPIClient.course_update_endpoint(
-            self.enterprise_configuration.canvas_base_url,
-            course_id,
+        Arguments:
+            - user_id: learner's id
+            - payload: (dict) with keys:
+                 {
+                     degreed_user_email,
+                     course_id,
+                     completed_timestamp, (in the format "2018-08-01T00:00:00")
+                 }
+        Returns: status_code, response_text
+        """
+        json_payload = json.loads(payload)
+        LOGGER.info(self.make_log_msg(
+            json_payload.get('data').get('attributes').get('content-id'),
+            f'Attempting find course via url: {self.get_completions_url()}'),
+            user_id
         )
-
-        return self._put(url, serialized_data)
-
-    def delete_content_metadata(self, serialized_data):
-        self._create_session()
-
-        integration_id = self._extract_integration_id(serialized_data)
-        course_id = self._get_course_id_from_integration_id(integration_id)
-
-        url = '{}/api/v1/courses/{}'.format(
-            self.enterprise_configuration.canvas_base_url,
-            course_id,
+        return self._post(
+            self.get_completions_url(),
+            json_payload,
+            self.ALL_DESIRED_SCOPES
         )
 
-        return self._delete(url)
-
-    def create_course_completion(self, user_id, payload):  # pylint: disable=unused-argument
-        learner_data = json.loads(payload)
-        self._create_session()
-
-        # Retrieve the Canvas user ID from the user's edx email (it is assumed that the learner's Edx
-        # and Canvas emails will match).
-        canvas_user_id = self._search_for_canvas_user_by_email(user_id)
-
-        # With the Canvas user ID, retrieve all courses for the user.
-        user_courses = self._get_canvas_user_courses_by_id(canvas_user_id)
-
-        # Find the course who's integration ID matches the learner data course ID
-        course_id = None
-        for course in user_courses:
-            integration_id = course['integration_id']
-            if '+'.join(integration_id.split(":")[1].split("+")[:2]) == learner_data['courseID']:
-                course_id = course['id']
-                break
-
-        if not course_id:
-            raise ClientError(
-                "Course: {course_id} not found registered in Canvas for Edx learner: {user_id}"
-                "/Canvas learner: {canvas_user_id}.".format(
-                    course_id=learner_data['courseID'],
-                    user_id=learner_data['userID'],
-                    canvas_user_id=canvas_user_id
-                ),
-                HTTPStatus.NOT_FOUND.value,
-            )
-
-        # Depending on if the assignment already exists, either retrieve or create it.
-        try:
-            assignment_id = self._handle_canvas_assignment_retrieval(integration_id, course_id)
-        except ClientError as client_error:
-            return client_error.status_code, client_error.message
-
-        # Post a grade for the assignment. This shouldn't create a submission for the user, but still update the grade.
-        submission_url = '{base_url}/api/v1/courses/{course_id}/assignments/' \
-                         '{assignment_id}/submissions/{user_id}'.format(
-                             base_url=self.enterprise_configuration.canvas_base_url,
-                             course_id=course_id,
-                             assignment_id=assignment_id,
-                             user_id=canvas_user_id
-                         )
-
-        # The percent grade from the grades api is represented as a decimal
-        submission_data = {
-            'submission': {
-                'posted_grade': learner_data['grade'] * 100
-            }
-        }
-        update_grade_response = self.session.put(submission_url, json=submission_data)
-
-        return update_grade_response.status_code, update_grade_response.text
-
-    def delete_course_completion(self, user_id, payload):  # pylint: disable=unused-argument
-        # Todo: There isn't a great way for users to delete course completion data
-        pass
-
-    # Private Methods
-
-    def _create_session(self):
-        """
-        Instantiate a new session object for use in connecting with Canvas. Each enterprise customer
-        connecting to Canvas should have a single client session.
-        Will only create a new session if token expiry has been reached
-        """
-        now = datetime.utcnow()
-        if self.session is None or self.expires_at is None or now >= self.expires_at:
-            # need new session if session expired, or not initialized
-            if self.session:
-                self.session.close()
-            # Create a new session with a valid token
-            oauth_access_token, expires_in = self._get_oauth_access_token(
-                self.enterprise_configuration.client_id,
-                self.enterprise_configuration.client_secret,
+    def delete_course_completion(self, user_id, payload):
+        """
+        Not implemented yet. deletion requires completion ID. We don't have a way to get the ID right now.
+        So we may need to store id on our side to be able to do this.
+        https://api.degreed.com/docs/#delete-a-specific-completion
+        """
+        LOGGER.error(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                None,
+                "Degreed2 integrated channel does not yet support deleting course completions."
             )
-            session = requests.Session()
-            session.headers['Authorization'] = 'Bearer {}'.format(oauth_access_token)
-            session.headers['content-type'] = 'application/json'
-            self.session = session
-            # expiry expected after `expires_in` seconds
-            if expires_in is not None:
-                self.expires_at = datetime.utcnow() + timedelta(seconds=expires_in)
+        )
 
-    def _update_course_details(self, course_id, serialized_data):
+    def fetch_degreed_course_id(self, external_id):
         """
-        Update a course for image_url (and possibly other settings in future)
-        This is used only for settings that are not settable in the initial course creation
+        Fetch the 'id' of a course from Degreed2, given the external-id as a search param
+        'external-id' is the edX course key
         """
-        try:
-            # there is no way to do this in a single request during create
-            # https://canvas.instructure.com/doc/api/all_resources.html#method.courses.update
-            content_metadata_item = json.loads(serialized_data.decode('utf-8'))['course']
-            if "image_url" in content_metadata_item:
-                url = CanvasAPIClient.course_update_endpoint(
-                    self.enterprise_configuration.canvas_base_url,
-                    course_id,
-                )
-                self._put(url, json.dumps({
-                    'course': {'image_url': content_metadata_item['image_url']}
-                }).encode('utf-8'))
-        except Exception:  # pylint: disable=broad-except
-            # we do not want course image update to cause failures
-            pass
+        # QueryDict converts + to space
+        params = QueryDict(f"filter[external_id]={external_id.replace('+','%2B')}")
+        course_search_url = f'{self.get_courses_url()}?{params.urlencode(safe="[]")}'
+        LOGGER.info(self.make_log_msg(external_id, f'Attempting find course via url: {course_search_url}'))
+        status_code, response_body = self._get(
+            course_search_url,
+            self.ALL_DESIRED_SCOPES
+        )
+        if status_code >= 400:
+            raise ClientError(
+                f'Degreed2: fetch request failed: attempted, external ID={external_id},'
+                f'received status_code={status_code}',
+                status_code=status_code
+            )
+        response_json = json.loads(response_body)
+        if response_json['data']:
+            return response_json['data'][0]['id']
+        raise ClientError(
+            f'Degreed2: Attempted to find degreed course id but failed, external id was {external_id}'
+            f', Response from Degreed was {response_body}')
 
-    def _post(self, url, data):
+    def create_content_metadata(self, serialized_data):
         """
-        Make a POST request using the session object to a Canvas endpoint.
+        Create content metadata using the Degreed course content API.
 
         Args:
-            url (str): The url to send a POST request to.
-            data (bytearray): The json encoded payload to POST.
-        """
-        post_response = self.session.post(url, data=data)
-        if post_response.status_code >= 400:
-            raise ClientError(post_response.text, post_response.status_code)
-        return post_response.status_code, post_response.text
+            serialized_data: JSON-encoded object containing content metadata.
 
-    def _put(self, url, data):
+        Raises:
+            ClientError: If Degreed API request fails.
         """
-        Make a PUT request using the session object to the Canvas course update endpoint
-
-        Args:
-            url (str): The canvas url to send update requests to.
-            data (bytearray): The json encoded payload to UPDATE. This also contains the integration
-            ID used to match a course with a course ID.
-        """
-        put_response = self.session.put(url, data=data)
-        if put_response.status_code >= 400:
-            raise ClientError(put_response.text, put_response.status_code)
-        return put_response.status_code, put_response.text
+        channel_metadata_item = json.loads(serialized_data.decode('utf-8'))
+        # only expect one course in this array as of now (chunk size is 1)
+        a_course = channel_metadata_item['courses'][0]
+        status_code, response_body = self._sync_content_metadata(a_course, 'post', self.get_courses_url())
+        if status_code == 409:
+            # course already exists, don't raise failure, but log and move on
+            LOGGER.warning(
+                self.make_log_msg(
+                    a_course.get('external-id'),
+                    f'Course with integration_id = {a_course.get("external-id")} already exists, '
+                )
+            )
+            # content already exists, we'll treat this as a success
+            status_code = 200
+        elif status_code >= 400:
+            raise ClientError(
+                f'Degreed2APIClient create_content_metadata failed with status {status_code}: {response_body}',
+                status_code=status_code
+            )
+        return status_code, response_body
 
-    def _delete(self, url):
+    def update_content_metadata(self, serialized_data):
         """
-        Make a DELETE request using the session object to the Canvas course delete endpoint.
+        Update content metadata using the Degreed course content API.
 
         Args:
-            url (str): The canvas url to send delete requests to.
-        """
-        delete_response = self.session.delete(url, data='{"event":"delete"}')
-        if delete_response.status_code >= 400:
-            raise ClientError(delete_response.text, delete_response.status_code)
-        return delete_response.status_code, delete_response.text
+            serialized_data: JSON-encoded object containing content metadata.
 
-    def _extract_integration_id(self, data):
+        Raises:
+            ClientError: If Degreed API request fails.
         """
-        Retrieve the integration ID string from the encoded transmission data and apply appropriate
-        error handling.
+        channel_metadata_item = json.loads(serialized_data.decode('utf-8'))
+        course_item = channel_metadata_item['courses'][0]
+        external_id = course_item.get('external-id')
 
-        Args:
-            data (bytearray): The json encoded payload intended for a Canvas endpoint.
-        """
-        if not data:
-            raise ClientError("No data to transmit.", HTTPStatus.NOT_FOUND.value)
-        try:
-            integration_id = json.loads(
-                data.decode("utf-8")
-            )['course']['integration_id']
-        except KeyError:
-            raise ClientError("Could not transmit data, no integration ID present.", HTTPStatus.NOT_FOUND.value)
-        except AttributeError:
-            raise ClientError("Unable to decode data.", HTTPStatus.BAD_REQUEST.value)
+        course_id = self.fetch_degreed_course_id(external_id)
+        if not course_id:
+            raise ClientError(f'Degreed2: Cannot find course via external-id {external_id}')
 
-        return integration_id
+        patch_url = f'{self.get_courses_url()}/{course_id}'
+        LOGGER.info(self.make_log_msg(external_id, f'Attempting course update via {patch_url}'))
+        patch_status_code, patch_response_body = self._sync_content_metadata(
+            course_item,
+            'patch',
+            patch_url,
+            course_id
+        )
+        return patch_status_code, patch_response_body
 
-    def _get_course_id_from_integration_id(self, integration_id):
+    def delete_content_metadata(self, serialized_data):
         """
-        To obtain course ID we have to request all courses associated with the integrated
-        account and match the one with our integration ID.
+        Delete content metadata using the Degreed course content API.
 
         Args:
-            integration_id (string): The ID retrieved from the transmission payload.
+            serialized_data: JSON-encoded object containing content metadata.
+
+        Raises:
+            ClientError: If Degreed API request fails.
         """
-        url = "{}/api/v1/accounts/{}/courses/?search_term={}".format(
-            self.enterprise_configuration.canvas_base_url,
-            self.enterprise_configuration.canvas_account_id,
-            quote(integration_id),
-        )
-        resp = self.session.get(url)
-        all_courses_response = resp.json()
+        # {{base_api_url}}/api/v2/content/courses?filter[external_id]=course-v1%3AedX%2B444555666%2B3T2021
+        channel_metadata_item = json.loads(serialized_data.decode('utf-8'))
+        course_item = channel_metadata_item['courses'][0]
+        external_id = course_item.get('external-id')
 
-        if resp.status_code >= 400:
-            raise ClientError(
-                all_courses_response.reason,
-                all_courses_response.status_code
+        del_status_code = None
+        del_response_body = ''
+        try:
+            course_id = self.fetch_degreed_course_id(external_id)
+            if not course_id:
+                raise ClientError(f'Degreed2: Cannot find course via external-id {external_id}')
+
+            del_url = f'{self.get_courses_url()}/{course_id}'
+            LOGGER.info(self.make_log_msg(external_id, f'Attempting course delete via {del_url}'))
+            del_status_code, del_response_body = self._delete(
+                del_url,
+                None,
+                self.ALL_DESIRED_SCOPES
             )
-
-        course_id = None
-        for course in all_courses_response:
-            if course['integration_id'] == integration_id:
-                course_id = course['id']
-                break
-
-        if not course_id:
+            if del_status_code >= 400:
+                raise ClientError(
+                    f'Degreed2: delete request failed: attempted, external ID={external_id},'
+                    f'status_code={del_status_code}'
+                    f'response_body={del_response_body}',
+                    status_code=del_status_code
+                )
+        except requests.exceptions.RequestException as exc:
             raise ClientError(
-                "No Canvas courses found with associated integration ID: {}.".format(
-                    integration_id
-                ),
-                HTTPStatus.NOT_FOUND.value
-            )
-        return course_id
+                'Degreed2APIClient delete request failed: {error} {message}'.format(
+                    error=exc.__class__.__name__,
+                    message=str(exc)
+                )
+            ) from exc
+
+        return del_status_code, del_response_body
 
-    def _search_for_canvas_user_by_email(self, user_email):
+    def _sync_content_metadata(self, course_attributes, http_method, override_url, degreed_course_id=None):
         """
-        Helper method to make an api call to Canvas using the user's email as a search term.
+        Synchronize content metadata using the Degreed course content API.
+        Invokes the Create/Update operations of degreed api
+        Used for create course, and update course use cases
+        The json sent contains
 
         Args:
-            user_email (string) : The email associated with both the user's Edx account and Canvas account.
-        """
-        get_user_id_from_email_url = '{url_base}/api/v1/accounts/{account_id}/users?search_term={email_address}'.format(
-            url_base=self.enterprise_configuration.canvas_base_url,
-            account_id=self.enterprise_configuration.canvas_account_id,
-            email_address=user_email
-        )
-        rsps = self.session.get(get_user_id_from_email_url)
+            course_attributes: JSON object containing content metadata converted into
+              Degreed2 'attributes' in the payload.
+            http_method: The HTTP method to use for the API request.
+            override_url: uses this url to post to
+            course_id: used to append at the end of the url as /ID if provided
 
-        if rsps.status_code >= 400:
-            raise ClientError(
-                "Failed to retrieve user from Canvas: received response-[{}]".format(rsps.reason),
-                rsps.status_code
-            )
+        Raises:
+            ClientError: If Degreed API request fails.
+        """
+        json_to_send = {
+            "data": {
+                "type": "content/courses",
+                "attributes": course_attributes,
+            }
+        }
 
-        get_users_by_email_response = rsps.json()
+        # useful for update use case
+        if degreed_course_id:
+            json_to_send['data']['id'] = degreed_course_id
 
+        LOGGER.info(self.make_log_msg('', f'About to post payload: {json_to_send}'))
         try:
-            canvas_user_id = get_users_by_email_response[0]['id']
-        except (KeyError, IndexError):
-            raise ClientError(
-                "No Canvas user ID found associated with email: {}".format(user_email),
-                HTTPStatus.NOT_FOUND.value
+            status_code, response_body = getattr(self, '_' + http_method)(
+                override_url,
+                json_to_send,
+                self.ALL_DESIRED_SCOPES
             )
-        return canvas_user_id
-
-    def _get_canvas_user_courses_by_id(self, user_id):
-        """Helper method to retrieve all courses that a Canvas user is enrolled in."""
-        get_users_courses_url = '{canvas_base_url}/api/v1/users/{canvas_user_id}/courses'.format(
-            canvas_base_url=self.enterprise_configuration.canvas_base_url,
-            canvas_user_id=user_id
-        )
-        rsps = self.session.get(get_users_courses_url)
-
-        if rsps.status_code >= 400:
+        except requests.exceptions.RequestException as exc:
             raise ClientError(
-                "Could not retrieve Canvas course list. Received exception: {}".format(
-                    rsps.reason
-                ),
-                rsps.status_code
-            )
+                'Degreed2APIClient request failed: {error} {message}'.format(
+                    error=exc.__class__.__name__,
+                    message=str(exc)
+                )
+            ) from exc
+        return status_code, response_body
 
-        return rsps.json()
+    def _calculate_backoff(self, attempt_count):
+        """
+        Calculate the seconds to sleep based on attempt_count
+        """
+        return (self.BACKOFF_FACTOR * (2 ** (attempt_count - 1)))
 
-    def _handle_canvas_assignment_retrieval(self, integration_id, course_id):
+    def _get(self, url, scope):
         """
-        Helper method to handle course assignment creation or retrieval. Canvas requires an assignment
-        in order for a user to get a grade, so first check the course for the "final grade"
-        assignment. This assignment will have a matching integration id to the currently transmitting
-        learner data. If this assignment is not yet created on Canvas, send a post request to do so.
+        Make a GET request using the session object to a Degreed2 endpoint.
 
         Args:
-            integration_id (str) : the string integration id from the edx course.
-            course_id (str) : the Canvas course ID relating to the course which the client is currently
-            transmitting learner data to.
-        """
-        # First, check if the course assignment already exists
-        canvas_assignments_url = '{canvas_base_url}/api/v1/courses/{course_id}/assignments'.format(
-            canvas_base_url=self.enterprise_configuration.canvas_base_url,
-            course_id=course_id
-        )
-        resp = self.session.get(canvas_assignments_url)
+            url (str): The url to send a GET request to.
+            scope (str): Must be one of the scopes Degreed expects:
+                        - `CONTENT_WRITE_SCOPE`
+                        - `CONTENT_READ_SCOPE`
+        """
+        self._create_session(scope)
+        attempts = 0
+        while True:
+            attempts = attempts + 1
+            response = self.session.get(url)
+            if attempts <= self.MAX_RETRIES and response.status_code == 429:
+                sleep_seconds = self._calculate_backoff(attempts)
+                LOGGER.warning(
+                    generate_formatted_log(
+                        self.enterprise_configuration.channel_code(),
+                        self.enterprise_configuration.enterprise_customer.uuid,
+                        None,
+                        None,
+                        f'429 detected from {url}, backing-off before retrying, '
+                        f'sleeping {sleep_seconds} seconds...'
+                    )
+                )
+                time.sleep(sleep_seconds)
+            else:
+                break
+        return response.status_code, response.text
 
-        assignments_resp = resp.json()
-        assignment_id = None
-        for assignment in assignments_resp:
-            try:
-                if assignment['integration_id'] == integration_id:
-                    assignment_id = assignment['id']
-                    break
-            except (KeyError, ValueError):
-                raise ClientError(
-                    "Something went wrong retrieving assignments from Canvas. Got response: {}".format(
-                        resp.text,
-                    ),
-                    resp.status_code
+    def _post(self, url, data, scope):
+        """
+        Make a POST request using the session object to a Degreed2 endpoint.
+
+        Args:
+            url (str): The url to send a POST request to.
+            data (dict): The json payload to POST.
+            scope (str): Must be one of the scopes Degreed expects:
+                        - `CONTENT_WRITE_SCOPE`
+                        - `CONTENT_READ_SCOPE`
+        """
+        self._create_session(scope)
+        attempts = 0
+        while True:
+            attempts = attempts + 1
+            response = self.session.post(url, json=data)
+            if attempts <= self.MAX_RETRIES and response.status_code == 429:
+                sleep_seconds = self._calculate_backoff(attempts)
+                LOGGER.warning(
+                    generate_formatted_log(
+                        self.enterprise_configuration.channel_code(),
+                        self.enterprise_configuration.enterprise_customer.uuid,
+                        None,
+                        None,
+                        f'429 detected from {url}, backing-off before retrying, '
+                        f'sleeping {sleep_seconds} seconds...'
+                    )
                 )
+                time.sleep(sleep_seconds)
+            else:
+                break
+        return response.status_code, response.text
 
-        # Canvas requires a course assignment for a learner to be assigned a grade.
-        # If no assignment has been made yet, create it.
-        if not assignment_id:
-            assignment_creation_data = {
-                'assignment': {
-                    'name': '(Edx integration) Final Grade',
-                    'submission_types': 'none',
-                    'integration_id': integration_id,
-                    'published': True,
-                    'points_possible': 100
-                }
-            }
-            create_assignment_resp = self.session.post(canvas_assignments_url, json=assignment_creation_data)
+    def _patch(self, url, data, scope):
+        """
+        Make a PATCH request using the session object to a Degreed2 endpoint.
 
-            try:
-                assignment_id = create_assignment_resp.json()['id']
-            except (ValueError, KeyError):
-                raise ClientError(
-                    "Something went wrong creating an assignment on Canvas. Got response: {}".format(
-                        create_assignment_resp.text,
-                    ),
-                    create_assignment_resp.status_code
+        Args:
+            url (str): The url to send a POST request to.
+            data (str): The json payload to POST.
+            scope (str): Must be one of the scopes Degreed expects:
+                        - `CONTENT_WRITE_SCOPE`
+                        - `CONTENT_READ_SCOPE`
+        """
+        self._create_session(scope)
+        attempts = 0
+        while True:
+            attempts = attempts + 1
+            response = self.session.patch(url, json=data)
+            if attempts <= self.MAX_RETRIES and response.status_code == 429:
+                sleep_seconds = self._calculate_backoff(attempts)
+                LOGGER.warning(
+                    generate_formatted_log(
+                        self.enterprise_configuration.channel_code(),
+                        self.enterprise_configuration.enterprise_customer.uuid,
+                        None,
+                        None,
+                        f'429 detected from {url}, backing-off before retrying, '
+                        f'sleeping {sleep_seconds} seconds...'
+                    )
                 )
-        return assignment_id
+                time.sleep(sleep_seconds)
+            else:
+                break
+        return response.status_code, response.text
 
-    def _get_oauth_access_token(self, client_id, client_secret):
-        """Uses the client id, secret and refresh token to request the user's auth token from Canvas.
+    def _delete(self, url, data, scope):
+        """
+        Make a DELETE request using the session object to a Degreed endpoint.
 
         Args:
-            client_id (str): API client ID
-            client_secret (str): API client secret
+            url (str): The url to send a DELETE request to.
+            data (str): The json payload to DELETE. None means nothing is sent in payload.
+            scope (str): Must be one of the scopes Degreed expects:
+                        - `CONTENT_PROVIDER_SCOPE`
+                        - `COMPLETION_PROVIDER_SCOPE`
+        """
+        self._create_session(scope)
+        attempts = 0
+        while True:
+            attempts = attempts + 1
+            response = self.session.delete(url, json=data) if data else self.session.delete(url)
+            if attempts <= self.MAX_RETRIES and response.status_code == 429:
+                sleep_seconds = self._calculate_backoff(attempts)
+                LOGGER.warning(
+                    generate_formatted_log(
+                        self.enterprise_configuration.channel_code(),
+                        self.enterprise_configuration.enterprise_customer.uuid,
+                        None,
+                        None,
+                        f'429 detected from {url}, backing-off before retrying, '
+                        f'sleeping {sleep_seconds} seconds...'
+                    )
+                )
+                time.sleep(sleep_seconds)
+            else:
+                break
+        return response.status_code, response.text
+
+    def _create_session(self, scope):
+        """
+        Instantiate a new session object for use in connecting with Degreed
+        """
+        self.session, self.expires_at = refresh_session_if_expired(
+            lambda: self._get_oauth_access_token(scope),
+            self.session,
+            self.expires_at,
+        )
 
+    def _get_oauth_access_token(self, scope):
+        """ Retrieves OAuth 2.0 access token using the client credentials grant.
+        Prefers using the degreed_token_fetch_base_url over the degreed_base_url, if present, to fetch the access token.
+
+        Args:
+            scope (str): Must be one or comma separated list of the scopes Degreed expects
         Returns:
-            access_token (str): the OAuth access token to access the Canvas API as the user
-            expires_in (int): the number of seconds after which token will expire
+            tuple: Tuple containing access token string and expiration datetime.
         Raises:
-            HTTPError: If we received a failure response code from Canvas.
+            HTTPError: If we received a failure response code from Degreed.
             ClientError: If an unexpected response format was received that we could not parse.
         """
-        if not client_id:
-            raise ClientError(
-                "Failed to generate oauth access token: Client ID required.",
-                HTTPStatus.INTERNAL_SERVER_ERROR
-            )
-        if not client_secret:
-            raise ClientError(
-                "Failed to generate oauth access token: Client secret required.",
-                HTTPStatus.INTERNAL_SERVER_ERROR
-            )
-        if not self.enterprise_configuration.refresh_token:
-            raise ClientError(
-                "Failed to generate oauth access token: Refresh token required.",
-                HTTPStatus.INTERNAL_SERVER_ERROR
-            )
-
-        if not self.enterprise_configuration.canvas_base_url or not self.config.oauth_token_auth_path:
-            raise ClientError(
-                "Failed to generate oauth access token: Canvas oauth path missing from configuration.",
-                HTTPStatus.INTERNAL_SERVER_ERROR
-            )
-        auth_token_url = urljoin(
-            self.enterprise_configuration.canvas_base_url,
-            self.config.oauth_token_auth_path,
+        config = self.enterprise_configuration
+        response = requests.post(
+            self.get_oauth_url(),
+            data={
+                'grant_type': 'client_credentials',
+                'scope': scope,
+                'client_id': config.client_id,
+                'client_secret': config.client_secret,
+            },
+            headers={'Content-Type': 'application/x-www-form-urlencoded'}
         )
 
-        auth_token_params = {
-            'grant_type': 'refresh_token',
-            'client_id': client_id,
-            'client_secret': client_secret,
-            'state': str(self.enterprise_configuration.enterprise_customer.uuid),
-            'refresh_token': self.enterprise_configuration.refresh_token,
-        }
-
-        auth_response = requests.post(auth_token_url, auth_token_params)
-        if auth_response.status_code >= 400:
-            raise ClientError(auth_response.text, auth_response.status_code)
         try:
-            data = auth_response.json()
-            return data['access_token'], data["expires_in"]
-        except (KeyError, ValueError):
-            raise ClientError(auth_response.text, auth_response.status_code)
+            data = response.json()
+            return data['access_token'], data['expires_in']
+        except (KeyError, ValueError) as error:
+            raise ClientError(response.text, response.status_code) from error
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/moodle/transmitters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/transmitters/learner_data.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# -*- coding: utf-8 -*-
 """
 Class for transmitting learner data to Moodle.
 """
 
 from integrated_channels.integrated_channel.transmitters.learner_data import LearnerTransmitter
 from integrated_channels.moodle.client import MoodleAPIClient
 
@@ -13,23 +12,23 @@
     sent to Moodle.
     """
 
     def __init__(self, enterprise_configuration, client=MoodleAPIClient):
         """
         By default, use the ``MoodleAPIClient`` for learner data transmission to Moodle.
         """
-        super(MoodleLearnerTransmitter, self).__init__(
+        super().__init__(
             enterprise_configuration=enterprise_configuration,
             client=client
         )
 
     def transmit(self, payload, **kwargs):
         """
         Send a completion status call to Moodle using the client.
 
         Args:
-            payload: The learner completion data payload to send to Moodle
+            payload: The learner data exporter for Moodle
         """
         kwargs['app_label'] = 'moodle'
         kwargs['model_name'] = 'MoodleLearnerDataTransmissionAudit'
         kwargs['remote_user_id'] = 'moodle_user_email'
-        super(MoodleLearnerTransmitter, self).transmit(payload, **kwargs)
+        super().transmit(payload, **kwargs)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/moodle/exporters/learner_data.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/exporters/learner_data.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,74 +1,83 @@
-# -*- coding: utf-8 -*-
 """
 Learner data exporter for Enterprise Integrated Channel Moodle.
 """
 
 from logging import getLogger
 
 from django.apps import apps
 
-from enterprise.api_client.discovery import get_course_catalog_api_service_client
+from integrated_channels.catalog_service_utils import get_course_id_for_enrollment
 from integrated_channels.integrated_channel.exporters.learner_data import LearnerExporter
-from integrated_channels.utils import parse_datetime_to_epoch_millis
+from integrated_channels.utils import generate_formatted_log, parse_datetime_to_epoch_millis
 
 LOGGER = getLogger(__name__)
 
 
 class MoodleLearnerExporter(LearnerExporter):
     """
     Class to provide a Moodle learner data transmission audit prepared for serialization.
     """
 
     def get_learner_data_records(
             self,
             enterprise_enrollment,
             completed_date=None,
-            is_passing=False,
+            course_completed=False,
             **kwargs
-    ):  # pylint: disable=arguments-differ,unused-argument
+    ):  # pylint: disable=arguments-differ
         """
         Return a MoodleLearnerDataTransmissionAudit with the given enrollment and course completion data.
-        If completed_date is None, then course completion has not been met.
         If no remote ID can be found, return None.
         """
-        enterprise_customer = enterprise_enrollment.enterprise_customer_user
-        completed_timestamp = None
+        enterprise_customer_user = enterprise_enrollment.enterprise_customer_user
+        moodle_completed_timestamp = None
         if completed_date is not None:
-            completed_timestamp = parse_datetime_to_epoch_millis(completed_date)
+            moodle_completed_timestamp = parse_datetime_to_epoch_millis(completed_date)
 
-        if enterprise_customer.user_email is None:
-            LOGGER.debug(
-                'No learner data was sent for user [%s] because a Moodle user ID could not be found.',
-                enterprise_customer.username
-            )
+        if enterprise_customer_user.user_email is None:
+            LOGGER.debug(generate_formatted_log(
+                'moodle',
+                enterprise_customer_user.enterprise_customer.uuid,
+                enterprise_customer_user.user_id,
+                None,
+                ('get_learner_data_records finished. No learner data was sent for this LMS User Id because '
+                 'Moodle User ID not found for [{name}]'.format(
+                     name=enterprise_customer_user.enterprise_customer.name
+                 ))))
             return None
 
-        MoodleLearnerDataTransmissionAudit = apps.get_model(  # pylint: disable=invalid-name
+        MoodleLearnerDataTransmissionAudit = apps.get_model(
             'moodle',
             'MoodleLearnerDataTransmissionAudit'
         )
 
-        course_catalog_client = get_course_catalog_api_service_client(
-            site=enterprise_customer.enterprise_customer.site
-        )
-
         percent_grade = kwargs.get('grade_percent', None)
-
+        # We return two records here, one with the course key and one with the course run id, to account for
+        # uncertainty about the type of content (course vs. course run) that was sent to the integrated channel.
+        # TODO: this shouldn't be necessary anymore and eventually phased out as part of tech debt
         return [
             MoodleLearnerDataTransmissionAudit(
                 enterprise_course_enrollment_id=enterprise_enrollment.id,
-                moodle_user_email=enterprise_customer.user_email,
-                course_id=course_catalog_client.get_course_id(enterprise_enrollment.course_id),
-                course_completed=completed_date is not None and is_passing,
+                moodle_user_email=enterprise_customer_user.user_email,
+                user_email=enterprise_customer_user.user_email,
+                course_id=get_course_id_for_enrollment(enterprise_enrollment),
+                course_completed=course_completed,
                 grade=percent_grade,
-                completed_timestamp=completed_timestamp,
+                completed_timestamp=completed_date,
+                moodle_completed_timestamp=moodle_completed_timestamp,
+                enterprise_customer_uuid=enterprise_customer_user.enterprise_customer.uuid,
+                plugin_configuration_id=self.enterprise_configuration.id,
             ),
             MoodleLearnerDataTransmissionAudit(
                 enterprise_course_enrollment_id=enterprise_enrollment.id,
-                moodle_user_email=enterprise_customer.user_email,
+                moodle_user_email=enterprise_customer_user.user_email,
+                user_email=enterprise_customer_user.user_email,
                 course_id=enterprise_enrollment.course_id,
-                course_completed=completed_date is not None and is_passing,
+                course_completed=course_completed,
                 grade=percent_grade,
-                completed_timestamp=completed_timestamp,
+                completed_timestamp=completed_date,
+                moodle_completed_timestamp=moodle_completed_timestamp,
+                enterprise_customer_uuid=enterprise_customer_user.enterprise_customer.uuid,
+                plugin_configuration_id=self.enterprise_configuration.id,
             )
         ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/moodle/migrations/0001_initial.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0001_initial.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/integrated_channels/moodle/migrations/0002_moodlelearnerdatatransmissionaudit.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/migrations/0002_moodlelearnerdatatransmissionaudit.py`

 * *Files identical despite different names*

### Comparing `edx-enterprise-3.9.9/integrated_channels/moodle/migrations/0003_auto_20201006_1706.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0008_auto_20210707_0815.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,23 +1,23 @@
-# Generated by Django 2.2.16 on 2020-10-06 17:06
+# Generated by Django 2.2.20 on 2021-07-07 13:15
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('moodle', '0002_moodlelearnerdatatransmissionaudit'),
+        ('canvas', '0007_auto_20210222_2225'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='historicalmoodleenterprisecustomerconfiguration',
+            model_name='canvasenterprisecustomerconfiguration',
             name='transmission_chunk_size',
-            field=models.IntegerField(default=4, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
+            field=models.IntegerField(default=1, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
         ),
         migrations.AlterField(
-            model_name='moodleenterprisecustomerconfiguration',
+            model_name='historicalcanvasenterprisecustomerconfiguration',
             name='transmission_chunk_size',
-            field=models.IntegerField(default=4, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
+            field=models.IntegerField(default=1, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/moodle/client.py` & `edx-enterprise-4.0.0/integrated_channels/moodle/client.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,44 +1,61 @@
-# -*- coding: utf-8 -*-
 """
 Client for connecting to Moodle.
 """
 
 import json
+import logging
 from http import HTTPStatus
-from urllib.parse import urlencode, urljoin
+from urllib.parse import urljoin
 
 import requests
 
 from django.apps import apps
 
 from integrated_channels.exceptions import ClientError
 from integrated_channels.integrated_channel.client import IntegratedChannelApiClient
+from integrated_channels.utils import generate_formatted_log
 
-MOODLE_FINAL_GRADE_ASSIGNMENT_NAME = '(edX integration) Final Grade'
+LOGGER = logging.getLogger(__name__)
+
+
+class MoodleClientError(ClientError):
+    """
+    Indicate a problem when interacting with Moodle.
+    """
+
+    def __init__(self, message, status_code=500, moodle_error=None):
+        """Save the status code and message raised from the client."""
+        self.status_code = status_code
+        self.message = message
+        self.moodle_error = moodle_error
+        super().__init__(message, status_code)
 
 
 def moodle_request_wrapper(method):
     """
     Wraps requests to Moodle's API in a token check.
     Will obtain a new token if there isn't one.
     """
+
     def inner(self, *args, **kwargs):
         if not self.token:
             self.token = self._get_access_token()  # pylint: disable=protected-access
         response = method(self, *args, **kwargs)
         try:
             body = response.json()
-        except (AttributeError, ValueError):
+        except (AttributeError, ValueError) as error:
             # Moodle spits back an entire HTML page if something is wrong in our URL format.
             # This cannot be converted to JSON thus the above fails miserably.
             # The above can fail with different errors depending on the format of the returned page.
             # Moodle of course does not tell us what is wrong in any part of this HTML.
-            raise ClientError('Moodle API task "{method}" failed due to unknown error.'.format(
-                method=method.__name__), response.status_code)
+            log_msg = (f'Moodle API task "{method.__name__}" '
+                       f'for enterprise_customer_uuid "{self.enterprise_configuration.enterprise_customer.uuid}" '
+                       f'failed due to unknown error with code "{response.status_code}".')
+            raise ClientError(log_msg, response.status_code) from error
         if isinstance(body, list):
             # On course creation (and ONLY course creation) success,
             # Moodle returns a list of JSON objects, because of course it does.
             # Otherwise, it fails instantly and returns actual JSON.
             return response
         if isinstance(body, int):
             # This only happens for grades AFAICT. Zero also doesn't necessarily mean success,
@@ -51,20 +68,21 @@
             raise ClientError('Moodle API Grade Update failed with possible error: {body}'.format(body=body), 500)
         error_code = body.get('errorcode')
         warnings = body.get('warnings')
         if error_code and error_code == 'invalidtoken':
             self.token = self._get_access_token()  # pylint: disable=protected-access
             response = method(self, *args, **kwargs)
         elif error_code:
-            raise ClientError(
+            raise MoodleClientError(
                 'Moodle API Client Task "{method}" failed with error code '
                 '"{code}" and message: "{msg}" '.format(
                     method=method.__name__, code=error_code, msg=body.get('message'),
                 ),
-                response.status_code
+                response.status_code,
+                error_code,
             )
         elif warnings:
             # More Moodle nonsense!
             errors = []
             for warning in warnings:
                 if warning.get('message'):
                     errors.append(warning.get('message'))
@@ -97,44 +115,50 @@
         """
         Instantiate a new client.
 
         Args:
             enterprise_configuration (MoodleEnterpriseCustomerConfiguration): An enterprise customers's
             configuration model for connecting with Moodle
         """
-        super(MoodleAPIClient, self).__init__(enterprise_configuration)
+        super().__init__(enterprise_configuration)
         self.config = apps.get_app_config('moodle')
         self.token = enterprise_configuration.token or self._get_access_token()
 
-    def _post(self, additional_params, method_url=None):
+    def _post(self, additional_params):
         """
         Compile common params and run request's post function
         """
+        headers = {
+            'Content-Type': 'application/x-www-form-urlencoded',
+        }
         params = {
             'wstoken': self.token,
             'moodlewsrestformat': 'json',
         }
         params.update(additional_params)
-        if method_url:
-            response = requests.post(
-                url='{url}&{querystring}'.format(
-                    url=method_url,
-                    querystring=urlencode(params)
-                )
-            )
-        else:
-            response = requests.post(
-                url='{url}{api_path}?{querystring}'.format(
-                    url=self.enterprise_configuration.moodle_base_url,
-                    api_path=self.MOODLE_API_PATH,
-                    querystring=urlencode(params)
-                )
-            )
+
+        response = requests.post(
+            url=urljoin(
+                self.enterprise_configuration.moodle_base_url,
+                self.MOODLE_API_PATH,
+            ),
+            data=params,
+            headers=headers
+        )
+
         return response
 
+    @moodle_request_wrapper
+    def _wrapped_post(self, additional_params):
+        """
+        A version of _post which handles error cases, useful
+        for when the caller wants to examine errors
+        """
+        return self._post(additional_params)
+
     def _get_access_token(self):
         """
         Obtains a new access token from Moodle using username and password.
         """
         querystring = {
             'service': self.enterprise_configuration.service_short_name
         }
@@ -154,19 +178,19 @@
             },
         )
 
         try:
             data = response.json()
             token = data['token']
             return token
-        except (KeyError, ValueError):
+        except (KeyError, ValueError) as error:
             raise ClientError(
                 "Failed to post access token. Received message={} from Moodle".format(response.text),
                 response.status_code
-            )
+            ) from error
 
     @moodle_request_wrapper
     def _get_enrolled_users(self, course_id):
         """
         Helper method to make a request for all user enrollments under a Moodle course ID.
         """
         params = {
@@ -226,22 +250,21 @@
         to be the edX integrated Final Grade. This is currently done by module name.
 
         Returns:
             - course_module_id (int): The ID of the shell assignment
             - module_name (string): The string name of the module. Required for sending a grade update request.
         """
         response = self._get_course_contents(course_id)
-
         course_module_id = None
         if isinstance(response.json(), list):
             for course in response.json():
                 if course.get('name') == 'General':
                     modules = course.get('modules')
                     for module in modules:
-                        if module.get('name') == MOODLE_FINAL_GRADE_ASSIGNMENT_NAME:
+                        if module.get('name') == self.enterprise_configuration.grade_assignment_name:
                             course_module_id = module.get('id')
                             module_name = module.get('modname')
 
         if not course_module_id:
             raise ClientError(
                 'MoodleAPIClient request failed: 404 Completion course module not found in Moodle.'
                 ' The enterprise customer needs to create an activity within the course with the name '
@@ -254,40 +277,50 @@
     def _get_courses(self, key):
         """
         Gets courses from Moodle by key (because we cannot update/delete without it).
         """
         params = {
             'wstoken': self.token,
             'wsfunction': 'core_course_get_courses_by_field',
-            'field': 'shortname',
+            'field': 'idnumber',
             'value': key,
             'moodlewsrestformat': 'json'
         }
         response = requests.get(
             urljoin(
                 self.enterprise_configuration.moodle_base_url,
                 self.MOODLE_API_PATH,
             ),
             params=params
         )
         return response
 
-    def get_course_id(self, key):
+    def _get_course_id(self, key):
         """
-        Obtain course from Moodle by course key and parse out the id.
+        Obtain course from Moodle by course key and parse out the id. No exception thrown.
         """
         response = self._get_courses(key)
         parsed_response = json.loads(response.text)
         if not parsed_response.get('courses'):
+            return None
+        else:
+            return parsed_response['courses'][0]['id']
+
+    def get_course_id(self, key):
+        """
+        Obtain course from Moodle by course key and parse out the id. Raise on not found.
+        """
+        course_id = self._get_course_id(key)
+        if not course_id:
             raise ClientError(
                 'MoodleAPIClient request failed: 404 Course key '
                 '"{}" not found in Moodle.'.format(key),
                 HTTPStatus.NOT_FOUND.value
             )
-        return parsed_response['courses'][0]['id']
+        return course_id
 
     @moodle_request_wrapper
     def _wrapped_create_course_completion(self, user_id, payload):
         """
         Wrapped method to request and use Moodle course and user information in order
         to post a final course grade for the user.
         """
@@ -302,64 +335,109 @@
             'source': module_name,
             'courseid': course_id,
             'component': 'mod_assign',
             'activityid': course_module_id,
             'itemnumber': 0,
             'grades[0][studentid]': moodle_user_id,
             # The grade is exported as a decimal between [0-1]
-            'grades[0][grade]': completion_data['grade'] * 100
+            'grades[0][grade]': completion_data['grade'] * self.enterprise_configuration.grade_scale
         }
         return self._post(params)
 
-    @moodle_request_wrapper
     def create_content_metadata(self, serialized_data):
         """
         The below assumes the data is dict/object.
         Format should look like:
         {
           courses[0][shortname]: 'value',
           courses[0][fullname]: 'value',
           [...]
           courses[1][shortname]: 'value',
           courses[1][fullname]: 'value',
           [...]
         }
+        when sending 1 course and its a dupe, treat as success.
+        when sending N courses and a dupe exists, throw exception since
+        there is no easy way to retry with just the non-dupes.
         """
+        # check to see if more than 1 course is being passed
+        more_than_one_course = serialized_data.get('courses[1][shortname]')
         serialized_data['wsfunction'] = 'core_course_create_courses'
-        response = self._post(serialized_data)
-        return response
+        try:
+            response = self._wrapped_post(serialized_data)
+        except MoodleClientError as error:
+            # treat duplicate as successful, but only if its a single course
+            # set chunk size settings to 1 if youre seeing a lot of these errors
+            if error.moodle_error == 'shortnametaken' and not more_than_one_course:
+                return 200, "shortnametaken"
+            elif error.moodle_error == 'courseidnumbertaken' and not more_than_one_course:
+                return 200, "courseidnumbertaken"
+            else:
+                raise error
+        return response.status_code, response.text
 
-    @moodle_request_wrapper
     def update_content_metadata(self, serialized_data):
-        for key in list(serialized_data):
-            if 'shortname' in key:
-                moodle_course_id = self.get_course_id(serialized_data[key])
-                serialized_data[key.replace('shortname', 'id')] = moodle_course_id
-        serialized_data['wsfunction'] = 'core_course_update_courses'
-        return self._post(serialized_data)
+        moodle_course_id = self._get_course_id(serialized_data['courses[0][idnumber]'])
+        # if we cannot find the course, lets create it
+        if moodle_course_id:
+            serialized_data['courses[0][id]'] = moodle_course_id
+            serialized_data['wsfunction'] = 'core_course_update_courses'
+            response = self._wrapped_post(serialized_data)
+            return response.status_code, response.text
+        else:
+            return self.create_content_metadata(serialized_data)
 
-    @moodle_request_wrapper
     def delete_content_metadata(self, serialized_data):
-        course_ids_to_delete = []
-        for key in list(serialized_data):
-            if 'shortname' in key:
-                moodle_course_id = self.get_course_id(serialized_data[key])
-                course_ids_to_delete.append(('courseids[]', moodle_course_id))
+        response = self._get_courses(serialized_data['courses[0][idnumber]'])
+        parsed_response = json.loads(response.text)
+        if not parsed_response.get('courses'):
+            LOGGER.info(
+                generate_formatted_log(
+                    self.enterprise_configuration.channel_code(),
+                    self.enterprise_configuration.enterprise_customer.uuid,
+                    None,
+                    None,
+                    'No course found while attempting to delete edX course: '
+                    f'{serialized_data["courses[0][idnumber]"]} from moodle.'
+                )
+            )
+            # Hacky way of getting around the request wrapper validation
+            rsp = requests.Response()
+            rsp._content = bytearray('{"result": "Course not found."}', 'utf-8')  # pylint: disable=protected-access
+            return rsp
+        moodle_course_id = parsed_response['courses'][0]['id']
         params = {
             'wsfunction': 'core_course_delete_courses',
+            'courseids[]': moodle_course_id
         }
-        url = '{url}{api_path}?{querystring}'.format(
-            url=self.enterprise_configuration.moodle_base_url,
-            api_path=self.MOODLE_API_PATH,
-            querystring=urlencode(course_ids_to_delete))
-        return self._post(params, url)
+        response = self._wrapped_post(params)
+        return response.status_code, response.text
+
+    def create_assessment_reporting(self, user_id, payload):
+        """
+        Not implemented yet
+        """
+
+    def cleanup_duplicate_assignment_records(self, courses):
+        """
+        Not implemented yet.
+        """
+        LOGGER.error(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                None,
+                "Moodle integrated channel does not yet support assignment deduplication."
+            )
+        )
 
     def create_course_completion(self, user_id, payload):
         """Send course completion data to Moodle"""
         # The base integrated channels transmitter expects a tuple of (code, body),
         # but we need to wrap the requests
         resp = self._wrapped_create_course_completion(user_id, payload)
         return resp.status_code, resp.text
 
     @moodle_request_wrapper
-    def delete_course_completion(self, user_id, payload):  # pylint: disable=unused-argument
+    def delete_course_completion(self, user_id, payload):
         pass
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/statements/learner_course_completion.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/statements/learner_course_completion.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,9 +1,7 @@
-# -*- coding: utf-8 -*-
-
 """
 xAPI statement for course completion.
 """
 
 from tincan import LanguageMap, Result, Score, Verb
 
 from integrated_channels.xapi.constants import MAX_SCORE, MIN_SCORE, X_API_VERB_COMPLETED
@@ -27,15 +25,15 @@
         """
         kwargs.update(
             actor=self.get_actor(user, user_social_auth),
             verb=self.get_verb(),
             object=self.get_object(site.domain, course_overview, object_type),
             result=self.get_result(course_grade),
         )
-        super(LearnerCourseCompletionStatement, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
 
     def get_verb(self):
         """
         Get verb for the statement.
         """
         return Verb(
             id=X_API_VERB_COMPLETED,
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/statements/base.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/statements/base.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,7 @@
-# -*- coding: utf-8 -*-
-
 """
 Statements base for xAPI.
 """
 
 from tincan import Activity, ActivityDefinition, Agent, LanguageMap, Statement
 
 from integrated_channels.xapi.constants import X_API_ACTIVITY_COURSE
@@ -33,15 +31,15 @@
         Arguments:
             user (User): User.
             user_social_auth (UserSocialAuth): UserSocialAuth.
         """
         name = self._get_actor_name(user, user_social_auth)
         return Agent(
             name=name,
-            mbox=u'mailto:{email}'.format(email=user.email),
+            mbox='mailto:{email}'.format(email=user.email),
         )
 
     def get_object(self, domain, course_overview, object_type):
         """
         Returns the object (activity) component of the Enterprise xAPI statement.
         Arguments:
             course_overview (CourseOverview): CourseOverview.
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/statements/learner_course_enrollment.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/statements/learner_course_enrollment.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,9 +1,7 @@
-# -*- coding: utf-8 -*-
-
 """
 xAPI statement for learner course enrollment.
 """
 
 from tincan import LanguageMap, Verb
 
 from integrated_channels.xapi.constants import X_API_VERB_REGISTERED
@@ -26,15 +24,15 @@
             course_overview (CourseOverview): course overview object containing course details.
         """
         kwargs.update(
             actor=self.get_actor(user, user_social_auth),
             verb=self.get_verb(),
             object=self.get_object(site.domain, course_overview, object_type)
         )
-        super(LearnerCourseEnrollmentStatement, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
 
     def get_verb(self):
         """
         Get verb for course enrollment statement.
         """
         return Verb(
             id=X_API_VERB_REGISTERED,
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/migrations/0001_initial.py` & `edx-enterprise-4.0.0/integrated_channels/cornerstone/migrations/0011_auto_20211103_1855.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,31 +1,33 @@
-# -*- coding: utf-8 -*-
+# Generated by Django 3.2.9 on 2021-11-03 18:55
 
-
-import django.utils.timezone
 from django.db import migrations, models
 
-import model_utils.fields
-
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('enterprise', '0050_progress_v2'),
+        ('cornerstone', '0010_cornerstonecoursekey'),
     ]
 
     operations = [
-        migrations.CreateModel(
-            name='XAPILRSConfiguration',
-            fields=[
-                ('id', models.AutoField(verbose_name='ID', primary_key=True, serialize=False, auto_created=True)),
-                ('created', model_utils.fields.AutoCreatedField(verbose_name='created', default=django.utils.timezone.now, editable=False)),
-                ('modified', model_utils.fields.AutoLastModifiedField(verbose_name='modified', default=django.utils.timezone.now, editable=False)),
-                ('version', models.CharField(help_text='Version of X-API.', default='1.0.1', max_length=16)),
-                ('endpoint', models.URLField(help_text='URL of the LRS.')),
-                ('key', models.CharField(help_text='Key of X-API LRS.', verbose_name='Client ID', max_length=255)),
-                ('secret', models.CharField(help_text='secret of X-API LRS.', verbose_name='Client Secret', max_length=255)),
-                ('active', models.BooleanField(help_text='Is this configuration active?')),
-                ('enterprise_customer', models.OneToOneField(to='enterprise.EnterpriseCustomer', help_text='Enterprise Customer associated with the configuration.', on_delete=models.CASCADE)),
-            ],
+        migrations.AddField(
+            model_name='cornerstoneenterprisecustomerconfiguration',
+            name='session_token',
+            field=models.CharField(blank=True, help_text="The most current session token provided for authorization to make API calls to the customer's instance", max_length=255, verbose_name='Cornerstone Session Token'),
+        ),
+        migrations.AddField(
+            model_name='cornerstoneenterprisecustomerconfiguration',
+            name='session_token_modified',
+            field=models.DateTimeField(blank=True, help_text='Date time when session token was last provided', null=True),
+        ),
+        migrations.AddField(
+            model_name='historicalcornerstoneenterprisecustomerconfiguration',
+            name='session_token',
+            field=models.CharField(blank=True, help_text="The most current session token provided for authorization to make API calls to the customer's instance", max_length=255, verbose_name='Cornerstone Session Token'),
+        ),
+        migrations.AddField(
+            model_name='historicalcornerstoneenterprisecustomerconfiguration',
+            name='session_token_modified',
+            field=models.DateTimeField(blank=True, help_text='Date time when session token was last provided', null=True),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/migrations/0002_auto_20180726_0142.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/migrations/0002_auto_20180726_0142.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,7 @@
-# -*- coding: utf-8 -*-
-
-
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
         ('xapi', '0001_initial'),
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/utils.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,17 +1,13 @@
-# -*- coding: utf-8 -*-
-
 """
 Utility functions for xAPI.
 """
 
 import logging
 
-import six
-
 from enterprise.tpa_pipeline import get_user_social_auth
 from integrated_channels.exceptions import ClientError
 from integrated_channels.xapi.client import EnterpriseXAPIClient
 from integrated_channels.xapi.statements.learner_course_completion import LearnerCourseCompletionStatement
 from integrated_channels.xapi.statements.learner_course_enrollment import LearnerCourseEnrollmentStatement
 
 LOGGER = logging.getLogger(__name__)
@@ -75,15 +71,15 @@
 
     Arguments:
          lrs_configuration (XAPILRSConfiguration): XAPILRSConfiguration instance where to send statements.
          user (User): User object.
          course_overview (CourseOverview): CourseOverview object containing course details.
     """
     event_type = 'enrollment'
-    course_id = course_overview.course_key if object_type == 'course' else six.text_type(course_overview.id)
+    course_id = course_overview.course_key if object_type == 'course' else str(course_overview.id)
     username = user.username if user else 'Unavailable'
     user_social_auth = get_user_social_auth(user, lrs_configuration.enterprise_customer)
 
     statement = LearnerCourseEnrollmentStatement(
         lrs_configuration.enterprise_customer.site,
         user,
         user_social_auth,
@@ -113,15 +109,15 @@
     Arguments:
          lrs_configuration (XAPILRSConfiguration): XAPILRSConfiguration instance where to send statements.
          user (User): User object.
          course_overview (CourseOverview): Course overview object containing course details.
          course_grade (CourseGrade): Course grade object.
     """
     event_type = 'completion'
-    course_id = course_overview.course_key if object_type == 'course' else six.text_type(course_overview.id)
+    course_id = course_overview.course_key if object_type == 'course' else str(course_overview.id)
     username = user.username if user else 'Unavailable'
     user_social_auth = get_user_social_auth(user, lrs_configuration.enterprise_customer)
 
     statement = LearnerCourseCompletionStatement(
         lrs_configuration.enterprise_customer.site,
         user,
         user_social_auth,
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/models.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/models.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,26 +1,25 @@
-# -*- coding: utf-8 -*-
-
 """
 Models for xAPI.
 """
 
 import base64
 
-from django.contrib.auth.models import User
+from django.contrib import auth
 from django.db import models
-from django.utils.encoding import python_2_unicode_compatible
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from model_utils.models import TimeStampedModel
 
 from enterprise.models import EnterpriseCustomer
+from integrated_channels.integrated_channel.models import LearnerDataTransmissionAudit
+
+User = auth.get_user_model()
 
 
-@python_2_unicode_compatible
 class XAPILRSConfiguration(TimeStampedModel):
     """
     xAPI LRS configurations.
 
     .. no_pii:
     """
 
@@ -64,40 +63,33 @@
         Authorization header for authenticating requests to LRS.
         """
         return 'Basic {}'.format(
             base64.b64encode('{key}:{secret}'.format(key=self.key, secret=self.secret).encode()).decode()
         )
 
 
-@python_2_unicode_compatible
-class XAPILearnerDataTransmissionAudit(TimeStampedModel):
+class XAPILearnerDataTransmissionAudit(LearnerDataTransmissionAudit):
     """
     The payload we sent to XAPI at a given point in time for an enterprise course enrollment.
 
     .. no_pii:
     """
 
     user = models.ForeignKey(
         User,
         blank=False,
         null=False,
         related_name='xapi_transmission_audit',
         on_delete=models.CASCADE,
     )
-    enterprise_course_enrollment_id = models.PositiveIntegerField(db_index=True, blank=True, null=True)
-    course_id = models.CharField(max_length=255, blank=False, null=False, db_index=True)
-    course_completed = models.BooleanField(default=False)
-    completed_timestamp = models.DateTimeField(null=True, blank=True)
-    grade = models.CharField(max_length=255, null=True, blank=True)
-    status = models.CharField(max_length=100, blank=False, null=False)
-    error_message = models.TextField(blank=True, null=True)
 
     class Meta:
         app_label = 'xapi'
         unique_together = ("user", "course_id")
+        index_together = ['enterprise_customer_uuid', 'plugin_configuration_id']
 
     def __str__(self):
         """
         Return a human-readable string representation of the object.
         """
         return (
             '<XAPILearnerDataTransmissionAudit {transmission_id} for enterprise enrollment '
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/management/commands/send_course_completions.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/management/commands/send_course_enrollments.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,41 +1,33 @@
-# -*- coding: utf-8 -*-
 """
 Send xAPI statements to the LRS configured via admin.
 """
 
+import datetime
 from logging import getLogger
 
-import six
-
-from django.contrib.auth.models import User
 from django.core.management.base import BaseCommand, CommandError
 
 from enterprise.api_client.discovery import get_course_catalog_api_service_client
-from enterprise.models import EnterpriseCourseEnrollment, EnterpriseCustomer, EnterpriseCustomerUser
+from enterprise.models import EnterpriseCourseEnrollment, EnterpriseCustomer
 from enterprise.utils import NotConnectedToOpenEdX
 from integrated_channels.xapi.models import XAPILearnerDataTransmissionAudit, XAPILRSConfiguration
-from integrated_channels.xapi.utils import is_success_response, send_course_completion_statement
-
-try:
-    from lms.djangoapps.grades.models import PersistentCourseGrade
-except ImportError:
-    PersistentCourseGrade = None
+from integrated_channels.xapi.utils import is_success_response, send_course_enrollment_statement
 
 try:
-    from openedx.core.djangoapps.content.course_overviews.models import CourseOverview
+    from common.djangoapps.student.models import CourseEnrollment
 except ImportError:
-    CourseOverview = None
+    CourseEnrollment = None
 
 LOGGER = getLogger(__name__)
 
 
 class Command(BaseCommand):
     """
-    Send course completion xAPI statements to enterprise customers.
+    Send xAPI statements to all Enterprise Customers.
     """
 
     def add_arguments(self, parser):
         """
         Add required arguments to the parser.
         """
         parser.add_argument(
@@ -49,279 +41,269 @@
         parser.add_argument(
             '--enterprise_customer_uuid',
             dest='enterprise_customer_uuid',
             type=str,
             required=False,
             help='Send xAPI analytics for this enterprise customer only.'
         )
-        super(Command, self).add_arguments(parser)
+        super().add_arguments(parser)
 
     @staticmethod
-    def parse_arguments(*args, **options):  # pylint: disable=unused-argument
+    def parse_arguments(*args, **options):
         """
-        Parse and validate arguments for the command.
+        Parse and validate arguments for send_course_enrollments command.
 
         Arguments:
             *args: Positional arguments passed to the command
-            **options: Optional arguments passed to the command
+            **options: optional arguments passed to the command
 
         Returns:
             A tuple containing parsed values for
             1. days (int): Integer showing number of days to lookup enterprise enrollments,
                 course completion etc and send to xAPI LRS
             2. enterprise_customer_uuid (EnterpriseCustomer): Enterprise Customer if present then
                 send xAPI statements just for this enterprise.
         """
         days = options.get('days', 1)
         enterprise_customer_uuid = options.get('enterprise_customer_uuid')
         enterprise_customer = None
 
         if enterprise_customer_uuid:
             try:
-                # pylint: disable=no-member
                 enterprise_customer = EnterpriseCustomer.objects.get(uuid=enterprise_customer_uuid)
-            except EnterpriseCustomer.DoesNotExist:
+            except EnterpriseCustomer.DoesNotExist as no_user_error:
                 raise CommandError('Enterprise customer with uuid "{enterprise_customer_uuid}" does not exist.'.format(
                     enterprise_customer_uuid=enterprise_customer_uuid
-                ))
+                )) from no_user_error
 
         return days, enterprise_customer
 
     def handle(self, *args, **options):
         """
         Send xAPI statements.
         """
-        if not all((PersistentCourseGrade, CourseOverview)):
+        if not CourseEnrollment:
             raise NotConnectedToOpenEdX("This package must be installed in an OpenEdX environment.")
 
         days, enterprise_customer = self.parse_arguments(*args, **options)
 
         if enterprise_customer:
             try:
                 lrs_configuration = XAPILRSConfiguration.objects.get(
                     active=True,
                     enterprise_customer=enterprise_customer
                 )
-            except XAPILRSConfiguration.DoesNotExist:
+            except XAPILRSConfiguration.DoesNotExist as no_config_error:
                 raise CommandError('No xAPI Configuration found for "{enterprise_customer}"'.format(
                     enterprise_customer=enterprise_customer.name
-                ))
+                )) from no_config_error
 
             # Send xAPI analytics data to the configured LRS
             self.send_xapi_statements(lrs_configuration, days)
         else:
             for lrs_configuration in XAPILRSConfiguration.objects.filter(active=True):
                 self.send_xapi_statements(lrs_configuration, days)
 
     def send_xapi_statements(self, lrs_configuration, days):
         """
         Send xAPI analytics data of the enterprise learners to the given LRS.
 
         Arguments:
             lrs_configuration (XAPILRSConfiguration): Configuration object containing LRS configurations
                 of the LRS where to send xAPI  learner analytics.
-
-            days (Numeric):  Deprecated.  Original implementation utilized a "days" parameter to limit
-                the number of enrollments transmitted, but this proved to be more problematic than helpful.
+            days (int): Include course enrollment of this number of days.
         """
-        enterprise_course_enrollments = self.get_enterprise_course_enrollments(lrs_configuration.enterprise_customer)
-        enterprise_enrollment_ids = self.get_enterprise_enrollment_ids(enterprise_course_enrollments)
-        xapi_transmission_queryset = self.get_xapi_transmission_queryset(enterprise_enrollment_ids)
-        pertinent_enrollment_ids = self.get_pertinent_enrollment_ids(xapi_transmission_queryset)
-        pertinent_enrollments = self.get_pertinent_enrollments(enterprise_course_enrollments, pertinent_enrollment_ids)
-        enrollment_grades = self.get_course_completions(pertinent_enrollments)
-        users = self.prefetch_users(enrollment_grades)
-        course_overviews = self.prefetch_courses(enrollment_grades)
+        course_enrollments = self.get_course_enrollments(lrs_configuration.enterprise_customer, days)
         course_catalog_client = get_course_catalog_api_service_client(site=lrs_configuration.enterprise_customer.site)
+        for course_enrollment in course_enrollments:
 
-        for xapi_transmission in xapi_transmission_queryset:
-
-            object_type = self.get_object_type(xapi_transmission)
-
-            try:
-                course_grade = enrollment_grades[xapi_transmission.enterprise_course_enrollment_id]
-            except KeyError:
-                continue
-
-            user = users.get(course_grade.user_id)
-            courserun_id = six.text_type(course_grade.course_id)
-            course_overview = course_overviews.get(course_grade.course_id)
+            course_overview = course_enrollment.course
+            courserun_id = str(course_overview.id)
             course_run_identifiers = course_catalog_client.get_course_run_identifiers(courserun_id)
             course_overview.course_key = course_run_identifiers['course_key']
             course_overview.course_uuid = course_run_identifiers['course_uuid']
 
-            default_error_message = 'Days argument has been deprecated.  Value: {days}'.format(days=days)
-            response_fields = {'status': 500, 'error_message': default_error_message}
-            response_fields = send_course_completion_statement(
+            response_fields = Command.transmit_course_enrollment_statement(
                 lrs_configuration,
-                user,
-                course_overview,
-                course_grade,
-                object_type,
-                response_fields
+                course_enrollment.user,
+                course_overview
             )
 
             if is_success_response(response_fields):
-                self.save_xapi_learner_data_transmission_audit(
-                    xapi_transmission,
-                    course_grade.percent_grade,
-                    1,
-                    course_grade.passed_timestamp,
-                    response_fields.get('status'),
-                    response_fields.get('error_message')
+                Command.transmit_courserun_enrollment_statement(
+                    lrs_configuration,
+                    course_enrollment.user,
+                    course_overview
                 )
 
     @staticmethod
-    def get_object_type(xapi_transmission):
-        """
-        Returns the object type for the xAPI transmission based on the course object identifier
-        """
-        object_type = 'course'
-        if 'course-v1' in xapi_transmission.course_id:
-            object_type = 'courserun'
-        return object_type
-
-    def get_enterprise_course_enrollments(self, enterprise_customer):
+    def transmit_enrollment_statement(lrs_configuration, user, course_overview, object_type):
         """
-        Retrieves the set of EnterpriseCourseEnrollment records for the specified EnterpriseCustomer
+        Transmits an xAPI enrollment statement for the specified object type.  If successful,
+        records a transmission audit record.
         """
-        return EnterpriseCourseEnrollment.objects.filter(
-            enterprise_customer_user_id__enterprise_customer=enterprise_customer
+        response_fields = {'status': 500, 'error_message': None}
+        response_fields = send_course_enrollment_statement(
+            lrs_configuration,
+            user,
+            course_overview,
+            object_type,
+            response_fields
         )
 
-    def get_enterprise_enrollment_ids(self, enterprise_course_enrollments):
-        """
-        Extracts the identifiers from the provided EnterprsieCourseEnrollment queryset.
-        """
-        return enterprise_course_enrollments.values_list('id', flat=True)
+        return response_fields
 
     @staticmethod
-    def get_xapi_transmission_queryset(enterprise_enrollment_ids):
+    def transmit_course_enrollment_statement(lrs_configuration, user, course_overview):
         """
-        Retrieves the xAPI transmission records for the specified list of EnterpriseCourseEnrollment identifiers
+        Transmits an xAPI enrollment statement for a course object
         """
-        return XAPILearnerDataTransmissionAudit.objects.filter(
-            enterprise_course_enrollment_id__in=enterprise_enrollment_ids,
-            course_completed=0,
-        )
+        object_type = 'course'
+        response_fields = Command.transmit_enrollment_statement(lrs_configuration, user, course_overview, object_type)
 
-    @staticmethod
-    def get_pertinent_enrollment_ids(xapi_transmission_queryset):
-        """
-        Returns the set of enterprise course enrollment identifiers from the
-        provided set of xAPI transmission records.
-        """
-        return xapi_transmission_queryset.values_list('enterprise_course_enrollment_id', flat=True)
+        if is_success_response(response_fields):
+            courserun_id = str(course_overview.id)
+            enterprise_course_enrollment_id = EnterpriseCourseEnrollment.get_enterprise_course_enrollment_id(
+                user,
+                courserun_id,
+                lrs_configuration.enterprise_customer
+            )
 
-    def get_pertinent_enrollments(self, enterprise_course_enrollments, pertinent_enrollment_ids):
-        """
-        Returns the subset of enterprise course enrollments matching the list of provided identfiers
-        """
-        return enterprise_course_enrollments.filter(id__in=pertinent_enrollment_ids)
+            Command.save_xapi_learner_data_transmission_audit(
+                user,
+                course_overview.course_key,
+                enterprise_course_enrollment_id,
+                response_fields.get('status'),
+                response_fields.get('error_message')
+            )
+        return response_fields
 
     @staticmethod
-    def get_lms_user_id_from_enrollment(enterprise_course_enrollment):
+    def transmit_courserun_enrollment_statement(lrs_configuration, user, course_overview):
         """
-        Retrieves the corresponding User identifier for the specified EnterpriseCourseEnrollment record
+        Transmits an xAPI enrollment statement for a courserun object
         """
-        return EnterpriseCustomerUser.objects.get(id=enterprise_course_enrollment.enterprise_customer_user_id).user_id
+        object_type = 'courserun'
+        response_fields = Command.transmit_enrollment_statement(lrs_configuration, user, course_overview, object_type)
 
-    @staticmethod
-    def get_grade_record_for_enrollment(enterprise_course_enrollment):
-        """
-        Retrieves the corresponding PersistentCourseGrade record (if available)
-        for the specified EnterpriseCourseEnrollment record
-        """
-        lms_user_id = Command.get_lms_user_id_from_enrollment(enterprise_course_enrollment)
-        course_id = enterprise_course_enrollment.course_id
-        grade_records = PersistentCourseGrade.objects.filter(
-            user_id=lms_user_id,
-            course_id=course_id,
-            passed_timestamp__isnull=False
-        )
-        return grade_records.first()
+        if is_success_response(response_fields):
+            courserun_id = str(course_overview.id)
+            enterprise_course_enrollment_id = EnterpriseCourseEnrollment.get_enterprise_course_enrollment_id(
+                user,
+                courserun_id,
+                lrs_configuration.enterprise_customer
+            )
+
+            Command.save_xapi_learner_data_transmission_audit(
+                user,
+                courserun_id,
+                enterprise_course_enrollment_id,
+                response_fields.get('status'),
+                response_fields.get('error_message')
+            )
+        return response_fields
 
     @staticmethod
-    def get_course_completions(enterprise_course_enrollments):
+    def is_already_transmitted(xapi_transmissions, user_id, course_id):
         """
-        Get course completions via PersistentCourseGrade for all the learners of given enterprise customer.
+        Determines if an xAPI transmission has already taken place for the specified enrollment
 
         Arguments:
-            enterprise_customer (EnterpriseCustomer): Include Course enrollments for learners
-                of this enterprise customer.
-            days (int): Include course enrollment of this number of days.
-
-        Returns:
-            (list): A list of PersistentCourseGrade objects.
+            xapi_transmissions (QuerySet)
+            user_id (Numeric)
+            course_id (String)
 
+        Returns
+            Queryset
         """
-        ece_grades = {}
-        for ece in enterprise_course_enrollments:
-            grade_record = Command.get_grade_record_for_enrollment(ece)
-            if grade_record is not None:
-                ece_grades.setdefault(ece.id, grade_record)
-        return ece_grades
+        return xapi_transmissions.filter(user_id=user_id, course_id=course_id)
 
     @staticmethod
-    def prefetch_users(enrollment_grades):
+    def get_pertinent_course_enrollments(course_enrollments, xapi_transmissions):
         """
-        Prefetch Users from the list of user_ids present in the persistent_course_grades.
+        Compares course enrollments to xAPI transmission records and determines which
+        enrollments have not yet been transmitted
 
         Arguments:
-            enrollment_grades (list): A list of PersistentCourseGrade.
+            course_enrollments (QuerySet)
+            xapi_transmissions (QuerySet)
 
-        Returns:
-            (dict): A dictionary containing user_id to user mapping.
+        Returns
+            list
         """
-        users = User.objects.filter(
-            id__in=[grade.user_id for grade in enrollment_grades.values()]
-        )
-        return {
-            user.id: user for user in users
-        }
+        pertinent_enrollments = []
+        for enrollment in course_enrollments:
+            if not Command.is_already_transmitted(xapi_transmissions, enrollment.user_id, enrollment.course_id):
+                pertinent_enrollments.append(enrollment)
+        return pertinent_enrollments
 
-    def prefetch_courses(self, enrollment_grades):
+    def get_course_enrollments(self, enterprise_customer, days):
         """
-        Prefetch courses from the list of course_ids present in the persistent_course_grades.
+        Get course enrollments for all the learners of given enterprise customer.
 
         Arguments:
-            persistent_course_grades (list): A list of PersistentCourseGrade.
+            enterprise_customer (EnterpriseCustomer): Include Course enrollments for learners
+                of this enterprise customer.
+            days (int): Include course enrollment of this number of days.
 
         Returns:
-            (dict): A dictionary containing course_id to course_overview mapping.
+            (list): A list of CourseEnrollment objects.
         """
-        return CourseOverview.get_from_ids(
-            [grade.course_id for grade in enrollment_grades.values()]
+        enterprise_enrollment_ids = EnterpriseCourseEnrollment.objects.filter(
+            enterprise_customer_user__enterprise_customer=enterprise_customer
+        )
+        xapi_transmissions = XAPILearnerDataTransmissionAudit.objects.filter(
+            enterprise_course_enrollment_id__in=enterprise_enrollment_ids
+        )
+
+        course_enrollments = CourseEnrollment.objects.filter(
+            created__gt=datetime.datetime.now() - datetime.timedelta(days=days)
+        ).filter(user_id__in=enterprise_customer.enterprise_customer_users.values_list('user_id', flat=True))
+
+        pertinent_enrollments = self.get_pertinent_course_enrollments(course_enrollments, xapi_transmissions)
+
+        LOGGER.info(
+            '[Integrated Channel][xAPI] Found %s course enrollments for enterprise customer: [%s] during last %s days',
+            len(pertinent_enrollments),
+            enterprise_customer,
+            days,
         )
 
-    def save_xapi_learner_data_transmission_audit(self, xapi_transmission,
-                                                  course_grade, course_completed, completed_timestamp,
+        return pertinent_enrollments
+
+    @staticmethod
+    def save_xapi_learner_data_transmission_audit(user, course_id, enterprise_course_enrollment_id,
                                                   status, error_message):
+
         """
         Capture interesting information about the xAPI enrollment (registration) event transmission.
 
         Arguments:
-            xapi_transmission (XAPILearnerDataTransmissionAudit): Transmission audit object being updated
-            course_grade (Numeric): Grade value for the enrollment
-            course_completed: (Boolean/Numeric): Whether or not the enrollment is considered complete.
-            completed_timestamp (Datetime): The point in time when completion occurred.
+            user (User): User object
+            course_id (String): Course or courserun key
+            enterprise_course_enrollment_id (Numeric): EnterpriseCourseEnrollment identifier
             status (Numeric):  The response status code
             error_message (String):  Information describing any error state provided by the caller
 
         Returns:
             None
         """
-        xapi_transmission.course_completed = course_completed
-        xapi_transmission.completed_timestamp = completed_timestamp
-        xapi_transmission.grade = course_grade
-        xapi_transmission.status = status
-        xapi_transmission.error_message = error_message
-        xapi_transmission.save()
 
-        LOGGER.info(
-            "[Integrated Channel][xAPI] Successfully updated the XAPILearnerDataTransmissionAudit object with id: {id}"
-            ", user: {username} and course: {course_id}".format(
-                id=xapi_transmission.id,
-                username=xapi_transmission.user.username,
-                course_id=xapi_transmission.course_id
-            )
+        xapi_transmission, created = XAPILearnerDataTransmissionAudit.objects.get_or_create(
+            user=user,
+            course_id=course_id,
+            defaults={
+                'enterprise_course_enrollment_id': enterprise_course_enrollment_id,
+                'status': status,
+                'error_message': error_message
+            }
         )
+
+        if created:
+            LOGGER.info(
+                "[Integrated Channel][xAPI] Successfully created the XAPILearnerDataTransmissionAudit object with "
+                "id: {id}, user: {username} and course: {course_id}".format(
+                    id=xapi_transmission.id,
+                    username=xapi_transmission.user.username,
+                    course_id=xapi_transmission.course_id
+                )
+            )
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/management/commands/send_course_enrollments.py` & `edx-enterprise-4.0.0/enterprise/management/commands/email_drip_for_missing_dsc_records.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,313 +1,216 @@
-# -*- coding: utf-8 -*-
 """
-Send xAPI statements to the LRS configured via admin.
+Django management command for sending an email to learners with missing DataSharingConsent records.
 """
-
 import datetime
-from logging import getLogger
-
-import six
-
-from django.core.management.base import BaseCommand, CommandError
-
-from enterprise.api_client.discovery import get_course_catalog_api_service_client
-from enterprise.models import EnterpriseCourseEnrollment, EnterpriseCustomer
-from enterprise.utils import NotConnectedToOpenEdX
-from integrated_channels.xapi.models import XAPILearnerDataTransmissionAudit, XAPILRSConfiguration
-from integrated_channels.xapi.utils import is_success_response, send_course_enrollment_statement
+import logging
+from datetime import timedelta
+from urllib.parse import urljoin
+
+from django.conf import settings
+from django.core.management import BaseCommand
+from django.urls import reverse
+from django.utils import timezone
+
+from consent.models import DataSharingConsent, ProxyDataSharingConsent
+from enterprise import utils
+from enterprise.api_client.discovery import CourseCatalogApiClient
+from enterprise.models import EnterpriseCourseEnrollment
+from enterprise.utils import get_configuration_value, parse_lms_api_datetime
 
 try:
-    from student.models import CourseEnrollment
+    from openedx.features.enterprise_support.utils import is_course_accessed
 except ImportError:
-    CourseEnrollment = None
+    is_course_accessed = None
 
-LOGGER = getLogger(__name__)
+LOGGER = logging.getLogger(__name__)
 
 
 class Command(BaseCommand):
     """
-    Send xAPI statements to all Enterprise Customers.
+    Django management command for sending an email to learners with missing DataSharingConsent records
     """
 
-    def add_arguments(self, parser):
-        """
-        Add required arguments to the parser.
+    def _get_course_properties(self, user, course_id, enterprise_customer):
         """
-        parser.add_argument(
-            '--days',
-            dest='days',
-            required=False,
-            type=int,
-            default=1,
-            help='Send xAPI analytics for learners who enrolled during last this number of days.'
-        )
-        parser.add_argument(
-            '--enterprise_customer_uuid',
-            dest='enterprise_customer_uuid',
-            type=str,
-            required=False,
-            help='Send xAPI analytics for this enterprise customer only.'
-        )
-        super(Command, self).add_arguments(parser)
+        Provide the data sharing consent page next url and course title
 
-    @staticmethod
-    def parse_arguments(*args, **options):  # pylint: disable=unused-argument
-        """
-        Parse and validate arguments for send_course_enrollments command.
-
-        Arguments:
-            *args: Positional arguments passed to the command
-            **options: optional arguments passed to the command
+        Arguments
+            user (Object): The User object
+            course_id (String): The course identifier
+            enterprise_customer(Object): EnterpriseCustomer object
 
         Returns:
-            A tuple containing parsed values for
-            1. days (int): Integer showing number of days to lookup enterprise enrollments,
-                course completion etc and send to xAPI LRS
-            2. enterprise_customer_uuid (EnterpriseCustomer): Enterprise Customer if present then
-                send xAPI statements just for this enterprise.
+            next_url (String): The DSC url 'next' param
+            course_title (String): Title of the course
         """
-        days = options.get('days', 1)
-        enterprise_customer_uuid = options.get('enterprise_customer_uuid')
-        enterprise_customer = None
-
-        if enterprise_customer_uuid:
-            try:
-                # pylint: disable=no-member
-                enterprise_customer = EnterpriseCustomer.objects.get(uuid=enterprise_customer_uuid)
-            except EnterpriseCustomer.DoesNotExist:
-                raise CommandError('Enterprise customer with uuid "{enterprise_customer_uuid}" does not exist.'.format(
-                    enterprise_customer_uuid=enterprise_customer_uuid
-                ))
-
-        return days, enterprise_customer
-
-    def handle(self, *args, **options):
-        """
-        Send xAPI statements.
-        """
-        if not CourseEnrollment:
-            raise NotConnectedToOpenEdX("This package must be installed in an OpenEdX environment.")
-
-        days, enterprise_customer = self.parse_arguments(*args, **options)
-
-        if enterprise_customer:
+        learner_portal_base_url = get_configuration_value(
+            'ENTERPRISE_LEARNER_PORTAL_BASE_URL',
+            settings.ENTERPRISE_LEARNER_PORTAL_BASE_URL
+        )
+        next_url = urljoin(learner_portal_base_url, str(enterprise_customer.slug))
+        course_start = None
+        course_title = ''
+        course_details = CourseCatalogApiClient(
+            user,
+            enterprise_customer.site
+        ).get_course_run(course_id)
+        if course_details:
             try:
-                lrs_configuration = XAPILRSConfiguration.objects.get(
-                    active=True,
-                    enterprise_customer=enterprise_customer
-                )
-            except XAPILRSConfiguration.DoesNotExist:
-                raise CommandError('No xAPI Configuration found for "{enterprise_customer}"'.format(
-                    enterprise_customer=enterprise_customer.name
-                ))
-
-            # Send xAPI analytics data to the configured LRS
-            self.send_xapi_statements(lrs_configuration, days)
+                course_start = parse_lms_api_datetime(course_details.get('start'))
+                course_title = course_details.get('title')
+            except (TypeError, ValueError):
+                pass
         else:
-            for lrs_configuration in XAPILRSConfiguration.objects.filter(active=True):
-                self.send_xapi_statements(lrs_configuration, days)
-
-    def send_xapi_statements(self, lrs_configuration, days):
-        """
-        Send xAPI analytics data of the enterprise learners to the given LRS.
-
-        Arguments:
-            lrs_configuration (XAPILRSConfiguration): Configuration object containing LRS configurations
-                of the LRS where to send xAPI  learner analytics.
-            days (int): Include course enrollment of this number of days.
-        """
-        course_enrollments = self.get_course_enrollments(lrs_configuration.enterprise_customer, days)
-        course_catalog_client = get_course_catalog_api_service_client(site=lrs_configuration.enterprise_customer.site)
-        for course_enrollment in course_enrollments:
-
-            course_overview = course_enrollment.course
-            courserun_id = six.text_type(course_overview.id)
-            course_run_identifiers = course_catalog_client.get_course_run_identifiers(courserun_id)
-            course_overview.course_key = course_run_identifiers['course_key']
-            course_overview.course_uuid = course_run_identifiers['course_uuid']
-
-            response_fields = Command.transmit_course_enrollment_statement(
-                lrs_configuration,
-                course_enrollment.user,
-                course_overview
+            LOGGER.info(
+                '[Absent DSC Course Details] Could not get course details from course catalog API. '
+                'User: [%s], Course: [%s], Enterprise: [%s]',
+                user.username,
+                course_id,
+                enterprise_customer.uuid,
+            )
+
+        if course_start and course_start < datetime.datetime.now(course_start.tzinfo):
+            lms_course_url = urljoin(settings.LMS_ROOT_URL, '/courses/{course_id}/course')
+            next_url = lms_course_url.format(course_id=course_id)
+
+        return next_url, course_title
+
+    def get_enterprise_course_enrollments(self, options):
+        """
+        Get EnterpriseCourseEnrollment records according to the options and with dsc enabled
+        """
+        enrollment_before = options['enrollment_before']
+        past_num_days = options['past_num_days']
+        if enrollment_before:
+            enrollments_with_dsc_enabled = EnterpriseCourseEnrollment.objects.select_related(
+                'enterprise_customer_user').filter(
+                created__date__lt=enrollment_before,
+                enterprise_customer_user__enterprise_customer__enable_data_sharing_consent=True
             )
-
-            if is_success_response(response_fields):
-                Command.transmit_courserun_enrollment_statement(
-                    lrs_configuration,
-                    course_enrollment.user,
-                    course_overview
-                )
-
-    @staticmethod
-    def transmit_enrollment_statement(lrs_configuration, user, course_overview, object_type):
-        """
-        Transmits an xAPI enrollment statement for the specified object type.  If successful,
-        records a transmission audit record.
-        """
-        response_fields = {'status': 500, 'error_message': None}
-        response_fields = send_course_enrollment_statement(
-            lrs_configuration,
-            user,
-            course_overview,
-            object_type,
-            response_fields
+        else:
+            past_date = timezone.now().date() - timedelta(days=past_num_days)
+            enrollments_with_dsc_enabled = EnterpriseCourseEnrollment.objects.select_related(
+                'enterprise_customer_user').filter(
+                created__date=past_date,
+                enterprise_customer_user__enterprise_customer__enable_data_sharing_consent=True
+            )
+
+        return enrollments_with_dsc_enabled
+
+    def emit_event(self, ec_user, course_id, enterprise_customer, greeting_name):
+        """
+         Emit the Segment event which will be used by Braze to send the email
+        """
+        next_url, course_title = self._get_course_properties(ec_user.user, course_id, enterprise_customer)
+        failure_url = urljoin(settings.LMS_ROOT_URL, '/dashboard')
+        grant_data_sharing_url = reverse('grant_data_sharing_permissions')
+        utils.track_event(ec_user.user_id, 'edx.bi.user.consent.absent', {
+            'course_id': course_id,
+            'username': ec_user.username,
+            'enterprise_name': enterprise_customer.name,
+            'enterprise_uuid': str(enterprise_customer.uuid),
+            'next_url': next_url,
+            'course_title': course_title,
+            'user_email': ec_user.user_email,
+            'greeting_name': greeting_name,
+            'failure_url': failure_url,
+            'lms_root_url': settings.LMS_ROOT_URL,
+            'grant_data_sharing_url': grant_data_sharing_url,
+            'source': 'missing-dsc-email-drip-command',
+        })
+        LOGGER.info(
+            '[Absent DSC Email] Segment event fired for missing data sharing consent. '
+            'User: [%s], Course: [%s], Enterprise: [%s], DSC Next Url: [%s]',
+            ec_user.username,
+            course_id,
+            str(enterprise_customer.uuid),
+            next_url
         )
 
-        return response_fields
-
-    @staticmethod
-    def transmit_course_enrollment_statement(lrs_configuration, user, course_overview):
-        """
-        Transmits an xAPI enrollment statement for a course object
-        """
-        object_type = 'course'
-        response_fields = Command.transmit_enrollment_statement(lrs_configuration, user, course_overview, object_type)
-
-        if is_success_response(response_fields):
-            courserun_id = six.text_type(course_overview.id)
-            enterprise_course_enrollment_id = EnterpriseCourseEnrollment.get_enterprise_course_enrollment_id(
-                user,
-                courserun_id,
-                lrs_configuration.enterprise_customer
-            )
-
-            Command.save_xapi_learner_data_transmission_audit(
-                user,
-                course_overview.course_key,
-                enterprise_course_enrollment_id,
-                response_fields.get('status'),
-                response_fields.get('error_message')
-            )
-        return response_fields
-
-    @staticmethod
-    def transmit_courserun_enrollment_statement(lrs_configuration, user, course_overview):
-        """
-        Transmits an xAPI enrollment statement for a courserun object
-        """
-        object_type = 'courserun'
-        response_fields = Command.transmit_enrollment_statement(lrs_configuration, user, course_overview, object_type)
-
-        if is_success_response(response_fields):
-            courserun_id = six.text_type(course_overview.id)
-            enterprise_course_enrollment_id = EnterpriseCourseEnrollment.get_enterprise_course_enrollment_id(
-                user,
-                courserun_id,
-                lrs_configuration.enterprise_customer
-            )
-
-            Command.save_xapi_learner_data_transmission_audit(
-                user,
-                courserun_id,
-                enterprise_course_enrollment_id,
-                response_fields.get('status'),
-                response_fields.get('error_message')
-            )
-        return response_fields
-
-    @staticmethod
-    def is_already_transmitted(xapi_transmissions, user_id, course_id):
-        """
-        Determines if an xAPI transmission has already taken place for the specified enrollment
-
-        Arguments:
-            xapi_transmissions (QuerySet)
-            user_id (Numeric)
-            course_id (String)
-
-        Returns
-            Queryset
-        """
-        return xapi_transmissions.filter(user_id=user_id, course_id=course_id)
-
-    @staticmethod
-    def get_pertinent_course_enrollments(course_enrollments, xapi_transmissions):
-        """
-        Compares course enrollments to xAPI transmission records and determines which
-        enrollments have not yet been transmitted
-
-        Arguments:
-            course_enrollments (QuerySet)
-            xapi_transmissions (QuerySet)
-
-        Returns
-            list
-        """
-        pertinent_enrollments = []
-        for enrollment in course_enrollments:
-            if not Command.is_already_transmitted(xapi_transmissions, enrollment.user_id, enrollment.course_id):
-                pertinent_enrollments.append(enrollment)
-        return pertinent_enrollments
-
-    def get_course_enrollments(self, enterprise_customer, days):
-        """
-        Get course enrollments for all the learners of given enterprise customer.
-
-        Arguments:
-            enterprise_customer (EnterpriseCustomer): Include Course enrollments for learners
-                of this enterprise customer.
-            days (int): Include course enrollment of this number of days.
-
-        Returns:
-            (list): A list of CourseEnrollment objects.
-        """
-        enterprise_enrollment_ids = EnterpriseCourseEnrollment.objects.filter(
-            enterprise_customer_user__enterprise_customer=enterprise_customer
+    def add_arguments(self, parser):
+        parser.add_argument(
+            '--no-commit',
+            action='store_true',
+            dest='no_commit',
+            default=False,
+            help='Dry Run, print log messages without committing anything.',
         )
-        xapi_transmissions = XAPILearnerDataTransmissionAudit.objects.filter(
-            enterprise_course_enrollment_id__in=enterprise_enrollment_ids
+        parser.add_argument(
+            '--enrollment-before',
+            action='store',
+            dest='enrollment_before',
+            default=None,
+            type=datetime.date.fromisoformat,
+            help='Specifies the date (format YYYY-MM-DD). Enrollments created before this date will receive DSC emails.'
         )
-
-        course_enrollments = CourseEnrollment.objects.filter(
-            created__gt=datetime.datetime.now() - datetime.timedelta(days=days)
-        ).filter(user_id__in=enterprise_customer.enterprise_customer_users.values_list('user_id', flat=True))
-
-        pertinent_enrollments = self.get_pertinent_course_enrollments(course_enrollments, xapi_transmissions)
-
-        LOGGER.info(
-            '[Integrated Channel][xAPI] Found %s course enrollments for enterprise customer: [%s] during last %s days',
-            len(pertinent_enrollments),
-            enterprise_customer,
-            days,
+        parser.add_argument(
+            '--past_num_days',
+            action='store',
+            dest='past_num_days',
+            default=1,
+            type=int,
+            help='Days past the current day. Enrollments created on that day with a missing DSC will be processed.'
         )
 
-        return pertinent_enrollments
-
-    @staticmethod
-    def save_xapi_learner_data_transmission_audit(user, course_id, enterprise_course_enrollment_id,
-                                                  status, error_message):
-
+    def handle(self, *args, **options):
         """
-        Capture interesting information about the xAPI enrollment (registration) event transmission.
-
-        Arguments:
-            user (User): User object
-            course_id (String): Course or courserun key
-            enterprise_course_enrollment_id (Numeric): EnterpriseCourseEnrollment identifier
-            status (Numeric):  The response status code
-            error_message (String):  Information describing any error state provided by the caller
+        Management command for sending an email to learners with a missing DSC. Designed to run daily.
 
-        Returns:
-            None
-        """
+        Example usage:
+           $ ./manage.py email_drip_for_missing_dsc_records
+           $ ./manage.py email_drip_for_missing_dsc_records  --no-commit
+           $ ./manage.py email_drip_for_missing_dsc_records  --enrollment-before 2021-05-06 --no-commit
+           $ ./manage.py email_drip_for_missing_dsc_records  --enrollment-before 2021-05-06
+        """
+        should_commit = not options['no_commit']
+        email_sent_records = []
+        enterprise_course_enrollments = self.get_enterprise_course_enrollments(options)
+        for enterprise_enrollment in enterprise_course_enrollments:
+            ec_user = enterprise_enrollment.enterprise_customer_user
+            username = ec_user.username
+            user_email = ec_user.user_email
+            greeting_name = user_email
+            if hasattr(ec_user, 'first_name') and ec_user.first_name:
+                greeting_name = ec_user.first_name
+            course_id = enterprise_enrollment.course_id
+            enterprise_customer = ec_user.enterprise_customer
+            consent = DataSharingConsent.objects.proxied_get(
+                username=username,
+                course_id=course_id,
+                enterprise_customer=enterprise_customer
+            )
+            if isinstance(consent, ProxyDataSharingConsent):
+                course_accessed = False
+                try:
+                    if is_course_accessed and is_course_accessed(ec_user.user, course_id):
+                        course_accessed = True
+                except Exception as exc:  # pylint: disable=broad-except
+                    LOGGER.exception('[Absent DSC Email] Error in {course} for user {user}. Error detail: {exc}'.format(
+                        course=course_id,
+                        user=username,
+                        exc=str(exc)
+                    ))
+                # Emit the Segment event which will be used by Braze to send the email
+                if course_accessed:
+                    if should_commit:
+                        self.emit_event(ec_user, course_id, enterprise_customer, greeting_name)
+                    email_sent_records.append(
+                        f'User: {username}, Course: {course_id}, Enterprise: {enterprise_customer.uuid}'
+                    )
+                else:
+                    LOGGER.info(
+                        f'[Absent DSC Email] User has not accessed the course yet. User: [{username}], Course: '
+                        f'[{course_id}], Enterprise: [{enterprise_customer.uuid}]'
+                    )
+            else:
+                LOGGER.info(
+                    f'[Absent DSC Email] Consent already given. User: [{username}], Course: [{course_id}], '
+                    f'Enterprise: [{enterprise_customer.uuid}]'
+                )
 
-        xapi_transmission, created = XAPILearnerDataTransmissionAudit.objects.get_or_create(
-            user=user,
-            course_id=course_id,
-            defaults={
-                'enterprise_course_enrollment_id': enterprise_course_enrollment_id,
-                'status': status,
-                'error_message': error_message
-            }
+        LOGGER.info(
+            '[Absent DSC Email] Emails sent for [%s] enrollments out of [%s] enrollments. DSC records sent to: [%s]',
+            len(email_sent_records),
+            enterprise_course_enrollments.count(),
+            email_sent_records
         )
-
-        if created:
-            LOGGER.info(
-                "[Integrated Channel][xAPI] Successfully created the XAPILearnerDataTransmissionAudit object with "
-                "id: {id}, user: {username} and course: {course_id}".format(
-                    id=xapi_transmission.id,
-                    username=xapi_transmission.user.username,
-                    course_id=xapi_transmission.course_id
-                )
-            )
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/xapi/client.py` & `edx-enterprise-4.0.0/integrated_channels/xapi/client.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,9 +1,7 @@
-# -*- coding: utf-8 -*-
-
 """
 xAPI Client to send payload data.
 """
 
 import logging
 
 from tincan.remote_lrs import RemoteLRS
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/blackboard/transmitters/content_metadata.py` & `edx-enterprise-4.0.0/integrated_channels/blackboard/transmitters/content_metadata.py`

 * *Files 4% similar despite different names*

```diff
@@ -11,15 +11,15 @@
     This transmitter transmits exported content metadata to Canvas.
     """
 
     def __init__(self, enterprise_configuration, client=BlackboardAPIClient):
         """
         Use the ``BlackboardAPIClient`` for content metadata transmission.
         """
-        super(BlackboardContentMetadataTransmitter, self).__init__(
+        super().__init__(
             enterprise_configuration=enterprise_configuration,
             client=client
         )
 
     def _prepare_items_for_transmission(self, channel_metadata_items):
         # here is a hack right now to send only one item
         # we have to investigate how to handle multiple
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/blackboard/migrations/0004_blackboard_tx_chunk_size_default_1.py` & `edx-enterprise-4.0.0/integrated_channels/degreed2/migrations/0006_auto_20220214_1627.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,23 +1,23 @@
-# Generated by Django 2.2.16 on 2020-10-13 19:02
+# Generated by Django 3.2.11 on 2022-02-14 16:27
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('blackboard', '0003_blackboardlearnerdatatransmissionaudit'),
+        ('degreed2', '0005_auto_20220131_1539'),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='blackboardenterprisecustomerconfiguration',
+            model_name='degreed2enterprisecustomerconfiguration',
             name='transmission_chunk_size',
             field=models.IntegerField(default=1, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
         ),
         migrations.AlterField(
-            model_name='historicalblackboardenterprisecustomerconfiguration',
+            model_name='historicaldegreed2enterprisecustomerconfiguration',
             name='transmission_chunk_size',
             field=models.IntegerField(default=1, help_text='The maximum number of data items to transmit to the integrated channel with each request.'),
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/blackboard/migrations/0003_blackboardlearnerdatatransmissionaudit.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/migrations/0006_canvaslearnerassessmentdatatransmissionaudit.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,29 +1,30 @@
-# Generated by Django 2.2.16 on 2020-10-09 22:09
+# Generated by Django 2.2.17 on 2020-12-01 18:57
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('blackboard', '0002_auto_20200930_1723'),
+        ('canvas', '0005_auto_20200909_1534'),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='BlackboardLearnerDataTransmissionAudit',
+            name='CanvasLearnerAssessmentDataTransmissionAudit',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('blackboard_user_email', models.EmailField(help_text='The learner`s Blackboard email. This must match the email on edX in order for both learner and content metadata integrations.', max_length=255)),
-                ('completed_timestamp', models.CharField(help_text='Represents the Blackboard representation of a timestamp: yyyy-mm-dd, which is always 10 characters.', max_length=10)),
-                ('course_id', models.CharField(max_length=255)),
-                ('course_completed', models.BooleanField(default=True, help_text="The learner's course completion status transmitted to Blackboard.")),
+                ('canvas_user_email', models.CharField(max_length=255)),
                 ('enterprise_course_enrollment_id', models.PositiveIntegerField(db_index=True)),
-                ('grade', models.DecimalField(blank=True, decimal_places=2, max_digits=3, null=True)),
-                ('total_hours', models.FloatField(blank=True, null=True)),
-                ('created', models.DateTimeField(auto_now_add=True)),
-                ('error_message', models.TextField(blank=True)),
+                ('course_id', models.CharField(help_text="The course run's key which is used to uniquely identify the course for Canvas.", max_length=255)),
+                ('subsection_id', models.CharField(db_index=True, help_text="The course's subsections's key.", max_length=255)),
+                ('grade_point_score', models.FloatField(help_text='The amount of points that the learner scored on the subsection.')),
+                ('grade_points_possible', models.FloatField(help_text='The total amount of points that the learner could score on the subsection.')),
+                ('grade', models.FloatField(help_text='The grade an enterprise learner received on the reported subsection.')),
+                ('subsection_name', models.CharField(help_text="The name given to the subsection being reported. Used for displaying on external LMS'.", max_length=255)),
                 ('status', models.CharField(max_length=100)),
+                ('error_message', models.TextField(blank=True)),
+                ('created', models.DateTimeField(auto_now_add=True)),
             ],
         ),
     ]
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/blackboard/views.py` & `edx-enterprise-4.0.0/integrated_channels/canvas/views.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,139 +1,141 @@
 """
-Views containing APIs for Blackboard integrated channel
+Views containing APIs for Canvas integrated channel
 """
 
-import base64
+from logging import getLogger
+from urllib.parse import urljoin
 
 import requests
 from rest_framework import generics
-from rest_framework.exceptions import APIException, NotFound, ParseError
-from rest_framework.response import Response
-from six.moves.urllib.parse import urljoin
+from rest_framework.renderers import JSONRenderer
 
 from django.apps import apps
 from django.conf import settings
+from django.core.exceptions import ValidationError
+from django.shortcuts import render
 
 from enterprise.utils import get_enterprise_customer
-from integrated_channels.blackboard.models import BlackboardEnterpriseCustomerConfiguration
+from integrated_channels.canvas.models import CanvasEnterpriseCustomerConfiguration
 
-# TODO: Refactor candidate (duplication with canvas views.py)
+LOGGER = getLogger(__name__)
 
 
-class BlackboardCompleteOAuthView(generics.ListAPIView):
+class CanvasCompleteOAuthView(generics.ListAPIView):
     """
         **Use Cases**
 
-            Retrieve and save a Blackboard OAuth refresh token after an enterprise customer
-            authorizes to integrated courses. Typically for use to plug into the redirect_uri field
-            in visiting the 'authorizationcode' endpoint:
-            Ref: https://developer.blackboard.com/portal/displayApi/Learn
-            e.g. https://blackboard.edx.us.org/learn/api/public/v1/oauth2/
-                 authorizationcode?redirect_uri={{this_endpoint}}&response_type=code
-                 &client_id={{app id}}&state={{enterprise_uuid}}
+            Retrieve and save a Canvas OAuth refresh token after an enterprise customer
+            authorizes to integrated courses.
 
         **Example Requests**
 
-            GET /blackboard/oauth-complete?code=123abc&state=abc123
+            GET /canvas/oauth-complete?code=123abc&state=abc123
 
         **Query Parameters for GET**
 
-            * code: The one time use string generated by the Blackboard API used to fetch the
-            access and refresh tokens for integrating with Blackboard.
+            * code: The one time use string generated by the Canvas API used to fetch the
+            access and refresh tokens for integrating with Canvas.
 
             * state: The user's enterprise customer uuid used to associate the incoming
             code with an enterprise configuration model.
 
         **Response Values**
 
-            HTTP 200 "OK" if successful
+            If the request for information about the course list is successful, an HTTP 200 "OK" response
+            is returned.
 
-            HTTP 400 if code/state is not provided
+            If code is not provided, a 400 error is returned.
 
-            HTTP 404 if state is not valid or contained in the set of registered enterprises
+            If state is not provided, a 400 error is returned.
+
+            If the specified state is not valid or contained in the set of registered enterprise customers
+            a 404 error is returned.
 
     """
-    def get(self, request, *args, **kwargs):  # pylint: disable=arguments-differ
-        app_config = apps.get_app_config('blackboard')
-        oauth_token_path = app_config.oauth_token_auth_path
-
-        # Check if encountered an error when generating the oauth code.
-        request_error = request.GET.get('error')
-        if request_error:
-            raise APIException(
-                "Blackboard OAuth API encountered an error when generating client code - "
-                "error: {} description: {}".format(
-                    request_error,
-                    request.GET.get('error_description')
-                )
+    renderer_classes = [JSONRenderer, ]
+
+    def render_page(self, request, error):
+        """
+        Return a success or failure page based on Canvas OAuth response
+        """
+        success_template = 'enterprise/admin/oauth_authorization_successful.html'
+        error_template = 'enterprise/admin/oauth_authorization_failed.html'
+        template = error_template if error else success_template
+
+        return render(request, template, context={})
+
+    def get(self, request, *args, **kwargs):
+        app_config = apps.get_app_config('canvas')
+        canvas_oauth_token_path = app_config.oauth_token_auth_path
+
+        # Check if Canvas encountered an error when generating the oauth code.
+        canvas_request_error = request.GET.get('error')
+        if canvas_request_error:
+            LOGGER.error(
+                'Canvas OAuth API encountered an error when generating client code- error: {} description: {}'.format(
+                    canvas_request_error,
+                    request.GET.get('error_description'))
             )
+            return self.render_page(request, 'error')
 
         # Retrieve the newly generated code and state (Enterprise user's ID)
         client_code = request.GET.get('code')
-        enterprise_customer_uuid = request.GET.get('state')
-        if not enterprise_customer_uuid:
-            raise ParseError("Enterprise ID (as 'state' url param) needed to obtain refresh token")
+        state_uuid = request.GET.get('state')
 
-        if not client_code:
-            raise ParseError("'code' url param was not provided, needed to obtain refresh token")
+        if not state_uuid:
+            LOGGER.error("Canvas Configuration uuid required to integrate with Canvas.")
+            return self.render_page(request, 'error')
 
-        enterprise_customer = get_enterprise_customer(enterprise_customer_uuid)
-        if not enterprise_customer:
-            raise NotFound("No enterprise data found for given uuid: {}."
-                           .format(enterprise_customer_uuid))
+        if not client_code:
+            LOGGER.error("Client code required to integrate with Canvas.")
+            return self.render_page(request, 'error')
 
         try:
-            enterprise_config = BlackboardEnterpriseCustomerConfiguration.objects.get(
-                enterprise_customer=enterprise_customer
-            )
-        except BlackboardEnterpriseCustomerConfiguration.DoesNotExist:
-            raise NotFound("No Blackboard configuration found for enterprise: {}"
-                           .format(enterprise_customer_uuid))
-
-        auth_header = self._create_auth_header(enterprise_config)
+            enterprise_config = CanvasEnterpriseCustomerConfiguration.objects.get(uuid=state_uuid)
+        except (CanvasEnterpriseCustomerConfiguration.DoesNotExist, ValidationError):
+            enterprise_config = None
+
+        # old urls may use the enterprise customer uuid in place of the config uuid, so lets fallback
+        if not enterprise_config:
+            enterprise_customer = get_enterprise_customer(state_uuid)
+
+            if not enterprise_customer:
+                LOGGER.error(f"No state data found for given uuid: {state_uuid}.")
+                return self.render_page(request, 'error')
+
+            try:
+                enterprise_config = CanvasEnterpriseCustomerConfiguration.objects.filter(
+                    enterprise_customer=enterprise_customer
+                ).first()
+            except CanvasEnterpriseCustomerConfiguration.DoesNotExist:
+                LOGGER.error(f"No state data found for given uuid: {state_uuid}")
+                return self.render_page(request, 'error')
 
         access_token_request_params = {
             'grant_type': 'authorization_code',
-            'redirect_uri': settings.LMS_INTERNAL_ROOT_URL + "/blackboard/oauth-complete",
+            'client_id': enterprise_config.client_id,
+            'client_secret': enterprise_config.client_secret,
+            'redirect_uri': settings.LMS_INTERNAL_ROOT_URL + "/canvas/oauth-complete",
             'code': client_code,
         }
 
-        auth_token_url = urljoin(enterprise_config.blackboard_base_url, oauth_token_path)
-        auth_response = requests.post(
-            auth_token_url,
-            access_token_request_params,
-            headers={
-                'Authorization': auth_header,
-                'Content-Type': 'application/x-www-form-urlencoded'
-            })
+        auth_token_url = urljoin(
+            enterprise_config.canvas_base_url,
+            canvas_oauth_token_path
+        )
+
+        auth_response = requests.post(auth_token_url, access_token_request_params)
 
         try:
             data = auth_response.json()
             refresh_token = data['refresh_token']
-        except KeyError as exception:
-            raise ParseError(
-                "BLACKBOARD: failed to find refresh_token in auth response. "
-                "Auth response text: {}, Response code: {}, JSON response: {}".format(
-                    auth_response.text,
-                    auth_response.status_code,
-                    data,
-                )
-            ) from exception
-        except ValueError as exception:
-            raise ParseError(
-                "BLACKBOARD: auth response is invalid json. auth_response: {}".format(auth_response)
-            ) from exception
+        except (KeyError, ValueError) as error:
+            LOGGER.exception(message=str(error))
+            return self.render_page(request, 'error')
 
         enterprise_config.refresh_token = refresh_token
         enterprise_config.save()
 
-        return Response()
+        status = '' if auth_response.status_code == 200 else 'error'
 
-    def _create_auth_header(self, enterprise_config):
-        """
-        Auth header in oauth2 token format as per Blackboard doc
-        """
-        return 'Basic {}'.format(
-            base64.b64encode(u'{key}:{secret}'.format(
-                key=enterprise_config.client_id, secret=enterprise_config.client_secret
-            ).encode('utf-8')).decode()
-        )
+        return self.render_page(request, status)
```

### Comparing `edx-enterprise-3.9.9/integrated_channels/blackboard/client.py` & `edx-enterprise-4.0.0/integrated_channels/blackboard/client.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,40 +1,43 @@
-# -*- coding: utf-8 -*-
 """
 Client for connecting to Blackboard.
 """
 import base64
 import copy
 import json
 import logging
 from http import HTTPStatus
+from urllib.parse import urljoin
 
 import requests
-from six.moves.urllib.parse import urljoin  # pylint: disable=import-error
 
 from django.apps import apps
+from django.db import transaction
 
 from integrated_channels.blackboard.exporters.content_metadata import BLACKBOARD_COURSE_CONTENT_NAME
 from integrated_channels.exceptions import ClientError
 from integrated_channels.integrated_channel.client import IntegratedChannelApiClient
-from integrated_channels.utils import refresh_session_if_expired
+from integrated_channels.utils import generate_formatted_log, refresh_session_if_expired
 
 LOGGER = logging.getLogger(__name__)
 
 # TODO: Refactor candidate (duplication with canvas client)
 GRADEBOOK_PATH = '/learn/api/public/v1/courses/{course_id}/gradebook/columns'
 ENROLLMENT_PATH = '/learn/api/public/v1/courses/{course_id}/users'
 COURSE_PATH = '/learn/api/public/v1/courses'
 POST_GRADE_COLUMN_PATH = '/learn/api/public/v2/courses/{course_id}/gradebook/columns'
+PATCH_GRADE_COLUMN_PATH = '/learn/api/public/v2/courses/{course_id}/gradebook/columns/{column_id}'
 POST_GRADE_PATH = '/learn/api/public/v2/courses/{course_id}/gradebook/columns/{column_id}/users/{user_id}'
 COURSE_V3_PATH = '/learn/api/public/v3/courses/{course_id}'
 COURSES_V3_PATH = '/learn/api/public/v3/courses'
 COURSE_CONTENT_PATH = '/learn/api/public/v1/courses/{course_id}/contents'
 COURSE_CONTENT_CHILDREN_PATH = '/learn/api/public/v1/courses/{course_id}/contents/{content_id}/children'
 COURSE_CONTENT_DELETE_PATH = '/learn/api/public/v1/courses/{course_id}/contents/{content_id}'
+GRADEBOOK_COLUMN_DESC = "edX learner's grade"
+PAGE_TRAVERSAL_LIMIT = 250
 
 
 class BlackboardAPIClient(IntegratedChannelApiClient):
     """
     Client for connecting to Blackboard.
     """
 
@@ -42,15 +45,20 @@
         """
         Instantiate a new client.
 
         Args:
             enterprise_configuration (BlackboardEnterpriseCustomerConfiguration): An enterprise customers's
             configuration model for connecting with Blackboard
         """
-        super(BlackboardAPIClient, self).__init__(enterprise_configuration)
+        super().__init__(enterprise_configuration)
+        BlackboardGlobalConfiguration = apps.get_model(
+            'blackboard',
+            'BlackboardGlobalConfiguration'
+        )
+        self.global_blackboard_config = BlackboardGlobalConfiguration.current()
         self.config = apps.get_app_config('blackboard')
         self.session = None
         self.expires_at = None
 
     def create_content_metadata(self, serialized_data):
         """
         Create a course from serialized course metadata
@@ -64,28 +72,57 @@
 
         # blackboard does not support all characters in our courseIds so let's gen a hash instead
         course_id_generated = self.generate_blackboard_course_id(external_id)
 
         copy_of_channel_metadata = copy.deepcopy(channel_metadata_item)
         copy_of_channel_metadata['course_metadata']['courseId'] = course_id_generated
 
-        LOGGER.info("Creating course with courseId: %s", external_id)
+        LOGGER.info(generate_formatted_log(
+            self.enterprise_configuration.channel_code(),
+            self.enterprise_configuration.enterprise_customer.uuid,
+            None,
+            external_id,
+            f"Creating course with courseId: {external_id}, and generated course_id: {course_id_generated}"
+        ))
         self._create_session()
         create_url = self.generate_course_create_url()
-        response = self._post(create_url, copy_of_channel_metadata['course_metadata'])
+        try:
+            response = self._post(create_url, copy_of_channel_metadata['course_metadata'])
+        except ClientError as error:
+            if error.status_code == 409 and 'Unique ID conflicts' in error.message:
+                # course already exists!
+                msg_body = (f"Course already exists with course_id {external_id},"
+                            f" and generated course_id: {course_id_generated}, not attempting creation")
+                LOGGER.warning(generate_formatted_log(
+                    self.enterprise_configuration.channel_code(),
+                    self.enterprise_configuration.enterprise_customer.uuid,
+                    None,
+                    external_id,
+                    msg_body,
+                ))
+                return HTTPStatus.NOT_MODIFIED.value, msg_body
+            else:
+                raise error
 
         # We wrap error handling in the post, but sanity check for the ID
         bb_course_id = response.json().get('id')
         if not bb_course_id:
             raise ClientError(
                 'Something went wrong while creating base course object on Blackboard. Could not retrieve course ID.',
                 HTTPStatus.NOT_FOUND.value
             )
 
-        LOGGER.info("Creating content page for Blackboard course with course ID={}".format(external_id))
+        LOGGER.info(generate_formatted_log(
+            self.enterprise_configuration.channel_code(),
+            self.enterprise_configuration.enterprise_customer.uuid,
+            None,
+            external_id,
+            (f"Creating content page for Blackboard course with course ID={external_id},"
+             f" and generated course_id: {course_id_generated}")
+        ))
         course_created_response = self.create_integration_content_for_course(bb_course_id, copy_of_channel_metadata)
 
         success_body = 'Successfully created Blackboard integration course={bb_course_id} with integration ' \
                        'content={bb_child_id}'.format(
                            bb_course_id=bb_course_id,
                            bb_child_id=course_created_response.json().get('id'),
                        )
@@ -98,15 +135,23 @@
         channel_metadata_item = json.loads(serialized_data.decode('utf-8'))
 
         BlackboardAPIClient._validate_channel_metadata(channel_metadata_item)
         external_id = channel_metadata_item.get('externalId')
         course_id = self._resolve_blackboard_course_id(external_id)
         BlackboardAPIClient._validate_course_id(course_id, external_id)
 
-        LOGGER.info('Updating course with courseId: {}'.format(course_id))
+        LOGGER.info(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                course_id,
+                f'Updating course with courseId: {course_id}'
+            )
+        )
         update_url = self.generate_course_update_url(course_id)
         response = self._patch(update_url, channel_metadata_item.get('course_metadata'))
 
         bb_course_id = response.json().get('id')
 
         if not bb_course_id:
             raise ClientError(
@@ -121,38 +166,93 @@
         bb_content_id = None
 
         for content in bb_contents:
             if content.get('title') == BLACKBOARD_COURSE_CONTENT_NAME:
                 bb_content_id = content.get('id')
 
         if not bb_content_id:
-            LOGGER.info('Blackboard integrated course content not found. Generating content.')
+            LOGGER.info(
+                generate_formatted_log(
+                    self.enterprise_configuration.channel_code(),
+                    self.enterprise_configuration.enterprise_customer.uuid,
+                    None,
+                    course_id,
+                    'Blackboard integrated course content not found. Generating content.'
+                )
+            )
         else:
             course_content_delete_url = self.generate_course_content_delete_url(bb_course_id, bb_content_id)
             self._delete(course_content_delete_url)
 
-        course_updated_response = self.create_integration_content_for_course(bb_course_id, channel_metadata_item)
+        course_updated_response = self.update_integration_content_for_course(
+            bb_course_id,
+            channel_metadata_item,
+        )
 
         return course_updated_response.status_code, course_updated_response.text
 
     def delete_content_metadata(self, serialized_data):
         """Delete course from blackboard (performs full delete as of now)"""
         self._create_session()
         channel_metadata_item = json.loads(serialized_data.decode("utf-8"))
 
         BlackboardAPIClient._validate_channel_metadata(channel_metadata_item)
         external_id = channel_metadata_item.get('externalId')
         course_id = self._resolve_blackboard_course_id(external_id)
-        BlackboardAPIClient._validate_course_id(course_id, external_id)
 
-        LOGGER.info("Deleting course with courseId: %s", course_id)
+        if not course_id:
+            return HTTPStatus.OK.value, 'Course:{} already removed.'.format(external_id)
+
+        LOGGER.info(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                course_id,
+                f'Deleting course with courseId: {course_id}'
+            )
+        )
         update_url = self.generate_course_update_url(course_id)
         response = self._delete(update_url)
         return response.status_code, response.text
 
+    def create_assessment_reporting(self, user_id, payload):
+        """
+        Post a learner's subsection assessment grade to the integrated Blackboard course.
+
+        Parameters:
+        -----------
+            user_id (str): The shared email between a user's edX account and Blackboard account
+            payload (str): The (string representation) of the learner data information
+        """
+        self._create_session()
+        learner_data = json.loads(payload)
+        external_id = learner_data.get('courseID')
+
+        course_id = self._resolve_blackboard_course_id(external_id)
+        BlackboardAPIClient._validate_course_id(course_id, external_id)
+
+        blackboard_user_id = self._get_bb_user_id_from_enrollments(user_id, course_id)
+        grade_column_id = self._get_or_create_integrated_grade_column(
+            course_id,
+            learner_data.get('subsection_name'),
+            learner_data.get('subsectionID'),
+            learner_data.get('points_possible'),
+        )
+
+        grade = learner_data.get('points_earned')
+        submission_response = self._submit_grade_to_blackboard(grade, course_id, grade_column_id, blackboard_user_id)
+
+        success_body = 'Successfully posted grade of {grade} to course:{course_id} for user:{user_email}.'.format(
+            grade=grade,
+            course_id=external_id,
+            user_email=user_id,
+        )
+        return submission_response.status_code, success_body
+
     def create_course_completion(self, user_id, payload):
         """
         Post a final course grade to the integrated Blackboard course.
 
         Parameters:
         -----------
             user_id (str): The shared email between a user's edX account and Blackboard account
@@ -168,46 +268,35 @@
 
         """
         self._create_session()
         learner_data = json.loads(payload)
         external_id = learner_data.get('courseID')
 
         course_id = self._resolve_blackboard_course_id(external_id)
-
-        # Sanity check for course id
-        if not course_id:
-            raise ClientError(
-                'Could not find course:{} on Blackboard'.format(external_id),
-                HTTPStatus.NOT_FOUND.value
-            )
+        BlackboardAPIClient._validate_course_id(course_id, external_id)
 
         blackboard_user_id = self._get_bb_user_id_from_enrollments(user_id, course_id)
-        grade_column_id = self._get_or_create_integrated_grade_column(course_id)
-
-        grade = learner_data.get('grade') * 100
-        grade_percent = {'score': grade}
-        response = self._patch(
-            self.generate_post_users_grade_url(course_id, grade_column_id, blackboard_user_id),
-            grade_percent
+        grade_column_id = self._get_or_create_integrated_grade_column(
+            course_id,
+            "(edX Integration) Final Grade",
+            "edx_final_grade",
+            include_in_calculations=True,
         )
 
-        if response.json().get('score') != grade:
-            raise ClientError(
-                'Failed to post new grade for user={} enrolled in course={}'.format(user_id, course_id),
-                HTTPStatus.INTERNAL_SERVER_ERROR.value
-            )
+        grade = learner_data.get('grade') * 100
+        submission_response = self._submit_grade_to_blackboard(grade, course_id, grade_column_id, blackboard_user_id)
 
         success_body = 'Successfully posted grade of {grade} to course:{course_id} for user:{user_email}.'.format(
             grade=grade,
             course_id=external_id,
             user_email=user_id,
         )
-        return response.status_code, success_body
+        return submission_response.status_code, success_body
 
-    def delete_course_completion(self, user_id, payload):  # pylint: disable=unused-argument
+    def delete_course_completion(self, user_id, payload):
         """TODO: course completion deletion is currently not easily supported"""
 
     @staticmethod
     def _validate_channel_metadata(channel_metadata_item):
         """
         Raise error if external_id invalid or not found
         """
@@ -236,117 +325,187 @@
             raise ClientError(
                 'Could not find course metadata group(s):{} necessary to create Blackboard integrated course.'.format(
                     course_metadata_groups - metadata_set
                 ),
                 HTTPStatus.NOT_FOUND.value
             )
 
-    def _resolve_blackboard_course_id(self, external_id):
-        """
-        Extract course id from blackboard, given it's externalId
-        """
-        params = {'externalId': external_id}
-        courses_responses = self._get(self.generate_courses_url(), params).json()
-        course_response = courses_responses.get('results')
-
-        for course in course_response:
-            if course.get('externalId') == external_id:
-                course_id = course.get('id')
-                return course_id
-        return None
-
     def _create_session(self):
         """
         Will only create a new session if token expiry has been reached
         """
         self.session, self.expires_at = refresh_session_if_expired(
             self._get_oauth_access_token,
             self.session,
             self.expires_at,
         )
 
+    def _formatted_message(self, msg):
+        return generate_formatted_log(
+            self.enterprise_configuration.channel_code(),
+            self.enterprise_configuration.enterprise_customer.uuid,
+            None,
+            None,
+            msg,
+        )
+
+    def _log_info(self, msg):
+        LOGGER.info(self._formatted_message(msg))
+
+    def _log_error(self, msg):
+        LOGGER.error(self._formatted_message(msg))
+
     def _get_oauth_access_token(self):
         """Fetch access token using refresh_token workflow from Blackboard
 
+        Using atomic block for refresh token handling code, because we need to use the
+        most recently obtained refresh token always
+        Since any time we use a refresh token to get a new one, the prior one is invalidated
+        and we MUST use the new one for the next request.
+
         Returns:
             access_token (str): the OAuth access token to access the Blackboard server
             expires_in (int): the number of seconds after which token will expire
         Raises:
             HTTPError: If we received a failure response code.
             ClientError: If an unexpected response format was received that we could not parse.
         """
 
-        if not self.enterprise_configuration.refresh_token:
-            raise ClientError(
-                "Failed to generate oauth access token: Refresh token required.",
-                HTTPStatus.INTERNAL_SERVER_ERROR.value
-            )
-
         if (not self.enterprise_configuration.blackboard_base_url
                 or not self.config.oauth_token_auth_path):
             raise ClientError(
                 "Failed to generate oauth access token: oauth path missing from configuration.",
                 HTTPStatus.INTERNAL_SERVER_ERROR.value
             )
         auth_token_url = urljoin(
             self.enterprise_configuration.blackboard_base_url,
             self.config.oauth_token_auth_path,
         )
 
-        auth_token_params = {
-            'grant_type': 'refresh_token',
-            'refresh_token': self.enterprise_configuration.refresh_token,
-        }
+        # Refresh token handling atomic block
+        # DO NOT USE self.enterprise_config in this block!
+        # Here we don't use the config passed from the constructor directly
+        # instead we fetch a transaction safe instance using select_for_update
+        # so that multiple sessions such as this
+        # don't interfere with each other's Blackboard refresh token state. Blackboard only allows
+        # only valid refresh token at a time, and once it's used it's invalidated and needs to be
+        # replaced by a new token
+        with transaction.atomic():
+            channel_config = apps.get_model(
+                'blackboard',
+                'BlackboardEnterpriseCustomerConfiguration'
+            ).objects.select_for_update().get(pk=self.enterprise_configuration.pk)
+            if not channel_config.refresh_token:
+                raise ClientError(
+                    "Failed to generate oauth access token: Refresh token required.",
+                    HTTPStatus.INTERNAL_SERVER_ERROR.value
+                )
 
-        auth_response = requests.post(
-            auth_token_url,
-            auth_token_params,
-            headers={
-                'Authorization': self._create_auth_header(),
-                'Content-Type': 'application/x-www-form-urlencoded'
+            auth_token_params = {
+                'grant_type': 'refresh_token',
+                'refresh_token': channel_config.refresh_token,
             }
-        )
-        if auth_response.status_code >= 400:
-            raise ClientError(auth_response.text, auth_response.status_code)
-        try:
-            data = auth_response.json()
-            # do not forget to save the new refresh token otherwise subsequent requests will fail
-            self.enterprise_configuration.refresh_token = data["refresh_token"]
-            self.enterprise_configuration.save()
-            return data['access_token'], data["expires_in"]
-        except (KeyError, ValueError):
-            raise ClientError(auth_response.text, auth_response.status_code)
+
+            auth_response = requests.post(
+                auth_token_url,
+                auth_token_params,
+                headers={
+                    'Authorization': self._create_auth_header(),
+                    'Content-Type': 'application/x-www-form-urlencoded'
+                }
+            )
+            if auth_response.status_code >= 400:
+                raise ClientError(
+                    f"BLACKBOARD: Access/Refresh token fetch failure, "
+                    f"enterprise_customer_uuid: {channel_config.enterprise_customer.uuid}, "
+                    f"blackboard_base_url: {channel_config.blackboard_base_url}, "
+                    f"auth_response_text: {auth_response.text}"
+                    f"config_last_modified: {channel_config.modified}",
+                    auth_response.status_code,
+                )
+            try:
+                data = auth_response.json()
+                # do not forget to save the new refresh token otherwise subsequent requests will fail
+                if "refresh_token" not in data:
+                    self._log_info("Server did not return refresh_token, keeping existing one")
+                else:
+                    # refresh token was returned by server, needs to be used
+                    fetched_refresh_token = data["refresh_token"]
+                    if not fetched_refresh_token.strip():
+                        # we are out of luck, can't use this invalid token
+                        # and we probably can't get unstuck without customer re-doing oauth url workflow
+                        self._log_error("Fetched a new refresh token, but it was empty, not using it!")
+                    else:
+                        channel_config.refresh_token = fetched_refresh_token
+                        self._log_info("Fetched a new refresh token, replacing current one")
+                        channel_config.save()
+                        # We do not want any fail-prone code in this atomic block after this line
+                        # it's because if something else fails, it will roll back the just-saved
+                        # refresh token!
+                return data['access_token'], data["expires_in"]
+            except (KeyError, ValueError) as error:
+                raise ClientError(auth_response.text, auth_response.status_code) from error
 
     def _create_auth_header(self):
         """
         auth header in oauth2 token format as required by blackboard doc
         """
-        if not self.enterprise_configuration.client_id:
-            raise ClientError(
-                "Failed to generate oauth access token: Client ID required.",
-                HTTPStatus.INTERNAL_SERVER_ERROR.value
-            )
-        if not self.enterprise_configuration.client_secret:
-            raise ClientError(
-                "Failed to generate oauth access token: Client secret required.",
-                HTTPStatus.INTERNAL_SERVER_ERROR.value
-            )
-        return 'Basic {}'.format(
-            base64.b64encode(u'{key}:{secret}'.format(
-                key=self.enterprise_configuration.client_id,
-                secret=self.enterprise_configuration.client_secret
-            ).encode('utf-8')).decode()
-        )
+        app_key = self.enterprise_configuration.client_id
+        if not app_key:
+            if not self.global_blackboard_config.app_key:
+                raise ClientError(
+                    "Failed to generate oauth access token: Client ID required.",
+                    HTTPStatus.INTERNAL_SERVER_ERROR.value
+                )
+            app_key = self.global_blackboard_config.app_key
+        app_secret = self.enterprise_configuration.client_secret
+        if not app_secret:
+            if not self.global_blackboard_config.app_secret:
+                raise ClientError(
+                    "Failed to generate oauth access token: Client secret required.",
+                    HTTPStatus.INTERNAL_SERVER_ERROR.value
+                )
+            app_secret = self.global_blackboard_config.app_secret
+        return f"Basic {base64.b64encode(f'{app_key}:{app_secret}'.encode('utf-8')).decode()}"
 
     def generate_blackboard_course_id(self, external_id):
         """
         A course_id suitable for use with blackboard
         """
         return str(abs(hash(external_id)))
 
+    def generate_blackboard_gradebook_column_data(self, external_id, grade_column_name, points_possible,
+                                                  include_in_calculations=False):
+        """
+        Properly formatted json data to create a new gradebook column in a blackboard course
+
+        Note: Potential customization here per-customer, if the need arises.
+        """
+        return {
+            "externalId": external_id,
+            "name": grade_column_name,
+            "displayName": grade_column_name,
+            "description": GRADEBOOK_COLUMN_DESC,
+            "externalGrade": False,
+            "score": {
+                "possible": points_possible
+            },
+            "availability": {
+                "available": "Yes"
+            },
+            "grading": {
+                "type": "Manual",
+                "scoringModel": "Last",
+                "anonymousGrading": {
+                    "type": "None",
+                }
+            },
+            "includeInCalculations": include_in_calculations,
+        }
+
     def generate_gradebook_url(self, course_id):
         """
         Blackboard API url helper method.
         Path: Get course gradebook
         """
         return '{base}{path}'.format(
             base=self.enterprise_configuration.blackboard_base_url,
@@ -398,14 +557,27 @@
         Path: Create course grade column
         """
         return '{base}{path}'.format(
             base=self.enterprise_configuration.blackboard_base_url,
             path=POST_GRADE_COLUMN_PATH.format(course_id=course_id),
         )
 
+    def generate_update_grade_column_url(self, course_id, column_id):
+        """
+        Blackboard API url helper method.
+        Path: Update course grade column
+        """
+        return '{base}{path}'.format(
+            base=self.enterprise_configuration.blackboard_base_url,
+            path=PATCH_GRADE_COLUMN_PATH.format(
+                course_id=course_id,
+                column_id=column_id,
+            ),
+        )
+
     def generate_post_users_grade_url(self, course_id, column_id, user_id):
         """
         Blackboard API url helper method.
         Path: User's grade column entry
         """
         return '{base}{path}'.format(
             base=self.enterprise_configuration.blackboard_base_url,
@@ -478,77 +650,110 @@
         Returns request's delete response and raises Client Errors if appropriate.
         """
         response = self.session.delete(url)
         if response.status_code >= 400:
             raise ClientError(response.text, response.status_code)
         return response
 
-    def _get_bb_user_id_from_enrollments(self, user_id, course_id):
+    def _get_bb_user_id_from_enrollments(self, user_email, course_id):
         """
         Helper method to retrieve a user's Blackboard ID from a list of enrollments in a
         Blackboard class.
 
         Parameters:
         -----------
-            user_id (str): The shared email of the user for both Blackboard and edX
+            user_email (str): The shared email of the user for both Blackboard and edX
             course_id (str): The Blackboard course ID of which to search enrollments.
         """
         enrollments_response = self._get(self.generate_enrollment_url(course_id)).json()
         for enrollment in enrollments_response.get('results'):
             # No point in checking non-students
             if enrollment.get('courseRoleId') == 'Student':
                 contact = enrollment.get('user').get('contact')
-                if contact.get('email') == user_id:
+                if contact.get('email') == user_email:
                     return enrollment.get('userId')
         raise ClientError(
-            'Could not find user={} enrolled in Blackboard course={}'.format(user_id, course_id),
+            'Could not find user={} enrolled in Blackboard course={}'.format(user_email, course_id),
             HTTPStatus.NOT_FOUND.value
         )
 
-    def _get_or_create_integrated_grade_column(self, bb_course_id):
+    def _get_or_create_integrated_grade_column(self, bb_course_id, grade_column_name, external_id, points_possible=100,
+                                               include_in_calculations=False):
         """
         Helper method to search an edX integrated Blackboard course for the designated edX grade column.
         If the column does not yet exist within the course, create it.
 
         Parameters:
         -----------
             bb_course_id (str): The Blackboard course ID in which to search for the edX final grade,
             grade column.
         """
-        grade_column_response = self._get(self.generate_gradebook_url(bb_course_id))
-        parsed_response = grade_column_response.json()
-        grade_columns = parsed_response.get('results')
-
+        gradebook_column_url = self.generate_gradebook_url(bb_course_id)
         grade_column_id = None
-        for grade_column in grade_columns:
-            if grade_column.get('externalId') == 'edx_final_grade':
-                grade_column_id = grade_column.get('id')
-        if not grade_column_id:
-            # Potential customization here per-customer, if the need arises.
-            grade_column_data = {
-                "externalId": "edx_final_grade",
-                "name": "edx final grade",
-                "displayName": "(edX Integration) Final Grade",
-                "description": "Student's final edX course grade",
-                "externalGrade": True,
-                "score": {
-                    "possible": 100
-                },
-                "availability": {
-                    "available": "Yes"
-                },
-                "grading": {
-                    "type": "Manual",
-                    "scoringModel": "Last",
-                    "anonymousGrading": {
-                        "type": "None",
-                    }
-                },
-            }
+        more_pages_present = True
+        current_page_count = 0
+
+        # Page count of 250 is a preventative of infinite while loops
+        while more_pages_present and current_page_count <= PAGE_TRAVERSAL_LIMIT:
+            grade_column_response = self._get(gradebook_column_url)
+            parsed_response = grade_column_response.json()
+            grade_columns = parsed_response.get('results')
+
+            for grade_column in grade_columns:
+                if grade_column.get('externalId') == external_id:
+                    grade_column_id = grade_column.get('id')
+                    # if includeInCalculations has legacy value, correct it
+                    if (
+                        grade_column.get('includeInCalculations') and
+                        grade_column.get('includeInCalculations') != include_in_calculations
+                    ):
+                        calculations_data = {"includeInCalculations": include_in_calculations}
+                        self._patch(
+                            self.generate_update_grade_column_url(bb_course_id, grade_column_id),
+                            calculations_data
+                        )
+                    break
+            # Blackboard's pagination is returned within the response json if it exists
+            # Example:
+            # Response = {
+            #     'results': [{
+            #         'id': 1,
+            #         ...
+            #     }, {
+            #         'id', 2,
+            #         ...
+            #     }],
+            #     'paging': {
+            #         'nextPage': '/learn/api/public/v1/courses/<courseID>/gradebook/columns?offset=200'
+            #     }
+            # }
+            if parsed_response.get('paging') and not grade_column_id:
+                gradebook_column_url = '{}{}'.format(
+                    self.enterprise_configuration.blackboard_base_url,
+                    parsed_response.get('paging').get('nextPage'),
+                )
+                current_page_count += 1
+            else:
+                more_pages_present = False
+
+        if current_page_count == PAGE_TRAVERSAL_LIMIT:
+            LOGGER.warning(
+                generate_formatted_log(
+                    self.enterprise_configuration.channel_code(),
+                    self.enterprise_configuration.enterprise_customer.uuid,
+                    None,
+                    None,
+                    f'Max page limit hit while traversing blackboard API for course={external_id}'
+                )
+            )
 
+        if not grade_column_id:
+            grade_column_data = self.generate_blackboard_gradebook_column_data(
+                external_id, grade_column_name, points_possible, include_in_calculations
+            )
             response = self._post(self.generate_create_grade_column_url(bb_course_id), grade_column_data)
             parsed_response = response.json()
             grade_column_id = parsed_response.get('id')
 
             # Sanity check that we created the grade column properly
             if not grade_column_id:
                 raise ClientError(
@@ -556,72 +761,182 @@
                         bb_course_id
                     ),
                     HTTPStatus.INTERNAL_SERVER_ERROR.value
                 )
 
         return grade_column_id
 
+    def _submit_grade_to_blackboard(self, grade, course_id, grade_column_id, user_id):
+        """
+        Helper method to post learner data to the integrated blackboard course and then validate the submission of
+        grade reporting.
+        """
+        grade_percent = {'score': grade}
+        response = self._patch(
+            self.generate_post_users_grade_url(course_id, grade_column_id, user_id),
+            grade_percent
+        )
+
+        if response.json().get('score') != grade:
+            raise ClientError(
+                'Failed to post new grade for user={} enrolled in course={}'.format(user_id, course_id),
+                HTTPStatus.INTERNAL_SERVER_ERROR.value
+            )
+
+        return response
+
+    def _resolve_blackboard_course_id(self, external_id):
+        """
+        Extract course id from blackboard, given it's externalId
+        """
+        params = {'externalId': external_id}
+        courses_responses = self._get(self.generate_courses_url(), params).json()
+        course_response = courses_responses.get('results')
+
+        for course in course_response:
+            if course.get('externalId') == external_id:
+                return course.get('id')
+        return None
+
+    def delete_course_content_from_blackboard(self, bb_course_id, bb_content_id):
+        """
+        Error handling Helper method that will delete any successful content posts that occurred during
+        the error'd transmission.
+        """
+        delete_course_content_url = urljoin(
+            self.enterprise_configuration.blackboard_base_url,
+            COURSE_CONTENT_DELETE_PATH.format(course_id=bb_course_id, content_id=bb_content_id),
+        )
+        resp = self._delete(delete_course_content_url)
+        return resp
+
     def delete_course_from_blackboard(self, bb_course_id, bb_content_id=None):
         """
-        Error handling Helper method that will delete any previously successful posts that occurred previously during
-        the current transmission.
+        Error handling Helper method that will delete any already made, successful post requests that occurred during
+        the content creation flow.
         """
+        # Remove the content if it exists
         if bb_content_id:
-            delete_course_content_url = urljoin(
-                self.enterprise_configuration.blackboard_base_url,
-                COURSE_CONTENT_DELETE_PATH.format(course_id=bb_course_id, content_id=bb_content_id),
-            )
-            self._delete(delete_course_content_url)
+            self.delete_course_content_from_blackboard(bb_course_id, bb_content_id)
 
+        # Remove the course
         delete_course_path = urljoin(
             self.enterprise_configuration.blackboard_base_url,
             COURSE_V3_PATH.format(course_id=bb_course_id),
         )
         resp = self._delete(delete_course_path)
         return resp
 
+    def update_integration_content_for_course(self, bb_course_id, channel_metadata_item):
+        """
+        Helper method to update the blackboard course content page with the integration custom information.
+        Differs from course customization creation in that we don't delete the course if things fail.
+        """
+        content_url = self.generate_create_course_content_url(bb_course_id)
+        error_message = ''
+        try:
+            content_resp = self._post(content_url, channel_metadata_item.get('course_content_metadata'))
+            bb_content_id = content_resp.json().get('id')
+        except ClientError as error:
+            bb_content_id = None
+            error_message = ' and received error response={}'.format(error.message)
+
+        if not bb_content_id:
+            error_message = '' if not error_message else error_message
+            raise ClientError(
+                'Something went wrong while creating course content object on Blackboard. Could not retrieve content '
+                'ID{}.'.format(error_message),
+                HTTPStatus.NOT_FOUND.value
+            )
+
+        try:
+            content_child_url = self.generate_create_course_content_child_url(bb_course_id, bb_content_id)
+            course_fully_created_response = self._post(
+                content_child_url, channel_metadata_item.get('course_child_content_metadata')
+            )
+            content_child_id = course_fully_created_response.json().get('id')
+        except ClientError as error:
+            content_child_id = None
+            error_message = ' and received error response={}'.format(error.message)
+
+        if not content_child_id:
+            error_message = '' if not error_message else error_message
+            error_handling_response = self.delete_course_content_from_blackboard(bb_course_id, bb_content_id)
+
+            raise ClientError(
+                'Something went wrong while creating course content child object on Blackboard. Could not retrieve a '
+                'content child ID and got error response={}. Deleted associated course content shell with response: '
+                '(status_code={}, body={})'.format(
+                    error_message,
+                    error_handling_response.status_code,
+                    error_handling_response.text
+                ),
+                HTTPStatus.NOT_FOUND.value
+            )
+
+        return course_fully_created_response
+
     def create_integration_content_for_course(self, bb_course_id, channel_metadata_item):
         """
         Helper method to generate the default blackboard course content page with the integration custom information.
         """
         content_url = self.generate_create_course_content_url(bb_course_id)
+        error_message = ''
         try:
             content_resp = self._post(content_url, channel_metadata_item.get('course_content_metadata'))
             bb_content_id = content_resp.json().get('id')
         except ClientError as error:
             bb_content_id = None
+            error_message = ' and received error response={}'.format(error.message)
 
         if not bb_content_id:
             error_handling_response = self.delete_course_from_blackboard(bb_course_id)
+            error_message = '' if not error_message else error_message
             raise ClientError(
-                'Something went wrong while creating course content object on Blackboard. Could not retrieve content ID'
-                'and received error response={}. Deleted course with response (status_code={}, body={})'.format(
-                    error.message,
+                'Something went wrong while creating course content object on Blackboard. Could not retrieve content '
+                'ID{}. Deleted course with response (status_code={}, body={})'.format(
+                    error_message,
                     error_handling_response.status_code,
                     error_handling_response.text
                 ),
                 HTTPStatus.NOT_FOUND.value
             )
 
         try:
             content_child_url = self.generate_create_course_content_child_url(bb_course_id, bb_content_id)
             course_fully_created_response = self._post(
                 content_child_url, channel_metadata_item.get('course_child_content_metadata')
             )
             content_child_id = course_fully_created_response.json().get('id')
         except ClientError as error:
             content_child_id = None
+            error_message = ' and received error response={}'.format(error.message)
 
         if not content_child_id:
+            error_message = '' if not error_message else error_message
             error_handling_response = self.delete_course_from_blackboard(bb_course_id, bb_content_id)
             raise ClientError(
                 'Something went wrong while creating course content child object on Blackboard. Could not retrieve a '
                 'content child ID and got error response={}. Deleted associated course and content with response: '
                 '(status_code={}, body={})'.format(
-                    error.message,
+                    error_message,
                     error_handling_response.status_code,
                     error_handling_response.text
                 ),
                 HTTPStatus.NOT_FOUND.value
             )
 
         return course_fully_created_response
+
+    def cleanup_duplicate_assignment_records(self, courses):
+        """
+        Not implemented yet.
+        """
+        LOGGER.error(
+            generate_formatted_log(
+                self.enterprise_configuration.channel_code(),
+                self.enterprise_configuration.enterprise_customer.uuid,
+                None,
+                None,
+                "Blackboard integrated channel does not yet support assignment deduplication."
+            )
+        )
```

### Comparing `edx-enterprise-3.9.9/enterprise_learner_portal/api/v1/views.py` & `edx-enterprise-4.0.0/enterprise/management/commands/unlink_enterprise_customer_learners.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,114 +1,108 @@
-# -*- coding: utf-8 -*-
 """
-Views for enterprise_learner_portal app.
+Django management command to unlink the learners, Delete the enrollments and remove the DSC.
 """
+import csv
+import logging
 
-from edx_rest_framework_extensions.auth.jwt.authentication import JwtAuthentication
-from rest_framework import permissions
-from rest_framework.authentication import SessionAuthentication
-from rest_framework.response import Response
-from rest_framework.status import HTTP_400_BAD_REQUEST
-from rest_framework.views import APIView
-
-from django.shortcuts import get_object_or_404
-from django.utils.translation import ugettext as _
-
-from enterprise.models import EnterpriseCourseEnrollment, EnterpriseCustomerUser
-from enterprise.utils import NotConnectedToOpenEdX
-from enterprise_learner_portal.api.v1.serializers import EnterpriseCourseEnrollmentSerializer
-
-try:
-    from openedx.core.djangoapps.content.course_overviews.api import get_course_overviews
-except ImportError:
-    get_course_overviews = None
+from edx_django_utils.cache import TieredCache, get_cache_key
 
+from django.contrib import auth
+from django.core.management import BaseCommand
 
-class EnterpriseCourseEnrollmentView(APIView):
-    """
-    View for returning information around a user's enterprise course enrollments.
+from enterprise.models import EnterpriseCustomer, EnterpriseCustomerUser, PendingEnterpriseCustomerUser
+
+LOGGER = logging.getLogger(__name__)
+
+User = auth.get_user_model()
+
+
+class Command(BaseCommand):
     """
-    permission_classes = (permissions.IsAuthenticated,)
-    authentication_classes = (JwtAuthentication, SessionAuthentication,)
+    Django management command to unlink the learners, Delete the enrollments and remove the DSC
 
-    def get(self, request):
-        """
-        Get method for the view.
-        """
-        if get_course_overviews is None:
-            raise NotConnectedToOpenEdX(
-                _('To use this endpoint, this package must be '
-                  'installed in an Open edX environment.')
-            )
-
-        user = request.user
-        enterprise_customer_id = request.query_params.get('enterprise_id', None)
-        if not enterprise_customer_id:
-            return Response(
-                {'error': 'enterprise_id must be provided as a query parameter'},
-                status=HTTP_400_BAD_REQUEST
-            )
-
-        enterprise_customer_user = get_object_or_404(
-            EnterpriseCustomerUser,
-            user_id=user.id,
-            enterprise_customer__uuid=enterprise_customer_id,
-        )
-        enterprise_enrollments = EnterpriseCourseEnrollment.objects.filter(
-            enterprise_customer_user=enterprise_customer_user
-        )
+    Example usage:
+    ./manage.py lms unlink_enterprise_customer_learners -e <enterprise-uuid> --data-csv /path/file.csv
+    ./manage.py lms unlink_enterprise_customer_learners -e <enterprise-uuid> --data-csv /path/file.csv --skip-unlink
 
-        course_overviews = get_course_overviews(enterprise_enrollments.values_list('course_id', flat=True))
+    """
 
-        data = EnterpriseCourseEnrollmentSerializer(
-            enterprise_enrollments,
-            many=True,
-            context={'request': request, 'course_overviews': course_overviews},
-        ).data
-
-        return Response(data)
-
-    def patch(self, request):
-        """
-        Patch method for the view.
-        """
-        if get_course_overviews is None:
-            raise NotConnectedToOpenEdX(
-                _('To use this endpoint, this package must be '
-                  'installed in an Open edX environment.')
-            )
-
-        user = request.user
-        enterprise_customer_id = request.query_params.get('enterprise_id', None)
-        course_id = request.query_params.get('course_id', None)
-        saved_for_later = request.query_params.get('saved_for_later', None)
-
-        if not enterprise_customer_id or not course_id or saved_for_later is None:
-            return Response(
-                {'error': 'enterprise_id, course_id, and saved_for_later must be provided as query parameters'},
-                status=HTTP_400_BAD_REQUEST
-            )
-
-        enterprise_customer_user = get_object_or_404(
-            EnterpriseCustomerUser,
-            user_id=user.id,
-            enterprise_customer__uuid=enterprise_customer_id,
+    def add_arguments(self, parser):
+        parser.add_argument(
+            '--data-csv',
+            action='store',
+            dest='data_csv',
+            help='Path of csv to read emails to be unlinked.',
+            type=str,
         )
 
-        enterprise_enrollment = get_object_or_404(
-            EnterpriseCourseEnrollment,
-            enterprise_customer_user=enterprise_customer_user,
-            course_id=course_id
+        parser.add_argument(
+            '-e',
+            '--enterprise_customer_uuid',
+            action='store',
+            dest='enterprise_customer_uuid',
+            help='Run this command for only the given EnterpriseCustomer UUID.'
         )
 
-        # TODO: For now, this makes the change backward compatible, we will change this to true boolean support
-        enterprise_enrollment.saved_for_later = saved_for_later.lower() == 'true'
-
-        enterprise_enrollment.save()
+        parser.add_argument(
+            '--skip-unlink',
+            action='store_true',
+            dest='skip_unlink',
+            default=False,
+            help='Specify to remove the DSC without unlinking learner for given data_csv.'
+        )
 
-        course_overviews = get_course_overviews([course_id])
-        data = EnterpriseCourseEnrollmentSerializer(
-            enterprise_enrollment,
-            context={'request': request, 'course_overviews': course_overviews},
-        ).data
+    def handle(self, *args, **options):
+        csv_path = options['data_csv']
+        skip_unlink = options['skip_unlink']
+        enterprise_customer_uuid = options['enterprise_customer_uuid']
+        enterprise_customer = EnterpriseCustomer.objects.get(uuid=enterprise_customer_uuid)
+
+        LOGGER.info('[Unlink and Remove DSC]  Process started.')
+
+        results = {}
+
+        with open(csv_path) as csv_file:
+            rows = list(csv.DictReader(csv_file))
+        csv_file.close()
+
+        for row in rows:
+            email = row['email']
+            results[email] = {'Unlinked': None, 'Removed_DSC': None}
+
+            if not skip_unlink:
+                # Unlink the user.
+                try:
+                    EnterpriseCustomerUser.objects.unlink_user(
+                        enterprise_customer=enterprise_customer, user_email=email
+                    )
+                    results[email]['Unlinked'] = 'Success'
+                except (EnterpriseCustomerUser.DoesNotExist, PendingEnterpriseCustomerUser.DoesNotExist):
+                    message = 'Email {email} is not associated with Enterprise Customer {ec_name}'.format(
+                        email=email, ec_name=enterprise_customer.name
+                    )
+                    results[email]['Unlinked'] = message
+
+            # Deleting the DSC record.
+            try:
+                user = User.objects.get(email=email)
+                enterprise_customer_user = EnterpriseCustomerUser.all_objects.get(
+                    enterprise_customer__uuid=enterprise_customer_uuid,
+                    user_id=user.id
+                )
+                data_sharing_consent_records = enterprise_customer_user.data_sharing_consent_records
+                course_ids = list(data_sharing_consent_records.values_list('course_id', flat=True))
+                data_sharing_consent_records.delete()
+                # Deleting the DCS cache
+                for course_id in course_ids:
+                    consent_cache_key = get_cache_key(
+                        type='data_sharing_consent_needed',
+                        user_id=user.id,
+                        course_id=course_id
+                    )
+                    TieredCache.delete_all_tiers(consent_cache_key)
+                results[email]['Removed_DSC'] = course_ids
+            except (User.DoesNotExist, EnterpriseCustomerUser.DoesNotExist) as excep:
+                results[email]['Removed_DSC'] = str(excep)
 
-        return Response(data)
+        LOGGER.info('[Unlink and Remove DSC] Execution completed for enterprise: %s, \nResults: %s',
+                    enterprise_customer_uuid, results)
```

### Comparing `edx-enterprise-3.9.9/README.rst` & `edx-enterprise-4.0.0/README.rst`

 * *Files 7% similar despite different names*

```diff
@@ -1,32 +1,28 @@
 enterprise
 ==========
 
 .. image:: https://img.shields.io/pypi/v/edx-enterprise.svg
     :target: https://pypi.python.org/pypi/edx-enterprise/
     :alt: PyPI
 
-.. image:: https://travis-ci.org/edx/edx-enterprise.svg?branch=master
-    :target: https://travis-ci.org/edx/edx-enterprise
-    :alt: Travis
-
 .. image:: http://codecov.io/github/edx/edx-enterprise/coverage.svg?branch=master
     :target: http://codecov.io/github/edx/edx-enterprise?branch=master
     :alt: Codecov
 
 .. image:: https://readthedocs.org/projects/open-edx-enterprise-service-documentation/badge/?version=latest
     :target: http://open-edx-enterprise-service-documentation.readthedocs.io/en/latest/
     :alt: Documentation
 
 .. image:: https://img.shields.io/pypi/pyversions/edx-enterprise.svg
     :target: https://pypi.python.org/pypi/edx-enterprise/
     :alt: Supported Python versions
 
 .. image:: https://img.shields.io/github/license/edx/edx-enterprise.svg
-    :target: https://github.com/edx/edx-enterprise/blob/master/LICENSE.txt
+    :target: https://github.com/openedx/edx-enterprise/blob/master/LICENSE.txt
     :alt: License
 
 The ``Open edx Enterprise Service`` app provides enterprise features to the Open
 edX platform.  The majority of these features are structured around the concept
 of an ``Enterprise Customer``, which is an organization or a group of people
 that "consumes" courses published on the Open edX platform.
 
@@ -44,24 +40,21 @@
 Please see ``LICENSE.txt`` for details.
 
 How To Contribute
 -----------------
 
 Contributions are very welcome.
 
-Please read `How To Contribute <https://github.com/edx/edx-platform/blob/master/CONTRIBUTING.rst>`_ for details.
-
-Even though they were written with ``edx-platform`` in mind, the guidelines
-should be followed for Open edX code in general.
+Please read `How To Contribute <https://github.com/openedx/.github/blob/master/CONTRIBUTING.md>`_ for details.
 
 A Pull Request Description Template can be found at`PULL_REQUEST_TEMPLATE.md`_ - this
 template is automatically applied when you open a pull request from GitHub.  Please
 make sure to include this template if submitting a pull request via other channels.
 
-.. _PULL_REQUEST_TEMPLATE.md: https://github.com/edx/edx-enterprise/blob/master/.github/PULL_REQUEST_TEMPLATE_TEMPLATE.md
+.. _PULL_REQUEST_TEMPLATE.md: https://github.com/openedx/edx-enterprise/blob/master/.github/PULL_REQUEST_TEMPLATE_TEMPLATE.md
 
 After submitting a pull request, please use the Github "Reviewers" widget to add
 relevant reviewers and track review process.
 
 Reporting Security Issues
 -------------------------
 
@@ -69,8 +62,8 @@
 
 Getting Help
 ------------
 
 Have a question about this repository, or about Open edX in general?  Please
 refer to this `list of resources`_ if you need any assistance.
 
-.. _list of resources: https://open.edx.org/getting-help
+.. _list of resources: https://openedx.org/getting-help
```

### Comparing `edx-enterprise-3.9.9/setup.py` & `edx-enterprise-4.0.0/setup.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,9 +1,8 @@
 #!/usr/bin/env python
-# -*- coding: utf-8 -*-
 # pylint: disable=C0111,W6005,W6100
 
 
 import os
 import re
 import sys
 
@@ -50,19 +49,15 @@
             # Remove -e <version_control> string
             package_link = re.sub(r'(.*)(?P<dependency_link>https?.*$)', r'\g<dependency_link>', package_link)
             package = re.sub(r'(egg=)?(?P<package_name>.*)==.*$', r'\g<package_name>', package)
             package_version = re.sub(r'.*[^=]==', '', line.strip())
 
             if package:
                 dependency_links.append(
-                    '{package_link}#egg={package}-{package_version}'.format(
-                        package_link=package_link,
-                        package=package,
-                        package_version=package_version,
-                    )
+                    f'{package_link}#egg={package}-{package_version}'
                 )
         else:
             # Ignore any trailing comment
             package, __, __ = package.partition('#')
             # Remove any whitespace and assume non-empty results are dependencies
             package = package.strip()
 
@@ -71,38 +66,39 @@
     return dependencies, dependency_links
 
 
 VERSION = get_version("enterprise", "__init__.py")
 
 if sys.argv[-1] == "tag":
     print("Tagging the version on github:")
-    os.system("git tag -a %s -m 'version %s'" % (VERSION, VERSION))
+    os.system(f"git tag -a {VERSION} -m 'version {VERSION}'")
     os.system("git push --tags")
     sys.exit()
 
 base_path = os.path.dirname(__file__)
 
 README = open(os.path.join(base_path, "README.rst")).read()
 CHANGELOG = open(os.path.join(base_path, "CHANGELOG.rst")).read()
 REQUIREMENTS, DEPENDENCY_LINKS = get_requirements(os.path.join(base_path, 'requirements', 'base.in'))
 
 setup(
     name="edx-enterprise",
     version=VERSION,
     description="""Your project description goes here""",
-    long_description=README + "\n\n" + CHANGELOG,
+    long_description=f"{README}\n\n{CHANGELOG}",
     author="edX",
     author_email="oscm@edx.org",
-    url="https://github.com/edx/edx-enterprise",
+    url="https://github.com/openedx/edx-enterprise",
     packages=[
         "enterprise",
         "consent",
         "integrated_channels",
         "integrated_channels.integrated_channel",
         "integrated_channels.degreed",
+        "integrated_channels.degreed2",
         "integrated_channels.canvas",
         "integrated_channels.blackboard",
         "integrated_channels.cornerstone",
         "integrated_channels.moodle",
         "integrated_channels.sap_success_factors",
         "integrated_channels.xapi",
         "enterprise_learner_portal",
@@ -112,16 +108,15 @@
     dependency_links=DEPENDENCY_LINKS,
     license="AGPL 3.0",
     zip_safe=False,
     keywords="Django edx",
     classifiers=[
         "Development Status :: 3 - Alpha",
         "Framework :: Django",
-        "Framework :: Django :: 2.2",
+        "Framework :: Django :: 3.2",
         "Intended Audience :: Developers",
         "License :: OSI Approved :: GNU Affero General Public License v3 or later (AGPLv3+)",
         "Natural Language :: English",
         "Programming Language :: Python :: 3",
-        "Programming Language :: Python :: 3.5",
         "Programming Language :: Python :: 3.8",
     ],
 )
```


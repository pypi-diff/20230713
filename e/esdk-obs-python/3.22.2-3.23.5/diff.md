# Comparing `tmp/esdk-obs-python-3.22.2.tar.gz` & `tmp/esdk-obs-python-3.23.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist\esdk-obs-python-3.22.2.tar", last modified: Tue Mar  1 16:50:38 2022, max compression
+gzip compressed data, was "dist\esdk-obs-python-3.23.5.tar", last modified: Thu Jul 13 14:50:38 2023, max compression
```

## Comparing `esdk-obs-python-3.22.2.tar` & `esdk-obs-python-3.23.5.tar`

### file list

```diff
@@ -1,33 +1,34 @@
-drwxrwxrwx   0        0        0        0 2022-03-01 16:50:38.757709 esdk-obs-python-3.22.2/
--rw-rw-rw-   0        0        0      243 2022-03-01 16:50:38.757709 esdk-obs-python-3.22.2/PKG-INFO
-drwxrwxrwx   0        0        0        0 2022-03-01 16:50:38.651613 esdk-obs-python-3.22.2/esdk_obs_python.egg-info/
--rw-rw-rw-   0        0        0      243 2022-03-01 16:50:38.000000 esdk-obs-python-3.22.2/esdk_obs_python.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      566 2022-03-01 16:50:38.000000 esdk-obs-python-3.22.2/esdk_obs_python.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2022-03-01 16:50:38.000000 esdk-obs-python-3.22.2/esdk_obs_python.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0        2 2022-03-01 16:50:38.000000 esdk-obs-python-3.22.2/esdk_obs_python.egg-info/not-zip-safe
--rw-rw-rw-   0        0        0       21 2022-03-01 16:50:38.000000 esdk-obs-python-3.22.2/esdk_obs_python.egg-info/requires.txt
--rw-rw-rw-   0        0        0        4 2022-03-01 16:50:38.000000 esdk-obs-python-3.22.2/esdk_obs_python.egg-info/top_level.txt
-drwxrwxrwx   0        0        0        0 2022-03-01 16:50:38.756708 esdk-obs-python-3.22.2/obs/
--rw-rw-rw-   0        0        0     3312 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/__init__.py
--rw-rw-rw-   0        0        0    11070 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/auth.py
--rw-rw-rw-   0        0        0     3620 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/bucket.py
--rw-rw-rw-   0        0        0     6476 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/bulktasks.py
--rw-rw-rw-   0        0        0     1347 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/cache.py
--rw-rw-rw-   0        0        0   128055 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/client.py
--rw-rw-rw-   0        0        0    10176 2022-03-01 16:28:53.000000 esdk-obs-python-3.22.2/obs/const.py
--rw-rw-rw-   0        0        0   114511 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/convertor.py
--rw-rw-rw-   0        0        0    16746 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/crypto_client.py
--rw-rw-rw-   0        0        0     6781 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/extension.py
--rw-rw-rw-   0        0        0     5912 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/http2.py
--rw-rw-rw-   0        0        0     5802 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/ilog.py
--rw-rw-rw-   0        0        0     6321 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/loadtoken.py
--rw-rw-rw-   0        0        0      894 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/locks.py
--rw-rw-rw-   0        0        0    61704 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/model.py
--rw-rw-rw-   0        0        0    16210 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/obs_cipher_suite.py
--rw-rw-rw-   0        0        0     2522 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/progress.py
--rw-rw-rw-   0        0        0     1623 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/searchmethod.py
--rw-rw-rw-   0        0        0    36205 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/transfer.py
--rw-rw-rw-   0        0        0    12382 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/util.py
--rw-rw-rw-   0        0        0    15539 2022-02-25 11:07:54.000000 esdk-obs-python-3.22.2/obs/workflow.py
--rw-rw-rw-   0        0        0       42 2022-03-01 16:50:38.757709 esdk-obs-python-3.22.2/setup.cfg
--rw-rw-rw-   0        0        0     1263 2022-03-01 16:28:53.000000 esdk-obs-python-3.22.2/setup.py
+drwxrwxrwx   0        0        0        0 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/
+-rw-rw-rw-   0        0        0      243 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/PKG-INFO
+drwxrwxrwx   0        0        0        0 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/esdk_obs_python.egg-info/
+-rw-rw-rw-   0        0        0      243 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/esdk_obs_python.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      588 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/esdk_obs_python.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/esdk_obs_python.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0        2 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/esdk_obs_python.egg-info/not-zip-safe
+-rw-rw-rw-   0        0        0       21 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/esdk_obs_python.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        4 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/esdk_obs_python.egg-info/top_level.txt
+drwxrwxrwx   0        0        0        0 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/obs/
+-rw-rw-rw-   0        0        0     3353 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/__init__.py
+-rw-rw-rw-   0        0        0    11070 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/auth.py
+-rw-rw-rw-   0        0        0     3620 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/bucket.py
+-rw-rw-rw-   0        0        0     6476 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/bulktasks.py
+-rw-rw-rw-   0        0        0     1347 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/cache.py
+-rw-rw-rw-   0        0        0   128968 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/client.py
+-rw-rw-rw-   0        0        0     9825 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/const.py
+-rw-rw-rw-   0        0        0   117804 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/convertor.py
+-rw-rw-rw-   0        0        0    16746 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/crypto_client.py
+-rw-rw-rw-   0        0        0     6781 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/extension.py
+-rw-rw-rw-   0        0        0     5912 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/http2.py
+-rw-rw-rw-   0        0        0     5780 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/ilog.py
+-rw-rw-rw-   0        0        0     6321 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/loadtoken.py
+-rw-rw-rw-   0        0        0      894 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/locks.py
+-rw-rw-rw-   0        0        0    64175 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/model.py
+-rw-rw-rw-   0        0        0    16231 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/obs_cipher_suite.py
+-rw-rw-rw-   0        0        0     3206 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/posix_transfer.py
+-rw-rw-rw-   0        0        0     2522 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/progress.py
+-rw-rw-rw-   0        0        0     1647 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/searchmethod.py
+-rw-rw-rw-   0        0        0    37148 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/transfer.py
+-rw-rw-rw-   0        0        0    13152 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/util.py
+-rw-rw-rw-   0        0        0    15539 2023-06-10 09:00:40.000000 esdk-obs-python-3.23.5/obs/workflow.py
+-rw-rw-rw-   0        0        0       42 2023-07-13 14:50:38.000000 esdk-obs-python-3.23.5/setup.cfg
+-rw-rw-rw-   0        0        0     1227 2023-07-13 14:50:36.000000 esdk-obs-python-3.23.5/setup.py
```

### filetype from file(1)

```diff
@@ -1 +1 @@
-POSIX tar archive
+POSIX tar archive (GNU)
```

### Comparing `esdk-obs-python-3.22.2/esdk_obs_python.egg-info/SOURCES.txt` & `esdk-obs-python-3.23.5/esdk_obs_python.egg-info/SOURCES.txt`

 * *Files 21% similar despite different names*

```diff
@@ -17,12 +17,13 @@
 obs/extension.py
 obs/http2.py
 obs/ilog.py
 obs/loadtoken.py
 obs/locks.py
 obs/model.py
 obs/obs_cipher_suite.py
+obs/posix_transfer.py
 obs/progress.py
 obs/searchmethod.py
 obs/transfer.py
 obs/util.py
 obs/workflow.py
```

### Comparing `esdk-obs-python-3.22.2/obs/__init__.py` & `esdk-obs-python-3.23.5/obs/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -12,15 +12,15 @@
 # specific language governing permissions and limitations under the License.
 
 
 from obs.ilog import LogConf
 from obs.client import ObsClient
 from obs.model import CompletePart, Permission, StorageClass, EventType, RestoreTier, Group, Grantee, Grant
 from obs.model import ExtensionGrant, Owner, ACL, Condition, DateTime, SseCHeader, SseKmsHeader, CopyObjectHeader
-from obs.model import SetObjectMetadataHeader, CorsRule, CreateBucketHeader, ErrorDocument, IndexDocument, Expiration
+from obs.model import SetObjectMetadataHeader,RenameFileHeader, CorsRule, CreateBucketHeader, ErrorDocument, IndexDocument, Expiration
 from obs.model import NoncurrentVersionExpiration, GetObjectHeader, HeadPermission, Lifecycle, Notification
 from obs.model import TopicConfiguration, FunctionGraphConfiguration, FilterRule, Replication, ReplicationRule
 from obs.model import Options, PutObjectHeader, AppendObjectHeader, AppendObjectContent, RedirectAllRequestTo
 from obs.model import Redirect, RoutingRule, Tag, TagInfo, Transition, NoncurrentVersionTransition, Rule, Versions
 from obs.model import Object, WebsiteConfiguration, Logging, CompleteMultipartUploadRequest, DeleteObjectsRequest
 from obs.model import ListMultipartUploadsRequest, GetObjectRequest, UploadFileHeader, Payer
 from obs.model import ExtensionHeader, FetchStatus, BucketAliasModel, ListBucketAliasModel
@@ -45,14 +45,15 @@
     'ACL',
     'Condition',
     'DateTime',
     'SseCHeader',
     'SseKmsHeader',
     'CopyObjectHeader',
     'SetObjectMetadataHeader',
+    'RenameFileHeader',
     'CorsRule',
     'CreateBucketHeader',
     'ErrorDocument',
     'IndexDocument',
     'Expiration',
     'NoncurrentVersionExpiration',
     'GetObjectHeader',
```

### Comparing `esdk-obs-python-3.22.2/obs/auth.py` & `esdk-obs-python-3.23.5/obs/auth.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/bucket.py` & `esdk-obs-python-3.23.5/obs/bucket.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/bulktasks.py` & `esdk-obs-python-3.23.5/obs/bulktasks.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/cache.py` & `esdk-obs-python-3.23.5/obs/cache.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/client.py` & `esdk-obs-python-3.23.5/obs/client.py`

 * *Files 1% similar despite different names*

```diff
@@ -39,7966 +39,8023 @@
 00000260: 6465 7220 7468 6520 4c69 6365 6e73 652e  der the License.
 00000270: 0a0a 6672 6f6d 205f 5f66 7574 7572 655f  ..from __future_
 00000280: 5f20 696d 706f 7274 2070 7269 6e74 5f66  _ import print_f
 00000290: 756e 6374 696f 6e0a 0a69 6d70 6f72 7420  unction..import 
 000002a0: 6675 6e63 746f 6f6c 730a 696d 706f 7274  functools.import
 000002b0: 206d 6174 680a 696d 706f 7274 206f 730a   math.import os.
 000002c0: 696d 706f 7274 2072 616e 646f 6d0a 696d  import random.im
-000002d0: 706f 7274 2072 650a 696d 706f 7274 2074  port re.import t
-000002e0: 6872 6561 6469 6e67 0a69 6d70 6f72 7420  hreading.import 
-000002f0: 7469 6d65 0a69 6d70 6f72 7420 7472 6163  time.import trac
-00000300: 6562 6163 6b0a 696d 706f 7274 206a 736f  eback.import jso
-00000310: 6e0a 6672 6f6d 2069 6e73 7065 6374 2069  n.from inspect i
-00000320: 6d70 6f72 7420 6973 6675 6e63 7469 6f6e  mport isfunction
-00000330: 0a66 726f 6d20 6f62 7320 696d 706f 7274  .from obs import
-00000340: 2061 7574 682c 2063 6f6e 7374 2c20 636f   auth, const, co
-00000350: 6e76 6572 746f 722c 206c 6f61 6474 6f6b  nvertor, loadtok
-00000360: 656e 2c20 6c6f 636b 732c 2070 726f 6772  en, locks, progr
-00000370: 6573 732c 2075 7469 6c0a 6672 6f6d 206f  ess, util.from o
-00000380: 6273 2e62 7563 6b65 7420 696d 706f 7274  bs.bucket import
-00000390: 2042 7563 6b65 7443 6c69 656e 740a 6672   BucketClient.fr
-000003a0: 6f6d 206f 6273 2e63 6163 6865 2069 6d70  om obs.cache imp
-000003b0: 6f72 7420 4c6f 6361 6c43 6163 6865 0a66  ort LocalCache.f
-000003c0: 726f 6d20 6f62 732e 6578 7465 6e73 696f  rom obs.extensio
-000003d0: 6e20 696d 706f 7274 205f 646f 776e 6c6f  n import _downlo
-000003e0: 6164 5f66 696c 6573 0a66 726f 6d20 6f62  ad_files.from ob
-000003f0: 732e 696c 6f67 2069 6d70 6f72 7420 4445  s.ilog import DE
-00000400: 4255 472c 2045 5252 4f52 2c20 494e 464f  BUG, ERROR, INFO
-00000410: 2c20 4c6f 6743 6c69 656e 742c 204e 6f6e  , LogClient, Non
-00000420: 654c 6f67 436c 6965 6e74 2c20 5741 524e  eLogClient, WARN
-00000430: 494e 470a 6672 6f6d 206f 6273 2e6d 6f64  ING.from obs.mod
-00000440: 656c 2069 6d70 6f72 7420 4143 4c2c 2041  el import ACL, A
-00000450: 7070 656e 644f 626a 6563 7443 6f6e 7465  ppendObjectConte
-00000460: 6e74 2c20 4170 7065 6e64 4f62 6a65 6374  nt, AppendObject
-00000470: 4865 6164 6572 2c20 4261 7365 4d6f 6465  Header, BaseMode
-00000480: 6c2c 2043 6f70 794f 626a 6563 7448 6561  l, CopyObjectHea
-00000490: 6465 722c 2043 7265 6174 6542 7563 6b65  der, CreateBucke
-000004a0: 7448 6561 6465 722c 205c 0a20 2020 2046  tHeader, \.    F
-000004b0: 6574 6368 506f 6c69 6379 2c20 4765 744f  etchPolicy, GetO
-000004c0: 626a 6563 7448 6561 6465 722c 2047 6574  bjectHeader, Get
-000004d0: 4f62 6a65 6374 5265 7175 6573 742c 2047  ObjectRequest, G
-000004e0: 6574 5265 7375 6c74 2c20 4c69 7374 4d75  etResult, ListMu
-000004f0: 6c74 6970 6172 7455 706c 6f61 6473 5265  ltipartUploadsRe
-00000500: 7175 6573 742c 204c 6f67 6769 6e67 2c20  quest, Logging, 
-00000510: 4e6f 7469 6669 6361 7469 6f6e 2c20 5c0a  Notification, \.
-00000520: 2020 2020 4f62 6a65 6374 5374 7265 616d      ObjectStream
-00000530: 2c20 5075 744f 626a 6563 7448 6561 6465  , PutObjectHeade
-00000540: 722c 2052 6573 706f 6e73 6557 7261 7070  r, ResponseWrapp
-00000550: 6572 2c20 5365 744f 626a 6563 744d 6574  er, SetObjectMet
-00000560: 6164 6174 6148 6561 6465 722c 2056 6572  adataHeader, Ver
-00000570: 7369 6f6e 732c 205f 4665 7463 684a 6f62  sions, _FetchJob
-00000580: 2c20 4578 7465 6e73 696f 6e48 6561 6465  , ExtensionHeade
-00000590: 722c 205c 0a20 2020 2042 7563 6b65 7441  r, \.    BucketA
-000005a0: 6c69 6173 4d6f 6465 6c2c 2052 6570 6c69  liasModel, Repli
-000005b0: 6361 7469 6f6e 2c20 5265 706c 6963 6174  cation, Replicat
-000005c0: 696f 6e52 756c 650a 6672 6f6d 206f 6273  ionRule.from obs
-000005d0: 2e74 7261 6e73 6665 7220 696d 706f 7274  .transfer import
-000005e0: 205f 7265 7375 6d65 5f64 6f77 6e6c 6f61   _resume_downloa
-000005f0: 642c 205f 7265 7375 6d65 5f75 706c 6f61  d, _resume_uploa
-00000600: 640a 0a69 6620 636f 6e73 742e 4953 5f50  d..if const.IS_P
-00000610: 5954 484f 4e32 3a0a 2020 2020 6672 6f6d  YTHON2:.    from
-00000620: 2075 726c 7061 7273 6520 696d 706f 7274   urlparse import
-00000630: 2075 726c 7061 7273 650a 2020 2020 696d   urlparse.    im
-00000640: 706f 7274 2068 7474 706c 6962 0a65 6c73  port httplib.els
-00000650: 653a 0a20 2020 2069 6d70 6f72 7420 6874  e:.    import ht
-00000660: 7470 2e63 6c69 656e 7420 6173 2068 7474  tp.client as htt
-00000670: 706c 6962 0a20 2020 2066 726f 6d20 7572  plib.    from ur
-00000680: 6c6c 6962 2e70 6172 7365 2069 6d70 6f72  llib.parse impor
-00000690: 7420 7572 6c70 6172 7365 0a0a 0a63 6c61  t urlparse...cla
-000006a0: 7373 205f 5265 6469 7265 6374 4578 6365  ss _RedirectExce
-000006b0: 7074 696f 6e28 4578 6365 7074 696f 6e29  ption(Exception)
-000006c0: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
-000006d0: 5f5f 2873 656c 662c 206d 7367 2c20 6c6f  __(self, msg, lo
-000006e0: 6361 7469 6f6e 2c20 7265 7375 6c74 3d4e  cation, result=N
-000006f0: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
-00000700: 6c66 2e6d 7367 203d 206d 7367 0a20 2020  lf.msg = msg.   
-00000710: 2020 2020 2073 656c 662e 6c6f 6361 7469       self.locati
-00000720: 6f6e 203d 206c 6f63 6174 696f 6e0a 2020  on = location.  
-00000730: 2020 2020 2020 7365 6c66 2e72 6573 756c        self.resul
-00000740: 7420 3d20 7265 7375 6c74 0a0a 2020 2020  t = result..    
-00000750: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
-00000760: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00000770: 6e20 7365 6c66 2e6d 7367 0a0a 0a63 6c61  n self.msg...cla
-00000780: 7373 205f 496e 7465 726e 616c 4578 6365  ss _InternalExce
-00000790: 7074 696f 6e28 4578 6365 7074 696f 6e29  ption(Exception)
-000007a0: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
-000007b0: 5f5f 2873 656c 662c 2072 6573 756c 7429  __(self, result)
-000007c0: 3a0a 2020 2020 2020 2020 7365 6c66 2e72  :.        self.r
-000007d0: 6573 756c 7420 3d20 7265 7375 6c74 0a0a  esult = result..
-000007e0: 0a63 6c61 7373 205f 5365 6375 7269 7479  .class _Security
-000007f0: 5072 6f76 6964 6572 286f 626a 6563 7429  Provider(object)
-00000800: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
-00000810: 5f5f 2873 656c 662c 2061 6363 6573 735f  __(self, access_
-00000820: 6b65 795f 6964 2c20 7365 6372 6574 5f61  key_id, secret_a
-00000830: 6363 6573 735f 6b65 792c 2073 6563 7572  ccess_key, secur
-00000840: 6974 795f 746f 6b65 6e3d 4e6f 6e65 293a  ity_token=None):
-00000850: 0a20 2020 2020 2020 2061 6363 6573 735f  .        access_
-00000860: 6b65 795f 6964 203d 2075 7469 6c2e 746f  key_id = util.to
-00000870: 5f73 7472 696e 6728 7574 696c 2e73 6166  _string(util.saf
-00000880: 655f 656e 636f 6465 2861 6363 6573 735f  e_encode(access_
-00000890: 6b65 795f 6964 2929 2e73 7472 6970 2829  key_id)).strip()
-000008a0: 0a20 2020 2020 2020 2073 6563 7265 745f  .        secret_
-000008b0: 6163 6365 7373 5f6b 6579 203d 2075 7469  access_key = uti
-000008c0: 6c2e 746f 5f73 7472 696e 6728 7574 696c  l.to_string(util
-000008d0: 2e73 6166 655f 656e 636f 6465 2873 6563  .safe_encode(sec
-000008e0: 7265 745f 6163 6365 7373 5f6b 6579 2929  ret_access_key))
-000008f0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
-00000900: 2073 6563 7572 6974 795f 746f 6b65 6e20   security_token 
-00000910: 3d20 7574 696c 2e74 6f5f 7374 7269 6e67  = util.to_string
-00000920: 280a 2020 2020 2020 2020 2020 2020 7574  (.            ut
-00000930: 696c 2e73 6166 655f 656e 636f 6465 2873  il.safe_encode(s
-00000940: 6563 7572 6974 795f 746f 6b65 6e29 292e  ecurity_token)).
-00000950: 7374 7269 7028 2920 6966 2073 6563 7572  strip() if secur
-00000960: 6974 795f 746f 6b65 6e20 6973 206e 6f74  ity_token is not
-00000970: 204e 6f6e 6520 656c 7365 204e 6f6e 650a   None else None.
-00000980: 2020 2020 2020 2020 7365 6c66 2e61 6363          self.acc
-00000990: 6573 735f 6b65 795f 6964 203d 2061 6363  ess_key_id = acc
-000009a0: 6573 735f 6b65 795f 6964 0a20 2020 2020  ess_key_id.     
-000009b0: 2020 2073 656c 662e 7365 6372 6574 5f61     self.secret_a
-000009c0: 6363 6573 735f 6b65 7920 3d20 7365 6372  ccess_key = secr
-000009d0: 6574 5f61 6363 6573 735f 6b65 790a 2020  et_access_key.  
-000009e0: 2020 2020 2020 7365 6c66 2e73 6563 7572        self.secur
-000009f0: 6974 795f 746f 6b65 6e20 3d20 7365 6375  ity_token = secu
-00000a00: 7269 7479 5f74 6f6b 656e 0a0a 0a64 6566  rity_token...def
-00000a10: 205f 6765 7443 6163 6865 4b65 7928 6e61   _getCacheKey(na
-00000a20: 6d65 2c20 6f62 7343 6c69 656e 742c 202a  me, obsClient, *
-00000a30: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-00000a40: 0a20 2020 206b 6579 203d 2027 270a 2020  .    key = ''.  
-00000a50: 2020 6c69 7374 5f6f 7065 7261 7469 6f6e    list_operation
-00000a60: 203d 205b 276c 6973 7442 7563 6b65 7473   = ['listBuckets
-00000a70: 272c 2027 6c69 7374 4275 636b 6574 416c  ', 'listBucketAl
-00000a80: 6961 7327 5d0a 2020 2020 6966 206e 616d  ias'].    if nam
-00000a90: 6520 3d3d 2027 636f 7079 4f62 6a65 6374  e == 'copyObject
-00000aa0: 273a 0a20 2020 2020 2020 2069 6620 6b77  ':.        if kw
-00000ab0: 6172 6773 2e67 6574 2827 6465 7374 4275  args.get('destBu
-00000ac0: 636b 6574 4e61 6d65 2729 3a0a 2020 2020  cketName'):.    
-00000ad0: 2020 2020 2020 2020 6b65 7920 3d20 6b77          key = kw
-00000ae0: 6172 6773 5b27 6465 7374 4275 636b 6574  args['destBucket
-00000af0: 4e61 6d65 275d 0a20 2020 2020 2020 2065  Name'].        e
-00000b00: 6c69 6620 6c65 6e28 6172 6773 2920 3e3d  lif len(args) >=
-00000b10: 2034 3a0a 2020 2020 2020 2020 2020 2020   4:.            
-00000b20: 6b65 7920 3d20 6172 6773 5b33 5d0a 0a20  key = args[3].. 
-00000b30: 2020 2020 2020 2069 6620 6e6f 7420 6f62         if not ob
-00000b40: 7343 6c69 656e 742e 6973 5f63 6e61 6d65  sClient.is_cname
-00000b50: 3a0a 2020 2020 2020 2020 2020 2020 6f62  :.            ob
-00000b60: 7343 6c69 656e 742e 5f61 7373 6572 745f  sClient._assert_
-00000b70: 6e6f 745f 6e75 6c6c 286b 6579 2c20 2764  not_null(key, 'd
-00000b80: 6573 7442 7563 6b65 744e 616d 6520 6973  estBucketName is
-00000b90: 2065 6d70 7479 2729 0a0a 2020 2020 656c   empty')..    el
-00000ba0: 6966 206e 616d 6520 6e6f 7420 696e 206c  if name not in l
-00000bb0: 6973 745f 6f70 6572 6174 696f 6e3a 0a20  ist_operation:. 
-00000bc0: 2020 2020 2020 2069 6620 6c65 6e28 6172         if len(ar
-00000bd0: 6773 2920 3e20 313a 0a20 2020 2020 2020  gs) > 1:.       
-00000be0: 2020 2020 206b 6579 203d 2061 7267 735b       key = args[
-00000bf0: 315d 0a20 2020 2020 2020 2065 6c69 6620  1].        elif 
-00000c00: 6b77 6172 6773 2e67 6574 2827 6275 636b  kwargs.get('buck
-00000c10: 6574 4e61 6d65 2729 3a0a 2020 2020 2020  etName'):.      
-00000c20: 2020 2020 2020 6b65 7920 3d20 6b77 6172        key = kwar
-00000c30: 6773 5b27 6275 636b 6574 4e61 6d65 275d  gs['bucketName']
-00000c40: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00000c50: 206f 6273 436c 6965 6e74 2e69 735f 636e   obsClient.is_cn
-00000c60: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
-00000c70: 206f 6273 436c 6965 6e74 2e5f 6173 7365   obsClient._asse
-00000c80: 7274 5f6e 6f74 5f6e 756c 6c28 6b65 792c  rt_not_null(key,
-00000c90: 2027 6275 636b 6574 4e61 6d65 2069 7320   'bucketName is 
-00000ca0: 656d 7074 7927 290a 2020 2020 7265 7475  empty').    retu
-00000cb0: 726e 206b 6579 0a0a 0a64 6566 205f 7772  rn key...def _wr
-00000cc0: 6170 7065 7246 696e 616c 6c79 286f 6273  apperFinally(obs
-00000cd0: 436c 6965 6e74 2c20 6e61 6d65 2c20 7374  Client, name, st
-00000ce0: 6172 7429 3a0a 2020 2020 6966 206f 6273  art):.    if obs
-00000cf0: 436c 6965 6e74 3a0a 2020 2020 2020 2020  Client:.        
-00000d00: 6f62 7343 6c69 656e 742e 6c6f 675f 636c  obsClient.log_cl
-00000d10: 6965 6e74 2e6c 6f67 2849 4e46 4f2c 2027  ient.log(INFO, '
-00000d20: 2573 2063 6f73 7420 2573 206d 7327 2025  %s cost %s ms' %
-00000d30: 2028 6e61 6d65 2c20 696e 7428 2874 696d   (name, int((tim
-00000d40: 652e 7469 6d65 2829 202d 2073 7461 7274  e.time() - start
-00000d50: 2920 2a20 3130 3030 2929 290a 2020 2020  ) * 1000))).    
-00000d60: 2020 2020 6966 206f 6273 436c 6965 6e74      if obsClient
-00000d70: 2e69 735f 7369 676e 6174 7572 655f 6e65  .is_signature_ne
-00000d80: 676f 7469 6174 696f 6e20 616e 6420 6861  gotiation and ha
-00000d90: 7361 7474 7228 6f62 7343 6c69 656e 742e  sattr(obsClient.
-00000da0: 7468 7265 6164 5f6c 6f63 616c 2c20 2773  thread_local, 's
-00000db0: 6967 6e61 7475 7265 2729 3a0a 2020 2020  ignature'):.    
-00000dc0: 2020 2020 2020 2020 6465 6c20 6f62 7343          del obsC
-00000dd0: 6c69 656e 742e 7468 7265 6164 5f6c 6f63  lient.thread_loc
-00000de0: 616c 2e73 6967 6e61 7475 7265 0a0a 0a64  al.signature...d
-00000df0: 6566 205f 6765 744f 6273 436c 6965 6e74  ef _getObsClient
-00000e00: 282a 6172 6773 293a 0a20 2020 206f 6273  (*args):.    obs
-00000e10: 436c 6965 6e74 203d 2061 7267 735b 305d  Client = args[0]
-00000e20: 2069 6620 6973 696e 7374 616e 6365 2861   if isinstance(a
-00000e30: 7267 735b 305d 2c20 4f62 7343 6c69 656e  rgs[0], ObsClien
-00000e40: 7429 2065 6c73 6520 4e6f 6e65 0a20 2020  t) else None.   
-00000e50: 2072 6574 7572 6e20 6f62 7343 6c69 656e   return obsClien
-00000e60: 740a 0a0a 6465 6620 5f69 7343 7265 6174  t...def _isCreat
-00000e70: 6542 7563 6b65 7428 6f62 7343 6c69 656e  eBucket(obsClien
-00000e80: 742c 206e 616d 652c 206b 6579 293a 0a20  t, name, key):. 
-00000e90: 2020 2072 6574 7572 6e20 6f62 7343 6c69     return obsCli
-00000ea0: 656e 742e 5f67 6574 4170 6956 6572 7369  ent._getApiVersi
-00000eb0: 6f6e 2829 2069 6620 6e61 6d65 203d 3d20  on() if name == 
-00000ec0: 2763 7265 6174 6542 7563 6b65 7427 2065  'createBucket' e
-00000ed0: 6c73 6520 6f62 7343 6c69 656e 742e 5f67  lse obsClient._g
-00000ee0: 6574 4170 6956 6572 7369 6f6e 286b 6579  etApiVersion(key
-00000ef0: 290a 0a0a 6465 6620 5f69 735f 7369 676e  )...def _is_sign
-00000f00: 6174 7572 655f 6e65 676f 7469 6174 696f  ature_negotiatio
-00000f10: 6e28 6f62 7343 6c69 656e 742c 206e 616d  n(obsClient, nam
-00000f20: 652c 206b 6579 293a 0a20 2020 2063 6163  e, key):.    cac
-00000f30: 6865 7320 3d20 6f62 7343 6c69 656e 742e  hes = obsClient.
-00000f40: 6361 6368 650a 2020 2020 6966 206e 616d  cache.    if nam
-00000f50: 6520 3d3d 2027 6c69 7374 4275 636b 6574  e == 'listBucket
-00000f60: 7327 3a0a 2020 2020 2020 2020 6175 7468  s':.        auth
-00000f70: 5479 7065 2c20 7265 7370 203d 206f 6273  Type, resp = obs
-00000f80: 436c 6965 6e74 2e5f 6765 7441 7069 5665  Client._getApiVe
-00000f90: 7273 696f 6e28 290a 2020 2020 2020 2020  rsion().        
-00000fa0: 6966 206e 6f74 2061 7574 6854 7970 653a  if not authType:
-00000fb0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00000fc0: 7572 6e20 6175 7468 5479 7065 2c20 7265  urn authType, re
-00000fd0: 7370 0a20 2020 2020 2020 206f 6273 436c  sp.        obsCl
-00000fe0: 6965 6e74 2e74 6872 6561 645f 6c6f 6361  ient.thread_loca
-00000ff0: 6c2e 7369 676e 6174 7572 6520 3d20 6175  l.signature = au
-00001000: 7468 5479 7065 0a20 2020 2020 2020 2072  thType.        r
+000002d0: 706f 7274 2072 650a 696d 706f 7274 2073  port re.import s
+000002e0: 7461 740a 696d 706f 7274 2074 6872 6561  tat.import threa
+000002f0: 6469 6e67 0a69 6d70 6f72 7420 7469 6d65  ding.import time
+00000300: 0a69 6d70 6f72 7420 7472 6163 6562 6163  .import tracebac
+00000310: 6b0a 696d 706f 7274 206a 736f 6e0a 6672  k.import json.fr
+00000320: 6f6d 2069 6e73 7065 6374 2069 6d70 6f72  om inspect impor
+00000330: 7420 6973 6675 6e63 7469 6f6e 0a66 726f  t isfunction.fro
+00000340: 6d20 6f62 7320 696d 706f 7274 2061 7574  m obs import aut
+00000350: 682c 2063 6f6e 7374 2c20 636f 6e76 6572  h, const, conver
+00000360: 746f 722c 206c 6f61 6474 6f6b 656e 2c20  tor, loadtoken, 
+00000370: 6c6f 636b 732c 2070 726f 6772 6573 732c  locks, progress,
+00000380: 2075 7469 6c0a 6672 6f6d 206f 6273 2e62   util.from obs.b
+00000390: 7563 6b65 7420 696d 706f 7274 2042 7563  ucket import Buc
+000003a0: 6b65 7443 6c69 656e 740a 6672 6f6d 206f  ketClient.from o
+000003b0: 6273 2e63 6163 6865 2069 6d70 6f72 7420  bs.cache import 
+000003c0: 4c6f 6361 6c43 6163 6865 0a66 726f 6d20  LocalCache.from 
+000003d0: 6f62 732e 6578 7465 6e73 696f 6e20 696d  obs.extension im
+000003e0: 706f 7274 205f 646f 776e 6c6f 6164 5f66  port _download_f
+000003f0: 696c 6573 0a66 726f 6d20 6f62 732e 696c  iles.from obs.il
+00000400: 6f67 2069 6d70 6f72 7420 4445 4255 472c  og import DEBUG,
+00000410: 2045 5252 4f52 2c20 494e 464f 2c20 4c6f   ERROR, INFO, Lo
+00000420: 6743 6c69 656e 742c 204e 6f6e 654c 6f67  gClient, NoneLog
+00000430: 436c 6965 6e74 2c20 5741 524e 494e 470a  Client, WARNING.
+00000440: 6672 6f6d 206f 6273 2e6d 6f64 656c 2069  from obs.model i
+00000450: 6d70 6f72 7420 4143 4c2c 2041 7070 656e  mport ACL, Appen
+00000460: 644f 626a 6563 7443 6f6e 7465 6e74 2c20  dObjectContent, 
+00000470: 4170 7065 6e64 4f62 6a65 6374 4865 6164  AppendObjectHead
+00000480: 6572 2c20 4261 7365 4d6f 6465 6c2c 2043  er, BaseModel, C
+00000490: 6f70 794f 626a 6563 7448 6561 6465 722c  opyObjectHeader,
+000004a0: 2043 7265 6174 6542 7563 6b65 7448 6561   CreateBucketHea
+000004b0: 6465 722c 205c 0a20 2020 2046 6574 6368  der, \.    Fetch
+000004c0: 506f 6c69 6379 2c20 4765 744f 626a 6563  Policy, GetObjec
+000004d0: 7448 6561 6465 722c 2047 6574 4f62 6a65  tHeader, GetObje
+000004e0: 6374 5265 7175 6573 742c 2047 6574 5265  ctRequest, GetRe
+000004f0: 7375 6c74 2c20 4c69 7374 4d75 6c74 6970  sult, ListMultip
+00000500: 6172 7455 706c 6f61 6473 5265 7175 6573  artUploadsReques
+00000510: 742c 204c 6f67 6769 6e67 2c20 4e6f 7469  t, Logging, Noti
+00000520: 6669 6361 7469 6f6e 2c20 5c0a 2020 2020  fication, \.    
+00000530: 4f62 6a65 6374 5374 7265 616d 2c20 5075  ObjectStream, Pu
+00000540: 744f 626a 6563 7448 6561 6465 722c 2052  tObjectHeader, R
+00000550: 6573 706f 6e73 6557 7261 7070 6572 2c20  esponseWrapper, 
+00000560: 5365 744f 626a 6563 744d 6574 6164 6174  SetObjectMetadat
+00000570: 6148 6561 6465 722c 2052 656e 616d 6546  aHeader, RenameF
+00000580: 696c 6548 6561 6465 722c 2056 6572 7369  ileHeader, Versi
+00000590: 6f6e 732c 205f 4665 7463 684a 6f62 2c20  ons, _FetchJob, 
+000005a0: 5c0a 2020 2020 4578 7465 6e73 696f 6e48  \.    ExtensionH
+000005b0: 6561 6465 722c 205c 0a20 2020 2042 7563  eader, \.    Buc
+000005c0: 6b65 7441 6c69 6173 4d6f 6465 6c2c 2052  ketAliasModel, R
+000005d0: 6570 6c69 6361 7469 6f6e 2c20 5265 706c  eplication, Repl
+000005e0: 6963 6174 696f 6e52 756c 650a 6672 6f6d  icationRule.from
+000005f0: 206f 6273 2e74 7261 6e73 6665 7220 696d   obs.transfer im
+00000600: 706f 7274 205f 7265 7375 6d65 5f64 6f77  port _resume_dow
+00000610: 6e6c 6f61 642c 205f 7265 7375 6d65 5f75  nload, _resume_u
+00000620: 706c 6f61 640a 6672 6f6d 206f 6273 2e70  pload.from obs.p
+00000630: 6f73 6978 5f74 7261 6e73 6665 7220 696d  osix_transfer im
+00000640: 706f 7274 205f 7265 7375 6d65 5f64 656c  port _resume_del
+00000650: 6574 650a 0a69 6620 636f 6e73 742e 4953  ete..if const.IS
+00000660: 5f50 5954 484f 4e32 3a0a 2020 2020 6672  _PYTHON2:.    fr
+00000670: 6f6d 2075 726c 7061 7273 6520 696d 706f  om urlparse impo
+00000680: 7274 2075 726c 7061 7273 650a 2020 2020  rt urlparse.    
+00000690: 696d 706f 7274 2068 7474 706c 6962 0a65  import httplib.e
+000006a0: 6c73 653a 0a20 2020 2069 6d70 6f72 7420  lse:.    import 
+000006b0: 6874 7470 2e63 6c69 656e 7420 6173 2068  http.client as h
+000006c0: 7474 706c 6962 0a20 2020 2066 726f 6d20  ttplib.    from 
+000006d0: 7572 6c6c 6962 2e70 6172 7365 2069 6d70  urllib.parse imp
+000006e0: 6f72 7420 7572 6c70 6172 7365 0a0a 0a63  ort urlparse...c
+000006f0: 6c61 7373 205f 5265 6469 7265 6374 4578  lass _RedirectEx
+00000700: 6365 7074 696f 6e28 4578 6365 7074 696f  ception(Exceptio
+00000710: 6e29 3a0a 2020 2020 6465 6620 5f5f 696e  n):.    def __in
+00000720: 6974 5f5f 2873 656c 662c 206d 7367 2c20  it__(self, msg, 
+00000730: 6c6f 6361 7469 6f6e 2c20 7265 7375 6c74  location, result
+00000740: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00000750: 7365 6c66 2e6d 7367 203d 206d 7367 0a20  self.msg = msg. 
+00000760: 2020 2020 2020 2073 656c 662e 6c6f 6361         self.loca
+00000770: 7469 6f6e 203d 206c 6f63 6174 696f 6e0a  tion = location.
+00000780: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
+00000790: 756c 7420 3d20 7265 7375 6c74 0a0a 2020  ult = result..  
+000007a0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
+000007b0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+000007c0: 7572 6e20 7365 6c66 2e6d 7367 0a0a 0a63  urn self.msg...c
+000007d0: 6c61 7373 205f 496e 7465 726e 616c 4578  lass _InternalEx
+000007e0: 6365 7074 696f 6e28 4578 6365 7074 696f  ception(Exceptio
+000007f0: 6e29 3a0a 2020 2020 6465 6620 5f5f 696e  n):.    def __in
+00000800: 6974 5f5f 2873 656c 662c 2072 6573 756c  it__(self, resul
+00000810: 7429 3a0a 2020 2020 2020 2020 7365 6c66  t):.        self
+00000820: 2e72 6573 756c 7420 3d20 7265 7375 6c74  .result = result
+00000830: 0a0a 0a63 6c61 7373 205f 5365 6375 7269  ...class _Securi
+00000840: 7479 5072 6f76 6964 6572 286f 626a 6563  tyProvider(objec
+00000850: 7429 3a0a 2020 2020 6465 6620 5f5f 696e  t):.    def __in
+00000860: 6974 5f5f 2873 656c 662c 2061 6363 6573  it__(self, acces
+00000870: 735f 6b65 795f 6964 2c20 7365 6372 6574  s_key_id, secret
+00000880: 5f61 6363 6573 735f 6b65 792c 2073 6563  _access_key, sec
+00000890: 7572 6974 795f 746f 6b65 6e3d 4e6f 6e65  urity_token=None
+000008a0: 293a 0a20 2020 2020 2020 2061 6363 6573  ):.        acces
+000008b0: 735f 6b65 795f 6964 203d 2075 7469 6c2e  s_key_id = util.
+000008c0: 746f 5f73 7472 696e 6728 7574 696c 2e73  to_string(util.s
+000008d0: 6166 655f 656e 636f 6465 2861 6363 6573  afe_encode(acces
+000008e0: 735f 6b65 795f 6964 2929 2e73 7472 6970  s_key_id)).strip
+000008f0: 2829 0a20 2020 2020 2020 2073 6563 7265  ().        secre
+00000900: 745f 6163 6365 7373 5f6b 6579 203d 2075  t_access_key = u
+00000910: 7469 6c2e 746f 5f73 7472 696e 6728 7574  til.to_string(ut
+00000920: 696c 2e73 6166 655f 656e 636f 6465 2873  il.safe_encode(s
+00000930: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
+00000940: 2929 2e73 7472 6970 2829 0a20 2020 2020  )).strip().     
+00000950: 2020 2073 6563 7572 6974 795f 746f 6b65     security_toke
+00000960: 6e20 3d20 7574 696c 2e74 6f5f 7374 7269  n = util.to_stri
+00000970: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+00000980: 7574 696c 2e73 6166 655f 656e 636f 6465  util.safe_encode
+00000990: 2873 6563 7572 6974 795f 746f 6b65 6e29  (security_token)
+000009a0: 292e 7374 7269 7028 2920 6966 2073 6563  ).strip() if sec
+000009b0: 7572 6974 795f 746f 6b65 6e20 6973 206e  urity_token is n
+000009c0: 6f74 204e 6f6e 6520 656c 7365 204e 6f6e  ot None else Non
+000009d0: 650a 2020 2020 2020 2020 7365 6c66 2e61  e.        self.a
+000009e0: 6363 6573 735f 6b65 795f 6964 203d 2061  ccess_key_id = a
+000009f0: 6363 6573 735f 6b65 795f 6964 0a20 2020  ccess_key_id.   
+00000a00: 2020 2020 2073 656c 662e 7365 6372 6574       self.secret
+00000a10: 5f61 6363 6573 735f 6b65 7920 3d20 7365  _access_key = se
+00000a20: 6372 6574 5f61 6363 6573 735f 6b65 790a  cret_access_key.
+00000a30: 2020 2020 2020 2020 7365 6c66 2e73 6563          self.sec
+00000a40: 7572 6974 795f 746f 6b65 6e20 3d20 7365  urity_token = se
+00000a50: 6375 7269 7479 5f74 6f6b 656e 0a0a 0a64  curity_token...d
+00000a60: 6566 205f 6765 7443 6163 6865 4b65 7928  ef _getCacheKey(
+00000a70: 6e61 6d65 2c20 6f62 7343 6c69 656e 742c  name, obsClient,
+00000a80: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+00000a90: 293a 0a20 2020 206b 6579 203d 2027 270a  ):.    key = ''.
+00000aa0: 2020 2020 6c69 7374 5f6f 7065 7261 7469      list_operati
+00000ab0: 6f6e 203d 205b 276c 6973 7442 7563 6b65  on = ['listBucke
+00000ac0: 7473 272c 2027 6c69 7374 4275 636b 6574  ts', 'listBucket
+00000ad0: 416c 6961 7327 5d0a 2020 2020 6966 206e  Alias'].    if n
+00000ae0: 616d 6520 3d3d 2027 636f 7079 4f62 6a65  ame == 'copyObje
+00000af0: 6374 273a 0a20 2020 2020 2020 2069 6620  ct':.        if 
+00000b00: 6b77 6172 6773 2e67 6574 2827 6465 7374  kwargs.get('dest
+00000b10: 4275 636b 6574 4e61 6d65 2729 3a0a 2020  BucketName'):.  
+00000b20: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
+00000b30: 6b77 6172 6773 5b27 6465 7374 4275 636b  kwargs['destBuck
+00000b40: 6574 4e61 6d65 275d 0a20 2020 2020 2020  etName'].       
+00000b50: 2065 6c69 6620 6c65 6e28 6172 6773 2920   elif len(args) 
+00000b60: 3e3d 2034 3a0a 2020 2020 2020 2020 2020  >= 4:.          
+00000b70: 2020 6b65 7920 3d20 6172 6773 5b33 5d0a    key = args[3].
+00000b80: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00000b90: 6f62 7343 6c69 656e 742e 6973 5f63 6e61  obsClient.is_cna
+00000ba0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00000bb0: 6f62 7343 6c69 656e 742e 5f61 7373 6572  obsClient._asser
+00000bc0: 745f 6e6f 745f 6e75 6c6c 286b 6579 2c20  t_not_null(key, 
+00000bd0: 2764 6573 7442 7563 6b65 744e 616d 6520  'destBucketName 
+00000be0: 6973 2065 6d70 7479 2729 0a0a 2020 2020  is empty')..    
+00000bf0: 656c 6966 206e 616d 6520 6e6f 7420 696e  elif name not in
+00000c00: 206c 6973 745f 6f70 6572 6174 696f 6e3a   list_operation:
+00000c10: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00000c20: 6172 6773 2920 3e20 313a 0a20 2020 2020  args) > 1:.     
+00000c30: 2020 2020 2020 206b 6579 203d 2061 7267         key = arg
+00000c40: 735b 315d 0a20 2020 2020 2020 2065 6c69  s[1].        eli
+00000c50: 6620 6b77 6172 6773 2e67 6574 2827 6275  f kwargs.get('bu
+00000c60: 636b 6574 4e61 6d65 2729 3a0a 2020 2020  cketName'):.    
+00000c70: 2020 2020 2020 2020 6b65 7920 3d20 6b77          key = kw
+00000c80: 6172 6773 5b27 6275 636b 6574 4e61 6d65  args['bucketName
+00000c90: 275d 0a0a 2020 2020 2020 2020 6966 206e  ']..        if n
+00000ca0: 6f74 206f 6273 436c 6965 6e74 2e69 735f  ot obsClient.is_
+00000cb0: 636e 616d 653a 0a20 2020 2020 2020 2020  cname:.         
+00000cc0: 2020 206f 6273 436c 6965 6e74 2e5f 6173     obsClient._as
+00000cd0: 7365 7274 5f6e 6f74 5f6e 756c 6c28 6b65  sert_not_null(ke
+00000ce0: 792c 2027 6275 636b 6574 4e61 6d65 2069  y, 'bucketName i
+00000cf0: 7320 656d 7074 7927 290a 2020 2020 7265  s empty').    re
+00000d00: 7475 726e 206b 6579 0a0a 0a64 6566 205f  turn key...def _
+00000d10: 7772 6170 7065 7246 696e 616c 6c79 286f  wrapperFinally(o
+00000d20: 6273 436c 6965 6e74 2c20 6e61 6d65 2c20  bsClient, name, 
+00000d30: 7374 6172 7429 3a0a 2020 2020 6966 206f  start):.    if o
+00000d40: 6273 436c 6965 6e74 3a0a 2020 2020 2020  bsClient:.      
+00000d50: 2020 6f62 7343 6c69 656e 742e 6c6f 675f    obsClient.log_
+00000d60: 636c 6965 6e74 2e6c 6f67 2849 4e46 4f2c  client.log(INFO,
+00000d70: 2027 2573 2063 6f73 7420 2573 206d 7327   '%s cost %s ms'
+00000d80: 2025 2028 6e61 6d65 2c20 696e 7428 2874   % (name, int((t
+00000d90: 696d 652e 7469 6d65 2829 202d 2073 7461  ime.time() - sta
+00000da0: 7274 2920 2a20 3130 3030 2929 290a 2020  rt) * 1000))).  
+00000db0: 2020 2020 2020 6966 206f 6273 436c 6965        if obsClie
+00000dc0: 6e74 2e69 735f 7369 676e 6174 7572 655f  nt.is_signature_
+00000dd0: 6e65 676f 7469 6174 696f 6e20 616e 6420  negotiation and 
+00000de0: 6861 7361 7474 7228 6f62 7343 6c69 656e  hasattr(obsClien
+00000df0: 742e 7468 7265 6164 5f6c 6f63 616c 2c20  t.thread_local, 
+00000e00: 2773 6967 6e61 7475 7265 2729 3a0a 2020  'signature'):.  
+00000e10: 2020 2020 2020 2020 2020 6465 6c20 6f62            del ob
+00000e20: 7343 6c69 656e 742e 7468 7265 6164 5f6c  sClient.thread_l
+00000e30: 6f63 616c 2e73 6967 6e61 7475 7265 0a0a  ocal.signature..
+00000e40: 0a64 6566 205f 6765 744f 6273 436c 6965  .def _getObsClie
+00000e50: 6e74 282a 6172 6773 293a 0a20 2020 206f  nt(*args):.    o
+00000e60: 6273 436c 6965 6e74 203d 2061 7267 735b  bsClient = args[
+00000e70: 305d 2069 6620 6973 696e 7374 616e 6365  0] if isinstance
+00000e80: 2861 7267 735b 305d 2c20 4f62 7343 6c69  (args[0], ObsCli
+00000e90: 656e 7429 2065 6c73 6520 4e6f 6e65 0a20  ent) else None. 
+00000ea0: 2020 2072 6574 7572 6e20 6f62 7343 6c69     return obsCli
+00000eb0: 656e 740a 0a0a 6465 6620 5f69 7343 7265  ent...def _isCre
+00000ec0: 6174 6542 7563 6b65 7428 6f62 7343 6c69  ateBucket(obsCli
+00000ed0: 656e 742c 206e 616d 652c 206b 6579 293a  ent, name, key):
+00000ee0: 0a20 2020 2072 6574 7572 6e20 6f62 7343  .    return obsC
+00000ef0: 6c69 656e 742e 5f67 6574 4170 6956 6572  lient._getApiVer
+00000f00: 7369 6f6e 2829 2069 6620 6e61 6d65 203d  sion() if name =
+00000f10: 3d20 2763 7265 6174 6542 7563 6b65 7427  = 'createBucket'
+00000f20: 2065 6c73 6520 6f62 7343 6c69 656e 742e   else obsClient.
+00000f30: 5f67 6574 4170 6956 6572 7369 6f6e 286b  _getApiVersion(k
+00000f40: 6579 290a 0a0a 6465 6620 5f69 735f 7369  ey)...def _is_si
+00000f50: 676e 6174 7572 655f 6e65 676f 7469 6174  gnature_negotiat
+00000f60: 696f 6e28 6f62 7343 6c69 656e 742c 206e  ion(obsClient, n
+00000f70: 616d 652c 206b 6579 293a 0a20 2020 2063  ame, key):.    c
+00000f80: 6163 6865 7320 3d20 6f62 7343 6c69 656e  aches = obsClien
+00000f90: 742e 6361 6368 650a 2020 2020 6966 206e  t.cache.    if n
+00000fa0: 616d 6520 3d3d 2027 6c69 7374 4275 636b  ame == 'listBuck
+00000fb0: 6574 7327 3a0a 2020 2020 2020 2020 6175  ets':.        au
+00000fc0: 7468 5479 7065 2c20 7265 7370 203d 206f  thType, resp = o
+00000fd0: 6273 436c 6965 6e74 2e5f 6765 7441 7069  bsClient._getApi
+00000fe0: 5665 7273 696f 6e28 290a 2020 2020 2020  Version().      
+00000ff0: 2020 6966 206e 6f74 2061 7574 6854 7970    if not authTyp
+00001000: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
 00001010: 6574 7572 6e20 6175 7468 5479 7065 2c20  eturn authType, 
-00001020: 7265 7370 0a20 2020 2065 6c73 653a 0a20  resp.    else:. 
-00001030: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
-00001040: 6320 3d20 6361 6368 6573 2e67 6574 286b  c = caches.get(k
-00001050: 6579 290a 2020 2020 2020 2020 6966 206e  ey).        if n
-00001060: 6f74 2072 6573 756c 745f 6469 633a 0a20  ot result_dic:. 
-00001070: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00001080: 6c6f 636b 732e 6765 745f 6c6f 636b 2868  locks.get_lock(h
-00001090: 6173 6828 6b65 7929 2025 206c 6f63 6b73  ash(key) % locks
-000010a0: 2e4c 4f43 4b5f 434f 554e 5429 3a0a 2020  .LOCK_COUNT):.  
-000010b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000010c0: 7375 6c74 5f64 6963 203d 2063 6163 6865  sult_dic = cache
-000010d0: 732e 6765 7428 6b65 7929 0a20 2020 2020  s.get(key).     
-000010e0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000010f0: 7420 7265 7375 6c74 5f64 6963 3a0a 2020  t result_dic:.  
+00001020: 7265 7370 0a20 2020 2020 2020 206f 6273  resp.        obs
+00001030: 436c 6965 6e74 2e74 6872 6561 645f 6c6f  Client.thread_lo
+00001040: 6361 6c2e 7369 676e 6174 7572 6520 3d20  cal.signature = 
+00001050: 6175 7468 5479 7065 0a20 2020 2020 2020  authType.       
+00001060: 2072 6574 7572 6e20 6175 7468 5479 7065   return authType
+00001070: 2c20 7265 7370 0a20 2020 2065 6c73 653a  , resp.    else:
+00001080: 0a20 2020 2020 2020 2072 6573 756c 745f  .        result_
+00001090: 6469 6320 3d20 6361 6368 6573 2e67 6574  dic = caches.get
+000010a0: 286b 6579 290a 2020 2020 2020 2020 6966  (key).        if
+000010b0: 206e 6f74 2072 6573 756c 745f 6469 633a   not result_dic:
+000010c0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+000010d0: 6820 6c6f 636b 732e 6765 745f 6c6f 636b  h locks.get_lock
+000010e0: 2868 6173 6828 6b65 7929 2025 206c 6f63  (hash(key) % loc
+000010f0: 6b73 2e4c 4f43 4b5f 434f 554e 5429 3a0a  ks.LOCK_COUNT):.
 00001100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001110: 2020 6175 7468 5479 7065 2c20 7265 7370    authType, resp
-00001120: 203d 205f 6973 4372 6561 7465 4275 636b   = _isCreateBuck
-00001130: 6574 286f 6273 436c 6965 6e74 2c20 6e61  et(obsClient, na
-00001140: 6d65 2c20 6b65 7929 0a20 2020 2020 2020  me, key).       
-00001150: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00001160: 6e6f 7420 6175 7468 5479 7065 3a0a 2020  not authType:.  
-00001170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001180: 2020 2020 2020 7265 7475 726e 2061 7574        return aut
-00001190: 6854 7970 652c 2072 6573 700a 2020 2020  hType, resp.    
-000011a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000011b0: 7265 7375 6c74 5f64 6963 203d 207b 2773  result_dic = {'s
-000011c0: 6967 6e61 7475 7265 273a 2061 7574 6854  ignature': authT
-000011d0: 7970 652c 2027 6578 7069 7265 273a 2072  ype, 'expire': r
-000011e0: 616e 646f 6d2e 7261 6e64 696e 7428 3930  andom.randint(90
-000011f0: 302c 2031 3230 3029 202b 2063 6163 6865  0, 1200) + cache
-00001200: 732e 6e6f 7754 696d 6528 297d 0a20 2020  s.nowTime()}.   
-00001210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001220: 2069 6620 6e61 6d65 2021 3d20 2763 7265   if name != 'cre
-00001230: 6174 6542 7563 6b65 7427 3a0a 2020 2020  ateBucket':.    
-00001240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001250: 2020 2020 6361 6368 6573 2e73 6574 286b      caches.set(k
-00001260: 6579 2c20 7265 7375 6c74 5f64 6963 290a  ey, result_dic).
-00001270: 2020 2020 2020 2020 6f62 7343 6c69 656e          obsClien
-00001280: 742e 7468 7265 6164 5f6c 6f63 616c 2e73  t.thread_local.s
-00001290: 6967 6e61 7475 7265 203d 2072 6573 756c  ignature = resul
-000012a0: 745f 6469 635b 2773 6967 6e61 7475 7265  t_dic['signature
-000012b0: 275d 0a20 2020 2020 2020 2072 6574 7572  '].        retur
-000012c0: 6e20 5472 7565 2c20 2222 0a0a 0a64 6566  n True, ""...def
-000012d0: 2066 756e 6343 6163 6865 2866 756e 6329   funcCache(func)
-000012e0: 3a0a 2020 2020 4066 756e 6374 6f6f 6c73  :.    @functools
-000012f0: 2e77 7261 7073 2866 756e 6329 0a20 2020  .wraps(func).   
-00001300: 2064 6566 2077 7261 7070 6572 282a 6172   def wrapper(*ar
-00001310: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
-00001320: 2020 2020 2020 2073 7461 7274 203d 2074         start = t
-00001330: 696d 652e 7469 6d65 2829 0a20 2020 2020  ime.time().     
-00001340: 2020 2072 6574 203d 204e 6f6e 650a 2020     ret = None.  
-00001350: 2020 2020 2020 6f62 7343 6c69 656e 7420        obsClient 
-00001360: 3d20 5f67 6574 4f62 7343 6c69 656e 7428  = _getObsClient(
-00001370: 2a61 7267 7329 0a20 2020 2020 2020 2074  *args).        t
-00001380: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00001390: 6966 206f 6273 436c 6965 6e74 3a0a 2020  if obsClient:.  
-000013a0: 2020 2020 2020 2020 2020 2020 2020 6f62                ob
-000013b0: 7343 6c69 656e 742e 6c6f 675f 636c 6965  sClient.log_clie
-000013c0: 6e74 2e6c 6f67 2849 4e46 4f2c 2027 656e  nt.log(INFO, 'en
-000013d0: 7465 7220 2573 202e 2e2e 2720 2520 6675  ter %s ...' % fu
-000013e0: 6e63 2e5f 5f6e 616d 655f 5f29 0a20 2020  nc.__name__).   
-000013f0: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00001400: 203d 205f 6765 7443 6163 6865 4b65 7928   = _getCacheKey(
-00001410: 6675 6e63 2e5f 5f6e 616d 655f 5f2c 206f  func.__name__, o
-00001420: 6273 436c 6965 6e74 2c20 2a61 7267 732c  bsClient, *args,
-00001430: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00001440: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00001450: 6273 436c 6965 6e74 2e69 735f 7369 676e  bsClient.is_sign
-00001460: 6174 7572 655f 6e65 676f 7469 6174 696f  ature_negotiatio
-00001470: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00001480: 2020 2020 2020 2062 6c61 636b 5f6c 6973         black_lis
-00001490: 7420 3d20 5b27 6c69 7374 4176 6169 6c61  t = ['listAvaila
-000014a0: 626c 655a 6f6e 6549 6e66 6f27 2c20 2763  bleZoneInfo', 'c
-000014b0: 7265 6174 6556 6972 7475 616c 4275 636b  reateVirtualBuck
-000014c0: 6574 272c 2027 6372 6561 7465 4275 636b  et', 'createBuck
-000014d0: 6574 416c 6961 7327 2c0a 2020 2020 2020  etAlias',.      
-000014e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014f0: 2020 2020 2020 2020 2020 2020 276c 6973              'lis
-00001500: 7442 7563 6b65 7441 6c69 6173 272c 2027  tBucketAlias', '
-00001510: 6465 6c65 7465 4275 636b 6574 416c 6961  deleteBucketAlia
-00001520: 7327 5d0a 2020 2020 2020 2020 2020 2020  s'].            
-00001530: 2020 2020 2020 2020 6966 2066 756e 632e          if func.
-00001540: 5f5f 6e61 6d65 5f5f 2069 6e20 626c 6163  __name__ in blac
-00001550: 6b5f 6c69 7374 3a0a 2020 2020 2020 2020  k_list:.        
-00001560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001570: 6f62 7343 6c69 656e 742e 7468 7265 6164  obsClient.thread
-00001580: 5f6c 6f63 616c 2e73 6967 6e61 7475 7265  _local.signature
-00001590: 203d 2063 6f6e 7374 2e4f 4253 5f53 4947   = const.OBS_SIG
-000015a0: 4e41 5455 5245 0a20 2020 2020 2020 2020  NATURE.         
-000015b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000015c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000015d0: 2020 2020 2020 2020 2061 7574 6854 7970           authTyp
-000015e0: 652c 2072 6573 7020 3d20 5f69 735f 7369  e, resp = _is_si
-000015f0: 676e 6174 7572 655f 6e65 676f 7469 6174  gnature_negotiat
-00001600: 696f 6e28 6f62 7343 6c69 656e 742c 2066  ion(obsClient, f
-00001610: 756e 632e 5f5f 6e61 6d65 5f5f 2c20 6b65  unc.__name__, ke
-00001620: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
-00001630: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00001640: 7420 6175 7468 5479 7065 3a0a 2020 2020  t authType:.    
-00001650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001660: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00001670: 6573 700a 2020 2020 2020 2020 2020 2020  esp.            
-00001680: 7265 7420 3d20 6675 6e63 282a 6172 6773  ret = func(*args
-00001690: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-000016a0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-000016b0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-000016c0: 2020 2020 2020 2069 6620 6f62 7343 6c69         if obsCli
-000016d0: 656e 7420 616e 6420 6f62 7343 6c69 656e  ent and obsClien
-000016e0: 742e 6c6f 675f 636c 6965 6e74 3a0a 2020  t.log_client:.  
-000016f0: 2020 2020 2020 2020 2020 2020 2020 6f62                ob
-00001700: 7343 6c69 656e 742e 6c6f 675f 636c 6965  sClient.log_clie
-00001710: 6e74 2e6c 6f67 2849 4e46 4f2c 2074 7261  nt.log(INFO, tra
-00001720: 6365 6261 636b 2e66 6f72 6d61 745f 6578  ceback.format_ex
-00001730: 6328 2929 0a20 2020 2020 2020 2020 2020  c()).           
-00001740: 2072 6169 7365 2065 0a20 2020 2020 2020   raise e.       
-00001750: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-00001760: 2020 2020 2020 5f77 7261 7070 6572 4669        _wrapperFi
-00001770: 6e61 6c6c 7928 6f62 7343 6c69 656e 742c  nally(obsClient,
-00001780: 2066 756e 632e 5f5f 6e61 6d65 5f5f 2c20   func.__name__, 
-00001790: 7374 6172 7429 0a20 2020 2020 2020 2072  start).        r
-000017a0: 6574 7572 6e20 7265 740a 0a20 2020 2072  eturn ret..    r
-000017b0: 6574 7572 6e20 7772 6170 7065 720a 0a0a  eturn wrapper...
-000017c0: 636c 6173 7320 4861 5772 6170 7065 7228  class HaWrapper(
-000017d0: 6f62 6a65 6374 293a 0a20 2020 2064 6566  object):.    def
-000017e0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-000017f0: 7468 7265 6164 5f6c 6f63 616c 2c20 7369  thread_local, si
-00001800: 676e 6174 7572 6529 3a0a 2020 2020 2020  gnature):.      
-00001810: 2020 7365 6c66 2e6f 6273 4841 203d 2063    self.obsHA = c
-00001820: 6f6e 7665 7274 6f72 2e41 6461 7074 6572  onvertor.Adapter
-00001830: 2827 6f62 7327 290a 2020 2020 2020 2020  ('obs').        
-00001840: 7365 6c66 2e76 3248 4120 3d20 636f 6e76  self.v2HA = conv
-00001850: 6572 746f 722e 4164 6170 7465 7228 2776  ertor.Adapter('v
-00001860: 3227 290a 2020 2020 2020 2020 7365 6c66  2').        self
-00001870: 2e76 3448 4120 3d20 636f 6e76 6572 746f  .v4HA = converto
-00001880: 722e 4164 6170 7465 7228 2776 3427 290a  r.Adapter('v4').
-00001890: 2020 2020 2020 2020 7365 6c66 2e74 6872          self.thr
-000018a0: 6561 645f 6c6f 6361 6c20 3d20 7468 7265  ead_local = thre
-000018b0: 6164 5f6c 6f63 616c 0a20 2020 2020 2020  ad_local.       
-000018c0: 2073 656c 662e 7369 676e 6174 7572 6520   self.signature 
-000018d0: 3d20 7369 676e 6174 7572 650a 0a20 2020  = signature..   
-000018e0: 2064 6566 205f 5f67 6574 6174 7472 5f5f   def __getattr__
-000018f0: 2873 656c 662c 2069 7465 6d29 3a0a 2020  (self, item):.  
-00001900: 2020 2020 2020 7369 676e 6174 7572 6520        signature 
-00001910: 3d20 7365 6c66 2e74 6872 6561 645f 6c6f  = self.thread_lo
-00001920: 6361 6c2e 7369 676e 6174 7572 6520 6966  cal.signature if
-00001930: 2068 6173 6174 7472 2873 656c 662e 7468   hasattr(self.th
-00001940: 7265 6164 5f6c 6f63 616c 2c20 2773 6967  read_local, 'sig
-00001950: 6e61 7475 7265 2729 2065 6c73 6520 7365  nature') else se
-00001960: 6c66 2e73 6967 6e61 7475 7265 0a20 2020  lf.signature.   
-00001970: 2020 2020 2068 6120 3d20 7365 6c66 2e6f       ha = self.o
-00001980: 6273 4841 2069 6620 7369 676e 6174 7572  bsHA if signatur
-00001990: 6520 3d3d 2027 6f62 7327 2065 6c73 6520  e == 'obs' else 
-000019a0: 7365 6c66 2e76 3448 4120 6966 2073 6967  self.v4HA if sig
-000019b0: 6e61 7475 7265 203d 3d20 2776 3427 2065  nature == 'v4' e
-000019c0: 6c73 6520 7365 6c66 2e76 3248 410a 2020  lse self.v2HA.  
-000019d0: 2020 2020 2020 7265 7475 726e 2067 6574        return get
-000019e0: 6174 7472 2868 612c 2069 7465 6d29 0a0a  attr(ha, item)..
-000019f0: 0a63 6c61 7373 2043 6f6e 7665 7274 5772  .class ConvertWr
-00001a00: 6170 7065 7228 6f62 6a65 6374 293a 0a20  apper(object):. 
-00001a10: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00001a20: 7365 6c66 2c20 7468 7265 6164 5f6c 6f63  self, thread_loc
-00001a30: 616c 2c20 7369 676e 6174 7572 6529 3a0a  al, signature):.
-00001a40: 2020 2020 2020 2020 7365 6c66 2e6f 6273          self.obs
-00001a50: 436f 7665 7220 3d20 636f 6e76 6572 746f  Cover = converto
-00001a60: 722e 436f 6e76 6572 746f 7228 276f 6273  r.Convertor('obs
-00001a70: 272c 2063 6f6e 7665 7274 6f72 2e41 6461  ', convertor.Ada
-00001a80: 7074 6572 2827 6f62 7327 2929 0a20 2020  pter('obs')).   
-00001a90: 2020 2020 2073 656c 662e 7632 436f 7665       self.v2Cove
-00001aa0: 7220 3d20 636f 6e76 6572 746f 722e 436f  r = convertor.Co
-00001ab0: 6e76 6572 746f 7228 2776 3227 2c20 636f  nvertor('v2', co
-00001ac0: 6e76 6572 746f 722e 4164 6170 7465 7228  nvertor.Adapter(
-00001ad0: 2776 3227 2929 0a20 2020 2020 2020 2073  'v2')).        s
-00001ae0: 656c 662e 7634 436f 7665 7220 3d20 636f  elf.v4Cover = co
-00001af0: 6e76 6572 746f 722e 436f 6e76 6572 746f  nvertor.Converto
-00001b00: 7228 2776 3427 2c20 636f 6e76 6572 746f  r('v4', converto
-00001b10: 722e 4164 6170 7465 7228 2776 3427 2929  r.Adapter('v4'))
-00001b20: 0a20 2020 2020 2020 2073 656c 662e 7468  .        self.th
-00001b30: 7265 6164 5f6c 6f63 616c 203d 2074 6872  read_local = thr
-00001b40: 6561 645f 6c6f 6361 6c0a 2020 2020 2020  ead_local.      
-00001b50: 2020 7365 6c66 2e73 6967 6e61 7475 7265    self.signature
-00001b60: 203d 2073 6967 6e61 7475 7265 0a0a 2020   = signature..  
-00001b70: 2020 6465 6620 5f5f 6765 7461 7474 725f    def __getattr_
-00001b80: 5f28 7365 6c66 2c20 6974 656d 293a 0a20  _(self, item):. 
-00001b90: 2020 2020 2020 2073 6967 6e61 7475 7265         signature
-00001ba0: 203d 2073 656c 662e 7468 7265 6164 5f6c   = self.thread_l
-00001bb0: 6f63 616c 2e73 6967 6e61 7475 7265 2069  ocal.signature i
-00001bc0: 6620 6861 7361 7474 7228 7365 6c66 2e74  f hasattr(self.t
-00001bd0: 6872 6561 645f 6c6f 6361 6c2c 2027 7369  hread_local, 'si
-00001be0: 676e 6174 7572 6527 2920 656c 7365 2073  gnature') else s
-00001bf0: 656c 662e 7369 676e 6174 7572 650a 2020  elf.signature.  
-00001c00: 2020 2020 2020 636f 6e76 6572 7420 3d20        convert = 
-00001c10: 7365 6c66 2e6f 6273 436f 7665 7220 6966  self.obsCover if
-00001c20: 2073 6967 6e61 7475 7265 203d 3d20 276f   signature == 'o
-00001c30: 6273 2720 656c 7365 2073 656c 662e 7634  bs' else self.v4
-00001c40: 436f 7665 7220 6966 2073 6967 6e61 7475  Cover if signatu
-00001c50: 7265 203d 3d20 2776 3427 2065 6c73 6520  re == 'v4' else 
-00001c60: 7365 6c66 2e76 3243 6f76 6572 0a20 2020  self.v2Cover.   
-00001c70: 2020 2020 2072 6574 7572 6e20 6765 7461       return geta
-00001c80: 7474 7228 636f 6e76 6572 742c 2069 7465  ttr(convert, ite
-00001c90: 6d29 0a0a 0a63 6c61 7373 205f 4261 7369  m)...class _Basi
-00001ca0: 6343 6c69 656e 7428 6f62 6a65 6374 293a  cClient(object):
-00001cb0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00001cc0: 5f28 7365 6c66 2c20 6163 6365 7373 5f6b  _(self, access_k
-00001cd0: 6579 5f69 643d 2727 2c20 7365 6372 6574  ey_id='', secret
-00001ce0: 5f61 6363 6573 735f 6b65 793d 2727 2c20  _access_key='', 
-00001cf0: 6973 5f73 6563 7572 653d 5472 7565 2c20  is_secure=True, 
-00001d00: 7365 7276 6572 3d4e 6f6e 652c 0a20 2020  server=None,.   
-00001d10: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00001d20: 676e 6174 7572 653d 276f 6273 272c 2072  gnature='obs', r
-00001d30: 6567 696f 6e3d 2772 6567 696f 6e27 2c20  egion='region', 
-00001d40: 7061 7468 5f73 7479 6c65 3d46 616c 7365  path_style=False
-00001d50: 2c20 7373 6c5f 7665 7269 6679 3d46 616c  , ssl_verify=Fal
-00001d60: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-00001d70: 2020 2020 2070 6f72 743d 4e6f 6e65 2c20       port=None, 
-00001d80: 6d61 785f 7265 7472 795f 636f 756e 743d  max_retry_count=
-00001d90: 332c 2074 696d 656f 7574 3d36 302c 2063  3, timeout=60, c
-00001da0: 6875 6e6b 5f73 697a 653d 636f 6e73 742e  hunk_size=const.
-00001db0: 5245 4144 5f4f 4e43 455f 4c45 4e47 5448  READ_ONCE_LENGTH
-00001dc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001dd0: 2020 206c 6f6e 675f 636f 6e6e 5f6d 6f64     long_conn_mod
-00001de0: 653d 4661 6c73 652c 2070 726f 7879 5f68  e=False, proxy_h
-00001df0: 6f73 743d 4e6f 6e65 2c20 7072 6f78 795f  ost=None, proxy_
-00001e00: 706f 7274 3d4e 6f6e 652c 0a20 2020 2020  port=None,.     
-00001e10: 2020 2020 2020 2020 2020 2020 7072 6f78              prox
-00001e20: 795f 7573 6572 6e61 6d65 3d4e 6f6e 652c  y_username=None,
-00001e30: 2070 726f 7879 5f70 6173 7377 6f72 643d   proxy_password=
-00001e40: 4e6f 6e65 2c20 7365 6375 7269 7479 5f74  None, security_t
-00001e50: 6f6b 656e 3d4e 6f6e 652c 0a20 2020 2020  oken=None,.     
-00001e60: 2020 2020 2020 2020 2020 2020 6375 7374              cust
-00001e70: 6f6d 5f63 6970 6865 7273 3d4e 6f6e 652c  om_ciphers=None,
-00001e80: 2075 7365 5f68 7474 7032 3d46 616c 7365   use_http2=False
-00001e90: 2c20 6973 5f73 6967 6e61 7475 7265 5f6e  , is_signature_n
-00001ea0: 6567 6f74 6961 7469 6f6e 3d54 7275 652c  egotiation=True,
-00001eb0: 2069 735f 636e 616d 653d 4661 6c73 652c   is_cname=False,
-00001ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001ed0: 2020 6d61 785f 7265 6469 7265 6374 5f63    max_redirect_c
-00001ee0: 6f75 6e74 3d31 302c 2073 6563 7572 6974  ount=10, securit
-00001ef0: 795f 7072 6f76 6964 6572 733d 4e6f 6e65  y_providers=None
-00001f00: 2c20 7365 6375 7269 7479 5f70 726f 7669  , security_provi
-00001f10: 6465 725f 706f 6c69 6379 3d4e 6f6e 652c  der_policy=None,
-00001f20: 2063 6c69 656e 745f 6d6f 6465 3d27 6f62   client_mode='ob
-00001f30: 7327 293a 0a20 2020 2020 2020 2073 656c  s'):.        sel
-00001f40: 662e 7365 6375 7269 7479 5072 6f76 6964  f.securityProvid
-00001f50: 6572 203d 205f 5365 6375 7269 7479 5072  er = _SecurityPr
-00001f60: 6f76 6964 6572 2861 6363 6573 735f 6b65  ovider(access_ke
-00001f70: 795f 6964 2c20 7365 6372 6574 5f61 6363  y_id, secret_acc
-00001f80: 6573 735f 6b65 792c 2073 6563 7572 6974  ess_key, securit
-00001f90: 795f 746f 6b65 6e29 0a20 2020 2020 2020  y_token).       
-00001fa0: 2073 6572 7665 7220 3d20 7365 7276 6572   server = server
-00001fb0: 2069 6620 7365 7276 6572 2069 7320 6e6f   if server is no
-00001fc0: 7420 4e6f 6e65 2065 6c73 6520 2727 0a20  t None else ''. 
-00001fd0: 2020 2020 2020 2073 6572 7665 7220 3d20         server = 
-00001fe0: 7574 696c 2e74 6f5f 7374 7269 6e67 2875  util.to_string(u
-00001ff0: 7469 6c2e 7361 6665 5f65 6e63 6f64 6528  til.safe_encode(
-00002000: 7365 7276 6572 2929 0a0a 2020 2020 2020  server))..      
-00002010: 2020 5f73 6572 7665 7220 3d20 7572 6c70    _server = urlp
-00002020: 6172 7365 2873 6572 7665 7229 0a0a 2020  arse(server)..  
-00002030: 2020 2020 2020 686f 7374 6e61 6d65 203d        hostname =
-00002040: 2073 656c 662e 5f70 6172 7365 5f73 6572   self._parse_ser
-00002050: 7665 725f 686f 7374 6e61 6d65 285f 7365  ver_hostname(_se
-00002060: 7276 6572 290a 2020 2020 2020 2020 6973  rver).        is
-00002070: 5f73 6563 7572 6520 3d20 7365 6c66 2e5f  _secure = self._
-00002080: 6368 6563 6b5f 7365 7276 6572 5f73 6563  check_server_sec
-00002090: 7572 6528 5f73 6572 7665 722c 2069 735f  ure(_server, is_
-000020a0: 7365 6375 7265 290a 2020 2020 2020 2020  secure).        
-000020b0: 686f 7374 5f70 6f72 742c 2070 6f72 7420  host_port, port 
-000020c0: 3d20 7365 6c66 2e5f 7370 6c69 745f 686f  = self._split_ho
-000020d0: 7374 5f70 6f72 7428 686f 7374 6e61 6d65  st_port(hostname
-000020e0: 2c20 706f 7274 290a 2020 2020 2020 2020  , port).        
-000020f0: 7365 6c66 2e73 6563 7572 6974 795f 7072  self.security_pr
-00002100: 6f76 6964 6572 5f70 6f6c 6963 7920 3d20  ovider_policy = 
-00002110: 7365 6375 7269 7479 5f70 726f 7669 6465  security_provide
-00002120: 725f 706f 6c69 6379 0a20 2020 2020 2020  r_policy.       
-00002130: 2073 656c 662e 5f70 6172 7365 5f73 6563   self._parse_sec
-00002140: 7572 6974 795f 7072 6f76 6964 6572 7328  urity_providers(
-00002150: 7365 6375 7269 7479 5f70 726f 7669 6465  security_provide
-00002160: 7273 290a 0a20 2020 2020 2020 2073 656c  rs)..        sel
-00002170: 662e 6973 5f73 6563 7572 6520 3d20 6973  f.is_secure = is
-00002180: 5f73 6563 7572 650a 2020 2020 2020 2020  _secure.        
-00002190: 7365 6c66 2e73 6572 7665 7220 3d20 686f  self.server = ho
-000021a0: 7374 5f70 6f72 745b 305d 0a0a 2020 2020  st_port[0]..    
-000021b0: 2020 2020 7061 7468 5f73 7479 6c65 203d      path_style =
-000021c0: 2073 656c 662e 5f63 6865 636b 5f70 6174   self._check_pat
-000021d0: 685f 7374 796c 6528 7061 7468 5f73 7479  h_style(path_sty
-000021e0: 6c65 290a 2020 2020 2020 2020 7365 6c66  le).        self
-000021f0: 2e73 6967 6e61 7475 7265 203d 2075 7469  .signature = uti
-00002200: 6c2e 746f 5f73 7472 696e 6728 7574 696c  l.to_string(util
-00002210: 2e73 6166 655f 656e 636f 6465 2873 6967  .safe_encode(sig
-00002220: 6e61 7475 7265 2929 0a20 2020 2020 2020  nature)).       
-00002230: 2073 656c 662e 7265 6769 6f6e 203d 2072   self.region = r
-00002240: 6567 696f 6e0a 2020 2020 2020 2020 7365  egion.        se
-00002250: 6c66 2e70 6174 685f 7374 796c 6520 3d20  lf.path_style = 
-00002260: 7061 7468 5f73 7479 6c65 0a20 2020 2020  path_style.     
-00002270: 2020 2073 656c 662e 7373 6c5f 7665 7269     self.ssl_veri
-00002280: 6679 203d 2073 736c 5f76 6572 6966 790a  fy = ssl_verify.
-00002290: 2020 2020 2020 2020 7365 6c66 2e63 616c          self.cal
-000022a0: 6c69 6e67 5f66 6f72 6d61 7420 3d20 7365  ling_format = se
-000022b0: 6c66 2e5f 7061 7273 655f 6361 6c6c 696e  lf._parse_callin
-000022c0: 675f 666f 726d 6174 2829 0a20 2020 2020  g_format().     
-000022d0: 2020 2073 656c 662e 706f 7274 203d 2073     self.port = s
-000022e0: 656c 662e 5f70 6172 7365 5f70 6f72 7428  elf._parse_port(
-000022f0: 706f 7274 2c20 6973 5f73 6563 7572 6529  port, is_secure)
-00002300: 0a0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
-00002310: 6178 5f72 6574 7279 5f63 6f75 6e74 203d  ax_retry_count =
-00002320: 206d 6178 5f72 6574 7279 5f63 6f75 6e74   max_retry_count
-00002330: 0a20 2020 2020 2020 2073 656c 662e 7469  .        self.ti
-00002340: 6d65 6f75 7420 3d20 7469 6d65 6f75 740a  meout = timeout.
-00002350: 2020 2020 2020 2020 7365 6c66 2e63 6875          self.chu
-00002360: 6e6b 5f73 697a 6520 3d20 6368 756e 6b5f  nk_size = chunk_
-00002370: 7369 7a65 0a20 2020 2020 2020 2073 656c  size.        sel
-00002380: 662e 6c6f 675f 636c 6965 6e74 203d 204e  f.log_client = N
-00002390: 6f6e 654c 6f67 436c 6965 6e74 2829 0a20  oneLogClient(). 
-000023a0: 2020 2020 2020 2073 656c 662e 7573 655f         self.use_
-000023b0: 6874 7470 3220 3d20 7573 655f 6874 7470  http2 = use_http
-000023c0: 320a 2020 2020 2020 2020 7365 6c66 2e69  2.        self.i
-000023d0: 735f 7369 676e 6174 7572 655f 6e65 676f  s_signature_nego
-000023e0: 7469 6174 696f 6e20 3d20 6973 5f73 6967  tiation = is_sig
-000023f0: 6e61 7475 7265 5f6e 6567 6f74 6961 7469  nature_negotiati
-00002400: 6f6e 0a20 2020 2020 2020 2073 656c 662e  on.        self.
-00002410: 6973 5f63 6e61 6d65 203d 2069 735f 636e  is_cname = is_cn
-00002420: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
-00002430: 2e6d 6178 5f72 6564 6972 6563 745f 636f  .max_redirect_co
-00002440: 756e 7420 3d20 6d61 785f 7265 6469 7265  unt = max_redire
-00002450: 6374 5f63 6f75 6e74 0a0a 2020 2020 2020  ct_count..      
-00002460: 2020 6966 2063 6c69 656e 745f 6d6f 6465    if client_mode
-00002470: 203d 3d20 276f 6273 273a 0a20 2020 2020   == 'obs':.     
-00002480: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
-00002490: 6174 685f 7374 796c 6520 6f72 2073 656c  ath_style or sel
-000024a0: 662e 6973 5f63 6e61 6d65 3a0a 2020 2020  f.is_cname:.    
-000024b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000024c0: 2e69 735f 7369 676e 6174 7572 655f 6e65  .is_signature_ne
-000024d0: 676f 7469 6174 696f 6e20 3d20 4661 6c73  gotiation = Fals
-000024e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000024f0: 2020 6966 2073 656c 662e 7369 676e 6174    if self.signat
-00002500: 7572 6520 3d3d 2027 6f62 7327 3a0a 2020  ure == 'obs':.  
-00002510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002520: 2020 7365 6c66 2e73 6967 6e61 7475 7265    self.signature
-00002530: 203d 2027 7632 270a 2020 2020 2020 2020   = 'v2'.        
-00002540: 656c 6966 2063 6c69 656e 745f 6d6f 6465  elif client_mode
-00002550: 203d 3d20 2777 6f72 6b66 6c6f 7727 3a0a   == 'workflow':.
-00002560: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002570: 2e69 735f 7369 676e 6174 7572 655f 6e65  .is_signature_ne
-00002580: 676f 7469 6174 696f 6e20 3d20 4661 6c73  gotiation = Fals
-00002590: 650a 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-000025a0: 636f 6e74 6578 7420 3d20 4e6f 6e65 0a20  context = None. 
-000025b0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-000025c0: 735f 7365 6375 7265 3a0a 2020 2020 2020  s_secure:.      
-000025d0: 2020 2020 2020 6966 2073 656c 662e 7573        if self.us
-000025e0: 655f 6874 7470 323a 0a20 2020 2020 2020  e_http2:.       
-000025f0: 2020 2020 2020 2020 2066 726f 6d20 6f62           from ob
-00002600: 7320 696d 706f 7274 2068 7474 7032 0a20  s import http2. 
-00002610: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002620: 656c 662e 636f 6e74 6578 7420 3d20 6874  elf.context = ht
-00002630: 7470 322e 5f67 6574 5f73 736c 5f63 6f6e  tp2._get_ssl_con
-00002640: 7465 7874 2873 656c 662e 7373 6c5f 7665  text(self.ssl_ve
-00002650: 7269 6679 290a 2020 2020 2020 2020 2020  rify).          
-00002660: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00002670: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
-00002680: 6974 5f73 736c 5f63 6f6e 7465 7874 2863  it_ssl_context(c
-00002690: 7573 746f 6d5f 6369 7068 6572 7329 0a0a  ustom_ciphers)..
-000026a0: 2020 2020 2020 2020 7365 6c66 2e6c 6f6e          self.lon
-000026b0: 675f 636f 6e6e 5f6d 6f64 6520 3d20 6c6f  g_conn_mode = lo
-000026c0: 6e67 5f63 6f6e 6e5f 6d6f 6465 0a0a 2020  ng_conn_mode..  
-000026d0: 2020 2020 2020 7365 6c66 2e63 6f6e 6e48        self.connH
-000026e0: 6f6c 6465 7220 3d20 4e6f 6e65 0a20 2020  older = None.   
-000026f0: 2020 2020 2069 6620 7365 6c66 2e6c 6f6e       if self.lon
-00002700: 675f 636f 6e6e 5f6d 6f64 653a 0a20 2020  g_conn_mode:.   
-00002710: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
-00002720: 6e69 745f 636f 6e6e 486f 6c64 6572 2829  nit_connHolder()
-00002730: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00002740: 726f 7879 5f68 6f73 7420 3d20 7072 6f78  roxy_host = prox
-00002750: 795f 686f 7374 0a20 2020 2020 2020 2073  y_host.        s
-00002760: 656c 662e 7072 6f78 795f 706f 7274 203d  elf.proxy_port =
-00002770: 2070 726f 7879 5f70 6f72 740a 2020 2020   proxy_port.    
-00002780: 2020 2020 7365 6c66 2e70 726f 7879 5f75      self.proxy_u
-00002790: 7365 726e 616d 6520 3d20 7072 6f78 795f  sername = proxy_
-000027a0: 7573 6572 6e61 6d65 0a20 2020 2020 2020  username.       
-000027b0: 2073 656c 662e 7072 6f78 795f 7061 7373   self.proxy_pass
-000027c0: 776f 7264 203d 2070 726f 7879 5f70 6173  word = proxy_pas
-000027d0: 7377 6f72 640a 2020 2020 2020 2020 7365  sword.        se
-000027e0: 6c66 2e70 6174 7465 726e 203d 2072 652e  lf.pattern = re.
-000027f0: 636f 6d70 696c 6528 2778 6d6c 6e73 3d22  compile('xmlns="
-00002800: 6874 7470 2e2a 3f22 2729 0a20 2020 2020  http.*?"').     
-00002810: 2020 2073 656c 662e 7468 7265 6164 5f6c     self.thread_l
-00002820: 6f63 616c 203d 2074 6872 6561 6469 6e67  ocal = threading
-00002830: 2e6c 6f63 616c 2829 0a20 2020 2020 2020  .local().       
-00002840: 2073 656c 662e 7468 7265 6164 5f6c 6f63   self.thread_loc
-00002850: 616c 2e73 6967 6e61 7475 7265 203d 2073  al.signature = s
-00002860: 656c 662e 7369 676e 6174 7572 650a 2020  elf.signature.  
-00002870: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
-00002880: 5f73 6967 6e61 7475 7265 5f6e 6567 6f74  _signature_negot
-00002890: 6961 7469 6f6e 3a0a 2020 2020 2020 2020  iation:.        
-000028a0: 2020 2020 7365 6c66 2e63 6163 6865 203d      self.cache =
-000028b0: 204c 6f63 616c 4361 6368 6528 6d61 786c   LocalCache(maxl
-000028c0: 656e 3d31 3030 290a 2020 2020 2020 2020  en=100).        
-000028d0: 2020 2020 7365 6c66 2e68 6120 3d20 4861      self.ha = Ha
-000028e0: 5772 6170 7065 7228 7365 6c66 2e74 6872  Wrapper(self.thr
-000028f0: 6561 645f 6c6f 6361 6c2c 2073 656c 662e  ead_local, self.
-00002900: 7369 676e 6174 7572 6529 0a20 2020 2020  signature).     
-00002910: 2020 2020 2020 2073 656c 662e 636f 6e76         self.conv
-00002920: 6572 746f 7220 3d20 436f 6e76 6572 7457  ertor = ConvertW
-00002930: 7261 7070 6572 2873 656c 662e 7468 7265  rapper(self.thre
-00002940: 6164 5f6c 6f63 616c 2c20 7365 6c66 2e73  ad_local, self.s
-00002950: 6967 6e61 7475 7265 290a 2020 2020 2020  ignature).      
-00002960: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00002970: 2020 2020 7365 6c66 2e68 6120 3d20 636f      self.ha = co
-00002980: 6e76 6572 746f 722e 4164 6170 7465 7228  nvertor.Adapter(
-00002990: 7365 6c66 2e73 6967 6e61 7475 7265 290a  self.signature).
-000029a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000029b0: 2e63 6f6e 7665 7274 6f72 203d 2063 6f6e  .convertor = con
-000029c0: 7665 7274 6f72 2e43 6f6e 7665 7274 6f72  vertor.Convertor
-000029d0: 2873 656c 662e 7369 676e 6174 7572 652c  (self.signature,
-000029e0: 2073 656c 662e 6861 290a 2020 2020 2020   self.ha).      
-000029f0: 2020 7365 6c66 2e6a 736f 6e5f 7265 7370    self.json_resp
-00002a00: 6f6e 7365 5f6d 6574 686f 645f 6e61 6d65  onse_method_name
-00002a10: 203d 2027 4765 744a 736f 6e52 6573 706f   = 'GetJsonRespo
-00002a20: 6e73 6527 0a0a 2020 2020 4073 7461 7469  nse'..    @stati
-00002a30: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-00002a40: 5f70 6172 7365 5f73 6572 7665 725f 686f  _parse_server_ho
-00002a50: 7374 6e61 6d65 2873 6572 7665 7229 3a0a  stname(server):.
-00002a60: 2020 2020 2020 2020 686f 7374 6e61 6d65          hostname
-00002a70: 203d 2073 6572 7665 722e 6e65 746c 6f63   = server.netloc
-00002a80: 2069 6620 7574 696c 2e69 735f 7661 6c69   if util.is_vali
-00002a90: 6428 7365 7276 6572 2e6e 6574 6c6f 6329  d(server.netloc)
-00002aa0: 2065 6c73 6520 7365 7276 6572 2e70 6174   else server.pat
-00002ab0: 680a 2020 2020 2020 2020 6966 206e 6f74  h.        if not
-00002ac0: 2075 7469 6c2e 6973 5f76 616c 6964 2868   util.is_valid(h
-00002ad0: 6f73 746e 616d 6529 3a0a 2020 2020 2020  ostname):.      
-00002ae0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-00002af0: 7074 696f 6e28 2773 6572 7665 7220 6973  ption('server is
-00002b00: 206e 6f74 2073 6574 2063 6f72 7265 6374   not set correct
-00002b10: 6c79 2729 0a20 2020 2020 2020 2072 6574  ly').        ret
-00002b20: 7572 6e20 686f 7374 6e61 6d65 0a0a 2020  urn hostname..  
-00002b30: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-00002b40: 2020 2020 6465 6620 5f63 6865 636b 5f73      def _check_s
-00002b50: 6572 7665 725f 7365 6375 7265 2873 6572  erver_secure(ser
-00002b60: 7665 722c 2069 735f 7365 6375 7265 293a  ver, is_secure):
-00002b70: 0a20 2020 2020 2020 2069 6620 7574 696c  .        if util
-00002b80: 2e69 735f 7661 6c69 6428 7365 7276 6572  .is_valid(server
-00002b90: 2e73 6368 656d 6529 3a0a 2020 2020 2020  .scheme):.      
-00002ba0: 2020 2020 2020 6966 2073 6572 7665 722e        if server.
-00002bb0: 7363 6865 6d65 203d 3d20 2768 7474 7073  scheme == 'https
-00002bc0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00002bd0: 2020 2069 735f 7365 6375 7265 203d 2054     is_secure = T
-00002be0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00002bf0: 656c 6966 2073 6572 7665 722e 7363 6865  elif server.sche
-00002c00: 6d65 203d 3d20 2768 7474 7027 3a0a 2020  me == 'http':.  
-00002c10: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00002c20: 5f73 6563 7572 6520 3d20 4661 6c73 650a  _secure = False.
-00002c30: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00002c40: 735f 7365 6375 7265 0a0a 2020 2020 6465  s_secure..    de
-00002c50: 6620 5f70 6172 7365 5f73 6563 7572 6974  f _parse_securit
-00002c60: 795f 7072 6f76 6964 6572 7328 7365 6c66  y_providers(self
-00002c70: 2c20 7365 6375 7269 7479 5f70 726f 7669  , security_provi
-00002c80: 6465 7273 293a 0a20 2020 2020 2020 2069  ders):.        i
-00002c90: 6620 7365 6375 7269 7479 5f70 726f 7669  f security_provi
-00002ca0: 6465 7273 2069 7320 4e6f 6e65 3a0a 2020  ders is None:.  
-00002cb0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00002cc0: 6563 7572 6974 795f 7072 6f76 6964 6572  ecurity_provider
-00002cd0: 7320 3d20 5b6c 6f61 6474 6f6b 656e 2e45  s = [loadtoken.E
-00002ce0: 4e56 2c20 6c6f 6164 746f 6b65 6e2e 4543  NV, loadtoken.EC
-00002cf0: 535d 0a20 2020 2020 2020 2065 6c73 653a  S].        else:
-00002d00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00002d10: 662e 7365 6375 7269 7479 5f70 726f 7669  f.security_provi
-00002d20: 6465 7273 203d 2073 6563 7572 6974 795f  ders = security_
-00002d30: 7072 6f76 6964 6572 730a 2020 2020 2020  providers.      
-00002d40: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00002d50: 2020 2069 6620 7365 6375 7269 7479 5f70     if security_p
-00002d60: 726f 7669 6465 7273 203d 3d20 5b5d 3a0a  roviders == []:.
-00002d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d80: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00002d90: 2827 6e6f 2061 7661 696c 6162 6c65 2073  ('no available s
-00002da0: 6563 7572 6974 795f 7072 6f76 6964 6572  ecurity_provider
-00002db0: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-00002dc0: 666f 7220 6d65 7468 6f64 2069 6e20 7365  for method in se
-00002dd0: 6c66 2e73 6563 7572 6974 795f 7072 6f76  lf.security_prov
-00002de0: 6964 6572 733a 0a20 2020 2020 2020 2020  iders:.         
-00002df0: 2020 2020 2020 2067 6574 6174 7472 286d         getattr(m
-00002e00: 6574 686f 642c 2027 5f5f 6e61 6d65 5f5f  ethod, '__name__
-00002e10: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00002e20: 2020 2069 6620 6e6f 7420 6973 6675 6e63     if not isfunc
-00002e30: 7469 6f6e 286d 6574 686f 642e 7365 6172  tion(method.sear
-00002e40: 6368 293a 0a20 2020 2020 2020 2020 2020  ch):.           
-00002e50: 2020 2020 2020 2020 2072 6169 7365 2041           raise A
-00002e60: 7474 7269 6275 7465 4572 726f 7228 6d65  ttributeError(me
-00002e70: 7468 6f64 202b 2027 6861 7320 6e6f 2066  thod + 'has no f
-00002e80: 756e 6374 696f 6e20 6361 6c6c 6564 2073  unction called s
-00002e90: 6561 7263 6827 290a 2020 2020 2020 2020  earch').        
-00002ea0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00002eb0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00002ec0: 6c66 2e73 6563 7572 6974 795f 7072 6f76  lf.security_prov
-00002ed0: 6964 6572 5f70 6f6c 6963 7920 3d20 4e6f  ider_policy = No
-00002ee0: 6e65 0a20 2020 2020 2020 2020 2020 2070  ne.            p
-00002ef0: 7269 6e74 2874 7261 6365 6261 636b 2e66  rint(traceback.f
-00002f00: 6f72 6d61 745f 6578 6328 2929 0a0a 2020  ormat_exc())..  
-00002f10: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-00002f20: 2020 2020 6465 6620 5f73 706c 6974 5f68      def _split_h
-00002f30: 6f73 745f 706f 7274 2868 6f73 746e 616d  ost_port(hostnam
-00002f40: 652c 2070 6f72 7429 3a0a 2020 2020 2020  e, port):.      
-00002f50: 2020 686f 7374 5f70 6f72 7420 3d20 686f    host_port = ho
-00002f60: 7374 6e61 6d65 2e73 706c 6974 2827 3a27  stname.split(':'
-00002f70: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-00002f80: 2868 6f73 745f 706f 7274 2920 3d3d 2032  (host_port) == 2
-00002f90: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
-00002fa0: 7274 203d 2075 7469 6c2e 746f 5f69 6e74  rt = util.to_int
-00002fb0: 2868 6f73 745f 706f 7274 5b31 5d29 0a20  (host_port[1]). 
-00002fc0: 2020 2020 2020 2072 6574 7572 6e20 686f         return ho
-00002fd0: 7374 5f70 6f72 742c 2070 6f72 740a 0a20  st_port, port.. 
-00002fe0: 2020 2064 6566 205f 6368 6563 6b5f 7061     def _check_pa
-00002ff0: 7468 5f73 7479 6c65 2873 656c 662c 2070  th_style(self, p
-00003000: 6174 685f 7374 796c 6529 3a0a 2020 2020  ath_style):.    
-00003010: 2020 2020 7265 7475 726e 2054 7275 6520      return True 
-00003020: 6966 2075 7469 6c2e 6973 5f69 7061 6464  if util.is_ipadd
-00003030: 7265 7373 2873 656c 662e 7365 7276 6572  ress(self.server
-00003040: 2920 656c 7365 2070 6174 685f 7374 796c  ) else path_styl
-00003050: 650a 0a20 2020 2040 7374 6174 6963 6d65  e..    @staticme
-00003060: 7468 6f64 0a20 2020 2064 6566 205f 7061  thod.    def _pa
-00003070: 7273 655f 706f 7274 2870 6f72 742c 2069  rse_port(port, i
-00003080: 735f 7365 6375 7265 293a 0a20 2020 2020  s_secure):.     
-00003090: 2020 2069 6620 706f 7274 2069 7320 4e6f     if port is No
-000030a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000030b0: 6966 2069 735f 7365 6375 7265 3a0a 2020  if is_secure:.  
-000030c0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-000030d0: 7274 203d 2063 6f6e 7374 2e44 4546 4155  rt = const.DEFAU
-000030e0: 4c54 5f53 4543 5552 455f 504f 5254 0a20  LT_SECURE_PORT. 
-000030f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00003100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003110: 2070 6f72 7420 3d20 636f 6e73 742e 4445   port = const.DE
-00003120: 4641 554c 545f 494e 5345 4355 5245 5f50  FAULT_INSECURE_P
-00003130: 4f52 540a 2020 2020 2020 2020 7265 7475  ORT.        retu
-00003140: 726e 2070 6f72 740a 0a20 2020 2064 6566  rn port..    def
-00003150: 205f 7061 7273 655f 6361 6c6c 696e 675f   _parse_calling_
-00003160: 666f 726d 6174 2873 656c 6629 3a0a 2020  format(self):.  
-00003170: 2020 2020 2020 6966 2073 656c 662e 7061        if self.pa
-00003180: 7468 5f73 7479 6c65 3a0a 2020 2020 2020  th_style:.      
-00003190: 2020 2020 2020 7265 7475 726e 2075 7469        return uti
-000031a0: 6c2e 5265 7175 6573 7446 6f72 6d61 742e  l.RequestFormat.
-000031b0: 6765 745f 7061 7468 5f66 6f72 6d61 7428  get_path_format(
-000031c0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-000031d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000031e0: 726e 2075 7469 6c2e 5265 7175 6573 7446  rn util.RequestF
-000031f0: 6f72 6d61 742e 6765 745f 7375 625f 646f  ormat.get_sub_do
-00003200: 6d61 696e 5f66 6f72 6d61 7428 290a 0a20  main_format().. 
-00003210: 2020 2064 6566 205f 6765 745f 746f 6b65     def _get_toke
-00003220: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
-00003230: 2066 726f 6d20 6f62 732e 7365 6172 6368   from obs.search
-00003240: 6d65 7468 6f64 2069 6d70 6f72 7420 6765  method import ge
-00003250: 745f 746f 6b65 6e0a 2020 2020 2020 2020  t_token.        
-00003260: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00003270: 2069 6620 7365 6c66 2e73 6563 7572 6974   if self.securit
-00003280: 795f 7072 6f76 6964 6572 5f70 6f6c 6963  y_provider_polic
-00003290: 7920 6973 206e 6f74 204e 6f6e 653a 0a20  y is not None:. 
-000032a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000032b0: 6620 7365 6c66 2e73 6563 7572 6974 7950  f self.securityP
-000032c0: 726f 7669 6465 722e 6163 6365 7373 5f6b  rovider.access_k
-000032d0: 6579 5f69 6420 213d 2027 2720 616e 6420  ey_id != '' and 
-000032e0: 7365 6c66 2e73 6563 7572 6974 7950 726f  self.securityPro
-000032f0: 7669 6465 722e 7365 6372 6574 5f61 6363  vider.secret_acc
-00003300: 6573 735f 6b65 7920 213d 2027 273a 0a20  ess_key != '':. 
-00003310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003320: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
-00003330: 6563 7572 6974 7950 726f 7669 6465 720a  ecurityProvider.
-00003340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003350: 2076 616c 7565 5f64 6963 7420 3d20 6765   value_dict = ge
-00003360: 745f 746f 6b65 6e28 7365 6c66 2e73 6563  t_token(self.sec
-00003370: 7572 6974 795f 7072 6f76 6964 6572 732c  urity_providers,
-00003380: 206e 616d 653d 7365 6c66 2e73 6563 7572   name=self.secur
-00003390: 6974 795f 7072 6f76 6964 6572 5f70 6f6c  ity_provider_pol
-000033a0: 6963 7929 0a20 2020 2020 2020 2020 2020  icy).           
-000033b0: 2020 2020 2073 6563 7572 6974 7950 726f       securityPro
-000033c0: 7669 6465 7220 3d20 5f53 6563 7572 6974  vider = _Securit
-000033d0: 7950 726f 7669 6465 7228 7661 6c75 655f  yProvider(value_
-000033e0: 6469 6374 2e67 6574 2827 6163 6365 7373  dict.get('access
-000033f0: 4b65 7927 292c 2076 616c 7565 5f64 6963  Key'), value_dic
-00003400: 742e 6765 7428 2773 6563 7265 744b 6579  t.get('secretKey
-00003410: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-00003420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003440: 2020 2020 2020 2020 2076 616c 7565 5f64           value_d
-00003450: 6963 742e 6765 7428 2773 6563 7572 6974  ict.get('securit
-00003460: 7954 6f6b 656e 2729 290a 2020 2020 2020  yToken')).      
-00003470: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00003480: 2073 6563 7572 6974 7950 726f 7669 6465   securityProvide
-00003490: 720a 2020 2020 2020 2020 6578 6365 7074  r.        except
-000034a0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-000034b0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-000034c0: 5f63 6c69 656e 742e 6c6f 6728 5741 524e  _client.log(WARN
-000034d0: 494e 472c 2074 7261 6365 6261 636b 2e66  ING, traceback.f
-000034e0: 6f72 6d61 745f 6578 6328 2929 0a20 2020  ormat_exc()).   
-000034f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00003500: 2e73 6563 7572 6974 7950 726f 7669 6465  .securityProvide
-00003510: 720a 0a20 2020 2064 6566 205f 696e 6974  r..    def _init
-00003520: 5f63 6f6e 6e48 6f6c 6465 7228 7365 6c66  _connHolder(self
-00003530: 293a 0a20 2020 2020 2020 2069 6620 636f  ):.        if co
-00003540: 6e73 742e 4953 5f50 5954 484f 4e32 3a0a  nst.IS_PYTHON2:.
-00003550: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-00003560: 2051 7565 7565 2069 6d70 6f72 7420 5175   Queue import Qu
-00003570: 6575 650a 2020 2020 2020 2020 656c 7365  eue.        else
-00003580: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
-00003590: 6f6d 2071 7565 7565 2069 6d70 6f72 7420  om queue import 
-000035a0: 5175 6575 650a 2020 2020 2020 2020 7365  Queue.        se
-000035b0: 6c66 2e63 6f6e 6e48 6f6c 6465 7220 3d20  lf.connHolder = 
-000035c0: 7b27 636f 6e6e 5365 7427 3a20 5175 6575  {'connSet': Queu
-000035d0: 6528 292c 2027 6c6f 636b 273a 2074 6872  e(), 'lock': thr
-000035e0: 6561 6469 6e67 2e4c 6f63 6b28 297d 0a0a  eading.Lock()}..
-000035f0: 2020 2020 6465 6620 5f69 6e69 745f 7373      def _init_ss
-00003600: 6c5f 636f 6e74 6578 7428 7365 6c66 2c20  l_context(self, 
-00003610: 6375 7374 6f6d 5f63 6970 6865 7273 293a  custom_ciphers):
-00003620: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00003630: 2020 2020 2020 2020 2020 696d 706f 7274            import
-00003640: 2073 736c 0a20 2020 2020 2020 2020 2020   ssl.           
-00003650: 2069 6620 6861 7361 7474 7228 7373 6c2c   if hasattr(ssl,
-00003660: 2027 5353 4c43 6f6e 7465 7874 2729 3a0a   'SSLContext'):.
-00003670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003680: 636f 6e74 6578 7420 3d20 7373 6c2e 5353  context = ssl.SS
-00003690: 4c43 6f6e 7465 7874 2873 736c 2e50 524f  LContext(ssl.PRO
-000036a0: 544f 434f 4c5f 5353 4c76 3233 290a 2020  TOCOL_SSLv23).  
-000036b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000036c0: 6e74 6578 742e 6f70 7469 6f6e 7320 7c3d  ntext.options |=
-000036d0: 2073 736c 2e4f 505f 4e4f 5f53 534c 7632   ssl.OP_NO_SSLv2
-000036e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000036f0: 2063 6f6e 7465 7874 2e6f 7074 696f 6e73   context.options
-00003700: 207c 3d20 7373 6c2e 4f50 5f4e 4f5f 5353   |= ssl.OP_NO_SS
-00003710: 4c76 330a 2020 2020 2020 2020 2020 2020  Lv3.            
-00003720: 2020 2020 6966 2063 7573 746f 6d5f 6369      if custom_ci
-00003730: 7068 6572 7320 6973 206e 6f74 204e 6f6e  phers is not Non
-00003740: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00003750: 2020 2020 2020 2063 7573 746f 6d5f 6369         custom_ci
-00003760: 7068 6572 7320 3d20 7574 696c 2e74 6f5f  phers = util.to_
-00003770: 7374 7269 6e67 2863 7573 746f 6d5f 6369  string(custom_ci
-00003780: 7068 6572 7329 2e73 7472 6970 2829 0a20  phers).strip(). 
-00003790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037a0: 2020 2069 6620 6375 7374 6f6d 5f63 6970     if custom_cip
-000037b0: 6865 7273 2021 3d20 2727 2061 6e64 2068  hers != '' and h
-000037c0: 6173 6174 7472 2863 6f6e 7465 7874 2c20  asattr(context, 
-000037d0: 2773 6574 5f63 6970 6865 7273 2729 2061  'set_ciphers') a
-000037e0: 6e64 2063 616c 6c61 626c 6528 636f 6e74  nd callable(cont
-000037f0: 6578 742e 7365 745f 6369 7068 6572 7329  ext.set_ciphers)
-00003800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003810: 2020 2020 2020 2020 2020 636f 6e74 6578            contex
-00003820: 742e 7365 745f 6369 7068 6572 7328 6375  t.set_ciphers(cu
-00003830: 7374 6f6d 5f63 6970 6865 7273 290a 2020  stom_ciphers).  
-00003840: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003850: 2073 656c 662e 7373 6c5f 7665 7269 6679   self.ssl_verify
-00003860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003870: 2020 2020 2020 696d 706f 7274 205f 7373        import _ss
-00003880: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-00003890: 2020 2020 2020 6361 6669 6c65 203d 2075        cafile = u
-000038a0: 7469 6c2e 746f 5f73 7472 696e 6728 7365  til.to_string(se
-000038b0: 6c66 2e73 736c 5f76 6572 6966 7929 0a20  lf.ssl_verify). 
-000038c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000038d0: 2020 2063 6f6e 7465 7874 2e6f 7074 696f     context.optio
-000038e0: 6e73 207c 3d20 6765 7461 7474 7228 5f73  ns |= getattr(_s
-000038f0: 736c 2c20 224f 505f 4e4f 5f43 4f4d 5052  sl, "OP_NO_COMPR
-00003900: 4553 5349 4f4e 222c 2030 290a 2020 2020  ESSION", 0).    
-00003910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003920: 636f 6e74 6578 742e 7665 7269 6679 5f6d  context.verify_m
-00003930: 6f64 6520 3d20 7373 6c2e 4345 5254 5f52  ode = ssl.CERT_R
-00003940: 4551 5549 5245 440a 2020 2020 2020 2020  EQUIRED.        
-00003950: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00003960: 732e 7061 7468 2e69 7366 696c 6528 6361  s.path.isfile(ca
-00003970: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-00003980: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00003990: 6f6e 7465 7874 2e6c 6f61 645f 7665 7269  ontext.load_veri
-000039a0: 6679 5f6c 6f63 6174 696f 6e73 2863 6166  fy_locations(caf
-000039b0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-000039c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000039d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000039e0: 6f6e 7465 7874 2e76 6572 6966 795f 6d6f  ontext.verify_mo
-000039f0: 6465 203d 2073 736c 2e43 4552 545f 4e4f  de = ssl.CERT_NO
-00003a00: 4e45 0a20 2020 2020 2020 2020 2020 2020  NE.             
-00003a10: 2020 2069 6620 6861 7361 7474 7228 636f     if hasattr(co
-00003a20: 6e74 6578 742c 2027 6368 6563 6b5f 686f  ntext, 'check_ho
-00003a30: 7374 6e61 6d65 2729 3a0a 2020 2020 2020  stname'):.      
-00003a40: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00003a50: 6e74 6578 742e 6368 6563 6b5f 686f 7374  ntext.check_host
-00003a60: 6e61 6d65 203d 2046 616c 7365 0a20 2020  name = False.   
-00003a70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00003a80: 662e 636f 6e74 6578 7420 3d20 636f 6e74  f.context = cont
-00003a90: 6578 740a 2020 2020 2020 2020 6578 6365  ext.        exce
-00003aa0: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00003ab0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00003ac0: 7472 6163 6562 6163 6b2e 666f 726d 6174  traceback.format
-00003ad0: 5f65 7863 2829 290a 0a20 2020 2064 6566  _exc())..    def
-00003ae0: 2063 6c6f 7365 2873 656c 6629 3a0a 2020   close(self):.  
-00003af0: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
-00003b00: 6e6e 486f 6c64 6572 2069 7320 6e6f 7420  nnHolder is not 
-00003b10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00003b20: 2020 7769 7468 2073 656c 662e 636f 6e6e    with self.conn
-00003b30: 486f 6c64 6572 5b27 6c6f 636b 275d 3a0a  Holder['lock']:.
-00003b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003b50: 7768 696c 6520 6e6f 7420 7365 6c66 2e63  while not self.c
-00003b60: 6f6e 6e48 6f6c 6465 725b 2763 6f6e 6e53  onnHolder['connS
-00003b70: 6574 275d 2e65 6d70 7479 2829 3a0a 2020  et'].empty():.  
-00003b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003b90: 2020 636f 6e6e 203d 2073 656c 662e 636f    conn = self.co
-00003ba0: 6e6e 486f 6c64 6572 5b27 636f 6e6e 5365  nnHolder['connSe
-00003bb0: 7427 5d2e 6765 7428 290a 2020 2020 2020  t'].get().      
-00003bc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003bd0: 2063 6f6e 6e20 616e 6420 6861 7361 7474   conn and hasatt
-00003be0: 7228 636f 6e6e 2c20 2763 6c6f 7365 2729  r(conn, 'close')
-00003bf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003c00: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00003c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c20: 2020 2020 2020 2020 2020 2063 6f6e 6e2e             conn.
-00003c30: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-00003c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c50: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00003c60: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
-00003c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c80: 2020 2020 7365 6c66 2e6c 6f67 5f63 6c69      self.log_cli
-00003c90: 656e 742e 6c6f 6728 5741 524e 494e 472c  ent.log(WARNING,
-00003ca0: 2065 7829 0a20 2020 2020 2020 2073 656c   ex).        sel
-00003cb0: 662e 636f 6e6e 486f 6c64 6572 203d 204e  f.connHolder = N
-00003cc0: 6f6e 650a 2020 2020 2020 2020 6966 2073  one.        if s
-00003cd0: 656c 662e 6c6f 675f 636c 6965 6e74 3a0a  elf.log_client:.
-00003ce0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00003cf0: 2e6c 6f67 5f63 6c69 656e 742e 636c 6f73  .log_client.clos
-00003d00: 6528 290a 0a20 2020 2064 6566 2072 6566  e()..    def ref
-00003d10: 7265 7368 2873 656c 662c 2061 6363 6573  resh(self, acces
-00003d20: 735f 6b65 795f 6964 2c20 7365 6372 6574  s_key_id, secret
-00003d30: 5f61 6363 6573 735f 6b65 792c 2073 6563  _access_key, sec
-00003d40: 7572 6974 795f 746f 6b65 6e3d 4e6f 6e65  urity_token=None
-00003d50: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00003d60: 7365 6375 7269 7479 5072 6f76 6964 6572  securityProvider
-00003d70: 203d 205f 5365 6375 7269 7479 5072 6f76   = _SecurityProv
-00003d80: 6964 6572 2861 6363 6573 735f 6b65 795f  ider(access_key_
-00003d90: 6964 2c20 7365 6372 6574 5f61 6363 6573  id, secret_acces
-00003da0: 735f 6b65 792c 2073 6563 7572 6974 795f  s_key, security_
-00003db0: 746f 6b65 6e29 0a0a 2020 2020 6465 6620  token)..    def 
-00003dc0: 696e 6974 4c6f 6728 7365 6c66 2c20 6c6f  initLog(self, lo
-00003dd0: 675f 636f 6e66 6967 3d4e 6f6e 652c 206c  g_config=None, l
-00003de0: 6f67 5f6e 616d 653d 274f 4253 5f4c 4f47  og_name='OBS_LOG
-00003df0: 4745 5227 293a 0a20 2020 2020 2020 2069  GER'):.        i
-00003e00: 6620 6c6f 675f 636f 6e66 6967 3a0a 2020  f log_config:.  
-00003e10: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00003e20: 6f67 5f63 6c69 656e 7420 3d20 4c6f 6743  og_client = LogC
-00003e30: 6c69 656e 7428 6c6f 675f 636f 6e66 6967  lient(log_config
-00003e40: 2c20 274f 4253 5f4c 4f47 4745 5227 2069  , 'OBS_LOGGER' i
-00003e50: 6620 636f 6e73 742e 4953 5f57 494e 444f  f const.IS_WINDO
-00003e60: 5753 2065 6c73 6520 6c6f 675f 6e61 6d65  WS else log_name
-00003e70: 2c20 6c6f 675f 6e61 6d65 290a 2020 2020  , log_name).    
-00003e80: 2020 2020 2020 2020 6d73 6720 3d20 5b27          msg = ['
-00003e90: 5b4f 4253 2053 444b 2056 6572 7369 6f6e  [OBS SDK Version
-00003ea0: 3d27 202b 2063 6f6e 7374 2e4f 4253 5f53  =' + const.OBS_S
-00003eb0: 444b 5f56 4552 5349 4f4e 5d0a 2020 2020  DK_VERSION].    
-00003ec0: 2020 2020 2020 2020 6d73 672e 6170 7065          msg.appe
-00003ed0: 6e64 2827 456e 6470 6f69 6e74 3d27 202b  nd('Endpoint=' +
-00003ee0: 2028 2725 733a 2f2f 2573 3a25 6427 2025   ('%s://%s:%d' %
-00003ef0: 2028 2768 7474 7073 2720 6966 2073 656c   ('https' if sel
-00003f00: 662e 6973 5f73 6563 7572 6520 656c 7365  f.is_secure else
-00003f10: 2027 6874 7470 272c 2073 656c 662e 7365   'http', self.se
-00003f20: 7276 6572 2c20 7365 6c66 2e70 6f72 7429  rver, self.port)
-00003f30: 2929 0a20 2020 2020 2020 2020 2020 206d  )).            m
-00003f40: 7367 2e61 7070 656e 6428 2741 6363 6573  sg.append('Acces
-00003f50: 7320 4d6f 6465 3d27 202b 2028 2750 6174  s Mode=' + ('Pat
-00003f60: 6827 2069 6620 7365 6c66 2e70 6174 685f  h' if self.path_
-00003f70: 7374 796c 6520 656c 7365 2027 5669 7274  style else 'Virt
-00003f80: 7561 6c20 486f 7374 696e 6727 2920 2b20  ual Hosting') + 
-00003f90: 275d 2729 0a20 2020 2020 2020 2020 2020  ']').           
-00003fa0: 2073 656c 662e 6c6f 675f 636c 6965 6e74   self.log_client
-00003fb0: 2e6c 6f67 2857 4152 4e49 4e47 2c20 275d  .log(WARNING, ']
-00003fc0: 3b5b 272e 6a6f 696e 286d 7367 2929 0a0a  ;['.join(msg))..
-00003fd0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-00003fe0: 640a 2020 2020 6465 6620 5f61 7373 6572  d.    def _asser
-00003ff0: 745f 6e6f 745f 6e75 6c6c 2870 6172 616d  t_not_null(param
-00004000: 2c20 6d73 6729 3a0a 2020 2020 2020 2020  , msg):.        
-00004010: 7061 7261 6d20 3d20 7574 696c 2e73 6166  param = util.saf
-00004020: 655f 656e 636f 6465 2870 6172 616d 290a  e_encode(param).
-00004030: 2020 2020 2020 2020 6966 2070 6172 616d          if param
-00004040: 2069 7320 4e6f 6e65 206f 7220 7574 696c   is None or util
-00004050: 2e74 6f5f 7374 7269 6e67 2870 6172 616d  .to_string(param
-00004060: 292e 7374 7269 7028 2920 3d3d 2027 273a  ).strip() == '':
-00004070: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00004080: 7365 2045 7863 6570 7469 6f6e 286d 7367  se Exception(msg
-00004090: 290a 0a20 2020 2064 6566 205f 6765 6e65  )..    def _gene
-000040a0: 7261 7465 5f6f 626a 6563 745f 7572 6c28  rate_object_url(
-000040b0: 7365 6c66 2c20 7265 742c 2062 7563 6b65  self, ret, bucke
-000040c0: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
-000040d0: 293a 0a20 2020 2020 2020 2069 6620 7265  ):.        if re
-000040e0: 7420 616e 6420 7265 742e 7374 6174 7573  t and ret.status
-000040f0: 203c 2033 3030 2061 6e64 2072 6574 2e62   < 300 and ret.b
-00004100: 6f64 793a 0a20 2020 2020 2020 2020 2020  ody:.           
-00004110: 2072 6574 2e62 6f64 792e 6f62 6a65 6374   ret.body.object
-00004120: 5572 6c20 3d20 7365 6c66 2e63 616c 6c69  Url = self.calli
-00004130: 6e67 5f66 6f72 6d61 742e 6765 745f 6675  ng_format.get_fu
-00004140: 6c6c 5f75 726c 2873 656c 662e 6973 5f73  ll_url(self.is_s
-00004150: 6563 7572 652c 2073 656c 662e 7365 7276  ecure, self.serv
-00004160: 6572 2c20 7365 6c66 2e70 6f72 742c 2062  er, self.port, b
-00004170: 7563 6b65 744e 616d 652c 0a20 2020 2020  ucketName,.     
-00004180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041b0: 2020 2020 2020 2020 2020 2020 206f 626a               obj
-000041c0: 6563 744b 6579 2c20 7b7d 290a 0a20 2020  ectKey, {})..   
-000041d0: 2064 6566 205f 6d61 6b65 5f6f 7074 696f   def _make_optio
-000041e0: 6e73 5f72 6571 7565 7374 2873 656c 662c  ns_request(self,
-000041f0: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
-00004200: 6563 744b 6579 3d4e 6f6e 652c 2070 6174  ectKey=None, pat
-00004210: 6841 7267 733d 4e6f 6e65 2c20 6865 6164  hArgs=None, head
-00004220: 6572 733d 4e6f 6e65 2c20 6d65 7468 6f64  ers=None, method
-00004230: 4e61 6d65 3d4e 6f6e 652c 0a20 2020 2020  Name=None,.     
+00001110: 7265 7375 6c74 5f64 6963 203d 2063 6163  result_dic = cac
+00001120: 6865 732e 6765 7428 6b65 7929 0a20 2020  hes.get(key).   
+00001130: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00001140: 6e6f 7420 7265 7375 6c74 5f64 6963 3a0a  not result_dic:.
+00001150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001160: 2020 2020 6175 7468 5479 7065 2c20 7265      authType, re
+00001170: 7370 203d 205f 6973 4372 6561 7465 4275  sp = _isCreateBu
+00001180: 636b 6574 286f 6273 436c 6965 6e74 2c20  cket(obsClient, 
+00001190: 6e61 6d65 2c20 6b65 7929 0a20 2020 2020  name, key).     
+000011a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000011b0: 6620 6e6f 7420 6175 7468 5479 7065 3a0a  f not authType:.
+000011c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011d0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+000011e0: 7574 6854 7970 652c 2072 6573 700a 2020  uthType, resp.  
+000011f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001200: 2020 7265 7375 6c74 5f64 6963 203d 207b    result_dic = {
+00001210: 2773 6967 6e61 7475 7265 273a 2061 7574  'signature': aut
+00001220: 6854 7970 652c 2027 6578 7069 7265 273a  hType, 'expire':
+00001230: 2072 616e 646f 6d2e 7261 6e64 696e 7428   random.randint(
+00001240: 3930 302c 2031 3230 3029 202b 2063 6163  900, 1200) + cac
+00001250: 6865 732e 6e6f 7754 696d 6528 297d 0a20  hes.nowTime()}. 
+00001260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001270: 2020 2069 6620 6e61 6d65 2021 3d20 2763     if name != 'c
+00001280: 7265 6174 6542 7563 6b65 7427 3a0a 2020  reateBucket':.  
+00001290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012a0: 2020 2020 2020 6361 6368 6573 2e73 6574        caches.set
+000012b0: 286b 6579 2c20 7265 7375 6c74 5f64 6963  (key, result_dic
+000012c0: 290a 2020 2020 2020 2020 6f62 7343 6c69  ).        obsCli
+000012d0: 656e 742e 7468 7265 6164 5f6c 6f63 616c  ent.thread_local
+000012e0: 2e73 6967 6e61 7475 7265 203d 2072 6573  .signature = res
+000012f0: 756c 745f 6469 635b 2773 6967 6e61 7475  ult_dic['signatu
+00001300: 7265 275d 0a20 2020 2020 2020 2072 6574  re'].        ret
+00001310: 7572 6e20 5472 7565 2c20 2222 0a0a 0a64  urn True, ""...d
+00001320: 6566 2066 756e 6343 6163 6865 2866 756e  ef funcCache(fun
+00001330: 6329 3a0a 2020 2020 4066 756e 6374 6f6f  c):.    @functoo
+00001340: 6c73 2e77 7261 7073 2866 756e 6329 0a20  ls.wraps(func). 
+00001350: 2020 2064 6566 2077 7261 7070 6572 282a     def wrapper(*
+00001360: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+00001370: 0a20 2020 2020 2020 2073 7461 7274 203d  .        start =
+00001380: 2074 696d 652e 7469 6d65 2829 0a20 2020   time.time().   
+00001390: 2020 2020 2072 6574 203d 204e 6f6e 650a       ret = None.
+000013a0: 2020 2020 2020 2020 6f62 7343 6c69 656e          obsClien
+000013b0: 7420 3d20 5f67 6574 4f62 7343 6c69 656e  t = _getObsClien
+000013c0: 7428 2a61 7267 7329 0a20 2020 2020 2020  t(*args).       
+000013d0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+000013e0: 2020 6966 206f 6273 436c 6965 6e74 3a0a    if obsClient:.
+000013f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001400: 6f62 7343 6c69 656e 742e 6c6f 675f 636c  obsClient.log_cl
+00001410: 6965 6e74 2e6c 6f67 2849 4e46 4f2c 2027  ient.log(INFO, '
+00001420: 656e 7465 7220 2573 202e 2e2e 2720 2520  enter %s ...' % 
+00001430: 6675 6e63 2e5f 5f6e 616d 655f 5f29 0a20  func.__name__). 
+00001440: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00001450: 6579 203d 205f 6765 7443 6163 6865 4b65  ey = _getCacheKe
+00001460: 7928 6675 6e63 2e5f 5f6e 616d 655f 5f2c  y(func.__name__,
+00001470: 206f 6273 436c 6965 6e74 2c20 2a61 7267   obsClient, *arg
+00001480: 732c 202a 2a6b 7761 7267 7329 0a0a 2020  s, **kwargs)..  
+00001490: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000014a0: 206f 6273 436c 6965 6e74 2e69 735f 7369   obsClient.is_si
+000014b0: 676e 6174 7572 655f 6e65 676f 7469 6174  gnature_negotiat
+000014c0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+000014d0: 2020 2020 2020 2020 2062 6c61 636b 5f6c           black_l
+000014e0: 6973 7420 3d20 5b27 6c69 7374 4176 6169  ist = ['listAvai
+000014f0: 6c61 626c 655a 6f6e 6549 6e66 6f27 2c20  lableZoneInfo', 
+00001500: 2763 7265 6174 6556 6972 7475 616c 4275  'createVirtualBu
+00001510: 636b 6574 272c 2027 6372 6561 7465 4275  cket', 'createBu
+00001520: 636b 6574 416c 6961 7327 2c0a 2020 2020  cketAlias',.    
+00001530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001540: 2020 2020 2020 2020 2020 2020 2020 276c                'l
+00001550: 6973 7442 7563 6b65 7441 6c69 6173 272c  istBucketAlias',
+00001560: 2027 6465 6c65 7465 4275 636b 6574 416c   'deleteBucketAl
+00001570: 6961 7327 5d0a 2020 2020 2020 2020 2020  ias'].          
+00001580: 2020 2020 2020 2020 2020 6966 2066 756e            if fun
+00001590: 632e 5f5f 6e61 6d65 5f5f 2069 6e20 626c  c.__name__ in bl
+000015a0: 6163 6b5f 6c69 7374 3a0a 2020 2020 2020  ack_list:.      
+000015b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000015c0: 2020 6f62 7343 6c69 656e 742e 7468 7265    obsClient.thre
+000015d0: 6164 5f6c 6f63 616c 2e73 6967 6e61 7475  ad_local.signatu
+000015e0: 7265 203d 2063 6f6e 7374 2e4f 4253 5f53  re = const.OBS_S
+000015f0: 4947 4e41 5455 5245 0a20 2020 2020 2020  IGNATURE.       
+00001600: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00001610: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00001620: 2020 2020 2020 2020 2020 2061 7574 6854             authT
+00001630: 7970 652c 2072 6573 7020 3d20 5f69 735f  ype, resp = _is_
+00001640: 7369 676e 6174 7572 655f 6e65 676f 7469  signature_negoti
+00001650: 6174 696f 6e28 6f62 7343 6c69 656e 742c  ation(obsClient,
+00001660: 2066 756e 632e 5f5f 6e61 6d65 5f5f 2c20   func.__name__, 
+00001670: 6b65 7929 0a20 2020 2020 2020 2020 2020  key).           
+00001680: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00001690: 6e6f 7420 6175 7468 5479 7065 3a0a 2020  not authType:.  
+000016a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000016c0: 2072 6573 700a 2020 2020 2020 2020 2020   resp.          
+000016d0: 2020 7265 7420 3d20 6675 6e63 282a 6172    ret = func(*ar
+000016e0: 6773 2c20 2a2a 6b77 6172 6773 290a 2020  gs, **kwargs).  
+000016f0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00001700: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+00001710: 2020 2020 2020 2020 2069 6620 6f62 7343           if obsC
+00001720: 6c69 656e 7420 616e 6420 6f62 7343 6c69  lient and obsCli
+00001730: 656e 742e 6c6f 675f 636c 6965 6e74 3a0a  ent.log_client:.
+00001740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001750: 6f62 7343 6c69 656e 742e 6c6f 675f 636c  obsClient.log_cl
+00001760: 6965 6e74 2e6c 6f67 2849 4e46 4f2c 2074  ient.log(INFO, t
+00001770: 7261 6365 6261 636b 2e66 6f72 6d61 745f  raceback.format_
+00001780: 6578 6328 2929 0a20 2020 2020 2020 2020  exc()).         
+00001790: 2020 2072 6169 7365 2065 0a20 2020 2020     raise e.     
+000017a0: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
+000017b0: 2020 2020 2020 2020 5f77 7261 7070 6572          _wrapper
+000017c0: 4669 6e61 6c6c 7928 6f62 7343 6c69 656e  Finally(obsClien
+000017d0: 742c 2066 756e 632e 5f5f 6e61 6d65 5f5f  t, func.__name__
+000017e0: 2c20 7374 6172 7429 0a20 2020 2020 2020  , start).       
+000017f0: 2072 6574 7572 6e20 7265 740a 0a20 2020   return ret..   
+00001800: 2072 6574 7572 6e20 7772 6170 7065 720a   return wrapper.
+00001810: 0a0a 636c 6173 7320 4861 5772 6170 7065  ..class HaWrappe
+00001820: 7228 6f62 6a65 6374 293a 0a20 2020 2064  r(object):.    d
+00001830: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00001840: 2c20 7468 7265 6164 5f6c 6f63 616c 2c20  , thread_local, 
+00001850: 7369 676e 6174 7572 6529 3a0a 2020 2020  signature):.    
+00001860: 2020 2020 7365 6c66 2e6f 6273 4841 203d      self.obsHA =
+00001870: 2063 6f6e 7665 7274 6f72 2e41 6461 7074   convertor.Adapt
+00001880: 6572 2827 6f62 7327 290a 2020 2020 2020  er('obs').      
+00001890: 2020 7365 6c66 2e76 3248 4120 3d20 636f    self.v2HA = co
+000018a0: 6e76 6572 746f 722e 4164 6170 7465 7228  nvertor.Adapter(
+000018b0: 2776 3227 290a 2020 2020 2020 2020 7365  'v2').        se
+000018c0: 6c66 2e76 3448 4120 3d20 636f 6e76 6572  lf.v4HA = conver
+000018d0: 746f 722e 4164 6170 7465 7228 2776 3427  tor.Adapter('v4'
+000018e0: 290a 2020 2020 2020 2020 7365 6c66 2e74  ).        self.t
+000018f0: 6872 6561 645f 6c6f 6361 6c20 3d20 7468  hread_local = th
+00001900: 7265 6164 5f6c 6f63 616c 0a20 2020 2020  read_local.     
+00001910: 2020 2073 656c 662e 7369 676e 6174 7572     self.signatur
+00001920: 6520 3d20 7369 676e 6174 7572 650a 0a20  e = signature.. 
+00001930: 2020 2064 6566 205f 5f67 6574 6174 7472     def __getattr
+00001940: 5f5f 2873 656c 662c 2069 7465 6d29 3a0a  __(self, item):.
+00001950: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
+00001960: 6520 3d20 7365 6c66 2e74 6872 6561 645f  e = self.thread_
+00001970: 6c6f 6361 6c2e 7369 676e 6174 7572 6520  local.signature 
+00001980: 6966 2068 6173 6174 7472 2873 656c 662e  if hasattr(self.
+00001990: 7468 7265 6164 5f6c 6f63 616c 2c20 2773  thread_local, 's
+000019a0: 6967 6e61 7475 7265 2729 2065 6c73 6520  ignature') else 
+000019b0: 7365 6c66 2e73 6967 6e61 7475 7265 0a20  self.signature. 
+000019c0: 2020 2020 2020 2068 6120 3d20 7365 6c66         ha = self
+000019d0: 2e6f 6273 4841 2069 6620 7369 676e 6174  .obsHA if signat
+000019e0: 7572 6520 3d3d 2027 6f62 7327 2065 6c73  ure == 'obs' els
+000019f0: 6520 7365 6c66 2e76 3448 4120 6966 2073  e self.v4HA if s
+00001a00: 6967 6e61 7475 7265 203d 3d20 2776 3427  ignature == 'v4'
+00001a10: 2065 6c73 6520 7365 6c66 2e76 3248 410a   else self.v2HA.
+00001a20: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+00001a30: 6574 6174 7472 2868 612c 2069 7465 6d29  etattr(ha, item)
+00001a40: 0a0a 0a63 6c61 7373 2043 6f6e 7665 7274  ...class Convert
+00001a50: 5772 6170 7065 7228 6f62 6a65 6374 293a  Wrapper(object):
+00001a60: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00001a70: 5f28 7365 6c66 2c20 7468 7265 6164 5f6c  _(self, thread_l
+00001a80: 6f63 616c 2c20 7369 676e 6174 7572 6529  ocal, signature)
+00001a90: 3a0a 2020 2020 2020 2020 7365 6c66 2e6f  :.        self.o
+00001aa0: 6273 436f 7665 7220 3d20 636f 6e76 6572  bsCover = conver
+00001ab0: 746f 722e 436f 6e76 6572 746f 7228 276f  tor.Convertor('o
+00001ac0: 6273 272c 2063 6f6e 7665 7274 6f72 2e41  bs', convertor.A
+00001ad0: 6461 7074 6572 2827 6f62 7327 2929 0a20  dapter('obs')). 
+00001ae0: 2020 2020 2020 2073 656c 662e 7632 436f         self.v2Co
+00001af0: 7665 7220 3d20 636f 6e76 6572 746f 722e  ver = convertor.
+00001b00: 436f 6e76 6572 746f 7228 2776 3227 2c20  Convertor('v2', 
+00001b10: 636f 6e76 6572 746f 722e 4164 6170 7465  convertor.Adapte
+00001b20: 7228 2776 3227 2929 0a20 2020 2020 2020  r('v2')).       
+00001b30: 2073 656c 662e 7634 436f 7665 7220 3d20   self.v4Cover = 
+00001b40: 636f 6e76 6572 746f 722e 436f 6e76 6572  convertor.Conver
+00001b50: 746f 7228 2776 3427 2c20 636f 6e76 6572  tor('v4', conver
+00001b60: 746f 722e 4164 6170 7465 7228 2776 3427  tor.Adapter('v4'
+00001b70: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+00001b80: 7468 7265 6164 5f6c 6f63 616c 203d 2074  thread_local = t
+00001b90: 6872 6561 645f 6c6f 6361 6c0a 2020 2020  hread_local.    
+00001ba0: 2020 2020 7365 6c66 2e73 6967 6e61 7475      self.signatu
+00001bb0: 7265 203d 2073 6967 6e61 7475 7265 0a0a  re = signature..
+00001bc0: 2020 2020 6465 6620 5f5f 6765 7461 7474      def __getatt
+00001bd0: 725f 5f28 7365 6c66 2c20 6974 656d 293a  r__(self, item):
+00001be0: 0a20 2020 2020 2020 2073 6967 6e61 7475  .        signatu
+00001bf0: 7265 203d 2073 656c 662e 7468 7265 6164  re = self.thread
+00001c00: 5f6c 6f63 616c 2e73 6967 6e61 7475 7265  _local.signature
+00001c10: 2069 6620 6861 7361 7474 7228 7365 6c66   if hasattr(self
+00001c20: 2e74 6872 6561 645f 6c6f 6361 6c2c 2027  .thread_local, '
+00001c30: 7369 676e 6174 7572 6527 2920 656c 7365  signature') else
+00001c40: 2073 656c 662e 7369 676e 6174 7572 650a   self.signature.
+00001c50: 2020 2020 2020 2020 636f 6e76 6572 7420          convert 
+00001c60: 3d20 7365 6c66 2e6f 6273 436f 7665 7220  = self.obsCover 
+00001c70: 6966 2073 6967 6e61 7475 7265 203d 3d20  if signature == 
+00001c80: 276f 6273 2720 656c 7365 2073 656c 662e  'obs' else self.
+00001c90: 7634 436f 7665 7220 6966 2073 6967 6e61  v4Cover if signa
+00001ca0: 7475 7265 203d 3d20 2776 3427 2065 6c73  ture == 'v4' els
+00001cb0: 6520 7365 6c66 2e76 3243 6f76 6572 0a20  e self.v2Cover. 
+00001cc0: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
+00001cd0: 7461 7474 7228 636f 6e76 6572 742c 2069  tattr(convert, i
+00001ce0: 7465 6d29 0a0a 0a63 6c61 7373 205f 4261  tem)...class _Ba
+00001cf0: 7369 6343 6c69 656e 7428 6f62 6a65 6374  sicClient(object
+00001d00: 293a 0a20 2020 2064 6566 205f 5f69 6e69  ):.    def __ini
+00001d10: 745f 5f28 7365 6c66 2c20 6163 6365 7373  t__(self, access
+00001d20: 5f6b 6579 5f69 643d 2727 2c20 7365 6372  _key_id='', secr
+00001d30: 6574 5f61 6363 6573 735f 6b65 793d 2727  et_access_key=''
+00001d40: 2c20 6973 5f73 6563 7572 653d 5472 7565  , is_secure=True
+00001d50: 2c20 7365 7276 6572 3d4e 6f6e 652c 0a20  , server=None,. 
+00001d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001d70: 7369 676e 6174 7572 653d 276f 6273 272c  signature='obs',
+00001d80: 2072 6567 696f 6e3d 2772 6567 696f 6e27   region='region'
+00001d90: 2c20 7061 7468 5f73 7479 6c65 3d46 616c  , path_style=Fal
+00001da0: 7365 2c20 7373 6c5f 7665 7269 6679 3d46  se, ssl_verify=F
+00001db0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00001dc0: 2020 2020 2020 2070 6f72 743d 4e6f 6e65         port=None
+00001dd0: 2c20 6d61 785f 7265 7472 795f 636f 756e  , max_retry_coun
+00001de0: 743d 332c 2074 696d 656f 7574 3d36 302c  t=3, timeout=60,
+00001df0: 2063 6875 6e6b 5f73 697a 653d 636f 6e73   chunk_size=cons
+00001e00: 742e 5245 4144 5f4f 4e43 455f 4c45 4e47  t.READ_ONCE_LENG
+00001e10: 5448 2c0a 2020 2020 2020 2020 2020 2020  TH,.            
+00001e20: 2020 2020 206c 6f6e 675f 636f 6e6e 5f6d       long_conn_m
+00001e30: 6f64 653d 4661 6c73 652c 2070 726f 7879  ode=False, proxy
+00001e40: 5f68 6f73 743d 4e6f 6e65 2c20 7072 6f78  _host=None, prox
+00001e50: 795f 706f 7274 3d4e 6f6e 652c 0a20 2020  y_port=None,.   
+00001e60: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00001e70: 6f78 795f 7573 6572 6e61 6d65 3d4e 6f6e  oxy_username=Non
+00001e80: 652c 2070 726f 7879 5f70 6173 7377 6f72  e, proxy_passwor
+00001e90: 643d 4e6f 6e65 2c20 7365 6375 7269 7479  d=None, security
+00001ea0: 5f74 6f6b 656e 3d4e 6f6e 652c 0a20 2020  _token=None,.   
+00001eb0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+00001ec0: 7374 6f6d 5f63 6970 6865 7273 3d4e 6f6e  stom_ciphers=Non
+00001ed0: 652c 2075 7365 5f68 7474 7032 3d46 616c  e, use_http2=Fal
+00001ee0: 7365 2c20 6973 5f73 6967 6e61 7475 7265  se, is_signature
+00001ef0: 5f6e 6567 6f74 6961 7469 6f6e 3d54 7275  _negotiation=Tru
+00001f00: 652c 2069 735f 636e 616d 653d 4661 6c73  e, is_cname=Fals
+00001f10: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00001f20: 2020 2020 6d61 785f 7265 6469 7265 6374      max_redirect
+00001f30: 5f63 6f75 6e74 3d31 302c 2073 6563 7572  _count=10, secur
+00001f40: 6974 795f 7072 6f76 6964 6572 733d 4e6f  ity_providers=No
+00001f50: 6e65 2c20 7365 6375 7269 7479 5f70 726f  ne, security_pro
+00001f60: 7669 6465 725f 706f 6c69 6379 3d4e 6f6e  vider_policy=Non
+00001f70: 652c 2063 6c69 656e 745f 6d6f 6465 3d27  e, client_mode='
+00001f80: 6f62 7327 293a 0a20 2020 2020 2020 2073  obs'):.        s
+00001f90: 656c 662e 7365 6375 7269 7479 5072 6f76  elf.securityProv
+00001fa0: 6964 6572 203d 205f 5365 6375 7269 7479  ider = _Security
+00001fb0: 5072 6f76 6964 6572 2861 6363 6573 735f  Provider(access_
+00001fc0: 6b65 795f 6964 2c20 7365 6372 6574 5f61  key_id, secret_a
+00001fd0: 6363 6573 735f 6b65 792c 2073 6563 7572  ccess_key, secur
+00001fe0: 6974 795f 746f 6b65 6e29 0a20 2020 2020  ity_token).     
+00001ff0: 2020 2073 6572 7665 7220 3d20 7365 7276     server = serv
+00002000: 6572 2069 6620 7365 7276 6572 2069 7320  er if server is 
+00002010: 6e6f 7420 4e6f 6e65 2065 6c73 6520 2727  not None else ''
+00002020: 0a20 2020 2020 2020 2073 6572 7665 7220  .        server 
+00002030: 3d20 7574 696c 2e74 6f5f 7374 7269 6e67  = util.to_string
+00002040: 2875 7469 6c2e 7361 6665 5f65 6e63 6f64  (util.safe_encod
+00002050: 6528 7365 7276 6572 2929 0a0a 2020 2020  e(server))..    
+00002060: 2020 2020 5f73 6572 7665 7220 3d20 7572      _server = ur
+00002070: 6c70 6172 7365 2873 6572 7665 7229 0a0a  lparse(server)..
+00002080: 2020 2020 2020 2020 686f 7374 6e61 6d65          hostname
+00002090: 203d 2073 656c 662e 5f70 6172 7365 5f73   = self._parse_s
+000020a0: 6572 7665 725f 686f 7374 6e61 6d65 285f  erver_hostname(_
+000020b0: 7365 7276 6572 290a 2020 2020 2020 2020  server).        
+000020c0: 6973 5f73 6563 7572 6520 3d20 7365 6c66  is_secure = self
+000020d0: 2e5f 6368 6563 6b5f 7365 7276 6572 5f73  ._check_server_s
+000020e0: 6563 7572 6528 5f73 6572 7665 722c 2069  ecure(_server, i
+000020f0: 735f 7365 6375 7265 290a 2020 2020 2020  s_secure).      
+00002100: 2020 686f 7374 5f70 6f72 742c 2070 6f72    host_port, por
+00002110: 7420 3d20 7365 6c66 2e5f 7370 6c69 745f  t = self._split_
+00002120: 686f 7374 5f70 6f72 7428 686f 7374 6e61  host_port(hostna
+00002130: 6d65 2c20 706f 7274 290a 2020 2020 2020  me, port).      
+00002140: 2020 7365 6c66 2e73 6563 7572 6974 795f    self.security_
+00002150: 7072 6f76 6964 6572 5f70 6f6c 6963 7920  provider_policy 
+00002160: 3d20 7365 6375 7269 7479 5f70 726f 7669  = security_provi
+00002170: 6465 725f 706f 6c69 6379 0a20 2020 2020  der_policy.     
+00002180: 2020 2073 656c 662e 5f70 6172 7365 5f73     self._parse_s
+00002190: 6563 7572 6974 795f 7072 6f76 6964 6572  ecurity_provider
+000021a0: 7328 7365 6375 7269 7479 5f70 726f 7669  s(security_provi
+000021b0: 6465 7273 290a 0a20 2020 2020 2020 2073  ders)..        s
+000021c0: 656c 662e 6973 5f73 6563 7572 6520 3d20  elf.is_secure = 
+000021d0: 6973 5f73 6563 7572 650a 2020 2020 2020  is_secure.      
+000021e0: 2020 7365 6c66 2e73 6572 7665 7220 3d20    self.server = 
+000021f0: 686f 7374 5f70 6f72 745b 305d 0a0a 2020  host_port[0]..  
+00002200: 2020 2020 2020 7061 7468 5f73 7479 6c65        path_style
+00002210: 203d 2073 656c 662e 5f63 6865 636b 5f70   = self._check_p
+00002220: 6174 685f 7374 796c 6528 7061 7468 5f73  ath_style(path_s
+00002230: 7479 6c65 290a 2020 2020 2020 2020 7365  tyle).        se
+00002240: 6c66 2e73 6967 6e61 7475 7265 203d 2075  lf.signature = u
+00002250: 7469 6c2e 746f 5f73 7472 696e 6728 7574  til.to_string(ut
+00002260: 696c 2e73 6166 655f 656e 636f 6465 2873  il.safe_encode(s
+00002270: 6967 6e61 7475 7265 2929 0a20 2020 2020  ignature)).     
+00002280: 2020 2073 656c 662e 7265 6769 6f6e 203d     self.region =
+00002290: 2072 6567 696f 6e0a 2020 2020 2020 2020   region.        
+000022a0: 7365 6c66 2e70 6174 685f 7374 796c 6520  self.path_style 
+000022b0: 3d20 7061 7468 5f73 7479 6c65 0a20 2020  = path_style.   
+000022c0: 2020 2020 2073 656c 662e 7373 6c5f 7665       self.ssl_ve
+000022d0: 7269 6679 203d 2073 736c 5f76 6572 6966  rify = ssl_verif
+000022e0: 790a 2020 2020 2020 2020 7365 6c66 2e63  y.        self.c
+000022f0: 616c 6c69 6e67 5f66 6f72 6d61 7420 3d20  alling_format = 
+00002300: 7365 6c66 2e5f 7061 7273 655f 6361 6c6c  self._parse_call
+00002310: 696e 675f 666f 726d 6174 2829 0a20 2020  ing_format().   
+00002320: 2020 2020 2073 656c 662e 706f 7274 203d       self.port =
+00002330: 2073 656c 662e 5f70 6172 7365 5f70 6f72   self._parse_por
+00002340: 7428 706f 7274 2c20 6973 5f73 6563 7572  t(port, is_secur
+00002350: 6529 0a0a 2020 2020 2020 2020 6966 2074  e)..        if t
+00002360: 696d 656f 7574 2069 7320 4e6f 6e65 3a0a  imeout is None:.
+00002370: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00002380: 6520 4578 6365 7074 696f 6e28 2774 696d  e Exception('tim
+00002390: 656f 7574 2063 616e 206e 6f74 2062 6520  eout can not be 
+000023a0: 4e6f 6e65 2729 0a20 2020 2020 2020 2073  None').        s
+000023b0: 656c 662e 6d61 785f 7265 7472 795f 636f  elf.max_retry_co
+000023c0: 756e 7420 3d20 6d61 785f 7265 7472 795f  unt = max_retry_
+000023d0: 636f 756e 740a 2020 2020 2020 2020 7365  count.        se
+000023e0: 6c66 2e74 696d 656f 7574 203d 2074 696d  lf.timeout = tim
+000023f0: 656f 7574 0a20 2020 2020 2020 2073 656c  eout.        sel
+00002400: 662e 6368 756e 6b5f 7369 7a65 203d 2063  f.chunk_size = c
+00002410: 6875 6e6b 5f73 697a 650a 2020 2020 2020  hunk_size.      
+00002420: 2020 7365 6c66 2e6c 6f67 5f63 6c69 656e    self.log_clien
+00002430: 7420 3d20 4e6f 6e65 4c6f 6743 6c69 656e  t = NoneLogClien
+00002440: 7428 290a 2020 2020 2020 2020 7365 6c66  t().        self
+00002450: 2e75 7365 5f68 7474 7032 203d 2075 7365  .use_http2 = use
+00002460: 5f68 7474 7032 0a20 2020 2020 2020 2073  _http2.        s
+00002470: 656c 662e 6973 5f73 6967 6e61 7475 7265  elf.is_signature
+00002480: 5f6e 6567 6f74 6961 7469 6f6e 203d 2069  _negotiation = i
+00002490: 735f 7369 676e 6174 7572 655f 6e65 676f  s_signature_nego
+000024a0: 7469 6174 696f 6e0a 2020 2020 2020 2020  tiation.        
+000024b0: 7365 6c66 2e69 735f 636e 616d 6520 3d20  self.is_cname = 
+000024c0: 6973 5f63 6e61 6d65 0a20 2020 2020 2020  is_cname.       
+000024d0: 2073 656c 662e 6d61 785f 7265 6469 7265   self.max_redire
+000024e0: 6374 5f63 6f75 6e74 203d 206d 6178 5f72  ct_count = max_r
+000024f0: 6564 6972 6563 745f 636f 756e 740a 0a20  edirect_count.. 
+00002500: 2020 2020 2020 2069 6620 636c 6965 6e74         if client
+00002510: 5f6d 6f64 6520 3d3d 2027 6f62 7327 3a0a  _mode == 'obs':.
+00002520: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00002530: 656c 662e 7061 7468 5f73 7479 6c65 206f  elf.path_style o
+00002540: 7220 7365 6c66 2e69 735f 636e 616d 653a  r self.is_cname:
+00002550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002560: 2073 656c 662e 6973 5f73 6967 6e61 7475   self.is_signatu
+00002570: 7265 5f6e 6567 6f74 6961 7469 6f6e 203d  re_negotiation =
+00002580: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+00002590: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
+000025a0: 6967 6e61 7475 7265 203d 3d20 276f 6273  ignature == 'obs
+000025b0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+000025c0: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+000025d0: 6174 7572 6520 3d20 2776 3227 0a20 2020  ature = 'v2'.   
+000025e0: 2020 2020 2065 6c69 6620 636c 6965 6e74       elif client
+000025f0: 5f6d 6f64 6520 3d3d 2027 776f 726b 666c  _mode == 'workfl
+00002600: 6f77 273a 0a20 2020 2020 2020 2020 2020  ow':.           
+00002610: 2073 656c 662e 6973 5f73 6967 6e61 7475   self.is_signatu
+00002620: 7265 5f6e 6567 6f74 6961 7469 6f6e 203d  re_negotiation =
+00002630: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
+00002640: 7365 6c66 2e63 6f6e 7465 7874 203d 204e  self.context = N
+00002650: 6f6e 650a 2020 2020 2020 2020 6966 2073  one.        if s
+00002660: 656c 662e 6973 5f73 6563 7572 653a 0a20  elf.is_secure:. 
+00002670: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00002680: 6c66 2e75 7365 5f68 7474 7032 3a0a 2020  lf.use_http2:.  
+00002690: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+000026a0: 6f6d 206f 6273 2069 6d70 6f72 7420 6874  om obs import ht
+000026b0: 7470 320a 2020 2020 2020 2020 2020 2020  tp2.            
+000026c0: 2020 2020 7365 6c66 2e63 6f6e 7465 7874      self.context
+000026d0: 203d 2068 7474 7032 2e5f 6765 745f 7373   = http2._get_ss
+000026e0: 6c5f 636f 6e74 6578 7428 7365 6c66 2e73  l_context(self.s
+000026f0: 736c 5f76 6572 6966 7929 0a20 2020 2020  sl_verify).     
+00002700: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00002710: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00002720: 662e 5f69 6e69 745f 7373 6c5f 636f 6e74  f._init_ssl_cont
+00002730: 6578 7428 6375 7374 6f6d 5f63 6970 6865  ext(custom_ciphe
+00002740: 7273 290a 0a20 2020 2020 2020 2073 656c  rs)..        sel
+00002750: 662e 6c6f 6e67 5f63 6f6e 6e5f 6d6f 6465  f.long_conn_mode
+00002760: 203d 206c 6f6e 675f 636f 6e6e 5f6d 6f64   = long_conn_mod
+00002770: 650a 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00002780: 636f 6e6e 486f 6c64 6572 203d 204e 6f6e  connHolder = Non
+00002790: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
+000027a0: 662e 6c6f 6e67 5f63 6f6e 6e5f 6d6f 6465  f.long_conn_mode
+000027b0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+000027c0: 6c66 2e5f 696e 6974 5f63 6f6e 6e48 6f6c  lf._init_connHol
+000027d0: 6465 7228 290a 0a20 2020 2020 2020 2073  der()..        s
+000027e0: 656c 662e 7072 6f78 795f 686f 7374 203d  elf.proxy_host =
+000027f0: 2070 726f 7879 5f68 6f73 740a 2020 2020   proxy_host.    
+00002800: 2020 2020 7365 6c66 2e70 726f 7879 5f70      self.proxy_p
+00002810: 6f72 7420 3d20 7072 6f78 795f 706f 7274  ort = proxy_port
+00002820: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+00002830: 6f78 795f 7573 6572 6e61 6d65 203d 2070  oxy_username = p
+00002840: 726f 7879 5f75 7365 726e 616d 650a 2020  roxy_username.  
+00002850: 2020 2020 2020 7365 6c66 2e70 726f 7879        self.proxy
+00002860: 5f70 6173 7377 6f72 6420 3d20 7072 6f78  _password = prox
+00002870: 795f 7061 7373 776f 7264 0a20 2020 2020  y_password.     
+00002880: 2020 2073 656c 662e 7061 7474 6572 6e20     self.pattern 
+00002890: 3d20 7265 2e63 6f6d 7069 6c65 2827 786d  = re.compile('xm
+000028a0: 6c6e 733d 2268 7474 702e 2a3f 2227 290a  lns="http.*?"').
+000028b0: 2020 2020 2020 2020 7365 6c66 2e74 6872          self.thr
+000028c0: 6561 645f 6c6f 6361 6c20 3d20 7468 7265  ead_local = thre
+000028d0: 6164 696e 672e 6c6f 6361 6c28 290a 2020  ading.local().  
+000028e0: 2020 2020 2020 7365 6c66 2e74 6872 6561        self.threa
+000028f0: 645f 6c6f 6361 6c2e 7369 676e 6174 7572  d_local.signatur
+00002900: 6520 3d20 7365 6c66 2e73 6967 6e61 7475  e = self.signatu
+00002910: 7265 0a20 2020 2020 2020 2069 6620 7365  re.        if se
+00002920: 6c66 2e69 735f 7369 676e 6174 7572 655f  lf.is_signature_
+00002930: 6e65 676f 7469 6174 696f 6e3a 0a20 2020  negotiation:.   
+00002940: 2020 2020 2020 2020 2073 656c 662e 6361           self.ca
+00002950: 6368 6520 3d20 4c6f 6361 6c43 6163 6865  che = LocalCache
+00002960: 286d 6178 6c65 6e3d 3130 3029 0a20 2020  (maxlen=100).   
+00002970: 2020 2020 2020 2020 2073 656c 662e 6861           self.ha
+00002980: 203d 2048 6157 7261 7070 6572 2873 656c   = HaWrapper(sel
+00002990: 662e 7468 7265 6164 5f6c 6f63 616c 2c20  f.thread_local, 
+000029a0: 7365 6c66 2e73 6967 6e61 7475 7265 290a  self.signature).
+000029b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000029c0: 2e63 6f6e 7665 7274 6f72 203d 2043 6f6e  .convertor = Con
+000029d0: 7665 7274 5772 6170 7065 7228 7365 6c66  vertWrapper(self
+000029e0: 2e74 6872 6561 645f 6c6f 6361 6c2c 2073  .thread_local, s
+000029f0: 656c 662e 7369 676e 6174 7572 6529 0a20  elf.signature). 
+00002a00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00002a10: 2020 2020 2020 2020 2073 656c 662e 6861           self.ha
+00002a20: 203d 2063 6f6e 7665 7274 6f72 2e41 6461   = convertor.Ada
+00002a30: 7074 6572 2873 656c 662e 7369 676e 6174  pter(self.signat
+00002a40: 7572 6529 0a20 2020 2020 2020 2020 2020  ure).           
+00002a50: 2073 656c 662e 636f 6e76 6572 746f 7220   self.convertor 
+00002a60: 3d20 636f 6e76 6572 746f 722e 436f 6e76  = convertor.Conv
+00002a70: 6572 746f 7228 7365 6c66 2e73 6967 6e61  ertor(self.signa
+00002a80: 7475 7265 2c20 7365 6c66 2e68 6129 0a20  ture, self.ha). 
+00002a90: 2020 2020 2020 2073 656c 662e 6a73 6f6e         self.json
+00002aa0: 5f72 6573 706f 6e73 655f 6d65 7468 6f64  _response_method
+00002ab0: 5f6e 616d 6520 3d20 2747 6574 4a73 6f6e  _name = 'GetJson
+00002ac0: 5265 7370 6f6e 7365 270a 0a20 2020 2040  Response'..    @
+00002ad0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00002ae0: 2064 6566 205f 7061 7273 655f 7365 7276   def _parse_serv
+00002af0: 6572 5f68 6f73 746e 616d 6528 7365 7276  er_hostname(serv
+00002b00: 6572 293a 0a20 2020 2020 2020 2068 6f73  er):.        hos
+00002b10: 746e 616d 6520 3d20 7365 7276 6572 2e6e  tname = server.n
+00002b20: 6574 6c6f 6320 6966 2075 7469 6c2e 6973  etloc if util.is
+00002b30: 5f76 616c 6964 2873 6572 7665 722e 6e65  _valid(server.ne
+00002b40: 746c 6f63 2920 656c 7365 2073 6572 7665  tloc) else serve
+00002b50: 722e 7061 7468 0a20 2020 2020 2020 2069  r.path.        i
+00002b60: 6620 6e6f 7420 7574 696c 2e69 735f 7661  f not util.is_va
+00002b70: 6c69 6428 686f 7374 6e61 6d65 293a 0a20  lid(hostname):. 
+00002b80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00002b90: 2045 7863 6570 7469 6f6e 2827 7365 7276   Exception('serv
+00002ba0: 6572 2069 7320 6e6f 7420 7365 7420 636f  er is not set co
+00002bb0: 7272 6563 746c 7927 290a 2020 2020 2020  rrectly').      
+00002bc0: 2020 7265 7475 726e 2068 6f73 746e 616d    return hostnam
+00002bd0: 650a 0a20 2020 2040 7374 6174 6963 6d65  e..    @staticme
+00002be0: 7468 6f64 0a20 2020 2064 6566 205f 6368  thod.    def _ch
+00002bf0: 6563 6b5f 7365 7276 6572 5f73 6563 7572  eck_server_secur
+00002c00: 6528 7365 7276 6572 2c20 6973 5f73 6563  e(server, is_sec
+00002c10: 7572 6529 3a0a 2020 2020 2020 2020 6966  ure):.        if
+00002c20: 2075 7469 6c2e 6973 5f76 616c 6964 2873   util.is_valid(s
+00002c30: 6572 7665 722e 7363 6865 6d65 293a 0a20  erver.scheme):. 
+00002c40: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00002c50: 7276 6572 2e73 6368 656d 6520 3d3d 2027  rver.scheme == '
+00002c60: 6874 7470 7327 3a0a 2020 2020 2020 2020  https':.        
+00002c70: 2020 2020 2020 2020 6973 5f73 6563 7572          is_secur
+00002c80: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+00002c90: 2020 2020 2065 6c69 6620 7365 7276 6572       elif server
+00002ca0: 2e73 6368 656d 6520 3d3d 2027 6874 7470  .scheme == 'http
+00002cb0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00002cc0: 2020 2069 735f 7365 6375 7265 203d 2046     is_secure = F
+00002cd0: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
+00002ce0: 7572 6e20 6973 5f73 6563 7572 650a 0a20  urn is_secure.. 
+00002cf0: 2020 2064 6566 205f 7061 7273 655f 7365     def _parse_se
+00002d00: 6375 7269 7479 5f70 726f 7669 6465 7273  curity_providers
+00002d10: 2873 656c 662c 2073 6563 7572 6974 795f  (self, security_
+00002d20: 7072 6f76 6964 6572 7329 3a0a 2020 2020  providers):.    
+00002d30: 2020 2020 6966 2073 6563 7572 6974 795f      if security_
+00002d40: 7072 6f76 6964 6572 7320 6973 204e 6f6e  providers is Non
+00002d50: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00002d60: 656c 662e 7365 6375 7269 7479 5f70 726f  elf.security_pro
+00002d70: 7669 6465 7273 203d 205b 6c6f 6164 746f  viders = [loadto
+00002d80: 6b65 6e2e 454e 562c 206c 6f61 6474 6f6b  ken.ENV, loadtok
+00002d90: 656e 2e45 4353 5d0a 2020 2020 2020 2020  en.ECS].        
+00002da0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00002db0: 2020 7365 6c66 2e73 6563 7572 6974 795f    self.security_
+00002dc0: 7072 6f76 6964 6572 7320 3d20 7365 6375  providers = secu
+00002dd0: 7269 7479 5f70 726f 7669 6465 7273 0a20  rity_providers. 
+00002de0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00002df0: 2020 2020 2020 2020 6966 2073 6563 7572          if secur
+00002e00: 6974 795f 7072 6f76 6964 6572 7320 3d3d  ity_providers ==
+00002e10: 205b 5d3a 0a20 2020 2020 2020 2020 2020   []:.           
+00002e20: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00002e30: 4572 726f 7228 276e 6f20 6176 6169 6c61  Error('no availa
+00002e40: 626c 6520 7365 6375 7269 7479 5f70 726f  ble security_pro
+00002e50: 7669 6465 7273 2729 0a20 2020 2020 2020  viders').       
+00002e60: 2020 2020 2066 6f72 206d 6574 686f 6420       for method 
+00002e70: 696e 2073 656c 662e 7365 6375 7269 7479  in self.security
+00002e80: 5f70 726f 7669 6465 7273 3a0a 2020 2020  _providers:.    
+00002e90: 2020 2020 2020 2020 2020 2020 6765 7461              geta
+00002ea0: 7474 7228 6d65 7468 6f64 2c20 275f 5f6e  ttr(method, '__n
+00002eb0: 616d 655f 5f27 290a 2020 2020 2020 2020  ame__').        
+00002ec0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00002ed0: 7366 756e 6374 696f 6e28 6d65 7468 6f64  sfunction(method
+00002ee0: 2e73 6561 7263 6829 3a0a 2020 2020 2020  .search):.      
+00002ef0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00002f00: 6973 6520 4174 7472 6962 7574 6545 7272  ise AttributeErr
+00002f10: 6f72 286d 6574 686f 6420 2b20 2768 6173  or(method + 'has
+00002f20: 206e 6f20 6675 6e63 7469 6f6e 2063 616c   no function cal
+00002f30: 6c65 6420 7365 6172 6368 2729 0a20 2020  led search').   
+00002f40: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00002f50: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+00002f60: 2020 2073 656c 662e 7365 6375 7269 7479     self.security
+00002f70: 5f70 726f 7669 6465 725f 706f 6c69 6379  _provider_policy
+00002f80: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00002f90: 2020 2020 7072 696e 7428 7472 6163 6562      print(traceb
+00002fa0: 6163 6b2e 666f 726d 6174 5f65 7863 2829  ack.format_exc()
+00002fb0: 290a 0a20 2020 2040 7374 6174 6963 6d65  )..    @staticme
+00002fc0: 7468 6f64 0a20 2020 2064 6566 205f 7370  thod.    def _sp
+00002fd0: 6c69 745f 686f 7374 5f70 6f72 7428 686f  lit_host_port(ho
+00002fe0: 7374 6e61 6d65 2c20 706f 7274 293a 0a20  stname, port):. 
+00002ff0: 2020 2020 2020 2068 6f73 745f 706f 7274         host_port
+00003000: 203d 2068 6f73 746e 616d 652e 7370 6c69   = hostname.spli
+00003010: 7428 273a 2729 0a20 2020 2020 2020 2069  t(':').        i
+00003020: 6620 6c65 6e28 686f 7374 5f70 6f72 7429  f len(host_port)
+00003030: 203d 3d20 323a 0a20 2020 2020 2020 2020   == 2:.         
+00003040: 2020 2070 6f72 7420 3d20 7574 696c 2e74     port = util.t
+00003050: 6f5f 696e 7428 686f 7374 5f70 6f72 745b  o_int(host_port[
+00003060: 315d 290a 2020 2020 2020 2020 7265 7475  1]).        retu
+00003070: 726e 2068 6f73 745f 706f 7274 2c20 706f  rn host_port, po
+00003080: 7274 0a0a 2020 2020 6465 6620 5f63 6865  rt..    def _che
+00003090: 636b 5f70 6174 685f 7374 796c 6528 7365  ck_path_style(se
+000030a0: 6c66 2c20 7061 7468 5f73 7479 6c65 293a  lf, path_style):
+000030b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000030c0: 5472 7565 2069 6620 7574 696c 2e69 735f  True if util.is_
+000030d0: 6970 6164 6472 6573 7328 7365 6c66 2e73  ipaddress(self.s
+000030e0: 6572 7665 7229 2065 6c73 6520 7061 7468  erver) else path
+000030f0: 5f73 7479 6c65 0a0a 2020 2020 4073 7461  _style..    @sta
+00003100: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+00003110: 6620 5f70 6172 7365 5f70 6f72 7428 706f  f _parse_port(po
+00003120: 7274 2c20 6973 5f73 6563 7572 6529 3a0a  rt, is_secure):.
+00003130: 2020 2020 2020 2020 6966 2070 6f72 7420          if port 
+00003140: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00003150: 2020 2020 2069 6620 6973 5f73 6563 7572       if is_secur
+00003160: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00003170: 2020 2070 6f72 7420 3d20 636f 6e73 742e     port = const.
+00003180: 4445 4641 554c 545f 5345 4355 5245 5f50  DEFAULT_SECURE_P
+00003190: 4f52 540a 2020 2020 2020 2020 2020 2020  ORT.            
+000031a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000031b0: 2020 2020 2020 706f 7274 203d 2063 6f6e        port = con
+000031c0: 7374 2e44 4546 4155 4c54 5f49 4e53 4543  st.DEFAULT_INSEC
+000031d0: 5552 455f 504f 5254 0a20 2020 2020 2020  URE_PORT.       
+000031e0: 2072 6574 7572 6e20 706f 7274 0a0a 2020   return port..  
+000031f0: 2020 6465 6620 5f70 6172 7365 5f63 616c    def _parse_cal
+00003200: 6c69 6e67 5f66 6f72 6d61 7428 7365 6c66  ling_format(self
+00003210: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
+00003220: 6c66 2e70 6174 685f 7374 796c 653a 0a20  lf.path_style:. 
+00003230: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003240: 6e20 7574 696c 2e52 6571 7565 7374 466f  n util.RequestFo
+00003250: 726d 6174 2e67 6574 5f70 6174 685f 666f  rmat.get_path_fo
+00003260: 726d 6174 2829 0a20 2020 2020 2020 2065  rmat().        e
+00003270: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00003280: 2072 6574 7572 6e20 7574 696c 2e52 6571   return util.Req
+00003290: 7565 7374 466f 726d 6174 2e67 6574 5f73  uestFormat.get_s
+000032a0: 7562 5f64 6f6d 6169 6e5f 666f 726d 6174  ub_domain_format
+000032b0: 2829 0a0a 2020 2020 6465 6620 5f67 6574  ()..    def _get
+000032c0: 5f74 6f6b 656e 2873 656c 6629 3a0a 2020  _token(self):.  
+000032d0: 2020 2020 2020 6672 6f6d 206f 6273 2e73        from obs.s
+000032e0: 6561 7263 686d 6574 686f 6420 696d 706f  earchmethod impo
+000032f0: 7274 2067 6574 5f74 6f6b 656e 0a20 2020  rt get_token.   
+00003300: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00003310: 2020 2020 2020 6966 2073 656c 662e 7365        if self.se
+00003320: 6375 7269 7479 5f70 726f 7669 6465 725f  curity_provider_
+00003330: 706f 6c69 6379 2069 7320 6e6f 7420 4e6f  policy is not No
+00003340: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00003350: 2020 2020 6966 2073 656c 662e 7365 6375      if self.secu
+00003360: 7269 7479 5072 6f76 6964 6572 2e61 6363  rityProvider.acc
+00003370: 6573 735f 6b65 795f 6964 2021 3d20 2727  ess_key_id != ''
+00003380: 2061 6e64 2073 656c 662e 7365 6375 7269   and self.securi
+00003390: 7479 5072 6f76 6964 6572 2e73 6563 7265  tyProvider.secre
+000033a0: 745f 6163 6365 7373 5f6b 6579 2021 3d20  t_access_key != 
+000033b0: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
+000033c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000033d0: 656c 662e 7365 6375 7269 7479 5072 6f76  elf.securityProv
+000033e0: 6964 6572 0a0a 2020 2020 2020 2020 2020  ider..          
+000033f0: 2020 2020 2020 7661 6c75 655f 6469 6374        value_dict
+00003400: 203d 2067 6574 5f74 6f6b 656e 2873 656c   = get_token(sel
+00003410: 662e 7365 6375 7269 7479 5f70 726f 7669  f.security_provi
+00003420: 6465 7273 2c20 6e61 6d65 3d73 656c 662e  ders, name=self.
+00003430: 7365 6375 7269 7479 5f70 726f 7669 6465  security_provide
+00003440: 725f 706f 6c69 6379 290a 2020 2020 2020  r_policy).      
+00003450: 2020 2020 2020 2020 2020 7365 6375 7269            securi
+00003460: 7479 5072 6f76 6964 6572 203d 205f 5365  tyProvider = _Se
+00003470: 6375 7269 7479 5072 6f76 6964 6572 2876  curityProvider(v
+00003480: 616c 7565 5f64 6963 742e 6765 7428 2761  alue_dict.get('a
+00003490: 6363 6573 734b 6579 2729 2c20 7661 6c75  ccessKey'), valu
+000034a0: 655f 6469 6374 2e67 6574 2827 7365 6372  e_dict.get('secr
+000034b0: 6574 4b65 7927 292c 0a20 2020 2020 2020  etKey'),.       
+000034c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034e0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+000034f0: 6c75 655f 6469 6374 2e67 6574 2827 7365  lue_dict.get('se
+00003500: 6375 7269 7479 546f 6b65 6e27 2929 0a20  curityToken')). 
+00003510: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00003520: 6574 7572 6e20 7365 6375 7269 7479 5072  eturn securityPr
+00003530: 6f76 6964 6572 0a20 2020 2020 2020 2065  ovider.        e
+00003540: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00003550: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00003560: 662e 6c6f 675f 636c 6965 6e74 2e6c 6f67  f.log_client.log
+00003570: 2857 4152 4e49 4e47 2c20 7472 6163 6562  (WARNING, traceb
+00003580: 6163 6b2e 666f 726d 6174 5f65 7863 2829  ack.format_exc()
+00003590: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000035a0: 2073 656c 662e 7365 6375 7269 7479 5072   self.securityPr
+000035b0: 6f76 6964 6572 0a0a 2020 2020 6465 6620  ovider..    def 
+000035c0: 5f69 6e69 745f 636f 6e6e 486f 6c64 6572  _init_connHolder
+000035d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000035e0: 6966 2063 6f6e 7374 2e49 535f 5059 5448  if const.IS_PYTH
+000035f0: 4f4e 323a 0a20 2020 2020 2020 2020 2020  ON2:.           
+00003600: 2066 726f 6d20 5175 6575 6520 696d 706f   from Queue impo
+00003610: 7274 2051 7565 7565 0a20 2020 2020 2020  rt Queue.       
+00003620: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00003630: 2020 2066 726f 6d20 7175 6575 6520 696d     from queue im
+00003640: 706f 7274 2051 7565 7565 0a20 2020 2020  port Queue.     
+00003650: 2020 2073 656c 662e 636f 6e6e 486f 6c64     self.connHold
+00003660: 6572 203d 207b 2763 6f6e 6e53 6574 273a  er = {'connSet':
+00003670: 2051 7565 7565 2829 2c20 276c 6f63 6b27   Queue(), 'lock'
+00003680: 3a20 7468 7265 6164 696e 672e 4c6f 636b  : threading.Lock
+00003690: 2829 7d0a 0a20 2020 2064 6566 205f 696e  ()}..    def _in
+000036a0: 6974 5f73 736c 5f63 6f6e 7465 7874 2873  it_ssl_context(s
+000036b0: 656c 662c 2063 7573 746f 6d5f 6369 7068  elf, custom_ciph
+000036c0: 6572 7329 3a0a 2020 2020 2020 2020 7472  ers):.        tr
+000036d0: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
+000036e0: 6d70 6f72 7420 7373 6c0a 2020 2020 2020  mport ssl.      
+000036f0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+00003700: 2873 736c 2c20 2753 534c 436f 6e74 6578  (ssl, 'SSLContex
+00003710: 7427 293a 0a20 2020 2020 2020 2020 2020  t'):.           
+00003720: 2020 2020 2063 6f6e 7465 7874 203d 2073       context = s
+00003730: 736c 2e53 534c 436f 6e74 6578 7428 7373  sl.SSLContext(ss
+00003740: 6c2e 5052 4f54 4f43 4f4c 5f53 534c 7632  l.PROTOCOL_SSLv2
+00003750: 3329 0a20 2020 2020 2020 2020 2020 2020  3).             
+00003760: 2020 2063 6f6e 7465 7874 2e6f 7074 696f     context.optio
+00003770: 6e73 207c 3d20 7373 6c2e 4f50 5f4e 4f5f  ns |= ssl.OP_NO_
+00003780: 5353 4c76 320a 2020 2020 2020 2020 2020  SSLv2.          
+00003790: 2020 2020 2020 636f 6e74 6578 742e 6f70        context.op
+000037a0: 7469 6f6e 7320 7c3d 2073 736c 2e4f 505f  tions |= ssl.OP_
+000037b0: 4e4f 5f53 534c 7633 0a20 2020 2020 2020  NO_SSLv3.       
+000037c0: 2020 2020 2020 2020 2069 6620 6375 7374           if cust
+000037d0: 6f6d 5f63 6970 6865 7273 2069 7320 6e6f  om_ciphers is no
+000037e0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000037f0: 2020 2020 2020 2020 2020 2020 6375 7374              cust
+00003800: 6f6d 5f63 6970 6865 7273 203d 2075 7469  om_ciphers = uti
+00003810: 6c2e 746f 5f73 7472 696e 6728 6375 7374  l.to_string(cust
+00003820: 6f6d 5f63 6970 6865 7273 292e 7374 7269  om_ciphers).stri
+00003830: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00003840: 2020 2020 2020 2020 6966 2063 7573 746f          if custo
+00003850: 6d5f 6369 7068 6572 7320 213d 2027 2720  m_ciphers != '' 
+00003860: 616e 6420 6861 7361 7474 7228 636f 6e74  and hasattr(cont
+00003870: 6578 742c 2027 7365 745f 6369 7068 6572  ext, 'set_cipher
+00003880: 7327 2920 616e 6420 6361 6c6c 6162 6c65  s') and callable
+00003890: 2863 6f6e 7465 7874 2e73 6574 5f63 6970  (context.set_cip
+000038a0: 6865 7273 293a 0a20 2020 2020 2020 2020  hers):.         
+000038b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000038c0: 6f6e 7465 7874 2e73 6574 5f63 6970 6865  ontext.set_ciphe
+000038d0: 7273 2863 7573 746f 6d5f 6369 7068 6572  rs(custom_cipher
+000038e0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+000038f0: 2020 2069 6620 7365 6c66 2e73 736c 5f76     if self.ssl_v
+00003900: 6572 6966 793a 0a20 2020 2020 2020 2020  erify:.         
+00003910: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+00003920: 7420 5f73 736c 0a20 2020 2020 2020 2020  t _ssl.         
+00003930: 2020 2020 2020 2020 2020 2063 6166 696c             cafil
+00003940: 6520 3d20 7574 696c 2e74 6f5f 7374 7269  e = util.to_stri
+00003950: 6e67 2873 656c 662e 7373 6c5f 7665 7269  ng(self.ssl_veri
+00003960: 6679 290a 2020 2020 2020 2020 2020 2020  fy).            
+00003970: 2020 2020 2020 2020 636f 6e74 6578 742e          context.
+00003980: 6f70 7469 6f6e 7320 7c3d 2067 6574 6174  options |= getat
+00003990: 7472 285f 7373 6c2c 2022 4f50 5f4e 4f5f  tr(_ssl, "OP_NO_
+000039a0: 434f 4d50 5245 5353 494f 4e22 2c20 3029  COMPRESSION", 0)
+000039b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000039c0: 2020 2020 2063 6f6e 7465 7874 2e76 6572       context.ver
+000039d0: 6966 795f 6d6f 6465 203d 2073 736c 2e43  ify_mode = ssl.C
+000039e0: 4552 545f 5245 5155 4952 4544 0a20 2020  ERT_REQUIRED.   
+000039f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a00: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
+00003a10: 6c65 2863 6166 696c 6529 3a0a 2020 2020  le(cafile):.    
+00003a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a30: 2020 2020 636f 6e74 6578 742e 6c6f 6164      context.load
+00003a40: 5f76 6572 6966 795f 6c6f 6361 7469 6f6e  _verify_location
+00003a50: 7328 6361 6669 6c65 290a 2020 2020 2020  s(cafile).      
+00003a60: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00003a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a80: 2020 2020 636f 6e74 6578 742e 7665 7269      context.veri
+00003a90: 6679 5f6d 6f64 6520 3d20 7373 6c2e 4345  fy_mode = ssl.CE
+00003aa0: 5254 5f4e 4f4e 450a 2020 2020 2020 2020  RT_NONE.        
+00003ab0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+00003ac0: 7472 2863 6f6e 7465 7874 2c20 2763 6865  tr(context, 'che
+00003ad0: 636b 5f68 6f73 746e 616d 6527 293a 0a20  ck_hostname'):. 
+00003ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003af0: 2020 2063 6f6e 7465 7874 2e63 6865 636b     context.check
+00003b00: 5f68 6f73 746e 616d 6520 3d20 4661 6c73  _hostname = Fals
+00003b10: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00003b20: 2020 7365 6c66 2e63 6f6e 7465 7874 203d    self.context =
+00003b30: 2063 6f6e 7465 7874 0a20 2020 2020 2020   context.       
+00003b40: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00003b50: 6e3a 0a20 2020 2020 2020 2020 2020 2070  n:.            p
+00003b60: 7269 6e74 2874 7261 6365 6261 636b 2e66  rint(traceback.f
+00003b70: 6f72 6d61 745f 6578 6328 2929 0a0a 2020  ormat_exc())..  
+00003b80: 2020 6465 6620 636c 6f73 6528 7365 6c66    def close(self
+00003b90: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
+00003ba0: 6c66 2e63 6f6e 6e48 6f6c 6465 7220 6973  lf.connHolder is
+00003bb0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00003bc0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+00003bd0: 2e63 6f6e 6e48 6f6c 6465 725b 276c 6f63  .connHolder['loc
+00003be0: 6b27 5d3a 0a20 2020 2020 2020 2020 2020  k']:.           
+00003bf0: 2020 2020 2077 6869 6c65 206e 6f74 2073       while not s
+00003c00: 656c 662e 636f 6e6e 486f 6c64 6572 5b27  elf.connHolder['
+00003c10: 636f 6e6e 5365 7427 5d2e 656d 7074 7928  connSet'].empty(
+00003c20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00003c30: 2020 2020 2020 2063 6f6e 6e20 3d20 7365         conn = se
+00003c40: 6c66 2e63 6f6e 6e48 6f6c 6465 725b 2763  lf.connHolder['c
+00003c50: 6f6e 6e53 6574 275d 2e67 6574 2829 0a20  onnSet'].get(). 
+00003c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c70: 2020 2069 6620 636f 6e6e 2061 6e64 2068     if conn and h
+00003c80: 6173 6174 7472 2863 6f6e 6e2c 2027 636c  asattr(conn, 'cl
+00003c90: 6f73 6527 293a 0a20 2020 2020 2020 2020  ose'):.         
+00003ca0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00003cb0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00003cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003cd0: 636f 6e6e 2e63 6c6f 7365 2829 0a20 2020  conn.close().   
+00003ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003cf0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00003d00: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00003d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d20: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00003d30: 675f 636c 6965 6e74 2e6c 6f67 2857 4152  g_client.log(WAR
+00003d40: 4e49 4e47 2c20 6578 290a 2020 2020 2020  NING, ex).      
+00003d50: 2020 7365 6c66 2e63 6f6e 6e48 6f6c 6465    self.connHolde
+00003d60: 7220 3d20 4e6f 6e65 0a20 2020 2020 2020  r = None.       
+00003d70: 2069 6620 7365 6c66 2e6c 6f67 5f63 6c69   if self.log_cli
+00003d80: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
+00003d90: 2073 656c 662e 6c6f 675f 636c 6965 6e74   self.log_client
+00003da0: 2e63 6c6f 7365 2829 0a0a 2020 2020 6465  .close()..    de
+00003db0: 6620 7265 6672 6573 6828 7365 6c66 2c20  f refresh(self, 
+00003dc0: 6163 6365 7373 5f6b 6579 5f69 642c 2073  access_key_id, s
+00003dd0: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
+00003de0: 2c20 7365 6375 7269 7479 5f74 6f6b 656e  , security_token
+00003df0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00003e00: 7365 6c66 2e73 6563 7572 6974 7950 726f  self.securityPro
+00003e10: 7669 6465 7220 3d20 5f53 6563 7572 6974  vider = _Securit
+00003e20: 7950 726f 7669 6465 7228 6163 6365 7373  yProvider(access
+00003e30: 5f6b 6579 5f69 642c 2073 6563 7265 745f  _key_id, secret_
+00003e40: 6163 6365 7373 5f6b 6579 2c20 7365 6375  access_key, secu
+00003e50: 7269 7479 5f74 6f6b 656e 290a 0a20 2020  rity_token)..   
+00003e60: 2064 6566 2069 6e69 744c 6f67 2873 656c   def initLog(sel
+00003e70: 662c 206c 6f67 5f63 6f6e 6669 673d 4e6f  f, log_config=No
+00003e80: 6e65 2c20 6c6f 675f 6e61 6d65 3d27 4f42  ne, log_name='OB
+00003e90: 535f 4c4f 4747 4552 2729 3a0a 2020 2020  S_LOGGER'):.    
+00003ea0: 2020 2020 6966 206c 6f67 5f63 6f6e 6669      if log_confi
+00003eb0: 673a 0a20 2020 2020 2020 2020 2020 2073  g:.            s
+00003ec0: 656c 662e 6c6f 675f 636c 6965 6e74 203d  elf.log_client =
+00003ed0: 204c 6f67 436c 6965 6e74 286c 6f67 5f63   LogClient(log_c
+00003ee0: 6f6e 6669 672c 2027 4f42 535f 4c4f 4747  onfig, 'OBS_LOGG
+00003ef0: 4552 2720 6966 2063 6f6e 7374 2e49 535f  ER' if const.IS_
+00003f00: 5749 4e44 4f57 5320 656c 7365 206c 6f67  WINDOWS else log
+00003f10: 5f6e 616d 652c 206c 6f67 5f6e 616d 6529  _name, log_name)
+00003f20: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+00003f30: 203d 205b 275b 4f42 5320 5344 4b20 5665   = ['[OBS SDK Ve
+00003f40: 7273 696f 6e3d 2720 2b20 636f 6e73 742e  rsion=' + const.
+00003f50: 4f42 535f 5344 4b5f 5645 5253 494f 4e5d  OBS_SDK_VERSION]
+00003f60: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+00003f70: 2e61 7070 656e 6428 2745 6e64 706f 696e  .append('Endpoin
+00003f80: 743d 2720 2b20 2827 2573 3a2f 2f25 733a  t=' + ('%s://%s:
+00003f90: 2564 2720 2520 2827 6874 7470 7327 2069  %d' % ('https' i
+00003fa0: 6620 7365 6c66 2e69 735f 7365 6375 7265  f self.is_secure
+00003fb0: 2065 6c73 6520 2768 7474 7027 2c20 7365   else 'http', se
+00003fc0: 6c66 2e73 6572 7665 722c 2073 656c 662e  lf.server, self.
+00003fd0: 706f 7274 2929 290a 2020 2020 2020 2020  port))).        
+00003fe0: 2020 2020 6d73 672e 6170 7065 6e64 2827      msg.append('
+00003ff0: 4163 6365 7373 204d 6f64 653d 2720 2b20  Access Mode=' + 
+00004000: 2827 5061 7468 2720 6966 2073 656c 662e  ('Path' if self.
+00004010: 7061 7468 5f73 7479 6c65 2065 6c73 6520  path_style else 
+00004020: 2756 6972 7475 616c 2048 6f73 7469 6e67  'Virtual Hosting
+00004030: 2729 202b 2027 5d27 290a 2020 2020 2020  ') + ']').      
+00004040: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
+00004050: 6c69 656e 742e 6c6f 6728 5741 524e 494e  lient.log(WARNIN
+00004060: 472c 2027 5d3b 5b27 2e6a 6f69 6e28 6d73  G, '];['.join(ms
+00004070: 6729 290a 0a20 2020 2040 7374 6174 6963  g))..    @static
+00004080: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+00004090: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
+000040a0: 7061 7261 6d2c 206d 7367 293a 0a20 2020  param, msg):.   
+000040b0: 2020 2020 2070 6172 616d 203d 2075 7469       param = uti
+000040c0: 6c2e 7361 6665 5f65 6e63 6f64 6528 7061  l.safe_encode(pa
+000040d0: 7261 6d29 0a20 2020 2020 2020 2069 6620  ram).        if 
+000040e0: 7061 7261 6d20 6973 204e 6f6e 6520 6f72  param is None or
+000040f0: 2075 7469 6c2e 746f 5f73 7472 696e 6728   util.to_string(
+00004100: 7061 7261 6d29 2e73 7472 6970 2829 203d  param).strip() =
+00004110: 3d20 2727 3a0a 2020 2020 2020 2020 2020  = '':.          
+00004120: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00004130: 6e28 6d73 6729 0a0a 2020 2020 6465 6620  n(msg)..    def 
+00004140: 5f67 656e 6572 6174 655f 6f62 6a65 6374  _generate_object
+00004150: 5f75 726c 2873 656c 662c 2072 6574 2c20  _url(self, ret, 
+00004160: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
+00004170: 6374 4b65 7929 3a0a 2020 2020 2020 2020  ctKey):.        
+00004180: 6966 2072 6574 2061 6e64 2072 6574 2e73  if ret and ret.s
+00004190: 7461 7475 7320 3c20 3330 3020 616e 6420  tatus < 300 and 
+000041a0: 7265 742e 626f 6479 3a0a 2020 2020 2020  ret.body:.      
+000041b0: 2020 2020 2020 7265 742e 626f 6479 2e6f        ret.body.o
+000041c0: 626a 6563 7455 726c 203d 2073 656c 662e  bjectUrl = self.
+000041d0: 6361 6c6c 696e 675f 666f 726d 6174 2e67  calling_format.g
+000041e0: 6574 5f66 756c 6c5f 7572 6c28 7365 6c66  et_full_url(self
+000041f0: 2e69 735f 7365 6375 7265 2c20 7365 6c66  .is_secure, self
+00004200: 2e73 6572 7665 722c 2073 656c 662e 706f  .server, self.po
+00004210: 7274 2c20 6275 636b 6574 4e61 6d65 2c0a  rt, bucketName,.
+00004220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004230: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00004240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004250: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
-00004260: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-00004270: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004280: 7365 6c66 2e5f 6d61 6b65 5f72 6571 7565  self._make_reque
-00004290: 7374 5f77 6974 685f 7265 7472 7928 636f  st_with_retry(co
-000042a0: 6e73 742e 4854 5450 5f4d 4554 484f 445f  nst.HTTP_METHOD_
-000042b0: 4f50 5449 4f4e 532c 2062 7563 6b65 744e  OPTIONS, bucketN
-000042c0: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-000042d0: 7061 7468 4172 6773 2c20 6865 6164 6572  pathArgs, header
-000042e0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000042f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004310: 6d65 7468 6f64 4e61 6d65 3d6d 6574 686f  methodName=metho
-00004320: 644e 616d 652c 2065 7874 656e 7369 6f6e  dName, extension
-00004330: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-00004340: 6e48 6561 6465 7273 290a 0a20 2020 2064  nHeaders)..    d
-00004350: 6566 205f 6d61 6b65 5f68 6561 645f 7265  ef _make_head_re
-00004360: 7175 6573 7428 7365 6c66 2c20 6275 636b  quest(self, buck
-00004370: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-00004380: 793d 4e6f 6e65 2c20 7061 7468 4172 6773  y=None, pathArgs
-00004390: 3d4e 6f6e 652c 2068 6561 6465 7273 3d4e  =None, headers=N
-000043a0: 6f6e 652c 206d 6574 686f 644e 616d 653d  one, methodName=
-000043b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-000043c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043d0: 2073 6b69 7041 7574 6865 6e74 6963 6174   skipAuthenticat
-000043e0: 696f 6e3d 4661 6c73 652c 2065 7874 656e  ion=False, exten
-000043f0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-00004400: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00004410: 6e20 7365 6c66 2e5f 6d61 6b65 5f72 6571  n self._make_req
-00004420: 7565 7374 5f77 6974 685f 7265 7472 7928  uest_with_retry(
-00004430: 636f 6e73 742e 4854 5450 5f4d 4554 484f  const.HTTP_METHO
-00004440: 445f 4845 4144 2c20 6275 636b 6574 4e61  D_HEAD, bucketNa
-00004450: 6d65 2c20 6f62 6a65 6374 4b65 792c 2070  me, objectKey, p
-00004460: 6174 6841 7267 732c 2068 6561 6465 7273  athArgs, headers
-00004470: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004490: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000044a0: 6574 686f 644e 616d 653d 6d65 7468 6f64  ethodName=method
-000044b0: 4e61 6d65 2c20 736b 6970 4175 7468 656e  Name, skipAuthen
-000044c0: 7469 6361 7469 6f6e 3d73 6b69 7041 7574  tication=skipAut
-000044d0: 6865 6e74 6963 6174 696f 6e2c 0a20 2020  hentication,.   
-000044e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004500: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-00004510: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00004520: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-00004530: 2020 6465 6620 5f6d 616b 655f 6765 745f    def _make_get_
-00004540: 7265 7175 6573 7428 7365 6c66 2c20 6275  request(self, bu
-00004550: 636b 6574 4e61 6d65 3d27 272c 206f 626a  cketName='', obj
-00004560: 6563 744b 6579 3d4e 6f6e 652c 2070 6174  ectKey=None, pat
-00004570: 6841 7267 733d 4e6f 6e65 2c20 6865 6164  hArgs=None, head
-00004580: 6572 733d 4e6f 6e65 2c20 6d65 7468 6f64  ers=None, method
-00004590: 4e61 6d65 3d4e 6f6e 652c 0a20 2020 2020  Name=None,.     
-000045a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000045b0: 2020 2020 2070 6172 7365 4d65 7468 6f64       parseMethod
-000045c0: 3d4e 6f6e 652c 2072 6561 6461 626c 653d  =None, readable=
-000045d0: 4661 6c73 652c 2065 7874 656e 7369 6f6e  False, extension
-000045e0: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
-000045f0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00004600: 6c66 2e5f 6d61 6b65 5f72 6571 7565 7374  lf._make_request
-00004610: 5f77 6974 685f 7265 7472 7928 636f 6e73  _with_retry(cons
-00004620: 742e 4854 5450 5f4d 4554 484f 445f 4745  t.HTTP_METHOD_GE
-00004630: 542c 2062 7563 6b65 744e 616d 652c 206f  T, bucketName, o
-00004640: 626a 6563 744b 6579 2c20 7061 7468 4172  bjectKey, pathAr
-00004650: 6773 2c20 6865 6164 6572 732c 0a20 2020  gs, headers,.   
-00004660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004680: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00004690: 4e61 6d65 3d6d 6574 686f 644e 616d 652c  Name=methodName,
-000046a0: 2070 6172 7365 4d65 7468 6f64 3d70 6172   parseMethod=par
-000046b0: 7365 4d65 7468 6f64 2c20 7265 6164 6162  seMethod, readab
-000046c0: 6c65 3d72 6561 6461 626c 652c 0a20 2020  le=readable,.   
-000046d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046f0: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-00004700: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00004710: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-00004720: 2020 6465 6620 5f6d 616b 655f 6465 6c65    def _make_dele
-00004730: 7465 5f72 6571 7565 7374 2873 656c 662c  te_request(self,
-00004740: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
-00004750: 6563 744b 6579 3d4e 6f6e 652c 2070 6174  ectKey=None, pat
-00004760: 6841 7267 733d 4e6f 6e65 2c20 6865 6164  hArgs=None, head
-00004770: 6572 733d 4e6f 6e65 2c20 656e 7469 7479  ers=None, entity
-00004780: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00004790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047a0: 2020 2020 6d65 7468 6f64 4e61 6d65 3d4e      methodName=N
-000047b0: 6f6e 652c 2065 7874 656e 7369 6f6e 4865  one, extensionHe
-000047c0: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-000047d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000047e0: 2e5f 6d61 6b65 5f72 6571 7565 7374 5f77  ._make_request_w
-000047f0: 6974 685f 7265 7472 7928 636f 6e73 742e  ith_retry(const.
-00004800: 4854 5450 5f4d 4554 484f 445f 4445 4c45  HTTP_METHOD_DELE
-00004810: 5445 2c20 6275 636b 6574 4e61 6d65 2c20  TE, bucketName, 
-00004820: 6f62 6a65 6374 4b65 792c 2070 6174 6841  objectKey, pathA
-00004830: 7267 732c 2068 6561 6465 7273 2c20 656e  rgs, headers, en
-00004840: 7469 7479 2c0a 2020 2020 2020 2020 2020  tity,.          
-00004850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004870: 2020 206d 6574 686f 644e 616d 653d 6d65     methodName=me
-00004880: 7468 6f64 4e61 6d65 2c20 6578 7465 6e73  thodName, extens
-00004890: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-000048a0: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-000048b0: 2020 6465 6620 5f6d 616b 655f 706f 7374    def _make_post
-000048c0: 5f72 6571 7565 7374 2873 656c 662c 2062  _request(self, b
-000048d0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-000048e0: 744b 6579 3d4e 6f6e 652c 2070 6174 6841  tKey=None, pathA
-000048f0: 7267 733d 4e6f 6e65 2c20 6865 6164 6572  rgs=None, header
-00004900: 733d 4e6f 6e65 2c20 656e 7469 7479 3d4e  s=None, entity=N
-00004910: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004930: 6368 756e 6b65 644d 6f64 653d 4661 6c73  chunkedMode=Fals
-00004940: 652c 206d 6574 686f 644e 616d 653d 4e6f  e, methodName=No
-00004950: 6e65 2c20 7265 6164 6162 6c65 3d46 616c  ne, readable=Fal
-00004960: 7365 2c20 6578 7465 6e73 696f 6e48 6561  se, extensionHea
-00004970: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
-00004980: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00004990: 5f6d 616b 655f 7265 7175 6573 745f 7769  _make_request_wi
-000049a0: 7468 5f72 6574 7279 2863 6f6e 7374 2e48  th_retry(const.H
-000049b0: 5454 505f 4d45 5448 4f44 5f50 4f53 542c  TTP_METHOD_POST,
-000049c0: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
-000049d0: 6563 744b 6579 2c20 7061 7468 4172 6773  ectKey, pathArgs
-000049e0: 2c20 6865 6164 6572 732c 2065 6e74 6974  , headers, entit
-000049f0: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-00004a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a20: 6368 756e 6b65 644d 6f64 652c 206d 6574  chunkedMode, met
-00004a30: 686f 644e 616d 653d 6d65 7468 6f64 4e61  hodName=methodNa
-00004a40: 6d65 2c20 7265 6164 6162 6c65 3d72 6561  me, readable=rea
-00004a50: 6461 626c 652c 0a20 2020 2020 2020 2020  dable,.         
-00004a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a80: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
-00004a90: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-00004aa0: 6164 6572 7329 0a0a 2020 2020 6465 6620  aders)..    def 
-00004ab0: 5f6d 616b 655f 7075 745f 7265 7175 6573  _make_put_reques
-00004ac0: 7428 7365 6c66 2c20 6275 636b 6574 4e61  t(self, bucketNa
-00004ad0: 6d65 2c20 6f62 6a65 6374 4b65 793d 4e6f  me, objectKey=No
-00004ae0: 6e65 2c20 7061 7468 4172 6773 3d4e 6f6e  ne, pathArgs=Non
-00004af0: 652c 2068 6561 6465 7273 3d4e 6f6e 652c  e, headers=None,
-00004b00: 2065 6e74 6974 793d 4e6f 6e65 2c20 6368   entity=None, ch
-00004b10: 756e 6b65 644d 6f64 653d 4661 6c73 652c  unkedMode=False,
-00004b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b30: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-00004b40: 644e 616d 653d 4e6f 6e65 2c20 7265 6164  dName=None, read
-00004b50: 6162 6c65 3d46 616c 7365 2c20 6578 7465  able=False, exte
-00004b60: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-00004b70: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
-00004b80: 726e 2073 656c 662e 5f6d 616b 655f 7265  rn self._make_re
-00004b90: 7175 6573 745f 7769 7468 5f72 6574 7279  quest_with_retry
-00004ba0: 2863 6f6e 7374 2e48 5454 505f 4d45 5448  (const.HTTP_METH
-00004bb0: 4f44 5f50 5554 2c20 6275 636b 6574 4e61  OD_PUT, bucketNa
-00004bc0: 6d65 2c20 6f62 6a65 6374 4b65 792c 2070  me, objectKey, p
-00004bd0: 6174 6841 7267 732c 2068 6561 6465 7273  athArgs, headers
-00004be0: 2c20 656e 7469 7479 2c0a 2020 2020 2020  , entity,.      
-00004bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c10: 2020 2020 2020 2063 6875 6e6b 6564 4d6f         chunkedMo
-00004c20: 6465 2c20 6d65 7468 6f64 4e61 6d65 3d6d  de, methodName=m
-00004c30: 6574 686f 644e 616d 652c 2072 6561 6461  ethodName, reada
-00004c40: 626c 653d 7265 6164 6162 6c65 2c0a 2020  ble=readable,.  
-00004c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c70: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-00004c80: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-00004c90: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
-00004ca0: 2020 2064 6566 205f 6d61 6b65 5f65 7272     def _make_err
-00004cb0: 6f72 5f72 6573 756c 7428 7365 6c66 2c20  or_result(self, 
-00004cc0: 652c 2072 6574 293a 0a20 2020 2020 2020  e, ret):.       
-00004cd0: 2073 656c 662e 6c6f 675f 636c 6965 6e74   self.log_client
-00004ce0: 2e6c 6f67 2845 5252 4f52 2c20 2772 6571  .log(ERROR, 'req
-00004cf0: 7565 7374 2065 7272 6f72 2c20 2573 2720  uest error, %s' 
-00004d00: 2520 6529 0a20 2020 2020 2020 2073 656c  % e).        sel
-00004d10: 662e 6c6f 675f 636c 6965 6e74 2e6c 6f67  f.log_client.log
-00004d20: 2845 5252 4f52 2c20 7472 6163 6562 6163  (ERROR, tracebac
-00004d30: 6b2e 666f 726d 6174 5f65 7863 2829 290a  k.format_exc()).
-00004d40: 2020 2020 2020 2020 6966 2072 6574 2069          if ret i
-00004d50: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00004d60: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00004d70: 6574 0a20 2020 2020 2020 2072 6169 7365  et.        raise
-00004d80: 2065 0a0a 2020 2020 6465 6620 5f6d 616b   e..    def _mak
-00004d90: 655f 7265 7175 6573 745f 7769 7468 5f72  e_request_with_r
-00004da0: 6574 7279 2873 656c 662c 206d 6574 686f  etry(self, metho
-00004db0: 6454 7970 652c 2062 7563 6b65 744e 616d  dType, bucketNam
-00004dc0: 652c 206f 626a 6563 744b 6579 3d4e 6f6e  e, objectKey=Non
-00004dd0: 652c 2070 6174 6841 7267 733d 4e6f 6e65  e, pathArgs=None
-00004de0: 2c20 6865 6164 6572 733d 4e6f 6e65 2c0a  , headers=None,.
-00004df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e10: 2065 6e74 6974 793d 4e6f 6e65 2c20 6368   entity=None, ch
-00004e20: 756e 6b65 644d 6f64 653d 4661 6c73 652c  unkedMode=False,
-00004e30: 206d 6574 686f 644e 616d 653d 4e6f 6e65   methodName=None
-00004e40: 2c20 7265 6164 6162 6c65 3d46 616c 7365  , readable=False
-00004e50: 2c20 7061 7273 654d 6574 686f 643d 4e6f  , parseMethod=No
-00004e60: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00004e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e80: 2020 2020 2072 6564 6972 6563 744c 6f63       redirectLoc
-00004e90: 6174 696f 6e3d 4e6f 6e65 2c20 736b 6970  ation=None, skip
-00004ea0: 4175 7468 656e 7469 6361 7469 6f6e 3d46  Authentication=F
-00004eb0: 616c 7365 2c20 6578 7465 6e73 696f 6e48  alse, extensionH
-00004ec0: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-00004ed0: 2020 2020 2020 666c 6167 203d 2030 0a20        flag = 0. 
-00004ee0: 2020 2020 2020 2072 6564 6972 6563 745f         redirect_
-00004ef0: 636f 756e 7420 3d20 300a 2020 2020 2020  count = 0.      
-00004f00: 2020 636f 6e6e 203d 204e 6f6e 650a 2020    conn = None.  
-00004f10: 2020 2020 2020 5f72 6564 6972 6563 744c        _redirectL
-00004f20: 6f63 6174 696f 6e20 3d20 7265 6469 7265  ocation = redire
-00004f30: 6374 4c6f 6361 7469 6f6e 0a20 2020 2020  ctLocation.     
-00004f40: 2020 2072 6564 6972 6563 7446 6c61 6720     redirectFlag 
-00004f50: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00004f60: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
-00004f70: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00004f80: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00004f90: 6e20 3d20 7365 6c66 2e5f 6d61 6b65 5f72  n = self._make_r
-00004fa0: 6571 7565 7374 5f69 6e74 6572 6e61 6c28  equest_internal(
-00004fb0: 6d65 7468 6f64 5479 7065 2c20 6275 636b  methodType, buck
-00004fc0: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-00004fd0: 792c 2070 6174 6841 7267 732c 2068 6561  y, pathArgs, hea
-00004fe0: 6465 7273 2c20 656e 7469 7479 2c0a 2020  ders, entity,.  
-00004ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005020: 2063 6875 6e6b 6564 4d6f 6465 2c20 5f72   chunkedMode, _r
-00005030: 6564 6972 6563 744c 6f63 6174 696f 6e2c  edirectLocation,
-00005040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005070: 2020 2020 736b 6970 4175 7468 656e 7469      skipAuthenti
-00005080: 6361 7469 6f6e 3d73 6b69 7041 7574 6865  cation=skipAuthe
-00005090: 6e74 6963 6174 696f 6e2c 2072 6564 6972  ntication, redir
-000050a0: 6563 7446 6c61 673d 7265 6469 7265 6374  ectFlag=redirect
-000050b0: 466c 6167 2c0a 2020 2020 2020 2020 2020  Flag,.          
-000050c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050e0: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
-000050f0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-00005100: 696f 6e48 6561 6465 7273 290a 2020 2020  ionHeaders).    
-00005110: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00005120: 726e 2073 656c 662e 5f70 6172 7365 5f78  rn self._parse_x
-00005130: 6d6c 2863 6f6e 6e2c 206d 6574 686f 644e  ml(conn, methodN
-00005140: 616d 652c 2072 6561 6461 626c 6529 2069  ame, readable) i
-00005150: 6620 6e6f 7420 7061 7273 654d 6574 686f  f not parseMetho
-00005160: 6420 656c 7365 2070 6172 7365 4d65 7468  d else parseMeth
-00005170: 6f64 2863 6f6e 6e29 0a20 2020 2020 2020  od(conn).       
-00005180: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00005190: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-000051a0: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
-000051b0: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
-000051c0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000051d0: 7461 6e63 6528 652c 205f 496e 7465 726e  tance(e, _Intern
-000051e0: 616c 4578 6365 7074 696f 6e29 3a0a 2020  alException):.  
-000051f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005200: 2020 7265 7420 3d20 652e 7265 7375 6c74    ret = e.result
-00005210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005220: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00005230: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-00005240: 636c 6f73 655f 636f 6e6e 2863 6f6e 6e2c  close_conn(conn,
-00005250: 2073 656c 662e 6c6f 675f 636c 6965 6e74   self.log_client
-00005260: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005270: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00005280: 6e63 6528 652c 205f 5265 6469 7265 6374  nce(e, _Redirect
-00005290: 4578 6365 7074 696f 6e29 3a0a 2020 2020  Exception):.    
-000052a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052b0: 2020 2020 7265 6469 7265 6374 5f63 6f75      redirect_cou
-000052c0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
+00004250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004260: 2020 6f62 6a65 6374 4b65 792c 207b 7d29    objectKey, {})
+00004270: 0a0a 2020 2020 6465 6620 5f6d 616b 655f  ..    def _make_
+00004280: 6f70 7469 6f6e 735f 7265 7175 6573 7428  options_request(
+00004290: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+000042a0: 2c20 6f62 6a65 6374 4b65 793d 4e6f 6e65  , objectKey=None
+000042b0: 2c20 7061 7468 4172 6773 3d4e 6f6e 652c  , pathArgs=None,
+000042c0: 2068 6561 6465 7273 3d4e 6f6e 652c 206d   headers=None, m
+000042d0: 6574 686f 644e 616d 653d 4e6f 6e65 2c0a  ethodName=None,.
+000042e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000042f0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00004300: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+00004310: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
+00004320: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+00004330: 7265 7175 6573 745f 7769 7468 5f72 6574  request_with_ret
+00004340: 7279 2863 6f6e 7374 2e48 5454 505f 4d45  ry(const.HTTP_ME
+00004350: 5448 4f44 5f4f 5054 494f 4e53 2c20 6275  THOD_OPTIONS, bu
+00004360: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
+00004370: 4b65 792c 2070 6174 6841 7267 732c 2068  Key, pathArgs, h
+00004380: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
+00004390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043b0: 2020 2020 206d 6574 686f 644e 616d 653d       methodName=
+000043c0: 6d65 7468 6f64 4e61 6d65 2c20 6578 7465  methodName, exte
+000043d0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+000043e0: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+000043f0: 2020 2020 6465 6620 5f6d 616b 655f 6865      def _make_he
+00004400: 6164 5f72 6571 7565 7374 2873 656c 662c  ad_request(self,
+00004410: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
+00004420: 6563 744b 6579 3d4e 6f6e 652c 2070 6174  ectKey=None, pat
+00004430: 6841 7267 733d 4e6f 6e65 2c20 6865 6164  hArgs=None, head
+00004440: 6572 733d 4e6f 6e65 2c20 6d65 7468 6f64  ers=None, method
+00004450: 4e61 6d65 3d4e 6f6e 652c 0a20 2020 2020  Name=None,.     
+00004460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004470: 2020 2020 2020 736b 6970 4175 7468 656e        skipAuthen
+00004480: 7469 6361 7469 6f6e 3d46 616c 7365 2c20  tication=False, 
+00004490: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+000044a0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+000044b0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
+000044c0: 655f 7265 7175 6573 745f 7769 7468 5f72  e_request_with_r
+000044d0: 6574 7279 2863 6f6e 7374 2e48 5454 505f  etry(const.HTTP_
+000044e0: 4d45 5448 4f44 5f48 4541 442c 2062 7563  METHOD_HEAD, buc
+000044f0: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+00004500: 6579 2c20 7061 7468 4172 6773 2c20 6865  ey, pathArgs, he
+00004510: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
+00004520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004540: 2020 2020 6d65 7468 6f64 4e61 6d65 3d6d      methodName=m
+00004550: 6574 686f 644e 616d 652c 2073 6b69 7041  ethodName, skipA
+00004560: 7574 6865 6e74 6963 6174 696f 6e3d 736b  uthentication=sk
+00004570: 6970 4175 7468 656e 7469 6361 7469 6f6e  ipAuthentication
+00004580: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000045b0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+000045c0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+000045d0: 290a 0a20 2020 2064 6566 205f 6d61 6b65  )..    def _make
+000045e0: 5f67 6574 5f72 6571 7565 7374 2873 656c  _get_request(sel
+000045f0: 662c 2062 7563 6b65 744e 616d 653d 2727  f, bucketName=''
+00004600: 2c20 6f62 6a65 6374 4b65 793d 4e6f 6e65  , objectKey=None
+00004610: 2c20 7061 7468 4172 6773 3d4e 6f6e 652c  , pathArgs=None,
+00004620: 2068 6561 6465 7273 3d4e 6f6e 652c 206d   headers=None, m
+00004630: 6574 686f 644e 616d 653d 4e6f 6e65 2c0a  ethodName=None,.
+00004640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004650: 2020 2020 2020 2020 2020 7061 7273 654d            parseM
+00004660: 6574 686f 643d 4e6f 6e65 2c20 7265 6164  ethod=None, read
+00004670: 6162 6c65 3d46 616c 7365 2c20 6578 7465  able=False, exte
+00004680: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+00004690: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+000046a0: 726e 2073 656c 662e 5f6d 616b 655f 7265  rn self._make_re
+000046b0: 7175 6573 745f 7769 7468 5f72 6574 7279  quest_with_retry
+000046c0: 2863 6f6e 7374 2e48 5454 505f 4d45 5448  (const.HTTP_METH
+000046d0: 4f44 5f47 4554 2c20 6275 636b 6574 4e61  OD_GET, bucketNa
+000046e0: 6d65 2c20 6f62 6a65 6374 4b65 792c 2070  me, objectKey, p
+000046f0: 6174 6841 7267 732c 2068 6561 6465 7273  athArgs, headers
+00004700: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004720: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00004730: 6574 686f 644e 616d 653d 6d65 7468 6f64  ethodName=method
+00004740: 4e61 6d65 2c20 7061 7273 654d 6574 686f  Name, parseMetho
+00004750: 643d 7061 7273 654d 6574 686f 642c 2072  d=parseMethod, r
+00004760: 6561 6461 626c 653d 7265 6164 6162 6c65  eadable=readable
+00004770: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004790: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000047a0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+000047b0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+000047c0: 290a 0a20 2020 2064 6566 205f 6d61 6b65  )..    def _make
+000047d0: 5f64 656c 6574 655f 7265 7175 6573 7428  _delete_request(
+000047e0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+000047f0: 2c20 6f62 6a65 6374 4b65 793d 4e6f 6e65  , objectKey=None
+00004800: 2c20 7061 7468 4172 6773 3d4e 6f6e 652c  , pathArgs=None,
+00004810: 2068 6561 6465 7273 3d4e 6f6e 652c 2065   headers=None, e
+00004820: 6e74 6974 793d 4e6f 6e65 2c0a 2020 2020  ntity=None,.    
+00004830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004840: 2020 2020 2020 2020 206d 6574 686f 644e           methodN
+00004850: 616d 653d 4e6f 6e65 2c20 6578 7465 6e73  ame=None, extens
+00004860: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+00004870: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00004880: 2073 656c 662e 5f6d 616b 655f 7265 7175   self._make_requ
+00004890: 6573 745f 7769 7468 5f72 6574 7279 2863  est_with_retry(c
+000048a0: 6f6e 7374 2e48 5454 505f 4d45 5448 4f44  onst.HTTP_METHOD
+000048b0: 5f44 454c 4554 452c 2062 7563 6b65 744e  _DELETE, bucketN
+000048c0: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+000048d0: 7061 7468 4172 6773 2c20 6865 6164 6572  pathArgs, header
+000048e0: 732c 2065 6e74 6974 792c 0a20 2020 2020  s, entity,.     
+000048f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004910: 2020 2020 2020 2020 6d65 7468 6f64 4e61          methodNa
+00004920: 6d65 3d6d 6574 686f 644e 616d 652c 2065  me=methodName, e
+00004930: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+00004940: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00004950: 290a 0a20 2020 2064 6566 205f 6d61 6b65  )..    def _make
+00004960: 5f70 6f73 745f 7265 7175 6573 7428 7365  _post_request(se
+00004970: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
+00004980: 6f62 6a65 6374 4b65 793d 4e6f 6e65 2c20  objectKey=None, 
+00004990: 7061 7468 4172 6773 3d4e 6f6e 652c 2068  pathArgs=None, h
+000049a0: 6561 6465 7273 3d4e 6f6e 652c 2065 6e74  eaders=None, ent
+000049b0: 6974 793d 4e6f 6e65 2c0a 2020 2020 2020  ity=None,.      
+000049c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049d0: 2020 2020 2063 6875 6e6b 6564 4d6f 6465       chunkedMode
+000049e0: 3d46 616c 7365 2c20 6d65 7468 6f64 4e61  =False, methodNa
+000049f0: 6d65 3d4e 6f6e 652c 2072 6561 6461 626c  me=None, readabl
+00004a00: 653d 4661 6c73 652c 2065 7874 656e 7369  e=False, extensi
+00004a10: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
+00004a20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00004a30: 7365 6c66 2e5f 6d61 6b65 5f72 6571 7565  self._make_reque
+00004a40: 7374 5f77 6974 685f 7265 7472 7928 636f  st_with_retry(co
+00004a50: 6e73 742e 4854 5450 5f4d 4554 484f 445f  nst.HTTP_METHOD_
+00004a60: 504f 5354 2c20 6275 636b 6574 4e61 6d65  POST, bucketName
+00004a70: 2c20 6f62 6a65 6374 4b65 792c 2070 6174  , objectKey, pat
+00004a80: 6841 7267 732c 2068 6561 6465 7273 2c20  hArgs, headers, 
+00004a90: 656e 7469 7479 2c0a 2020 2020 2020 2020  entity,.        
+00004aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ac0: 2020 2020 2063 6875 6e6b 6564 4d6f 6465       chunkedMode
+00004ad0: 2c20 6d65 7468 6f64 4e61 6d65 3d6d 6574  , methodName=met
+00004ae0: 686f 644e 616d 652c 2072 6561 6461 626c  hodName, readabl
+00004af0: 653d 7265 6164 6162 6c65 2c0a 2020 2020  e=readable,.    
+00004b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b20: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+00004b30: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+00004b40: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
+00004b50: 2064 6566 205f 6d61 6b65 5f70 7574 5f72   def _make_put_r
+00004b60: 6571 7565 7374 2873 656c 662c 2062 7563  equest(self, buc
+00004b70: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+00004b80: 6579 3d4e 6f6e 652c 2070 6174 6841 7267  ey=None, pathArg
+00004b90: 733d 4e6f 6e65 2c20 6865 6164 6572 733d  s=None, headers=
+00004ba0: 4e6f 6e65 2c20 656e 7469 7479 3d4e 6f6e  None, entity=Non
+00004bb0: 652c 2063 6875 6e6b 6564 4d6f 6465 3d46  e, chunkedMode=F
+00004bc0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00004bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004be0: 6d65 7468 6f64 4e61 6d65 3d4e 6f6e 652c  methodName=None,
+00004bf0: 2072 6561 6461 626c 653d 4661 6c73 652c   readable=False,
+00004c00: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+00004c10: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+00004c20: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+00004c30: 6b65 5f72 6571 7565 7374 5f77 6974 685f  ke_request_with_
+00004c40: 7265 7472 7928 636f 6e73 742e 4854 5450  retry(const.HTTP
+00004c50: 5f4d 4554 484f 445f 5055 542c 2062 7563  _METHOD_PUT, buc
+00004c60: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+00004c70: 6579 2c20 7061 7468 4172 6773 2c20 6865  ey, pathArgs, he
+00004c80: 6164 6572 732c 2065 6e74 6974 792c 0a20  aders, entity,. 
+00004c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cb0: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+00004cc0: 6b65 644d 6f64 652c 206d 6574 686f 644e  kedMode, methodN
+00004cd0: 616d 653d 6d65 7468 6f64 4e61 6d65 2c20  ame=methodName, 
+00004ce0: 7265 6164 6162 6c65 3d72 6561 6461 626c  readable=readabl
+00004cf0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d20: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00004d30: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+00004d40: 7329 0a0a 2020 2020 6465 6620 5f6d 616b  s)..    def _mak
+00004d50: 655f 6572 726f 725f 7265 7375 6c74 2873  e_error_result(s
+00004d60: 656c 662c 2065 2c20 7265 7429 3a0a 2020  elf, e, ret):.  
+00004d70: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
+00004d80: 6c69 656e 742e 6c6f 6728 4552 524f 522c  lient.log(ERROR,
+00004d90: 2027 7265 7175 6573 7420 6572 726f 722c   'request error,
+00004da0: 2025 7327 2025 2065 290a 2020 2020 2020   %s' % e).      
+00004db0: 2020 7365 6c66 2e6c 6f67 5f63 6c69 656e    self.log_clien
+00004dc0: 742e 6c6f 6728 4552 524f 522c 2074 7261  t.log(ERROR, tra
+00004dd0: 6365 6261 636b 2e66 6f72 6d61 745f 6578  ceback.format_ex
+00004de0: 6328 2929 0a20 2020 2020 2020 2069 6620  c()).        if 
+00004df0: 7265 7420 6973 206e 6f74 204e 6f6e 653a  ret is not None:
+00004e00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00004e10: 7572 6e20 7265 740a 2020 2020 2020 2020  urn ret.        
+00004e20: 7261 6973 6520 650a 0a20 2020 2064 6566  raise e..    def
+00004e30: 205f 6d61 6b65 5f72 6571 7565 7374 5f77   _make_request_w
+00004e40: 6974 685f 7265 7472 7928 7365 6c66 2c20  ith_retry(self, 
+00004e50: 6d65 7468 6f64 5479 7065 2c20 6275 636b  methodType, buck
+00004e60: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
+00004e70: 793d 4e6f 6e65 2c20 7061 7468 4172 6773  y=None, pathArgs
+00004e80: 3d4e 6f6e 652c 2068 6561 6465 7273 3d4e  =None, headers=N
+00004e90: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00004ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004eb0: 2020 2020 2020 656e 7469 7479 3d4e 6f6e        entity=Non
+00004ec0: 652c 2063 6875 6e6b 6564 4d6f 6465 3d46  e, chunkedMode=F
+00004ed0: 616c 7365 2c20 6d65 7468 6f64 4e61 6d65  alse, methodName
+00004ee0: 3d4e 6f6e 652c 2072 6561 6461 626c 653d  =None, readable=
+00004ef0: 4661 6c73 652c 2070 6172 7365 4d65 7468  False, parseMeth
+00004f00: 6f64 3d4e 6f6e 652c 0a20 2020 2020 2020  od=None,.       
+00004f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f20: 2020 2020 2020 2020 2020 7265 6469 7265            redire
+00004f30: 6374 4c6f 6361 7469 6f6e 3d4e 6f6e 652c  ctLocation=None,
+00004f40: 2073 6b69 7041 7574 6865 6e74 6963 6174   skipAuthenticat
+00004f50: 696f 6e3d 4661 6c73 652c 2065 7874 656e  ion=False, exten
+00004f60: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+00004f70: 293a 0a20 2020 2020 2020 2066 6c61 6720  ):.        flag 
+00004f80: 3d20 300a 2020 2020 2020 2020 7265 6469  = 0.        redi
+00004f90: 7265 6374 5f63 6f75 6e74 203d 2030 0a20  rect_count = 0. 
+00004fa0: 2020 2020 2020 2063 6f6e 6e20 3d20 4e6f         conn = No
+00004fb0: 6e65 0a20 2020 2020 2020 205f 7265 6469  ne.        _redi
+00004fc0: 7265 6374 4c6f 6361 7469 6f6e 203d 2072  rectLocation = r
+00004fd0: 6564 6972 6563 744c 6f63 6174 696f 6e0a  edirectLocation.
+00004fe0: 2020 2020 2020 2020 7265 6469 7265 6374          redirect
+00004ff0: 466c 6167 203d 2046 616c 7365 0a20 2020  Flag = False.   
+00005000: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+00005010: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00005020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005030: 2020 636f 6e6e 203d 2073 656c 662e 5f6d    conn = self._m
+00005040: 616b 655f 7265 7175 6573 745f 696e 7465  ake_request_inte
+00005050: 726e 616c 286d 6574 686f 6454 7970 652c  rnal(methodType,
+00005060: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
+00005070: 6563 744b 6579 2c20 7061 7468 4172 6773  ectKey, pathArgs
+00005080: 2c20 6865 6164 6572 732c 2065 6e74 6974  , headers, entit
+00005090: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+000050a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000050b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000050c0: 2020 2020 2020 6368 756e 6b65 644d 6f64        chunkedMod
+000050d0: 652c 205f 7265 6469 7265 6374 4c6f 6361  e, _redirectLoca
+000050e0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+000050f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005110: 2020 2020 2020 2020 2073 6b69 7041 7574           skipAut
+00005120: 6865 6e74 6963 6174 696f 6e3d 736b 6970  hentication=skip
+00005130: 4175 7468 656e 7469 6361 7469 6f6e 2c20  Authentication, 
+00005140: 7265 6469 7265 6374 466c 6167 3d72 6564  redirectFlag=red
+00005150: 6972 6563 7446 6c61 672c 0a20 2020 2020  irectFlag,.     
+00005160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005180: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00005190: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+000051a0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+000051b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000051c0: 2072 6574 7572 6e20 7365 6c66 2e5f 7061   return self._pa
+000051d0: 7273 655f 786d 6c28 636f 6e6e 2c20 6d65  rse_xml(conn, me
+000051e0: 7468 6f64 4e61 6d65 2c20 7265 6164 6162  thodName, readab
+000051f0: 6c65 2920 6966 206e 6f74 2070 6172 7365  le) if not parse
+00005200: 4d65 7468 6f64 2065 6c73 6520 7061 7273  Method else pars
+00005210: 654d 6574 686f 6428 636f 6e6e 290a 2020  eMethod(conn).  
+00005220: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00005230: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00005240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005250: 2072 6574 203d 204e 6f6e 650a 0a20 2020   ret = None..   
+00005260: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00005270: 6973 696e 7374 616e 6365 2865 2c20 5f49  isinstance(e, _I
+00005280: 6e74 6572 6e61 6c45 7863 6570 7469 6f6e  nternalException
+00005290: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000052a0: 2020 2020 2020 2072 6574 203d 2065 2e72         ret = e.r
+000052b0: 6573 756c 740a 2020 2020 2020 2020 2020  esult.          
+000052c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
 000052d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052e0: 5f72 6564 6972 6563 744c 6f63 6174 696f  _redirectLocatio
-000052f0: 6e20 3d20 652e 6c6f 6361 7469 6f6e 0a20  n = e.location. 
-00005300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005310: 2020 2020 2020 2066 6c61 6720 2d3d 2031         flag -= 1
-00005320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005330: 2020 2020 2020 2020 2072 6574 203d 2065           ret = e
-00005340: 2e72 6573 756c 740a 2020 2020 2020 2020  .result.        
-00005350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005360: 6966 206d 6574 686f 6454 7970 6520 3d3d  if methodType ==
-00005370: 2063 6f6e 7374 2e48 5454 505f 4d45 5448   const.HTTP_METH
-00005380: 4f44 5f47 4554 2061 6e64 2065 2e72 6573  OD_GET and e.res
-00005390: 756c 742e 7374 6174 7573 203d 3d20 3330  ult.status == 30
-000053a0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-000053b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000053c0: 6564 6972 6563 7446 6c61 6720 3d20 5472  edirectFlag = Tr
-000053d0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-000053e0: 2020 2069 6620 7265 6469 7265 6374 5f63     if redirect_c
-000053f0: 6f75 6e74 203e 3d20 7365 6c66 2e6d 6178  ount >= self.max
-00005400: 5f72 6564 6972 6563 745f 636f 756e 743a  _redirect_count:
-00005410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005420: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
-00005430: 6965 6e74 2e6c 6f67 2845 5252 4f52 2c20  ient.log(ERROR, 
-00005440: 2772 6571 7565 7374 2072 6564 6972 6563  'request redirec
-00005450: 7420 636f 756e 7420 5b25 645d 2067 7265  t count [%d] gre
-00005460: 6174 6572 2074 6861 6e20 6d61 7820 7265  ater than max re
-00005470: 6469 7265 6374 2063 6f75 6e74 205b 2564  direct count [%d
-00005480: 5d27 2025 2028 0a20 2020 2020 2020 2020  ]' % (.         
-00005490: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000054a0: 6564 6972 6563 745f 636f 756e 742c 2073  edirect_count, s
-000054b0: 656c 662e 6d61 785f 7265 6469 7265 6374  elf.max_redirect
-000054c0: 5f63 6f75 6e74 2929 0a20 2020 2020 2020  _count)).       
-000054d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000054e0: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f65  urn self._make_e
-000054f0: 7272 6f72 5f72 6573 756c 7428 652c 2072  rror_result(e, r
-00005500: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
-00005510: 2020 2020 6966 2066 6c61 6720 3e3d 2073      if flag >= s
-00005520: 656c 662e 6d61 785f 7265 7472 795f 636f  elf.max_retry_co
-00005530: 756e 7420 6f72 2072 6561 6461 626c 653a  unt or readable:
-00005540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005550: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00005560: 2e5f 6d61 6b65 5f65 7272 6f72 5f72 6573  ._make_error_res
-00005570: 756c 7428 652c 2072 6574 290a 2020 2020  ult(e, ret).    
-00005580: 2020 2020 2020 2020 2020 2020 666c 6167              flag
-00005590: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-000055a0: 2020 2020 2020 7469 6d65 2e73 6c65 6570        time.sleep
-000055b0: 286d 6174 682e 706f 7728 322c 2066 6c61  (math.pow(2, fla
-000055c0: 6729 202a 2030 2e30 3529 0a20 2020 2020  g) * 0.05).     
-000055d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000055e0: 6c6f 675f 636c 6965 6e74 2e6c 6f67 2857  log_client.log(W
-000055f0: 4152 4e49 4e47 2c20 2772 6571 7565 7374  ARNING, 'request
-00005600: 2061 6761 696e 2c20 7469 6d65 3a25 6427   again, time:%d'
-00005610: 2025 2069 6e74 2866 6c61 6729 290a 2020   % int(flag)).  
-00005620: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00005630: 6e74 696e 7565 0a0a 2020 2020 6465 6620  ntinue..    def 
-00005640: 5f6d 616b 655f 7265 7175 6573 745f 696e  _make_request_in
-00005650: 7465 726e 616c 2873 656c 662c 206d 6574  ternal(self, met
-00005660: 686f 642c 2062 7563 6b65 744e 616d 653d  hod, bucketName=
-00005670: 2727 2c20 6f62 6a65 6374 4b65 793d 4e6f  '', objectKey=No
-00005680: 6e65 2c20 7061 7468 4172 6773 3d4e 6f6e  ne, pathArgs=Non
-00005690: 652c 2068 6561 6465 7273 3d4e 6f6e 652c  e, headers=None,
-000056a0: 2065 6e74 6974 793d 4e6f 6e65 2c0a 2020   entity=None,.  
-000056b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056c0: 2020 2020 2020 2020 2020 2020 2063 6875               chu
-000056d0: 6e6b 6564 4d6f 6465 3d46 616c 7365 2c20  nkedMode=False, 
-000056e0: 7265 6469 7265 6374 4c6f 6361 7469 6f6e  redirectLocation
-000056f0: 3d4e 6f6e 652c 2073 6b69 7041 7574 6865  =None, skipAuthe
-00005700: 6e74 6963 6174 696f 6e3d 4661 6c73 652c  ntication=False,
-00005710: 2072 6564 6972 6563 7446 6c61 673d 4661   redirectFlag=Fa
-00005720: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00005730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005740: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
-00005750: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
-00005760: 2020 2020 6f62 6a65 6374 4b65 7920 3d20      objectKey = 
-00005770: 7574 696c 2e73 6166 655f 656e 636f 6465  util.safe_encode
-00005780: 286f 626a 6563 744b 6579 290a 2020 2020  (objectKey).    
-00005790: 2020 2020 6966 206f 626a 6563 744b 6579      if objectKey
-000057a0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000057b0: 2020 2020 2020 6f62 6a65 6374 4b65 7920        objectKey 
-000057c0: 3d20 2727 0a20 2020 2020 2020 2070 6f72  = ''.        por
-000057d0: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-000057e0: 2073 6368 656d 6520 3d20 4e6f 6e65 0a20   scheme = None. 
-000057f0: 2020 2020 2020 2070 6174 6820 3d20 4e6f         path = No
-00005800: 6e65 0a20 2020 2020 2020 2069 6620 7265  ne.        if re
-00005810: 6469 7265 6374 4c6f 6361 7469 6f6e 3a0a  directLocation:.
-00005820: 2020 2020 2020 2020 2020 2020 7265 6469              redi
-00005830: 7265 6374 4c6f 6361 7469 6f6e 203d 2075  rectLocation = u
-00005840: 726c 7061 7273 6528 7265 6469 7265 6374  rlparse(redirect
-00005850: 4c6f 6361 7469 6f6e 290a 2020 2020 2020  Location).      
-00005860: 2020 2020 2020 636f 6e6e 6563 745f 7365        connect_se
-00005870: 7276 6572 203d 2072 6564 6972 6563 744c  rver = redirectL
-00005880: 6f63 6174 696f 6e2e 686f 7374 6e61 6d65  ocation.hostname
-00005890: 0a20 2020 2020 2020 2020 2020 2073 6368  .            sch
-000058a0: 656d 6520 3d20 7265 6469 7265 6374 4c6f  eme = redirectLo
-000058b0: 6361 7469 6f6e 2e73 6368 656d 650a 2020  cation.scheme.  
-000058c0: 2020 2020 2020 2020 2020 706f 7274 203d            port =
-000058d0: 2073 656c 662e 5f70 6172 7365 5f70 6f72   self._parse_por
-000058e0: 7428 7265 6469 7265 6374 4c6f 6361 7469  t(redirectLocati
-000058f0: 6f6e 2e70 6f72 742c 2073 6368 656d 652e  on.port, scheme.
-00005900: 6c6f 7765 7228 2920 3d3d 2027 6874 7470  lower() == 'http
-00005910: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-00005920: 7265 6469 7265 6374 203d 2054 7275 650a  redirect = True.
-00005930: 2020 2020 2020 2020 2020 2020 5f70 6174              _pat
-00005940: 6820 3d20 7265 6469 7265 6374 4c6f 6361  h = redirectLoca
-00005950: 7469 6f6e 2e70 6174 680a 2020 2020 2020  tion.path.      
-00005960: 2020 2020 2020 7175 6572 7920 3d20 7265        query = re
-00005970: 6469 7265 6374 4c6f 6361 7469 6f6e 2e71  directLocation.q
-00005980: 7565 7279 0a20 2020 2020 2020 2020 2020  uery.           
-00005990: 2070 6174 6820 3d20 5f70 6174 6820 2b20   path = _path + 
-000059a0: 273f 2720 2b20 7175 6572 7920 6966 2071  '?' + query if q
-000059b0: 7565 7279 2065 6c73 6520 5f70 6174 680a  uery else _path.
-000059c0: 2020 2020 2020 2020 2020 2020 736b 6970              skip
-000059d0: 4175 7468 656e 7469 6361 7469 6f6e 203d  Authentication =
-000059e0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-000059f0: 2020 6966 206e 6f74 2072 6564 6972 6563    if not redirec
-00005a00: 7446 6c61 673a 0a20 2020 2020 2020 2020  tFlag:.         
-00005a10: 2020 2020 2020 2073 6b69 7041 7574 6865         skipAuthe
-00005a20: 6e74 6963 6174 696f 6e20 3d20 4661 6c73  ntication = Fals
-00005a30: 650a 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
-00005a40: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00005a50: 6e65 6374 5f73 6572 7665 7220 3d20 7365  nect_server = se
-00005a60: 6c66 2e73 6572 7665 7220 6966 2073 656c  lf.server if sel
-00005a70: 662e 6973 5f63 6e61 6d65 2065 6c73 6520  f.is_cname else 
-00005a80: 7365 6c66 2e63 616c 6c69 6e67 5f66 6f72  self.calling_for
-00005a90: 6d61 742e 6765 745f 7365 7276 6572 2873  mat.get_server(s
-00005aa0: 656c 662e 7365 7276 6572 2c20 6275 636b  elf.server, buck
-00005ab0: 6574 4e61 6d65 290a 2020 2020 2020 2020  etName).        
-00005ac0: 2020 2020 7265 6469 7265 6374 203d 2046      redirect = F
-00005ad0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00005ae0: 2070 6f72 7420 3d20 7365 6c66 2e70 6f72   port = self.por
-00005af0: 740a 0a20 2020 2020 2020 2069 6620 7365  t..        if se
-00005b00: 6c66 2e69 735f 636e 616d 653a 0a20 2020  lf.is_cname:.   
-00005b10: 2020 2020 2020 2020 2062 7563 6b65 744e           bucketN
-00005b20: 616d 6520 3d20 2727 0a0a 2020 2020 2020  ame = ''..      
-00005b30: 2020 6966 206e 6f74 2070 6174 683a 0a20    if not path:. 
-00005b40: 2020 2020 2020 2020 2020 2070 6174 6820             path 
-00005b50: 3d20 7365 6c66 2e63 616c 6c69 6e67 5f66  = self.calling_f
-00005b60: 6f72 6d61 742e 6765 745f 7572 6c28 6275  ormat.get_url(bu
-00005b70: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-00005b80: 4b65 792c 2070 6174 6841 7267 7329 0a0a  Key, pathArgs)..
-00005b90: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-00005ba0: 6e5f 6865 6164 6572 7320 3d20 7365 6c66  n_headers = self
-00005bb0: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
-00005bc0: 5f67 6574 5f65 7874 656e 7369 6f6e 5f68  _get_extension_h
-00005bd0: 6561 6465 7273 2865 7874 656e 7369 6f6e  eaders(extension
-00005be0: 4865 6164 6572 7329 0a20 2020 2020 2020  Headers).       
-00005bf0: 2068 6561 6465 7273 203d 2073 656c 662e   headers = self.
-00005c00: 5f70 6172 7365 5f65 7874 656e 7369 6f6e  _parse_extension
-00005c10: 5f68 6561 6465 7273 2868 6561 6465 7273  _headers(headers
-00005c20: 2c20 6578 7465 6e73 696f 6e5f 6865 6164  , extension_head
-00005c30: 6572 7329 0a20 2020 2020 2020 2068 6561  ers).        hea
-00005c40: 6465 7273 203d 2073 656c 662e 5f72 656e  ders = self._ren
-00005c50: 616d 655f 7265 7175 6573 745f 6865 6164  ame_request_head
-00005c60: 6572 7328 6865 6164 6572 732c 206d 6574  ers(headers, met
-00005c70: 686f 6429 0a0a 2020 2020 2020 2020 656e  hod)..        en
-00005c80: 7469 7479 2c20 6865 6164 6572 7320 3d20  tity, headers = 
-00005c90: 7365 6c66 2e5f 7061 7273 655f 656e 7469  self._parse_enti
-00005ca0: 7479 2865 6e74 6974 792c 2068 6561 6465  ty(entity, heade
-00005cb0: 7273 290a 0a20 2020 2020 2020 2068 6561  rs)..        hea
-00005cc0: 6465 7273 5b63 6f6e 7374 2e48 4f53 545f  ders[const.HOST_
-00005cd0: 4845 4144 4552 5d20 3d20 2725 733a 2573  HEADER] = '%s:%s
-00005ce0: 2720 2520 2863 6f6e 6e65 6374 5f73 6572  ' % (connect_ser
-00005cf0: 7665 722c 2070 6f72 7429 2069 6620 706f  ver, port) if po
-00005d00: 7274 206e 6f74 2069 6e20 2834 3433 2c20  rt not in (443, 
-00005d10: 3830 2920 656c 7365 2063 6f6e 6e65 6374  80) else connect
-00005d20: 5f73 6572 7665 720a 2020 2020 2020 2020  _server.        
-00005d30: 6865 6164 6572 5f63 6f6e 6669 6720 3d20  header_config = 
-00005d40: 7365 6c66 2e5f 6164 645f 6175 7468 5f68  self._add_auth_h
-00005d50: 6561 6465 7273 2868 6561 6465 7273 2c20  eaders(headers, 
-00005d60: 6d65 7468 6f64 2c20 6275 636b 6574 4e61  method, bucketNa
-00005d70: 6d65 2c20 6f62 6a65 6374 4b65 792c 2070  me, objectKey, p
-00005d80: 6174 6841 7267 732c 2073 6b69 7041 7574  athArgs, skipAut
-00005d90: 6865 6e74 6963 6174 696f 6e29 0a0a 2020  hentication)..  
-00005da0: 2020 2020 2020 6865 6164 6572 5f6c 6f67        header_log
-00005db0: 203d 2068 6561 6465 725f 636f 6e66 6967   = header_config
-00005dc0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-00005dd0: 6865 6164 6572 5f6c 6f67 5b63 6f6e 7374  header_log[const
-00005de0: 2e48 4f53 545f 4845 4144 4552 5d20 3d20  .HOST_HEADER] = 
-00005df0: 272a 2a2a 2a2a 2a27 0a20 2020 2020 2020  '******'.       
-00005e00: 2068 6561 6465 725f 6c6f 675b 636f 6e73   header_log[cons
-00005e10: 742e 4155 5448 4f52 495a 4154 494f 4e5f  t.AUTHORIZATION_
-00005e20: 4845 4144 4552 5d20 3d20 272a 2a2a 2a2a  HEADER] = '*****
-00005e30: 2a27 0a20 2020 2020 2020 2069 6620 7365  *'.        if se
-00005e40: 6c66 2e68 612e 7365 6375 7269 7479 5f74  lf.ha.security_t
-00005e50: 6f6b 656e 5f68 6561 6465 7228 2920 696e  oken_header() in
-00005e60: 2068 6561 6465 725f 6c6f 673a 0a20 2020   header_log:.   
-00005e70: 2020 2020 2020 2020 2068 6561 6465 725f           header_
-00005e80: 6c6f 675b 7365 6c66 2e68 612e 7365 6375  log[self.ha.secu
-00005e90: 7269 7479 5f74 6f6b 656e 5f68 6561 6465  rity_token_heade
-00005ea0: 7228 295d 203d 2022 2a2a 2a2a 2a2a 220a  r()] = "******".
-00005eb0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00005ec0: 5f63 6c69 656e 742e 6c6f 6728 4445 4255  _client.log(DEBU
-00005ed0: 472c 2027 6d65 7468 6f64 3a25 732c 2070  G, 'method:%s, p
-00005ee0: 6174 683a 2573 2c20 6865 6164 6572 3a25  ath:%s, header:%
-00005ef0: 7327 2c20 6d65 7468 6f64 2c20 7061 7468  s', method, path
-00005f00: 2c20 6865 6164 6572 5f6c 6f67 290a 2020  , header_log).  
-00005f10: 2020 2020 2020 636f 6e6e 203d 2073 656c        conn = sel
-00005f20: 662e 5f73 656e 645f 7265 7175 6573 7428  f._send_request(
-00005f30: 636f 6e6e 6563 745f 7365 7276 6572 2c20  connect_server, 
-00005f40: 6d65 7468 6f64 2c20 7061 7468 2c20 6865  method, path, he
-00005f50: 6164 6572 5f63 6f6e 6669 672c 2065 6e74  ader_config, ent
-00005f60: 6974 792c 2070 6f72 742c 2073 6368 656d  ity, port, schem
-00005f70: 652c 2072 6564 6972 6563 742c 0a20 2020  e, redirect,.   
-00005f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00005fa0: 6875 6e6b 6564 4d6f 6465 290a 2020 2020  hunkedMode).    
-00005fb0: 2020 2020 7265 7475 726e 2063 6f6e 6e0a      return conn.
-00005fc0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00005fd0: 6f64 0a20 2020 2064 6566 205f 7061 7273  od.    def _pars
-00005fe0: 655f 6578 7465 6e73 696f 6e5f 6865 6164  e_extension_head
-00005ff0: 6572 7328 6865 6164 6572 732c 2065 7874  ers(headers, ext
-00006000: 656e 7369 6f6e 5f68 6561 6465 7273 293a  ension_headers):
-00006010: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00006020: 6578 7465 6e73 696f 6e5f 6865 6164 6572  extension_header
-00006030: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
-00006040: 2020 2020 6966 2068 6561 6465 7273 2069      if headers i
-00006050: 7320 4e6f 6e65 206f 7220 6e6f 7420 6973  s None or not is
-00006060: 696e 7374 616e 6365 2868 6561 6465 7273  instance(headers
-00006070: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
-00006080: 2020 2020 2020 2020 2068 6561 6465 7273           headers
-00006090: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
-000060a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000060b0: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-000060c0: 3d20 6865 6164 6572 732e 636f 7079 2829  = headers.copy()
-000060d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000060e0: 206b 6579 2c20 7661 6c75 6520 696e 2065   key, value in e
-000060f0: 7874 656e 7369 6f6e 5f68 6561 6465 7273  xtension_headers
-00006100: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00006110: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00006120: 735b 6b65 795d 203d 2076 616c 7565 0a20  s[key] = value. 
-00006130: 2020 2020 2020 2072 6574 7572 6e20 6865         return he
-00006140: 6164 6572 730a 0a20 2020 2040 7374 6174  aders..    @stat
-00006150: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00006160: 205f 7061 7273 655f 656e 7469 7479 2865   _parse_entity(e
-00006170: 6e74 6974 792c 2068 6561 6465 7273 293a  ntity, headers):
-00006180: 0a20 2020 2020 2020 2069 6620 656e 7469  .        if enti
-00006190: 7479 2069 7320 6e6f 7420 4e6f 6e65 2061  ty is not None a
-000061a0: 6e64 206e 6f74 2063 616c 6c61 626c 6528  nd not callable(
-000061b0: 656e 7469 7479 293a 0a20 2020 2020 2020  entity):.       
-000061c0: 2020 2020 2065 6e74 6974 7920 3d20 7574       entity = ut
-000061d0: 696c 2e73 6166 655f 656e 636f 6465 2865  il.safe_encode(e
-000061e0: 6e74 6974 7929 0a20 2020 2020 2020 2020  ntity).         
-000061f0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00006200: 616e 6365 2865 6e74 6974 792c 2073 7472  ance(entity, str
-00006210: 2920 616e 6420 6e6f 7420 6973 696e 7374  ) and not isinst
-00006220: 616e 6365 2865 6e74 6974 792c 2062 7974  ance(entity, byt
-00006230: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
-00006240: 2020 2020 2065 6e74 6974 7920 3d20 7574       entity = ut
-00006250: 696c 2e74 6f5f 7374 7269 6e67 2865 6e74  il.to_string(ent
-00006260: 6974 7929 0a20 2020 2020 2020 2020 2020  ity).           
-00006270: 2069 6620 6e6f 7420 636f 6e73 742e 4953   if not const.IS
-00006280: 5f50 5954 484f 4e32 3a0a 2020 2020 2020  _PYTHON2:.      
-00006290: 2020 2020 2020 2020 2020 656e 7469 7479            entity
-000062a0: 203d 2065 6e74 6974 792e 656e 636f 6465   = entity.encode
-000062b0: 2827 5554 462d 3827 2920 6966 206e 6f74  ('UTF-8') if not
-000062c0: 2069 7369 6e73 7461 6e63 6528 656e 7469   isinstance(enti
-000062d0: 7479 2c20 6279 7465 7329 2065 6c73 6520  ty, bytes) else 
-000062e0: 656e 7469 7479 0a20 2020 2020 2020 2020  entity.         
-000062f0: 2020 2068 6561 6465 7273 5b63 6f6e 7374     headers[const
-00006300: 2e43 4f4e 5445 4e54 5f4c 454e 4754 485f  .CONTENT_LENGTH_
-00006310: 4845 4144 4552 5d20 3d20 7574 696c 2e74  HEADER] = util.t
-00006320: 6f5f 7374 7269 6e67 286c 656e 2865 6e74  o_string(len(ent
-00006330: 6974 7929 290a 2020 2020 2020 2020 7265  ity)).        re
-00006340: 7475 726e 2065 6e74 6974 792c 2068 6561  turn entity, hea
-00006350: 6465 7273 0a0a 2020 2020 6465 6620 5f61  ders..    def _a
-00006360: 6464 5f61 7574 685f 6865 6164 6572 7328  dd_auth_headers(
-00006370: 7365 6c66 2c20 6865 6164 6572 732c 206d  self, headers, m
-00006380: 6574 686f 642c 2062 7563 6b65 744e 616d  ethod, bucketNam
-00006390: 652c 206f 626a 6563 744b 6579 2c20 7061  e, objectKey, pa
-000063a0: 7468 4172 6773 2c20 736b 6970 4175 7468  thArgs, skipAuth
-000063b0: 656e 7469 6361 7469 6f6e 3d46 616c 7365  entication=False
-000063c0: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
-000063d0: 6461 7465 7469 6d65 2069 6d70 6f72 7420  datetime import 
-000063e0: 6461 7465 7469 6d65 0a0a 2020 2020 2020  datetime..      
-000063f0: 2020 6e6f 775f 6461 7465 203d 204e 6f6e    now_date = Non
-00006400: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
-00006410: 662e 6861 2e64 6174 655f 6865 6164 6572  f.ha.date_header
-00006420: 2829 206e 6f74 2069 6e20 6865 6164 6572  () not in header
-00006430: 733a 0a20 2020 2020 2020 2020 2020 206e  s:.            n
-00006440: 6f77 5f64 6174 6520 3d20 6461 7465 7469  ow_date = dateti
-00006450: 6d65 2e75 7463 6e6f 7728 290a 2020 2020  me.utcnow().    
-00006460: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
-00006470: 636f 6e73 742e 4441 5445 5f48 4541 4445  const.DATE_HEADE
-00006480: 525d 203d 206e 6f77 5f64 6174 652e 7374  R] = now_date.st
-00006490: 7266 7469 6d65 2863 6f6e 7374 2e47 4d54  rftime(const.GMT
-000064a0: 5f44 4154 455f 464f 524d 4154 290a 0a20  _DATE_FORMAT).. 
-000064b0: 2020 2020 2020 2069 6620 736b 6970 4175         if skipAu
-000064c0: 7468 656e 7469 6361 7469 6f6e 3a0a 2020  thentication:.  
-000064d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000064e0: 2068 6561 6465 7273 0a0a 2020 2020 2020   headers..      
-000064f0: 2020 7365 6375 7269 7479 5072 6f76 6964    securityProvid
-00006500: 6572 203d 2073 656c 662e 5f67 6574 5f74  er = self._get_t
-00006510: 6f6b 656e 2829 0a20 2020 2020 2020 2061  oken().        a
-00006520: 6b20 3d20 7365 6375 7269 7479 5072 6f76  k = securityProv
-00006530: 6964 6572 2e61 6363 6573 735f 6b65 795f  ider.access_key_
-00006540: 6964 0a20 2020 2020 2020 2073 6b20 3d20  id.        sk = 
-00006550: 7365 6375 7269 7479 5072 6f76 6964 6572  securityProvider
-00006560: 2e73 6563 7265 745f 6163 6365 7373 5f6b  .secret_access_k
-00006570: 6579 0a0a 2020 2020 2020 2020 6966 2075  ey..        if u
-00006580: 7469 6c2e 6973 5f76 616c 6964 2861 6b29  til.is_valid(ak)
-00006590: 2061 6e64 2075 7469 6c2e 6973 5f76 616c   and util.is_val
-000065a0: 6964 2873 6b29 3a0a 2020 2020 2020 2020  id(sk):.        
-000065b0: 2020 2020 6966 2073 6563 7572 6974 7950      if securityP
-000065c0: 726f 7669 6465 722e 7365 6375 7269 7479  rovider.security
-000065d0: 5f74 6f6b 656e 2069 7320 6e6f 7420 4e6f  _token is not No
-000065e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000065f0: 2020 2020 6865 6164 6572 735b 7365 6c66      headers[self
-00006600: 2e68 612e 7365 6375 7269 7479 5f74 6f6b  .ha.security_tok
-00006610: 656e 5f68 6561 6465 7228 295d 203d 2073  en_header()] = s
-00006620: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
-00006630: 7365 6375 7269 7479 5f74 6f6b 656e 0a0a  security_token..
-00006640: 2020 2020 2020 2020 2020 2020 6375 725f              cur_
-00006650: 7369 676e 6174 7572 6520 3d20 7365 6c66  signature = self
-00006660: 2e74 6872 6561 645f 6c6f 6361 6c2e 7369  .thread_local.si
-00006670: 676e 6174 7572 652e 6c6f 7765 7228 2920  gnature.lower() 
-00006680: 6966 2073 656c 662e 6973 5f73 6967 6e61  if self.is_signa
-00006690: 7475 7265 5f6e 6567 6f74 6961 7469 6f6e  ture_negotiation
-000066a0: 2065 6c73 6520 5c0a 2020 2020 2020 2020   else \.        
-000066b0: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-000066c0: 6e61 7475 7265 2e6c 6f77 6572 2829 0a20  nature.lower(). 
-000066d0: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
-000066e0: 725f 7369 676e 6174 7572 6520 3d3d 2027  r_signature == '
-000066f0: 7634 273a 0a20 2020 2020 2020 2020 2020  v4':.           
-00006700: 2020 2020 2069 6620 6e6f 775f 6461 7465       if now_date
-00006710: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00006720: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00006730: 775f 6461 7465 203d 2064 6174 6574 696d  w_date = datetim
-00006740: 652e 7374 7270 7469 6d65 2868 6561 6465  e.strptime(heade
-00006750: 7273 5b73 656c 662e 6861 2e64 6174 655f  rs[self.ha.date_
-00006760: 6865 6164 6572 2829 5d2c 2063 6f6e 7374  header()], const
-00006770: 2e4c 4f4e 475f 4441 5445 5f46 4f52 4d41  .LONG_DATE_FORMA
-00006780: 5429 0a20 2020 2020 2020 2020 2020 2020  T).             
-00006790: 2020 2073 686f 7274 4461 7465 203d 206e     shortDate = n
-000067a0: 6f77 5f64 6174 652e 7374 7266 7469 6d65  ow_date.strftime
-000067b0: 2863 6f6e 7374 2e53 484f 5254 5f44 4154  (const.SHORT_DAT
-000067c0: 455f 464f 524d 4154 290a 2020 2020 2020  E_FORMAT).      
-000067d0: 2020 2020 2020 2020 2020 6c6f 6e67 4461            longDa
-000067e0: 7465 203d 206e 6f77 5f64 6174 652e 7374  te = now_date.st
-000067f0: 7266 7469 6d65 2863 6f6e 7374 2e4c 4f4e  rftime(const.LON
-00006800: 475f 4441 5445 5f46 4f52 4d41 5429 0a20  G_DATE_FORMAT). 
-00006810: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00006820: 3441 7574 6820 3d20 6175 7468 2e56 3441  4Auth = auth.V4A
-00006830: 7574 6865 6e74 6963 6174 696f 6e28 616b  uthentication(ak
-00006840: 2c20 736b 2c20 7374 7228 7365 6c66 2e72  , sk, str(self.r
-00006850: 6567 696f 6e29 2069 6620 7365 6c66 2e72  egion) if self.r
-00006860: 6567 696f 6e20 6973 206e 6f74 204e 6f6e  egion is not Non
-00006870: 6520 656c 7365 2027 272c 2073 686f 7274  e else '', short
-00006880: 4461 7465 2c0a 2020 2020 2020 2020 2020  Date,.          
-00006890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000068a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000068b0: 2020 2020 206c 6f6e 6744 6174 652c 2073       longDate, s
-000068c0: 656c 662e 7061 7468 5f73 7479 6c65 2c20  elf.path_style, 
-000068d0: 7365 6c66 2e68 6129 0a20 2020 2020 2020  self.ha).       
-000068e0: 2020 2020 2020 2020 2072 6574 203d 2076           ret = v
-000068f0: 3441 7574 682e 646f 4175 7468 286d 6574  4Auth.doAuth(met
-00006900: 686f 642c 2062 7563 6b65 744e 616d 652c  hod, bucketName,
-00006910: 206f 626a 6563 744b 6579 2c20 7061 7468   objectKey, path
-00006920: 4172 6773 2c20 6865 6164 6572 7329 0a0a  Args, headers)..
+000052e0: 7574 696c 2e63 6c6f 7365 5f63 6f6e 6e28  util.close_conn(
+000052f0: 636f 6e6e 2c20 7365 6c66 2e6c 6f67 5f63  conn, self.log_c
+00005300: 6c69 656e 7429 0a20 2020 2020 2020 2020  lient).         
+00005310: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00005320: 696e 7374 616e 6365 2865 2c20 5f52 6564  instance(e, _Red
+00005330: 6972 6563 7445 7863 6570 7469 6f6e 293a  irectException):
+00005340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005350: 2020 2020 2020 2020 2072 6564 6972 6563           redirec
+00005360: 745f 636f 756e 7420 2b3d 2031 0a20 2020  t_count += 1.   
+00005370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005380: 2020 2020 205f 7265 6469 7265 6374 4c6f       _redirectLo
+00005390: 6361 7469 6f6e 203d 2065 2e6c 6f63 6174  cation = e.locat
+000053a0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+000053b0: 2020 2020 2020 2020 2020 2020 666c 6167              flag
+000053c0: 202d 3d20 310a 2020 2020 2020 2020 2020   -= 1.          
+000053d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000053e0: 7420 3d20 652e 7265 7375 6c74 0a20 2020  t = e.result.   
+000053f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005400: 2020 2020 2069 6620 6d65 7468 6f64 5479       if methodTy
+00005410: 7065 203d 3d20 636f 6e73 742e 4854 5450  pe == const.HTTP
+00005420: 5f4d 4554 484f 445f 4745 5420 616e 6420  _METHOD_GET and 
+00005430: 652e 7265 7375 6c74 2e73 7461 7475 7320  e.result.status 
+00005440: 3d3d 2033 3032 3a0a 2020 2020 2020 2020  == 302:.        
+00005450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005460: 2020 2020 7265 6469 7265 6374 466c 6167      redirectFlag
+00005470: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00005480: 2020 2020 2020 2020 6966 2072 6564 6972          if redir
+00005490: 6563 745f 636f 756e 7420 3e3d 2073 656c  ect_count >= sel
+000054a0: 662e 6d61 785f 7265 6469 7265 6374 5f63  f.max_redirect_c
+000054b0: 6f75 6e74 3a0a 2020 2020 2020 2020 2020  ount:.          
+000054c0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+000054d0: 6f67 5f63 6c69 656e 742e 6c6f 6728 4552  og_client.log(ER
+000054e0: 524f 522c 2027 7265 7175 6573 7420 7265  ROR, 'request re
+000054f0: 6469 7265 6374 2063 6f75 6e74 205b 2564  direct count [%d
+00005500: 5d20 6772 6561 7465 7220 7468 616e 206d  ] greater than m
+00005510: 6178 2072 6564 6972 6563 7420 636f 756e  ax redirect coun
+00005520: 7420 5b25 645d 2720 2520 280a 2020 2020  t [%d]' % (.    
+00005530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005540: 2020 2020 7265 6469 7265 6374 5f63 6f75      redirect_cou
+00005550: 6e74 2c20 7365 6c66 2e6d 6178 5f72 6564  nt, self.max_red
+00005560: 6972 6563 745f 636f 756e 7429 290a 2020  irect_count)).  
+00005570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005580: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+00005590: 616b 655f 6572 726f 725f 7265 7375 6c74  ake_error_result
+000055a0: 2865 2c20 7265 7429 0a20 2020 2020 2020  (e, ret).       
+000055b0: 2020 2020 2020 2020 2069 6620 666c 6167           if flag
+000055c0: 203e 3d20 7365 6c66 2e6d 6178 5f72 6574   >= self.max_ret
+000055d0: 7279 5f63 6f75 6e74 206f 7220 7265 6164  ry_count or read
+000055e0: 6162 6c65 3a0a 2020 2020 2020 2020 2020  able:.          
+000055f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00005600: 2073 656c 662e 5f6d 616b 655f 6572 726f   self._make_erro
+00005610: 725f 7265 7375 6c74 2865 2c20 7265 7429  r_result(e, ret)
+00005620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005630: 2066 6c61 6720 2b3d 2031 0a20 2020 2020   flag += 1.     
+00005640: 2020 2020 2020 2020 2020 2074 696d 652e             time.
+00005650: 736c 6565 7028 6d61 7468 2e70 6f77 2832  sleep(math.pow(2
+00005660: 2c20 666c 6167 2920 2a20 302e 3035 290a  , flag) * 0.05).
+00005670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005680: 7365 6c66 2e6c 6f67 5f63 6c69 656e 742e  self.log_client.
+00005690: 6c6f 6728 5741 524e 494e 472c 2027 7265  log(WARNING, 're
+000056a0: 7175 6573 7420 6167 6169 6e2c 2074 696d  quest again, tim
+000056b0: 653a 2564 2720 2520 696e 7428 666c 6167  e:%d' % int(flag
+000056c0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+000056d0: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+000056e0: 2064 6566 205f 6d61 6b65 5f72 6571 7565   def _make_reque
+000056f0: 7374 5f69 6e74 6572 6e61 6c28 7365 6c66  st_internal(self
+00005700: 2c20 6d65 7468 6f64 2c20 6275 636b 6574  , method, bucket
+00005710: 4e61 6d65 3d27 272c 206f 626a 6563 744b  Name='', objectK
+00005720: 6579 3d4e 6f6e 652c 2070 6174 6841 7267  ey=None, pathArg
+00005730: 733d 4e6f 6e65 2c20 6865 6164 6572 733d  s=None, headers=
+00005740: 4e6f 6e65 2c20 656e 7469 7479 3d4e 6f6e  None, entity=Non
+00005750: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00005760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005770: 2020 6368 756e 6b65 644d 6f64 653d 4661    chunkedMode=Fa
+00005780: 6c73 652c 2072 6564 6972 6563 744c 6f63  lse, redirectLoc
+00005790: 6174 696f 6e3d 4e6f 6e65 2c20 736b 6970  ation=None, skip
+000057a0: 4175 7468 656e 7469 6361 7469 6f6e 3d46  Authentication=F
+000057b0: 616c 7365 2c20 7265 6469 7265 6374 466c  alse, redirectFl
+000057c0: 6167 3d46 616c 7365 2c0a 2020 2020 2020  ag=False,.      
+000057d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057e0: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+000057f0: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
+00005800: 0a20 2020 2020 2020 206f 626a 6563 744b  .        objectK
+00005810: 6579 203d 2075 7469 6c2e 7361 6665 5f65  ey = util.safe_e
+00005820: 6e63 6f64 6528 6f62 6a65 6374 4b65 7929  ncode(objectKey)
+00005830: 0a20 2020 2020 2020 2069 6620 6f62 6a65  .        if obje
+00005840: 6374 4b65 7920 6973 204e 6f6e 653a 0a20  ctKey is None:. 
+00005850: 2020 2020 2020 2020 2020 206f 626a 6563             objec
+00005860: 744b 6579 203d 2027 270a 2020 2020 2020  tKey = ''.      
+00005870: 2020 706f 7274 203d 204e 6f6e 650a 2020    port = None.  
+00005880: 2020 2020 2020 7363 6865 6d65 203d 204e        scheme = N
+00005890: 6f6e 650a 2020 2020 2020 2020 7061 7468  one.        path
+000058a0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000058b0: 6966 2072 6564 6972 6563 744c 6f63 6174  if redirectLocat
+000058c0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+000058d0: 2072 6564 6972 6563 744c 6f63 6174 696f   redirectLocatio
+000058e0: 6e20 3d20 7572 6c70 6172 7365 2872 6564  n = urlparse(red
+000058f0: 6972 6563 744c 6f63 6174 696f 6e29 0a20  irectLocation). 
+00005900: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
+00005910: 6374 5f73 6572 7665 7220 3d20 7265 6469  ct_server = redi
+00005920: 7265 6374 4c6f 6361 7469 6f6e 2e68 6f73  rectLocation.hos
+00005930: 746e 616d 650a 2020 2020 2020 2020 2020  tname.          
+00005940: 2020 7363 6865 6d65 203d 2072 6564 6972    scheme = redir
+00005950: 6563 744c 6f63 6174 696f 6e2e 7363 6865  ectLocation.sche
+00005960: 6d65 0a20 2020 2020 2020 2020 2020 2070  me.            p
+00005970: 6f72 7420 3d20 7365 6c66 2e5f 7061 7273  ort = self._pars
+00005980: 655f 706f 7274 2872 6564 6972 6563 744c  e_port(redirectL
+00005990: 6f63 6174 696f 6e2e 706f 7274 2c20 7363  ocation.port, sc
+000059a0: 6865 6d65 2e6c 6f77 6572 2829 203d 3d20  heme.lower() == 
+000059b0: 2768 7474 7073 2729 0a20 2020 2020 2020  'https').       
+000059c0: 2020 2020 2072 6564 6972 6563 7420 3d20       redirect = 
+000059d0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000059e0: 205f 7061 7468 203d 2072 6564 6972 6563   _path = redirec
+000059f0: 744c 6f63 6174 696f 6e2e 7061 7468 0a20  tLocation.path. 
+00005a00: 2020 2020 2020 2020 2020 2071 7565 7279             query
+00005a10: 203d 2072 6564 6972 6563 744c 6f63 6174   = redirectLocat
+00005a20: 696f 6e2e 7175 6572 790a 2020 2020 2020  ion.query.      
+00005a30: 2020 2020 2020 7061 7468 203d 205f 7061        path = _pa
+00005a40: 7468 202b 2027 3f27 202b 2071 7565 7279  th + '?' + query
+00005a50: 2069 6620 7175 6572 7920 656c 7365 205f   if query else _
+00005a60: 7061 7468 0a20 2020 2020 2020 2020 2020  path.           
+00005a70: 2073 6b69 7041 7574 6865 6e74 6963 6174   skipAuthenticat
+00005a80: 696f 6e20 3d20 5472 7565 0a20 2020 2020  ion = True.     
+00005a90: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
+00005aa0: 6469 7265 6374 466c 6167 3a0a 2020 2020  directFlag:.    
+00005ab0: 2020 2020 2020 2020 2020 2020 736b 6970              skip
+00005ac0: 4175 7468 656e 7469 6361 7469 6f6e 203d  Authentication =
+00005ad0: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
+00005ae0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005af0: 2020 636f 6e6e 6563 745f 7365 7276 6572    connect_server
+00005b00: 203d 2073 656c 662e 7365 7276 6572 2069   = self.server i
+00005b10: 6620 7365 6c66 2e69 735f 636e 616d 6520  f self.is_cname 
+00005b20: 656c 7365 2073 656c 662e 6361 6c6c 696e  else self.callin
+00005b30: 675f 666f 726d 6174 2e67 6574 5f73 6572  g_format.get_ser
+00005b40: 7665 7228 7365 6c66 2e73 6572 7665 722c  ver(self.server,
+00005b50: 2062 7563 6b65 744e 616d 6529 0a20 2020   bucketName).   
+00005b60: 2020 2020 2020 2020 2072 6564 6972 6563           redirec
+00005b70: 7420 3d20 4661 6c73 650a 2020 2020 2020  t = False.      
+00005b80: 2020 2020 2020 706f 7274 203d 2073 656c        port = sel
+00005b90: 662e 706f 7274 0a0a 2020 2020 2020 2020  f.port..        
+00005ba0: 6966 2073 656c 662e 6973 5f63 6e61 6d65  if self.is_cname
+00005bb0: 3a0a 2020 2020 2020 2020 2020 2020 6275  :.            bu
+00005bc0: 636b 6574 4e61 6d65 203d 2027 270a 0a20  cketName = ''.. 
+00005bd0: 2020 2020 2020 2069 6620 6e6f 7420 7061         if not pa
+00005be0: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+00005bf0: 7061 7468 203d 2073 656c 662e 6361 6c6c  path = self.call
+00005c00: 696e 675f 666f 726d 6174 2e67 6574 5f75  ing_format.get_u
+00005c10: 726c 2862 7563 6b65 744e 616d 652c 206f  rl(bucketName, o
+00005c20: 626a 6563 744b 6579 2c20 7061 7468 4172  bjectKey, pathAr
+00005c30: 6773 290a 0a20 2020 2020 2020 2065 7874  gs)..        ext
+00005c40: 656e 7369 6f6e 5f68 6561 6465 7273 203d  ension_headers =
+00005c50: 2073 656c 662e 636f 6e76 6572 746f 722e   self.convertor.
+00005c60: 7472 616e 735f 6765 745f 6578 7465 6e73  trans_get_extens
+00005c70: 696f 6e5f 6865 6164 6572 7328 6578 7465  ion_headers(exte
+00005c80: 6e73 696f 6e48 6561 6465 7273 290a 2020  nsionHeaders).  
+00005c90: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+00005ca0: 7365 6c66 2e5f 7265 6e61 6d65 5f72 6571  self._rename_req
+00005cb0: 7565 7374 5f68 6561 6465 7273 2868 6561  uest_headers(hea
+00005cc0: 6465 7273 2c20 6578 7465 6e73 696f 6e5f  ders, extension_
+00005cd0: 6865 6164 6572 732c 206d 6574 686f 6429  headers, method)
+00005ce0: 0a0a 2020 2020 2020 2020 656e 7469 7479  ..        entity
+00005cf0: 2c20 6865 6164 6572 7320 3d20 7365 6c66  , headers = self
+00005d00: 2e5f 7061 7273 655f 656e 7469 7479 2865  ._parse_entity(e
+00005d10: 6e74 6974 792c 2068 6561 6465 7273 290a  ntity, headers).
+00005d20: 0a20 2020 2020 2020 2068 6561 6465 7273  .        headers
+00005d30: 5b63 6f6e 7374 2e48 4f53 545f 4845 4144  [const.HOST_HEAD
+00005d40: 4552 5d20 3d20 2725 733a 2573 2720 2520  ER] = '%s:%s' % 
+00005d50: 2863 6f6e 6e65 6374 5f73 6572 7665 722c  (connect_server,
+00005d60: 2070 6f72 7429 2069 6620 706f 7274 206e   port) if port n
+00005d70: 6f74 2069 6e20 2834 3433 2c20 3830 2920  ot in (443, 80) 
+00005d80: 656c 7365 2063 6f6e 6e65 6374 5f73 6572  else connect_ser
+00005d90: 7665 720a 2020 2020 2020 2020 6865 6164  ver.        head
+00005da0: 6572 5f63 6f6e 6669 6720 3d20 7365 6c66  er_config = self
+00005db0: 2e5f 6164 645f 6175 7468 5f68 6561 6465  ._add_auth_heade
+00005dc0: 7273 2868 6561 6465 7273 2c20 6d65 7468  rs(headers, meth
+00005dd0: 6f64 2c20 6275 636b 6574 4e61 6d65 2c20  od, bucketName, 
+00005de0: 6f62 6a65 6374 4b65 792c 2070 6174 6841  objectKey, pathA
+00005df0: 7267 732c 2073 6b69 7041 7574 6865 6e74  rgs, skipAuthent
+00005e00: 6963 6174 696f 6e29 0a0a 2020 2020 2020  ication)..      
+00005e10: 2020 6865 6164 6572 5f6c 6f67 203d 2068    header_log = h
+00005e20: 6561 6465 725f 636f 6e66 6967 2e63 6f70  eader_config.cop
+00005e30: 7928 290a 2020 2020 2020 2020 6865 6164  y().        head
+00005e40: 6572 5f6c 6f67 5b63 6f6e 7374 2e48 4f53  er_log[const.HOS
+00005e50: 545f 4845 4144 4552 5d20 3d20 272a 2a2a  T_HEADER] = '***
+00005e60: 2a2a 2a27 0a20 2020 2020 2020 2068 6561  ***'.        hea
+00005e70: 6465 725f 6c6f 675b 636f 6e73 742e 4155  der_log[const.AU
+00005e80: 5448 4f52 495a 4154 494f 4e5f 4845 4144  THORIZATION_HEAD
+00005e90: 4552 5d20 3d20 272a 2a2a 2a2a 2a27 0a20  ER] = '******'. 
+00005ea0: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
+00005eb0: 612e 7365 6375 7269 7479 5f74 6f6b 656e  a.security_token
+00005ec0: 5f68 6561 6465 7228 2920 696e 2068 6561  _header() in hea
+00005ed0: 6465 725f 6c6f 673a 0a20 2020 2020 2020  der_log:.       
+00005ee0: 2020 2020 2068 6561 6465 725f 6c6f 675b       header_log[
+00005ef0: 7365 6c66 2e68 612e 7365 6375 7269 7479  self.ha.security
+00005f00: 5f74 6f6b 656e 5f68 6561 6465 7228 295d  _token_header()]
+00005f10: 203d 2022 2a2a 2a2a 2a2a 220a 2020 2020   = "******".    
+00005f20: 2020 2020 7365 6c66 2e6c 6f67 5f63 6c69      self.log_cli
+00005f30: 656e 742e 6c6f 6728 4445 4255 472c 2027  ent.log(DEBUG, '
+00005f40: 6d65 7468 6f64 3a25 732c 2070 6174 683a  method:%s, path:
+00005f50: 2573 2c20 6865 6164 6572 3a25 7327 2c20  %s, header:%s', 
+00005f60: 6d65 7468 6f64 2c20 7061 7468 2c20 6865  method, path, he
+00005f70: 6164 6572 5f6c 6f67 290a 2020 2020 2020  ader_log).      
+00005f80: 2020 636f 6e6e 203d 2073 656c 662e 5f73    conn = self._s
+00005f90: 656e 645f 7265 7175 6573 7428 636f 6e6e  end_request(conn
+00005fa0: 6563 745f 7365 7276 6572 2c20 6d65 7468  ect_server, meth
+00005fb0: 6f64 2c20 7061 7468 2c20 6865 6164 6572  od, path, header
+00005fc0: 5f63 6f6e 6669 672c 2065 6e74 6974 792c  _config, entity,
+00005fd0: 2070 6f72 742c 2073 6368 656d 652c 2072   port, scheme, r
+00005fe0: 6564 6972 6563 742c 0a20 2020 2020 2020  edirect,.       
+00005ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006000: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00006010: 6564 4d6f 6465 290a 2020 2020 2020 2020  edMode).        
+00006020: 7265 7475 726e 2063 6f6e 6e0a 0a20 2020  return conn..   
+00006030: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00006040: 2020 2064 6566 205f 7061 7273 655f 656e     def _parse_en
+00006050: 7469 7479 2865 6e74 6974 792c 2068 6561  tity(entity, hea
+00006060: 6465 7273 293a 0a20 2020 2020 2020 2069  ders):.        i
+00006070: 6620 656e 7469 7479 2069 7320 6e6f 7420  f entity is not 
+00006080: 4e6f 6e65 2061 6e64 206e 6f74 2063 616c  None and not cal
+00006090: 6c61 626c 6528 656e 7469 7479 293a 0a20  lable(entity):. 
+000060a0: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
+000060b0: 7920 3d20 7574 696c 2e73 6166 655f 656e  y = util.safe_en
+000060c0: 636f 6465 2865 6e74 6974 7929 0a20 2020  code(entity).   
+000060d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000060e0: 6973 696e 7374 616e 6365 2865 6e74 6974  isinstance(entit
+000060f0: 792c 2073 7472 2920 616e 6420 6e6f 7420  y, str) and not 
+00006100: 6973 696e 7374 616e 6365 2865 6e74 6974  isinstance(entit
+00006110: 792c 2062 7974 6573 293a 0a20 2020 2020  y, bytes):.     
+00006120: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
+00006130: 7920 3d20 7574 696c 2e74 6f5f 7374 7269  y = util.to_stri
+00006140: 6e67 2865 6e74 6974 7929 0a20 2020 2020  ng(entity).     
+00006150: 2020 2020 2020 2069 6620 6e6f 7420 636f         if not co
+00006160: 6e73 742e 4953 5f50 5954 484f 4e32 3a0a  nst.IS_PYTHON2:.
+00006170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006180: 656e 7469 7479 203d 2065 6e74 6974 792e  entity = entity.
+00006190: 656e 636f 6465 2827 5554 462d 3827 2920  encode('UTF-8') 
+000061a0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+000061b0: 6528 656e 7469 7479 2c20 6279 7465 7329  e(entity, bytes)
+000061c0: 2065 6c73 6520 656e 7469 7479 0a20 2020   else entity.   
+000061d0: 2020 2020 2020 2020 2068 6561 6465 7273           headers
+000061e0: 5b63 6f6e 7374 2e43 4f4e 5445 4e54 5f4c  [const.CONTENT_L
+000061f0: 454e 4754 485f 4845 4144 4552 5d20 3d20  ENGTH_HEADER] = 
+00006200: 7574 696c 2e74 6f5f 7374 7269 6e67 286c  util.to_string(l
+00006210: 656e 2865 6e74 6974 7929 290a 2020 2020  en(entity)).    
+00006220: 2020 2020 7265 7475 726e 2065 6e74 6974      return entit
+00006230: 792c 2068 6561 6465 7273 0a0a 2020 2020  y, headers..    
+00006240: 6465 6620 5f61 6464 5f61 7574 685f 6865  def _add_auth_he
+00006250: 6164 6572 7328 7365 6c66 2c20 6865 6164  aders(self, head
+00006260: 6572 732c 206d 6574 686f 642c 2062 7563  ers, method, buc
+00006270: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+00006280: 6579 2c20 7061 7468 4172 6773 2c20 736b  ey, pathArgs, sk
+00006290: 6970 4175 7468 656e 7469 6361 7469 6f6e  ipAuthentication
+000062a0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+000062b0: 2066 726f 6d20 6461 7465 7469 6d65 2069   from datetime i
+000062c0: 6d70 6f72 7420 6461 7465 7469 6d65 0a0a  mport datetime..
+000062d0: 2020 2020 2020 2020 6e6f 775f 6461 7465          now_date
+000062e0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000062f0: 6966 2073 656c 662e 6861 2e64 6174 655f  if self.ha.date_
+00006300: 6865 6164 6572 2829 206e 6f74 2069 6e20  header() not in 
+00006310: 6865 6164 6572 733a 0a20 2020 2020 2020  headers:.       
+00006320: 2020 2020 206e 6f77 5f64 6174 6520 3d20       now_date = 
+00006330: 6461 7465 7469 6d65 2e75 7463 6e6f 7728  datetime.utcnow(
+00006340: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
+00006350: 6164 6572 735b 636f 6e73 742e 4441 5445  aders[const.DATE
+00006360: 5f48 4541 4445 525d 203d 206e 6f77 5f64  _HEADER] = now_d
+00006370: 6174 652e 7374 7266 7469 6d65 2863 6f6e  ate.strftime(con
+00006380: 7374 2e47 4d54 5f44 4154 455f 464f 524d  st.GMT_DATE_FORM
+00006390: 4154 290a 0a20 2020 2020 2020 2069 6620  AT)..        if 
+000063a0: 736b 6970 4175 7468 656e 7469 6361 7469  skipAuthenticati
+000063b0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+000063c0: 7265 7475 726e 2068 6561 6465 7273 0a0a  return headers..
+000063d0: 2020 2020 2020 2020 7365 6375 7269 7479          security
+000063e0: 5072 6f76 6964 6572 203d 2073 656c 662e  Provider = self.
+000063f0: 5f67 6574 5f74 6f6b 656e 2829 0a20 2020  _get_token().   
+00006400: 2020 2020 2061 6b20 3d20 7365 6375 7269       ak = securi
+00006410: 7479 5072 6f76 6964 6572 2e61 6363 6573  tyProvider.acces
+00006420: 735f 6b65 795f 6964 0a20 2020 2020 2020  s_key_id.       
+00006430: 2073 6b20 3d20 7365 6375 7269 7479 5072   sk = securityPr
+00006440: 6f76 6964 6572 2e73 6563 7265 745f 6163  ovider.secret_ac
+00006450: 6365 7373 5f6b 6579 0a0a 2020 2020 2020  cess_key..      
+00006460: 2020 6966 2075 7469 6c2e 6973 5f76 616c    if util.is_val
+00006470: 6964 2861 6b29 2061 6e64 2075 7469 6c2e  id(ak) and util.
+00006480: 6973 5f76 616c 6964 2873 6b29 3a0a 2020  is_valid(sk):.  
+00006490: 2020 2020 2020 2020 2020 6966 2073 6563            if sec
+000064a0: 7572 6974 7950 726f 7669 6465 722e 7365  urityProvider.se
+000064b0: 6375 7269 7479 5f74 6f6b 656e 2069 7320  curity_token is 
+000064c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000064d0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+000064e0: 735b 7365 6c66 2e68 612e 7365 6375 7269  s[self.ha.securi
+000064f0: 7479 5f74 6f6b 656e 5f68 6561 6465 7228  ty_token_header(
+00006500: 295d 203d 2073 6563 7572 6974 7950 726f  )] = securityPro
+00006510: 7669 6465 722e 7365 6375 7269 7479 5f74  vider.security_t
+00006520: 6f6b 656e 0a0a 2020 2020 2020 2020 2020  oken..          
+00006530: 2020 6375 725f 7369 676e 6174 7572 6520    cur_signature 
+00006540: 3d20 7365 6c66 2e74 6872 6561 645f 6c6f  = self.thread_lo
+00006550: 6361 6c2e 7369 676e 6174 7572 652e 6c6f  cal.signature.lo
+00006560: 7765 7228 2920 6966 2073 656c 662e 6973  wer() if self.is
+00006570: 5f73 6967 6e61 7475 7265 5f6e 6567 6f74  _signature_negot
+00006580: 6961 7469 6f6e 2065 6c73 6520 5c0a 2020  iation else \.  
+00006590: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000065a0: 6c66 2e73 6967 6e61 7475 7265 2e6c 6f77  lf.signature.low
+000065b0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
+000065c0: 2069 6620 6375 725f 7369 676e 6174 7572   if cur_signatur
+000065d0: 6520 3d3d 2027 7634 273a 0a20 2020 2020  e == 'v4':.     
+000065e0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000065f0: 775f 6461 7465 2069 7320 4e6f 6e65 3a0a  w_date is None:.
+00006600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006610: 2020 2020 6e6f 775f 6461 7465 203d 2064      now_date = d
+00006620: 6174 6574 696d 652e 7374 7270 7469 6d65  atetime.strptime
+00006630: 2868 6561 6465 7273 5b73 656c 662e 6861  (headers[self.ha
+00006640: 2e64 6174 655f 6865 6164 6572 2829 5d2c  .date_header()],
+00006650: 2063 6f6e 7374 2e4c 4f4e 475f 4441 5445   const.LONG_DATE
+00006660: 5f46 4f52 4d41 5429 0a20 2020 2020 2020  _FORMAT).       
+00006670: 2020 2020 2020 2020 2073 686f 7274 4461           shortDa
+00006680: 7465 203d 206e 6f77 5f64 6174 652e 7374  te = now_date.st
+00006690: 7266 7469 6d65 2863 6f6e 7374 2e53 484f  rftime(const.SHO
+000066a0: 5254 5f44 4154 455f 464f 524d 4154 290a  RT_DATE_FORMAT).
+000066b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066c0: 6c6f 6e67 4461 7465 203d 206e 6f77 5f64  longDate = now_d
+000066d0: 6174 652e 7374 7266 7469 6d65 2863 6f6e  ate.strftime(con
+000066e0: 7374 2e4c 4f4e 475f 4441 5445 5f46 4f52  st.LONG_DATE_FOR
+000066f0: 4d41 5429 0a20 2020 2020 2020 2020 2020  MAT).           
+00006700: 2020 2020 2076 3441 7574 6820 3d20 6175       v4Auth = au
+00006710: 7468 2e56 3441 7574 6865 6e74 6963 6174  th.V4Authenticat
+00006720: 696f 6e28 616b 2c20 736b 2c20 7374 7228  ion(ak, sk, str(
+00006730: 7365 6c66 2e72 6567 696f 6e29 2069 6620  self.region) if 
+00006740: 7365 6c66 2e72 6567 696f 6e20 6973 206e  self.region is n
+00006750: 6f74 204e 6f6e 6520 656c 7365 2027 272c  ot None else '',
+00006760: 2073 686f 7274 4461 7465 2c0a 2020 2020   shortDate,.    
+00006770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006790: 2020 2020 2020 2020 2020 206c 6f6e 6744             longD
+000067a0: 6174 652c 2073 656c 662e 7061 7468 5f73  ate, self.path_s
+000067b0: 7479 6c65 2c20 7365 6c66 2e68 6129 0a20  tyle, self.ha). 
+000067c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000067d0: 6574 203d 2076 3441 7574 682e 646f 4175  et = v4Auth.doAu
+000067e0: 7468 286d 6574 686f 642c 2062 7563 6b65  th(method, bucke
+000067f0: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
+00006800: 2c20 7061 7468 4172 6773 2c20 6865 6164  , pathArgs, head
+00006810: 6572 7329 0a0a 2020 2020 2020 2020 2020  ers)..          
+00006820: 2020 2020 2020 6c6f 675f 6361 6e6f 6e69        log_canoni
+00006830: 6361 6c5f 7265 7175 6573 7420 3d20 7265  cal_request = re
+00006840: 745b 636f 6e73 742e 4341 4e4f 4e49 4341  t[const.CANONICA
+00006850: 4c5f 5245 5155 4553 545d 0a20 2020 2020  L_REQUEST].     
+00006860: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00006870: 6c66 2e68 612e 7365 6375 7269 7479 5f74  lf.ha.security_t
+00006880: 6f6b 656e 5f68 6561 6465 7228 2920 696e  oken_header() in
+00006890: 2068 6561 6465 7273 3a0a 2020 2020 2020   headers:.      
+000068a0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+000068b0: 675f 6361 6e6f 6e69 6361 6c5f 7265 7175  g_canonical_requ
+000068c0: 6573 7420 3d20 7374 722e 7265 706c 6163  est = str.replac
+000068d0: 6528 6c6f 675f 6361 6e6f 6e69 6361 6c5f  e(log_canonical_
+000068e0: 7265 7175 6573 742c 2068 6561 6465 7273  request, headers
+000068f0: 5b73 656c 662e 6861 2e73 6563 7572 6974  [self.ha.securit
+00006900: 795f 746f 6b65 6e5f 6865 6164 6572 2829  y_token_header()
+00006910: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00006920: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00006930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006940: 6c6f 675f 6361 6e6f 6e69 6361 6c5f 7265  log_canonical_re
-00006950: 7175 6573 7420 3d20 7265 745b 636f 6e73  quest = ret[cons
-00006960: 742e 4341 4e4f 4e49 4341 4c5f 5245 5155  t.CANONICAL_REQU
-00006970: 4553 545d 0a20 2020 2020 2020 2020 2020  EST].           
-00006980: 2020 2020 2069 6620 7365 6c66 2e68 612e       if self.ha.
-00006990: 7365 6375 7269 7479 5f74 6f6b 656e 5f68  security_token_h
-000069a0: 6561 6465 7228 2920 696e 2068 6561 6465  eader() in heade
-000069b0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-000069c0: 2020 2020 2020 2020 6c6f 675f 6361 6e6f          log_cano
-000069d0: 6e69 6361 6c5f 7265 7175 6573 7420 3d20  nical_request = 
-000069e0: 7374 722e 7265 706c 6163 6528 6c6f 675f  str.replace(log_
-000069f0: 6361 6e6f 6e69 6361 6c5f 7265 7175 6573  canonical_reques
-00006a00: 742c 2068 6561 6465 7273 5b73 656c 662e  t, headers[self.
-00006a10: 6861 2e73 6563 7572 6974 795f 746f 6b65  ha.security_toke
-00006a20: 6e5f 6865 6164 6572 2829 5d2c 0a20 2020  n_header()],.   
-00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a60: 2020 2020 2022 2a2a 2a2a 2a2a 2229 0a20       "******"). 
-00006a70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00006a80: 656c 662e 6c6f 675f 636c 6965 6e74 2e6c  elf.log_client.l
-00006a90: 6f67 2844 4542 5547 2c20 2725 733a 2025  og(DEBUG, '%s: %
-00006aa0: 7327 2025 2028 636f 6e73 742e 4341 4e4f  s' % (const.CANO
-00006ab0: 4e49 4341 4c5f 5245 5155 4553 542c 206c  NICAL_REQUEST, l
-00006ac0: 6f67 5f63 616e 6f6e 6963 616c 5f72 6571  og_canonical_req
-00006ad0: 7565 7374 2929 0a20 2020 2020 2020 2020  uest)).         
-00006ae0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006af0: 2020 2020 2020 2020 206f 6273 4175 7468           obsAuth
-00006b00: 203d 2061 7574 682e 4175 7468 656e 7469   = auth.Authenti
-00006b10: 6361 7469 6f6e 2861 6b2c 2073 6b2c 2073  cation(ak, sk, s
-00006b20: 656c 662e 7061 7468 5f73 7479 6c65 2c20  elf.path_style, 
-00006b30: 7365 6c66 2e68 612c 2073 656c 662e 7365  self.ha, self.se
-00006b40: 7276 6572 2c20 7365 6c66 2e69 735f 636e  rver, self.is_cn
-00006b50: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00006b60: 2020 2020 2072 6574 203d 206f 6273 4175       ret = obsAu
-00006b70: 7468 2e64 6f41 7574 6828 6d65 7468 6f64  th.doAuth(method
-00006b80: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
-00006b90: 6a65 6374 4b65 792c 2070 6174 6841 7267  jectKey, pathArg
-00006ba0: 732c 2068 6561 6465 7273 290a 2020 2020  s, headers).    
-00006bb0: 2020 2020 2020 2020 2020 2020 6c6f 675f              log_
-00006bc0: 6361 6e6f 6e69 6361 6c5f 7374 7269 6e67  canonical_string
-00006bd0: 203d 2072 6574 5b63 6f6e 7374 2e43 414e   = ret[const.CAN
-00006be0: 4f4e 4943 414c 5f53 5452 494e 475d 0a20  ONICAL_STRING]. 
-00006bf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00006c00: 6620 7365 6c66 2e68 612e 7365 6375 7269  f self.ha.securi
-00006c10: 7479 5f74 6f6b 656e 5f68 6561 6465 7228  ty_token_header(
-00006c20: 2920 696e 2068 6561 6465 7273 3a0a 2020  ) in headers:.  
-00006c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c40: 2020 6c6f 675f 6361 6e6f 6e69 6361 6c5f    log_canonical_
-00006c50: 7374 7269 6e67 203d 2073 7472 2e72 6570  string = str.rep
-00006c60: 6c61 6365 286c 6f67 5f63 616e 6f6e 6963  lace(log_canonic
-00006c70: 616c 5f73 7472 696e 672c 2068 6561 6465  al_string, heade
-00006c80: 7273 5b73 656c 662e 6861 2e73 6563 7572  rs[self.ha.secur
-00006c90: 6974 795f 746f 6b65 6e5f 6865 6164 6572  ity_token_header
-00006ca0: 2829 5d2c 0a20 2020 2020 2020 2020 2020  ()],.           
-00006cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cd0: 2020 2020 2020 2020 2020 2020 222a 2a2a              "***
-00006ce0: 2a2a 2a22 290a 2020 2020 2020 2020 2020  ***").          
-00006cf0: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
-00006d00: 6c69 656e 742e 6c6f 6728 4445 4255 472c  lient.log(DEBUG,
-00006d10: 2027 2573 3a20 2573 2720 2520 2863 6f6e   '%s: %s' % (con
-00006d20: 7374 2e43 414e 4f4e 4943 414c 5f53 5452  st.CANONICAL_STR
-00006d30: 494e 472c 206c 6f67 5f63 616e 6f6e 6963  ING, log_canonic
-00006d40: 616c 5f73 7472 696e 6729 290a 2020 2020  al_string)).    
-00006d50: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
-00006d60: 636f 6e73 742e 4155 5448 4f52 495a 4154  const.AUTHORIZAT
-00006d70: 494f 4e5f 4845 4144 4552 5d20 3d20 7265  ION_HEADER] = re
-00006d80: 745b 636f 6e73 742e 4155 5448 4f52 495a  t[const.AUTHORIZ
-00006d90: 4154 494f 4e5f 4845 4144 4552 5d0a 2020  ATION_HEADER].  
-00006da0: 2020 2020 2020 7265 7475 726e 2068 6561        return hea
-00006db0: 6465 7273 0a0a 2020 2020 6465 6620 5f72  ders..    def _r
-00006dc0: 656e 616d 655f 7265 7175 6573 745f 6865  ename_request_he
-00006dd0: 6164 6572 7328 7365 6c66 2c20 6865 6164  aders(self, head
-00006de0: 6572 732c 206d 6574 686f 6429 3a0a 2020  ers, method):.  
-00006df0: 2020 2020 2020 6e65 775f 6865 6164 6572        new_header
-00006e00: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
-00006e10: 6620 6973 696e 7374 616e 6365 2868 6561  f isinstance(hea
-00006e20: 6465 7273 2c20 6469 6374 293a 0a20 2020  ders, dict):.   
-00006e30: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
-00006e40: 7620 696e 2068 6561 6465 7273 2e69 7465  v in headers.ite
-00006e50: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00006e60: 2020 2020 2020 6966 206b 2069 7320 6e6f        if k is no
-00006e70: 7420 4e6f 6e65 2061 6e64 2076 2069 7320  t None and v is 
-00006e80: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00006e90: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
-00006ea0: 3d20 7574 696c 2e74 6f5f 7374 7269 6e67  = util.to_string
-00006eb0: 286b 292e 7374 7269 7028 290a 2020 2020  (k).strip().    
-00006ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ed0: 6966 206b 2e6c 6f77 6572 2829 206e 6f74  if k.lower() not
-00006ee0: 2069 6e20 636f 6e73 742e 414c 4c4f 5745   in const.ALLOWE
-00006ef0: 445f 5245 5155 4553 545f 4854 5450 5f48  D_REQUEST_HTTP_H
-00006f00: 4541 4445 525f 4d45 5441 4441 5441 5f4e  EADER_METADATA_N
-00006f10: 414d 4553 2061 6e64 206e 6f74 206b 2e6c  AMES and not k.l
-00006f20: 6f77 6572 2829 2e73 7461 7274 7377 6974  ower().startswit
-00006f30: 6828 0a20 2020 2020 2020 2020 2020 2020  h(.             
-00006f40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00006f50: 6f6e 7374 2e56 325f 4845 4144 4552 5f50  onst.V2_HEADER_P
-00006f60: 5245 4649 5829 2061 6e64 206e 6f74 206b  REFIX) and not k
-00006f70: 2e6c 6f77 6572 2829 2e73 7461 7274 7377  .lower().startsw
-00006f80: 6974 6828 636f 6e73 742e 4f42 535f 4845  ith(const.OBS_HE
-00006f90: 4144 4552 5f50 5245 4649 5829 3a0a 2020  ADER_PREFIX):.  
-00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fb0: 2020 2020 2020 6966 206d 6574 686f 6420        if method 
-00006fc0: 6e6f 7420 696e 2028 636f 6e73 742e 4854  not in (const.HT
-00006fd0: 5450 5f4d 4554 484f 445f 5055 542c 2063  TP_METHOD_PUT, c
-00006fe0: 6f6e 7374 2e48 5454 505f 4d45 5448 4f44  onst.HTTP_METHOD
-00006ff0: 5f50 4f53 5429 3a0a 2020 2020 2020 2020  _POST):.        
-00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007010: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00007020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007030: 2020 2020 206b 203d 2073 656c 662e 6861       k = self.ha
-00007040: 2e5f 6765 745f 6d65 7461 5f68 6561 6465  ._get_meta_heade
-00007050: 725f 7072 6566 6978 2829 202b 206b 0a0a  r_prefix() + k..
-00007060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007070: 2020 2020 6966 206b 2e6c 6f77 6572 2829      if k.lower()
-00007080: 2e73 7461 7274 7377 6974 6828 7365 6c66  .startswith(self
-00007090: 2e68 612e 5f67 6574 5f6d 6574 615f 6865  .ha._get_meta_he
-000070a0: 6164 6572 5f70 7265 6669 7828 2929 3a0a  ader_prefix()):.
-000070b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070c0: 2020 2020 2020 2020 6b20 3d20 7574 696c          k = util
-000070d0: 2e65 6e63 6f64 655f 6974 656d 286b 2c20  .encode_item(k, 
-000070e0: 2720 3b2f 3f3a 4026 3d2b 242c 2729 0a0a  ' ;/?:@&=+$,')..
-000070f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007100: 2020 2020 6e65 775f 6865 6164 6572 7320      new_headers 
-00007110: 3d20 7365 6c66 2e5f 7265 6e61 6d65 5f72  = self._rename_r
-00007120: 6571 7565 7374 5f68 6561 6465 7273 5f68  equest_headers_h
-00007130: 616e 646c 6528 6b2c 2076 2c20 6e65 775f  andle(k, v, new_
-00007140: 6865 6164 6572 7329 0a20 2020 2020 2020  headers).       
-00007150: 2072 6574 7572 6e20 6e65 775f 6865 6164   return new_head
-00007160: 6572 730a 0a20 2020 2064 6566 205f 7265  ers..    def _re
-00007170: 6e61 6d65 5f72 6571 7565 7374 5f68 6561  name_request_hea
-00007180: 6465 7273 5f68 616e 646c 6528 7365 6c66  ders_handle(self
-00007190: 2c20 6b2c 2076 2c20 6e65 775f 6865 6164  , k, v, new_head
-000071a0: 6572 7329 3a0a 2020 2020 2020 2020 6966  ers):.        if
-000071b0: 206b 2e6c 6f77 6572 2829 203d 3d20 7365   k.lower() == se
-000071c0: 6c66 2e68 612e 5f67 6574 5f68 6561 6465  lf.ha._get_heade
-000071d0: 725f 7072 6566 6978 2829 202b 2027 636f  r_prefix() + 'co
-000071e0: 7079 2d73 6f75 7263 6527 3a0a 2020 2020  py-source':.    
-000071f0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-00007200: 762e 7266 696e 6428 273f 7665 7273 696f  v.rfind('?versio
-00007210: 6e49 643d 2729 0a20 2020 2020 2020 2020  nId=').         
-00007220: 2020 2069 6620 696e 6465 7820 3e20 303a     if index > 0:
-00007230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007240: 206e 6577 5f68 6561 6465 7273 5b6b 5d20   new_headers[k] 
-00007250: 3d20 7574 696c 2e65 6e63 6f64 655f 6974  = util.encode_it
-00007260: 656d 2876 5b30 3a69 6e64 6578 5d2c 2027  em(v[0:index], '
-00007270: 2f27 2920 2b20 765b 696e 6465 783a 5d0a  /') + v[index:].
-00007280: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00007290: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000072a0: 2020 6e65 775f 6865 6164 6572 735b 6b5d    new_headers[k]
-000072b0: 203d 2075 7469 6c2e 656e 636f 6465 5f69   = util.encode_i
-000072c0: 7465 6d28 762c 2027 2f27 290a 2020 2020  tem(v, '/').    
-000072d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000072e0: 2020 2020 2020 6e65 775f 6865 6164 6572        new_header
-000072f0: 735b 6b5d 203d 2076 2069 6620 2869 7369  s[k] = v if (isi
-00007300: 6e73 7461 6e63 6528 762c 206c 6973 7429  nstance(v, list)
-00007310: 2920 656c 7365 2075 7469 6c2e 656e 636f  ) else util.enco
-00007320: 6465 5f69 7465 6d28 762c 2027 203b 2f3f  de_item(v, ' ;/?
-00007330: 3a40 263d 2b24 2c5c 272a 2729 0a20 2020  :@&=+$,\'*').   
-00007340: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
-00007350: 6865 6164 6572 730a 0a20 2020 2064 6566  headers..    def
-00007360: 205f 6765 745f 7365 7276 6572 5f63 6f6e   _get_server_con
-00007370: 6e65 6374 696f 6e28 7365 6c66 2c20 7365  nection(self, se
-00007380: 7276 6572 2c20 706f 7274 3d4e 6f6e 652c  rver, port=None,
-00007390: 2073 6368 656d 653d 4e6f 6e65 2c20 7265   scheme=None, re
-000073a0: 6469 7265 6374 3d46 616c 7365 2c20 7072  direct=False, pr
-000073b0: 6f78 795f 686f 7374 3d4e 6f6e 652c 2070  oxy_host=None, p
-000073c0: 726f 7879 5f70 6f72 743d 4e6f 6e65 293a  roxy_port=None):
-000073d0: 0a0a 2020 2020 2020 2020 6973 5f73 6563  ..        is_sec
-000073e0: 7572 6520 3d20 7365 6c66 2e69 735f 7365  ure = self.is_se
-000073f0: 6375 7265 2069 6620 7363 6865 6d65 2069  cure if scheme i
-00007400: 7320 4e6f 6e65 2065 6c73 6520 5472 7565  s None else True
-00007410: 2069 6620 7363 6865 6d65 203d 3d20 2768   if scheme == 'h
-00007420: 7474 7073 2720 656c 7365 2046 616c 7365  ttps' else False
-00007430: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00007440: 662e 636f 6e6e 486f 6c64 6572 2069 7320  f.connHolder is 
-00007450: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
-00007460: 2073 656c 662e 636f 6e6e 486f 6c64 6572   self.connHolder
-00007470: 5b27 636f 6e6e 5365 7427 5d2e 656d 7074  ['connSet'].empt
-00007480: 7928 2920 616e 6420 6e6f 7420 7265 6469  y() and not redi
-00007490: 7265 6374 3a0a 2020 2020 2020 2020 2020  rect:.          
-000074a0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000074b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000074c0: 6c66 2e63 6f6e 6e48 6f6c 6465 725b 2763  lf.connHolder['c
-000074d0: 6f6e 6e53 6574 275d 2e67 6574 5f6e 6f77  onnSet'].get_now
-000074e0: 6169 7428 290a 2020 2020 2020 2020 2020  ait().          
-000074f0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00007500: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00007510: 2020 2020 7365 6c66 2e6c 6f67 5f63 6c69      self.log_cli
-00007520: 656e 742e 6c6f 6728 4445 4255 472c 2027  ent.log(DEBUG, '
-00007530: 6361 6e20 6e6f 7420 6765 7420 636f 6e6e  can not get conn
-00007540: 2c20 7769 6c6c 2063 7265 6174 6520 6120  , will create a 
-00007550: 6e65 7720 6f6e 6527 290a 0a20 2020 2020  new one')..     
-00007560: 2020 2069 6620 7365 6c66 2e75 7365 5f68     if self.use_h
-00007570: 7474 7032 3a0a 2020 2020 2020 2020 2020  ttp2:.          
-00007580: 2020 6672 6f6d 206f 6273 2069 6d70 6f72    from obs impor
-00007590: 7420 6874 7470 320a 2020 2020 2020 2020  t http2.        
-000075a0: 2020 2020 636f 6e6e 203d 2068 7474 7032      conn = http2
-000075b0: 2e5f 6765 745f 7365 7276 6572 5f63 6f6e  ._get_server_con
-000075c0: 6e65 6374 696f 6e28 7365 7276 6572 2c20  nection(server, 
-000075d0: 706f 7274 2c20 7365 6c66 2e63 6f6e 7465  port, self.conte
-000075e0: 7874 2c20 6973 5f73 6563 7572 652c 2070  xt, is_secure, p
-000075f0: 726f 7879 5f68 6f73 742c 2070 726f 7879  roxy_host, proxy
-00007600: 5f70 6f72 7429 0a20 2020 2020 2020 2065  _port).        e
-00007610: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00007620: 2063 6f6e 6e20 3d20 7365 6c66 2e5f 6765   conn = self._ge
-00007630: 745f 7365 7276 6572 5f63 6f6e 6e65 6374  t_server_connect
-00007640: 696f 6e5f 7573 655f 6874 7470 3178 2869  ion_use_http1x(i
-00007650: 735f 7365 6375 7265 2c20 7365 7276 6572  s_secure, server
-00007660: 2c20 706f 7274 2c20 7072 6f78 795f 686f  , port, proxy_ho
-00007670: 7374 2c20 7072 6f78 795f 706f 7274 290a  st, proxy_port).
-00007680: 0a20 2020 2020 2020 2069 6620 7265 6469  .        if redi
-00007690: 7265 6374 3a0a 2020 2020 2020 2020 2020  rect:.          
-000076a0: 2020 636f 6e6e 2e5f 636c 6561 7220 3d20    conn._clear = 
-000076b0: 5472 7565 0a0a 2020 2020 2020 2020 7265  True..        re
-000076c0: 7475 726e 2063 6f6e 6e0a 0a20 2020 2064  turn conn..    d
-000076d0: 6566 205f 6765 745f 7365 7276 6572 5f63  ef _get_server_c
-000076e0: 6f6e 6e65 6374 696f 6e5f 7573 655f 6874  onnection_use_ht
-000076f0: 7470 3178 2873 656c 662c 2069 735f 7365  tp1x(self, is_se
-00007700: 6375 7265 2c20 7365 7276 6572 2c20 706f  cure, server, po
-00007710: 7274 2c20 7072 6f78 795f 686f 7374 2c20  rt, proxy_host, 
-00007720: 7072 6f78 795f 706f 7274 293a 0a20 2020  proxy_port):.   
-00007730: 2020 2020 2069 6620 7072 6f78 795f 686f       if proxy_ho
-00007740: 7374 2069 7320 6e6f 7420 4e6f 6e65 2061  st is not None a
-00007750: 6e64 2070 726f 7879 5f70 6f72 7420 6973  nd proxy_port is
-00007760: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00007770: 2020 2020 2020 2073 6572 7665 7220 3d20         server = 
-00007780: 7072 6f78 795f 686f 7374 0a20 2020 2020  proxy_host.     
-00007790: 2020 2020 2020 2070 6f72 7420 3d20 7072         port = pr
-000077a0: 6f78 795f 706f 7274 0a0a 2020 2020 2020  oxy_port..      
-000077b0: 2020 6966 2069 735f 7365 6375 7265 3a0a    if is_secure:.
-000077c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-000077d0: 6f6e 7374 2e49 535f 5059 5448 4f4e 323a  onst.IS_PYTHON2:
-000077e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000077f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00007800: 2020 2020 2020 2020 2020 636f 6e6e 203d            conn =
-00007810: 2068 7474 706c 6962 2e48 5454 5053 436f   httplib.HTTPSCo
-00007820: 6e6e 6563 7469 6f6e 2873 6572 7665 722c  nnection(server,
-00007830: 2070 6f72 743d 706f 7274 2c20 7469 6d65   port=port, time
-00007840: 6f75 743d 7365 6c66 2e74 696d 656f 7574  out=self.timeout
-00007850: 2c20 636f 6e74 6578 743d 7365 6c66 2e63  , context=self.c
-00007860: 6f6e 7465 7874 290a 2020 2020 2020 2020  ontext).        
-00007870: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00007880: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-00007890: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000078a0: 6e6e 203d 2068 7474 706c 6962 2e48 5454  nn = httplib.HTT
-000078b0: 5053 436f 6e6e 6563 7469 6f6e 2873 6572  PSConnection(ser
-000078c0: 7665 722c 2070 6f72 743d 706f 7274 2c20  ver, port=port, 
-000078d0: 7469 6d65 6f75 743d 7365 6c66 2e74 696d  timeout=self.tim
-000078e0: 656f 7574 290a 2020 2020 2020 2020 2020  eout).          
-000078f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00007900: 2020 2020 2020 2020 636f 6e6e 203d 2068          conn = h
-00007910: 7474 706c 6962 2e48 5454 5053 436f 6e6e  ttplib.HTTPSConn
-00007920: 6563 7469 6f6e 2873 6572 7665 722c 2070  ection(server, p
-00007930: 6f72 743d 706f 7274 2c20 7469 6d65 6f75  ort=port, timeou
-00007940: 743d 7365 6c66 2e74 696d 656f 7574 2c20  t=self.timeout, 
-00007950: 636f 6e74 6578 743d 7365 6c66 2e63 6f6e  context=self.con
-00007960: 7465 7874 2c0a 2020 2020 2020 2020 2020  text,.          
-00007970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007990: 2020 2020 2063 6865 636b 5f68 6f73 746e       check_hostn
-000079a0: 616d 653d 4e6f 6e65 290a 2020 2020 2020  ame=None).      
-000079b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000079c0: 2020 2020 636f 6e6e 203d 2068 7474 706c      conn = httpl
-000079d0: 6962 2e48 5454 5043 6f6e 6e65 6374 696f  ib.HTTPConnectio
-000079e0: 6e28 7365 7276 6572 2c20 706f 7274 3d70  n(server, port=p
-000079f0: 6f72 742c 2074 696d 656f 7574 3d73 656c  ort, timeout=sel
-00007a00: 662e 7469 6d65 6f75 7429 0a0a 2020 2020  f.timeout)..    
-00007a10: 2020 2020 7265 7475 726e 2063 6f6e 6e0a      return conn.
-00007a20: 0a20 2020 2064 6566 205f 7365 6e64 5f72  .    def _send_r
-00007a30: 6571 7565 7374 2873 656c 662c 2073 6572  equest(self, ser
-00007a40: 7665 722c 206d 6574 686f 642c 2070 6174  ver, method, pat
-00007a50: 682c 2068 6561 6465 722c 2065 6e74 6974  h, header, entit
-00007a60: 793d 4e6f 6e65 2c20 706f 7274 3d4e 6f6e  y=None, port=Non
-00007a70: 652c 2073 6368 656d 653d 4e6f 6e65 2c20  e, scheme=None, 
-00007a80: 7265 6469 7265 6374 3d46 616c 7365 2c0a  redirect=False,.
-00007a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007aa0: 2020 2020 2020 6368 756e 6b65 644d 6f64        chunkedMod
-00007ab0: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
-00007ac0: 2020 636f 6e6e 203d 204e 6f6e 650a 2020    conn = None.  
-00007ad0: 2020 2020 2020 6865 6164 6572 203d 2068        header = h
-00007ae0: 6561 6465 7220 6f72 207b 7d0a 2020 2020  eader or {}.    
-00007af0: 2020 2020 636f 6e6e 6563 7469 6f6e 5f6b      connection_k
-00007b00: 6579 203d 2063 6f6e 7374 2e43 4f4e 4e45  ey = const.CONNE
-00007b10: 4354 494f 4e5f 4845 4144 4552 0a20 2020  CTION_HEADER.   
-00007b20: 2020 2020 2063 6f6e 6e2c 2068 6561 6465       conn, heade
-00007b30: 7220 3d20 7365 6c66 2e5f 7061 7273 655f  r = self._parse_
-00007b40: 7265 7175 6573 745f 636f 6e6e 6563 7469  request_connecti
-00007b50: 6f6e 2873 6572 7665 722c 2070 6f72 742c  on(server, port,
-00007b60: 2073 6368 656d 652c 2063 6f6e 6e65 6374   scheme, connect
-00007b70: 696f 6e5f 6b65 792c 2072 6564 6972 6563  ion_key, redirec
-00007b80: 742c 2068 6561 6465 7229 0a0a 2020 2020  t, header)..    
-00007b90: 2020 2020 6865 6164 6572 5b63 6f6e 7374      header[const
-00007ba0: 2e55 5345 525f 4147 454e 545f 4845 4144  .USER_AGENT_HEAD
-00007bb0: 4552 5d20 3d20 276f 6273 2d73 646b 2d70  ER] = 'obs-sdk-p
-00007bc0: 7974 686f 6e2f 2720 2b20 636f 6e73 742e  ython/' + const.
-00007bd0: 4f42 535f 5344 4b5f 5645 5253 494f 4e0a  OBS_SDK_VERSION.
-00007be0: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
-00007bf0: 6f64 203d 3d20 636f 6e73 742e 4854 5450  od == const.HTTP
-00007c00: 5f4d 4554 484f 445f 4f50 5449 4f4e 5320  _METHOD_OPTIONS 
-00007c10: 616e 6420 6e6f 7420 7365 6c66 2e75 7365  and not self.use
-00007c20: 5f68 7474 7032 3a0a 2020 2020 2020 2020  _http2:.        
-00007c30: 2020 2020 636f 6e6e 2e70 7574 7265 7175      conn.putrequ
-00007c40: 6573 7428 6d65 7468 6f64 2c20 7061 7468  est(method, path
-00007c50: 2c20 736b 6970 5f68 6f73 743d 3129 0a20  , skip_host=1). 
-00007c60: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-00007c70: 2c20 7620 696e 2068 6561 6465 722e 6974  , v in header.it
-00007c80: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00007c90: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00007ca0: 616e 6365 2876 2c20 6c69 7374 293a 0a20  ance(v, list):. 
-00007cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007cc0: 2020 2066 6f72 2069 7465 6d20 696e 2076     for item in v
-00007cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007ce0: 2020 2020 2020 2020 2020 636f 6e6e 2e70            conn.p
-00007cf0: 7574 6865 6164 6572 286b 2c20 6974 656d  utheader(k, item
-00007d00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00007d10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00007d20: 2020 2020 2020 2020 2020 2020 636f 6e6e              conn
-00007d30: 2e70 7574 6865 6164 6572 286b 2c20 7629  .putheader(k, v)
-00007d40: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00007d50: 6e2e 656e 6468 6561 6465 7273 2829 0a20  n.endheaders(). 
-00007d60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00007d70: 2020 2020 2020 2020 2069 6620 6368 756e           if chun
-00007d80: 6b65 644d 6f64 653a 0a20 2020 2020 2020  kedMode:.       
-00007d90: 2020 2020 2020 2020 2068 6561 6465 725b           header[
-00007da0: 636f 6e73 742e 5452 414e 5346 4552 5f45  const.TRANSFER_E
-00007db0: 4e43 4f44 494e 475f 4845 4144 4552 5d20  NCODING_HEADER] 
-00007dc0: 3d20 636f 6e73 742e 5452 414e 5346 4552  = const.TRANSFER
-00007dd0: 5f45 4e43 4f44 494e 475f 5641 4c55 450a  _ENCODING_VALUE.
-00007de0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00007df0: 7365 6c66 2e75 7365 5f68 7474 7032 3a0a  self.use_http2:.
-00007e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e10: 636f 6e6e 2e72 6571 7565 7374 286d 6574  conn.request(met
-00007e20: 686f 642c 2070 6174 682c 2062 6f64 793d  hod, path, body=
-00007e30: 656e 7469 7479 2c20 6865 6164 6572 733d  entity, headers=
-00007e40: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
-00007e50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00007e60: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00007e70: 7061 7273 655f 636f 6e6e 6563 7469 6f6e  parse_connection
-00007e80: 5f63 6875 6e6b 6564 5f6d 6f64 6528 636f  _chunked_mode(co
-00007e90: 6e6e 2c20 6368 756e 6b65 644d 6f64 652c  nn, chunkedMode,
-00007ea0: 206d 6574 686f 642c 2070 6174 682c 2068   method, path, h
-00007eb0: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
-00007ec0: 2020 2020 2020 2069 6620 656e 7469 7479         if entity
-00007ed0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00006940: 2020 2020 2020 2020 2020 2022 2a2a 2a2a             "****
+00006950: 2a2a 2229 0a20 2020 2020 2020 2020 2020  **").           
+00006960: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
+00006970: 6965 6e74 2e6c 6f67 2844 4542 5547 2c20  ient.log(DEBUG, 
+00006980: 2725 733a 2025 7327 2025 2028 636f 6e73  '%s: %s' % (cons
+00006990: 742e 4341 4e4f 4e49 4341 4c5f 5245 5155  t.CANONICAL_REQU
+000069a0: 4553 542c 206c 6f67 5f63 616e 6f6e 6963  EST, log_canonic
+000069b0: 616c 5f72 6571 7565 7374 2929 0a20 2020  al_request)).   
+000069c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000069d0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000069e0: 6273 4175 7468 203d 2061 7574 682e 4175  bsAuth = auth.Au
+000069f0: 7468 656e 7469 6361 7469 6f6e 2861 6b2c  thentication(ak,
+00006a00: 2073 6b2c 2073 656c 662e 7061 7468 5f73   sk, self.path_s
+00006a10: 7479 6c65 2c20 7365 6c66 2e68 612c 2073  tyle, self.ha, s
+00006a20: 656c 662e 7365 7276 6572 2c20 7365 6c66  elf.server, self
+00006a30: 2e69 735f 636e 616d 6529 0a20 2020 2020  .is_cname).     
+00006a40: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
+00006a50: 206f 6273 4175 7468 2e64 6f41 7574 6828   obsAuth.doAuth(
+00006a60: 6d65 7468 6f64 2c20 6275 636b 6574 4e61  method, bucketNa
+00006a70: 6d65 2c20 6f62 6a65 6374 4b65 792c 2070  me, objectKey, p
+00006a80: 6174 6841 7267 732c 2068 6561 6465 7273  athArgs, headers
+00006a90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00006aa0: 2020 6c6f 675f 6361 6e6f 6e69 6361 6c5f    log_canonical_
+00006ab0: 7374 7269 6e67 203d 2072 6574 5b63 6f6e  string = ret[con
+00006ac0: 7374 2e43 414e 4f4e 4943 414c 5f53 5452  st.CANONICAL_STR
+00006ad0: 494e 475d 0a20 2020 2020 2020 2020 2020  ING].           
+00006ae0: 2020 2020 2069 6620 7365 6c66 2e68 612e       if self.ha.
+00006af0: 7365 6375 7269 7479 5f74 6f6b 656e 5f68  security_token_h
+00006b00: 6561 6465 7228 2920 696e 2068 6561 6465  eader() in heade
+00006b10: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00006b20: 2020 2020 2020 2020 6c6f 675f 6361 6e6f          log_cano
+00006b30: 6e69 6361 6c5f 7374 7269 6e67 203d 2073  nical_string = s
+00006b40: 7472 2e72 6570 6c61 6365 286c 6f67 5f63  tr.replace(log_c
+00006b50: 616e 6f6e 6963 616c 5f73 7472 696e 672c  anonical_string,
+00006b60: 2068 6561 6465 7273 5b73 656c 662e 6861   headers[self.ha
+00006b70: 2e73 6563 7572 6974 795f 746f 6b65 6e5f  .security_token_
+00006b80: 6865 6164 6572 2829 5d2c 0a20 2020 2020  header()],.     
+00006b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bc0: 2020 222a 2a2a 2a2a 2a22 290a 2020 2020    "******").    
+00006bd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006be0: 2e6c 6f67 5f63 6c69 656e 742e 6c6f 6728  .log_client.log(
+00006bf0: 4445 4255 472c 2027 2573 3a20 2573 2720  DEBUG, '%s: %s' 
+00006c00: 2520 2863 6f6e 7374 2e43 414e 4f4e 4943  % (const.CANONIC
+00006c10: 414c 5f53 5452 494e 472c 206c 6f67 5f63  AL_STRING, log_c
+00006c20: 616e 6f6e 6963 616c 5f73 7472 696e 6729  anonical_string)
+00006c30: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
+00006c40: 6164 6572 735b 636f 6e73 742e 4155 5448  aders[const.AUTH
+00006c50: 4f52 495a 4154 494f 4e5f 4845 4144 4552  ORIZATION_HEADER
+00006c60: 5d20 3d20 7265 745b 636f 6e73 742e 4155  ] = ret[const.AU
+00006c70: 5448 4f52 495a 4154 494f 4e5f 4845 4144  THORIZATION_HEAD
+00006c80: 4552 5d0a 2020 2020 2020 2020 7265 7475  ER].        retu
+00006c90: 726e 2068 6561 6465 7273 0a0a 2020 2020  rn headers..    
+00006ca0: 6465 6620 5f72 656e 616d 655f 7265 7175  def _rename_requ
+00006cb0: 6573 745f 6865 6164 6572 7328 7365 6c66  est_headers(self
+00006cc0: 2c20 6865 6164 6572 732c 2065 7874 656e  , headers, exten
+00006cd0: 7369 6f6e 5f68 6561 6465 7273 2c20 6d65  sion_headers, me
+00006ce0: 7468 6f64 293a 0a20 2020 2020 2020 206e  thod):.        n
+00006cf0: 6577 5f68 6561 6465 7273 203d 207b 7d0a  ew_headers = {}.
+00006d00: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00006d10: 7461 6e63 6528 6865 6164 6572 732c 2064  tance(headers, d
+00006d20: 6963 7429 3a0a 2020 2020 2020 2020 2020  ict):.          
+00006d30: 2020 666f 7220 6b2c 2076 2069 6e20 6865    for k, v in he
+00006d40: 6164 6572 732e 6974 656d 7328 293a 0a20  aders.items():. 
+00006d50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00006d60: 6620 6b20 6973 206e 6f74 204e 6f6e 6520  f k is not None 
+00006d70: 616e 6420 7620 6973 206e 6f74 204e 6f6e  and v is not Non
+00006d80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00006d90: 2020 2020 2020 206b 203d 2075 7469 6c2e         k = util.
+00006da0: 746f 5f73 7472 696e 6728 6b29 2e73 7472  to_string(k).str
+00006db0: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
+00006dc0: 2020 2020 2020 2020 2069 6620 6b2e 6c6f           if k.lo
+00006dd0: 7765 7228 2920 6e6f 7420 696e 2063 6f6e  wer() not in con
+00006de0: 7374 2e41 4c4c 4f57 4544 5f52 4551 5545  st.ALLOWED_REQUE
+00006df0: 5354 5f48 5454 505f 4845 4144 4552 5f4d  ST_HTTP_HEADER_M
+00006e00: 4554 4144 4154 415f 4e41 4d45 5320 616e  ETADATA_NAMES an
+00006e10: 6420 6e6f 7420 6b2e 6c6f 7765 7228 292e  d not k.lower().
+00006e20: 7374 6172 7473 7769 7468 280a 2020 2020  startswith(.    
+00006e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e40: 2020 2020 2020 2020 636f 6e73 742e 5632          const.V2
+00006e50: 5f48 4541 4445 525f 5052 4546 4958 2920  _HEADER_PREFIX) 
+00006e60: 616e 6420 6e6f 7420 6b2e 6c6f 7765 7228  and not k.lower(
+00006e70: 292e 7374 6172 7473 7769 7468 2863 6f6e  ).startswith(con
+00006e80: 7374 2e4f 4253 5f48 4541 4445 525f 5052  st.OBS_HEADER_PR
+00006e90: 4546 4958 293a 0a20 2020 2020 2020 2020  EFIX):.         
+00006ea0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00006eb0: 6620 6d65 7468 6f64 206e 6f74 2069 6e20  f method not in 
+00006ec0: 2863 6f6e 7374 2e48 5454 505f 4d45 5448  (const.HTTP_METH
+00006ed0: 4f44 5f50 5554 2c20 636f 6e73 742e 4854  OD_PUT, const.HT
+00006ee0: 5450 5f4d 4554 484f 445f 504f 5354 293a  TP_METHOD_POST):
+00006ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006f00: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00006f10: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00006f20: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
+00006f30: 3d20 7365 6c66 2e68 612e 5f67 6574 5f6d  = self.ha._get_m
+00006f40: 6574 615f 6865 6164 6572 5f70 7265 6669  eta_header_prefi
+00006f50: 7828 2920 2b20 6b0a 0a20 2020 2020 2020  x() + k..       
+00006f60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00006f70: 6b2e 6c6f 7765 7228 292e 7374 6172 7473  k.lower().starts
+00006f80: 7769 7468 2873 656c 662e 6861 2e5f 6765  with(self.ha._ge
+00006f90: 745f 6d65 7461 5f68 6561 6465 725f 7072  t_meta_header_pr
+00006fa0: 6566 6978 2829 293a 0a20 2020 2020 2020  efix()):.       
+00006fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fc0: 206b 203d 2075 7469 6c2e 656e 636f 6465   k = util.encode
+00006fd0: 5f69 7465 6d28 6b2c 2027 203b 2f3f 3a40  _item(k, ' ;/?:@
+00006fe0: 263d 2b24 2c27 290a 0a20 2020 2020 2020  &=+$,')..       
+00006ff0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00007000: 5f68 6561 6465 7273 203d 2073 656c 662e  _headers = self.
+00007010: 5f72 656e 616d 655f 7265 7175 6573 745f  _rename_request_
+00007020: 6865 6164 6572 735f 6861 6e64 6c65 286b  headers_handle(k
+00007030: 2c20 762c 206e 6577 5f68 6561 6465 7273  , v, new_headers
+00007040: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00007050: 7220 6b2c 2076 2069 6e20 6578 7465 6e73  r k, v in extens
+00007060: 696f 6e5f 6865 6164 6572 732e 6974 656d  ion_headers.item
+00007070: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00007080: 2020 2020 206e 6577 5f68 6561 6465 7273       new_headers
+00007090: 203d 2073 656c 662e 5f72 656e 616d 655f   = self._rename_
+000070a0: 7265 7175 6573 745f 6865 6164 6572 735f  request_headers_
+000070b0: 6861 6e64 6c65 286b 2c20 762c 206e 6577  handle(k, v, new
+000070c0: 5f68 6561 6465 7273 290a 2020 2020 2020  _headers).      
+000070d0: 2020 7265 7475 726e 206e 6577 5f68 6561    return new_hea
+000070e0: 6465 7273 0a0a 2020 2020 6465 6620 5f72  ders..    def _r
+000070f0: 656e 616d 655f 7265 7175 6573 745f 6865  ename_request_he
+00007100: 6164 6572 735f 6861 6e64 6c65 2873 656c  aders_handle(sel
+00007110: 662c 206b 2c20 762c 206e 6577 5f68 6561  f, k, v, new_hea
+00007120: 6465 7273 293a 0a20 2020 2020 2020 2069  ders):.        i
+00007130: 6620 6b2e 6c6f 7765 7228 2920 3d3d 2073  f k.lower() == s
+00007140: 656c 662e 6861 2e5f 6765 745f 6865 6164  elf.ha._get_head
+00007150: 6572 5f70 7265 6669 7828 2920 2b20 2763  er_prefix() + 'c
+00007160: 6f70 792d 736f 7572 6365 273a 0a20 2020  opy-source':.   
+00007170: 2020 2020 2020 2020 2069 6e64 6578 203d           index =
+00007180: 2076 2e72 6669 6e64 2827 3f76 6572 7369   v.rfind('?versi
+00007190: 6f6e 4964 3d27 290a 2020 2020 2020 2020  onId=').        
+000071a0: 2020 2020 6966 2069 6e64 6578 203e 2030      if index > 0
+000071b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000071c0: 2020 6e65 775f 6865 6164 6572 735b 6b5d    new_headers[k]
+000071d0: 203d 2075 7469 6c2e 656e 636f 6465 5f69   = util.encode_i
+000071e0: 7465 6d28 765b 303a 696e 6465 785d 2c20  tem(v[0:index], 
+000071f0: 272f 2729 202b 2076 5b69 6e64 6578 3a5d  '/') + v[index:]
+00007200: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00007210: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00007220: 2020 206e 6577 5f68 6561 6465 7273 5b6b     new_headers[k
+00007230: 5d20 3d20 7574 696c 2e65 6e63 6f64 655f  ] = util.encode_
+00007240: 6974 656d 2876 2c20 272f 2729 0a20 2020  item(v, '/').   
+00007250: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00007260: 2020 2020 2020 206e 6577 5f68 6561 6465         new_heade
+00007270: 7273 5b6b 5d20 3d20 7620 6966 2028 6973  rs[k] = v if (is
+00007280: 696e 7374 616e 6365 2876 2c20 6c69 7374  instance(v, list
+00007290: 2929 2065 6c73 6520 7574 696c 2e65 6e63  )) else util.enc
+000072a0: 6f64 655f 6974 656d 2876 2c20 2720 3b2f  ode_item(v, ' ;/
+000072b0: 3f3a 4026 3d2b 242c 5c27 2a27 290a 2020  ?:@&=+$,\'*').  
+000072c0: 2020 2020 2020 7265 7475 726e 206e 6577        return new
+000072d0: 5f68 6561 6465 7273 0a0a 2020 2020 6465  _headers..    de
+000072e0: 6620 5f67 6574 5f73 6572 7665 725f 636f  f _get_server_co
+000072f0: 6e6e 6563 7469 6f6e 2873 656c 662c 2073  nnection(self, s
+00007300: 6572 7665 722c 2070 6f72 743d 4e6f 6e65  erver, port=None
+00007310: 2c20 7363 6865 6d65 3d4e 6f6e 652c 2072  , scheme=None, r
+00007320: 6564 6972 6563 743d 4661 6c73 652c 2070  edirect=False, p
+00007330: 726f 7879 5f68 6f73 743d 4e6f 6e65 2c20  roxy_host=None, 
+00007340: 7072 6f78 795f 706f 7274 3d4e 6f6e 6529  proxy_port=None)
+00007350: 3a0a 0a20 2020 2020 2020 2069 735f 7365  :..        is_se
+00007360: 6375 7265 203d 2073 656c 662e 6973 5f73  cure = self.is_s
+00007370: 6563 7572 6520 6966 2073 6368 656d 6520  ecure if scheme 
+00007380: 6973 204e 6f6e 6520 656c 7365 2054 7275  is None else Tru
+00007390: 6520 6966 2073 6368 656d 6520 3d3d 2027  e if scheme == '
+000073a0: 6874 7470 7327 2065 6c73 6520 4661 6c73  https' else Fals
+000073b0: 650a 0a20 2020 2020 2020 2069 6620 7365  e..        if se
+000073c0: 6c66 2e63 6f6e 6e48 6f6c 6465 7220 6973  lf.connHolder is
+000073d0: 206e 6f74 204e 6f6e 6520 616e 6420 6e6f   not None and no
+000073e0: 7420 7365 6c66 2e63 6f6e 6e48 6f6c 6465  t self.connHolde
+000073f0: 725b 2763 6f6e 6e53 6574 275d 2e65 6d70  r['connSet'].emp
+00007400: 7479 2829 2061 6e64 206e 6f74 2072 6564  ty() and not red
+00007410: 6972 6563 743a 0a20 2020 2020 2020 2020  irect:.         
+00007420: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00007430: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00007440: 656c 662e 636f 6e6e 486f 6c64 6572 5b27  elf.connHolder['
+00007450: 636f 6e6e 5365 7427 5d2e 6765 745f 6e6f  connSet'].get_no
+00007460: 7761 6974 2829 0a20 2020 2020 2020 2020  wait().         
+00007470: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00007480: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00007490: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
+000074a0: 6965 6e74 2e6c 6f67 2844 4542 5547 2c20  ient.log(DEBUG, 
+000074b0: 2763 616e 206e 6f74 2067 6574 2063 6f6e  'can not get con
+000074c0: 6e2c 2077 696c 6c20 6372 6561 7465 2061  n, will create a
+000074d0: 206e 6577 206f 6e65 2729 0a0a 2020 2020   new one')..    
+000074e0: 2020 2020 6966 2073 656c 662e 7573 655f      if self.use_
+000074f0: 6874 7470 323a 0a20 2020 2020 2020 2020  http2:.         
+00007500: 2020 2066 726f 6d20 6f62 7320 696d 706f     from obs impo
+00007510: 7274 2068 7474 7032 0a20 2020 2020 2020  rt http2.       
+00007520: 2020 2020 2063 6f6e 6e20 3d20 6874 7470       conn = http
+00007530: 322e 5f67 6574 5f73 6572 7665 725f 636f  2._get_server_co
+00007540: 6e6e 6563 7469 6f6e 2873 6572 7665 722c  nnection(server,
+00007550: 2070 6f72 742c 2073 656c 662e 636f 6e74   port, self.cont
+00007560: 6578 742c 2069 735f 7365 6375 7265 2c20  ext, is_secure, 
+00007570: 7072 6f78 795f 686f 7374 2c20 7072 6f78  proxy_host, prox
+00007580: 795f 706f 7274 290a 2020 2020 2020 2020  y_port).        
+00007590: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000075a0: 2020 636f 6e6e 203d 2073 656c 662e 5f67    conn = self._g
+000075b0: 6574 5f73 6572 7665 725f 636f 6e6e 6563  et_server_connec
+000075c0: 7469 6f6e 5f75 7365 5f68 7474 7031 7828  tion_use_http1x(
+000075d0: 6973 5f73 6563 7572 652c 2073 6572 7665  is_secure, serve
+000075e0: 722c 2070 6f72 742c 2070 726f 7879 5f68  r, port, proxy_h
+000075f0: 6f73 742c 2070 726f 7879 5f70 6f72 7429  ost, proxy_port)
+00007600: 0a0a 2020 2020 2020 2020 6966 2072 6564  ..        if red
+00007610: 6972 6563 743a 0a20 2020 2020 2020 2020  irect:.         
+00007620: 2020 2063 6f6e 6e2e 5f63 6c65 6172 203d     conn._clear =
+00007630: 2054 7275 650a 0a20 2020 2020 2020 2072   True..        r
+00007640: 6574 7572 6e20 636f 6e6e 0a0a 2020 2020  eturn conn..    
+00007650: 6465 6620 5f67 6574 5f73 6572 7665 725f  def _get_server_
+00007660: 636f 6e6e 6563 7469 6f6e 5f75 7365 5f68  connection_use_h
+00007670: 7474 7031 7828 7365 6c66 2c20 6973 5f73  ttp1x(self, is_s
+00007680: 6563 7572 652c 2073 6572 7665 722c 2070  ecure, server, p
+00007690: 6f72 742c 2070 726f 7879 5f68 6f73 742c  ort, proxy_host,
+000076a0: 2070 726f 7879 5f70 6f72 7429 3a0a 2020   proxy_port):.  
+000076b0: 2020 2020 2020 6966 2070 726f 7879 5f68        if proxy_h
+000076c0: 6f73 7420 6973 206e 6f74 204e 6f6e 6520  ost is not None 
+000076d0: 616e 6420 7072 6f78 795f 706f 7274 2069  and proxy_port i
+000076e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000076f0: 2020 2020 2020 2020 7365 7276 6572 203d          server =
+00007700: 2070 726f 7879 5f68 6f73 740a 2020 2020   proxy_host.    
+00007710: 2020 2020 2020 2020 706f 7274 203d 2070          port = p
+00007720: 726f 7879 5f70 6f72 740a 0a20 2020 2020  roxy_port..     
+00007730: 2020 2069 6620 6973 5f73 6563 7572 653a     if is_secure:
+00007740: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00007750: 636f 6e73 742e 4953 5f50 5954 484f 4e32  const.IS_PYTHON2
+00007760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007770: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00007780: 2020 2020 2020 2020 2020 2063 6f6e 6e20             conn 
+00007790: 3d20 6874 7470 6c69 622e 4854 5450 5343  = httplib.HTTPSC
+000077a0: 6f6e 6e65 6374 696f 6e28 7365 7276 6572  onnection(server
+000077b0: 2c20 706f 7274 3d70 6f72 742c 2074 696d  , port=port, tim
+000077c0: 656f 7574 3d73 656c 662e 7469 6d65 6f75  eout=self.timeou
+000077d0: 742c 2063 6f6e 7465 7874 3d73 656c 662e  t, context=self.
+000077e0: 636f 6e74 6578 7429 0a20 2020 2020 2020  context).       
+000077f0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00007800: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00007810: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00007820: 6f6e 6e20 3d20 6874 7470 6c69 622e 4854  onn = httplib.HT
+00007830: 5450 5343 6f6e 6e65 6374 696f 6e28 7365  TPSConnection(se
+00007840: 7276 6572 2c20 706f 7274 3d70 6f72 742c  rver, port=port,
+00007850: 2074 696d 656f 7574 3d73 656c 662e 7469   timeout=self.ti
+00007860: 6d65 6f75 7429 0a20 2020 2020 2020 2020  meout).         
+00007870: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00007880: 2020 2020 2020 2020 2063 6f6e 6e20 3d20           conn = 
+00007890: 6874 7470 6c69 622e 4854 5450 5343 6f6e  httplib.HTTPSCon
+000078a0: 6e65 6374 696f 6e28 7365 7276 6572 2c20  nection(server, 
+000078b0: 706f 7274 3d70 6f72 742c 2074 696d 656f  port=port, timeo
+000078c0: 7574 3d73 656c 662e 7469 6d65 6f75 742c  ut=self.timeout,
+000078d0: 2063 6f6e 7465 7874 3d73 656c 662e 636f   context=self.co
+000078e0: 6e74 6578 742c 0a20 2020 2020 2020 2020  ntext,.         
+000078f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007910: 2020 2020 2020 6368 6563 6b5f 686f 7374        check_host
+00007920: 6e61 6d65 3d4e 6f6e 6529 0a20 2020 2020  name=None).     
+00007930: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00007940: 2020 2020 2063 6f6e 6e20 3d20 6874 7470       conn = http
+00007950: 6c69 622e 4854 5450 436f 6e6e 6563 7469  lib.HTTPConnecti
+00007960: 6f6e 2873 6572 7665 722c 2070 6f72 743d  on(server, port=
+00007970: 706f 7274 2c20 7469 6d65 6f75 743d 7365  port, timeout=se
+00007980: 6c66 2e74 696d 656f 7574 290a 0a20 2020  lf.timeout)..   
+00007990: 2020 2020 2072 6574 7572 6e20 636f 6e6e       return conn
+000079a0: 0a0a 2020 2020 6465 6620 5f73 656e 645f  ..    def _send_
+000079b0: 7265 7175 6573 7428 7365 6c66 2c20 7365  request(self, se
+000079c0: 7276 6572 2c20 6d65 7468 6f64 2c20 7061  rver, method, pa
+000079d0: 7468 2c20 6865 6164 6572 2c20 656e 7469  th, header, enti
+000079e0: 7479 3d4e 6f6e 652c 2070 6f72 743d 4e6f  ty=None, port=No
+000079f0: 6e65 2c20 7363 6865 6d65 3d4e 6f6e 652c  ne, scheme=None,
+00007a00: 2072 6564 6972 6563 743d 4661 6c73 652c   redirect=False,
+00007a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007a20: 2020 2020 2020 2063 6875 6e6b 6564 4d6f         chunkedMo
+00007a30: 6465 3d46 616c 7365 293a 0a20 2020 2020  de=False):.     
+00007a40: 2020 2063 6f6e 6e20 3d20 4e6f 6e65 0a20     conn = None. 
+00007a50: 2020 2020 2020 2068 6561 6465 7220 3d20         header = 
+00007a60: 6865 6164 6572 206f 7220 7b7d 0a20 2020  header or {}.   
+00007a70: 2020 2020 2063 6f6e 6e65 6374 696f 6e5f       connection_
+00007a80: 6b65 7920 3d20 636f 6e73 742e 434f 4e4e  key = const.CONN
+00007a90: 4543 5449 4f4e 5f48 4541 4445 520a 2020  ECTION_HEADER.  
+00007aa0: 2020 2020 2020 636f 6e6e 2c20 6865 6164        conn, head
+00007ab0: 6572 203d 2073 656c 662e 5f70 6172 7365  er = self._parse
+00007ac0: 5f72 6571 7565 7374 5f63 6f6e 6e65 6374  _request_connect
+00007ad0: 696f 6e28 7365 7276 6572 2c20 706f 7274  ion(server, port
+00007ae0: 2c20 7363 6865 6d65 2c20 636f 6e6e 6563  , scheme, connec
+00007af0: 7469 6f6e 5f6b 6579 2c20 7265 6469 7265  tion_key, redire
+00007b00: 6374 2c20 6865 6164 6572 290a 0a20 2020  ct, header)..   
+00007b10: 2020 2020 2068 6561 6465 725b 636f 6e73       header[cons
+00007b20: 742e 5553 4552 5f41 4745 4e54 5f48 4541  t.USER_AGENT_HEA
+00007b30: 4445 525d 203d 2027 6f62 732d 7364 6b2d  DER] = 'obs-sdk-
+00007b40: 7079 7468 6f6e 2f27 202b 2063 6f6e 7374  python/' + const
+00007b50: 2e4f 4253 5f53 444b 5f56 4552 5349 4f4e  .OBS_SDK_VERSION
+00007b60: 0a0a 2020 2020 2020 2020 6966 206d 6574  ..        if met
+00007b70: 686f 6420 3d3d 2063 6f6e 7374 2e48 5454  hod == const.HTT
+00007b80: 505f 4d45 5448 4f44 5f4f 5054 494f 4e53  P_METHOD_OPTIONS
+00007b90: 2061 6e64 206e 6f74 2073 656c 662e 7573   and not self.us
+00007ba0: 655f 6874 7470 323a 0a20 2020 2020 2020  e_http2:.       
+00007bb0: 2020 2020 2063 6f6e 6e2e 7075 7472 6571       conn.putreq
+00007bc0: 7565 7374 286d 6574 686f 642c 2070 6174  uest(method, pat
+00007bd0: 682c 2073 6b69 705f 686f 7374 3d31 290a  h, skip_host=1).
+00007be0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00007bf0: 6b2c 2076 2069 6e20 6865 6164 6572 2e69  k, v in header.i
+00007c00: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00007c10: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00007c20: 7461 6e63 6528 762c 206c 6973 7429 3a0a  tance(v, list):.
+00007c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c40: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
+00007c50: 763a 0a20 2020 2020 2020 2020 2020 2020  v:.             
+00007c60: 2020 2020 2020 2020 2020 2063 6f6e 6e2e             conn.
+00007c70: 7075 7468 6561 6465 7228 6b2c 2069 7465  putheader(k, ite
+00007c80: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
+00007c90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00007ca0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00007cb0: 6e2e 7075 7468 6561 6465 7228 6b2c 2076  n.putheader(k, v
+00007cc0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+00007cd0: 6e6e 2e65 6e64 6865 6164 6572 7328 290a  nn.endheaders().
+00007ce0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00007cf0: 2020 2020 2020 2020 2020 6966 2063 6875            if chu
+00007d00: 6e6b 6564 4d6f 6465 3a0a 2020 2020 2020  nkedMode:.      
+00007d10: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00007d20: 5b63 6f6e 7374 2e54 5241 4e53 4645 525f  [const.TRANSFER_
+00007d30: 454e 434f 4449 4e47 5f48 4541 4445 525d  ENCODING_HEADER]
+00007d40: 203d 2063 6f6e 7374 2e54 5241 4e53 4645   = const.TRANSFE
+00007d50: 525f 454e 434f 4449 4e47 5f56 414c 5545  R_ENCODING_VALUE
+00007d60: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00007d70: 2073 656c 662e 7573 655f 6874 7470 323a   self.use_http2:
+00007d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007d90: 2063 6f6e 6e2e 7265 7175 6573 7428 6d65   conn.request(me
+00007da0: 7468 6f64 2c20 7061 7468 2c20 626f 6479  thod, path, body
+00007db0: 3d65 6e74 6974 792c 2068 6561 6465 7273  =entity, headers
+00007dc0: 3d68 6561 6465 7229 0a20 2020 2020 2020  =header).       
+00007dd0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00007de0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007df0: 5f70 6172 7365 5f63 6f6e 6e65 6374 696f  _parse_connectio
+00007e00: 6e5f 6368 756e 6b65 645f 6d6f 6465 2863  n_chunked_mode(c
+00007e10: 6f6e 6e2c 2063 6875 6e6b 6564 4d6f 6465  onn, chunkedMode
+00007e20: 2c20 6d65 7468 6f64 2c20 7061 7468 2c20  , method, path, 
+00007e30: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
+00007e40: 2020 2020 2020 2020 6966 2065 6e74 6974          if entit
+00007e50: 7920 6973 206e 6f74 204e 6f6e 653a 0a20  y is not None:. 
+00007e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007e70: 2020 2069 6620 6361 6c6c 6162 6c65 2865     if callable(e
+00007e80: 6e74 6974 7929 3a0a 2020 2020 2020 2020  ntity):.        
+00007e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ea0: 656e 7469 7479 2875 7469 6c2e 636f 6e6e  entity(util.conn
+00007eb0: 5f64 656c 6567 6174 6528 636f 6e6e 2929  _delegate(conn))
+00007ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007ed0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
 00007ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ef0: 2020 6966 2063 616c 6c61 626c 6528 656e    if callable(en
-00007f00: 7469 7479 293a 0a20 2020 2020 2020 2020  tity):.         
-00007f10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00007f20: 6e74 6974 7928 7574 696c 2e63 6f6e 6e5f  ntity(util.conn_
-00007f30: 6465 6c65 6761 7465 2863 6f6e 6e29 290a  delegate(conn)).
-00007f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00007f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f70: 2020 636f 6e6e 2e73 656e 6428 656e 7469    conn.send(enti
-00007f80: 7479 290a 2020 2020 2020 2020 2020 2020  ty).            
-00007f90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007fa0: 2e6c 6f67 5f63 6c69 656e 742e 6c6f 6728  .log_client.log(
-00007fb0: 4445 4255 472c 2027 7265 7175 6573 7420  DEBUG, 'request 
-00007fc0: 636f 6e74 656e 743a 2573 272c 2075 7469  content:%s', uti
-00007fd0: 6c2e 746f 5f73 7472 696e 6728 656e 7469  l.to_string(enti
-00007fe0: 7479 2929 0a20 2020 2020 2020 2072 6574  ty)).        ret
-00007ff0: 7572 6e20 636f 6e6e 0a0a 2020 2020 6465  urn conn..    de
-00008000: 6620 5f70 6172 7365 5f72 6571 7565 7374  f _parse_request
-00008010: 5f63 6f6e 6e65 6374 696f 6e28 7365 6c66  _connection(self
-00008020: 2c20 7365 7276 6572 2c20 706f 7274 2c20  , server, port, 
-00008030: 7363 6865 6d65 2c20 636f 6e6e 6563 7469  scheme, connecti
-00008040: 6f6e 5f6b 6579 2c20 7265 6469 7265 6374  on_key, redirect
-00008050: 2c20 6865 6164 6572 293a 0a20 2020 2020  , header):.     
-00008060: 2020 2069 6620 7365 6c66 2e70 726f 7879     if self.proxy
-00008070: 5f68 6f73 7420 6973 206e 6f74 204e 6f6e  _host is not Non
-00008080: 6520 616e 6420 7365 6c66 2e70 726f 7879  e and self.proxy
-00008090: 5f70 6f72 7420 6973 206e 6f74 204e 6f6e  _port is not Non
-000080a0: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-000080b0: 6f6e 6e20 3d20 7365 6c66 2e5f 6765 745f  onn = self._get_
-000080c0: 7365 7276 6572 5f63 6f6e 6e65 6374 696f  server_connectio
-000080d0: 6e28 7365 7276 6572 2c20 706f 7274 2c20  n(server, port, 
-000080e0: 7363 6865 6d65 2c20 7265 6469 7265 6374  scheme, redirect
-000080f0: 2c20 7574 696c 2e74 6f5f 7374 7269 6e67  , util.to_string
-00008100: 2873 656c 662e 7072 6f78 795f 686f 7374  (self.proxy_host
-00008110: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00008120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008140: 2020 7574 696c 2e74 6f5f 696e 7428 7365    util.to_int(se
-00008150: 6c66 2e70 726f 7879 5f70 6f72 7429 290a  lf.proxy_port)).
-00008160: 2020 2020 2020 2020 2020 2020 5f68 6561              _hea
-00008170: 6465 7220 3d20 7b7d 0a20 2020 2020 2020  der = {}.       
-00008180: 2020 2020 2069 6620 7365 6c66 2e70 726f       if self.pro
-00008190: 7879 5f75 7365 726e 616d 6520 6973 206e  xy_username is n
-000081a0: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
-000081b0: 2e70 726f 7879 5f70 6173 7377 6f72 6420  .proxy_password 
-000081c0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000081d0: 2020 2020 2020 2020 2020 2020 205f 6865               _he
-000081e0: 6164 6572 5b63 6f6e 7374 2e50 524f 5859  ader[const.PROXY
-000081f0: 5f41 5554 484f 5249 5a41 5449 4f4e 5f48  _AUTHORIZATION_H
-00008200: 4541 4445 525d 203d 2027 4261 7369 6320  EADER] = 'Basic 
-00008210: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
-00008220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ef0: 2020 2063 6f6e 6e2e 7365 6e64 2865 6e74     conn.send(ent
+00007f00: 6974 7929 0a20 2020 2020 2020 2020 2020  ity).           
+00007f10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00007f20: 662e 6c6f 675f 636c 6965 6e74 2e6c 6f67  f.log_client.log
+00007f30: 2844 4542 5547 2c20 2772 6571 7565 7374  (DEBUG, 'request
+00007f40: 2063 6f6e 7465 6e74 3a25 7327 2c20 7574   content:%s', ut
+00007f50: 696c 2e74 6f5f 7374 7269 6e67 2865 6e74  il.to_string(ent
+00007f60: 6974 7929 290a 2020 2020 2020 2020 7265  ity)).        re
+00007f70: 7475 726e 2063 6f6e 6e0a 0a20 2020 2064  turn conn..    d
+00007f80: 6566 205f 7061 7273 655f 7265 7175 6573  ef _parse_reques
+00007f90: 745f 636f 6e6e 6563 7469 6f6e 2873 656c  t_connection(sel
+00007fa0: 662c 2073 6572 7665 722c 2070 6f72 742c  f, server, port,
+00007fb0: 2073 6368 656d 652c 2063 6f6e 6e65 6374   scheme, connect
+00007fc0: 696f 6e5f 6b65 792c 2072 6564 6972 6563  ion_key, redirec
+00007fd0: 742c 2068 6561 6465 7229 3a0a 2020 2020  t, header):.    
+00007fe0: 2020 2020 6966 2073 656c 662e 7072 6f78      if self.prox
+00007ff0: 795f 686f 7374 2069 7320 6e6f 7420 4e6f  y_host is not No
+00008000: 6e65 2061 6e64 2073 656c 662e 7072 6f78  ne and self.prox
+00008010: 795f 706f 7274 2069 7320 6e6f 7420 4e6f  y_port is not No
+00008020: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00008030: 636f 6e6e 203d 2073 656c 662e 5f67 6574  conn = self._get
+00008040: 5f73 6572 7665 725f 636f 6e6e 6563 7469  _server_connecti
+00008050: 6f6e 2873 6572 7665 722c 2070 6f72 742c  on(server, port,
+00008060: 2073 6368 656d 652c 2072 6564 6972 6563   scheme, redirec
+00008070: 742c 2075 7469 6c2e 746f 5f73 7472 696e  t, util.to_strin
+00008080: 6728 7365 6c66 2e70 726f 7879 5f68 6f73  g(self.proxy_hos
+00008090: 7429 2c0a 2020 2020 2020 2020 2020 2020  t),.            
+000080a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080c0: 2020 2075 7469 6c2e 746f 5f69 6e74 2873     util.to_int(s
+000080d0: 656c 662e 7072 6f78 795f 706f 7274 2929  elf.proxy_port))
+000080e0: 0a20 2020 2020 2020 2020 2020 205f 6865  .            _he
+000080f0: 6164 6572 203d 207b 7d0a 2020 2020 2020  ader = {}.      
+00008100: 2020 2020 2020 6966 2073 656c 662e 7072        if self.pr
+00008110: 6f78 795f 7573 6572 6e61 6d65 2069 7320  oxy_username is 
+00008120: 6e6f 7420 4e6f 6e65 2061 6e64 2073 656c  not None and sel
+00008130: 662e 7072 6f78 795f 7061 7373 776f 7264  f.proxy_password
+00008140: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00008150: 2020 2020 2020 2020 2020 2020 2020 5f68                _h
+00008160: 6561 6465 725b 636f 6e73 742e 5052 4f58  eader[const.PROX
+00008170: 595f 4155 5448 4f52 495a 4154 494f 4e5f  Y_AUTHORIZATION_
+00008180: 4845 4144 4552 5d20 3d20 2742 6173 6963  HEADER] = 'Basic
+00008190: 2027 205c 0a20 2020 2020 2020 2020 2020   ' \.           
+000081a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081d0: 2027 2573 2720 2520 280a 2020 2020 2020   '%s' % (.      
+000081e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008210: 2020 2020 2020 2020 2020 7574 696c 2e62            util.b
+00008220: 6173 6536 345f 656e 636f 6465 2875 7469  ase64_encode(uti
+00008230: 6c2e 746f 5f73 7472 696e 6728 0a20 2020  l.to_string(.   
 00008240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008250: 2725 7327 2025 2028 0a20 2020 2020 2020  '%s' % (.       
+00008250: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008260: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008290: 2020 2020 2020 2020 2075 7469 6c2e 6261           util.ba
-000082a0: 7365 3634 5f65 6e63 6f64 6528 7574 696c  se64_encode(util
-000082b0: 2e74 6f5f 7374 7269 6e67 280a 2020 2020  .to_string(.    
+00008280: 2073 656c 662e 7072 6f78 795f 7573 6572   self.proxy_user
+00008290: 6e61 6d65 2920 2b20 273a 2720 2b20 7574  name) + ':' + ut
+000082a0: 696c 2e74 6f5f 7374 7269 6e67 280a 2020  il.to_string(.  
+000082b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000082c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000082d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000082e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008300: 7365 6c66 2e70 726f 7879 5f75 7365 726e  self.proxy_usern
-00008310: 616d 6529 202b 2027 3a27 202b 2075 7469  ame) + ':' + uti
-00008320: 6c2e 746f 5f73 7472 696e 6728 0a20 2020  l.to_string(.   
+000082f0: 2020 7365 6c66 2e70 726f 7879 5f70 6173    self.proxy_pas
+00008300: 7377 6f72 6429 290a 2020 2020 2020 2020  sword)).        
+00008310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008320: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008370: 2073 656c 662e 7072 6f78 795f 7061 7373   self.proxy_pass
-00008380: 776f 7264 2929 0a20 2020 2020 2020 2020  word)).         
-00008390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000083a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000083b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000083c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000083d0: 2069 6620 6e6f 7420 7365 6c66 2e75 7365   if not self.use
-000083e0: 5f68 7474 7032 3a0a 2020 2020 2020 2020  _http2:.        
-000083f0: 2020 2020 2020 2020 636f 6e6e 2e73 6574          conn.set
-00008400: 5f74 756e 6e65 6c28 7365 7276 6572 2c20  _tunnel(server, 
-00008410: 706f 7274 2c20 5f68 6561 6465 7229 0a20  port, _header). 
-00008420: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00008430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008440: 2068 6561 6465 725b 636f 6e73 742e 5052   header[const.PR
-00008450: 4f58 595f 4155 5448 4f52 495a 4154 494f  OXY_AUTHORIZATIO
-00008460: 4e5f 4845 4144 4552 5d20 3d20 5f68 6561  N_HEADER] = _hea
-00008470: 6465 725b 636f 6e73 742e 5052 4f58 595f  der[const.PROXY_
-00008480: 4155 5448 4f52 495a 4154 494f 4e5f 4845  AUTHORIZATION_HE
-00008490: 4144 4552 5d0a 2020 2020 2020 2020 2020  ADER].          
-000084a0: 2020 636f 6e6e 6563 7469 6f6e 5f6b 6579    connection_key
-000084b0: 203d 2063 6f6e 7374 2e50 524f 5859 5f43   = const.PROXY_C
-000084c0: 4f4e 4e45 4354 494f 4e5f 4845 4144 4552  ONNECTION_HEADER
-000084d0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000084e0: 2020 2020 2020 2020 2020 2063 6f6e 6e20             conn 
-000084f0: 3d20 7365 6c66 2e5f 6765 745f 7365 7276  = self._get_serv
-00008500: 6572 5f63 6f6e 6e65 6374 696f 6e28 7365  er_connection(se
-00008510: 7276 6572 2c20 706f 7274 2c20 7363 6865  rver, port, sche
-00008520: 6d65 2c20 7265 6469 7265 6374 290a 2020  me, redirect).  
-00008530: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
-00008540: 6e67 5f63 6f6e 6e5f 6d6f 6465 3a0a 2020  ng_conn_mode:.  
-00008550: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00008560: 5b63 6f6e 6e65 6374 696f 6e5f 6b65 795d  [connection_key]
-00008570: 203d 2063 6f6e 7374 2e43 4f4e 4e45 4354   = const.CONNECT
-00008580: 494f 4e5f 4b45 4550 5f41 4c49 5645 5f56  ION_KEEP_ALIVE_V
-00008590: 414c 5545 0a20 2020 2020 2020 2065 6c73  ALUE.        els
-000085a0: 653a 0a20 2020 2020 2020 2020 2020 2068  e:.            h
-000085b0: 6561 6465 725b 636f 6e73 742e 434f 4e4e  eader[const.CONN
-000085c0: 4543 5449 4f4e 5f48 4541 4445 525d 203d  ECTION_HEADER] =
-000085d0: 2063 6f6e 7374 2e43 4f4e 4e45 4354 494f   const.CONNECTIO
-000085e0: 4e5f 434c 4f53 455f 5641 4c55 450a 2020  N_CLOSE_VALUE.  
-000085f0: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
-00008600: 6e2c 2068 6561 6465 720a 0a20 2020 2040  n, header..    @
-00008610: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-00008620: 2064 6566 205f 7061 7273 655f 636f 6e6e   def _parse_conn
-00008630: 6563 7469 6f6e 5f63 6875 6e6b 6564 5f6d  ection_chunked_m
-00008640: 6f64 6528 636f 6e6e 2c20 6368 756e 6b65  ode(conn, chunke
-00008650: 644d 6f64 652c 206d 6574 686f 642c 2070  dMode, method, p
-00008660: 6174 682c 2068 6561 6465 7229 3a0a 2020  ath, header):.  
-00008670: 2020 2020 2020 6966 2063 6875 6e6b 6564        if chunked
-00008680: 4d6f 6465 3a0a 2020 2020 2020 2020 2020  Mode:.          
-00008690: 2020 636f 6e6e 2e70 7574 7265 7175 6573    conn.putreques
-000086a0: 7428 6d65 7468 6f64 2c20 7061 7468 2c20  t(method, path, 
-000086b0: 736b 6970 5f68 6f73 743d 3129 0a20 2020  skip_host=1).   
-000086c0: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
-000086d0: 7620 696e 2068 6561 6465 722e 6974 656d  v in header.item
-000086e0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-000086f0: 2020 2020 2063 6f6e 6e2e 7075 7468 6561       conn.puthea
-00008700: 6465 7228 6b2c 2076 290a 2020 2020 2020  der(k, v).      
-00008710: 2020 2020 2020 636f 6e6e 2e65 6e64 6865        conn.endhe
-00008720: 6164 6572 7328 290a 2020 2020 2020 2020  aders().        
-00008730: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00008740: 2020 636f 6e6e 2e72 6571 7565 7374 286d    conn.request(m
-00008750: 6574 686f 642c 2070 6174 682c 2068 6561  ethod, path, hea
-00008760: 6465 7273 3d68 6561 6465 7229 0a0a 2020  ders=header)..  
-00008770: 2020 6465 6620 5f67 6574 4e6f 6e65 5265    def _getNoneRe
-00008780: 7375 6c74 2873 656c 662c 206d 6573 7361  sult(self, messa
-00008790: 6765 3d27 4e6f 6e65 2052 6573 756c 7427  ge='None Result'
-000087a0: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
-000087b0: 2045 7863 6570 7469 6f6e 286d 6573 7361   Exception(messa
-000087c0: 6765 290a 0a20 2020 2064 6566 205f 7061  ge)..    def _pa
-000087d0: 7273 655f 786d 6c28 7365 6c66 2c20 636f  rse_xml(self, co
-000087e0: 6e6e 2c20 6d65 7468 6f64 4e61 6d65 3d4e  nn, methodName=N
-000087f0: 6f6e 652c 2072 6561 6461 626c 653d 4661  one, readable=Fa
-00008800: 6c73 6529 3a0a 2020 2020 2020 2020 6966  lse):.        if
-00008810: 206e 6f74 2063 6f6e 6e3a 0a20 2020 2020   not conn:.     
-00008820: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00008830: 6c66 2e5f 6765 744e 6f6e 6552 6573 756c  lf._getNoneResul
-00008840: 7428 2763 6f6e 6e65 6374 696f 6e20 6973  t('connection is
-00008850: 206e 6f6e 6527 290a 2020 2020 2020 2020   none').        
-00008860: 7265 7375 6c74 203d 204e 6f6e 650a 2020  result = None.  
-00008870: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00008880: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00008890: 636f 6e6e 2e67 6574 7265 7370 6f6e 7365  conn.getresponse
-000088a0: 2854 7275 6529 2069 6620 636f 6e73 742e  (True) if const.
-000088b0: 4953 5f50 5954 484f 4e32 2065 6c73 6520  IS_PYTHON2 else 
-000088c0: 636f 6e6e 2e67 6574 7265 7370 6f6e 7365  conn.getresponse
-000088d0: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
-000088e0: 6620 6e6f 7420 7265 7375 6c74 3a0a 2020  f not result:.  
-000088f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00008900: 7475 726e 2073 656c 662e 5f67 6574 4e6f  turn self._getNo
-00008910: 6e65 5265 7375 6c74 2827 7265 7370 6f6e  neResult('respon
-00008920: 7365 2069 7320 6e6f 6e65 2729 0a20 2020  se is none').   
-00008930: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00008940: 7365 6c66 2e5f 7061 7273 655f 786d 6c5f  self._parse_xml_
-00008950: 696e 7465 726e 616c 2872 6573 756c 742c  internal(result,
-00008960: 206d 6574 686f 644e 616d 652c 2072 6561   methodName, rea
-00008970: 6461 626c 653d 7265 6164 6162 6c65 290a  dable=readable).
-00008980: 2020 2020 2020 2020 6578 6365 7074 205f          except _
-00008990: 5265 6469 7265 6374 4578 6365 7074 696f  RedirectExceptio
-000089a0: 6e20 6173 2065 783a 0a20 2020 2020 2020  n as ex:.       
-000089b0: 2020 2020 2072 6169 7365 2065 780a 2020       raise ex.  
-000089c0: 2020 2020 2020 6578 6365 7074 205f 496e        except _In
-000089d0: 7465 726e 616c 4578 6365 7074 696f 6e20  ternalException 
-000089e0: 6173 2065 783a 0a20 2020 2020 2020 2020  as ex:.         
-000089f0: 2020 2072 6169 7365 2065 780a 2020 2020     raise ex.    
-00008a00: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00008a10: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-00008a20: 2020 2020 2020 2063 6f6e 6e2e 5f63 6c65         conn._cle
-00008a30: 6172 203d 2054 7275 650a 2020 2020 2020  ar = True.      
-00008a40: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
-00008a50: 6c69 656e 742e 6c6f 6728 4552 524f 522c  lient.log(ERROR,
-00008a60: 2074 7261 6365 6261 636b 2e66 6f72 6d61   traceback.forma
-00008a70: 745f 6578 6328 2929 0a20 2020 2020 2020  t_exc()).       
-00008a80: 2020 2020 2072 6169 7365 2065 0a20 2020       raise e.   
-00008a90: 2020 2020 2066 696e 616c 6c79 3a0a 2020       finally:.  
-00008aa0: 2020 2020 2020 2020 2020 7574 696c 2e64            util.d
-00008ab0: 6f5f 636c 6f73 6528 7265 7375 6c74 2c20  o_close(result, 
-00008ac0: 636f 6e6e 2c20 7365 6c66 2e63 6f6e 6e48  conn, self.connH
-00008ad0: 6f6c 6465 722c 2073 656c 662e 6c6f 675f  older, self.log_
-00008ae0: 636c 6965 6e74 290a 0a20 2020 2064 6566  client)..    def
-00008af0: 205f 7061 7273 655f 636f 6e74 656e 7428   _parse_content(
-00008b00: 7365 6c66 2c20 6f62 6a65 6374 4b65 792c  self, objectKey,
-00008b10: 2063 6f6e 6e2c 2072 6573 706f 6e73 652c   conn, response,
-00008b20: 2064 6f77 6e6c 6f61 645f 7374 6172 743d   download_start=
-00008b30: 2727 2c0a 2020 2020 2020 2020 2020 2020  '',.            
-00008b40: 2020 2020 2020 2020 2020 2064 6f77 6e6c             downl
-00008b50: 6f61 6450 6174 683d 4e6f 6e65 2c20 6368  oadPath=None, ch
-00008b60: 7563 6b53 697a 653d 636f 6e73 742e 5245  uckSize=const.RE
-00008b70: 4144 5f4f 4e43 455f 4c45 4e47 5448 2c20  AD_ONCE_LENGTH, 
-00008b80: 6c6f 6164 5374 7265 616d 496e 4d65 6d6f  loadStreamInMemo
-00008b90: 7279 3d46 616c 7365 2c0a 2020 2020 2020  ry=False,.      
-00008ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008bb0: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-00008bc0: 6b3d 4e6f 6e65 2c20 6e6f 7469 6669 6572  k=None, notifier
-00008bd0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00008be0: 6966 206e 6f74 2063 6f6e 6e3a 0a20 2020  if not conn:.   
-00008bf0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00008c00: 7365 6c66 2e5f 6765 744e 6f6e 6552 6573  self._getNoneRes
-00008c10: 756c 7428 2763 6f6e 6e65 6374 696f 6e20  ult('connection 
-00008c20: 6973 206e 6f6e 6527 290a 2020 2020 2020  is none').      
-00008c30: 2020 636c 6f73 655f 636f 6e6e 5f66 6c61    close_conn_fla
-00008c40: 6720 3d20 5472 7565 0a20 2020 2020 2020  g = True.       
-00008c50: 2072 6573 756c 745f 7772 6170 7065 7220   result_wrapper 
-00008c60: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
-00008c70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00008c80: 6966 206e 6f74 2072 6573 706f 6e73 653a  if not response:
-00008c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008ca0: 2072 6574 7572 6e20 7365 6c66 2e5f 6765   return self._ge
-00008cb0: 744e 6f6e 6552 6573 756c 7428 2772 6573  tNoneResult('res
-00008cc0: 706f 6e73 6520 6973 206e 6f6e 6527 290a  ponse is none').
-00008cd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008ce0: 6e6f 7420 7574 696c 2e74 6f5f 696e 7428  not util.to_int(
-00008cf0: 7265 7370 6f6e 7365 2e73 7461 7475 7329  response.status)
-00008d00: 203c 2033 3030 3a0a 2020 2020 2020 2020   < 300:.        
-00008d10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00008d20: 656c 662e 5f70 6172 7365 5f78 6d6c 5f69  elf._parse_xml_i
-00008d30: 6e74 6572 6e61 6c28 7265 7370 6f6e 7365  nternal(response
-00008d40: 290a 0a20 2020 2020 2020 2020 2020 2068  )..            h
-00008d50: 6561 6465 7273 203d 207b 7d0a 2020 2020  eaders = {}.    
-00008d60: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-00008d70: 2069 6e20 7265 7370 6f6e 7365 2e67 6574   in response.get
-00008d80: 6865 6164 6572 7328 293a 0a20 2020 2020  headers():.     
-00008d90: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-00008da0: 7273 5b6b 2e6c 6f77 6572 2829 5d20 3d20  rs[k.lower()] = 
-00008db0: 760a 0a20 2020 2020 2020 2020 2020 2063  v..            c
-00008dc0: 6f6e 7465 6e74 5f6c 656e 6774 6820 3d20  ontent_length = 
-00008dd0: 6865 6164 6572 732e 6765 7428 2763 6f6e  headers.get('con
-00008de0: 7465 6e74 2d6c 656e 6774 6827 290a 2020  tent-length').  
-00008df0: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
-00008e00: 745f 6c65 6e67 7468 203d 2075 7469 6c2e  t_length = util.
-00008e10: 746f 5f6c 6f6e 6728 636f 6e74 656e 745f  to_long(content_
-00008e20: 6c65 6e67 7468 2920 6966 2063 6f6e 7465  length) if conte
-00008e30: 6e74 5f6c 656e 6774 6820 6973 206e 6f74  nt_length is not
-00008e40: 204e 6f6e 6520 656c 7365 204e 6f6e 650a   None else None.
-00008e50: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00008e60: 6f74 206e 6f74 6966 6965 723a 0a20 2020  ot notifier:.   
-00008e70: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-00008e80: 6966 6965 7220 3d20 7365 6c66 2e5f 6765  ifier = self._ge
-00008e90: 745f 6e6f 7469 6669 6572 2863 6f6e 7465  t_notifier(conte
-00008ea0: 6e74 5f6c 656e 6774 682c 2070 726f 6772  nt_length, progr
-00008eb0: 6573 7343 616c 6c62 6163 6b29 0a20 2020  essCallback).   
-00008ec0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-00008ed0: 6966 6965 722e 7374 6172 7428 290a 2020  ifier.start().  
-00008ee0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00008ef0: 5f77 7261 7070 6572 203d 2052 6573 706f  _wrapper = Respo
-00008f00: 6e73 6557 7261 7070 6572 2863 6f6e 6e2c  nseWrapper(conn,
-00008f10: 2072 6573 706f 6e73 652c 2073 656c 662e   response, self.
-00008f20: 636f 6e6e 486f 6c64 6572 2c20 636f 6e74  connHolder, cont
-00008f30: 656e 745f 6c65 6e67 7468 2c20 6e6f 7469  ent_length, noti
-00008f40: 6669 6572 290a 2020 2020 2020 2020 2020  fier).          
-00008f50: 2020 6966 206c 6f61 6453 7472 6561 6d49    if loadStreamI
-00008f60: 6e4d 656d 6f72 793a 0a20 2020 2020 2020  nMemory:.       
-00008f70: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00008f80: 675f 636c 6965 6e74 2e6c 6f67 2844 4542  g_client.log(DEB
-00008f90: 5547 2c20 276c 6f61 6453 7472 6561 6d49  UG, 'loadStreamI
-00008fa0: 6e4d 656d 6f72 7920 6973 2054 7275 652c  nMemory is True,
-00008fb0: 2072 6561 6420 7374 7265 616d 2069 6e74   read stream int
-00008fc0: 6f20 6d65 6d6f 7279 2729 0a20 2020 2020  o memory').     
-00008fd0: 2020 2020 2020 2020 2020 2062 7566 203d             buf =
-00008fe0: 2073 656c 662e 5f67 6574 5f62 7566 6665   self._get_buffe
-00008ff0: 725f 6461 7461 2872 6573 756c 745f 7772  r_data(result_wr
-00009000: 6170 7065 722c 2063 6875 636b 5369 7a65  apper, chuckSize
-00009010: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009020: 2020 626f 6479 203d 204f 626a 6563 7453    body = ObjectS
-00009030: 7472 6561 6d28 6275 6666 6572 3d62 7566  tream(buffer=buf
-00009040: 2c20 7369 7a65 3d75 7469 6c2e 746f 5f6c  , size=util.to_l
-00009050: 6f6e 6728 6c65 6e28 6275 6629 2920 6966  ong(len(buf)) if
-00009060: 2062 7566 2069 7320 6e6f 7420 4e6f 6e65   buf is not None
-00009070: 2065 6c73 6520 3029 0a20 2020 2020 2020   else 0).       
-00009080: 2020 2020 2065 6c69 6620 646f 776e 6c6f       elif downlo
-00009090: 6164 5061 7468 2069 7320 4e6f 6e65 3a0a  adPath is None:.
-000090a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000090b0: 7365 6c66 2e6c 6f67 5f63 6c69 656e 742e  self.log_client.
-000090c0: 6c6f 6728 4445 4255 472c 2027 446f 776e  log(DEBUG, 'Down
-000090d0: 6c6f 6164 5061 7468 2069 7320 6e6f 6e65  loadPath is none
-000090e0: 2c20 7265 7475 726e 2063 6f6e 6e20 6469  , return conn di
-000090f0: 7265 6374 6c79 2729 0a20 2020 2020 2020  rectly').       
-00009100: 2020 2020 2020 2020 2063 6c6f 7365 5f63           close_c
-00009110: 6f6e 6e5f 666c 6167 203d 2046 616c 7365  onn_flag = False
-00009120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009130: 2062 6f64 7920 3d20 4f62 6a65 6374 5374   body = ObjectSt
-00009140: 7265 616d 2872 6573 706f 6e73 653d 7265  ream(response=re
-00009150: 7375 6c74 5f77 7261 7070 6572 290a 2020  sult_wrapper).  
-00009160: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00009170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009180: 646f 776e 6c6f 6164 5061 7468 203d 2075  downloadPath = u
-00009190: 7469 6c2e 7361 6665 5f65 6e63 6f64 6528  til.safe_encode(
-000091a0: 646f 776e 6c6f 6164 5061 7468 290a 2020  downloadPath).  
-000091b0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000091c0: 6c65 5f70 6174 682c 205f 203d 2073 656c  le_path, _ = sel
-000091d0: 662e 5f67 6574 5f64 6174 6128 7265 7375  f._get_data(resu
-000091e0: 6c74 5f77 7261 7070 6572 2c20 646f 776e  lt_wrapper, down
-000091f0: 6c6f 6164 5061 7468 2c20 6368 7563 6b53  loadPath, chuckS
-00009200: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-00009210: 2020 2020 2062 6f64 7920 3d20 4f62 6a65       body = Obje
-00009220: 6374 5374 7265 616d 2875 726c 3d75 7469  ctStream(url=uti
-00009230: 6c2e 746f 5f73 7472 696e 6728 6669 6c65  l.to_string(file
-00009240: 5f70 6174 6829 290a 2020 2020 2020 2020  _path)).        
-00009250: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00009260: 5f63 6c69 656e 742e 6c6f 6728 4445 4255  _client.log(DEBU
-00009270: 472c 2027 446f 776e 6c6f 6164 5061 7468  G, 'DownloadPath
-00009280: 2069 7320 2720 2b20 7574 696c 2e74 6f5f   is ' + util.to_
-00009290: 7374 7269 6e67 2866 696c 655f 7061 7468  string(file_path
-000092a0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-000092b0: 7374 6174 7573 203d 2075 7469 6c2e 746f  status = util.to
-000092c0: 5f69 6e74 2872 6573 706f 6e73 652e 7374  _int(response.st
-000092d0: 6174 7573 290a 2020 2020 2020 2020 2020  atus).          
-000092e0: 2020 7265 6173 6f6e 203d 2072 6573 706f    reason = respo
-000092f0: 6e73 652e 7265 6173 6f6e 0a20 2020 2020  nse.reason.     
-00009300: 2020 2020 2020 2073 656c 662e 636f 6e76         self.conv
-00009310: 6572 746f 722e 7061 7273 6547 6574 4f62  ertor.parseGetOb
-00009320: 6a65 6374 2868 6561 6465 7273 2c20 626f  ject(headers, bo
-00009330: 6479 290a 2020 2020 2020 2020 2020 2020  dy).            
-00009340: 6865 6164 6572 203d 2073 656c 662e 5f72  header = self._r
-00009350: 656e 616d 655f 7265 7370 6f6e 7365 5f68  ename_response_h
-00009360: 6561 6465 7273 2868 6561 6465 7273 290a  eaders(headers).
-00009370: 2020 2020 2020 2020 2020 2020 7265 7175              requ
-00009380: 6573 7449 6420 3d20 6469 6374 2868 6561  estId = dict(hea
-00009390: 6465 7229 2e67 6574 2827 7265 7175 6573  der).get('reques
-000093a0: 742d 6964 2729 0a20 2020 2020 2020 2020  t-id').         
-000093b0: 2020 2072 6574 7572 6e20 4765 7452 6573     return GetRes
-000093c0: 756c 7428 7374 6174 7573 3d73 7461 7475  ult(status=statu
-000093d0: 732c 2072 6561 736f 6e3d 7265 6173 6f6e  s, reason=reason
-000093e0: 2c20 6865 6164 6572 3d68 6561 6465 722c  , header=header,
-000093f0: 2062 6f64 793d 626f 6479 2c20 7265 7175   body=body, requ
-00009400: 6573 7449 643d 7265 7175 6573 7449 6429  estId=requestId)
-00009410: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00009420: 5f52 6564 6972 6563 7445 7863 6570 7469  _RedirectExcepti
-00009430: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
-00009440: 2020 2020 2020 7261 6973 6520 6578 0a20        raise ex. 
-00009450: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00009460: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
-00009470: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00009480: 6f67 5f63 6c69 656e 742e 6c6f 6728 4552  og_client.log(ER
-00009490: 524f 522c 2074 7261 6365 6261 636b 2e66  ROR, traceback.f
-000094a0: 6f72 6d61 745f 6578 6328 2929 0a20 2020  ormat_exc()).   
-000094b0: 2020 2020 2020 2020 2072 6169 7365 2065           raise e
-000094c0: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
-000094d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000094e0: 2063 6c6f 7365 5f63 6f6e 6e5f 666c 6167   close_conn_flag
-000094f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009500: 2020 6966 2072 6573 756c 745f 7772 6170    if result_wrap
-00009510: 7065 7220 6973 206e 6f74 204e 6f6e 653a  per is not None:
-00009520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009530: 2020 2020 2072 6573 756c 745f 7772 6170       result_wrap
-00009540: 7065 722e 636c 6f73 6528 290a 2020 2020  per.close().    
-00009550: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00009560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009570: 2020 2020 2020 7574 696c 2e64 6f5f 636c        util.do_cl
-00009580: 6f73 6528 7265 7370 6f6e 7365 2c20 636f  ose(response, co
-00009590: 6e6e 2c20 7365 6c66 2e63 6f6e 6e48 6f6c  nn, self.connHol
-000095a0: 6465 722c 2073 656c 662e 6c6f 675f 636c  der, self.log_cl
-000095b0: 6965 6e74 290a 0a20 2020 2040 7374 6174  ient)..    @stat
-000095c0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-000095d0: 205f 6765 745f 6275 6666 6572 5f64 6174   _get_buffer_dat
-000095e0: 6128 7265 7375 6c74 5772 6170 7065 722c  a(resultWrapper,
-000095f0: 2063 6875 636b 5369 7a65 293a 0a20 2020   chuckSize):.   
-00009600: 2020 2020 2062 7566 203d 204e 6f6e 650a       buf = None.
-00009610: 2020 2020 2020 2020 6170 7065 6e64 4c69          appendLi
-00009620: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-00009630: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
-00009640: 2020 2020 2020 2020 6368 756e 6b20 3d20          chunk = 
-00009650: 7265 7375 6c74 5772 6170 7065 722e 7265  resultWrapper.re
-00009660: 6164 2863 6875 636b 5369 7a65 290a 2020  ad(chuckSize).  
-00009670: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00009680: 2063 6875 6e6b 3a0a 2020 2020 2020 2020   chunk:.        
-00009690: 2020 2020 2020 2020 6966 2062 6f6f 6c28          if bool(
-000096a0: 6170 7065 6e64 4c69 7374 293a 0a20 2020  appendList):.   
-000096b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096c0: 2074 656d 7053 7472 203d 2022 220a 2020   tempStr = "".  
-000096d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096e0: 2020 6966 206e 6f74 2063 6f6e 7374 2e49    if not const.I
-000096f0: 535f 5059 5448 4f4e 323a 0a20 2020 2020  S_PYTHON2:.     
-00009700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009710: 2020 2074 656d 7053 7472 203d 2062 2222     tempStr = b""
-00009720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009730: 2020 2020 2062 7566 203d 2074 656d 7053       buf = tempS
-00009740: 7472 2e6a 6f69 6e28 6170 7065 6e64 4c69  tr.join(appendLi
-00009750: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
-00009760: 2020 2020 2020 2020 6465 6c20 6170 7065          del appe
-00009770: 6e64 4c69 7374 5b3a 5d0a 2020 2020 2020  ndList[:].      
-00009780: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00009790: 2020 2020 2020 2020 2020 2020 6170 7065              appe
-000097a0: 6e64 4c69 7374 2e61 7070 656e 6428 6368  ndList.append(ch
-000097b0: 756e 6b29 0a20 2020 2020 2020 2072 6574  unk).        ret
-000097c0: 7572 6e20 6275 660a 0a20 2020 2040 7374  urn buf..    @st
-000097d0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-000097e0: 6566 205f 6765 745f 6e6f 7469 6669 6572  ef _get_notifier
-000097f0: 2863 6f6e 7465 6e74 5f6c 656e 6774 682c  (content_length,
-00009800: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-00009810: 6b29 3a0a 2020 2020 2020 2020 7265 7475  k):.        retu
-00009820: 726e 2070 726f 6772 6573 732e 5072 6f67  rn progress.Prog
-00009830: 7265 7373 4e6f 7469 6669 6572 2870 726f  ressNotifier(pro
-00009840: 6772 6573 7343 616c 6c62 6163 6b2c 0a20  gressCallback,. 
+00008340: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00008350: 2020 6966 206e 6f74 2073 656c 662e 7573    if not self.us
+00008360: 655f 6874 7470 323a 0a20 2020 2020 2020  e_http2:.       
+00008370: 2020 2020 2020 2020 2063 6f6e 6e2e 7365           conn.se
+00008380: 745f 7475 6e6e 656c 2873 6572 7665 722c  t_tunnel(server,
+00008390: 2070 6f72 742c 205f 6865 6164 6572 290a   port, _header).
+000083a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000083b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000083c0: 2020 6865 6164 6572 5b63 6f6e 7374 2e50    header[const.P
+000083d0: 524f 5859 5f41 5554 484f 5249 5a41 5449  ROXY_AUTHORIZATI
+000083e0: 4f4e 5f48 4541 4445 525d 203d 205f 6865  ON_HEADER] = _he
+000083f0: 6164 6572 5b63 6f6e 7374 2e50 524f 5859  ader[const.PROXY
+00008400: 5f41 5554 484f 5249 5a41 5449 4f4e 5f48  _AUTHORIZATION_H
+00008410: 4541 4445 525d 0a20 2020 2020 2020 2020  EADER].         
+00008420: 2020 2063 6f6e 6e65 6374 696f 6e5f 6b65     connection_ke
+00008430: 7920 3d20 636f 6e73 742e 5052 4f58 595f  y = const.PROXY_
+00008440: 434f 4e4e 4543 5449 4f4e 5f48 4541 4445  CONNECTION_HEADE
+00008450: 520a 2020 2020 2020 2020 656c 7365 3a0a  R.        else:.
+00008460: 2020 2020 2020 2020 2020 2020 636f 6e6e              conn
+00008470: 203d 2073 656c 662e 5f67 6574 5f73 6572   = self._get_ser
+00008480: 7665 725f 636f 6e6e 6563 7469 6f6e 2873  ver_connection(s
+00008490: 6572 7665 722c 2070 6f72 742c 2073 6368  erver, port, sch
+000084a0: 656d 652c 2072 6564 6972 6563 7429 0a20  eme, redirect). 
+000084b0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
+000084c0: 6f6e 675f 636f 6e6e 5f6d 6f64 653a 0a20  ong_conn_mode:. 
+000084d0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+000084e0: 725b 636f 6e6e 6563 7469 6f6e 5f6b 6579  r[connection_key
+000084f0: 5d20 3d20 636f 6e73 742e 434f 4e4e 4543  ] = const.CONNEC
+00008500: 5449 4f4e 5f4b 4545 505f 414c 4956 455f  TION_KEEP_ALIVE_
+00008510: 5641 4c55 450a 2020 2020 2020 2020 656c  VALUE.        el
+00008520: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00008530: 6865 6164 6572 5b63 6f6e 7374 2e43 4f4e  header[const.CON
+00008540: 4e45 4354 494f 4e5f 4845 4144 4552 5d20  NECTION_HEADER] 
+00008550: 3d20 636f 6e73 742e 434f 4e4e 4543 5449  = const.CONNECTI
+00008560: 4f4e 5f43 4c4f 5345 5f56 414c 5545 0a20  ON_CLOSE_VALUE. 
+00008570: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00008580: 6e6e 2c20 6865 6164 6572 0a0a 2020 2020  nn, header..    
+00008590: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+000085a0: 2020 6465 6620 5f70 6172 7365 5f63 6f6e    def _parse_con
+000085b0: 6e65 6374 696f 6e5f 6368 756e 6b65 645f  nection_chunked_
+000085c0: 6d6f 6465 2863 6f6e 6e2c 2063 6875 6e6b  mode(conn, chunk
+000085d0: 6564 4d6f 6465 2c20 6d65 7468 6f64 2c20  edMode, method, 
+000085e0: 7061 7468 2c20 6865 6164 6572 293a 0a20  path, header):. 
+000085f0: 2020 2020 2020 2069 6620 6368 756e 6b65         if chunke
+00008600: 644d 6f64 653a 0a20 2020 2020 2020 2020  dMode:.         
+00008610: 2020 2063 6f6e 6e2e 7075 7472 6571 7565     conn.putreque
+00008620: 7374 286d 6574 686f 642c 2070 6174 682c  st(method, path,
+00008630: 2073 6b69 705f 686f 7374 3d31 290a 2020   skip_host=1).  
+00008640: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
+00008650: 2076 2069 6e20 6865 6164 6572 2e69 7465   v in header.ite
+00008660: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00008670: 2020 2020 2020 636f 6e6e 2e70 7574 6865        conn.puthe
+00008680: 6164 6572 286b 2c20 7629 0a20 2020 2020  ader(k, v).     
+00008690: 2020 2020 2020 2063 6f6e 6e2e 656e 6468         conn.endh
+000086a0: 6561 6465 7273 2829 0a20 2020 2020 2020  eaders().       
+000086b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000086c0: 2020 2063 6f6e 6e2e 7265 7175 6573 7428     conn.request(
+000086d0: 6d65 7468 6f64 2c20 7061 7468 2c20 6865  method, path, he
+000086e0: 6164 6572 733d 6865 6164 6572 290a 0a20  aders=header).. 
+000086f0: 2020 2064 6566 205f 6765 744e 6f6e 6552     def _getNoneR
+00008700: 6573 756c 7428 7365 6c66 2c20 6d65 7373  esult(self, mess
+00008710: 6167 653d 274e 6f6e 6520 5265 7375 6c74  age='None Result
+00008720: 2729 3a0a 2020 2020 2020 2020 7261 6973  '):.        rais
+00008730: 6520 4578 6365 7074 696f 6e28 6d65 7373  e Exception(mess
+00008740: 6167 6529 0a0a 2020 2020 6465 6620 5f70  age)..    def _p
+00008750: 6172 7365 5f78 6d6c 2873 656c 662c 2063  arse_xml(self, c
+00008760: 6f6e 6e2c 206d 6574 686f 644e 616d 653d  onn, methodName=
+00008770: 4e6f 6e65 2c20 7265 6164 6162 6c65 3d46  None, readable=F
+00008780: 616c 7365 293a 0a20 2020 2020 2020 2069  alse):.        i
+00008790: 6620 6e6f 7420 636f 6e6e 3a0a 2020 2020  f not conn:.    
+000087a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000087b0: 656c 662e 5f67 6574 4e6f 6e65 5265 7375  elf._getNoneResu
+000087c0: 6c74 2827 636f 6e6e 6563 7469 6f6e 2069  lt('connection i
+000087d0: 7320 6e6f 6e65 2729 0a20 2020 2020 2020  s none').       
+000087e0: 2072 6573 756c 7420 3d20 4e6f 6e65 0a20   result = None. 
+000087f0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00008800: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00008810: 2063 6f6e 6e2e 6765 7472 6573 706f 6e73   conn.getrespons
+00008820: 6528 5472 7565 2920 6966 2063 6f6e 7374  e(True) if const
+00008830: 2e49 535f 5059 5448 4f4e 3220 656c 7365  .IS_PYTHON2 else
+00008840: 2063 6f6e 6e2e 6765 7472 6573 706f 6e73   conn.getrespons
+00008850: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00008860: 6966 206e 6f74 2072 6573 756c 743a 0a20  if not result:. 
+00008870: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00008880: 6574 7572 6e20 7365 6c66 2e5f 6765 744e  eturn self._getN
+00008890: 6f6e 6552 6573 756c 7428 2772 6573 706f  oneResult('respo
+000088a0: 6e73 6520 6973 206e 6f6e 6527 290a 2020  nse is none').  
+000088b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000088c0: 2073 656c 662e 5f70 6172 7365 5f78 6d6c   self._parse_xml
+000088d0: 5f69 6e74 6572 6e61 6c28 7265 7375 6c74  _internal(result
+000088e0: 2c20 6d65 7468 6f64 4e61 6d65 2c20 7265  , methodName, re
+000088f0: 6164 6162 6c65 3d72 6561 6461 626c 6529  adable=readable)
+00008900: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00008910: 5f52 6564 6972 6563 7445 7863 6570 7469  _RedirectExcepti
+00008920: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
+00008930: 2020 2020 2020 7261 6973 6520 6578 0a20        raise ex. 
+00008940: 2020 2020 2020 2065 7863 6570 7420 5f49         except _I
+00008950: 6e74 6572 6e61 6c45 7863 6570 7469 6f6e  nternalException
+00008960: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
+00008970: 2020 2020 7261 6973 6520 6578 0a20 2020      raise ex.   
+00008980: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00008990: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+000089a0: 2020 2020 2020 2020 636f 6e6e 2e5f 636c          conn._cl
+000089b0: 6561 7220 3d20 5472 7565 0a20 2020 2020  ear = True.     
+000089c0: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
+000089d0: 636c 6965 6e74 2e6c 6f67 2845 5252 4f52  client.log(ERROR
+000089e0: 2c20 7472 6163 6562 6163 6b2e 666f 726d  , traceback.form
+000089f0: 6174 5f65 7863 2829 290a 2020 2020 2020  at_exc()).      
+00008a00: 2020 2020 2020 7261 6973 6520 650a 2020        raise e.  
+00008a10: 2020 2020 2020 6669 6e61 6c6c 793a 0a20        finally:. 
+00008a20: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
+00008a30: 646f 5f63 6c6f 7365 2872 6573 756c 742c  do_close(result,
+00008a40: 2063 6f6e 6e2c 2073 656c 662e 636f 6e6e   conn, self.conn
+00008a50: 486f 6c64 6572 2c20 7365 6c66 2e6c 6f67  Holder, self.log
+00008a60: 5f63 6c69 656e 7429 0a0a 2020 2020 6465  _client)..    de
+00008a70: 6620 5f70 6172 7365 5f63 6f6e 7465 6e74  f _parse_content
+00008a80: 2873 656c 662c 206f 626a 6563 744b 6579  (self, objectKey
+00008a90: 2c20 636f 6e6e 2c20 7265 7370 6f6e 7365  , conn, response
+00008aa0: 2c20 646f 776e 6c6f 6164 5f73 7461 7274  , download_start
+00008ab0: 3d27 272c 0a20 2020 2020 2020 2020 2020  ='',.           
+00008ac0: 2020 2020 2020 2020 2020 2020 646f 776e              down
+00008ad0: 6c6f 6164 5061 7468 3d4e 6f6e 652c 2063  loadPath=None, c
+00008ae0: 6875 636b 5369 7a65 3d63 6f6e 7374 2e52  huckSize=const.R
+00008af0: 4541 445f 4f4e 4345 5f4c 454e 4754 482c  EAD_ONCE_LENGTH,
+00008b00: 206c 6f61 6453 7472 6561 6d49 6e4d 656d   loadStreamInMem
+00008b10: 6f72 793d 4661 6c73 652c 0a20 2020 2020  ory=False,.     
+00008b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b30: 2020 7072 6f67 7265 7373 4361 6c6c 6261    progressCallba
+00008b40: 636b 3d4e 6f6e 652c 206e 6f74 6966 6965  ck=None, notifie
+00008b50: 723d 4e6f 6e65 293a 0a20 2020 2020 2020  r=None):.       
+00008b60: 2069 6620 6e6f 7420 636f 6e6e 3a0a 2020   if not conn:.  
+00008b70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00008b80: 2073 656c 662e 5f67 6574 4e6f 6e65 5265   self._getNoneRe
+00008b90: 7375 6c74 2827 636f 6e6e 6563 7469 6f6e  sult('connection
+00008ba0: 2069 7320 6e6f 6e65 2729 0a20 2020 2020   is none').     
+00008bb0: 2020 2063 6c6f 7365 5f63 6f6e 6e5f 666c     close_conn_fl
+00008bc0: 6167 203d 2054 7275 650a 2020 2020 2020  ag = True.      
+00008bd0: 2020 7265 7375 6c74 5f77 7261 7070 6572    result_wrapper
+00008be0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00008bf0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00008c00: 2069 6620 6e6f 7420 7265 7370 6f6e 7365   if not response
+00008c10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008c20: 2020 7265 7475 726e 2073 656c 662e 5f67    return self._g
+00008c30: 6574 4e6f 6e65 5265 7375 6c74 2827 7265  etNoneResult('re
+00008c40: 7370 6f6e 7365 2069 7320 6e6f 6e65 2729  sponse is none')
+00008c50: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00008c60: 206e 6f74 2075 7469 6c2e 746f 5f69 6e74   not util.to_int
+00008c70: 2872 6573 706f 6e73 652e 7374 6174 7573  (response.status
+00008c80: 2920 3c20 3330 303a 0a20 2020 2020 2020  ) < 300:.       
+00008c90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008ca0: 7365 6c66 2e5f 7061 7273 655f 786d 6c5f  self._parse_xml_
+00008cb0: 696e 7465 726e 616c 2872 6573 706f 6e73  internal(respons
+00008cc0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+00008cd0: 6865 6164 6572 7320 3d20 7b7d 0a20 2020  headers = {}.   
+00008ce0: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
+00008cf0: 7620 696e 2072 6573 706f 6e73 652e 6765  v in response.ge
+00008d00: 7468 6561 6465 7273 2829 3a0a 2020 2020  theaders():.    
+00008d10: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00008d20: 6572 735b 6b2e 6c6f 7765 7228 295d 203d  ers[k.lower()] =
+00008d30: 2076 0a0a 2020 2020 2020 2020 2020 2020   v..            
+00008d40: 636f 6e74 656e 745f 6c65 6e67 7468 203d  content_length =
+00008d50: 2068 6561 6465 7273 2e67 6574 2827 636f   headers.get('co
+00008d60: 6e74 656e 742d 6c65 6e67 7468 2729 0a20  ntent-length'). 
+00008d70: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
+00008d80: 6e74 5f6c 656e 6774 6820 3d20 7574 696c  nt_length = util
+00008d90: 2e74 6f5f 6c6f 6e67 2863 6f6e 7465 6e74  .to_long(content
+00008da0: 5f6c 656e 6774 6829 2069 6620 636f 6e74  _length) if cont
+00008db0: 656e 745f 6c65 6e67 7468 2069 7320 6e6f  ent_length is no
+00008dc0: 7420 4e6f 6e65 2065 6c73 6520 4e6f 6e65  t None else None
+00008dd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00008de0: 6e6f 7420 6e6f 7469 6669 6572 3a0a 2020  not notifier:.  
+00008df0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00008e00: 7469 6669 6572 203d 2073 656c 662e 5f67  tifier = self._g
+00008e10: 6574 5f6e 6f74 6966 6965 7228 636f 6e74  et_notifier(cont
+00008e20: 656e 745f 6c65 6e67 7468 2c20 7072 6f67  ent_length, prog
+00008e30: 7265 7373 4361 6c6c 6261 636b 290a 2020  ressCallback).  
+00008e40: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00008e50: 7469 6669 6572 2e73 7461 7274 2829 0a20  tifier.start(). 
+00008e60: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00008e70: 745f 7772 6170 7065 7220 3d20 5265 7370  t_wrapper = Resp
+00008e80: 6f6e 7365 5772 6170 7065 7228 636f 6e6e  onseWrapper(conn
+00008e90: 2c20 7265 7370 6f6e 7365 2c20 7365 6c66  , response, self
+00008ea0: 2e63 6f6e 6e48 6f6c 6465 722c 2063 6f6e  .connHolder, con
+00008eb0: 7465 6e74 5f6c 656e 6774 682c 206e 6f74  tent_length, not
+00008ec0: 6966 6965 7229 0a20 2020 2020 2020 2020  ifier).         
+00008ed0: 2020 2069 6620 6c6f 6164 5374 7265 616d     if loadStream
+00008ee0: 496e 4d65 6d6f 7279 3a0a 2020 2020 2020  InMemory:.      
+00008ef0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00008f00: 6f67 5f63 6c69 656e 742e 6c6f 6728 4445  og_client.log(DE
+00008f10: 4255 472c 2027 6c6f 6164 5374 7265 616d  BUG, 'loadStream
+00008f20: 496e 4d65 6d6f 7279 2069 7320 5472 7565  InMemory is True
+00008f30: 2c20 7265 6164 2073 7472 6561 6d20 696e  , read stream in
+00008f40: 746f 206d 656d 6f72 7927 290a 2020 2020  to memory').    
+00008f50: 2020 2020 2020 2020 2020 2020 6275 6620              buf 
+00008f60: 3d20 7365 6c66 2e5f 6765 745f 6275 6666  = self._get_buff
+00008f70: 6572 5f64 6174 6128 7265 7375 6c74 5f77  er_data(result_w
+00008f80: 7261 7070 6572 2c20 6368 7563 6b53 697a  rapper, chuckSiz
+00008f90: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00008fa0: 2020 2062 6f64 7920 3d20 4f62 6a65 6374     body = Object
+00008fb0: 5374 7265 616d 2862 7566 6665 723d 6275  Stream(buffer=bu
+00008fc0: 662c 2073 697a 653d 7574 696c 2e74 6f5f  f, size=util.to_
+00008fd0: 6c6f 6e67 286c 656e 2862 7566 2929 2069  long(len(buf)) i
+00008fe0: 6620 6275 6620 6973 206e 6f74 204e 6f6e  f buf is not Non
+00008ff0: 6520 656c 7365 2030 290a 2020 2020 2020  e else 0).      
+00009000: 2020 2020 2020 656c 6966 2064 6f77 6e6c        elif downl
+00009010: 6f61 6450 6174 6820 6973 204e 6f6e 653a  oadPath is None:
+00009020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009030: 2073 656c 662e 6c6f 675f 636c 6965 6e74   self.log_client
+00009040: 2e6c 6f67 2844 4542 5547 2c20 2744 6f77  .log(DEBUG, 'Dow
+00009050: 6e6c 6f61 6450 6174 6820 6973 206e 6f6e  nloadPath is non
+00009060: 652c 2072 6574 7572 6e20 636f 6e6e 2064  e, return conn d
+00009070: 6972 6563 746c 7927 290a 2020 2020 2020  irectly').      
+00009080: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
+00009090: 636f 6e6e 5f66 6c61 6720 3d20 4661 6c73  conn_flag = Fals
+000090a0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000090b0: 2020 626f 6479 203d 204f 626a 6563 7453    body = ObjectS
+000090c0: 7472 6561 6d28 7265 7370 6f6e 7365 3d72  tream(response=r
+000090d0: 6573 756c 745f 7772 6170 7065 7229 0a20  esult_wrapper). 
+000090e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000090f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009100: 2064 6f77 6e6c 6f61 6450 6174 6820 3d20   downloadPath = 
+00009110: 7574 696c 2e73 6166 655f 656e 636f 6465  util.safe_encode
+00009120: 2864 6f77 6e6c 6f61 6450 6174 6829 0a20  (downloadPath). 
+00009130: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009140: 696c 655f 7061 7468 2c20 5f20 3d20 7365  ile_path, _ = se
+00009150: 6c66 2e5f 6765 745f 6461 7461 2872 6573  lf._get_data(res
+00009160: 756c 745f 7772 6170 7065 722c 2064 6f77  ult_wrapper, dow
+00009170: 6e6c 6f61 6450 6174 682c 2063 6875 636b  nloadPath, chuck
+00009180: 5369 7a65 290a 2020 2020 2020 2020 2020  Size).          
+00009190: 2020 2020 2020 626f 6479 203d 204f 626a        body = Obj
+000091a0: 6563 7453 7472 6561 6d28 7572 6c3d 7574  ectStream(url=ut
+000091b0: 696c 2e74 6f5f 7374 7269 6e67 2866 696c  il.to_string(fil
+000091c0: 655f 7061 7468 2929 0a20 2020 2020 2020  e_path)).       
+000091d0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+000091e0: 675f 636c 6965 6e74 2e6c 6f67 2844 4542  g_client.log(DEB
+000091f0: 5547 2c20 2744 6f77 6e6c 6f61 6450 6174  UG, 'DownloadPat
+00009200: 6820 6973 2027 202b 2075 7469 6c2e 746f  h is ' + util.to
+00009210: 5f73 7472 696e 6728 6669 6c65 5f70 6174  _string(file_pat
+00009220: 6829 290a 0a20 2020 2020 2020 2020 2020  h))..           
+00009230: 2073 7461 7475 7320 3d20 7574 696c 2e74   status = util.t
+00009240: 6f5f 696e 7428 7265 7370 6f6e 7365 2e73  o_int(response.s
+00009250: 7461 7475 7329 0a20 2020 2020 2020 2020  tatus).         
+00009260: 2020 2072 6561 736f 6e20 3d20 7265 7370     reason = resp
+00009270: 6f6e 7365 2e72 6561 736f 6e0a 2020 2020  onse.reason.    
+00009280: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00009290: 7665 7274 6f72 2e70 6172 7365 4765 744f  vertor.parseGetO
+000092a0: 626a 6563 7428 6865 6164 6572 732c 2062  bject(headers, b
+000092b0: 6f64 7929 0a20 2020 2020 2020 2020 2020  ody).           
+000092c0: 2068 6561 6465 7220 3d20 7365 6c66 2e5f   header = self._
+000092d0: 7265 6e61 6d65 5f72 6573 706f 6e73 655f  rename_response_
+000092e0: 6865 6164 6572 7328 6865 6164 6572 7329  headers(headers)
+000092f0: 0a20 2020 2020 2020 2020 2020 2072 6571  .            req
+00009300: 7565 7374 4964 203d 2064 6963 7428 6865  uestId = dict(he
+00009310: 6164 6572 292e 6765 7428 2772 6571 7565  ader).get('reque
+00009320: 7374 2d69 6427 290a 2020 2020 2020 2020  st-id').        
+00009330: 2020 2020 7265 7475 726e 2047 6574 5265      return GetRe
+00009340: 7375 6c74 2873 7461 7475 733d 7374 6174  sult(status=stat
+00009350: 7573 2c20 7265 6173 6f6e 3d72 6561 736f  us, reason=reaso
+00009360: 6e2c 2068 6561 6465 723d 6865 6164 6572  n, header=header
+00009370: 2c20 626f 6479 3d62 6f64 792c 2072 6571  , body=body, req
+00009380: 7565 7374 4964 3d72 6571 7565 7374 4964  uestId=requestId
+00009390: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+000093a0: 205f 5265 6469 7265 6374 4578 6365 7074   _RedirectExcept
+000093b0: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
+000093c0: 2020 2020 2020 2072 6169 7365 2065 780a         raise ex.
+000093d0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+000093e0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+000093f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009400: 6c6f 675f 636c 6965 6e74 2e6c 6f67 2845  log_client.log(E
+00009410: 5252 4f52 2c20 7472 6163 6562 6163 6b2e  RROR, traceback.
+00009420: 666f 726d 6174 5f65 7863 2829 290a 2020  format_exc()).  
+00009430: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00009440: 650a 2020 2020 2020 2020 6669 6e61 6c6c  e.        finall
+00009450: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
+00009460: 6620 636c 6f73 655f 636f 6e6e 5f66 6c61  f close_conn_fla
+00009470: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+00009480: 2020 2069 6620 7265 7375 6c74 5f77 7261     if result_wra
+00009490: 7070 6572 2069 7320 6e6f 7420 4e6f 6e65  pper is not None
+000094a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000094b0: 2020 2020 2020 7265 7375 6c74 5f77 7261        result_wra
+000094c0: 7070 6572 2e63 6c6f 7365 2829 0a20 2020  pper.close().   
+000094d0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000094e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000094f0: 2020 2020 2020 2075 7469 6c2e 646f 5f63         util.do_c
+00009500: 6c6f 7365 2872 6573 706f 6e73 652c 2063  lose(response, c
+00009510: 6f6e 6e2c 2073 656c 662e 636f 6e6e 486f  onn, self.connHo
+00009520: 6c64 6572 2c20 7365 6c66 2e6c 6f67 5f63  lder, self.log_c
+00009530: 6c69 656e 7429 0a0a 2020 2020 4073 7461  lient)..    @sta
+00009540: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+00009550: 6620 5f67 6574 5f62 7566 6665 725f 6461  f _get_buffer_da
+00009560: 7461 2872 6573 756c 7457 7261 7070 6572  ta(resultWrapper
+00009570: 2c20 6368 7563 6b53 697a 6529 3a0a 2020  , chuckSize):.  
+00009580: 2020 2020 2020 6275 6620 3d20 4e6f 6e65        buf = None
+00009590: 0a20 2020 2020 2020 2061 7070 656e 644c  .        appendL
+000095a0: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+000095b0: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
+000095c0: 2020 2020 2020 2020 2063 6875 6e6b 203d           chunk =
+000095d0: 2072 6573 756c 7457 7261 7070 6572 2e72   resultWrapper.r
+000095e0: 6561 6428 6368 7563 6b53 697a 6529 0a20  ead(chuckSize). 
+000095f0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00009600: 7420 6368 756e 6b3a 0a20 2020 2020 2020  t chunk:.       
+00009610: 2020 2020 2020 2020 2069 6620 626f 6f6c           if bool
+00009620: 2861 7070 656e 644c 6973 7429 3a0a 2020  (appendList):.  
+00009630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009640: 2020 7465 6d70 5374 7220 3d20 2222 0a20    tempStr = "". 
+00009650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009660: 2020 2069 6620 6e6f 7420 636f 6e73 742e     if not const.
+00009670: 4953 5f50 5954 484f 4e32 3a0a 2020 2020  IS_PYTHON2:.    
+00009680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009690: 2020 2020 7465 6d70 5374 7220 3d20 6222      tempStr = b"
+000096a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000096b0: 2020 2020 2020 6275 6620 3d20 7465 6d70        buf = temp
+000096c0: 5374 722e 6a6f 696e 2861 7070 656e 644c  Str.join(appendL
+000096d0: 6973 7429 0a20 2020 2020 2020 2020 2020  ist).           
+000096e0: 2020 2020 2020 2020 2064 656c 2061 7070           del app
+000096f0: 656e 644c 6973 745b 3a5d 0a20 2020 2020  endList[:].     
+00009700: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00009710: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
+00009720: 656e 644c 6973 742e 6170 7065 6e64 2863  endList.append(c
+00009730: 6875 6e6b 290a 2020 2020 2020 2020 7265  hunk).        re
+00009740: 7475 726e 2062 7566 0a0a 2020 2020 4073  turn buf..    @s
+00009750: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00009760: 6465 6620 5f67 6574 5f6e 6f74 6966 6965  def _get_notifie
+00009770: 7228 636f 6e74 656e 745f 6c65 6e67 7468  r(content_length
+00009780: 2c20 7072 6f67 7265 7373 4361 6c6c 6261  , progressCallba
+00009790: 636b 293a 0a20 2020 2020 2020 2072 6574  ck):.        ret
+000097a0: 7572 6e20 7072 6f67 7265 7373 2e50 726f  urn progress.Pro
+000097b0: 6772 6573 734e 6f74 6966 6965 7228 7072  gressNotifier(pr
+000097c0: 6f67 7265 7373 4361 6c6c 6261 636b 2c0a  ogressCallback,.
+000097d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097f0: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+00009800: 5f6c 656e 6774 6829 2069 6620 636f 6e74  _length) if cont
+00009810: 656e 745f 6c65 6e67 7468 2069 7320 6e6f  ent_length is no
+00009820: 7420 4e6f 6e65 2061 6e64 2063 6f6e 7465  t None and conte
+00009830: 6e74 5f6c 656e 6774 6820 3e20 3020 5c0a  nt_length > 0 \.
+00009840: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009850: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009870: 2020 2020 2020 2020 636f 6e74 656e 745f          content_
-00009880: 6c65 6e67 7468 2920 6966 2063 6f6e 7465  length) if conte
-00009890: 6e74 5f6c 656e 6774 6820 6973 206e 6f74  nt_length is not
-000098a0: 204e 6f6e 6520 616e 6420 636f 6e74 656e   None and conten
-000098b0: 745f 6c65 6e67 7468 203e 2030 205c 0a20  t_length > 0 \. 
-000098c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098f0: 2020 2020 2020 2020 2020 2061 6e64 2070             and p
-00009900: 726f 6772 6573 7343 616c 6c62 6163 6b20  rogressCallback 
-00009910: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-00009920: 2070 726f 6772 6573 732e 4e4f 4e45 5f4e   progress.NONE_N
-00009930: 4f54 4946 4945 520a 0a20 2020 2040 7374  OTIFIER..    @st
-00009940: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-00009950: 6566 205f 6765 745f 6461 7461 2872 6573  ef _get_data(res
-00009960: 756c 7457 7261 7070 6572 2c20 646f 776e  ultWrapper, down
-00009970: 6c6f 6164 5061 7468 2c20 6368 7563 6b53  loadPath, chuckS
-00009980: 697a 6529 3a0a 2020 2020 2020 2020 6f72  ize):.        or
-00009990: 6967 696e 5f66 696c 655f 7061 7468 203d  igin_file_path =
-000099a0: 2064 6f77 6e6c 6f61 6450 6174 680a 2020   downloadPath.  
-000099b0: 2020 2020 2020 7265 6164 5f63 6f75 6e74        read_count
-000099c0: 203d 2030 0a20 2020 2020 2020 2069 6620   = 0.        if 
-000099d0: 636f 6e73 742e 4953 5f57 494e 444f 5753  const.IS_WINDOWS
-000099e0: 3a0a 2020 2020 2020 2020 2020 2020 646f  :.            do
-000099f0: 776e 6c6f 6164 5061 7468 203d 2075 7469  wnloadPath = uti
-00009a00: 6c2e 7361 6665 5f74 7261 6e73 5f74 6f5f  l.safe_trans_to_
-00009a10: 6762 3233 3132 2864 6f77 6e6c 6f61 6450  gb2312(downloadP
-00009a20: 6174 6829 0a20 2020 2020 2020 2070 6174  ath).        pat
-00009a30: 6844 6972 203d 206f 732e 7061 7468 2e64  hDir = os.path.d
-00009a40: 6972 6e61 6d65 2864 6f77 6e6c 6f61 6450  irname(downloadP
-00009a50: 6174 6829 0a20 2020 2020 2020 2069 6620  ath).        if 
-00009a60: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-00009a70: 7473 2870 6174 6844 6972 293a 0a20 2020  ts(pathDir):.   
-00009a80: 2020 2020 2020 2020 206f 732e 6d61 6b65           os.make
-00009a90: 6469 7273 2870 6174 6844 6972 2c20 306f  dirs(pathDir, 0o
-00009aa0: 3735 3529 0a20 2020 2020 2020 2077 6974  755).        wit
-00009ab0: 6820 6f70 656e 2864 6f77 6e6c 6f61 6450  h open(downloadP
-00009ac0: 6174 682c 2027 7762 2729 2061 7320 663a  ath, 'wb') as f:
-00009ad0: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
-00009ae0: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-00009af0: 2020 2020 2020 2020 2063 6875 6e6b 203d           chunk =
-00009b00: 2072 6573 756c 7457 7261 7070 6572 2e72   resultWrapper.r
-00009b10: 6561 6428 6368 7563 6b53 697a 6529 0a20  ead(chuckSize). 
-00009b20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009b30: 6620 6e6f 7420 6368 756e 6b3a 0a20 2020  f not chunk:.   
-00009b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b50: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00009b60: 2020 2020 2020 2066 2e77 7269 7465 2863         f.write(c
-00009b70: 6875 6e6b 290a 2020 2020 2020 2020 2020  hunk).          
-00009b80: 2020 2020 2020 7265 6164 5f63 6f75 6e74        read_count
-00009b90: 202b 3d20 6c65 6e28 6368 756e 6b29 0a20   += len(chunk). 
-00009ba0: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
-00009bb0: 6967 696e 5f66 696c 655f 7061 7468 2c20  igin_file_path, 
-00009bc0: 7265 6164 5f63 6f75 6e74 0a0a 2020 2020  read_count..    
-00009bd0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-00009be0: 2020 6465 6620 5f72 656e 616d 655f 6b65    def _rename_ke
-00009bf0: 7928 6b2c 2076 293a 0a20 2020 2020 2020  y(k, v):.       
-00009c00: 2066 6c61 6720 3d20 300a 2020 2020 2020   flag = 0.      
-00009c10: 2020 6966 206b 2e73 7461 7274 7377 6974    if k.startswit
-00009c20: 6828 636f 6e73 742e 5632 5f4d 4554 415f  h(const.V2_META_
-00009c30: 4845 4144 4552 5f50 5245 4649 5829 3a0a  HEADER_PREFIX):.
-00009c40: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
-00009c50: 6b5b 6b2e 696e 6465 7828 636f 6e73 742e  k[k.index(const.
-00009c60: 5632 5f4d 4554 415f 4845 4144 4552 5f50  V2_META_HEADER_P
-00009c70: 5245 4649 5829 202b 206c 656e 2863 6f6e  REFIX) + len(con
-00009c80: 7374 2e56 325f 4d45 5441 5f48 4541 4445  st.V2_META_HEADE
-00009c90: 525f 5052 4546 4958 293a 5d0a 2020 2020  R_PREFIX):].    
-00009ca0: 2020 2020 2020 2020 6b20 3d20 7574 696c          k = util
-00009cb0: 2e64 6563 6f64 655f 6974 656d 286b 290a  .decode_item(k).
-00009cc0: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
-00009cd0: 7574 696c 2e64 6563 6f64 655f 6974 656d  util.decode_item
-00009ce0: 2876 290a 2020 2020 2020 2020 2020 2020  (v).            
-00009cf0: 666c 6167 203d 2031 0a20 2020 2020 2020  flag = 1.       
-00009d00: 2065 6c69 6620 6b2e 7374 6172 7473 7769   elif k.startswi
-00009d10: 7468 2863 6f6e 7374 2e56 325f 4845 4144  th(const.V2_HEAD
-00009d20: 4552 5f50 5245 4649 5829 3a0a 2020 2020  ER_PREFIX):.    
-00009d30: 2020 2020 2020 2020 6b20 3d20 6b5b 6b2e          k = k[k.
-00009d40: 696e 6465 7828 636f 6e73 742e 5632 5f48  index(const.V2_H
-00009d50: 4541 4445 525f 5052 4546 4958 2920 2b20  EADER_PREFIX) + 
-00009d60: 6c65 6e28 636f 6e73 742e 5632 5f48 4541  len(const.V2_HEA
-00009d70: 4445 525f 5052 4546 4958 293a 5d0a 2020  DER_PREFIX):].  
-00009d80: 2020 2020 2020 2020 2020 7620 3d20 7574            v = ut
-00009d90: 696c 2e64 6563 6f64 655f 6974 656d 2876  il.decode_item(v
-00009da0: 290a 2020 2020 2020 2020 2020 2020 666c  ).            fl
-00009db0: 6167 203d 2031 0a20 2020 2020 2020 2065  ag = 1.        e
-00009dc0: 6c69 6620 6b2e 7374 6172 7473 7769 7468  lif k.startswith
-00009dd0: 2863 6f6e 7374 2e4f 4253 5f4d 4554 415f  (const.OBS_META_
-00009de0: 4845 4144 4552 5f50 5245 4649 5829 3a0a  HEADER_PREFIX):.
-00009df0: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
-00009e00: 6b5b 6b2e 696e 6465 7828 636f 6e73 742e  k[k.index(const.
-00009e10: 4f42 535f 4d45 5441 5f48 4541 4445 525f  OBS_META_HEADER_
-00009e20: 5052 4546 4958 2920 2b20 6c65 6e28 636f  PREFIX) + len(co
-00009e30: 6e73 742e 4f42 535f 4d45 5441 5f48 4541  nst.OBS_META_HEA
-00009e40: 4445 525f 5052 4546 4958 293a 5d0a 2020  DER_PREFIX):].  
-00009e50: 2020 2020 2020 2020 2020 6b20 3d20 7574            k = ut
-00009e60: 696c 2e64 6563 6f64 655f 6974 656d 286b  il.decode_item(k
-00009e70: 290a 2020 2020 2020 2020 2020 2020 7620  ).            v 
-00009e80: 3d20 7574 696c 2e64 6563 6f64 655f 6974  = util.decode_it
-00009e90: 656d 2876 290a 2020 2020 2020 2020 2020  em(v).          
-00009ea0: 2020 666c 6167 203d 2031 0a20 2020 2020    flag = 1.     
-00009eb0: 2020 2065 6c69 6620 6b2e 7374 6172 7473     elif k.starts
-00009ec0: 7769 7468 2863 6f6e 7374 2e4f 4253 5f48  with(const.OBS_H
-00009ed0: 4541 4445 525f 5052 4546 4958 293a 0a20  EADER_PREFIX):. 
-00009ee0: 2020 2020 2020 2020 2020 206b 203d 206b             k = k
-00009ef0: 5b6b 2e69 6e64 6578 2863 6f6e 7374 2e4f  [k.index(const.O
-00009f00: 4253 5f48 4541 4445 525f 5052 4546 4958  BS_HEADER_PREFIX
-00009f10: 2920 2b20 6c65 6e28 636f 6e73 742e 4f42  ) + len(const.OB
-00009f20: 535f 4845 4144 4552 5f50 5245 4649 5829  S_HEADER_PREFIX)
-00009f30: 3a5d 0a20 2020 2020 2020 2020 2020 2076  :].            v
-00009f40: 203d 2075 7469 6c2e 6465 636f 6465 5f69   = util.decode_i
-00009f50: 7465 6d28 7629 0a20 2020 2020 2020 2020  tem(v).         
-00009f60: 2020 2066 6c61 6720 3d20 310a 2020 2020     flag = 1.    
-00009f70: 2020 2020 7265 7475 726e 2066 6c61 672c      return flag,
-00009f80: 206b 2c20 760a 0a20 2020 2064 6566 205f   k, v..    def _
-00009f90: 7265 6e61 6d65 5f72 6573 706f 6e73 655f  rename_response_
-00009fa0: 6865 6164 6572 7328 7365 6c66 2c20 6865  headers(self, he
-00009fb0: 6164 6572 7329 3a0a 2020 2020 2020 2020  aders):.        
-00009fc0: 6865 6164 6572 203d 205b 5d0a 2020 2020  header = [].    
-00009fd0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
-00009fe0: 6865 6164 6572 732e 6974 656d 7328 293a  headers.items():
-00009ff0: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
-0000a000: 6720 3d20 300a 2020 2020 2020 2020 2020  g = 0.          
-0000a010: 2020 6966 206b 2069 6e20 636f 6e73 742e    if k in const.
-0000a020: 414c 4c4f 5745 445f 5245 5350 4f4e 5345  ALLOWED_RESPONSE
-0000a030: 5f48 5454 505f 4845 4144 4552 5f4d 4554  _HTTP_HEADER_MET
-0000a040: 4144 4154 415f 4e41 4d45 533a 0a20 2020  ADATA_NAMES:.   
-0000a050: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-0000a060: 6720 3d20 310a 2020 2020 2020 2020 2020  g = 1.          
-0000a070: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000a080: 2020 2020 2020 2020 666c 6167 2c20 6b2c          flag, k,
-0000a090: 2076 203d 2073 656c 662e 5f72 656e 616d   v = self._renam
-0000a0a0: 655f 6b65 7928 6b2c 2076 290a 2020 2020  e_key(k, v).    
-0000a0b0: 2020 2020 2020 2020 6966 2066 6c61 673a          if flag:
-0000a0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0d0: 2068 6561 6465 722e 6170 7065 6e64 2828   header.append((
-0000a0e0: 6b2c 2076 2929 0a20 2020 2020 2020 2072  k, v)).        r
-0000a0f0: 6574 7572 6e20 6865 6164 6572 0a0a 2020  eturn header..  
-0000a100: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-0000a110: 2020 2020 6465 6620 5f70 7265 7061 7265      def _prepare
-0000a120: 5f72 6573 706f 6e73 655f 6461 7461 2872  _response_data(r
-0000a130: 6573 756c 742c 2063 6875 636b 5369 7a65  esult, chuckSize
-0000a140: 293a 0a20 2020 2020 2020 2072 6573 706f  ):.        respo
-0000a150: 6e73 6544 6174 6120 3d20 4e6f 6e65 0a20  nseData = None. 
-0000a160: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
-0000a170: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-0000a180: 6875 6e6b 203d 2072 6573 756c 742e 7265  hunk = result.re
-0000a190: 6164 2863 6875 636b 5369 7a65 290a 2020  ad(chuckSize).  
-0000a1a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000a1b0: 2063 6875 6e6b 3a0a 2020 2020 2020 2020   chunk:.        
-0000a1c0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0000a1d0: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
-0000a1e0: 7365 4461 7461 203d 2063 6875 6e6b 2069  seData = chunk i
-0000a1f0: 6620 7265 7370 6f6e 7365 4461 7461 2069  f responseData i
-0000a200: 7320 4e6f 6e65 2065 6c73 6520 7265 7370  s None else resp
-0000a210: 6f6e 7365 4461 7461 202b 2063 6875 6e6b  onseData + chunk
-0000a220: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000a230: 7265 7370 6f6e 7365 4461 7461 0a0a 2020  responseData..  
-0000a240: 2020 6465 6620 5f70 7265 7061 7265 5f62    def _prepare_b
-0000a250: 6f64 7928 7365 6c66 2c20 6d65 7468 6f64  ody(self, method
-0000a260: 4e61 6d65 2c20 7265 7370 6f6e 7365 4461  Name, responseDa
-0000a270: 7461 2c20 6973 4a73 6f6e 2c20 6865 6164  ta, isJson, head
-0000a280: 6572 7329 3a0a 2020 2020 2020 2020 626f  ers):.        bo
-0000a290: 6479 203d 204e 6f6e 650a 2020 2020 2020  dy = None.      
-0000a2a0: 2020 6966 206d 6574 686f 644e 616d 6520    if methodName 
-0000a2b0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000a2c0: 2020 2020 2020 2020 2070 6172 7365 4d65           parseMe
-0000a2d0: 7468 6f64 203d 2067 6574 6174 7472 2873  thod = getattr(s
-0000a2e0: 656c 662e 636f 6e76 6572 746f 722c 2027  elf.convertor, '
-0000a2f0: 7061 7273 6527 202b 206d 6574 686f 644e  parse' + methodN
-0000a300: 616d 655b 3a31 5d2e 7570 7065 7228 2920  ame[:1].upper() 
-0000a310: 2b20 6d65 7468 6f64 4e61 6d65 5b31 3a5d  + methodName[1:]
-0000a320: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000a330: 2070 6172 7365 4d65 7468 6f64 2069 7320   parseMethod is 
-0000a340: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000a350: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00009870: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00009880: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
+00009890: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+000098a0: 6520 7072 6f67 7265 7373 2e4e 4f4e 455f  e progress.NONE_
+000098b0: 4e4f 5449 4649 4552 0a0a 2020 2020 4073  NOTIFIER..    @s
+000098c0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+000098d0: 6465 6620 5f67 6574 5f64 6174 6128 7265  def _get_data(re
+000098e0: 7375 6c74 5772 6170 7065 722c 2064 6f77  sultWrapper, dow
+000098f0: 6e6c 6f61 6450 6174 682c 2063 6875 636b  nloadPath, chuck
+00009900: 5369 7a65 293a 0a20 2020 2020 2020 206f  Size):.        o
+00009910: 7269 6769 6e5f 6669 6c65 5f70 6174 6820  rigin_file_path 
+00009920: 3d20 646f 776e 6c6f 6164 5061 7468 0a20  = downloadPath. 
+00009930: 2020 2020 2020 2072 6561 645f 636f 756e         read_coun
+00009940: 7420 3d20 300a 2020 2020 2020 2020 6966  t = 0.        if
+00009950: 2063 6f6e 7374 2e49 535f 5749 4e44 4f57   const.IS_WINDOW
+00009960: 533a 0a20 2020 2020 2020 2020 2020 2064  S:.            d
+00009970: 6f77 6e6c 6f61 6450 6174 6820 3d20 7574  ownloadPath = ut
+00009980: 696c 2e73 6166 655f 7472 616e 735f 746f  il.safe_trans_to
+00009990: 5f67 6232 3331 3228 646f 776e 6c6f 6164  _gb2312(download
+000099a0: 5061 7468 290a 2020 2020 2020 2020 7061  Path).        pa
+000099b0: 7468 4469 7220 3d20 6f73 2e70 6174 682e  thDir = os.path.
+000099c0: 6469 726e 616d 6528 646f 776e 6c6f 6164  dirname(download
+000099d0: 5061 7468 290a 2020 2020 2020 2020 6966  Path).        if
+000099e0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+000099f0: 7374 7328 7061 7468 4469 7229 3a0a 2020  sts(pathDir):.  
+00009a00: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
+00009a10: 6564 6972 7328 7061 7468 4469 722c 2030  edirs(pathDir, 0
+00009a20: 6f37 3535 290a 0a20 2020 2020 2020 206d  o755)..        m
+00009a30: 6f64 6573 203d 2073 7461 742e 535f 4957  odes = stat.S_IW
+00009a40: 5553 5220 7c20 7374 6174 2e53 5f49 5255  USR | stat.S_IRU
+00009a50: 5352 0a20 2020 2020 2020 2066 6c61 6773  SR.        flags
+00009a60: 203d 206f 732e 4f5f 5244 5752 207c 206f   = os.O_RDWR | o
+00009a70: 732e 4f5f 5452 554e 4320 7c20 6f73 2e4f  s.O_TRUNC | os.O
+00009a80: 5f43 5245 4154 0a20 2020 2020 2020 2077  _CREAT.        w
+00009a90: 6974 6820 6f73 2e66 646f 7065 6e28 6f73  ith os.fdopen(os
+00009aa0: 2e6f 7065 6e28 646f 776e 6c6f 6164 5061  .open(downloadPa
+00009ab0: 7468 2c20 666c 6167 732c 206d 6f64 6573  th, flags, modes
+00009ac0: 292c 2027 7762 2729 2061 7320 663a 0a20  ), 'wb') as f:. 
+00009ad0: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+00009ae0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+00009af0: 2020 2020 2020 2063 6875 6e6b 203d 2072         chunk = r
+00009b00: 6573 756c 7457 7261 7070 6572 2e72 6561  esultWrapper.rea
+00009b10: 6428 6368 7563 6b53 697a 6529 0a20 2020  d(chuckSize).   
+00009b20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00009b30: 6e6f 7420 6368 756e 6b3a 0a20 2020 2020  not chunk:.     
+00009b40: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00009b50: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00009b60: 2020 2020 2066 2e77 7269 7465 2863 6875       f.write(chu
+00009b70: 6e6b 290a 2020 2020 2020 2020 2020 2020  nk).            
+00009b80: 2020 2020 7265 6164 5f63 6f75 6e74 202b      read_count +
+00009b90: 3d20 6c65 6e28 6368 756e 6b29 0a20 2020  = len(chunk).   
+00009ba0: 2020 2020 2072 6574 7572 6e20 6f72 6967       return orig
+00009bb0: 696e 5f66 696c 655f 7061 7468 2c20 7265  in_file_path, re
+00009bc0: 6164 5f63 6f75 6e74 0a0a 2020 2020 4073  ad_count..    @s
+00009bd0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00009be0: 6465 6620 5f72 656e 616d 655f 6b65 7928  def _rename_key(
+00009bf0: 6b2c 2076 293a 0a20 2020 2020 2020 2066  k, v):.        f
+00009c00: 6c61 6720 3d20 300a 2020 2020 2020 2020  lag = 0.        
+00009c10: 6966 206b 2e73 7461 7274 7377 6974 6828  if k.startswith(
+00009c20: 636f 6e73 742e 5632 5f4d 4554 415f 4845  const.V2_META_HE
+00009c30: 4144 4552 5f50 5245 4649 5829 3a0a 2020  ADER_PREFIX):.  
+00009c40: 2020 2020 2020 2020 2020 6b20 3d20 6b5b            k = k[
+00009c50: 6b2e 696e 6465 7828 636f 6e73 742e 5632  k.index(const.V2
+00009c60: 5f4d 4554 415f 4845 4144 4552 5f50 5245  _META_HEADER_PRE
+00009c70: 4649 5829 202b 206c 656e 2863 6f6e 7374  FIX) + len(const
+00009c80: 2e56 325f 4d45 5441 5f48 4541 4445 525f  .V2_META_HEADER_
+00009c90: 5052 4546 4958 293a 5d0a 2020 2020 2020  PREFIX):].      
+00009ca0: 2020 2020 2020 6b20 3d20 7574 696c 2e64        k = util.d
+00009cb0: 6563 6f64 655f 6974 656d 286b 290a 2020  ecode_item(k).  
+00009cc0: 2020 2020 2020 2020 2020 7620 3d20 7574            v = ut
+00009cd0: 696c 2e64 6563 6f64 655f 6974 656d 2876  il.decode_item(v
+00009ce0: 290a 2020 2020 2020 2020 2020 2020 666c  ).            fl
+00009cf0: 6167 203d 2031 0a20 2020 2020 2020 2065  ag = 1.        e
+00009d00: 6c69 6620 6b2e 7374 6172 7473 7769 7468  lif k.startswith
+00009d10: 2863 6f6e 7374 2e56 325f 4845 4144 4552  (const.V2_HEADER
+00009d20: 5f50 5245 4649 5829 3a0a 2020 2020 2020  _PREFIX):.      
+00009d30: 2020 2020 2020 6b20 3d20 6b5b 6b2e 696e        k = k[k.in
+00009d40: 6465 7828 636f 6e73 742e 5632 5f48 4541  dex(const.V2_HEA
+00009d50: 4445 525f 5052 4546 4958 2920 2b20 6c65  DER_PREFIX) + le
+00009d60: 6e28 636f 6e73 742e 5632 5f48 4541 4445  n(const.V2_HEADE
+00009d70: 525f 5052 4546 4958 293a 5d0a 2020 2020  R_PREFIX):].    
+00009d80: 2020 2020 2020 2020 7620 3d20 7574 696c          v = util
+00009d90: 2e64 6563 6f64 655f 6974 656d 2876 290a  .decode_item(v).
+00009da0: 2020 2020 2020 2020 2020 2020 666c 6167              flag
+00009db0: 203d 2031 0a20 2020 2020 2020 2065 6c69   = 1.        eli
+00009dc0: 6620 6b2e 7374 6172 7473 7769 7468 2863  f k.startswith(c
+00009dd0: 6f6e 7374 2e4f 4253 5f4d 4554 415f 4845  onst.OBS_META_HE
+00009de0: 4144 4552 5f50 5245 4649 5829 3a0a 2020  ADER_PREFIX):.  
+00009df0: 2020 2020 2020 2020 2020 6b20 3d20 6b5b            k = k[
+00009e00: 6b2e 696e 6465 7828 636f 6e73 742e 4f42  k.index(const.OB
+00009e10: 535f 4d45 5441 5f48 4541 4445 525f 5052  S_META_HEADER_PR
+00009e20: 4546 4958 2920 2b20 6c65 6e28 636f 6e73  EFIX) + len(cons
+00009e30: 742e 4f42 535f 4d45 5441 5f48 4541 4445  t.OBS_META_HEADE
+00009e40: 525f 5052 4546 4958 293a 5d0a 2020 2020  R_PREFIX):].    
+00009e50: 2020 2020 2020 2020 6b20 3d20 7574 696c          k = util
+00009e60: 2e64 6563 6f64 655f 6974 656d 286b 290a  .decode_item(k).
+00009e70: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
+00009e80: 7574 696c 2e64 6563 6f64 655f 6974 656d  util.decode_item
+00009e90: 2876 290a 2020 2020 2020 2020 2020 2020  (v).            
+00009ea0: 666c 6167 203d 2031 0a20 2020 2020 2020  flag = 1.       
+00009eb0: 2065 6c69 6620 6b2e 7374 6172 7473 7769   elif k.startswi
+00009ec0: 7468 2863 6f6e 7374 2e4f 4253 5f48 4541  th(const.OBS_HEA
+00009ed0: 4445 525f 5052 4546 4958 293a 0a20 2020  DER_PREFIX):.   
+00009ee0: 2020 2020 2020 2020 206b 203d 206b 5b6b           k = k[k
+00009ef0: 2e69 6e64 6578 2863 6f6e 7374 2e4f 4253  .index(const.OBS
+00009f00: 5f48 4541 4445 525f 5052 4546 4958 2920  _HEADER_PREFIX) 
+00009f10: 2b20 6c65 6e28 636f 6e73 742e 4f42 535f  + len(const.OBS_
+00009f20: 4845 4144 4552 5f50 5245 4649 5829 3a5d  HEADER_PREFIX):]
+00009f30: 0a20 2020 2020 2020 2020 2020 2076 203d  .            v =
+00009f40: 2075 7469 6c2e 6465 636f 6465 5f69 7465   util.decode_ite
+00009f50: 6d28 7629 0a20 2020 2020 2020 2020 2020  m(v).           
+00009f60: 2066 6c61 6720 3d20 310a 2020 2020 2020   flag = 1.      
+00009f70: 2020 7265 7475 726e 2066 6c61 672c 206b    return flag, k
+00009f80: 2c20 760a 0a20 2020 2064 6566 205f 7265  , v..    def _re
+00009f90: 6e61 6d65 5f72 6573 706f 6e73 655f 6865  name_response_he
+00009fa0: 6164 6572 7328 7365 6c66 2c20 6865 6164  aders(self, head
+00009fb0: 6572 7329 3a0a 2020 2020 2020 2020 6865  ers):.        he
+00009fc0: 6164 6572 203d 205b 5d0a 2020 2020 2020  ader = [].      
+00009fd0: 2020 666f 7220 6b2c 2076 2069 6e20 6865    for k, v in he
+00009fe0: 6164 6572 732e 6974 656d 7328 293a 0a20  aders.items():. 
+00009ff0: 2020 2020 2020 2020 2020 2066 6c61 6720             flag 
+0000a000: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0000a010: 6966 206b 2069 6e20 636f 6e73 742e 414c  if k in const.AL
+0000a020: 4c4f 5745 445f 5245 5350 4f4e 5345 5f48  LOWED_RESPONSE_H
+0000a030: 5454 505f 4845 4144 4552 5f4d 4554 4144  TTP_HEADER_METAD
+0000a040: 4154 415f 4e41 4d45 533a 0a20 2020 2020  ATA_NAMES:.     
+0000a050: 2020 2020 2020 2020 2020 2066 6c61 6720             flag 
+0000a060: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0000a070: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000a080: 2020 2020 2020 666c 6167 2c20 6b2c 2076        flag, k, v
+0000a090: 203d 2073 656c 662e 5f72 656e 616d 655f   = self._rename_
+0000a0a0: 6b65 7928 6b2c 2076 290a 2020 2020 2020  key(k, v).      
+0000a0b0: 2020 2020 2020 6966 2066 6c61 673a 0a20        if flag:. 
+0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000a0d0: 6561 6465 722e 6170 7065 6e64 2828 6b2c  eader.append((k,
+0000a0e0: 2076 2929 0a20 2020 2020 2020 2072 6574   v)).        ret
+0000a0f0: 7572 6e20 6865 6164 6572 0a0a 2020 2020  urn header..    
+0000a100: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+0000a110: 2020 6465 6620 5f70 7265 7061 7265 5f72    def _prepare_r
+0000a120: 6573 706f 6e73 655f 6461 7461 2872 6573  esponse_data(res
+0000a130: 756c 742c 2063 6875 636b 5369 7a65 293a  ult, chuckSize):
+0000a140: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
+0000a150: 6544 6174 6120 3d20 4e6f 6e65 0a20 2020  eData = None.   
+0000a160: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+0000a170: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
+0000a180: 6e6b 203d 2072 6573 756c 742e 7265 6164  nk = result.read
+0000a190: 2863 6875 636b 5369 7a65 290a 2020 2020  (chuckSize).    
+0000a1a0: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
+0000a1b0: 6875 6e6b 3a0a 2020 2020 2020 2020 2020  hunk:.          
+0000a1c0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0000a1d0: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+0000a1e0: 4461 7461 203d 2063 6875 6e6b 2069 6620  Data = chunk if 
+0000a1f0: 7265 7370 6f6e 7365 4461 7461 2069 7320  responseData is 
+0000a200: 4e6f 6e65 2065 6c73 6520 7265 7370 6f6e  None else respon
+0000a210: 7365 4461 7461 202b 2063 6875 6e6b 0a20  seData + chunk. 
+0000a220: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000a230: 7370 6f6e 7365 4461 7461 0a0a 2020 2020  sponseData..    
+0000a240: 6465 6620 5f70 7265 7061 7265 5f62 6f64  def _prepare_bod
+0000a250: 7928 7365 6c66 2c20 6d65 7468 6f64 4e61  y(self, methodNa
+0000a260: 6d65 2c20 7265 7370 6f6e 7365 4461 7461  me, responseData
+0000a270: 2c20 6973 4a73 6f6e 2c20 6865 6164 6572  , isJson, header
+0000a280: 7329 3a0a 2020 2020 2020 2020 626f 6479  s):.        body
+0000a290: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000a2a0: 6966 206d 6574 686f 644e 616d 6520 6973  if methodName is
+0000a2b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000a2c0: 2020 2020 2020 2070 6172 7365 4d65 7468         parseMeth
+0000a2d0: 6f64 203d 2067 6574 6174 7472 2873 656c  od = getattr(sel
+0000a2e0: 662e 636f 6e76 6572 746f 722c 2027 7061  f.convertor, 'pa
+0000a2f0: 7273 6527 202b 206d 6574 686f 644e 616d  rse' + methodNam
+0000a300: 655b 3a31 5d2e 7570 7065 7228 2920 2b20  e[:1].upper() + 
+0000a310: 6d65 7468 6f64 4e61 6d65 5b31 3a5d 290a  methodName[1:]).
+0000a320: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0000a330: 6172 7365 4d65 7468 6f64 2069 7320 6e6f  arseMethod is no
+0000a340: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000a350: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
 0000a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a370: 2020 2069 6620 7265 7370 6f6e 7365 4461     if responseDa
-0000a380: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-0000a390: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-0000a3a0: 6f6e 7365 4461 7461 203d 2072 6573 706f  onseData = respo
-0000a3b0: 6e73 6544 6174 6120 6966 2063 6f6e 7374  nseData if const
-0000a3c0: 2e49 535f 5059 5448 4f4e 3220 656c 7365  .IS_PYTHON2 else
-0000a3d0: 2072 6573 706f 6e73 6544 6174 612e 6465   responseData.de
-0000a3e0: 636f 6465 2827 5554 462d 3827 290a 2020  code('UTF-8').  
+0000a370: 2069 6620 7265 7370 6f6e 7365 4461 7461   if responseData
+0000a380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a390: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
+0000a3a0: 7365 4461 7461 203d 2072 6573 706f 6e73  seData = respons
+0000a3b0: 6544 6174 6120 6966 2063 6f6e 7374 2e49  eData if const.I
+0000a3c0: 535f 5059 5448 4f4e 3220 656c 7365 2072  S_PYTHON2 else r
+0000a3d0: 6573 706f 6e73 6544 6174 612e 6465 636f  esponseData.deco
+0000a3e0: 6465 2827 5554 462d 3827 290a 2020 2020  de('UTF-8').    
 0000a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a400: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
-0000a410: 6c69 656e 742e 6c6f 6728 4445 4255 472c  lient.log(DEBUG,
-0000a420: 2027 7265 6365 6976 6520 4d73 673a 2573   'receive Msg:%s
-0000a430: 272c 2072 6573 706f 6e73 6544 6174 6129  ', responseData)
-0000a440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a450: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0000a460: 6973 4a73 6f6e 3a0a 2020 2020 2020 2020  isJson:.        
+0000a400: 2020 2020 7365 6c66 2e6c 6f67 5f63 6c69      self.log_cli
+0000a410: 656e 742e 6c6f 6728 4445 4255 472c 2027  ent.log(DEBUG, '
+0000a420: 7265 6365 6976 6520 4d73 673a 2573 272c  receive Msg:%s',
+0000a430: 2072 6573 706f 6e73 6544 6174 6129 0a20   responseData). 
+0000a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a450: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000a460: 4a73 6f6e 3a0a 2020 2020 2020 2020 2020  Json:.          
 0000a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a480: 2020 2020 7365 6172 6368 203d 2073 656c      search = sel
-0000a490: 662e 7061 7474 6572 6e2e 7365 6172 6368  f.pattern.search
-0000a4a0: 2872 6573 706f 6e73 6544 6174 6129 0a20  (responseData). 
+0000a480: 2020 7365 6172 6368 203d 2073 656c 662e    search = self.
+0000a490: 7061 7474 6572 6e2e 7365 6172 6368 2872  pattern.search(r
+0000a4a0: 6573 706f 6e73 6544 6174 6129 0a20 2020  esponseData).   
 0000a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4c0: 2020 2020 2020 2020 2020 2072 6573 706f             respo
-0000a4d0: 6e73 6544 6174 6120 3d20 7265 7370 6f6e  nseData = respon
-0000a4e0: 7365 4461 7461 2069 6620 7365 6172 6368  seData if search
-0000a4f0: 2069 7320 4e6f 6e65 2065 6c73 6520 7265   is None else re
-0000a500: 7370 6f6e 7365 4461 7461 2e72 6570 6c61  sponseData.repla
-0000a510: 6365 2873 6561 7263 682e 6772 6f75 7028  ce(search.group(
-0000a520: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000a4c0: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
+0000a4d0: 6544 6174 6120 3d20 7265 7370 6f6e 7365  eData = response
+0000a4e0: 4461 7461 2069 6620 7365 6172 6368 2069  Data if search i
+0000a4f0: 7320 4e6f 6e65 2065 6c73 6520 7265 7370  s None else resp
+0000a500: 6f6e 7365 4461 7461 2e72 6570 6c61 6365  onseData.replace
+0000a510: 2873 6561 7263 682e 6772 6f75 7028 292c  (search.group(),
+0000a520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a580: 2020 2020 2020 2027 2729 0a20 2020 2020         '').     
+0000a580: 2020 2020 2027 2729 0a20 2020 2020 2020       '').       
 0000a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5a0: 2020 2062 6f64 7920 3d20 7061 7273 654d     body = parseM
-0000a5b0: 6574 686f 6428 7265 7370 6f6e 7365 4461  ethod(responseDa
-0000a5c0: 7461 2c20 6865 6164 6572 7329 0a20 2020  ta, headers).   
-0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a5f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000a600: 6f64 7920 3d20 7061 7273 654d 6574 686f  ody = parseMetho
-0000a610: 6428 6865 6164 6572 7329 0a20 2020 2020  d(headers).     
-0000a620: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000a630: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-0000a640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a650: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
-0000a660: 6c69 656e 742e 6c6f 6728 4552 524f 522c  lient.log(ERROR,
-0000a670: 2075 7469 6c2e 746f 5f73 7472 696e 6728   util.to_string(
-0000a680: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-0000a690: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0000a6a0: 5f63 6c69 656e 742e 6c6f 6728 4552 524f  _client.log(ERRO
-0000a6b0: 522c 2074 7261 6365 6261 636b 2e66 6f72  R, traceback.for
-0000a6c0: 6d61 745f 6578 6328 2929 0a20 2020 2020  mat_exc()).     
-0000a6d0: 2020 2072 6574 7572 6e20 7265 7370 6f6e     return respon
-0000a6e0: 7365 4461 7461 2c20 626f 6479 0a0a 2020  seData, body..  
-0000a6f0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-0000a700: 2020 2020 6465 6620 5f70 7265 7061 7265      def _prepare
-0000a710: 5f72 6571 7565 7374 5f69 6428 7265 7175  _request_id(requ
-0000a720: 6573 7449 642c 2068 6561 6465 7273 293a  estId, headers):
-0000a730: 0a20 2020 2020 2020 2069 6620 7265 7175  .        if requ
-0000a740: 6573 7449 6420 6973 204e 6f6e 653a 0a20  estId is None:. 
-0000a750: 2020 2020 2020 2020 2020 2072 6571 7565             reque
-0000a760: 7374 4964 203d 2068 6561 6465 7273 2e67  stId = headers.g
-0000a770: 6574 2827 782d 6f62 732d 7265 7175 6573  et('x-obs-reques
-0000a780: 742d 6964 2729 0a20 2020 2020 2020 2069  t-id').        i
-0000a790: 6620 7265 7175 6573 7449 6420 6973 204e  f requestId is N
-0000a7a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000a7b0: 2072 6571 7565 7374 4964 203d 2068 6561   requestId = hea
-0000a7c0: 6465 7273 2e67 6574 2827 782d 616d 7a2d  ders.get('x-amz-
-0000a7d0: 7265 7175 6573 742d 6964 2729 0a20 2020  request-id').   
-0000a7e0: 2020 2020 2072 6574 7572 6e20 7265 7175       return requ
-0000a7f0: 6573 7449 640a 0a20 2020 2040 7374 6174  estId..    @stat
-0000a800: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-0000a810: 205f 6973 5f72 6564 6972 6563 745f 6578   _is_redirect_ex
-0000a820: 6365 7074 696f 6e28 7374 6174 7573 2c20  ception(status, 
-0000a830: 6865 6164 6572 7329 3a0a 2020 2020 2020  headers):.      
-0000a840: 2020 7265 7475 726e 2033 3030 203c 3d20    return 300 <= 
-0000a850: 7374 6174 7573 203c 2034 3030 2061 6e64  status < 400 and
-0000a860: 2073 7461 7475 7320 213d 2033 3034 2061   status != 304 a
-0000a870: 6e64 2063 6f6e 7374 2e4c 4f43 4154 494f  nd const.LOCATIO
-0000a880: 4e5f 4845 4144 4552 2e6c 6f77 6572 2829  N_HEADER.lower()
-0000a890: 2069 6e20 6865 6164 6572 730a 0a20 2020   in headers..   
-0000a8a0: 2064 6566 205f 7061 7273 655f 786d 6c5f   def _parse_xml_
-0000a8b0: 696e 7465 726e 616c 2873 656c 662c 2072  internal(self, r
-0000a8c0: 6573 756c 742c 206d 6574 686f 644e 616d  esult, methodNam
-0000a8d0: 653d 4e6f 6e65 2c20 6368 7563 6b53 697a  e=None, chuckSiz
-0000a8e0: 653d 636f 6e73 742e 5245 4144 5f4f 4e43  e=const.READ_ONC
-0000a8f0: 455f 4c45 4e47 5448 2c20 7265 6164 6162  E_LENGTH, readab
-0000a900: 6c65 3d46 616c 7365 293a 0a20 2020 2020  le=False):.     
-0000a910: 2020 2073 7461 7475 7320 3d20 7574 696c     status = util
-0000a920: 2e74 6f5f 696e 7428 7265 7375 6c74 2e73  .to_int(result.s
-0000a930: 7461 7475 7329 0a20 2020 2020 2020 2072  tatus).        r
-0000a940: 6561 736f 6e20 3d20 7265 7375 6c74 2e72  eason = result.r
-0000a950: 6561 736f 6e0a 2020 2020 2020 2020 636f  eason.        co
-0000a960: 6465 203d 204e 6f6e 650a 2020 2020 2020  de = None.      
-0000a970: 2020 6d65 7373 6167 6520 3d20 4e6f 6e65    message = None
-0000a980: 0a20 2020 2020 2020 2062 6f64 7920 3d20  .        body = 
-0000a990: 4e6f 6e65 0a20 2020 2020 2020 2072 6571  None.        req
-0000a9a0: 7565 7374 4964 203d 204e 6f6e 650a 2020  uestId = None.  
-0000a9b0: 2020 2020 2020 686f 7374 4964 203d 204e        hostId = N
-0000a9c0: 6f6e 650a 2020 2020 2020 2020 7265 736f  one.        reso
-0000a9d0: 7572 6365 203d 204e 6f6e 650a 2020 2020  urce = None.    
-0000a9e0: 2020 2020 6865 6164 6572 7320 3d20 7b7d      headers = {}
-0000a9f0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-0000aa00: 7620 696e 2072 6573 756c 742e 6765 7468  v in result.geth
-0000aa10: 6561 6465 7273 2829 3a0a 2020 2020 2020  eaders():.      
-0000aa20: 2020 2020 2020 6865 6164 6572 735b 6b2e        headers[k.
-0000aa30: 6c6f 7765 7228 295d 203d 2076 0a20 2020  lower()] = v.   
-0000aa40: 2020 2020 2072 6573 706f 6e73 6544 6174       responseDat
-0000aa50: 6120 3d20 7365 6c66 2e5f 7072 6570 6172  a = self._prepar
-0000aa60: 655f 7265 7370 6f6e 7365 5f64 6174 6128  e_response_data(
-0000aa70: 7265 7375 6c74 2c20 6368 7563 6b53 697a  result, chuckSiz
-0000aa80: 6529 0a0a 2020 2020 2020 2020 6865 6164  e)..        head
-0000aa90: 6572 203d 2073 656c 662e 5f72 656e 616d  er = self._renam
-0000aaa0: 655f 7265 7370 6f6e 7365 5f68 6561 6465  e_response_heade
-0000aab0: 7273 2868 6561 6465 7273 290a 2020 2020  rs(headers).    
-0000aac0: 2020 2020 6973 4a73 6f6e 203d 2068 6561      isJson = hea
-0000aad0: 6465 7273 2e67 6574 2863 6f6e 7374 2e43  ders.get(const.C
-0000aae0: 4f4e 5445 4e54 5f54 5950 455f 4845 4144  ONTENT_TYPE_HEAD
-0000aaf0: 4552 2e6c 6f77 6572 2829 2c20 2778 6d6c  ER.lower(), 'xml
-0000ab00: 2729 203d 3d20 636f 6e73 742e 4d49 4d45  ') == const.MIME
-0000ab10: 5f54 5950 4553 2e67 6574 2827 6a73 6f6e  _TYPES.get('json
-0000ab20: 2729 0a20 2020 2020 2020 2069 6e64 6963  ').        indic
-0000ab30: 6174 6f72 203d 2068 6561 6465 7273 2e67  ator = headers.g
-0000ab40: 6574 2873 656c 662e 6861 2e69 6e64 6963  et(self.ha.indic
-0000ab50: 6174 6f72 5f68 6561 6465 7228 2929 0a0a  ator_header())..
-0000ab60: 2020 2020 2020 2020 6966 2073 7461 7475          if statu
-0000ab70: 7320 3c20 3330 303a 0a20 2020 2020 2020  s < 300:.       
-0000ab80: 2020 2020 2072 6573 706f 6e73 6544 6174       responseDat
-0000ab90: 612c 2062 6f64 7920 3d20 7365 6c66 2e5f  a, body = self._
-0000aba0: 7072 6570 6172 655f 626f 6479 286d 6574  prepare_body(met
-0000abb0: 686f 644e 616d 652c 2072 6573 706f 6e73  hodName, respons
-0000abc0: 6544 6174 612c 2069 734a 736f 6e2c 2068  eData, isJson, h
-0000abd0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
-0000abe0: 2020 2020 7265 7175 6573 7449 6420 3d20      requestId = 
-0000abf0: 7365 6c66 2e5f 7072 6570 6172 655f 7265  self._prepare_re
-0000ac00: 7175 6573 745f 6964 284e 6f6e 652c 2068  quest_id(None, h
-0000ac10: 6561 6465 7273 290a 0a20 2020 2020 2020  eaders)..       
-0000ac20: 2065 6c69 6620 7265 7370 6f6e 7365 4461   elif responseDa
-0000ac30: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-0000ac40: 7265 7370 6f6e 7365 4461 7461 203d 2072  responseData = r
-0000ac50: 6573 706f 6e73 6544 6174 6120 6966 2063  esponseData if c
-0000ac60: 6f6e 7374 2e49 535f 5059 5448 4f4e 3220  onst.IS_PYTHON2 
-0000ac70: 656c 7365 2072 6573 706f 6e73 6544 6174  else responseDat
-0000ac80: 612e 6465 636f 6465 2827 5554 462d 3827  a.decode('UTF-8'
-0000ac90: 290a 2020 2020 2020 2020 2020 2020 7472  ).            tr
-0000aca0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000acb0: 2020 2069 6620 6973 4a73 6f6e 3a0a 2020     if isJson:.  
+0000a5a0: 2062 6f64 7920 3d20 7061 7273 654d 6574   body = parseMet
+0000a5b0: 686f 6428 7265 7370 6f6e 7365 4461 7461  hod(responseData
+0000a5c0: 2c20 6865 6164 6572 7329 0a20 2020 2020  , headers).     
+0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000a5e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000a5f0: 2020 2020 2020 2020 2020 2020 2062 6f64               bod
+0000a600: 7920 3d20 7061 7273 654d 6574 686f 6428  y = parseMethod(
+0000a610: 6865 6164 6572 7329 0a20 2020 2020 2020  headers).       
+0000a620: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000a630: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+0000a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a650: 2020 2020 7365 6c66 2e6c 6f67 5f63 6c69      self.log_cli
+0000a660: 656e 742e 6c6f 6728 4552 524f 522c 2075  ent.log(ERROR, u
+0000a670: 7469 6c2e 746f 5f73 7472 696e 6728 6529  til.to_string(e)
+0000a680: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a690: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
+0000a6a0: 6c69 656e 742e 6c6f 6728 4552 524f 522c  lient.log(ERROR,
+0000a6b0: 2074 7261 6365 6261 636b 2e66 6f72 6d61   traceback.forma
+0000a6c0: 745f 6578 6328 2929 0a20 2020 2020 2020  t_exc()).       
+0000a6d0: 2072 6574 7572 6e20 7265 7370 6f6e 7365   return response
+0000a6e0: 4461 7461 2c20 626f 6479 0a0a 2020 2020  Data, body..    
+0000a6f0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+0000a700: 2020 6465 6620 5f70 7265 7061 7265 5f72    def _prepare_r
+0000a710: 6571 7565 7374 5f69 6428 7265 7175 6573  equest_id(reques
+0000a720: 7449 642c 2068 6561 6465 7273 293a 0a20  tId, headers):. 
+0000a730: 2020 2020 2020 2069 6620 7265 7175 6573         if reques
+0000a740: 7449 6420 6973 204e 6f6e 653a 0a20 2020  tId is None:.   
+0000a750: 2020 2020 2020 2020 2072 6571 7565 7374           request
+0000a760: 4964 203d 2068 6561 6465 7273 2e67 6574  Id = headers.get
+0000a770: 2827 782d 6f62 732d 7265 7175 6573 742d  ('x-obs-request-
+0000a780: 6964 2729 0a20 2020 2020 2020 2069 6620  id').        if 
+0000a790: 7265 7175 6573 7449 6420 6973 204e 6f6e  requestId is Non
+0000a7a0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000a7b0: 6571 7565 7374 4964 203d 2068 6561 6465  equestId = heade
+0000a7c0: 7273 2e67 6574 2827 782d 616d 7a2d 7265  rs.get('x-amz-re
+0000a7d0: 7175 6573 742d 6964 2729 0a20 2020 2020  quest-id').     
+0000a7e0: 2020 2072 6574 7572 6e20 7265 7175 6573     return reques
+0000a7f0: 7449 640a 0a20 2020 2040 7374 6174 6963  tId..    @static
+0000a800: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+0000a810: 6973 5f72 6564 6972 6563 745f 6578 6365  is_redirect_exce
+0000a820: 7074 696f 6e28 7374 6174 7573 2c20 6865  ption(status, he
+0000a830: 6164 6572 7329 3a0a 2020 2020 2020 2020  aders):.        
+0000a840: 7265 7475 726e 2033 3030 203c 3d20 7374  return 300 <= st
+0000a850: 6174 7573 203c 2034 3030 2061 6e64 2073  atus < 400 and s
+0000a860: 7461 7475 7320 213d 2033 3034 2061 6e64  tatus != 304 and
+0000a870: 2063 6f6e 7374 2e4c 4f43 4154 494f 4e5f   const.LOCATION_
+0000a880: 4845 4144 4552 2e6c 6f77 6572 2829 2069  HEADER.lower() i
+0000a890: 6e20 6865 6164 6572 730a 0a20 2020 2064  n headers..    d
+0000a8a0: 6566 205f 7061 7273 655f 786d 6c5f 696e  ef _parse_xml_in
+0000a8b0: 7465 726e 616c 2873 656c 662c 2072 6573  ternal(self, res
+0000a8c0: 756c 742c 206d 6574 686f 644e 616d 653d  ult, methodName=
+0000a8d0: 4e6f 6e65 2c20 6368 7563 6b53 697a 653d  None, chuckSize=
+0000a8e0: 636f 6e73 742e 5245 4144 5f4f 4e43 455f  const.READ_ONCE_
+0000a8f0: 4c45 4e47 5448 2c20 7265 6164 6162 6c65  LENGTH, readable
+0000a900: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+0000a910: 2073 7461 7475 7320 3d20 7574 696c 2e74   status = util.t
+0000a920: 6f5f 696e 7428 7265 7375 6c74 2e73 7461  o_int(result.sta
+0000a930: 7475 7329 0a20 2020 2020 2020 2072 6561  tus).        rea
+0000a940: 736f 6e20 3d20 7265 7375 6c74 2e72 6561  son = result.rea
+0000a950: 736f 6e0a 2020 2020 2020 2020 636f 6465  son.        code
+0000a960: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000a970: 6d65 7373 6167 6520 3d20 4e6f 6e65 0a20  message = None. 
+0000a980: 2020 2020 2020 2062 6f64 7920 3d20 4e6f         body = No
+0000a990: 6e65 0a20 2020 2020 2020 2072 6571 7565  ne.        reque
+0000a9a0: 7374 4964 203d 204e 6f6e 650a 2020 2020  stId = None.    
+0000a9b0: 2020 2020 686f 7374 4964 203d 204e 6f6e      hostId = Non
+0000a9c0: 650a 2020 2020 2020 2020 7265 736f 7572  e.        resour
+0000a9d0: 6365 203d 204e 6f6e 650a 2020 2020 2020  ce = None.      
+0000a9e0: 2020 6865 6164 6572 7320 3d20 7b7d 0a20    headers = {}. 
+0000a9f0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+0000aa00: 696e 2072 6573 756c 742e 6765 7468 6561  in result.gethea
+0000aa10: 6465 7273 2829 3a0a 2020 2020 2020 2020  ders():.        
+0000aa20: 2020 2020 6865 6164 6572 735b 6b2e 6c6f      headers[k.lo
+0000aa30: 7765 7228 295d 203d 2076 0a20 2020 2020  wer()] = v.     
+0000aa40: 2020 2072 6573 706f 6e73 6544 6174 6120     responseData 
+0000aa50: 3d20 7365 6c66 2e5f 7072 6570 6172 655f  = self._prepare_
+0000aa60: 7265 7370 6f6e 7365 5f64 6174 6128 7265  response_data(re
+0000aa70: 7375 6c74 2c20 6368 7563 6b53 697a 6529  sult, chuckSize)
+0000aa80: 0a0a 2020 2020 2020 2020 6865 6164 6572  ..        header
+0000aa90: 203d 2073 656c 662e 5f72 656e 616d 655f   = self._rename_
+0000aaa0: 7265 7370 6f6e 7365 5f68 6561 6465 7273  response_headers
+0000aab0: 2868 6561 6465 7273 290a 2020 2020 2020  (headers).      
+0000aac0: 2020 6973 4a73 6f6e 203d 2068 6561 6465    isJson = heade
+0000aad0: 7273 2e67 6574 2863 6f6e 7374 2e43 4f4e  rs.get(const.CON
+0000aae0: 5445 4e54 5f54 5950 455f 4845 4144 4552  TENT_TYPE_HEADER
+0000aaf0: 2e6c 6f77 6572 2829 2c20 2778 6d6c 2729  .lower(), 'xml')
+0000ab00: 203d 3d20 636f 6e73 742e 4d49 4d45 5f54   == const.MIME_T
+0000ab10: 5950 4553 2e67 6574 2827 6a73 6f6e 2729  YPES.get('json')
+0000ab20: 0a20 2020 2020 2020 2069 6e64 6963 6174  .        indicat
+0000ab30: 6f72 203d 2068 6561 6465 7273 2e67 6574  or = headers.get
+0000ab40: 2873 656c 662e 6861 2e69 6e64 6963 6174  (self.ha.indicat
+0000ab50: 6f72 5f68 6561 6465 7228 2929 0a0a 2020  or_header())..  
+0000ab60: 2020 2020 2020 6966 2073 7461 7475 7320        if status 
+0000ab70: 3c20 3330 303a 0a20 2020 2020 2020 2020  < 300:.         
+0000ab80: 2020 2072 6573 706f 6e73 6544 6174 612c     responseData,
+0000ab90: 2062 6f64 7920 3d20 7365 6c66 2e5f 7072   body = self._pr
+0000aba0: 6570 6172 655f 626f 6479 286d 6574 686f  epare_body(metho
+0000abb0: 644e 616d 652c 2072 6573 706f 6e73 6544  dName, responseD
+0000abc0: 6174 612c 2069 734a 736f 6e2c 2068 6561  ata, isJson, hea
+0000abd0: 6465 7273 290a 2020 2020 2020 2020 2020  ders).          
+0000abe0: 2020 7265 7175 6573 7449 6420 3d20 7365    requestId = se
+0000abf0: 6c66 2e5f 7072 6570 6172 655f 7265 7175  lf._prepare_requ
+0000ac00: 6573 745f 6964 284e 6f6e 652c 2068 6561  est_id(None, hea
+0000ac10: 6465 7273 290a 0a20 2020 2020 2020 2065  ders)..        e
+0000ac20: 6c69 6620 7265 7370 6f6e 7365 4461 7461  lif responseData
+0000ac30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000ac40: 7370 6f6e 7365 4461 7461 203d 2072 6573  sponseData = res
+0000ac50: 706f 6e73 6544 6174 6120 6966 2063 6f6e  ponseData if con
+0000ac60: 7374 2e49 535f 5059 5448 4f4e 3220 656c  st.IS_PYTHON2 el
+0000ac70: 7365 2072 6573 706f 6e73 6544 6174 612e  se responseData.
+0000ac80: 6465 636f 6465 2827 5554 462d 3827 290a  decode('UTF-8').
+0000ac90: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0000aca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000acb0: 2069 6620 6973 4a73 6f6e 3a0a 2020 2020   if isJson:.    
 0000acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acd0: 2020 636f 6465 2c20 6d65 7373 6167 652c    code, message,
-0000ace0: 2072 6571 7565 7374 4964 203d 2073 656c   requestId = sel
-0000acf0: 662e 636f 6e76 6572 746f 722e 7061 7273  f.convertor.pars
-0000ad00: 654a 736f 6e45 7272 6f72 5265 7375 6c74  eJsonErrorResult
-0000ad10: 2872 6573 706f 6e73 6544 6174 6129 0a20  (responseData). 
-0000ad20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000ad30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000ad40: 2020 2020 2020 2020 2073 6561 7263 6820           search 
-0000ad50: 3d20 7365 6c66 2e70 6174 7465 726e 2e73  = self.pattern.s
-0000ad60: 6561 7263 6828 7265 7370 6f6e 7365 4461  earch(responseDa
-0000ad70: 7461 290a 2020 2020 2020 2020 2020 2020  ta).            
-0000ad80: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-0000ad90: 4461 7461 203d 2072 6573 706f 6e73 6544  Data = responseD
-0000ada0: 6174 6120 6966 2073 6561 7263 6820 6973  ata if search is
-0000adb0: 204e 6f6e 6520 656c 7365 2072 6573 706f   None else respo
-0000adc0: 6e73 6544 6174 612e 7265 706c 6163 6528  nseData.replace(
-0000add0: 7365 6172 6368 2e67 726f 7570 2829 2c20  search.group(), 
-0000ade0: 2727 290a 2020 2020 2020 2020 2020 2020  '').            
-0000adf0: 2020 2020 2020 2020 636f 6465 2c20 6d65          code, me
-0000ae00: 7373 6167 652c 2072 6571 7565 7374 4964  ssage, requestId
-0000ae10: 2c20 686f 7374 4964 2c20 7265 736f 7572  , hostId, resour
-0000ae20: 6365 203d 2073 656c 662e 636f 6e76 6572  ce = self.conver
-0000ae30: 746f 722e 7061 7273 6545 7272 6f72 5265  tor.parseErrorRe
-0000ae40: 7375 6c74 2872 6573 706f 6e73 6544 6174  sult(responseDat
-0000ae50: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
-0000ae60: 2020 2062 6f64 7920 3d20 7265 7370 6f6e     body = respon
-0000ae70: 7365 4461 7461 0a20 2020 2020 2020 2020  seData.         
-0000ae80: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0000ae90: 696f 6e20 6173 2065 653a 0a20 2020 2020  ion as ee:.     
-0000aea0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000aeb0: 6c6f 675f 636c 6965 6e74 2e6c 6f67 2845  log_client.log(E
-0000aec0: 5252 4f52 2c20 7574 696c 2e74 6f5f 7374  RROR, util.to_st
-0000aed0: 7269 6e67 2865 6529 290a 2020 2020 2020  ring(ee)).      
-0000aee0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0000aef0: 6f67 5f63 6c69 656e 742e 6c6f 6728 4552  og_client.log(ER
-0000af00: 524f 522c 2074 7261 6365 6261 636b 2e66  ROR, traceback.f
-0000af10: 6f72 6d61 745f 6578 6328 2929 0a0a 2020  ormat_exc())..  
-0000af20: 2020 2020 2020 7265 7175 6573 7449 6420        requestId 
-0000af30: 3d20 7365 6c66 2e5f 7072 6570 6172 655f  = self._prepare_
-0000af40: 7265 7175 6573 745f 6964 2872 6571 7565  request_id(reque
-0000af50: 7374 4964 2c20 6865 6164 6572 7329 0a0a  stId, headers)..
-0000af60: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0000af70: 5f63 6c69 656e 742e 6c6f 6728 4445 4255  _client.log(DEBU
-0000af80: 472c 2027 6874 7470 2072 6573 706f 6e73  G, 'http respons
-0000af90: 6520 7265 7375 6c74 3a73 7461 7475 733a  e result:status:
-0000afa0: 2564 2c72 6561 736f 6e3a 2573 2c63 6f64  %d,reason:%s,cod
-0000afb0: 653a 2573 2c6d 6573 7361 6765 3a25 732c  e:%s,message:%s,
-0000afc0: 6865 6164 6572 733a 2573 272c 0a20 2020  headers:%s',.   
+0000acd0: 636f 6465 2c20 6d65 7373 6167 652c 2072  code, message, r
+0000ace0: 6571 7565 7374 4964 203d 2073 656c 662e  equestId = self.
+0000acf0: 636f 6e76 6572 746f 722e 7061 7273 654a  convertor.parseJ
+0000ad00: 736f 6e45 7272 6f72 5265 7375 6c74 2872  sonErrorResult(r
+0000ad10: 6573 706f 6e73 6544 6174 6129 0a20 2020  esponseData).   
+0000ad20: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0000ad30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000ad40: 2020 2020 2020 2073 6561 7263 6820 3d20         search = 
+0000ad50: 7365 6c66 2e70 6174 7465 726e 2e73 6561  self.pattern.sea
+0000ad60: 7263 6828 7265 7370 6f6e 7365 4461 7461  rch(responseData
+0000ad70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ad80: 2020 2020 2020 7265 7370 6f6e 7365 4461        responseDa
+0000ad90: 7461 203d 2072 6573 706f 6e73 6544 6174  ta = responseDat
+0000ada0: 6120 6966 2073 6561 7263 6820 6973 204e  a if search is N
+0000adb0: 6f6e 6520 656c 7365 2072 6573 706f 6e73  one else respons
+0000adc0: 6544 6174 612e 7265 706c 6163 6528 7365  eData.replace(se
+0000add0: 6172 6368 2e67 726f 7570 2829 2c20 2727  arch.group(), ''
+0000ade0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000adf0: 2020 2020 2020 636f 6465 2c20 6d65 7373        code, mess
+0000ae00: 6167 652c 2072 6571 7565 7374 4964 2c20  age, requestId, 
+0000ae10: 686f 7374 4964 2c20 7265 736f 7572 6365  hostId, resource
+0000ae20: 203d 2073 656c 662e 636f 6e76 6572 746f   = self.converto
+0000ae30: 722e 7061 7273 6545 7272 6f72 5265 7375  r.parseErrorResu
+0000ae40: 6c74 2872 6573 706f 6e73 6544 6174 6129  lt(responseData)
+0000ae50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ae60: 2062 6f64 7920 3d20 7265 7370 6f6e 7365   body = response
+0000ae70: 4461 7461 0a20 2020 2020 2020 2020 2020  Data.           
+0000ae80: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0000ae90: 6e20 6173 2065 653a 0a20 2020 2020 2020  n as ee:.       
+0000aea0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+0000aeb0: 675f 636c 6965 6e74 2e6c 6f67 2845 5252  g_client.log(ERR
+0000aec0: 4f52 2c20 7574 696c 2e74 6f5f 7374 7269  OR, util.to_stri
+0000aed0: 6e67 2865 6529 290a 2020 2020 2020 2020  ng(ee)).        
+0000aee0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0000aef0: 5f63 6c69 656e 742e 6c6f 6728 4552 524f  _client.log(ERRO
+0000af00: 522c 2074 7261 6365 6261 636b 2e66 6f72  R, traceback.for
+0000af10: 6d61 745f 6578 6328 2929 0a0a 2020 2020  mat_exc())..    
+0000af20: 2020 2020 7265 7175 6573 7449 6420 3d20      requestId = 
+0000af30: 7365 6c66 2e5f 7072 6570 6172 655f 7265  self._prepare_re
+0000af40: 7175 6573 745f 6964 2872 6571 7565 7374  quest_id(request
+0000af50: 4964 2c20 6865 6164 6572 7329 0a0a 2020  Id, headers)..  
+0000af60: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
+0000af70: 6c69 656e 742e 6c6f 6728 4445 4255 472c  lient.log(DEBUG,
+0000af80: 2027 6874 7470 2072 6573 706f 6e73 6520   'http response 
+0000af90: 7265 7375 6c74 3a73 7461 7475 733a 2564  result:status:%d
+0000afa0: 2c72 6561 736f 6e3a 2573 2c63 6f64 653a  ,reason:%s,code:
+0000afb0: 2573 2c6d 6573 7361 6765 3a25 732c 6865  %s,message:%s,he
+0000afc0: 6164 6572 733a 2573 272c 0a20 2020 2020  aders:%s',.     
 0000afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afe0: 2020 2020 2020 2020 2073 7461 7475 732c           status,
-0000aff0: 2072 6561 736f 6e2c 2063 6f64 652c 206d   reason, code, m
-0000b000: 6573 7361 6765 2c20 6865 6164 6572 290a  essage, header).
-0000b010: 0a20 2020 2020 2020 2069 6620 7374 6174  .        if stat
-0000b020: 7573 203e 3d20 3330 303a 0a20 2020 2020  us >= 300:.     
-0000b030: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
-0000b040: 636c 6965 6e74 2e6c 6f67 2845 5252 4f52  client.log(ERROR
-0000b050: 2c20 2765 7863 6570 7469 6f6e 616c 206f  , 'exceptional o
-0000b060: 6273 2072 6573 706f 6e73 653a 7374 6174  bs response:stat
-0000b070: 7573 3a25 642c 7265 6173 6f6e 3a25 732c  us:%d,reason:%s,
-0000b080: 636f 6465 3a25 732c 6d65 7373 6167 653a  code:%s,message:
-0000b090: 2573 2c72 6571 7565 7374 4964 3a25 7327  %s,requestId:%s'
-0000b0a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000afe0: 2020 2020 2020 2073 7461 7475 732c 2072         status, r
+0000aff0: 6561 736f 6e2c 2063 6f64 652c 206d 6573  eason, code, mes
+0000b000: 7361 6765 2c20 6865 6164 6572 290a 0a20  sage, header).. 
+0000b010: 2020 2020 2020 2069 6620 7374 6174 7573         if status
+0000b020: 203e 3d20 3330 303a 0a20 2020 2020 2020   >= 300:.       
+0000b030: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
+0000b040: 6965 6e74 2e6c 6f67 2845 5252 4f52 2c20  ient.log(ERROR, 
+0000b050: 2765 7863 6570 7469 6f6e 616c 206f 6273  'exceptional obs
+0000b060: 2072 6573 706f 6e73 653a 7374 6174 7573   response:status
+0000b070: 3a25 642c 7265 6173 6f6e 3a25 732c 636f  :%d,reason:%s,co
+0000b080: 6465 3a25 732c 6d65 7373 6167 653a 2573  de:%s,message:%s
+0000b090: 2c72 6571 7565 7374 4964 3a25 7327 2c0a  ,requestId:%s',.
+0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0c0: 2020 7374 6174 7573 2c20 7265 6173 6f6e    status, reason
-0000b0d0: 2c20 636f 6465 2c20 6d65 7373 6167 652c  , code, message,
-0000b0e0: 2072 6571 7565 7374 4964 290a 0a20 2020   requestId)..   
-0000b0f0: 2020 2020 2072 6574 203d 2047 6574 5265       ret = GetRe
-0000b100: 7375 6c74 2863 6f64 653d 636f 6465 2c20  sult(code=code, 
-0000b110: 6d65 7373 6167 653d 6d65 7373 6167 652c  message=message,
-0000b120: 2073 7461 7475 733d 7374 6174 7573 2c20   status=status, 
-0000b130: 7265 6173 6f6e 3d72 6561 736f 6e2c 2062  reason=reason, b
-0000b140: 6f64 793d 626f 6479 2c0a 2020 2020 2020  ody=body,.      
+0000b0c0: 7374 6174 7573 2c20 7265 6173 6f6e 2c20  status, reason, 
+0000b0d0: 636f 6465 2c20 6d65 7373 6167 652c 2072  code, message, r
+0000b0e0: 6571 7565 7374 4964 290a 0a20 2020 2020  equestId)..     
+0000b0f0: 2020 2072 6574 203d 2047 6574 5265 7375     ret = GetResu
+0000b100: 6c74 2863 6f64 653d 636f 6465 2c20 6d65  lt(code=code, me
+0000b110: 7373 6167 653d 6d65 7373 6167 652c 2073  ssage=message, s
+0000b120: 7461 7475 733d 7374 6174 7573 2c20 7265  tatus=status, re
+0000b130: 6173 6f6e 3d72 6561 736f 6e2c 2062 6f64  ason=reason, bod
+0000b140: 793d 626f 6479 2c0a 2020 2020 2020 2020  y=body,.        
 0000b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b160: 2020 7265 7175 6573 7449 643d 7265 7175    requestId=requ
-0000b170: 6573 7449 642c 2068 6f73 7449 643d 686f  estId, hostId=ho
-0000b180: 7374 4964 2c20 7265 736f 7572 6365 3d72  stId, resource=r
-0000b190: 6573 6f75 7263 652c 2068 6561 6465 723d  esource, header=
-0000b1a0: 6865 6164 6572 2c20 696e 6469 6361 746f  header, indicato
-0000b1b0: 723d 696e 6469 6361 746f 7229 0a0a 2020  r=indicator)..  
-0000b1c0: 2020 2020 2020 6966 206e 6f74 2072 6561        if not rea
-0000b1d0: 6461 626c 653a 0a20 2020 2020 2020 2020  dable:.         
-0000b1e0: 2020 2069 6620 7365 6c66 2e5f 6973 5f72     if self._is_r
-0000b1f0: 6564 6972 6563 745f 6578 6365 7074 696f  edirect_exceptio
-0000b200: 6e28 7374 6174 7573 2c20 6865 6164 6572  n(status, header
-0000b210: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000b220: 2020 2020 6c6f 6361 7469 6f6e 203d 2068      location = h
-0000b230: 6561 6465 7273 2e67 6574 2863 6f6e 7374  eaders.get(const
-0000b240: 2e4c 4f43 4154 494f 4e5f 4845 4144 4552  .LOCATION_HEADER
-0000b250: 2e6c 6f77 6572 2829 290a 2020 2020 2020  .lower()).      
-0000b260: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0000b270: 6f67 5f63 6c69 656e 742e 6c6f 6728 5741  og_client.log(WA
-0000b280: 524e 494e 472c 2027 6874 7470 2063 6f64  RNING, 'http cod
-0000b290: 6520 6973 2025 642c 206e 6565 6420 746f  e is %d, need to
-0000b2a0: 2072 6564 6972 6563 7420 746f 2025 7327   redirect to %s'
-0000b2b0: 2c20 7374 6174 7573 2c20 6c6f 6361 7469  , status, locati
-0000b2c0: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
-0000b2d0: 2020 2020 7261 6973 6520 5f52 6564 6972      raise _Redir
-0000b2e0: 6563 7445 7863 6570 7469 6f6e 2827 6874  ectException('ht
-0000b2f0: 7470 2063 6f64 6520 6973 207b 307d 2c20  tp code is {0}, 
-0000b300: 6e65 6564 2074 6f20 7265 6469 7265 6374  need to redirect
-0000b310: 2074 6f20 7b31 7d27 2e66 6f72 6d61 7428   to {1}'.format(
-0000b320: 7374 6174 7573 2c20 6c6f 6361 7469 6f6e  status, location
-0000b330: 292c 206c 6f63 6174 696f 6e2c 0a20 2020  ), location,.   
+0000b160: 7265 7175 6573 7449 643d 7265 7175 6573  requestId=reques
+0000b170: 7449 642c 2068 6f73 7449 643d 686f 7374  tId, hostId=host
+0000b180: 4964 2c20 7265 736f 7572 6365 3d72 6573  Id, resource=res
+0000b190: 6f75 7263 652c 2068 6561 6465 723d 6865  ource, header=he
+0000b1a0: 6164 6572 2c20 696e 6469 6361 746f 723d  ader, indicator=
+0000b1b0: 696e 6469 6361 746f 7229 0a0a 2020 2020  indicator)..    
+0000b1c0: 2020 2020 6966 206e 6f74 2072 6561 6461      if not reada
+0000b1d0: 626c 653a 0a20 2020 2020 2020 2020 2020  ble:.           
+0000b1e0: 2069 6620 7365 6c66 2e5f 6973 5f72 6564   if self._is_red
+0000b1f0: 6972 6563 745f 6578 6365 7074 696f 6e28  irect_exception(
+0000b200: 7374 6174 7573 2c20 6865 6164 6572 7329  status, headers)
+0000b210: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b220: 2020 6c6f 6361 7469 6f6e 203d 2068 6561    location = hea
+0000b230: 6465 7273 2e67 6574 2863 6f6e 7374 2e4c  ders.get(const.L
+0000b240: 4f43 4154 494f 4e5f 4845 4144 4552 2e6c  OCATION_HEADER.l
+0000b250: 6f77 6572 2829 290a 2020 2020 2020 2020  ower()).        
+0000b260: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0000b270: 5f63 6c69 656e 742e 6c6f 6728 5741 524e  _client.log(WARN
+0000b280: 494e 472c 2027 6874 7470 2063 6f64 6520  ING, 'http code 
+0000b290: 6973 2025 642c 206e 6565 6420 746f 2072  is %d, need to r
+0000b2a0: 6564 6972 6563 7420 746f 2025 7327 2c20  edirect to %s', 
+0000b2b0: 7374 6174 7573 2c20 6c6f 6361 7469 6f6e  status, location
+0000b2c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b2d0: 2020 7261 6973 6520 5f52 6564 6972 6563    raise _Redirec
+0000b2e0: 7445 7863 6570 7469 6f6e 2827 6874 7470  tException('http
+0000b2f0: 2063 6f64 6520 6973 207b 307d 2c20 6e65   code is {0}, ne
+0000b300: 6564 2074 6f20 7265 6469 7265 6374 2074  ed to redirect t
+0000b310: 6f20 7b31 7d27 2e66 6f72 6d61 7428 7374  o {1}'.format(st
+0000b320: 6174 7573 2c20 6c6f 6361 7469 6f6e 292c  atus, location),
+0000b330: 206c 6f63 6174 696f 6e2c 0a20 2020 2020   location,.     
 0000b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b360: 2020 2020 2020 7265 7429 0a0a 2020 2020        ret)..    
-0000b370: 2020 2020 2020 2020 6966 2073 7461 7475          if statu
-0000b380: 7320 3e3d 2035 3030 3a0a 2020 2020 2020  s >= 500:.      
-0000b390: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000b3a0: 5f49 6e74 6572 6e61 6c45 7863 6570 7469  _InternalExcepti
-0000b3b0: 6f6e 2872 6574 290a 2020 2020 2020 2020  on(ret).        
-0000b3c0: 7265 7475 726e 2072 6574 0a0a 0a63 6c61  return ret...cla
-0000b3d0: 7373 205f 4372 6561 7465 5369 676e 6564  ss _CreateSigned
-0000b3e0: 5572 6c52 6573 706f 6e73 6528 4261 7365  UrlResponse(Base
-0000b3f0: 4d6f 6465 6c29 3a0a 2020 2020 616c 6c6f  Model):.    allo
-0000b400: 7765 6441 7474 7220 3d20 7b27 7369 676e  wedAttr = {'sign
-0000b410: 6564 5572 6c27 3a20 636f 6e73 742e 4241  edUrl': const.BA
-0000b420: 5345 5354 5249 4e47 2c20 2761 6374 7561  SESTRING, 'actua
-0000b430: 6c53 6967 6e65 6452 6571 7565 7374 4865  lSignedRequestHe
-0000b440: 6164 6572 7327 3a20 6469 6374 7d0a 0a0a  aders': dict}...
-0000b450: 636c 6173 7320 5f43 7265 6174 6550 6f73  class _CreatePos
-0000b460: 7453 6967 6e61 7475 7265 5265 7370 6f6e  tSignatureRespon
-0000b470: 7365 2842 6173 654d 6f64 656c 293a 0a20  se(BaseModel):. 
-0000b480: 2020 2061 6c6c 6f77 6564 4174 7472 203d     allowedAttr =
-0000b490: 207b 276f 7269 6769 6e50 6f6c 6963 7927   {'originPolicy'
-0000b4a0: 3a20 636f 6e73 742e 4241 5345 5354 5249  : const.BASESTRI
-0000b4b0: 4e47 2c20 2770 6f6c 6963 7927 3a20 636f  NG, 'policy': co
-0000b4c0: 6e73 742e 4241 5345 5354 5249 4e47 2c0a  nst.BASESTRING,.
+0000b360: 2020 2020 7265 7429 0a0a 2020 2020 2020      ret)..      
+0000b370: 2020 2020 2020 6966 2073 7461 7475 7320        if status 
+0000b380: 3e3d 2035 3030 3a0a 2020 2020 2020 2020  >= 500:.        
+0000b390: 2020 2020 2020 2020 7261 6973 6520 5f49          raise _I
+0000b3a0: 6e74 6572 6e61 6c45 7863 6570 7469 6f6e  nternalException
+0000b3b0: 2872 6574 290a 2020 2020 2020 2020 7265  (ret).        re
+0000b3c0: 7475 726e 2072 6574 0a0a 0a63 6c61 7373  turn ret...class
+0000b3d0: 205f 4372 6561 7465 5369 676e 6564 5572   _CreateSignedUr
+0000b3e0: 6c52 6573 706f 6e73 6528 4261 7365 4d6f  lResponse(BaseMo
+0000b3f0: 6465 6c29 3a0a 2020 2020 616c 6c6f 7765  del):.    allowe
+0000b400: 6441 7474 7220 3d20 7b27 7369 676e 6564  dAttr = {'signed
+0000b410: 5572 6c27 3a20 636f 6e73 742e 4241 5345  Url': const.BASE
+0000b420: 5354 5249 4e47 2c20 2761 6374 7561 6c53  STRING, 'actualS
+0000b430: 6967 6e65 6452 6571 7565 7374 4865 6164  ignedRequestHead
+0000b440: 6572 7327 3a20 6469 6374 7d0a 0a0a 636c  ers': dict}...cl
+0000b450: 6173 7320 5f43 7265 6174 6550 6f73 7453  ass _CreatePostS
+0000b460: 6967 6e61 7475 7265 5265 7370 6f6e 7365  ignatureResponse
+0000b470: 2842 6173 654d 6f64 656c 293a 0a20 2020  (BaseModel):.   
+0000b480: 2061 6c6c 6f77 6564 4174 7472 203d 207b   allowedAttr = {
+0000b490: 276f 7269 6769 6e50 6f6c 6963 7927 3a20  'originPolicy': 
+0000b4a0: 636f 6e73 742e 4241 5345 5354 5249 4e47  const.BASESTRING
+0000b4b0: 2c20 2770 6f6c 6963 7927 3a20 636f 6e73  , 'policy': cons
+0000b4c0: 742e 4241 5345 5354 5249 4e47 2c0a 2020  t.BASESTRING,.  
 0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4e0: 2020 2027 6372 6564 656e 7469 616c 273a     'credential':
-0000b4f0: 2063 6f6e 7374 2e42 4153 4553 5452 494e   const.BASESTRIN
-0000b500: 472c 2027 6461 7465 273a 2063 6f6e 7374  G, 'date': const
-0000b510: 2e42 4153 4553 5452 494e 472c 2027 7369  .BASESTRING, 'si
-0000b520: 676e 6174 7572 6527 3a20 636f 6e73 742e  gnature': const.
-0000b530: 4241 5345 5354 5249 4e47 2c0a 2020 2020  BASESTRING,.    
-0000b540: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000b550: 6163 6365 7373 4b65 7949 6427 3a20 636f  accessKeyId': co
-0000b560: 6e73 742e 4241 5345 5354 5249 4e47 7d0a  nst.BASESTRING}.
-0000b570: 0a0a 636c 6173 7320 4f62 7343 6c69 656e  ..class ObsClien
-0000b580: 7428 5f42 6173 6963 436c 6965 6e74 293a  t(_BasicClient):
-0000b590: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0000b5a0: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
-0000b5b0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0000b5c0: 2020 2073 7570 6572 284f 6273 436c 6965     super(ObsClie
-0000b5d0: 6e74 2c20 7365 6c66 292e 5f5f 696e 6974  nt, self).__init
-0000b5e0: 5f5f 282a 6172 6773 2c20 2a2a 6b77 6172  __(*args, **kwar
-0000b5f0: 6773 290a 0a20 2020 2064 6566 205f 7072  gs)..    def _pr
-0000b600: 6570 6172 6550 6172 616d 6574 6572 466f  epareParameterFo
-0000b610: 7253 6967 6e65 6455 726c 2873 656c 662c  rSignedUrl(self,
-0000b620: 2073 7065 6369 616c 5061 7261 6d2c 2065   specialParam, e
-0000b630: 7870 6972 6573 2c20 6865 6164 6572 732c  xpires, headers,
-0000b640: 2071 7565 7279 5061 7261 6d73 293a 0a0a   queryParams):..
-0000b650: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-0000b660: 3d20 7b7d 2069 6620 6865 6164 6572 7320  = {} if headers 
-0000b670: 6973 204e 6f6e 6520 6f72 206e 6f74 2069  is None or not i
-0000b680: 7369 6e73 7461 6e63 6528 6865 6164 6572  sinstance(header
-0000b690: 732c 2064 6963 7429 2065 6c73 6520 6865  s, dict) else he
-0000b6a0: 6164 6572 732e 636f 7079 2829 0a20 2020  aders.copy().   
-0000b6b0: 2020 2020 2071 7565 7279 5061 7261 6d73       queryParams
-0000b6c0: 203d 207b 7d20 6966 2071 7565 7279 5061   = {} if queryPa
-0000b6d0: 7261 6d73 2069 7320 4e6f 6e65 206f 7220  rams is None or 
-0000b6e0: 6e6f 7420 6973 696e 7374 616e 6365 2871  not isinstance(q
-0000b6f0: 7565 7279 5061 7261 6d73 2c20 6469 6374  ueryParams, dict
-0000b700: 2920 656c 7365 2071 7565 7279 5061 7261  ) else queryPara
-0000b710: 6d73 2e63 6f70 7928 290a 0a20 2020 2020  ms.copy()..     
-0000b720: 2020 205f 6865 6164 6572 7320 3d20 7b7d     _headers = {}
-0000b730: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-0000b740: 7620 696e 2068 6561 6465 7273 2e69 7465  v in headers.ite
-0000b750: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0000b760: 2020 6966 206b 2069 7320 6e6f 7420 4e6f    if k is not No
-0000b770: 6e65 2061 6e64 206b 2021 3d20 2727 3a0a  ne and k != '':.
-0000b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b790: 5f68 6561 6465 7273 5b6b 5d20 3d20 760a  _headers[k] = v.
-0000b7a0: 0a20 2020 2020 2020 205f 7175 6572 7950  .        _queryP
-0000b7b0: 6172 616d 7320 3d20 7365 6c66 2e5f 7072  arams = self._pr
-0000b7c0: 6570 6172 6550 6172 616d 6574 6572 466f  epareParameterFo
-0000b7d0: 7253 6967 6e65 6455 726c 5175 6572 7928  rSignedUrlQuery(
-0000b7e0: 7175 6572 7950 6172 616d 732c 2073 7065  queryParams, spe
-0000b7f0: 6369 616c 5061 7261 6d29 0a0a 2020 2020  cialParam)..    
-0000b800: 2020 2020 6578 7069 7265 7320 3d20 3330      expires = 30
-0000b810: 3020 6966 2065 7870 6972 6573 2069 7320  0 if expires is 
-0000b820: 4e6f 6e65 2065 6c73 6520 7574 696c 2e74  None else util.t
-0000b830: 6f5f 696e 7428 6578 7069 7265 7329 0a0a  o_int(expires)..
-0000b840: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-0000b850: 6865 6164 6572 732c 205f 7175 6572 7950  headers, _queryP
-0000b860: 6172 616d 732c 2065 7870 6972 6573 2c20  arams, expires, 
-0000b870: 7365 6c66 2e63 616c 6c69 6e67 5f66 6f72  self.calling_for
-0000b880: 6d61 740a 0a20 2020 2064 6566 205f 7072  mat..    def _pr
-0000b890: 6570 6172 6550 6172 616d 6574 6572 466f  epareParameterFo
-0000b8a0: 7253 6967 6e65 6455 726c 5175 6572 7928  rSignedUrlQuery(
-0000b8b0: 7365 6c66 2c20 7175 6572 7950 6172 616d  self, queryParam
-0000b8c0: 732c 2073 7065 6369 616c 5061 7261 6d29  s, specialParam)
-0000b8d0: 3a0a 2020 2020 2020 2020 5f71 7565 7279  :.        _query
-0000b8e0: 5061 7261 6d73 203d 207b 7d0a 2020 2020  Params = {}.    
-0000b8f0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
-0000b900: 7175 6572 7950 6172 616d 732e 6974 656d  queryParams.item
-0000b910: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0000b920: 2069 6620 6b20 6973 206e 6f74 204e 6f6e   if k is not Non
-0000b930: 6520 616e 6420 6b20 213d 2027 273a 0a20  e and k != '':. 
-0000b940: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0000b950: 7175 6572 7950 6172 616d 735b 6b5d 203d  queryParams[k] =
-0000b960: 2076 0a0a 2020 2020 2020 2020 6966 2073   v..        if s
-0000b970: 7065 6369 616c 5061 7261 6d20 6973 206e  pecialParam is n
-0000b980: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000b990: 2020 2020 2073 7065 6369 616c 5061 7261       specialPara
-0000b9a0: 6d20 3d20 2773 746f 7261 6765 436c 6173  m = 'storageClas
-0000b9b0: 7327 2069 6620 7365 6c66 2e73 6967 6e61  s' if self.signa
-0000b9c0: 7475 7265 2e6c 6f77 6572 2829 203d 3d20  ture.lower() == 
-0000b9d0: 276f 6273 2720 616e 6420 7370 6563 6961  'obs' and specia
-0000b9e0: 6c50 6172 616d 203d 3d20 2773 746f 7261  lParam == 'stora
-0000b9f0: 6765 506f 6c69 6379 2720 5c0a 2020 2020  gePolicy' \.    
-0000ba00: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000ba10: 2027 7374 6f72 6167 6550 6f6c 6963 7927   'storagePolicy'
-0000ba20: 2069 6620 7365 6c66 2e73 6967 6e61 7475   if self.signatu
-0000ba30: 7265 2e6c 6f77 6572 2829 2021 3d20 276f  re.lower() != 'o
-0000ba40: 6273 2720 616e 6420 7370 6563 6961 6c50  bs' and specialP
-0000ba50: 6172 616d 203d 3d20 2773 746f 7261 6765  aram == 'storage
-0000ba60: 436c 6173 7327 205c 0a20 2020 2020 2020  Class' \.       
-0000ba70: 2020 2020 2020 2020 2065 6c73 6520 7370           else sp
-0000ba80: 6563 6961 6c50 6172 616d 0a20 2020 2020  ecialParam.     
-0000ba90: 2020 2020 2020 205f 7175 6572 7950 6172         _queryPar
-0000baa0: 616d 735b 7370 6563 6961 6c50 6172 616d  ams[specialParam
-0000bab0: 5d20 3d20 4e6f 6e65 0a0a 2020 2020 2020  ] = None..      
-0000bac0: 2020 7265 7475 726e 205f 7175 6572 7950    return _queryP
-0000bad0: 6172 616d 730a 0a20 2020 2064 6566 2063  arams..    def c
-0000bae0: 7265 6174 6553 6967 6e65 6455 726c 2873  reateSignedUrl(s
-0000baf0: 656c 662c 206d 6574 686f 642c 2062 7563  elf, method, buc
-0000bb00: 6b65 744e 616d 653d 4e6f 6e65 2c20 6f62  ketName=None, ob
-0000bb10: 6a65 6374 4b65 793d 4e6f 6e65 2c20 7370  jectKey=None, sp
-0000bb20: 6563 6961 6c50 6172 616d 3d4e 6f6e 652c  ecialParam=None,
-0000bb30: 2065 7870 6972 6573 3d33 3030 2c20 6865   expires=300, he
-0000bb40: 6164 6572 733d 4e6f 6e65 2c0a 2020 2020  aders=None,.    
+0000b4e0: 2027 6372 6564 656e 7469 616c 273a 2063   'credential': c
+0000b4f0: 6f6e 7374 2e42 4153 4553 5452 494e 472c  onst.BASESTRING,
+0000b500: 2027 6461 7465 273a 2063 6f6e 7374 2e42   'date': const.B
+0000b510: 4153 4553 5452 494e 472c 2027 7369 676e  ASESTRING, 'sign
+0000b520: 6174 7572 6527 3a20 636f 6e73 742e 4241  ature': const.BA
+0000b530: 5345 5354 5249 4e47 2c0a 2020 2020 2020  SESTRING,.      
+0000b540: 2020 2020 2020 2020 2020 2020 2027 6163               'ac
+0000b550: 6365 7373 4b65 7949 6427 3a20 636f 6e73  cessKeyId': cons
+0000b560: 742e 4241 5345 5354 5249 4e47 7d0a 0a0a  t.BASESTRING}...
+0000b570: 636c 6173 7320 4f62 7343 6c69 656e 7428  class ObsClient(
+0000b580: 5f42 6173 6963 436c 6965 6e74 293a 0a0a  _BasicClient):..
+0000b590: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0000b5a0: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
+0000b5b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+0000b5c0: 2073 7570 6572 284f 6273 436c 6965 6e74   super(ObsClient
+0000b5d0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
+0000b5e0: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+0000b5f0: 290a 0a20 2020 2064 6566 205f 7072 6570  )..    def _prep
+0000b600: 6172 6550 6172 616d 6574 6572 466f 7253  areParameterForS
+0000b610: 6967 6e65 6455 726c 2873 656c 662c 2073  ignedUrl(self, s
+0000b620: 7065 6369 616c 5061 7261 6d2c 2065 7870  pecialParam, exp
+0000b630: 6972 6573 2c20 6865 6164 6572 732c 2071  ires, headers, q
+0000b640: 7565 7279 5061 7261 6d73 293a 0a0a 2020  ueryParams):..  
+0000b650: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+0000b660: 7b7d 2069 6620 6865 6164 6572 7320 6973  {} if headers is
+0000b670: 204e 6f6e 6520 6f72 206e 6f74 2069 7369   None or not isi
+0000b680: 6e73 7461 6e63 6528 6865 6164 6572 732c  nstance(headers,
+0000b690: 2064 6963 7429 2065 6c73 6520 6865 6164   dict) else head
+0000b6a0: 6572 732e 636f 7079 2829 0a20 2020 2020  ers.copy().     
+0000b6b0: 2020 2071 7565 7279 5061 7261 6d73 203d     queryParams =
+0000b6c0: 207b 7d20 6966 2071 7565 7279 5061 7261   {} if queryPara
+0000b6d0: 6d73 2069 7320 4e6f 6e65 206f 7220 6e6f  ms is None or no
+0000b6e0: 7420 6973 696e 7374 616e 6365 2871 7565  t isinstance(que
+0000b6f0: 7279 5061 7261 6d73 2c20 6469 6374 2920  ryParams, dict) 
+0000b700: 656c 7365 2071 7565 7279 5061 7261 6d73  else queryParams
+0000b710: 2e63 6f70 7928 290a 0a20 2020 2020 2020  .copy()..       
+0000b720: 205f 6865 6164 6572 7320 3d20 7b7d 0a20   _headers = {}. 
+0000b730: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+0000b740: 696e 2068 6561 6465 7273 2e69 7465 6d73  in headers.items
+0000b750: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000b760: 6966 206b 2069 7320 6e6f 7420 4e6f 6e65  if k is not None
+0000b770: 2061 6e64 206b 2021 3d20 2727 3a0a 2020   and k != '':.  
+0000b780: 2020 2020 2020 2020 2020 2020 2020 5f68                _h
+0000b790: 6561 6465 7273 5b6b 5d20 3d20 760a 0a20  eaders[k] = v.. 
+0000b7a0: 2020 2020 2020 205f 7175 6572 7950 6172         _queryPar
+0000b7b0: 616d 7320 3d20 7365 6c66 2e5f 7072 6570  ams = self._prep
+0000b7c0: 6172 6550 6172 616d 6574 6572 466f 7253  areParameterForS
+0000b7d0: 6967 6e65 6455 726c 5175 6572 7928 7175  ignedUrlQuery(qu
+0000b7e0: 6572 7950 6172 616d 732c 2073 7065 6369  eryParams, speci
+0000b7f0: 616c 5061 7261 6d29 0a0a 2020 2020 2020  alParam)..      
+0000b800: 2020 6578 7069 7265 7320 3d20 3330 3020    expires = 300 
+0000b810: 6966 2065 7870 6972 6573 2069 7320 4e6f  if expires is No
+0000b820: 6e65 2065 6c73 6520 7574 696c 2e74 6f5f  ne else util.to_
+0000b830: 696e 7428 6578 7069 7265 7329 0a0a 2020  int(expires)..  
+0000b840: 2020 2020 2020 7265 7475 726e 205f 6865        return _he
+0000b850: 6164 6572 732c 205f 7175 6572 7950 6172  aders, _queryPar
+0000b860: 616d 732c 2065 7870 6972 6573 2c20 7365  ams, expires, se
+0000b870: 6c66 2e63 616c 6c69 6e67 5f66 6f72 6d61  lf.calling_forma
+0000b880: 740a 0a20 2020 2064 6566 205f 7072 6570  t..    def _prep
+0000b890: 6172 6550 6172 616d 6574 6572 466f 7253  areParameterForS
+0000b8a0: 6967 6e65 6455 726c 5175 6572 7928 7365  ignedUrlQuery(se
+0000b8b0: 6c66 2c20 7175 6572 7950 6172 616d 732c  lf, queryParams,
+0000b8c0: 2073 7065 6369 616c 5061 7261 6d29 3a0a   specialParam):.
+0000b8d0: 2020 2020 2020 2020 5f71 7565 7279 5061          _queryPa
+0000b8e0: 7261 6d73 203d 207b 7d0a 2020 2020 2020  rams = {}.      
+0000b8f0: 2020 666f 7220 6b2c 2076 2069 6e20 7175    for k, v in qu
+0000b900: 6572 7950 6172 616d 732e 6974 656d 7328  eryParams.items(
+0000b910: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0000b920: 6620 6b20 6973 206e 6f74 204e 6f6e 6520  f k is not None 
+0000b930: 616e 6420 6b20 213d 2027 273a 0a20 2020  and k != '':.   
+0000b940: 2020 2020 2020 2020 2020 2020 205f 7175               _qu
+0000b950: 6572 7950 6172 616d 735b 6b5d 203d 2076  eryParams[k] = v
+0000b960: 0a0a 2020 2020 2020 2020 6966 2073 7065  ..        if spe
+0000b970: 6369 616c 5061 7261 6d20 6973 206e 6f74  cialParam is not
+0000b980: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000b990: 2020 2073 7065 6369 616c 5061 7261 6d20     specialParam 
+0000b9a0: 3d20 2773 746f 7261 6765 436c 6173 7327  = 'storageClass'
+0000b9b0: 2069 6620 7365 6c66 2e73 6967 6e61 7475   if self.signatu
+0000b9c0: 7265 2e6c 6f77 6572 2829 203d 3d20 276f  re.lower() == 'o
+0000b9d0: 6273 2720 616e 6420 7370 6563 6961 6c50  bs' and specialP
+0000b9e0: 6172 616d 203d 3d20 2773 746f 7261 6765  aram == 'storage
+0000b9f0: 506f 6c69 6379 2720 5c0a 2020 2020 2020  Policy' \.      
+0000ba00: 2020 2020 2020 2020 2020 656c 7365 2027            else '
+0000ba10: 7374 6f72 6167 6550 6f6c 6963 7927 2069  storagePolicy' i
+0000ba20: 6620 7365 6c66 2e73 6967 6e61 7475 7265  f self.signature
+0000ba30: 2e6c 6f77 6572 2829 2021 3d20 276f 6273  .lower() != 'obs
+0000ba40: 2720 616e 6420 7370 6563 6961 6c50 6172  ' and specialPar
+0000ba50: 616d 203d 3d20 2773 746f 7261 6765 436c  am == 'storageCl
+0000ba60: 6173 7327 205c 0a20 2020 2020 2020 2020  ass' \.         
+0000ba70: 2020 2020 2020 2065 6c73 6520 7370 6563         else spec
+0000ba80: 6961 6c50 6172 616d 0a20 2020 2020 2020  ialParam.       
+0000ba90: 2020 2020 205f 7175 6572 7950 6172 616d       _queryParam
+0000baa0: 735b 7370 6563 6961 6c50 6172 616d 5d20  s[specialParam] 
+0000bab0: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
+0000bac0: 7265 7475 726e 205f 7175 6572 7950 6172  return _queryPar
+0000bad0: 616d 730a 0a20 2020 2064 6566 2063 7265  ams..    def cre
+0000bae0: 6174 6553 6967 6e65 6455 726c 2873 656c  ateSignedUrl(sel
+0000baf0: 662c 206d 6574 686f 642c 2062 7563 6b65  f, method, bucke
+0000bb00: 744e 616d 653d 4e6f 6e65 2c20 6f62 6a65  tName=None, obje
+0000bb10: 6374 4b65 793d 4e6f 6e65 2c20 7370 6563  ctKey=None, spec
+0000bb20: 6961 6c50 6172 616d 3d4e 6f6e 652c 2065  ialParam=None, e
+0000bb30: 7870 6972 6573 3d33 3030 2c20 6865 6164  xpires=300, head
+0000bb40: 6572 733d 4e6f 6e65 2c0a 2020 2020 2020  ers=None,.      
 0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb60: 2020 2020 7175 6572 7950 6172 616d 733d      queryParams=
-0000bb70: 4e6f 6e65 293a 0a20 2020 2020 2020 2064  None):.        d
-0000bb80: 656c 6567 6174 6520 3d20 7365 6c66 2e5f  elegate = self._
-0000bb90: 6372 6561 7465 5634 5369 676e 6564 5572  createV4SignedUr
-0000bba0: 6c20 6966 2073 656c 662e 7369 676e 6174  l if self.signat
-0000bbb0: 7572 652e 6c6f 7765 7228 2920 3d3d 2027  ure.lower() == '
-0000bbc0: 7634 2720 656c 7365 2073 656c 662e 5f63  v4' else self._c
-0000bbd0: 7265 6174 6556 3253 6967 6e65 6455 726c  reateV2SignedUrl
-0000bbe0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000bbf0: 6465 6c65 6761 7465 286d 6574 686f 642c  delegate(method,
-0000bc00: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
-0000bc10: 6563 744b 6579 2c20 7370 6563 6961 6c50  ectKey, specialP
-0000bc20: 6172 616d 2c20 6578 7069 7265 732c 2068  aram, expires, h
-0000bc30: 6561 6465 7273 2c20 7175 6572 7950 6172  eaders, queryPar
-0000bc40: 616d 7329 0a0a 2020 2020 6465 6620 6372  ams)..    def cr
-0000bc50: 6561 7465 5632 5369 676e 6564 5572 6c28  eateV2SignedUrl(
-0000bc60: 7365 6c66 2c20 6d65 7468 6f64 2c20 6275  self, method, bu
-0000bc70: 636b 6574 4e61 6d65 3d4e 6f6e 652c 206f  cketName=None, o
-0000bc80: 626a 6563 744b 6579 3d4e 6f6e 652c 2073  bjectKey=None, s
-0000bc90: 7065 6369 616c 5061 7261 6d3d 4e6f 6e65  pecialParam=None
-0000bca0: 2c20 6578 7069 7265 733d 3330 302c 2068  , expires=300, h
-0000bcb0: 6561 6465 7273 3d4e 6f6e 652c 0a20 2020  eaders=None,.   
+0000bb60: 2020 7175 6572 7950 6172 616d 733d 4e6f    queryParams=No
+0000bb70: 6e65 293a 0a20 2020 2020 2020 2064 656c  ne):.        del
+0000bb80: 6567 6174 6520 3d20 7365 6c66 2e5f 6372  egate = self._cr
+0000bb90: 6561 7465 5634 5369 676e 6564 5572 6c20  eateV4SignedUrl 
+0000bba0: 6966 2073 656c 662e 7369 676e 6174 7572  if self.signatur
+0000bbb0: 652e 6c6f 7765 7228 2920 3d3d 2027 7634  e.lower() == 'v4
+0000bbc0: 2720 656c 7365 2073 656c 662e 5f63 7265  ' else self._cre
+0000bbd0: 6174 6556 3253 6967 6e65 6455 726c 0a20  ateV2SignedUrl. 
+0000bbe0: 2020 2020 2020 2072 6574 7572 6e20 6465         return de
+0000bbf0: 6c65 6761 7465 286d 6574 686f 642c 2062  legate(method, b
+0000bc00: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+0000bc10: 744b 6579 2c20 7370 6563 6961 6c50 6172  tKey, specialPar
+0000bc20: 616d 2c20 6578 7069 7265 732c 2068 6561  am, expires, hea
+0000bc30: 6465 7273 2c20 7175 6572 7950 6172 616d  ders, queryParam
+0000bc40: 7329 0a0a 2020 2020 6465 6620 6372 6561  s)..    def crea
+0000bc50: 7465 5632 5369 676e 6564 5572 6c28 7365  teV2SignedUrl(se
+0000bc60: 6c66 2c20 6d65 7468 6f64 2c20 6275 636b  lf, method, buck
+0000bc70: 6574 4e61 6d65 3d4e 6f6e 652c 206f 626a  etName=None, obj
+0000bc80: 6563 744b 6579 3d4e 6f6e 652c 2073 7065  ectKey=None, spe
+0000bc90: 6369 616c 5061 7261 6d3d 4e6f 6e65 2c20  cialParam=None, 
+0000bca0: 6578 7069 7265 733d 3330 302c 2068 6561  expires=300, hea
+0000bcb0: 6465 7273 3d4e 6f6e 652c 0a20 2020 2020  ders=None,.     
 0000bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bcd0: 2020 2020 2020 2071 7565 7279 5061 7261         queryPara
-0000bce0: 6d73 3d4e 6f6e 6529 3a0a 2020 2020 2020  ms=None):.      
-0000bcf0: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
-0000bd00: 7265 6174 6556 3253 6967 6e65 6455 726c  reateV2SignedUrl
-0000bd10: 286d 6574 686f 642c 2062 7563 6b65 744e  (method, bucketN
-0000bd20: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-0000bd30: 7370 6563 6961 6c50 6172 616d 2c20 6578  specialParam, ex
-0000bd40: 7069 7265 732c 2068 6561 6465 7273 2c20  pires, headers, 
-0000bd50: 7175 6572 7950 6172 616d 7329 0a0a 2020  queryParams)..  
-0000bd60: 2020 6465 6620 6372 6561 7465 5634 5369    def createV4Si
-0000bd70: 676e 6564 5572 6c28 7365 6c66 2c20 6d65  gnedUrl(self, me
-0000bd80: 7468 6f64 2c20 6275 636b 6574 4e61 6d65  thod, bucketName
-0000bd90: 3d4e 6f6e 652c 206f 626a 6563 744b 6579  =None, objectKey
-0000bda0: 3d4e 6f6e 652c 2073 7065 6369 616c 5061  =None, specialPa
-0000bdb0: 7261 6d3d 4e6f 6e65 2c20 6578 7069 7265  ram=None, expire
-0000bdc0: 733d 3330 302c 2068 6561 6465 7273 3d4e  s=300, headers=N
-0000bdd0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-0000bde0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
-0000bdf0: 7565 7279 5061 7261 6d73 3d4e 6f6e 6529  ueryParams=None)
-0000be00: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000be10: 2073 656c 662e 5f63 7265 6174 6556 3453   self._createV4S
-0000be20: 6967 6e65 6455 726c 286d 6574 686f 642c  ignedUrl(method,
-0000be30: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
-0000be40: 6563 744b 6579 2c20 7370 6563 6961 6c50  ectKey, specialP
-0000be50: 6172 616d 2c20 6578 7069 7265 732c 2068  aram, expires, h
-0000be60: 6561 6465 7273 2c20 7175 6572 7950 6172  eaders, queryPar
-0000be70: 616d 7329 0a0a 2020 2020 6465 6620 5f63  ams)..    def _c
-0000be80: 7265 6174 6556 3253 6967 6e65 6455 726c  reateV2SignedUrl
-0000be90: 2873 656c 662c 206d 6574 686f 642c 2062  (self, method, b
-0000bea0: 7563 6b65 744e 616d 653d 4e6f 6e65 2c20  ucketName=None, 
-0000beb0: 6f62 6a65 6374 4b65 793d 4e6f 6e65 2c20  objectKey=None, 
-0000bec0: 7370 6563 6961 6c50 6172 616d 3d4e 6f6e  specialParam=Non
-0000bed0: 652c 2065 7870 6972 6573 3d33 3030 2c20  e, expires=300, 
-0000bee0: 6865 6164 6572 733d 4e6f 6e65 2c0a 2020  headers=None,.  
+0000bcd0: 2020 2020 2071 7565 7279 5061 7261 6d73       queryParams
+0000bce0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0000bcf0: 7265 7475 726e 2073 656c 662e 5f63 7265  return self._cre
+0000bd00: 6174 6556 3253 6967 6e65 6455 726c 286d  ateV2SignedUrl(m
+0000bd10: 6574 686f 642c 2062 7563 6b65 744e 616d  ethod, bucketNam
+0000bd20: 652c 206f 626a 6563 744b 6579 2c20 7370  e, objectKey, sp
+0000bd30: 6563 6961 6c50 6172 616d 2c20 6578 7069  ecialParam, expi
+0000bd40: 7265 732c 2068 6561 6465 7273 2c20 7175  res, headers, qu
+0000bd50: 6572 7950 6172 616d 7329 0a0a 2020 2020  eryParams)..    
+0000bd60: 6465 6620 6372 6561 7465 5634 5369 676e  def createV4Sign
+0000bd70: 6564 5572 6c28 7365 6c66 2c20 6d65 7468  edUrl(self, meth
+0000bd80: 6f64 2c20 6275 636b 6574 4e61 6d65 3d4e  od, bucketName=N
+0000bd90: 6f6e 652c 206f 626a 6563 744b 6579 3d4e  one, objectKey=N
+0000bda0: 6f6e 652c 2073 7065 6369 616c 5061 7261  one, specialPara
+0000bdb0: 6d3d 4e6f 6e65 2c20 6578 7069 7265 733d  m=None, expires=
+0000bdc0: 3330 302c 2068 6561 6465 7273 3d4e 6f6e  300, headers=Non
+0000bdd0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000bde0: 2020 2020 2020 2020 2020 2020 2071 7565               que
+0000bdf0: 7279 5061 7261 6d73 3d4e 6f6e 6529 3a0a  ryParams=None):.
+0000be00: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000be10: 656c 662e 5f63 7265 6174 6556 3453 6967  elf._createV4Sig
+0000be20: 6e65 6455 726c 286d 6574 686f 642c 2062  nedUrl(method, b
+0000be30: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+0000be40: 744b 6579 2c20 7370 6563 6961 6c50 6172  tKey, specialPar
+0000be50: 616d 2c20 6578 7069 7265 732c 2068 6561  am, expires, hea
+0000be60: 6465 7273 2c20 7175 6572 7950 6172 616d  ders, queryParam
+0000be70: 7329 0a0a 2020 2020 6465 6620 5f63 7265  s)..    def _cre
+0000be80: 6174 6556 3253 6967 6e65 6455 726c 2873  ateV2SignedUrl(s
+0000be90: 656c 662c 206d 6574 686f 642c 2062 7563  elf, method, buc
+0000bea0: 6b65 744e 616d 653d 4e6f 6e65 2c20 6f62  ketName=None, ob
+0000beb0: 6a65 6374 4b65 793d 4e6f 6e65 2c20 7370  jectKey=None, sp
+0000bec0: 6563 6961 6c50 6172 616d 3d4e 6f6e 652c  ecialParam=None,
+0000bed0: 2065 7870 6972 6573 3d33 3030 2c20 6865   expires=300, he
+0000bee0: 6164 6572 733d 4e6f 6e65 2c0a 2020 2020  aders=None,.    
 0000bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf00: 2020 2020 2020 2020 2071 7565 7279 5061           queryPa
-0000bf10: 7261 6d73 3d4e 6f6e 6529 3a0a 0a20 2020  rams=None):..   
-0000bf20: 2020 2020 2068 6561 6465 7273 2c20 7175       headers, qu
-0000bf30: 6572 7950 6172 616d 732c 2065 7870 6972  eryParams, expir
-0000bf40: 6573 2c20 6361 6c6c 696e 675f 666f 726d  es, calling_form
-0000bf50: 6174 203d 2073 656c 662e 5f70 7265 7061  at = self._prepa
-0000bf60: 7265 5061 7261 6d65 7465 7246 6f72 5369  reParameterForSi
-0000bf70: 676e 6564 5572 6c28 7370 6563 6961 6c50  gnedUrl(specialP
-0000bf80: 6172 616d 2c20 6578 7069 7265 732c 0a20  aram, expires,. 
+0000bf00: 2020 2020 2020 2071 7565 7279 5061 7261         queryPara
+0000bf10: 6d73 3d4e 6f6e 6529 3a0a 0a20 2020 2020  ms=None):..     
+0000bf20: 2020 2068 6561 6465 7273 2c20 7175 6572     headers, quer
+0000bf30: 7950 6172 616d 732c 2065 7870 6972 6573  yParams, expires
+0000bf40: 2c20 6361 6c6c 696e 675f 666f 726d 6174  , calling_format
+0000bf50: 203d 2073 656c 662e 5f70 7265 7061 7265   = self._prepare
+0000bf60: 5061 7261 6d65 7465 7246 6f72 5369 676e  ParameterForSign
+0000bf70: 6564 5572 6c28 7370 6563 6961 6c50 6172  edUrl(specialPar
+0000bf80: 616d 2c20 6578 7069 7265 732c 0a20 2020  am, expires,.   
 0000bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfe0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-0000bff0: 732c 2071 7565 7279 5061 7261 6d73 290a  s, queryParams).
-0000c000: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-0000c010: 5f73 6572 7665 7220 3d20 7365 6c66 2e73  _server = self.s
-0000c020: 6572 7665 7220 6966 2073 656c 662e 6973  erver if self.is
-0000c030: 5f63 6e61 6d65 2065 6c73 6520 6361 6c6c  _cname else call
-0000c040: 696e 675f 666f 726d 6174 2e67 6574 5f73  ing_format.get_s
-0000c050: 6572 7665 7228 7365 6c66 2e73 6572 7665  erver(self.serve
-0000c060: 722c 2062 7563 6b65 744e 616d 6529 0a0a  r, bucketName)..
-0000c070: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
-0000c080: 636f 6e73 742e 484f 5354 5f48 4541 4445  const.HOST_HEADE
-0000c090: 525d 203d 2027 2573 3a25 7327 2025 2028  R] = '%s:%s' % (
-0000c0a0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0000c0b0: 6e65 6374 5f73 6572 7665 722c 2073 656c  nect_server, sel
-0000c0c0: 662e 706f 7274 2920 6966 2073 656c 662e  f.port) if self.
-0000c0d0: 706f 7274 2021 3d20 3434 3320 616e 6420  port != 443 and 
-0000c0e0: 7365 6c66 2e70 6f72 7420 213d 2038 3020  self.port != 80 
-0000c0f0: 656c 7365 2063 6f6e 6e65 6374 5f73 6572  else connect_ser
-0000c100: 7665 720a 0a20 2020 2020 2020 2065 7870  ver..        exp
-0000c110: 6972 6573 202b 3d20 7574 696c 2e74 6f5f  ires += util.to_
-0000c120: 696e 7428 7469 6d65 2e74 696d 6528 2929  int(time.time())
-0000c130: 0a0a 2020 2020 2020 2020 7365 6375 7269  ..        securi
-0000c140: 7479 5072 6f76 6964 6572 203d 2073 656c  tyProvider = sel
-0000c150: 662e 5f67 6574 5f74 6f6b 656e 2829 0a20  f._get_token(). 
-0000c160: 2020 2020 2020 2069 6620 7365 6375 7269         if securi
-0000c170: 7479 5072 6f76 6964 6572 2e73 6563 7572  tyProvider.secur
-0000c180: 6974 795f 746f 6b65 6e20 6973 206e 6f74  ity_token is not
-0000c190: 204e 6f6e 6520 616e 6420 7365 6c66 2e68   None and self.h
-0000c1a0: 612e 7365 6375 7269 7479 5f74 6f6b 656e  a.security_token
-0000c1b0: 5f68 6561 6465 7228 2920 6e6f 7420 696e  _header() not in
-0000c1c0: 2071 7565 7279 5061 7261 6d73 3a0a 2020   queryParams:.  
-0000c1d0: 2020 2020 2020 2020 2020 7175 6572 7950            queryP
-0000c1e0: 6172 616d 735b 7365 6c66 2e68 612e 7365  arams[self.ha.se
-0000c1f0: 6375 7269 7479 5f74 6f6b 656e 5f68 6561  curity_token_hea
-0000c200: 6465 7228 295d 203d 2073 6563 7572 6974  der()] = securit
-0000c210: 7950 726f 7669 6465 722e 7365 6375 7269  yProvider.securi
-0000c220: 7479 5f74 6f6b 656e 0a0a 2020 2020 2020  ty_token..      
-0000c230: 2020 7632 4175 7468 203d 2061 7574 682e    v2Auth = auth.
-0000c240: 4175 7468 656e 7469 6361 7469 6f6e 2873  Authentication(s
-0000c250: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
-0000c260: 6163 6365 7373 5f6b 6579 5f69 642c 2073  access_key_id, s
-0000c270: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
-0000c280: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
-0000c290: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+0000bfe0: 2020 2020 2020 2020 6865 6164 6572 732c          headers,
+0000bff0: 2071 7565 7279 5061 7261 6d73 290a 0a20   queryParams).. 
+0000c000: 2020 2020 2020 2063 6f6e 6e65 6374 5f73         connect_s
+0000c010: 6572 7665 7220 3d20 7365 6c66 2e73 6572  erver = self.ser
+0000c020: 7665 7220 6966 2073 656c 662e 6973 5f63  ver if self.is_c
+0000c030: 6e61 6d65 2065 6c73 6520 6361 6c6c 696e  name else callin
+0000c040: 675f 666f 726d 6174 2e67 6574 5f73 6572  g_format.get_ser
+0000c050: 7665 7228 7365 6c66 2e73 6572 7665 722c  ver(self.server,
+0000c060: 2062 7563 6b65 744e 616d 6529 0a0a 2020   bucketName)..  
+0000c070: 2020 2020 2020 6865 6164 6572 735b 636f        headers[co
+0000c080: 6e73 742e 484f 5354 5f48 4541 4445 525d  nst.HOST_HEADER]
+0000c090: 203d 2027 2573 3a25 7327 2025 2028 0a20   = '%s:%s' % (. 
+0000c0a0: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
+0000c0b0: 6374 5f73 6572 7665 722c 2073 656c 662e  ct_server, self.
+0000c0c0: 706f 7274 2920 6966 2073 656c 662e 706f  port) if self.po
+0000c0d0: 7274 2021 3d20 3434 3320 616e 6420 7365  rt != 443 and se
+0000c0e0: 6c66 2e70 6f72 7420 213d 2038 3020 656c  lf.port != 80 el
+0000c0f0: 7365 2063 6f6e 6e65 6374 5f73 6572 7665  se connect_serve
+0000c100: 720a 0a20 2020 2020 2020 2065 7870 6972  r..        expir
+0000c110: 6573 202b 3d20 7574 696c 2e74 6f5f 696e  es += util.to_in
+0000c120: 7428 7469 6d65 2e74 696d 6528 2929 0a0a  t(time.time())..
+0000c130: 2020 2020 2020 2020 7365 6375 7269 7479          security
+0000c140: 5072 6f76 6964 6572 203d 2073 656c 662e  Provider = self.
+0000c150: 5f67 6574 5f74 6f6b 656e 2829 0a20 2020  _get_token().   
+0000c160: 2020 2020 2069 6620 7365 6375 7269 7479       if security
+0000c170: 5072 6f76 6964 6572 2e73 6563 7572 6974  Provider.securit
+0000c180: 795f 746f 6b65 6e20 6973 206e 6f74 204e  y_token is not N
+0000c190: 6f6e 6520 616e 6420 7365 6c66 2e68 612e  one and self.ha.
+0000c1a0: 7365 6375 7269 7479 5f74 6f6b 656e 5f68  security_token_h
+0000c1b0: 6561 6465 7228 2920 6e6f 7420 696e 2071  eader() not in q
+0000c1c0: 7565 7279 5061 7261 6d73 3a0a 2020 2020  ueryParams:.    
+0000c1d0: 2020 2020 2020 2020 7175 6572 7950 6172          queryPar
+0000c1e0: 616d 735b 7365 6c66 2e68 612e 7365 6375  ams[self.ha.secu
+0000c1f0: 7269 7479 5f74 6f6b 656e 5f68 6561 6465  rity_token_heade
+0000c200: 7228 295d 203d 2073 6563 7572 6974 7950  r()] = securityP
+0000c210: 726f 7669 6465 722e 7365 6375 7269 7479  rovider.security
+0000c220: 5f74 6f6b 656e 0a0a 2020 2020 2020 2020  _token..        
+0000c230: 7632 4175 7468 203d 2061 7574 682e 4175  v2Auth = auth.Au
+0000c240: 7468 656e 7469 6361 7469 6f6e 2873 6563  thentication(sec
+0000c250: 7572 6974 7950 726f 7669 6465 722e 6163  urityProvider.ac
+0000c260: 6365 7373 5f6b 6579 5f69 642c 2073 6563  cess_key_id, sec
+0000c270: 7572 6974 7950 726f 7669 6465 722e 7365  urityProvider.se
+0000c280: 6372 6574 5f61 6363 6573 735f 6b65 792c  cret_access_key,
+0000c290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2b0: 2020 2020 2020 2020 7365 6c66 2e70 6174          self.pat
-0000c2c0: 685f 7374 796c 652c 2073 656c 662e 6861  h_style, self.ha
-0000c2d0: 2c20 7365 6c66 2e73 6572 7665 722c 2073  , self.server, s
-0000c2e0: 656c 662e 6973 5f63 6e61 6d65 290a 0a20  elf.is_cname).. 
-0000c2f0: 2020 2020 2020 2073 6967 6e61 7475 7265         signature
-0000c300: 203d 2076 3241 7574 682e 6765 7453 6967   = v2Auth.getSig
-0000c310: 6e61 7475 7265 286d 6574 686f 642c 2062  nature(method, b
-0000c320: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-0000c330: 744b 6579 2c20 7175 6572 7950 6172 616d  tKey, queryParam
-0000c340: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000c2b0: 2020 2020 2020 7365 6c66 2e70 6174 685f        self.path_
+0000c2c0: 7374 796c 652c 2073 656c 662e 6861 2c20  style, self.ha, 
+0000c2d0: 7365 6c66 2e73 6572 7665 722c 2073 656c  self.server, sel
+0000c2e0: 662e 6973 5f63 6e61 6d65 290a 0a20 2020  f.is_cname)..   
+0000c2f0: 2020 2020 2073 6967 6e61 7475 7265 203d       signature =
+0000c300: 2076 3241 7574 682e 6765 7453 6967 6e61   v2Auth.getSigna
+0000c310: 7475 7265 286d 6574 686f 642c 2062 7563  ture(method, buc
+0000c320: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+0000c330: 6579 2c20 7175 6572 7950 6172 616d 732c  ey, queryParams,
+0000c340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c360: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-0000c370: 7273 2c20 7574 696c 2e74 6f5f 7374 7269  rs, util.to_stri
-0000c380: 6e67 2865 7870 6972 6573 2929 5b27 5369  ng(expires))['Si
-0000c390: 676e 6174 7572 6527 5d0a 0a20 2020 2020  gnature']..     
-0000c3a0: 2020 2071 7565 7279 5061 7261 6d73 5b27     queryParams['
-0000c3b0: 4578 7069 7265 7327 5d20 3d20 6578 7069  Expires'] = expi
-0000c3c0: 7265 730a 2020 2020 2020 2020 7175 6572  res.        quer
-0000c3d0: 7950 6172 616d 735b 2741 6363 6573 734b  yParams['AccessK
-0000c3e0: 6579 4964 2720 6966 2073 656c 662e 7369  eyId' if self.si
-0000c3f0: 676e 6174 7572 6520 3d3d 2027 6f62 7327  gnature == 'obs'
-0000c400: 2065 6c73 6520 2741 5753 4163 6365 7373   else 'AWSAccess
-0000c410: 4b65 7949 6427 5d20 3d20 7365 6375 7269  KeyId'] = securi
-0000c420: 7479 5072 6f76 6964 6572 2e61 6363 6573  tyProvider.acces
-0000c430: 735f 6b65 795f 6964 0a20 2020 2020 2020  s_key_id.       
-0000c440: 2071 7565 7279 5061 7261 6d73 5b27 5369   queryParams['Si
-0000c450: 676e 6174 7572 6527 5d20 3d20 7369 676e  gnature'] = sign
-0000c460: 6174 7572 650a 0a20 2020 2020 2020 2069  ature..        i
-0000c470: 6620 7365 6c66 2e69 735f 636e 616d 653a  f self.is_cname:
-0000c480: 0a20 2020 2020 2020 2020 2020 2062 7563  .            buc
-0000c490: 6b65 744e 616d 6520 3d20 4e6f 6e65 0a0a  ketName = None..
-0000c4a0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000c4b0: 207b 2773 6967 6e65 6455 726c 273a 2063   {'signedUrl': c
-0000c4c0: 616c 6c69 6e67 5f66 6f72 6d61 742e 6765  alling_format.ge
-0000c4d0: 745f 6675 6c6c 5f75 726c 2873 656c 662e  t_full_url(self.
-0000c4e0: 6973 5f73 6563 7572 652c 2073 656c 662e  is_secure, self.
-0000c4f0: 7365 7276 6572 2c0a 2020 2020 2020 2020  server,.        
+0000c360: 2020 2020 2020 2020 2068 6561 6465 7273           headers
+0000c370: 2c20 7574 696c 2e74 6f5f 7374 7269 6e67  , util.to_string
+0000c380: 2865 7870 6972 6573 2929 5b27 5369 676e  (expires))['Sign
+0000c390: 6174 7572 6527 5d0a 0a20 2020 2020 2020  ature']..       
+0000c3a0: 2071 7565 7279 5061 7261 6d73 5b27 4578   queryParams['Ex
+0000c3b0: 7069 7265 7327 5d20 3d20 6578 7069 7265  pires'] = expire
+0000c3c0: 730a 2020 2020 2020 2020 7175 6572 7950  s.        queryP
+0000c3d0: 6172 616d 735b 2741 6363 6573 734b 6579  arams['AccessKey
+0000c3e0: 4964 2720 6966 2073 656c 662e 7369 676e  Id' if self.sign
+0000c3f0: 6174 7572 6520 3d3d 2027 6f62 7327 2065  ature == 'obs' e
+0000c400: 6c73 6520 2741 5753 4163 6365 7373 4b65  lse 'AWSAccessKe
+0000c410: 7949 6427 5d20 3d20 7365 6375 7269 7479  yId'] = security
+0000c420: 5072 6f76 6964 6572 2e61 6363 6573 735f  Provider.access_
+0000c430: 6b65 795f 6964 0a20 2020 2020 2020 2071  key_id.        q
+0000c440: 7565 7279 5061 7261 6d73 5b27 5369 676e  ueryParams['Sign
+0000c450: 6174 7572 6527 5d20 3d20 7369 676e 6174  ature'] = signat
+0000c460: 7572 650a 0a20 2020 2020 2020 2069 6620  ure..        if 
+0000c470: 7365 6c66 2e69 735f 636e 616d 653a 0a20  self.is_cname:. 
+0000c480: 2020 2020 2020 2020 2020 2062 7563 6b65             bucke
+0000c490: 744e 616d 6520 3d20 4e6f 6e65 0a0a 2020  tName = None..  
+0000c4a0: 2020 2020 2020 7265 7375 6c74 203d 207b        result = {
+0000c4b0: 2773 6967 6e65 6455 726c 273a 2063 616c  'signedUrl': cal
+0000c4c0: 6c69 6e67 5f66 6f72 6d61 742e 6765 745f  ling_format.get_
+0000c4d0: 6675 6c6c 5f75 726c 2873 656c 662e 6973  full_url(self.is
+0000c4e0: 5f73 6563 7572 652c 2073 656c 662e 7365  _secure, self.se
+0000c4f0: 7276 6572 2c0a 2020 2020 2020 2020 2020  rver,.          
 0000c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c530: 2020 2073 656c 662e 706f 7274 2c20 6275     self.port, bu
-0000c540: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-0000c550: 4b65 792c 0a20 2020 2020 2020 2020 2020  Key,.           
+0000c530: 2073 656c 662e 706f 7274 2c20 6275 636b   self.port, buck
+0000c540: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
+0000c550: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
 0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c590: 7175 6572 7950 6172 616d 7329 2c0a 2020  queryParams),.  
-0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5b0: 2761 6374 7561 6c53 6967 6e65 6452 6571  'actualSignedReq
-0000c5c0: 7565 7374 4865 6164 6572 7327 3a20 6865  uestHeaders': he
-0000c5d0: 6164 6572 737d 0a0a 2020 2020 2020 2020  aders}..        
-0000c5e0: 7265 7475 726e 205f 4372 6561 7465 5369  return _CreateSi
-0000c5f0: 676e 6564 5572 6c52 6573 706f 6e73 6528  gnedUrlResponse(
-0000c600: 2a2a 7265 7375 6c74 290a 0a20 2020 2064  **result)..    d
-0000c610: 6566 205f 6372 6561 7465 5634 5369 676e  ef _createV4Sign
-0000c620: 6564 5572 6c28 7365 6c66 2c20 6d65 7468  edUrl(self, meth
-0000c630: 6f64 2c20 6275 636b 6574 4e61 6d65 3d4e  od, bucketName=N
-0000c640: 6f6e 652c 206f 626a 6563 744b 6579 3d4e  one, objectKey=N
-0000c650: 6f6e 652c 2073 7065 6369 616c 5061 7261  one, specialPara
-0000c660: 6d3d 4e6f 6e65 2c20 6578 7069 7265 733d  m=None, expires=
-0000c670: 3330 302c 2068 6561 6465 7273 3d4e 6f6e  300, headers=Non
-0000c680: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000c690: 2020 2020 2020 2020 2020 2020 2020 7175                qu
-0000c6a0: 6572 7950 6172 616d 733d 4e6f 6e65 293a  eryParams=None):
-0000c6b0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-0000c6c0: 7465 7469 6d65 2069 6d70 6f72 7420 6461  tetime import da
-0000c6d0: 7465 7469 6d65 0a0a 2020 2020 2020 2020  tetime..        
-0000c6e0: 6865 6164 6572 732c 2071 7565 7279 5061  headers, queryPa
-0000c6f0: 7261 6d73 2c20 6578 7069 7265 732c 2063  rams, expires, c
-0000c700: 616c 6c69 6e67 5f66 6f72 6d61 7420 3d20  alling_format = 
-0000c710: 7365 6c66 2e5f 7072 6570 6172 6550 6172  self._preparePar
-0000c720: 616d 6574 6572 466f 7253 6967 6e65 6455  ameterForSignedU
-0000c730: 726c 2873 7065 6369 616c 5061 7261 6d2c  rl(specialParam,
-0000c740: 2065 7870 6972 6573 2c0a 2020 2020 2020   expires,.      
+0000c580: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+0000c590: 6572 7950 6172 616d 7329 2c0a 2020 2020  eryParams),.    
+0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2761                'a
+0000c5b0: 6374 7561 6c53 6967 6e65 6452 6571 7565  ctualSignedReque
+0000c5c0: 7374 4865 6164 6572 7327 3a20 6865 6164  stHeaders': head
+0000c5d0: 6572 737d 0a0a 2020 2020 2020 2020 7265  ers}..        re
+0000c5e0: 7475 726e 205f 4372 6561 7465 5369 676e  turn _CreateSign
+0000c5f0: 6564 5572 6c52 6573 706f 6e73 6528 2a2a  edUrlResponse(**
+0000c600: 7265 7375 6c74 290a 0a20 2020 2064 6566  result)..    def
+0000c610: 205f 6372 6561 7465 5634 5369 676e 6564   _createV4Signed
+0000c620: 5572 6c28 7365 6c66 2c20 6d65 7468 6f64  Url(self, method
+0000c630: 2c20 6275 636b 6574 4e61 6d65 3d4e 6f6e  , bucketName=Non
+0000c640: 652c 206f 626a 6563 744b 6579 3d4e 6f6e  e, objectKey=Non
+0000c650: 652c 2073 7065 6369 616c 5061 7261 6d3d  e, specialParam=
+0000c660: 4e6f 6e65 2c20 6578 7069 7265 733d 3330  None, expires=30
+0000c670: 302c 2068 6561 6465 7273 3d4e 6f6e 652c  0, headers=None,
+0000c680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c690: 2020 2020 2020 2020 2020 2020 7175 6572              quer
+0000c6a0: 7950 6172 616d 733d 4e6f 6e65 293a 0a20  yParams=None):. 
+0000c6b0: 2020 2020 2020 2066 726f 6d20 6461 7465         from date
+0000c6c0: 7469 6d65 2069 6d70 6f72 7420 6461 7465  time import date
+0000c6d0: 7469 6d65 0a0a 2020 2020 2020 2020 6865  time..        he
+0000c6e0: 6164 6572 732c 2071 7565 7279 5061 7261  aders, queryPara
+0000c6f0: 6d73 2c20 6578 7069 7265 732c 2063 616c  ms, expires, cal
+0000c700: 6c69 6e67 5f66 6f72 6d61 7420 3d20 7365  ling_format = se
+0000c710: 6c66 2e5f 7072 6570 6172 6550 6172 616d  lf._prepareParam
+0000c720: 6574 6572 466f 7253 6967 6e65 6455 726c  eterForSignedUrl
+0000c730: 2873 7065 6369 616c 5061 7261 6d2c 2065  (specialParam, e
+0000c740: 7870 6972 6573 2c0a 2020 2020 2020 2020  xpires,.        
 0000c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7a0: 2020 2020 2068 6561 6465 7273 2c20 7175       headers, qu
-0000c7b0: 6572 7950 6172 616d 7329 0a0a 2020 2020  eryParams)..    
-0000c7c0: 2020 2020 6966 2073 656c 662e 6973 5f63      if self.is_c
-0000c7d0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-0000c7e0: 2020 636f 6e6e 6563 745f 7365 7276 6572    connect_server
-0000c7f0: 203d 2073 656c 662e 7365 7276 6572 0a20   = self.server. 
-0000c800: 2020 2020 2020 2020 2020 2062 7563 6b65             bucke
-0000c810: 744e 616d 6520 3d20 4e6f 6e65 0a20 2020  tName = None.   
-0000c820: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c830: 2020 2020 2020 2063 6f6e 6e65 6374 5f73         connect_s
-0000c840: 6572 7665 7220 3d20 6361 6c6c 696e 675f  erver = calling_
-0000c850: 666f 726d 6174 2e67 6574 5f73 6572 7665  format.get_serve
-0000c860: 7228 7365 6c66 2e73 6572 7665 722c 2062  r(self.server, b
-0000c870: 7563 6b65 744e 616d 6529 0a0a 2020 2020  ucketName)..    
-0000c880: 2020 2020 6865 6164 6572 735b 636f 6e73      headers[cons
-0000c890: 742e 484f 5354 5f48 4541 4445 525d 203d  t.HOST_HEADER] =
-0000c8a0: 2027 2573 3a25 7327 2025 2028 0a20 2020   '%s:%s' % (.   
-0000c8b0: 2020 2020 2020 2020 2063 6f6e 6e65 6374           connect
-0000c8c0: 5f73 6572 7665 722c 2073 656c 662e 706f  _server, self.po
-0000c8d0: 7274 2920 6966 2073 656c 662e 706f 7274  rt) if self.port
-0000c8e0: 2021 3d20 3434 3320 616e 6420 7365 6c66   != 443 and self
-0000c8f0: 2e70 6f72 7420 213d 2038 3020 656c 7365  .port != 80 else
-0000c900: 2063 6f6e 6e65 6374 5f73 6572 7665 720a   connect_server.
-0000c910: 0a20 2020 2020 2020 2064 6174 6520 3d20  .        date = 
-0000c920: 6865 6164 6572 735b 636f 6e73 742e 4441  headers[const.DA
-0000c930: 5445 5f48 4541 4445 525d 2069 6620 636f  TE_HEADER] if co
-0000c940: 6e73 742e 4441 5445 5f48 4541 4445 5220  nst.DATE_HEADER 
-0000c950: 696e 2068 6561 6465 7273 2065 6c73 6520  in headers else 
-0000c960: 6865 6164 6572 732e 6765 7428 636f 6e73  headers.get(cons
-0000c970: 742e 4441 5445 5f48 4541 4445 522e 6c6f  t.DATE_HEADER.lo
-0000c980: 7765 7228 2929 0a20 2020 2020 2020 2064  wer()).        d
-0000c990: 6174 6520 3d20 6461 7465 7469 6d65 2e73  ate = datetime.s
-0000c9a0: 7472 7074 696d 6528 6461 7465 2c20 636f  trptime(date, co
-0000c9b0: 6e73 742e 474d 545f 4441 5445 5f46 4f52  nst.GMT_DATE_FOR
-0000c9c0: 4d41 5429 2069 6620 6461 7465 2065 6c73  MAT) if date els
-0000c9d0: 6520 6461 7465 7469 6d65 2e75 7463 6e6f  e datetime.utcno
-0000c9e0: 7728 290a 2020 2020 2020 2020 7368 6f72  w().        shor
-0000c9f0: 7444 6174 6520 3d20 6461 7465 2e73 7472  tDate = date.str
-0000ca00: 6674 696d 6528 636f 6e73 742e 5348 4f52  ftime(const.SHOR
-0000ca10: 545f 4441 5445 5f46 4f52 4d41 5429 0a20  T_DATE_FORMAT). 
-0000ca20: 2020 2020 2020 206c 6f6e 6744 6174 6520         longDate 
-0000ca30: 3d20 6461 7465 2e73 7472 6674 696d 6528  = date.strftime(
-0000ca40: 636f 6e73 742e 4c4f 4e47 5f44 4154 455f  const.LONG_DATE_
-0000ca50: 464f 524d 4154 290a 0a20 2020 2020 2020  FORMAT)..       
-0000ca60: 2073 6563 7572 6974 7950 726f 7669 6465   securityProvide
-0000ca70: 7220 3d20 7365 6c66 2e5f 6765 745f 746f  r = self._get_to
-0000ca80: 6b65 6e28 290a 0a20 2020 2020 2020 2069  ken()..        i
-0000ca90: 6620 7365 6375 7269 7479 5072 6f76 6964  f securityProvid
-0000caa0: 6572 2e73 6563 7572 6974 795f 746f 6b65  er.security_toke
-0000cab0: 6e20 6973 206e 6f74 204e 6f6e 6520 616e  n is not None an
-0000cac0: 6420 7365 6c66 2e68 612e 7365 6375 7269  d self.ha.securi
-0000cad0: 7479 5f74 6f6b 656e 5f68 6561 6465 7228  ty_token_header(
-0000cae0: 2920 6e6f 7420 696e 2071 7565 7279 5061  ) not in queryPa
-0000caf0: 7261 6d73 3a0a 2020 2020 2020 2020 2020  rams:.          
-0000cb00: 2020 7175 6572 7950 6172 616d 735b 7365    queryParams[se
-0000cb10: 6c66 2e68 612e 7365 6375 7269 7479 5f74  lf.ha.security_t
-0000cb20: 6f6b 656e 5f68 6561 6465 7228 295d 203d  oken_header()] =
-0000cb30: 2073 6563 7572 6974 7950 726f 7669 6465   securityProvide
-0000cb40: 722e 7365 6375 7269 7479 5f74 6f6b 656e  r.security_token
-0000cb50: 0a0a 2020 2020 2020 2020 7634 4175 7468  ..        v4Auth
-0000cb60: 203d 2061 7574 682e 5634 4175 7468 656e   = auth.V4Authen
-0000cb70: 7469 6361 7469 6f6e 2873 6563 7572 6974  tication(securit
-0000cb80: 7950 726f 7669 6465 722e 6163 6365 7373  yProvider.access
-0000cb90: 5f6b 6579 5f69 642c 2073 6563 7572 6974  _key_id, securit
-0000cba0: 7950 726f 7669 6465 722e 7365 6372 6574  yProvider.secret
-0000cbb0: 5f61 6363 6573 735f 6b65 792c 2073 656c  _access_key, sel
-0000cbc0: 662e 7265 6769 6f6e 2c0a 2020 2020 2020  f.region,.      
+0000c7a0: 2020 2068 6561 6465 7273 2c20 7175 6572     headers, quer
+0000c7b0: 7950 6172 616d 7329 0a0a 2020 2020 2020  yParams)..      
+0000c7c0: 2020 6966 2073 656c 662e 6973 5f63 6e61    if self.is_cna
+0000c7d0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0000c7e0: 636f 6e6e 6563 745f 7365 7276 6572 203d  connect_server =
+0000c7f0: 2073 656c 662e 7365 7276 6572 0a20 2020   self.server.   
+0000c800: 2020 2020 2020 2020 2062 7563 6b65 744e           bucketN
+0000c810: 616d 6520 3d20 4e6f 6e65 0a20 2020 2020  ame = None.     
+0000c820: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000c830: 2020 2020 2063 6f6e 6e65 6374 5f73 6572       connect_ser
+0000c840: 7665 7220 3d20 6361 6c6c 696e 675f 666f  ver = calling_fo
+0000c850: 726d 6174 2e67 6574 5f73 6572 7665 7228  rmat.get_server(
+0000c860: 7365 6c66 2e73 6572 7665 722c 2062 7563  self.server, buc
+0000c870: 6b65 744e 616d 6529 0a0a 2020 2020 2020  ketName)..      
+0000c880: 2020 6865 6164 6572 735b 636f 6e73 742e    headers[const.
+0000c890: 484f 5354 5f48 4541 4445 525d 203d 2027  HOST_HEADER] = '
+0000c8a0: 2573 3a25 7327 2025 2028 0a20 2020 2020  %s:%s' % (.     
+0000c8b0: 2020 2020 2020 2063 6f6e 6e65 6374 5f73         connect_s
+0000c8c0: 6572 7665 722c 2073 656c 662e 706f 7274  erver, self.port
+0000c8d0: 2920 6966 2073 656c 662e 706f 7274 2021  ) if self.port !
+0000c8e0: 3d20 3434 3320 616e 6420 7365 6c66 2e70  = 443 and self.p
+0000c8f0: 6f72 7420 213d 2038 3020 656c 7365 2063  ort != 80 else c
+0000c900: 6f6e 6e65 6374 5f73 6572 7665 720a 0a20  onnect_server.. 
+0000c910: 2020 2020 2020 2064 6174 6520 3d20 6865         date = he
+0000c920: 6164 6572 735b 636f 6e73 742e 4441 5445  aders[const.DATE
+0000c930: 5f48 4541 4445 525d 2069 6620 636f 6e73  _HEADER] if cons
+0000c940: 742e 4441 5445 5f48 4541 4445 5220 696e  t.DATE_HEADER in
+0000c950: 2068 6561 6465 7273 2065 6c73 6520 6865   headers else he
+0000c960: 6164 6572 732e 6765 7428 636f 6e73 742e  aders.get(const.
+0000c970: 4441 5445 5f48 4541 4445 522e 6c6f 7765  DATE_HEADER.lowe
+0000c980: 7228 2929 0a20 2020 2020 2020 2064 6174  r()).        dat
+0000c990: 6520 3d20 6461 7465 7469 6d65 2e73 7472  e = datetime.str
+0000c9a0: 7074 696d 6528 6461 7465 2c20 636f 6e73  ptime(date, cons
+0000c9b0: 742e 474d 545f 4441 5445 5f46 4f52 4d41  t.GMT_DATE_FORMA
+0000c9c0: 5429 2069 6620 6461 7465 2065 6c73 6520  T) if date else 
+0000c9d0: 6461 7465 7469 6d65 2e75 7463 6e6f 7728  datetime.utcnow(
+0000c9e0: 290a 2020 2020 2020 2020 7368 6f72 7444  ).        shortD
+0000c9f0: 6174 6520 3d20 6461 7465 2e73 7472 6674  ate = date.strft
+0000ca00: 696d 6528 636f 6e73 742e 5348 4f52 545f  ime(const.SHORT_
+0000ca10: 4441 5445 5f46 4f52 4d41 5429 0a20 2020  DATE_FORMAT).   
+0000ca20: 2020 2020 206c 6f6e 6744 6174 6520 3d20       longDate = 
+0000ca30: 6461 7465 2e73 7472 6674 696d 6528 636f  date.strftime(co
+0000ca40: 6e73 742e 4c4f 4e47 5f44 4154 455f 464f  nst.LONG_DATE_FO
+0000ca50: 524d 4154 290a 0a20 2020 2020 2020 2073  RMAT)..        s
+0000ca60: 6563 7572 6974 7950 726f 7669 6465 7220  ecurityProvider 
+0000ca70: 3d20 7365 6c66 2e5f 6765 745f 746f 6b65  = self._get_toke
+0000ca80: 6e28 290a 0a20 2020 2020 2020 2069 6620  n()..        if 
+0000ca90: 7365 6375 7269 7479 5072 6f76 6964 6572  securityProvider
+0000caa0: 2e73 6563 7572 6974 795f 746f 6b65 6e20  .security_token 
+0000cab0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+0000cac0: 7365 6c66 2e68 612e 7365 6375 7269 7479  self.ha.security
+0000cad0: 5f74 6f6b 656e 5f68 6561 6465 7228 2920  _token_header() 
+0000cae0: 6e6f 7420 696e 2071 7565 7279 5061 7261  not in queryPara
+0000caf0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0000cb00: 7175 6572 7950 6172 616d 735b 7365 6c66  queryParams[self
+0000cb10: 2e68 612e 7365 6375 7269 7479 5f74 6f6b  .ha.security_tok
+0000cb20: 656e 5f68 6561 6465 7228 295d 203d 2073  en_header()] = s
+0000cb30: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
+0000cb40: 7365 6375 7269 7479 5f74 6f6b 656e 0a0a  security_token..
+0000cb50: 2020 2020 2020 2020 7634 4175 7468 203d          v4Auth =
+0000cb60: 2061 7574 682e 5634 4175 7468 656e 7469   auth.V4Authenti
+0000cb70: 6361 7469 6f6e 2873 6563 7572 6974 7950  cation(securityP
+0000cb80: 726f 7669 6465 722e 6163 6365 7373 5f6b  rovider.access_k
+0000cb90: 6579 5f69 642c 2073 6563 7572 6974 7950  ey_id, securityP
+0000cba0: 726f 7669 6465 722e 7365 6372 6574 5f61  rovider.secret_a
+0000cbb0: 6363 6573 735f 6b65 792c 2073 656c 662e  ccess_key, self.
+0000cbc0: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
 0000cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbf0: 2073 686f 7274 4461 7465 2c20 6c6f 6e67   shortDate, long
-0000cc00: 4461 7465 2c20 7365 6c66 2e70 6174 685f  Date, self.path_
-0000cc10: 7374 796c 652c 2073 656c 662e 6861 290a  style, self.ha).
-0000cc20: 0a20 2020 2020 2020 2071 7565 7279 5061  .        queryPa
-0000cc30: 7261 6d73 5b27 582d 416d 7a2d 416c 676f  rams['X-Amz-Algo
-0000cc40: 7269 7468 6d27 5d20 3d20 2741 5753 342d  rithm'] = 'AWS4-
-0000cc50: 484d 4143 2d53 4841 3235 3627 0a20 2020  HMAC-SHA256'.   
-0000cc60: 2020 2020 2071 7565 7279 5061 7261 6d73       queryParams
-0000cc70: 5b27 582d 416d 7a2d 4372 6564 656e 7469  ['X-Amz-Credenti
-0000cc80: 616c 275d 203d 2076 3441 7574 682e 6765  al'] = v4Auth.ge
-0000cc90: 7443 7265 6465 6e74 6961 6c28 290a 2020  tCredential().  
-0000cca0: 2020 2020 2020 7175 6572 7950 6172 616d        queryParam
-0000ccb0: 735b 2758 2d41 6d7a 2d44 6174 6527 5d20  s['X-Amz-Date'] 
-0000ccc0: 3d20 6c6f 6e67 4461 7465 0a20 2020 2020  = longDate.     
-0000ccd0: 2020 2071 7565 7279 5061 7261 6d73 5b27     queryParams['
-0000cce0: 582d 416d 7a2d 4578 7069 7265 7327 5d20  X-Amz-Expires'] 
-0000ccf0: 3d20 6578 7069 7265 730a 0a20 2020 2020  = expires..     
-0000cd00: 2020 2068 6561 644d 6170 203d 2076 3441     headMap = v4A
-0000cd10: 7574 682e 7365 744d 6170 4b65 794c 6f77  uth.setMapKeyLow
-0000cd20: 6572 2868 6561 6465 7273 290a 2020 2020  er(headers).    
-0000cd30: 2020 2020 7369 676e 6564 4865 6164 6572      signedHeader
-0000cd40: 7320 3d20 7634 4175 7468 2e67 6574 5369  s = v4Auth.getSi
-0000cd50: 676e 6564 4865 6164 6572 7328 6865 6164  gnedHeaders(head
-0000cd60: 4d61 7029 0a0a 2020 2020 2020 2020 7175  Map)..        qu
-0000cd70: 6572 7950 6172 616d 735b 2758 2d41 6d7a  eryParams['X-Amz
-0000cd80: 2d53 6967 6e65 6448 6561 6465 7273 275d  -SignedHeaders']
-0000cd90: 203d 2073 6967 6e65 6448 6561 6465 7273   = signedHeaders
-0000cda0: 0a0a 2020 2020 2020 2020 7369 676e 6174  ..        signat
-0000cdb0: 7572 6520 3d20 7634 4175 7468 2e67 6574  ure = v4Auth.get
-0000cdc0: 5369 676e 6174 7572 6528 6d65 7468 6f64  Signature(method
-0000cdd0: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
-0000cde0: 6a65 6374 4b65 792c 2071 7565 7279 5061  jectKey, queryPa
-0000cdf0: 7261 6d73 2c0a 2020 2020 2020 2020 2020  rams,.          
+0000cbe0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000cbf0: 686f 7274 4461 7465 2c20 6c6f 6e67 4461  hortDate, longDa
+0000cc00: 7465 2c20 7365 6c66 2e70 6174 685f 7374  te, self.path_st
+0000cc10: 796c 652c 2073 656c 662e 6861 290a 0a20  yle, self.ha).. 
+0000cc20: 2020 2020 2020 2071 7565 7279 5061 7261         queryPara
+0000cc30: 6d73 5b27 582d 416d 7a2d 416c 676f 7269  ms['X-Amz-Algori
+0000cc40: 7468 6d27 5d20 3d20 2741 5753 342d 484d  thm'] = 'AWS4-HM
+0000cc50: 4143 2d53 4841 3235 3627 0a20 2020 2020  AC-SHA256'.     
+0000cc60: 2020 2071 7565 7279 5061 7261 6d73 5b27     queryParams['
+0000cc70: 582d 416d 7a2d 4372 6564 656e 7469 616c  X-Amz-Credential
+0000cc80: 275d 203d 2076 3441 7574 682e 6765 7443  '] = v4Auth.getC
+0000cc90: 7265 6465 6e74 6961 6c28 290a 2020 2020  redential().    
+0000cca0: 2020 2020 7175 6572 7950 6172 616d 735b      queryParams[
+0000ccb0: 2758 2d41 6d7a 2d44 6174 6527 5d20 3d20  'X-Amz-Date'] = 
+0000ccc0: 6c6f 6e67 4461 7465 0a20 2020 2020 2020  longDate.       
+0000ccd0: 2071 7565 7279 5061 7261 6d73 5b27 582d   queryParams['X-
+0000cce0: 416d 7a2d 4578 7069 7265 7327 5d20 3d20  Amz-Expires'] = 
+0000ccf0: 6578 7069 7265 730a 0a20 2020 2020 2020  expires..       
+0000cd00: 2068 6561 644d 6170 203d 2076 3441 7574   headMap = v4Aut
+0000cd10: 682e 7365 744d 6170 4b65 794c 6f77 6572  h.setMapKeyLower
+0000cd20: 2868 6561 6465 7273 290a 2020 2020 2020  (headers).      
+0000cd30: 2020 7369 676e 6564 4865 6164 6572 7320    signedHeaders 
+0000cd40: 3d20 7634 4175 7468 2e67 6574 5369 676e  = v4Auth.getSign
+0000cd50: 6564 4865 6164 6572 7328 6865 6164 4d61  edHeaders(headMa
+0000cd60: 7029 0a0a 2020 2020 2020 2020 7175 6572  p)..        quer
+0000cd70: 7950 6172 616d 735b 2758 2d41 6d7a 2d53  yParams['X-Amz-S
+0000cd80: 6967 6e65 6448 6561 6465 7273 275d 203d  ignedHeaders'] =
+0000cd90: 2073 6967 6e65 6448 6561 6465 7273 0a0a   signedHeaders..
+0000cda0: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
+0000cdb0: 6520 3d20 7634 4175 7468 2e67 6574 5369  e = v4Auth.getSi
+0000cdc0: 676e 6174 7572 6528 6d65 7468 6f64 2c20  gnature(method, 
+0000cdd0: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
+0000cde0: 6374 4b65 792c 2071 7565 7279 5061 7261  ctKey, queryPara
+0000cdf0: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
 0000ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce10: 2020 2020 2020 2020 2020 2020 2020 6865                he
-0000ce20: 6164 4d61 702c 2073 6967 6e65 6448 6561  adMap, signedHea
-0000ce30: 6465 7273 2c20 2755 4e53 4947 4e45 442d  ders, 'UNSIGNED-
-0000ce40: 5041 594c 4f41 4427 295b 2753 6967 6e61  PAYLOAD')['Signa
-0000ce50: 7475 7265 275d 0a0a 2020 2020 2020 2020  ture']..        
-0000ce60: 7175 6572 7950 6172 616d 735b 2758 2d41  queryParams['X-A
-0000ce70: 6d7a 2d53 6967 6e61 7475 7265 275d 203d  mz-Signature'] =
-0000ce80: 2073 6967 6e61 7475 7265 0a0a 2020 2020   signature..    
-0000ce90: 2020 2020 6966 2073 656c 662e 6973 5f63      if self.is_c
-0000cea0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-0000ceb0: 2020 6275 636b 6574 4e61 6d65 203d 204e    bucketName = N
-0000cec0: 6f6e 650a 0a20 2020 2020 2020 2072 6573  one..        res
-0000ced0: 756c 7420 3d20 7b0a 2020 2020 2020 2020  ult = {.        
-0000cee0: 2020 2020 2773 6967 6e65 6455 726c 273a      'signedUrl':
-0000cef0: 2063 616c 6c69 6e67 5f66 6f72 6d61 742e   calling_format.
-0000cf00: 6765 745f 6675 6c6c 5f75 726c 2873 656c  get_full_url(sel
-0000cf10: 662e 6973 5f73 6563 7572 652c 2073 656c  f.is_secure, sel
-0000cf20: 662e 7365 7276 6572 2c20 7365 6c66 2e70  f.server, self.p
-0000cf30: 6f72 742c 2062 7563 6b65 744e 616d 652c  ort, bucketName,
-0000cf40: 206f 626a 6563 744b 6579 2c0a 2020 2020   objectKey,.    
+0000ce10: 2020 2020 2020 2020 2020 2020 6865 6164              head
+0000ce20: 4d61 702c 2073 6967 6e65 6448 6561 6465  Map, signedHeade
+0000ce30: 7273 2c20 2755 4e53 4947 4e45 442d 5041  rs, 'UNSIGNED-PA
+0000ce40: 594c 4f41 4427 295b 2753 6967 6e61 7475  YLOAD')['Signatu
+0000ce50: 7265 275d 0a0a 2020 2020 2020 2020 7175  re']..        qu
+0000ce60: 6572 7950 6172 616d 735b 2758 2d41 6d7a  eryParams['X-Amz
+0000ce70: 2d53 6967 6e61 7475 7265 275d 203d 2073  -Signature'] = s
+0000ce80: 6967 6e61 7475 7265 0a0a 2020 2020 2020  ignature..      
+0000ce90: 2020 6966 2073 656c 662e 6973 5f63 6e61    if self.is_cna
+0000cea0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0000ceb0: 6275 636b 6574 4e61 6d65 203d 204e 6f6e  bucketName = Non
+0000cec0: 650a 0a20 2020 2020 2020 2072 6573 756c  e..        resul
+0000ced0: 7420 3d20 7b0a 2020 2020 2020 2020 2020  t = {.          
+0000cee0: 2020 2773 6967 6e65 6455 726c 273a 2063    'signedUrl': c
+0000cef0: 616c 6c69 6e67 5f66 6f72 6d61 742e 6765  alling_format.ge
+0000cf00: 745f 6675 6c6c 5f75 726c 2873 656c 662e  t_full_url(self.
+0000cf10: 6973 5f73 6563 7572 652c 2073 656c 662e  is_secure, self.
+0000cf20: 7365 7276 6572 2c20 7365 6c66 2e70 6f72  server, self.por
+0000cf30: 742c 2062 7563 6b65 744e 616d 652c 206f  t, bucketName, o
+0000cf40: 626a 6563 744b 6579 2c0a 2020 2020 2020  bjectKey,.      
 0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf80: 2071 7565 7279 5061 7261 6d73 292c 0a20   queryParams),. 
-0000cf90: 2020 2020 2020 2020 2020 2027 6163 7475             'actu
-0000cfa0: 616c 5369 676e 6564 5265 7175 6573 7448  alSignedRequestH
-0000cfb0: 6561 6465 7273 273a 2068 6561 6465 7273  eaders': headers
-0000cfc0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-0000cfd0: 2020 2020 7265 7475 726e 205f 4372 6561      return _Crea
-0000cfe0: 7465 5369 676e 6564 5572 6c52 6573 706f  teSignedUrlRespo
-0000cff0: 6e73 6528 2a2a 7265 7375 6c74 290a 0a20  nse(**result).. 
-0000d000: 2020 2064 6566 2063 7265 6174 6556 3450     def createV4P
-0000d010: 6f73 7453 6967 6e61 7475 7265 2873 656c  ostSignature(sel
-0000d020: 662c 2062 7563 6b65 744e 616d 653d 4e6f  f, bucketName=No
-0000d030: 6e65 2c20 6f62 6a65 6374 4b65 793d 4e6f  ne, objectKey=No
-0000d040: 6e65 2c20 6578 7069 7265 733d 3330 302c  ne, expires=300,
-0000d050: 2066 6f72 6d50 6172 616d 733d 4e6f 6e65   formParams=None
-0000d060: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0000d070: 6e20 7365 6c66 2e5f 6372 6561 7465 506f  n self._createPo
-0000d080: 7374 5369 676e 6174 7572 6528 6275 636b  stSignature(buck
-0000d090: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-0000d0a0: 792c 2065 7870 6972 6573 2c20 666f 726d  y, expires, form
-0000d0b0: 5061 7261 6d73 2c20 5472 7565 290a 0a20  Params, True).. 
-0000d0c0: 2020 2064 6566 2063 7265 6174 6550 6f73     def createPos
-0000d0d0: 7453 6967 6e61 7475 7265 2873 656c 662c  tSignature(self,
-0000d0e0: 2062 7563 6b65 744e 616d 653d 4e6f 6e65   bucketName=None
-0000d0f0: 2c20 6f62 6a65 6374 4b65 793d 4e6f 6e65  , objectKey=None
-0000d100: 2c20 6578 7069 7265 733d 3330 302c 2066  , expires=300, f
-0000d110: 6f72 6d50 6172 616d 733d 4e6f 6e65 293a  ormParams=None):
-0000d120: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d130: 7365 6c66 2e5f 6372 6561 7465 506f 7374  self._createPost
-0000d140: 5369 676e 6174 7572 6528 6275 636b 6574  Signature(bucket
-0000d150: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
-0000d160: 2065 7870 6972 6573 2c20 666f 726d 5061   expires, formPa
-0000d170: 7261 6d73 2c20 7365 6c66 2e73 6967 6e61  rams, self.signa
-0000d180: 7475 7265 2e6c 6f77 6572 2829 203d 3d20  ture.lower() == 
-0000d190: 2776 3427 290a 0a20 2020 2064 6566 205f  'v4')..    def _
-0000d1a0: 6372 6561 7465 506f 7374 5369 676e 6174  createPostSignat
-0000d1b0: 7572 6528 7365 6c66 2c20 6275 636b 6574  ure(self, bucket
-0000d1c0: 4e61 6d65 3d4e 6f6e 652c 206f 626a 6563  Name=None, objec
-0000d1d0: 744b 6579 3d4e 6f6e 652c 2065 7870 6972  tKey=None, expir
-0000d1e0: 6573 3d33 3030 2c20 666f 726d 5061 7261  es=300, formPara
-0000d1f0: 6d73 3d4e 6f6e 652c 2069 735f 7634 3d46  ms=None, is_v4=F
-0000d200: 616c 7365 293a 0a20 2020 2020 2020 2066  alse):.        f
-0000d210: 726f 6d20 6461 7465 7469 6d65 2069 6d70  rom datetime imp
-0000d220: 6f72 7420 6461 7465 7469 6d65 2c20 7469  ort datetime, ti
-0000d230: 6d65 6465 6c74 610a 0a20 2020 2020 2020  medelta..       
-0000d240: 2064 6174 6520 3d20 6461 7465 7469 6d65   date = datetime
-0000d250: 2e75 7463 6e6f 7728 290a 2020 2020 2020  .utcnow().      
-0000d260: 2020 7368 6f72 7444 6174 6520 3d20 6461    shortDate = da
-0000d270: 7465 2e73 7472 6674 696d 6528 636f 6e73  te.strftime(cons
-0000d280: 742e 5348 4f52 545f 4441 5445 5f46 4f52  t.SHORT_DATE_FOR
-0000d290: 4d41 5429 0a20 2020 2020 2020 206c 6f6e  MAT).        lon
-0000d2a0: 6744 6174 6520 3d20 6461 7465 2e73 7472  gDate = date.str
-0000d2b0: 6674 696d 6528 636f 6e73 742e 4c4f 4e47  ftime(const.LONG
-0000d2c0: 5f44 4154 455f 464f 524d 4154 290a 2020  _DATE_FORMAT).  
-0000d2d0: 2020 2020 2020 7365 6375 7269 7479 5072        securityPr
-0000d2e0: 6f76 6964 6572 203d 2073 656c 662e 5f67  ovider = self._g
-0000d2f0: 6574 5f74 6f6b 656e 2829 0a0a 2020 2020  et_token()..    
-0000d300: 2020 2020 6578 7069 7265 7320 3d20 3330      expires = 30
-0000d310: 3020 6966 2065 7870 6972 6573 2069 7320  0 if expires is 
-0000d320: 4e6f 6e65 2065 6c73 6520 7574 696c 2e74  None else util.t
-0000d330: 6f5f 696e 7428 6578 7069 7265 7329 0a20  o_int(expires). 
-0000d340: 2020 2020 2020 2065 7870 6972 6573 203d         expires =
-0000d350: 2064 6174 6520 2b20 7469 6d65 6465 6c74   date + timedelt
-0000d360: 6128 7365 636f 6e64 733d 6578 7069 7265  a(seconds=expire
-0000d370: 7329 0a0a 2020 2020 2020 2020 6578 7069  s)..        expi
-0000d380: 7265 7320 3d20 6578 7069 7265 732e 7374  res = expires.st
-0000d390: 7266 7469 6d65 2863 6f6e 7374 2e45 5850  rftime(const.EXP
-0000d3a0: 4952 4154 494f 4e5f 4441 5445 5f46 4f52  IRATION_DATE_FOR
-0000d3b0: 4d41 5429 0a0a 2020 2020 2020 2020 666f  MAT)..        fo
-0000d3c0: 726d 5061 7261 6d73 203d 2073 656c 662e  rmParams = self.
-0000d3d0: 5f70 6172 7365 5f70 6f73 745f 7061 7261  _parse_post_para
-0000d3e0: 6d73 2866 6f72 6d50 6172 616d 732c 2073  ms(formParams, s
-0000d3f0: 6563 7572 6974 7950 726f 7669 6465 722c  ecurityProvider,
-0000d400: 2069 735f 7634 2c0a 2020 2020 2020 2020   is_v4,.        
+0000cf70: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0000cf80: 7565 7279 5061 7261 6d73 292c 0a20 2020  ueryParams),.   
+0000cf90: 2020 2020 2020 2020 2027 6163 7475 616c           'actual
+0000cfa0: 5369 676e 6564 5265 7175 6573 7448 6561  SignedRequestHea
+0000cfb0: 6465 7273 273a 2068 6561 6465 7273 0a20  ders': headers. 
+0000cfc0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0000cfd0: 2020 7265 7475 726e 205f 4372 6561 7465    return _Create
+0000cfe0: 5369 676e 6564 5572 6c52 6573 706f 6e73  SignedUrlRespons
+0000cff0: 6528 2a2a 7265 7375 6c74 290a 0a20 2020  e(**result)..   
+0000d000: 2064 6566 2063 7265 6174 6556 3450 6f73   def createV4Pos
+0000d010: 7453 6967 6e61 7475 7265 2873 656c 662c  tSignature(self,
+0000d020: 2062 7563 6b65 744e 616d 653d 4e6f 6e65   bucketName=None
+0000d030: 2c20 6f62 6a65 6374 4b65 793d 4e6f 6e65  , objectKey=None
+0000d040: 2c20 6578 7069 7265 733d 3330 302c 2066  , expires=300, f
+0000d050: 6f72 6d50 6172 616d 733d 4e6f 6e65 293a  ormParams=None):
+0000d060: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000d070: 7365 6c66 2e5f 6372 6561 7465 506f 7374  self._createPost
+0000d080: 5369 676e 6174 7572 6528 6275 636b 6574  Signature(bucket
+0000d090: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
+0000d0a0: 2065 7870 6972 6573 2c20 666f 726d 5061   expires, formPa
+0000d0b0: 7261 6d73 2c20 5472 7565 290a 0a20 2020  rams, True)..   
+0000d0c0: 2064 6566 2063 7265 6174 6550 6f73 7453   def createPostS
+0000d0d0: 6967 6e61 7475 7265 2873 656c 662c 2062  ignature(self, b
+0000d0e0: 7563 6b65 744e 616d 653d 4e6f 6e65 2c20  ucketName=None, 
+0000d0f0: 6f62 6a65 6374 4b65 793d 4e6f 6e65 2c20  objectKey=None, 
+0000d100: 6578 7069 7265 733d 3330 302c 2066 6f72  expires=300, for
+0000d110: 6d50 6172 616d 733d 4e6f 6e65 293a 0a20  mParams=None):. 
+0000d120: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000d130: 6c66 2e5f 6372 6561 7465 506f 7374 5369  lf._createPostSi
+0000d140: 676e 6174 7572 6528 6275 636b 6574 4e61  gnature(bucketNa
+0000d150: 6d65 2c20 6f62 6a65 6374 4b65 792c 2065  me, objectKey, e
+0000d160: 7870 6972 6573 2c20 666f 726d 5061 7261  xpires, formPara
+0000d170: 6d73 2c20 7365 6c66 2e73 6967 6e61 7475  ms, self.signatu
+0000d180: 7265 2e6c 6f77 6572 2829 203d 3d20 2776  re.lower() == 'v
+0000d190: 3427 290a 0a20 2020 2064 6566 205f 6372  4')..    def _cr
+0000d1a0: 6561 7465 506f 7374 5369 676e 6174 7572  eatePostSignatur
+0000d1b0: 6528 7365 6c66 2c20 6275 636b 6574 4e61  e(self, bucketNa
+0000d1c0: 6d65 3d4e 6f6e 652c 206f 626a 6563 744b  me=None, objectK
+0000d1d0: 6579 3d4e 6f6e 652c 2065 7870 6972 6573  ey=None, expires
+0000d1e0: 3d33 3030 2c20 666f 726d 5061 7261 6d73  =300, formParams
+0000d1f0: 3d4e 6f6e 652c 2069 735f 7634 3d46 616c  =None, is_v4=Fal
+0000d200: 7365 293a 0a20 2020 2020 2020 2066 726f  se):.        fro
+0000d210: 6d20 6461 7465 7469 6d65 2069 6d70 6f72  m datetime impor
+0000d220: 7420 6461 7465 7469 6d65 2c20 7469 6d65  t datetime, time
+0000d230: 6465 6c74 610a 0a20 2020 2020 2020 2064  delta..        d
+0000d240: 6174 6520 3d20 6461 7465 7469 6d65 2e75  ate = datetime.u
+0000d250: 7463 6e6f 7728 290a 2020 2020 2020 2020  tcnow().        
+0000d260: 7368 6f72 7444 6174 6520 3d20 6461 7465  shortDate = date
+0000d270: 2e73 7472 6674 696d 6528 636f 6e73 742e  .strftime(const.
+0000d280: 5348 4f52 545f 4441 5445 5f46 4f52 4d41  SHORT_DATE_FORMA
+0000d290: 5429 0a20 2020 2020 2020 206c 6f6e 6744  T).        longD
+0000d2a0: 6174 6520 3d20 6461 7465 2e73 7472 6674  ate = date.strft
+0000d2b0: 696d 6528 636f 6e73 742e 4c4f 4e47 5f44  ime(const.LONG_D
+0000d2c0: 4154 455f 464f 524d 4154 290a 2020 2020  ATE_FORMAT).    
+0000d2d0: 2020 2020 7365 6375 7269 7479 5072 6f76      securityProv
+0000d2e0: 6964 6572 203d 2073 656c 662e 5f67 6574  ider = self._get
+0000d2f0: 5f74 6f6b 656e 2829 0a0a 2020 2020 2020  _token()..      
+0000d300: 2020 6578 7069 7265 7320 3d20 3330 3020    expires = 300 
+0000d310: 6966 2065 7870 6972 6573 2069 7320 4e6f  if expires is No
+0000d320: 6e65 2065 6c73 6520 7574 696c 2e74 6f5f  ne else util.to_
+0000d330: 696e 7428 6578 7069 7265 7329 0a20 2020  int(expires).   
+0000d340: 2020 2020 2065 7870 6972 6573 203d 2064       expires = d
+0000d350: 6174 6520 2b20 7469 6d65 6465 6c74 6128  ate + timedelta(
+0000d360: 7365 636f 6e64 733d 6578 7069 7265 7329  seconds=expires)
+0000d370: 0a0a 2020 2020 2020 2020 6578 7069 7265  ..        expire
+0000d380: 7320 3d20 6578 7069 7265 732e 7374 7266  s = expires.strf
+0000d390: 7469 6d65 2863 6f6e 7374 2e45 5850 4952  time(const.EXPIR
+0000d3a0: 4154 494f 4e5f 4441 5445 5f46 4f52 4d41  ATION_DATE_FORMA
+0000d3b0: 5429 0a0a 2020 2020 2020 2020 666f 726d  T)..        form
+0000d3c0: 5061 7261 6d73 203d 2073 656c 662e 5f70  Params = self._p
+0000d3d0: 6172 7365 5f70 6f73 745f 7061 7261 6d73  arse_post_params
+0000d3e0: 2866 6f72 6d50 6172 616d 732c 2073 6563  (formParams, sec
+0000d3f0: 7572 6974 7950 726f 7669 6465 722c 2069  urityProvider, i
+0000d400: 735f 7634 2c0a 2020 2020 2020 2020 2020  s_v4,.          
 0000d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d430: 2020 2020 2062 7563 6b65 744e 616d 652c       bucketName,
-0000d440: 206f 626a 6563 744b 6579 2c20 6c6f 6e67   objectKey, long
-0000d450: 4461 7465 2c20 7368 6f72 7444 6174 6529  Date, shortDate)
-0000d460: 0a0a 2020 2020 2020 2020 706f 6c69 6379  ..        policy
-0000d470: 203d 205b 277b 2265 7870 6972 6174 696f   = ['{"expiratio
-0000d480: 6e22 3a22 275d 0a20 2020 2020 2020 2070  n":"'].        p
-0000d490: 6f6c 6963 792e 6170 7065 6e64 2865 7870  olicy.append(exp
-0000d4a0: 6972 6573 290a 2020 2020 2020 2020 706f  ires).        po
-0000d4b0: 6c69 6379 2e61 7070 656e 6428 2722 2c20  licy.append('", 
-0000d4c0: 2263 6f6e 6469 7469 6f6e 7322 3a5b 2729  "conditions":[')
-0000d4d0: 0a0a 2020 2020 2020 2020 6d61 7463 6841  ..        matchA
-0000d4e0: 6e79 4275 636b 6574 203d 2054 7275 650a  nyBucket = True.
-0000d4f0: 2020 2020 2020 2020 6d61 7463 6841 6e79          matchAny
-0000d500: 4b65 7920 3d20 5472 7565 0a0a 2020 2020  Key = True..    
-0000d510: 2020 2020 636f 6e64 6974 696f 6e41 6c6c      conditionAll
-0000d520: 6f77 4b65 7973 203d 205b 2761 636c 272c  owKeys = ['acl',
-0000d530: 2027 6275 636b 6574 272c 2027 6b65 7927   'bucket', 'key'
-0000d540: 2c20 2773 7563 6365 7373 5f61 6374 696f  , 'success_actio
-0000d550: 6e5f 7265 6469 7265 6374 272c 2027 7265  n_redirect', 're
-0000d560: 6469 7265 6374 272c 2027 7375 6363 6573  direct', 'succes
-0000d570: 735f 6163 7469 6f6e 5f73 7461 7475 7327  s_action_status'
-0000d580: 5d0a 0a20 2020 2020 2020 2066 6f72 206b  ]..        for k
-0000d590: 6579 2c20 7661 6c75 6520 696e 2066 6f72  ey, value in for
-0000d5a0: 6d50 6172 616d 732e 6974 656d 7328 293a  mParams.items():
-0000d5b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d5c0: 6b65 793a 0a20 2020 2020 2020 2020 2020  key:.           
-0000d5d0: 2020 2020 206b 6579 203d 2075 7469 6c2e       key = util.
-0000d5e0: 746f 5f73 7472 696e 6728 6b65 7929 2e6c  to_string(key).l
-0000d5f0: 6f77 6572 2829 0a0a 2020 2020 2020 2020  ower()..        
-0000d600: 2020 2020 2020 2020 6966 206b 6579 203d          if key =
-0000d610: 3d20 2762 7563 6b65 7427 3a0a 2020 2020  = 'bucket':.    
-0000d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d630: 6d61 7463 6841 6e79 4275 636b 6574 203d  matchAnyBucket =
-0000d640: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-0000d650: 2020 2020 2020 2065 6c69 6620 6b65 7920         elif key 
-0000d660: 3d3d 2027 6b65 7927 3a0a 2020 2020 2020  == 'key':.      
-0000d670: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000d680: 7463 6841 6e79 4b65 7920 3d20 4661 6c73  tchAnyKey = Fals
-0000d690: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-0000d6a0: 2020 2069 6620 6b65 7920 6e6f 7420 696e     if key not in
-0000d6b0: 2063 6f6e 7374 2e41 4c4c 4f57 4544 5f52   const.ALLOWED_R
-0000d6c0: 4551 5545 5354 5f48 5454 505f 4845 4144  EQUEST_HTTP_HEAD
-0000d6d0: 4552 5f4d 4554 4144 4154 415f 4e41 4d45  ER_METADATA_NAME
-0000d6e0: 5320 5c0a 2020 2020 2020 2020 2020 2020  S \.            
-0000d6f0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000d700: 6e6f 7420 6b65 792e 7374 6172 7473 7769  not key.startswi
-0000d710: 7468 2873 656c 662e 6861 2e5f 6765 745f  th(self.ha._get_
-0000d720: 6865 6164 6572 5f70 7265 6669 7828 2929  header_prefix())
-0000d730: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0000d740: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
-0000d750: 6f74 206b 6579 2e73 7461 7274 7377 6974  ot key.startswit
-0000d760: 6828 636f 6e73 742e 4f42 535f 4845 4144  h(const.OBS_HEAD
-0000d770: 4552 5f50 5245 4649 5829 2061 6e64 206b  ER_PREFIX) and k
-0000d780: 6579 206e 6f74 2069 6e20 636f 6e64 6974  ey not in condit
-0000d790: 696f 6e41 6c6c 6f77 4b65 7973 3a0a 2020  ionAllowKeys:.  
+0000d430: 2020 2062 7563 6b65 744e 616d 652c 206f     bucketName, o
+0000d440: 626a 6563 744b 6579 2c20 6c6f 6e67 4461  bjectKey, longDa
+0000d450: 7465 2c20 7368 6f72 7444 6174 6529 0a0a  te, shortDate)..
+0000d460: 2020 2020 2020 2020 706f 6c69 6379 203d          policy =
+0000d470: 205b 277b 2265 7870 6972 6174 696f 6e22   ['{"expiration"
+0000d480: 3a22 275d 0a20 2020 2020 2020 2070 6f6c  :"'].        pol
+0000d490: 6963 792e 6170 7065 6e64 2865 7870 6972  icy.append(expir
+0000d4a0: 6573 290a 2020 2020 2020 2020 706f 6c69  es).        poli
+0000d4b0: 6379 2e61 7070 656e 6428 2722 2c20 2263  cy.append('", "c
+0000d4c0: 6f6e 6469 7469 6f6e 7322 3a5b 2729 0a0a  onditions":[')..
+0000d4d0: 2020 2020 2020 2020 6d61 7463 6841 6e79          matchAny
+0000d4e0: 4275 636b 6574 203d 2054 7275 650a 2020  Bucket = True.  
+0000d4f0: 2020 2020 2020 6d61 7463 6841 6e79 4b65        matchAnyKe
+0000d500: 7920 3d20 5472 7565 0a0a 2020 2020 2020  y = True..      
+0000d510: 2020 636f 6e64 6974 696f 6e41 6c6c 6f77    conditionAllow
+0000d520: 4b65 7973 203d 205b 2761 636c 272c 2027  Keys = ['acl', '
+0000d530: 6275 636b 6574 272c 2027 6b65 7927 2c20  bucket', 'key', 
+0000d540: 2773 7563 6365 7373 5f61 6374 696f 6e5f  'success_action_
+0000d550: 7265 6469 7265 6374 272c 2027 7265 6469  redirect', 'redi
+0000d560: 7265 6374 272c 2027 7375 6363 6573 735f  rect', 'success_
+0000d570: 6163 7469 6f6e 5f73 7461 7475 7327 5d0a  action_status'].
+0000d580: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+0000d590: 2c20 7661 6c75 6520 696e 2066 6f72 6d50  , value in formP
+0000d5a0: 6172 616d 732e 6974 656d 7328 293a 0a20  arams.items():. 
+0000d5b0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
+0000d5c0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000d5d0: 2020 206b 6579 203d 2075 7469 6c2e 746f     key = util.to
+0000d5e0: 5f73 7472 696e 6728 6b65 7929 2e6c 6f77  _string(key).low
+0000d5f0: 6572 2829 0a0a 2020 2020 2020 2020 2020  er()..          
+0000d600: 2020 2020 2020 6966 206b 6579 203d 3d20        if key == 
+0000d610: 2762 7563 6b65 7427 3a0a 2020 2020 2020  'bucket':.      
+0000d620: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0000d630: 7463 6841 6e79 4275 636b 6574 203d 2046  tchAnyBucket = F
+0000d640: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0000d650: 2020 2020 2065 6c69 6620 6b65 7920 3d3d       elif key ==
+0000d660: 2027 6b65 7927 3a0a 2020 2020 2020 2020   'key':.        
+0000d670: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+0000d680: 6841 6e79 4b65 7920 3d20 4661 6c73 650a  hAnyKey = False.
+0000d690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d6a0: 2069 6620 6b65 7920 6e6f 7420 696e 2063   if key not in c
+0000d6b0: 6f6e 7374 2e41 4c4c 4f57 4544 5f52 4551  onst.ALLOWED_REQ
+0000d6c0: 5545 5354 5f48 5454 505f 4845 4144 4552  UEST_HTTP_HEADER
+0000d6d0: 5f4d 4554 4144 4154 415f 4e41 4d45 5320  _METADATA_NAMES 
+0000d6e0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0000d6f0: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
+0000d700: 7420 6b65 792e 7374 6172 7473 7769 7468  t key.startswith
+0000d710: 2873 656c 662e 6861 2e5f 6765 745f 6865  (self.ha._get_he
+0000d720: 6164 6572 5f70 7265 6669 7828 2929 205c  ader_prefix()) \
+0000d730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d740: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
+0000d750: 206b 6579 2e73 7461 7274 7377 6974 6828   key.startswith(
+0000d760: 636f 6e73 742e 4f42 535f 4845 4144 4552  const.OBS_HEADER
+0000d770: 5f50 5245 4649 5829 2061 6e64 206b 6579  _PREFIX) and key
+0000d780: 206e 6f74 2069 6e20 636f 6e64 6974 696f   not in conditio
+0000d790: 6e41 6c6c 6f77 4b65 7973 3a0a 2020 2020  nAllowKeys:.    
 0000d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7b0: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
-0000d7c0: 2020 2020 2020 2020 2020 2020 706f 6c69              poli
-0000d7d0: 6379 2e61 7070 656e 6428 277b 2227 290a  cy.append('{"').
-0000d7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7f0: 706f 6c69 6379 2e61 7070 656e 6428 6b65  policy.append(ke
-0000d800: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
-0000d810: 2020 2070 6f6c 6963 792e 6170 7065 6e64     policy.append
-0000d820: 2827 223a 2227 290a 2020 2020 2020 2020  ('":"').        
-0000d830: 2020 2020 2020 2020 706f 6c69 6379 2e61          policy.a
-0000d840: 7070 656e 6428 7574 696c 2e74 6f5f 7374  ppend(util.to_st
-0000d850: 7269 6e67 2876 616c 7565 2929 0a20 2020  ring(value)).   
-0000d860: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
-0000d870: 6963 792e 6170 7065 6e64 2827 227d 2c27  icy.append('"},'
-0000d880: 290a 0a20 2020 2020 2020 2069 6620 6d61  )..        if ma
-0000d890: 7463 6841 6e79 4275 636b 6574 3a0a 2020  tchAnyBucket:.  
-0000d8a0: 2020 2020 2020 2020 2020 706f 6c69 6379            policy
-0000d8b0: 2e61 7070 656e 6428 275b 2273 7461 7274  .append('["start
-0000d8c0: 732d 7769 7468 222c 2022 2462 7563 6b65  s-with", "$bucke
-0000d8d0: 7422 2c20 2222 5d2c 2729 0a0a 2020 2020  t", ""],')..    
-0000d8e0: 2020 2020 6966 206d 6174 6368 416e 794b      if matchAnyK
-0000d8f0: 6579 3a0a 2020 2020 2020 2020 2020 2020  ey:.            
-0000d900: 706f 6c69 6379 2e61 7070 656e 6428 275b  policy.append('[
-0000d910: 2273 7461 7274 732d 7769 7468 222c 2022  "starts-with", "
-0000d920: 246b 6579 222c 2022 225d 2c27 290a 0a20  $key", ""],').. 
-0000d930: 2020 2020 2020 2070 6f6c 6963 792e 6170         policy.ap
-0000d940: 7065 6e64 2827 5d7d 2729 0a0a 2020 2020  pend(']}')..    
-0000d950: 2020 2020 6f72 6967 696e 506f 6c69 6379      originPolicy
-0000d960: 203d 2027 272e 6a6f 696e 2870 6f6c 6963   = ''.join(polic
-0000d970: 7929 0a0a 2020 2020 2020 2020 706f 6c69  y)..        poli
-0000d980: 6379 203d 2075 7469 6c2e 6261 7365 3634  cy = util.base64
-0000d990: 5f65 6e63 6f64 6528 6f72 6967 696e 506f  _encode(originPo
-0000d9a0: 6c69 6379 290a 0a20 2020 2020 2020 2072  licy)..        r
-0000d9b0: 6573 756c 7420 3d20 7365 6c66 2e5f 7061  esult = self._pa
-0000d9c0: 7273 655f 706f 7374 5f73 6967 6e61 7475  rse_post_signatu
-0000d9d0: 7265 5f74 7970 6528 6973 5f76 342c 2073  re_type(is_v4, s
-0000d9e0: 6563 7572 6974 7950 726f 7669 6465 722c  ecurityProvider,
-0000d9f0: 206f 7269 6769 6e50 6f6c 6963 792c 0a20   originPolicy,. 
+0000d7b0: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
+0000d7c0: 2020 2020 2020 2020 2020 706f 6c69 6379            policy
+0000d7d0: 2e61 7070 656e 6428 277b 2227 290a 2020  .append('{"').  
+0000d7e0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000d7f0: 6c69 6379 2e61 7070 656e 6428 6b65 7929  licy.append(key)
+0000d800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d810: 2070 6f6c 6963 792e 6170 7065 6e64 2827   policy.append('
+0000d820: 223a 2227 290a 2020 2020 2020 2020 2020  ":"').          
+0000d830: 2020 2020 2020 706f 6c69 6379 2e61 7070        policy.app
+0000d840: 656e 6428 7574 696c 2e74 6f5f 7374 7269  end(util.to_stri
+0000d850: 6e67 2876 616c 7565 2929 0a20 2020 2020  ng(value)).     
+0000d860: 2020 2020 2020 2020 2020 2070 6f6c 6963             polic
+0000d870: 792e 6170 7065 6e64 2827 227d 2c27 290a  y.append('"},').
+0000d880: 0a20 2020 2020 2020 2069 6620 6d61 7463  .        if matc
+0000d890: 6841 6e79 4275 636b 6574 3a0a 2020 2020  hAnyBucket:.    
+0000d8a0: 2020 2020 2020 2020 706f 6c69 6379 2e61          policy.a
+0000d8b0: 7070 656e 6428 275b 2273 7461 7274 732d  ppend('["starts-
+0000d8c0: 7769 7468 222c 2022 2462 7563 6b65 7422  with", "$bucket"
+0000d8d0: 2c20 2222 5d2c 2729 0a0a 2020 2020 2020  , ""],')..      
+0000d8e0: 2020 6966 206d 6174 6368 416e 794b 6579    if matchAnyKey
+0000d8f0: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
+0000d900: 6c69 6379 2e61 7070 656e 6428 275b 2273  licy.append('["s
+0000d910: 7461 7274 732d 7769 7468 222c 2022 246b  tarts-with", "$k
+0000d920: 6579 222c 2022 225d 2c27 290a 0a20 2020  ey", ""],')..   
+0000d930: 2020 2020 2070 6f6c 6963 792e 6170 7065       policy.appe
+0000d940: 6e64 2827 5d7d 2729 0a0a 2020 2020 2020  nd(']}')..      
+0000d950: 2020 6f72 6967 696e 506f 6c69 6379 203d    originPolicy =
+0000d960: 2027 272e 6a6f 696e 2870 6f6c 6963 7929   ''.join(policy)
+0000d970: 0a0a 2020 2020 2020 2020 706f 6c69 6379  ..        policy
+0000d980: 203d 2075 7469 6c2e 6261 7365 3634 5f65   = util.base64_e
+0000d990: 6e63 6f64 6528 6f72 6967 696e 506f 6c69  ncode(originPoli
+0000d9a0: 6379 290a 0a20 2020 2020 2020 2072 6573  cy)..        res
+0000d9b0: 756c 7420 3d20 7365 6c66 2e5f 7061 7273  ult = self._pars
+0000d9c0: 655f 706f 7374 5f73 6967 6e61 7475 7265  e_post_signature
+0000d9d0: 5f74 7970 6528 6973 5f76 342c 2073 6563  _type(is_v4, sec
+0000d9e0: 7572 6974 7950 726f 7669 6465 722c 206f  urityProvider, o
+0000d9f0: 7269 6769 6e50 6f6c 6963 792c 0a20 2020  riginPolicy,.   
 0000da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da30: 706f 6c69 6379 2c20 666f 726d 5061 7261  policy, formPara
-0000da40: 6d73 2c20 7368 6f72 7444 6174 652c 206c  ms, shortDate, l
-0000da50: 6f6e 6744 6174 6529 0a20 2020 2020 2020  ongDate).       
-0000da60: 2072 6574 7572 6e20 5f43 7265 6174 6550   return _CreateP
-0000da70: 6f73 7453 6967 6e61 7475 7265 5265 7370  ostSignatureResp
-0000da80: 6f6e 7365 282a 2a72 6573 756c 7429 0a0a  onse(**result)..
-0000da90: 2020 2020 6465 6620 5f70 6172 7365 5f70      def _parse_p
-0000daa0: 6f73 745f 7061 7261 6d73 2873 656c 662c  ost_params(self,
-0000dab0: 2066 6f72 6d50 6172 616d 732c 2073 6563   formParams, sec
-0000dac0: 7572 6974 7950 726f 7669 6465 722c 2069  urityProvider, i
-0000dad0: 735f 7634 2c20 6275 636b 6574 4e61 6d65  s_v4, bucketName
-0000dae0: 2c20 6f62 6a65 6374 4b65 792c 206c 6f6e  , objectKey, lon
-0000daf0: 6744 6174 652c 2073 686f 7274 4461 7465  gDate, shortDate
-0000db00: 293a 0a20 2020 2020 2020 2066 6f72 6d50  ):.        formP
-0000db10: 6172 616d 7320 3d20 7b7d 2069 6620 666f  arams = {} if fo
-0000db20: 726d 5061 7261 6d73 2069 7320 4e6f 6e65  rmParams is None
-0000db30: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
-0000db40: 6365 2866 6f72 6d50 6172 616d 732c 0a20  ce(formParams,. 
+0000da20: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000da30: 6c69 6379 2c20 666f 726d 5061 7261 6d73  licy, formParams
+0000da40: 2c20 7368 6f72 7444 6174 652c 206c 6f6e  , shortDate, lon
+0000da50: 6744 6174 6529 0a20 2020 2020 2020 2072  gDate).        r
+0000da60: 6574 7572 6e20 5f43 7265 6174 6550 6f73  eturn _CreatePos
+0000da70: 7453 6967 6e61 7475 7265 5265 7370 6f6e  tSignatureRespon
+0000da80: 7365 282a 2a72 6573 756c 7429 0a0a 2020  se(**result)..  
+0000da90: 2020 6465 6620 5f70 6172 7365 5f70 6f73    def _parse_pos
+0000daa0: 745f 7061 7261 6d73 2873 656c 662c 2066  t_params(self, f
+0000dab0: 6f72 6d50 6172 616d 732c 2073 6563 7572  ormParams, secur
+0000dac0: 6974 7950 726f 7669 6465 722c 2069 735f  ityProvider, is_
+0000dad0: 7634 2c20 6275 636b 6574 4e61 6d65 2c20  v4, bucketName, 
+0000dae0: 6f62 6a65 6374 4b65 792c 206c 6f6e 6744  objectKey, longD
+0000daf0: 6174 652c 2073 686f 7274 4461 7465 293a  ate, shortDate):
+0000db00: 0a20 2020 2020 2020 2066 6f72 6d50 6172  .        formPar
+0000db10: 616d 7320 3d20 7b7d 2069 6620 666f 726d  ams = {} if form
+0000db20: 5061 7261 6d73 2069 7320 4e6f 6e65 206f  Params is None o
+0000db30: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
+0000db40: 2866 6f72 6d50 6172 616d 732c 0a20 2020  (formParams,.   
 0000db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000db90: 6963 7429 2065 6c73 6520 666f 726d 5061  ict) else formPa
-0000dba0: 7261 6d73 2e63 6f70 7928 290a 0a20 2020  rams.copy()..   
-0000dbb0: 2020 2020 2069 6620 7365 6375 7269 7479       if security
-0000dbc0: 5072 6f76 6964 6572 2e73 6563 7572 6974  Provider.securit
-0000dbd0: 795f 746f 6b65 6e20 6973 206e 6f74 204e  y_token is not N
-0000dbe0: 6f6e 6520 616e 6420 7365 6c66 2e68 612e  one and self.ha.
-0000dbf0: 7365 6375 7269 7479 5f74 6f6b 656e 5f68  security_token_h
-0000dc00: 6561 6465 7228 2920 6e6f 7420 696e 2066  eader() not in f
-0000dc10: 6f72 6d50 6172 616d 733a 0a20 2020 2020  ormParams:.     
-0000dc20: 2020 2020 2020 2066 6f72 6d50 6172 616d         formParam
-0000dc30: 735b 0a20 2020 2020 2020 2020 2020 2020  s[.             
-0000dc40: 2020 2073 656c 662e 6861 2e73 6563 7572     self.ha.secur
-0000dc50: 6974 795f 746f 6b65 6e5f 6865 6164 6572  ity_token_header
-0000dc60: 2829 5d20 3d20 7365 6375 7269 7479 5072  ()] = securityPr
-0000dc70: 6f76 6964 6572 2e73 6563 7572 6974 795f  ovider.security_
-0000dc80: 746f 6b65 6e0a 0a20 2020 2020 2020 2069  token..        i
-0000dc90: 6620 6973 5f76 343a 0a20 2020 2020 2020  f is_v4:.       
-0000dca0: 2020 2020 2066 6f72 6d50 6172 616d 735b       formParams[
-0000dcb0: 2758 2d41 6d7a 2d41 6c67 6f72 6974 686d  'X-Amz-Algorithm
-0000dcc0: 275d 203d 2027 4157 5334 2d48 4d41 432d  '] = 'AWS4-HMAC-
-0000dcd0: 5348 4132 3536 270a 2020 2020 2020 2020  SHA256'.        
-0000dce0: 2020 2020 666f 726d 5061 7261 6d73 5b27      formParams['
-0000dcf0: 582d 416d 7a2d 4461 7465 275d 203d 206c  X-Amz-Date'] = l
-0000dd00: 6f6e 6744 6174 650a 2020 2020 2020 2020  ongDate.        
-0000dd10: 2020 2020 666f 726d 5061 7261 6d73 5b27      formParams['
-0000dd20: 582d 416d 7a2d 4372 6564 656e 7469 616c  X-Amz-Credential
-0000dd30: 275d 203d 2027 2573 2f25 732f 2573 2f73  '] = '%s/%s/%s/s
-0000dd40: 332f 6177 7334 5f72 6571 7565 7374 2720  3/aws4_request' 
-0000dd50: 2520 280a 2020 2020 2020 2020 2020 2020  % (.            
-0000dd60: 2020 2020 7365 6375 7269 7479 5072 6f76      securityProv
-0000dd70: 6964 6572 2e61 6363 6573 735f 6b65 795f  ider.access_key_
-0000dd80: 6964 2c20 7368 6f72 7444 6174 652c 2073  id, shortDate, s
-0000dd90: 656c 662e 7265 6769 6f6e 290a 0a20 2020  elf.region)..   
-0000dda0: 2020 2020 2069 6620 6275 636b 6574 4e61       if bucketNa
-0000ddb0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-0000ddc0: 666f 726d 5061 7261 6d73 5b27 6275 636b  formParams['buck
-0000ddd0: 6574 275d 203d 2062 7563 6b65 744e 616d  et'] = bucketNam
-0000dde0: 650a 0a20 2020 2020 2020 2069 6620 6f62  e..        if ob
-0000ddf0: 6a65 6374 4b65 793a 0a20 2020 2020 2020  jectKey:.       
-0000de00: 2020 2020 2066 6f72 6d50 6172 616d 735b       formParams[
-0000de10: 276b 6579 275d 203d 206f 626a 6563 744b  'key'] = objectK
-0000de20: 6579 0a20 2020 2020 2020 2072 6574 7572  ey.        retur
-0000de30: 6e20 666f 726d 5061 7261 6d73 0a0a 2020  n formParams..  
-0000de40: 2020 6465 6620 5f70 6172 7365 5f70 6f73    def _parse_pos
-0000de50: 745f 7369 676e 6174 7572 655f 7479 7065  t_signature_type
-0000de60: 2873 656c 662c 2069 735f 7634 2c20 7365  (self, is_v4, se
-0000de70: 6375 7269 7479 5072 6f76 6964 6572 2c20  curityProvider, 
-0000de80: 6f72 6967 696e 506f 6c69 6379 2c20 706f  originPolicy, po
-0000de90: 6c69 6379 2c20 666f 726d 5061 7261 6d73  licy, formParams
-0000dea0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000db80: 2020 2020 2020 2020 2020 2020 2064 6963               dic
+0000db90: 7429 2065 6c73 6520 666f 726d 5061 7261  t) else formPara
+0000dba0: 6d73 2e63 6f70 7928 290a 0a20 2020 2020  ms.copy()..     
+0000dbb0: 2020 2069 6620 7365 6375 7269 7479 5072     if securityPr
+0000dbc0: 6f76 6964 6572 2e73 6563 7572 6974 795f  ovider.security_
+0000dbd0: 746f 6b65 6e20 6973 206e 6f74 204e 6f6e  token is not Non
+0000dbe0: 6520 616e 6420 7365 6c66 2e68 612e 7365  e and self.ha.se
+0000dbf0: 6375 7269 7479 5f74 6f6b 656e 5f68 6561  curity_token_hea
+0000dc00: 6465 7228 2920 6e6f 7420 696e 2066 6f72  der() not in for
+0000dc10: 6d50 6172 616d 733a 0a20 2020 2020 2020  mParams:.       
+0000dc20: 2020 2020 2066 6f72 6d50 6172 616d 735b       formParams[
+0000dc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dc40: 2073 656c 662e 6861 2e73 6563 7572 6974   self.ha.securit
+0000dc50: 795f 746f 6b65 6e5f 6865 6164 6572 2829  y_token_header()
+0000dc60: 5d20 3d20 7365 6375 7269 7479 5072 6f76  ] = securityProv
+0000dc70: 6964 6572 2e73 6563 7572 6974 795f 746f  ider.security_to
+0000dc80: 6b65 6e0a 0a20 2020 2020 2020 2069 6620  ken..        if 
+0000dc90: 6973 5f76 343a 0a20 2020 2020 2020 2020  is_v4:.         
+0000dca0: 2020 2066 6f72 6d50 6172 616d 735b 2758     formParams['X
+0000dcb0: 2d41 6d7a 2d41 6c67 6f72 6974 686d 275d  -Amz-Algorithm']
+0000dcc0: 203d 2027 4157 5334 2d48 4d41 432d 5348   = 'AWS4-HMAC-SH
+0000dcd0: 4132 3536 270a 2020 2020 2020 2020 2020  A256'.          
+0000dce0: 2020 666f 726d 5061 7261 6d73 5b27 582d    formParams['X-
+0000dcf0: 416d 7a2d 4461 7465 275d 203d 206c 6f6e  Amz-Date'] = lon
+0000dd00: 6744 6174 650a 2020 2020 2020 2020 2020  gDate.          
+0000dd10: 2020 666f 726d 5061 7261 6d73 5b27 582d    formParams['X-
+0000dd20: 416d 7a2d 4372 6564 656e 7469 616c 275d  Amz-Credential']
+0000dd30: 203d 2027 2573 2f25 732f 2573 2f73 332f   = '%s/%s/%s/s3/
+0000dd40: 6177 7334 5f72 6571 7565 7374 2720 2520  aws4_request' % 
+0000dd50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000dd60: 2020 7365 6375 7269 7479 5072 6f76 6964    securityProvid
+0000dd70: 6572 2e61 6363 6573 735f 6b65 795f 6964  er.access_key_id
+0000dd80: 2c20 7368 6f72 7444 6174 652c 2073 656c  , shortDate, sel
+0000dd90: 662e 7265 6769 6f6e 290a 0a20 2020 2020  f.region)..     
+0000dda0: 2020 2069 6620 6275 636b 6574 4e61 6d65     if bucketName
+0000ddb0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+0000ddc0: 726d 5061 7261 6d73 5b27 6275 636b 6574  rmParams['bucket
+0000ddd0: 275d 203d 2062 7563 6b65 744e 616d 650a  '] = bucketName.
+0000dde0: 0a20 2020 2020 2020 2069 6620 6f62 6a65  .        if obje
+0000ddf0: 6374 4b65 793a 0a20 2020 2020 2020 2020  ctKey:.         
+0000de00: 2020 2066 6f72 6d50 6172 616d 735b 276b     formParams['k
+0000de10: 6579 275d 203d 206f 626a 6563 744b 6579  ey'] = objectKey
+0000de20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000de30: 666f 726d 5061 7261 6d73 0a0a 2020 2020  formParams..    
+0000de40: 6465 6620 5f70 6172 7365 5f70 6f73 745f  def _parse_post_
+0000de50: 7369 676e 6174 7572 655f 7479 7065 2873  signature_type(s
+0000de60: 656c 662c 2069 735f 7634 2c20 7365 6375  elf, is_v4, secu
+0000de70: 7269 7479 5072 6f76 6964 6572 2c20 6f72  rityProvider, or
+0000de80: 6967 696e 506f 6c69 6379 2c20 706f 6c69  iginPolicy, poli
+0000de90: 6379 2c20 666f 726d 5061 7261 6d73 2c0a  cy, formParams,.
+0000dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dec0: 2020 2020 2073 686f 7274 4461 7465 2c20       shortDate, 
-0000ded0: 6c6f 6e67 4461 7465 293a 0a20 2020 2020  longDate):.     
-0000dee0: 2020 2069 6620 6973 5f76 343a 0a20 2020     if is_v4:.   
-0000def0: 2020 2020 2020 2020 2076 3441 7574 6820           v4Auth 
-0000df00: 3d20 6175 7468 2e56 3441 7574 6865 6e74  = auth.V4Authent
-0000df10: 6963 6174 696f 6e28 7365 6375 7269 7479  ication(security
-0000df20: 5072 6f76 6964 6572 2e61 6363 6573 735f  Provider.access_
-0000df30: 6b65 795f 6964 2c20 7365 6375 7269 7479  key_id, security
-0000df40: 5072 6f76 6964 6572 2e73 6563 7265 745f  Provider.secret_
-0000df50: 6163 6365 7373 5f6b 6579 2c0a 2020 2020  access_key,.    
+0000dec0: 2020 2073 686f 7274 4461 7465 2c20 6c6f     shortDate, lo
+0000ded0: 6e67 4461 7465 293a 0a20 2020 2020 2020  ngDate):.       
+0000dee0: 2069 6620 6973 5f76 343a 0a20 2020 2020   if is_v4:.     
+0000def0: 2020 2020 2020 2076 3441 7574 6820 3d20         v4Auth = 
+0000df00: 6175 7468 2e56 3441 7574 6865 6e74 6963  auth.V4Authentic
+0000df10: 6174 696f 6e28 7365 6375 7269 7479 5072  ation(securityPr
+0000df20: 6f76 6964 6572 2e61 6363 6573 735f 6b65  ovider.access_ke
+0000df30: 795f 6964 2c20 7365 6375 7269 7479 5072  y_id, securityPr
+0000df40: 6f76 6964 6572 2e73 6563 7265 745f 6163  ovider.secret_ac
+0000df50: 6365 7373 5f6b 6579 2c0a 2020 2020 2020  cess_key,.      
 0000df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000df70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df80: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
-0000df90: 6f6e 2c20 7368 6f72 7444 6174 652c 206c  on, shortDate, l
-0000dfa0: 6f6e 6744 6174 652c 0a20 2020 2020 2020  ongDate,.       
+0000df80: 2020 2020 2073 656c 662e 7265 6769 6f6e       self.region
+0000df90: 2c20 7368 6f72 7444 6174 652c 206c 6f6e  , shortDate, lon
+0000dfa0: 6744 6174 652c 0a20 2020 2020 2020 2020  gDate,.         
 0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfd0: 2020 2020 7365 6c66 2e70 6174 685f 7374      self.path_st
-0000dfe0: 796c 652c 2073 656c 662e 6861 290a 2020  yle, self.ha).  
-0000dff0: 2020 2020 2020 2020 2020 7369 676e 696e            signin
-0000e000: 674b 6579 203d 2076 3441 7574 682e 6765  gKey = v4Auth.ge
-0000e010: 7453 6967 6e69 6e67 4b65 795f 7079 7468  tSigningKey_pyth
-0000e020: 6f6e 3228 2920 6966 2063 6f6e 7374 2e49  on2() if const.I
-0000e030: 535f 5059 5448 4f4e 3220 656c 7365 2076  S_PYTHON2 else v
-0000e040: 3441 7574 682e 6765 7453 6967 6e69 6e67  4Auth.getSigning
-0000e050: 4b65 795f 7079 7468 6f6e 3328 290a 2020  Key_python3().  
-0000e060: 2020 2020 2020 2020 2020 7369 676e 6174            signat
-0000e070: 7572 6520 3d20 7634 4175 7468 2e68 6d61  ure = v4Auth.hma
-0000e080: 6353 6861 3235 3628 7369 676e 696e 674b  cSha256(signingK
-0000e090: 6579 2c20 706f 6c69 6379 2069 6620 636f  ey, policy if co
-0000e0a0: 6e73 742e 4953 5f50 5954 484f 4e32 2065  nst.IS_PYTHON2 e
-0000e0b0: 6c73 6520 706f 6c69 6379 2e65 6e63 6f64  lse policy.encod
-0000e0c0: 6528 2755 5446 2d38 2729 290a 2020 2020  e('UTF-8')).    
-0000e0d0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000e0e0: 207b 276f 7269 6769 6e50 6f6c 6963 7927   {'originPolicy'
-0000e0f0: 3a20 6f72 6967 696e 506f 6c69 6379 2c20  : originPolicy, 
-0000e100: 2770 6f6c 6963 7927 3a20 706f 6c69 6379  'policy': policy
-0000e110: 2c20 2761 6c67 6f72 6974 686d 273a 2066  , 'algorithm': f
-0000e120: 6f72 6d50 6172 616d 735b 2758 2d41 6d7a  ormParams['X-Amz
-0000e130: 2d41 6c67 6f72 6974 686d 275d 2c0a 2020  -Algorithm'],.  
+0000dfd0: 2020 7365 6c66 2e70 6174 685f 7374 796c    self.path_styl
+0000dfe0: 652c 2073 656c 662e 6861 290a 2020 2020  e, self.ha).    
+0000dff0: 2020 2020 2020 2020 7369 676e 696e 674b          signingK
+0000e000: 6579 203d 2076 3441 7574 682e 6765 7453  ey = v4Auth.getS
+0000e010: 6967 6e69 6e67 4b65 795f 7079 7468 6f6e  igningKey_python
+0000e020: 3228 2920 6966 2063 6f6e 7374 2e49 535f  2() if const.IS_
+0000e030: 5059 5448 4f4e 3220 656c 7365 2076 3441  PYTHON2 else v4A
+0000e040: 7574 682e 6765 7453 6967 6e69 6e67 4b65  uth.getSigningKe
+0000e050: 795f 7079 7468 6f6e 3328 290a 2020 2020  y_python3().    
+0000e060: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
+0000e070: 6520 3d20 7634 4175 7468 2e68 6d61 6353  e = v4Auth.hmacS
+0000e080: 6861 3235 3628 7369 676e 696e 674b 6579  ha256(signingKey
+0000e090: 2c20 706f 6c69 6379 2069 6620 636f 6e73  , policy if cons
+0000e0a0: 742e 4953 5f50 5954 484f 4e32 2065 6c73  t.IS_PYTHON2 els
+0000e0b0: 6520 706f 6c69 6379 2e65 6e63 6f64 6528  e policy.encode(
+0000e0c0: 2755 5446 2d38 2729 290a 2020 2020 2020  'UTF-8')).      
+0000e0d0: 2020 2020 2020 7265 7375 6c74 203d 207b        result = {
+0000e0e0: 276f 7269 6769 6e50 6f6c 6963 7927 3a20  'originPolicy': 
+0000e0f0: 6f72 6967 696e 506f 6c69 6379 2c20 2770  originPolicy, 'p
+0000e100: 6f6c 6963 7927 3a20 706f 6c69 6379 2c20  olicy': policy, 
+0000e110: 2761 6c67 6f72 6974 686d 273a 2066 6f72  'algorithm': for
+0000e120: 6d50 6172 616d 735b 2758 2d41 6d7a 2d41  mParams['X-Amz-A
+0000e130: 6c67 6f72 6974 686d 275d 2c0a 2020 2020  lgorithm'],.    
 0000e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e150: 2020 2020 2763 7265 6465 6e74 6961 6c27      'credential'
-0000e160: 3a20 666f 726d 5061 7261 6d73 5b27 582d  : formParams['X-
-0000e170: 416d 7a2d 4372 6564 656e 7469 616c 275d  Amz-Credential']
-0000e180: 2c20 2764 6174 6527 3a20 666f 726d 5061  , 'date': formPa
-0000e190: 7261 6d73 5b27 582d 416d 7a2d 4461 7465  rams['X-Amz-Date
-0000e1a0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-0000e1b0: 2020 2020 2020 2020 2020 2773 6967 6e61            'signa
-0000e1c0: 7475 7265 273a 2073 6967 6e61 7475 7265  ture': signature
-0000e1d0: 7d0a 2020 2020 2020 2020 656c 7365 3a0a  }.        else:.
-0000e1e0: 2020 2020 2020 2020 2020 2020 7632 4175              v2Au
-0000e1f0: 7468 203d 2061 7574 682e 4175 7468 656e  th = auth.Authen
-0000e200: 7469 6361 7469 6f6e 2873 6563 7572 6974  tication(securit
-0000e210: 7950 726f 7669 6465 722e 6163 6365 7373  yProvider.access
-0000e220: 5f6b 6579 5f69 642c 2073 6563 7572 6974  _key_id, securit
-0000e230: 7950 726f 7669 6465 722e 7365 6372 6574  yProvider.secret
-0000e240: 5f61 6363 6573 735f 6b65 792c 0a20 2020  _access_key,.   
+0000e150: 2020 2763 7265 6465 6e74 6961 6c27 3a20    'credential': 
+0000e160: 666f 726d 5061 7261 6d73 5b27 582d 416d  formParams['X-Am
+0000e170: 7a2d 4372 6564 656e 7469 616c 275d 2c20  z-Credential'], 
+0000e180: 2764 6174 6527 3a20 666f 726d 5061 7261  'date': formPara
+0000e190: 6d73 5b27 582d 416d 7a2d 4461 7465 275d  ms['X-Amz-Date']
+0000e1a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e1b0: 2020 2020 2020 2020 2773 6967 6e61 7475          'signatu
+0000e1c0: 7265 273a 2073 6967 6e61 7475 7265 7d0a  re': signature}.
+0000e1d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000e1e0: 2020 2020 2020 2020 2020 7632 4175 7468            v2Auth
+0000e1f0: 203d 2061 7574 682e 4175 7468 656e 7469   = auth.Authenti
+0000e200: 6361 7469 6f6e 2873 6563 7572 6974 7950  cation(securityP
+0000e210: 726f 7669 6465 722e 6163 6365 7373 5f6b  rovider.access_k
+0000e220: 6579 5f69 642c 2073 6563 7572 6974 7950  ey_id, securityP
+0000e230: 726f 7669 6465 722e 7365 6372 6574 5f61  rovider.secret_a
+0000e240: 6363 6573 735f 6b65 792c 0a20 2020 2020  ccess_key,.     
 0000e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e270: 2020 2020 2020 7365 6c66 2e70 6174 685f        self.path_
-0000e280: 7374 796c 652c 2073 656c 662e 6861 2c20  style, self.ha, 
-0000e290: 7365 6c66 2e73 6572 7665 722c 2073 656c  self.server, sel
-0000e2a0: 662e 6973 5f63 6e61 6d65 290a 2020 2020  f.is_cname).    
-0000e2b0: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
-0000e2c0: 6520 3d20 7632 4175 7468 2e68 6d61 6353  e = v2Auth.hmacS
-0000e2d0: 6861 3132 3828 706f 6c69 6379 290a 2020  ha128(policy).  
-0000e2e0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0000e2f0: 203d 207b 276f 7269 6769 6e50 6f6c 6963   = {'originPolic
-0000e300: 7927 3a20 6f72 6967 696e 506f 6c69 6379  y': originPolicy
-0000e310: 2c20 2770 6f6c 6963 7927 3a20 706f 6c69  , 'policy': poli
-0000e320: 6379 2c20 2773 6967 6e61 7475 7265 273a  cy, 'signature':
-0000e330: 2073 6967 6e61 7475 7265 2c0a 2020 2020   signature,.    
+0000e270: 2020 2020 7365 6c66 2e70 6174 685f 7374      self.path_st
+0000e280: 796c 652c 2073 656c 662e 6861 2c20 7365  yle, self.ha, se
+0000e290: 6c66 2e73 6572 7665 722c 2073 656c 662e  lf.server, self.
+0000e2a0: 6973 5f63 6e61 6d65 290a 2020 2020 2020  is_cname).      
+0000e2b0: 2020 2020 2020 7369 676e 6174 7572 6520        signature 
+0000e2c0: 3d20 7632 4175 7468 2e68 6d61 6353 6861  = v2Auth.hmacSha
+0000e2d0: 3132 3828 706f 6c69 6379 290a 2020 2020  128(policy).    
+0000e2e0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0000e2f0: 207b 276f 7269 6769 6e50 6f6c 6963 7927   {'originPolicy'
+0000e300: 3a20 6f72 6967 696e 506f 6c69 6379 2c20  : originPolicy, 
+0000e310: 2770 6f6c 6963 7927 3a20 706f 6c69 6379  'policy': policy
+0000e320: 2c20 2773 6967 6e61 7475 7265 273a 2073  , 'signature': s
+0000e330: 6967 6e61 7475 7265 2c0a 2020 2020 2020  ignature,.      
 0000e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e350: 2020 2761 6363 6573 734b 6579 4964 273a    'accessKeyId':
-0000e360: 2073 6563 7572 6974 7950 726f 7669 6465   securityProvide
-0000e370: 722e 6163 6365 7373 5f6b 6579 5f69 647d  r.access_key_id}
-0000e380: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000e390: 7265 7375 6c74 0a0a 2020 2020 6465 6620  result..    def 
-0000e3a0: 6275 636b 6574 436c 6965 6e74 2873 656c  bucketClient(sel
-0000e3b0: 662c 2062 7563 6b65 744e 616d 6529 3a0a  f, bucketName):.
-0000e3c0: 2020 2020 2020 2020 7265 7475 726e 2042          return B
-0000e3d0: 7563 6b65 7443 6c69 656e 7428 7365 6c66  ucketClient(self
-0000e3e0: 2c20 6275 636b 6574 4e61 6d65 290a 0a20  , bucketName).. 
-0000e3f0: 2020 2064 6566 205f 6765 7441 7069 5665     def _getApiVe
-0000e400: 7273 696f 6e28 7365 6c66 2c20 6275 636b  rsion(self, buck
-0000e410: 6574 4e61 6d65 3d27 2729 3a0a 2020 2020  etName=''):.    
-0000e420: 2020 2020 7265 7320 3d20 7365 6c66 2e5f      res = self._
-0000e430: 6d61 6b65 5f68 6561 645f 7265 7175 6573  make_head_reques
-0000e440: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
-0000e450: 7468 4172 6773 3d7b 2761 7069 7665 7273  thArgs={'apivers
-0000e460: 696f 6e27 3a20 4e6f 6e65 7d2c 2073 6b69  ion': None}, ski
-0000e470: 7041 7574 6865 6e74 6963 6174 696f 6e3d  pAuthentication=
-0000e480: 5472 7565 290a 2020 2020 2020 2020 6966  True).        if
-0000e490: 2072 6573 2e73 7461 7475 7320 3e3d 2035   res.status >= 5
-0000e4a0: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
-0000e4b0: 203d 3d20 3430 343a 0a20 2020 2020 2020   == 404:.       
-0000e4c0: 2020 2020 2072 6574 7572 6e20 2727 2c20       return '', 
-0000e4d0: 7265 730a 2020 2020 2020 2020 6966 206e  res.        if n
-0000e4e0: 6f74 2068 6173 6174 7472 2872 6573 2c20  ot hasattr(res, 
-0000e4f0: 2768 6561 6465 7227 293a 0a20 2020 2020  'header'):.     
-0000e500: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-0000e510: 6e73 742e 5632 5f53 4947 4e41 5455 5245  nst.V2_SIGNATURE
-0000e520: 2c20 7265 730a 2020 2020 2020 2020 6865  , res.        he
-0000e530: 6164 6572 203d 2064 6963 7428 7265 732e  ader = dict(res.
-0000e540: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
-0000e550: 6966 2068 6561 6465 722e 6765 7428 2761  if header.get('a
-0000e560: 7069 272c 2027 302e 3027 2920 3e3d 2027  pi', '0.0') >= '
-0000e570: 332e 3027 206f 7220 6865 6164 6572 2e67  3.0' or header.g
-0000e580: 6574 2827 782d 6f62 732d 6170 6927 2c20  et('x-obs-api', 
-0000e590: 2730 2e30 2729 203e 3d20 2733 2e30 273a  '0.0') >= '3.0':
-0000e5a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000e5b0: 7572 6e20 636f 6e73 742e 4f42 535f 5349  urn const.OBS_SI
-0000e5c0: 474e 4154 5552 452c 2072 6573 0a20 2020  GNATURE, res.   
-0000e5d0: 2020 2020 2072 6574 7572 6e20 636f 6e73       return cons
-0000e5e0: 742e 5632 5f53 4947 4e41 5455 5245 2c20  t.V2_SIGNATURE, 
-0000e5f0: 7265 730a 0a20 2020 2040 6675 6e63 4361  res..    @funcCa
-0000e600: 6368 650a 2020 2020 6465 6620 6c69 7374  che.    def list
-0000e610: 4275 636b 6574 7328 7365 6c66 2c20 6973  Buckets(self, is
-0000e620: 5175 6572 794c 6f63 6174 696f 6e3d 5472  QueryLocation=Tr
-0000e630: 7565 2c20 6578 7465 6e73 696f 6e48 6561  ue, extensionHea
-0000e640: 6465 7273 3d4e 6f6e 652c 2062 7563 6b65  ders=None, bucke
-0000e650: 7454 7970 653d 4e6f 6e65 293a 0a20 2020  tType=None):.   
-0000e660: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e670: 204f 6274 6169 6e20 6120 6275 636b 6574   Obtain a bucket
-0000e680: 206c 6973 742e 0a20 2020 2020 2020 203a   list..        :
-0000e690: 7061 7261 6d20 6973 5175 6572 794c 6f63  param isQueryLoc
-0000e6a0: 6174 696f 6e3a 2057 6865 7468 6572 2074  ation: Whether t
-0000e6b0: 6f20 7175 6572 7920 7468 6520 6275 636b  o query the buck
-0000e6c0: 6574 206c 6f63 6174 696f 6e2e 0a20 2020  et location..   
-0000e6d0: 2020 2020 203a 7061 7261 6d20 6578 7465       :param exte
-0000e6e0: 6e73 696f 6e48 6561 6465 7273 3a20 4f74  nsionHeaders: Ot
-0000e6f0: 6865 7220 6865 6164 6572 730a 2020 2020  her headers.    
-0000e700: 2020 2020 3a70 6172 616d 2062 7563 6b65      :param bucke
-0000e710: 7454 7970 653a 2054 7970 6520 6f66 2074  tType: Type of t
-0000e720: 6865 2062 7563 6b65 7473 2079 6f75 2077  he buckets you w
-0000e730: 616e 7420 746f 206c 6973 742e 2054 6865  ant to list. The
-0000e740: 2076 616c 7565 2063 616e 2062 6520 4f42   value can be OB
-0000e750: 4a45 4354 206f 7220 504f 5349 582c 206f  JECT or POSIX, o
-0000e760: 7220 6265 206c 6566 7420 626c 616e 6b2e  r be left blank.
-0000e770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e780: 224f 424a 4543 5422 3a20 546f 206c 6973  "OBJECT": To lis
-0000e790: 7420 636f 6d6d 6f6e 2062 7563 6b65 7473  t common buckets
-0000e7a0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e7b0: 2022 504f 5349 5822 3a20 546f 206c 6973   "POSIX": To lis
-0000e7c0: 7420 7061 7261 6c6c 656c 2066 696c 6520  t parallel file 
-0000e7d0: 7379 7374 656d 732e 0a20 2020 2020 2020  systems..       
-0000e7e0: 2020 2020 2020 2020 2049 6620 7468 6973           If this
-0000e7f0: 2070 6172 616d 6574 6572 2069 7320 6c65   parameter is le
-0000e800: 6674 2062 6c61 6e6b 2c20 626f 7468 2062  ft blank, both b
-0000e810: 7563 6b65 7473 2061 6e64 2070 6172 616c  uckets and paral
-0000e820: 6c65 6c20 6669 6c65 2073 7973 7465 6d73  lel file systems
-0000e830: 2077 696c 6c20 6265 206c 6973 7465 642e   will be listed.
-0000e840: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0000e850: 3a20 4120 6275 636b 6574 206c 6973 740a  : A bucket list.
-0000e860: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000e870: 2020 2020 6966 2073 656c 662e 6973 5f63      if self.is_c
-0000e880: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-0000e890: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-0000e8a0: 6e28 276c 6973 7442 7563 6b65 7473 2069  n('listBuckets i
-0000e8b0: 7320 6e6f 7420 616c 6c6f 7765 6420 696e  s not allowed in
-0000e8c0: 2063 7573 746f 6d20 646f 6d61 696e 206d   custom domain m
-0000e8d0: 6f64 6527 290a 2020 2020 2020 2020 7265  ode').        re
-0000e8e0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-0000e8f0: 6765 745f 7265 7175 6573 7428 6d65 7468  get_request(meth
-0000e900: 6f64 4e61 6d65 3d27 6c69 7374 4275 636b  odName='listBuck
-0000e910: 6574 7327 2c20 6578 7465 6e73 696f 6e48  ets', extensionH
-0000e920: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
-0000e930: 4865 6164 6572 732c 0a20 2020 2020 2020  Headers,.       
-0000e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e950: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0000e960: 2a73 656c 662e 636f 6e76 6572 746f 722e  *self.convertor.
-0000e970: 7472 616e 735f 6c69 7374 5f62 7563 6b65  trans_list_bucke
-0000e980: 7473 2869 7351 7565 7279 4c6f 6361 7469  ts(isQueryLocati
-0000e990: 6f6e 3d69 7351 7565 7279 4c6f 6361 7469  on=isQueryLocati
-0000e9a0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0000e350: 2761 6363 6573 734b 6579 4964 273a 2073  'accessKeyId': s
+0000e360: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
+0000e370: 6163 6365 7373 5f6b 6579 5f69 647d 0a20  access_key_id}. 
+0000e380: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000e390: 7375 6c74 0a0a 2020 2020 6465 6620 6275  sult..    def bu
+0000e3a0: 636b 6574 436c 6965 6e74 2873 656c 662c  cketClient(self,
+0000e3b0: 2062 7563 6b65 744e 616d 6529 3a0a 2020   bucketName):.  
+0000e3c0: 2020 2020 2020 7265 7475 726e 2042 7563        return Buc
+0000e3d0: 6b65 7443 6c69 656e 7428 7365 6c66 2c20  ketClient(self, 
+0000e3e0: 6275 636b 6574 4e61 6d65 290a 0a20 2020  bucketName)..   
+0000e3f0: 2064 6566 205f 6765 7441 7069 5665 7273   def _getApiVers
+0000e400: 696f 6e28 7365 6c66 2c20 6275 636b 6574  ion(self, bucket
+0000e410: 4e61 6d65 3d27 2729 3a0a 2020 2020 2020  Name=''):.      
+0000e420: 2020 7265 7320 3d20 7365 6c66 2e5f 6d61    res = self._ma
+0000e430: 6b65 5f68 6561 645f 7265 7175 6573 7428  ke_head_request(
+0000e440: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
+0000e450: 4172 6773 3d7b 2761 7069 7665 7273 696f  Args={'apiversio
+0000e460: 6e27 3a20 4e6f 6e65 7d2c 2073 6b69 7041  n': None}, skipA
+0000e470: 7574 6865 6e74 6963 6174 696f 6e3d 5472  uthentication=Tr
+0000e480: 7565 290a 2020 2020 2020 2020 6966 2072  ue).        if r
+0000e490: 6573 2e73 7461 7475 7320 3e3d 2035 3030  es.status >= 500
+0000e4a0: 206f 7220 7265 732e 7374 6174 7573 203d   or res.status =
+0000e4b0: 3d20 3430 343a 0a20 2020 2020 2020 2020  = 404:.         
+0000e4c0: 2020 2072 6574 7572 6e20 2727 2c20 7265     return '', re
+0000e4d0: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
+0000e4e0: 2068 6173 6174 7472 2872 6573 2c20 2768   hasattr(res, 'h
+0000e4f0: 6561 6465 7227 293a 0a20 2020 2020 2020  eader'):.       
+0000e500: 2020 2020 2072 6574 7572 6e20 636f 6e73       return cons
+0000e510: 742e 5632 5f53 4947 4e41 5455 5245 2c20  t.V2_SIGNATURE, 
+0000e520: 7265 730a 2020 2020 2020 2020 6865 6164  res.        head
+0000e530: 6572 203d 2064 6963 7428 7265 732e 6865  er = dict(res.he
+0000e540: 6164 6572 290a 2020 2020 2020 2020 6966  ader).        if
+0000e550: 2068 6561 6465 722e 6765 7428 2761 7069   header.get('api
+0000e560: 272c 2027 302e 3027 2920 3e3d 2027 332e  ', '0.0') >= '3.
+0000e570: 3027 206f 7220 6865 6164 6572 2e67 6574  0' or header.get
+0000e580: 2827 782d 6f62 732d 6170 6927 2c20 2730  ('x-obs-api', '0
+0000e590: 2e30 2729 203e 3d20 2733 2e30 273a 0a20  .0') >= '3.0':. 
+0000e5a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000e5b0: 6e20 636f 6e73 742e 4f42 535f 5349 474e  n const.OBS_SIGN
+0000e5c0: 4154 5552 452c 2072 6573 0a20 2020 2020  ATURE, res.     
+0000e5d0: 2020 2072 6574 7572 6e20 636f 6e73 742e     return const.
+0000e5e0: 5632 5f53 4947 4e41 5455 5245 2c20 7265  V2_SIGNATURE, re
+0000e5f0: 730a 0a20 2020 2040 6675 6e63 4361 6368  s..    @funcCach
+0000e600: 650a 2020 2020 6465 6620 6c69 7374 4275  e.    def listBu
+0000e610: 636b 6574 7328 7365 6c66 2c20 6973 5175  ckets(self, isQu
+0000e620: 6572 794c 6f63 6174 696f 6e3d 5472 7565  eryLocation=True
+0000e630: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0000e640: 7273 3d4e 6f6e 652c 2062 7563 6b65 7454  rs=None, bucketT
+0000e650: 7970 653d 4e6f 6e65 2c20 6d61 784b 6579  ype=None, maxKey
+0000e660: 733d 3130 302c 206d 6172 6b65 723d 4e6f  s=100, marker=No
+0000e670: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+0000e680: 0a20 2020 2020 2020 204f 6274 6169 6e20  .        Obtain 
+0000e690: 6120 6275 636b 6574 206c 6973 742e 0a20  a bucket list.. 
+0000e6a0: 2020 2020 2020 203a 7061 7261 6d20 6973         :param is
+0000e6b0: 5175 6572 794c 6f63 6174 696f 6e3a 2057  QueryLocation: W
+0000e6c0: 6865 7468 6572 2074 6f20 7175 6572 7920  hether to query 
+0000e6d0: 7468 6520 6275 636b 6574 206c 6f63 6174  the bucket locat
+0000e6e0: 696f 6e2e 0a20 2020 2020 2020 203a 7061  ion..        :pa
+0000e6f0: 7261 6d20 6578 7465 6e73 696f 6e48 6561  ram extensionHea
+0000e700: 6465 7273 3a20 4f74 6865 7220 6865 6164  ders: Other head
+0000e710: 6572 730a 2020 2020 2020 2020 3a70 6172  ers.        :par
+0000e720: 616d 2062 7563 6b65 7454 7970 653a 2054  am bucketType: T
+0000e730: 7970 6520 6f66 2074 6865 2062 7563 6b65  ype of the bucke
+0000e740: 7473 2079 6f75 2077 616e 7420 746f 206c  ts you want to l
+0000e750: 6973 742e 2054 6865 2076 616c 7565 2063  ist. The value c
+0000e760: 616e 2062 6520 4f42 4a45 4354 206f 7220  an be OBJECT or 
+0000e770: 504f 5349 582c 206f 7220 6265 206c 6566  POSIX, or be lef
+0000e780: 7420 626c 616e 6b2e 0a20 2020 2020 2020  t blank..       
+0000e790: 2020 2020 2020 2020 224f 424a 4543 5422          "OBJECT"
+0000e7a0: 3a20 546f 206c 6973 7420 636f 6d6d 6f6e  : To list common
+0000e7b0: 2062 7563 6b65 7473 2e0a 2020 2020 2020   buckets..      
+0000e7c0: 2020 2020 2020 2020 2022 504f 5349 5822           "POSIX"
+0000e7d0: 3a20 546f 206c 6973 7420 7061 7261 6c6c  : To list parall
+0000e7e0: 656c 2066 696c 6520 7379 7374 656d 732e  el file systems.
+0000e7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e800: 2049 6620 7468 6973 2070 6172 616d 6574   If this paramet
+0000e810: 6572 2069 7320 6c65 6674 2062 6c61 6e6b  er is left blank
+0000e820: 2c20 626f 7468 2062 7563 6b65 7473 2061  , both buckets a
+0000e830: 6e64 2070 6172 616c 6c65 6c20 6669 6c65  nd parallel file
+0000e840: 2073 7973 7465 6d73 2077 696c 6c20 6265   systems will be
+0000e850: 206c 6973 7465 642e 0a20 2020 2020 2020   listed..       
+0000e860: 203a 7265 7475 726e 3a20 4120 6275 636b   :return: A buck
+0000e870: 6574 206c 6973 740a 2020 2020 2020 2020  et list.        
+0000e880: 2222 220a 2020 2020 2020 2020 7061 7468  """.        path
+0000e890: 4172 6773 203d 207b 276d 6172 6b65 7227  Args = {'marker'
+0000e8a0: 3a6d 6172 6b65 722c 2027 6d61 782d 6b65  :marker, 'max-ke
+0000e8b0: 7973 273a 6d61 784b 6579 737d 0a20 2020  ys':maxKeys}.   
+0000e8c0: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+0000e8d0: 636e 616d 653a 0a20 2020 2020 2020 2020  cname:.         
+0000e8e0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+0000e8f0: 6f6e 2827 6c69 7374 4275 636b 6574 7320  on('listBuckets 
+0000e900: 6973 206e 6f74 2061 6c6c 6f77 6564 2069  is not allowed i
+0000e910: 6e20 6375 7374 6f6d 2064 6f6d 6169 6e20  n custom domain 
+0000e920: 6d6f 6465 2729 0a20 2020 2020 2020 2072  mode').        r
+0000e930: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+0000e940: 5f67 6574 5f72 6571 7565 7374 286d 6574  _get_request(met
+0000e950: 686f 644e 616d 653d 276c 6973 7442 7563  hodName='listBuc
+0000e960: 6b65 7473 272c 2070 6174 6841 7267 733d  kets', pathArgs=
+0000e970: 7061 7468 4172 6773 2c20 6578 7465 6e73  pathArgs, extens
+0000e980: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+0000e990: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
+0000e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9e0: 2020 2020 2020 2020 2020 2020 2020 6275                bu
-0000e9f0: 636b 6574 5479 7065 3d62 7563 6b65 7454  cketType=bucketT
-0000ea00: 7970 6529 290a 0a20 2020 2040 6675 6e63  ype))..    @func
-0000ea10: 4361 6368 650a 2020 2020 6465 6620 6372  Cache.    def cr
-0000ea20: 6561 7465 4275 636b 6574 2873 656c 662c  eateBucket(self,
-0000ea30: 2062 7563 6b65 744e 616d 652c 2068 6561   bucketName, hea
-0000ea40: 6465 723d 4e6f 6e65 2c20 6c6f 6361 7469  der=None, locati
-0000ea50: 6f6e 3d4e 6f6e 652c 2065 7874 656e 7369  on=None, extensi
-0000ea60: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-0000ea70: 0a20 2020 2020 2020 2069 6620 6865 6164  .        if head
-0000ea80: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-0000ea90: 2020 2020 2020 2020 6865 6164 6572 203d          header =
-0000eaa0: 2043 7265 6174 6542 7563 6b65 7448 6561   CreateBucketHea
-0000eab0: 6465 7228 290a 2020 2020 2020 2020 6966  der().        if
-0000eac0: 2073 656c 662e 6973 5f63 6e61 6d65 3a0a   self.is_cname:.
-0000ead0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000eae0: 6520 4578 6365 7074 696f 6e28 2763 7265  e Exception('cre
-0000eaf0: 6174 6542 7563 6b65 7420 6973 206e 6f74  ateBucket is not
-0000eb00: 2061 6c6c 6f77 6564 2069 6e20 6375 7374   allowed in cust
-0000eb10: 6f6d 2064 6f6d 6169 6e20 6d6f 6465 2729  om domain mode')
-0000eb20: 0a20 2020 2020 2020 2072 6573 203d 2073  .        res = s
-0000eb30: 656c 662e 5f6d 616b 655f 7075 745f 7265  elf._make_put_re
-0000eb40: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
-0000eb50: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-0000eb60: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-0000eb70: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
-0000eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb90: 2020 2020 2020 2020 2020 2a2a 7365 6c66            **self
-0000eba0: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
-0000ebb0: 5f63 7265 6174 655f 6275 636b 6574 2868  _create_bucket(h
-0000ebc0: 6561 6465 723d 6865 6164 6572 2c20 6c6f  eader=header, lo
-0000ebd0: 6361 7469 6f6e 3d6c 6f63 6174 696f 6e29  cation=location)
-0000ebe0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-0000ebf0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0000ec00: 6c66 2e69 735f 7369 676e 6174 7572 655f  lf.is_signature_
-0000ec10: 6e65 676f 7469 6174 696f 6e20 616e 6420  negotiation and 
-0000ec20: 7265 732e 7374 6174 7573 203d 3d20 3430  res.status == 40
-0000ec30: 3020 616e 6420 5c0a 2020 2020 2020 2020  0 and \.        
-0000ec40: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-0000ec50: 6572 726f 724d 6573 7361 6765 203d 3d20  errorMessage == 
-0000ec60: 2755 6e73 7570 706f 7274 6564 2041 7574  'Unsupported Aut
-0000ec70: 686f 7269 7a61 7469 6f6e 2054 7970 6527  horization Type'
-0000ec80: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-0000ec90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000eca0: 7468 7265 6164 5f6c 6f63 616c 2e73 6967  thread_local.sig
-0000ecb0: 6e61 7475 7265 203d 3d20 636f 6e73 742e  nature == const.
-0000ecc0: 4f42 535f 5349 474e 4154 5552 453a 0a20  OBS_SIGNATURE:. 
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ece0: 656c 662e 7468 7265 6164 5f6c 6f63 616c  elf.thread_local
-0000ecf0: 2e73 6967 6e61 7475 7265 203d 2063 6f6e  .signature = con
-0000ed00: 7374 2e56 325f 5349 474e 4154 5552 450a  st.V2_SIGNATURE.
-0000ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed20: 7265 7320 3d20 7365 6c66 2e5f 6d61 6b65  res = self._make
-0000ed30: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
-0000ed40: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-0000ed50: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-0000ed60: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
-0000ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed90: 2020 2020 2020 2020 202a 2a73 656c 662e           **self.
-0000eda0: 636f 6e76 6572 746f 722e 7472 616e 735f  convertor.trans_
-0000edb0: 6372 6561 7465 5f62 7563 6b65 7428 6865  create_bucket(he
-0000edc0: 6164 6572 3d68 6561 6465 722c 206c 6f63  ader=header, loc
-0000edd0: 6174 696f 6e3d 6c6f 6361 7469 6f6e 2929  ation=location))
-0000ede0: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
-0000edf0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000ee00: 7475 726e 2072 6573 0a0a 2020 2020 4066  turn res..    @f
-0000ee10: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-0000ee20: 206c 6973 744f 626a 6563 7473 2873 656c   listObjects(sel
-0000ee30: 662c 2062 7563 6b65 744e 616d 652c 2070  f, bucketName, p
-0000ee40: 7265 6669 783d 4e6f 6e65 2c20 6d61 726b  refix=None, mark
-0000ee50: 6572 3d4e 6f6e 652c 206d 6178 5f6b 6579  er=None, max_key
-0000ee60: 733d 4e6f 6e65 2c20 6465 6c69 6d69 7465  s=None, delimite
-0000ee70: 723d 4e6f 6e65 2c0a 2020 2020 2020 2020  r=None,.        
-0000ee80: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-0000ee90: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-0000eea0: 652c 2065 6e63 6f64 696e 675f 7479 7065  e, encoding_type
-0000eeb0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0000eec0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-0000eed0: 655f 6765 745f 7265 7175 6573 7428 6275  e_get_request(bu
-0000eee0: 636b 6574 4e61 6d65 2c20 6d65 7468 6f64  cketName, method
-0000eef0: 4e61 6d65 3d27 6c69 7374 4f62 6a65 6374  Name='listObject
-0000ef00: 7327 2c20 6578 7465 6e73 696f 6e48 6561  s', extensionHea
-0000ef10: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-0000ef20: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
-0000ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef40: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
-0000ef50: 656c 662e 636f 6e76 6572 746f 722e 7472  elf.convertor.tr
-0000ef60: 616e 735f 6c69 7374 5f6f 626a 6563 7473  ans_list_objects
-0000ef70: 2870 7265 6669 783d 7072 6566 6978 2c20  (prefix=prefix, 
-0000ef80: 6d61 726b 6572 3d6d 6172 6b65 722c 0a20  marker=marker,. 
+0000e9c0: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
+0000e9d0: 746f 722e 7472 616e 735f 6c69 7374 5f62  tor.trans_list_b
+0000e9e0: 7563 6b65 7473 2869 7351 7565 7279 4c6f  uckets(isQueryLo
+0000e9f0: 6361 7469 6f6e 3d69 7351 7565 7279 4c6f  cation=isQueryLo
+0000ea00: 6361 7469 6f6e 2c0a 2020 2020 2020 2020  cation,.        
+0000ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea50: 2020 6275 636b 6574 5479 7065 3d62 7563    bucketType=buc
+0000ea60: 6b65 7454 7970 6529 290a 0a20 2020 2040  ketType))..    @
+0000ea70: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+0000ea80: 6620 6372 6561 7465 4275 636b 6574 2873  f createBucket(s
+0000ea90: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+0000eaa0: 2068 6561 6465 723d 4e6f 6e65 2c20 6c6f   header=None, lo
+0000eab0: 6361 7469 6f6e 3d4e 6f6e 652c 2065 7874  cation=None, ext
+0000eac0: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+0000ead0: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
+0000eae0: 6865 6164 6572 2069 7320 4e6f 6e65 3a0a  header is None:.
+0000eaf0: 2020 2020 2020 2020 2020 2020 6865 6164              head
+0000eb00: 6572 203d 2043 7265 6174 6542 7563 6b65  er = CreateBucke
+0000eb10: 7448 6561 6465 7228 290a 2020 2020 2020  tHeader().      
+0000eb20: 2020 6966 2073 656c 662e 6973 5f63 6e61    if self.is_cna
+0000eb30: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0000eb40: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+0000eb50: 2763 7265 6174 6542 7563 6b65 7420 6973  'createBucket is
+0000eb60: 206e 6f74 2061 6c6c 6f77 6564 2069 6e20   not allowed in 
+0000eb70: 6375 7374 6f6d 2064 6f6d 6169 6e20 6d6f  custom domain mo
+0000eb80: 6465 2729 0a20 2020 2020 2020 2072 6573  de').        res
+0000eb90: 203d 2073 656c 662e 5f6d 616b 655f 7075   = self._make_pu
+0000eba0: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
+0000ebb0: 4e61 6d65 2c20 6578 7465 6e73 696f 6e48  Name, extensionH
+0000ebc0: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0000ebd0: 4865 6164 6572 732c 0a20 2020 2020 2020  Headers,.       
+0000ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ebf0: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
+0000ec00: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e74  self.convertor.t
+0000ec10: 7261 6e73 5f63 7265 6174 655f 6275 636b  rans_create_buck
+0000ec20: 6574 2868 6561 6465 723d 6865 6164 6572  et(header=header
+0000ec30: 2c20 6c6f 6361 7469 6f6e 3d6c 6f63 6174  , location=locat
+0000ec40: 696f 6e29 290a 2020 2020 2020 2020 7472  ion)).        tr
+0000ec50: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
+0000ec60: 6620 7365 6c66 2e69 735f 7369 676e 6174  f self.is_signat
+0000ec70: 7572 655f 6e65 676f 7469 6174 696f 6e20  ure_negotiation 
+0000ec80: 616e 6420 7265 732e 7374 6174 7573 203d  and res.status =
+0000ec90: 3d20 3430 3020 616e 6420 5c0a 2020 2020  = 400 and \.    
+0000eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecb0: 7265 732e 6572 726f 724d 6573 7361 6765  res.errorMessage
+0000ecc0: 203d 3d20 2755 6e73 7570 706f 7274 6564   == 'Unsupported
+0000ecd0: 2041 7574 686f 7269 7a61 7469 6f6e 2054   Authorization T
+0000ece0: 7970 6527 2061 6e64 205c 0a20 2020 2020  ype' and \.     
+0000ecf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ed00: 656c 662e 7468 7265 6164 5f6c 6f63 616c  elf.thread_local
+0000ed10: 2e73 6967 6e61 7475 7265 203d 3d20 636f  .signature == co
+0000ed20: 6e73 742e 4f42 535f 5349 474e 4154 5552  nst.OBS_SIGNATUR
+0000ed30: 453a 0a20 2020 2020 2020 2020 2020 2020  E:.             
+0000ed40: 2020 2073 656c 662e 7468 7265 6164 5f6c     self.thread_l
+0000ed50: 6f63 616c 2e73 6967 6e61 7475 7265 203d  ocal.signature =
+0000ed60: 2063 6f6e 7374 2e56 325f 5349 474e 4154   const.V2_SIGNAT
+0000ed70: 5552 450a 2020 2020 2020 2020 2020 2020  URE.            
+0000ed80: 2020 2020 7265 7320 3d20 7365 6c66 2e5f      res = self._
+0000ed90: 6d61 6b65 5f70 7574 5f72 6571 7565 7374  make_put_request
+0000eda0: 2862 7563 6b65 744e 616d 652c 2065 7874  (bucketName, ext
+0000edb0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+0000edc0: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
+0000edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edf0: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+0000ee00: 656c 662e 636f 6e76 6572 746f 722e 7472  elf.convertor.tr
+0000ee10: 616e 735f 6372 6561 7465 5f62 7563 6b65  ans_create_bucke
+0000ee20: 7428 6865 6164 6572 3d68 6561 6465 722c  t(header=header,
+0000ee30: 206c 6f63 6174 696f 6e3d 6c6f 6361 7469   location=locati
+0000ee40: 6f6e 2929 0a20 2020 2020 2020 2066 696e  on)).        fin
+0000ee50: 616c 6c79 3a0a 2020 2020 2020 2020 2020  ally:.          
+0000ee60: 2020 7265 7475 726e 2072 6573 0a0a 2020    return res..  
+0000ee70: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+0000ee80: 2064 6566 206c 6973 744f 626a 6563 7473   def listObjects
+0000ee90: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+0000eea0: 652c 2070 7265 6669 783d 4e6f 6e65 2c20  e, prefix=None, 
+0000eeb0: 6d61 726b 6572 3d4e 6f6e 652c 206d 6178  marker=None, max
+0000eec0: 5f6b 6579 733d 4e6f 6e65 2c20 6465 6c69  _keys=None, deli
+0000eed0: 6d69 7465 723d 4e6f 6e65 2c0a 2020 2020  miter=None,.    
+0000eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eef0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0000ef00: 3d4e 6f6e 652c 2065 6e63 6f64 696e 675f  =None, encoding_
+0000ef10: 7479 7065 3d4e 6f6e 6529 3a0a 2020 2020  type=None):.    
+0000ef20: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000ef30: 5f6d 616b 655f 6765 745f 7265 7175 6573  _make_get_reques
+0000ef40: 7428 6275 636b 6574 4e61 6d65 2c20 6d65  t(bucketName, me
+0000ef50: 7468 6f64 4e61 6d65 3d27 6c69 7374 4f62  thodName='listOb
+0000ef60: 6a65 6374 7327 2c20 6578 7465 6e73 696f  jects', extensio
+0000ef70: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+0000ef80: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
 0000ef90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efd0: 2020 2020 2020 2020 206d 6178 5f6b 6579           max_key
-0000efe0: 733d 6d61 785f 6b65 7973 2c20 6465 6c69  s=max_keys, deli
-0000eff0: 6d69 7465 723d 6465 6c69 6d69 7465 722c  miter=delimiter,
-0000f000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000efb0: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
+0000efc0: 722e 7472 616e 735f 6c69 7374 5f6f 626a  r.trans_list_obj
+0000efd0: 6563 7473 2870 7265 6669 783d 7072 6566  ects(prefix=pref
+0000efe0: 6978 2c20 6d61 726b 6572 3d6d 6172 6b65  ix, marker=marke
+0000eff0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0000f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f040: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-0000f050: 696e 675f 7479 7065 3d65 6e63 6f64 696e  ing_type=encodin
-0000f060: 675f 7479 7065 2929 0a0a 2020 2020 4066  g_type))..    @f
-0000f070: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-0000f080: 2068 6561 6442 7563 6b65 7428 7365 6c66   headBucket(self
-0000f090: 2c20 6275 636b 6574 4e61 6d65 2c20 6578  , bucketName, ex
-0000f0a0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-0000f0b0: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
-0000f0c0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-0000f0d0: 6865 6164 5f72 6571 7565 7374 2862 7563  head_request(buc
-0000f0e0: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-0000f0f0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-0000f100: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
-0000f110: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-0000f120: 6465 6620 6865 6164 4f62 6a65 6374 2873  def headObject(s
-0000f130: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-0000f140: 206f 626a 6563 744b 6579 2c20 7665 7273   objectKey, vers
-0000f150: 696f 6e49 643d 4e6f 6e65 2c20 6578 7465  ionId=None, exte
-0000f160: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-0000f170: 6529 3a0a 2020 2020 2020 2020 7061 7468  e):.        path
-0000f180: 4172 6773 203d 207b 7d0a 2020 2020 2020  Args = {}.      
-0000f190: 2020 6966 2076 6572 7369 6f6e 4964 3a0a    if versionId:.
-0000f1a0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0000f1b0: 4172 6773 5b63 6f6e 7374 2e56 4552 5349  Args[const.VERSI
-0000f1c0: 4f4e 5f49 445f 5041 5241 4d5d 203d 2075  ON_ID_PARAM] = u
-0000f1d0: 7469 6c2e 746f 5f73 7472 696e 6728 7665  til.to_string(ve
-0000f1e0: 7273 696f 6e49 6429 0a20 2020 2020 2020  rsionId).       
-0000f1f0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-0000f200: 6b65 5f68 6561 645f 7265 7175 6573 7428  ke_head_request(
-0000f210: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
-0000f220: 6374 4b65 792c 2070 6174 6841 7267 733d  ctKey, pathArgs=
-0000f230: 7061 7468 4172 6773 2c20 6578 7465 6e73  pathArgs, extens
-0000f240: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0000f250: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0000f260: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0000f270: 2064 6566 2067 6574 4275 636b 6574 4d65   def getBucketMe
-0000f280: 7461 6461 7461 2873 656c 662c 2062 7563  tadata(self, buc
-0000f290: 6b65 744e 616d 652c 206f 7269 6769 6e3d  ketName, origin=
-0000f2a0: 4e6f 6e65 2c20 7265 7175 6573 7448 6561  None, requestHea
-0000f2b0: 6465 7273 3d4e 6f6e 652c 2065 7874 656e  ders=None, exten
-0000f2c0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-0000f2d0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0000f2e0: 6e20 7365 6c66 2e5f 6d61 6b65 5f68 6561  n self._make_hea
-0000f2f0: 645f 7265 7175 6573 7428 6275 636b 6574  d_request(bucket
-0000f300: 4e61 6d65 2c20 6d65 7468 6f64 4e61 6d65  Name, methodName
-0000f310: 3d27 6765 7442 7563 6b65 744d 6574 6164  ='getBucketMetad
-0000f320: 6174 6127 2c20 6578 7465 6e73 696f 6e48  ata', extensionH
-0000f330: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
-0000f340: 4865 6164 6572 732c 0a20 2020 2020 2020  Headers,.       
-0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f370: 2a2a 7365 6c66 2e63 6f6e 7665 7274 6f72  **self.convertor
-0000f380: 2e74 7261 6e73 5f67 6574 5f62 7563 6b65  .trans_get_bucke
-0000f390: 745f 6d65 7461 6461 7461 286f 7269 6769  t_metadata(origi
-0000f3a0: 6e3d 6f72 6967 696e 2c0a 2020 2020 2020  n=origin,.      
+0000f030: 2020 2020 2020 2020 2020 2020 206d 6178               max
+0000f040: 5f6b 6579 733d 6d61 785f 6b65 7973 2c20  _keys=max_keys, 
+0000f050: 6465 6c69 6d69 7465 723d 6465 6c69 6d69  delimiter=delimi
+0000f060: 7465 722c 0a20 2020 2020 2020 2020 2020  ter,.           
+0000f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000f0b0: 6e63 6f64 696e 675f 7479 7065 3d65 6e63  ncoding_type=enc
+0000f0c0: 6f64 696e 675f 7479 7065 2929 0a0a 2020  oding_type))..  
+0000f0d0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+0000f0e0: 2064 6566 2068 6561 6442 7563 6b65 7428   def headBucket(
+0000f0f0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0000f100: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0000f110: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+0000f120: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0000f130: 616b 655f 6865 6164 5f72 6571 7565 7374  ake_head_request
+0000f140: 2862 7563 6b65 744e 616d 652c 2065 7874  (bucketName, ext
+0000f150: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+0000f160: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+0000f170: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+0000f180: 2020 2020 6465 6620 6865 6164 4f62 6a65      def headObje
+0000f190: 6374 2873 656c 662c 2062 7563 6b65 744e  ct(self, bucketN
+0000f1a0: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+0000f1b0: 7665 7273 696f 6e49 643d 4e6f 6e65 2c20  versionId=None, 
+0000f1c0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0000f1d0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0000f1e0: 7061 7468 4172 6773 203d 207b 7d0a 2020  pathArgs = {}.  
+0000f1f0: 2020 2020 2020 6966 2076 6572 7369 6f6e        if version
+0000f200: 4964 3a0a 2020 2020 2020 2020 2020 2020  Id:.            
+0000f210: 7061 7468 4172 6773 5b63 6f6e 7374 2e56  pathArgs[const.V
+0000f220: 4552 5349 4f4e 5f49 445f 5041 5241 4d5d  ERSION_ID_PARAM]
+0000f230: 203d 2075 7469 6c2e 746f 5f73 7472 696e   = util.to_strin
+0000f240: 6728 7665 7273 696f 6e49 6429 0a20 2020  g(versionId).   
+0000f250: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000f260: 2e5f 6d61 6b65 5f68 6561 645f 7265 7175  ._make_head_requ
+0000f270: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+0000f280: 6f62 6a65 6374 4b65 792c 2070 6174 6841  objectKey, pathA
+0000f290: 7267 733d 7061 7468 4172 6773 2c20 6578  rgs=pathArgs, ex
+0000f2a0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+0000f2b0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+0000f2c0: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
+0000f2d0: 0a20 2020 2064 6566 2067 6574 4275 636b  .    def getBuck
+0000f2e0: 6574 4d65 7461 6461 7461 2873 656c 662c  etMetadata(self,
+0000f2f0: 2062 7563 6b65 744e 616d 652c 206f 7269   bucketName, ori
+0000f300: 6769 6e3d 4e6f 6e65 2c20 7265 7175 6573  gin=None, reques
+0000f310: 7448 6561 6465 7273 3d4e 6f6e 652c 2065  tHeaders=None, e
+0000f320: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0000f330: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
+0000f340: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+0000f350: 5f68 6561 645f 7265 7175 6573 7428 6275  _head_request(bu
+0000f360: 636b 6574 4e61 6d65 2c20 6d65 7468 6f64  cketName, method
+0000f370: 4e61 6d65 3d27 6765 7442 7563 6b65 744d  Name='getBucketM
+0000f380: 6574 6164 6174 6127 2c20 6578 7465 6e73  etadata', extens
+0000f390: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+0000f3a0: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
 0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3f0: 2020 2020 2020 2020 2020 2020 7265 7175              requ
-0000f400: 6573 7448 6561 6465 7273 3d72 6571 7565  estHeaders=reque
-0000f410: 7374 4865 6164 6572 7329 290a 0a20 2020  stHeaders))..   
-0000f420: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-0000f430: 6465 6620 6765 7442 7563 6b65 744c 6f63  def getBucketLoc
-0000f440: 6174 696f 6e28 7365 6c66 2c20 6275 636b  ation(self, buck
-0000f450: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
-0000f460: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-0000f470: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000f480: 656c 662e 5f6d 616b 655f 6765 745f 7265  elf._make_get_re
-0000f490: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
-0000f4a0: 2c20 7061 7468 4172 6773 3d7b 276c 6f63  , pathArgs={'loc
-0000f4b0: 6174 696f 6e27 3a20 4e6f 6e65 7d2c 206d  ation': None}, m
-0000f4c0: 6574 686f 644e 616d 653d 2767 6574 4275  ethodName='getBu
-0000f4d0: 636b 6574 4c6f 6361 7469 6f6e 272c 0a20  cketLocation',. 
-0000f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f500: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
-0000f510: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-0000f520: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
-0000f530: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-0000f540: 6465 6c65 7465 4275 636b 6574 2873 656c  deleteBucket(sel
-0000f550: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-0000f560: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0000f570: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-0000f580: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-0000f590: 5f64 656c 6574 655f 7265 7175 6573 7428  _delete_request(
-0000f5a0: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
-0000f5b0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
-0000f5c0: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
-0000f5d0: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
-0000f5e0: 2020 2064 6566 2073 6574 4275 636b 6574     def setBucket
-0000f5f0: 5175 6f74 6128 7365 6c66 2c20 6275 636b  Quota(self, buck
-0000f600: 6574 4e61 6d65 2c20 7175 6f74 612c 2065  etName, quota, e
-0000f610: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0000f620: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-0000f630: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
-0000f640: 6e75 6c6c 2871 756f 7461 2c20 2771 756f  null(quota, 'quo
-0000f650: 7461 2069 7320 656d 7074 7927 290a 2020  ta is empty').  
-0000f660: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000f670: 662e 5f6d 616b 655f 7075 745f 7265 7175  f._make_put_requ
-0000f680: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-0000f690: 7061 7468 4172 6773 3d7b 2771 756f 7461  pathArgs={'quota
-0000f6a0: 273a 204e 6f6e 657d 2c20 656e 7469 7479  ': None}, entity
-0000f6b0: 3d73 656c 662e 636f 6e76 6572 746f 722e  =self.convertor.
-0000f6c0: 7472 616e 735f 7175 6f74 6128 7175 6f74  trans_quota(quot
-0000f6d0: 6129 2c0a 2020 2020 2020 2020 2020 2020  a),.            
-0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6f0: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-0000f700: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0000f710: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0000f720: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0000f730: 2064 6566 2067 6574 4275 636b 6574 5175   def getBucketQu
-0000f740: 6f74 6128 7365 6c66 2c20 6275 636b 6574  ota(self, bucket
-0000f750: 4e61 6d65 2c20 6578 7465 6e73 696f 6e48  Name, extensionH
-0000f760: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-0000f770: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000f780: 662e 5f6d 616b 655f 6765 745f 7265 7175  f._make_get_requ
-0000f790: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-0000f7a0: 7061 7468 4172 6773 3d7b 2771 756f 7461  pathArgs={'quota
-0000f7b0: 273a 204e 6f6e 657d 2c20 6d65 7468 6f64  ': None}, method
-0000f7c0: 4e61 6d65 3d27 6765 7442 7563 6b65 7451  Name='getBucketQ
-0000f7d0: 756f 7461 272c 0a20 2020 2020 2020 2020  uota',.         
-0000f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7f0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-0000f800: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-0000f810: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
-0000f820: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-0000f830: 2020 2020 6465 6620 6765 7442 7563 6b65      def getBucke
-0000f840: 7453 746f 7261 6765 496e 666f 2873 656c  tStorageInfo(sel
-0000f850: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-0000f860: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0000f870: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-0000f880: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-0000f890: 5f67 6574 5f72 6571 7565 7374 2862 7563  _get_request(buc
-0000f8a0: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
-0000f8b0: 733d 7b27 7374 6f72 6167 6569 6e66 6f27  s={'storageinfo'
-0000f8c0: 3a20 4e6f 6e65 7d2c 206d 6574 686f 644e  : None}, methodN
-0000f8d0: 616d 653d 2767 6574 4275 636b 6574 5374  ame='getBucketSt
-0000f8e0: 6f72 6167 6549 6e66 6f27 2c0a 2020 2020  orageInfo',.    
-0000f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f910: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
-0000f920: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-0000f930: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
-0000f940: 6163 6865 0a20 2020 2064 6566 2073 6574  ache.    def set
-0000f950: 4275 636b 6574 4163 6c28 7365 6c66 2c20  BucketAcl(self, 
-0000f960: 6275 636b 6574 4e61 6d65 2c20 6163 6c3d  bucketName, acl=
-0000f970: 4e6f 6e65 2c20 6163 6c43 6f6e 7472 6f6c  None, aclControl
-0000f980: 3d4e 6f6e 652c 2065 7874 656e 7369 6f6e  =None, extension
-0000f990: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
-0000f9a0: 2020 2020 2020 2069 6620 6163 6c20 6973         if acl is
-0000f9b0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000f9c0: 2020 2061 636c 203d 2041 434c 2829 0a20     acl = ACL(). 
-0000f9d0: 2020 2020 2020 2069 6620 6163 6c20 6973         if acl is
-0000f9e0: 206e 6f74 204e 6f6e 6520 616e 6420 6c65   not None and le
-0000f9f0: 6e28 6163 6c29 203e 2030 2061 6e64 2061  n(acl) > 0 and a
-0000fa00: 636c 436f 6e74 726f 6c20 6973 206e 6f74  clControl is not
-0000fa10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000fa20: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0000fa30: 6f6e 2827 426f 7468 2061 636c 2061 6e64  on('Both acl and
-0000fa40: 2061 636c 436f 6e74 726f 6c20 6172 6520   aclControl are 
-0000fa50: 7365 7427 290a 2020 2020 2020 2020 6966  set').        if
-0000fa60: 206e 6f74 2061 636c 2061 6e64 206e 6f74   not acl and not
-0000fa70: 2061 636c 436f 6e74 726f 6c3a 0a20 2020   aclControl:.   
-0000fa80: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0000fa90: 7863 6570 7469 6f6e 2827 426f 7468 2061  xception('Both a
-0000faa0: 636c 2061 6e64 2061 636c 436f 6e74 726f  cl and aclContro
-0000fab0: 6c20 6172 6520 6e6f 7420 7365 7427 290a  l are not set').
-0000fac0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000fad0: 656c 662e 5f6d 616b 655f 7075 745f 7265  elf._make_put_re
-0000fae0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
-0000faf0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-0000fb00: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-0000fb10: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
-0000fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb30: 2020 2020 2020 2020 2020 202a 2a73 656c             **sel
-0000fb40: 662e 636f 6e76 6572 746f 722e 7472 616e  f.convertor.tran
-0000fb50: 735f 7365 745f 6275 636b 6574 5f61 636c  s_set_bucket_acl
-0000fb60: 2861 636c 3d61 636c 2c20 6163 6c43 6f6e  (acl=acl, aclCon
-0000fb70: 7472 6f6c 3d61 636c 436f 6e74 726f 6c29  trol=aclControl)
-0000fb80: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-0000fb90: 650a 2020 2020 6465 6620 6765 7442 7563  e.    def getBuc
-0000fba0: 6b65 7441 636c 2873 656c 662c 2062 7563  ketAcl(self, buc
-0000fbb0: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-0000fbc0: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-0000fbd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000fbe0: 7365 6c66 2e5f 6d61 6b65 5f67 6574 5f72  self._make_get_r
-0000fbf0: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0000fc00: 652c 2070 6174 6841 7267 733d 7b27 6163  e, pathArgs={'ac
-0000fc10: 6c27 3a20 4e6f 6e65 7d2c 206d 6574 686f  l': None}, metho
-0000fc20: 644e 616d 653d 2767 6574 4275 636b 6574  dName='getBucket
-0000fc30: 4163 6c27 2c0a 2020 2020 2020 2020 2020  Acl',.          
-0000fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc50: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-0000fc60: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
-0000fc70: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
-0000fc80: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
-0000fc90: 2020 2064 6566 2073 6574 4275 636b 6574     def setBucket
-0000fca0: 506f 6c69 6379 2873 656c 662c 2062 7563  Policy(self, buc
-0000fcb0: 6b65 744e 616d 652c 2070 6f6c 6963 794a  ketName, policyJ
-0000fcc0: 534f 4e2c 2065 7874 656e 7369 6f6e 4865  SON, extensionHe
-0000fcd0: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-0000fce0: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
-0000fcf0: 745f 6e6f 745f 6e75 6c6c 2870 6f6c 6963  t_not_null(polic
-0000fd00: 794a 534f 4e2c 2027 706f 6c69 6379 4a53  yJSON, 'policyJS
-0000fd10: 4f4e 2069 7320 656d 7074 7927 290a 2020  ON is empty').  
-0000fd20: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000fd30: 662e 5f6d 616b 655f 7075 745f 7265 7175  f._make_put_requ
-0000fd40: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-0000fd50: 7061 7468 4172 6773 3d7b 2770 6f6c 6963  pathArgs={'polic
-0000fd60: 7927 3a20 4e6f 6e65 7d2c 2065 6e74 6974  y': None}, entit
-0000fd70: 793d 706f 6c69 6379 4a53 4f4e 2c0a 2020  y=policyJSON,.  
-0000fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fda0: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
-0000fdb0: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-0000fdc0: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
-0000fdd0: 6343 6163 6865 0a20 2020 2064 6566 2067  cCache.    def g
-0000fde0: 6574 4275 636b 6574 506f 6c69 6379 2873  etBucketPolicy(s
-0000fdf0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-0000fe00: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0000fe10: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-0000fe20: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-0000fe30: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
-0000fe40: 7563 6b65 744e 616d 652c 2070 6174 6841  ucketName, pathA
-0000fe50: 7267 733d 7b27 706f 6c69 6379 273a 204e  rgs={'policy': N
-0000fe60: 6f6e 657d 2c20 6d65 7468 6f64 4e61 6d65  one}, methodName
-0000fe70: 3d27 6765 7442 7563 6b65 7450 6f6c 6963  ='getBucketPolic
-0000fe80: 7927 2c0a 2020 2020 2020 2020 2020 2020  y',.            
-0000fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fea0: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-0000feb0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0000fec0: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0000fed0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0000fee0: 2064 6566 2064 656c 6574 6542 7563 6b65   def deleteBucke
-0000fef0: 7450 6f6c 6963 7928 7365 6c66 2c20 6275  tPolicy(self, bu
-0000ff00: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
-0000ff10: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-0000ff20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000ff30: 2073 656c 662e 5f6d 616b 655f 6465 6c65   self._make_dele
-0000ff40: 7465 5f72 6571 7565 7374 2862 7563 6b65  te_request(bucke
-0000ff50: 744e 616d 652c 2070 6174 6841 7267 733d  tName, pathArgs=
-0000ff60: 7b27 706f 6c69 6379 273a 204e 6f6e 657d  {'policy': None}
-0000ff70: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-0000ff80: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-0000ff90: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
-0000ffa0: 6163 6865 0a20 2020 2064 6566 2073 6574  ache.    def set
-0000ffb0: 4275 636b 6574 5665 7273 696f 6e69 6e67  BucketVersioning
-0000ffc0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-0000ffd0: 652c 2073 7461 7475 732c 2065 7874 656e  e, status, exten
-0000ffe0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-0000fff0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00010000: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
-00010010: 2873 7461 7475 732c 2027 7374 6174 7573  (status, 'status
-00010020: 2069 7320 656d 7074 7927 290a 2020 2020   is empty').    
-00010030: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00010040: 5f6d 616b 655f 7075 745f 7265 7175 6573  _make_put_reques
-00010050: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
-00010060: 7468 4172 6773 3d7b 2776 6572 7369 6f6e  thArgs={'version
-00010070: 696e 6727 3a20 4e6f 6e65 7d2c 0a20 2020  ing': None},.   
-00010080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100a0: 2020 2065 6e74 6974 793d 7365 6c66 2e63     entity=self.c
-000100b0: 6f6e 7665 7274 6f72 2e74 7261 6e73 5f76  onvertor.trans_v
-000100c0: 6572 7369 6f6e 5f73 7461 7475 7328 7374  ersion_status(st
-000100d0: 6174 7573 292c 0a20 2020 2020 2020 2020  atus),.         
-000100e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100f0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-00010100: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-00010110: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
-00010120: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-00010130: 2020 2020 6465 6620 6765 7442 7563 6b65      def getBucke
-00010140: 7456 6572 7369 6f6e 696e 6728 7365 6c66  tVersioning(self
-00010150: 2c20 6275 636b 6574 4e61 6d65 2c20 6578  , bucketName, ex
-00010160: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-00010170: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
-00010180: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-00010190: 6765 745f 7265 7175 6573 7428 6275 636b  get_request(buck
-000101a0: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
-000101b0: 3d7b 2776 6572 7369 6f6e 696e 6727 3a20  ={'versioning': 
-000101c0: 4e6f 6e65 7d2c 206d 6574 686f 644e 616d  None}, methodNam
-000101d0: 653d 2767 6574 4275 636b 6574 5665 7273  e='getBucketVers
-000101e0: 696f 6e69 6e67 272c 0a20 2020 2020 2020  ioning',.       
-000101f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010200: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00010210: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00010220: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00010230: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-00010240: 650a 2020 2020 6465 6620 6c69 7374 5665  e.    def listVe
-00010250: 7273 696f 6e73 2873 656c 662c 2062 7563  rsions(self, buc
-00010260: 6b65 744e 616d 652c 2076 6572 7369 6f6e  ketName, version
-00010270: 3d4e 6f6e 652c 2065 7874 656e 7369 6f6e  =None, extension
-00010280: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
-00010290: 2020 2020 2020 2069 6620 7665 7273 696f         if versio
-000102a0: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-000102b0: 2020 2020 2020 2076 6572 7369 6f6e 203d         version =
-000102c0: 2056 6572 7369 6f6e 7328 290a 2020 2020   Versions().    
-000102d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000102e0: 5f6d 616b 655f 6765 745f 7265 7175 6573  _make_get_reques
-000102f0: 7428 6275 636b 6574 4e61 6d65 2c20 6d65  t(bucketName, me
-00010300: 7468 6f64 4e61 6d65 3d27 6c69 7374 5665  thodName='listVe
-00010310: 7273 696f 6e73 272c 2065 7874 656e 7369  rsions', extensi
-00010320: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-00010330: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
-00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010360: 2020 2a2a 7365 6c66 2e63 6f6e 7665 7274    **self.convert
-00010370: 6f72 2e74 7261 6e73 5f6c 6973 745f 7665  or.trans_list_ve
-00010380: 7273 696f 6e73 2876 6572 7369 6f6e 3d76  rsions(version=v
-00010390: 6572 7369 6f6e 2929 0a0a 2020 2020 4066  ersion))..    @f
-000103a0: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-000103b0: 206c 6973 744d 756c 7469 7061 7274 5570   listMultipartUp
-000103c0: 6c6f 6164 7328 7365 6c66 2c20 6275 636b  loads(self, buck
-000103d0: 6574 4e61 6d65 2c20 6d75 6c74 6970 6172  etName, multipar
-000103e0: 743d 4e6f 6e65 2c20 6578 7465 6e73 696f  t=None, extensio
-000103f0: 6e48 6561 6465 7273 3d4e 6f6e 652c 0a20  nHeaders=None,. 
-00010400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010410: 2020 2020 2020 2020 2020 2020 656e 636f              enco
-00010420: 6469 6e67 5f74 7970 653d 4e6f 6e65 293a  ding_type=None):
-00010430: 0a20 2020 2020 2020 2069 6620 6d75 6c74  .        if mult
-00010440: 6970 6172 7420 6973 204e 6f6e 653a 0a20  ipart is None:. 
-00010450: 2020 2020 2020 2020 2020 206d 756c 7469             multi
-00010460: 7061 7274 203d 204c 6973 744d 756c 7469  part = ListMulti
-00010470: 7061 7274 5570 6c6f 6164 7352 6571 7565  partUploadsReque
-00010480: 7374 2829 0a20 2020 2020 2020 2072 6574  st().        ret
-00010490: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f67  urn self._make_g
-000104a0: 6574 5f72 6571 7565 7374 2862 7563 6b65  et_request(bucke
-000104b0: 744e 616d 652c 206d 6574 686f 644e 616d  tName, methodNam
-000104c0: 653d 276c 6973 744d 756c 7469 7061 7274  e='listMultipart
-000104d0: 5570 6c6f 6164 7327 2c20 6578 7465 6e73  Uploads', extens
-000104e0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-000104f0: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
-00010500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010520: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
-00010530: 746f 722e 7472 616e 735f 6c69 7374 5f6d  tor.trans_list_m
-00010540: 756c 7469 7061 7274 5f75 706c 6f61 6473  ultipart_uploads
-00010550: 286d 756c 7469 7061 7274 3d6d 756c 7469  (multipart=multi
-00010560: 7061 7274 2c0a 2020 2020 2020 2020 2020  part,.          
+0000f3d0: 2020 2020 2a2a 7365 6c66 2e63 6f6e 7665      **self.conve
+0000f3e0: 7274 6f72 2e74 7261 6e73 5f67 6574 5f62  rtor.trans_get_b
+0000f3f0: 7563 6b65 745f 6d65 7461 6461 7461 286f  ucket_metadata(o
+0000f400: 7269 6769 6e3d 6f72 6967 696e 2c0a 2020  rigin=origin,.  
+0000f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f460: 7265 7175 6573 7448 6561 6465 7273 3d72  requestHeaders=r
+0000f470: 6571 7565 7374 4865 6164 6572 7329 290a  equestHeaders)).
+0000f480: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+0000f490: 2020 2020 6465 6620 6765 7442 7563 6b65      def getBucke
+0000f4a0: 744c 6f63 6174 696f 6e28 7365 6c66 2c20  tLocation(self, 
+0000f4b0: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
+0000f4c0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+0000f4d0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+0000f4e0: 726e 2073 656c 662e 5f6d 616b 655f 6765  rn self._make_ge
+0000f4f0: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
+0000f500: 4e61 6d65 2c20 7061 7468 4172 6773 3d7b  Name, pathArgs={
+0000f510: 276c 6f63 6174 696f 6e27 3a20 4e6f 6e65  'location': None
+0000f520: 7d2c 206d 6574 686f 644e 616d 653d 2767  }, methodName='g
+0000f530: 6574 4275 636b 6574 4c6f 6361 7469 6f6e  etBucketLocation
+0000f540: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f560: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0000f570: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+0000f580: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
+0000f590: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+0000f5a0: 6465 6620 6465 6c65 7465 4275 636b 6574  def deleteBucket
+0000f5b0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+0000f5c0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+0000f5d0: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+0000f5e0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000f5f0: 6d61 6b65 5f64 656c 6574 655f 7265 7175  make_delete_requ
+0000f600: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+0000f610: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0000f620: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+0000f630: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
+0000f640: 6865 0a20 2020 2064 6566 2073 6574 4275  he.    def setBu
+0000f650: 636b 6574 5175 6f74 6128 7365 6c66 2c20  cketQuota(self, 
+0000f660: 6275 636b 6574 4e61 6d65 2c20 7175 6f74  bucketName, quot
+0000f670: 612c 2065 7874 656e 7369 6f6e 4865 6164  a, extensionHead
+0000f680: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+0000f690: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
+0000f6a0: 6e6f 745f 6e75 6c6c 2871 756f 7461 2c20  not_null(quota, 
+0000f6b0: 2771 756f 7461 2069 7320 656d 7074 7927  'quota is empty'
+0000f6c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000f6d0: 2073 656c 662e 5f6d 616b 655f 7075 745f   self._make_put_
+0000f6e0: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+0000f6f0: 6d65 2c20 7061 7468 4172 6773 3d7b 2771  me, pathArgs={'q
+0000f700: 756f 7461 273a 204e 6f6e 657d 2c20 656e  uota': None}, en
+0000f710: 7469 7479 3d73 656c 662e 636f 6e76 6572  tity=self.conver
+0000f720: 746f 722e 7472 616e 735f 7175 6f74 6128  tor.trans_quota(
+0000f730: 7175 6f74 6129 2c0a 2020 2020 2020 2020  quota),.        
+0000f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f750: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0000f760: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+0000f770: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+0000f780: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
+0000f790: 0a20 2020 2064 6566 2067 6574 4275 636b  .    def getBuck
+0000f7a0: 6574 5175 6f74 6128 7365 6c66 2c20 6275  etQuota(self, bu
+0000f7b0: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
+0000f7c0: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+0000f7d0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000f7e0: 2073 656c 662e 5f6d 616b 655f 6765 745f   self._make_get_
+0000f7f0: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+0000f800: 6d65 2c20 7061 7468 4172 6773 3d7b 2771  me, pathArgs={'q
+0000f810: 756f 7461 273a 204e 6f6e 657d 2c20 6d65  uota': None}, me
+0000f820: 7468 6f64 4e61 6d65 3d27 6765 7442 7563  thodName='getBuc
+0000f830: 6b65 7451 756f 7461 272c 0a20 2020 2020  ketQuota',.     
+0000f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f860: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0000f870: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
+0000f880: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
+0000f890: 6368 650a 2020 2020 6465 6620 6765 7442  che.    def getB
+0000f8a0: 7563 6b65 7453 746f 7261 6765 496e 666f  ucketStorageInfo
+0000f8b0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+0000f8c0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+0000f8d0: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+0000f8e0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000f8f0: 6d61 6b65 5f67 6574 5f72 6571 7565 7374  make_get_request
+0000f900: 2862 7563 6b65 744e 616d 652c 2070 6174  (bucketName, pat
+0000f910: 6841 7267 733d 7b27 7374 6f72 6167 6569  hArgs={'storagei
+0000f920: 6e66 6f27 3a20 4e6f 6e65 7d2c 206d 6574  nfo': None}, met
+0000f930: 686f 644e 616d 653d 2767 6574 4275 636b  hodName='getBuck
+0000f940: 6574 5374 6f72 6167 6549 6e66 6f27 2c0a  etStorageInfo',.
+0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f970: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
+0000f980: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0000f990: 4865 6164 6572 7329 0a0a 2020 2020 4066  Headers)..    @f
+0000f9a0: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+0000f9b0: 2073 6574 4275 636b 6574 4163 6c28 7365   setBucketAcl(se
+0000f9c0: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
+0000f9d0: 6163 6c3d 4e6f 6e65 2c20 6163 6c43 6f6e  acl=None, aclCon
+0000f9e0: 7472 6f6c 3d4e 6f6e 652c 2065 7874 656e  trol=None, exten
+0000f9f0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+0000fa00: 293a 0a20 2020 2020 2020 2069 6620 6163  ):.        if ac
+0000fa10: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
+0000fa20: 2020 2020 2020 2061 636c 203d 2041 434c         acl = ACL
+0000fa30: 2829 0a20 2020 2020 2020 2069 6620 6163  ().        if ac
+0000fa40: 6c20 6973 206e 6f74 204e 6f6e 6520 616e  l is not None an
+0000fa50: 6420 6c65 6e28 6163 6c29 203e 2030 2061  d len(acl) > 0 a
+0000fa60: 6e64 2061 636c 436f 6e74 726f 6c20 6973  nd aclControl is
+0000fa70: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000fa80: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0000fa90: 6570 7469 6f6e 2827 426f 7468 2061 636c  eption('Both acl
+0000faa0: 2061 6e64 2061 636c 436f 6e74 726f 6c20   and aclControl 
+0000fab0: 6172 6520 7365 7427 290a 2020 2020 2020  are set').      
+0000fac0: 2020 6966 206e 6f74 2061 636c 2061 6e64    if not acl and
+0000fad0: 206e 6f74 2061 636c 436f 6e74 726f 6c3a   not aclControl:
+0000fae0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000faf0: 7365 2045 7863 6570 7469 6f6e 2827 426f  se Exception('Bo
+0000fb00: 7468 2061 636c 2061 6e64 2061 636c 436f  th acl and aclCo
+0000fb10: 6e74 726f 6c20 6172 6520 6e6f 7420 7365  ntrol are not se
+0000fb20: 7427 290a 2020 2020 2020 2020 7265 7475  t').        retu
+0000fb30: 726e 2073 656c 662e 5f6d 616b 655f 7075  rn self._make_pu
+0000fb40: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
+0000fb50: 4e61 6d65 2c20 6578 7465 6e73 696f 6e48  Name, extensionH
+0000fb60: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0000fb70: 4865 6164 6572 732c 0a20 2020 2020 2020  Headers,.       
+0000fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb90: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0000fba0: 2a73 656c 662e 636f 6e76 6572 746f 722e  *self.convertor.
+0000fbb0: 7472 616e 735f 7365 745f 6275 636b 6574  trans_set_bucket
+0000fbc0: 5f61 636c 2861 636c 3d61 636c 2c20 6163  _acl(acl=acl, ac
+0000fbd0: 6c43 6f6e 7472 6f6c 3d61 636c 436f 6e74  lControl=aclCont
+0000fbe0: 726f 6c29 290a 0a20 2020 2040 6675 6e63  rol))..    @func
+0000fbf0: 4361 6368 650a 2020 2020 6465 6620 6765  Cache.    def ge
+0000fc00: 7442 7563 6b65 7441 636c 2873 656c 662c  tBucketAcl(self,
+0000fc10: 2062 7563 6b65 744e 616d 652c 2065 7874   bucketName, ext
+0000fc20: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+0000fc30: 6e65 293a 0a20 2020 2020 2020 2072 6574  ne):.        ret
+0000fc40: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f67  urn self._make_g
+0000fc50: 6574 5f72 6571 7565 7374 2862 7563 6b65  et_request(bucke
+0000fc60: 744e 616d 652c 2070 6174 6841 7267 733d  tName, pathArgs=
+0000fc70: 7b27 6163 6c27 3a20 4e6f 6e65 7d2c 206d  {'acl': None}, m
+0000fc80: 6574 686f 644e 616d 653d 2767 6574 4275  ethodName='getBu
+0000fc90: 636b 6574 4163 6c27 2c0a 2020 2020 2020  cketAcl',.      
+0000fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fcc0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0000fcd0: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+0000fce0: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
+0000fcf0: 6865 0a20 2020 2064 6566 2073 6574 4275  he.    def setBu
+0000fd00: 636b 6574 506f 6c69 6379 2873 656c 662c  cketPolicy(self,
+0000fd10: 2062 7563 6b65 744e 616d 652c 2070 6f6c   bucketName, pol
+0000fd20: 6963 794a 534f 4e2c 2065 7874 656e 7369  icyJSON, extensi
+0000fd30: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
+0000fd40: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
+0000fd50: 7373 6572 745f 6e6f 745f 6e75 6c6c 2870  ssert_not_null(p
+0000fd60: 6f6c 6963 794a 534f 4e2c 2027 706f 6c69  olicyJSON, 'poli
+0000fd70: 6379 4a53 4f4e 2069 7320 656d 7074 7927  cyJSON is empty'
+0000fd80: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000fd90: 2073 656c 662e 5f6d 616b 655f 7075 745f   self._make_put_
+0000fda0: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+0000fdb0: 6d65 2c20 7061 7468 4172 6773 3d7b 2770  me, pathArgs={'p
+0000fdc0: 6f6c 6963 7927 3a20 4e6f 6e65 7d2c 2065  olicy': None}, e
+0000fdd0: 6e74 6974 793d 706f 6c69 6379 4a53 4f4e  ntity=policyJSON
+0000fde0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe00: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
+0000fe10: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+0000fe20: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
+0000fe30: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+0000fe40: 6566 2067 6574 4275 636b 6574 506f 6c69  ef getBucketPoli
+0000fe50: 6379 2873 656c 662c 2062 7563 6b65 744e  cy(self, bucketN
+0000fe60: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
+0000fe70: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
+0000fe80: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000fe90: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
+0000fea0: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
+0000feb0: 6174 6841 7267 733d 7b27 706f 6c69 6379  athArgs={'policy
+0000fec0: 273a 204e 6f6e 657d 2c20 6d65 7468 6f64  ': None}, method
+0000fed0: 4e61 6d65 3d27 6765 7442 7563 6b65 7450  Name='getBucketP
+0000fee0: 6f6c 6963 7927 2c0a 2020 2020 2020 2020  olicy',.        
+0000fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff00: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0000ff10: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+0000ff20: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+0000ff30: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
+0000ff40: 0a20 2020 2064 6566 2064 656c 6574 6542  .    def deleteB
+0000ff50: 7563 6b65 7450 6f6c 6963 7928 7365 6c66  ucketPolicy(self
+0000ff60: 2c20 6275 636b 6574 4e61 6d65 2c20 6578  , bucketName, ex
+0000ff70: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+0000ff80: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
+0000ff90: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+0000ffa0: 6465 6c65 7465 5f72 6571 7565 7374 2862  delete_request(b
+0000ffb0: 7563 6b65 744e 616d 652c 2070 6174 6841  ucketName, pathA
+0000ffc0: 7267 733d 7b27 706f 6c69 6379 273a 204e  rgs={'policy': N
+0000ffd0: 6f6e 657d 2c20 6578 7465 6e73 696f 6e48  one}, extensionH
+0000ffe0: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0000fff0: 4865 6164 6572 7329 0a0a 2020 2020 4066  Headers)..    @f
+00010000: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+00010010: 2073 6574 4275 636b 6574 5665 7273 696f   setBucketVersio
+00010020: 6e69 6e67 2873 656c 662c 2062 7563 6b65  ning(self, bucke
+00010030: 744e 616d 652c 2073 7461 7475 732c 2065  tName, status, e
+00010040: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+00010050: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
+00010060: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
+00010070: 6e75 6c6c 2873 7461 7475 732c 2027 7374  null(status, 'st
+00010080: 6174 7573 2069 7320 656d 7074 7927 290a  atus is empty').
+00010090: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000100a0: 656c 662e 5f6d 616b 655f 7075 745f 7265  elf._make_put_re
+000100b0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+000100c0: 2c20 7061 7468 4172 6773 3d7b 2776 6572  , pathArgs={'ver
+000100d0: 7369 6f6e 696e 6727 3a20 4e6f 6e65 7d2c  sioning': None},
+000100e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000100f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010100: 2020 2020 2020 2065 6e74 6974 793d 7365         entity=se
+00010110: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
+00010120: 6e73 5f76 6572 7369 6f6e 5f73 7461 7475  ns_version_statu
+00010130: 7328 7374 6174 7573 292c 0a20 2020 2020  s(status),.     
+00010140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010160: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+00010170: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
+00010180: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
+00010190: 6368 650a 2020 2020 6465 6620 6765 7442  che.    def getB
+000101a0: 7563 6b65 7456 6572 7369 6f6e 696e 6728  ucketVersioning(
+000101b0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+000101c0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+000101d0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+000101e0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+000101f0: 616b 655f 6765 745f 7265 7175 6573 7428  ake_get_request(
+00010200: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
+00010210: 4172 6773 3d7b 2776 6572 7369 6f6e 696e  Args={'versionin
+00010220: 6727 3a20 4e6f 6e65 7d2c 206d 6574 686f  g': None}, metho
+00010230: 644e 616d 653d 2767 6574 4275 636b 6574  dName='getBucket
+00010240: 5665 7273 696f 6e69 6e67 272c 0a20 2020  Versioning',.   
+00010250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010270: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+00010280: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+00010290: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
+000102a0: 4361 6368 650a 2020 2020 6465 6620 6c69  Cache.    def li
+000102b0: 7374 5665 7273 696f 6e73 2873 656c 662c  stVersions(self,
+000102c0: 2062 7563 6b65 744e 616d 652c 2076 6572   bucketName, ver
+000102d0: 7369 6f6e 3d4e 6f6e 652c 2065 7874 656e  sion=None, exten
+000102e0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+000102f0: 293a 0a20 2020 2020 2020 2069 6620 7665  ):.        if ve
+00010300: 7273 696f 6e20 6973 204e 6f6e 653a 0a20  rsion is None:. 
+00010310: 2020 2020 2020 2020 2020 2076 6572 7369             versi
+00010320: 6f6e 203d 2056 6572 7369 6f6e 7328 290a  on = Versions().
+00010330: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00010340: 656c 662e 5f6d 616b 655f 6765 745f 7265  elf._make_get_re
+00010350: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+00010360: 2c20 6d65 7468 6f64 4e61 6d65 3d27 6c69  , methodName='li
+00010370: 7374 5665 7273 696f 6e73 272c 2065 7874  stVersions', ext
+00010380: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00010390: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
+000103a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103c0: 2020 2020 2020 2a2a 7365 6c66 2e63 6f6e        **self.con
+000103d0: 7665 7274 6f72 2e74 7261 6e73 5f6c 6973  vertor.trans_lis
+000103e0: 745f 7665 7273 696f 6e73 2876 6572 7369  t_versions(versi
+000103f0: 6f6e 3d76 6572 7369 6f6e 2929 0a0a 2020  on=version))..  
+00010400: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+00010410: 2064 6566 206c 6973 744d 756c 7469 7061   def listMultipa
+00010420: 7274 5570 6c6f 6164 7328 7365 6c66 2c20  rtUploads(self, 
+00010430: 6275 636b 6574 4e61 6d65 2c20 6d75 6c74  bucketName, mult
+00010440: 6970 6172 743d 4e6f 6e65 2c20 6578 7465  ipart=None, exte
+00010450: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+00010460: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00010470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010480: 656e 636f 6469 6e67 5f74 7970 653d 4e6f  encoding_type=No
+00010490: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
+000104a0: 6d75 6c74 6970 6172 7420 6973 204e 6f6e  multipart is Non
+000104b0: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+000104c0: 756c 7469 7061 7274 203d 204c 6973 744d  ultipart = ListM
+000104d0: 756c 7469 7061 7274 5570 6c6f 6164 7352  ultipartUploadsR
+000104e0: 6571 7565 7374 2829 0a20 2020 2020 2020  equest().       
+000104f0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+00010500: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
+00010510: 7563 6b65 744e 616d 652c 206d 6574 686f  ucketName, metho
+00010520: 644e 616d 653d 276c 6973 744d 756c 7469  dName='listMulti
+00010530: 7061 7274 5570 6c6f 6164 7327 2c20 6578  partUploads', ex
+00010540: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+00010550: 7874 656e 7369 6f6e 4865 6164 6572 732c  xtensionHeaders,
+00010560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00010570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105b0: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
-000105c0: 6e67 5f74 7970 653d 656e 636f 6469 6e67  ng_type=encoding
-000105d0: 5f74 7970 6529 290a 0a20 2020 2040 6675  _type))..    @fu
-000105e0: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-000105f0: 6465 6c65 7465 4275 636b 6574 4c69 6665  deleteBucketLife
-00010600: 6379 636c 6528 7365 6c66 2c20 6275 636b  cycle(self, buck
-00010610: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
-00010620: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-00010630: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00010640: 656c 662e 5f6d 616b 655f 6465 6c65 7465  elf._make_delete
-00010650: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-00010660: 616d 652c 2070 6174 6841 7267 733d 7b27  ame, pathArgs={'
-00010670: 6c69 6665 6379 636c 6527 3a20 4e6f 6e65  lifecycle': None
-00010680: 7d2c 2065 7874 656e 7369 6f6e 4865 6164  }, extensionHead
-00010690: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-000106a0: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
-000106b0: 4361 6368 650a 2020 2020 6465 6620 7365  Cache.    def se
-000106c0: 7442 7563 6b65 744c 6966 6563 7963 6c65  tBucketLifecycle
-000106d0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-000106e0: 652c 206c 6966 6563 7963 6c65 2c20 6578  e, lifecycle, ex
-000106f0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-00010700: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
-00010710: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
-00010720: 756c 6c28 6c69 6665 6379 636c 652c 2027  ull(lifecycle, '
-00010730: 6c69 6665 6379 636c 6520 6973 2065 6d70  lifecycle is emp
-00010740: 7479 2729 0a20 2020 2020 2020 2072 6574  ty').        ret
-00010750: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f70  urn self._make_p
-00010760: 7574 5f72 6571 7565 7374 2862 7563 6b65  ut_request(bucke
-00010770: 744e 616d 652c 2065 7874 656e 7369 6f6e  tName, extension
-00010780: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-00010790: 6e48 6561 6465 7273 2c0a 2020 2020 2020  nHeaders,.      
-000107a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107c0: 2a2a 7365 6c66 2e63 6f6e 7665 7274 6f72  **self.convertor
-000107d0: 2e74 7261 6e73 5f73 6574 5f62 7563 6b65  .trans_set_bucke
-000107e0: 745f 6c69 6665 6379 636c 6528 6c69 6665  t_lifecycle(life
-000107f0: 6379 636c 653d 6c69 6665 6379 636c 6529  cycle=lifecycle)
-00010800: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-00010810: 650a 2020 2020 6465 6620 6765 7442 7563  e.    def getBuc
-00010820: 6b65 744c 6966 6563 7963 6c65 2873 656c  ketLifecycle(sel
-00010830: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-00010840: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00010850: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-00010860: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-00010870: 5f67 6574 5f72 6571 7565 7374 2862 7563  _get_request(buc
-00010880: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
-00010890: 733d 7b27 6c69 6665 6379 636c 6527 3a20  s={'lifecycle': 
-000108a0: 4e6f 6e65 7d2c 206d 6574 686f 644e 616d  None}, methodNam
-000108b0: 653d 2767 6574 4275 636b 6574 4c69 6665  e='getBucketLife
-000108c0: 6379 636c 6527 2c0a 2020 2020 2020 2020  cycle',.        
-000108d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108e0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-000108f0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-00010900: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-00010910: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-00010920: 0a20 2020 2064 6566 2064 656c 6574 6542  .    def deleteB
-00010930: 7563 6b65 7457 6562 7369 7465 2873 656c  ucketWebsite(sel
-00010940: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-00010950: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00010960: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-00010970: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-00010980: 5f64 656c 6574 655f 7265 7175 6573 7428  _delete_request(
-00010990: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
-000109a0: 4172 6773 3d7b 2777 6562 7369 7465 273a  Args={'website':
-000109b0: 204e 6f6e 657d 2c20 6578 7465 6e73 696f   None}, extensio
-000109c0: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-000109d0: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
-000109e0: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-000109f0: 6566 2073 6574 4275 636b 6574 5765 6273  ef setBucketWebs
-00010a00: 6974 6528 7365 6c66 2c20 6275 636b 6574  ite(self, bucket
-00010a10: 4e61 6d65 2c20 7765 6273 6974 652c 2065  Name, website, e
-00010a20: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00010a30: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-00010a40: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
-00010a50: 6e75 6c6c 2877 6562 7369 7465 2c20 2777  null(website, 'w
-00010a60: 6562 7369 7465 2069 7320 656d 7074 7927  ebsite is empty'
-00010a70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00010a80: 2073 656c 662e 5f6d 616b 655f 7075 745f   self._make_put_
-00010a90: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
-00010aa0: 6d65 2c20 7061 7468 4172 6773 3d7b 2777  me, pathArgs={'w
-00010ab0: 6562 7369 7465 273a 204e 6f6e 657d 2c0a  ebsite': None},.
-00010ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ae0: 2020 2020 2020 656e 7469 7479 3d73 656c        entity=sel
-00010af0: 662e 636f 6e76 6572 746f 722e 7472 616e  f.convertor.tran
-00010b00: 735f 7765 6273 6974 6528 7765 6273 6974  s_website(websit
-00010b10: 6529 2c20 6578 7465 6e73 696f 6e48 6561  e), extensionHea
-00010b20: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-00010b30: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
-00010b40: 6343 6163 6865 0a20 2020 2064 6566 2067  cCache.    def g
-00010b50: 6574 4275 636b 6574 5765 6273 6974 6528  etBucketWebsite(
-00010b60: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
-00010b70: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-00010b80: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
-00010b90: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
-00010ba0: 616b 655f 6765 745f 7265 7175 6573 7428  ake_get_request(
-00010bb0: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
-00010bc0: 4172 6773 3d7b 2777 6562 7369 7465 273a  Args={'website':
-00010bd0: 204e 6f6e 657d 2c20 6d65 7468 6f64 4e61   None}, methodNa
-00010be0: 6d65 3d27 6765 7442 7563 6b65 7457 6562  me='getBucketWeb
-00010bf0: 7369 7465 272c 0a20 2020 2020 2020 2020  site',.         
-00010c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c10: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-00010c20: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-00010c30: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
-00010c40: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-00010c50: 2020 2020 6465 6620 7365 7442 7563 6b65      def setBucke
-00010c60: 744c 6f67 6769 6e67 2873 656c 662c 2062  tLogging(self, b
-00010c70: 7563 6b65 744e 616d 652c 206c 6f67 7374  ucketName, logst
-00010c80: 6174 7573 3d4e 6f6e 652c 2065 7874 656e  atus=None, exten
-00010c90: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-00010ca0: 293a 0a20 2020 2020 2020 2069 6620 6c6f  ):.        if lo
-00010cb0: 6773 7461 7475 7320 6973 204e 6f6e 653a  gstatus is None:
-00010cc0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00010cd0: 7374 6174 7573 203d 204c 6f67 6769 6e67  status = Logging
-00010ce0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00010cf0: 6e20 7365 6c66 2e5f 6d61 6b65 5f70 7574  n self._make_put
-00010d00: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-00010d10: 616d 652c 2070 6174 6841 7267 733d 7b27  ame, pathArgs={'
-00010d20: 6c6f 6767 696e 6727 3a20 4e6f 6e65 7d2c  logging': None},
-00010d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d50: 2020 2020 2020 2065 6e74 6974 793d 7365         entity=se
-00010d60: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
-00010d70: 6e73 5f6c 6f67 6769 6e67 286c 6f67 7374  ns_logging(logst
-00010d80: 6174 7573 292c 2065 7874 656e 7369 6f6e  atus), extension
-00010d90: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-00010da0: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
-00010db0: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-00010dc0: 6620 6765 7442 7563 6b65 744c 6f67 6769  f getBucketLoggi
-00010dd0: 6e67 2873 656c 662c 2062 7563 6b65 744e  ng(self, bucketN
-00010de0: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
-00010df0: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-00010e00: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00010e10: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
-00010e20: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
-00010e30: 6174 6841 7267 733d 7b27 6c6f 6767 696e  athArgs={'loggin
-00010e40: 6727 3a20 4e6f 6e65 7d2c 206d 6574 686f  g': None}, metho
-00010e50: 644e 616d 653d 2767 6574 4275 636b 6574  dName='getBucket
-00010e60: 4c6f 6767 696e 6727 2c0a 2020 2020 2020  Logging',.      
-00010e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e90: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00010ea0: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-00010eb0: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
-00010ec0: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
-00010ed0: 636b 6574 5461 6767 696e 6728 7365 6c66  cketTagging(self
-00010ee0: 2c20 6275 636b 6574 4e61 6d65 2c20 6578  , bucketName, ex
-00010ef0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-00010f00: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
-00010f10: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-00010f20: 6765 745f 7265 7175 6573 7428 6275 636b  get_request(buck
-00010f30: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
-00010f40: 3d7b 2774 6167 6769 6e67 273a 204e 6f6e  ={'tagging': Non
-00010f50: 657d 2c20 6d65 7468 6f64 4e61 6d65 3d27  e}, methodName='
-00010f60: 6765 7442 7563 6b65 7454 6167 6769 6e67  getBucketTagging
-00010f70: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00010f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f90: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
-00010fa0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-00010fb0: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
-00010fc0: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-00010fd0: 6465 6620 7365 7442 7563 6b65 7454 6167  def setBucketTag
-00010fe0: 6769 6e67 2873 656c 662c 2062 7563 6b65  ging(self, bucke
-00010ff0: 744e 616d 652c 2074 6167 496e 666f 2c20  tName, tagInfo, 
-00011000: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00011010: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00011020: 7365 6c66 2e5f 6173 7365 7274 5f6e 6f74  self._assert_not
-00011030: 5f6e 756c 6c28 7461 6749 6e66 6f2c 2027  _null(tagInfo, '
-00011040: 7461 6749 6e66 6f20 6973 2065 6d70 7479  tagInfo is empty
-00011050: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
-00011060: 6e20 7365 6c66 2e5f 6d61 6b65 5f70 7574  n self._make_put
-00011070: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-00011080: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
-00011090: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-000110a0: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
-000110b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110c0: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-000110d0: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e74  self.convertor.t
-000110e0: 7261 6e73 5f73 6574 5f62 7563 6b65 745f  rans_set_bucket_
-000110f0: 7461 6767 696e 6728 7461 6749 6e66 6f3d  tagging(tagInfo=
-00011100: 7461 6749 6e66 6f29 290a 0a20 2020 2040  tagInfo))..    @
-00011110: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-00011120: 6620 6465 6c65 7465 4275 636b 6574 5461  f deleteBucketTa
-00011130: 6767 696e 6728 7365 6c66 2c20 6275 636b  gging(self, buck
-00011140: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
-00011150: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-00011160: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00011170: 656c 662e 5f6d 616b 655f 6465 6c65 7465  elf._make_delete
-00011180: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-00011190: 616d 652c 2070 6174 6841 7267 733d 7b27  ame, pathArgs={'
-000111a0: 7461 6767 696e 6727 3a20 4e6f 6e65 7d2c  tagging': None},
-000111b0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-000111c0: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
-000111d0: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
-000111e0: 6368 650a 2020 2020 6465 6620 7365 7442  che.    def setB
-000111f0: 7563 6b65 7443 6f72 7328 7365 6c66 2c20  ucketCors(self, 
-00011200: 6275 636b 6574 4e61 6d65 2c20 636f 7273  bucketName, cors
-00011210: 5275 6c65 4c69 7374 2c20 6578 7465 6e73  RuleList, extens
-00011220: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-00011230: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-00011240: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
-00011250: 636f 7273 5275 6c65 4c69 7374 2c20 2763  corsRuleList, 'c
-00011260: 6f72 7352 756c 654c 6973 7420 6973 2065  orsRuleList is e
-00011270: 6d70 7479 2729 0a20 2020 2020 2020 2072  mpty').        r
-00011280: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-00011290: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
-000112a0: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-000112b0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-000112c0: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
-000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112f0: 2020 2a2a 7365 6c66 2e63 6f6e 7665 7274    **self.convert
-00011300: 6f72 2e74 7261 6e73 5f73 6574 5f62 7563  or.trans_set_buc
-00011310: 6b65 745f 636f 7273 2863 6f72 7352 756c  ket_cors(corsRul
-00011320: 654c 6973 743d 636f 7273 5275 6c65 4c69  eList=corsRuleLi
-00011330: 7374 2929 0a0a 2020 2020 4066 756e 6343  st))..    @funcC
-00011340: 6163 6865 0a20 2020 2064 6566 2064 656c  ache.    def del
-00011350: 6574 6542 7563 6b65 7443 6f72 7328 7365  eteBucketCors(se
-00011360: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-00011370: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00011380: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00011390: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-000113a0: 655f 6465 6c65 7465 5f72 6571 7565 7374  e_delete_request
-000113b0: 2862 7563 6b65 744e 616d 652c 2070 6174  (bucketName, pat
-000113c0: 6841 7267 733d 7b27 636f 7273 273a 204e  hArgs={'cors': N
-000113d0: 6f6e 657d 2c20 6578 7465 6e73 696f 6e48  one}, extensionH
-000113e0: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
-000113f0: 4865 6164 6572 7329 0a0a 2020 2020 4066  Headers)..    @f
-00011400: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-00011410: 2067 6574 4275 636b 6574 436f 7273 2873   getBucketCors(s
-00011420: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-00011430: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-00011440: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-00011450: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-00011460: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
-00011470: 7563 6b65 744e 616d 652c 2070 6174 6841  ucketName, pathA
-00011480: 7267 733d 7b27 636f 7273 273a 204e 6f6e  rgs={'cors': Non
-00011490: 657d 2c20 6d65 7468 6f64 4e61 6d65 3d27  e}, methodName='
-000114a0: 6765 7442 7563 6b65 7443 6f72 7327 2c0a  getBucketCors',.
-000114b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114d0: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
-000114e0: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
-000114f0: 4865 6164 6572 7329 0a0a 2020 2020 4066  Headers)..    @f
-00011500: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-00011510: 206f 7074 696f 6e73 4275 636b 6574 2873   optionsBucket(s
-00011520: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-00011530: 206f 7074 696f 6e2c 2065 7874 656e 7369   option, extensi
-00011540: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-00011550: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011560: 7365 6c66 2e6f 7074 696f 6e73 4f62 6a65  self.optionsObje
-00011570: 6374 2862 7563 6b65 744e 616d 652c 204e  ct(bucketName, N
-00011580: 6f6e 652c 206f 7074 696f 6e3d 6f70 7469  one, option=opti
-00011590: 6f6e 2c20 6578 7465 6e73 696f 6e48 6561  on, extensionHea
-000115a0: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-000115b0: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
-000115c0: 6343 6163 6865 0a20 2020 2064 6566 2073  cCache.    def s
-000115d0: 6574 4275 636b 6574 4e6f 7469 6669 6361  etBucketNotifica
-000115e0: 7469 6f6e 2873 656c 662c 2062 7563 6b65  tion(self, bucke
-000115f0: 744e 616d 652c 206e 6f74 6966 6963 6174  tName, notificat
-00011600: 696f 6e3d 4e6f 6e65 2c20 6578 7465 6e73  ion=None, extens
-00011610: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-00011620: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-00011630: 6966 6963 6174 696f 6e20 6973 204e 6f6e  ification is Non
-00011640: 653a 0a20 2020 2020 2020 2020 2020 206e  e:.            n
-00011650: 6f74 6966 6963 6174 696f 6e20 3d20 4e6f  otification = No
-00011660: 7469 6669 6361 7469 6f6e 2829 0a20 2020  tification().   
-00011670: 2020 2020 2069 6620 6e6f 7469 6669 6361       if notifica
-00011680: 7469 6f6e 2069 7320 4e6f 6e65 3a0a 2020  tion is None:.  
-00011690: 2020 2020 2020 2020 2020 6e6f 7469 6669            notifi
-000116a0: 6361 7469 6f6e 203d 204e 6f74 6966 6963  cation = Notific
-000116b0: 6174 696f 6e28 290a 2020 2020 2020 2020  ation().        
-000116c0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-000116d0: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
-000116e0: 636b 6574 4e61 6d65 2c20 7061 7468 4172  cketName, pathAr
-000116f0: 6773 3d7b 276e 6f74 6966 6963 6174 696f  gs={'notificatio
-00011700: 6e27 3a20 4e6f 6e65 7d2c 0a20 2020 2020  n': None},.     
-00011710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011730: 2065 6e74 6974 793d 7365 6c66 2e63 6f6e   entity=self.con
-00011740: 7665 7274 6f72 2e74 7261 6e73 5f6e 6f74  vertor.trans_not
-00011750: 6966 6963 6174 696f 6e28 6e6f 7469 6669  ification(notifi
-00011760: 6361 7469 6f6e 292c 0a20 2020 2020 2020  cation),.       
+00010580: 2020 2020 2020 202a 2a73 656c 662e 636f         **self.co
+00010590: 6e76 6572 746f 722e 7472 616e 735f 6c69  nvertor.trans_li
+000105a0: 7374 5f6d 756c 7469 7061 7274 5f75 706c  st_multipart_upl
+000105b0: 6f61 6473 286d 756c 7469 7061 7274 3d6d  oads(multipart=m
+000105c0: 756c 7469 7061 7274 2c0a 2020 2020 2020  ultipart,.      
+000105d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010610: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00010620: 636f 6469 6e67 5f74 7970 653d 656e 636f  coding_type=enco
+00010630: 6469 6e67 5f74 7970 6529 290a 0a20 2020  ding_type))..   
+00010640: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+00010650: 6465 6620 6465 6c65 7465 4275 636b 6574  def deleteBucket
+00010660: 4c69 6665 6379 636c 6528 7365 6c66 2c20  Lifecycle(self, 
+00010670: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
+00010680: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+00010690: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+000106a0: 726e 2073 656c 662e 5f6d 616b 655f 6465  rn self._make_de
+000106b0: 6c65 7465 5f72 6571 7565 7374 2862 7563  lete_request(buc
+000106c0: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
+000106d0: 733d 7b27 6c69 6665 6379 636c 6527 3a20  s={'lifecycle': 
+000106e0: 4e6f 6e65 7d2c 2065 7874 656e 7369 6f6e  None}, extension
+000106f0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+00010700: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
+00010710: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+00010720: 6620 7365 7442 7563 6b65 744c 6966 6563  f setBucketLifec
+00010730: 7963 6c65 2873 656c 662c 2062 7563 6b65  ycle(self, bucke
+00010740: 744e 616d 652c 206c 6966 6563 7963 6c65  tName, lifecycle
+00010750: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+00010760: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+00010770: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
+00010780: 6f74 5f6e 756c 6c28 6c69 6665 6379 636c  ot_null(lifecycl
+00010790: 652c 2027 6c69 6665 6379 636c 6520 6973  e, 'lifecycle is
+000107a0: 2065 6d70 7479 2729 0a20 2020 2020 2020   empty').       
+000107b0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+000107c0: 6b65 5f70 7574 5f72 6571 7565 7374 2862  ke_put_request(b
+000107d0: 7563 6b65 744e 616d 652c 2065 7874 656e  ucketName, exten
+000107e0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+000107f0: 6e73 696f 6e48 6561 6465 7273 2c0a 2020  nsionHeaders,.  
+00010800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010820: 2020 2020 2a2a 7365 6c66 2e63 6f6e 7665      **self.conve
+00010830: 7274 6f72 2e74 7261 6e73 5f73 6574 5f62  rtor.trans_set_b
+00010840: 7563 6b65 745f 6c69 6665 6379 636c 6528  ucket_lifecycle(
+00010850: 6c69 6665 6379 636c 653d 6c69 6665 6379  lifecycle=lifecy
+00010860: 636c 6529 290a 0a20 2020 2040 6675 6e63  cle))..    @func
+00010870: 4361 6368 650a 2020 2020 6465 6620 6765  Cache.    def ge
+00010880: 7442 7563 6b65 744c 6966 6563 7963 6c65  tBucketLifecycle
+00010890: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+000108a0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+000108b0: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+000108c0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000108d0: 6d61 6b65 5f67 6574 5f72 6571 7565 7374  make_get_request
+000108e0: 2862 7563 6b65 744e 616d 652c 2070 6174  (bucketName, pat
+000108f0: 6841 7267 733d 7b27 6c69 6665 6379 636c  hArgs={'lifecycl
+00010900: 6527 3a20 4e6f 6e65 7d2c 206d 6574 686f  e': None}, metho
+00010910: 644e 616d 653d 2767 6574 4275 636b 6574  dName='getBucket
+00010920: 4c69 6665 6379 636c 6527 2c0a 2020 2020  Lifecycle',.    
+00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010950: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
+00010960: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
+00010970: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
+00010980: 6163 6865 0a20 2020 2064 6566 2064 656c  ache.    def del
+00010990: 6574 6542 7563 6b65 7457 6562 7369 7465  eteBucketWebsite
+000109a0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+000109b0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+000109c0: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+000109d0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000109e0: 6d61 6b65 5f64 656c 6574 655f 7265 7175  make_delete_requ
+000109f0: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+00010a00: 7061 7468 4172 6773 3d7b 2777 6562 7369  pathArgs={'websi
+00010a10: 7465 273a 204e 6f6e 657d 2c20 6578 7465  te': None}, exte
+00010a20: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+00010a30: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+00010a40: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+00010a50: 2020 2064 6566 2073 6574 4275 636b 6574     def setBucket
+00010a60: 5765 6273 6974 6528 7365 6c66 2c20 6275  Website(self, bu
+00010a70: 636b 6574 4e61 6d65 2c20 7765 6273 6974  cketName, websit
+00010a80: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+00010a90: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+00010aa0: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
+00010ab0: 6e6f 745f 6e75 6c6c 2877 6562 7369 7465  not_null(website
+00010ac0: 2c20 2777 6562 7369 7465 2069 7320 656d  , 'website is em
+00010ad0: 7074 7927 290a 2020 2020 2020 2020 7265  pty').        re
+00010ae0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+00010af0: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
+00010b00: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
+00010b10: 3d7b 2777 6562 7369 7465 273a 204e 6f6e  ={'website': Non
+00010b20: 657d 2c0a 2020 2020 2020 2020 2020 2020  e},.            
+00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b40: 2020 2020 2020 2020 2020 656e 7469 7479            entity
+00010b50: 3d73 656c 662e 636f 6e76 6572 746f 722e  =self.convertor.
+00010b60: 7472 616e 735f 7765 6273 6974 6528 7765  trans_website(we
+00010b70: 6273 6974 6529 2c20 6578 7465 6e73 696f  bsite), extensio
+00010b80: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+00010b90: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
+00010ba0: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+00010bb0: 6566 2067 6574 4275 636b 6574 5765 6273  ef getBucketWebs
+00010bc0: 6974 6528 7365 6c66 2c20 6275 636b 6574  ite(self, bucket
+00010bd0: 4e61 6d65 2c20 6578 7465 6e73 696f 6e48  Name, extensionH
+00010be0: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
+00010bf0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00010c00: 662e 5f6d 616b 655f 6765 745f 7265 7175  f._make_get_requ
+00010c10: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+00010c20: 7061 7468 4172 6773 3d7b 2777 6562 7369  pathArgs={'websi
+00010c30: 7465 273a 204e 6f6e 657d 2c20 6d65 7468  te': None}, meth
+00010c40: 6f64 4e61 6d65 3d27 6765 7442 7563 6b65  odName='getBucke
+00010c50: 7457 6562 7369 7465 272c 0a20 2020 2020  tWebsite',.     
+00010c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c80: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+00010c90: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
+00010ca0: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
+00010cb0: 6368 650a 2020 2020 6465 6620 7365 7442  che.    def setB
+00010cc0: 7563 6b65 744c 6f67 6769 6e67 2873 656c  ucketLogging(sel
+00010cd0: 662c 2062 7563 6b65 744e 616d 652c 206c  f, bucketName, l
+00010ce0: 6f67 7374 6174 7573 3d4e 6f6e 652c 2065  ogstatus=None, e
+00010cf0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+00010d00: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
+00010d10: 6620 6c6f 6773 7461 7475 7320 6973 204e  f logstatus is N
+00010d20: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00010d30: 206c 6f67 7374 6174 7573 203d 204c 6f67   logstatus = Log
+00010d40: 6769 6e67 2829 0a20 2020 2020 2020 2072  ging().        r
+00010d50: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+00010d60: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
+00010d70: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
+00010d80: 733d 7b27 6c6f 6767 696e 6727 3a20 4e6f  s={'logging': No
+00010d90: 6e65 7d2c 0a20 2020 2020 2020 2020 2020  ne},.           
+00010da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010db0: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
+00010dc0: 793d 7365 6c66 2e63 6f6e 7665 7274 6f72  y=self.convertor
+00010dd0: 2e74 7261 6e73 5f6c 6f67 6769 6e67 286c  .trans_logging(l
+00010de0: 6f67 7374 6174 7573 292c 2065 7874 656e  ogstatus), exten
+00010df0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+00010e00: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
+00010e10: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+00010e20: 2020 6465 6620 6765 7442 7563 6b65 744c    def getBucketL
+00010e30: 6f67 6769 6e67 2873 656c 662c 2062 7563  ogging(self, buc
+00010e40: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
+00010e50: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
+00010e60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00010e70: 7365 6c66 2e5f 6d61 6b65 5f67 6574 5f72  self._make_get_r
+00010e80: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+00010e90: 652c 2070 6174 6841 7267 733d 7b27 6c6f  e, pathArgs={'lo
+00010ea0: 6767 696e 6727 3a20 4e6f 6e65 7d2c 206d  gging': None}, m
+00010eb0: 6574 686f 644e 616d 653d 2767 6574 4275  ethodName='getBu
+00010ec0: 636b 6574 4c6f 6767 696e 6727 2c0a 2020  cketLogging',.  
+00010ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ef0: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
+00010f00: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+00010f10: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
+00010f20: 6343 6163 6865 0a20 2020 2064 6566 2067  cCache.    def g
+00010f30: 6574 4275 636b 6574 5461 6767 696e 6728  etBucketTagging(
+00010f40: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+00010f50: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+00010f60: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+00010f70: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+00010f80: 616b 655f 6765 745f 7265 7175 6573 7428  ake_get_request(
+00010f90: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
+00010fa0: 4172 6773 3d7b 2774 6167 6769 6e67 273a  Args={'tagging':
+00010fb0: 204e 6f6e 657d 2c20 6d65 7468 6f64 4e61   None}, methodNa
+00010fc0: 6d65 3d27 6765 7442 7563 6b65 7454 6167  me='getBucketTag
+00010fd0: 6769 6e67 272c 0a20 2020 2020 2020 2020  ging',.         
+00010fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ff0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+00011000: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00011010: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+00011020: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+00011030: 2020 2020 6465 6620 7365 7442 7563 6b65      def setBucke
+00011040: 7454 6167 6769 6e67 2873 656c 662c 2062  tTagging(self, b
+00011050: 7563 6b65 744e 616d 652c 2074 6167 496e  ucketName, tagIn
+00011060: 666f 2c20 6578 7465 6e73 696f 6e48 6561  fo, extensionHea
+00011070: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+00011080: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
+00011090: 5f6e 6f74 5f6e 756c 6c28 7461 6749 6e66  _not_null(tagInf
+000110a0: 6f2c 2027 7461 6749 6e66 6f20 6973 2065  o, 'tagInfo is e
+000110b0: 6d70 7479 2729 0a20 2020 2020 2020 2072  mpty').        r
+000110c0: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+000110d0: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
+000110e0: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
+000110f0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+00011100: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
+00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011130: 2020 2a2a 7365 6c66 2e63 6f6e 7665 7274    **self.convert
+00011140: 6f72 2e74 7261 6e73 5f73 6574 5f62 7563  or.trans_set_buc
+00011150: 6b65 745f 7461 6767 696e 6728 7461 6749  ket_tagging(tagI
+00011160: 6e66 6f3d 7461 6749 6e66 6f29 290a 0a20  nfo=tagInfo)).. 
+00011170: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+00011180: 2020 6465 6620 6465 6c65 7465 4275 636b    def deleteBuck
+00011190: 6574 5461 6767 696e 6728 7365 6c66 2c20  etTagging(self, 
+000111a0: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
+000111b0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+000111c0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+000111d0: 726e 2073 656c 662e 5f6d 616b 655f 6465  rn self._make_de
+000111e0: 6c65 7465 5f72 6571 7565 7374 2862 7563  lete_request(buc
+000111f0: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
+00011200: 733d 7b27 7461 6767 696e 6727 3a20 4e6f  s={'tagging': No
+00011210: 6e65 7d2c 2065 7874 656e 7369 6f6e 4865  ne}, extensionHe
+00011220: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+00011230: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
+00011240: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+00011250: 7365 7442 7563 6b65 7443 6f72 7328 7365  setBucketCors(se
+00011260: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
+00011270: 636f 7273 5275 6c65 4c69 7374 2c20 6578  corsRuleList, ex
+00011280: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+00011290: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
+000112a0: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
+000112b0: 756c 6c28 636f 7273 5275 6c65 4c69 7374  ull(corsRuleList
+000112c0: 2c20 2763 6f72 7352 756c 654c 6973 7420  , 'corsRuleList 
+000112d0: 6973 2065 6d70 7479 2729 0a20 2020 2020  is empty').     
+000112e0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000112f0: 6d61 6b65 5f70 7574 5f72 6571 7565 7374  make_put_request
+00011300: 2862 7563 6b65 744e 616d 652c 2065 7874  (bucketName, ext
+00011310: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00011320: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
+00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011350: 2020 2020 2020 2a2a 7365 6c66 2e63 6f6e        **self.con
+00011360: 7665 7274 6f72 2e74 7261 6e73 5f73 6574  vertor.trans_set
+00011370: 5f62 7563 6b65 745f 636f 7273 2863 6f72  _bucket_cors(cor
+00011380: 7352 756c 654c 6973 743d 636f 7273 5275  sRuleList=corsRu
+00011390: 6c65 4c69 7374 2929 0a0a 2020 2020 4066  leList))..    @f
+000113a0: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+000113b0: 2064 656c 6574 6542 7563 6b65 7443 6f72   deleteBucketCor
+000113c0: 7328 7365 6c66 2c20 6275 636b 6574 4e61  s(self, bucketNa
+000113d0: 6d65 2c20 6578 7465 6e73 696f 6e48 6561  me, extensionHea
+000113e0: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+000113f0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00011400: 5f6d 616b 655f 6465 6c65 7465 5f72 6571  _make_delete_req
+00011410: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+00011420: 2070 6174 6841 7267 733d 7b27 636f 7273   pathArgs={'cors
+00011430: 273a 204e 6f6e 657d 2c20 6578 7465 6e73  ': None}, extens
+00011440: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00011450: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
+00011460: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+00011470: 2064 6566 2067 6574 4275 636b 6574 436f   def getBucketCo
+00011480: 7273 2873 656c 662c 2062 7563 6b65 744e  rs(self, bucketN
+00011490: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
+000114a0: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
+000114b0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000114c0: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
+000114d0: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
+000114e0: 6174 6841 7267 733d 7b27 636f 7273 273a  athArgs={'cors':
+000114f0: 204e 6f6e 657d 2c20 6d65 7468 6f64 4e61   None}, methodNa
+00011500: 6d65 3d27 6765 7442 7563 6b65 7443 6f72  me='getBucketCor
+00011510: 7327 2c0a 2020 2020 2020 2020 2020 2020  s',.            
+00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011530: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
+00011540: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00011550: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
+00011560: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+00011570: 2064 6566 206f 7074 696f 6e73 4275 636b   def optionsBuck
+00011580: 6574 2873 656c 662c 2062 7563 6b65 744e  et(self, bucketN
+00011590: 616d 652c 206f 7074 696f 6e2c 2065 7874  ame, option, ext
+000115a0: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+000115b0: 6e65 293a 0a20 2020 2020 2020 2072 6574  ne):.        ret
+000115c0: 7572 6e20 7365 6c66 2e6f 7074 696f 6e73  urn self.options
+000115d0: 4f62 6a65 6374 2862 7563 6b65 744e 616d  Object(bucketNam
+000115e0: 652c 204e 6f6e 652c 206f 7074 696f 6e3d  e, None, option=
+000115f0: 6f70 7469 6f6e 2c20 6578 7465 6e73 696f  option, extensio
+00011600: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+00011610: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
+00011620: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+00011630: 6566 2073 6574 4275 636b 6574 4e6f 7469  ef setBucketNoti
+00011640: 6669 6361 7469 6f6e 2873 656c 662c 2062  fication(self, b
+00011650: 7563 6b65 744e 616d 652c 206e 6f74 6966  ucketName, notif
+00011660: 6963 6174 696f 6e3d 4e6f 6e65 2c20 6578  ication=None, ex
+00011670: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+00011680: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
+00011690: 206e 6f74 6966 6963 6174 696f 6e20 6973   notification is
+000116a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000116b0: 2020 206e 6f74 6966 6963 6174 696f 6e20     notification 
+000116c0: 3d20 4e6f 7469 6669 6361 7469 6f6e 2829  = Notification()
+000116d0: 0a20 2020 2020 2020 2069 6620 6e6f 7469  .        if noti
+000116e0: 6669 6361 7469 6f6e 2069 7320 4e6f 6e65  fication is None
+000116f0: 3a0a 2020 2020 2020 2020 2020 2020 6e6f  :.            no
+00011700: 7469 6669 6361 7469 6f6e 203d 204e 6f74  tification = Not
+00011710: 6966 6963 6174 696f 6e28 290a 2020 2020  ification().    
+00011720: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00011730: 5f6d 616b 655f 7075 745f 7265 7175 6573  _make_put_reques
+00011740: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
+00011750: 7468 4172 6773 3d7b 276e 6f74 6966 6963  thArgs={'notific
+00011760: 6174 696f 6e27 3a20 4e6f 6e65 7d2c 0a20  ation': None},. 
 00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011780: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00011790: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-000117a0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-000117b0: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-000117c0: 650a 2020 2020 6465 6620 6765 7442 7563  e.    def getBuc
-000117d0: 6b65 744e 6f74 6966 6963 6174 696f 6e28  ketNotification(
-000117e0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
-000117f0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-00011800: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
-00011810: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
-00011820: 616b 655f 6765 745f 7265 7175 6573 7428  ake_get_request(
-00011830: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
-00011840: 4172 6773 3d7b 276e 6f74 6966 6963 6174  Args={'notificat
-00011850: 696f 6e27 3a20 4e6f 6e65 7d2c 206d 6574  ion': None}, met
-00011860: 686f 644e 616d 653d 2767 6574 4275 636b  hodName='getBuck
-00011870: 6574 4e6f 7469 6669 6361 7469 6f6e 272c  etNotification',
-00011880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118a0: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-000118b0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-000118c0: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
-000118d0: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-000118e0: 6620 6f70 7469 6f6e 734f 626a 6563 7428  f optionsObject(
-000118f0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
-00011900: 2c20 6f62 6a65 6374 4b65 792c 206f 7074  , objectKey, opt
-00011910: 696f 6e2c 2065 7874 656e 7369 6f6e 4865  ion, extensionHe
-00011920: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-00011930: 2020 2020 2068 6561 6465 7273 203d 207b       headers = {
-00011940: 7d0a 2020 2020 2020 2020 6966 206f 7074  }.        if opt
-00011950: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
-00011960: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00011970: 6f70 7469 6f6e 2e67 6574 2827 6f72 6967  option.get('orig
-00011980: 696e 2729 2069 7320 6e6f 7420 4e6f 6e65  in') is not None
-00011990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000119a0: 2020 6865 6164 6572 735b 636f 6e73 742e    headers[const.
-000119b0: 4f52 4947 494e 5f48 4541 4445 525d 203d  ORIGIN_HEADER] =
-000119c0: 2075 7469 6c2e 746f 5f73 7472 696e 6728   util.to_string(
-000119d0: 6f70 7469 6f6e 5b27 6f72 6967 696e 275d  option['origin']
-000119e0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000119f0: 206f 7074 696f 6e2e 6765 7428 2761 6363   option.get('acc
-00011a00: 6573 7343 6f6e 7472 6f6c 5265 7175 6573  essControlReques
-00011a10: 744d 6574 686f 6473 2729 2069 7320 6e6f  tMethods') is no
-00011a20: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00011a30: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
-00011a40: 636f 6e73 742e 4143 4345 5353 5f43 4f4e  const.ACCESS_CON
-00011a50: 5452 4f4c 5f52 4551 5545 5354 5f4d 4554  TROL_REQUEST_MET
-00011a60: 484f 445f 4845 4144 4552 5d20 3d20 6f70  HOD_HEADER] = op
-00011a70: 7469 6f6e 5b27 6163 6365 7373 436f 6e74  tion['accessCont
-00011a80: 726f 6c52 6571 7565 7374 4d65 7468 6f64  rolRequestMethod
-00011a90: 7327 5d0a 2020 2020 2020 2020 2020 2020  s'].            
-00011aa0: 6966 206f 7074 696f 6e2e 6765 7428 2761  if option.get('a
-00011ab0: 6363 6573 7343 6f6e 7472 6f6c 5265 7175  ccessControlRequ
-00011ac0: 6573 7448 6561 6465 7273 2729 2069 7320  estHeaders') is 
-00011ad0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00011ae0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00011af0: 735b 636f 6e73 742e 4143 4345 5353 5f43  s[const.ACCESS_C
-00011b00: 4f4e 5452 4f4c 5f52 4551 5545 5354 5f48  ONTROL_REQUEST_H
-00011b10: 4541 4445 5253 5f48 4541 4445 525d 203d  EADERS_HEADER] =
-00011b20: 206f 7074 696f 6e5b 2761 6363 6573 7343   option['accessC
-00011b30: 6f6e 7472 6f6c 5265 7175 6573 7448 6561  ontrolRequestHea
-00011b40: 6465 7273 275d 0a20 2020 2020 2020 2072  ders'].        r
-00011b50: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-00011b60: 5f6f 7074 696f 6e73 5f72 6571 7565 7374  _options_request
-00011b70: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
-00011b80: 6563 744b 6579 2c20 6865 6164 6572 733d  ectKey, headers=
-00011b90: 6865 6164 6572 732c 206d 6574 686f 644e  headers, methodN
-00011ba0: 616d 653d 276f 7074 696f 6e73 4275 636b  ame='optionsBuck
-00011bb0: 6574 272c 0a20 2020 2020 2020 2020 2020  et',.           
-00011bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00011be0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00011bf0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00011c00: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-00011c10: 650a 2020 2020 6465 6620 6765 744f 626a  e.    def getObj
-00011c20: 6563 744d 6574 6164 6174 6128 7365 6c66  ectMetadata(self
-00011c30: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
-00011c40: 6a65 6374 4b65 792c 2076 6572 7369 6f6e  jectKey, version
-00011c50: 4964 3d4e 6f6e 652c 2073 7365 4865 6164  Id=None, sseHead
-00011c60: 6572 3d4e 6f6e 652c 206f 7269 6769 6e3d  er=None, origin=
-00011c70: 4e6f 6e65 2c20 7265 7175 6573 7448 6561  None, requestHea
-00011c80: 6465 7273 3d4e 6f6e 652c 0a20 2020 2020  ders=None,.     
-00011c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ca0: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
-00011cb0: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-00011cc0: 2020 2020 2070 6174 6841 7267 7320 3d20       pathArgs = 
-00011cd0: 7b7d 0a20 2020 2020 2020 2069 6620 7665  {}.        if ve
-00011ce0: 7273 696f 6e49 643a 0a20 2020 2020 2020  rsionId:.       
-00011cf0: 2020 2020 2070 6174 6841 7267 735b 636f       pathArgs[co
-00011d00: 6e73 742e 5645 5253 494f 4e5f 4944 5f50  nst.VERSION_ID_P
-00011d10: 4152 414d 5d20 3d20 7574 696c 2e74 6f5f  ARAM] = util.to_
-00011d20: 7374 7269 6e67 2876 6572 7369 6f6e 4964  string(versionId
-00011d30: 290a 2020 2020 2020 2020 6865 6164 6572  ).        header
-00011d40: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
-00011d50: 6620 6f72 6967 696e 3a0a 2020 2020 2020  f origin:.      
-00011d60: 2020 2020 2020 6865 6164 6572 735b 636f        headers[co
-00011d70: 6e73 742e 4f52 4947 494e 5f48 4541 4445  nst.ORIGIN_HEADE
-00011d80: 525d 203d 2075 7469 6c2e 746f 5f73 7472  R] = util.to_str
-00011d90: 696e 6728 6f72 6967 696e 290a 2020 2020  ing(origin).    
-00011da0: 2020 2020 5f72 6571 7565 7374 4865 6164      _requestHead
-00011db0: 6572 7320 3d20 7265 7175 6573 7448 6561  ers = requestHea
-00011dc0: 6465 7273 5b30 5d20 6966 2069 7369 6e73  ders[0] if isins
-00011dd0: 7461 6e63 6528 7265 7175 6573 7448 6561  tance(requestHea
-00011de0: 6465 7273 2c20 6c69 7374 2920 616e 6420  ders, list) and 
-00011df0: 6c65 6e28 0a20 2020 2020 2020 2020 2020  len(.           
-00011e00: 2072 6571 7565 7374 4865 6164 6572 7329   requestHeaders)
-00011e10: 203d 3d20 3120 656c 7365 2072 6571 7565   == 1 else reque
-00011e20: 7374 4865 6164 6572 730a 2020 2020 2020  stHeaders.      
-00011e30: 2020 6966 205f 7265 7175 6573 7448 6561    if _requestHea
-00011e40: 6465 7273 3a0a 2020 2020 2020 2020 2020  ders:.          
-00011e50: 2020 6865 6164 6572 735b 636f 6e73 742e    headers[const.
-00011e60: 4143 4345 5353 5f43 4f4e 5452 4f4c 5f52  ACCESS_CONTROL_R
-00011e70: 4551 5545 5354 5f48 4541 4445 5253 5f48  EQUEST_HEADERS_H
-00011e80: 4541 4445 525d 203d 2075 7469 6c2e 746f  EADER] = util.to
-00011e90: 5f73 7472 696e 6728 5f72 6571 7565 7374  _string(_request
-00011ea0: 4865 6164 6572 7329 0a20 2020 2020 2020  Headers).       
-00011eb0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-00011ec0: 6b65 5f68 6561 645f 7265 7175 6573 7428  ke_head_request(
-00011ed0: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
-00011ee0: 6374 4b65 792c 2070 6174 6841 7267 733d  ctKey, pathArgs=
-00011ef0: 7061 7468 4172 6773 2c0a 2020 2020 2020  pathArgs,.      
-00011f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f20: 2068 6561 6465 7273 3d73 656c 662e 636f   headers=self.co
-00011f30: 6e76 6572 746f 722e 5f73 6574 5f73 7365  nvertor._set_sse
-00011f40: 5f68 6561 6465 7228 7373 6548 6561 6465  _header(sseHeade
-00011f50: 722c 2068 6561 6465 7273 3d68 6561 6465  r, headers=heade
-00011f60: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-00011f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011fb0: 2020 6f6e 6c79 5373 6543 4865 6164 6572    onlySseCHeader
-00011fc0: 3d54 7275 6529 2c0a 2020 2020 2020 2020  =True),.        
-00011fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011fe0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00011ff0: 6574 686f 644e 616d 653d 2767 6574 4f62  ethodName='getOb
-00012000: 6a65 6374 4d65 7461 6461 7461 272c 2065  jectMetadata', e
-00012010: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00012020: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00012030: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-00012040: 650a 2020 2020 6465 6620 7365 744f 626a  e.    def setObj
-00012050: 6563 744d 6574 6164 6174 6128 7365 6c66  ectMetadata(self
-00012060: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
-00012070: 6a65 6374 4b65 792c 206d 6574 6164 6174  jectKey, metadat
-00012080: 613d 4e6f 6e65 2c20 6865 6164 6572 733d  a=None, headers=
-00012090: 4e6f 6e65 2c20 7665 7273 696f 6e49 643d  None, versionId=
-000120a0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-000120b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120c0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-000120d0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-000120e0: 6966 2068 6561 6465 7273 2069 7320 4e6f  if headers is No
-000120f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00012100: 6865 6164 6572 7320 3d20 5365 744f 626a  headers = SetObj
-00012110: 6563 744d 6574 6164 6174 6148 6561 6465  ectMetadataHeade
-00012120: 7228 290a 0a20 2020 2020 2020 2072 6574  r()..        ret
-00012130: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f70  urn self._make_p
-00012140: 7574 5f72 6571 7565 7374 2862 7563 6b65  ut_request(bucke
-00012150: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
-00012160: 2c20 6d65 7468 6f64 4e61 6d65 3d27 7365  , methodName='se
-00012170: 744f 626a 6563 744d 6574 6164 6174 6127  tObjectMetadata'
-00012180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011790: 2020 2020 2065 6e74 6974 793d 7365 6c66       entity=self
+000117a0: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
+000117b0: 5f6e 6f74 6966 6963 6174 696f 6e28 6e6f  _notification(no
+000117c0: 7469 6669 6361 7469 6f6e 292c 0a20 2020  tification),.   
+000117d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117f0: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+00011800: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+00011810: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
+00011820: 4361 6368 650a 2020 2020 6465 6620 7265  Cache.    def re
+00011830: 6e61 6d65 4669 6c65 2873 656c 662c 2062  nameFile(self, b
+00011840: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+00011850: 744b 6579 2c20 6e65 774f 626a 6563 744b  tKey, newObjectK
+00011860: 6579 3d4e 6f6e 652c 2068 6561 6465 7273  ey=None, headers
+00011870: 3d52 656e 616d 6546 696c 6548 6561 6465  =RenameFileHeade
+00011880: 7228 292c 0a20 2020 2020 2020 2020 2020  r(),.           
+00011890: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
+000118a0: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
+000118b0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000118c0: 656c 662e 5f6d 616b 655f 706f 7374 5f72  elf._make_post_r
+000118d0: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+000118e0: 652c 206f 626a 6563 744b 6579 2c0a 2020  e, objectKey,.  
+000118f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011910: 2020 2020 2070 6174 6841 7267 733d 7b27       pathArgs={'
+00011920: 7265 6e61 6d65 273a 204e 6f6e 652c 2027  rename': None, '
+00011930: 6e61 6d65 273a 2075 7469 6c2e 746f 5f73  name': util.to_s
+00011940: 7472 696e 6728 6e65 774f 626a 6563 744b  tring(newObjectK
+00011950: 6579 297d 2c0a 2020 2020 2020 2020 2020  ey)},.          
+00011960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011970: 2020 2020 2020 2020 2020 2020 2068 6561               hea
+00011980: 6465 7273 3d68 6561 6465 7273 2c0a 2020  ders=headers,.  
+00011990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119b0: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+000119c0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+000119d0: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
+000119e0: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+000119f0: 6765 7442 7563 6b65 744e 6f74 6966 6963  getBucketNotific
+00011a00: 6174 696f 6e28 7365 6c66 2c20 6275 636b  ation(self, buck
+00011a10: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
+00011a20: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
+00011a30: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00011a40: 656c 662e 5f6d 616b 655f 6765 745f 7265  elf._make_get_re
+00011a50: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+00011a60: 2c20 7061 7468 4172 6773 3d7b 276e 6f74  , pathArgs={'not
+00011a70: 6966 6963 6174 696f 6e27 3a20 4e6f 6e65  ification': None
+00011a80: 7d2c 206d 6574 686f 644e 616d 653d 2767  }, methodName='g
+00011a90: 6574 4275 636b 6574 4e6f 7469 6669 6361  etBucketNotifica
+00011aa0: 7469 6f6e 272c 0a20 2020 2020 2020 2020  tion',.         
+00011ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ac0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+00011ad0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00011ae0: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+00011af0: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+00011b00: 2020 2020 6465 6620 6f70 7469 6f6e 734f      def optionsO
+00011b10: 626a 6563 7428 7365 6c66 2c20 6275 636b  bject(self, buck
+00011b20: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
+00011b30: 792c 206f 7074 696f 6e2c 2065 7874 656e  y, option, exten
+00011b40: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+00011b50: 293a 0a20 2020 2020 2020 2068 6561 6465  ):.        heade
+00011b60: 7273 203d 207b 7d0a 2020 2020 2020 2020  rs = {}.        
+00011b70: 6966 206f 7074 696f 6e20 6973 206e 6f74  if option is not
+00011b80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00011b90: 2020 2069 6620 6f70 7469 6f6e 2e67 6574     if option.get
+00011ba0: 2827 6f72 6967 696e 2729 2069 7320 6e6f  ('origin') is no
+00011bb0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00011bc0: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
+00011bd0: 636f 6e73 742e 4f52 4947 494e 5f48 4541  const.ORIGIN_HEA
+00011be0: 4445 525d 203d 2075 7469 6c2e 746f 5f73  DER] = util.to_s
+00011bf0: 7472 696e 6728 6f70 7469 6f6e 5b27 6f72  tring(option['or
+00011c00: 6967 696e 275d 290a 2020 2020 2020 2020  igin']).        
+00011c10: 2020 2020 6966 206f 7074 696f 6e2e 6765      if option.ge
+00011c20: 7428 2761 6363 6573 7343 6f6e 7472 6f6c  t('accessControl
+00011c30: 5265 7175 6573 744d 6574 686f 6473 2729  RequestMethods')
+00011c40: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00011c50: 2020 2020 2020 2020 2020 2020 2020 6865                he
+00011c60: 6164 6572 735b 636f 6e73 742e 4143 4345  aders[const.ACCE
+00011c70: 5353 5f43 4f4e 5452 4f4c 5f52 4551 5545  SS_CONTROL_REQUE
+00011c80: 5354 5f4d 4554 484f 445f 4845 4144 4552  ST_METHOD_HEADER
+00011c90: 5d20 3d20 6f70 7469 6f6e 5b27 6163 6365  ] = option['acce
+00011ca0: 7373 436f 6e74 726f 6c52 6571 7565 7374  ssControlRequest
+00011cb0: 4d65 7468 6f64 7327 5d0a 2020 2020 2020  Methods'].      
+00011cc0: 2020 2020 2020 6966 206f 7074 696f 6e2e        if option.
+00011cd0: 6765 7428 2761 6363 6573 7343 6f6e 7472  get('accessContr
+00011ce0: 6f6c 5265 7175 6573 7448 6561 6465 7273  olRequestHeaders
+00011cf0: 2729 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ') is not None:.
+00011d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d10: 6865 6164 6572 735b 636f 6e73 742e 4143  headers[const.AC
+00011d20: 4345 5353 5f43 4f4e 5452 4f4c 5f52 4551  CESS_CONTROL_REQ
+00011d30: 5545 5354 5f48 4541 4445 5253 5f48 4541  UEST_HEADERS_HEA
+00011d40: 4445 525d 203d 206f 7074 696f 6e5b 2761  DER] = option['a
+00011d50: 6363 6573 7343 6f6e 7472 6f6c 5265 7175  ccessControlRequ
+00011d60: 6573 7448 6561 6465 7273 275d 0a20 2020  estHeaders'].   
+00011d70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00011d80: 2e5f 6d61 6b65 5f6f 7074 696f 6e73 5f72  ._make_options_r
+00011d90: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+00011da0: 652c 206f 626a 6563 744b 6579 2c20 6865  e, objectKey, he
+00011db0: 6164 6572 733d 6865 6164 6572 732c 206d  aders=headers, m
+00011dc0: 6574 686f 644e 616d 653d 276f 7074 696f  ethodName='optio
+00011dd0: 6e73 4275 636b 6574 272c 0a20 2020 2020  nsBucket',.     
+00011de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e00: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+00011e10: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+00011e20: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
+00011e30: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+00011e40: 6765 744f 626a 6563 744d 6574 6164 6174  getObjectMetadat
+00011e50: 6128 7365 6c66 2c20 6275 636b 6574 4e61  a(self, bucketNa
+00011e60: 6d65 2c20 6f62 6a65 6374 4b65 792c 2076  me, objectKey, v
+00011e70: 6572 7369 6f6e 4964 3d4e 6f6e 652c 2073  ersionId=None, s
+00011e80: 7365 4865 6164 6572 3d4e 6f6e 652c 206f  seHeader=None, o
+00011e90: 7269 6769 6e3d 4e6f 6e65 2c20 7265 7175  rigin=None, requ
+00011ea0: 6573 7448 6561 6465 7273 3d4e 6f6e 652c  estHeaders=None,
+00011eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011ec0: 2020 2020 2020 2020 2020 2065 7874 656e             exten
+00011ed0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+00011ee0: 293a 0a20 2020 2020 2020 2070 6174 6841  ):.        pathA
+00011ef0: 7267 7320 3d20 7b7d 0a20 2020 2020 2020  rgs = {}.       
+00011f00: 2069 6620 7665 7273 696f 6e49 643a 0a20   if versionId:. 
+00011f10: 2020 2020 2020 2020 2020 2070 6174 6841             pathA
+00011f20: 7267 735b 636f 6e73 742e 5645 5253 494f  rgs[const.VERSIO
+00011f30: 4e5f 4944 5f50 4152 414d 5d20 3d20 7574  N_ID_PARAM] = ut
+00011f40: 696c 2e74 6f5f 7374 7269 6e67 2876 6572  il.to_string(ver
+00011f50: 7369 6f6e 4964 290a 2020 2020 2020 2020  sionId).        
+00011f60: 6865 6164 6572 7320 3d20 7b7d 0a20 2020  headers = {}.   
+00011f70: 2020 2020 2069 6620 6f72 6967 696e 3a0a       if origin:.
+00011f80: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00011f90: 6572 735b 636f 6e73 742e 4f52 4947 494e  ers[const.ORIGIN
+00011fa0: 5f48 4541 4445 525d 203d 2075 7469 6c2e  _HEADER] = util.
+00011fb0: 746f 5f73 7472 696e 6728 6f72 6967 696e  to_string(origin
+00011fc0: 290a 2020 2020 2020 2020 5f72 6571 7565  ).        _reque
+00011fd0: 7374 4865 6164 6572 7320 3d20 7265 7175  stHeaders = requ
+00011fe0: 6573 7448 6561 6465 7273 5b30 5d20 6966  estHeaders[0] if
+00011ff0: 2069 7369 6e73 7461 6e63 6528 7265 7175   isinstance(requ
+00012000: 6573 7448 6561 6465 7273 2c20 6c69 7374  estHeaders, list
+00012010: 2920 616e 6420 6c65 6e28 0a20 2020 2020  ) and len(.     
+00012020: 2020 2020 2020 2072 6571 7565 7374 4865         requestHe
+00012030: 6164 6572 7329 203d 3d20 3120 656c 7365  aders) == 1 else
+00012040: 2072 6571 7565 7374 4865 6164 6572 730a   requestHeaders.
+00012050: 2020 2020 2020 2020 6966 205f 7265 7175          if _requ
+00012060: 6573 7448 6561 6465 7273 3a0a 2020 2020  estHeaders:.    
+00012070: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
+00012080: 636f 6e73 742e 4143 4345 5353 5f43 4f4e  const.ACCESS_CON
+00012090: 5452 4f4c 5f52 4551 5545 5354 5f48 4541  TROL_REQUEST_HEA
+000120a0: 4445 5253 5f48 4541 4445 525d 203d 2075  DERS_HEADER] = u
+000120b0: 7469 6c2e 746f 5f73 7472 696e 6728 5f72  til.to_string(_r
+000120c0: 6571 7565 7374 4865 6164 6572 7329 0a20  equestHeaders). 
+000120d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000120e0: 6c66 2e5f 6d61 6b65 5f68 6561 645f 7265  lf._make_head_re
+000120f0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+00012100: 2c20 6f62 6a65 6374 4b65 792c 2070 6174  , objectKey, pat
+00012110: 6841 7267 733d 7061 7468 4172 6773 2c0a  hArgs=pathArgs,.
+00012120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012140: 2020 2020 2020 2068 6561 6465 7273 3d73         headers=s
+00012150: 656c 662e 636f 6e76 6572 746f 722e 5f73  elf.convertor._s
+00012160: 6574 5f73 7365 5f68 6561 6465 7228 7373  et_sse_header(ss
+00012170: 6548 6561 6465 722c 2068 6561 6465 7273  eHeader, headers
+00012180: 3d68 6561 6465 7273 2c0a 2020 2020 2020  =headers,.      
 00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121a0: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-000121b0: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-000121c0: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
-000121d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121f0: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
-00012200: 722e 7472 616e 735f 7365 745f 6f62 6a65  r.trans_set_obje
-00012210: 6374 5f6d 6574 6164 6174 6128 6d65 7461  ct_metadata(meta
-00012220: 6461 7461 3d6d 6574 6164 6174 612c 2068  data=metadata, h
-00012230: 6561 6465 7273 3d68 6561 6465 7273 2c0a  eaders=headers,.
-00012240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012290: 2076 6572 7369 6f6e 4964 3d76 6572 7369   versionId=versi
-000122a0: 6f6e 4964 2929 0a0a 2020 2020 4066 756e  onId))..    @fun
-000122b0: 6343 6163 6865 0a20 2020 2064 6566 2067  cCache.    def g
-000122c0: 6574 4f62 6a65 6374 2873 656c 662c 2062  etObject(self, b
-000122d0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-000122e0: 744b 6579 2c20 646f 776e 6c6f 6164 5061  tKey, downloadPa
-000122f0: 7468 3d4e 6f6e 652c 2067 6574 4f62 6a65  th=None, getObje
-00012300: 6374 5265 7175 6573 743d 4e6f 6e65 2c0a  ctRequest=None,.
-00012310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012320: 2020 6865 6164 6572 733d 4e6f 6e65 2c20    headers=None, 
-00012330: 6c6f 6164 5374 7265 616d 496e 4d65 6d6f  loadStreamInMemo
-00012340: 7279 3d46 616c 7365 2c20 7072 6f67 7265  ry=False, progre
-00012350: 7373 4361 6c6c 6261 636b 3d4e 6f6e 652c  ssCallback=None,
-00012360: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-00012370: 733d 4e6f 6e65 2c20 6e6f 7469 6669 6572  s=None, notifier
-00012380: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00012390: 6966 2067 6574 4f62 6a65 6374 5265 7175  if getObjectRequ
-000123a0: 6573 7420 6973 204e 6f6e 653a 0a20 2020  est is None:.   
-000123b0: 2020 2020 2020 2020 2067 6574 4f62 6a65           getObje
-000123c0: 6374 5265 7175 6573 7420 3d20 4765 744f  ctRequest = GetO
-000123d0: 626a 6563 7452 6571 7565 7374 2829 0a20  bjectRequest(). 
-000123e0: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-000123f0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00012400: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
-00012410: 2047 6574 4f62 6a65 6374 4865 6164 6572   GetObjectHeader
-00012420: 2829 0a20 2020 2020 2020 205f 7061 7273  ().        _pars
-00012430: 655f 636f 6e74 656e 7420 3d20 7365 6c66  e_content = self
-00012440: 2e5f 7061 7273 655f 636f 6e74 656e 740a  ._parse_content.
-00012450: 2020 2020 2020 2020 4348 554e 4b5f 5349          CHUNK_SI
-00012460: 5a45 203d 2073 656c 662e 6368 756e 6b5f  ZE = self.chunk_
-00012470: 7369 7a65 0a20 2020 2020 2020 2072 6561  size.        rea
-00012480: 6461 626c 6520 3d20 4661 6c73 6520 6966  dable = False if
-00012490: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-000124a0: 6b20 6973 204e 6f6e 6520 656c 7365 2054  k is None else T
-000124b0: 7275 650a 0a20 2020 2020 2020 2064 6566  rue..        def
-000124c0: 2070 6172 7365 4d65 7468 6f64 2863 6f6e   parseMethod(con
-000124d0: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
-000124e0: 7265 7375 6c74 203d 2063 6f6e 6e2e 6765  result = conn.ge
-000124f0: 7472 6573 706f 6e73 6528 290a 2020 2020  tresponse().    
-00012500: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-00012510: 7061 7273 655f 636f 6e74 656e 7428 6f62  parse_content(ob
-00012520: 6a65 6374 4b65 792c 2063 6f6e 6e2c 2072  jectKey, conn, r
-00012530: 6573 756c 742c 2064 6f77 6e6c 6f61 645f  esult, download_
-00012540: 7374 6172 743d 6865 6164 6572 732e 7261  start=headers.ra
-00012550: 6e67 652c 2064 6f77 6e6c 6f61 6450 6174  nge, downloadPat
-00012560: 683d 646f 776e 6c6f 6164 5061 7468 2c0a  h=downloadPath,.
-00012570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012590: 2020 6368 7563 6b53 697a 653d 4348 554e    chuckSize=CHUN
-000125a0: 4b5f 5349 5a45 2c20 6c6f 6164 5374 7265  K_SIZE, loadStre
-000125b0: 616d 496e 4d65 6d6f 7279 3d6c 6f61 6453  amInMemory=loadS
-000125c0: 7472 6561 6d49 6e4d 656d 6f72 792c 206e  treamInMemory, n
-000125d0: 6f74 6966 6965 723d 6e6f 7469 6669 6572  otifier=notifier
-000125e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000125f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012600: 2020 2020 7072 6f67 7265 7373 4361 6c6c      progressCall
-00012610: 6261 636b 3d70 726f 6772 6573 7343 616c  back=progressCal
-00012620: 6c62 6163 6b29 0a0a 2020 2020 2020 2020  lback)..        
-00012630: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-00012640: 655f 6765 745f 7265 7175 6573 7428 6275  e_get_request(bu
-00012650: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-00012660: 4b65 792c 2070 6172 7365 4d65 7468 6f64  Key, parseMethod
-00012670: 3d70 6172 7365 4d65 7468 6f64 2c20 7265  =parseMethod, re
-00012680: 6164 6162 6c65 3d72 6561 6461 626c 652c  adable=readable,
-00012690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000126a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126b0: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-000126c0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-000126d0: 6e48 6561 6465 7273 2c0a 2020 2020 2020  nHeaders,.      
-000126e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012700: 2a2a 7365 6c66 2e63 6f6e 7665 7274 6f72  **self.convertor
-00012710: 2e74 7261 6e73 5f67 6574 5f6f 626a 6563  .trans_get_objec
-00012720: 7428 6765 744f 626a 6563 7452 6571 7565  t(getObjectReque
-00012730: 7374 3d67 6574 4f62 6a65 6374 5265 7175  st=getObjectRequ
-00012740: 6573 742c 0a20 2020 2020 2020 2020 2020  est,.           
-00012750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012780: 2020 2020 2020 2020 2020 2020 2068 6561               hea
-00012790: 6465 7273 3d68 6561 6465 7273 2929 0a0a  ders=headers))..
-000127a0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-000127b0: 640a 2020 2020 6465 6620 5f70 7265 7061  d.    def _prepa
-000127c0: 7265 5f61 7070 656e 645f 6f62 6a65 6374  re_append_object
-000127d0: 5f69 6e70 7574 286f 626a 6563 744b 6579  _input(objectKey
-000127e0: 2c20 6865 6164 6572 732c 2063 6f6e 7465  , headers, conte
-000127f0: 6e74 293a 0a20 2020 2020 2020 206f 626a  nt):.        obj
-00012800: 6563 744b 6579 203d 2075 7469 6c2e 7361  ectKey = util.sa
-00012810: 6665 5f65 6e63 6f64 6528 6f62 6a65 6374  fe_encode(object
-00012820: 4b65 7929 0a20 2020 2020 2020 2069 6620  Key).        if 
-00012830: 6f62 6a65 6374 4b65 7920 6973 204e 6f6e  objectKey is Non
-00012840: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-00012850: 626a 6563 744b 6579 203d 2027 270a 0a20  bjectKey = ''.. 
-00012860: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-00012870: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00012880: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
-00012890: 2041 7070 656e 644f 626a 6563 7448 6561   AppendObjectHea
-000128a0: 6465 7228 290a 0a20 2020 2020 2020 2069  der()..        i
-000128b0: 6620 636f 6e74 656e 7420 6973 204e 6f6e  f content is Non
-000128c0: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-000128d0: 6f6e 7465 6e74 203d 2041 7070 656e 644f  ontent = AppendO
-000128e0: 626a 6563 7443 6f6e 7465 6e74 2829 0a0a  bjectContent()..
-000128f0: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
-00012900: 7273 2e67 6574 2827 636f 6e74 656e 7454  rs.get('contentT
-00012910: 7970 6527 2920 6973 204e 6f6e 653a 0a20  ype') is None:. 
-00012920: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-00012930: 7273 5b27 636f 6e74 656e 7454 7970 6527  rs['contentType'
-00012940: 5d20 3d20 636f 6e73 742e 4d49 4d45 5f54  ] = const.MIME_T
-00012950: 5950 4553 2e67 6574 286f 626a 6563 744b  YPES.get(objectK
-00012960: 6579 5b6f 626a 6563 744b 6579 2e72 6669  ey[objectKey.rfi
-00012970: 6e64 2827 2e27 2920 2b20 313a 5d2e 6c6f  nd('.') + 1:].lo
-00012980: 7765 7228 2929 0a0a 2020 2020 2020 2020  wer())..        
-00012990: 7265 7475 726e 206f 626a 6563 744b 6579  return objectKey
-000129a0: 2c20 6865 6164 6572 732c 2063 6f6e 7465  , headers, conte
-000129b0: 6e74 0a0a 2020 2020 6465 6620 5f70 7265  nt..    def _pre
-000129c0: 7061 7265 5f66 696c 655f 6e6f 7469 6669  pare_file_notifi
-000129d0: 6572 5f61 6e64 5f65 6e74 6974 7928 7365  er_and_entity(se
-000129e0: 6c66 2c20 6f66 6673 6574 2c20 6669 6c65  lf, offset, file
-000129f0: 5f73 697a 652c 2068 6561 6465 7273 2c20  _size, headers, 
-00012a00: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
-00012a10: 2c20 6669 6c65 5f70 6174 682c 2072 6561  , file_path, rea
-00012a20: 6461 626c 6529 3a0a 2020 2020 2020 2020  dable):.        
-00012a30: 6966 206f 6666 7365 7420 6973 206e 6f74  if offset is not
-00012a40: 204e 6f6e 6520 616e 6420 3020 3c20 6f66   None and 0 < of
-00012a50: 6673 6574 203c 2066 696c 655f 7369 7a65  fset < file_size
-00012a60: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
-00012a70: 6164 6572 735b 2763 6f6e 7465 6e74 4c65  aders['contentLe
-00012a80: 6e67 7468 275d 203d 2068 6561 6465 7273  ngth'] = headers
-00012a90: 5b27 636f 6e74 656e 744c 656e 6774 6827  ['contentLength'
-00012aa0: 5d20 6966 2030 203c 2068 6561 6465 7273  ] if 0 < headers
-00012ab0: 5b27 636f 6e74 656e 744c 656e 6774 6827  ['contentLength'
-00012ac0: 5d20 3c3d 2028 0a20 2020 2020 2020 2020  ] <= (.         
-00012ad0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00012ae0: 7369 7a65 202d 206f 6666 7365 7429 2065  size - offset) e
-00012af0: 6c73 6520 6669 6c65 5f73 697a 6520 2d20  lse file_size - 
-00012b00: 6f66 6673 6574 0a20 2020 2020 2020 2020  offset.         
-00012b10: 2020 2074 6f74 616c 436f 756e 7420 3d20     totalCount = 
-00012b20: 6865 6164 6572 735b 2763 6f6e 7465 6e74  headers['content
-00012b30: 4c65 6e67 7468 275d 0a20 2020 2020 2020  Length'].       
-00012b40: 2020 2020 2069 6620 746f 7461 6c43 6f75       if totalCou
-00012b50: 6e74 203e 2030 2061 6e64 2070 726f 6772  nt > 0 and progr
-00012b60: 6573 7343 616c 6c62 6163 6b20 6973 206e  essCallback is n
-00012b70: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00012b80: 2020 2020 2020 2020 2072 6561 6461 626c           readabl
-00012b90: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-00012ba0: 2020 2020 2020 2020 206e 6f74 6966 6965           notifie
-00012bb0: 7220 3d20 7072 6f67 7265 7373 2e50 726f  r = progress.Pro
-00012bc0: 6772 6573 734e 6f74 6966 6965 7228 7072  gressNotifier(pr
-00012bd0: 6f67 7265 7373 4361 6c6c 6261 636b 2c20  ogressCallback, 
-00012be0: 746f 7461 6c43 6f75 6e74 290a 2020 2020  totalCount).    
-00012bf0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00012c00: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00012c10: 7469 6669 6572 203d 2070 726f 6772 6573  tifier = progres
-00012c20: 732e 4e4f 4e45 5f4e 4f54 4946 4945 520a  s.NONE_NOTIFIER.
-00012c30: 2020 2020 2020 2020 2020 2020 7265 6164              read
-00012c40: 6162 6c65 5f6f 626a 6563 7420 3d20 7365  able_object = se
-00012c50: 6c66 2e67 656e 5f72 6561 6461 626c 655f  lf.gen_readable_
-00012c60: 6f62 6a65 6374 5f66 726f 6d5f 6669 6c65  object_from_file
-00012c70: 2866 696c 655f 7061 7468 290a 2020 2020  (file_path).    
-00012c80: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
-00012c90: 5f6f 626a 6563 742e 7365 656b 286f 6666  _object.seek(off
-00012ca0: 7365 7429 0a20 2020 2020 2020 2020 2020  set).           
-00012cb0: 2065 6e74 6974 7920 3d20 7574 696c 2e67   entity = util.g
-00012cc0: 6574 5f65 6e74 6974 795f 666f 725f 7365  et_entity_for_se
-00012cd0: 6e64 5f77 6974 685f 746f 7461 6c5f 636f  nd_with_total_co
-00012ce0: 756e 7428 7265 6164 6162 6c65 5f6f 626a  unt(readable_obj
-00012cf0: 6563 742c 2074 6f74 616c 436f 756e 742c  ect, totalCount,
-00012d00: 2073 656c 662e 6368 756e 6b5f 7369 7a65   self.chunk_size
-00012d10: 2c20 6e6f 7469 6669 6572 290a 2020 2020  , notifier).    
-00012d20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012d30: 2020 2020 2020 746f 7461 6c43 6f75 6e74        totalCount
-00012d40: 203d 2068 6561 6465 7273 5b27 636f 6e74   = headers['cont
-00012d50: 656e 744c 656e 6774 6827 5d0a 2020 2020  entLength'].    
-00012d60: 2020 2020 2020 2020 6966 2074 6f74 616c          if total
-00012d70: 436f 756e 7420 3e20 3020 616e 6420 7072  Count > 0 and pr
-00012d80: 6f67 7265 7373 4361 6c6c 6261 636b 2069  ogressCallback i
-00012d90: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00012da0: 2020 2020 2020 2020 2020 2020 7265 6164              read
-00012db0: 6162 6c65 203d 2054 7275 650a 2020 2020  able = True.    
-00012dc0: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
-00012dd0: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
-00012de0: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
-00012df0: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
-00012e00: 6b2c 2074 6f74 616c 436f 756e 7429 0a20  k, totalCount). 
-00012e10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00012e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012e30: 206e 6f74 6966 6965 7220 3d20 7072 6f67   notifier = prog
-00012e40: 7265 7373 2e4e 4f4e 455f 4e4f 5449 4649  ress.NONE_NOTIFI
-00012e50: 4552 0a20 2020 2020 2020 2020 2020 2072  ER.            r
-00012e60: 6561 6461 626c 655f 6f62 6a65 6374 203d  eadable_object =
-00012e70: 2073 656c 662e 6765 6e5f 7265 6164 6162   self.gen_readab
-00012e80: 6c65 5f6f 626a 6563 745f 6672 6f6d 5f66  le_object_from_f
-00012e90: 696c 6528 6669 6c65 5f70 6174 6829 0a20  ile(file_path). 
-00012ea0: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
-00012eb0: 7920 3d20 7574 696c 2e67 6574 5f65 6e74  y = util.get_ent
-00012ec0: 6974 795f 666f 725f 7365 6e64 5f77 6974  ity_for_send_wit
-00012ed0: 685f 746f 7461 6c5f 636f 756e 7428 7265  h_total_count(re
-00012ee0: 6164 6162 6c65 5f6f 626a 6563 742c 2074  adable_object, t
-00012ef0: 6f74 616c 436f 756e 742c 2073 656c 662e  otalCount, self.
-00012f00: 6368 756e 6b5f 7369 7a65 2c20 6e6f 7469  chunk_size, noti
-00012f10: 6669 6572 290a 0a20 2020 2020 2020 2072  fier)..        r
-00012f20: 6574 7572 6e20 6865 6164 6572 732c 2072  eturn headers, r
-00012f30: 6561 6461 626c 652c 206e 6f74 6966 6965  eadable, notifie
-00012f40: 722c 2065 6e74 6974 790a 0a20 2020 2064  r, entity..    d
-00012f50: 6566 205f 7072 6570 6172 655f 636f 6e74  ef _prepare_cont
-00012f60: 656e 745f 6e6f 7469 6669 6572 5f61 6e64  ent_notifier_and
-00012f70: 5f65 6e74 6974 7928 7365 6c66 2c20 656e  _entity(self, en
-00012f80: 7469 7479 2c20 6865 6164 6572 732c 2070  tity, headers, p
-00012f90: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
-00012fa0: 2061 7574 6f43 6c6f 7365 2c20 7265 6164   autoClose, read
-00012fb0: 6162 6c65 2c20 6368 756e 6b65 644d 6f64  able, chunkedMod
-00012fc0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00012fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ff0: 6e6f 7469 6669 6572 293a 0a20 2020 2020  notifier):.     
-00013000: 2020 2069 6620 656e 7469 7479 2069 7320     if entity is 
-00013010: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00013020: 2020 656e 7469 7479 203d 2027 270a 2020    entity = ''.  
-00013030: 2020 2020 2020 656c 6966 2068 6173 6174        elif hasat
-00013040: 7472 2865 6e74 6974 792c 2027 7265 6164  tr(entity, 'read
-00013050: 2729 2061 6e64 2063 616c 6c61 626c 6528  ') and callable(
-00013060: 656e 7469 7479 2e72 6561 6429 3a0a 2020  entity.read):.  
-00013070: 2020 2020 2020 2020 2020 7265 6164 6162            readab
-00013080: 6c65 203d 2054 7275 650a 2020 2020 2020  le = True.      
-00013090: 2020 2020 2020 6966 2068 6561 6465 7273        if headers
-000130a0: 2e67 6574 2827 636f 6e74 656e 744c 656e  .get('contentLen
-000130b0: 6774 6827 2920 6973 204e 6f6e 653a 0a20  gth') is None:. 
-000130c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000130d0: 6875 6e6b 6564 4d6f 6465 203d 2054 7275  hunkedMode = Tru
-000130e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000130f0: 2020 6e6f 7469 6669 6572 203d 2070 726f    notifier = pro
-00013100: 6772 6573 732e 5072 6f67 7265 7373 4e6f  gress.ProgressNo
-00013110: 7469 6669 6572 2870 726f 6772 6573 7343  tifier(progressC
-00013120: 616c 6c62 6163 6b2c 0a20 2020 2020 2020  allback,.       
-00013130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013150: 2020 2020 2020 2020 2020 2020 2020 2d31                -1
-00013160: 2920 6966 2070 726f 6772 6573 7343 616c  ) if progressCal
-00013170: 6c62 6163 6b20 6973 206e 6f74 204e 6f6e  lback is not Non
-00013180: 6520 656c 7365 2070 726f 6772 6573 732e  e else progress.
-00013190: 4e4f 4e45 5f4e 4f54 4946 4945 520a 2020  NONE_NOTIFIER.  
-000131a0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-000131b0: 7469 7479 203d 2075 7469 6c2e 6765 745f  tity = util.get_
-000131c0: 7265 6164 6162 6c65 5f65 6e74 6974 7928  readable_entity(
-000131d0: 656e 7469 7479 2c20 7365 6c66 2e63 6875  entity, self.chu
-000131e0: 6e6b 5f73 697a 652c 206e 6f74 6966 6965  nk_size, notifie
-000131f0: 722c 2061 7574 6f43 6c6f 7365 290a 2020  r, autoClose).  
-00013200: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00013210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013220: 746f 7461 6c43 6f75 6e74 203d 2075 7469  totalCount = uti
-00013230: 6c2e 746f 5f6c 6f6e 6728 6865 6164 6572  l.to_long(header
-00013240: 732e 6765 7428 2763 6f6e 7465 6e74 4c65  s.get('contentLe
-00013250: 6e67 7468 2729 290a 2020 2020 2020 2020  ngth')).        
-00013260: 2020 2020 2020 2020 6e6f 7469 6669 6572          notifier
-00013270: 203d 2070 726f 6772 6573 732e 5072 6f67   = progress.Prog
-00013280: 7265 7373 4e6f 7469 6669 6572 2870 726f  ressNotifier(pro
-00013290: 6772 6573 7343 616c 6c62 6163 6b2c 0a20  gressCallback,. 
-000132a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132d0: 2020 2020 746f 7461 6c43 6f75 6e74 2920      totalCount) 
-000132e0: 6966 2074 6f74 616c 436f 756e 7420 3e20  if totalCount > 
-000132f0: 3020 616e 6420 7072 6f67 7265 7373 4361  0 and progressCa
-00013300: 6c6c 6261 636b 2069 7320 6e6f 7420 4e6f  llback is not No
-00013310: 6e65 205c 0a20 2020 2020 2020 2020 2020  ne \.           
-00013320: 2020 2020 2020 2020 2065 6c73 6520 7072           else pr
-00013330: 6f67 7265 7373 2e4e 4f4e 455f 4e4f 5449  ogress.NONE_NOTI
-00013340: 4649 4552 0a20 2020 2020 2020 2020 2020  FIER.           
-00013350: 2020 2020 2065 6e74 6974 7920 3d20 7574       entity = ut
-00013360: 696c 2e67 6574 5f65 6e74 6974 795f 666f  il.get_entity_fo
-00013370: 725f 7365 6e64 5f77 6974 685f 746f 7461  r_send_with_tota
-00013380: 6c5f 636f 756e 7428 656e 7469 7479 2c20  l_count(entity, 
-00013390: 746f 7461 6c43 6f75 6e74 2c20 7365 6c66  totalCount, self
-000133a0: 2e63 6875 6e6b 5f73 697a 652c 206e 6f74  .chunk_size, not
-000133b0: 6966 6965 722c 0a20 2020 2020 2020 2020  ifier,.         
-000133c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133f0: 2020 2020 2020 2020 2020 6175 746f 436c            autoCl
-00013400: 6f73 6529 0a0a 2020 2020 2020 2020 7265  ose)..        re
-00013410: 7475 726e 2065 6e74 6974 792c 2072 6561  turn entity, rea
-00013420: 6461 626c 652c 2063 6875 6e6b 6564 4d6f  dable, chunkedMo
-00013430: 6465 2c20 6e6f 7469 6669 6572 0a0a 2020  de, notifier..  
-00013440: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-00013450: 2064 6566 2061 7070 656e 644f 626a 6563   def appendObjec
-00013460: 7428 7365 6c66 2c20 6275 636b 6574 4e61  t(self, bucketNa
-00013470: 6d65 2c20 6f62 6a65 6374 4b65 792c 2063  me, objectKey, c
-00013480: 6f6e 7465 6e74 3d4e 6f6e 652c 206d 6574  ontent=None, met
-00013490: 6164 6174 613d 4e6f 6e65 2c20 6865 6164  adata=None, head
-000134a0: 6572 733d 4e6f 6e65 2c20 7072 6f67 7265  ers=None, progre
-000134b0: 7373 4361 6c6c 6261 636b 3d4e 6f6e 652c  ssCallback=None,
-000134c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000134d0: 2020 2020 2020 6175 746f 436c 6f73 653d        autoClose=
-000134e0: 5472 7565 2c20 6578 7465 6e73 696f 6e48  True, extensionH
-000134f0: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-00013500: 2020 2020 2020 6f62 6a65 6374 4b65 792c        objectKey,
-00013510: 2068 6561 6465 7273 2c20 636f 6e74 656e   headers, conten
-00013520: 7420 3d20 7365 6c66 2e5f 7072 6570 6172  t = self._prepar
-00013530: 655f 6170 7065 6e64 5f6f 626a 6563 745f  e_append_object_
-00013540: 696e 7075 7428 6f62 6a65 6374 4b65 792c  input(objectKey,
-00013550: 2068 6561 6465 7273 2c20 636f 6e74 656e   headers, conten
-00013560: 7429 0a0a 2020 2020 2020 2020 6368 756e  t)..        chun
-00013570: 6b65 644d 6f64 6520 3d20 4661 6c73 650a  kedMode = False.
-00013580: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
-00013590: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000135a0: 206e 6f74 6966 6965 7220 3d20 4e6f 6e65   notifier = None
-000135b0: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-000135c0: 656e 742e 6765 7428 2769 7346 696c 6527  ent.get('isFile'
-000135d0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-000135e0: 696c 655f 7061 7468 203d 2073 656c 662e  ile_path = self.
-000135f0: 6368 6563 6b5f 6669 6c65 5f70 6174 6828  check_file_path(
-00013600: 636f 6e74 656e 742e 6765 7428 2763 6f6e  content.get('con
-00013610: 7465 6e74 2729 290a 0a20 2020 2020 2020  tent'))..       
-00013620: 2020 2020 2069 6620 6865 6164 6572 732e       if headers.
-00013630: 6765 7428 2763 6f6e 7465 6e74 5479 7065  get('contentType
-00013640: 2729 2069 7320 4e6f 6e65 3a0a 2020 2020  ') is None:.    
-00013650: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00013660: 6572 735b 2763 6f6e 7465 6e74 5479 7065  ers['contentType
-00013670: 275d 203d 2063 6f6e 7374 2e4d 494d 455f  '] = const.MIME_
-00013680: 5459 5045 532e 6765 7428 6669 6c65 5f70  TYPES.get(file_p
-00013690: 6174 685b 6669 6c65 5f70 6174 682e 7266  ath[file_path.rf
-000136a0: 696e 6428 272e 2729 202b 2031 3a5d 2e6c  ind('.') + 1:].l
-000136b0: 6f77 6572 2829 290a 0a20 2020 2020 2020  ower())..       
-000136c0: 2020 2020 2066 696c 655f 7369 7a65 203d       file_size =
-000136d0: 2075 7469 6c2e 746f 5f6c 6f6e 6728 6f73   util.to_long(os
-000136e0: 2e70 6174 682e 6765 7473 697a 6528 6669  .path.getsize(fi
-000136f0: 6c65 5f70 6174 6829 290a 2020 2020 2020  le_path)).      
-00013700: 2020 2020 2020 6865 6164 6572 735b 2763        headers['c
-00013710: 6f6e 7465 6e74 4c65 6e67 7468 275d 203d  ontentLength'] =
-00013720: 2075 7469 6c2e 746f 5f6c 6f6e 6728 6865   util.to_long(he
-00013730: 6164 6572 732e 6765 7428 2763 6f6e 7465  aders.get('conte
-00013740: 6e74 4c65 6e67 7468 2729 290a 2020 2020  ntLength')).    
-00013750: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
-00013760: 2763 6f6e 7465 6e74 4c65 6e67 7468 275d  'contentLength']
-00013770: 203d 2068 6561 6465 7273 5b27 636f 6e74   = headers['cont
-00013780: 656e 744c 656e 6774 6827 5d20 6966 2068  entLength'] if h
-00013790: 6561 6465 7273 2e67 6574 2827 636f 6e74  eaders.get('cont
-000137a0: 656e 744c 656e 6774 6827 2920 6973 206e  entLength') is n
-000137b0: 6f74 204e 6f6e 6520 616e 6420 6865 6164  ot None and head
-000137c0: 6572 735b 0a20 2020 2020 2020 2020 2020  ers[.           
-000137d0: 2020 2020 2027 636f 6e74 656e 744c 656e       'contentLen
-000137e0: 6774 6827 5d20 3c3d 2066 696c 655f 7369  gth'] <= file_si
-000137f0: 7a65 2065 6c73 6520 6669 6c65 5f73 697a  ze else file_siz
-00013800: 650a 2020 2020 2020 2020 2020 2020 6f66  e.            of
-00013810: 6673 6574 203d 2075 7469 6c2e 746f 5f6c  fset = util.to_l
-00013820: 6f6e 6728 636f 6e74 656e 742e 6765 7428  ong(content.get(
-00013830: 276f 6666 7365 7427 2929 0a20 2020 2020  'offset')).     
-00013840: 2020 2020 2020 2068 6561 6465 7273 2c20         headers, 
-00013850: 7265 6164 6162 6c65 2c20 6e6f 7469 6669  readable, notifi
-00013860: 6572 2c20 656e 7469 7479 203d 2073 656c  er, entity = sel
-00013870: 662e 5f70 7265 7061 7265 5f66 696c 655f  f._prepare_file_
-00013880: 6e6f 7469 6669 6572 5f61 6e64 5f65 6e74  notifier_and_ent
-00013890: 6974 7928 6f66 6673 6574 2c20 6669 6c65  ity(offset, file
-000138a0: 5f73 697a 652c 2068 6561 6465 7273 2c0a  _size, headers,.
-000138b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013900: 2020 2020 2020 2020 2070 726f 6772 6573           progres
-00013910: 7343 616c 6c62 6163 6b2c 2066 696c 655f  sCallback, file_
-00013920: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
-00013930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013970: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00013980: 6561 6461 626c 6529 0a20 2020 2020 2020  eadable).       
-00013990: 2020 2020 2068 6561 6465 7273 203d 2073       headers = s
-000139a0: 656c 662e 636f 6e76 6572 746f 722e 7472  elf.convertor.tr
-000139b0: 616e 735f 7075 745f 6f62 6a65 6374 286d  ans_put_object(m
-000139c0: 6574 6164 6174 613d 6d65 7461 6461 7461  etadata=metadata
-000139d0: 2c20 6865 6164 6572 733d 6865 6164 6572  , headers=header
-000139e0: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-000139f0: 656c 662e 6c6f 675f 636c 6965 6e74 2e6c  elf.log_client.l
-00013a00: 6f67 2844 4542 5547 2c20 2773 656e 6420  og(DEBUG, 'send 
-00013a10: 5061 7468 3a25 7327 2025 2066 696c 655f  Path:%s' % file_
-00013a20: 7061 7468 290a 2020 2020 2020 2020 656c  path).        el
-00013a30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00013a40: 656e 7469 7479 203d 2063 6f6e 7465 6e74  entity = content
-00013a50: 2e67 6574 2827 636f 6e74 656e 7427 290a  .get('content').
-00013a60: 2020 2020 2020 2020 2020 2020 656e 7469              enti
-00013a70: 7479 2c20 7265 6164 6162 6c65 2c20 6368  ty, readable, ch
-00013a80: 756e 6b65 644d 6f64 652c 206e 6f74 6966  unkedMode, notif
-00013a90: 6965 7220 3d20 7365 6c66 2e5f 7072 6570  ier = self._prep
-00013aa0: 6172 655f 636f 6e74 656e 745f 6e6f 7469  are_content_noti
-00013ab0: 6669 6572 5f61 6e64 5f65 6e74 6974 7928  fier_and_entity(
-00013ac0: 656e 7469 7479 2c20 6865 6164 6572 732c  entity, headers,
-00013ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000121a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121d0: 2020 2020 2020 2020 6f6e 6c79 5373 6543          onlySseC
+000121e0: 4865 6164 6572 3d54 7275 6529 2c0a 2020  Header=True),.  
+000121f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012210: 2020 2020 206d 6574 686f 644e 616d 653d       methodName=
+00012220: 2767 6574 4f62 6a65 6374 4d65 7461 6461  'getObjectMetada
+00012230: 7461 272c 2065 7874 656e 7369 6f6e 4865  ta', extensionHe
+00012240: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+00012250: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
+00012260: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+00012270: 7365 744f 626a 6563 744d 6574 6164 6174  setObjectMetadat
+00012280: 6128 7365 6c66 2c20 6275 636b 6574 4e61  a(self, bucketNa
+00012290: 6d65 2c20 6f62 6a65 6374 4b65 792c 206d  me, objectKey, m
+000122a0: 6574 6164 6174 613d 4e6f 6e65 2c20 6865  etadata=None, he
+000122b0: 6164 6572 733d 4e6f 6e65 2c20 7665 7273  aders=None, vers
+000122c0: 696f 6e49 643d 4e6f 6e65 2c0a 2020 2020  ionId=None,.    
+000122d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122e0: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
+000122f0: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
+00012300: 2020 2020 2020 6966 2068 6561 6465 7273        if headers
+00012310: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00012320: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+00012330: 5365 744f 626a 6563 744d 6574 6164 6174  SetObjectMetadat
+00012340: 6148 6561 6465 7228 290a 0a20 2020 2020  aHeader()..     
+00012350: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00012360: 6d61 6b65 5f70 7574 5f72 6571 7565 7374  make_put_request
+00012370: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
+00012380: 6563 744b 6579 2c20 6d65 7468 6f64 4e61  ectKey, methodNa
+00012390: 6d65 3d27 7365 744f 626a 6563 744d 6574  me='setObjectMet
+000123a0: 6164 6174 6127 2c0a 2020 2020 2020 2020  adata',.        
+000123b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123c0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000123d0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+000123e0: 7874 656e 7369 6f6e 4865 6164 6572 732c  xtensionHeaders,
+000123f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012410: 2020 2020 2020 202a 2a73 656c 662e 636f         **self.co
+00012420: 6e76 6572 746f 722e 7472 616e 735f 7365  nvertor.trans_se
+00012430: 745f 6f62 6a65 6374 5f6d 6574 6164 6174  t_object_metadat
+00012440: 6128 6d65 7461 6461 7461 3d6d 6574 6164  a(metadata=metad
+00012450: 6174 612c 2068 6561 6465 7273 3d68 6561  ata, headers=hea
+00012460: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
+00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124b0: 2020 2020 2020 2076 6572 7369 6f6e 4964         versionId
+000124c0: 3d76 6572 7369 6f6e 4964 2929 0a0a 2020  =versionId))..  
+000124d0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+000124e0: 2064 6566 2067 6574 4f62 6a65 6374 2873   def getObject(s
+000124f0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00012500: 206f 626a 6563 744b 6579 2c20 646f 776e   objectKey, down
+00012510: 6c6f 6164 5061 7468 3d4e 6f6e 652c 2067  loadPath=None, g
+00012520: 6574 4f62 6a65 6374 5265 7175 6573 743d  etObjectRequest=
+00012530: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+00012540: 2020 2020 2020 2020 6865 6164 6572 733d          headers=
+00012550: 4e6f 6e65 2c20 6c6f 6164 5374 7265 616d  None, loadStream
+00012560: 496e 4d65 6d6f 7279 3d46 616c 7365 2c20  InMemory=False, 
+00012570: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
+00012580: 3d4e 6f6e 652c 2065 7874 656e 7369 6f6e  =None, extension
+00012590: 4865 6164 6572 733d 4e6f 6e65 2c20 6e6f  Headers=None, no
+000125a0: 7469 6669 6572 3d4e 6f6e 6529 3a0a 2020  tifier=None):.  
+000125b0: 2020 2020 2020 6966 2067 6574 4f62 6a65        if getObje
+000125c0: 6374 5265 7175 6573 7420 6973 204e 6f6e  ctRequest is Non
+000125d0: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+000125e0: 6574 4f62 6a65 6374 5265 7175 6573 7420  etObjectRequest 
+000125f0: 3d20 4765 744f 626a 6563 7452 6571 7565  = GetObjectReque
+00012600: 7374 2829 0a20 2020 2020 2020 2069 6620  st().        if 
+00012610: 6865 6164 6572 7320 6973 204e 6f6e 653a  headers is None:
+00012620: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+00012630: 6465 7273 203d 2047 6574 4f62 6a65 6374  ders = GetObject
+00012640: 4865 6164 6572 2829 0a20 2020 2020 2020  Header().       
+00012650: 205f 7061 7273 655f 636f 6e74 656e 7420   _parse_content 
+00012660: 3d20 7365 6c66 2e5f 7061 7273 655f 636f  = self._parse_co
+00012670: 6e74 656e 740a 2020 2020 2020 2020 4348  ntent.        CH
+00012680: 554e 4b5f 5349 5a45 203d 2073 656c 662e  UNK_SIZE = self.
+00012690: 6368 756e 6b5f 7369 7a65 0a20 2020 2020  chunk_size.     
+000126a0: 2020 2072 6561 6461 626c 6520 3d20 4661     readable = Fa
+000126b0: 6c73 6520 6966 2070 726f 6772 6573 7343  lse if progressC
+000126c0: 616c 6c62 6163 6b20 6973 204e 6f6e 6520  allback is None 
+000126d0: 656c 7365 2054 7275 650a 0a20 2020 2020  else True..     
+000126e0: 2020 2064 6566 2070 6172 7365 4d65 7468     def parseMeth
+000126f0: 6f64 2863 6f6e 6e29 3a0a 2020 2020 2020  od(conn):.      
+00012700: 2020 2020 2020 7265 7375 6c74 203d 2063        result = c
+00012710: 6f6e 6e2e 6765 7472 6573 706f 6e73 6528  onn.getresponse(
+00012720: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00012730: 7475 726e 205f 7061 7273 655f 636f 6e74  turn _parse_cont
+00012740: 656e 7428 6f62 6a65 6374 4b65 792c 2063  ent(objectKey, c
+00012750: 6f6e 6e2c 2072 6573 756c 742c 2064 6f77  onn, result, dow
+00012760: 6e6c 6f61 645f 7374 6172 743d 6865 6164  nload_start=head
+00012770: 6572 732e 7261 6e67 652c 2064 6f77 6e6c  ers.range, downl
+00012780: 6f61 6450 6174 683d 646f 776e 6c6f 6164  oadPath=download
+00012790: 5061 7468 2c0a 2020 2020 2020 2020 2020  Path,.          
+000127a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127b0: 2020 2020 2020 2020 6368 7563 6b53 697a          chuckSiz
+000127c0: 653d 4348 554e 4b5f 5349 5a45 2c20 6c6f  e=CHUNK_SIZE, lo
+000127d0: 6164 5374 7265 616d 496e 4d65 6d6f 7279  adStreamInMemory
+000127e0: 3d6c 6f61 6453 7472 6561 6d49 6e4d 656d  =loadStreamInMem
+000127f0: 6f72 792c 206e 6f74 6966 6965 723d 6e6f  ory, notifier=no
+00012800: 7469 6669 6572 2c0a 2020 2020 2020 2020  tifier,.        
+00012810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012820: 2020 2020 2020 2020 2020 7072 6f67 7265            progre
+00012830: 7373 4361 6c6c 6261 636b 3d70 726f 6772  ssCallback=progr
+00012840: 6573 7343 616c 6c62 6163 6b29 0a0a 2020  essCallback)..  
+00012850: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00012860: 662e 5f6d 616b 655f 6765 745f 7265 7175  f._make_get_requ
+00012870: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+00012880: 6f62 6a65 6374 4b65 792c 2070 6172 7365  objectKey, parse
+00012890: 4d65 7468 6f64 3d70 6172 7365 4d65 7468  Method=parseMeth
+000128a0: 6f64 2c20 7265 6164 6162 6c65 3d72 6561  od, readable=rea
+000128b0: 6461 626c 652c 0a20 2020 2020 2020 2020  dable,.         
+000128c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128d0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+000128e0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+000128f0: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
+00012900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012920: 2020 2020 2020 2a2a 7365 6c66 2e63 6f6e        **self.con
+00012930: 7665 7274 6f72 2e74 7261 6e73 5f67 6574  vertor.trans_get
+00012940: 5f6f 626a 6563 7428 6765 744f 626a 6563  _object(getObjec
+00012950: 7452 6571 7565 7374 3d67 6574 4f62 6a65  tRequest=getObje
+00012960: 6374 5265 7175 6573 742c 0a20 2020 2020  ctRequest,.     
+00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129b0: 2020 2068 6561 6465 7273 3d68 6561 6465     headers=heade
+000129c0: 7273 2929 0a0a 2020 2020 4073 7461 7469  rs))..    @stati
+000129d0: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+000129e0: 5f70 7265 7061 7265 5f61 7070 656e 645f  _prepare_append_
+000129f0: 6f62 6a65 6374 5f69 6e70 7574 286f 626a  object_input(obj
+00012a00: 6563 744b 6579 2c20 6865 6164 6572 732c  ectKey, headers,
+00012a10: 2063 6f6e 7465 6e74 293a 0a20 2020 2020   content):.     
+00012a20: 2020 206f 626a 6563 744b 6579 203d 2075     objectKey = u
+00012a30: 7469 6c2e 7361 6665 5f65 6e63 6f64 6528  til.safe_encode(
+00012a40: 6f62 6a65 6374 4b65 7929 0a20 2020 2020  objectKey).     
+00012a50: 2020 2069 6620 6f62 6a65 6374 4b65 7920     if objectKey 
+00012a60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00012a70: 2020 2020 206f 626a 6563 744b 6579 203d       objectKey =
+00012a80: 2027 270a 0a20 2020 2020 2020 2069 6620   ''..        if 
+00012a90: 6865 6164 6572 7320 6973 204e 6f6e 653a  headers is None:
+00012aa0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+00012ab0: 6465 7273 203d 2041 7070 656e 644f 626a  ders = AppendObj
+00012ac0: 6563 7448 6561 6465 7228 290a 0a20 2020  ectHeader()..   
+00012ad0: 2020 2020 2069 6620 636f 6e74 656e 7420       if content 
+00012ae0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00012af0: 2020 2020 2063 6f6e 7465 6e74 203d 2041       content = A
+00012b00: 7070 656e 644f 626a 6563 7443 6f6e 7465  ppendObjectConte
+00012b10: 6e74 2829 0a0a 2020 2020 2020 2020 6966  nt()..        if
+00012b20: 2068 6561 6465 7273 2e67 6574 2827 636f   headers.get('co
+00012b30: 6e74 656e 7454 7970 6527 2920 6973 204e  ntentType') is N
+00012b40: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00012b50: 2068 6561 6465 7273 5b27 636f 6e74 656e   headers['conten
+00012b60: 7454 7970 6527 5d20 3d20 636f 6e73 742e  tType'] = const.
+00012b70: 4d49 4d45 5f54 5950 4553 2e67 6574 286f  MIME_TYPES.get(o
+00012b80: 626a 6563 744b 6579 5b6f 626a 6563 744b  bjectKey[objectK
+00012b90: 6579 2e72 6669 6e64 2827 2e27 2920 2b20  ey.rfind('.') + 
+00012ba0: 313a 5d2e 6c6f 7765 7228 2929 0a0a 2020  1:].lower())..  
+00012bb0: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
+00012bc0: 6563 744b 6579 2c20 6865 6164 6572 732c  ectKey, headers,
+00012bd0: 2063 6f6e 7465 6e74 0a0a 2020 2020 6465   content..    de
+00012be0: 6620 5f70 7265 7061 7265 5f66 696c 655f  f _prepare_file_
+00012bf0: 6e6f 7469 6669 6572 5f61 6e64 5f65 6e74  notifier_and_ent
+00012c00: 6974 7928 7365 6c66 2c20 6f66 6673 6574  ity(self, offset
+00012c10: 2c20 6669 6c65 5f73 697a 652c 2068 6561  , file_size, hea
+00012c20: 6465 7273 2c20 7072 6f67 7265 7373 4361  ders, progressCa
+00012c30: 6c6c 6261 636b 2c20 6669 6c65 5f70 6174  llback, file_pat
+00012c40: 682c 2072 6561 6461 626c 6529 3a0a 2020  h, readable):.  
+00012c50: 2020 2020 2020 6966 206f 6666 7365 7420        if offset 
+00012c60: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00012c70: 3020 3c20 6f66 6673 6574 203c 2066 696c  0 < offset < fil
+00012c80: 655f 7369 7a65 3a0a 2020 2020 2020 2020  e_size:.        
+00012c90: 2020 2020 6865 6164 6572 735b 2763 6f6e      headers['con
+00012ca0: 7465 6e74 4c65 6e67 7468 275d 203d 2068  tentLength'] = h
+00012cb0: 6561 6465 7273 5b27 636f 6e74 656e 744c  eaders['contentL
+00012cc0: 656e 6774 6827 5d20 6966 2030 203c 2068  ength'] if 0 < h
+00012cd0: 6561 6465 7273 5b27 636f 6e74 656e 744c  eaders['contentL
+00012ce0: 656e 6774 6827 5d20 3c3d 2028 0a20 2020  ength'] <= (.   
+00012cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d00: 2066 696c 655f 7369 7a65 202d 206f 6666   file_size - off
+00012d10: 7365 7429 2065 6c73 6520 6669 6c65 5f73  set) else file_s
+00012d20: 697a 6520 2d20 6f66 6673 6574 0a20 2020  ize - offset.   
+00012d30: 2020 2020 2020 2020 2074 6f74 616c 436f           totalCo
+00012d40: 756e 7420 3d20 6865 6164 6572 735b 2763  unt = headers['c
+00012d50: 6f6e 7465 6e74 4c65 6e67 7468 275d 0a20  ontentLength']. 
+00012d60: 2020 2020 2020 2020 2020 2069 6620 746f             if to
+00012d70: 7461 6c43 6f75 6e74 203e 2030 2061 6e64  talCount > 0 and
+00012d80: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
+00012d90: 6b20 6973 206e 6f74 204e 6f6e 653a 0a20  k is not None:. 
+00012da0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00012db0: 6561 6461 626c 6520 3d20 5472 7565 0a20  eadable = True. 
+00012dc0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00012dd0: 6f74 6966 6965 7220 3d20 7072 6f67 7265  otifier = progre
+00012de0: 7373 2e50 726f 6772 6573 734e 6f74 6966  ss.ProgressNotif
+00012df0: 6965 7228 7072 6f67 7265 7373 4361 6c6c  ier(progressCall
+00012e00: 6261 636b 2c20 746f 7461 6c43 6f75 6e74  back, totalCount
+00012e10: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00012e20: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00012e30: 2020 2020 6e6f 7469 6669 6572 203d 2070      notifier = p
+00012e40: 726f 6772 6573 732e 4e4f 4e45 5f4e 4f54  rogress.NONE_NOT
+00012e50: 4946 4945 520a 2020 2020 2020 2020 2020  IFIER.          
+00012e60: 2020 7265 6164 6162 6c65 5f6f 626a 6563    readable_objec
+00012e70: 7420 3d20 7365 6c66 2e67 656e 5f72 6561  t = self.gen_rea
+00012e80: 6461 626c 655f 6f62 6a65 6374 5f66 726f  dable_object_fro
+00012e90: 6d5f 6669 6c65 2866 696c 655f 7061 7468  m_file(file_path
+00012ea0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00012eb0: 6164 6162 6c65 5f6f 626a 6563 742e 7365  adable_object.se
+00012ec0: 656b 286f 6666 7365 7429 0a20 2020 2020  ek(offset).     
+00012ed0: 2020 2020 2020 2065 6e74 6974 7920 3d20         entity = 
+00012ee0: 7574 696c 2e67 6574 5f65 6e74 6974 795f  util.get_entity_
+00012ef0: 666f 725f 7365 6e64 5f77 6974 685f 746f  for_send_with_to
+00012f00: 7461 6c5f 636f 756e 7428 7265 6164 6162  tal_count(readab
+00012f10: 6c65 5f6f 626a 6563 742c 2074 6f74 616c  le_object, total
+00012f20: 436f 756e 742c 2073 656c 662e 6368 756e  Count, self.chun
+00012f30: 6b5f 7369 7a65 2c20 6e6f 7469 6669 6572  k_size, notifier
+00012f40: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00012f50: 2020 2020 2020 2020 2020 2020 746f 7461              tota
+00012f60: 6c43 6f75 6e74 203d 2068 6561 6465 7273  lCount = headers
+00012f70: 5b27 636f 6e74 656e 744c 656e 6774 6827  ['contentLength'
+00012f80: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00012f90: 2074 6f74 616c 436f 756e 7420 3e20 3020   totalCount > 0 
+00012fa0: 616e 6420 7072 6f67 7265 7373 4361 6c6c  and progressCall
+00012fb0: 6261 636b 2069 7320 6e6f 7420 4e6f 6e65  back is not None
+00012fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012fd0: 2020 7265 6164 6162 6c65 203d 2054 7275    readable = Tru
+00012fe0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00012ff0: 2020 6e6f 7469 6669 6572 203d 2070 726f    notifier = pro
+00013000: 6772 6573 732e 5072 6f67 7265 7373 4e6f  gress.ProgressNo
+00013010: 7469 6669 6572 2870 726f 6772 6573 7343  tifier(progressC
+00013020: 616c 6c62 6163 6b2c 2074 6f74 616c 436f  allback, totalCo
+00013030: 756e 7429 0a20 2020 2020 2020 2020 2020  unt).           
+00013040: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00013050: 2020 2020 2020 206e 6f74 6966 6965 7220         notifier 
+00013060: 3d20 7072 6f67 7265 7373 2e4e 4f4e 455f  = progress.NONE_
+00013070: 4e4f 5449 4649 4552 0a20 2020 2020 2020  NOTIFIER.       
+00013080: 2020 2020 2072 6561 6461 626c 655f 6f62       readable_ob
+00013090: 6a65 6374 203d 2073 656c 662e 6765 6e5f  ject = self.gen_
+000130a0: 7265 6164 6162 6c65 5f6f 626a 6563 745f  readable_object_
+000130b0: 6672 6f6d 5f66 696c 6528 6669 6c65 5f70  from_file(file_p
+000130c0: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
+000130d0: 2065 6e74 6974 7920 3d20 7574 696c 2e67   entity = util.g
+000130e0: 6574 5f65 6e74 6974 795f 666f 725f 7365  et_entity_for_se
+000130f0: 6e64 5f77 6974 685f 746f 7461 6c5f 636f  nd_with_total_co
+00013100: 756e 7428 7265 6164 6162 6c65 5f6f 626a  unt(readable_obj
+00013110: 6563 742c 2074 6f74 616c 436f 756e 742c  ect, totalCount,
+00013120: 2073 656c 662e 6368 756e 6b5f 7369 7a65   self.chunk_size
+00013130: 2c20 6e6f 7469 6669 6572 290a 0a20 2020  , notifier)..   
+00013140: 2020 2020 2072 6574 7572 6e20 6865 6164       return head
+00013150: 6572 732c 2072 6561 6461 626c 652c 206e  ers, readable, n
+00013160: 6f74 6966 6965 722c 2065 6e74 6974 790a  otifier, entity.
+00013170: 0a20 2020 2064 6566 205f 7072 6570 6172  .    def _prepar
+00013180: 655f 636f 6e74 656e 745f 6e6f 7469 6669  e_content_notifi
+00013190: 6572 5f61 6e64 5f65 6e74 6974 7928 7365  er_and_entity(se
+000131a0: 6c66 2c20 656e 7469 7479 2c20 6865 6164  lf, entity, head
+000131b0: 6572 732c 2070 726f 6772 6573 7343 616c  ers, progressCal
+000131c0: 6c62 6163 6b2c 2061 7574 6f43 6c6f 7365  lback, autoClose
+000131d0: 2c20 7265 6164 6162 6c65 2c20 6368 756e  , readable, chun
+000131e0: 6b65 644d 6f64 652c 0a20 2020 2020 2020  kedMode,.       
+000131f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013210: 2020 2020 2020 6e6f 7469 6669 6572 293a        notifier):
+00013220: 0a20 2020 2020 2020 2069 6620 656e 7469  .        if enti
+00013230: 7479 2069 7320 4e6f 6e65 3a0a 2020 2020  ty is None:.    
+00013240: 2020 2020 2020 2020 656e 7469 7479 203d          entity =
+00013250: 2027 270a 2020 2020 2020 2020 656c 6966   ''.        elif
+00013260: 2068 6173 6174 7472 2865 6e74 6974 792c   hasattr(entity,
+00013270: 2027 7265 6164 2729 2061 6e64 2063 616c   'read') and cal
+00013280: 6c61 626c 6528 656e 7469 7479 2e72 6561  lable(entity.rea
+00013290: 6429 3a0a 2020 2020 2020 2020 2020 2020  d):.            
+000132a0: 7265 6164 6162 6c65 203d 2054 7275 650a  readable = True.
+000132b0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+000132c0: 6561 6465 7273 2e67 6574 2827 636f 6e74  eaders.get('cont
+000132d0: 656e 744c 656e 6774 6827 2920 6973 204e  entLength') is N
+000132e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000132f0: 2020 2020 2063 6875 6e6b 6564 4d6f 6465       chunkedMode
+00013300: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00013310: 2020 2020 2020 2020 6e6f 7469 6669 6572          notifier
+00013320: 203d 2070 726f 6772 6573 732e 5072 6f67   = progress.Prog
+00013330: 7265 7373 4e6f 7469 6669 6572 2870 726f  ressNotifier(pro
+00013340: 6772 6573 7343 616c 6c62 6163 6b2c 0a20  gressCallback,. 
+00013350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013380: 2020 2020 2d31 2920 6966 2070 726f 6772      -1) if progr
+00013390: 6573 7343 616c 6c62 6163 6b20 6973 206e  essCallback is n
+000133a0: 6f74 204e 6f6e 6520 656c 7365 2070 726f  ot None else pro
+000133b0: 6772 6573 732e 4e4f 4e45 5f4e 4f54 4946  gress.NONE_NOTIF
+000133c0: 4945 520a 2020 2020 2020 2020 2020 2020  IER.            
+000133d0: 2020 2020 656e 7469 7479 203d 2075 7469      entity = uti
+000133e0: 6c2e 6765 745f 7265 6164 6162 6c65 5f65  l.get_readable_e
+000133f0: 6e74 6974 7928 656e 7469 7479 2c20 7365  ntity(entity, se
+00013400: 6c66 2e63 6875 6e6b 5f73 697a 652c 206e  lf.chunk_size, n
+00013410: 6f74 6966 6965 722c 2061 7574 6f43 6c6f  otifier, autoClo
+00013420: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+00013430: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00013440: 2020 2020 2020 746f 7461 6c43 6f75 6e74        totalCount
+00013450: 203d 2075 7469 6c2e 746f 5f6c 6f6e 6728   = util.to_long(
+00013460: 6865 6164 6572 732e 6765 7428 2763 6f6e  headers.get('con
+00013470: 7465 6e74 4c65 6e67 7468 2729 290a 2020  tentLength')).  
+00013480: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00013490: 7469 6669 6572 203d 2070 726f 6772 6573  tifier = progres
+000134a0: 732e 5072 6f67 7265 7373 4e6f 7469 6669  s.ProgressNotifi
+000134b0: 6572 2870 726f 6772 6573 7343 616c 6c62  er(progressCallb
+000134c0: 6163 6b2c 0a20 2020 2020 2020 2020 2020  ack,.           
+000134d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134f0: 2020 2020 2020 2020 2020 746f 7461 6c43            totalC
+00013500: 6f75 6e74 2920 6966 2074 6f74 616c 436f  ount) if totalCo
+00013510: 756e 7420 3e20 3020 616e 6420 7072 6f67  unt > 0 and prog
+00013520: 7265 7373 4361 6c6c 6261 636b 2069 7320  ressCallback is 
+00013530: 6e6f 7420 4e6f 6e65 205c 0a20 2020 2020  not None \.     
+00013540: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00013550: 6c73 6520 7072 6f67 7265 7373 2e4e 4f4e  lse progress.NON
+00013560: 455f 4e4f 5449 4649 4552 0a20 2020 2020  E_NOTIFIER.     
+00013570: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
+00013580: 7920 3d20 7574 696c 2e67 6574 5f65 6e74  y = util.get_ent
+00013590: 6974 795f 666f 725f 7365 6e64 5f77 6974  ity_for_send_wit
+000135a0: 685f 746f 7461 6c5f 636f 756e 7428 656e  h_total_count(en
+000135b0: 7469 7479 2c20 746f 7461 6c43 6f75 6e74  tity, totalCount
+000135c0: 2c20 7365 6c66 2e63 6875 6e6b 5f73 697a  , self.chunk_siz
+000135d0: 652c 206e 6f74 6966 6965 722c 0a20 2020  e, notifier,.   
+000135e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013620: 6175 746f 436c 6f73 6529 0a0a 2020 2020  autoClose)..    
+00013630: 2020 2020 7265 7475 726e 2065 6e74 6974      return entit
+00013640: 792c 2072 6561 6461 626c 652c 2063 6875  y, readable, chu
+00013650: 6e6b 6564 4d6f 6465 2c20 6e6f 7469 6669  nkedMode, notifi
+00013660: 6572 0a0a 2020 2020 4066 756e 6343 6163  er..    @funcCac
+00013670: 6865 0a20 2020 2064 6566 2061 7070 656e  he.    def appen
+00013680: 644f 626a 6563 7428 7365 6c66 2c20 6275  dObject(self, bu
+00013690: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
+000136a0: 4b65 792c 2063 6f6e 7465 6e74 3d4e 6f6e  Key, content=Non
+000136b0: 652c 206d 6574 6164 6174 613d 4e6f 6e65  e, metadata=None
+000136c0: 2c20 6865 6164 6572 733d 4e6f 6e65 2c20  , headers=None, 
+000136d0: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
+000136e0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+000136f0: 2020 2020 2020 2020 2020 2020 6175 746f              auto
+00013700: 436c 6f73 653d 5472 7565 2c20 6578 7465  Close=True, exte
+00013710: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+00013720: 6529 3a0a 2020 2020 2020 2020 6f62 6a65  e):.        obje
+00013730: 6374 4b65 792c 2068 6561 6465 7273 2c20  ctKey, headers, 
+00013740: 636f 6e74 656e 7420 3d20 7365 6c66 2e5f  content = self._
+00013750: 7072 6570 6172 655f 6170 7065 6e64 5f6f  prepare_append_o
+00013760: 626a 6563 745f 696e 7075 7428 6f62 6a65  bject_input(obje
+00013770: 6374 4b65 792c 2068 6561 6465 7273 2c20  ctKey, headers, 
+00013780: 636f 6e74 656e 7429 0a0a 2020 2020 2020  content)..      
+00013790: 2020 6368 756e 6b65 644d 6f64 6520 3d20    chunkedMode = 
+000137a0: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+000137b0: 6164 6162 6c65 203d 2046 616c 7365 0a20  adable = False. 
+000137c0: 2020 2020 2020 206e 6f74 6966 6965 7220         notifier 
+000137d0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+000137e0: 6620 636f 6e74 656e 742e 6765 7428 2769  f content.get('i
+000137f0: 7346 696c 6527 293a 0a20 2020 2020 2020  sFile'):.       
+00013800: 2020 2020 2066 696c 655f 7061 7468 203d       file_path =
+00013810: 2073 656c 662e 6368 6563 6b5f 6669 6c65   self.check_file
+00013820: 5f70 6174 6828 636f 6e74 656e 742e 6765  _path(content.ge
+00013830: 7428 2763 6f6e 7465 6e74 2729 290a 0a20  t('content')).. 
+00013840: 2020 2020 2020 2020 2020 2069 6620 6865             if he
+00013850: 6164 6572 732e 6765 7428 2763 6f6e 7465  aders.get('conte
+00013860: 6e74 5479 7065 2729 2069 7320 4e6f 6e65  ntType') is None
+00013870: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013880: 2020 6865 6164 6572 735b 2763 6f6e 7465    headers['conte
+00013890: 6e74 5479 7065 275d 203d 2063 6f6e 7374  ntType'] = const
+000138a0: 2e4d 494d 455f 5459 5045 532e 6765 7428  .MIME_TYPES.get(
+000138b0: 6669 6c65 5f70 6174 685b 6669 6c65 5f70  file_path[file_p
+000138c0: 6174 682e 7266 696e 6428 272e 2729 202b  ath.rfind('.') +
+000138d0: 2031 3a5d 2e6c 6f77 6572 2829 290a 0a20   1:].lower()).. 
+000138e0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+000138f0: 7369 7a65 203d 2075 7469 6c2e 746f 5f6c  size = util.to_l
+00013900: 6f6e 6728 6f73 2e70 6174 682e 6765 7473  ong(os.path.gets
+00013910: 697a 6528 6669 6c65 5f70 6174 6829 290a  ize(file_path)).
+00013920: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00013930: 6572 735b 2763 6f6e 7465 6e74 4c65 6e67  ers['contentLeng
+00013940: 7468 275d 203d 2075 7469 6c2e 746f 5f6c  th'] = util.to_l
+00013950: 6f6e 6728 6865 6164 6572 732e 6765 7428  ong(headers.get(
+00013960: 2763 6f6e 7465 6e74 4c65 6e67 7468 2729  'contentLength')
+00013970: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
+00013980: 6164 6572 735b 2763 6f6e 7465 6e74 4c65  aders['contentLe
+00013990: 6e67 7468 275d 203d 2068 6561 6465 7273  ngth'] = headers
+000139a0: 5b27 636f 6e74 656e 744c 656e 6774 6827  ['contentLength'
+000139b0: 5d20 6966 2068 6561 6465 7273 2e67 6574  ] if headers.get
+000139c0: 2827 636f 6e74 656e 744c 656e 6774 6827  ('contentLength'
+000139d0: 2920 6973 206e 6f74 204e 6f6e 6520 616e  ) is not None an
+000139e0: 6420 6865 6164 6572 735b 0a20 2020 2020  d headers[.     
+000139f0: 2020 2020 2020 2020 2020 2027 636f 6e74             'cont
+00013a00: 656e 744c 656e 6774 6827 5d20 3c3d 2066  entLength'] <= f
+00013a10: 696c 655f 7369 7a65 2065 6c73 6520 6669  ile_size else fi
+00013a20: 6c65 5f73 697a 650a 2020 2020 2020 2020  le_size.        
+00013a30: 2020 2020 6f66 6673 6574 203d 2075 7469      offset = uti
+00013a40: 6c2e 746f 5f6c 6f6e 6728 636f 6e74 656e  l.to_long(conten
+00013a50: 742e 6765 7428 276f 6666 7365 7427 2929  t.get('offset'))
+00013a60: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+00013a70: 6465 7273 2c20 7265 6164 6162 6c65 2c20  ders, readable, 
+00013a80: 6e6f 7469 6669 6572 2c20 656e 7469 7479  notifier, entity
+00013a90: 203d 2073 656c 662e 5f70 7265 7061 7265   = self._prepare
+00013aa0: 5f66 696c 655f 6e6f 7469 6669 6572 5f61  _file_notifier_a
+00013ab0: 6e64 5f65 6e74 6974 7928 6f66 6673 6574  nd_entity(offset
+00013ac0: 2c20 6669 6c65 5f73 697a 652c 2068 6561  , file_size, hea
+00013ad0: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
 00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b30: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-00013b40: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
+00013b20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00013b30: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
+00013b40: 2066 696c 655f 7061 7468 2c0a 2020 2020   file_path,.    
 00013b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ba0: 2020 2061 7574 6f43 6c6f 7365 2c20 7265     autoClose, re
-00013bb0: 6164 6162 6c65 2c0a 2020 2020 2020 2020  adable,.        
-00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c10: 2020 2020 2020 2020 6368 756e 6b65 644d          chunkedM
-00013c20: 6f64 652c 206e 6f74 6966 6965 7229 0a0a  ode, notifier)..
-00013c30: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00013c40: 6572 7320 3d20 7365 6c66 2e63 6f6e 7665  ers = self.conve
-00013c50: 7274 6f72 2e74 7261 6e73 5f70 7574 5f6f  rtor.trans_put_o
-00013c60: 626a 6563 7428 6d65 7461 6461 7461 3d6d  bject(metadata=m
-00013c70: 6574 6164 6174 612c 2068 6561 6465 7273  etadata, headers
-00013c80: 3d68 6561 6465 7273 290a 0a20 2020 2020  =headers)..     
-00013c90: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00013ca0: 2020 2020 6966 206e 6f74 6966 6965 7220      if notifier 
-00013cb0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00013cc0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-00013cd0: 6966 6965 722e 7374 6172 7428 290a 2020  ifier.start().  
-00013ce0: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
-00013cf0: 7365 6c66 2e5f 6d61 6b65 5f70 6f73 745f  self._make_post_
-00013d00: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
-00013d10: 6d65 2c20 6f62 6a65 6374 4b65 792c 2070  me, objectKey, p
-00013d20: 6174 6841 7267 733d 7b27 6170 7065 6e64  athArgs={'append
-00013d30: 273a 204e 6f6e 652c 2027 706f 7369 7469  ': None, 'positi
-00013d40: 6f6e 273a 2075 7469 6c2e 746f 5f73 7472  on': util.to_str
-00013d50: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-00013d60: 2020 2020 2063 6f6e 7465 6e74 5b27 706f       content['po
-00013d70: 7369 7469 6f6e 275d 2920 6966 2063 6f6e  sition']) if con
-00013d80: 7465 6e74 2e67 6574 2827 706f 7369 7469  tent.get('positi
-00013d90: 6f6e 2729 2069 7320 6e6f 7420 4e6f 6e65  on') is not None
-00013da0: 2065 6c73 6520 307d 2c0a 2020 2020 2020   else 0},.      
+00013ba0: 2020 2020 2072 6561 6461 626c 6529 0a20       readable). 
+00013bb0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00013bc0: 7273 203d 2073 656c 662e 636f 6e76 6572  rs = self.conver
+00013bd0: 746f 722e 7472 616e 735f 7075 745f 6f62  tor.trans_put_ob
+00013be0: 6a65 6374 286d 6574 6164 6174 613d 6d65  ject(metadata=me
+00013bf0: 7461 6461 7461 2c20 6865 6164 6572 733d  tadata, headers=
+00013c00: 6865 6164 6572 7329 0a20 2020 2020 2020  headers).       
+00013c10: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
+00013c20: 6965 6e74 2e6c 6f67 2844 4542 5547 2c20  ient.log(DEBUG, 
+00013c30: 2773 656e 6420 5061 7468 3a25 7327 2025  'send Path:%s' %
+00013c40: 2066 696c 655f 7061 7468 290a 2020 2020   file_path).    
+00013c50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00013c60: 2020 2020 2020 656e 7469 7479 203d 2063        entity = c
+00013c70: 6f6e 7465 6e74 2e67 6574 2827 636f 6e74  ontent.get('cont
+00013c80: 656e 7427 290a 2020 2020 2020 2020 2020  ent').          
+00013c90: 2020 656e 7469 7479 2c20 7265 6164 6162    entity, readab
+00013ca0: 6c65 2c20 6368 756e 6b65 644d 6f64 652c  le, chunkedMode,
+00013cb0: 206e 6f74 6966 6965 7220 3d20 7365 6c66   notifier = self
+00013cc0: 2e5f 7072 6570 6172 655f 636f 6e74 656e  ._prepare_conten
+00013cd0: 745f 6e6f 7469 6669 6572 5f61 6e64 5f65  t_notifier_and_e
+00013ce0: 6e74 6974 7928 656e 7469 7479 2c20 6865  ntity(entity, he
+00013cf0: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
+00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d50: 2020 2020 2020 2070 726f 6772 6573 7343         progressC
+00013d60: 616c 6c62 6163 6b2c 0a20 2020 2020 2020  allback,.       
+00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dd0: 2020 2020 6865 6164 6572 733d 6865 6164      headers=head
-00013de0: 6572 732c 2065 6e74 6974 793d 656e 7469  ers, entity=enti
-00013df0: 7479 2c20 6368 756e 6b65 644d 6f64 653d  ty, chunkedMode=
-00013e00: 6368 756e 6b65 644d 6f64 652c 0a20 2020  chunkedMode,.   
+00013dc0: 2020 2020 2020 2020 2061 7574 6f43 6c6f           autoClo
+00013dd0: 7365 2c20 7265 6164 6162 6c65 2c0a 2020  se, readable,.  
+00013de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e30: 2020 2020 2020 206d 6574 686f 644e 616d         methodNam
-00013e40: 653d 2761 7070 656e 644f 626a 6563 7427  e='appendObject'
-00013e50: 2c20 7265 6164 6162 6c65 3d72 6561 6461  , readable=reada
-00013e60: 626c 652c 0a20 2020 2020 2020 2020 2020  ble,.           
-00013e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00013e90: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00013ea0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00013eb0: 290a 2020 2020 2020 2020 6669 6e61 6c6c  ).        finall
-00013ec0: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
-00013ed0: 6620 6e6f 7469 6669 6572 2069 7320 6e6f  f notifier is no
-00013ee0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00013ef0: 2020 2020 2020 2020 6e6f 7469 6669 6572          notifier
-00013f00: 2e65 6e64 2829 0a20 2020 2020 2020 2073  .end().        s
-00013f10: 656c 662e 5f67 656e 6572 6174 655f 6f62  elf._generate_ob
-00013f20: 6a65 6374 5f75 726c 2872 6574 2c20 6275  ject_url(ret, bu
+00013e30: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00013e40: 756e 6b65 644d 6f64 652c 206e 6f74 6966  unkedMode, notif
+00013e50: 6965 7229 0a0a 2020 2020 2020 2020 2020  ier)..          
+00013e60: 2020 6865 6164 6572 7320 3d20 7365 6c66    headers = self
+00013e70: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
+00013e80: 5f70 7574 5f6f 626a 6563 7428 6d65 7461  _put_object(meta
+00013e90: 6461 7461 3d6d 6574 6164 6174 612c 2068  data=metadata, h
+00013ea0: 6561 6465 7273 3d68 6561 6465 7273 290a  eaders=headers).
+00013eb0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00013ec0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00013ed0: 6966 6965 7220 6973 206e 6f74 204e 6f6e  ifier is not Non
+00013ee0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00013ef0: 2020 206e 6f74 6966 6965 722e 7374 6172     notifier.star
+00013f00: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00013f10: 7265 7420 3d20 7365 6c66 2e5f 6d61 6b65  ret = self._make
+00013f20: 5f70 6f73 745f 7265 7175 6573 7428 6275  _post_request(bu
 00013f30: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-00013f40: 4b65 7929 0a20 2020 2020 2020 2072 6574  Key).        ret
-00013f50: 7572 6e20 7265 740a 0a20 2020 2040 6675  urn ret..    @fu
-00013f60: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-00013f70: 7075 7443 6f6e 7465 6e74 2873 656c 662c  putContent(self,
-00013f80: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
-00013f90: 6563 744b 6579 2c20 636f 6e74 656e 743d  ectKey, content=
-00013fa0: 4e6f 6e65 2c20 6d65 7461 6461 7461 3d4e  None, metadata=N
-00013fb0: 6f6e 652c 2068 6561 6465 7273 3d4e 6f6e  one, headers=Non
-00013fc0: 652c 2070 726f 6772 6573 7343 616c 6c62  e, progressCallb
-00013fd0: 6163 6b3d 4e6f 6e65 2c0a 2020 2020 2020  ack=None,.      
-00013fe0: 2020 2020 2020 2020 2020 2020 2061 7574               aut
-00013ff0: 6f43 6c6f 7365 3d54 7275 652c 2065 7874  oClose=True, ext
-00014000: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
-00014010: 6e65 293a 0a20 2020 2020 2020 206f 626a  ne):.        obj
-00014020: 6563 744b 6579 203d 2075 7469 6c2e 7361  ectKey = util.sa
-00014030: 6665 5f65 6e63 6f64 6528 6f62 6a65 6374  fe_encode(object
-00014040: 4b65 7929 0a20 2020 2020 2020 2069 6620  Key).        if 
-00014050: 6f62 6a65 6374 4b65 7920 6973 204e 6f6e  objectKey is Non
-00014060: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-00014070: 626a 6563 744b 6579 203d 2027 270a 2020  bjectKey = ''.  
-00014080: 2020 2020 2020 6966 2068 6561 6465 7273        if headers
-00014090: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000140a0: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
-000140b0: 5075 744f 626a 6563 7448 6561 6465 7228  PutObjectHeader(
-000140c0: 290a 2020 2020 2020 2020 6966 2068 6561  ).        if hea
-000140d0: 6465 7273 2e67 6574 2827 636f 6e74 656e  ders.get('conten
-000140e0: 7454 7970 6527 2920 6973 204e 6f6e 653a  tType') is None:
-000140f0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-00014100: 6465 7273 5b27 636f 6e74 656e 7454 7970  ders['contentTyp
-00014110: 6527 5d20 3d20 636f 6e73 742e 4d49 4d45  e'] = const.MIME
-00014120: 5f54 5950 4553 2e67 6574 286f 626a 6563  _TYPES.get(objec
-00014130: 744b 6579 5b6f 626a 6563 744b 6579 2e72  tKey[objectKey.r
-00014140: 6669 6e64 2827 2e27 2920 2b20 313a 5d2e  find('.') + 1:].
-00014150: 6c6f 7765 7228 2929 0a20 2020 2020 2020  lower()).       
-00014160: 205f 6865 6164 6572 7320 3d20 7365 6c66   _headers = self
-00014170: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
-00014180: 5f70 7574 5f6f 626a 6563 7428 6d65 7461  _put_object(meta
-00014190: 6461 7461 3d6d 6574 6164 6174 612c 2068  data=metadata, h
-000141a0: 6561 6465 7273 3d68 6561 6465 7273 290a  eaders=headers).
-000141b0: 0a20 2020 2020 2020 2072 6561 6461 626c  .        readabl
-000141c0: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
-000141d0: 2020 6368 756e 6b65 644d 6f64 6520 3d20    chunkedMode = 
-000141e0: 4661 6c73 650a 2020 2020 2020 2020 6e6f  False.        no
-000141f0: 7469 6669 6572 203d 204e 6f6e 650a 0a20  tifier = None.. 
-00014200: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00014210: 2020 2020 2020 2020 656e 7469 7479 203d          entity =
-00014220: 2063 6f6e 7465 6e74 0a20 2020 2020 2020   content.       
-00014230: 2020 2020 2069 6620 656e 7469 7479 2069       if entity i
-00014240: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00014250: 2020 2020 2020 2020 656e 7469 7479 203d          entity =
-00014260: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
-00014270: 656c 6966 2068 6173 6174 7472 2865 6e74  elif hasattr(ent
-00014280: 6974 792c 2027 7265 6164 2729 2061 6e64  ity, 'read') and
-00014290: 2063 616c 6c61 626c 6528 656e 7469 7479   callable(entity
-000142a0: 2e72 6561 6429 3a0a 2020 2020 2020 2020  .read):.        
-000142b0: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
-000142c0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000142d0: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
-000142e0: 7273 2e67 6574 2827 636f 6e74 656e 744c  rs.get('contentL
-000142f0: 656e 6774 6827 2920 6973 204e 6f6e 653a  ength') is None:
-00014300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014310: 2020 2020 2063 6875 6e6b 6564 4d6f 6465       chunkedMode
-00014320: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00014330: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
-00014340: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
-00014350: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
-00014360: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
-00014370: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
-00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143a0: 2020 2020 2020 2020 2020 2020 2d31 2920              -1) 
-000143b0: 6966 2070 726f 6772 6573 7343 616c 6c62  if progressCallb
-000143c0: 6163 6b20 6973 206e 6f74 204e 6f6e 6520  ack is not None 
-000143d0: 656c 7365 2070 726f 6772 6573 732e 4e4f  else progress.NO
-000143e0: 4e45 5f4e 4f54 4946 4945 520a 2020 2020  NE_NOTIFIER.    
-000143f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014400: 656e 7469 7479 203d 2075 7469 6c2e 6765  entity = util.ge
-00014410: 745f 7265 6164 6162 6c65 5f65 6e74 6974  t_readable_entit
-00014420: 7928 656e 7469 7479 2c20 7365 6c66 2e63  y(entity, self.c
-00014430: 6875 6e6b 5f73 697a 652c 206e 6f74 6966  hunk_size, notif
-00014440: 6965 722c 2061 7574 6f43 6c6f 7365 290a  ier, autoClose).
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00014470: 2020 2020 2020 2020 2020 746f 7461 6c43            totalC
-00014480: 6f75 6e74 203d 2075 7469 6c2e 746f 5f6c  ount = util.to_l
-00014490: 6f6e 6728 6865 6164 6572 732e 6765 7428  ong(headers.get(
-000144a0: 2763 6f6e 7465 6e74 4c65 6e67 7468 2729  'contentLength')
-000144b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000144c0: 2020 2020 2020 6e6f 7469 6669 6572 203d        notifier =
-000144d0: 2070 726f 6772 6573 732e 5072 6f67 7265   progress.Progre
-000144e0: 7373 4e6f 7469 6669 6572 2870 726f 6772  ssNotifier(progr
-000144f0: 6573 7343 616c 6c62 6163 6b2c 0a20 2020  essCallback,.   
-00014500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014530: 2020 2020 2020 746f 7461 6c43 6f75 6e74        totalCount
-00014540: 2920 6966 2074 6f74 616c 436f 756e 7420  ) if totalCount 
-00014550: 3e20 3020 616e 6420 7072 6f67 7265 7373  > 0 and progress
-00014560: 4361 6c6c 6261 636b 205c 0a20 2020 2020  Callback \.     
-00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f40: 4b65 792c 2070 6174 6841 7267 733d 7b27  Key, pathArgs={'
+00013f50: 6170 7065 6e64 273a 204e 6f6e 652c 2027  append': None, '
+00013f60: 706f 7369 7469 6f6e 273a 2075 7469 6c2e  position': util.
+00013f70: 746f 5f73 7472 696e 6728 0a20 2020 2020  to_string(.     
+00013f80: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
+00013f90: 6e74 5b27 706f 7369 7469 6f6e 275d 2920  nt['position']) 
+00013fa0: 6966 2063 6f6e 7465 6e74 2e67 6574 2827  if content.get('
+00013fb0: 706f 7369 7469 6f6e 2729 2069 7320 6e6f  position') is no
+00013fc0: 7420 4e6f 6e65 2065 6c73 6520 307d 2c0a  t None else 0},.
+00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ff0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00014000: 733d 6865 6164 6572 732c 2065 6e74 6974  s=headers, entit
+00014010: 793d 656e 7469 7479 2c20 6368 756e 6b65  y=entity, chunke
+00014020: 644d 6f64 653d 6368 756e 6b65 644d 6f64  dMode=chunkedMod
+00014030: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00014040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014050: 2020 2020 2020 2020 2020 2020 206d 6574               met
+00014060: 686f 644e 616d 653d 2761 7070 656e 644f  hodName='appendO
+00014070: 626a 6563 7427 2c20 7265 6164 6162 6c65  bject', readable
+00014080: 3d72 6561 6461 626c 652c 0a20 2020 2020  =readable,.     
+00014090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140b0: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+000140c0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+000140d0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
+000140e0: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+000140f0: 2020 2020 2069 6620 6e6f 7469 6669 6572       if notifier
+00014100: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00014110: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00014120: 7469 6669 6572 2e65 6e64 2829 0a20 2020  tifier.end().   
+00014130: 2020 2020 2073 656c 662e 5f67 656e 6572       self._gener
+00014140: 6174 655f 6f62 6a65 6374 5f75 726c 2872  ate_object_url(r
+00014150: 6574 2c20 6275 636b 6574 4e61 6d65 2c20  et, bucketName, 
+00014160: 6f62 6a65 6374 4b65 7929 0a20 2020 2020  objectKey).     
+00014170: 2020 2072 6574 7572 6e20 7265 740a 0a20     return ret.. 
+00014180: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+00014190: 2020 6465 6620 7075 7443 6f6e 7465 6e74    def putContent
+000141a0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+000141b0: 652c 206f 626a 6563 744b 6579 2c20 636f  e, objectKey, co
+000141c0: 6e74 656e 743d 4e6f 6e65 2c20 6d65 7461  ntent=None, meta
+000141d0: 6461 7461 3d4e 6f6e 652c 2068 6561 6465  data=None, heade
+000141e0: 7273 3d4e 6f6e 652c 2070 726f 6772 6573  rs=None, progres
+000141f0: 7343 616c 6c62 6163 6b3d 4e6f 6e65 2c0a  sCallback=None,.
+00014200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014210: 2020 2061 7574 6f43 6c6f 7365 3d54 7275     autoClose=Tru
+00014220: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+00014230: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+00014240: 2020 206f 626a 6563 744b 6579 203d 2075     objectKey = u
+00014250: 7469 6c2e 7361 6665 5f65 6e63 6f64 6528  til.safe_encode(
+00014260: 6f62 6a65 6374 4b65 7929 0a20 2020 2020  objectKey).     
+00014270: 2020 2069 6620 6f62 6a65 6374 4b65 7920     if objectKey 
+00014280: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00014290: 2020 2020 206f 626a 6563 744b 6579 203d       objectKey =
+000142a0: 2027 270a 2020 2020 2020 2020 6966 2068   ''.        if h
+000142b0: 6561 6465 7273 2069 7320 4e6f 6e65 3a0a  eaders is None:.
+000142c0: 2020 2020 2020 2020 2020 2020 6865 6164              head
+000142d0: 6572 7320 3d20 5075 744f 626a 6563 7448  ers = PutObjectH
+000142e0: 6561 6465 7228 290a 2020 2020 2020 2020  eader().        
+000142f0: 6966 2068 6561 6465 7273 2e67 6574 2827  if headers.get('
+00014300: 636f 6e74 656e 7454 7970 6527 2920 6973  contentType') is
+00014310: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00014320: 2020 2068 6561 6465 7273 5b27 636f 6e74     headers['cont
+00014330: 656e 7454 7970 6527 5d20 3d20 636f 6e73  entType'] = cons
+00014340: 742e 4d49 4d45 5f54 5950 4553 2e67 6574  t.MIME_TYPES.get
+00014350: 286f 626a 6563 744b 6579 5b6f 626a 6563  (objectKey[objec
+00014360: 744b 6579 2e72 6669 6e64 2827 2e27 2920  tKey.rfind('.') 
+00014370: 2b20 313a 5d2e 6c6f 7765 7228 2929 0a20  + 1:].lower()). 
+00014380: 2020 2020 2020 205f 6865 6164 6572 7320         _headers 
+00014390: 3d20 7365 6c66 2e63 6f6e 7665 7274 6f72  = self.convertor
+000143a0: 2e74 7261 6e73 5f70 7574 5f6f 626a 6563  .trans_put_objec
+000143b0: 7428 6d65 7461 6461 7461 3d6d 6574 6164  t(metadata=metad
+000143c0: 6174 612c 2068 6561 6465 7273 3d68 6561  ata, headers=hea
+000143d0: 6465 7273 290a 0a20 2020 2020 2020 2072  ders)..        r
+000143e0: 6561 6461 626c 6520 3d20 4661 6c73 650a  eadable = False.
+000143f0: 2020 2020 2020 2020 6368 756e 6b65 644d          chunkedM
+00014400: 6f64 6520 3d20 4661 6c73 650a 2020 2020  ode = False.    
+00014410: 2020 2020 6e6f 7469 6669 6572 203d 204e      notifier = N
+00014420: 6f6e 650a 0a20 2020 2020 2020 2074 7279  one..        try
+00014430: 3a0a 2020 2020 2020 2020 2020 2020 656e  :.            en
+00014440: 7469 7479 203d 2063 6f6e 7465 6e74 0a20  tity = content. 
+00014450: 2020 2020 2020 2020 2020 2069 6620 656e             if en
+00014460: 7469 7479 2069 7320 4e6f 6e65 3a0a 2020  tity is None:.  
+00014470: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00014480: 7469 7479 203d 2027 270a 2020 2020 2020  tity = ''.      
+00014490: 2020 2020 2020 656c 6966 2068 6173 6174        elif hasat
+000144a0: 7472 2865 6e74 6974 792c 2027 7265 6164  tr(entity, 'read
+000144b0: 2729 2061 6e64 2063 616c 6c61 626c 6528  ') and callable(
+000144c0: 656e 7469 7479 2e72 6561 6429 3a0a 2020  entity.read):.  
+000144d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000144e0: 6164 6162 6c65 203d 2054 7275 650a 2020  adable = True.  
+000144f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014500: 2068 6561 6465 7273 2e67 6574 2827 636f   headers.get('co
+00014510: 6e74 656e 744c 656e 6774 6827 2920 6973  ntentLength') is
+00014520: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00014530: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00014540: 6564 4d6f 6465 203d 2054 7275 650a 2020  edMode = True.  
+00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014560: 2020 6e6f 7469 6669 6572 203d 2070 726f    notifier = pro
+00014570: 6772 6573 732e 5072 6f67 7265 7373 4e6f  gress.ProgressNo
+00014580: 7469 6669 6572 2870 726f 6772 6573 7343  tifier(progressC
+00014590: 616c 6c62 6163 6b2c 0a20 2020 2020 2020  allback,.       
 000145a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145b0: 2020 2069 7320 6e6f 7420 4e6f 6e65 2065     is not None e
-000145c0: 6c73 6520 7072 6f67 7265 7373 2e4e 4f4e  lse progress.NON
-000145d0: 455f 4e4f 5449 4649 4552 0a20 2020 2020  E_NOTIFIER.     
-000145e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000145f0: 6e74 6974 7920 3d20 7574 696c 2e67 6574  ntity = util.get
-00014600: 5f65 6e74 6974 795f 666f 725f 7365 6e64  _entity_for_send
-00014610: 5f77 6974 685f 746f 7461 6c5f 636f 756e  _with_total_coun
-00014620: 7428 656e 7469 7479 2c20 746f 7461 6c43  t(entity, totalC
-00014630: 6f75 6e74 2c20 7365 6c66 2e63 6875 6e6b  ount, self.chunk
-00014640: 5f73 697a 652c 206e 6f74 6966 6965 722c  _size, notifier,
-00014650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014690: 2020 2020 2020 2020 6175 746f 436c 6f73          autoClos
-000146a0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-000146b0: 2020 2020 6e6f 7469 6669 6572 2e73 7461      notifier.sta
-000146c0: 7274 2829 0a20 2020 2020 2020 2020 2020  rt().           
-000146d0: 2072 6574 203d 2073 656c 662e 5f6d 616b   ret = self._mak
-000146e0: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
-000146f0: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-00014700: 4b65 792c 2068 6561 6465 7273 3d5f 6865  Key, headers=_he
-00014710: 6164 6572 732c 2065 6e74 6974 793d 656e  aders, entity=en
-00014720: 7469 7479 2c0a 2020 2020 2020 2020 2020  tity,.          
+000145b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145d0: 2020 2d31 2920 6966 2070 726f 6772 6573    -1) if progres
+000145e0: 7343 616c 6c62 6163 6b20 6973 206e 6f74  sCallback is not
+000145f0: 204e 6f6e 6520 656c 7365 2070 726f 6772   None else progr
+00014600: 6573 732e 4e4f 4e45 5f4e 4f54 4946 4945  ess.NONE_NOTIFIE
+00014610: 520a 2020 2020 2020 2020 2020 2020 2020  R.              
+00014620: 2020 2020 2020 656e 7469 7479 203d 2075        entity = u
+00014630: 7469 6c2e 6765 745f 7265 6164 6162 6c65  til.get_readable
+00014640: 5f65 6e74 6974 7928 656e 7469 7479 2c20  _entity(entity, 
+00014650: 7365 6c66 2e63 6875 6e6b 5f73 697a 652c  self.chunk_size,
+00014660: 206e 6f74 6966 6965 722c 2061 7574 6f43   notifier, autoC
+00014670: 6c6f 7365 290a 2020 2020 2020 2020 2020  lose).          
+00014680: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146a0: 746f 7461 6c43 6f75 6e74 203d 2075 7469  totalCount = uti
+000146b0: 6c2e 746f 5f6c 6f6e 6728 6865 6164 6572  l.to_long(header
+000146c0: 732e 6765 7428 2763 6f6e 7465 6e74 4c65  s.get('contentLe
+000146d0: 6e67 7468 2729 290a 2020 2020 2020 2020  ngth')).        
+000146e0: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+000146f0: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
+00014700: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
+00014710: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
+00014720: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
 00014730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014740: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00014750: 6875 6e6b 6564 4d6f 6465 3d63 6875 6e6b  hunkedMode=chunk
-00014760: 6564 4d6f 6465 2c20 6d65 7468 6f64 4e61  edMode, methodNa
-00014770: 6d65 3d27 7075 7443 6f6e 7465 6e74 272c  me='putContent',
-00014780: 2072 6561 6461 626c 653d 7265 6164 6162   readable=readab
-00014790: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00014740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014750: 2020 2020 2020 2020 2020 2020 746f 7461              tota
+00014760: 6c43 6f75 6e74 2920 6966 2074 6f74 616c  lCount) if total
+00014770: 436f 756e 7420 3e20 3020 616e 6420 7072  Count > 0 and pr
+00014780: 6f67 7265 7373 4361 6c6c 6261 636b 205c  ogressCallback \
+00014790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 000147a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147b0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-000147c0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-000147d0: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
-000147e0: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
-000147f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00014800: 6e6f 7469 6669 6572 2069 7320 6e6f 7420  notifier is not 
-00014810: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00014820: 2020 2020 2020 6e6f 7469 6669 6572 2e65        notifier.e
-00014830: 6e64 2829 0a20 2020 2020 2020 2073 656c  nd().        sel
-00014840: 662e 5f67 656e 6572 6174 655f 6f62 6a65  f._generate_obje
-00014850: 6374 5f75 726c 2872 6574 2c20 6275 636b  ct_url(ret, buck
-00014860: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-00014870: 7929 0a20 2020 2020 2020 2072 6574 7572  y).        retur
-00014880: 6e20 7265 740a 0a20 2020 2064 6566 2070  n ret..    def p
-00014890: 7574 4f62 6a65 6374 2873 656c 662c 2062  utObject(self, b
-000148a0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-000148b0: 744b 6579 2c20 636f 6e74 656e 742c 206d  tKey, content, m
-000148c0: 6574 6164 6174 613d 4e6f 6e65 2c20 6865  etadata=None, he
-000148d0: 6164 6572 733d 4e6f 6e65 2c20 7072 6f67  aders=None, prog
-000148e0: 7265 7373 4361 6c6c 6261 636b 3d4e 6f6e  ressCallback=Non
-000148f0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00014900: 2020 2020 2061 7574 6f43 6c6f 7365 3d54       autoClose=T
-00014910: 7275 652c 2065 7874 656e 7369 6f6e 4865  rue, extensionHe
-00014920: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-00014930: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00014940: 2e70 7574 436f 6e74 656e 7428 6275 636b  .putContent(buck
-00014950: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-00014960: 792c 2063 6f6e 7465 6e74 2c20 6d65 7461  y, content, meta
-00014970: 6461 7461 2c20 6865 6164 6572 732c 2070  data, headers, p
-00014980: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
-00014990: 2061 7574 6f43 6c6f 7365 2c0a 2020 2020   autoClose,.    
-000149a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149b0: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-000149c0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-000149d0: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
-000149e0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-000149f0: 2020 6465 6620 7075 7446 696c 6528 7365    def putFile(se
-00014a00: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-00014a10: 6f62 6a65 6374 4b65 792c 2066 696c 655f  objectKey, file_
-00014a20: 7061 7468 2c20 6d65 7461 6461 7461 3d4e  path, metadata=N
-00014a30: 6f6e 652c 2068 6561 6465 7273 3d4e 6f6e  one, headers=Non
-00014a40: 652c 2070 726f 6772 6573 7343 616c 6c62  e, progressCallb
-00014a50: 6163 6b3d 4e6f 6e65 2c0a 2020 2020 2020  ack=None,.      
-00014a60: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-00014a70: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-00014a80: 3a0a 2020 2020 2020 2020 6669 6c65 5f70  :.        file_p
-00014a90: 6174 6820 3d20 7365 6c66 2e63 6865 636b  ath = self.check
-00014aa0: 5f66 696c 655f 7061 7468 2866 696c 655f  _file_path(file_
-00014ab0: 7061 7468 290a 2020 2020 2020 2020 5f66  path).        _f
-00014ac0: 6c61 6720 3d20 6f73 2e70 6174 682e 6973  lag = os.path.is
-00014ad0: 6469 7228 6669 6c65 5f70 6174 6829 0a0a  dir(file_path)..
-00014ae0: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
-00014af0: 7273 2069 7320 4e6f 6e65 3a0a 2020 2020  rs is None:.    
-00014b00: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-00014b10: 3d20 5075 744f 626a 6563 7448 6561 6465  = PutObjectHeade
-00014b20: 7228 290a 2020 2020 2020 2020 6966 206d  r().        if m
-00014b30: 6574 6164 6174 6120 6973 204e 6f6e 653a  etadata is None:
-00014b40: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-00014b50: 6164 6174 6120 3d20 6469 6374 2829 0a0a  adata = dict()..
-00014b60: 2020 2020 2020 2020 6966 205f 666c 6167          if _flag
-00014b70: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
-00014b80: 6164 6572 735b 2763 6f6e 7465 6e74 4c65  aders['contentLe
-00014b90: 6e67 7468 275d 203d 204e 6f6e 650a 2020  ngth'] = None.  
-00014ba0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00014bb0: 735b 276d 6435 275d 203d 204e 6f6e 650a  s['md5'] = None.
-00014bc0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00014bd0: 6572 735b 2763 6f6e 7465 6e74 5479 7065  ers['contentType
-00014be0: 275d 203d 204e 6f6e 650a 0a20 2020 2020  '] = None..     
-00014bf0: 2020 2020 2020 2072 6573 756c 7473 203d         results =
-00014c00: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00014c10: 666f 7220 6620 696e 206f 732e 6c69 7374  for f in os.list
-00014c20: 6469 7228 6669 6c65 5f70 6174 6829 3a0a  dir(file_path):.
-00014c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c40: 6620 3d20 7574 696c 2e73 6166 655f 656e  f = util.safe_en
-00014c50: 636f 6465 2866 290a 2020 2020 2020 2020  code(f).        
-00014c60: 2020 2020 2020 2020 5f5f 6669 6c65 5f70          __file_p
-00014c70: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
-00014c80: 696e 2866 696c 655f 7061 7468 2c20 6629  in(file_path, f)
-00014c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ca0: 2069 6620 6e6f 7420 6f62 6a65 6374 4b65   if not objectKe
-00014cb0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00014cc0: 2020 2020 2020 206b 6579 203d 2075 7469         key = uti
-00014cd0: 6c2e 7361 6665 5f74 7261 6e73 5f74 6f5f  l.safe_trans_to_
-00014ce0: 6762 3233 3132 2827 7b30 7d2f 272e 666f  gb2312('{0}/'.fo
-00014cf0: 726d 6174 286f 732e 7061 7468 2e73 706c  rmat(os.path.spl
-00014d00: 6974 2866 696c 655f 7061 7468 295b 315d  it(file_path)[1]
-00014d10: 2920 2b20 6629 0a20 2020 2020 2020 2020  ) + f).         
-00014d20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00014d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d40: 206b 6579 203d 2027 7b30 7d2f 272e 666f   key = '{0}/'.fo
-00014d50: 726d 6174 286f 626a 6563 744b 6579 2920  rmat(objectKey) 
-00014d60: 2b20 7574 696c 2e73 6166 655f 7472 616e  + util.safe_tran
-00014d70: 735f 746f 5f67 6232 3331 3228 6629 0a20  s_to_gb2312(f). 
-00014d80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00014d90: 6573 756c 7420 3d20 7365 6c66 2e70 7574  esult = self.put
-00014da0: 4669 6c65 2862 7563 6b65 744e 616d 652c  File(bucketName,
-00014db0: 206b 6579 2c20 5f5f 6669 6c65 5f70 6174   key, __file_pat
-00014dc0: 682c 206d 6574 6164 6174 612c 2068 6561  h, metadata, hea
-00014dd0: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
-00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014df0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-00014e00: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
-00014e10: 656e 7369 6f6e 4865 6164 6572 7329 0a20  ensionHeaders). 
-00014e20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00014e30: 6573 756c 7473 2e61 7070 656e 6428 286b  esults.append((k
-00014e40: 6579 2c20 7265 7375 6c74 2929 0a20 2020  ey, result)).   
-00014e50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00014e60: 7265 7375 6c74 730a 0a20 2020 2020 2020  results..       
-00014e70: 2069 6620 6e6f 7420 6f62 6a65 6374 4b65   if not objectKe
-00014e80: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
-00014e90: 626a 6563 744b 6579 203d 206f 732e 7061  bjectKey = os.pa
-00014ea0: 7468 2e73 706c 6974 2866 696c 655f 7061  th.split(file_pa
-00014eb0: 7468 295b 315d 0a0a 2020 2020 2020 2020  th)[1]..        
-00014ec0: 7369 7a65 203d 2075 7469 6c2e 746f 5f6c  size = util.to_l
-00014ed0: 6f6e 6728 6f73 2e70 6174 682e 6765 7473  ong(os.path.gets
-00014ee0: 697a 6528 6669 6c65 5f70 6174 6829 290a  ize(file_path)).
-00014ef0: 0a20 2020 2020 2020 2068 6561 6465 7273  .        headers
-00014f00: 203d 2073 656c 662e 5f70 7574 4669 6c65   = self._putFile
-00014f10: 4861 6e64 6c65 4865 6164 6572 2868 6561  HandleHeader(hea
-00014f20: 6465 7273 2c20 7369 7a65 2c20 6f62 6a65  ders, size, obje
-00014f30: 6374 4b65 792c 2066 696c 655f 7061 7468  ctKey, file_path
-00014f40: 290a 0a20 2020 2020 2020 2072 6561 6461  )..        reada
-00014f50: 626c 655f 6f62 6a65 6374 203d 2073 656c  ble_object = sel
-00014f60: 662e 6765 6e5f 7265 6164 6162 6c65 5f6f  f.gen_readable_o
-00014f70: 626a 6563 745f 6672 6f6d 5f66 696c 6528  bject_from_file(
-00014f80: 6669 6c65 5f70 6174 6829 0a20 2020 2020  file_path).     
-00014f90: 2020 206d 6574 6164 6174 6120 3d20 7365     metadata = se
-00014fa0: 6c66 2e61 6464 5f6d 6574 6164 6174 615f  lf.add_metadata_
-00014fb0: 6672 6f6d 5f63 6f6e 7465 6e74 286d 6574  from_content(met
-00014fc0: 6164 6174 612c 2068 6561 6465 7273 2c20  adata, headers, 
-00014fd0: 7265 6164 6162 6c65 5f6f 626a 6563 7429  readable_object)
-00014fe0: 0a20 2020 2020 2020 205f 6865 6164 6572  .        _header
-00014ff0: 7320 3d20 7365 6c66 2e63 6f6e 7665 7274  s = self.convert
-00015000: 6f72 2e74 7261 6e73 5f70 7574 5f6f 626a  or.trans_put_obj
-00015010: 6563 7428 6d65 7461 6461 7461 3d6d 6574  ect(metadata=met
-00015020: 6164 6174 612c 2068 6561 6465 7273 3d68  adata, headers=h
-00015030: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
-00015040: 6966 2063 6f6e 7374 2e43 4f4e 5445 4e54  if const.CONTENT
-00015050: 5f4c 454e 4754 485f 4845 4144 4552 206e  _LENGTH_HEADER n
-00015060: 6f74 2069 6e20 5f68 6561 6465 7273 3a0a  ot in _headers:.
-00015070: 2020 2020 2020 2020 2020 2020 5f68 6561              _hea
-00015080: 6465 7273 5b63 6f6e 7374 2e43 4f4e 5445  ders[const.CONTE
-00015090: 4e54 5f4c 454e 4754 485f 4845 4144 4552  NT_LENGTH_HEADER
-000150a0: 5d20 3d20 7574 696c 2e74 6f5f 7374 7269  ] = util.to_stri
-000150b0: 6e67 2873 697a 6529 0a20 2020 2020 2020  ng(size).       
-000150c0: 2073 656c 662e 6c6f 675f 636c 6965 6e74   self.log_client
-000150d0: 2e6c 6f67 2844 4542 5547 2c20 2773 656e  .log(DEBUG, 'sen
-000150e0: 6420 5061 7468 3a25 7327 2025 2066 696c  d Path:%s' % fil
-000150f0: 655f 7061 7468 290a 0a20 2020 2020 2020  e_path)..       
-00015100: 2074 6f74 616c 436f 756e 7420 3d20 7574   totalCount = ut
-00015110: 696c 2e74 6f5f 6c6f 6e67 2868 6561 6465  il.to_long(heade
-00015120: 7273 5b27 636f 6e74 656e 744c 656e 6774  rs['contentLengt
-00015130: 6827 5d29 2069 6620 6865 6164 6572 732e  h']) if headers.
-00015140: 6765 7428 2763 6f6e 7465 6e74 4c65 6e67  get('contentLeng
-00015150: 7468 2729 2069 7320 6e6f 7420 4e6f 6e65  th') is not None
-00015160: 205c 0a20 2020 2020 2020 2020 2020 2065   \.            e
-00015170: 6c73 6520 6f73 2e70 6174 682e 6765 7473  lse os.path.gets
-00015180: 697a 6528 6669 6c65 5f70 6174 6829 0a20  ize(file_path). 
-00015190: 2020 2020 2020 2069 6620 746f 7461 6c43         if totalC
-000151a0: 6f75 6e74 203e 2030 2061 6e64 2070 726f  ount > 0 and pro
-000151b0: 6772 6573 7343 616c 6c62 6163 6b20 6973  gressCallback is
-000151c0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-000151d0: 2020 2020 2020 206e 6f74 6966 6965 7220         notifier 
-000151e0: 3d20 7072 6f67 7265 7373 2e50 726f 6772  = progress.Progr
-000151f0: 6573 734e 6f74 6966 6965 7228 7072 6f67  essNotifier(prog
-00015200: 7265 7373 4361 6c6c 6261 636b 2c20 746f  ressCallback, to
-00015210: 7461 6c43 6f75 6e74 290a 2020 2020 2020  talCount).      
-00015220: 2020 2020 2020 7265 6164 6162 6c65 203d        readable =
-00015230: 2054 7275 650a 2020 2020 2020 2020 656c   True.        el
-00015240: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00015250: 6e6f 7469 6669 6572 203d 2070 726f 6772  notifier = progr
-00015260: 6573 732e 4e4f 4e45 5f4e 4f54 4946 4945  ess.NONE_NOTIFIE
-00015270: 520a 2020 2020 2020 2020 2020 2020 7265  R.            re
-00015280: 6164 6162 6c65 203d 2046 616c 7365 0a0a  adable = False..
-00015290: 2020 2020 2020 2020 656e 7469 7479 203d          entity =
-000152a0: 2075 7469 6c2e 6765 745f 656e 7469 7479   util.get_entity
-000152b0: 5f66 6f72 5f73 656e 645f 7769 7468 5f74  _for_send_with_t
-000152c0: 6f74 616c 5f63 6f75 6e74 2872 6561 6461  otal_count(reada
-000152d0: 626c 655f 6f62 6a65 6374 2c20 746f 7461  ble_object, tota
-000152e0: 6c43 6f75 6e74 2c20 7365 6c66 2e63 6875  lCount, self.chu
-000152f0: 6e6b 5f73 697a 652c 206e 6f74 6966 6965  nk_size, notifie
-00015300: 7229 0a20 2020 2020 2020 2074 7279 3a0a  r).        try:.
-00015310: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
-00015320: 6669 6572 2e73 7461 7274 2829 0a20 2020  fier.start().   
-00015330: 2020 2020 2020 2020 2072 6574 203d 2073           ret = s
-00015340: 656c 662e 5f6d 616b 655f 7075 745f 7265  elf._make_put_re
-00015350: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
-00015360: 2c20 6f62 6a65 6374 4b65 792c 2068 6561  , objectKey, hea
-00015370: 6465 7273 3d5f 6865 6164 6572 732c 2065  ders=_headers, e
-00015380: 6e74 6974 793d 656e 7469 7479 2c0a 2020  ntity=entity,.  
-00015390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153b0: 2020 2020 2020 206d 6574 686f 644e 616d         methodNam
-000153c0: 653d 2770 7574 436f 6e74 656e 7427 2c20  e='putContent', 
-000153d0: 7265 6164 6162 6c65 3d72 6561 6461 626c  readable=readabl
-000153e0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-000153f0: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-00015400: 6465 7273 290a 2020 2020 2020 2020 6669  ders).        fi
-00015410: 6e61 6c6c 793a 0a20 2020 2020 2020 2020  nally:.         
-00015420: 2020 206e 6f74 6966 6965 722e 656e 6428     notifier.end(
-00015430: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-00015440: 6765 6e65 7261 7465 5f6f 626a 6563 745f  generate_object_
-00015450: 7572 6c28 7265 742c 2062 7563 6b65 744e  url(ret, bucketN
-00015460: 616d 652c 206f 626a 6563 744b 6579 290a  ame, objectKey).
-00015470: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00015480: 6574 0a0a 2020 2020 4073 7461 7469 636d  et..    @staticm
-00015490: 6574 686f 640a 2020 2020 6465 6620 6164  ethod.    def ad
-000154a0: 645f 6d65 7461 6461 7461 5f66 726f 6d5f  d_metadata_from_
-000154b0: 636f 6e74 656e 7428 6d65 7461 6461 7461  content(metadata
-000154c0: 2c20 6865 6164 6572 732c 2063 6f6e 7465  , headers, conte
-000154d0: 6e74 293a 0a20 2020 2020 2020 2072 6574  nt):.        ret
-000154e0: 7572 6e20 6d65 7461 6461 7461 0a0a 2020  urn metadata..  
-000154f0: 2020 6465 6620 6765 6e5f 7265 6164 6162    def gen_readab
-00015500: 6c65 5f6f 626a 6563 745f 6672 6f6d 5f66  le_object_from_f
-00015510: 696c 6528 7365 6c66 2c20 6669 6c65 5f70  ile(self, file_p
-00015520: 6174 6829 3a0a 2020 2020 2020 2020 7265  ath):.        re
-00015530: 7475 726e 206f 7065 6e28 6669 6c65 5f70  turn open(file_p
-00015540: 6174 682c 2022 7262 2229 0a0a 2020 2020  ath, "rb")..    
-00015550: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-00015560: 2020 6465 6620 5f70 7574 4669 6c65 4861    def _putFileHa
-00015570: 6e64 6c65 4865 6164 6572 2868 6561 6465  ndleHeader(heade
-00015580: 7273 2c20 7369 7a65 2c20 6f62 6a65 6374  rs, size, object
-00015590: 4b65 792c 2066 696c 655f 7061 7468 293a  Key, file_path):
-000155a0: 0a20 2020 2020 2020 2068 6561 6465 7273  .        headers
-000155b0: 5b27 636f 6e74 656e 744c 656e 6774 6827  ['contentLength'
-000155c0: 5d20 3d20 7574 696c 2e74 6f5f 6c6f 6e67  ] = util.to_long
-000155d0: 2868 6561 6465 7273 2e67 6574 2827 636f  (headers.get('co
-000155e0: 6e74 656e 744c 656e 6774 6827 2929 0a20  ntentLength')). 
-000155f0: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-00015600: 732e 6765 7428 2763 6f6e 7465 6e74 4c65  s.get('contentLe
-00015610: 6e67 7468 2729 2069 7320 6e6f 7420 4e6f  ngth') is not No
-00015620: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00015630: 6865 6164 6572 735b 2763 6f6e 7465 6e74  headers['content
-00015640: 4c65 6e67 7468 275d 203d 2073 697a 6520  Length'] = size 
-00015650: 6966 2068 6561 6465 7273 5b27 636f 6e74  if headers['cont
-00015660: 656e 744c 656e 6774 6827 5d20 3e20 7369  entLength'] > si
-00015670: 7a65 2065 6c73 6520 6865 6164 6572 735b  ze else headers[
-00015680: 2763 6f6e 7465 6e74 4c65 6e67 7468 275d  'contentLength']
-00015690: 0a0a 2020 2020 2020 2020 6966 2068 6561  ..        if hea
-000156a0: 6465 7273 2e67 6574 2827 636f 6e74 656e  ders.get('conten
-000156b0: 7454 7970 6527 2920 6973 204e 6f6e 653a  tType') is None:
-000156c0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-000156d0: 6465 7273 5b27 636f 6e74 656e 7454 7970  ders['contentTyp
-000156e0: 6527 5d20 3d20 636f 6e73 742e 4d49 4d45  e'] = const.MIME
-000156f0: 5f54 5950 4553 2e67 6574 286f 626a 6563  _TYPES.get(objec
-00015700: 744b 6579 5b6f 626a 6563 744b 6579 2e72  tKey[objectKey.r
-00015710: 6669 6e64 2827 2e27 2920 2b20 313a 5d2e  find('.') + 1:].
-00015720: 6c6f 7765 7228 2929 0a0a 2020 2020 2020  lower())..      
-00015730: 2020 6966 2068 6561 6465 7273 2e67 6574    if headers.get
-00015740: 2827 636f 6e74 656e 7454 7970 6527 2920  ('contentType') 
-00015750: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00015760: 2020 2020 2068 6561 6465 7273 5b27 636f       headers['co
-00015770: 6e74 656e 7454 7970 6527 5d20 3d20 636f  ntentType'] = co
-00015780: 6e73 742e 4d49 4d45 5f54 5950 4553 2e67  nst.MIME_TYPES.g
-00015790: 6574 2866 696c 655f 7061 7468 5b66 696c  et(file_path[fil
-000157a0: 655f 7061 7468 2e72 6669 6e64 2827 2e27  e_path.rfind('.'
-000157b0: 2920 2b20 313a 5d2e 6c6f 7765 7228 2929  ) + 1:].lower())
-000157c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000157d0: 6865 6164 6572 730a 0a20 2020 2040 7374  headers..    @st
-000157e0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-000157f0: 6566 205f 6765 745f 6f66 6673 6574 286f  ef _get_offset(o
-00015800: 6666 7365 742c 2066 696c 655f 7369 7a65  ffset, file_size
-00015810: 293a 0a20 2020 2020 2020 206f 6666 7365  ):.        offse
-00015820: 7420 3d20 6f66 6673 6574 2069 6620 6f66  t = offset if of
-00015830: 6673 6574 2069 7320 6e6f 7420 4e6f 6e65  fset is not None
-00015840: 2061 6e64 2030 203c 3d20 6f66 6673 6574   and 0 <= offset
-00015850: 203c 2066 696c 655f 7369 7a65 2065 6c73   < file_size els
-00015860: 6520 300a 2020 2020 2020 2020 7265 7475  e 0.        retu
-00015870: 726e 206f 6666 7365 740a 0a20 2020 2040  rn offset..    @
-00015880: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-00015890: 2064 6566 205f 6765 745f 7061 7274 5f73   def _get_part_s
-000158a0: 697a 6528 7061 7274 5369 7a65 2c20 6669  ize(partSize, fi
-000158b0: 6c65 5f73 697a 652c 206f 6666 7365 7429  le_size, offset)
-000158c0: 3a0a 2020 2020 2020 2020 7061 7274 5369  :.        partSi
-000158d0: 7a65 203d 2070 6172 7453 697a 6520 6966  ze = partSize if
-000158e0: 2070 6172 7453 697a 6520 6973 206e 6f74   partSize is not
-000158f0: 204e 6f6e 6520 616e 6420 3020 3c20 7061   None and 0 < pa
-00015900: 7274 5369 7a65 203c 3d20 2866 696c 655f  rtSize <= (file_
-00015910: 7369 7a65 202d 206f 6666 7365 7429 2065  size - offset) e
-00015920: 6c73 6520 6669 6c65 5f73 697a 6520 2d20  lse file_size - 
-00015930: 6f66 6673 6574 0a20 2020 2020 2020 2072  offset.        r
-00015940: 6574 7572 6e20 7061 7274 5369 7a65 0a0a  eturn partSize..
-00015950: 2020 2020 6465 6620 5f70 7265 7061 7265      def _prepare
-00015960: 5f68 6561 6465 7273 2873 656c 662c 206d  _headers(self, m
-00015970: 6435 2c20 6973 4174 7461 6368 4d64 352c  d5, isAttachMd5,
-00015980: 2066 696c 655f 7061 7468 2c20 7061 7274   file_path, part
-00015990: 5369 7a65 2c20 6f66 6673 6574 2c20 7373  Size, offset, ss
-000159a0: 6548 6561 6465 722c 2068 6561 6465 7273  eHeader, headers
-000159b0: 293a 0a20 2020 2020 2020 2069 6620 6d64  ):.        if md
-000159c0: 353a 0a20 2020 2020 2020 2020 2020 2068  5:.            h
-000159d0: 6561 6465 7273 5b63 6f6e 7374 2e43 4f4e  eaders[const.CON
-000159e0: 5445 4e54 5f4d 4435 5f48 4541 4445 525d  TENT_MD5_HEADER]
-000159f0: 203d 206d 6435 0a20 2020 2020 2020 2065   = md5.        e
-00015a00: 6c69 6620 6973 4174 7461 6368 4d64 353a  lif isAttachMd5:
-00015a10: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-00015a20: 6465 7273 5b63 6f6e 7374 2e43 4f4e 5445  ders[const.CONTE
-00015a30: 4e54 5f4d 4435 5f48 4541 4445 525d 203d  NT_MD5_HEADER] =
-00015a40: 2075 7469 6c2e 6261 7365 3634 5f65 6e63   util.base64_enc
-00015a50: 6f64 6528 0a20 2020 2020 2020 2020 2020  ode(.           
-00015a60: 2020 2020 2075 7469 6c2e 6d64 355f 6669       util.md5_fi
-00015a70: 6c65 5f65 6e63 6f64 655f 6279 5f73 697a  le_encode_by_siz
-00015a80: 655f 6f66 6673 6574 2866 696c 655f 7061  e_offset(file_pa
-00015a90: 7468 2c20 7061 7274 5369 7a65 2c20 6f66  th, partSize, of
-00015aa0: 6673 6574 2c20 7365 6c66 2e63 6875 6e6b  fset, self.chunk
-00015ab0: 5f73 697a 6529 290a 0a20 2020 2020 2020  _size))..       
-00015ac0: 2069 6620 7373 6548 6561 6465 7220 6973   if sseHeader is
-00015ad0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00015ae0: 2020 2020 2020 2073 656c 662e 636f 6e76         self.conv
-00015af0: 6572 746f 722e 5f73 6574 5f73 7365 5f68  ertor._set_sse_h
-00015b00: 6561 6465 7228 7373 6548 6561 6465 722c  eader(sseHeader,
-00015b10: 2068 6561 6465 7273 2c20 5472 7565 290a   headers, True).
-00015b20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00015b30: 6865 6164 6572 730a 0a20 2020 2040 7374  headers..    @st
-00015b40: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-00015b50: 6566 205f 7072 6570 6172 655f 7570 6c6f  ef _prepare_uplo
-00015b60: 6164 5f70 6172 745f 6e6f 7469 6669 6572  ad_part_notifier
-00015b70: 2870 6172 7453 697a 652c 2070 726f 6772  (partSize, progr
-00015b80: 6573 7343 616c 6c62 6163 6b2c 2072 6561  essCallback, rea
-00015b90: 6461 626c 6529 3a0a 2020 2020 2020 2020  dable):.        
-00015ba0: 6966 2070 6172 7453 697a 6520 3e20 3020  if partSize > 0 
-00015bb0: 616e 6420 7072 6f67 7265 7373 4361 6c6c  and progressCall
-00015bc0: 6261 636b 2069 7320 6e6f 7420 4e6f 6e65  back is not None
-00015bd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00015be0: 6164 6162 6c65 203d 2054 7275 650a 2020  adable = True.  
-00015bf0: 2020 2020 2020 2020 2020 6e6f 7469 6669            notifi
-00015c00: 6572 203d 2070 726f 6772 6573 732e 5072  er = progress.Pr
-00015c10: 6f67 7265 7373 4e6f 7469 6669 6572 2870  ogressNotifier(p
-00015c20: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
-00015c30: 2070 6172 7453 697a 6529 0a20 2020 2020   partSize).     
-00015c40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00015c50: 2020 2020 206e 6f74 6966 6965 7220 3d20       notifier = 
-00015c60: 7072 6f67 7265 7373 2e4e 4f4e 455f 4e4f  progress.NONE_NO
-00015c70: 5449 4649 4552 0a0a 2020 2020 2020 2020  TIFIER..        
-00015c80: 7265 7475 726e 2072 6561 6461 626c 652c  return readable,
-00015c90: 206e 6f74 6966 6965 720a 0a20 2020 2064   notifier..    d
-00015ca0: 6566 205f 6765 745f 6865 6164 6572 7328  ef _get_headers(
-00015cb0: 7365 6c66 2c20 6d64 352c 2073 7365 4865  self, md5, sseHe
-00015cc0: 6164 6572 2c20 6865 6164 6572 7329 3a0a  ader, headers):.
-00015cd0: 2020 2020 2020 2020 6966 206d 6435 3a0a          if md5:.
-00015ce0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00015cf0: 6572 735b 636f 6e73 742e 434f 4e54 454e  ers[const.CONTEN
-00015d00: 545f 4d44 355f 4845 4144 4552 5d20 3d20  T_MD5_HEADER] = 
-00015d10: 6d64 350a 2020 2020 2020 2020 6966 2073  md5.        if s
-00015d20: 7365 4865 6164 6572 2069 7320 6e6f 7420  seHeader is not 
-00015d30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00015d40: 2020 7365 6c66 2e63 6f6e 7665 7274 6f72    self.convertor
-00015d50: 2e5f 7365 745f 7373 655f 6865 6164 6572  ._set_sse_header
-00015d60: 2873 7365 4865 6164 6572 2c20 6865 6164  (sseHeader, head
-00015d70: 6572 732c 2054 7275 6529 0a0a 2020 2020  ers, True)..    
-00015d80: 2020 2020 7265 7475 726e 2068 6561 6465      return heade
-00015d90: 7273 0a0a 2020 2020 4073 7461 7469 636d  rs..    @staticm
-00015da0: 6574 686f 640a 2020 2020 6465 6620 5f67  ethod.    def _g
-00015db0: 6574 5f6e 6f74 6966 6965 725f 7769 7468  et_notifier_with
-00015dc0: 6f75 745f 7369 7a65 2870 726f 6772 6573  out_size(progres
-00015dd0: 7343 616c 6c62 6163 6b29 3a0a 2020 2020  sCallback):.    
-00015de0: 2020 2020 7265 7475 726e 2070 726f 6772      return progr
-00015df0: 6573 732e 5072 6f67 7265 7373 4e6f 7469  ess.ProgressNoti
-00015e00: 6669 6572 2870 726f 6772 6573 7343 616c  fier(progressCal
-00015e10: 6c62 6163 6b2c 0a20 2020 2020 2020 2020  lback,.         
-00015e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e40: 2d31 2920 6966 2070 726f 6772 6573 7343  -1) if progressC
-00015e50: 616c 6c62 6163 6b20 6973 206e 6f74 204e  allback is not N
-00015e60: 6f6e 6520 656c 7365 2070 726f 6772 6573  one else progres
-00015e70: 732e 4e4f 4e45 5f4e 4f54 4946 4945 520a  s.NONE_NOTIFIER.
-00015e80: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00015e90: 6f64 0a20 2020 2064 6566 205f 6765 745f  od.    def _get_
-00015ea0: 6e6f 7469 6669 6572 5f77 6974 685f 7369  notifier_with_si
-00015eb0: 7a65 2870 726f 6772 6573 7343 616c 6c62  ze(progressCallb
-00015ec0: 6163 6b2c 2074 6f74 616c 436f 756e 7429  ack, totalCount)
-00015ed0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00015ee0: 2070 726f 6772 6573 732e 5072 6f67 7265   progress.Progre
-00015ef0: 7373 4e6f 7469 6669 6572 2870 726f 6772  ssNotifier(progr
-00015f00: 6573 7343 616c 6c62 6163 6b2c 0a20 2020  essCallback,.   
-00015f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f30: 2020 2020 2020 746f 7461 6c43 6f75 6e74        totalCount
-00015f40: 2920 6966 2074 6f74 616c 436f 756e 7420  ) if totalCount 
-00015f50: 3e20 3020 616e 6420 7072 6f67 7265 7373  > 0 and progress
-00015f60: 4361 6c6c 6261 636b 2069 7320 6e6f 7420  Callback is not 
-00015f70: 4e6f 6e65 205c 0a20 2020 2020 2020 2020  None \.         
-00015f80: 2020 2065 6c73 6520 7072 6f67 7265 7373     else progress
-00015f90: 2e4e 4f4e 455f 4e4f 5449 4649 4552 0a0a  .NONE_NOTIFIER..
-00015fa0: 2020 2020 6465 6620 5f63 6865 636b 5f66      def _check_f
-00015fb0: 696c 655f 7061 7274 5f69 6e66 6f28 7365  ile_part_info(se
-00015fc0: 6c66 2c20 6669 6c65 5f70 6174 682c 206f  lf, file_path, o
-00015fd0: 6666 7365 742c 2070 6172 7453 697a 6529  ffset, partSize)
-00015fe0: 3a0a 2020 2020 2020 2020 6669 6c65 5f70  :.        file_p
-00015ff0: 6172 745f 696e 666f 203d 2064 6963 7428  art_info = dict(
-00016000: 290a 2020 2020 2020 2020 6669 6c65 5f70  ).        file_p
-00016010: 6172 745f 696e 666f 5b22 6669 6c65 5f70  art_info["file_p
-00016020: 6174 6822 5d20 3d20 7365 6c66 2e63 6865  ath"] = self.che
-00016030: 636b 5f66 696c 655f 7061 7468 2866 696c  ck_file_path(fil
-00016040: 655f 7061 7468 290a 2020 2020 2020 2020  e_path).        
-00016050: 6669 6c65 5f73 697a 6520 3d20 7574 696c  file_size = util
-00016060: 2e74 6f5f 6c6f 6e67 286f 732e 7061 7468  .to_long(os.path
-00016070: 2e67 6574 7369 7a65 2866 696c 655f 7061  .getsize(file_pa
-00016080: 7468 2929 0a20 2020 2020 2020 206f 6666  th)).        off
-00016090: 7365 7420 3d20 7574 696c 2e74 6f5f 6c6f  set = util.to_lo
-000160a0: 6e67 286f 6666 7365 7429 0a20 2020 2020  ng(offset).     
-000160b0: 2020 2066 696c 655f 7061 7274 5f69 6e66     file_part_inf
-000160c0: 6f5b 226f 6666 7365 7422 5d20 3d20 7365  o["offset"] = se
-000160d0: 6c66 2e5f 6765 745f 6f66 6673 6574 286f  lf._get_offset(o
-000160e0: 6666 7365 742c 2066 696c 655f 7369 7a65  ffset, file_size
-000160f0: 290a 2020 2020 2020 2020 7061 7274 5369  ).        partSi
-00016100: 7a65 203d 2075 7469 6c2e 746f 5f6c 6f6e  ze = util.to_lon
-00016110: 6728 7061 7274 5369 7a65 290a 2020 2020  g(partSize).    
-00016120: 2020 2020 6669 6c65 5f70 6172 745f 696e      file_part_in
-00016130: 666f 5b22 7061 7274 5369 7a65 225d 203d  fo["partSize"] =
-00016140: 2073 656c 662e 5f67 6574 5f70 6172 745f   self._get_part_
-00016150: 7369 7a65 2870 6172 7453 697a 652c 2066  size(partSize, f
-00016160: 696c 655f 7369 7a65 2c20 6f66 6673 6574  ile_size, offset
-00016170: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00016180: 2066 696c 655f 7061 7274 5f69 6e66 6f0a   file_part_info.
-00016190: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-000161a0: 2020 2020 6465 6620 7570 6c6f 6164 5061      def uploadPa
-000161b0: 7274 2873 656c 662c 2062 7563 6b65 744e  rt(self, bucketN
-000161c0: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-000161d0: 7061 7274 4e75 6d62 6572 2c20 7570 6c6f  partNumber, uplo
-000161e0: 6164 4964 2c20 6f62 6a65 6374 3d4e 6f6e  adId, object=Non
-000161f0: 652c 2069 7346 696c 653d 4661 6c73 652c  e, isFile=False,
-00016200: 2070 6172 7453 697a 653d 4e6f 6e65 2c0a   partSize=None,.
-00016210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016220: 2020 206f 6666 7365 743d 302c 2073 7365     offset=0, sse
-00016230: 4865 6164 6572 3d4e 6f6e 652c 2069 7341  Header=None, isA
-00016240: 7474 6163 684d 6435 3d46 616c 7365 2c20  ttachMd5=False, 
-00016250: 6d64 353d 4e6f 6e65 2c20 636f 6e74 656e  md5=None, conten
-00016260: 743d 4e6f 6e65 2c20 7072 6f67 7265 7373  t=None, progress
-00016270: 4361 6c6c 6261 636b 3d4e 6f6e 652c 0a20  Callback=None,. 
-00016280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016290: 2020 6175 746f 436c 6f73 653d 5472 7565    autoClose=True
-000162a0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-000162b0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
-000162c0: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
-000162d0: 6f74 5f6e 756c 6c28 7061 7274 4e75 6d62  ot_null(partNumb
-000162e0: 6572 2c20 2770 6172 744e 756d 6265 7220  er, 'partNumber 
-000162f0: 6973 2065 6d70 7479 2729 0a20 2020 2020  is empty').     
-00016300: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
-00016310: 6e6f 745f 6e75 6c6c 2875 706c 6f61 6449  not_null(uploadI
-00016320: 642c 2027 7570 6c6f 6164 4964 2069 7320  d, 'uploadId is 
-00016330: 656d 7074 7927 290a 0a20 2020 2020 2020  empty')..       
-00016340: 2063 6875 6e6b 6564 4d6f 6465 203d 2046   chunkedMode = F
-00016350: 616c 7365 0a20 2020 2020 2020 2072 6561  alse.        rea
-00016360: 6461 626c 6520 3d20 4661 6c73 650a 0a20  dable = False.. 
-00016370: 2020 2020 2020 2069 6620 636f 6e74 656e         if conten
-00016380: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
-00016390: 2020 2020 2020 2063 6f6e 7465 6e74 203d         content =
-000163a0: 206f 626a 6563 740a 0a20 2020 2020 2020   object..       
-000163b0: 206e 6f74 6966 6965 7220 3d20 4e6f 6e65   notifier = None
-000163c0: 0a20 2020 2020 2020 2069 6620 6973 4669  .        if isFi
-000163d0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-000163e0: 6368 6563 6b65 645f 6669 6c65 5f70 6172  checked_file_par
-000163f0: 745f 696e 666f 203d 2073 656c 662e 5f63  t_info = self._c
-00016400: 6865 636b 5f66 696c 655f 7061 7274 5f69  heck_file_part_i
-00016410: 6e66 6f28 636f 6e74 656e 742c 206f 6666  nfo(content, off
-00016420: 7365 742c 2070 6172 7453 697a 6529 0a0a  set, partSize)..
-00016430: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00016440: 6572 7320 3d20 7b63 6f6e 7374 2e43 4f4e  ers = {const.CON
-00016450: 5445 4e54 5f4c 454e 4754 485f 4845 4144  TENT_LENGTH_HEAD
-00016460: 4552 3a20 7574 696c 2e74 6f5f 7374 7269  ER: util.to_stri
-00016470: 6e67 2863 6865 636b 6564 5f66 696c 655f  ng(checked_file_
-00016480: 7061 7274 5f69 6e66 6f5b 2270 6172 7453  part_info["partS
-00016490: 697a 6522 5d29 7d0a 2020 2020 2020 2020  ize"])}.        
-000164a0: 2020 2020 6865 6164 6572 7320 3d20 7365      headers = se
-000164b0: 6c66 2e5f 7072 6570 6172 655f 6865 6164  lf._prepare_head
-000164c0: 6572 7328 6d64 352c 2069 7341 7474 6163  ers(md5, isAttac
-000164d0: 684d 6435 2c20 6368 6563 6b65 645f 6669  hMd5, checked_fi
-000164e0: 6c65 5f70 6172 745f 696e 666f 5b22 6669  le_part_info["fi
-000164f0: 6c65 5f70 6174 6822 5d2c 0a20 2020 2020  le_path"],.     
-00016500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016520: 2020 2020 2020 2063 6865 636b 6564 5f66         checked_f
-00016530: 696c 655f 7061 7274 5f69 6e66 6f5b 2270  ile_part_info["p
-00016540: 6172 7453 697a 6522 5d2c 2063 6865 636b  artSize"], check
-00016550: 6564 5f66 696c 655f 7061 7274 5f69 6e66  ed_file_part_inf
-00016560: 6f5b 226f 6666 7365 7422 5d2c 0a20 2020  o["offset"],.   
-00016570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016590: 2020 2020 2020 2020 2073 7365 4865 6164           sseHead
-000165a0: 6572 2c20 6865 6164 6572 7329 0a0a 2020  er, headers)..  
-000165b0: 2020 2020 2020 2020 2020 7265 6164 6162            readab
-000165c0: 6c65 2c20 6e6f 7469 6669 6572 203d 2073  le, notifier = s
-000165d0: 656c 662e 5f70 7265 7061 7265 5f75 706c  elf._prepare_upl
-000165e0: 6f61 645f 7061 7274 5f6e 6f74 6966 6965  oad_part_notifie
-000165f0: 7228 6368 6563 6b65 645f 6669 6c65 5f70  r(checked_file_p
-00016600: 6172 745f 696e 666f 5b22 7061 7274 5369  art_info["partSi
-00016610: 7a65 225d 2c0a 2020 2020 2020 2020 2020  ze"],.          
-00016620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016650: 2020 2020 2020 2020 2020 7072 6f67 7265            progre
-00016660: 7373 4361 6c6c 6261 636b 2c20 7265 6164  ssCallback, read
-00016670: 6162 6c65 290a 2020 2020 2020 2020 2020  able).          
-00016680: 2020 7265 6164 6162 6c65 5f6f 626a 6563    readable_objec
-00016690: 7420 3d20 6f70 656e 2863 6865 636b 6564  t = open(checked
-000166a0: 5f66 696c 655f 7061 7274 5f69 6e66 6f5b  _file_part_info[
-000166b0: 2266 696c 655f 7061 7468 225d 2c20 2272  "file_path"], "r
-000166c0: 6222 290a 2020 2020 2020 2020 2020 2020  b").            
-000166d0: 7265 6164 6162 6c65 5f6f 626a 6563 742e  readable_object.
-000166e0: 7365 656b 2863 6865 636b 6564 5f66 696c  seek(checked_fil
-000166f0: 655f 7061 7274 5f69 6e66 6f5b 226f 6666  e_part_info["off
-00016700: 7365 7422 5d29 0a20 2020 2020 2020 2020  set"]).         
-00016710: 2020 2065 6e74 6974 7920 3d20 7574 696c     entity = util
-00016720: 2e67 6574 5f65 6e74 6974 795f 666f 725f  .get_entity_for_
-00016730: 7365 6e64 5f77 6974 685f 746f 7461 6c5f  send_with_total_
-00016740: 636f 756e 7428 7265 6164 6162 6c65 5f6f  count(readable_o
-00016750: 626a 6563 742c 2063 6865 636b 6564 5f66  bject, checked_f
-00016760: 696c 655f 7061 7274 5f69 6e66 6f5b 2270  ile_part_info["p
-00016770: 6172 7453 697a 6522 5d2c 0a20 2020 2020  artSize"],.     
-00016780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167b0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-000167c0: 6875 6e6b 5f73 697a 652c 206e 6f74 6966  hunk_size, notif
-000167d0: 6965 7229 0a20 2020 2020 2020 2065 6c73  ier).        els
-000167e0: 653a 0a20 2020 2020 2020 2020 2020 2068  e:.            h
-000167f0: 6561 6465 7273 203d 207b 7d0a 2020 2020  eaders = {}.    
-00016800: 2020 2020 2020 2020 6966 2063 6f6e 7465          if conte
-00016810: 6e74 2069 7320 6e6f 7420 4e6f 6e65 2061  nt is not None a
-00016820: 6e64 2068 6173 6174 7472 2863 6f6e 7465  nd hasattr(conte
-00016830: 6e74 2c20 2772 6561 6427 2920 616e 6420  nt, 'read') and 
-00016840: 6361 6c6c 6162 6c65 2863 6f6e 7465 6e74  callable(content
-00016850: 2e72 6561 6429 3a0a 2020 2020 2020 2020  .read):.        
-00016860: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
-00016870: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00016880: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-00016890: 3d20 7365 6c66 2e5f 6765 745f 6865 6164  = self._get_head
-000168a0: 6572 7328 6d64 352c 2073 7365 4865 6164  ers(md5, sseHead
-000168b0: 6572 2c20 6865 6164 6572 7329 0a0a 2020  er, headers)..  
-000168c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000168d0: 2070 6172 7453 697a 6520 6973 204e 6f6e   partSize is Non
-000168e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000168f0: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
-00016900: 636c 6965 6e74 2e6c 6f67 2844 4542 5547  client.log(DEBUG
-00016910: 2c20 276d 6973 7369 6e67 2070 6172 7453  , 'missing partS
-00016920: 697a 6520 7768 656e 2075 706c 6f61 6469  ize when uploadi
-00016930: 6e67 2061 2072 6561 6461 626c 6520 7374  ng a readable st
-00016940: 7265 616d 2729 0a20 2020 2020 2020 2020  ream').         
-00016950: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
-00016960: 6564 4d6f 6465 203d 2054 7275 650a 2020  edMode = True.  
-00016970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016980: 2020 6e6f 7469 6669 6572 203d 2073 656c    notifier = sel
-00016990: 662e 5f67 6574 5f6e 6f74 6966 6965 725f  f._get_notifier_
-000169a0: 7769 7468 6f75 745f 7369 7a65 2870 726f  without_size(pro
-000169b0: 6772 6573 7343 616c 6c62 6163 6b29 0a20  gressCallback). 
-000169c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169d0: 2020 2065 6e74 6974 7920 3d20 7574 696c     entity = util
-000169e0: 2e67 6574 5f72 6561 6461 626c 655f 656e  .get_readable_en
-000169f0: 7469 7479 2863 6f6e 7465 6e74 2c20 7365  tity(content, se
-00016a00: 6c66 2e63 6875 6e6b 5f73 697a 652c 206e  lf.chunk_size, n
-00016a10: 6f74 6966 6965 722c 2061 7574 6f43 6c6f  otifier, autoClo
-00016a20: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-00016a30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00016a40: 2020 2020 2020 2020 2020 2020 2020 6865                he
-00016a50: 6164 6572 735b 636f 6e73 742e 434f 4e54  aders[const.CONT
-00016a60: 454e 545f 4c45 4e47 5448 5f48 4541 4445  ENT_LENGTH_HEADE
-00016a70: 525d 203d 2075 7469 6c2e 746f 5f73 7472  R] = util.to_str
-00016a80: 696e 6728 7061 7274 5369 7a65 290a 2020  ing(partSize).  
-00016a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016aa0: 2020 746f 7461 6c43 6f75 6e74 203d 2075    totalCount = u
-00016ab0: 7469 6c2e 746f 5f6c 6f6e 6728 7061 7274  til.to_long(part
-00016ac0: 5369 7a65 290a 2020 2020 2020 2020 2020  Size).          
-00016ad0: 2020 2020 2020 2020 2020 6e6f 7469 6669            notifi
-00016ae0: 6572 203d 2073 656c 662e 5f67 6574 5f6e  er = self._get_n
-00016af0: 6f74 6966 6965 725f 7769 7468 5f73 697a  otifier_with_siz
-00016b00: 6528 7072 6f67 7265 7373 4361 6c6c 6261  e(progressCallba
-00016b10: 636b 2c20 746f 7461 6c43 6f75 6e74 290a  ck, totalCount).
-00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b30: 2020 2020 656e 7469 7479 203d 2075 7469      entity = uti
-00016b40: 6c2e 6765 745f 656e 7469 7479 5f66 6f72  l.get_entity_for
-00016b50: 5f73 656e 645f 7769 7468 5f74 6f74 616c  _send_with_total
-00016b60: 5f63 6f75 6e74 2863 6f6e 7465 6e74 2c20  _count(content, 
-00016b70: 746f 7461 6c43 6f75 6e74 2c20 7365 6c66  totalCount, self
-00016b80: 2e63 6875 6e6b 5f73 697a 652c 206e 6f74  .chunk_size, not
-00016b90: 6966 6965 722c 0a20 2020 2020 2020 2020  ifier,.         
-00016ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bd0: 2020 2020 2020 2020 2020 2020 2020 6175                au
-00016be0: 746f 436c 6f73 6529 0a20 2020 2020 2020  toClose).       
-00016bf0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00016c00: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
-00016c10: 7920 3d20 636f 6e74 656e 740a 2020 2020  y = content.    
-00016c20: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00016c30: 6e74 6974 7920 6973 204e 6f6e 653a 0a20  ntity is None:. 
-00016c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c50: 2020 2065 6e74 6974 7920 3d20 2727 0a20     entity = ''. 
-00016c60: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00016c70: 6561 6465 7273 203d 2073 656c 662e 5f67  eaders = self._g
-00016c80: 6574 5f68 6561 6465 7273 286d 6435 2c20  et_headers(md5, 
-00016c90: 7373 6548 6561 6465 722c 2068 6561 6465  sseHeader, heade
-00016ca0: 7273 290a 0a20 2020 2020 2020 2074 7279  rs)..        try
-00016cb0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00016cc0: 206e 6f74 6966 6965 7220 6973 206e 6f74   notifier is not
-00016cd0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00016ce0: 2020 2020 2020 206e 6f74 6966 6965 722e         notifier.
-00016cf0: 7374 6172 7428 290a 2020 2020 2020 2020  start().        
-00016d00: 2020 2020 7265 7420 3d20 7365 6c66 2e5f      ret = self._
-00016d10: 6d61 6b65 5f70 7574 5f72 6571 7565 7374  make_put_request
-00016d20: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
-00016d30: 6563 744b 6579 2c0a 2020 2020 2020 2020  ectKey,.        
+000147b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147d0: 2020 2020 2020 2020 2069 7320 6e6f 7420           is not 
+000147e0: 4e6f 6e65 2065 6c73 6520 7072 6f67 7265  None else progre
+000147f0: 7373 2e4e 4f4e 455f 4e4f 5449 4649 4552  ss.NONE_NOTIFIER
+00014800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014810: 2020 2020 2065 6e74 6974 7920 3d20 7574       entity = ut
+00014820: 696c 2e67 6574 5f65 6e74 6974 795f 666f  il.get_entity_fo
+00014830: 725f 7365 6e64 5f77 6974 685f 746f 7461  r_send_with_tota
+00014840: 6c5f 636f 756e 7428 656e 7469 7479 2c20  l_count(entity, 
+00014850: 746f 7461 6c43 6f75 6e74 2c20 7365 6c66  totalCount, self
+00014860: 2e63 6875 6e6b 5f73 697a 652c 206e 6f74  .chunk_size, not
+00014870: 6966 6965 722c 0a20 2020 2020 2020 2020  ifier,.         
+00014880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148b0: 2020 2020 2020 2020 2020 2020 2020 6175                au
+000148c0: 746f 436c 6f73 6529 0a0a 2020 2020 2020  toClose)..      
+000148d0: 2020 2020 2020 2020 2020 6e6f 7469 6669            notifi
+000148e0: 6572 2e73 7461 7274 2829 0a20 2020 2020  er.start().     
+000148f0: 2020 2020 2020 2072 6574 203d 2073 656c         ret = sel
+00014900: 662e 5f6d 616b 655f 7075 745f 7265 7175  f._make_put_requ
+00014910: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+00014920: 6f62 6a65 6374 4b65 792c 2068 6561 6465  objectKey, heade
+00014930: 7273 3d5f 6865 6164 6572 732c 2065 6e74  rs=_headers, ent
+00014940: 6974 793d 656e 7469 7479 2c0a 2020 2020  ity=entity,.    
+00014950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014970: 2020 2020 2063 6875 6e6b 6564 4d6f 6465       chunkedMode
+00014980: 3d63 6875 6e6b 6564 4d6f 6465 2c20 6d65  =chunkedMode, me
+00014990: 7468 6f64 4e61 6d65 3d27 7075 7443 6f6e  thodName='putCon
+000149a0: 7465 6e74 272c 2072 6561 6461 626c 653d  tent', readable=
+000149b0: 7265 6164 6162 6c65 2c0a 2020 2020 2020  readable,.      
+000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149e0: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+000149f0: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+00014a00: 6465 7273 290a 2020 2020 2020 2020 6669  ders).        fi
+00014a10: 6e61 6c6c 793a 0a20 2020 2020 2020 2020  nally:.         
+00014a20: 2020 2069 6620 6e6f 7469 6669 6572 2069     if notifier i
+00014a30: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00014a40: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+00014a50: 6669 6572 2e65 6e64 2829 0a20 2020 2020  fier.end().     
+00014a60: 2020 2073 656c 662e 5f67 656e 6572 6174     self._generat
+00014a70: 655f 6f62 6a65 6374 5f75 726c 2872 6574  e_object_url(ret
+00014a80: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
+00014a90: 6a65 6374 4b65 7929 0a20 2020 2020 2020  jectKey).       
+00014aa0: 2072 6574 7572 6e20 7265 740a 0a20 2020   return ret..   
+00014ab0: 2064 6566 2070 7574 4f62 6a65 6374 2873   def putObject(s
+00014ac0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00014ad0: 206f 626a 6563 744b 6579 2c20 636f 6e74   objectKey, cont
+00014ae0: 656e 742c 206d 6574 6164 6174 613d 4e6f  ent, metadata=No
+00014af0: 6e65 2c20 6865 6164 6572 733d 4e6f 6e65  ne, headers=None
+00014b00: 2c20 7072 6f67 7265 7373 4361 6c6c 6261  , progressCallba
+00014b10: 636b 3d4e 6f6e 652c 0a20 2020 2020 2020  ck=None,.       
+00014b20: 2020 2020 2020 2020 2020 2061 7574 6f43             autoC
+00014b30: 6c6f 7365 3d54 7275 652c 2065 7874 656e  lose=True, exten
+00014b40: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+00014b50: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00014b60: 6e20 7365 6c66 2e70 7574 436f 6e74 656e  n self.putConten
+00014b70: 7428 6275 636b 6574 4e61 6d65 2c20 6f62  t(bucketName, ob
+00014b80: 6a65 6374 4b65 792c 2063 6f6e 7465 6e74  jectKey, content
+00014b90: 2c20 6d65 7461 6461 7461 2c20 6865 6164  , metadata, head
+00014ba0: 6572 732c 2070 726f 6772 6573 7343 616c  ers, progressCal
+00014bb0: 6c62 6163 6b2c 2061 7574 6f43 6c6f 7365  lback, autoClose
+00014bc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014be0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+00014bf0: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
+00014c00: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
+00014c10: 6368 650a 2020 2020 6465 6620 7075 7446  che.    def putF
+00014c20: 696c 6528 7365 6c66 2c20 6275 636b 6574  ile(self, bucket
+00014c30: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
+00014c40: 2066 696c 655f 7061 7468 2c20 6d65 7461   file_path, meta
+00014c50: 6461 7461 3d4e 6f6e 652c 2068 6561 6465  data=None, heade
+00014c60: 7273 3d4e 6f6e 652c 2070 726f 6772 6573  rs=None, progres
+00014c70: 7343 616c 6c62 6163 6b3d 4e6f 6e65 2c0a  sCallback=None,.
+00014c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c90: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00014ca0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00014cb0: 6669 6c65 5f70 6174 6820 3d20 7365 6c66  file_path = self
+00014cc0: 2e63 6865 636b 5f66 696c 655f 7061 7468  .check_file_path
+00014cd0: 2866 696c 655f 7061 7468 290a 2020 2020  (file_path).    
+00014ce0: 2020 2020 5f66 6c61 6720 3d20 6f73 2e70      _flag = os.p
+00014cf0: 6174 682e 6973 6469 7228 6669 6c65 5f70  ath.isdir(file_p
+00014d00: 6174 6829 0a0a 2020 2020 2020 2020 6966  ath)..        if
+00014d10: 2068 6561 6465 7273 2069 7320 4e6f 6e65   headers is None
+00014d20: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
+00014d30: 6164 6572 7320 3d20 5075 744f 626a 6563  aders = PutObjec
+00014d40: 7448 6561 6465 7228 290a 2020 2020 2020  tHeader().      
+00014d50: 2020 6966 206d 6574 6164 6174 6120 6973    if metadata is
+00014d60: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00014d70: 2020 206d 6574 6164 6174 6120 3d20 6469     metadata = di
+00014d80: 6374 2829 0a0a 2020 2020 2020 2020 6966  ct()..        if
+00014d90: 205f 666c 6167 3a0a 2020 2020 2020 2020   _flag:.        
+00014da0: 2020 2020 6865 6164 6572 735b 2763 6f6e      headers['con
+00014db0: 7465 6e74 4c65 6e67 7468 275d 203d 204e  tentLength'] = N
+00014dc0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00014dd0: 6865 6164 6572 735b 276d 6435 275d 203d  headers['md5'] =
+00014de0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00014df0: 2020 6865 6164 6572 735b 2763 6f6e 7465    headers['conte
+00014e00: 6e74 5479 7065 275d 203d 204e 6f6e 650a  ntType'] = None.
+00014e10: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014e20: 756c 7473 203d 205b 5d0a 2020 2020 2020  ults = [].      
+00014e30: 2020 2020 2020 666f 7220 6620 696e 206f        for f in o
+00014e40: 732e 6c69 7374 6469 7228 6669 6c65 5f70  s.listdir(file_p
+00014e50: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+00014e60: 2020 2020 2020 6620 3d20 7574 696c 2e73        f = util.s
+00014e70: 6166 655f 656e 636f 6465 2866 290a 2020  afe_encode(f).  
+00014e80: 2020 2020 2020 2020 2020 2020 2020 5f5f                __
+00014e90: 6669 6c65 5f70 6174 6820 3d20 6f73 2e70  file_path = os.p
+00014ea0: 6174 682e 6a6f 696e 2866 696c 655f 7061  ath.join(file_pa
+00014eb0: 7468 2c20 6629 0a20 2020 2020 2020 2020  th, f).         
+00014ec0: 2020 2020 2020 2069 6620 6e6f 7420 636f         if not co
+00014ed0: 6e73 742e 4953 5f50 5954 484f 4e32 3a0a  nst.IS_PYTHON2:.
+00014ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ef0: 2020 2020 6966 206e 6f74 206f 626a 6563      if not objec
+00014f00: 744b 6579 3a0a 2020 2020 2020 2020 2020  tKey:.          
+00014f10: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+00014f20: 7920 3d20 7574 696c 2e73 6166 655f 7472  y = util.safe_tr
+00014f30: 616e 735f 746f 5f67 6232 3331 3228 277b  ans_to_gb2312('{
+00014f40: 307d 2f27 2e66 6f72 6d61 7428 6f73 2e70  0}/'.format(os.p
+00014f50: 6174 682e 7370 6c69 7428 6669 6c65 5f70  ath.split(file_p
+00014f60: 6174 6829 5b31 5d29 202b 2066 290a 2020  ath)[1]) + f).  
+00014f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00014f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014fa0: 6b65 7920 3d20 277b 307d 2f27 2e66 6f72  key = '{0}/'.for
+00014fb0: 6d61 7428 6f62 6a65 6374 4b65 7929 202b  mat(objectKey) +
+00014fc0: 2075 7469 6c2e 7361 6665 5f74 7261 6e73   util.safe_trans
+00014fd0: 5f74 6f5f 6762 3233 3132 2866 290a 2020  _to_gb2312(f).  
+00014fe0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00014ff0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00015000: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00015010: 626a 6563 744b 6579 3a0a 2020 2020 2020  bjectKey:.      
+00015020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015030: 2020 6b65 7920 3d20 7574 696c 2e73 6166    key = util.saf
+00015040: 655f 7472 616e 735f 746f 5f67 6232 3331  e_trans_to_gb231
+00015050: 3228 277b 307d 2f27 2e66 6f72 6d61 7428  2('{0}/'.format(
+00015060: 6f73 2e70 6174 682e 7370 6c69 7428 6669  os.path.split(fi
+00015070: 6c65 5f70 6174 6829 5b31 5d29 202b 2066  le_path)[1]) + f
+00015080: 292e 6465 636f 6465 280a 2020 2020 2020  ).decode(.      
+00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150a0: 2020 2020 2020 2747 4232 3331 3227 292e        'GB2312').
+000150b0: 656e 636f 6465 2827 5554 462d 3827 290a  encode('UTF-8').
+000150c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150f0: 2020 6b65 7920 3d20 277b 307d 2f27 2e66    key = '{0}/'.f
+00015100: 6f72 6d61 7428 6f62 6a65 6374 4b65 7929  ormat(objectKey)
+00015110: 202b 2075 7469 6c2e 7361 6665 5f74 7261   + util.safe_tra
+00015120: 6e73 5f74 6f5f 6762 3233 3132 2866 292e  ns_to_gb2312(f).
+00015130: 6465 636f 6465 2827 4742 3233 3132 2729  decode('GB2312')
+00015140: 2e65 6e63 6f64 6528 2755 5446 2d38 2729  .encode('UTF-8')
+00015150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015160: 2072 6573 756c 7420 3d20 7365 6c66 2e70   result = self.p
+00015170: 7574 4669 6c65 2862 7563 6b65 744e 616d  utFile(bucketNam
+00015180: 652c 206b 6579 2c20 5f5f 6669 6c65 5f70  e, key, __file_p
+00015190: 6174 682c 206d 6574 6164 6174 612c 2068  ath, metadata, h
+000151a0: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
+000151b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151c0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000151d0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+000151e0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+000151f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015200: 2072 6573 756c 7473 2e61 7070 656e 6428   results.append(
+00015210: 286b 6579 2c20 7265 7375 6c74 2929 0a20  (key, result)). 
+00015220: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00015230: 6e20 7265 7375 6c74 730a 0a20 2020 2020  n results..     
+00015240: 2020 2069 6620 6e6f 7420 6f62 6a65 6374     if not object
+00015250: 4b65 793a 0a20 2020 2020 2020 2020 2020  Key:.           
+00015260: 206f 626a 6563 744b 6579 203d 206f 732e   objectKey = os.
+00015270: 7061 7468 2e73 706c 6974 2866 696c 655f  path.split(file_
+00015280: 7061 7468 295b 315d 0a0a 2020 2020 2020  path)[1]..      
+00015290: 2020 7369 7a65 203d 2075 7469 6c2e 746f    size = util.to
+000152a0: 5f6c 6f6e 6728 6f73 2e70 6174 682e 6765  _long(os.path.ge
+000152b0: 7473 697a 6528 6669 6c65 5f70 6174 6829  tsize(file_path)
+000152c0: 290a 0a20 2020 2020 2020 2068 6561 6465  )..        heade
+000152d0: 7273 203d 2073 656c 662e 5f70 7574 4669  rs = self._putFi
+000152e0: 6c65 4861 6e64 6c65 4865 6164 6572 2868  leHandleHeader(h
+000152f0: 6561 6465 7273 2c20 7369 7a65 2c20 6f62  eaders, size, ob
+00015300: 6a65 6374 4b65 792c 2066 696c 655f 7061  jectKey, file_pa
+00015310: 7468 290a 0a20 2020 2020 2020 2072 6561  th)..        rea
+00015320: 6461 626c 655f 6f62 6a65 6374 203d 2073  dable_object = s
+00015330: 656c 662e 6765 6e5f 7265 6164 6162 6c65  elf.gen_readable
+00015340: 5f6f 626a 6563 745f 6672 6f6d 5f66 696c  _object_from_fil
+00015350: 6528 6669 6c65 5f70 6174 6829 0a20 2020  e(file_path).   
+00015360: 2020 2020 206d 6574 6164 6174 6120 3d20       metadata = 
+00015370: 7365 6c66 2e61 6464 5f6d 6574 6164 6174  self.add_metadat
+00015380: 615f 6672 6f6d 5f63 6f6e 7465 6e74 286d  a_from_content(m
+00015390: 6574 6164 6174 612c 2068 6561 6465 7273  etadata, headers
+000153a0: 2c20 7265 6164 6162 6c65 5f6f 626a 6563  , readable_objec
+000153b0: 7429 0a20 2020 2020 2020 205f 6865 6164  t).        _head
+000153c0: 6572 7320 3d20 7365 6c66 2e63 6f6e 7665  ers = self.conve
+000153d0: 7274 6f72 2e74 7261 6e73 5f70 7574 5f6f  rtor.trans_put_o
+000153e0: 626a 6563 7428 6d65 7461 6461 7461 3d6d  bject(metadata=m
+000153f0: 6574 6164 6174 612c 2068 6561 6465 7273  etadata, headers
+00015400: 3d68 6561 6465 7273 290a 2020 2020 2020  =headers).      
+00015410: 2020 6966 2063 6f6e 7374 2e43 4f4e 5445    if const.CONTE
+00015420: 4e54 5f4c 454e 4754 485f 4845 4144 4552  NT_LENGTH_HEADER
+00015430: 206e 6f74 2069 6e20 5f68 6561 6465 7273   not in _headers
+00015440: 3a0a 2020 2020 2020 2020 2020 2020 5f68  :.            _h
+00015450: 6561 6465 7273 5b63 6f6e 7374 2e43 4f4e  eaders[const.CON
+00015460: 5445 4e54 5f4c 454e 4754 485f 4845 4144  TENT_LENGTH_HEAD
+00015470: 4552 5d20 3d20 7574 696c 2e74 6f5f 7374  ER] = util.to_st
+00015480: 7269 6e67 2873 697a 6529 0a20 2020 2020  ring(size).     
+00015490: 2020 2073 656c 662e 6c6f 675f 636c 6965     self.log_clie
+000154a0: 6e74 2e6c 6f67 2844 4542 5547 2c20 2773  nt.log(DEBUG, 's
+000154b0: 656e 6420 5061 7468 3a25 7327 2025 2066  end Path:%s' % f
+000154c0: 696c 655f 7061 7468 290a 0a20 2020 2020  ile_path)..     
+000154d0: 2020 2074 6f74 616c 436f 756e 7420 3d20     totalCount = 
+000154e0: 7574 696c 2e74 6f5f 6c6f 6e67 2868 6561  util.to_long(hea
+000154f0: 6465 7273 5b27 636f 6e74 656e 744c 656e  ders['contentLen
+00015500: 6774 6827 5d29 2069 6620 6865 6164 6572  gth']) if header
+00015510: 732e 6765 7428 2763 6f6e 7465 6e74 4c65  s.get('contentLe
+00015520: 6e67 7468 2729 2069 7320 6e6f 7420 4e6f  ngth') is not No
+00015530: 6e65 205c 0a20 2020 2020 2020 2020 2020  ne \.           
+00015540: 2065 6c73 6520 6f73 2e70 6174 682e 6765   else os.path.ge
+00015550: 7473 697a 6528 6669 6c65 5f70 6174 6829  tsize(file_path)
+00015560: 0a20 2020 2020 2020 2069 6620 746f 7461  .        if tota
+00015570: 6c43 6f75 6e74 203e 2030 2061 6e64 2070  lCount > 0 and p
+00015580: 726f 6772 6573 7343 616c 6c62 6163 6b20  rogressCallback 
+00015590: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000155a0: 2020 2020 2020 2020 206e 6f74 6966 6965           notifie
+000155b0: 7220 3d20 7072 6f67 7265 7373 2e50 726f  r = progress.Pro
+000155c0: 6772 6573 734e 6f74 6966 6965 7228 7072  gressNotifier(pr
+000155d0: 6f67 7265 7373 4361 6c6c 6261 636b 2c20  ogressCallback, 
+000155e0: 746f 7461 6c43 6f75 6e74 290a 2020 2020  totalCount).    
+000155f0: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
+00015600: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00015610: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00015620: 2020 6e6f 7469 6669 6572 203d 2070 726f    notifier = pro
+00015630: 6772 6573 732e 4e4f 4e45 5f4e 4f54 4946  gress.NONE_NOTIF
+00015640: 4945 520a 2020 2020 2020 2020 2020 2020  IER.            
+00015650: 7265 6164 6162 6c65 203d 2046 616c 7365  readable = False
+00015660: 0a0a 2020 2020 2020 2020 656e 7469 7479  ..        entity
+00015670: 203d 2075 7469 6c2e 6765 745f 656e 7469   = util.get_enti
+00015680: 7479 5f66 6f72 5f73 656e 645f 7769 7468  ty_for_send_with
+00015690: 5f74 6f74 616c 5f63 6f75 6e74 2872 6561  _total_count(rea
+000156a0: 6461 626c 655f 6f62 6a65 6374 2c20 746f  dable_object, to
+000156b0: 7461 6c43 6f75 6e74 2c20 7365 6c66 2e63  talCount, self.c
+000156c0: 6875 6e6b 5f73 697a 652c 206e 6f74 6966  hunk_size, notif
+000156d0: 6965 7229 0a20 2020 2020 2020 2074 7279  ier).        try
+000156e0: 3a0a 2020 2020 2020 2020 2020 2020 6e6f  :.            no
+000156f0: 7469 6669 6572 2e73 7461 7274 2829 0a20  tifier.start(). 
+00015700: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
+00015710: 2073 656c 662e 5f6d 616b 655f 7075 745f   self._make_put_
+00015720: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+00015730: 6d65 2c20 6f62 6a65 6374 4b65 792c 2068  me, objectKey, h
+00015740: 6561 6465 7273 3d5f 6865 6164 6572 732c  eaders=_headers,
+00015750: 2065 6e74 6974 793d 656e 7469 7479 2c0a   entity=entity,.
+00015760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015780: 2020 2020 2020 2020 206d 6574 686f 644e           methodN
+00015790: 616d 653d 2770 7574 436f 6e74 656e 7427  ame='putContent'
+000157a0: 2c20 7265 6164 6162 6c65 3d72 6561 6461  , readable=reada
+000157b0: 626c 652c 2065 7874 656e 7369 6f6e 4865  ble, extensionHe
+000157c0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+000157d0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
+000157e0: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+000157f0: 2020 2020 206e 6f74 6966 6965 722e 656e       notifier.en
+00015800: 6428 290a 2020 2020 2020 2020 7365 6c66  d().        self
+00015810: 2e5f 6765 6e65 7261 7465 5f6f 626a 6563  ._generate_objec
+00015820: 745f 7572 6c28 7265 742c 2062 7563 6b65  t_url(ret, bucke
+00015830: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
+00015840: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00015850: 2072 6574 0a0a 2020 2020 4073 7461 7469   ret..    @stati
+00015860: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00015870: 6164 645f 6d65 7461 6461 7461 5f66 726f  add_metadata_fro
+00015880: 6d5f 636f 6e74 656e 7428 6d65 7461 6461  m_content(metada
+00015890: 7461 2c20 6865 6164 6572 732c 2063 6f6e  ta, headers, con
+000158a0: 7465 6e74 293a 0a20 2020 2020 2020 2072  tent):.        r
+000158b0: 6574 7572 6e20 6d65 7461 6461 7461 0a0a  eturn metadata..
+000158c0: 2020 2020 6465 6620 6765 6e5f 7265 6164      def gen_read
+000158d0: 6162 6c65 5f6f 626a 6563 745f 6672 6f6d  able_object_from
+000158e0: 5f66 696c 6528 7365 6c66 2c20 6669 6c65  _file(self, file
+000158f0: 5f70 6174 6829 3a0a 2020 2020 2020 2020  _path):.        
+00015900: 7265 7475 726e 206f 7065 6e28 6669 6c65  return open(file
+00015910: 5f70 6174 682c 2022 7262 2229 0a0a 2020  _path, "rb")..  
+00015920: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+00015930: 2020 2020 6465 6620 5f70 7574 4669 6c65      def _putFile
+00015940: 4861 6e64 6c65 4865 6164 6572 2868 6561  HandleHeader(hea
+00015950: 6465 7273 2c20 7369 7a65 2c20 6f62 6a65  ders, size, obje
+00015960: 6374 4b65 792c 2066 696c 655f 7061 7468  ctKey, file_path
+00015970: 293a 0a20 2020 2020 2020 2068 6561 6465  ):.        heade
+00015980: 7273 5b27 636f 6e74 656e 744c 656e 6774  rs['contentLengt
+00015990: 6827 5d20 3d20 7574 696c 2e74 6f5f 6c6f  h'] = util.to_lo
+000159a0: 6e67 2868 6561 6465 7273 2e67 6574 2827  ng(headers.get('
+000159b0: 636f 6e74 656e 744c 656e 6774 6827 2929  contentLength'))
+000159c0: 0a20 2020 2020 2020 2069 6620 6865 6164  .        if head
+000159d0: 6572 732e 6765 7428 2763 6f6e 7465 6e74  ers.get('content
+000159e0: 4c65 6e67 7468 2729 2069 7320 6e6f 7420  Length') is not 
+000159f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00015a00: 2020 6865 6164 6572 735b 2763 6f6e 7465    headers['conte
+00015a10: 6e74 4c65 6e67 7468 275d 203d 2073 697a  ntLength'] = siz
+00015a20: 6520 6966 2068 6561 6465 7273 5b27 636f  e if headers['co
+00015a30: 6e74 656e 744c 656e 6774 6827 5d20 3e20  ntentLength'] > 
+00015a40: 7369 7a65 2065 6c73 6520 6865 6164 6572  size else header
+00015a50: 735b 2763 6f6e 7465 6e74 4c65 6e67 7468  s['contentLength
+00015a60: 275d 0a0a 2020 2020 2020 2020 6966 2068  ']..        if h
+00015a70: 6561 6465 7273 2e67 6574 2827 636f 6e74  eaders.get('cont
+00015a80: 656e 7454 7970 6527 2920 6973 204e 6f6e  entType') is Non
+00015a90: 653a 0a20 2020 2020 2020 2020 2020 2068  e:.            h
+00015aa0: 6561 6465 7273 5b27 636f 6e74 656e 7454  eaders['contentT
+00015ab0: 7970 6527 5d20 3d20 636f 6e73 742e 4d49  ype'] = const.MI
+00015ac0: 4d45 5f54 5950 4553 2e67 6574 286f 626a  ME_TYPES.get(obj
+00015ad0: 6563 744b 6579 5b6f 626a 6563 744b 6579  ectKey[objectKey
+00015ae0: 2e72 6669 6e64 2827 2e27 2920 2b20 313a  .rfind('.') + 1:
+00015af0: 5d2e 6c6f 7765 7228 2929 0a0a 2020 2020  ].lower())..    
+00015b00: 2020 2020 6966 2068 6561 6465 7273 2e67      if headers.g
+00015b10: 6574 2827 636f 6e74 656e 7454 7970 6527  et('contentType'
+00015b20: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
+00015b30: 2020 2020 2020 2068 6561 6465 7273 5b27         headers['
+00015b40: 636f 6e74 656e 7454 7970 6527 5d20 3d20  contentType'] = 
+00015b50: 636f 6e73 742e 4d49 4d45 5f54 5950 4553  const.MIME_TYPES
+00015b60: 2e67 6574 2866 696c 655f 7061 7468 5b66  .get(file_path[f
+00015b70: 696c 655f 7061 7468 2e72 6669 6e64 2827  ile_path.rfind('
+00015b80: 2e27 2920 2b20 313a 5d2e 6c6f 7765 7228  .') + 1:].lower(
+00015b90: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+00015ba0: 6e20 6865 6164 6572 730a 0a20 2020 2040  n headers..    @
+00015bb0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00015bc0: 2064 6566 205f 6765 745f 6f66 6673 6574   def _get_offset
+00015bd0: 286f 6666 7365 742c 2066 696c 655f 7369  (offset, file_si
+00015be0: 7a65 293a 0a20 2020 2020 2020 206f 6666  ze):.        off
+00015bf0: 7365 7420 3d20 6f66 6673 6574 2069 6620  set = offset if 
+00015c00: 6f66 6673 6574 2069 7320 6e6f 7420 4e6f  offset is not No
+00015c10: 6e65 2061 6e64 2030 203c 3d20 6f66 6673  ne and 0 <= offs
+00015c20: 6574 203c 2066 696c 655f 7369 7a65 2065  et < file_size e
+00015c30: 6c73 6520 300a 2020 2020 2020 2020 7265  lse 0.        re
+00015c40: 7475 726e 206f 6666 7365 740a 0a20 2020  turn offset..   
+00015c50: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00015c60: 2020 2064 6566 205f 6765 745f 7061 7274     def _get_part
+00015c70: 5f73 697a 6528 7061 7274 5369 7a65 2c20  _size(partSize, 
+00015c80: 6669 6c65 5f73 697a 652c 206f 6666 7365  file_size, offse
+00015c90: 7429 3a0a 2020 2020 2020 2020 7061 7274  t):.        part
+00015ca0: 5369 7a65 203d 2070 6172 7453 697a 6520  Size = partSize 
+00015cb0: 6966 2070 6172 7453 697a 6520 6973 206e  if partSize is n
+00015cc0: 6f74 204e 6f6e 6520 616e 6420 3020 3c20  ot None and 0 < 
+00015cd0: 7061 7274 5369 7a65 203c 3d20 2866 696c  partSize <= (fil
+00015ce0: 655f 7369 7a65 202d 206f 6666 7365 7429  e_size - offset)
+00015cf0: 2065 6c73 6520 6669 6c65 5f73 697a 6520   else file_size 
+00015d00: 2d20 6f66 6673 6574 0a20 2020 2020 2020  - offset.       
+00015d10: 2072 6574 7572 6e20 7061 7274 5369 7a65   return partSize
+00015d20: 0a0a 2020 2020 6465 6620 5f70 7265 7061  ..    def _prepa
+00015d30: 7265 5f68 6561 6465 7273 2873 656c 662c  re_headers(self,
+00015d40: 206d 6435 2c20 6973 4174 7461 6368 4d64   md5, isAttachMd
+00015d50: 352c 2066 696c 655f 7061 7468 2c20 7061  5, file_path, pa
+00015d60: 7274 5369 7a65 2c20 6f66 6673 6574 2c20  rtSize, offset, 
+00015d70: 7373 6548 6561 6465 722c 2068 6561 6465  sseHeader, heade
+00015d80: 7273 293a 0a20 2020 2020 2020 2069 6620  rs):.        if 
+00015d90: 6d64 353a 0a20 2020 2020 2020 2020 2020  md5:.           
+00015da0: 2068 6561 6465 7273 5b63 6f6e 7374 2e43   headers[const.C
+00015db0: 4f4e 5445 4e54 5f4d 4435 5f48 4541 4445  ONTENT_MD5_HEADE
+00015dc0: 525d 203d 206d 6435 0a20 2020 2020 2020  R] = md5.       
+00015dd0: 2065 6c69 6620 6973 4174 7461 6368 4d64   elif isAttachMd
+00015de0: 353a 0a20 2020 2020 2020 2020 2020 2068  5:.            h
+00015df0: 6561 6465 7273 5b63 6f6e 7374 2e43 4f4e  eaders[const.CON
+00015e00: 5445 4e54 5f4d 4435 5f48 4541 4445 525d  TENT_MD5_HEADER]
+00015e10: 203d 2075 7469 6c2e 6261 7365 3634 5f65   = util.base64_e
+00015e20: 6e63 6f64 6528 0a20 2020 2020 2020 2020  ncode(.         
+00015e30: 2020 2020 2020 2075 7469 6c2e 6d64 355f         util.md5_
+00015e40: 6669 6c65 5f65 6e63 6f64 655f 6279 5f73  file_encode_by_s
+00015e50: 697a 655f 6f66 6673 6574 2866 696c 655f  ize_offset(file_
+00015e60: 7061 7468 2c20 7061 7274 5369 7a65 2c20  path, partSize, 
+00015e70: 6f66 6673 6574 2c20 7365 6c66 2e63 6875  offset, self.chu
+00015e80: 6e6b 5f73 697a 6529 290a 0a20 2020 2020  nk_size))..     
+00015e90: 2020 2069 6620 7373 6548 6561 6465 7220     if sseHeader 
+00015ea0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00015eb0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00015ec0: 6e76 6572 746f 722e 5f73 6574 5f73 7365  nvertor._set_sse
+00015ed0: 5f68 6561 6465 7228 7373 6548 6561 6465  _header(sseHeade
+00015ee0: 722c 2068 6561 6465 7273 2c20 5472 7565  r, headers, True
+00015ef0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00015f00: 6e20 6865 6164 6572 730a 0a20 2020 2040  n headers..    @
+00015f10: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00015f20: 2064 6566 205f 7072 6570 6172 655f 7570   def _prepare_up
+00015f30: 6c6f 6164 5f70 6172 745f 6e6f 7469 6669  load_part_notifi
+00015f40: 6572 2870 6172 7453 697a 652c 2070 726f  er(partSize, pro
+00015f50: 6772 6573 7343 616c 6c62 6163 6b2c 2072  gressCallback, r
+00015f60: 6561 6461 626c 6529 3a0a 2020 2020 2020  eadable):.      
+00015f70: 2020 6966 2070 6172 7453 697a 6520 3e20    if partSize > 
+00015f80: 3020 616e 6420 7072 6f67 7265 7373 4361  0 and progressCa
+00015f90: 6c6c 6261 636b 2069 7320 6e6f 7420 4e6f  llback is not No
+00015fa0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00015fb0: 7265 6164 6162 6c65 203d 2054 7275 650a  readable = True.
+00015fc0: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+00015fd0: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
+00015fe0: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
+00015ff0: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
+00016000: 6b2c 2070 6172 7453 697a 6529 0a20 2020  k, partSize).   
+00016010: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00016020: 2020 2020 2020 206e 6f74 6966 6965 7220         notifier 
+00016030: 3d20 7072 6f67 7265 7373 2e4e 4f4e 455f  = progress.NONE_
+00016040: 4e4f 5449 4649 4552 0a0a 2020 2020 2020  NOTIFIER..      
+00016050: 2020 7265 7475 726e 2072 6561 6461 626c    return readabl
+00016060: 652c 206e 6f74 6966 6965 720a 0a20 2020  e, notifier..   
+00016070: 2064 6566 205f 6765 745f 6865 6164 6572   def _get_header
+00016080: 7328 7365 6c66 2c20 6d64 352c 2073 7365  s(self, md5, sse
+00016090: 4865 6164 6572 2c20 6865 6164 6572 7329  Header, headers)
+000160a0: 3a0a 2020 2020 2020 2020 6966 206d 6435  :.        if md5
+000160b0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
+000160c0: 6164 6572 735b 636f 6e73 742e 434f 4e54  aders[const.CONT
+000160d0: 454e 545f 4d44 355f 4845 4144 4552 5d20  ENT_MD5_HEADER] 
+000160e0: 3d20 6d64 350a 2020 2020 2020 2020 6966  = md5.        if
+000160f0: 2073 7365 4865 6164 6572 2069 7320 6e6f   sseHeader is no
+00016100: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00016110: 2020 2020 7365 6c66 2e63 6f6e 7665 7274      self.convert
+00016120: 6f72 2e5f 7365 745f 7373 655f 6865 6164  or._set_sse_head
+00016130: 6572 2873 7365 4865 6164 6572 2c20 6865  er(sseHeader, he
+00016140: 6164 6572 732c 2054 7275 6529 0a0a 2020  aders, True)..  
+00016150: 2020 2020 2020 7265 7475 726e 2068 6561        return hea
+00016160: 6465 7273 0a0a 2020 2020 4073 7461 7469  ders..    @stati
+00016170: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00016180: 5f67 6574 5f6e 6f74 6966 6965 725f 7769  _get_notifier_wi
+00016190: 7468 6f75 745f 7369 7a65 2870 726f 6772  thout_size(progr
+000161a0: 6573 7343 616c 6c62 6163 6b29 3a0a 2020  essCallback):.  
+000161b0: 2020 2020 2020 7265 7475 726e 2070 726f        return pro
+000161c0: 6772 6573 732e 5072 6f67 7265 7373 4e6f  gress.ProgressNo
+000161d0: 7469 6669 6572 2870 726f 6772 6573 7343  tifier(progressC
+000161e0: 616c 6c62 6163 6b2c 0a20 2020 2020 2020  allback,.       
+000161f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016210: 2020 2d31 2920 6966 2070 726f 6772 6573    -1) if progres
+00016220: 7343 616c 6c62 6163 6b20 6973 206e 6f74  sCallback is not
+00016230: 204e 6f6e 6520 656c 7365 2070 726f 6772   None else progr
+00016240: 6573 732e 4e4f 4e45 5f4e 4f54 4946 4945  ess.NONE_NOTIFIE
+00016250: 520a 0a20 2020 2040 7374 6174 6963 6d65  R..    @staticme
+00016260: 7468 6f64 0a20 2020 2064 6566 205f 6765  thod.    def _ge
+00016270: 745f 6e6f 7469 6669 6572 5f77 6974 685f  t_notifier_with_
+00016280: 7369 7a65 2870 726f 6772 6573 7343 616c  size(progressCal
+00016290: 6c62 6163 6b2c 2074 6f74 616c 436f 756e  lback, totalCoun
+000162a0: 7429 3a0a 2020 2020 2020 2020 7265 7475  t):.        retu
+000162b0: 726e 2070 726f 6772 6573 732e 5072 6f67  rn progress.Prog
+000162c0: 7265 7373 4e6f 7469 6669 6572 2870 726f  ressNotifier(pro
+000162d0: 6772 6573 7343 616c 6c62 6163 6b2c 0a20  gressCallback,. 
+000162e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016300: 2020 2020 2020 2020 746f 7461 6c43 6f75          totalCou
+00016310: 6e74 2920 6966 2074 6f74 616c 436f 756e  nt) if totalCoun
+00016320: 7420 3e20 3020 616e 6420 7072 6f67 7265  t > 0 and progre
+00016330: 7373 4361 6c6c 6261 636b 2069 7320 6e6f  ssCallback is no
+00016340: 7420 4e6f 6e65 205c 0a20 2020 2020 2020  t None \.       
+00016350: 2020 2020 2065 6c73 6520 7072 6f67 7265       else progre
+00016360: 7373 2e4e 4f4e 455f 4e4f 5449 4649 4552  ss.NONE_NOTIFIER
+00016370: 0a0a 2020 2020 6465 6620 5f63 6865 636b  ..    def _check
+00016380: 5f66 696c 655f 7061 7274 5f69 6e66 6f28  _file_part_info(
+00016390: 7365 6c66 2c20 6669 6c65 5f70 6174 682c  self, file_path,
+000163a0: 206f 6666 7365 742c 2070 6172 7453 697a   offset, partSiz
+000163b0: 6529 3a0a 2020 2020 2020 2020 6669 6c65  e):.        file
+000163c0: 5f70 6172 745f 696e 666f 203d 2064 6963  _part_info = dic
+000163d0: 7428 290a 2020 2020 2020 2020 6669 6c65  t().        file
+000163e0: 5f70 6172 745f 696e 666f 5b22 6669 6c65  _part_info["file
+000163f0: 5f70 6174 6822 5d20 3d20 7365 6c66 2e63  _path"] = self.c
+00016400: 6865 636b 5f66 696c 655f 7061 7468 2866  heck_file_path(f
+00016410: 696c 655f 7061 7468 290a 2020 2020 2020  ile_path).      
+00016420: 2020 6669 6c65 5f73 697a 6520 3d20 7574    file_size = ut
+00016430: 696c 2e74 6f5f 6c6f 6e67 286f 732e 7061  il.to_long(os.pa
+00016440: 7468 2e67 6574 7369 7a65 2866 696c 655f  th.getsize(file_
+00016450: 7061 7468 2929 0a20 2020 2020 2020 206f  path)).        o
+00016460: 6666 7365 7420 3d20 7574 696c 2e74 6f5f  ffset = util.to_
+00016470: 6c6f 6e67 286f 6666 7365 7429 0a20 2020  long(offset).   
+00016480: 2020 2020 2066 696c 655f 7061 7274 5f69       file_part_i
+00016490: 6e66 6f5b 226f 6666 7365 7422 5d20 3d20  nfo["offset"] = 
+000164a0: 7365 6c66 2e5f 6765 745f 6f66 6673 6574  self._get_offset
+000164b0: 286f 6666 7365 742c 2066 696c 655f 7369  (offset, file_si
+000164c0: 7a65 290a 2020 2020 2020 2020 7061 7274  ze).        part
+000164d0: 5369 7a65 203d 2075 7469 6c2e 746f 5f6c  Size = util.to_l
+000164e0: 6f6e 6728 7061 7274 5369 7a65 290a 2020  ong(partSize).  
+000164f0: 2020 2020 2020 6669 6c65 5f70 6172 745f        file_part_
+00016500: 696e 666f 5b22 7061 7274 5369 7a65 225d  info["partSize"]
+00016510: 203d 2073 656c 662e 5f67 6574 5f70 6172   = self._get_par
+00016520: 745f 7369 7a65 2870 6172 7453 697a 652c  t_size(partSize,
+00016530: 2066 696c 655f 7369 7a65 2c20 6f66 6673   file_size, offs
+00016540: 6574 290a 2020 2020 2020 2020 7265 7475  et).        retu
+00016550: 726e 2066 696c 655f 7061 7274 5f69 6e66  rn file_part_inf
+00016560: 6f0a 0a20 2020 2040 6675 6e63 4361 6368  o..    @funcCach
+00016570: 650a 2020 2020 6465 6620 7570 6c6f 6164  e.    def upload
+00016580: 5061 7274 2873 656c 662c 2062 7563 6b65  Part(self, bucke
+00016590: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
+000165a0: 2c20 7061 7274 4e75 6d62 6572 2c20 7570  , partNumber, up
+000165b0: 6c6f 6164 4964 2c20 6f62 6a65 6374 3d4e  loadId, object=N
+000165c0: 6f6e 652c 2069 7346 696c 653d 4661 6c73  one, isFile=Fals
+000165d0: 652c 2070 6172 7453 697a 653d 4e6f 6e65  e, partSize=None
+000165e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000165f0: 2020 2020 206f 6666 7365 743d 302c 2073       offset=0, s
+00016600: 7365 4865 6164 6572 3d4e 6f6e 652c 2069  seHeader=None, i
+00016610: 7341 7474 6163 684d 6435 3d46 616c 7365  sAttachMd5=False
+00016620: 2c20 6d64 353d 4e6f 6e65 2c20 636f 6e74  , md5=None, cont
+00016630: 656e 743d 4e6f 6e65 2c20 7072 6f67 7265  ent=None, progre
+00016640: 7373 4361 6c6c 6261 636b 3d4e 6f6e 652c  ssCallback=None,
+00016650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016660: 2020 2020 6175 746f 436c 6f73 653d 5472      autoClose=Tr
+00016670: 7565 2c20 6578 7465 6e73 696f 6e48 6561  ue, extensionHea
+00016680: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+00016690: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
+000166a0: 5f6e 6f74 5f6e 756c 6c28 7061 7274 4e75  _not_null(partNu
+000166b0: 6d62 6572 2c20 2770 6172 744e 756d 6265  mber, 'partNumbe
+000166c0: 7220 6973 2065 6d70 7479 2729 0a20 2020  r is empty').   
+000166d0: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
+000166e0: 745f 6e6f 745f 6e75 6c6c 2875 706c 6f61  t_not_null(uploa
+000166f0: 6449 642c 2027 7570 6c6f 6164 4964 2069  dId, 'uploadId i
+00016700: 7320 656d 7074 7927 290a 0a20 2020 2020  s empty')..     
+00016710: 2020 2063 6875 6e6b 6564 4d6f 6465 203d     chunkedMode =
+00016720: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
+00016730: 6561 6461 626c 6520 3d20 4661 6c73 650a  eadable = False.
+00016740: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
+00016750: 656e 7420 6973 204e 6f6e 653a 0a20 2020  ent is None:.   
+00016760: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+00016770: 203d 206f 626a 6563 740a 0a20 2020 2020   = object..     
+00016780: 2020 206e 6f74 6966 6965 7220 3d20 4e6f     notifier = No
+00016790: 6e65 0a20 2020 2020 2020 2069 6620 6973  ne.        if is
+000167a0: 4669 6c65 3a0a 2020 2020 2020 2020 2020  File:.          
+000167b0: 2020 6368 6563 6b65 645f 6669 6c65 5f70    checked_file_p
+000167c0: 6172 745f 696e 666f 203d 2073 656c 662e  art_info = self.
+000167d0: 5f63 6865 636b 5f66 696c 655f 7061 7274  _check_file_part
+000167e0: 5f69 6e66 6f28 636f 6e74 656e 742c 206f  _info(content, o
+000167f0: 6666 7365 742c 2070 6172 7453 697a 6529  ffset, partSize)
+00016800: 0a0a 2020 2020 2020 2020 2020 2020 6865  ..            he
+00016810: 6164 6572 7320 3d20 7b63 6f6e 7374 2e43  aders = {const.C
+00016820: 4f4e 5445 4e54 5f4c 454e 4754 485f 4845  ONTENT_LENGTH_HE
+00016830: 4144 4552 3a20 7574 696c 2e74 6f5f 7374  ADER: util.to_st
+00016840: 7269 6e67 2863 6865 636b 6564 5f66 696c  ring(checked_fil
+00016850: 655f 7061 7274 5f69 6e66 6f5b 2270 6172  e_part_info["par
+00016860: 7453 697a 6522 5d29 7d0a 2020 2020 2020  tSize"])}.      
+00016870: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+00016880: 7365 6c66 2e5f 7072 6570 6172 655f 6865  self._prepare_he
+00016890: 6164 6572 7328 6d64 352c 2069 7341 7474  aders(md5, isAtt
+000168a0: 6163 684d 6435 2c20 6368 6563 6b65 645f  achMd5, checked_
+000168b0: 6669 6c65 5f70 6172 745f 696e 666f 5b22  file_part_info["
+000168c0: 6669 6c65 5f70 6174 6822 5d2c 0a20 2020  file_path"],.   
+000168d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168f0: 2020 2020 2020 2020 2063 6865 636b 6564           checked
+00016900: 5f66 696c 655f 7061 7274 5f69 6e66 6f5b  _file_part_info[
+00016910: 2270 6172 7453 697a 6522 5d2c 2063 6865  "partSize"], che
+00016920: 636b 6564 5f66 696c 655f 7061 7274 5f69  cked_file_part_i
+00016930: 6e66 6f5b 226f 6666 7365 7422 5d2c 0a20  nfo["offset"],. 
+00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016960: 2020 2020 2020 2020 2020 2073 7365 4865             sseHe
+00016970: 6164 6572 2c20 6865 6164 6572 7329 0a0a  ader, headers)..
+00016980: 2020 2020 2020 2020 2020 2020 7265 6164              read
+00016990: 6162 6c65 2c20 6e6f 7469 6669 6572 203d  able, notifier =
+000169a0: 2073 656c 662e 5f70 7265 7061 7265 5f75   self._prepare_u
+000169b0: 706c 6f61 645f 7061 7274 5f6e 6f74 6966  pload_part_notif
+000169c0: 6965 7228 6368 6563 6b65 645f 6669 6c65  ier(checked_file
+000169d0: 5f70 6172 745f 696e 666f 5b22 7061 7274  _part_info["part
+000169e0: 5369 7a65 225d 2c0a 2020 2020 2020 2020  Size"],.        
+000169f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a20: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
+00016a30: 7265 7373 4361 6c6c 6261 636b 2c20 7265  ressCallback, re
+00016a40: 6164 6162 6c65 290a 2020 2020 2020 2020  adable).        
+00016a50: 2020 2020 7265 6164 6162 6c65 5f6f 626a      readable_obj
+00016a60: 6563 7420 3d20 6f70 656e 2863 6865 636b  ect = open(check
+00016a70: 6564 5f66 696c 655f 7061 7274 5f69 6e66  ed_file_part_inf
+00016a80: 6f5b 2266 696c 655f 7061 7468 225d 2c20  o["file_path"], 
+00016a90: 2272 6222 290a 2020 2020 2020 2020 2020  "rb").          
+00016aa0: 2020 7265 6164 6162 6c65 5f6f 626a 6563    readable_objec
+00016ab0: 742e 7365 656b 2863 6865 636b 6564 5f66  t.seek(checked_f
+00016ac0: 696c 655f 7061 7274 5f69 6e66 6f5b 226f  ile_part_info["o
+00016ad0: 6666 7365 7422 5d29 0a20 2020 2020 2020  ffset"]).       
+00016ae0: 2020 2020 2065 6e74 6974 7920 3d20 7574       entity = ut
+00016af0: 696c 2e67 6574 5f65 6e74 6974 795f 666f  il.get_entity_fo
+00016b00: 725f 7365 6e64 5f77 6974 685f 746f 7461  r_send_with_tota
+00016b10: 6c5f 636f 756e 7428 7265 6164 6162 6c65  l_count(readable
+00016b20: 5f6f 626a 6563 742c 2063 6865 636b 6564  _object, checked
+00016b30: 5f66 696c 655f 7061 7274 5f69 6e66 6f5b  _file_part_info[
+00016b40: 2270 6172 7453 697a 6522 5d2c 0a20 2020  "partSize"],.   
+00016b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016b90: 2e63 6875 6e6b 5f73 697a 652c 206e 6f74  .chunk_size, not
+00016ba0: 6966 6965 7229 0a20 2020 2020 2020 2065  ifier).        e
+00016bb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00016bc0: 2068 6561 6465 7273 203d 207b 7d0a 2020   headers = {}.  
+00016bd0: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
+00016be0: 7465 6e74 2069 7320 6e6f 7420 4e6f 6e65  tent is not None
+00016bf0: 2061 6e64 2068 6173 6174 7472 2863 6f6e   and hasattr(con
+00016c00: 7465 6e74 2c20 2772 6561 6427 2920 616e  tent, 'read') an
+00016c10: 6420 6361 6c6c 6162 6c65 2863 6f6e 7465  d callable(conte
+00016c20: 6e74 2e72 6561 6429 3a0a 2020 2020 2020  nt.read):.      
+00016c30: 2020 2020 2020 2020 2020 7265 6164 6162            readab
+00016c40: 6c65 203d 2054 7275 650a 2020 2020 2020  le = True.      
+00016c50: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00016c60: 7320 3d20 7365 6c66 2e5f 6765 745f 6865  s = self._get_he
+00016c70: 6164 6572 7328 6d64 352c 2073 7365 4865  aders(md5, sseHe
+00016c80: 6164 6572 2c20 6865 6164 6572 7329 0a0a  ader, headers)..
+00016c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ca0: 6966 2070 6172 7453 697a 6520 6973 204e  if partSize is N
+00016cb0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00016cc0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00016cd0: 675f 636c 6965 6e74 2e6c 6f67 2844 4542  g_client.log(DEB
+00016ce0: 5547 2c20 276d 6973 7369 6e67 2070 6172  UG, 'missing par
+00016cf0: 7453 697a 6520 7768 656e 2075 706c 6f61  tSize when uploa
+00016d00: 6469 6e67 2061 2072 6561 6461 626c 6520  ding a readable 
+00016d10: 7374 7265 616d 2729 0a20 2020 2020 2020  stream').       
+00016d20: 2020 2020 2020 2020 2020 2020 2063 6875               chu
+00016d30: 6e6b 6564 4d6f 6465 203d 2054 7275 650a  nkedMode = True.
 00016d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d60: 2070 6174 6841 7267 733d 7b27 7061 7274   pathArgs={'part
-00016d70: 4e75 6d62 6572 273a 2070 6172 744e 756d  Number': partNum
-00016d80: 6265 722c 2027 7570 6c6f 6164 4964 273a  ber, 'uploadId':
-00016d90: 2075 706c 6f61 6449 647d 2c0a 2020 2020   uploadId},.    
-00016da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016dc0: 2020 2020 2068 6561 6465 7273 3d68 6561       headers=hea
-00016dd0: 6465 7273 2c20 656e 7469 7479 3d65 6e74  ders, entity=ent
-00016de0: 6974 792c 2063 6875 6e6b 6564 4d6f 6465  ity, chunkedMode
-00016df0: 3d63 6875 6e6b 6564 4d6f 6465 2c0a 2020  =chunkedMode,.  
-00016e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d50: 2020 2020 6e6f 7469 6669 6572 203d 2073      notifier = s
+00016d60: 656c 662e 5f67 6574 5f6e 6f74 6966 6965  elf._get_notifie
+00016d70: 725f 7769 7468 6f75 745f 7369 7a65 2870  r_without_size(p
+00016d80: 726f 6772 6573 7343 616c 6c62 6163 6b29  rogressCallback)
+00016d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016da0: 2020 2020 2065 6e74 6974 7920 3d20 7574       entity = ut
+00016db0: 696c 2e67 6574 5f72 6561 6461 626c 655f  il.get_readable_
+00016dc0: 656e 7469 7479 2863 6f6e 7465 6e74 2c20  entity(content, 
+00016dd0: 7365 6c66 2e63 6875 6e6b 5f73 697a 652c  self.chunk_size,
+00016de0: 206e 6f74 6966 6965 722c 2061 7574 6f43   notifier, autoC
+00016df0: 6c6f 7365 290a 2020 2020 2020 2020 2020  lose).          
+00016e00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
 00016e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e20: 2020 2020 2020 206d 6574 686f 644e 616d         methodNam
-00016e30: 653d 2775 706c 6f61 6450 6172 7427 2c20  e='uploadPart', 
-00016e40: 7265 6164 6162 6c65 3d72 6561 6461 626c  readable=readabl
-00016e50: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-00016e60: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-00016e70: 6465 7273 290a 2020 2020 2020 2020 6669  ders).        fi
-00016e80: 6e61 6c6c 793a 0a20 2020 2020 2020 2020  nally:.         
-00016e90: 2020 2069 6620 6e6f 7469 6669 6572 2069     if notifier i
-00016ea0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00016eb0: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
-00016ec0: 6669 6572 2e65 6e64 2829 0a20 2020 2020  fier.end().     
-00016ed0: 2020 2072 6574 7572 6e20 7265 740a 0a20     return ret.. 
-00016ee0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-00016ef0: 0a20 2020 2064 6566 2063 6865 636b 5f66  .    def check_f
-00016f00: 696c 655f 7061 7468 2866 696c 655f 7061  ile_path(file_pa
-00016f10: 7468 293a 0a20 2020 2020 2020 2066 696c  th):.        fil
-00016f20: 655f 7061 7468 203d 2075 7469 6c2e 7361  e_path = util.sa
-00016f30: 6665 5f65 6e63 6f64 6528 6669 6c65 5f70  fe_encode(file_p
-00016f40: 6174 6829 0a20 2020 2020 2020 2069 6620  ath).        if 
-00016f50: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-00016f60: 7473 2866 696c 655f 7061 7468 293a 0a20  ts(file_path):. 
-00016f70: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00016f80: 7061 7468 203d 2075 7469 6c2e 7361 6665  path = util.safe
-00016f90: 5f74 7261 6e73 5f74 6f5f 6762 3233 3132  _trans_to_gb2312
-00016fa0: 2866 696c 655f 7061 7468 290a 2020 2020  (file_path).    
-00016fb0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00016fc0: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
-00016fd0: 6c65 5f70 6174 6829 3a0a 2020 2020 2020  le_path):.      
-00016fe0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00016ff0: 4578 6365 7074 696f 6e28 2766 696c 6520  Exception('file 
-00017000: 5b25 735d 2064 6f65 7320 6e6f 7420 6578  [%s] does not ex
-00017010: 6973 7427 2025 2066 696c 655f 7061 7468  ist' % file_path
-00017020: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00017030: 2066 696c 655f 7061 7468 0a0a 2020 2020   file_path..    
-00017040: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-00017050: 6566 205f 7570 6c6f 6164 5061 7274 5769  ef _uploadPartWi
-00017060: 7468 4e6f 7469 6669 6572 2873 656c 662c  thNotifier(self,
-00017070: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
-00017080: 6563 744b 6579 2c20 7061 7274 4e75 6d62  ectKey, partNumb
-00017090: 6572 2c20 7570 6c6f 6164 4964 2c20 636f  er, uploadId, co
-000170a0: 6e74 656e 743d 4e6f 6e65 2c20 6973 4669  ntent=None, isFi
-000170b0: 6c65 3d46 616c 7365 2c0a 2020 2020 2020  le=False,.      
-000170c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170d0: 2020 2020 2020 2020 2020 7061 7274 5369            partSi
-000170e0: 7a65 3d4e 6f6e 652c 206f 6666 7365 743d  ze=None, offset=
-000170f0: 302c 2073 7365 4865 6164 6572 3d4e 6f6e  0, sseHeader=Non
-00017100: 652c 2069 7341 7474 6163 684d 6435 3d46  e, isAttachMd5=F
-00017110: 616c 7365 2c20 6d64 353d 4e6f 6e65 2c20  alse, md5=None, 
-00017120: 6e6f 7469 6669 6572 3d4e 6f6e 652c 0a20  notifier=None,. 
-00017130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017140: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00017150: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00017160: 4e6f 6e65 2c20 6865 6164 6572 733d 4e6f  None, headers=No
-00017170: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
-00017180: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
-00017190: 6c6c 2870 6172 744e 756d 6265 722c 2027  ll(partNumber, '
-000171a0: 7061 7274 4e75 6d62 6572 2069 7320 656d  partNumber is em
-000171b0: 7074 7927 290a 2020 2020 2020 2020 7365  pty').        se
-000171c0: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
-000171d0: 756c 6c28 7570 6c6f 6164 4964 2c20 2775  ull(uploadId, 'u
-000171e0: 706c 6f61 6449 6420 6973 2065 6d70 7479  ploadId is empty
-000171f0: 2729 0a0a 2020 2020 2020 2020 6368 756e  ')..        chun
-00017200: 6b65 644d 6f64 6520 3d20 4661 6c73 650a  kedMode = False.
-00017210: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
-00017220: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00017230: 2069 6620 6865 6164 6572 7320 6973 204e   if headers is N
-00017240: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00017250: 2068 6561 6465 7273 203d 2064 6963 7428   headers = dict(
-00017260: 290a 2020 2020 2020 2020 6966 2069 7346  ).        if isF
-00017270: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-00017280: 2063 6865 636b 6564 5f66 696c 655f 7061   checked_file_pa
-00017290: 7274 5f69 6e66 6f20 3d20 7365 6c66 2e5f  rt_info = self._
-000172a0: 6368 6563 6b5f 6669 6c65 5f70 6172 745f  check_file_part_
-000172b0: 696e 666f 2863 6f6e 7465 6e74 2c20 6f66  info(content, of
-000172c0: 6673 6574 2c20 7061 7274 5369 7a65 290a  fset, partSize).
-000172d0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-000172e0: 6465 7273 5b63 6f6e 7374 2e43 4f4e 5445  ders[const.CONTE
-000172f0: 4e54 5f4c 454e 4754 485f 4845 4144 4552  NT_LENGTH_HEADER
-00017300: 5d20 3d20 7574 696c 2e74 6f5f 7374 7269  ] = util.to_stri
-00017310: 6e67 2863 6865 636b 6564 5f66 696c 655f  ng(checked_file_
-00017320: 7061 7274 5f69 6e66 6f5b 2270 6172 7453  part_info["partS
-00017330: 697a 6522 5d29 0a20 2020 2020 2020 2020  ize"]).         
-00017340: 2020 2068 6561 6465 7273 203d 2073 656c     headers = sel
-00017350: 662e 5f70 7265 7061 7265 5f68 6561 6465  f._prepare_heade
-00017360: 7273 286d 6435 2c20 6973 4174 7461 6368  rs(md5, isAttach
-00017370: 4d64 352c 2063 6865 636b 6564 5f66 696c  Md5, checked_fil
-00017380: 655f 7061 7274 5f69 6e66 6f5b 2266 696c  e_part_info["fil
-00017390: 655f 7061 7468 225d 2c0a 2020 2020 2020  e_path"],.      
-000173a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173c0: 2020 2020 2020 6368 6563 6b65 645f 6669        checked_fi
-000173d0: 6c65 5f70 6172 745f 696e 666f 5b22 7061  le_part_info["pa
-000173e0: 7274 5369 7a65 225d 2c20 6368 6563 6b65  rtSize"], checke
-000173f0: 645f 6669 6c65 5f70 6172 745f 696e 666f  d_file_part_info
-00017400: 5b22 6f66 6673 6574 225d 2c0a 2020 2020  ["offset"],.    
-00017410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017430: 2020 2020 2020 2020 7373 6548 6561 6465          sseHeade
-00017440: 722c 2068 6561 6465 7273 290a 0a20 2020  r, headers)..   
-00017450: 2020 2020 2020 2020 2069 6620 6e6f 7469           if noti
-00017460: 6669 6572 2069 7320 6e6f 7420 4e6f 6e65  fier is not None
-00017470: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
-00017480: 6e63 6528 6e6f 7469 6669 6572 2c20 7072  nce(notifier, pr
-00017490: 6f67 7265 7373 2e4e 6f6e 654e 6f74 6966  ogress.NoneNotif
-000174a0: 6965 7229 3a0a 2020 2020 2020 2020 2020  ier):.          
-000174b0: 2020 2020 2020 7265 6164 6162 6c65 203d        readable =
-000174c0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-000174d0: 2020 7265 6164 6162 6c65 5f6f 626a 6563    readable_objec
-000174e0: 7420 3d20 6f70 656e 2863 6865 636b 6564  t = open(checked
-000174f0: 5f66 696c 655f 7061 7274 5f69 6e66 6f5b  _file_part_info[
-00017500: 2266 696c 655f 7061 7468 225d 2c20 2272  "file_path"], "r
-00017510: 6222 290a 2020 2020 2020 2020 2020 2020  b").            
-00017520: 7265 6164 6162 6c65 5f6f 626a 6563 742e  readable_object.
-00017530: 7365 656b 2863 6865 636b 6564 5f66 696c  seek(checked_fil
-00017540: 655f 7061 7274 5f69 6e66 6f5b 226f 6666  e_part_info["off
-00017550: 7365 7422 5d29 0a20 2020 2020 2020 2020  set"]).         
-00017560: 2020 2065 6e74 6974 7920 3d20 7574 696c     entity = util
-00017570: 2e67 6574 5f65 6e74 6974 795f 666f 725f  .get_entity_for_
-00017580: 7365 6e64 5f77 6974 685f 746f 7461 6c5f  send_with_total_
-00017590: 636f 756e 7428 7265 6164 6162 6c65 5f6f  count(readable_o
-000175a0: 626a 6563 742c 2070 6172 7453 697a 652c  bject, partSize,
-000175b0: 2073 656c 662e 6368 756e 6b5f 7369 7a65   self.chunk_size
-000175c0: 2c20 6e6f 7469 6669 6572 290a 2020 2020  , notifier).    
-000175d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000175e0: 2020 2020 2020 6966 2063 6f6e 7465 6e74        if content
-000175f0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00017600: 2068 6173 6174 7472 2863 6f6e 7465 6e74   hasattr(content
-00017610: 2c20 2772 6561 6427 2920 616e 6420 6361  , 'read') and ca
-00017620: 6c6c 6162 6c65 2863 6f6e 7465 6e74 2e72  llable(content.r
-00017630: 6561 6429 3a0a 2020 2020 2020 2020 2020  ead):.          
-00017640: 2020 2020 2020 7265 6164 6162 6c65 203d        readable =
-00017650: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00017660: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
-00017670: 7365 6c66 2e5f 6765 745f 6865 6164 6572  self._get_header
-00017680: 7328 6d64 352c 2073 7365 4865 6164 6572  s(md5, sseHeader
-00017690: 2c20 6865 6164 6572 7329 0a0a 2020 2020  , headers)..    
-000176a0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-000176b0: 6172 7453 697a 6520 6973 204e 6f6e 653a  artSize is None:
-000176c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000176d0: 2020 2020 2063 6875 6e6b 6564 4d6f 6465       chunkedMode
-000176e0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000176f0: 2020 2020 2020 2020 2020 2020 656e 7469              enti
-00017700: 7479 203d 2075 7469 6c2e 6765 745f 7265  ty = util.get_re
-00017710: 6164 6162 6c65 5f65 6e74 6974 7928 636f  adable_entity(co
-00017720: 6e74 656e 742c 2073 656c 662e 6368 756e  ntent, self.chun
-00017730: 6b5f 7369 7a65 2c20 6e6f 7469 6669 6572  k_size, notifier
-00017740: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017750: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00017760: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00017770: 6572 735b 636f 6e73 742e 434f 4e54 454e  ers[const.CONTEN
-00017780: 545f 4c45 4e47 5448 5f48 4541 4445 525d  T_LENGTH_HEADER]
-00017790: 203d 2075 7469 6c2e 746f 5f73 7472 696e   = util.to_strin
-000177a0: 6728 7061 7274 5369 7a65 290a 2020 2020  g(partSize).    
-000177b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177c0: 656e 7469 7479 203d 2075 7469 6c2e 6765  entity = util.ge
-000177d0: 745f 656e 7469 7479 5f66 6f72 5f73 656e  t_entity_for_sen
-000177e0: 645f 7769 7468 5f74 6f74 616c 5f63 6f75  d_with_total_cou
-000177f0: 6e74 2863 6f6e 7465 6e74 2c20 7574 696c  nt(content, util
-00017800: 2e74 6f5f 6c6f 6e67 2870 6172 7453 697a  .to_long(partSiz
-00017810: 6529 2c20 7365 6c66 2e63 6875 6e6b 5f73  e), self.chunk_s
-00017820: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-00017830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017860: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
-00017870: 6669 6572 290a 2020 2020 2020 2020 2020  fier).          
-00017880: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00017890: 2020 2020 2020 2020 656e 7469 7479 203d          entity =
-000178a0: 2063 6f6e 7465 6e74 0a20 2020 2020 2020   content.       
-000178b0: 2020 2020 2020 2020 2069 6620 656e 7469           if enti
-000178c0: 7479 2069 7320 4e6f 6e65 3a0a 2020 2020  ty is None:.    
-000178d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178e0: 656e 7469 7479 203d 2027 270a 2020 2020  entity = ''.    
-000178f0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00017900: 6572 7320 3d20 7365 6c66 2e5f 6765 745f  ers = self._get_
-00017910: 6865 6164 6572 7328 6d64 352c 2073 7365  headers(md5, sse
-00017920: 4865 6164 6572 2c20 6865 6164 6572 7329  Header, headers)
-00017930: 0a0a 2020 2020 2020 2020 7265 7420 3d20  ..        ret = 
-00017940: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
-00017950: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-00017960: 652c 206f 626a 6563 744b 6579 2c20 7061  e, objectKey, pa
-00017970: 7468 4172 6773 3d7b 2770 6172 744e 756d  thArgs={'partNum
-00017980: 6265 7227 3a20 7061 7274 4e75 6d62 6572  ber': partNumber
-00017990: 2c20 2775 706c 6f61 6449 6427 3a20 7570  , 'uploadId': up
-000179a0: 6c6f 6164 4964 7d2c 0a20 2020 2020 2020  loadId},.       
-000179b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179c0: 2020 2020 2020 2020 2020 2020 2020 6865                he
-000179d0: 6164 6572 733d 6865 6164 6572 732c 2065  aders=headers, e
-000179e0: 6e74 6974 793d 656e 7469 7479 2c20 6368  ntity=entity, ch
-000179f0: 756e 6b65 644d 6f64 653d 6368 756e 6b65  unkedMode=chunke
-00017a00: 644d 6f64 652c 206d 6574 686f 644e 616d  dMode, methodNam
-00017a10: 653d 2775 706c 6f61 6450 6172 7427 2c0a  e='uploadPart',.
-00017a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a40: 2020 2020 2072 6561 6461 626c 653d 7265       readable=re
-00017a50: 6164 6162 6c65 2c20 6578 7465 6e73 696f  adable, extensio
-00017a60: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-00017a70: 6f6e 4865 6164 6572 7329 0a20 2020 2020  onHeaders).     
-00017a80: 2020 2072 6574 7572 6e20 7265 740a 0a20     return ret.. 
-00017a90: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-00017aa0: 2020 6465 6620 636f 7079 4f62 6a65 6374    def copyObject
-00017ab0: 2873 656c 662c 2073 6f75 7263 6542 7563  (self, sourceBuc
-00017ac0: 6b65 744e 616d 652c 2073 6f75 7263 654f  ketName, sourceO
-00017ad0: 626a 6563 744b 6579 2c20 6465 7374 4275  bjectKey, destBu
-00017ae0: 636b 6574 4e61 6d65 2c20 6465 7374 4f62  cketName, destOb
-00017af0: 6a65 6374 4b65 792c 206d 6574 6164 6174  jectKey, metadat
-00017b00: 613d 4e6f 6e65 2c20 6865 6164 6572 733d  a=None, headers=
-00017b10: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00017b20: 2020 2020 2020 2020 2076 6572 7369 6f6e           version
-00017b30: 4964 3d4e 6f6e 652c 2065 7874 656e 7369  Id=None, extensi
-00017b40: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-00017b50: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
-00017b60: 7373 6572 745f 6e6f 745f 6e75 6c6c 2873  ssert_not_null(s
-00017b70: 6f75 7263 6542 7563 6b65 744e 616d 652c  ourceBucketName,
-00017b80: 2027 736f 7572 6365 4275 636b 6574 4e61   'sourceBucketNa
-00017b90: 6d65 2069 7320 656d 7074 7927 290a 2020  me is empty').  
-00017ba0: 2020 2020 2020 736f 7572 6365 4f62 6a65        sourceObje
-00017bb0: 6374 4b65 7920 3d20 7574 696c 2e73 6166  ctKey = util.saf
-00017bc0: 655f 656e 636f 6465 2873 6f75 7263 654f  e_encode(sourceO
-00017bd0: 626a 6563 744b 6579 290a 2020 2020 2020  bjectKey).      
-00017be0: 2020 6966 2073 6f75 7263 654f 626a 6563    if sourceObjec
-00017bf0: 744b 6579 2069 7320 4e6f 6e65 3a0a 2020  tKey is None:.  
-00017c00: 2020 2020 2020 2020 2020 736f 7572 6365            source
-00017c10: 4f62 6a65 6374 4b65 7920 3d20 2727 0a20  ObjectKey = ''. 
-00017c20: 2020 2020 2020 2064 6573 744f 626a 6563         destObjec
-00017c30: 744b 6579 203d 2075 7469 6c2e 7361 6665  tKey = util.safe
-00017c40: 5f65 6e63 6f64 6528 6465 7374 4f62 6a65  _encode(destObje
-00017c50: 6374 4b65 7929 0a20 2020 2020 2020 2069  ctKey).        i
-00017c60: 6620 6465 7374 4f62 6a65 6374 4b65 7920  f destObjectKey 
-00017c70: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00017c80: 2020 2020 2064 6573 744f 626a 6563 744b       destObjectK
-00017c90: 6579 203d 2027 270a 0a20 2020 2020 2020  ey = ''..       
-00017ca0: 2069 6620 6865 6164 6572 7320 6973 204e   if headers is N
-00017cb0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00017cc0: 2068 6561 6465 7273 203d 2043 6f70 794f   headers = CopyO
-00017cd0: 626a 6563 7448 6561 6465 7228 290a 0a20  bjectHeader().. 
-00017ce0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00017cf0: 6c66 2e5f 6d61 6b65 5f70 7574 5f72 6571  lf._make_put_req
-00017d00: 7565 7374 2864 6573 7442 7563 6b65 744e  uest(destBucketN
-00017d10: 616d 652c 2064 6573 744f 626a 6563 744b  ame, destObjectK
-00017d20: 6579 2c0a 2020 2020 2020 2020 2020 2020  ey,.            
-00017d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d40: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00017d50: 4e61 6d65 3d27 636f 7079 4f62 6a65 6374  Name='copyObject
-00017d60: 272c 2065 7874 656e 7369 6f6e 4865 6164  ', extensionHead
-00017d70: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-00017d80: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
+00016e20: 6865 6164 6572 735b 636f 6e73 742e 434f  headers[const.CO
+00016e30: 4e54 454e 545f 4c45 4e47 5448 5f48 4541  NTENT_LENGTH_HEA
+00016e40: 4445 525d 203d 2075 7469 6c2e 746f 5f73  DER] = util.to_s
+00016e50: 7472 696e 6728 7061 7274 5369 7a65 290a  tring(partSize).
+00016e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e70: 2020 2020 746f 7461 6c43 6f75 6e74 203d      totalCount =
+00016e80: 2075 7469 6c2e 746f 5f6c 6f6e 6728 7061   util.to_long(pa
+00016e90: 7274 5369 7a65 290a 2020 2020 2020 2020  rtSize).        
+00016ea0: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+00016eb0: 6669 6572 203d 2073 656c 662e 5f67 6574  fier = self._get
+00016ec0: 5f6e 6f74 6966 6965 725f 7769 7468 5f73  _notifier_with_s
+00016ed0: 697a 6528 7072 6f67 7265 7373 4361 6c6c  ize(progressCall
+00016ee0: 6261 636b 2c20 746f 7461 6c43 6f75 6e74  back, totalCount
+00016ef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016f00: 2020 2020 2020 656e 7469 7479 203d 2075        entity = u
+00016f10: 7469 6c2e 6765 745f 656e 7469 7479 5f66  til.get_entity_f
+00016f20: 6f72 5f73 656e 645f 7769 7468 5f74 6f74  or_send_with_tot
+00016f30: 616c 5f63 6f75 6e74 2863 6f6e 7465 6e74  al_count(content
+00016f40: 2c20 746f 7461 6c43 6f75 6e74 2c20 7365  , totalCount, se
+00016f50: 6c66 2e63 6875 6e6b 5f73 697a 652c 206e  lf.chunk_size, n
+00016f60: 6f74 6966 6965 722c 0a20 2020 2020 2020  otifier,.       
+00016f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fb0: 6175 746f 436c 6f73 6529 0a20 2020 2020  autoClose).     
+00016fc0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00016fd0: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+00016fe0: 6974 7920 3d20 636f 6e74 656e 740a 2020  ity = content.  
+00016ff0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00017000: 2065 6e74 6974 7920 6973 204e 6f6e 653a   entity is None:
+00017010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017020: 2020 2020 2065 6e74 6974 7920 3d20 2727       entity = ''
+00017030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017040: 2068 6561 6465 7273 203d 2073 656c 662e   headers = self.
+00017050: 5f67 6574 5f68 6561 6465 7273 286d 6435  _get_headers(md5
+00017060: 2c20 7373 6548 6561 6465 722c 2068 6561  , sseHeader, hea
+00017070: 6465 7273 290a 0a20 2020 2020 2020 2074  ders)..        t
+00017080: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00017090: 6966 206e 6f74 6966 6965 7220 6973 206e  if notifier is n
+000170a0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000170b0: 2020 2020 2020 2020 206e 6f74 6966 6965           notifie
+000170c0: 722e 7374 6172 7428 290a 2020 2020 2020  r.start().      
+000170d0: 2020 2020 2020 7265 7420 3d20 7365 6c66        ret = self
+000170e0: 2e5f 6d61 6b65 5f70 7574 5f72 6571 7565  ._make_put_reque
+000170f0: 7374 2862 7563 6b65 744e 616d 652c 206f  st(bucketName, o
+00017100: 626a 6563 744b 6579 2c0a 2020 2020 2020  bjectKey,.      
+00017110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017130: 2020 2070 6174 6841 7267 733d 7b27 7061     pathArgs={'pa
+00017140: 7274 4e75 6d62 6572 273a 2070 6172 744e  rtNumber': partN
+00017150: 756d 6265 722c 2027 7570 6c6f 6164 4964  umber, 'uploadId
+00017160: 273a 2075 706c 6f61 6449 647d 2c0a 2020  ': uploadId},.  
+00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017190: 2020 2020 2020 2068 6561 6465 7273 3d68         headers=h
+000171a0: 6561 6465 7273 2c20 656e 7469 7479 3d65  eaders, entity=e
+000171b0: 6e74 6974 792c 2063 6875 6e6b 6564 4d6f  ntity, chunkedMo
+000171c0: 6465 3d63 6875 6e6b 6564 4d6f 6465 2c0a  de=chunkedMode,.
+000171d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171f0: 2020 2020 2020 2020 206d 6574 686f 644e           methodN
+00017200: 616d 653d 2775 706c 6f61 6450 6172 7427  ame='uploadPart'
+00017210: 2c20 7265 6164 6162 6c65 3d72 6561 6461  , readable=reada
+00017220: 626c 652c 2065 7874 656e 7369 6f6e 4865  ble, extensionHe
+00017230: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+00017240: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
+00017250: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+00017260: 2020 2020 2069 6620 6e6f 7469 6669 6572       if notifier
+00017270: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00017280: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00017290: 7469 6669 6572 2e65 6e64 2829 0a20 2020  tifier.end().   
+000172a0: 2020 2020 2072 6574 7572 6e20 7265 740a       return ret.
+000172b0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+000172c0: 6f64 0a20 2020 2064 6566 2063 6865 636b  od.    def check
+000172d0: 5f66 696c 655f 7061 7468 2866 696c 655f  _file_path(file_
+000172e0: 7061 7468 293a 0a20 2020 2020 2020 2066  path):.        f
+000172f0: 696c 655f 7061 7468 203d 2075 7469 6c2e  ile_path = util.
+00017300: 7361 6665 5f65 6e63 6f64 6528 6669 6c65  safe_encode(file
+00017310: 5f70 6174 6829 0a20 2020 2020 2020 2069  _path).        i
+00017320: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+00017330: 6973 7473 2866 696c 655f 7061 7468 293a  ists(file_path):
+00017340: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00017350: 655f 7061 7468 203d 2075 7469 6c2e 7361  e_path = util.sa
+00017360: 6665 5f74 7261 6e73 5f74 6f5f 6762 3233  fe_trans_to_gb23
+00017370: 3132 2866 696c 655f 7061 7468 290a 2020  12(file_path).  
+00017380: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00017390: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000173a0: 6669 6c65 5f70 6174 6829 3a0a 2020 2020  file_path):.    
+000173b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000173c0: 6520 4578 6365 7074 696f 6e28 2766 696c  e Exception('fil
+000173d0: 6520 5b25 735d 2064 6f65 7320 6e6f 7420  e [%s] does not 
+000173e0: 6578 6973 7427 2025 2066 696c 655f 7061  exist' % file_pa
+000173f0: 7468 290a 2020 2020 2020 2020 7265 7475  th).        retu
+00017400: 726e 2066 696c 655f 7061 7468 0a0a 2020  rn file_path..  
+00017410: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+00017420: 2064 6566 205f 7570 6c6f 6164 5061 7274   def _uploadPart
+00017430: 5769 7468 4e6f 7469 6669 6572 2873 656c  WithNotifier(sel
+00017440: 662c 2062 7563 6b65 744e 616d 652c 206f  f, bucketName, o
+00017450: 626a 6563 744b 6579 2c20 7061 7274 4e75  bjectKey, partNu
+00017460: 6d62 6572 2c20 7570 6c6f 6164 4964 2c20  mber, uploadId, 
+00017470: 636f 6e74 656e 743d 4e6f 6e65 2c20 6973  content=None, is
+00017480: 4669 6c65 3d46 616c 7365 2c0a 2020 2020  File=False,.    
+00017490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174a0: 2020 2020 2020 2020 2020 2020 7061 7274              part
+000174b0: 5369 7a65 3d4e 6f6e 652c 206f 6666 7365  Size=None, offse
+000174c0: 743d 302c 2073 7365 4865 6164 6572 3d4e  t=0, sseHeader=N
+000174d0: 6f6e 652c 2069 7341 7474 6163 684d 6435  one, isAttachMd5
+000174e0: 3d46 616c 7365 2c20 6d64 353d 4e6f 6e65  =False, md5=None
+000174f0: 2c20 6e6f 7469 6669 6572 3d4e 6f6e 652c  , notifier=None,
+00017500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017520: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+00017530: 733d 4e6f 6e65 2c20 6865 6164 6572 733d  s=None, headers=
+00017540: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
+00017550: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
+00017560: 6e75 6c6c 2870 6172 744e 756d 6265 722c  null(partNumber,
+00017570: 2027 7061 7274 4e75 6d62 6572 2069 7320   'partNumber is 
+00017580: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
+00017590: 7365 6c66 2e5f 6173 7365 7274 5f6e 6f74  self._assert_not
+000175a0: 5f6e 756c 6c28 7570 6c6f 6164 4964 2c20  _null(uploadId, 
+000175b0: 2775 706c 6f61 6449 6420 6973 2065 6d70  'uploadId is emp
+000175c0: 7479 2729 0a0a 2020 2020 2020 2020 6368  ty')..        ch
+000175d0: 756e 6b65 644d 6f64 6520 3d20 4661 6c73  unkedMode = Fals
+000175e0: 650a 2020 2020 2020 2020 7265 6164 6162  e.        readab
+000175f0: 6c65 203d 2046 616c 7365 0a20 2020 2020  le = False.     
+00017600: 2020 2069 6620 6865 6164 6572 7320 6973     if headers is
+00017610: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00017620: 2020 2068 6561 6465 7273 203d 2064 6963     headers = dic
+00017630: 7428 290a 2020 2020 2020 2020 6966 2069  t().        if i
+00017640: 7346 696c 653a 0a20 2020 2020 2020 2020  sFile:.         
+00017650: 2020 2063 6865 636b 6564 5f66 696c 655f     checked_file_
+00017660: 7061 7274 5f69 6e66 6f20 3d20 7365 6c66  part_info = self
+00017670: 2e5f 6368 6563 6b5f 6669 6c65 5f70 6172  ._check_file_par
+00017680: 745f 696e 666f 2863 6f6e 7465 6e74 2c20  t_info(content, 
+00017690: 6f66 6673 6574 2c20 7061 7274 5369 7a65  offset, partSize
+000176a0: 290a 0a20 2020 2020 2020 2020 2020 2068  )..            h
+000176b0: 6561 6465 7273 5b63 6f6e 7374 2e43 4f4e  eaders[const.CON
+000176c0: 5445 4e54 5f4c 454e 4754 485f 4845 4144  TENT_LENGTH_HEAD
+000176d0: 4552 5d20 3d20 7574 696c 2e74 6f5f 7374  ER] = util.to_st
+000176e0: 7269 6e67 2863 6865 636b 6564 5f66 696c  ring(checked_fil
+000176f0: 655f 7061 7274 5f69 6e66 6f5b 2270 6172  e_part_info["par
+00017700: 7453 697a 6522 5d29 0a20 2020 2020 2020  tSize"]).       
+00017710: 2020 2020 2068 6561 6465 7273 203d 2073       headers = s
+00017720: 656c 662e 5f70 7265 7061 7265 5f68 6561  elf._prepare_hea
+00017730: 6465 7273 286d 6435 2c20 6973 4174 7461  ders(md5, isAtta
+00017740: 6368 4d64 352c 2063 6865 636b 6564 5f66  chMd5, checked_f
+00017750: 696c 655f 7061 7274 5f69 6e66 6f5b 2266  ile_part_info["f
+00017760: 696c 655f 7061 7468 225d 2c0a 2020 2020  ile_path"],.    
+00017770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017790: 2020 2020 2020 2020 6368 6563 6b65 645f          checked_
+000177a0: 6669 6c65 5f70 6172 745f 696e 666f 5b22  file_part_info["
+000177b0: 7061 7274 5369 7a65 225d 2c20 6368 6563  partSize"], chec
+000177c0: 6b65 645f 6669 6c65 5f70 6172 745f 696e  ked_file_part_in
+000177d0: 666f 5b22 6f66 6673 6574 225d 2c0a 2020  fo["offset"],.  
+000177e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017800: 2020 2020 2020 2020 2020 7373 6548 6561            sseHea
+00017810: 6465 722c 2068 6561 6465 7273 290a 0a20  der, headers).. 
+00017820: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00017830: 7469 6669 6572 2069 7320 6e6f 7420 4e6f  tifier is not No
+00017840: 6e65 2061 6e64 206e 6f74 2069 7369 6e73  ne and not isins
+00017850: 7461 6e63 6528 6e6f 7469 6669 6572 2c20  tance(notifier, 
+00017860: 7072 6f67 7265 7373 2e4e 6f6e 654e 6f74  progress.NoneNot
+00017870: 6966 6965 7229 3a0a 2020 2020 2020 2020  ifier):.        
+00017880: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
+00017890: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+000178a0: 2020 2020 7265 6164 6162 6c65 5f6f 626a      readable_obj
+000178b0: 6563 7420 3d20 6f70 656e 2863 6865 636b  ect = open(check
+000178c0: 6564 5f66 696c 655f 7061 7274 5f69 6e66  ed_file_part_inf
+000178d0: 6f5b 2266 696c 655f 7061 7468 225d 2c20  o["file_path"], 
+000178e0: 2272 6222 290a 2020 2020 2020 2020 2020  "rb").          
+000178f0: 2020 7265 6164 6162 6c65 5f6f 626a 6563    readable_objec
+00017900: 742e 7365 656b 2863 6865 636b 6564 5f66  t.seek(checked_f
+00017910: 696c 655f 7061 7274 5f69 6e66 6f5b 226f  ile_part_info["o
+00017920: 6666 7365 7422 5d29 0a20 2020 2020 2020  ffset"]).       
+00017930: 2020 2020 2065 6e74 6974 7920 3d20 7574       entity = ut
+00017940: 696c 2e67 6574 5f65 6e74 6974 795f 666f  il.get_entity_fo
+00017950: 725f 7365 6e64 5f77 6974 685f 746f 7461  r_send_with_tota
+00017960: 6c5f 636f 756e 7428 7265 6164 6162 6c65  l_count(readable
+00017970: 5f6f 626a 6563 742c 2070 6172 7453 697a  _object, partSiz
+00017980: 652c 2073 656c 662e 6368 756e 6b5f 7369  e, self.chunk_si
+00017990: 7a65 2c20 6e6f 7469 6669 6572 290a 2020  ze, notifier).  
+000179a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000179b0: 2020 2020 2020 2020 6966 2063 6f6e 7465          if conte
+000179c0: 6e74 2069 7320 6e6f 7420 4e6f 6e65 2061  nt is not None a
+000179d0: 6e64 2068 6173 6174 7472 2863 6f6e 7465  nd hasattr(conte
+000179e0: 6e74 2c20 2772 6561 6427 2920 616e 6420  nt, 'read') and 
+000179f0: 6361 6c6c 6162 6c65 2863 6f6e 7465 6e74  callable(content
+00017a00: 2e72 6561 6429 3a0a 2020 2020 2020 2020  .read):.        
+00017a10: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
+00017a20: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00017a30: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
+00017a40: 3d20 7365 6c66 2e5f 6765 745f 6865 6164  = self._get_head
+00017a50: 6572 7328 6d64 352c 2073 7365 4865 6164  ers(md5, sseHead
+00017a60: 6572 2c20 6865 6164 6572 7329 0a0a 2020  er, headers)..  
+00017a70: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00017a80: 2070 6172 7453 697a 6520 6973 204e 6f6e   partSize is Non
+00017a90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017aa0: 2020 2020 2020 2063 6875 6e6b 6564 4d6f         chunkedMo
+00017ab0: 6465 203d 2054 7275 650a 2020 2020 2020  de = True.      
+00017ac0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00017ad0: 7469 7479 203d 2075 7469 6c2e 6765 745f  tity = util.get_
+00017ae0: 7265 6164 6162 6c65 5f65 6e74 6974 7928  readable_entity(
+00017af0: 636f 6e74 656e 742c 2073 656c 662e 6368  content, self.ch
+00017b00: 756e 6b5f 7369 7a65 2c20 6e6f 7469 6669  unk_size, notifi
+00017b10: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+00017b20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00017b30: 2020 2020 2020 2020 2020 2020 2020 6865                he
+00017b40: 6164 6572 735b 636f 6e73 742e 434f 4e54  aders[const.CONT
+00017b50: 454e 545f 4c45 4e47 5448 5f48 4541 4445  ENT_LENGTH_HEADE
+00017b60: 525d 203d 2075 7469 6c2e 746f 5f73 7472  R] = util.to_str
+00017b70: 696e 6728 7061 7274 5369 7a65 290a 2020  ing(partSize).  
+00017b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b90: 2020 656e 7469 7479 203d 2075 7469 6c2e    entity = util.
+00017ba0: 6765 745f 656e 7469 7479 5f66 6f72 5f73  get_entity_for_s
+00017bb0: 656e 645f 7769 7468 5f74 6f74 616c 5f63  end_with_total_c
+00017bc0: 6f75 6e74 2863 6f6e 7465 6e74 2c20 7574  ount(content, ut
+00017bd0: 696c 2e74 6f5f 6c6f 6e67 2870 6172 7453  il.to_long(partS
+00017be0: 697a 6529 2c20 7365 6c66 2e63 6875 6e6b  ize), self.chunk
+00017bf0: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
+00017c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c30: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00017c40: 7469 6669 6572 290a 2020 2020 2020 2020  tifier).        
+00017c50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00017c60: 2020 2020 2020 2020 2020 656e 7469 7479            entity
+00017c70: 203d 2063 6f6e 7465 6e74 0a20 2020 2020   = content.     
+00017c80: 2020 2020 2020 2020 2020 2069 6620 656e             if en
+00017c90: 7469 7479 2069 7320 4e6f 6e65 3a0a 2020  tity is None:.  
+00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cb0: 2020 656e 7469 7479 203d 2027 270a 2020    entity = ''.  
+00017cc0: 2020 2020 2020 2020 2020 2020 2020 6865                he
+00017cd0: 6164 6572 7320 3d20 7365 6c66 2e5f 6765  aders = self._ge
+00017ce0: 745f 6865 6164 6572 7328 6d64 352c 2073  t_headers(md5, s
+00017cf0: 7365 4865 6164 6572 2c20 6865 6164 6572  seHeader, header
+00017d00: 7329 0a0a 2020 2020 2020 2020 7265 7420  s)..        ret 
+00017d10: 3d20 7365 6c66 2e5f 6d61 6b65 5f70 7574  = self._make_put
+00017d20: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
+00017d30: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+00017d40: 7061 7468 4172 6773 3d7b 2770 6172 744e  pathArgs={'partN
+00017d50: 756d 6265 7227 3a20 7061 7274 4e75 6d62  umber': partNumb
+00017d60: 6572 2c20 2775 706c 6f61 6449 6427 3a20  er, 'uploadId': 
+00017d70: 7570 6c6f 6164 4964 7d2c 0a20 2020 2020  uploadId},.     
+00017d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00017d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017da0: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
-00017db0: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
-00017dc0: 6e73 5f63 6f70 795f 6f62 6a65 6374 286d  ns_copy_object(m
-00017dd0: 6574 6164 6174 613d 6d65 7461 6461 7461  etadata=metadata
-00017de0: 2c20 6865 6164 6572 733d 6865 6164 6572  , headers=header
-00017df0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00017da0: 6865 6164 6572 733d 6865 6164 6572 732c  headers=headers,
+00017db0: 2065 6e74 6974 793d 656e 7469 7479 2c20   entity=entity, 
+00017dc0: 6368 756e 6b65 644d 6f64 653d 6368 756e  chunkedMode=chun
+00017dd0: 6b65 644d 6f64 652c 206d 6574 686f 644e  kedMode, methodN
+00017de0: 616d 653d 2775 706c 6f61 6450 6172 7427  ame='uploadPart'
+00017df0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00017e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e30: 2020 2020 2020 2020 2020 2020 7665 7273              vers
-00017e40: 696f 6e49 643d 7665 7273 696f 6e49 642c  ionId=versionId,
-00017e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e90: 2020 2020 2020 2020 2020 736f 7572 6365            source
-00017ea0: 4275 636b 6574 4e61 6d65 3d73 6f75 7263  BucketName=sourc
-00017eb0: 6542 7563 6b65 744e 616d 652c 0a20 2020  eBucketName,.   
-00017ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f00: 2020 2020 2020 736f 7572 6365 4f62 6a65        sourceObje
-00017f10: 6374 4b65 793d 736f 7572 6365 4f62 6a65  ctKey=sourceObje
-00017f20: 6374 4b65 7929 290a 0a20 2020 2040 6675  ctKey))..    @fu
-00017f30: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-00017f40: 7365 744f 626a 6563 7441 636c 2873 656c  setObjectAcl(sel
-00017f50: 662c 2062 7563 6b65 744e 616d 652c 206f  f, bucketName, o
-00017f60: 626a 6563 744b 6579 2c20 6163 6c3d 4e6f  bjectKey, acl=No
-00017f70: 6e65 2c20 7665 7273 696f 6e49 643d 4e6f  ne, versionId=No
-00017f80: 6e65 2c20 6163 6c43 6f6e 7472 6f6c 3d4e  ne, aclControl=N
-00017f90: 6f6e 652c 2065 7874 656e 7369 6f6e 4865  one, extensionHe
-00017fa0: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-00017fb0: 2020 2020 2069 6620 6163 6c20 6973 204e       if acl is N
-00017fc0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00017fd0: 2061 636c 203d 2041 434c 2829 0a20 2020   acl = ACL().   
-00017fe0: 2020 2020 2069 6620 6163 6c20 6973 206e       if acl is n
-00017ff0: 6f74 204e 6f6e 6520 616e 6420 6c65 6e28  ot None and len(
-00018000: 6163 6c29 203e 2030 2061 6e64 2061 636c  acl) > 0 and acl
-00018010: 436f 6e74 726f 6c20 6973 206e 6f74 204e  Control is not N
-00018020: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00018030: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-00018040: 2827 426f 7468 2061 636c 2061 6e64 2061  ('Both acl and a
-00018050: 636c 436f 6e74 726f 6c20 6172 6520 7365  clControl are se
-00018060: 7427 290a 2020 2020 2020 2020 6966 206e  t').        if n
-00018070: 6f74 2061 636c 2061 6e64 206e 6f74 2061  ot acl and not a
-00018080: 636c 436f 6e74 726f 6c3a 0a20 2020 2020  clControl:.     
-00018090: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-000180a0: 6570 7469 6f6e 2827 426f 7468 2061 636c  eption('Both acl
-000180b0: 2061 6e64 2061 636c 436f 6e74 726f 6c20   and aclControl 
-000180c0: 6172 6520 6e6f 7420 7365 7427 290a 2020  are not set').  
-000180d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000180e0: 662e 5f6d 616b 655f 7075 745f 7265 7175  f._make_put_requ
-000180f0: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-00018100: 6f62 6a65 6374 4b65 792c 2065 7874 656e  objectKey, exten
-00018110: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-00018120: 6e73 696f 6e48 6561 6465 7273 2c0a 2020  nsionHeaders,.  
-00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018150: 2020 2020 2a2a 7365 6c66 2e63 6f6e 7665      **self.conve
-00018160: 7274 6f72 2e74 7261 6e73 5f73 6574 5f6f  rtor.trans_set_o
-00018170: 626a 6563 745f 6163 6c28 6163 6c3d 6163  bject_acl(acl=ac
-00018180: 6c2c 2076 6572 7369 6f6e 4964 3d76 6572  l, versionId=ver
-00018190: 7369 6f6e 4964 2c0a 2020 2020 2020 2020  sionId,.        
-000181a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e10: 2020 2020 2020 2072 6561 6461 626c 653d         readable=
+00017e20: 7265 6164 6162 6c65 2c20 6578 7465 6e73  readable, extens
+00017e30: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00017e40: 7369 6f6e 4865 6164 6572 7329 0a20 2020  sionHeaders).   
+00017e50: 2020 2020 2072 6574 7572 6e20 7265 740a       return ret.
+00017e60: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+00017e70: 2020 2020 6465 6620 636f 7079 4f62 6a65      def copyObje
+00017e80: 6374 2873 656c 662c 2073 6f75 7263 6542  ct(self, sourceB
+00017e90: 7563 6b65 744e 616d 652c 2073 6f75 7263  ucketName, sourc
+00017ea0: 654f 626a 6563 744b 6579 2c20 6465 7374  eObjectKey, dest
+00017eb0: 4275 636b 6574 4e61 6d65 2c20 6465 7374  BucketName, dest
+00017ec0: 4f62 6a65 6374 4b65 792c 206d 6574 6164  ObjectKey, metad
+00017ed0: 6174 613d 4e6f 6e65 2c20 6865 6164 6572  ata=None, header
+00017ee0: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+00017ef0: 2020 2020 2020 2020 2020 2076 6572 7369             versi
+00017f00: 6f6e 4964 3d4e 6f6e 652c 2065 7874 656e  onId=None, exten
+00017f10: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+00017f20: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00017f30: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
+00017f40: 2873 6f75 7263 6542 7563 6b65 744e 616d  (sourceBucketNam
+00017f50: 652c 2027 736f 7572 6365 4275 636b 6574  e, 'sourceBucket
+00017f60: 4e61 6d65 2069 7320 656d 7074 7927 290a  Name is empty').
+00017f70: 2020 2020 2020 2020 736f 7572 6365 4f62          sourceOb
+00017f80: 6a65 6374 4b65 7920 3d20 7574 696c 2e73  jectKey = util.s
+00017f90: 6166 655f 656e 636f 6465 2873 6f75 7263  afe_encode(sourc
+00017fa0: 654f 626a 6563 744b 6579 290a 2020 2020  eObjectKey).    
+00017fb0: 2020 2020 6966 2073 6f75 7263 654f 626a      if sourceObj
+00017fc0: 6563 744b 6579 2069 7320 4e6f 6e65 3a0a  ectKey is None:.
+00017fd0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+00017fe0: 6365 4f62 6a65 6374 4b65 7920 3d20 2727  ceObjectKey = ''
+00017ff0: 0a20 2020 2020 2020 2064 6573 744f 626a  .        destObj
+00018000: 6563 744b 6579 203d 2075 7469 6c2e 7361  ectKey = util.sa
+00018010: 6665 5f65 6e63 6f64 6528 6465 7374 4f62  fe_encode(destOb
+00018020: 6a65 6374 4b65 7929 0a20 2020 2020 2020  jectKey).       
+00018030: 2069 6620 6465 7374 4f62 6a65 6374 4b65   if destObjectKe
+00018040: 7920 6973 204e 6f6e 653a 0a20 2020 2020  y is None:.     
+00018050: 2020 2020 2020 2064 6573 744f 626a 6563         destObjec
+00018060: 744b 6579 203d 2027 270a 0a20 2020 2020  tKey = ''..     
+00018070: 2020 2069 6620 6865 6164 6572 7320 6973     if headers is
+00018080: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00018090: 2020 2068 6561 6465 7273 203d 2043 6f70     headers = Cop
+000180a0: 794f 626a 6563 7448 6561 6465 7228 290a  yObjectHeader().
+000180b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000180c0: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
+000180d0: 6571 7565 7374 2864 6573 7442 7563 6b65  equest(destBucke
+000180e0: 744e 616d 652c 2064 6573 744f 626a 6563  tName, destObjec
+000180f0: 744b 6579 2c0a 2020 2020 2020 2020 2020  tKey,.          
+00018100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018110: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+00018120: 6f64 4e61 6d65 3d27 636f 7079 4f62 6a65  odName='copyObje
+00018130: 6374 272c 2065 7874 656e 7369 6f6e 4865  ct', extensionHe
+00018140: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+00018150: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
+00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018170: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
+00018180: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e74  self.convertor.t
+00018190: 7261 6e73 5f63 6f70 795f 6f62 6a65 6374  rans_copy_object
+000181a0: 286d 6574 6164 6174 613d 6d65 7461 6461  (metadata=metada
+000181b0: 7461 2c20 6865 6164 6572 733d 6865 6164  ta, headers=head
+000181c0: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
 000181d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181e0: 2020 2020 6163 6c43 6f6e 7472 6f6c 3d61      aclControl=a
-000181f0: 636c 436f 6e74 726f 6c29 290a 0a20 2020  clControl))..   
-00018200: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-00018210: 6465 6620 6765 744f 626a 6563 7441 636c  def getObjectAcl
-00018220: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-00018230: 652c 206f 626a 6563 744b 6579 2c20 7665  e, objectKey, ve
-00018240: 7273 696f 6e49 643d 4e6f 6e65 2c20 6578  rsionId=None, ex
-00018250: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-00018260: 6f6e 6529 3a0a 2020 2020 2020 2020 7061  one):.        pa
-00018270: 7468 4172 6773 203d 207b 2761 636c 273a  thArgs = {'acl':
-00018280: 204e 6f6e 657d 0a20 2020 2020 2020 2069   None}.        i
-00018290: 6620 7665 7273 696f 6e49 643a 0a20 2020  f versionId:.   
-000182a0: 2020 2020 2020 2020 2070 6174 6841 7267           pathArg
-000182b0: 735b 636f 6e73 742e 5645 5253 494f 4e5f  s[const.VERSION_
-000182c0: 4944 5f50 4152 414d 5d20 3d20 7574 696c  ID_PARAM] = util
-000182d0: 2e74 6f5f 7374 7269 6e67 2876 6572 7369  .to_string(versi
-000182e0: 6f6e 4964 290a 0a20 2020 2020 2020 2072  onId)..        r
-000182f0: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-00018300: 5f67 6574 5f72 6571 7565 7374 2862 7563  _get_request(buc
-00018310: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
-00018320: 6579 2c20 7061 7468 4172 6773 3d70 6174  ey, pathArgs=pat
-00018330: 6841 7267 732c 206d 6574 686f 644e 616d  hArgs, methodNam
-00018340: 653d 2767 6574 4f62 6a65 6374 4163 6c27  e='getObjectAcl'
-00018350: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018370: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-00018380: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-00018390: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
-000183a0: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-000183b0: 6566 2064 656c 6574 654f 626a 6563 7428  ef deleteObject(
-000183c0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
-000183d0: 2c20 6f62 6a65 6374 4b65 792c 2076 6572  , objectKey, ver
-000183e0: 7369 6f6e 4964 3d4e 6f6e 652c 2065 7874  sionId=None, ext
-000183f0: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
-00018400: 6e65 293a 0a20 2020 2020 2020 2070 6174  ne):.        pat
-00018410: 685f 6172 6773 203d 207b 7d0a 2020 2020  h_args = {}.    
-00018420: 2020 2020 6966 2076 6572 7369 6f6e 4964      if versionId
-00018430: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00018440: 7468 5f61 7267 735b 636f 6e73 742e 5645  th_args[const.VE
-00018450: 5253 494f 4e5f 4944 5f50 4152 414d 5d20  RSION_ID_PARAM] 
-00018460: 3d20 7574 696c 2e74 6f5f 7374 7269 6e67  = util.to_string
-00018470: 2876 6572 7369 6f6e 4964 290a 2020 2020  (versionId).    
-00018480: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00018490: 5f6d 616b 655f 6465 6c65 7465 5f72 6571  _make_delete_req
-000184a0: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
-000184b0: 206f 626a 6563 744b 6579 2c20 7061 7468   objectKey, path
-000184c0: 4172 6773 3d70 6174 685f 6172 6773 2c20  Args=path_args, 
-000184d0: 6d65 7468 6f64 4e61 6d65 3d27 6465 6c65  methodName='dele
-000184e0: 7465 4f62 6a65 6374 272c 0a20 2020 2020  teObject',.     
-000184f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018200: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+00018210: 7273 696f 6e49 643d 7665 7273 696f 6e49  rsionId=versionI
+00018220: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00018230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018260: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+00018270: 6365 4275 636b 6574 4e61 6d65 3d73 6f75  ceBucketName=sou
+00018280: 7263 6542 7563 6b65 744e 616d 652c 0a20  rceBucketName,. 
+00018290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182d0: 2020 2020 2020 2020 736f 7572 6365 4f62          sourceOb
+000182e0: 6a65 6374 4b65 793d 736f 7572 6365 4f62  jectKey=sourceOb
+000182f0: 6a65 6374 4b65 7929 290a 0a20 2020 2040  jectKey))..    @
+00018300: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+00018310: 6620 7365 744f 626a 6563 7441 636c 2873  f setObjectAcl(s
+00018320: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00018330: 206f 626a 6563 744b 6579 2c20 6163 6c3d   objectKey, acl=
+00018340: 4e6f 6e65 2c20 7665 7273 696f 6e49 643d  None, versionId=
+00018350: 4e6f 6e65 2c20 6163 6c43 6f6e 7472 6f6c  None, aclControl
+00018360: 3d4e 6f6e 652c 2065 7874 656e 7369 6f6e  =None, extension
+00018370: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
+00018380: 2020 2020 2020 2069 6620 6163 6c20 6973         if acl is
+00018390: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000183a0: 2020 2061 636c 203d 2041 434c 2829 0a20     acl = ACL(). 
+000183b0: 2020 2020 2020 2069 6620 6163 6c20 6973         if acl is
+000183c0: 206e 6f74 204e 6f6e 6520 616e 6420 6c65   not None and le
+000183d0: 6e28 6163 6c29 203e 2030 2061 6e64 2061  n(acl) > 0 and a
+000183e0: 636c 436f 6e74 726f 6c20 6973 206e 6f74  clControl is not
+000183f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00018400: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00018410: 6f6e 2827 426f 7468 2061 636c 2061 6e64  on('Both acl and
+00018420: 2061 636c 436f 6e74 726f 6c20 6172 6520   aclControl are 
+00018430: 7365 7427 290a 2020 2020 2020 2020 6966  set').        if
+00018440: 206e 6f74 2061 636c 2061 6e64 206e 6f74   not acl and not
+00018450: 2061 636c 436f 6e74 726f 6c3a 0a20 2020   aclControl:.   
+00018460: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+00018470: 7863 6570 7469 6f6e 2827 426f 7468 2061  xception('Both a
+00018480: 636c 2061 6e64 2061 636c 436f 6e74 726f  cl and aclContro
+00018490: 6c20 6172 6520 6e6f 7420 7365 7427 290a  l are not set').
+000184a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000184b0: 656c 662e 5f6d 616b 655f 7075 745f 7265  elf._make_put_re
+000184c0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+000184d0: 2c20 6f62 6a65 6374 4b65 792c 2065 7874  , objectKey, ext
+000184e0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+000184f0: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
 00018500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018510: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
-00018520: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-00018530: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
-00018540: 6343 6163 6865 0a20 2020 2064 6566 2064  cCache.    def d
-00018550: 656c 6574 654f 626a 6563 7473 2873 656c  eleteObjects(sel
-00018560: 662c 2062 7563 6b65 744e 616d 652c 2064  f, bucketName, d
-00018570: 656c 6574 654f 626a 6563 7473 5265 7175  eleteObjectsRequ
-00018580: 6573 742c 2065 7874 656e 7369 6f6e 4865  est, extensionHe
-00018590: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-000185a0: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
-000185b0: 745f 6e6f 745f 6e75 6c6c 2864 656c 6574  t_not_null(delet
-000185c0: 654f 626a 6563 7473 5265 7175 6573 742c  eObjectsRequest,
-000185d0: 2027 6465 6c65 7465 4f62 6a65 6374 7352   'deleteObjectsR
-000185e0: 6571 7565 7374 2069 7320 656d 7074 7927  equest is empty'
-000185f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00018600: 2073 656c 662e 5f6d 616b 655f 706f 7374   self._make_post
-00018610: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-00018620: 616d 652c 206d 6574 686f 644e 616d 653d  ame, methodName=
-00018630: 2764 656c 6574 654f 626a 6563 7473 272c  'deleteObjects',
-00018640: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-00018650: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
-00018660: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-00018670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018680: 2020 2020 2020 2020 2020 202a 2a73 656c             **sel
-00018690: 662e 636f 6e76 6572 746f 722e 7472 616e  f.convertor.tran
-000186a0: 735f 6465 6c65 7465 5f6f 626a 6563 7473  s_delete_objects
-000186b0: 2864 656c 6574 654f 626a 6563 7473 5265  (deleteObjectsRe
-000186c0: 7175 6573 743d 6465 6c65 7465 4f62 6a65  quest=deleteObje
-000186d0: 6374 7352 6571 7565 7374 2929 0a0a 2020  ctsRequest))..  
-000186e0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-000186f0: 2064 6566 2072 6573 746f 7265 4f62 6a65   def restoreObje
-00018700: 6374 2873 656c 662c 2062 7563 6b65 744e  ct(self, bucketN
-00018710: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-00018720: 6461 7973 2c20 7469 6572 3d4e 6f6e 652c  days, tier=None,
-00018730: 2076 6572 7369 6f6e 4964 3d4e 6f6e 652c   versionId=None,
-00018740: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-00018750: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-00018760: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
-00018770: 745f 6e75 6c6c 2864 6179 732c 2027 6461  t_null(days, 'da
-00018780: 7973 2069 7320 656d 7074 7927 290a 2020  ys is empty').  
-00018790: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000187a0: 662e 5f6d 616b 655f 706f 7374 5f72 6571  f._make_post_req
-000187b0: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
-000187c0: 206f 626a 6563 744b 6579 2c20 6578 7465   objectKey, exte
-000187d0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
-000187e0: 656e 7369 6f6e 4865 6164 6572 732c 0a20  ensionHeaders,. 
-000187f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018810: 2020 2020 2020 2a2a 7365 6c66 2e63 6f6e        **self.con
-00018820: 7665 7274 6f72 2e74 7261 6e73 5f72 6573  vertor.trans_res
-00018830: 746f 7265 5f6f 626a 6563 7428 6461 7973  tore_object(days
-00018840: 3d64 6179 732c 2074 6965 723d 7469 6572  =days, tier=tier
-00018850: 2c20 7665 7273 696f 6e49 643d 7665 7273  , versionId=vers
-00018860: 696f 6e49 6429 290a 0a20 2020 2040 6675  ionId))..    @fu
-00018870: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-00018880: 696e 6974 6961 7465 4d75 6c74 6970 6172  initiateMultipar
-00018890: 7455 706c 6f61 6428 7365 6c66 2c20 6275  tUpload(self, bu
-000188a0: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-000188b0: 4b65 792c 2061 636c 3d4e 6f6e 652c 2073  Key, acl=None, s
-000188c0: 746f 7261 6765 436c 6173 733d 4e6f 6e65  torageClass=None
-000188d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000188e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188f0: 2020 6d65 7461 6461 7461 3d4e 6f6e 652c    metadata=None,
-00018900: 2077 6562 7369 7465 5265 6469 7265 6374   websiteRedirect
-00018910: 4c6f 6361 7469 6f6e 3d4e 6f6e 652c 2063  Location=None, c
-00018920: 6f6e 7465 6e74 5479 7065 3d4e 6f6e 652c  ontentType=None,
-00018930: 2073 7365 4865 6164 6572 3d4e 6f6e 652c   sseHeader=None,
-00018940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018960: 2065 7870 6972 6573 3d4e 6f6e 652c 2065   expires=None, e
-00018970: 7874 656e 7369 6f6e 4772 616e 7473 3d4e  xtensionGrants=N
-00018980: 6f6e 652c 2065 7874 656e 7369 6f6e 4865  one, extensionHe
-00018990: 6164 6572 733d 4e6f 6e65 2c20 656e 636f  aders=None, enco
-000189a0: 6469 6e67 5f74 7970 653d 4e6f 6e65 293a  ding_type=None):
-000189b0: 0a20 2020 2020 2020 206f 626a 6563 744b  .        objectK
-000189c0: 6579 203d 2075 7469 6c2e 7361 6665 5f65  ey = util.safe_e
-000189d0: 6e63 6f64 6528 6f62 6a65 6374 4b65 7929  ncode(objectKey)
-000189e0: 0a20 2020 2020 2020 2069 6620 6f62 6a65  .        if obje
-000189f0: 6374 4b65 7920 6973 204e 6f6e 653a 0a20  ctKey is None:. 
-00018a00: 2020 2020 2020 2020 2020 206f 626a 6563             objec
-00018a10: 744b 6579 203d 2027 270a 0a20 2020 2020  tKey = ''..     
-00018a20: 2020 2069 6620 636f 6e74 656e 7454 7970     if contentTyp
-00018a30: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00018a40: 2020 2020 2020 2063 6f6e 7465 6e74 5479         contentTy
-00018a50: 7065 203d 2063 6f6e 7374 2e4d 494d 455f  pe = const.MIME_
-00018a60: 5459 5045 532e 6765 7428 6f62 6a65 6374  TYPES.get(object
-00018a70: 4b65 795b 6f62 6a65 6374 4b65 792e 7266  Key[objectKey.rf
-00018a80: 696e 6428 272e 2729 202b 2031 3a5d 2e6c  ind('.') + 1:].l
-00018a90: 6f77 6572 2829 290a 0a20 2020 2020 2020  ower())..       
-00018aa0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-00018ab0: 6b65 5f70 6f73 745f 7265 7175 6573 7428  ke_post_request(
-00018ac0: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
-00018ad0: 6374 4b65 792c 206d 6574 686f 644e 616d  ctKey, methodNam
-00018ae0: 653d 2769 6e69 7469 6174 654d 756c 7469  e='initiateMulti
-00018af0: 7061 7274 5570 6c6f 6164 272c 0a20 2020  partUpload',.   
-00018b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b20: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
-00018b30: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-00018b40: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
-00018b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b60: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-00018b70: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e0a  self.convertor..
-00018b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ba0: 2020 2020 2020 2074 7261 6e73 5f69 6e69         trans_ini
-00018bb0: 7469 6174 655f 6d75 6c74 6970 6172 745f  tiate_multipart_
-00018bc0: 7570 6c6f 6164 2861 636c 3d61 636c 2c0a  upload(acl=acl,.
-00018bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c10: 2020 2020 2020 2073 746f 7261 6765 436c         storageCl
-00018c20: 6173 733d 7374 6f72 6167 6543 6c61 7373  ass=storageClass
-00018c30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c70: 2020 2020 2020 2020 206d 6574 6164 6174           metadat
-00018c80: 613d 6d65 7461 6461 7461 2c0a 2020 2020  a=metadata,.    
+00018510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018520: 2020 2020 2020 2a2a 7365 6c66 2e63 6f6e        **self.con
+00018530: 7665 7274 6f72 2e74 7261 6e73 5f73 6574  vertor.trans_set
+00018540: 5f6f 626a 6563 745f 6163 6c28 6163 6c3d  _object_acl(acl=
+00018550: 6163 6c2c 2076 6572 7369 6f6e 4964 3d76  acl, versionId=v
+00018560: 6572 7369 6f6e 4964 2c0a 2020 2020 2020  ersionId,.      
+00018570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185b0: 2020 2020 2020 6163 6c43 6f6e 7472 6f6c        aclControl
+000185c0: 3d61 636c 436f 6e74 726f 6c29 290a 0a20  =aclControl)).. 
+000185d0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+000185e0: 2020 6465 6620 6765 744f 626a 6563 7441    def getObjectA
+000185f0: 636c 2873 656c 662c 2062 7563 6b65 744e  cl(self, bucketN
+00018600: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+00018610: 7665 7273 696f 6e49 643d 4e6f 6e65 2c20  versionId=None, 
+00018620: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00018630: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00018640: 7061 7468 4172 6773 203d 207b 2761 636c  pathArgs = {'acl
+00018650: 273a 204e 6f6e 657d 0a20 2020 2020 2020  ': None}.       
+00018660: 2069 6620 7665 7273 696f 6e49 643a 0a20   if versionId:. 
+00018670: 2020 2020 2020 2020 2020 2070 6174 6841             pathA
+00018680: 7267 735b 636f 6e73 742e 5645 5253 494f  rgs[const.VERSIO
+00018690: 4e5f 4944 5f50 4152 414d 5d20 3d20 7574  N_ID_PARAM] = ut
+000186a0: 696c 2e74 6f5f 7374 7269 6e67 2876 6572  il.to_string(ver
+000186b0: 7369 6f6e 4964 290a 0a20 2020 2020 2020  sionId)..       
+000186c0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+000186d0: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
+000186e0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+000186f0: 744b 6579 2c20 7061 7468 4172 6773 3d70  tKey, pathArgs=p
+00018700: 6174 6841 7267 732c 206d 6574 686f 644e  athArgs, methodN
+00018710: 616d 653d 2767 6574 4f62 6a65 6374 4163  ame='getObjectAc
+00018720: 6c27 2c0a 2020 2020 2020 2020 2020 2020  l',.            
+00018730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018740: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
+00018750: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00018760: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
+00018770: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+00018780: 2064 6566 2064 656c 6574 654f 626a 6563   def deleteObjec
+00018790: 7428 7365 6c66 2c20 6275 636b 6574 4e61  t(self, bucketNa
+000187a0: 6d65 2c20 6f62 6a65 6374 4b65 792c 2076  me, objectKey, v
+000187b0: 6572 7369 6f6e 4964 3d4e 6f6e 652c 2065  ersionId=None, e
+000187c0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+000187d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2070  None):.        p
+000187e0: 6174 685f 6172 6773 203d 207b 7d0a 2020  ath_args = {}.  
+000187f0: 2020 2020 2020 6966 2076 6572 7369 6f6e        if version
+00018800: 4964 3a0a 2020 2020 2020 2020 2020 2020  Id:.            
+00018810: 7061 7468 5f61 7267 735b 636f 6e73 742e  path_args[const.
+00018820: 5645 5253 494f 4e5f 4944 5f50 4152 414d  VERSION_ID_PARAM
+00018830: 5d20 3d20 7574 696c 2e74 6f5f 7374 7269  ] = util.to_stri
+00018840: 6e67 2876 6572 7369 6f6e 4964 290a 2020  ng(versionId).  
+00018850: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00018860: 662e 5f6d 616b 655f 6465 6c65 7465 5f72  f._make_delete_r
+00018870: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+00018880: 652c 206f 626a 6563 744b 6579 2c20 7061  e, objectKey, pa
+00018890: 7468 4172 6773 3d70 6174 685f 6172 6773  thArgs=path_args
+000188a0: 2c20 6d65 7468 6f64 4e61 6d65 3d27 6465  , methodName='de
+000188b0: 6c65 7465 4f62 6a65 6374 272c 0a20 2020  leteObject',.   
+000188c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188e0: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
+000188f0: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+00018900: 4865 6164 6572 7329 0a0a 2020 2020 4066  Headers)..    @f
+00018910: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+00018920: 2064 656c 6574 654f 626a 6563 7473 2873   deleteObjects(s
+00018930: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00018940: 2064 656c 6574 654f 626a 6563 7473 5265   deleteObjectsRe
+00018950: 7175 6573 742c 2065 7874 656e 7369 6f6e  quest, extension
+00018960: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
+00018970: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
+00018980: 6572 745f 6e6f 745f 6e75 6c6c 2864 656c  ert_not_null(del
+00018990: 6574 654f 626a 6563 7473 5265 7175 6573  eteObjectsReques
+000189a0: 742c 2027 6465 6c65 7465 4f62 6a65 6374  t, 'deleteObject
+000189b0: 7352 6571 7565 7374 2069 7320 656d 7074  sRequest is empt
+000189c0: 7927 290a 2020 2020 2020 2020 7265 7475  y').        retu
+000189d0: 726e 2073 656c 662e 5f6d 616b 655f 706f  rn self._make_po
+000189e0: 7374 5f72 6571 7565 7374 2862 7563 6b65  st_request(bucke
+000189f0: 744e 616d 652c 206d 6574 686f 644e 616d  tName, methodNam
+00018a00: 653d 2764 656c 6574 654f 626a 6563 7473  e='deleteObjects
+00018a10: 272c 2065 7874 656e 7369 6f6e 4865 6164  ', extensionHead
+00018a20: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+00018a30: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
+00018a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a50: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+00018a60: 656c 662e 636f 6e76 6572 746f 722e 7472  elf.convertor.tr
+00018a70: 616e 735f 6465 6c65 7465 5f6f 626a 6563  ans_delete_objec
+00018a80: 7473 2864 656c 6574 654f 626a 6563 7473  ts(deleteObjects
+00018a90: 5265 7175 6573 743d 6465 6c65 7465 4f62  Request=deleteOb
+00018aa0: 6a65 6374 7352 6571 7565 7374 2929 0a0a  jectsRequest))..
+00018ab0: 2020 2020 6465 6620 6465 6c65 7465 506f      def deletePo
+00018ac0: 7369 7846 6c6f 6465 7228 7365 6c66 2c20  sixFloder(self, 
+00018ad0: 6275 636b 6574 4e61 6d65 2c20 666f 6c64  bucketName, fold
+00018ae0: 6572 4e61 6d65 293a 0a20 2020 2020 2020  erName):.       
+00018af0: 2073 656c 662e 6c6f 675f 636c 6965 6e74   self.log_client
+00018b00: 2e6c 6f67 2849 4e46 4f2c 2027 656e 7465  .log(INFO, 'ente
+00018b10: 7220 7265 7375 6d65 2064 656c 6574 6520  r resume delete 
+00018b20: 706f 7369 7820 666c 6f64 6572 2e2e 2e27  posix floder...'
+00018b30: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00018b40: 205f 7265 7375 6d65 5f64 656c 6574 6528   _resume_delete(
+00018b50: 6275 636b 6574 4e61 6d65 2c20 666f 6c64  bucketName, fold
+00018b60: 6572 4e61 6d65 2c20 7365 6c66 290a 0a20  erName, self).. 
+00018b70: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+00018b80: 2020 6465 6620 7265 7374 6f72 654f 626a    def restoreObj
+00018b90: 6563 7428 7365 6c66 2c20 6275 636b 6574  ect(self, bucket
+00018ba0: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
+00018bb0: 2064 6179 732c 2074 6965 723d 4e6f 6e65   days, tier=None
+00018bc0: 2c20 7665 7273 696f 6e49 643d 4e6f 6e65  , versionId=None
+00018bd0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+00018be0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+00018bf0: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
+00018c00: 6f74 5f6e 756c 6c28 6461 7973 2c20 2764  ot_null(days, 'd
+00018c10: 6179 7320 6973 2065 6d70 7479 2729 0a20  ays is empty'). 
+00018c20: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00018c30: 6c66 2e5f 6d61 6b65 5f70 6f73 745f 7265  lf._make_post_re
+00018c40: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+00018c50: 2c20 6f62 6a65 6374 4b65 792c 2065 7874  , objectKey, ext
+00018c60: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00018c70: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
+00018c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cd0: 2020 2077 6562 7369 7465 5265 6469 7265     websiteRedire
-00018ce0: 6374 4c6f 6361 7469 6f6e 3d77 6562 7369  ctLocation=websi
-00018cf0: 7465 5265 6469 7265 6374 4c6f 6361 7469  teRedirectLocati
-00018d00: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00018d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d40: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
-00018d50: 6e74 5479 7065 3d63 6f6e 7465 6e74 5479  ntType=contentTy
-00018d60: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+00018ca0: 2020 2020 2020 202a 2a73 656c 662e 636f         **self.co
+00018cb0: 6e76 6572 746f 722e 7472 616e 735f 7265  nvertor.trans_re
+00018cc0: 7374 6f72 655f 6f62 6a65 6374 2864 6179  store_object(day
+00018cd0: 733d 6461 7973 2c20 7469 6572 3d74 6965  s=days, tier=tie
+00018ce0: 722c 2076 6572 7369 6f6e 4964 3d76 6572  r, versionId=ver
+00018cf0: 7369 6f6e 4964 2929 0a0a 2020 2020 4066  sionId))..    @f
+00018d00: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+00018d10: 2069 6e69 7469 6174 654d 756c 7469 7061   initiateMultipa
+00018d20: 7274 5570 6c6f 6164 2873 656c 662c 2062  rtUpload(self, b
+00018d30: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+00018d40: 744b 6579 2c20 6163 6c3d 4e6f 6e65 2c20  tKey, acl=None, 
+00018d50: 7374 6f72 6167 6543 6c61 7373 3d4e 6f6e  storageClass=Non
+00018d60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
 00018d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018da0: 2020 2020 2020 2020 2020 2073 7365 4865             sseHe
-00018db0: 6164 6572 3d73 7365 4865 6164 6572 2c0a  ader=sseHeader,.
-00018dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d80: 2020 206d 6574 6164 6174 613d 4e6f 6e65     metadata=None
+00018d90: 2c20 7765 6273 6974 6552 6564 6972 6563  , websiteRedirec
+00018da0: 744c 6f63 6174 696f 6e3d 4e6f 6e65 2c20  tLocation=None, 
+00018db0: 636f 6e74 656e 7454 7970 653d 4e6f 6e65  contentType=None
+00018dc0: 2c20 7373 6548 6561 6465 723d 4e6f 6e65  , sseHeader=None
+00018dd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00018de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e00: 2020 2020 2020 2065 7870 6972 6573 3d65         expires=e
-00018e10: 7870 6972 6573 2c0a 2020 2020 2020 2020  xpires,.        
-00018e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00018e60: 7874 656e 7369 6f6e 4772 616e 7473 3d65  xtensionGrants=e
-00018e70: 7874 656e 7369 6f6e 4772 616e 7473 2c0a  xtensionGrants,.
-00018e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ec0: 2020 2020 2020 2065 6e63 6f64 696e 675f         encoding_
-00018ed0: 7479 7065 3d65 6e63 6f64 696e 675f 7479  type=encoding_ty
-00018ee0: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
-00018ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f00: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00018f10: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-00018f20: 2064 6566 2063 6f70 7950 6172 7428 7365   def copyPart(se
-00018f30: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-00018f40: 6f62 6a65 6374 4b65 792c 2070 6172 744e  objectKey, partN
-00018f50: 756d 6265 722c 2075 706c 6f61 6449 642c  umber, uploadId,
-00018f60: 2063 6f70 7953 6f75 7263 652c 2063 6f70   copySource, cop
-00018f70: 7953 6f75 7263 6552 616e 6765 3d4e 6f6e  ySourceRange=Non
-00018f80: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00018f90: 2020 2020 6465 7374 5373 6548 6561 6465      destSseHeade
-00018fa0: 723d 4e6f 6e65 2c20 736f 7572 6365 5373  r=None, sourceSs
-00018fb0: 6548 6561 6465 723d 4e6f 6e65 2c20 6578  eHeader=None, ex
-00018fc0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-00018fd0: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
-00018fe0: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
-00018ff0: 756c 6c28 7061 7274 4e75 6d62 6572 2c20  ull(partNumber, 
-00019000: 2770 6172 744e 756d 6265 7220 6973 2065  'partNumber is e
-00019010: 6d70 7479 2729 0a20 2020 2020 2020 2073  mpty').        s
-00019020: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
-00019030: 6e75 6c6c 2875 706c 6f61 6449 642c 2027  null(uploadId, '
-00019040: 7570 6c6f 6164 4964 2069 7320 656d 7074  uploadId is empt
-00019050: 7927 290a 2020 2020 2020 2020 7365 6c66  y').        self
-00019060: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
-00019070: 6c28 636f 7079 536f 7572 6365 2c20 2763  l(copySource, 'c
-00019080: 6f70 7953 6f75 7263 6520 6973 2065 6d70  opySource is emp
-00019090: 7479 2729 0a0a 2020 2020 2020 2020 7265  ty')..        re
-000190a0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-000190b0: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
-000190c0: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-000190d0: 792c 206d 6574 686f 644e 616d 653d 2763  y, methodName='c
-000190e0: 6f70 7950 6172 7427 2c20 6578 7465 6e73  opyPart', extens
-000190f0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00019100: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
-00019110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018df0: 2020 6578 7069 7265 733d 4e6f 6e65 2c20    expires=None, 
+00018e00: 6578 7465 6e73 696f 6e47 7261 6e74 733d  extensionGrants=
+00018e10: 4e6f 6e65 2c20 6578 7465 6e73 696f 6e48  None, extensionH
+00018e20: 6561 6465 7273 3d4e 6f6e 652c 2065 6e63  eaders=None, enc
+00018e30: 6f64 696e 675f 7479 7065 3d4e 6f6e 6529  oding_type=None)
+00018e40: 3a0a 2020 2020 2020 2020 6f62 6a65 6374  :.        object
+00018e50: 4b65 7920 3d20 7574 696c 2e73 6166 655f  Key = util.safe_
+00018e60: 656e 636f 6465 286f 626a 6563 744b 6579  encode(objectKey
+00018e70: 290a 2020 2020 2020 2020 6966 206f 626a  ).        if obj
+00018e80: 6563 744b 6579 2069 7320 4e6f 6e65 3a0a  ectKey is None:.
+00018e90: 2020 2020 2020 2020 2020 2020 6f62 6a65              obje
+00018ea0: 6374 4b65 7920 3d20 2727 0a0a 2020 2020  ctKey = ''..    
+00018eb0: 2020 2020 6966 2063 6f6e 7465 6e74 5479      if contentTy
+00018ec0: 7065 2069 7320 4e6f 6e65 3a0a 2020 2020  pe is None:.    
+00018ed0: 2020 2020 2020 2020 636f 6e74 656e 7454          contentT
+00018ee0: 7970 6520 3d20 636f 6e73 742e 4d49 4d45  ype = const.MIME
+00018ef0: 5f54 5950 4553 2e67 6574 286f 626a 6563  _TYPES.get(objec
+00018f00: 744b 6579 5b6f 626a 6563 744b 6579 2e72  tKey[objectKey.r
+00018f10: 6669 6e64 2827 2e27 2920 2b20 313a 5d2e  find('.') + 1:].
+00018f20: 6c6f 7765 7228 2929 0a0a 2020 2020 2020  lower())..      
+00018f30: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+00018f40: 616b 655f 706f 7374 5f72 6571 7565 7374  ake_post_request
+00018f50: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
+00018f60: 6563 744b 6579 2c20 6d65 7468 6f64 4e61  ectKey, methodNa
+00018f70: 6d65 3d27 696e 6974 6961 7465 4d75 6c74  me='initiateMult
+00018f80: 6970 6172 7455 706c 6f61 6427 2c0a 2020  ipartUpload',.  
+00018f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018fb0: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+00018fc0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+00018fd0: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
+00018fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ff0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00019000: 2a73 656c 662e 636f 6e76 6572 746f 722e  *self.convertor.
+00019010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019030: 2020 2020 2020 2020 7472 616e 735f 696e          trans_in
+00019040: 6974 6961 7465 5f6d 756c 7469 7061 7274  itiate_multipart
+00019050: 5f75 706c 6f61 6428 6163 6c3d 6163 6c2c  _upload(acl=acl,
+00019060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190a0: 2020 2020 2020 2020 7374 6f72 6167 6543          storageC
+000190b0: 6c61 7373 3d73 746f 7261 6765 436c 6173  lass=storageClas
+000190c0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019100: 2020 2020 2020 2020 2020 6d65 7461 6461            metada
+00019110: 7461 3d6d 6574 6164 6174 612c 0a20 2020  ta=metadata,.   
 00019120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019130: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
-00019140: 746f 722e 7472 616e 735f 636f 7079 5f70  tor.trans_copy_p
-00019150: 6172 7428 7061 7274 4e75 6d62 6572 3d70  art(partNumber=p
-00019160: 6172 744e 756d 6265 722c 2075 706c 6f61  artNumber, uploa
-00019170: 6449 643d 7570 6c6f 6164 4964 2c0a 2020  dId=uploadId,.  
-00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019160: 2020 2020 7765 6273 6974 6552 6564 6972      websiteRedir
+00019170: 6563 744c 6f63 6174 696f 6e3d 7765 6273  ectLocation=webs
+00019180: 6974 6552 6564 6972 6563 744c 6f63 6174  iteRedirectLocat
+00019190: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
 000191a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000191b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191c0: 2020 2020 2063 6f70 7953 6f75 7263 653d       copySource=
-000191d0: 636f 7079 536f 7572 6365 2c0a 2020 2020  copySource,.    
-000191e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191d0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000191e0: 656e 7454 7970 653d 636f 6e74 656e 7454  entType=contentT
+000191f0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
 00019200: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2020 2063 6f70 7953 6f75 7263 6552 616e     copySourceRan
-00019230: 6765 3d63 6f70 7953 6f75 7263 6552 616e  ge=copySourceRan
-00019240: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
-00019250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019230: 2020 2020 2020 2020 2020 2020 7373 6548              sseH
+00019240: 6561 6465 723d 7373 6548 6561 6465 722c  eader=sseHeader,
+00019250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00019260: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019280: 2020 2020 2020 2020 2020 2064 6573 7453             destS
-00019290: 7365 4865 6164 6572 3d64 6573 7453 7365  seHeader=destSse
-000192a0: 4865 6164 6572 2c0a 2020 2020 2020 2020  Header,.        
+00019280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019290: 2020 2020 2020 2020 6578 7069 7265 733d          expires=
+000192a0: 6578 7069 7265 732c 0a20 2020 2020 2020  expires,.       
 000192b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000192c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000192d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000192f0: 6f75 7263 6553 7365 4865 6164 6572 3d73  ourceSseHeader=s
-00019300: 6f75 7263 6553 7365 4865 6164 6572 2929  ourceSseHeader))
-00019310: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-00019320: 0a20 2020 2064 6566 2063 6f6d 706c 6574  .    def complet
-00019330: 654d 756c 7469 7061 7274 5570 6c6f 6164  eMultipartUpload
-00019340: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-00019350: 652c 206f 626a 6563 744b 6579 2c20 7570  e, objectKey, up
-00019360: 6c6f 6164 4964 2c20 636f 6d70 6c65 7465  loadId, complete
-00019370: 4d75 6c74 6970 6172 7455 706c 6f61 6452  MultipartUploadR
-00019380: 6571 7565 7374 2c0a 2020 2020 2020 2020  equest,.        
-00019390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193a0: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-000193b0: 6e48 6561 6465 7273 3d4e 6f6e 652c 2065  nHeaders=None, e
-000193c0: 6e63 6f64 696e 675f 7479 7065 3d4e 6f6e  ncoding_type=Non
-000193d0: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
-000193e0: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
-000193f0: 6c28 7570 6c6f 6164 4964 2c20 2775 706c  l(uploadId, 'upl
-00019400: 6f61 6449 6420 6973 2065 6d70 7479 2729  oadId is empty')
-00019410: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
-00019420: 7373 6572 745f 6e6f 745f 6e75 6c6c 2863  ssert_not_null(c
-00019430: 6f6d 706c 6574 654d 756c 7469 7061 7274  ompleteMultipart
-00019440: 5570 6c6f 6164 5265 7175 6573 742c 2027  UploadRequest, '
-00019450: 636f 6d70 6c65 7465 4d75 6c74 6970 6172  completeMultipar
-00019460: 7455 706c 6f61 6452 6571 7565 7374 2069  tUploadRequest i
-00019470: 7320 656d 7074 7927 290a 2020 2020 2020  s empty').      
-00019480: 2020 7061 7468 4172 6773 203d 207b 2775    pathArgs = {'u
-00019490: 706c 6f61 6449 6427 3a20 7570 6c6f 6164  ploadId': upload
-000194a0: 4964 7d0a 2020 2020 2020 2020 6966 2065  Id}.        if e
-000194b0: 6e63 6f64 696e 675f 7479 7065 2069 7320  ncoding_type is 
-000194c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000194d0: 2020 2020 2020 7061 7468 4172 6773 5b22        pathArgs["
-000194e0: 656e 636f 6469 6e67 2d74 7970 6522 5d20  encoding-type"] 
-000194f0: 3d20 656e 636f 6469 6e67 5f74 7970 650a  = encoding_type.
-00019500: 2020 2020 2020 2020 7265 7420 3d20 7365          ret = se
-00019510: 6c66 2e5f 6d61 6b65 5f70 6f73 745f 7265  lf._make_post_re
-00019520: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
-00019530: 2c20 6f62 6a65 6374 4b65 792c 0a20 2020  , objectKey,.   
-00019540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019560: 2020 2070 6174 6841 7267 733d 7061 7468     pathArgs=path
-00019570: 4172 6773 2c0a 2020 2020 2020 2020 2020  Args,.          
-00019580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019590: 2020 2020 2020 2020 2020 2020 656e 7469              enti
-000195a0: 7479 3d73 656c 662e 636f 6e76 6572 746f  ty=self.converto
-000195b0: 722e 7472 616e 735f 636f 6d70 6c65 7465  r.trans_complete
-000195c0: 5f6d 756c 7469 7061 7274 5f75 706c 6f61  _multipart_uploa
-000195d0: 645f 7265 7175 6573 7428 0a20 2020 2020  d_request(.     
-000195e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019600: 2020 2020 2063 6f6d 706c 6574 654d 756c       completeMul
-00019610: 7469 7061 7274 5570 6c6f 6164 5265 7175  tipartUploadRequ
-00019620: 6573 7429 2c20 6d65 7468 6f64 4e61 6d65  est), methodName
-00019630: 3d27 636f 6d70 6c65 7465 4d75 6c74 6970  ='completeMultip
-00019640: 6172 7455 706c 6f61 6427 2c0a 2020 2020  artUpload',.    
-00019650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019670: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
-00019680: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-00019690: 6572 7329 0a20 2020 2020 2020 2073 656c  ers).        sel
-000196a0: 662e 5f67 656e 6572 6174 655f 6f62 6a65  f._generate_obje
-000196b0: 6374 5f75 726c 2872 6574 2c20 6275 636b  ct_url(ret, buck
-000196c0: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-000196d0: 7929 0a20 2020 2020 2020 2072 6574 7572  y).        retur
-000196e0: 6e20 7265 740a 0a20 2020 2040 6675 6e63  n ret..    @func
-000196f0: 4361 6368 650a 2020 2020 6465 6620 6162  Cache.    def ab
-00019700: 6f72 744d 756c 7469 7061 7274 5570 6c6f  ortMultipartUplo
-00019710: 6164 2873 656c 662c 2062 7563 6b65 744e  ad(self, bucketN
-00019720: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-00019730: 7570 6c6f 6164 4964 2c20 6578 7465 6e73  uploadId, extens
-00019740: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-00019750: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-00019760: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
-00019770: 7570 6c6f 6164 4964 2c20 2775 706c 6f61  uploadId, 'uploa
-00019780: 6449 6420 6973 2065 6d70 7479 2729 0a20  dId is empty'). 
-00019790: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000197a0: 6c66 2e5f 6d61 6b65 5f64 656c 6574 655f  lf._make_delete_
-000197b0: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
-000197c0: 6d65 2c20 6f62 6a65 6374 4b65 792c 2070  me, objectKey, p
-000197d0: 6174 6841 7267 733d 7b27 7570 6c6f 6164  athArgs={'upload
-000197e0: 4964 273a 2075 706c 6f61 6449 647d 2c0a  Id': uploadId},.
-000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019810: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
-00019820: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-00019830: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
-00019840: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-00019850: 6465 6620 6c69 7374 5061 7274 7328 7365  def listParts(se
-00019860: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-00019870: 6f62 6a65 6374 4b65 792c 2075 706c 6f61  objectKey, uploa
-00019880: 6449 642c 206d 6178 5061 7274 733d 4e6f  dId, maxParts=No
-00019890: 6e65 2c20 7061 7274 4e75 6d62 6572 4d61  ne, partNumberMa
-000198a0: 726b 6572 3d4e 6f6e 652c 2065 7874 656e  rker=None, exten
-000198b0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-000198c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000198d0: 2020 2020 656e 636f 6469 6e67 5f74 7970      encoding_typ
-000198e0: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
-000198f0: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
-00019900: 745f 6e75 6c6c 2875 706c 6f61 6449 642c  t_null(uploadId,
-00019910: 2027 7570 6c6f 6164 4964 2069 7320 656d   'uploadId is em
-00019920: 7074 7927 290a 2020 2020 2020 2020 7061  pty').        pa
-00019930: 7468 4172 6773 203d 207b 2775 706c 6f61  thArgs = {'uploa
-00019940: 6449 6427 3a20 7570 6c6f 6164 4964 7d0a  dId': uploadId}.
-00019950: 2020 2020 2020 2020 6966 206d 6178 5061          if maxPa
-00019960: 7274 7320 6973 206e 6f74 204e 6f6e 653a  rts is not None:
-00019970: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00019980: 6841 7267 735b 276d 6178 2d70 6172 7473  hArgs['max-parts
-00019990: 275d 203d 206d 6178 5061 7274 730a 2020  '] = maxParts.  
-000199a0: 2020 2020 2020 6966 2070 6172 744e 756d        if partNum
-000199b0: 6265 724d 6172 6b65 7220 6973 206e 6f74  berMarker is not
-000199c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000199d0: 2020 2070 6174 6841 7267 735b 2770 6172     pathArgs['par
-000199e0: 742d 6e75 6d62 6572 2d6d 6172 6b65 7227  t-number-marker'
-000199f0: 5d20 3d20 7061 7274 4e75 6d62 6572 4d61  ] = partNumberMa
-00019a00: 726b 6572 0a20 2020 2020 2020 2069 6620  rker.        if 
-00019a10: 656e 636f 6469 6e67 5f74 7970 6520 6973  encoding_type is
-00019a20: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00019a30: 2020 2020 2020 2070 6174 6841 7267 735b         pathArgs[
-00019a40: 2765 6e63 6f64 696e 672d 7479 7065 275d  'encoding-type']
-00019a50: 203d 2065 6e63 6f64 696e 675f 7479 7065   = encoding_type
-00019a60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019a70: 7365 6c66 2e5f 6d61 6b65 5f67 6574 5f72  self._make_get_r
-00019a80: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-00019a90: 652c 206f 626a 6563 744b 6579 2c20 7061  e, objectKey, pa
-00019aa0: 7468 4172 6773 3d70 6174 6841 7267 732c  thArgs=pathArgs,
-00019ab0: 206d 6574 686f 644e 616d 653d 276c 6973   methodName='lis
-00019ac0: 7450 6172 7473 272c 0a20 2020 2020 2020  tParts',.       
-00019ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ae0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00019af0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00019b00: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00019b10: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-00019b20: 650a 2020 2020 6465 6620 6765 7442 7563  e.    def getBuc
-00019b30: 6b65 7453 746f 7261 6765 506f 6c69 6379  ketStoragePolicy
-00019b40: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-00019b50: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-00019b60: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-00019b70: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00019b80: 6d61 6b65 5f67 6574 5f72 6571 7565 7374  make_get_request
-00019b90: 2862 7563 6b65 744e 616d 652c 206d 6574  (bucketName, met
-00019ba0: 686f 644e 616d 653d 2767 6574 4275 636b  hodName='getBuck
-00019bb0: 6574 5374 6f72 6167 6550 6f6c 6963 7927  etStoragePolicy'
-00019bc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019be0: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-00019bf0: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-00019c00: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
-00019c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c30: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
-00019c40: 722e 7472 616e 735f 6765 745f 6275 636b  r.trans_get_buck
-00019c50: 6574 5f73 746f 7261 6765 5f70 6f6c 6963  et_storage_polic
-00019c60: 7928 2929 0a0a 2020 2020 4066 756e 6343  y())..    @funcC
-00019c70: 6163 6865 0a20 2020 2064 6566 2073 6574  ache.    def set
-00019c80: 4275 636b 6574 5374 6f72 6167 6550 6f6c  BucketStoragePol
-00019c90: 6963 7928 7365 6c66 2c20 6275 636b 6574  icy(self, bucket
-00019ca0: 4e61 6d65 2c20 7374 6f72 6167 6543 6c61  Name, storageCla
-00019cb0: 7373 2c20 6578 7465 6e73 696f 6e48 6561  ss, extensionHea
-00019cc0: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
-00019cd0: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
-00019ce0: 5f6e 6f74 5f6e 756c 6c28 7374 6f72 6167  _not_null(storag
-00019cf0: 6543 6c61 7373 2c20 2773 746f 7261 6765  eClass, 'storage
-00019d00: 436c 6173 7320 6973 2065 6d70 7479 2729  Class is empty')
-00019d10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019d20: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
-00019d30: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-00019d40: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-00019d50: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-00019d60: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
-00019d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d80: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
-00019d90: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
-00019da0: 6e73 5f73 6574 5f62 7563 6b65 745f 7374  ns_set_bucket_st
-00019db0: 6f72 6167 655f 706f 6c69 6379 2873 746f  orage_policy(sto
-00019dc0: 7261 6765 436c 6173 733d 7374 6f72 6167  rageClass=storag
-00019dd0: 6543 6c61 7373 2929 0a0a 2020 2020 4066  eClass))..    @f
-00019de0: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-00019df0: 2073 6574 4275 636b 6574 456e 6372 7970   setBucketEncryp
-00019e00: 7469 6f6e 2873 656c 662c 2062 7563 6b65  tion(self, bucke
-00019e10: 744e 616d 652c 2065 6e63 7279 7074 696f  tName, encryptio
-00019e20: 6e2c 206b 6579 3d4e 6f6e 652c 2065 7874  n, key=None, ext
-00019e30: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
-00019e40: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
-00019e50: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
-00019e60: 6c6c 2865 6e63 7279 7074 696f 6e2c 2027  ll(encryption, '
-00019e70: 656e 6372 7970 7469 6f6e 2069 7320 656d  encryption is em
-00019e80: 7074 7927 290a 2020 2020 2020 2020 7265  pty').        re
-00019e90: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-00019ea0: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
-00019eb0: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
-00019ec0: 3d7b 2765 6e63 7279 7074 696f 6e27 3a20  ={'encryption': 
-00019ed0: 4e6f 6e65 7d2c 0a20 2020 2020 2020 2020  None},.         
-00019ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ef0: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-00019f00: 6974 793d 7365 6c66 2e63 6f6e 7665 7274  ity=self.convert
-00019f10: 6f72 2e74 7261 6e73 5f65 6e63 7279 7074  or.trans_encrypt
-00019f20: 696f 6e28 656e 6372 7970 7469 6f6e 3d65  ion(encryption=e
-00019f30: 6e63 7279 7074 696f 6e2c 206b 6579 3d6b  ncryption, key=k
-00019f40: 6579 292c 0a20 2020 2020 2020 2020 2020  ey),.           
-00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f60: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-00019f70: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-00019f80: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
-00019f90: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-00019fa0: 2020 6465 6620 6765 7442 7563 6b65 7445    def getBucketE
-00019fb0: 6e63 7279 7074 696f 6e28 7365 6c66 2c20  ncryption(self, 
-00019fc0: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
-00019fd0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-00019fe0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
-00019ff0: 726e 2073 656c 662e 5f6d 616b 655f 6765  rn self._make_ge
-0001a000: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
-0001a010: 4e61 6d65 2c20 6d65 7468 6f64 4e61 6d65  Name, methodName
-0001a020: 3d27 6765 7442 7563 6b65 7445 6e63 7279  ='getBucketEncry
-0001a030: 7074 696f 6e27 2c20 7061 7468 4172 6773  ption', pathArgs
-0001a040: 3d7b 2765 6e63 7279 7074 696f 6e27 3a20  ={'encryption': 
-0001a050: 4e6f 6e65 7d2c 0a20 2020 2020 2020 2020  None},.         
+000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192f0: 6578 7465 6e73 696f 6e47 7261 6e74 733d  extensionGrants=
+00019300: 6578 7465 6e73 696f 6e47 7261 6e74 732c  extensionGrants,
+00019310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019350: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
+00019360: 5f74 7970 653d 656e 636f 6469 6e67 5f74  _type=encoding_t
+00019370: 7970 6529 0a20 2020 2020 2020 2020 2020  ype).           
+00019380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019390: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000193a0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+000193b0: 2020 6465 6620 636f 7079 5061 7274 2873    def copyPart(s
+000193c0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+000193d0: 206f 626a 6563 744b 6579 2c20 7061 7274   objectKey, part
+000193e0: 4e75 6d62 6572 2c20 7570 6c6f 6164 4964  Number, uploadId
+000193f0: 2c20 636f 7079 536f 7572 6365 2c20 636f  , copySource, co
+00019400: 7079 536f 7572 6365 5261 6e67 653d 4e6f  pySourceRange=No
+00019410: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00019420: 2020 2020 2064 6573 7453 7365 4865 6164       destSseHead
+00019430: 6572 3d4e 6f6e 652c 2073 6f75 7263 6553  er=None, sourceS
+00019440: 7365 4865 6164 6572 3d4e 6f6e 652c 2065  seHeader=None, e
+00019450: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+00019460: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
+00019470: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
+00019480: 6e75 6c6c 2870 6172 744e 756d 6265 722c  null(partNumber,
+00019490: 2027 7061 7274 4e75 6d62 6572 2069 7320   'partNumber is 
+000194a0: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
+000194b0: 7365 6c66 2e5f 6173 7365 7274 5f6e 6f74  self._assert_not
+000194c0: 5f6e 756c 6c28 7570 6c6f 6164 4964 2c20  _null(uploadId, 
+000194d0: 2775 706c 6f61 6449 6420 6973 2065 6d70  'uploadId is emp
+000194e0: 7479 2729 0a20 2020 2020 2020 2073 656c  ty').        sel
+000194f0: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
+00019500: 6c6c 2863 6f70 7953 6f75 7263 652c 2027  ll(copySource, '
+00019510: 636f 7079 536f 7572 6365 2069 7320 656d  copySource is em
+00019520: 7074 7927 290a 0a20 2020 2020 2020 2072  pty')..        r
+00019530: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+00019540: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
+00019550: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+00019560: 6579 2c20 6d65 7468 6f64 4e61 6d65 3d27  ey, methodName='
+00019570: 636f 7079 5061 7274 272c 2065 7874 656e  copyPart', exten
+00019580: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+00019590: 6e73 696f 6e48 6561 6465 7273 2c0a 2020  nsionHeaders,.  
+000195a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195c0: 2020 2020 2a2a 7365 6c66 2e63 6f6e 7665      **self.conve
+000195d0: 7274 6f72 2e74 7261 6e73 5f63 6f70 795f  rtor.trans_copy_
+000195e0: 7061 7274 2870 6172 744e 756d 6265 723d  part(partNumber=
+000195f0: 7061 7274 4e75 6d62 6572 2c20 7570 6c6f  partNumber, uplo
+00019600: 6164 4964 3d75 706c 6f61 6449 642c 0a20  adId=uploadId,. 
+00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019650: 2020 2020 2020 636f 7079 536f 7572 6365        copySource
+00019660: 3d63 6f70 7953 6f75 7263 652c 0a20 2020  =copySource,.   
+00019670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196b0: 2020 2020 636f 7079 536f 7572 6365 5261      copySourceRa
+000196c0: 6e67 653d 636f 7079 536f 7572 6365 5261  nge=copySourceRa
+000196d0: 6e67 652c 0a20 2020 2020 2020 2020 2020  nge,.           
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019710: 2020 2020 2020 2020 2020 2020 6465 7374              dest
+00019720: 5373 6548 6561 6465 723d 6465 7374 5373  SseHeader=destSs
+00019730: 6548 6561 6465 722c 0a20 2020 2020 2020  eHeader,.       
+00019740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019780: 736f 7572 6365 5373 6548 6561 6465 723d  sourceSseHeader=
+00019790: 736f 7572 6365 5373 6548 6561 6465 7229  sourceSseHeader)
+000197a0: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
+000197b0: 650a 2020 2020 6465 6620 636f 6d70 6c65  e.    def comple
+000197c0: 7465 4d75 6c74 6970 6172 7455 706c 6f61  teMultipartUploa
+000197d0: 6428 7365 6c66 2c20 6275 636b 6574 4e61  d(self, bucketNa
+000197e0: 6d65 2c20 6f62 6a65 6374 4b65 792c 2075  me, objectKey, u
+000197f0: 706c 6f61 6449 642c 2063 6f6d 706c 6574  ploadId, complet
+00019800: 654d 756c 7469 7061 7274 5570 6c6f 6164  eMultipartUpload
+00019810: 5265 7175 6573 742c 0a20 2020 2020 2020  Request,.       
+00019820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019830: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+00019840: 6f6e 4865 6164 6572 733d 4e6f 6e65 2c20  onHeaders=None, 
+00019850: 656e 636f 6469 6e67 5f74 7970 653d 4e6f  encoding_type=No
+00019860: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
+00019870: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
+00019880: 6c6c 2875 706c 6f61 6449 642c 2027 7570  ll(uploadId, 'up
+00019890: 6c6f 6164 4964 2069 7320 656d 7074 7927  loadId is empty'
+000198a0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+000198b0: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
+000198c0: 636f 6d70 6c65 7465 4d75 6c74 6970 6172  completeMultipar
+000198d0: 7455 706c 6f61 6452 6571 7565 7374 2c20  tUploadRequest, 
+000198e0: 2763 6f6d 706c 6574 654d 756c 7469 7061  'completeMultipa
+000198f0: 7274 5570 6c6f 6164 5265 7175 6573 7420  rtUploadRequest 
+00019900: 6973 2065 6d70 7479 2729 0a20 2020 2020  is empty').     
+00019910: 2020 2070 6174 6841 7267 7320 3d20 7b27     pathArgs = {'
+00019920: 7570 6c6f 6164 4964 273a 2075 706c 6f61  uploadId': uploa
+00019930: 6449 647d 0a20 2020 2020 2020 2069 6620  dId}.        if 
+00019940: 656e 636f 6469 6e67 5f74 7970 6520 6973  encoding_type is
+00019950: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00019960: 2020 2020 2020 2070 6174 6841 7267 735b         pathArgs[
+00019970: 2265 6e63 6f64 696e 672d 7479 7065 225d  "encoding-type"]
+00019980: 203d 2065 6e63 6f64 696e 675f 7479 7065   = encoding_type
+00019990: 0a20 2020 2020 2020 2072 6574 203d 2073  .        ret = s
+000199a0: 656c 662e 5f6d 616b 655f 706f 7374 5f72  elf._make_post_r
+000199b0: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+000199c0: 652c 206f 626a 6563 744b 6579 2c0a 2020  e, objectKey,.  
+000199d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199f0: 2020 2020 7061 7468 4172 6773 3d70 6174      pathArgs=pat
+00019a00: 6841 7267 732c 0a20 2020 2020 2020 2020  hArgs,.         
+00019a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a20: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+00019a30: 6974 793d 7365 6c66 2e63 6f6e 7665 7274  ity=self.convert
+00019a40: 6f72 2e74 7261 6e73 5f63 6f6d 706c 6574  or.trans_complet
+00019a50: 655f 6d75 6c74 6970 6172 745f 7570 6c6f  e_multipart_uplo
+00019a60: 6164 5f72 6571 7565 7374 280a 2020 2020  ad_request(.    
+00019a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a90: 2020 2020 2020 636f 6d70 6c65 7465 4d75        completeMu
+00019aa0: 6c74 6970 6172 7455 706c 6f61 6452 6571  ltipartUploadReq
+00019ab0: 7565 7374 292c 206d 6574 686f 644e 616d  uest), methodNam
+00019ac0: 653d 2763 6f6d 706c 6574 654d 756c 7469  e='completeMulti
+00019ad0: 7061 7274 5570 6c6f 6164 272c 0a20 2020  partUpload',.   
+00019ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b00: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+00019b10: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+00019b20: 6465 7273 290a 2020 2020 2020 2020 7365  ders).        se
+00019b30: 6c66 2e5f 6765 6e65 7261 7465 5f6f 626a  lf._generate_obj
+00019b40: 6563 745f 7572 6c28 7265 742c 2062 7563  ect_url(ret, buc
+00019b50: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+00019b60: 6579 290a 2020 2020 2020 2020 7265 7475  ey).        retu
+00019b70: 726e 2072 6574 0a0a 2020 2020 4066 756e  rn ret..    @fun
+00019b80: 6343 6163 6865 0a20 2020 2064 6566 2061  cCache.    def a
+00019b90: 626f 7274 4d75 6c74 6970 6172 7455 706c  bortMultipartUpl
+00019ba0: 6f61 6428 7365 6c66 2c20 6275 636b 6574  oad(self, bucket
+00019bb0: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
+00019bc0: 2075 706c 6f61 6449 642c 2065 7874 656e   uploadId, exten
+00019bd0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+00019be0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00019bf0: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
+00019c00: 2875 706c 6f61 6449 642c 2027 7570 6c6f  (uploadId, 'uplo
+00019c10: 6164 4964 2069 7320 656d 7074 7927 290a  adId is empty').
+00019c20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00019c30: 656c 662e 5f6d 616b 655f 6465 6c65 7465  elf._make_delete
+00019c40: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
+00019c50: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+00019c60: 7061 7468 4172 6773 3d7b 2775 706c 6f61  pathArgs={'uploa
+00019c70: 6449 6427 3a20 7570 6c6f 6164 4964 7d2c  dId': uploadId},
+00019c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ca0: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
+00019cb0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00019cc0: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
+00019cd0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+00019ce0: 2064 6566 206c 6973 7450 6172 7473 2873   def listParts(s
+00019cf0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00019d00: 206f 626a 6563 744b 6579 2c20 7570 6c6f   objectKey, uplo
+00019d10: 6164 4964 2c20 6d61 7850 6172 7473 3d4e  adId, maxParts=N
+00019d20: 6f6e 652c 2070 6172 744e 756d 6265 724d  one, partNumberM
+00019d30: 6172 6b65 723d 4e6f 6e65 2c20 6578 7465  arker=None, exte
+00019d40: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+00019d50: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00019d60: 2020 2020 2065 6e63 6f64 696e 675f 7479       encoding_ty
+00019d70: 7065 3d4e 6f6e 6529 3a0a 2020 2020 2020  pe=None):.      
+00019d80: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
+00019d90: 6f74 5f6e 756c 6c28 7570 6c6f 6164 4964  ot_null(uploadId
+00019da0: 2c20 2775 706c 6f61 6449 6420 6973 2065  , 'uploadId is e
+00019db0: 6d70 7479 2729 0a20 2020 2020 2020 2070  mpty').        p
+00019dc0: 6174 6841 7267 7320 3d20 7b27 7570 6c6f  athArgs = {'uplo
+00019dd0: 6164 4964 273a 2075 706c 6f61 6449 647d  adId': uploadId}
+00019de0: 0a20 2020 2020 2020 2069 6620 6d61 7850  .        if maxP
+00019df0: 6172 7473 2069 7320 6e6f 7420 4e6f 6e65  arts is not None
+00019e00: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00019e10: 7468 4172 6773 5b27 6d61 782d 7061 7274  thArgs['max-part
+00019e20: 7327 5d20 3d20 6d61 7850 6172 7473 0a20  s'] = maxParts. 
+00019e30: 2020 2020 2020 2069 6620 7061 7274 4e75         if partNu
+00019e40: 6d62 6572 4d61 726b 6572 2069 7320 6e6f  mberMarker is no
+00019e50: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00019e60: 2020 2020 7061 7468 4172 6773 5b27 7061      pathArgs['pa
+00019e70: 7274 2d6e 756d 6265 722d 6d61 726b 6572  rt-number-marker
+00019e80: 275d 203d 2070 6172 744e 756d 6265 724d  '] = partNumberM
+00019e90: 6172 6b65 720a 2020 2020 2020 2020 6966  arker.        if
+00019ea0: 2065 6e63 6f64 696e 675f 7479 7065 2069   encoding_type i
+00019eb0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00019ec0: 2020 2020 2020 2020 7061 7468 4172 6773          pathArgs
+00019ed0: 5b27 656e 636f 6469 6e67 2d74 7970 6527  ['encoding-type'
+00019ee0: 5d20 3d20 656e 636f 6469 6e67 5f74 7970  ] = encoding_typ
+00019ef0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00019f00: 2073 656c 662e 5f6d 616b 655f 6765 745f   self._make_get_
+00019f10: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+00019f20: 6d65 2c20 6f62 6a65 6374 4b65 792c 2070  me, objectKey, p
+00019f30: 6174 6841 7267 733d 7061 7468 4172 6773  athArgs=pathArgs
+00019f40: 2c20 6d65 7468 6f64 4e61 6d65 3d27 6c69  , methodName='li
+00019f50: 7374 5061 7274 7327 2c0a 2020 2020 2020  stParts',.      
+00019f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f80: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00019f90: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+00019fa0: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
+00019fb0: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
+00019fc0: 636b 6574 5374 6f72 6167 6550 6f6c 6963  cketStoragePolic
+00019fd0: 7928 7365 6c66 2c20 6275 636b 6574 4e61  y(self, bucketNa
+00019fe0: 6d65 2c20 6578 7465 6e73 696f 6e48 6561  me, extensionHea
+00019ff0: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+0001a000: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001a010: 5f6d 616b 655f 6765 745f 7265 7175 6573  _make_get_reques
+0001a020: 7428 6275 636b 6574 4e61 6d65 2c20 6d65  t(bucketName, me
+0001a030: 7468 6f64 4e61 6d65 3d27 6765 7442 7563  thodName='getBuc
+0001a040: 6b65 7453 746f 7261 6765 506f 6c69 6379  ketStoragePolicy
+0001a050: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
 0001a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a070: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-0001a080: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-0001a090: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
-0001a0a0: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-0001a0b0: 2020 2020 6465 6620 6465 6c65 7465 4275      def deleteBu
-0001a0c0: 636b 6574 456e 6372 7970 7469 6f6e 2873  cketEncryption(s
-0001a0d0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-0001a0e0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001a0f0: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-0001a100: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-0001a110: 6b65 5f64 656c 6574 655f 7265 7175 6573  ke_delete_reques
-0001a120: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
-0001a130: 7468 4172 6773 3d7b 2765 6e63 7279 7074  thArgs={'encrypt
-0001a140: 696f 6e27 3a20 4e6f 6e65 7d2c 2065 7874  ion': None}, ext
-0001a150: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-0001a160: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
-0001a170: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-0001a180: 2020 2020 6465 6620 7365 7442 7563 6b65      def setBucke
-0001a190: 7452 6570 6c69 6361 7469 6f6e 2873 656c  tReplication(sel
-0001a1a0: 662c 2062 7563 6b65 744e 616d 652c 2072  f, bucketName, r
-0001a1b0: 6570 6c69 6361 7469 6f6e 2c20 6578 7465  eplication, exte
-0001a1c0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-0001a1d0: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
-0001a1e0: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
-0001a1f0: 6c28 7265 706c 6963 6174 696f 6e2c 2027  l(replication, '
-0001a200: 7265 706c 6963 6174 696f 6e20 6973 2065  replication is e
-0001a210: 6d70 7479 2729 0a20 2020 2020 2020 2072  mpty').        r
-0001a220: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-0001a230: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
-0001a240: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-0001a250: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-0001a260: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
-0001a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a290: 2020 2a2a 7365 6c66 2e63 6f6e 7665 7274    **self.convert
-0001a2a0: 6f72 2e74 7261 6e73 5f73 6574 5f62 7563  or.trans_set_buc
-0001a2b0: 6b65 745f 7265 706c 6963 6174 696f 6e28  ket_replication(
-0001a2c0: 7265 706c 6963 6174 696f 6e3d 7265 706c  replication=repl
-0001a2d0: 6963 6174 696f 6e29 290a 0a20 2020 2040  ication))..    @
-0001a2e0: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-0001a2f0: 6620 6765 7442 7563 6b65 7452 6570 6c69  f getBucketRepli
-0001a300: 6361 7469 6f6e 2873 656c 662c 2062 7563  cation(self, buc
-0001a310: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-0001a320: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-0001a330: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001a340: 7365 6c66 2e5f 6d61 6b65 5f67 6574 5f72  self._make_get_r
-0001a350: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0001a360: 652c 2070 6174 6841 7267 733d 7b27 7265  e, pathArgs={'re
-0001a370: 706c 6963 6174 696f 6e27 3a20 4e6f 6e65  plication': None
-0001a380: 7d2c 206d 6574 686f 644e 616d 653d 2767  }, methodName='g
-0001a390: 6574 4275 636b 6574 5265 706c 6963 6174  etBucketReplicat
-0001a3a0: 696f 6e27 2c0a 2020 2020 2020 2020 2020  ion',.          
-0001a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3c0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-0001a3d0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
-0001a3e0: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
-0001a3f0: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
-0001a400: 2020 2064 6566 2064 656c 6574 6542 7563     def deleteBuc
-0001a410: 6b65 7452 6570 6c69 6361 7469 6f6e 2873  ketReplication(s
-0001a420: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-0001a430: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001a440: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-0001a450: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-0001a460: 6b65 5f64 656c 6574 655f 7265 7175 6573  ke_delete_reques
-0001a470: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
-0001a480: 7468 4172 6773 3d7b 2772 6570 6c69 6361  thArgs={'replica
-0001a490: 7469 6f6e 273a 204e 6f6e 657d 2c20 6578  tion': None}, ex
-0001a4a0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-0001a4b0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-0001a4c0: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-0001a4d0: 0a20 2020 2064 6566 2073 6574 4275 636b  .    def setBuck
-0001a4e0: 6574 5265 7175 6573 7450 6179 6d65 6e74  etRequestPayment
-0001a4f0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-0001a500: 652c 2070 6179 6572 2c20 6578 7465 6e73  e, payer, extens
-0001a510: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-0001a520: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-0001a530: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
-0001a540: 7061 7965 722c 2027 7061 7965 7220 6973  payer, 'payer is
-0001a550: 2065 6d70 7479 2729 0a20 2020 2020 2020   empty').       
-0001a560: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-0001a570: 6b65 5f70 7574 5f72 6571 7565 7374 2862  ke_put_request(b
-0001a580: 7563 6b65 744e 616d 652c 2070 6174 6841  ucketName, pathA
-0001a590: 7267 733d 7b27 7265 7175 6573 7450 6179  rgs={'requestPay
-0001a5a0: 6d65 6e74 273a 204e 6f6e 657d 2c0a 2020  ment': None},.  
-0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5d0: 2020 2020 656e 7469 7479 3d73 656c 662e      entity=self.
-0001a5e0: 636f 6e76 6572 746f 722e 7472 616e 735f  convertor.trans_
-0001a5f0: 6275 636b 6574 5f72 6571 7565 7374 5f70  bucket_request_p
-0001a600: 6179 6d65 6e74 2870 6179 6572 3d70 6179  ayment(payer=pay
-0001a610: 6572 292c 0a20 2020 2020 2020 2020 2020  er),.           
-0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a630: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0001a640: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-0001a650: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
-0001a660: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-0001a670: 2020 6465 6620 6765 7442 7563 6b65 7452    def getBucketR
-0001a680: 6571 7565 7374 5061 796d 656e 7428 7365  equestPayment(se
-0001a690: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-0001a6a0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001a6b0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001a6c0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-0001a6d0: 655f 6765 745f 7265 7175 6573 7428 6275  e_get_request(bu
-0001a6e0: 636b 6574 4e61 6d65 2c20 7061 7468 4172  cketName, pathAr
-0001a6f0: 6773 3d7b 2772 6571 7565 7374 5061 796d  gs={'requestPaym
-0001a700: 656e 7427 3a20 4e6f 6e65 7d2c 0a20 2020  ent': None},.   
+0001a070: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0001a080: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+0001a090: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
+0001a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0c0: 2020 2a2a 7365 6c66 2e63 6f6e 7665 7274    **self.convert
+0001a0d0: 6f72 2e74 7261 6e73 5f67 6574 5f62 7563  or.trans_get_buc
+0001a0e0: 6b65 745f 7374 6f72 6167 655f 706f 6c69  ket_storage_poli
+0001a0f0: 6379 2829 290a 0a20 2020 2040 6675 6e63  cy())..    @func
+0001a100: 4361 6368 650a 2020 2020 6465 6620 7365  Cache.    def se
+0001a110: 7442 7563 6b65 7453 746f 7261 6765 506f  tBucketStoragePo
+0001a120: 6c69 6379 2873 656c 662c 2062 7563 6b65  licy(self, bucke
+0001a130: 744e 616d 652c 2073 746f 7261 6765 436c  tName, storageCl
+0001a140: 6173 732c 2065 7874 656e 7369 6f6e 4865  ass, extensionHe
+0001a150: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
+0001a160: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
+0001a170: 745f 6e6f 745f 6e75 6c6c 2873 746f 7261  t_not_null(stora
+0001a180: 6765 436c 6173 732c 2027 7374 6f72 6167  geClass, 'storag
+0001a190: 6543 6c61 7373 2069 7320 656d 7074 7927  eClass is empty'
+0001a1a0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001a1b0: 2073 656c 662e 5f6d 616b 655f 7075 745f   self._make_put_
+0001a1c0: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+0001a1d0: 6d65 2c20 6578 7465 6e73 696f 6e48 6561  me, extensionHea
+0001a1e0: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+0001a1f0: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
+0001a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a210: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+0001a220: 656c 662e 636f 6e76 6572 746f 722e 7472  elf.convertor.tr
+0001a230: 616e 735f 7365 745f 6275 636b 6574 5f73  ans_set_bucket_s
+0001a240: 746f 7261 6765 5f70 6f6c 6963 7928 7374  torage_policy(st
+0001a250: 6f72 6167 6543 6c61 7373 3d73 746f 7261  orageClass=stora
+0001a260: 6765 436c 6173 7329 290a 0a20 2020 2040  geClass))..    @
+0001a270: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+0001a280: 6620 7365 7442 7563 6b65 7445 6e63 7279  f setBucketEncry
+0001a290: 7074 696f 6e28 7365 6c66 2c20 6275 636b  ption(self, buck
+0001a2a0: 6574 4e61 6d65 2c20 656e 6372 7970 7469  etName, encrypti
+0001a2b0: 6f6e 2c20 6b65 793d 4e6f 6e65 2c20 6578  on, key=None, ex
+0001a2c0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+0001a2d0: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
+0001a2e0: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
+0001a2f0: 756c 6c28 656e 6372 7970 7469 6f6e 2c20  ull(encryption, 
+0001a300: 2765 6e63 7279 7074 696f 6e20 6973 2065  'encryption is e
+0001a310: 6d70 7479 2729 0a20 2020 2020 2020 2072  mpty').        r
+0001a320: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+0001a330: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
+0001a340: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
+0001a350: 733d 7b27 656e 6372 7970 7469 6f6e 273a  s={'encryption':
+0001a360: 204e 6f6e 657d 2c0a 2020 2020 2020 2020   None},.        
+0001a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a380: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0001a390: 7469 7479 3d73 656c 662e 636f 6e76 6572  tity=self.conver
+0001a3a0: 746f 722e 7472 616e 735f 656e 6372 7970  tor.trans_encryp
+0001a3b0: 7469 6f6e 2865 6e63 7279 7074 696f 6e3d  tion(encryption=
+0001a3c0: 656e 6372 7970 7469 6f6e 2c20 6b65 793d  encryption, key=
+0001a3d0: 6b65 7929 2c0a 2020 2020 2020 2020 2020  key),.          
+0001a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3f0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+0001a400: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+0001a410: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+0001a420: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+0001a430: 2020 2064 6566 2067 6574 4275 636b 6574     def getBucket
+0001a440: 456e 6372 7970 7469 6f6e 2873 656c 662c  Encryption(self,
+0001a450: 2062 7563 6b65 744e 616d 652c 2065 7874   bucketName, ext
+0001a460: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+0001a470: 6e65 293a 0a20 2020 2020 2020 2072 6574  ne):.        ret
+0001a480: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f67  urn self._make_g
+0001a490: 6574 5f72 6571 7565 7374 2862 7563 6b65  et_request(bucke
+0001a4a0: 744e 616d 652c 206d 6574 686f 644e 616d  tName, methodNam
+0001a4b0: 653d 2767 6574 4275 636b 6574 456e 6372  e='getBucketEncr
+0001a4c0: 7970 7469 6f6e 272c 2070 6174 6841 7267  yption', pathArg
+0001a4d0: 733d 7b27 656e 6372 7970 7469 6f6e 273a  s={'encryption':
+0001a4e0: 204e 6f6e 657d 2c0a 2020 2020 2020 2020   None},.        
+0001a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a500: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0001a510: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+0001a520: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+0001a530: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
+0001a540: 0a20 2020 2064 6566 2064 656c 6574 6542  .    def deleteB
+0001a550: 7563 6b65 7445 6e63 7279 7074 696f 6e28  ucketEncryption(
+0001a560: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0001a570: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0001a580: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+0001a590: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0001a5a0: 616b 655f 6465 6c65 7465 5f72 6571 7565  ake_delete_reque
+0001a5b0: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
+0001a5c0: 6174 6841 7267 733d 7b27 656e 6372 7970  athArgs={'encryp
+0001a5d0: 7469 6f6e 273a 204e 6f6e 657d 2c20 6578  tion': None}, ex
+0001a5e0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+0001a5f0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+0001a600: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
+0001a610: 0a20 2020 2064 6566 2073 6574 4275 636b  .    def setBuck
+0001a620: 6574 5265 706c 6963 6174 696f 6e28 7365  etReplication(se
+0001a630: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
+0001a640: 7265 706c 6963 6174 696f 6e2c 2065 7874  replication, ext
+0001a650: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+0001a660: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
+0001a670: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
+0001a680: 6c6c 2872 6570 6c69 6361 7469 6f6e 2c20  ll(replication, 
+0001a690: 2772 6570 6c69 6361 7469 6f6e 2069 7320  'replication is 
+0001a6a0: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
+0001a6b0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
+0001a6c0: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
+0001a6d0: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
+0001a6e0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+0001a6f0: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
+0001a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a730: 2020 206d 6574 686f 644e 616d 653d 2767     methodName='g
-0001a740: 6574 4275 636b 6574 5265 7175 6573 7450  etBucketRequestP
-0001a750: 6179 6d65 6e74 272c 2065 7874 656e 7369  ayment', extensi
-0001a760: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-0001a770: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
-0001a780: 2023 2062 6567 696e 2076 6972 7475 616c   # begin virtual
-0001a790: 2062 7563 6b65 7420 7265 6c61 7465 640a   bucket related.
-0001a7a0: 2020 2020 2320 6265 6769 6e20 7669 7274      # begin virt
-0001a7b0: 7561 6c20 6275 636b 6574 2072 656c 6174  ual bucket relat
-0001a7c0: 6564 0a20 2020 2023 2062 6567 696e 2076  ed.    # begin v
-0001a7d0: 6972 7475 616c 2062 7563 6b65 7420 7265  irtual bucket re
-0001a7e0: 6c61 7465 640a 0a20 2020 2040 6675 6e63  lated..    @func
-0001a7f0: 4361 6368 650a 2020 2020 6465 6620 6c69  Cache.    def li
-0001a800: 7374 4176 6169 6c61 626c 655a 6f6e 6549  stAvailableZoneI
-0001a810: 6e66 6f28 7365 6c66 2c20 7265 6769 6f6e  nfo(self, region
-0001a820: 4964 2c20 746f 6b65 6e2c 2065 7874 656e  Id, token, exten
-0001a830: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-0001a840: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-0001a850: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
-0001a860: 2872 6567 696f 6e49 642c 2027 7265 6769  (regionId, 'regi
-0001a870: 6f6e 4964 2073 686f 756c 6420 6e6f 7420  onId should not 
-0001a880: 6265 2065 6d70 7479 2729 0a20 2020 2020  be empty').     
-0001a890: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
-0001a8a0: 6e6f 745f 6e75 6c6c 2874 6f6b 656e 2c20  not_null(token, 
-0001a8b0: 2774 6f6b 656e 2073 686f 756c 6420 6e6f  'token should no
-0001a8c0: 7420 6265 2065 6d70 7479 2729 0a0a 2020  t be empty')..  
-0001a8d0: 2020 2020 2020 7061 7468 4172 6773 203d        pathArgs =
-0001a8e0: 207b 2772 6567 696f 6e49 6427 3a20 7265   {'regionId': re
-0001a8f0: 6769 6f6e 4964 7d0a 2020 2020 2020 2020  gionId}.        
-0001a900: 6865 6164 6572 203d 207b 0a20 2020 2020  header = {.     
-0001a910: 2020 2020 2020 2063 6f6e 7374 2e58 5f41         const.X_A
-0001a920: 5554 485f 544f 4b45 4e5f 4845 4144 4552  UTH_TOKEN_HEADER
-0001a930: 3a20 746f 6b65 6e2c 0a20 2020 2020 2020  : token,.       
-0001a940: 2020 2020 2063 6f6e 7374 2e43 4f4e 5445       const.CONTE
-0001a950: 4e54 5f54 5950 455f 4845 4144 4552 3a20  NT_TYPE_HEADER: 
-0001a960: 636f 6e73 742e 4d49 4d45 5f54 5950 4553  const.MIME_TYPES
-0001a970: 2e67 6574 2827 6a73 6f6e 2729 0a20 2020  .get('json').   
-0001a980: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-0001a990: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-0001a9a0: 655f 6765 745f 7265 7175 6573 7428 0a20  e_get_request(. 
-0001a9b0: 2020 2020 2020 2020 2020 206f 626a 6563             objec
-0001a9c0: 744b 6579 3d27 7631 2f73 6572 7669 6365  tKey='v1/service
-0001a9d0: 732f 636c 7573 7465 7273 272c 0a20 2020  s/clusters',.   
-0001a9e0: 2020 2020 2020 2020 2070 6174 6841 7267           pathArg
-0001a9f0: 733d 7061 7468 4172 6773 2c0a 2020 2020  s=pathArgs,.    
-0001aa00: 2020 2020 2020 2020 6865 6164 6572 733d          headers=
-0001aa10: 6865 6164 6572 2c0a 2020 2020 2020 2020  header,.        
-0001aa20: 2020 2020 6d65 7468 6f64 4e61 6d65 3d73      methodName=s
-0001aa30: 656c 662e 6a73 6f6e 5f72 6573 706f 6e73  elf.json_respons
-0001aa40: 655f 6d65 7468 6f64 5f6e 616d 652c 0a20  e_method_name,. 
-0001aa50: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0001aa60: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-0001aa70: 6e73 696f 6e48 6561 6465 7273 0a20 2020  nsionHeaders.   
-0001aa80: 2020 2020 2029 0a0a 2020 2020 4066 756e       )..    @fun
-0001aa90: 6343 6163 6865 0a20 2020 2064 6566 2063  cCache.    def c
-0001aaa0: 7265 6174 6542 7563 6b65 7441 6c69 6173  reateBucketAlias
-0001aab0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-0001aac0: 652c 2061 6c69 6173 496e 666f 3d4e 6f6e  e, aliasInfo=Non
-0001aad0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-0001aae0: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-0001aaf0: 2020 2069 6620 616c 6961 7349 6e66 6f20     if aliasInfo 
-0001ab00: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001ab10: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-0001ab20: 7469 6f6e 2827 616c 6961 7349 6e66 6f20  tion('aliasInfo 
-0001ab30: 6973 204e 6f6e 6527 290a 2020 2020 2020  is None').      
-0001ab40: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
-0001ab50: 6f74 5f6e 756c 6c28 616c 6961 7349 6e66  ot_null(aliasInf
-0001ab60: 6f2e 6765 7428 2762 7563 6b65 7431 2729  o.get('bucket1')
-0001ab70: 2c20 2762 7563 6b65 7431 2073 686f 756c  , 'bucket1 shoul
-0001ab80: 6420 6e6f 7420 6265 2065 6d70 7479 2729  d not be empty')
-0001ab90: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
-0001aba0: 7373 6572 745f 6e6f 745f 6e75 6c6c 2861  ssert_not_null(a
-0001abb0: 6c69 6173 496e 666f 2e67 6574 2827 6275  liasInfo.get('bu
-0001abc0: 636b 6574 3227 292c 2027 6275 636b 6574  cket2'), 'bucket
-0001abd0: 3220 7368 6f75 6c64 206e 6f74 2062 6520  2 should not be 
-0001abe0: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
-0001abf0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-0001ac00: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
-0001ac10: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
-0001ac20: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0001ac30: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
-0001ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac60: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
-0001ac70: 746f 722e 7472 616e 735f 7365 745f 6275  tor.trans_set_bu
-0001ac80: 636b 6574 5f61 6c69 6173 2861 6c69 6173  cket_alias(alias
-0001ac90: 496e 666f 3d61 6c69 6173 496e 666f 2929  Info=aliasInfo))
-0001aca0: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-0001acb0: 0a20 2020 2064 6566 2062 696e 6442 7563  .    def bindBuc
-0001acc0: 6b65 7441 6c69 6173 2873 656c 662c 2062  ketAlias(self, b
-0001acd0: 7563 6b65 744e 616d 652c 2061 6c69 6173  ucketName, alias
-0001ace0: 496e 666f 3d4e 6f6e 652c 2065 7874 656e  Info=None, exten
-0001acf0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-0001ad00: 293a 0a20 2020 2020 2020 2069 6620 616c  ):.        if al
-0001ad10: 6961 7349 6e66 6f20 6973 204e 6f6e 653a  iasInfo is None:
-0001ad20: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001ad30: 7365 2045 7863 6570 7469 6f6e 2827 616c  se Exception('al
-0001ad40: 6961 7349 6e66 6f20 6973 204e 6f6e 6527  iasInfo is None'
-0001ad50: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0001ad60: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
-0001ad70: 616c 6961 7349 6e66 6f2e 6765 7428 2761  aliasInfo.get('a
-0001ad80: 6c69 6173 2729 2c20 2762 7563 6b65 7420  lias'), 'bucket 
-0001ad90: 616c 6961 7320 7368 6f75 6c64 206e 6f74  alias should not
-0001ada0: 2062 6520 656d 7074 7927 290a 2020 2020   be empty').    
-0001adb0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001adc0: 5f6d 616b 655f 7075 745f 7265 7175 6573  _make_put_reques
-0001add0: 7428 6275 636b 6574 4e61 6d65 2c20 6578  t(bucketName, ex
-0001ade0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-0001adf0: 7874 656e 7369 6f6e 4865 6164 6572 732c  xtensionHeaders,
-0001ae00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae20: 2020 2020 2020 202a 2a73 656c 662e 636f         **self.co
-0001ae30: 6e76 6572 746f 722e 7472 616e 735f 6269  nvertor.trans_bi
-0001ae40: 6e64 5f62 7563 6b65 745f 616c 6961 7328  nd_bucket_alias(
-0001ae50: 616c 6961 7349 6e66 6f3d 616c 6961 7349  aliasInfo=aliasI
-0001ae60: 6e66 6f29 290a 0a20 2020 2040 6675 6e63  nfo))..    @func
-0001ae70: 4361 6368 650a 2020 2020 6465 6620 6465  Cache.    def de
-0001ae80: 6c65 7465 4275 636b 6574 416c 6961 7328  leteBucketAlias(
-0001ae90: 7365 6c66 2c20 6275 636b 6574 416c 6961  self, bucketAlia
-0001aea0: 732c 2065 7874 656e 7369 6f6e 4865 6164  s, extensionHead
-0001aeb0: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-0001aec0: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
-0001aed0: 6e6f 745f 6e75 6c6c 2862 7563 6b65 7441  not_null(bucketA
-0001aee0: 6c69 6173 2c20 2762 7563 6b65 7420 616c  lias, 'bucket al
-0001aef0: 6961 7320 7368 6f75 6c64 206e 6f74 2062  ias should not b
-0001af00: 6520 656d 7074 7927 290a 2020 2020 2020  e empty').      
-0001af10: 2020 7061 7468 4172 6773 203d 207b 636f    pathArgs = {co
-0001af20: 6e73 742e 4f42 5342 5543 4b45 5441 4c49  nst.OBSBUCKETALI
-0001af30: 4153 5f50 4152 414d 3a20 4e6f 6e65 7d0a  AS_PARAM: None}.
-0001af40: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001af50: 656c 662e 5f6d 616b 655f 6465 6c65 7465  elf._make_delete
-0001af60: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-0001af70: 616d 653d 6275 636b 6574 416c 6961 732c  ame=bucketAlias,
-0001af80: 2070 6174 6841 7267 733d 7061 7468 4172   pathArgs=pathAr
-0001af90: 6773 2c20 6578 7465 6e73 696f 6e48 6561  gs, extensionHea
-0001afa0: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-0001afb0: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
-0001afc0: 6343 6163 6865 0a20 2020 2064 6566 2075  cCache.    def u
-0001afd0: 6e62 696e 6442 7563 6b65 7441 6c69 6173  nbindBucketAlias
-0001afe0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-0001aff0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-0001b000: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-0001b010: 2020 2070 6174 6841 7267 7320 3d20 7b63     pathArgs = {c
-0001b020: 6f6e 7374 2e4f 4253 414c 4941 535f 5041  onst.OBSALIAS_PA
-0001b030: 5241 4d3a 204e 6f6e 657d 0a20 2020 2020  RAM: None}.     
-0001b040: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001b050: 6d61 6b65 5f64 656c 6574 655f 7265 7175  make_delete_requ
-0001b060: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-0001b070: 7061 7468 4172 6773 3d70 6174 6841 7267  pathArgs=pathArg
-0001b080: 732c 2065 7874 656e 7369 6f6e 4865 6164  s, extensionHead
-0001b090: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-0001b0a0: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
-0001b0b0: 4361 6368 650a 2020 2020 6465 6620 6765  Cache.    def ge
-0001b0c0: 7442 7563 6b65 7441 6c69 6173 2873 656c  tBucketAlias(sel
-0001b0d0: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-0001b0e0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0001b0f0: 4e6f 6e65 293a 0a20 2020 2020 2020 2070  None):.        p
-0001b100: 6174 6841 7267 7320 3d20 7b63 6f6e 7374  athArgs = {const
-0001b110: 2e4f 4253 414c 4941 535f 5041 5241 4d3a  .OBSALIAS_PARAM:
-0001b120: 204e 6f6e 657d 0a20 2020 2020 2020 2072   None}.        r
-0001b130: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-0001b140: 5f67 6574 5f72 6571 7565 7374 2862 7563  _get_request(buc
-0001b150: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
-0001b160: 733d 7061 7468 4172 6773 2c20 6d65 7468  s=pathArgs, meth
-0001b170: 6f64 4e61 6d65 3d27 6765 7442 7563 6b65  odName='getBucke
-0001b180: 7441 6c69 6173 272c 0a20 2020 2020 2020  tAlias',.       
-0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001b1b0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0001b1c0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001b1d0: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-0001b1e0: 650a 2020 2020 6465 6620 6c69 7374 4275  e.    def listBu
-0001b1f0: 636b 6574 416c 6961 7328 7365 6c66 2c20  cketAlias(self, 
-0001b200: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001b210: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001b220: 7061 7468 4172 6773 203d 207b 636f 6e73  pathArgs = {cons
-0001b230: 742e 4f42 5342 5543 4b45 5441 4c49 4153  t.OBSBUCKETALIAS
-0001b240: 5f50 4152 414d 3a20 4e6f 6e65 7d0a 2020  _PARAM: None}.  
-0001b250: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001b260: 662e 5f6d 616b 655f 6765 745f 7265 7175  f._make_get_requ
-0001b270: 6573 7428 7061 7468 4172 6773 3d70 6174  est(pathArgs=pat
-0001b280: 6841 7267 732c 206d 6574 686f 644e 616d  hArgs, methodNam
-0001b290: 653d 274c 6973 7442 7563 6b65 7441 6c69  e='ListBucketAli
-0001b2a0: 6173 272c 0a20 2020 2020 2020 2020 2020  as',.           
-0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2c0: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0001b2d0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-0001b2e0: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
-0001b2f0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-0001b300: 2020 6465 6620 6372 6561 7465 5669 7274    def createVirt
-0001b310: 7561 6c42 7563 6b65 7428 7365 6c66 2c20  ualBucket(self, 
-0001b320: 7265 6769 6f6e 4964 2c20 746f 6b65 6e2c  regionId, token,
-0001b330: 2062 7563 6b65 744e 616d 6531 2c20 6275   bucketName1, bu
-0001b340: 636b 6574 4e61 6d65 322c 2062 7563 6b65  cketName2, bucke
-0001b350: 7441 6c69 6173 2c20 6167 656e 6379 4e61  tAlias, agencyNa
-0001b360: 6d65 2c20 6865 6164 6572 3d4e 6f6e 6529  me, header=None)
-0001b370: 3a0a 2020 2020 2020 2020 2320 7374 6570  :.        # step
-0001b380: 2031 3a20 e588 97e4 b8be e68c 87e5 ae9a   1: ............
-0001b390: 7265 6769 6f6e e4b8 8be7 9a84 e99b 86e7  region..........
-0001b3a0: bea4 e4bf a1e6 81af 0a20 2020 2020 2020  .........       
-0001b3b0: 2061 7a52 6573 7020 3d20 7365 6c66 2e6c   azResp = self.l
-0001b3c0: 6973 7441 7661 696c 6162 6c65 5a6f 6e65  istAvailableZone
-0001b3d0: 496e 666f 2872 6567 696f 6e49 642c 2074  Info(regionId, t
-0001b3e0: 6f6b 656e 290a 2020 2020 2020 2020 6966  oken).        if
-0001b3f0: 2061 7a52 6573 702e 7374 6174 7573 2021   azResp.status !
-0001b400: 3d20 3230 303a 0a20 2020 2020 2020 2020  = 200:.         
-0001b410: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0001b420: 6f6e 2827 6c69 7374 2041 5a20 696e 666f  on('list AZ info
-0001b430: 7320 6661 696c 6564 2c20 7265 7370 3a20  s failed, resp: 
-0001b440: 2573 2720 2520 617a 5265 7370 290a 0a20  %s' % azResp).. 
-0001b450: 2020 2020 2020 2066 6972 7374 415a 4367         firstAZCg
-0001b460: 4964 2c20 7365 636f 6e64 415a 4367 4964  Id, secondAZCgId
-0001b470: 203d 2073 656c 662e 5f67 6574 5f63 6c75   = self._get_clu
-0001b480: 7374 6572 5f67 726f 7570 5f69 6428 617a  ster_group_id(az
-0001b490: 5265 7370 290a 0a20 2020 2020 2020 2023  Resp)..        #
-0001b4a0: 2073 7465 7020 323a 20e6 8c87 e5ae 9ae9   step 2: .......
-0001b4b0: 9b86 e7be a469 64e5 889b e6a1 b60a 2020  .....id.......  
-0001b4c0: 2020 2020 2020 7365 6c66 2e5f 6372 6561        self._crea
-0001b4d0: 7465 5f62 7563 6b65 745f 7769 7468 5f63  te_bucket_with_c
-0001b4e0: 6c75 7374 6572 5f69 6428 6669 7273 7441  luster_id(firstA
-0001b4f0: 5a43 6749 642c 2073 6563 6f6e 6441 5a43  ZCgId, secondAZC
-0001b500: 6749 642c 2062 7563 6b65 744e 616d 6531  gId, bucketName1
-0001b510: 2c20 6275 636b 6574 4e61 6d65 322c 2062  , bucketName2, b
-0001b520: 7563 6b65 7441 6c69 6173 2c20 6865 6164  ucketAlias, head
-0001b530: 6572 290a 0a20 2020 2020 2020 2023 2073  er)..        # s
-0001b540: 7465 7020 333a 20e5 889b e5bb bae4 b880  tep 3: .........
-0001b550: e6ac a1e5 88ab e590 8d0a 2020 2020 2020  ..........      
-0001b560: 2020 616c 6961 7349 6e66 6f20 3d20 4275    aliasInfo = Bu
-0001b570: 636b 6574 416c 6961 734d 6f64 656c 2829  cketAliasModel()
-0001b580: 0a20 2020 2020 2020 2061 6c69 6173 496e  .        aliasIn
-0001b590: 666f 2e62 7563 6b65 7431 203d 2062 7563  fo.bucket1 = buc
-0001b5a0: 6b65 744e 616d 6531 0a20 2020 2020 2020  ketName1.       
-0001b5b0: 2061 6c69 6173 496e 666f 2e62 7563 6b65   aliasInfo.bucke
-0001b5c0: 7432 203d 2062 7563 6b65 744e 616d 6532  t2 = bucketName2
-0001b5d0: 0a20 2020 2020 2020 2063 6261 5265 7370  .        cbaResp
-0001b5e0: 203d 2073 656c 662e 6372 6561 7465 4275   = self.createBu
-0001b5f0: 636b 6574 416c 6961 7328 6275 636b 6574  cketAlias(bucket
-0001b600: 416c 6961 732c 2061 6c69 6173 496e 666f  Alias, aliasInfo
-0001b610: 290a 2020 2020 2020 2020 6966 2063 6261  ).        if cba
-0001b620: 5265 7370 2e73 7461 7475 7320 213d 2032  Resp.status != 2
-0001b630: 3030 3a0a 2020 2020 2020 2020 2020 2020  00:.            
-0001b640: 7365 6c66 2e5f 636c 6561 725f 7669 7274  self._clear_virt
-0001b650: 7561 6c5f 6275 636b 6574 2863 6f6e 7374  ual_bucket(const
-0001b660: 2e56 4952 5455 414c 5f42 5543 4b45 545f  .VIRTUAL_BUCKET_
-0001b670: 4352 4541 5445 4255 434b 4554 5f53 5441  CREATEBUCKET_STA
-0001b680: 4745 442c 2062 7563 6b65 744e 616d 6531  GED, bucketName1
-0001b690: 2c20 6275 636b 6574 4e61 6d65 322c 2062  , bucketName2, b
-0001b6a0: 7563 6b65 7441 6c69 6173 290a 2020 2020  ucketAlias).    
-0001b6b0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0001b6c0: 6365 7074 696f 6e28 2763 7265 6174 6520  ception('create 
-0001b6d0: 6275 636b 6574 2061 6c69 6173 2066 6169  bucket alias fai
-0001b6e0: 6c65 642c 2072 6573 703a 2025 7327 2025  led, resp: %s' %
-0001b6f0: 2063 6261 5265 7370 290a 0a20 2020 2020   cbaResp)..     
-0001b700: 2020 2023 2073 7465 7020 343a 20e7 bb91     # step 4: ...
-0001b710: e5ae 9ae4 b8a4 e6ac a1e5 88ab e590 8def  ................
-0001b720: bc8c e4b8 bae4 b8a4 e4b8 aae7 9c9f e5ae  ................
-0001b730: 9ee6 a1b6 e588 86e5 88ab e7bb 91e5 ae9a  ................
-0001b740: 0a20 2020 2020 2020 2061 6c69 6173 496e  .        aliasIn
-0001b750: 666f 2e61 6c69 6173 203d 2062 7563 6b65  fo.alias = bucke
-0001b760: 7441 6c69 6173 0a20 2020 2020 2020 2062  tAlias.        b
-0001b770: 696e 6452 6573 7020 3d20 7365 6c66 2e62  indResp = self.b
-0001b780: 696e 6442 7563 6b65 7441 6c69 6173 2862  indBucketAlias(b
-0001b790: 7563 6b65 744e 616d 6531 2c20 616c 6961  ucketName1, alia
-0001b7a0: 7349 6e66 6f29 0a20 2020 2020 2020 2069  sInfo).        i
-0001b7b0: 6620 6269 6e64 5265 7370 2e73 7461 7475  f bindResp.statu
-0001b7c0: 7320 213d 2032 3030 3a0a 2020 2020 2020  s != 200:.      
-0001b7d0: 2020 2020 2020 7365 6c66 2e5f 636c 6561        self._clea
-0001b7e0: 725f 7669 7274 7561 6c5f 6275 636b 6574  r_virtual_bucket
-0001b7f0: 2863 6f6e 7374 2e56 4952 5455 414c 5f42  (const.VIRTUAL_B
-0001b800: 5543 4b45 545f 4352 4541 5445 414c 4941  UCKET_CREATEALIA
-0001b810: 535f 5354 4147 4544 2c20 6275 636b 6574  S_STAGED, bucket
-0001b820: 4e61 6d65 312c 2062 7563 6b65 744e 616d  Name1, bucketNam
-0001b830: 6532 2c20 6275 636b 6574 416c 6961 7329  e2, bucketAlias)
-0001b840: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001b850: 7365 2045 7863 6570 7469 6f6e 2827 6269  se Exception('bi
-0001b860: 6e64 696e 6720 6275 636b 6574 2061 6c69  nding bucket ali
-0001b870: 6173 2066 6169 6c65 642c 2072 6573 703a  as failed, resp:
-0001b880: 2025 7327 2025 2062 696e 6452 6573 7029   %s' % bindResp)
-0001b890: 0a0a 2020 2020 2020 2020 6269 6e64 5265  ..        bindRe
-0001b8a0: 7370 203d 2073 656c 662e 6269 6e64 4275  sp = self.bindBu
-0001b8b0: 636b 6574 416c 6961 7328 6275 636b 6574  cketAlias(bucket
-0001b8c0: 4e61 6d65 322c 2061 6c69 6173 496e 666f  Name2, aliasInfo
-0001b8d0: 290a 2020 2020 2020 2020 6966 2062 696e  ).        if bin
-0001b8e0: 6452 6573 702e 7374 6174 7573 2021 3d20  dResp.status != 
-0001b8f0: 3230 303a 0a20 2020 2020 2020 2020 2020  200:.           
-0001b900: 2073 656c 662e 5f63 6c65 6172 5f76 6972   self._clear_vir
-0001b910: 7475 616c 5f62 7563 6b65 7428 636f 6e73  tual_bucket(cons
-0001b920: 742e 5649 5254 5541 4c5f 4255 434b 4554  t.VIRTUAL_BUCKET
-0001b930: 5f42 494e 4441 4c49 4153 5f53 5441 4745  _BINDALIAS_STAGE
-0001b940: 442c 2062 7563 6b65 744e 616d 6531 2c20  D, bucketName1, 
-0001b950: 6275 636b 6574 4e61 6d65 322c 2062 7563  bucketName2, buc
-0001b960: 6b65 7441 6c69 6173 290a 2020 2020 2020  ketAlias).      
-0001b970: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-0001b980: 7074 696f 6e28 2762 696e 6469 6e67 2062  ption('binding b
-0001b990: 7563 6b65 7420 616c 6961 7320 6661 696c  ucket alias fail
-0001b9a0: 6564 2c20 7265 7370 3a20 2573 2720 2520  ed, resp: %s' % 
-0001b9b0: 6269 6e64 5265 7370 290a 0a20 2020 2020  bindResp)..     
-0001b9c0: 2020 2023 2073 7465 7020 353a 20e5 8f8c     # step 5: ...
-0001b9d0: e590 91e9 858d e7bd aee5 a48d e588 b6e5  ................
-0001b9e0: 85b3 e7b3 bbef bc8c e5b9 b6e5 bc80 e590  ................
-0001b9f0: afe5 8e86 e58f b2e5 afb9 e8b1 a1e5 a48d  ................
-0001ba00: e588 b60a 2020 2020 2020 2020 7265 706c  ....        repl
-0001ba10: 6963 6174 696f 6e52 6573 7020 3d20 7365  icationResp = se
-0001ba20: 6c66 2e5f 7365 745f 7669 7274 7561 6c5f  lf._set_virtual_
-0001ba30: 7265 706c 6963 6174 696f 6e28 6167 656e  replication(agen
-0001ba40: 6379 4e61 6d65 2c20 6275 636b 6574 4e61  cyName, bucketNa
-0001ba50: 6d65 312c 2062 7563 6b65 744e 616d 6532  me1, bucketName2
-0001ba60: 290a 2020 2020 2020 2020 6966 2072 6570  ).        if rep
-0001ba70: 6c69 6361 7469 6f6e 5265 7370 2e73 7461  licationResp.sta
-0001ba80: 7475 7320 213d 2032 3030 3a0a 2020 2020  tus != 200:.    
-0001ba90: 2020 2020 2020 2020 7365 6c66 2e5f 636c          self._cl
-0001baa0: 6561 725f 7669 7274 7561 6c5f 6275 636b  ear_virtual_buck
-0001bab0: 6574 2863 6f6e 7374 2e56 4952 5455 414c  et(const.VIRTUAL
-0001bac0: 5f42 5543 4b45 545f 4249 4e44 414c 4941  _BUCKET_BINDALIA
-0001bad0: 535f 5354 4147 4544 2c20 6275 636b 6574  S_STAGED, bucket
-0001bae0: 4e61 6d65 312c 2062 7563 6b65 744e 616d  Name1, bucketNam
-0001baf0: 6532 2c20 6275 636b 6574 416c 6961 7329  e2, bucketAlias)
-0001bb00: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001bb10: 7365 2045 7863 6570 7469 6f6e 2827 7365  se Exception('se
-0001bb20: 7420 7265 706c 6963 6174 696f 6e20 6661  t replication fa
-0001bb30: 696c 6564 2c20 7265 7370 3a20 2573 2720  iled, resp: %s' 
-0001bb40: 2520 7265 706c 6963 6174 696f 6e52 6573  % replicationRes
-0001bb50: 7029 0a0a 2020 2020 2020 2020 7265 706c  p)..        repl
-0001bb60: 6963 6174 696f 6e52 6573 7020 3d20 7365  icationResp = se
-0001bb70: 6c66 2e5f 7365 745f 7669 7274 7561 6c5f  lf._set_virtual_
-0001bb80: 7265 706c 6963 6174 696f 6e28 6167 656e  replication(agen
-0001bb90: 6379 4e61 6d65 2c20 6275 636b 6574 4e61  cyName, bucketNa
-0001bba0: 6d65 322c 2062 7563 6b65 744e 616d 6531  me2, bucketName1
-0001bbb0: 290a 2020 2020 2020 2020 6966 2072 6570  ).        if rep
-0001bbc0: 6c69 6361 7469 6f6e 5265 7370 2e73 7461  licationResp.sta
-0001bbd0: 7475 7320 213d 2032 3030 3a0a 2020 2020  tus != 200:.    
-0001bbe0: 2020 2020 2020 2020 7365 6c66 2e5f 636c          self._cl
-0001bbf0: 6561 725f 7669 7274 7561 6c5f 6275 636b  ear_virtual_buck
-0001bc00: 6574 2863 6f6e 7374 2e56 4952 5455 414c  et(const.VIRTUAL
-0001bc10: 5f42 5543 4b45 545f 4249 4e44 414c 4941  _BUCKET_BINDALIA
-0001bc20: 535f 5354 4147 4544 2c20 6275 636b 6574  S_STAGED, bucket
-0001bc30: 4e61 6d65 312c 2062 7563 6b65 744e 616d  Name1, bucketNam
-0001bc40: 6532 2c20 6275 636b 6574 416c 6961 7329  e2, bucketAlias)
-0001bc50: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001bc60: 7365 2045 7863 6570 7469 6f6e 2827 7365  se Exception('se
-0001bc70: 7420 7265 706c 6963 6174 696f 6e20 6661  t replication fa
-0001bc80: 696c 6564 2c20 7265 7370 3a20 2573 2720  iled, resp: %s' 
-0001bc90: 2520 7265 706c 6963 6174 696f 6e52 6573  % replicationRes
-0001bca0: 7029 0a0a 2020 2020 2020 2020 7265 7475  p)..        retu
-0001bcb0: 726e 207b 2763 6f64 6527 3a20 274f 4b27  rn {'code': 'OK'
-0001bcc0: 2c20 276d 6573 7361 6765 273a 2027 6372  , 'message': 'cr
-0001bcd0: 6561 7465 2076 6972 7475 616c 2062 7563  eate virtual buc
-0001bce0: 6b65 7420 7375 6363 6573 7327 2c20 2776  ket success', 'v
-0001bcf0: 6972 7475 616c 4275 636b 6574 4e61 6d65  irtualBucketName
-0001bd00: 273a 2062 7563 6b65 7441 6c69 6173 2c0a  ': bucketAlias,.
-0001bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd20: 2762 7563 6b65 744e 616d 6531 273a 2062  'bucketName1': b
-0001bd30: 7563 6b65 744e 616d 6531 2c20 2762 7563  ucketName1, 'buc
-0001bd40: 6b65 744e 616d 6532 273a 2062 7563 6b65  ketName2': bucke
-0001bd50: 744e 616d 6532 7d0a 0a20 2020 2064 6566  tName2}..    def
-0001bd60: 205f 6765 745f 636c 7573 7465 725f 6772   _get_cluster_gr
-0001bd70: 6f75 705f 6964 2873 656c 662c 2061 7a52  oup_id(self, azR
-0001bd80: 6573 7029 3a0a 2020 2020 2020 2020 617a  esp):.        az
-0001bd90: 4a73 6f6e 5265 7370 203d 2075 7469 6c2e  JsonResp = util.
-0001bda0: 6a73 6f6e 4c6f 6164 7346 6f72 5079 3228  jsonLoadsForPy2(
-0001bdb0: 617a 5265 7370 2e62 6f64 7929 2069 6620  azResp.body) if 
-0001bdc0: 636f 6e73 742e 4953 5f50 5954 484f 4e32  const.IS_PYTHON2
-0001bdd0: 2065 6c73 6520 6a73 6f6e 2e6c 6f61 6473   else json.loads
-0001bde0: 2861 7a52 6573 702e 626f 6479 290a 2020  (azResp.body).  
-0001bdf0: 2020 2020 2020 617a 496e 666f 7320 3d20        azInfos = 
-0001be00: 617a 4a73 6f6e 5265 7370 2e67 6574 2827  azJsonResp.get('
-0001be10: 696e 666f 7327 290a 0a20 2020 2020 2020  infos')..       
-0001be20: 2069 6620 6c65 6e28 617a 496e 666f 7329   if len(azInfos)
-0001be30: 2021 3d20 636f 6e73 742e 5649 5254 5541   != const.VIRTUA
-0001be40: 4c5f 4255 434b 4554 5f4e 4545 445f 415a  L_BUCKET_NEED_AZ
-0001be50: 5f43 4f55 4e54 3a0a 2020 2020 2020 2020  _COUNT:.        
-0001be60: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0001be70: 696f 6e28 2774 6865 206e 756d 6265 7220  ion('the number 
-0001be80: 6f66 2041 5a73 2064 6f65 7320 6e6f 7420  of AZs does not 
-0001be90: 6d65 6574 2074 6865 2072 6571 7569 7265  meet the require
-0001bea0: 6d65 6e74 7327 290a 0a20 2020 2020 2020  ments')..       
-0001beb0: 2066 6972 7374 415a 4b65 7920 3d20 6e65   firstAZKey = ne
-0001bec0: 7874 2869 7465 7228 617a 496e 666f 7329  xt(iter(azInfos)
-0001bed0: 290a 2020 2020 2020 2020 6669 7273 7441  ).        firstA
-0001bee0: 5a56 616c 7565 203d 2061 7a49 6e66 6f73  ZValue = azInfos
-0001bef0: 2e67 6574 2866 6972 7374 415a 4b65 7929  .get(firstAZKey)
-0001bf00: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0001bf10: 6669 7273 7441 5a56 616c 7565 2920 3d3d  firstAZValue) ==
-0001bf20: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0001bf30: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0001bf40: 276e 6f20 636c 7573 7465 7220 6578 6973  'no cluster exis
-0001bf50: 7473 2069 6e20 7468 6520 415a 2c20 415a  ts in the AZ, AZ
-0001bf60: 206b 6579 3a20 2573 2720 2520 6669 7273   key: %s' % firs
-0001bf70: 7441 5a4b 6579 290a 0a20 2020 2020 2020  tAZKey)..       
-0001bf80: 2066 6972 7374 415a 4367 4964 203d 2066   firstAZCgId = f
-0001bf90: 6972 7374 415a 5661 6c75 655b 305d 2e67  irstAZValue[0].g
-0001bfa0: 6574 2863 6f6e 7374 2e4b 4559 5f43 4c55  et(const.KEY_CLU
-0001bfb0: 5354 4552 5f47 524f 5550 5f49 4429 0a20  STER_GROUP_ID). 
-0001bfc0: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
-0001bfd0: 7273 7441 5a43 6749 643a 0a20 2020 2020  rstAZCgId:.     
-0001bfe0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0001bff0: 6570 7469 6f6e 2827 7468 6973 2041 5a73  eption('this AZs
-0001c000: 2066 6972 7374 2063 6c75 7374 6572 2067   first cluster g
-0001c010: 726f 7570 2069 6420 6973 204e 6f6e 652c  roup id is None,
-0001c020: 2041 5a20 6b65 793a 2025 7327 2025 2066   AZ key: %s' % f
-0001c030: 6972 7374 415a 4b65 7929 0a0a 2020 2020  irstAZKey)..    
-0001c040: 2020 2020 7365 636f 6e64 415a 4b65 7920      secondAZKey 
-0001c050: 3d20 6c69 7374 2861 7a49 6e66 6f73 2e6b  = list(azInfos.k
-0001c060: 6579 7328 2929 5b2d 315d 0a20 2020 2020  eys())[-1].     
-0001c070: 2020 2073 6563 6f6e 6441 5a56 616c 7565     secondAZValue
-0001c080: 203d 2061 7a49 6e66 6f73 2e67 6574 2873   = azInfos.get(s
-0001c090: 6563 6f6e 6441 5a4b 6579 290a 2020 2020  econdAZKey).    
-0001c0a0: 2020 2020 6966 206c 656e 2873 6563 6f6e      if len(secon
-0001c0b0: 6441 5a56 616c 7565 2920 3d3d 2030 3a0a  dAZValue) == 0:.
-0001c0c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001c0d0: 6520 4578 6365 7074 696f 6e28 276e 6f20  e Exception('no 
-0001c0e0: 636c 7573 7465 7220 6578 6973 7473 2069  cluster exists i
-0001c0f0: 6e20 7468 6520 415a 2c20 415a 206b 6579  n the AZ, AZ key
-0001c100: 3a20 2573 2720 2520 7365 636f 6e64 415a  : %s' % secondAZ
-0001c110: 4b65 7929 0a0a 2020 2020 2020 2020 7365  Key)..        se
-0001c120: 636f 6e64 415a 4367 4964 203d 2073 6563  condAZCgId = sec
-0001c130: 6f6e 6441 5a56 616c 7565 5b30 5d2e 6765  ondAZValue[0].ge
-0001c140: 7428 636f 6e73 742e 4b45 595f 434c 5553  t(const.KEY_CLUS
-0001c150: 5445 525f 4752 4f55 505f 4944 290a 2020  TER_GROUP_ID).  
-0001c160: 2020 2020 2020 6966 206e 6f74 2073 6563        if not sec
-0001c170: 6f6e 6441 5a43 6749 643a 0a20 2020 2020  ondAZCgId:.     
-0001c180: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0001c190: 6570 7469 6f6e 2827 7468 6973 2041 5a73  eption('this AZs
-0001c1a0: 2066 6972 7374 2063 6c75 7374 6572 2067   first cluster g
-0001c1b0: 726f 7570 2069 6420 6973 204e 6f6e 652c  roup id is None,
-0001c1c0: 2041 5a20 6b65 793a 2025 7327 2025 2073   AZ key: %s' % s
-0001c1d0: 6563 6f6e 6441 5a4b 6579 290a 0a20 2020  econdAZKey)..   
-0001c1e0: 2020 2020 2072 6574 7572 6e20 6669 7273       return firs
-0001c1f0: 7441 5a43 6749 642c 2073 6563 6f6e 6441  tAZCgId, secondA
-0001c200: 5a43 6749 640a 0a20 2020 2064 6566 205f  ZCgId..    def _
-0001c210: 6372 6561 7465 5f62 7563 6b65 745f 7769  create_bucket_wi
-0001c220: 7468 5f63 6c75 7374 6572 5f69 6428 7365  th_cluster_id(se
-0001c230: 6c66 2c20 6669 7273 7441 5a43 6749 642c  lf, firstAZCgId,
-0001c240: 2073 6563 6f6e 6441 5a43 6749 642c 2062   secondAZCgId, b
-0001c250: 7563 6b65 744e 616d 6531 2c20 6275 636b  ucketName1, buck
-0001c260: 6574 4e61 6d65 322c 2062 7563 6b65 7441  etName2, bucketA
-0001c270: 6c69 6173 2c20 6865 6164 6572 293a 0a20  lias, header):. 
-0001c280: 2020 2020 2020 2023 20e5 88a4 e696 ade6         # .......
-0001c290: a1b6 e698 afe5 90a6 e5ad 98e5 9ca8 0a20  ............... 
-0001c2a0: 2020 2020 2020 2062 7563 6b65 7431 4367         bucket1Cg
-0001c2b0: 4964 2c20 6275 636b 6574 3243 6749 6420  Id, bucket2CgId 
-0001c2c0: 3d20 7365 6c66 2e5f 6865 6164 5f76 6972  = self._head_vir
-0001c2d0: 7475 616c 5f62 7563 6b65 7428 6275 636b  tual_bucket(buck
-0001c2e0: 6574 4e61 6d65 312c 2062 7563 6b65 744e  etName1, bucketN
-0001c2f0: 616d 6532 290a 0a20 2020 2020 2020 2023  ame2)..        #
-0001c300: 20e4 b8a4 e4b8 aae6 a1b6 e983 bde5 ad98   ...............
-0001c310: e59c a8ef bc8c e4b8 9463 6c75 7374 6572  .........cluster
-0001c320: 2067 726f 7570 2069 64e4 b880 e887 b40a   group id.......
-0001c330: 2020 2020 2020 2020 6966 2062 7563 6b65          if bucke
-0001c340: 7431 4367 4964 2061 6e64 2062 7563 6b65  t1CgId and bucke
-0001c350: 7432 4367 4964 2061 6e64 2062 7563 6b65  t2CgId and bucke
-0001c360: 7431 4367 4964 203d 3d20 6275 636b 6574  t1CgId == bucket
-0001c370: 3243 6749 643a 0a20 2020 2020 2020 2020  2CgId:.         
-0001c380: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0001c390: 6f6e 2827 6372 6561 7465 2062 7563 6b65  on('create bucke
-0001c3a0: 7420 6661 696c 6564 2c20 626f 7468 2062  t failed, both b
-0001c3b0: 7563 6b65 7473 2065 7869 7374 2061 6e64  uckets exist and
-0001c3c0: 2063 6c75 7374 6572 2067 726f 7570 2069   cluster group i
-0001c3d0: 6420 6973 2074 6865 2073 616d 6527 290a  d is the same').
-0001c3e0: 0a20 2020 2020 2020 2065 7874 656e 7369  .        extensi
-0001c3f0: 6f6e 4865 6164 6572 7320 3d20 4578 7465  onHeaders = Exte
-0001c400: 6e73 696f 6e48 6561 6465 7228 290a 0a20  nsionHeader().. 
-0001c410: 2020 2020 2020 2023 20e5 8faa e5ad 98e5         # .......
-0001c420: 9ca8 e6a1 b631 0a20 2020 2020 2020 2069  .....1.        i
-0001c430: 6620 6275 636b 6574 3143 6749 643a 0a20  f bucket1CgId:. 
-0001c440: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0001c450: 7369 6f6e 4865 6164 6572 732e 6c6f 6361  sionHeaders.loca
-0001c460: 7469 6f6e 436c 7573 7465 7247 726f 7570  tionClusterGroup
-0001c470: 4964 203d 2073 6563 6f6e 6441 5a43 6749  Id = secondAZCgI
-0001c480: 6420 6966 2062 7563 6b65 7431 4367 4964  d if bucket1CgId
-0001c490: 203d 3d20 6669 7273 7441 5a43 6749 6420   == firstAZCgId 
-0001c4a0: 656c 7365 2066 6972 7374 415a 4367 4964  else firstAZCgId
-0001c4b0: 0a20 2020 2020 2020 2020 2020 2063 6252  .            cbR
-0001c4c0: 6573 7020 3d20 7365 6c66 2e63 7265 6174  esp = self.creat
-0001c4d0: 6542 7563 6b65 7428 6275 636b 6574 4e61  eBucket(bucketNa
-0001c4e0: 6d65 322c 2068 6561 6465 723d 6865 6164  me2, header=head
-0001c4f0: 6572 2c20 6578 7465 6e73 696f 6e48 6561  er, extensionHea
-0001c500: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-0001c510: 6164 6572 7329 0a20 2020 2020 2020 2020  aders).         
-0001c520: 2020 2069 6620 6362 5265 7370 2e73 7461     if cbResp.sta
-0001c530: 7475 7320 213d 2032 3030 3a0a 2020 2020  tus != 200:.    
-0001c540: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001c550: 2e5f 636c 6561 725f 7669 7274 7561 6c5f  ._clear_virtual_
-0001c560: 6275 636b 6574 2863 6f6e 7374 2e56 4952  bucket(const.VIR
-0001c570: 5455 414c 5f42 5543 4b45 545f 4352 4541  TUAL_BUCKET_CREA
-0001c580: 5445 4255 434b 4554 5f53 5441 4745 442c  TEBUCKET_STAGED,
-0001c590: 2062 7563 6b65 744e 616d 6531 2c20 6275   bucketName1, bu
-0001c5a0: 636b 6574 4e61 6d65 322c 0a20 2020 2020  cketName2,.     
-0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5d0: 2020 2020 2020 6275 636b 6574 416c 6961        bucketAlia
-0001c5e0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0001c5f0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0001c600: 6f6e 2827 6372 6561 7465 2062 7563 6b65  on('create bucke
-0001c610: 7420 6661 696c 6564 2c20 636c 7573 7465  t failed, cluste
-0001c620: 7220 6772 6f75 7020 6964 3a20 2573 2c20  r group id: %s, 
-0001c630: 7265 7370 3a20 2573 2720 2520 280a 2020  resp: %s' % (.  
-0001c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c650: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
-0001c660: 7273 2e6c 6f63 6174 696f 6e43 6c75 7374  rs.locationClust
-0001c670: 6572 4772 6f75 7049 642c 2063 6252 6573  erGroupId, cbRes
-0001c680: 7029 290a 0a20 2020 2020 2020 2023 20e5  p))..        # .
-0001c690: 8faa e5ad 98e5 9ca8 e6a1 b632 0a20 2020  ...........2.   
-0001c6a0: 2020 2020 2069 6620 6275 636b 6574 3243       if bucket2C
-0001c6b0: 6749 643a 0a20 2020 2020 2020 2020 2020  gId:.           
-0001c6c0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001c6d0: 732e 6c6f 6361 7469 6f6e 436c 7573 7465  s.locationCluste
-0001c6e0: 7247 726f 7570 4964 203d 2073 6563 6f6e  rGroupId = secon
-0001c6f0: 6441 5a43 6749 6420 6966 2062 7563 6b65  dAZCgId if bucke
-0001c700: 7432 4367 4964 203d 3d20 6669 7273 7441  t2CgId == firstA
-0001c710: 5a43 6749 6420 656c 7365 2066 6972 7374  ZCgId else first
-0001c720: 415a 4367 4964 0a20 2020 2020 2020 2020  AZCgId.         
-0001c730: 2020 2063 6252 6573 7020 3d20 7365 6c66     cbResp = self
-0001c740: 2e63 7265 6174 6542 7563 6b65 7428 6275  .createBucket(bu
-0001c750: 636b 6574 4e61 6d65 312c 2068 6561 6465  cketName1, heade
-0001c760: 723d 6865 6164 6572 2c20 6578 7465 6e73  r=header, extens
-0001c770: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0001c780: 7369 6f6e 4865 6164 6572 7329 0a20 2020  sionHeaders).   
-0001c790: 2020 2020 2020 2020 2069 6620 6362 5265           if cbRe
-0001c7a0: 7370 2e73 7461 7475 7320 213d 2032 3030  sp.status != 200
-0001c7b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c7c0: 2020 7365 6c66 2e5f 636c 6561 725f 7669    self._clear_vi
-0001c7d0: 7274 7561 6c5f 6275 636b 6574 2863 6f6e  rtual_bucket(con
-0001c7e0: 7374 2e56 4952 5455 414c 5f42 5543 4b45  st.VIRTUAL_BUCKE
-0001c7f0: 545f 4352 4541 5445 4255 434b 4554 5f53  T_CREATEBUCKET_S
-0001c800: 5441 4745 442c 2062 7563 6b65 744e 616d  TAGED, bucketNam
-0001c810: 6531 2c20 6275 636b 6574 4e61 6d65 322c  e1, bucketName2,
-0001c820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c840: 2020 2020 2020 2020 2020 2020 6275 636b              buck
-0001c850: 6574 416c 6961 7329 0a20 2020 2020 2020  etAlias).       
-0001c860: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0001c870: 7863 6570 7469 6f6e 2827 6372 6561 7465  xception('create
-0001c880: 2062 7563 6b65 7420 6661 696c 6564 2c20   bucket failed, 
-0001c890: 636c 7573 7465 7220 6772 6f75 7020 6964  cluster group id
-0001c8a0: 3a20 2573 2c20 7265 7370 3a20 2573 2720  : %s, resp: %s' 
-0001c8b0: 2520 280a 2020 2020 2020 2020 2020 2020  % (.            
-0001c8c0: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-0001c8d0: 6e48 6561 6465 7273 2e6c 6f63 6174 696f  nHeaders.locatio
-0001c8e0: 6e43 6c75 7374 6572 4772 6f75 7049 642c  nClusterGroupId,
-0001c8f0: 2063 6252 6573 7029 290a 0a20 2020 2020   cbResp))..     
-0001c900: 2020 2023 20e4 b8a4 e4b8 aae6 a1b6 e983     # ...........
-0001c910: bde4 b88d e5ad 98e5 9ca8 0a20 2020 2020  ...........     
-0001c920: 2020 2069 6620 6e6f 7420 6275 636b 6574     if not bucket
-0001c930: 3143 6749 6420 616e 6420 6e6f 7420 6275  1CgId and not bu
-0001c940: 636b 6574 3243 6749 643a 0a20 2020 2020  cket2CgId:.     
-0001c950: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-0001c960: 4865 6164 6572 732e 6c6f 6361 7469 6f6e  Headers.location
-0001c970: 436c 7573 7465 7247 726f 7570 4964 203d  ClusterGroupId =
-0001c980: 2066 6972 7374 415a 4367 4964 0a20 2020   firstAZCgId.   
-0001c990: 2020 2020 2020 2020 2063 6252 6573 7020           cbResp 
-0001c9a0: 3d20 7365 6c66 2e63 7265 6174 6542 7563  = self.createBuc
-0001c9b0: 6b65 7428 6275 636b 6574 4e61 6d65 312c  ket(bucketName1,
-0001c9c0: 2068 6561 6465 723d 6865 6164 6572 2c20   header=header, 
-0001c9d0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001c9e0: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-0001c9f0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
-0001ca00: 6620 6362 5265 7370 2e73 7461 7475 7320  f cbResp.status 
-0001ca10: 213d 2032 3030 3a0a 2020 2020 2020 2020  != 200:.        
-0001ca20: 2020 2020 2020 2020 7365 6c66 2e5f 636c          self._cl
-0001ca30: 6561 725f 7669 7274 7561 6c5f 6275 636b  ear_virtual_buck
-0001ca40: 6574 2863 6f6e 7374 2e56 4952 5455 414c  et(const.VIRTUAL
-0001ca50: 5f42 5543 4b45 545f 4352 4541 5445 4255  _BUCKET_CREATEBU
-0001ca60: 434b 4554 5f53 5441 4745 442c 2062 7563  CKET_STAGED, buc
-0001ca70: 6b65 744e 616d 6531 2c20 6275 636b 6574  ketName1, bucket
-0001ca80: 4e61 6d65 322c 0a20 2020 2020 2020 2020  Name2,.         
-0001ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cab0: 2020 6275 636b 6574 416c 6961 7329 0a20    bucketAlias). 
-0001cac0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001cad0: 6169 7365 2045 7863 6570 7469 6f6e 2827  aise Exception('
-0001cae0: 6372 6561 7465 2062 7563 6b65 7420 6661  create bucket fa
-0001caf0: 696c 6564 2c20 636c 7573 7465 7220 6772  iled, cluster gr
-0001cb00: 6f75 7020 6964 3a20 2573 2c20 7265 7370  oup id: %s, resp
-0001cb10: 3a20 2573 2720 2520 2866 6972 7374 415a  : %s' % (firstAZ
-0001cb20: 4367 4964 2c20 6362 5265 7370 2929 0a0a  CgId, cbResp))..
-0001cb30: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-0001cb40: 6e73 696f 6e48 6561 6465 7273 2e6c 6f63  nsionHeaders.loc
-0001cb50: 6174 696f 6e43 6c75 7374 6572 4772 6f75  ationClusterGrou
-0001cb60: 7049 6420 3d20 7365 636f 6e64 415a 4367  pId = secondAZCg
-0001cb70: 4964 0a20 2020 2020 2020 2020 2020 2063  Id.            c
-0001cb80: 6252 6573 7020 3d20 7365 6c66 2e63 7265  bResp = self.cre
-0001cb90: 6174 6542 7563 6b65 7428 6275 636b 6574  ateBucket(bucket
-0001cba0: 4e61 6d65 322c 2068 6561 6465 723d 6865  Name2, header=he
-0001cbb0: 6164 6572 2c20 6578 7465 6e73 696f 6e48  ader, extensionH
-0001cbc0: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
-0001cbd0: 4865 6164 6572 7329 0a20 2020 2020 2020  Headers).       
-0001cbe0: 2020 2020 2069 6620 6362 5265 7370 2e73       if cbResp.s
-0001cbf0: 7461 7475 7320 213d 2032 3030 3a0a 2020  tatus != 200:.  
-0001cc00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001cc10: 6c66 2e5f 636c 6561 725f 7669 7274 7561  lf._clear_virtua
-0001cc20: 6c5f 6275 636b 6574 2863 6f6e 7374 2e56  l_bucket(const.V
-0001cc30: 4952 5455 414c 5f42 5543 4b45 545f 4352  IRTUAL_BUCKET_CR
-0001cc40: 4541 5445 4255 434b 4554 5f53 5441 4745  EATEBUCKET_STAGE
-0001cc50: 442c 2062 7563 6b65 744e 616d 6531 2c20  D, bucketName1, 
-0001cc60: 6275 636b 6574 4e61 6d65 322c 0a20 2020  bucketName2,.   
-0001cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc90: 2020 2020 2020 2020 6275 636b 6574 416c          bucketAl
-0001cca0: 6961 7329 0a20 2020 2020 2020 2020 2020  ias).           
-0001ccb0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-0001ccc0: 7469 6f6e 2827 6372 6561 7465 2062 7563  tion('create buc
-0001ccd0: 6b65 7420 6661 696c 6564 2c20 636c 7573  ket failed, clus
-0001cce0: 7465 7220 6772 6f75 7020 6964 3a20 2573  ter group id: %s
-0001ccf0: 2c20 7265 7370 3a20 2573 2720 2520 2873  , resp: %s' % (s
-0001cd00: 6563 6f6e 6441 5a43 6749 642c 2063 6252  econdAZCgId, cbR
-0001cd10: 6573 7029 290a 0a20 2020 2064 6566 205f  esp))..    def _
-0001cd20: 6865 6164 5f76 6972 7475 616c 5f62 7563  head_virtual_buc
-0001cd30: 6b65 7428 7365 6c66 2c20 6275 636b 6574  ket(self, bucket
-0001cd40: 4e61 6d65 312c 2062 7563 6b65 744e 616d  Name1, bucketNam
-0001cd50: 6532 293a 0a20 2020 2020 2020 2062 7563  e2):.        buc
-0001cd60: 6b65 7431 4367 4964 203d 204e 6f6e 650a  ket1CgId = None.
-0001cd70: 2020 2020 2020 2020 6275 636b 6574 3243          bucket2C
-0001cd80: 6749 6420 3d20 4e6f 6e65 0a0a 2020 2020  gId = None..    
-0001cd90: 2020 2020 6865 6164 3152 6573 7020 3d20      head1Resp = 
-0001cda0: 7365 6c66 2e68 6561 6442 7563 6b65 7428  self.headBucket(
-0001cdb0: 6275 636b 6574 4e61 6d65 3129 0a20 2020  bucketName1).   
-0001cdc0: 2020 2020 2069 6620 6865 6164 3152 6573       if head1Res
-0001cdd0: 702e 7374 6174 7573 203d 3d20 3230 303a  p.status == 200:
-0001cde0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001cdf0: 2068 2069 6e20 6865 6164 3152 6573 702e   h in head1Resp.
-0001ce00: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-0001ce10: 2020 2020 2020 2020 6966 2063 6f6e 7374          if const
-0001ce20: 2e4c 4f43 4154 494f 4e5f 434c 5553 5445  .LOCATION_CLUSTE
-0001ce30: 5247 524f 5550 5f49 4420 696e 2068 3a0a  RGROUP_ID in h:.
-0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce50: 2020 2020 6275 636b 6574 3143 6749 6420      bucket1CgId 
-0001ce60: 3d20 685b 315d 0a20 2020 2020 2020 2020  = h[1].         
-0001ce70: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0001ce80: 0a0a 2020 2020 2020 2020 6865 6164 3252  ..        head2R
-0001ce90: 6573 7020 3d20 7365 6c66 2e68 6561 6442  esp = self.headB
-0001cea0: 7563 6b65 7428 6275 636b 6574 4e61 6d65  ucket(bucketName
-0001ceb0: 3229 0a20 2020 2020 2020 2069 6620 6865  2).        if he
-0001cec0: 6164 3252 6573 702e 7374 6174 7573 203d  ad2Resp.status =
-0001ced0: 3d20 3230 303a 0a20 2020 2020 2020 2020  = 200:.         
-0001cee0: 2020 2066 6f72 2068 2069 6e20 6865 6164     for h in head
-0001cef0: 3252 6573 702e 6865 6164 6572 3a0a 2020  2Resp.header:.  
-0001cf00: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001cf10: 2063 6f6e 7374 2e4c 4f43 4154 494f 4e5f   const.LOCATION_
-0001cf20: 434c 5553 5445 5247 524f 5550 5f49 4420  CLUSTERGROUP_ID 
-0001cf30: 696e 2068 3a0a 2020 2020 2020 2020 2020  in h:.          
-0001cf40: 2020 2020 2020 2020 2020 6275 636b 6574            bucket
-0001cf50: 3243 6749 6420 3d20 685b 315d 0a20 2020  2CgId = h[1].   
-0001cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf70: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
-0001cf80: 7265 7475 726e 2062 7563 6b65 7431 4367  return bucket1Cg
-0001cf90: 4964 2c20 6275 636b 6574 3243 6749 640a  Id, bucket2CgId.
-0001cfa0: 0a20 2020 2064 6566 205f 7365 745f 7669  .    def _set_vi
-0001cfb0: 7274 7561 6c5f 7265 706c 6963 6174 696f  rtual_replicatio
-0001cfc0: 6e28 7365 6c66 2c20 6167 656e 6379 4e61  n(self, agencyNa
-0001cfd0: 6d65 2c20 736f 7572 6365 4275 636b 6574  me, sourceBucket
-0001cfe0: 4e61 6d65 2c20 6465 7374 4275 636b 6574  Name, destBucket
-0001cff0: 4e61 6d65 293a 0a20 2020 2020 2020 2072  Name):.        r
-0001d000: 6570 6c69 6361 7469 6f6e 203d 2052 6570  eplication = Rep
-0001d010: 6c69 6361 7469 6f6e 2829 0a20 2020 2020  lication().     
-0001d020: 2020 2072 6570 6c69 6361 7469 6f6e 2e61     replication.a
-0001d030: 6765 6e63 7920 3d20 6167 656e 6379 4e61  gency = agencyNa
-0001d040: 6d65 0a0a 2020 2020 2020 2020 2320 7275  me..        # ru
-0001d050: 6c65 e79a 84e9 bb98 e8ae a4e8 a784 e588  le..............
-0001d060: 99e5 a682 e4b8 8bef bc9a 0a20 2020 2020  ...........     
-0001d070: 2020 2023 2069 64ef bc9a 7b73 6f75 7263     # id...{sourc
-0001d080: 6542 7563 6b65 744e 616d 657d 5f74 6f5f  eBucketName}_to_
-0001d090: 7b64 6573 7442 7563 6b65 744e 616d 657d  {destBucketName}
-0001d0a0: 0a20 2020 2020 2020 2023 2070 7265 6669  .        # prefi
-0001d0b0: 78e4 b8ba e7a9 ba0a 2020 2020 2020 2020  x.......        
-0001d0c0: 2320 7374 6174 7573 e4b8 ba45 6e61 626c  # status...Enabl
-0001d0d0: 6564 0a20 2020 2020 2020 2023 2073 746f  ed.        # sto
-0001d0e0: 7261 6765 436c 6173 73e4 b8ba 5354 414e  rageClass...STAN
-0001d0f0: 4441 5244 0a20 2020 2020 2020 2023 2064  DARD.        # d
-0001d100: 656c 6574 6544 6174 61e4 b8ba 456e 6162  eleteData...Enab
-0001d110: 6c65 640a 2020 2020 2020 2020 2320 6869  led.        # hi
-0001d120: 7374 6f72 6963 616c 4f62 6a65 6374 5265  storicalObjectRe
-0001d130: 706c 6963 6174 696f 6ee4 b8ba 456e 6162  plication...Enab
-0001d140: 6c65 640a 2020 2020 2020 2020 5f72 756c  led.        _rul
-0001d150: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
-0001d160: 7265 706c 6963 6174 696f 6e52 756c 6520  replicationRule 
-0001d170: 3d20 5265 706c 6963 6174 696f 6e52 756c  = ReplicationRul
-0001d180: 6528 290a 2020 2020 2020 2020 7265 706c  e().        repl
-0001d190: 6963 6174 696f 6e52 756c 652e 6964 203d  icationRule.id =
-0001d1a0: 2073 6f75 7263 6542 7563 6b65 744e 616d   sourceBucketNam
-0001d1b0: 6520 2b20 275f 746f 5f27 202b 2064 6573  e + '_to_' + des
-0001d1c0: 7442 7563 6b65 744e 616d 650a 2020 2020  tBucketName.    
-0001d1d0: 2020 2020 7265 706c 6963 6174 696f 6e52      replicationR
-0001d1e0: 756c 652e 7072 6566 6978 203d 2027 270a  ule.prefix = ''.
-0001d1f0: 2020 2020 2020 2020 7265 706c 6963 6174          replicat
-0001d200: 696f 6e52 756c 652e 7374 6174 7573 203d  ionRule.status =
-0001d210: 2027 456e 6162 6c65 6427 0a20 2020 2020   'Enabled'.     
-0001d220: 2020 2072 6570 6c69 6361 7469 6f6e 5275     replicationRu
-0001d230: 6c65 2e62 7563 6b65 7420 3d20 6465 7374  le.bucket = dest
-0001d240: 4275 636b 6574 4e61 6d65 0a20 2020 2020  BucketName.     
-0001d250: 2020 2072 6570 6c69 6361 7469 6f6e 5275     replicationRu
-0001d260: 6c65 2e73 746f 7261 6765 436c 6173 7320  le.storageClass 
-0001d270: 3d20 2753 5441 4e44 4152 4427 0a20 2020  = 'STANDARD'.   
-0001d280: 2020 2020 2072 6570 6c69 6361 7469 6f6e       replication
-0001d290: 5275 6c65 2e64 656c 6574 6544 6174 6120  Rule.deleteData 
-0001d2a0: 3d20 2745 6e61 626c 6564 270a 2020 2020  = 'Enabled'.    
-0001d2b0: 2020 2020 7265 706c 6963 6174 696f 6e52      replicationR
-0001d2c0: 756c 652e 6869 7374 6f72 6963 616c 4f62  ule.historicalOb
-0001d2d0: 6a65 6374 5265 706c 6963 6174 696f 6e20  jectReplication 
-0001d2e0: 3d20 2745 6e61 626c 6564 270a 0a20 2020  = 'Enabled'..   
-0001d2f0: 2020 2020 205f 7275 6c65 732e 6170 7065       _rules.appe
-0001d300: 6e64 2872 6570 6c69 6361 7469 6f6e 5275  nd(replicationRu
-0001d310: 6c65 290a 2020 2020 2020 2020 7265 706c  le).        repl
-0001d320: 6963 6174 696f 6e2e 7265 706c 6963 6174  ication.replicat
-0001d330: 696f 6e52 756c 6573 203d 205f 7275 6c65  ionRules = _rule
-0001d340: 730a 2020 2020 2020 2020 7265 7370 203d  s.        resp =
-0001d350: 2073 656c 662e 7365 7442 7563 6b65 7452   self.setBucketR
-0001d360: 6570 6c69 6361 7469 6f6e 2873 6f75 7263  eplication(sourc
-0001d370: 6542 7563 6b65 744e 616d 652c 2072 6570  eBucketName, rep
-0001d380: 6c69 6361 7469 6f6e 290a 2020 2020 2020  lication).      
-0001d390: 2020 7265 7475 726e 2072 6573 700a 0a20    return resp.. 
-0001d3a0: 2020 2064 6566 205f 636c 6561 725f 7669     def _clear_vi
-0001d3b0: 7274 7561 6c5f 6275 636b 6574 2873 656c  rtual_bucket(sel
-0001d3c0: 662c 2073 7461 6765 642c 2062 7563 6b65  f, staged, bucke
-0001d3d0: 744e 616d 6531 2c20 6275 636b 6574 4e61  tName1, bucketNa
-0001d3e0: 6d65 322c 2062 7563 6b65 7441 6c69 6173  me2, bucketAlias
-0001d3f0: 293a 0a20 2020 2020 2020 2023 2073 7461  ):.        # sta
-0001d400: 6765 64e5 8f96 e580 bcef bc9a 0a20 2020  ged..........   
-0001d410: 2020 2020 2023 2031 efbc 9ae5 889b e5bb       # 1........
-0001d420: bae7 9c9f e5ae 9ee6 a1b6 0a20 2020 2020  ...........     
-0001d430: 2020 2023 2032 efbc 9ae5 889b e5bb bae6     # 2..........
-0001d440: a1b6 e588 abe5 908d 0a20 2020 2020 2020  .........       
-0001d450: 2023 2033 efbc 9ae7 bb91 e5ae 9ae6 a1b6   # 3............
-0001d460: e588 abe5 908d 0a20 2020 2020 2020 2069  .......        i
-0001d470: 6620 7374 6167 6564 203e 3d20 636f 6e73  f staged >= cons
-0001d480: 742e 5649 5254 5541 4c5f 4255 434b 4554  t.VIRTUAL_BUCKET
-0001d490: 5f42 494e 4441 4c49 4153 5f53 5441 4745  _BINDALIAS_STAGE
-0001d4a0: 443a 0a20 2020 2020 2020 2020 2020 2023  D:.            #
-0001d4b0: 20e8 a7a3 e7bb 91e6 a1b6 e588 abe5 908d   ...............
-0001d4c0: 0a20 2020 2020 2020 2020 2020 2075 6e62  .            unb
-0001d4d0: 696e 6452 6573 7020 3d20 7365 6c66 2e75  indResp = self.u
-0001d4e0: 6e62 696e 6442 7563 6b65 7441 6c69 6173  nbindBucketAlias
-0001d4f0: 2862 7563 6b65 744e 616d 6531 290a 2020  (bucketName1).  
-0001d500: 2020 2020 2020 2020 2020 6966 2075 6e62            if unb
-0001d510: 696e 6452 6573 702e 7374 6174 7573 2021  indResp.status !
-0001d520: 3d20 3230 343a 0a20 2020 2020 2020 2020  = 204:.         
-0001d530: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0001d540: 6570 7469 6f6e 2827 756e 6269 6e64 2062  eption('unbind b
-0001d550: 7563 6b65 7420 616c 6961 7320 6661 696c  ucket alias fail
-0001d560: 6564 2c20 7265 7370 3a20 2573 2720 2520  ed, resp: %s' % 
-0001d570: 756e 6269 6e64 5265 7370 290a 0a20 2020  unbindResp)..   
-0001d580: 2020 2020 2020 2020 2075 6e62 696e 6452           unbindR
-0001d590: 6573 7020 3d20 7365 6c66 2e75 6e62 696e  esp = self.unbin
-0001d5a0: 6442 7563 6b65 7441 6c69 6173 2862 7563  dBucketAlias(buc
-0001d5b0: 6b65 744e 616d 6532 290a 2020 2020 2020  ketName2).      
-0001d5c0: 2020 2020 2020 6966 2075 6e62 696e 6452        if unbindR
-0001d5d0: 6573 702e 7374 6174 7573 2021 3d20 3230  esp.status != 20
-0001d5e0: 343a 0a20 2020 2020 2020 2020 2020 2020  4:.             
-0001d5f0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0001d600: 6f6e 2827 756e 6269 6e64 2062 7563 6b65  on('unbind bucke
-0001d610: 7420 616c 6961 7320 6661 696c 6564 2c20  t alias failed, 
-0001d620: 7265 7370 3a20 2573 2720 2520 756e 6269  resp: %s' % unbi
-0001d630: 6e64 5265 7370 290a 0a20 2020 2020 2020  ndResp)..       
-0001d640: 2069 6620 7374 6167 6564 203e 3d20 636f   if staged >= co
-0001d650: 6e73 742e 5649 5254 5541 4c5f 4255 434b  nst.VIRTUAL_BUCK
-0001d660: 4554 5f43 5245 4154 4541 4c49 4153 5f53  ET_CREATEALIAS_S
-0001d670: 5441 4745 443a 0a20 2020 2020 2020 2020  TAGED:.         
-0001d680: 2020 2023 20e5 88a0 e999 a4e6 a1b6 e588     # ...........
-0001d690: abe5 908d 0a20 2020 2020 2020 2020 2020  .....           
-0001d6a0: 2064 656c 6574 6541 6c69 6173 5265 7370   deleteAliasResp
-0001d6b0: 203d 2073 656c 662e 6465 6c65 7465 4275   = self.deleteBu
-0001d6c0: 636b 6574 416c 6961 7328 6275 636b 6574  cketAlias(bucket
-0001d6d0: 416c 6961 7329 0a20 2020 2020 2020 2020  Alias).         
-0001d6e0: 2020 2069 6620 6465 6c65 7465 416c 6961     if deleteAlia
-0001d6f0: 7352 6573 702e 7374 6174 7573 2021 3d20  sResp.status != 
-0001d700: 3230 343a 0a20 2020 2020 2020 2020 2020  204:.           
-0001d710: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-0001d720: 7469 6f6e 2827 6465 6c65 7465 2062 7563  tion('delete buc
-0001d730: 6b65 7420 616c 6961 7320 6661 696c 6564  ket alias failed
-0001d740: 2c20 7265 7370 3a20 2573 2720 2520 6465  , resp: %s' % de
-0001d750: 6c65 7465 416c 6961 7352 6573 7029 0a0a  leteAliasResp)..
-0001d760: 2020 2020 2020 2020 6966 2073 7461 6765          if stage
-0001d770: 6420 3e3d 2063 6f6e 7374 2e56 4952 5455  d >= const.VIRTU
-0001d780: 414c 5f42 5543 4b45 545f 4352 4541 5445  AL_BUCKET_CREATE
-0001d790: 4255 434b 4554 5f53 5441 4745 443a 0a20  BUCKET_STAGED:. 
-0001d7a0: 2020 2020 2020 2020 2020 2023 20e5 88a0             # ...
-0001d7b0: e999 a4e7 9c9f e5ae 9ee6 a1b6 0a20 2020  .............   
-0001d7c0: 2020 2020 2020 2020 2064 656c 6574 6542           deleteB
-0001d7d0: 7563 6b65 7452 6573 7020 3d20 7365 6c66  ucketResp = self
-0001d7e0: 2e64 656c 6574 6542 7563 6b65 7428 6275  .deleteBucket(bu
-0001d7f0: 636b 6574 4e61 6d65 3129 0a20 2020 2020  cketName1).     
-0001d800: 2020 2020 2020 2069 6620 6465 6c65 7465         if delete
-0001d810: 4275 636b 6574 5265 7370 2e73 7461 7475  BucketResp.statu
-0001d820: 7320 213d 2032 3034 3a0a 2020 2020 2020  s != 204:.      
-0001d830: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001d840: 4578 6365 7074 696f 6e28 2764 656c 6574  Exception('delet
-0001d850: 6520 6275 636b 6574 2066 6169 6c65 642c  e bucket failed,
-0001d860: 2072 6573 703a 2025 7327 2025 2064 656c   resp: %s' % del
-0001d870: 6574 6542 7563 6b65 7452 6573 7029 0a0a  eteBucketResp)..
-0001d880: 2020 2020 2020 2020 2020 2020 6465 6c65              dele
-0001d890: 7465 4275 636b 6574 5265 7370 203d 2073  teBucketResp = s
-0001d8a0: 656c 662e 6465 6c65 7465 4275 636b 6574  elf.deleteBucket
-0001d8b0: 2862 7563 6b65 744e 616d 6532 290a 2020  (bucketName2).  
-0001d8c0: 2020 2020 2020 2020 2020 6966 2064 656c            if del
-0001d8d0: 6574 6542 7563 6b65 7452 6573 702e 7374  eteBucketResp.st
-0001d8e0: 6174 7573 2021 3d20 3230 343a 0a20 2020  atus != 204:.   
-0001d8f0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0001d900: 7365 2045 7863 6570 7469 6f6e 2827 6465  se Exception('de
-0001d910: 6c65 7465 2062 7563 6b65 7420 6661 696c  lete bucket fail
-0001d920: 6564 2c20 7265 7370 3a20 2573 2720 2520  ed, resp: %s' % 
-0001d930: 6465 6c65 7465 4275 636b 6574 5265 7370  deleteBucketResp
-0001d940: 290a 0a20 2020 2023 2065 6e64 2076 6972  )..    # end vir
-0001d950: 7475 616c 2062 7563 6b65 7420 7265 6c61  tual bucket rela
-0001d960: 7465 640a 2020 2020 2320 656e 6420 7669  ted.    # end vi
-0001d970: 7274 7561 6c20 6275 636b 6574 2072 656c  rtual bucket rel
-0001d980: 6174 6564 0a20 2020 2023 2065 6e64 2076  ated.    # end v
-0001d990: 6972 7475 616c 2062 7563 6b65 7420 7265  irtual bucket re
-0001d9a0: 6c61 7465 640a 0a20 2020 2040 6675 6e63  lated..    @func
-0001d9b0: 4361 6368 650a 2020 2020 6465 6620 7570  Cache.    def up
-0001d9c0: 6c6f 6164 4669 6c65 2873 656c 662c 2062  loadFile(self, b
-0001d9d0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-0001d9e0: 744b 6579 2c20 7570 6c6f 6164 4669 6c65  tKey, uploadFile
-0001d9f0: 2c20 7061 7274 5369 7a65 3d39 202a 2031  , partSize=9 * 1
-0001da00: 3032 3420 2a20 3130 3234 2c0a 2020 2020  024 * 1024,.    
-0001da10: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001da20: 6173 6b4e 756d 3d31 2c20 656e 6162 6c65  askNum=1, enable
-0001da30: 4368 6563 6b70 6f69 6e74 3d46 616c 7365  Checkpoint=False
-0001da40: 2c20 6368 6563 6b70 6f69 6e74 4669 6c65  , checkpointFile
-0001da50: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-0001da60: 2020 2020 2020 2020 2020 6368 6563 6b53            checkS
-0001da70: 756d 3d46 616c 7365 2c20 6d65 7461 6461  um=False, metada
-0001da80: 7461 3d4e 6f6e 652c 2070 726f 6772 6573  ta=None, progres
-0001da90: 7343 616c 6c62 6163 6b3d 4e6f 6e65 2c20  sCallback=None, 
-0001daa0: 6865 6164 6572 733d 4e6f 6e65 2c0a 2020  headers=None,.  
-0001dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dac0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001dad0: 733d 4e6f 6e65 2c20 656e 636f 6469 6e67  s=None, encoding
-0001dae0: 5f74 7970 653d 4e6f 6e65 293a 0a20 2020  _type=None):.   
-0001daf0: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
-0001db00: 6965 6e74 2e6c 6f67 2849 4e46 4f2c 2027  ient.log(INFO, '
-0001db10: 656e 7465 7220 7265 7375 6d65 2075 706c  enter resume upl
-0001db20: 6f61 6420 6669 6c65 2e2e 2e27 290a 2020  oad file...').  
-0001db30: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
-0001db40: 7274 5f6e 6f74 5f6e 756c 6c28 6275 636b  rt_not_null(buck
-0001db50: 6574 4e61 6d65 2c20 2762 7563 6b65 744e  etName, 'bucketN
-0001db60: 616d 6520 6973 2065 6d70 7479 2729 0a20  ame is empty'). 
-0001db70: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
-0001db80: 6572 745f 6e6f 745f 6e75 6c6c 286f 626a  ert_not_null(obj
-0001db90: 6563 744b 6579 2c20 276f 626a 6563 744b  ectKey, 'objectK
-0001dba0: 6579 2069 7320 656d 7074 7927 290a 2020  ey is empty').  
-0001dbb0: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
-0001dbc0: 7274 5f6e 6f74 5f6e 756c 6c28 7570 6c6f  rt_not_null(uplo
-0001dbd0: 6164 4669 6c65 2c20 2775 706c 6f61 6446  adFile, 'uploadF
-0001dbe0: 696c 6520 6973 2065 6d70 7479 2729 0a0a  ile is empty')..
-0001dbf0: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-0001dc00: 7265 7375 6d65 5f75 706c 6f61 6428 6275  resume_upload(bu
-0001dc10: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-0001dc20: 4b65 792c 2075 706c 6f61 6446 696c 652c  Key, uploadFile,
-0001dc30: 2070 6172 7453 697a 652c 2074 6173 6b4e   partSize, taskN
-0001dc40: 756d 2c20 656e 6162 6c65 4368 6563 6b70  um, enableCheckp
-0001dc50: 6f69 6e74 2c20 6368 6563 6b70 6f69 6e74  oint, checkpoint
-0001dc60: 4669 6c65 2c0a 2020 2020 2020 2020 2020  File,.          
-0001dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc80: 2020 2020 6368 6563 6b53 756d 2c20 6d65      checkSum, me
-0001dc90: 7461 6461 7461 2c20 7072 6f67 7265 7373  tadata, progress
-0001dca0: 4361 6c6c 6261 636b 2c20 7365 6c66 2c20  Callback, self, 
-0001dcb0: 6865 6164 6572 732c 0a20 2020 2020 2020  headers,.       
-0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcd0: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-0001dce0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-0001dcf0: 6e48 6561 6465 7273 2c20 656e 636f 6469  nHeaders, encodi
-0001dd00: 6e67 5f74 7970 653d 656e 636f 6469 6e67  ng_type=encoding
-0001dd10: 5f74 7970 6529 0a0a 2020 2020 4066 756e  _type)..    @fun
-0001dd20: 6343 6163 6865 0a20 2020 2064 6566 205f  cCache.    def _
-0001dd30: 646f 776e 6c6f 6164 4669 6c65 5769 7468  downloadFileWith
-0001dd40: 4e6f 7469 6669 6572 2873 656c 662c 2062  Notifier(self, b
-0001dd50: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-0001dd60: 744b 6579 2c20 646f 776e 6c6f 6164 4669  tKey, downloadFi
-0001dd70: 6c65 3d4e 6f6e 652c 2070 6172 7453 697a  le=None, partSiz
-0001dd80: 653d 3520 2a20 3130 3234 202a 2031 3032  e=5 * 1024 * 102
-0001dd90: 342c 2074 6173 6b4e 756d 3d31 2c0a 2020  4, taskNum=1,.  
+0001a720: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
+0001a730: 746f 722e 7472 616e 735f 7365 745f 6275  tor.trans_set_bu
+0001a740: 636b 6574 5f72 6570 6c69 6361 7469 6f6e  cket_replication
+0001a750: 2872 6570 6c69 6361 7469 6f6e 3d72 6570  (replication=rep
+0001a760: 6c69 6361 7469 6f6e 2929 0a0a 2020 2020  lication))..    
+0001a770: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+0001a780: 6566 2067 6574 4275 636b 6574 5265 706c  ef getBucketRepl
+0001a790: 6963 6174 696f 6e28 7365 6c66 2c20 6275  ication(self, bu
+0001a7a0: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
+0001a7b0: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+0001a7c0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001a7d0: 2073 656c 662e 5f6d 616b 655f 6765 745f   self._make_get_
+0001a7e0: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+0001a7f0: 6d65 2c20 7061 7468 4172 6773 3d7b 2772  me, pathArgs={'r
+0001a800: 6570 6c69 6361 7469 6f6e 273a 204e 6f6e  eplication': Non
+0001a810: 657d 2c20 6d65 7468 6f64 4e61 6d65 3d27  e}, methodName='
+0001a820: 6765 7442 7563 6b65 7452 6570 6c69 6361  getBucketReplica
+0001a830: 7469 6f6e 272c 0a20 2020 2020 2020 2020  tion',.         
+0001a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a850: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+0001a860: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+0001a870: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+0001a880: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+0001a890: 2020 2020 6465 6620 6465 6c65 7465 4275      def deleteBu
+0001a8a0: 636b 6574 5265 706c 6963 6174 696f 6e28  cketReplication(
+0001a8b0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0001a8c0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0001a8d0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+0001a8e0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0001a8f0: 616b 655f 6465 6c65 7465 5f72 6571 7565  ake_delete_reque
+0001a900: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
+0001a910: 6174 6841 7267 733d 7b27 7265 706c 6963  athArgs={'replic
+0001a920: 6174 696f 6e27 3a20 4e6f 6e65 7d2c 2065  ation': None}, e
+0001a930: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0001a940: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0001a950: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
+0001a960: 650a 2020 2020 6465 6620 7365 7442 7563  e.    def setBuc
+0001a970: 6b65 7452 6571 7565 7374 5061 796d 656e  ketRequestPaymen
+0001a980: 7428 7365 6c66 2c20 6275 636b 6574 4e61  t(self, bucketNa
+0001a990: 6d65 2c20 7061 7965 722c 2065 7874 656e  me, payer, exten
+0001a9a0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+0001a9b0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+0001a9c0: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
+0001a9d0: 2870 6179 6572 2c20 2770 6179 6572 2069  (payer, 'payer i
+0001a9e0: 7320 656d 7074 7927 290a 2020 2020 2020  s empty').      
+0001a9f0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0001aa00: 616b 655f 7075 745f 7265 7175 6573 7428  ake_put_request(
+0001aa10: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
+0001aa20: 4172 6773 3d7b 2772 6571 7565 7374 5061  Args={'requestPa
+0001aa30: 796d 656e 7427 3a20 4e6f 6e65 7d2c 0a20  yment': None},. 
+0001aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa60: 2020 2020 2065 6e74 6974 793d 7365 6c66       entity=self
+0001aa70: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
+0001aa80: 5f62 7563 6b65 745f 7265 7175 6573 745f  _bucket_request_
+0001aa90: 7061 796d 656e 7428 7061 7965 723d 7061  payment(payer=pa
+0001aaa0: 7965 7229 2c0a 2020 2020 2020 2020 2020  yer),.          
+0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aac0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+0001aad0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+0001aae0: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+0001aaf0: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+0001ab00: 2020 2064 6566 2067 6574 4275 636b 6574     def getBucket
+0001ab10: 5265 7175 6573 7450 6179 6d65 6e74 2873  RequestPayment(s
+0001ab20: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+0001ab30: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0001ab40: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+0001ab50: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+0001ab60: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
+0001ab70: 7563 6b65 744e 616d 652c 2070 6174 6841  ucketName, pathA
+0001ab80: 7267 733d 7b27 7265 7175 6573 7450 6179  rgs={'requestPay
+0001ab90: 6d65 6e74 273a 204e 6f6e 657d 2c0a 2020  ment': None},.  
+0001aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abc0: 2020 2020 6d65 7468 6f64 4e61 6d65 3d27      methodName='
+0001abd0: 6765 7442 7563 6b65 7452 6571 7565 7374  getBucketRequest
+0001abe0: 5061 796d 656e 7427 2c20 6578 7465 6e73  Payment', extens
+0001abf0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+0001ac00: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
+0001ac10: 2020 2320 6265 6769 6e20 7669 7274 7561    # begin virtua
+0001ac20: 6c20 6275 636b 6574 2072 656c 6174 6564  l bucket related
+0001ac30: 0a20 2020 2023 2062 6567 696e 2076 6972  .    # begin vir
+0001ac40: 7475 616c 2062 7563 6b65 7420 7265 6c61  tual bucket rela
+0001ac50: 7465 640a 2020 2020 2320 6265 6769 6e20  ted.    # begin 
+0001ac60: 7669 7274 7561 6c20 6275 636b 6574 2072  virtual bucket r
+0001ac70: 656c 6174 6564 0a0a 2020 2020 4066 756e  elated..    @fun
+0001ac80: 6343 6163 6865 0a20 2020 2064 6566 206c  cCache.    def l
+0001ac90: 6973 7441 7661 696c 6162 6c65 5a6f 6e65  istAvailableZone
+0001aca0: 496e 666f 2873 656c 662c 2072 6567 696f  Info(self, regio
+0001acb0: 6e49 642c 2074 6f6b 656e 2c20 6578 7465  nId, token, exte
+0001acc0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+0001acd0: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
+0001ace0: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
+0001acf0: 6c28 7265 6769 6f6e 4964 2c20 2772 6567  l(regionId, 'reg
+0001ad00: 696f 6e49 6420 7368 6f75 6c64 206e 6f74  ionId should not
+0001ad10: 2062 6520 656d 7074 7927 290a 2020 2020   be empty').    
+0001ad20: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
+0001ad30: 5f6e 6f74 5f6e 756c 6c28 746f 6b65 6e2c  _not_null(token,
+0001ad40: 2027 746f 6b65 6e20 7368 6f75 6c64 206e   'token should n
+0001ad50: 6f74 2062 6520 656d 7074 7927 290a 0a20  ot be empty').. 
+0001ad60: 2020 2020 2020 2070 6174 6841 7267 7320         pathArgs 
+0001ad70: 3d20 7b27 7265 6769 6f6e 4964 273a 2072  = {'regionId': r
+0001ad80: 6567 696f 6e49 647d 0a20 2020 2020 2020  egionId}.       
+0001ad90: 2068 6561 6465 7220 3d20 7b0a 2020 2020   header = {.    
+0001ada0: 2020 2020 2020 2020 636f 6e73 742e 585f          const.X_
+0001adb0: 4155 5448 5f54 4f4b 454e 5f48 4541 4445  AUTH_TOKEN_HEADE
+0001adc0: 523a 2074 6f6b 656e 2c0a 2020 2020 2020  R: token,.      
+0001add0: 2020 2020 2020 636f 6e73 742e 434f 4e54        const.CONT
+0001ade0: 454e 545f 5459 5045 5f48 4541 4445 523a  ENT_TYPE_HEADER:
+0001adf0: 2063 6f6e 7374 2e4d 494d 455f 5459 5045   const.MIME_TYPE
+0001ae00: 532e 6765 7428 276a 736f 6e27 290a 2020  S.get('json').  
+0001ae10: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+0001ae20: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+0001ae30: 6b65 5f67 6574 5f72 6571 7565 7374 280a  ke_get_request(.
+0001ae40: 2020 2020 2020 2020 2020 2020 6f62 6a65              obje
+0001ae50: 6374 4b65 793d 2776 312f 7365 7276 6963  ctKey='v1/servic
+0001ae60: 6573 2f63 6c75 7374 6572 7327 2c0a 2020  es/clusters',.  
+0001ae70: 2020 2020 2020 2020 2020 7061 7468 4172            pathAr
+0001ae80: 6773 3d70 6174 6841 7267 732c 0a20 2020  gs=pathArgs,.   
+0001ae90: 2020 2020 2020 2020 2068 6561 6465 7273           headers
+0001aea0: 3d68 6561 6465 722c 0a20 2020 2020 2020  =header,.       
+0001aeb0: 2020 2020 206d 6574 686f 644e 616d 653d       methodName=
+0001aec0: 7365 6c66 2e6a 736f 6e5f 7265 7370 6f6e  self.json_respon
+0001aed0: 7365 5f6d 6574 686f 645f 6e61 6d65 2c0a  se_method_name,.
+0001aee0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+0001aef0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+0001af00: 656e 7369 6f6e 4865 6164 6572 730a 2020  ensionHeaders.  
+0001af10: 2020 2020 2020 290a 0a20 2020 2040 6675        )..    @fu
+0001af20: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+0001af30: 6372 6561 7465 4275 636b 6574 416c 6961  createBucketAlia
+0001af40: 7328 7365 6c66 2c20 6275 636b 6574 4e61  s(self, bucketNa
+0001af50: 6d65 2c20 616c 6961 7349 6e66 6f3d 4e6f  me, aliasInfo=No
+0001af60: 6e65 2c20 6578 7465 6e73 696f 6e48 6561  ne, extensionHea
+0001af70: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+0001af80: 2020 2020 6966 2061 6c69 6173 496e 666f      if aliasInfo
+0001af90: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001afa0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+0001afb0: 7074 696f 6e28 2761 6c69 6173 496e 666f  ption('aliasInfo
+0001afc0: 2069 7320 4e6f 6e65 2729 0a20 2020 2020   is None').     
+0001afd0: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
+0001afe0: 6e6f 745f 6e75 6c6c 2861 6c69 6173 496e  not_null(aliasIn
+0001aff0: 666f 2e67 6574 2827 6275 636b 6574 3127  fo.get('bucket1'
+0001b000: 292c 2027 6275 636b 6574 3120 7368 6f75  ), 'bucket1 shou
+0001b010: 6c64 206e 6f74 2062 6520 656d 7074 7927  ld not be empty'
+0001b020: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+0001b030: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
+0001b040: 616c 6961 7349 6e66 6f2e 6765 7428 2762  aliasInfo.get('b
+0001b050: 7563 6b65 7432 2729 2c20 2762 7563 6b65  ucket2'), 'bucke
+0001b060: 7432 2073 686f 756c 6420 6e6f 7420 6265  t2 should not be
+0001b070: 2065 6d70 7479 2729 0a20 2020 2020 2020   empty').       
+0001b080: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+0001b090: 6b65 5f70 7574 5f72 6571 7565 7374 2862  ke_put_request(b
+0001b0a0: 7563 6b65 744e 616d 652c 2065 7874 656e  ucketName, exten
+0001b0b0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+0001b0c0: 6e73 696f 6e48 6561 6465 7273 2c0a 2020  nsionHeaders,.  
+0001b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0f0: 2020 2020 2a2a 7365 6c66 2e63 6f6e 7665      **self.conve
+0001b100: 7274 6f72 2e74 7261 6e73 5f73 6574 5f62  rtor.trans_set_b
+0001b110: 7563 6b65 745f 616c 6961 7328 616c 6961  ucket_alias(alia
+0001b120: 7349 6e66 6f3d 616c 6961 7349 6e66 6f29  sInfo=aliasInfo)
+0001b130: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
+0001b140: 650a 2020 2020 6465 6620 6269 6e64 4275  e.    def bindBu
+0001b150: 636b 6574 416c 6961 7328 7365 6c66 2c20  cketAlias(self, 
+0001b160: 6275 636b 6574 4e61 6d65 2c20 616c 6961  bucketName, alia
+0001b170: 7349 6e66 6f3d 4e6f 6e65 2c20 6578 7465  sInfo=None, exte
+0001b180: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+0001b190: 6529 3a0a 2020 2020 2020 2020 6966 2061  e):.        if a
+0001b1a0: 6c69 6173 496e 666f 2069 7320 4e6f 6e65  liasInfo is None
+0001b1b0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001b1c0: 6973 6520 4578 6365 7074 696f 6e28 2761  ise Exception('a
+0001b1d0: 6c69 6173 496e 666f 2069 7320 4e6f 6e65  liasInfo is None
+0001b1e0: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
+0001b1f0: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
+0001b200: 2861 6c69 6173 496e 666f 2e67 6574 2827  (aliasInfo.get('
+0001b210: 616c 6961 7327 292c 2027 6275 636b 6574  alias'), 'bucket
+0001b220: 2061 6c69 6173 2073 686f 756c 6420 6e6f   alias should no
+0001b230: 7420 6265 2065 6d70 7479 2729 0a20 2020  t be empty').   
+0001b240: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001b250: 2e5f 6d61 6b65 5f70 7574 5f72 6571 7565  ._make_put_reque
+0001b260: 7374 2862 7563 6b65 744e 616d 652c 2065  st(bucketName, e
+0001b270: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0001b280: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0001b290: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2b0: 2020 2020 2020 2020 2a2a 7365 6c66 2e63          **self.c
+0001b2c0: 6f6e 7665 7274 6f72 2e74 7261 6e73 5f62  onvertor.trans_b
+0001b2d0: 696e 645f 6275 636b 6574 5f61 6c69 6173  ind_bucket_alias
+0001b2e0: 2861 6c69 6173 496e 666f 3d61 6c69 6173  (aliasInfo=alias
+0001b2f0: 496e 666f 2929 0a0a 2020 2020 4066 756e  Info))..    @fun
+0001b300: 6343 6163 6865 0a20 2020 2064 6566 2064  cCache.    def d
+0001b310: 656c 6574 6542 7563 6b65 7441 6c69 6173  eleteBucketAlias
+0001b320: 2873 656c 662c 2062 7563 6b65 7441 6c69  (self, bucketAli
+0001b330: 6173 2c20 6578 7465 6e73 696f 6e48 6561  as, extensionHea
+0001b340: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+0001b350: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
+0001b360: 5f6e 6f74 5f6e 756c 6c28 6275 636b 6574  _not_null(bucket
+0001b370: 416c 6961 732c 2027 6275 636b 6574 2061  Alias, 'bucket a
+0001b380: 6c69 6173 2073 686f 756c 6420 6e6f 7420  lias should not 
+0001b390: 6265 2065 6d70 7479 2729 0a20 2020 2020  be empty').     
+0001b3a0: 2020 2070 6174 6841 7267 7320 3d20 7b63     pathArgs = {c
+0001b3b0: 6f6e 7374 2e4f 4253 4255 434b 4554 414c  onst.OBSBUCKETAL
+0001b3c0: 4941 535f 5041 5241 4d3a 204e 6f6e 657d  IAS_PARAM: None}
+0001b3d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001b3e0: 7365 6c66 2e5f 6d61 6b65 5f64 656c 6574  self._make_delet
+0001b3f0: 655f 7265 7175 6573 7428 6275 636b 6574  e_request(bucket
+0001b400: 4e61 6d65 3d62 7563 6b65 7441 6c69 6173  Name=bucketAlias
+0001b410: 2c20 7061 7468 4172 6773 3d70 6174 6841  , pathArgs=pathA
+0001b420: 7267 732c 2065 7874 656e 7369 6f6e 4865  rgs, extensionHe
+0001b430: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+0001b440: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
+0001b450: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+0001b460: 756e 6269 6e64 4275 636b 6574 416c 6961  unbindBucketAlia
+0001b470: 7328 7365 6c66 2c20 6275 636b 6574 4e61  s(self, bucketNa
+0001b480: 6d65 2c20 6578 7465 6e73 696f 6e48 6561  me, extensionHea
+0001b490: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+0001b4a0: 2020 2020 7061 7468 4172 6773 203d 207b      pathArgs = {
+0001b4b0: 636f 6e73 742e 4f42 5341 4c49 4153 5f50  const.OBSALIAS_P
+0001b4c0: 4152 414d 3a20 4e6f 6e65 7d0a 2020 2020  ARAM: None}.    
+0001b4d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001b4e0: 5f6d 616b 655f 6465 6c65 7465 5f72 6571  _make_delete_req
+0001b4f0: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+0001b500: 2070 6174 6841 7267 733d 7061 7468 4172   pathArgs=pathAr
+0001b510: 6773 2c20 6578 7465 6e73 696f 6e48 6561  gs, extensionHea
+0001b520: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+0001b530: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
+0001b540: 6343 6163 6865 0a20 2020 2064 6566 2067  cCache.    def g
+0001b550: 6574 4275 636b 6574 416c 6961 7328 7365  etBucketAlias(se
+0001b560: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
+0001b570: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0001b580: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0001b590: 7061 7468 4172 6773 203d 207b 636f 6e73  pathArgs = {cons
+0001b5a0: 742e 4f42 5341 4c49 4153 5f50 4152 414d  t.OBSALIAS_PARAM
+0001b5b0: 3a20 4e6f 6e65 7d0a 2020 2020 2020 2020  : None}.        
+0001b5c0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
+0001b5d0: 655f 6765 745f 7265 7175 6573 7428 6275  e_get_request(bu
+0001b5e0: 636b 6574 4e61 6d65 2c20 7061 7468 4172  cketName, pathAr
+0001b5f0: 6773 3d70 6174 6841 7267 732c 206d 6574  gs=pathArgs, met
+0001b600: 686f 644e 616d 653d 2767 6574 4275 636b  hodName='getBuck
+0001b610: 6574 416c 6961 7327 2c0a 2020 2020 2020  etAlias',.      
+0001b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b640: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0001b650: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+0001b660: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
+0001b670: 6865 0a20 2020 2064 6566 206c 6973 7442  he.    def listB
+0001b680: 7563 6b65 7441 6c69 6173 2873 656c 662c  ucketAlias(self,
+0001b690: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0001b6a0: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+0001b6b0: 2070 6174 6841 7267 7320 3d20 7b63 6f6e   pathArgs = {con
+0001b6c0: 7374 2e4f 4253 4255 434b 4554 414c 4941  st.OBSBUCKETALIA
+0001b6d0: 535f 5041 5241 4d3a 204e 6f6e 657d 0a20  S_PARAM: None}. 
+0001b6e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001b6f0: 6c66 2e5f 6d61 6b65 5f67 6574 5f72 6571  lf._make_get_req
+0001b700: 7565 7374 2870 6174 6841 7267 733d 7061  uest(pathArgs=pa
+0001b710: 7468 4172 6773 2c20 6d65 7468 6f64 4e61  thArgs, methodNa
+0001b720: 6d65 3d27 4c69 7374 4275 636b 6574 416c  me='ListBucketAl
+0001b730: 6961 7327 2c0a 2020 2020 2020 2020 2020  ias',.          
+0001b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b750: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+0001b760: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+0001b770: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+0001b780: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+0001b790: 2020 2064 6566 2063 7265 6174 6556 6972     def createVir
+0001b7a0: 7475 616c 4275 636b 6574 2873 656c 662c  tualBucket(self,
+0001b7b0: 2072 6567 696f 6e49 642c 2074 6f6b 656e   regionId, token
+0001b7c0: 2c20 6275 636b 6574 4e61 6d65 312c 2062  , bucketName1, b
+0001b7d0: 7563 6b65 744e 616d 6532 2c20 6275 636b  ucketName2, buck
+0001b7e0: 6574 416c 6961 732c 2061 6765 6e63 794e  etAlias, agencyN
+0001b7f0: 616d 652c 2068 6561 6465 723d 4e6f 6e65  ame, header=None
+0001b800: 293a 0a20 2020 2020 2020 2023 2073 7465  ):.        # ste
+0001b810: 7020 313a 20e5 8897 e4b8 bee6 8c87 e5ae  p 1: ...........
+0001b820: 9a72 6567 696f 6ee4 b88b e79a 84e9 9b86  .region.........
+0001b830: e7be a4e4 bfa1 e681 af0a 2020 2020 2020  ..........      
+0001b840: 2020 617a 5265 7370 203d 2073 656c 662e    azResp = self.
+0001b850: 6c69 7374 4176 6169 6c61 626c 655a 6f6e  listAvailableZon
+0001b860: 6549 6e66 6f28 7265 6769 6f6e 4964 2c20  eInfo(regionId, 
+0001b870: 746f 6b65 6e29 0a20 2020 2020 2020 2069  token).        i
+0001b880: 6620 617a 5265 7370 2e73 7461 7475 7320  f azResp.status 
+0001b890: 213d 2032 3030 3a0a 2020 2020 2020 2020  != 200:.        
+0001b8a0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0001b8b0: 696f 6e28 276c 6973 7420 415a 2069 6e66  ion('list AZ inf
+0001b8c0: 6f73 2066 6169 6c65 642c 2072 6573 703a  os failed, resp:
+0001b8d0: 2025 7327 2025 2061 7a52 6573 7029 0a0a   %s' % azResp)..
+0001b8e0: 2020 2020 2020 2020 6669 7273 7441 5a43          firstAZC
+0001b8f0: 6749 642c 2073 6563 6f6e 6441 5a43 6749  gId, secondAZCgI
+0001b900: 6420 3d20 7365 6c66 2e5f 6765 745f 636c  d = self._get_cl
+0001b910: 7573 7465 725f 6772 6f75 705f 6964 2861  uster_group_id(a
+0001b920: 7a52 6573 7029 0a0a 2020 2020 2020 2020  zResp)..        
+0001b930: 2320 7374 6570 2032 3a20 e68c 87e5 ae9a  # step 2: ......
+0001b940: e99b 86e7 bea4 6964 e588 9be6 a1b6 0a20  ......id....... 
+0001b950: 2020 2020 2020 2073 656c 662e 5f63 7265         self._cre
+0001b960: 6174 655f 6275 636b 6574 5f77 6974 685f  ate_bucket_with_
+0001b970: 636c 7573 7465 725f 6964 2866 6972 7374  cluster_id(first
+0001b980: 415a 4367 4964 2c20 7365 636f 6e64 415a  AZCgId, secondAZ
+0001b990: 4367 4964 2c20 6275 636b 6574 4e61 6d65  CgId, bucketName
+0001b9a0: 312c 2062 7563 6b65 744e 616d 6532 2c20  1, bucketName2, 
+0001b9b0: 6275 636b 6574 416c 6961 732c 2068 6561  bucketAlias, hea
+0001b9c0: 6465 7229 0a0a 2020 2020 2020 2020 2320  der)..        # 
+0001b9d0: 7374 6570 2033 3a20 e588 9be5 bbba e4b8  step 3: ........
+0001b9e0: 80e6 aca1 e588 abe5 908d 0a20 2020 2020  ...........     
+0001b9f0: 2020 2061 6c69 6173 496e 666f 203d 2042     aliasInfo = B
+0001ba00: 7563 6b65 7441 6c69 6173 4d6f 6465 6c28  ucketAliasModel(
+0001ba10: 290a 2020 2020 2020 2020 616c 6961 7349  ).        aliasI
+0001ba20: 6e66 6f2e 6275 636b 6574 3120 3d20 6275  nfo.bucket1 = bu
+0001ba30: 636b 6574 4e61 6d65 310a 2020 2020 2020  cketName1.      
+0001ba40: 2020 616c 6961 7349 6e66 6f2e 6275 636b    aliasInfo.buck
+0001ba50: 6574 3220 3d20 6275 636b 6574 4e61 6d65  et2 = bucketName
+0001ba60: 320a 2020 2020 2020 2020 6362 6152 6573  2.        cbaRes
+0001ba70: 7020 3d20 7365 6c66 2e63 7265 6174 6542  p = self.createB
+0001ba80: 7563 6b65 7441 6c69 6173 2862 7563 6b65  ucketAlias(bucke
+0001ba90: 7441 6c69 6173 2c20 616c 6961 7349 6e66  tAlias, aliasInf
+0001baa0: 6f29 0a20 2020 2020 2020 2069 6620 6362  o).        if cb
+0001bab0: 6152 6573 702e 7374 6174 7573 2021 3d20  aResp.status != 
+0001bac0: 3230 303a 0a20 2020 2020 2020 2020 2020  200:.           
+0001bad0: 2073 656c 662e 5f63 6c65 6172 5f76 6972   self._clear_vir
+0001bae0: 7475 616c 5f62 7563 6b65 7428 636f 6e73  tual_bucket(cons
+0001baf0: 742e 5649 5254 5541 4c5f 4255 434b 4554  t.VIRTUAL_BUCKET
+0001bb00: 5f43 5245 4154 4542 5543 4b45 545f 5354  _CREATEBUCKET_ST
+0001bb10: 4147 4544 2c20 6275 636b 6574 4e61 6d65  AGED, bucketName
+0001bb20: 312c 2062 7563 6b65 744e 616d 6532 2c20  1, bucketName2, 
+0001bb30: 6275 636b 6574 416c 6961 7329 0a20 2020  bucketAlias).   
+0001bb40: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+0001bb50: 7863 6570 7469 6f6e 2827 6372 6561 7465  xception('create
+0001bb60: 2062 7563 6b65 7420 616c 6961 7320 6661   bucket alias fa
+0001bb70: 696c 6564 2c20 7265 7370 3a20 2573 2720  iled, resp: %s' 
+0001bb80: 2520 6362 6152 6573 7029 0a0a 2020 2020  % cbaResp)..    
+0001bb90: 2020 2020 2320 7374 6570 2034 3a20 e7bb      # step 4: ..
+0001bba0: 91e5 ae9a e4b8 a4e6 aca1 e588 abe5 908d  ................
+0001bbb0: efbc 8ce4 b8ba e4b8 a4e4 b8aa e79c 9fe5  ................
+0001bbc0: ae9e e6a1 b6e5 8886 e588 abe7 bb91 e5ae  ................
+0001bbd0: 9a0a 2020 2020 2020 2020 616c 6961 7349  ..        aliasI
+0001bbe0: 6e66 6f2e 616c 6961 7320 3d20 6275 636b  nfo.alias = buck
+0001bbf0: 6574 416c 6961 730a 2020 2020 2020 2020  etAlias.        
+0001bc00: 6269 6e64 5265 7370 203d 2073 656c 662e  bindResp = self.
+0001bc10: 6269 6e64 4275 636b 6574 416c 6961 7328  bindBucketAlias(
+0001bc20: 6275 636b 6574 4e61 6d65 312c 2061 6c69  bucketName1, ali
+0001bc30: 6173 496e 666f 290a 2020 2020 2020 2020  asInfo).        
+0001bc40: 6966 2062 696e 6452 6573 702e 7374 6174  if bindResp.stat
+0001bc50: 7573 2021 3d20 3230 303a 0a20 2020 2020  us != 200:.     
+0001bc60: 2020 2020 2020 2073 656c 662e 5f63 6c65         self._cle
+0001bc70: 6172 5f76 6972 7475 616c 5f62 7563 6b65  ar_virtual_bucke
+0001bc80: 7428 636f 6e73 742e 5649 5254 5541 4c5f  t(const.VIRTUAL_
+0001bc90: 4255 434b 4554 5f43 5245 4154 4541 4c49  BUCKET_CREATEALI
+0001bca0: 4153 5f53 5441 4745 442c 2062 7563 6b65  AS_STAGED, bucke
+0001bcb0: 744e 616d 6531 2c20 6275 636b 6574 4e61  tName1, bucketNa
+0001bcc0: 6d65 322c 2062 7563 6b65 7441 6c69 6173  me2, bucketAlias
+0001bcd0: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
+0001bce0: 6973 6520 4578 6365 7074 696f 6e28 2762  ise Exception('b
+0001bcf0: 696e 6469 6e67 2062 7563 6b65 7420 616c  inding bucket al
+0001bd00: 6961 7320 6661 696c 6564 2c20 7265 7370  ias failed, resp
+0001bd10: 3a20 2573 2720 2520 6269 6e64 5265 7370  : %s' % bindResp
+0001bd20: 290a 0a20 2020 2020 2020 2062 696e 6452  )..        bindR
+0001bd30: 6573 7020 3d20 7365 6c66 2e62 696e 6442  esp = self.bindB
+0001bd40: 7563 6b65 7441 6c69 6173 2862 7563 6b65  ucketAlias(bucke
+0001bd50: 744e 616d 6532 2c20 616c 6961 7349 6e66  tName2, aliasInf
+0001bd60: 6f29 0a20 2020 2020 2020 2069 6620 6269  o).        if bi
+0001bd70: 6e64 5265 7370 2e73 7461 7475 7320 213d  ndResp.status !=
+0001bd80: 2032 3030 3a0a 2020 2020 2020 2020 2020   200:.          
+0001bd90: 2020 7365 6c66 2e5f 636c 6561 725f 7669    self._clear_vi
+0001bda0: 7274 7561 6c5f 6275 636b 6574 2863 6f6e  rtual_bucket(con
+0001bdb0: 7374 2e56 4952 5455 414c 5f42 5543 4b45  st.VIRTUAL_BUCKE
+0001bdc0: 545f 4249 4e44 414c 4941 535f 5354 4147  T_BINDALIAS_STAG
+0001bdd0: 4544 2c20 6275 636b 6574 4e61 6d65 312c  ED, bucketName1,
+0001bde0: 2062 7563 6b65 744e 616d 6532 2c20 6275   bucketName2, bu
+0001bdf0: 636b 6574 416c 6961 7329 0a20 2020 2020  cketAlias).     
+0001be00: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0001be10: 6570 7469 6f6e 2827 6269 6e64 696e 6720  eption('binding 
+0001be20: 6275 636b 6574 2061 6c69 6173 2066 6169  bucket alias fai
+0001be30: 6c65 642c 2072 6573 703a 2025 7327 2025  led, resp: %s' %
+0001be40: 2062 696e 6452 6573 7029 0a0a 2020 2020   bindResp)..    
+0001be50: 2020 2020 2320 7374 6570 2035 3a20 e58f      # step 5: ..
+0001be60: 8ce5 9091 e985 8de7 bdae e5a4 8de5 88b6  ................
+0001be70: e585 b3e7 b3bb efbc 8ce5 b9b6 e5bc 80e5  ................
+0001be80: 90af e58e 86e5 8fb2 e5af b9e8 b1a1 e5a4  ................
+0001be90: 8de5 88b6 0a20 2020 2020 2020 2072 6570  .....        rep
+0001bea0: 6c69 6361 7469 6f6e 5265 7370 203d 2073  licationResp = s
+0001beb0: 656c 662e 5f73 6574 5f76 6972 7475 616c  elf._set_virtual
+0001bec0: 5f72 6570 6c69 6361 7469 6f6e 2861 6765  _replication(age
+0001bed0: 6e63 794e 616d 652c 2062 7563 6b65 744e  ncyName, bucketN
+0001bee0: 616d 6531 2c20 6275 636b 6574 4e61 6d65  ame1, bucketName
+0001bef0: 3229 0a20 2020 2020 2020 2069 6620 7265  2).        if re
+0001bf00: 706c 6963 6174 696f 6e52 6573 702e 7374  plicationResp.st
+0001bf10: 6174 7573 2021 3d20 3230 303a 0a20 2020  atus != 200:.   
+0001bf20: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+0001bf30: 6c65 6172 5f76 6972 7475 616c 5f62 7563  lear_virtual_buc
+0001bf40: 6b65 7428 636f 6e73 742e 5649 5254 5541  ket(const.VIRTUA
+0001bf50: 4c5f 4255 434b 4554 5f42 494e 4441 4c49  L_BUCKET_BINDALI
+0001bf60: 4153 5f53 5441 4745 442c 2062 7563 6b65  AS_STAGED, bucke
+0001bf70: 744e 616d 6531 2c20 6275 636b 6574 4e61  tName1, bucketNa
+0001bf80: 6d65 322c 2062 7563 6b65 7441 6c69 6173  me2, bucketAlias
+0001bf90: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
+0001bfa0: 6973 6520 4578 6365 7074 696f 6e28 2773  ise Exception('s
+0001bfb0: 6574 2072 6570 6c69 6361 7469 6f6e 2066  et replication f
+0001bfc0: 6169 6c65 642c 2072 6573 703a 2025 7327  ailed, resp: %s'
+0001bfd0: 2025 2072 6570 6c69 6361 7469 6f6e 5265   % replicationRe
+0001bfe0: 7370 290a 0a20 2020 2020 2020 2072 6570  sp)..        rep
+0001bff0: 6c69 6361 7469 6f6e 5265 7370 203d 2073  licationResp = s
+0001c000: 656c 662e 5f73 6574 5f76 6972 7475 616c  elf._set_virtual
+0001c010: 5f72 6570 6c69 6361 7469 6f6e 2861 6765  _replication(age
+0001c020: 6e63 794e 616d 652c 2062 7563 6b65 744e  ncyName, bucketN
+0001c030: 616d 6532 2c20 6275 636b 6574 4e61 6d65  ame2, bucketName
+0001c040: 3129 0a20 2020 2020 2020 2069 6620 7265  1).        if re
+0001c050: 706c 6963 6174 696f 6e52 6573 702e 7374  plicationResp.st
+0001c060: 6174 7573 2021 3d20 3230 303a 0a20 2020  atus != 200:.   
+0001c070: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+0001c080: 6c65 6172 5f76 6972 7475 616c 5f62 7563  lear_virtual_buc
+0001c090: 6b65 7428 636f 6e73 742e 5649 5254 5541  ket(const.VIRTUA
+0001c0a0: 4c5f 4255 434b 4554 5f42 494e 4441 4c49  L_BUCKET_BINDALI
+0001c0b0: 4153 5f53 5441 4745 442c 2062 7563 6b65  AS_STAGED, bucke
+0001c0c0: 744e 616d 6531 2c20 6275 636b 6574 4e61  tName1, bucketNa
+0001c0d0: 6d65 322c 2062 7563 6b65 7441 6c69 6173  me2, bucketAlias
+0001c0e0: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
+0001c0f0: 6973 6520 4578 6365 7074 696f 6e28 2773  ise Exception('s
+0001c100: 6574 2072 6570 6c69 6361 7469 6f6e 2066  et replication f
+0001c110: 6169 6c65 642c 2072 6573 703a 2025 7327  ailed, resp: %s'
+0001c120: 2025 2072 6570 6c69 6361 7469 6f6e 5265   % replicationRe
+0001c130: 7370 290a 0a20 2020 2020 2020 2072 6574  sp)..        ret
+0001c140: 7572 6e20 7b27 636f 6465 273a 2027 4f4b  urn {'code': 'OK
+0001c150: 272c 2027 6d65 7373 6167 6527 3a20 2763  ', 'message': 'c
+0001c160: 7265 6174 6520 7669 7274 7561 6c20 6275  reate virtual bu
+0001c170: 636b 6574 2073 7563 6365 7373 272c 2027  cket success', '
+0001c180: 7669 7274 7561 6c42 7563 6b65 744e 616d  virtualBucketNam
+0001c190: 6527 3a20 6275 636b 6574 416c 6961 732c  e': bucketAlias,
+0001c1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c1b0: 2027 6275 636b 6574 4e61 6d65 3127 3a20   'bucketName1': 
+0001c1c0: 6275 636b 6574 4e61 6d65 312c 2027 6275  bucketName1, 'bu
+0001c1d0: 636b 6574 4e61 6d65 3227 3a20 6275 636b  cketName2': buck
+0001c1e0: 6574 4e61 6d65 327d 0a0a 2020 2020 6465  etName2}..    de
+0001c1f0: 6620 5f67 6574 5f63 6c75 7374 6572 5f67  f _get_cluster_g
+0001c200: 726f 7570 5f69 6428 7365 6c66 2c20 617a  roup_id(self, az
+0001c210: 5265 7370 293a 0a20 2020 2020 2020 2061  Resp):.        a
+0001c220: 7a4a 736f 6e52 6573 7020 3d20 7574 696c  zJsonResp = util
+0001c230: 2e6a 736f 6e4c 6f61 6473 466f 7250 7932  .jsonLoadsForPy2
+0001c240: 2861 7a52 6573 702e 626f 6479 2920 6966  (azResp.body) if
+0001c250: 2063 6f6e 7374 2e49 535f 5059 5448 4f4e   const.IS_PYTHON
+0001c260: 3220 656c 7365 206a 736f 6e2e 6c6f 6164  2 else json.load
+0001c270: 7328 617a 5265 7370 2e62 6f64 7929 0a20  s(azResp.body). 
+0001c280: 2020 2020 2020 2061 7a49 6e66 6f73 203d         azInfos =
+0001c290: 2061 7a4a 736f 6e52 6573 702e 6765 7428   azJsonResp.get(
+0001c2a0: 2769 6e66 6f73 2729 0a0a 2020 2020 2020  'infos')..      
+0001c2b0: 2020 6966 206c 656e 2861 7a49 6e66 6f73    if len(azInfos
+0001c2c0: 2920 213d 2063 6f6e 7374 2e56 4952 5455  ) != const.VIRTU
+0001c2d0: 414c 5f42 5543 4b45 545f 4e45 4544 5f41  AL_BUCKET_NEED_A
+0001c2e0: 5a5f 434f 554e 543a 0a20 2020 2020 2020  Z_COUNT:.       
+0001c2f0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+0001c300: 7469 6f6e 2827 7468 6520 6e75 6d62 6572  tion('the number
+0001c310: 206f 6620 415a 7320 646f 6573 206e 6f74   of AZs does not
+0001c320: 206d 6565 7420 7468 6520 7265 7175 6972   meet the requir
+0001c330: 656d 656e 7473 2729 0a0a 2020 2020 2020  ements')..      
+0001c340: 2020 6669 7273 7441 5a4b 6579 203d 206e    firstAZKey = n
+0001c350: 6578 7428 6974 6572 2861 7a49 6e66 6f73  ext(iter(azInfos
+0001c360: 2929 0a20 2020 2020 2020 2066 6972 7374  )).        first
+0001c370: 415a 5661 6c75 6520 3d20 617a 496e 666f  AZValue = azInfo
+0001c380: 732e 6765 7428 6669 7273 7441 5a4b 6579  s.get(firstAZKey
+0001c390: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+0001c3a0: 2866 6972 7374 415a 5661 6c75 6529 203d  (firstAZValue) =
+0001c3b0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0001c3c0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0001c3d0: 2827 6e6f 2063 6c75 7374 6572 2065 7869  ('no cluster exi
+0001c3e0: 7374 7320 696e 2074 6865 2041 5a2c 2041  sts in the AZ, A
+0001c3f0: 5a20 6b65 793a 2025 7327 2025 2066 6972  Z key: %s' % fir
+0001c400: 7374 415a 4b65 7929 0a0a 2020 2020 2020  stAZKey)..      
+0001c410: 2020 6669 7273 7441 5a43 6749 6420 3d20    firstAZCgId = 
+0001c420: 6669 7273 7441 5a56 616c 7565 5b30 5d2e  firstAZValue[0].
+0001c430: 6765 7428 636f 6e73 742e 4b45 595f 434c  get(const.KEY_CL
+0001c440: 5553 5445 525f 4752 4f55 505f 4944 290a  USTER_GROUP_ID).
+0001c450: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+0001c460: 6972 7374 415a 4367 4964 3a0a 2020 2020  irstAZCgId:.    
+0001c470: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0001c480: 6365 7074 696f 6e28 2774 6869 7320 415a  ception('this AZ
+0001c490: 7320 6669 7273 7420 636c 7573 7465 7220  s first cluster 
+0001c4a0: 6772 6f75 7020 6964 2069 7320 4e6f 6e65  group id is None
+0001c4b0: 2c20 415a 206b 6579 3a20 2573 2720 2520  , AZ key: %s' % 
+0001c4c0: 6669 7273 7441 5a4b 6579 290a 0a20 2020  firstAZKey)..   
+0001c4d0: 2020 2020 2073 6563 6f6e 6441 5a4b 6579       secondAZKey
+0001c4e0: 203d 206c 6973 7428 617a 496e 666f 732e   = list(azInfos.
+0001c4f0: 6b65 7973 2829 295b 2d31 5d0a 2020 2020  keys())[-1].    
+0001c500: 2020 2020 7365 636f 6e64 415a 5661 6c75      secondAZValu
+0001c510: 6520 3d20 617a 496e 666f 732e 6765 7428  e = azInfos.get(
+0001c520: 7365 636f 6e64 415a 4b65 7929 0a20 2020  secondAZKey).   
+0001c530: 2020 2020 2069 6620 6c65 6e28 7365 636f       if len(seco
+0001c540: 6e64 415a 5661 6c75 6529 203d 3d20 303a  ndAZValue) == 0:
+0001c550: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001c560: 7365 2045 7863 6570 7469 6f6e 2827 6e6f  se Exception('no
+0001c570: 2063 6c75 7374 6572 2065 7869 7374 7320   cluster exists 
+0001c580: 696e 2074 6865 2041 5a2c 2041 5a20 6b65  in the AZ, AZ ke
+0001c590: 793a 2025 7327 2025 2073 6563 6f6e 6441  y: %s' % secondA
+0001c5a0: 5a4b 6579 290a 0a20 2020 2020 2020 2073  ZKey)..        s
+0001c5b0: 6563 6f6e 6441 5a43 6749 6420 3d20 7365  econdAZCgId = se
+0001c5c0: 636f 6e64 415a 5661 6c75 655b 305d 2e67  condAZValue[0].g
+0001c5d0: 6574 2863 6f6e 7374 2e4b 4559 5f43 4c55  et(const.KEY_CLU
+0001c5e0: 5354 4552 5f47 524f 5550 5f49 4429 0a20  STER_GROUP_ID). 
+0001c5f0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0001c600: 636f 6e64 415a 4367 4964 3a0a 2020 2020  condAZCgId:.    
+0001c610: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0001c620: 6365 7074 696f 6e28 2774 6869 7320 415a  ception('this AZ
+0001c630: 7320 6669 7273 7420 636c 7573 7465 7220  s first cluster 
+0001c640: 6772 6f75 7020 6964 2069 7320 4e6f 6e65  group id is None
+0001c650: 2c20 415a 206b 6579 3a20 2573 2720 2520  , AZ key: %s' % 
+0001c660: 7365 636f 6e64 415a 4b65 7929 0a0a 2020  secondAZKey)..  
+0001c670: 2020 2020 2020 7265 7475 726e 2066 6972        return fir
+0001c680: 7374 415a 4367 4964 2c20 7365 636f 6e64  stAZCgId, second
+0001c690: 415a 4367 4964 0a0a 2020 2020 6465 6620  AZCgId..    def 
+0001c6a0: 5f63 7265 6174 655f 6275 636b 6574 5f77  _create_bucket_w
+0001c6b0: 6974 685f 636c 7573 7465 725f 6964 2873  ith_cluster_id(s
+0001c6c0: 656c 662c 2066 6972 7374 415a 4367 4964  elf, firstAZCgId
+0001c6d0: 2c20 7365 636f 6e64 415a 4367 4964 2c20  , secondAZCgId, 
+0001c6e0: 6275 636b 6574 4e61 6d65 312c 2062 7563  bucketName1, buc
+0001c6f0: 6b65 744e 616d 6532 2c20 6275 636b 6574  ketName2, bucket
+0001c700: 416c 6961 732c 2068 6561 6465 7229 3a0a  Alias, header):.
+0001c710: 2020 2020 2020 2020 2320 e588 a4e6 96ad          # ......
+0001c720: e6a1 b6e6 98af e590 a6e5 ad98 e59c a80a  ................
+0001c730: 2020 2020 2020 2020 6275 636b 6574 3143          bucket1C
+0001c740: 6749 642c 2062 7563 6b65 7432 4367 4964  gId, bucket2CgId
+0001c750: 203d 2073 656c 662e 5f68 6561 645f 7669   = self._head_vi
+0001c760: 7274 7561 6c5f 6275 636b 6574 2862 7563  rtual_bucket(buc
+0001c770: 6b65 744e 616d 6531 2c20 6275 636b 6574  ketName1, bucket
+0001c780: 4e61 6d65 3229 0a0a 2020 2020 2020 2020  Name2)..        
+0001c790: 2320 e4b8 a4e4 b8aa e6a1 b6e9 83bd e5ad  # ..............
+0001c7a0: 98e5 9ca8 efbc 8ce4 b894 636c 7573 7465  ..........cluste
+0001c7b0: 7220 6772 6f75 7020 6964 e4b8 80e8 87b4  r group id......
+0001c7c0: 0a20 2020 2020 2020 2069 6620 6275 636b  .        if buck
+0001c7d0: 6574 3143 6749 6420 616e 6420 6275 636b  et1CgId and buck
+0001c7e0: 6574 3243 6749 6420 616e 6420 6275 636b  et2CgId and buck
+0001c7f0: 6574 3143 6749 6420 3d3d 2062 7563 6b65  et1CgId == bucke
+0001c800: 7432 4367 4964 3a0a 2020 2020 2020 2020  t2CgId:.        
+0001c810: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0001c820: 696f 6e28 2763 7265 6174 6520 6275 636b  ion('create buck
+0001c830: 6574 2066 6169 6c65 642c 2062 6f74 6820  et failed, both 
+0001c840: 6275 636b 6574 7320 6578 6973 7420 616e  buckets exist an
+0001c850: 6420 636c 7573 7465 7220 6772 6f75 7020  d cluster group 
+0001c860: 6964 2069 7320 7468 6520 7361 6d65 2729  id is the same')
+0001c870: 0a0a 2020 2020 2020 2020 6578 7465 6e73  ..        extens
+0001c880: 696f 6e48 6561 6465 7273 203d 2045 7874  ionHeaders = Ext
+0001c890: 656e 7369 6f6e 4865 6164 6572 2829 0a0a  ensionHeader()..
+0001c8a0: 2020 2020 2020 2020 2320 e58f aae5 ad98          # ......
+0001c8b0: e59c a8e6 a1b6 310a 2020 2020 2020 2020  ......1.        
+0001c8c0: 6966 2062 7563 6b65 7431 4367 4964 3a0a  if bucket1CgId:.
+0001c8d0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+0001c8e0: 6e73 696f 6e48 6561 6465 7273 2e6c 6f63  nsionHeaders.loc
+0001c8f0: 6174 696f 6e43 6c75 7374 6572 4772 6f75  ationClusterGrou
+0001c900: 7049 6420 3d20 7365 636f 6e64 415a 4367  pId = secondAZCg
+0001c910: 4964 2069 6620 6275 636b 6574 3143 6749  Id if bucket1CgI
+0001c920: 6420 3d3d 2066 6972 7374 415a 4367 4964  d == firstAZCgId
+0001c930: 2065 6c73 6520 6669 7273 7441 5a43 6749   else firstAZCgI
+0001c940: 640a 2020 2020 2020 2020 2020 2020 6362  d.            cb
+0001c950: 5265 7370 203d 2073 656c 662e 6372 6561  Resp = self.crea
+0001c960: 7465 4275 636b 6574 2862 7563 6b65 744e  teBucket(bucketN
+0001c970: 616d 6532 2c20 6865 6164 6572 3d68 6561  ame2, header=hea
+0001c980: 6465 722c 2065 7874 656e 7369 6f6e 4865  der, extensionHe
+0001c990: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+0001c9a0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
+0001c9b0: 2020 2020 6966 2063 6252 6573 702e 7374      if cbResp.st
+0001c9c0: 6174 7573 2021 3d20 3230 303a 0a20 2020  atus != 200:.   
+0001c9d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001c9e0: 662e 5f63 6c65 6172 5f76 6972 7475 616c  f._clear_virtual
+0001c9f0: 5f62 7563 6b65 7428 636f 6e73 742e 5649  _bucket(const.VI
+0001ca00: 5254 5541 4c5f 4255 434b 4554 5f43 5245  RTUAL_BUCKET_CRE
+0001ca10: 4154 4542 5543 4b45 545f 5354 4147 4544  ATEBUCKET_STAGED
+0001ca20: 2c20 6275 636b 6574 4e61 6d65 312c 2062  , bucketName1, b
+0001ca30: 7563 6b65 744e 616d 6532 2c0a 2020 2020  ucketName2,.    
+0001ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca60: 2020 2020 2020 2062 7563 6b65 7441 6c69         bucketAli
+0001ca70: 6173 290a 2020 2020 2020 2020 2020 2020  as).            
+0001ca80: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0001ca90: 696f 6e28 2763 7265 6174 6520 6275 636b  ion('create buck
+0001caa0: 6574 2066 6169 6c65 642c 2063 6c75 7374  et failed, clust
+0001cab0: 6572 2067 726f 7570 2069 643a 2025 732c  er group id: %s,
+0001cac0: 2072 6573 703a 2025 7327 2025 2028 0a20   resp: %s' % (. 
+0001cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cae0: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+0001caf0: 6572 732e 6c6f 6361 7469 6f6e 436c 7573  ers.locationClus
+0001cb00: 7465 7247 726f 7570 4964 2c20 6362 5265  terGroupId, cbRe
+0001cb10: 7370 2929 0a0a 2020 2020 2020 2020 2320  sp))..        # 
+0001cb20: e58f aae5 ad98 e59c a8e6 a1b6 320a 2020  ............2.  
+0001cb30: 2020 2020 2020 6966 2062 7563 6b65 7432        if bucket2
+0001cb40: 4367 4964 3a0a 2020 2020 2020 2020 2020  CgId:.          
+0001cb50: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
+0001cb60: 7273 2e6c 6f63 6174 696f 6e43 6c75 7374  rs.locationClust
+0001cb70: 6572 4772 6f75 7049 6420 3d20 7365 636f  erGroupId = seco
+0001cb80: 6e64 415a 4367 4964 2069 6620 6275 636b  ndAZCgId if buck
+0001cb90: 6574 3243 6749 6420 3d3d 2066 6972 7374  et2CgId == first
+0001cba0: 415a 4367 4964 2065 6c73 6520 6669 7273  AZCgId else firs
+0001cbb0: 7441 5a43 6749 640a 2020 2020 2020 2020  tAZCgId.        
+0001cbc0: 2020 2020 6362 5265 7370 203d 2073 656c      cbResp = sel
+0001cbd0: 662e 6372 6561 7465 4275 636b 6574 2862  f.createBucket(b
+0001cbe0: 7563 6b65 744e 616d 6531 2c20 6865 6164  ucketName1, head
+0001cbf0: 6572 3d68 6561 6465 722c 2065 7874 656e  er=header, exten
+0001cc00: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+0001cc10: 6e73 696f 6e48 6561 6465 7273 290a 2020  nsionHeaders).  
+0001cc20: 2020 2020 2020 2020 2020 6966 2063 6252            if cbR
+0001cc30: 6573 702e 7374 6174 7573 2021 3d20 3230  esp.status != 20
+0001cc40: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0001cc50: 2020 2073 656c 662e 5f63 6c65 6172 5f76     self._clear_v
+0001cc60: 6972 7475 616c 5f62 7563 6b65 7428 636f  irtual_bucket(co
+0001cc70: 6e73 742e 5649 5254 5541 4c5f 4255 434b  nst.VIRTUAL_BUCK
+0001cc80: 4554 5f43 5245 4154 4542 5543 4b45 545f  ET_CREATEBUCKET_
+0001cc90: 5354 4147 4544 2c20 6275 636b 6574 4e61  STAGED, bucketNa
+0001cca0: 6d65 312c 2062 7563 6b65 744e 616d 6532  me1, bucketName2
+0001ccb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccd0: 2020 2020 2020 2020 2020 2020 2062 7563               buc
+0001cce0: 6b65 7441 6c69 6173 290a 2020 2020 2020  ketAlias).      
+0001ccf0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001cd00: 4578 6365 7074 696f 6e28 2763 7265 6174  Exception('creat
+0001cd10: 6520 6275 636b 6574 2066 6169 6c65 642c  e bucket failed,
+0001cd20: 2063 6c75 7374 6572 2067 726f 7570 2069   cluster group i
+0001cd30: 643a 2025 732c 2072 6573 703a 2025 7327  d: %s, resp: %s'
+0001cd40: 2025 2028 0a20 2020 2020 2020 2020 2020   % (.           
+0001cd50: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0001cd60: 6f6e 4865 6164 6572 732e 6c6f 6361 7469  onHeaders.locati
+0001cd70: 6f6e 436c 7573 7465 7247 726f 7570 4964  onClusterGroupId
+0001cd80: 2c20 6362 5265 7370 2929 0a0a 2020 2020  , cbResp))..    
+0001cd90: 2020 2020 2320 e4b8 a4e4 b8aa e6a1 b6e9      # ..........
+0001cda0: 83bd e4b8 8de5 ad98 e59c a80a 2020 2020  ............    
+0001cdb0: 2020 2020 6966 206e 6f74 2062 7563 6b65      if not bucke
+0001cdc0: 7431 4367 4964 2061 6e64 206e 6f74 2062  t1CgId and not b
+0001cdd0: 7563 6b65 7432 4367 4964 3a0a 2020 2020  ucket2CgId:.    
+0001cde0: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
+0001cdf0: 6e48 6561 6465 7273 2e6c 6f63 6174 696f  nHeaders.locatio
+0001ce00: 6e43 6c75 7374 6572 4772 6f75 7049 6420  nClusterGroupId 
+0001ce10: 3d20 6669 7273 7441 5a43 6749 640a 2020  = firstAZCgId.  
+0001ce20: 2020 2020 2020 2020 2020 6362 5265 7370            cbResp
+0001ce30: 203d 2073 656c 662e 6372 6561 7465 4275   = self.createBu
+0001ce40: 636b 6574 2862 7563 6b65 744e 616d 6531  cket(bucketName1
+0001ce50: 2c20 6865 6164 6572 3d68 6561 6465 722c  , header=header,
+0001ce60: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0001ce70: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
+0001ce80: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+0001ce90: 6966 2063 6252 6573 702e 7374 6174 7573  if cbResp.status
+0001cea0: 2021 3d20 3230 303a 0a20 2020 2020 2020   != 200:.       
+0001ceb0: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+0001cec0: 6c65 6172 5f76 6972 7475 616c 5f62 7563  lear_virtual_buc
+0001ced0: 6b65 7428 636f 6e73 742e 5649 5254 5541  ket(const.VIRTUA
+0001cee0: 4c5f 4255 434b 4554 5f43 5245 4154 4542  L_BUCKET_CREATEB
+0001cef0: 5543 4b45 545f 5354 4147 4544 2c20 6275  UCKET_STAGED, bu
+0001cf00: 636b 6574 4e61 6d65 312c 2062 7563 6b65  cketName1, bucke
+0001cf10: 744e 616d 6532 2c0a 2020 2020 2020 2020  tName2,.        
+0001cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf40: 2020 2062 7563 6b65 7441 6c69 6173 290a     bucketAlias).
+0001cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf60: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+0001cf70: 2763 7265 6174 6520 6275 636b 6574 2066  'create bucket f
+0001cf80: 6169 6c65 642c 2063 6c75 7374 6572 2067  ailed, cluster g
+0001cf90: 726f 7570 2069 643a 2025 732c 2072 6573  roup id: %s, res
+0001cfa0: 703a 2025 7327 2025 2028 6669 7273 7441  p: %s' % (firstA
+0001cfb0: 5a43 6749 642c 2063 6252 6573 7029 290a  ZCgId, cbResp)).
+0001cfc0: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
+0001cfd0: 656e 7369 6f6e 4865 6164 6572 732e 6c6f  ensionHeaders.lo
+0001cfe0: 6361 7469 6f6e 436c 7573 7465 7247 726f  cationClusterGro
+0001cff0: 7570 4964 203d 2073 6563 6f6e 6441 5a43  upId = secondAZC
+0001d000: 6749 640a 2020 2020 2020 2020 2020 2020  gId.            
+0001d010: 6362 5265 7370 203d 2073 656c 662e 6372  cbResp = self.cr
+0001d020: 6561 7465 4275 636b 6574 2862 7563 6b65  eateBucket(bucke
+0001d030: 744e 616d 6532 2c20 6865 6164 6572 3d68  tName2, header=h
+0001d040: 6561 6465 722c 2065 7874 656e 7369 6f6e  eader, extension
+0001d050: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+0001d060: 6e48 6561 6465 7273 290a 2020 2020 2020  nHeaders).      
+0001d070: 2020 2020 2020 6966 2063 6252 6573 702e        if cbResp.
+0001d080: 7374 6174 7573 2021 3d20 3230 303a 0a20  status != 200:. 
+0001d090: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001d0a0: 656c 662e 5f63 6c65 6172 5f76 6972 7475  elf._clear_virtu
+0001d0b0: 616c 5f62 7563 6b65 7428 636f 6e73 742e  al_bucket(const.
+0001d0c0: 5649 5254 5541 4c5f 4255 434b 4554 5f43  VIRTUAL_BUCKET_C
+0001d0d0: 5245 4154 4542 5543 4b45 545f 5354 4147  REATEBUCKET_STAG
+0001d0e0: 4544 2c20 6275 636b 6574 4e61 6d65 312c  ED, bucketName1,
+0001d0f0: 2062 7563 6b65 744e 616d 6532 2c0a 2020   bucketName2,.  
+0001d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d120: 2020 2020 2020 2020 2062 7563 6b65 7441           bucketA
+0001d130: 6c69 6173 290a 2020 2020 2020 2020 2020  lias).          
+0001d140: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+0001d150: 7074 696f 6e28 2763 7265 6174 6520 6275  ption('create bu
+0001d160: 636b 6574 2066 6169 6c65 642c 2063 6c75  cket failed, clu
+0001d170: 7374 6572 2067 726f 7570 2069 643a 2025  ster group id: %
+0001d180: 732c 2072 6573 703a 2025 7327 2025 2028  s, resp: %s' % (
+0001d190: 7365 636f 6e64 415a 4367 4964 2c20 6362  secondAZCgId, cb
+0001d1a0: 5265 7370 2929 0a0a 2020 2020 6465 6620  Resp))..    def 
+0001d1b0: 5f68 6561 645f 7669 7274 7561 6c5f 6275  _head_virtual_bu
+0001d1c0: 636b 6574 2873 656c 662c 2062 7563 6b65  cket(self, bucke
+0001d1d0: 744e 616d 6531 2c20 6275 636b 6574 4e61  tName1, bucketNa
+0001d1e0: 6d65 3229 3a0a 2020 2020 2020 2020 6275  me2):.        bu
+0001d1f0: 636b 6574 3143 6749 6420 3d20 4e6f 6e65  cket1CgId = None
+0001d200: 0a20 2020 2020 2020 2062 7563 6b65 7432  .        bucket2
+0001d210: 4367 4964 203d 204e 6f6e 650a 0a20 2020  CgId = None..   
+0001d220: 2020 2020 2068 6561 6431 5265 7370 203d       head1Resp =
+0001d230: 2073 656c 662e 6865 6164 4275 636b 6574   self.headBucket
+0001d240: 2862 7563 6b65 744e 616d 6531 290a 2020  (bucketName1).  
+0001d250: 2020 2020 2020 6966 2068 6561 6431 5265        if head1Re
+0001d260: 7370 2e73 7461 7475 7320 3d3d 2032 3030  sp.status == 200
+0001d270: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+0001d280: 7220 6820 696e 2068 6561 6431 5265 7370  r h in head1Resp
+0001d290: 2e68 6561 6465 723a 0a20 2020 2020 2020  .header:.       
+0001d2a0: 2020 2020 2020 2020 2069 6620 636f 6e73           if cons
+0001d2b0: 742e 4c4f 4341 5449 4f4e 5f43 4c55 5354  t.LOCATION_CLUST
+0001d2c0: 4552 4752 4f55 505f 4944 2069 6e20 683a  ERGROUP_ID in h:
+0001d2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d2e0: 2020 2020 2062 7563 6b65 7431 4367 4964       bucket1CgId
+0001d2f0: 203d 2068 5b31 5d0a 2020 2020 2020 2020   = h[1].        
+0001d300: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0001d310: 6b0a 0a20 2020 2020 2020 2068 6561 6432  k..        head2
+0001d320: 5265 7370 203d 2073 656c 662e 6865 6164  Resp = self.head
+0001d330: 4275 636b 6574 2862 7563 6b65 744e 616d  Bucket(bucketNam
+0001d340: 6532 290a 2020 2020 2020 2020 6966 2068  e2).        if h
+0001d350: 6561 6432 5265 7370 2e73 7461 7475 7320  ead2Resp.status 
+0001d360: 3d3d 2032 3030 3a0a 2020 2020 2020 2020  == 200:.        
+0001d370: 2020 2020 666f 7220 6820 696e 2068 6561      for h in hea
+0001d380: 6432 5265 7370 2e68 6561 6465 723a 0a20  d2Resp.header:. 
+0001d390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001d3a0: 6620 636f 6e73 742e 4c4f 4341 5449 4f4e  f const.LOCATION
+0001d3b0: 5f43 4c55 5354 4552 4752 4f55 505f 4944  _CLUSTERGROUP_ID
+0001d3c0: 2069 6e20 683a 0a20 2020 2020 2020 2020   in h:.         
+0001d3d0: 2020 2020 2020 2020 2020 2062 7563 6b65             bucke
+0001d3e0: 7432 4367 4964 203d 2068 5b31 5d0a 2020  t2CgId = h[1].  
+0001d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d400: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
+0001d410: 2072 6574 7572 6e20 6275 636b 6574 3143   return bucket1C
+0001d420: 6749 642c 2062 7563 6b65 7432 4367 4964  gId, bucket2CgId
+0001d430: 0a0a 2020 2020 6465 6620 5f73 6574 5f76  ..    def _set_v
+0001d440: 6972 7475 616c 5f72 6570 6c69 6361 7469  irtual_replicati
+0001d450: 6f6e 2873 656c 662c 2061 6765 6e63 794e  on(self, agencyN
+0001d460: 616d 652c 2073 6f75 7263 6542 7563 6b65  ame, sourceBucke
+0001d470: 744e 616d 652c 2064 6573 7442 7563 6b65  tName, destBucke
+0001d480: 744e 616d 6529 3a0a 2020 2020 2020 2020  tName):.        
+0001d490: 7265 706c 6963 6174 696f 6e20 3d20 5265  replication = Re
+0001d4a0: 706c 6963 6174 696f 6e28 290a 2020 2020  plication().    
+0001d4b0: 2020 2020 7265 706c 6963 6174 696f 6e2e      replication.
+0001d4c0: 6167 656e 6379 203d 2061 6765 6e63 794e  agency = agencyN
+0001d4d0: 616d 650a 0a20 2020 2020 2020 205f 7275  ame..        _ru
+0001d4e0: 6c65 7320 3d20 5b5d 0a20 2020 2020 2020  les = [].       
+0001d4f0: 2072 6570 6c69 6361 7469 6f6e 5275 6c65   replicationRule
+0001d500: 203d 2052 6570 6c69 6361 7469 6f6e 5275   = ReplicationRu
+0001d510: 6c65 2829 0a20 2020 2020 2020 2072 6570  le().        rep
+0001d520: 6c69 6361 7469 6f6e 5275 6c65 2e69 6420  licationRule.id 
+0001d530: 3d20 736f 7572 6365 4275 636b 6574 4e61  = sourceBucketNa
+0001d540: 6d65 202b 2027 5f74 6f5f 2720 2b20 6465  me + '_to_' + de
+0001d550: 7374 4275 636b 6574 4e61 6d65 0a20 2020  stBucketName.   
+0001d560: 2020 2020 2072 6570 6c69 6361 7469 6f6e       replication
+0001d570: 5275 6c65 2e70 7265 6669 7820 3d20 2727  Rule.prefix = ''
+0001d580: 0a20 2020 2020 2020 2072 6570 6c69 6361  .        replica
+0001d590: 7469 6f6e 5275 6c65 2e73 7461 7475 7320  tionRule.status 
+0001d5a0: 3d20 2745 6e61 626c 6564 270a 2020 2020  = 'Enabled'.    
+0001d5b0: 2020 2020 7265 706c 6963 6174 696f 6e52      replicationR
+0001d5c0: 756c 652e 6275 636b 6574 203d 2064 6573  ule.bucket = des
+0001d5d0: 7442 7563 6b65 744e 616d 650a 2020 2020  tBucketName.    
+0001d5e0: 2020 2020 7265 706c 6963 6174 696f 6e52      replicationR
+0001d5f0: 756c 652e 7374 6f72 6167 6543 6c61 7373  ule.storageClass
+0001d600: 203d 2027 5354 414e 4441 5244 270a 2020   = 'STANDARD'.  
+0001d610: 2020 2020 2020 7265 706c 6963 6174 696f        replicatio
+0001d620: 6e52 756c 652e 6465 6c65 7465 4461 7461  nRule.deleteData
+0001d630: 203d 2027 456e 6162 6c65 6427 0a20 2020   = 'Enabled'.   
+0001d640: 2020 2020 2072 6570 6c69 6361 7469 6f6e       replication
+0001d650: 5275 6c65 2e68 6973 746f 7269 6361 6c4f  Rule.historicalO
+0001d660: 626a 6563 7452 6570 6c69 6361 7469 6f6e  bjectReplication
+0001d670: 203d 2027 456e 6162 6c65 6427 0a0a 2020   = 'Enabled'..  
+0001d680: 2020 2020 2020 5f72 756c 6573 2e61 7070        _rules.app
+0001d690: 656e 6428 7265 706c 6963 6174 696f 6e52  end(replicationR
+0001d6a0: 756c 6529 0a20 2020 2020 2020 2072 6570  ule).        rep
+0001d6b0: 6c69 6361 7469 6f6e 2e72 6570 6c69 6361  lication.replica
+0001d6c0: 7469 6f6e 5275 6c65 7320 3d20 5f72 756c  tionRules = _rul
+0001d6d0: 6573 0a20 2020 2020 2020 2072 6573 7020  es.        resp 
+0001d6e0: 3d20 7365 6c66 2e73 6574 4275 636b 6574  = self.setBucket
+0001d6f0: 5265 706c 6963 6174 696f 6e28 736f 7572  Replication(sour
+0001d700: 6365 4275 636b 6574 4e61 6d65 2c20 7265  ceBucketName, re
+0001d710: 706c 6963 6174 696f 6e29 0a20 2020 2020  plication).     
+0001d720: 2020 2072 6574 7572 6e20 7265 7370 0a0a     return resp..
+0001d730: 2020 2020 6465 6620 5f63 6c65 6172 5f76      def _clear_v
+0001d740: 6972 7475 616c 5f62 7563 6b65 7428 7365  irtual_bucket(se
+0001d750: 6c66 2c20 7374 6167 6564 2c20 6275 636b  lf, staged, buck
+0001d760: 6574 4e61 6d65 312c 2062 7563 6b65 744e  etName1, bucketN
+0001d770: 616d 6532 2c20 6275 636b 6574 416c 6961  ame2, bucketAlia
+0001d780: 7329 3a0a 2020 2020 2020 2020 2320 7374  s):.        # st
+0001d790: 6167 6564 e58f 96e5 80bc efbc 9a0a 2020  aged..........  
+0001d7a0: 2020 2020 2020 2320 31ef bc9a e588 9be5        # 1.......
+0001d7b0: bbba e79c 9fe5 ae9e e6a1 b60a 2020 2020  ............    
+0001d7c0: 2020 2020 2320 32ef bc9a e588 9be5 bbba      # 2.........
+0001d7d0: e6a1 b6e5 88ab e590 8d0a 2020 2020 2020  ..........      
+0001d7e0: 2020 2320 33ef bc9a e7bb 91e5 ae9a e6a1    # 3...........
+0001d7f0: b6e5 88ab e590 8d0a 2020 2020 2020 2020  ........        
+0001d800: 6966 2073 7461 6765 6420 3e3d 2063 6f6e  if staged >= con
+0001d810: 7374 2e56 4952 5455 414c 5f42 5543 4b45  st.VIRTUAL_BUCKE
+0001d820: 545f 4249 4e44 414c 4941 535f 5354 4147  T_BINDALIAS_STAG
+0001d830: 4544 3a0a 2020 2020 2020 2020 2020 2020  ED:.            
+0001d840: 2320 e8a7 a3e7 bb91 e6a1 b6e5 88ab e590  # ..............
+0001d850: 8d0a 2020 2020 2020 2020 2020 2020 756e  ..            un
+0001d860: 6269 6e64 5265 7370 203d 2073 656c 662e  bindResp = self.
+0001d870: 756e 6269 6e64 4275 636b 6574 416c 6961  unbindBucketAlia
+0001d880: 7328 6275 636b 6574 4e61 6d65 3129 0a20  s(bucketName1). 
+0001d890: 2020 2020 2020 2020 2020 2069 6620 756e             if un
+0001d8a0: 6269 6e64 5265 7370 2e73 7461 7475 7320  bindResp.status 
+0001d8b0: 213d 2032 3034 3a0a 2020 2020 2020 2020  != 204:.        
+0001d8c0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0001d8d0: 6365 7074 696f 6e28 2775 6e62 696e 6420  ception('unbind 
+0001d8e0: 6275 636b 6574 2061 6c69 6173 2066 6169  bucket alias fai
+0001d8f0: 6c65 642c 2072 6573 703a 2025 7327 2025  led, resp: %s' %
+0001d900: 2075 6e62 696e 6452 6573 7029 0a0a 2020   unbindResp)..  
+0001d910: 2020 2020 2020 2020 2020 756e 6269 6e64            unbind
+0001d920: 5265 7370 203d 2073 656c 662e 756e 6269  Resp = self.unbi
+0001d930: 6e64 4275 636b 6574 416c 6961 7328 6275  ndBucketAlias(bu
+0001d940: 636b 6574 4e61 6d65 3229 0a20 2020 2020  cketName2).     
+0001d950: 2020 2020 2020 2069 6620 756e 6269 6e64         if unbind
+0001d960: 5265 7370 2e73 7461 7475 7320 213d 2032  Resp.status != 2
+0001d970: 3034 3a0a 2020 2020 2020 2020 2020 2020  04:.            
+0001d980: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0001d990: 696f 6e28 2775 6e62 696e 6420 6275 636b  ion('unbind buck
+0001d9a0: 6574 2061 6c69 6173 2066 6169 6c65 642c  et alias failed,
+0001d9b0: 2072 6573 703a 2025 7327 2025 2075 6e62   resp: %s' % unb
+0001d9c0: 696e 6452 6573 7029 0a0a 2020 2020 2020  indResp)..      
+0001d9d0: 2020 6966 2073 7461 6765 6420 3e3d 2063    if staged >= c
+0001d9e0: 6f6e 7374 2e56 4952 5455 414c 5f42 5543  onst.VIRTUAL_BUC
+0001d9f0: 4b45 545f 4352 4541 5445 414c 4941 535f  KET_CREATEALIAS_
+0001da00: 5354 4147 4544 3a0a 2020 2020 2020 2020  STAGED:.        
+0001da10: 2020 2020 2320 e588 a0e9 99a4 e6a1 b6e5      # ..........
+0001da20: 88ab e590 8d0a 2020 2020 2020 2020 2020  ......          
+0001da30: 2020 6465 6c65 7465 416c 6961 7352 6573    deleteAliasRes
+0001da40: 7020 3d20 7365 6c66 2e64 656c 6574 6542  p = self.deleteB
+0001da50: 7563 6b65 7441 6c69 6173 2862 7563 6b65  ucketAlias(bucke
+0001da60: 7441 6c69 6173 290a 2020 2020 2020 2020  tAlias).        
+0001da70: 2020 2020 6966 2064 656c 6574 6541 6c69      if deleteAli
+0001da80: 6173 5265 7370 2e73 7461 7475 7320 213d  asResp.status !=
+0001da90: 2032 3034 3a0a 2020 2020 2020 2020 2020   204:.          
+0001daa0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+0001dab0: 7074 696f 6e28 2764 656c 6574 6520 6275  ption('delete bu
+0001dac0: 636b 6574 2061 6c69 6173 2066 6169 6c65  cket alias faile
+0001dad0: 642c 2072 6573 703a 2025 7327 2025 2064  d, resp: %s' % d
+0001dae0: 656c 6574 6541 6c69 6173 5265 7370 290a  eleteAliasResp).
+0001daf0: 0a20 2020 2020 2020 2069 6620 7374 6167  .        if stag
+0001db00: 6564 203e 3d20 636f 6e73 742e 5649 5254  ed >= const.VIRT
+0001db10: 5541 4c5f 4255 434b 4554 5f43 5245 4154  UAL_BUCKET_CREAT
+0001db20: 4542 5543 4b45 545f 5354 4147 4544 3a0a  EBUCKET_STAGED:.
+0001db30: 2020 2020 2020 2020 2020 2020 2320 e588              # ..
+0001db40: a0e9 99a4 e79c 9fe5 ae9e e6a1 b60a 2020  ..............  
+0001db50: 2020 2020 2020 2020 2020 6465 6c65 7465            delete
+0001db60: 4275 636b 6574 5265 7370 203d 2073 656c  BucketResp = sel
+0001db70: 662e 6465 6c65 7465 4275 636b 6574 2862  f.deleteBucket(b
+0001db80: 7563 6b65 744e 616d 6531 290a 2020 2020  ucketName1).    
+0001db90: 2020 2020 2020 2020 6966 2064 656c 6574          if delet
+0001dba0: 6542 7563 6b65 7452 6573 702e 7374 6174  eBucketResp.stat
+0001dbb0: 7573 2021 3d20 3230 343a 0a20 2020 2020  us != 204:.     
+0001dbc0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001dbd0: 2045 7863 6570 7469 6f6e 2827 6465 6c65   Exception('dele
+0001dbe0: 7465 2062 7563 6b65 7420 6661 696c 6564  te bucket failed
+0001dbf0: 2c20 7265 7370 3a20 2573 2720 2520 6465  , resp: %s' % de
+0001dc00: 6c65 7465 4275 636b 6574 5265 7370 290a  leteBucketResp).
+0001dc10: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+0001dc20: 6574 6542 7563 6b65 7452 6573 7020 3d20  eteBucketResp = 
+0001dc30: 7365 6c66 2e64 656c 6574 6542 7563 6b65  self.deleteBucke
+0001dc40: 7428 6275 636b 6574 4e61 6d65 3229 0a20  t(bucketName2). 
+0001dc50: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+0001dc60: 6c65 7465 4275 636b 6574 5265 7370 2e73  leteBucketResp.s
+0001dc70: 7461 7475 7320 213d 2032 3034 3a0a 2020  tatus != 204:.  
+0001dc80: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0001dc90: 6973 6520 4578 6365 7074 696f 6e28 2764  ise Exception('d
+0001dca0: 656c 6574 6520 6275 636b 6574 2066 6169  elete bucket fai
+0001dcb0: 6c65 642c 2072 6573 703a 2025 7327 2025  led, resp: %s' %
+0001dcc0: 2064 656c 6574 6542 7563 6b65 7452 6573   deleteBucketRes
+0001dcd0: 7029 0a0a 2020 2020 2320 656e 6420 7669  p)..    # end vi
+0001dce0: 7274 7561 6c20 6275 636b 6574 2072 656c  rtual bucket rel
+0001dcf0: 6174 6564 0a20 2020 2023 2065 6e64 2076  ated.    # end v
+0001dd00: 6972 7475 616c 2062 7563 6b65 7420 7265  irtual bucket re
+0001dd10: 6c61 7465 640a 2020 2020 2320 656e 6420  lated.    # end 
+0001dd20: 7669 7274 7561 6c20 6275 636b 6574 2072  virtual bucket r
+0001dd30: 656c 6174 6564 0a0a 2020 2020 4066 756e  elated..    @fun
+0001dd40: 6343 6163 6865 0a20 2020 2064 6566 2075  cCache.    def u
+0001dd50: 706c 6f61 6446 696c 6528 7365 6c66 2c20  ploadFile(self, 
+0001dd60: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
+0001dd70: 6374 4b65 792c 2075 706c 6f61 6446 696c  ctKey, uploadFil
+0001dd80: 652c 2070 6172 7453 697a 653d 3920 2a20  e, partSize=9 * 
+0001dd90: 3130 3234 202a 2031 3032 342c 0a20 2020  1024 * 1024,.   
 0001dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddc0: 656e 6162 6c65 4368 6563 6b70 6f69 6e74  enableCheckpoint
-0001ddd0: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-0001dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddf0: 2020 2020 2020 2020 2020 6368 6563 6b70            checkp
-0001de00: 6f69 6e74 4669 6c65 3d4e 6f6e 652c 2068  ointFile=None, h
-0001de10: 6561 6465 723d 4e6f 6e65 2c20 7665 7273  eader=None, vers
-0001de20: 696f 6e49 643d 4e6f 6e65 2c20 7072 6f67  ionId=None, prog
-0001de30: 7265 7373 4361 6c6c 6261 636b 3d4e 6f6e  ressCallback=Non
-0001de40: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de60: 2020 2020 2069 6d61 6765 5072 6f63 6573       imageProces
-0001de70: 733d 4e6f 6e65 2c20 6e6f 7469 6669 6572  s=None, notifier
-0001de80: 3d70 726f 6772 6573 732e 4e4f 4e45 5f4e  =progress.NONE_N
-0001de90: 4f54 4946 4945 522c 2065 7874 656e 7369  OTIFIER, extensi
-0001dea0: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-0001deb0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-0001dec0: 675f 636c 6965 6e74 2e6c 6f67 2849 4e46  g_client.log(INF
-0001ded0: 4f2c 2027 656e 7465 7220 7265 7375 6d65  O, 'enter resume
-0001dee0: 2064 6f77 6e6c 6f61 642e 2e2e 2729 0a20   download...'). 
-0001def0: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
-0001df00: 6572 745f 6e6f 745f 6e75 6c6c 2862 7563  ert_not_null(buc
-0001df10: 6b65 744e 616d 652c 2027 6275 636b 6574  ketName, 'bucket
-0001df20: 4e61 6d65 2069 7320 656d 7074 7927 290a  Name is empty').
-0001df30: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
-0001df40: 7365 7274 5f6e 6f74 5f6e 756c 6c28 6f62  sert_not_null(ob
-0001df50: 6a65 6374 4b65 792c 2027 6f62 6a65 6374  jectKey, 'object
-0001df60: 4b65 7920 6973 2065 6d70 7479 2729 0a20  Key is empty'). 
-0001df70: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-0001df80: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001df90: 2020 2020 2020 6865 6164 6572 203d 2047        header = G
-0001dfa0: 6574 4f62 6a65 6374 4865 6164 6572 2829  etObjectHeader()
-0001dfb0: 0a20 2020 2020 2020 2069 6620 646f 776e  .        if down
-0001dfc0: 6c6f 6164 4669 6c65 2069 7320 4e6f 6e65  loadFile is None
-0001dfd0: 3a0a 2020 2020 2020 2020 2020 2020 646f  :.            do
-0001dfe0: 776e 6c6f 6164 4669 6c65 203d 206f 626a  wnloadFile = obj
-0001dff0: 6563 744b 6579 0a0a 2020 2020 2020 2020  ectKey..        
-0001e000: 7265 7475 726e 205f 7265 7375 6d65 5f64  return _resume_d
-0001e010: 6f77 6e6c 6f61 6428 6275 636b 6574 4e61  ownload(bucketNa
-0001e020: 6d65 2c20 6f62 6a65 6374 4b65 792c 2064  me, objectKey, d
-0001e030: 6f77 6e6c 6f61 6446 696c 652c 2070 6172  ownloadFile, par
-0001e040: 7453 697a 652c 2074 6173 6b4e 756d 2c20  tSize, taskNum, 
-0001e050: 656e 6162 6c65 4368 6563 6b70 6f69 6e74  enableCheckpoint
-0001e060: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e080: 2020 6368 6563 6b70 6f69 6e74 4669 6c65    checkpointFile
-0001e090: 2c20 6865 6164 6572 2c20 7665 7273 696f  , header, versio
-0001e0a0: 6e49 642c 2070 726f 6772 6573 7343 616c  nId, progressCal
-0001e0b0: 6c62 6163 6b2c 2073 656c 662c 0a20 2020  lback, self,.   
-0001e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0d0: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-0001e0e0: 6765 5072 6f63 6573 732c 206e 6f74 6966  geProcess, notif
-0001e0f0: 6965 722c 2065 7874 656e 7369 6f6e 4865  ier, extensionHe
-0001e100: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-0001e110: 6561 6465 7273 290a 0a20 2020 2064 6566  eaders)..    def
-0001e120: 2064 6f77 6e6c 6f61 6446 696c 6528 7365   downloadFile(se
-0001e130: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-0001e140: 6f62 6a65 6374 4b65 792c 2064 6f77 6e6c  objectKey, downl
-0001e150: 6f61 6446 696c 653d 4e6f 6e65 2c20 7061  oadFile=None, pa
-0001e160: 7274 5369 7a65 3d35 202a 2031 3032 3420  rtSize=5 * 1024 
-0001e170: 2a20 3130 3234 2c20 7461 736b 4e75 6d3d  * 1024, taskNum=
-0001e180: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0001e190: 2020 2020 2020 2020 656e 6162 6c65 4368          enableCh
-0001e1a0: 6563 6b70 6f69 6e74 3d46 616c 7365 2c0a  eckpoint=False,.
-0001e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1c0: 2020 2020 2063 6865 636b 706f 696e 7446       checkpointF
-0001e1d0: 696c 653d 4e6f 6e65 2c20 6865 6164 6572  ile=None, header
-0001e1e0: 3d4e 6f6e 652c 2076 6572 7369 6f6e 4964  =None, versionId
-0001e1f0: 3d4e 6f6e 652c 2070 726f 6772 6573 7343  =None, progressC
-0001e200: 616c 6c62 6163 6b3d 4e6f 6e65 2c20 696d  allback=None, im
-0001e210: 6167 6550 726f 6365 7373 3d4e 6f6e 652c  ageProcess=None,
-0001e220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e230: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
-0001e240: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-0001e250: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001e260: 662e 5f64 6f77 6e6c 6f61 6446 696c 6557  f._downloadFileW
-0001e270: 6974 684e 6f74 6966 6965 7228 6275 636b  ithNotifier(buck
-0001e280: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-0001e290: 792c 2064 6f77 6e6c 6f61 6446 696c 652c  y, downloadFile,
-0001e2a0: 2070 6172 7453 697a 652c 2074 6173 6b4e   partSize, taskN
-0001e2b0: 756d 2c20 656e 6162 6c65 4368 6563 6b70  um, enableCheckp
-0001e2c0: 6f69 6e74 2c0a 2020 2020 2020 2020 2020  oint,.          
-0001e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2f0: 2020 2020 6368 6563 6b70 6f69 6e74 4669      checkpointFi
-0001e300: 6c65 2c20 6865 6164 6572 2c20 7665 7273  le, header, vers
-0001e310: 696f 6e49 642c 2070 726f 6772 6573 7343  ionId, progressC
-0001e320: 616c 6c62 6163 6b2c 2069 6d61 6765 5072  allback, imagePr
-0001e330: 6f63 6573 732c 0a20 2020 2020 2020 2020  ocess,.         
-0001e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e360: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
-0001e370: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-0001e380: 6561 6465 7273 290a 0a20 2020 2064 6566  eaders)..    def
-0001e390: 2064 6f77 6e6c 6f61 6446 696c 6573 2873   downloadFiles(s
-0001e3a0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-0001e3b0: 2070 7265 6669 782c 2064 6f77 6e6c 6f61   prefix, downloa
-0001e3c0: 6446 6f6c 6465 723d 4e6f 6e65 2c20 7461  dFolder=None, ta
-0001e3d0: 736b 4e75 6d3d 636f 6e73 742e 4445 4641  skNum=const.DEFA
-0001e3e0: 554c 545f 5441 534b 5f4e 554d 2c0a 2020  ULT_TASK_NUM,.  
-0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e400: 2020 2020 7461 736b 5175 6575 6553 697a      taskQueueSiz
-0001e410: 653d 636f 6e73 742e 4445 4641 554c 545f  e=const.DEFAULT_
-0001e420: 5441 534b 5f51 5545 5545 5f53 495a 452c  TASK_QUEUE_SIZE,
-0001e430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e440: 2020 2020 2020 2068 6561 6465 7273 3d4e         headers=N
-0001e450: 6f6e 652c 2069 6d61 6765 5072 6f63 6573  one, imageProces
-0001e460: 733d 4e6f 6e65 2c20 696e 7465 7276 616c  s=None, interval
-0001e470: 3d63 6f6e 7374 2e44 4546 4155 4c54 5f42  =const.DEFAULT_B
-0001e480: 5954 455f 494e 5454 4552 5641 4c2c 0a20  YTE_INTTERVAL,. 
-0001e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4a0: 2020 2020 2074 6173 6b43 616c 6c62 6163       taskCallbac
-0001e4b0: 6b3d 4e6f 6e65 2c20 7072 6f67 7265 7373  k=None, progress
-0001e4c0: 4361 6c6c 6261 636b 3d4e 6f6e 652c 0a20  Callback=None,. 
-0001e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4e0: 2020 2020 2074 6872 6573 686f 6c64 3d63       threshold=c
-0001e4f0: 6f6e 7374 2e44 4546 4155 4c54 5f4d 4158  onst.DEFAULT_MAX
-0001e500: 494d 554d 5f53 495a 452c 2070 6172 7453  IMUM_SIZE, partS
-0001e510: 697a 653d 3520 2a20 3130 3234 202a 2031  ize=5 * 1024 * 1
-0001e520: 3032 342c 2073 7562 5461 736b 4e75 6d3d  024, subTaskNum=
-0001e530: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0001e540: 2020 2020 2020 2020 2065 6e61 626c 6543           enableC
-0001e550: 6865 636b 706f 696e 743d 4661 6c73 652c  heckpoint=False,
-0001e560: 2063 6865 636b 706f 696e 7446 696c 653d   checkpointFile=
-0001e570: 4e6f 6e65 2c20 6578 7465 6e73 696f 6e48  None, extensionH
-0001e580: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-0001e590: 2020 2020 2020 6966 2068 6561 6465 7273        if headers
-0001e5a0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001e5b0: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
-0001e5c0: 4765 744f 626a 6563 7448 6561 6465 7228  GetObjectHeader(
-0001e5d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001e5e0: 205f 646f 776e 6c6f 6164 5f66 696c 6573   _download_files
-0001e5f0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-0001e600: 652c 2070 7265 6669 782c 2064 6f77 6e6c  e, prefix, downl
-0001e610: 6f61 6446 6f6c 6465 722c 2074 6173 6b4e  oadFolder, taskN
-0001e620: 756d 2c20 7461 736b 5175 6575 6553 697a  um, taskQueueSiz
-0001e630: 652c 2068 6561 6465 7273 2c20 696d 6167  e, headers, imag
-0001e640: 6550 726f 6365 7373 2c0a 2020 2020 2020  eProcess,.      
-0001e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e660: 2020 2020 2020 2020 2069 6e74 6572 7661           interva
-0001e670: 6c2c 2074 6173 6b43 616c 6c62 6163 6b2c  l, taskCallback,
-0001e680: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-0001e690: 6b2c 2074 6872 6573 686f 6c64 2c20 7061  k, threshold, pa
-0001e6a0: 7274 5369 7a65 2c20 7375 6254 6173 6b4e  rtSize, subTaskN
-0001e6b0: 756d 2c0a 2020 2020 2020 2020 2020 2020  um,.            
-0001e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6d0: 2020 2065 6e61 626c 6543 6865 636b 706f     enableCheckpo
-0001e6e0: 696e 742c 2063 6865 636b 706f 696e 7446  int, checkpointF
-0001e6f0: 696c 652c 2065 7874 656e 7369 6f6e 4865  ile, extensionHe
-0001e700: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-0001e710: 6561 6465 7273 290a 0a20 2020 2023 204f  eaders)..    # O
-0001e720: 4546 2069 6e74 6572 6661 6365 0a0a 2020  EF interface..  
-0001e730: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0001e740: 2064 6566 2073 6574 4275 636b 6574 4665   def setBucketFe
-0001e750: 7463 6850 6f6c 6963 7928 7365 6c66 2c20  tchPolicy(self, 
-0001e760: 6275 636b 6574 4e61 6d65 2c20 7374 6174  bucketName, stat
-0001e770: 7573 2c20 6167 656e 6379 2c20 6578 7465  us, agency, exte
-0001e780: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-0001e790: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
-0001e7a0: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
-0001e7b0: 6c28 7374 6174 7573 2c20 2273 7461 7475  l(status, "statu
-0001e7c0: 7320 6973 2065 6d70 7479 2229 0a20 2020  s is empty").   
-0001e7d0: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
-0001e7e0: 745f 6e6f 745f 6e75 6c6c 2861 6765 6e63  t_not_null(agenc
-0001e7f0: 792c 2022 6167 656e 6379 2069 7320 656d  y, "agency is em
-0001e800: 7074 7922 290a 2020 2020 2020 2020 6665  pty").        fe
-0001e810: 7463 6850 6f6c 6963 7920 3d20 4665 7463  tchPolicy = Fetc
-0001e820: 6850 6f6c 6963 7928 7374 6174 7573 2c20  hPolicy(status, 
-0001e830: 6167 656e 6379 290a 2020 2020 2020 2020  agency).        
-0001e840: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-0001e850: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
-0001e860: 636b 6574 4e61 6d65 2c20 636f 6e73 742e  cketName, const.
-0001e870: 4645 5443 485f 504f 4c49 4359 5f4b 4559  FETCH_POLICY_KEY
-0001e880: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-0001e890: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-0001e8a0: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
-0001e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8c0: 2020 2020 2020 2020 2020 202a 2a73 656c             **sel
-0001e8d0: 662e 636f 6e76 6572 746f 722e 7472 616e  f.convertor.tran
-0001e8e0: 735f 7365 745f 6275 636b 6574 5f66 6574  s_set_bucket_fet
-0001e8f0: 6368 5f70 6f6c 6963 7928 6665 7463 6850  ch_policy(fetchP
-0001e900: 6f6c 6963 7929 290a 0a20 2020 2040 6675  olicy))..    @fu
-0001e910: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-0001e920: 6765 7442 7563 6b65 7446 6574 6368 506f  getBucketFetchPo
-0001e930: 6c69 6379 2873 656c 662c 2062 7563 6b65  licy(self, bucke
-0001e940: 744e 616d 652c 2065 7874 656e 7369 6f6e  tName, extension
-0001e950: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
-0001e960: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
-0001e970: 207b 7365 6c66 2e68 612e 6f65 665f 6d61   {self.ha.oef_ma
-0001e980: 726b 6572 5f68 6561 6465 7228 293a 2022  rker_header(): "
-0001e990: 7965 7322 7d0a 2020 2020 2020 2020 7265  yes"}.        re
-0001e9a0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-0001e9b0: 6765 745f 7265 7175 6573 7428 6275 636b  get_request(buck
-0001e9c0: 6574 4e61 6d65 2c20 636f 6e73 742e 4645  etName, const.FE
-0001e9d0: 5443 485f 504f 4c49 4359 5f4b 4559 2c20  TCH_POLICY_KEY, 
-0001e9e0: 6d65 7468 6f64 4e61 6d65 3d22 6765 7442  methodName="getB
-0001e9f0: 7563 6b65 7446 6574 6368 506f 6c69 6379  ucketFetchPolicy
-0001ea00: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0001ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea20: 2020 2020 2020 2020 2068 6561 6465 7273           headers
-0001ea30: 3d68 6561 6465 7273 2c20 6578 7465 6e73  =headers, extens
-0001ea40: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0001ea50: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0001ea60: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0001ea70: 2064 6566 2064 656c 6574 6542 7563 6b65   def deleteBucke
-0001ea80: 7446 6574 6368 506f 6c69 6379 2873 656c  tFetchPolicy(sel
-0001ea90: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-0001eaa0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0001eab0: 4e6f 6e65 293a 0a20 2020 2020 2020 2068  None):.        h
-0001eac0: 6561 6465 7273 203d 207b 7365 6c66 2e68  eaders = {self.h
-0001ead0: 612e 6f65 665f 6d61 726b 6572 5f68 6561  a.oef_marker_hea
-0001eae0: 6465 7228 293a 2022 7965 7322 7d0a 2020  der(): "yes"}.  
-0001eaf0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001eb00: 662e 5f6d 616b 655f 6465 6c65 7465 5f72  f._make_delete_r
-0001eb10: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0001eb20: 652c 2063 6f6e 7374 2e46 4554 4348 5f50  e, const.FETCH_P
-0001eb30: 4f4c 4943 595f 4b45 592c 2068 6561 6465  OLICY_KEY, heade
-0001eb40: 7273 3d68 6561 6465 7273 2c0a 2020 2020  rs=headers,.    
-0001eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb70: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
-0001eb80: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-0001eb90: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
-0001eba0: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-0001ebb0: 7365 7442 7563 6b65 7446 6574 6368 4a6f  setBucketFetchJo
-0001ebc0: 6228 7365 6c66 2c20 6275 636b 6574 4e61  b(self, bucketNa
-0001ebd0: 6d65 2c20 7572 6c2c 2068 6f73 743d 4e6f  me, url, host=No
-0001ebe0: 6e65 2c20 6b65 793d 4e6f 6e65 2c20 6d64  ne, key=None, md
-0001ebf0: 353d 4e6f 6e65 2c20 6361 6c6c 4261 636b  5=None, callBack
-0001ec00: 5572 6c3d 4e6f 6e65 2c0a 2020 2020 2020  Url=None,.      
-0001ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec20: 2020 2020 6361 6c6c 4261 636b 426f 6479      callBackBody
-0001ec30: 3d4e 6f6e 652c 2063 616c 6c42 6163 6b42  =None, callBackB
-0001ec40: 6f64 7954 7970 653d 4e6f 6e65 2c20 6361  odyType=None, ca
-0001ec50: 6c6c 4261 636b 486f 7374 3d4e 6f6e 652c  llBackHost=None,
-0001ec60: 2066 696c 6554 7970 653d 4e6f 6e65 2c0a   fileType=None,.
-0001ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec80: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
-0001ec90: 5361 6d65 4b65 793d 4661 6c73 652c 206f  SameKey=False, o
-0001eca0: 626a 6563 7448 6561 6465 7273 3d4e 6f6e  bjectHeaders=Non
-0001ecb0: 652c 2065 7461 673d 4e6f 6e65 2c20 7472  e, etag=None, tr
-0001ecc0: 7573 744e 616d 653d 4e6f 6e65 2c20 6578  ustName=None, ex
-0001ecd0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-0001ece0: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
-0001ecf0: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
-0001ed00: 756c 6c28 7572 6c2c 2022 7572 6c20 6973  ull(url, "url is
-0001ed10: 2065 6d70 7479 2229 0a20 2020 2020 2020   empty").       
-0001ed20: 2066 6574 6368 4a6f 6220 3d20 5f46 6574   fetchJob = _Fet
-0001ed30: 6368 4a6f 6228 7572 6c3d 7572 6c2c 2068  chJob(url=url, h
-0001ed40: 6f73 743d 686f 7374 2c20 6275 636b 6574  ost=host, bucket
-0001ed50: 3d62 7563 6b65 744e 616d 652c 206b 6579  =bucketName, key
-0001ed60: 3d6b 6579 2c20 6d64 353d 6d64 352c 2063  =key, md5=md5, c
-0001ed70: 616c 6c42 6163 6b55 726c 3d63 616c 6c42  allBackUrl=callB
-0001ed80: 6163 6b55 726c 2c0a 2020 2020 2020 2020  ackUrl,.        
-0001ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eda0: 2020 2020 2063 616c 6c42 6163 6b42 6f64       callBackBod
-0001edb0: 793d 6361 6c6c 4261 636b 426f 6479 2c20  y=callBackBody, 
-0001edc0: 6361 6c6c 4261 636b 426f 6479 5479 7065  callBackBodyType
-0001edd0: 3d63 616c 6c42 6163 6b42 6f64 7954 7970  =callBackBodyTyp
-0001ede0: 652c 2063 616c 6c42 6163 6b48 6f73 743d  e, callBackHost=
-0001edf0: 6361 6c6c 4261 636b 486f 7374 2c0a 2020  callBackHost,.  
-0001ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee10: 2020 2020 2020 2020 2020 2066 696c 6554             fileT
-0001ee20: 7970 653d 6669 6c65 5479 7065 2c20 6967  ype=fileType, ig
-0001ee30: 6e6f 7265 5361 6d65 4b65 793d 6967 6e6f  noreSameKey=igno
-0001ee40: 7265 5361 6d65 4b65 792c 206f 626a 6563  reSameKey, objec
-0001ee50: 7448 6561 6465 7273 3d6f 626a 6563 7448  tHeaders=objectH
-0001ee60: 6561 6465 7273 2c20 6574 6167 3d65 7461  eaders, etag=eta
-0001ee70: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
-0001ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee90: 7472 7573 744e 616d 653d 7472 7573 744e  trustName=trustN
-0001eea0: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
-0001eeb0: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f70  urn self._make_p
-0001eec0: 6f73 745f 7265 7175 6573 7428 6275 636b  ost_request(buck
-0001eed0: 6574 4e61 6d65 2c20 636f 6e73 742e 4645  etName, const.FE
-0001eee0: 5443 485f 4a4f 425f 4b45 592c 206d 6574  TCH_JOB_KEY, met
-0001eef0: 686f 644e 616d 653d 2273 6574 4275 636b  hodName="setBuck
-0001ef00: 6574 4665 7463 684a 6f62 222c 0a20 2020  etFetchJob",.   
-0001ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef30: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
-0001ef40: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-0001ef50: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
-0001ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef70: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-0001ef80: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e74  self.convertor.t
-0001ef90: 7261 6e73 5f73 6574 5f62 7563 6b65 745f  rans_set_bucket_
-0001efa0: 6665 7463 685f 6a6f 6228 6665 7463 684a  fetch_job(fetchJ
-0001efb0: 6f62 2929 0a0a 2020 2020 4066 756e 6343  ob))..    @funcC
-0001efc0: 6163 6865 0a20 2020 2064 6566 2067 6574  ache.    def get
-0001efd0: 4275 636b 6574 4665 7463 684a 6f62 2873  BucketFetchJob(s
-0001efe0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-0001eff0: 206a 6f62 4964 2c20 6578 7465 6e73 696f   jobId, extensio
-0001f000: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-0001f010: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
-0001f020: 7365 7274 5f6e 6f74 5f6e 756c 6c28 6a6f  sert_not_null(jo
-0001f030: 6249 642c 2022 6a6f 6249 6420 6973 2065  bId, "jobId is e
-0001f040: 6d70 7479 2229 0a20 2020 2020 2020 2068  mpty").        h
-0001f050: 6561 6465 7273 203d 207b 7365 6c66 2e68  eaders = {self.h
-0001f060: 612e 6f65 665f 6d61 726b 6572 5f68 6561  a.oef_marker_hea
-0001f070: 6465 7228 293a 2022 7965 7322 7d0a 2020  der(): "yes"}.  
-0001f080: 2020 2020 2020 6b65 7920 3d20 636f 6e73        key = cons
-0001f090: 742e 4645 5443 485f 4a4f 425f 4b45 5920  t.FETCH_JOB_KEY 
-0001f0a0: 2b20 222f 2220 2b20 6a6f 6249 640a 2020  + "/" + jobId.  
-0001f0b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001f0c0: 662e 5f6d 616b 655f 6765 745f 7265 7175  f._make_get_requ
-0001f0d0: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-0001f0e0: 6b65 792c 206d 6574 686f 644e 616d 653d  key, methodName=
-0001f0f0: 2267 6574 4275 636b 6574 4665 7463 684a  "getBucketFetchJ
-0001f100: 6f62 222c 2068 6561 6465 7273 3d68 6561  ob", headers=hea
-0001f110: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
+0001ddb0: 7461 736b 4e75 6d3d 312c 2065 6e61 626c  taskNum=1, enabl
+0001ddc0: 6543 6865 636b 706f 696e 743d 4661 6c73  eCheckpoint=Fals
+0001ddd0: 652c 2063 6865 636b 706f 696e 7446 696c  e, checkpointFil
+0001dde0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+0001ddf0: 2020 2020 2020 2020 2020 2063 6865 636b             check
+0001de00: 5375 6d3d 4661 6c73 652c 206d 6574 6164  Sum=False, metad
+0001de10: 6174 613d 4e6f 6e65 2c20 7072 6f67 7265  ata=None, progre
+0001de20: 7373 4361 6c6c 6261 636b 3d4e 6f6e 652c  ssCallback=None,
+0001de30: 2068 6561 6465 7273 3d4e 6f6e 652c 0a20   headers=None,. 
+0001de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de50: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
+0001de60: 7273 3d4e 6f6e 652c 2065 6e63 6f64 696e  rs=None, encodin
+0001de70: 675f 7479 7065 3d4e 6f6e 6529 3a0a 2020  g_type=None):.  
+0001de80: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
+0001de90: 6c69 656e 742e 6c6f 6728 494e 464f 2c20  lient.log(INFO, 
+0001dea0: 2765 6e74 6572 2072 6573 756d 6520 7570  'enter resume up
+0001deb0: 6c6f 6164 2066 696c 652e 2e2e 2729 0a20  load file...'). 
+0001dec0: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
+0001ded0: 6572 745f 6e6f 745f 6e75 6c6c 2862 7563  ert_not_null(buc
+0001dee0: 6b65 744e 616d 652c 2027 6275 636b 6574  ketName, 'bucket
+0001def0: 4e61 6d65 2069 7320 656d 7074 7927 290a  Name is empty').
+0001df00: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
+0001df10: 7365 7274 5f6e 6f74 5f6e 756c 6c28 6f62  sert_not_null(ob
+0001df20: 6a65 6374 4b65 792c 2027 6f62 6a65 6374  jectKey, 'object
+0001df30: 4b65 7920 6973 2065 6d70 7479 2729 0a20  Key is empty'). 
+0001df40: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
+0001df50: 6572 745f 6e6f 745f 6e75 6c6c 2875 706c  ert_not_null(upl
+0001df60: 6f61 6446 696c 652c 2027 7570 6c6f 6164  oadFile, 'upload
+0001df70: 4669 6c65 2069 7320 656d 7074 7927 290a  File is empty').
+0001df80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001df90: 5f72 6573 756d 655f 7570 6c6f 6164 2862  _resume_upload(b
+0001dfa0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+0001dfb0: 744b 6579 2c20 7570 6c6f 6164 4669 6c65  tKey, uploadFile
+0001dfc0: 2c20 7061 7274 5369 7a65 2c20 7461 736b  , partSize, task
+0001dfd0: 4e75 6d2c 2065 6e61 626c 6543 6865 636b  Num, enableCheck
+0001dfe0: 706f 696e 742c 2063 6865 636b 706f 696e  point, checkpoin
+0001dff0: 7446 696c 652c 0a20 2020 2020 2020 2020  tFile,.         
+0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e010: 2020 2020 2063 6865 636b 5375 6d2c 206d       checkSum, m
+0001e020: 6574 6164 6174 612c 2070 726f 6772 6573  etadata, progres
+0001e030: 7343 616c 6c62 6163 6b2c 2073 656c 662c  sCallback, self,
+0001e040: 2068 6561 6465 7273 2c0a 2020 2020 2020   headers,.      
+0001e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e060: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
+0001e070: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+0001e080: 6f6e 4865 6164 6572 732c 2065 6e63 6f64  onHeaders, encod
+0001e090: 696e 675f 7479 7065 3d65 6e63 6f64 696e  ing_type=encodin
+0001e0a0: 675f 7479 7065 290a 0a20 2020 2040 6675  g_type)..    @fu
+0001e0b0: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+0001e0c0: 5f64 6f77 6e6c 6f61 6446 696c 6557 6974  _downloadFileWit
+0001e0d0: 684e 6f74 6966 6965 7228 7365 6c66 2c20  hNotifier(self, 
+0001e0e0: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
+0001e0f0: 6374 4b65 792c 2064 6f77 6e6c 6f61 6446  ctKey, downloadF
+0001e100: 696c 653d 4e6f 6e65 2c20 7061 7274 5369  ile=None, partSi
+0001e110: 7a65 3d35 202a 2031 3032 3420 2a20 3130  ze=5 * 1024 * 10
+0001e120: 3234 2c20 7461 736b 4e75 6d3d 312c 0a20  24, taskNum=1,. 
+0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e150: 2065 6e61 626c 6543 6865 636b 706f 696e   enableCheckpoin
+0001e160: 743d 4661 6c73 652c 0a20 2020 2020 2020  t=False,.       
+0001e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e180: 2020 2020 2020 2020 2020 2063 6865 636b             check
+0001e190: 706f 696e 7446 696c 653d 4e6f 6e65 2c20  pointFile=None, 
+0001e1a0: 6865 6164 6572 3d4e 6f6e 652c 2076 6572  header=None, ver
+0001e1b0: 7369 6f6e 4964 3d4e 6f6e 652c 2070 726f  sionId=None, pro
+0001e1c0: 6772 6573 7343 616c 6c62 6163 6b3d 4e6f  gressCallback=No
+0001e1d0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1f0: 2020 2020 2020 696d 6167 6550 726f 6365        imageProce
+0001e200: 7373 3d4e 6f6e 652c 206e 6f74 6966 6965  ss=None, notifie
+0001e210: 723d 7072 6f67 7265 7373 2e4e 4f4e 455f  r=progress.NONE_
+0001e220: 4e4f 5449 4649 4552 2c20 6578 7465 6e73  NOTIFIER, extens
+0001e230: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+0001e240: 3a0a 2020 2020 2020 2020 7365 6c66 2e6c  :.        self.l
+0001e250: 6f67 5f63 6c69 656e 742e 6c6f 6728 494e  og_client.log(IN
+0001e260: 464f 2c20 2765 6e74 6572 2072 6573 756d  FO, 'enter resum
+0001e270: 6520 646f 776e 6c6f 6164 2e2e 2e27 290a  e download...').
+0001e280: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
+0001e290: 7365 7274 5f6e 6f74 5f6e 756c 6c28 6275  sert_not_null(bu
+0001e2a0: 636b 6574 4e61 6d65 2c20 2762 7563 6b65  cketName, 'bucke
+0001e2b0: 744e 616d 6520 6973 2065 6d70 7479 2729  tName is empty')
+0001e2c0: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
+0001e2d0: 7373 6572 745f 6e6f 745f 6e75 6c6c 286f  ssert_not_null(o
+0001e2e0: 626a 6563 744b 6579 2c20 276f 626a 6563  bjectKey, 'objec
+0001e2f0: 744b 6579 2069 7320 656d 7074 7927 290a  tKey is empty').
+0001e300: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
+0001e310: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
+0001e320: 2020 2020 2020 2068 6561 6465 7220 3d20         header = 
+0001e330: 4765 744f 626a 6563 7448 6561 6465 7228  GetObjectHeader(
+0001e340: 290a 2020 2020 2020 2020 6966 2064 6f77  ).        if dow
+0001e350: 6e6c 6f61 6446 696c 6520 6973 204e 6f6e  nloadFile is Non
+0001e360: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+0001e370: 6f77 6e6c 6f61 6446 696c 6520 3d20 6f62  ownloadFile = ob
+0001e380: 6a65 6374 4b65 790a 0a20 2020 2020 2020  jectKey..       
+0001e390: 2072 6574 7572 6e20 5f72 6573 756d 655f   return _resume_
+0001e3a0: 646f 776e 6c6f 6164 2862 7563 6b65 744e  download(bucketN
+0001e3b0: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+0001e3c0: 646f 776e 6c6f 6164 4669 6c65 2c20 7061  downloadFile, pa
+0001e3d0: 7274 5369 7a65 2c20 7461 736b 4e75 6d2c  rtSize, taskNum,
+0001e3e0: 2065 6e61 626c 6543 6865 636b 706f 696e   enableCheckpoin
+0001e3f0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0001e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e410: 2020 2063 6865 636b 706f 696e 7446 696c     checkpointFil
+0001e420: 652c 2068 6561 6465 722c 2076 6572 7369  e, header, versi
+0001e430: 6f6e 4964 2c20 7072 6f67 7265 7373 4361  onId, progressCa
+0001e440: 6c6c 6261 636b 2c20 7365 6c66 2c0a 2020  llback, self,.  
+0001e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e460: 2020 2020 2020 2020 2020 2020 2020 696d                im
+0001e470: 6167 6550 726f 6365 7373 2c20 6e6f 7469  ageProcess, noti
+0001e480: 6669 6572 2c20 6578 7465 6e73 696f 6e48  fier, extensionH
+0001e490: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0001e4a0: 4865 6164 6572 7329 0a0a 2020 2020 6465  Headers)..    de
+0001e4b0: 6620 646f 776e 6c6f 6164 4669 6c65 2873  f downloadFile(s
+0001e4c0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+0001e4d0: 206f 626a 6563 744b 6579 2c20 646f 776e   objectKey, down
+0001e4e0: 6c6f 6164 4669 6c65 3d4e 6f6e 652c 2070  loadFile=None, p
+0001e4f0: 6172 7453 697a 653d 3520 2a20 3130 3234  artSize=5 * 1024
+0001e500: 202a 2031 3032 342c 2074 6173 6b4e 756d   * 1024, taskNum
+0001e510: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
+0001e520: 2020 2020 2020 2020 2065 6e61 626c 6543           enableC
+0001e530: 6865 636b 706f 696e 743d 4661 6c73 652c  heckpoint=False,
+0001e540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e550: 2020 2020 2020 6368 6563 6b70 6f69 6e74        checkpoint
+0001e560: 4669 6c65 3d4e 6f6e 652c 2068 6561 6465  File=None, heade
+0001e570: 723d 4e6f 6e65 2c20 7665 7273 696f 6e49  r=None, versionI
+0001e580: 643d 4e6f 6e65 2c20 7072 6f67 7265 7373  d=None, progress
+0001e590: 4361 6c6c 6261 636b 3d4e 6f6e 652c 2069  Callback=None, i
+0001e5a0: 6d61 6765 5072 6f63 6573 733d 4e6f 6e65  mageProcess=None
+0001e5b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e5c0: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
+0001e5d0: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
+0001e5e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001e5f0: 6c66 2e5f 646f 776e 6c6f 6164 4669 6c65  lf._downloadFile
+0001e600: 5769 7468 4e6f 7469 6669 6572 2862 7563  WithNotifier(buc
+0001e610: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+0001e620: 6579 2c20 646f 776e 6c6f 6164 4669 6c65  ey, downloadFile
+0001e630: 2c20 7061 7274 5369 7a65 2c20 7461 736b  , partSize, task
+0001e640: 4e75 6d2c 2065 6e61 626c 6543 6865 636b  Num, enableCheck
+0001e650: 706f 696e 742c 0a20 2020 2020 2020 2020  point,.         
+0001e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e680: 2020 2020 2063 6865 636b 706f 696e 7446       checkpointF
+0001e690: 696c 652c 2068 6561 6465 722c 2076 6572  ile, header, ver
+0001e6a0: 7369 6f6e 4964 2c20 7072 6f67 7265 7373  sionId, progress
+0001e6b0: 4361 6c6c 6261 636b 2c20 696d 6167 6550  Callback, imageP
+0001e6c0: 726f 6365 7373 2c0a 2020 2020 2020 2020  rocess,.        
+0001e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6f0: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
+0001e700: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0001e710: 4865 6164 6572 7329 0a0a 2020 2020 6465  Headers)..    de
+0001e720: 6620 646f 776e 6c6f 6164 4669 6c65 7328  f downloadFiles(
+0001e730: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0001e740: 2c20 7072 6566 6978 2c20 646f 776e 6c6f  , prefix, downlo
+0001e750: 6164 466f 6c64 6572 3d4e 6f6e 652c 2074  adFolder=None, t
+0001e760: 6173 6b4e 756d 3d63 6f6e 7374 2e44 4546  askNum=const.DEF
+0001e770: 4155 4c54 5f54 4153 4b5f 4e55 4d2c 0a20  AULT_TASK_NUM,. 
+0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e790: 2020 2020 2074 6173 6b51 7565 7565 5369       taskQueueSi
+0001e7a0: 7a65 3d63 6f6e 7374 2e44 4546 4155 4c54  ze=const.DEFAULT
+0001e7b0: 5f54 4153 4b5f 5155 4555 455f 5349 5a45  _TASK_QUEUE_SIZE
+0001e7c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e7d0: 2020 2020 2020 2020 6865 6164 6572 733d          headers=
+0001e7e0: 4e6f 6e65 2c20 696d 6167 6550 726f 6365  None, imageProce
+0001e7f0: 7373 3d4e 6f6e 652c 2069 6e74 6572 7661  ss=None, interva
+0001e800: 6c3d 636f 6e73 742e 4445 4641 554c 545f  l=const.DEFAULT_
+0001e810: 4259 5445 5f49 4e54 5445 5256 414c 2c0a  BYTE_INTTERVAL,.
+0001e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e830: 2020 2020 2020 7461 736b 4361 6c6c 6261        taskCallba
+0001e840: 636b 3d4e 6f6e 652c 2070 726f 6772 6573  ck=None, progres
+0001e850: 7343 616c 6c62 6163 6b3d 4e6f 6e65 2c0a  sCallback=None,.
+0001e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e870: 2020 2020 2020 7468 7265 7368 6f6c 643d        threshold=
+0001e880: 636f 6e73 742e 4445 4641 554c 545f 4d41  const.DEFAULT_MA
+0001e890: 5849 4d55 4d5f 5349 5a45 2c20 7061 7274  XIMUM_SIZE, part
+0001e8a0: 5369 7a65 3d35 202a 2031 3032 3420 2a20  Size=5 * 1024 * 
+0001e8b0: 3130 3234 2c20 7375 6254 6173 6b4e 756d  1024, subTaskNum
+0001e8c0: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
+0001e8d0: 2020 2020 2020 2020 2020 656e 6162 6c65            enable
+0001e8e0: 4368 6563 6b70 6f69 6e74 3d46 616c 7365  Checkpoint=False
+0001e8f0: 2c20 6368 6563 6b70 6f69 6e74 4669 6c65  , checkpointFile
+0001e900: 3d4e 6f6e 652c 2065 7874 656e 7369 6f6e  =None, extension
+0001e910: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
+0001e920: 2020 2020 2020 2069 6620 6865 6164 6572         if header
+0001e930: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+0001e940: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
+0001e950: 2047 6574 4f62 6a65 6374 4865 6164 6572   GetObjectHeader
+0001e960: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+0001e970: 6e20 5f64 6f77 6e6c 6f61 645f 6669 6c65  n _download_file
+0001e980: 7328 7365 6c66 2c20 6275 636b 6574 4e61  s(self, bucketNa
+0001e990: 6d65 2c20 7072 6566 6978 2c20 646f 776e  me, prefix, down
+0001e9a0: 6c6f 6164 466f 6c64 6572 2c20 7461 736b  loadFolder, task
+0001e9b0: 4e75 6d2c 2074 6173 6b51 7565 7565 5369  Num, taskQueueSi
+0001e9c0: 7a65 2c20 6865 6164 6572 732c 2069 6d61  ze, headers, ima
+0001e9d0: 6765 5072 6f63 6573 732c 0a20 2020 2020  geProcess,.     
+0001e9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9f0: 2020 2020 2020 2020 2020 696e 7465 7276            interv
+0001ea00: 616c 2c20 7461 736b 4361 6c6c 6261 636b  al, taskCallback
+0001ea10: 2c20 7072 6f67 7265 7373 4361 6c6c 6261  , progressCallba
+0001ea20: 636b 2c20 7468 7265 7368 6f6c 642c 2070  ck, threshold, p
+0001ea30: 6172 7453 697a 652c 2073 7562 5461 736b  artSize, subTask
+0001ea40: 4e75 6d2c 0a20 2020 2020 2020 2020 2020  Num,.           
+0001ea50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea60: 2020 2020 656e 6162 6c65 4368 6563 6b70      enableCheckp
+0001ea70: 6f69 6e74 2c20 6368 6563 6b70 6f69 6e74  oint, checkpoint
+0001ea80: 4669 6c65 2c20 6578 7465 6e73 696f 6e48  File, extensionH
+0001ea90: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0001eaa0: 4865 6164 6572 7329 0a0a 2020 2020 2320  Headers)..    # 
+0001eab0: 4f45 4620 696e 7465 7266 6163 650a 0a20  OEF interface.. 
+0001eac0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+0001ead0: 2020 6465 6620 7365 7442 7563 6b65 7446    def setBucketF
+0001eae0: 6574 6368 506f 6c69 6379 2873 656c 662c  etchPolicy(self,
+0001eaf0: 2062 7563 6b65 744e 616d 652c 2073 7461   bucketName, sta
+0001eb00: 7475 732c 2061 6765 6e63 792c 2065 7874  tus, agency, ext
+0001eb10: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+0001eb20: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
+0001eb30: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
+0001eb40: 6c6c 2873 7461 7475 732c 2022 7374 6174  ll(status, "stat
+0001eb50: 7573 2069 7320 656d 7074 7922 290a 2020  us is empty").  
+0001eb60: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
+0001eb70: 7274 5f6e 6f74 5f6e 756c 6c28 6167 656e  rt_not_null(agen
+0001eb80: 6379 2c20 2261 6765 6e63 7920 6973 2065  cy, "agency is e
+0001eb90: 6d70 7479 2229 0a20 2020 2020 2020 2066  mpty").        f
+0001eba0: 6574 6368 506f 6c69 6379 203d 2046 6574  etchPolicy = Fet
+0001ebb0: 6368 506f 6c69 6379 2873 7461 7475 732c  chPolicy(status,
+0001ebc0: 2061 6765 6e63 7929 0a20 2020 2020 2020   agency).       
+0001ebd0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+0001ebe0: 6b65 5f70 7574 5f72 6571 7565 7374 2862  ke_put_request(b
+0001ebf0: 7563 6b65 744e 616d 652c 2063 6f6e 7374  ucketName, const
+0001ec00: 2e46 4554 4348 5f50 4f4c 4943 595f 4b45  .FETCH_POLICY_KE
+0001ec10: 592c 2065 7874 656e 7369 6f6e 4865 6164  Y, extensionHead
+0001ec20: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+0001ec30: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
+0001ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec50: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
+0001ec60: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
+0001ec70: 6e73 5f73 6574 5f62 7563 6b65 745f 6665  ns_set_bucket_fe
+0001ec80: 7463 685f 706f 6c69 6379 2866 6574 6368  tch_policy(fetch
+0001ec90: 506f 6c69 6379 2929 0a0a 2020 2020 4066  Policy))..    @f
+0001eca0: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+0001ecb0: 2067 6574 4275 636b 6574 4665 7463 6850   getBucketFetchP
+0001ecc0: 6f6c 6963 7928 7365 6c66 2c20 6275 636b  olicy(self, buck
+0001ecd0: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
+0001ece0: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
+0001ecf0: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
+0001ed00: 3d20 7b73 656c 662e 6861 2e6f 6566 5f6d  = {self.ha.oef_m
+0001ed10: 6172 6b65 725f 6865 6164 6572 2829 3a20  arker_header(): 
+0001ed20: 2279 6573 227d 0a20 2020 2020 2020 2072  "yes"}.        r
+0001ed30: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+0001ed40: 5f67 6574 5f72 6571 7565 7374 2862 7563  _get_request(buc
+0001ed50: 6b65 744e 616d 652c 2063 6f6e 7374 2e46  ketName, const.F
+0001ed60: 4554 4348 5f50 4f4c 4943 595f 4b45 592c  ETCH_POLICY_KEY,
+0001ed70: 206d 6574 686f 644e 616d 653d 2267 6574   methodName="get
+0001ed80: 4275 636b 6574 4665 7463 6850 6f6c 6963  BucketFetchPolic
+0001ed90: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
+0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edb0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+0001edc0: 733d 6865 6164 6572 732c 2065 7874 656e  s=headers, exten
+0001edd0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+0001ede0: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
+0001edf0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+0001ee00: 2020 6465 6620 6465 6c65 7465 4275 636b    def deleteBuck
+0001ee10: 6574 4665 7463 6850 6f6c 6963 7928 7365  etFetchPolicy(se
+0001ee20: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
+0001ee30: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0001ee40: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0001ee50: 6865 6164 6572 7320 3d20 7b73 656c 662e  headers = {self.
+0001ee60: 6861 2e6f 6566 5f6d 6172 6b65 725f 6865  ha.oef_marker_he
+0001ee70: 6164 6572 2829 3a20 2279 6573 227d 0a20  ader(): "yes"}. 
+0001ee80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001ee90: 6c66 2e5f 6d61 6b65 5f64 656c 6574 655f  lf._make_delete_
+0001eea0: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+0001eeb0: 6d65 2c20 636f 6e73 742e 4645 5443 485f  me, const.FETCH_
+0001eec0: 504f 4c49 4359 5f4b 4559 2c20 6865 6164  POLICY_KEY, head
+0001eed0: 6572 733d 6865 6164 6572 732c 0a20 2020  ers=headers,.   
+0001eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef00: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
+0001ef10: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0001ef20: 4865 6164 6572 7329 0a0a 2020 2020 4066  Headers)..    @f
+0001ef30: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+0001ef40: 2073 6574 4275 636b 6574 4665 7463 684a   setBucketFetchJ
+0001ef50: 6f62 2873 656c 662c 2062 7563 6b65 744e  ob(self, bucketN
+0001ef60: 616d 652c 2075 726c 2c20 686f 7374 3d4e  ame, url, host=N
+0001ef70: 6f6e 652c 206b 6579 3d4e 6f6e 652c 206d  one, key=None, m
+0001ef80: 6435 3d4e 6f6e 652c 2063 616c 6c42 6163  d5=None, callBac
+0001ef90: 6b55 726c 3d4e 6f6e 652c 0a20 2020 2020  kUrl=None,.     
+0001efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efb0: 2020 2020 2063 616c 6c42 6163 6b42 6f64       callBackBod
+0001efc0: 793d 4e6f 6e65 2c20 6361 6c6c 4261 636b  y=None, callBack
+0001efd0: 426f 6479 5479 7065 3d4e 6f6e 652c 2063  BodyType=None, c
+0001efe0: 616c 6c42 6163 6b48 6f73 743d 4e6f 6e65  allBackHost=None
+0001eff0: 2c20 6669 6c65 5479 7065 3d4e 6f6e 652c  , fileType=None,
+0001f000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f010: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
+0001f020: 6553 616d 654b 6579 3d46 616c 7365 2c20  eSameKey=False, 
+0001f030: 6f62 6a65 6374 4865 6164 6572 733d 4e6f  objectHeaders=No
+0001f040: 6e65 2c20 6574 6167 3d4e 6f6e 652c 2074  ne, etag=None, t
+0001f050: 7275 7374 4e61 6d65 3d4e 6f6e 652c 2065  rustName=None, e
+0001f060: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0001f070: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
+0001f080: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
+0001f090: 6e75 6c6c 2875 726c 2c20 2275 726c 2069  null(url, "url i
+0001f0a0: 7320 656d 7074 7922 290a 2020 2020 2020  s empty").      
+0001f0b0: 2020 6665 7463 684a 6f62 203d 205f 4665    fetchJob = _Fe
+0001f0c0: 7463 684a 6f62 2875 726c 3d75 726c 2c20  tchJob(url=url, 
+0001f0d0: 686f 7374 3d68 6f73 742c 2062 7563 6b65  host=host, bucke
+0001f0e0: 743d 6275 636b 6574 4e61 6d65 2c20 6b65  t=bucketName, ke
+0001f0f0: 793d 6b65 792c 206d 6435 3d6d 6435 2c20  y=key, md5=md5, 
+0001f100: 6361 6c6c 4261 636b 5572 6c3d 6361 6c6c  callBackUrl=call
+0001f110: 4261 636b 5572 6c2c 0a20 2020 2020 2020  BackUrl,.       
 0001f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f130: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-0001f140: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
-0001f150: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
-0001f160: 0a4f 6273 436c 6965 6e74 2e73 6574 4275  .ObsClient.setBu
-0001f170: 636b 6574 5665 7273 696f 6e69 6e67 436f  cketVersioningCo
-0001f180: 6e66 6967 7572 6174 696f 6e20 3d20 4f62  nfiguration = Ob
-0001f190: 7343 6c69 656e 742e 7365 7442 7563 6b65  sClient.setBucke
-0001f1a0: 7456 6572 7369 6f6e 696e 670a 4f62 7343  tVersioning.ObsC
-0001f1b0: 6c69 656e 742e 6765 7442 7563 6b65 7456  lient.getBucketV
-0001f1c0: 6572 7369 6f6e 696e 6743 6f6e 6669 6775  ersioningConfigu
-0001f1d0: 7261 7469 6f6e 203d 204f 6273 436c 6965  ration = ObsClie
-0001f1e0: 6e74 2e67 6574 4275 636b 6574 5665 7273  nt.getBucketVers
-0001f1f0: 696f 6e69 6e67 0a4f 6273 436c 6965 6e74  ioning.ObsClient
-0001f200: 2e64 656c 6574 6542 7563 6b65 744c 6966  .deleteBucketLif
-0001f210: 6563 7963 6c65 436f 6e66 6967 7572 6174  ecycleConfigurat
-0001f220: 696f 6e20 3d20 4f62 7343 6c69 656e 742e  ion = ObsClient.
-0001f230: 6465 6c65 7465 4275 636b 6574 4c69 6665  deleteBucketLife
-0001f240: 6379 636c 650a 4f62 7343 6c69 656e 742e  cycle.ObsClient.
-0001f250: 7365 7442 7563 6b65 744c 6966 6563 7963  setBucketLifecyc
-0001f260: 6c65 436f 6e66 6967 7572 6174 696f 6e20  leConfiguration 
-0001f270: 3d20 4f62 7343 6c69 656e 742e 7365 7442  = ObsClient.setB
-0001f280: 7563 6b65 744c 6966 6563 7963 6c65 0a4f  ucketLifecycle.O
-0001f290: 6273 436c 6965 6e74 2e67 6574 4275 636b  bsClient.getBuck
-0001f2a0: 6574 4c69 6665 6379 636c 6543 6f6e 6669  etLifecycleConfi
-0001f2b0: 6775 7261 7469 6f6e 203d 204f 6273 436c  guration = ObsCl
-0001f2c0: 6965 6e74 2e67 6574 4275 636b 6574 4c69  ient.getBucketLi
-0001f2d0: 6665 6379 636c 650a 4f62 7343 6c69 656e  fecycle.ObsClien
-0001f2e0: 742e 6765 7442 7563 6b65 7457 6562 7369  t.getBucketWebsi
-0001f2f0: 7465 436f 6e66 6967 7572 6174 696f 6e20  teConfiguration 
-0001f300: 3d20 4f62 7343 6c69 656e 742e 6765 7442  = ObsClient.getB
-0001f310: 7563 6b65 7457 6562 7369 7465 0a4f 6273  ucketWebsite.Obs
-0001f320: 436c 6965 6e74 2e73 6574 4275 636b 6574  Client.setBucket
-0001f330: 5765 6273 6974 6543 6f6e 6669 6775 7261  WebsiteConfigura
-0001f340: 7469 6f6e 203d 204f 6273 436c 6965 6e74  tion = ObsClient
-0001f350: 2e73 6574 4275 636b 6574 5765 6273 6974  .setBucketWebsit
-0001f360: 650a 4f62 7343 6c69 656e 742e 6465 6c65  e.ObsClient.dele
-0001f370: 7465 4275 636b 6574 5765 6273 6974 6543  teBucketWebsiteC
-0001f380: 6f6e 6669 6775 7261 7469 6f6e 203d 204f  onfiguration = O
-0001f390: 6273 436c 6965 6e74 2e64 656c 6574 6542  bsClient.deleteB
-0001f3a0: 7563 6b65 7457 6562 7369 7465 0a4f 6273  ucketWebsite.Obs
-0001f3b0: 436c 6965 6e74 2e73 6574 4275 636b 6574  Client.setBucket
-0001f3c0: 4c6f 6767 696e 6743 6f6e 6669 6775 7261  LoggingConfigura
-0001f3d0: 7469 6f6e 203d 204f 6273 436c 6965 6e74  tion = ObsClient
-0001f3e0: 2e73 6574 4275 636b 6574 4c6f 6767 696e  .setBucketLoggin
-0001f3f0: 670a 4f62 7343 6c69 656e 742e 6765 7442  g.ObsClient.getB
-0001f400: 7563 6b65 744c 6f67 6769 6e67 436f 6e66  ucketLoggingConf
-0001f410: 6967 7572 6174 696f 6e20 3d20 4f62 7343  iguration = ObsC
-0001f420: 6c69 656e 742e 6765 7442 7563 6b65 744c  lient.getBucketL
-0001f430: 6f67 6769 6e67 0a                        ogging.
+0001f130: 2020 2020 2020 6361 6c6c 4261 636b 426f        callBackBo
+0001f140: 6479 3d63 616c 6c42 6163 6b42 6f64 792c  dy=callBackBody,
+0001f150: 2063 616c 6c42 6163 6b42 6f64 7954 7970   callBackBodyTyp
+0001f160: 653d 6361 6c6c 4261 636b 426f 6479 5479  e=callBackBodyTy
+0001f170: 7065 2c20 6361 6c6c 4261 636b 486f 7374  pe, callBackHost
+0001f180: 3d63 616c 6c42 6163 6b48 6f73 742c 0a20  =callBackHost,. 
+0001f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1a0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0001f1b0: 5479 7065 3d66 696c 6554 7970 652c 2069  Type=fileType, i
+0001f1c0: 676e 6f72 6553 616d 654b 6579 3d69 676e  gnoreSameKey=ign
+0001f1d0: 6f72 6553 616d 654b 6579 2c20 6f62 6a65  oreSameKey, obje
+0001f1e0: 6374 4865 6164 6572 733d 6f62 6a65 6374  ctHeaders=object
+0001f1f0: 4865 6164 6572 732c 2065 7461 673d 6574  Headers, etag=et
+0001f200: 6167 2c0a 2020 2020 2020 2020 2020 2020  ag,.            
+0001f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f220: 2074 7275 7374 4e61 6d65 3d74 7275 7374   trustName=trust
+0001f230: 4e61 6d65 290a 2020 2020 2020 2020 7265  Name).        re
+0001f240: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+0001f250: 706f 7374 5f72 6571 7565 7374 2862 7563  post_request(buc
+0001f260: 6b65 744e 616d 652c 2063 6f6e 7374 2e46  ketName, const.F
+0001f270: 4554 4348 5f4a 4f42 5f4b 4559 2c20 6d65  ETCH_JOB_KEY, me
+0001f280: 7468 6f64 4e61 6d65 3d22 7365 7442 7563  thodName="setBuc
+0001f290: 6b65 7446 6574 6368 4a6f 6222 2c0a 2020  ketFetchJob",.  
+0001f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2c0: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+0001f2d0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+0001f2e0: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
+0001f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f300: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0001f310: 2a73 656c 662e 636f 6e76 6572 746f 722e  *self.convertor.
+0001f320: 7472 616e 735f 7365 745f 6275 636b 6574  trans_set_bucket
+0001f330: 5f66 6574 6368 5f6a 6f62 2866 6574 6368  _fetch_job(fetch
+0001f340: 4a6f 6229 290a 0a20 2020 2040 6675 6e63  Job))..    @func
+0001f350: 4361 6368 650a 2020 2020 6465 6620 6765  Cache.    def ge
+0001f360: 7442 7563 6b65 7446 6574 6368 4a6f 6228  tBucketFetchJob(
+0001f370: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0001f380: 2c20 6a6f 6249 642c 2065 7874 656e 7369  , jobId, extensi
+0001f390: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
+0001f3a0: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
+0001f3b0: 7373 6572 745f 6e6f 745f 6e75 6c6c 286a  ssert_not_null(j
+0001f3c0: 6f62 4964 2c20 226a 6f62 4964 2069 7320  obId, "jobId is 
+0001f3d0: 656d 7074 7922 290a 2020 2020 2020 2020  empty").        
+0001f3e0: 6865 6164 6572 7320 3d20 7b73 656c 662e  headers = {self.
+0001f3f0: 6861 2e6f 6566 5f6d 6172 6b65 725f 6865  ha.oef_marker_he
+0001f400: 6164 6572 2829 3a20 2279 6573 227d 0a20  ader(): "yes"}. 
+0001f410: 2020 2020 2020 206b 6579 203d 2063 6f6e         key = con
+0001f420: 7374 2e46 4554 4348 5f4a 4f42 5f4b 4559  st.FETCH_JOB_KEY
+0001f430: 202b 2022 2f22 202b 206a 6f62 4964 0a20   + "/" + jobId. 
+0001f440: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001f450: 6c66 2e5f 6d61 6b65 5f67 6574 5f72 6571  lf._make_get_req
+0001f460: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+0001f470: 206b 6579 2c20 6d65 7468 6f64 4e61 6d65   key, methodName
+0001f480: 3d22 6765 7442 7563 6b65 7446 6574 6368  ="getBucketFetch
+0001f490: 4a6f 6222 2c20 6865 6164 6572 733d 6865  Job", headers=he
+0001f4a0: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
+0001f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4c0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+0001f4d0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+0001f4e0: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+0001f4f0: 0a0a 4f62 7343 6c69 656e 742e 7365 7442  ..ObsClient.setB
+0001f500: 7563 6b65 7456 6572 7369 6f6e 696e 6743  ucketVersioningC
+0001f510: 6f6e 6669 6775 7261 7469 6f6e 203d 204f  onfiguration = O
+0001f520: 6273 436c 6965 6e74 2e73 6574 4275 636b  bsClient.setBuck
+0001f530: 6574 5665 7273 696f 6e69 6e67 0a4f 6273  etVersioning.Obs
+0001f540: 436c 6965 6e74 2e67 6574 4275 636b 6574  Client.getBucket
+0001f550: 5665 7273 696f 6e69 6e67 436f 6e66 6967  VersioningConfig
+0001f560: 7572 6174 696f 6e20 3d20 4f62 7343 6c69  uration = ObsCli
+0001f570: 656e 742e 6765 7442 7563 6b65 7456 6572  ent.getBucketVer
+0001f580: 7369 6f6e 696e 670a 4f62 7343 6c69 656e  sioning.ObsClien
+0001f590: 742e 6465 6c65 7465 4275 636b 6574 4c69  t.deleteBucketLi
+0001f5a0: 6665 6379 636c 6543 6f6e 6669 6775 7261  fecycleConfigura
+0001f5b0: 7469 6f6e 203d 204f 6273 436c 6965 6e74  tion = ObsClient
+0001f5c0: 2e64 656c 6574 6542 7563 6b65 744c 6966  .deleteBucketLif
+0001f5d0: 6563 7963 6c65 0a4f 6273 436c 6965 6e74  ecycle.ObsClient
+0001f5e0: 2e73 6574 4275 636b 6574 4c69 6665 6379  .setBucketLifecy
+0001f5f0: 636c 6543 6f6e 6669 6775 7261 7469 6f6e  cleConfiguration
+0001f600: 203d 204f 6273 436c 6965 6e74 2e73 6574   = ObsClient.set
+0001f610: 4275 636b 6574 4c69 6665 6379 636c 650a  BucketLifecycle.
+0001f620: 4f62 7343 6c69 656e 742e 6765 7442 7563  ObsClient.getBuc
+0001f630: 6b65 744c 6966 6563 7963 6c65 436f 6e66  ketLifecycleConf
+0001f640: 6967 7572 6174 696f 6e20 3d20 4f62 7343  iguration = ObsC
+0001f650: 6c69 656e 742e 6765 7442 7563 6b65 744c  lient.getBucketL
+0001f660: 6966 6563 7963 6c65 0a4f 6273 436c 6965  ifecycle.ObsClie
+0001f670: 6e74 2e67 6574 4275 636b 6574 5765 6273  nt.getBucketWebs
+0001f680: 6974 6543 6f6e 6669 6775 7261 7469 6f6e  iteConfiguration
+0001f690: 203d 204f 6273 436c 6965 6e74 2e67 6574   = ObsClient.get
+0001f6a0: 4275 636b 6574 5765 6273 6974 650a 4f62  BucketWebsite.Ob
+0001f6b0: 7343 6c69 656e 742e 7365 7442 7563 6b65  sClient.setBucke
+0001f6c0: 7457 6562 7369 7465 436f 6e66 6967 7572  tWebsiteConfigur
+0001f6d0: 6174 696f 6e20 3d20 4f62 7343 6c69 656e  ation = ObsClien
+0001f6e0: 742e 7365 7442 7563 6b65 7457 6562 7369  t.setBucketWebsi
+0001f6f0: 7465 0a4f 6273 436c 6965 6e74 2e64 656c  te.ObsClient.del
+0001f700: 6574 6542 7563 6b65 7457 6562 7369 7465  eteBucketWebsite
+0001f710: 436f 6e66 6967 7572 6174 696f 6e20 3d20  Configuration = 
+0001f720: 4f62 7343 6c69 656e 742e 6465 6c65 7465  ObsClient.delete
+0001f730: 4275 636b 6574 5765 6273 6974 650a 4f62  BucketWebsite.Ob
+0001f740: 7343 6c69 656e 742e 7365 7442 7563 6b65  sClient.setBucke
+0001f750: 744c 6f67 6769 6e67 436f 6e66 6967 7572  tLoggingConfigur
+0001f760: 6174 696f 6e20 3d20 4f62 7343 6c69 656e  ation = ObsClien
+0001f770: 742e 7365 7442 7563 6b65 744c 6f67 6769  t.setBucketLoggi
+0001f780: 6e67 0a4f 6273 436c 6965 6e74 2e67 6574  ng.ObsClient.get
+0001f790: 4275 636b 6574 4c6f 6767 696e 6743 6f6e  BucketLoggingCon
+0001f7a0: 6669 6775 7261 7469 6f6e 203d 204f 6273  figuration = Obs
+0001f7b0: 436c 6965 6e74 2e67 6574 4275 636b 6574  Client.getBucket
+0001f7c0: 4c6f 6767 696e 670a                      Logging.
```

### Comparing `esdk-obs-python-3.22.2/obs/const.py` & `esdk-obs-python-3.23.5/obs/const.py`

 * *Ordering differences only*

 * *Files 26% similar despite different names*

```diff
@@ -1,351 +1,351 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import sys
-import platform
-import os
-
-READ_ONCE_LENGTH = 65536
-
-CONTENT_LENGTH_HEADER = 'Content-Length'
-CONTENT_TYPE_HEADER = 'Content-Type'
-CONTENT_MD5_HEADER = 'Content-MD5'
-CACHE_CONTROL_HEADER = 'Cache-Control'
-CONTENT_DISPOSITION_HEADER = 'Content-Disposition'
-CONTENT_ENCODING_HEADER = 'Content-Encoding'
-CONTENT_LANGUAGE_HEADER = 'Content-Language'
-EXPIRES_HEADER = 'Expires'
-DATE_HEADER = 'Date'
-
-CONTENT_LIST = [CONTENT_TYPE_HEADER.lower(), CONTENT_MD5_HEADER.lower(), DATE_HEADER.lower()]
-
-HOST_HEADER = 'Host'
-AUTHORIZATION_HEADER = 'Authorization'
-CONNECTION_HEADER = 'Connection'
-PROXY_CONNECTION_HEADER = 'Proxy-Connection'
-PROXY_AUTHORIZATION_HEADER = 'Proxy-Authorization'
-USER_AGENT_HEADER = 'User-Agent'
-TRANSFER_ENCODING_HEADER = 'Transfer-Encoding'
-TRANSFER_ENCODING_VALUE = 'chunked'
-ORIGIN_HEADER = 'Origin'
-RANGE_HEADER = 'Range'
-IF_MODIFIED_SINCE = 'If-Modified-Since'
-IF_UNMODIFIED_SINCE = 'If-Unmodified-Since'
-IF_MATCH = 'If-Match'
-IF_NONE_MATCH = 'If-None-Match'
-
-CONNECTION_KEEP_ALIVE_VALUE = 'Keep-Alive'
-CONNECTION_CLOSE_VALUE = 'close'
-ACCESS_CONTROL_REQUEST_METHOD_HEADER = 'Access-Control-Request-Method'
-ACCESS_CONTROL_REQUEST_HEADERS_HEADER = 'Access-Control-Request-Headers'
-LOCATION_HEADER = 'Location'
-ETAG_HEADER = 'ETag'
-LAST_MODIFIED_HEADER = 'Last-Modified'
-
-LOCATION_CLUSTERGROUP_ID = 'location-clustergroup-id'
-X_AUTH_TOKEN_HEADER = 'X-Auth-Token'
-KEY_CLUSTER_GROUP_ID = 'cgId'
-VIRTUAL_BUCKET_NEED_AZ_COUNT = 2
-VIRTUAL_BUCKET_CREATEBUCKET_STAGED = 1
-VIRTUAL_BUCKET_CREATEALIAS_STAGED = 2
-VIRTUAL_BUCKET_BINDALIAS_STAGED = 3
-
-VERSION_ID_PARAM = 'versionId'
-RESPONSE_CACHE_CONTROL_PARAM = 'response-cache-control'
-RESPONSE_CONTENT_DISPOSITION_PARAM = 'response-content-disposition'
-RESPONSE_CONTENT_ENCODING_PARAM = 'response-content-encoding'
-RESPONSE_CONTENT_LANGUAGE_PARAM = 'response-content-language'
-RESPONSE_CONTENT_TYPE_PARAM = 'response-content-type'
-RESPONSE_EXPIRES_PARAM = 'response-expires'
-X_IMAGE_PROCESS_PARAM = 'x-image-process'
-OBSALIAS_PARAM = 'obsalias'
-OBSBUCKETALIAS_PARAM = 'obsbucketalias'
-
-HTTP_METHOD_PUT = 'PUT'
-HTTP_METHOD_POST = 'POST'
-HTTP_METHOD_GET = 'GET'
-HTTP_METHOD_DELETE = 'DELETE'
-HTTP_METHOD_HEAD = 'HEAD'
-HTTP_METHOD_OPTIONS = 'OPTIONS'
-
-IS_WINDOWS = platform.system() == 'Windows' or os.name == 'nt'
-IS_PYTHON2 = sys.version_info.major == 2 or sys.version < '3'
-IS_PYTHON35_UP = sys.version >= '3.5'
-BASESTRING = basestring if IS_PYTHON2 else str
-UNICODE = unicode if IS_PYTHON2 else str
-LONG = long if IS_PYTHON2 else int
-
-DEFAULT_SECURE_PORT = 443
-DEFAULT_INSECURE_PORT = 80
-DEFAULT_MINIMUM_SIZE = 100 * 1024
-DEFAULT_MAXIMUM_SIZE = 5 * 1024 * 1024 * 1024
-
-DEFAULT_BYTE_INTTERVAL = 102400
-DEFAULT_TASK_INTTERVAL = 100
-DEFAULT_TASK_NUM = 8
-DEFAULT_TASK_QUEUE_SIZE = 20000
-
-OBS_SDK_VERSION = '3.22.2'
-
-V2_META_HEADER_PREFIX = 'x-amz-meta-'
-V2_HEADER_PREFIX = 'x-amz-'
-
-OBS_META_HEADER_PREFIX = 'x-obs-meta-'
-OBS_HEADER_PREFIX = 'x-obs-'
-
-GMT_DATE_FORMAT = '%a, %d %b %Y %H:%M:%S GMT'
-LONG_DATE_FORMAT = '%Y%m%dT%H%M%SZ'
-SHORT_DATE_FORMAT = '%Y%m%d'
-EXPIRATION_DATE_FORMAT = '%Y-%m-%dT%H:%M:%SZ'
-
-CANONICAL_REQUEST = 'CannonicalRequest'
-CANONICAL_STRING = 'CanonicalString'
-
-IPv4_REGEX = '^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$'
-
-V2_SIGNATURE = 'v2'
-OBS_SIGNATURE = 'obs'
-
-FETCH_POLICY_KEY = "v1/extension_policy"
-FETCH_JOB_KEY = "v1/async-fetch/jobs"
-
-WORKFLOW_TEMPLATES = 'workflowtemplates'
-WORKFLOWS = 'workflows'
-WORKFLOW_EXECUTIONS = 'workflowexecutions'
-WORKFLOW_TRIGGERPOLICY = 'obsworkflowtriggerpolicy'
-
-ALLOWED_RESOURCE_PARAMTER_NAMES = (
-    'acl',
-    'backtosource',
-    'policy',
-    'torrent',
-    'logging',
-    'location',
-    'storageinfo',
-    'quota',
-    'storageclass',
-    'storagepolicy',
-    'requestpayment',
-    'versions',
-    'versioning',
-    'versionid',
-    'uploads',
-    'uploadid',
-    'partnumber',
-    'website',
-    'notification',
-    'lifecycle',
-    'deletebucket',
-    'delete',
-    'cors',
-    'restore',
-    'tagging',
-    'replication',
-    'metadata',
-    'encryption',
-
-    # File System API
-    'append',
-    'position',
-    'truncate',
-    'modify',
-    'rename',
-    'length',
-    'name',
-    'fileinterface',
-
-    'response-content-type',
-    'response-content-language',
-    'response-expires',
-    'response-cache-control',
-    'response-content-disposition',
-    'response-content-encoding',
-    'x-image-save-bucket',
-    'x-image-save-object',
-    'x-image-process',
-    'x-oss-process',
-
-    # workflow api
-    'x-workflow-prefix',
-    'x-workflow-start',
-    'x-workflow-limit',
-    'x-workflow-template-name',
-    'x-workflow-graph-name',
-    'x-workflow-execution-state',
-    'x-workflow-execution-type',
-    'x-workflow-next-marker',
-    'obsworkflowtriggerpolicy',
-
-    # virtual bucket api
-    'obsbucketalias',
-    'obsalias'
-)
-
-ALLOWED_REQUEST_HTTP_HEADER_METADATA_NAMES = (
-    'content-type',
-    'content-md5',
-    'content-length',
-    'content-language',
-    'expires',
-    'origin',
-    'cache-control',
-    'content-disposition',
-    'content-encoding',
-    'access-control-request-method',
-    'access-control-request-headers',
-    'success-action-redirect',
-    'x-default-storage-class',
-    'location',
-    'date',
-    'etag',
-    'range',
-    'host',
-    'if-modified-since',
-    'if-unmodified-since',
-    'if-match',
-    'if-none-match',
-    'last-modified',
-    'content-range',
-    'x-auth-token'
-)
-
-ALLOWED_RESPONSE_HTTP_HEADER_METADATA_NAMES = (
-    'content-type',
-    'content-md5',
-    'content-length',
-    'content-language',
-    'expires',
-    'origin',
-    'cache-control',
-    'content-disposition',
-    'content-encoding',
-    'x-default-storage-class',
-    'location',
-    'date',
-    'etag',
-    'host',
-    'last-modified',
-    'content-range',
-    'x-reserved',
-    'access-control-allow-origin',
-    'access-control-allow-headers',
-    'access-control-max-age',
-    'access-control-allow-methods',
-    'access-control-expose-headers',
-    'connection',
-    'x-reserved-indicator',
-    'x-oef-request-id'
-)
-
-MIME_TYPES = {
-    '7z': 'application/x-7z-compressed',
-    'aac': 'audio/x-aac',
-    'ai': 'application/postscript',
-    'aif': 'audio/x-aiff',
-    'apk': 'application/vnd.android.package-archive',
-    'asc': 'text/plain',
-    'asf': 'video/x-ms-asf',
-    'atom': 'application/atom+xml',
-    'avi': 'video/x-msvideo',
-    'bmp': 'image/bmp',
-    'bz2': 'application/x-bzip2',
-    'cer': 'application/pkix-cert',
-    'crl': 'application/pkix-crl',
-    'crt': 'application/x-x509-ca-cert',
-    'css': 'text/css',
-    'csv': 'text/csv',
-    'cu': 'application/cu-seeme',
-    'deb': 'application/x-debian-package',
-    'doc': 'application/msword',
-    'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
-    'dvi': 'application/x-dvi',
-    'eot': 'application/vnd.ms-fontobject',
-    'eps': 'application/postscript',
-    'epub': 'application/epub+zip',
-    'etx': 'text/x-setext',
-    'flac': 'audio/flac',
-    'flv': 'video/x-flv',
-    'gif': 'image/gif',
-    'gz': 'application/gzip',
-    'htm': 'text/html',
-    'html': 'text/html',
-    'ico': 'image/x-icon',
-    'ics': 'text/calendar',
-    'ini': 'text/plain',
-    'iso': 'application/x-iso9660-image',
-    'jar': 'application/java-archive',
-    'jpe': 'image/jpeg',
-    'jpeg': 'image/jpeg',
-    'jpg': 'image/jpeg',
-    'js': 'text/javascript',
-    'json': 'application/json',
-    'latex': 'application/x-latex',
-    'log': 'text/plain',
-    'm4a': 'audio/mp4',
-    'm4v': 'video/mp4',
-    'mid': 'audio/midi',
-    'midi': 'audio/midi',
-    'mov': 'video/quicktime',
-    'mp3': 'audio/mpeg',
-    'mp4': 'video/mp4',
-    'mp4a': 'audio/mp4',
-    'mp4v': 'video/mp4',
-    'mpe': 'video/mpeg',
-    'mpeg': 'video/mpeg',
-    'mpg': 'video/mpeg',
-    'mpg4': 'video/mp4',
-    'oga': 'audio/ogg',
-    'ogg': 'audio/ogg',
-    'ogv': 'video/ogg',
-    'ogx': 'application/ogg',
-    'pbm': 'image/x-portable-bitmap',
-    'pdf': 'application/pdf',
-    'pgm': 'image/x-portable-graymap',
-    'png': 'image/png',
-    'pnm': 'image/x-portable-anymap',
-    'ppm': 'image/x-portable-pixmap',
-    'ppt': 'application/vnd.ms-powerpoint',
-    'pptx': 'application/vnd.openxmlformats-officedocument.presentationml.presentation',
-    'ps': 'application/postscript',
-    'qt': 'video/quicktime',
-    'rar': 'application/x-rar-compressed',
-    'ras': 'image/x-cmu-raster',
-    'rss': 'application/rss+xml',
-    'rtf': 'application/rtf',
-    'sgm': 'text/sgml',
-    'sgml': 'text/sgml',
-    'svg': 'image/svg+xml',
-    'swf': 'application/x-shockwave-flash',
-    'tar': 'application/x-tar',
-    'tif': 'image/tiff',
-    'tiff': 'image/tiff',
-    'torrent': 'application/x-bittorrent',
-    'ttf': 'application/x-font-ttf',
-    'txt': 'text/plain',
-    'wav': 'audio/x-wav',
-    'webm': 'video/webm',
-    'wma': 'audio/x-ms-wma',
-    'wmv': 'video/x-ms-wmv',
-    'woff': 'application/x-font-woff',
-    'wsdl': 'application/wsdl+xml',
-    'xbm': 'image/x-xbitmap',
-    'xls': 'application/vnd.ms-excel',
-    'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
-    'xml': 'application/xml',
-    'xpm': 'image/x-xpixmap',
-    'xwd': 'image/x-xwindowdump',
-    'yaml': 'text/yaml',
-    'yml': 'text/yaml',
-    'zip': 'application/zip'
-}
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import sys
+import platform
+import os
+
+READ_ONCE_LENGTH = 65536
+
+CONTENT_LENGTH_HEADER = 'Content-Length'
+CONTENT_TYPE_HEADER = 'Content-Type'
+CONTENT_MD5_HEADER = 'Content-MD5'
+CACHE_CONTROL_HEADER = 'Cache-Control'
+CONTENT_DISPOSITION_HEADER = 'Content-Disposition'
+CONTENT_ENCODING_HEADER = 'Content-Encoding'
+CONTENT_LANGUAGE_HEADER = 'Content-Language'
+EXPIRES_HEADER = 'Expires'
+DATE_HEADER = 'Date'
+
+CONTENT_LIST = [CONTENT_TYPE_HEADER.lower(), CONTENT_MD5_HEADER.lower(), DATE_HEADER.lower()]
+
+HOST_HEADER = 'Host'
+AUTHORIZATION_HEADER = 'Authorization'
+CONNECTION_HEADER = 'Connection'
+PROXY_CONNECTION_HEADER = 'Proxy-Connection'
+PROXY_AUTHORIZATION_HEADER = 'Proxy-Authorization'
+USER_AGENT_HEADER = 'User-Agent'
+TRANSFER_ENCODING_HEADER = 'Transfer-Encoding'
+TRANSFER_ENCODING_VALUE = 'chunked'
+ORIGIN_HEADER = 'Origin'
+RANGE_HEADER = 'Range'
+IF_MODIFIED_SINCE = 'If-Modified-Since'
+IF_UNMODIFIED_SINCE = 'If-Unmodified-Since'
+IF_MATCH = 'If-Match'
+IF_NONE_MATCH = 'If-None-Match'
+
+CONNECTION_KEEP_ALIVE_VALUE = 'Keep-Alive'
+CONNECTION_CLOSE_VALUE = 'close'
+ACCESS_CONTROL_REQUEST_METHOD_HEADER = 'Access-Control-Request-Method'
+ACCESS_CONTROL_REQUEST_HEADERS_HEADER = 'Access-Control-Request-Headers'
+LOCATION_HEADER = 'Location'
+ETAG_HEADER = 'ETag'
+LAST_MODIFIED_HEADER = 'Last-Modified'
+
+LOCATION_CLUSTERGROUP_ID = 'location-clustergroup-id'
+X_AUTH_TOKEN_HEADER = 'X-Auth-Token'
+KEY_CLUSTER_GROUP_ID = 'cgId'
+VIRTUAL_BUCKET_NEED_AZ_COUNT = 2
+VIRTUAL_BUCKET_CREATEBUCKET_STAGED = 1
+VIRTUAL_BUCKET_CREATEALIAS_STAGED = 2
+VIRTUAL_BUCKET_BINDALIAS_STAGED = 3
+
+VERSION_ID_PARAM = 'versionId'
+RESPONSE_CACHE_CONTROL_PARAM = 'response-cache-control'
+RESPONSE_CONTENT_DISPOSITION_PARAM = 'response-content-disposition'
+RESPONSE_CONTENT_ENCODING_PARAM = 'response-content-encoding'
+RESPONSE_CONTENT_LANGUAGE_PARAM = 'response-content-language'
+RESPONSE_CONTENT_TYPE_PARAM = 'response-content-type'
+RESPONSE_EXPIRES_PARAM = 'response-expires'
+X_IMAGE_PROCESS_PARAM = 'x-image-process'
+OBSALIAS_PARAM = 'obsalias'
+OBSBUCKETALIAS_PARAM = 'obsbucketalias'
+
+HTTP_METHOD_PUT = 'PUT'
+HTTP_METHOD_POST = 'POST'
+HTTP_METHOD_GET = 'GET'
+HTTP_METHOD_DELETE = 'DELETE'
+HTTP_METHOD_HEAD = 'HEAD'
+HTTP_METHOD_OPTIONS = 'OPTIONS'
+
+IS_WINDOWS = platform.system() == 'Windows' or os.name == 'nt'
+IS_PYTHON2 = sys.version_info.major == 2 or sys.version < '3'
+IS_PYTHON35_UP = sys.version >= '3.5'
+BASESTRING = basestring if IS_PYTHON2 else str
+UNICODE = unicode if IS_PYTHON2 else str
+LONG = long if IS_PYTHON2 else int
+
+DEFAULT_SECURE_PORT = 443
+DEFAULT_INSECURE_PORT = 80
+DEFAULT_MINIMUM_SIZE = 100 * 1024
+DEFAULT_MAXIMUM_SIZE = 5 * 1024 * 1024 * 1024
+
+DEFAULT_BYTE_INTTERVAL = 102400
+DEFAULT_TASK_INTTERVAL = 100
+DEFAULT_TASK_NUM = 8
+DEFAULT_TASK_QUEUE_SIZE = 20000
+
+OBS_SDK_VERSION = '3.22.2'
+
+V2_META_HEADER_PREFIX = 'x-amz-meta-'
+V2_HEADER_PREFIX = 'x-amz-'
+
+OBS_META_HEADER_PREFIX = 'x-obs-meta-'
+OBS_HEADER_PREFIX = 'x-obs-'
+
+GMT_DATE_FORMAT = '%a, %d %b %Y %H:%M:%S GMT'
+LONG_DATE_FORMAT = '%Y%m%dT%H%M%SZ'
+SHORT_DATE_FORMAT = '%Y%m%d'
+EXPIRATION_DATE_FORMAT = '%Y-%m-%dT%H:%M:%SZ'
+
+CANONICAL_REQUEST = 'CannonicalRequest'
+CANONICAL_STRING = 'CanonicalString'
+
+IPv4_REGEX = '^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$'
+
+V2_SIGNATURE = 'v2'
+OBS_SIGNATURE = 'obs'
+
+FETCH_POLICY_KEY = "v1/extension_policy"
+FETCH_JOB_KEY = "v1/async-fetch/jobs"
+
+WORKFLOW_TEMPLATES = 'workflowtemplates'
+WORKFLOWS = 'workflows'
+WORKFLOW_EXECUTIONS = 'workflowexecutions'
+WORKFLOW_TRIGGERPOLICY = 'obsworkflowtriggerpolicy'
+
+ALLOWED_RESOURCE_PARAMTER_NAMES = (
+    'acl',
+    'backtosource',
+    'policy',
+    'torrent',
+    'logging',
+    'location',
+    'storageinfo',
+    'quota',
+    'storageclass',
+    'storagepolicy',
+    'requestpayment',
+    'versions',
+    'versioning',
+    'versionid',
+    'uploads',
+    'uploadid',
+    'partnumber',
+    'website',
+    'notification',
+    'lifecycle',
+    'deletebucket',
+    'delete',
+    'cors',
+    'restore',
+    'tagging',
+    'replication',
+    'metadata',
+    'encryption',
+
+    # File System API
+    'append',
+    'position',
+    'truncate',
+    'modify',
+    'rename',
+    'length',
+    'name',
+    'fileinterface',
+
+    'response-content-type',
+    'response-content-language',
+    'response-expires',
+    'response-cache-control',
+    'response-content-disposition',
+    'response-content-encoding',
+    'x-image-save-bucket',
+    'x-image-save-object',
+    'x-image-process',
+    'x-oss-process',
+
+    # workflow api
+    'x-workflow-prefix',
+    'x-workflow-start',
+    'x-workflow-limit',
+    'x-workflow-template-name',
+    'x-workflow-graph-name',
+    'x-workflow-execution-state',
+    'x-workflow-execution-type',
+    'x-workflow-next-marker',
+    'obsworkflowtriggerpolicy',
+
+    # virtual bucket api
+    'obsbucketalias',
+    'obsalias'
+)
+
+ALLOWED_REQUEST_HTTP_HEADER_METADATA_NAMES = (
+    'content-type',
+    'content-md5',
+    'content-length',
+    'content-language',
+    'expires',
+    'origin',
+    'cache-control',
+    'content-disposition',
+    'content-encoding',
+    'access-control-request-method',
+    'access-control-request-headers',
+    'success-action-redirect',
+    'x-default-storage-class',
+    'location',
+    'date',
+    'etag',
+    'range',
+    'host',
+    'if-modified-since',
+    'if-unmodified-since',
+    'if-match',
+    'if-none-match',
+    'last-modified',
+    'content-range',
+    'x-auth-token'
+)
+
+ALLOWED_RESPONSE_HTTP_HEADER_METADATA_NAMES = (
+    'content-type',
+    'content-md5',
+    'content-length',
+    'content-language',
+    'expires',
+    'origin',
+    'cache-control',
+    'content-disposition',
+    'content-encoding',
+    'x-default-storage-class',
+    'location',
+    'date',
+    'etag',
+    'host',
+    'last-modified',
+    'content-range',
+    'x-reserved',
+    'access-control-allow-origin',
+    'access-control-allow-headers',
+    'access-control-max-age',
+    'access-control-allow-methods',
+    'access-control-expose-headers',
+    'connection',
+    'x-reserved-indicator',
+    'x-oef-request-id'
+)
+
+MIME_TYPES = {
+    '7z': 'application/x-7z-compressed',
+    'aac': 'audio/x-aac',
+    'ai': 'application/postscript',
+    'aif': 'audio/x-aiff',
+    'apk': 'application/vnd.android.package-archive',
+    'asc': 'text/plain',
+    'asf': 'video/x-ms-asf',
+    'atom': 'application/atom+xml',
+    'avi': 'video/x-msvideo',
+    'bmp': 'image/bmp',
+    'bz2': 'application/x-bzip2',
+    'cer': 'application/pkix-cert',
+    'crl': 'application/pkix-crl',
+    'crt': 'application/x-x509-ca-cert',
+    'css': 'text/css',
+    'csv': 'text/csv',
+    'cu': 'application/cu-seeme',
+    'deb': 'application/x-debian-package',
+    'doc': 'application/msword',
+    'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
+    'dvi': 'application/x-dvi',
+    'eot': 'application/vnd.ms-fontobject',
+    'eps': 'application/postscript',
+    'epub': 'application/epub+zip',
+    'etx': 'text/x-setext',
+    'flac': 'audio/flac',
+    'flv': 'video/x-flv',
+    'gif': 'image/gif',
+    'gz': 'application/gzip',
+    'htm': 'text/html',
+    'html': 'text/html',
+    'ico': 'image/x-icon',
+    'ics': 'text/calendar',
+    'ini': 'text/plain',
+    'iso': 'application/x-iso9660-image',
+    'jar': 'application/java-archive',
+    'jpe': 'image/jpeg',
+    'jpeg': 'image/jpeg',
+    'jpg': 'image/jpeg',
+    'js': 'text/javascript',
+    'json': 'application/json',
+    'latex': 'application/x-latex',
+    'log': 'text/plain',
+    'm4a': 'audio/mp4',
+    'm4v': 'video/mp4',
+    'mid': 'audio/midi',
+    'midi': 'audio/midi',
+    'mov': 'video/quicktime',
+    'mp3': 'audio/mpeg',
+    'mp4': 'video/mp4',
+    'mp4a': 'audio/mp4',
+    'mp4v': 'video/mp4',
+    'mpe': 'video/mpeg',
+    'mpeg': 'video/mpeg',
+    'mpg': 'video/mpeg',
+    'mpg4': 'video/mp4',
+    'oga': 'audio/ogg',
+    'ogg': 'audio/ogg',
+    'ogv': 'video/ogg',
+    'ogx': 'application/ogg',
+    'pbm': 'image/x-portable-bitmap',
+    'pdf': 'application/pdf',
+    'pgm': 'image/x-portable-graymap',
+    'png': 'image/png',
+    'pnm': 'image/x-portable-anymap',
+    'ppm': 'image/x-portable-pixmap',
+    'ppt': 'application/vnd.ms-powerpoint',
+    'pptx': 'application/vnd.openxmlformats-officedocument.presentationml.presentation',
+    'ps': 'application/postscript',
+    'qt': 'video/quicktime',
+    'rar': 'application/x-rar-compressed',
+    'ras': 'image/x-cmu-raster',
+    'rss': 'application/rss+xml',
+    'rtf': 'application/rtf',
+    'sgm': 'text/sgml',
+    'sgml': 'text/sgml',
+    'svg': 'image/svg+xml',
+    'swf': 'application/x-shockwave-flash',
+    'tar': 'application/x-tar',
+    'tif': 'image/tiff',
+    'tiff': 'image/tiff',
+    'torrent': 'application/x-bittorrent',
+    'ttf': 'application/x-font-ttf',
+    'txt': 'text/plain',
+    'wav': 'audio/x-wav',
+    'webm': 'video/webm',
+    'wma': 'audio/x-ms-wma',
+    'wmv': 'video/x-ms-wmv',
+    'woff': 'application/x-font-woff',
+    'wsdl': 'application/wsdl+xml',
+    'xbm': 'image/x-xbitmap',
+    'xls': 'application/vnd.ms-excel',
+    'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
+    'xml': 'application/xml',
+    'xpm': 'image/x-xpixmap',
+    'xwd': 'image/x-xwindowdump',
+    'yaml': 'text/yaml',
+    'yml': 'text/yaml',
+    'zip': 'application/zip'
+}
```

### Comparing `esdk-obs-python-3.22.2/obs/convertor.py` & `esdk-obs-python-3.23.5/obs/convertor.py`

 * *Files 1% similar despite different names*

```diff
@@ -84,14 +84,23 @@
 
     def acl_header(self):
         return self._get_header_prefix() + 'acl'
 
     def epid_header(self):
         return self._get_header_prefix() + 'epid'
 
+    def bucket_redundancy_header(self):
+        return self._get_header_prefix() + 'bucket-redundancy'
+
+    def fusion_allow_upgrade_header(self):
+        return self._get_header_prefix() + 'fusion-allow-upgrade'
+
+    def fusion_allow_alternative_header(self):
+        return self._get_header_prefix() + 'fusion-allow-alternative'
+
     @staticmethod
     def pfs_header():
         return 'x-obs-fs-file-interface'
 
     def date_header(self):
         return self._get_header_prefix() + 'date'
 
@@ -313,14 +322,17 @@
         header = kwargs.get('header')
         if header is not None:
             self._put_key_value(headers, self.ha.acl_header(), self.ha.adapt_acl_control(header.get('aclControl')))
             self._put_key_value(headers, self.ha.default_storage_class_header(),
                                 self.ha.adapt_storage_class(header.get('storageClass')))
             self._put_key_value(headers, self.ha.az_redundancy_header(), header.get('availableZone'))
             self._put_key_value(headers, self.ha.epid_header(), header.get('epid'))
+            self._put_key_value(headers, self.ha.bucket_redundancy_header(), header.get('redundancy'))
+            self._put_key_value(headers, self.ha.fusion_allow_upgrade_header(), util.to_string(header.get('isFusionAllowUpgrade')).lower())
+            self._put_key_value(headers, self.ha.fusion_allow_alternative_header(), util.to_string(header.get('isFusionAllowAlternative')).lower())
             if header.get('isPFS'):
                 self._put_key_value(headers, self.ha.pfs_header(), "Enabled")
             extensionGrants = header.get('extensionGrants')
             if extensionGrants is not None and len(extensionGrants) > 0:
                 grantDict = {}
                 for extensionGrant in extensionGrants:
                     permission = self.ha.adapt_extension_permission(extensionGrant.get('permission'))
@@ -1092,14 +1104,17 @@
 
     def trans_get_extension_headers(self, headers):
         _headers = {}
         if headers is not None and len(headers) > 0:
             self._put_key_value(_headers, self.ha.request_payer_header(), headers.get('requesterPayer'))
             self._put_key_value(_headers, self.ha.location_clustergroup_id_header(),
                                 headers.get('locationClusterGroupId'))
+            for key, val in headers.items():
+                if key != 'requesterPayer' or 'locationClusterGroupId':
+                    self._put_key_value(_headers, key, val)
         return _headers
 
     # OEF trans func
     def trans_set_bucket_fetch_policy(self, fetchPolicy):
         headers = {}
         self._put_key_value(headers, const.CONTENT_TYPE_HEADER, const.MIME_TYPES.get("json"))
         self._put_key_value(headers, self.ha.oef_marker_header(), "yes")
@@ -1147,14 +1162,18 @@
         if encoding_type == "url":
             return util.to_string(unquote_plus(result))
         return util.to_string(result)
 
     def parseListBuckets(self, xml, headers=None):
         root = ET.fromstring(xml)
         owner = root.find('Owner')
+        marker = self._find_item(root, 'Marker')
+        maxKeys = self._find_item(root, 'MaxKeys')
+        isTruncated = self._find_item(root, 'IsTruncated')
+        nextMarker = self._find_item(root, 'NextMarker')
         Owners = None
         if owner is not None:
             ID = self._find_item(owner, 'ID')
             DisplayName = None if self.is_obs else self._find_item(owner, 'DisplayName')
             Owners = Owner(owner_id=ID, owner_name=DisplayName)
 
         buckets = root.find('Buckets').findall('Bucket')
@@ -1164,15 +1183,16 @@
             name = self._find_item(bucket, 'Name')
             d = self._find_item(bucket, 'CreationDate')
             location = self._find_item(bucket, 'Location')
             bucket_type = self._find_item(bucket, 'BucketType')
             create_date = DateTime.UTCToLocal(d)
             curr_bucket = Bucket(name=name, create_date=create_date, location=location, bucket_type=bucket_type)
             entries.append(curr_bucket)
-        return ListBucketsResponse(buckets=entries, owner=Owners)
+        return ListBucketsResponse(buckets=entries, owner=Owners, maxKeys=maxKeys,
+                                   marker=marker, isTruncated=isTruncated, nextMarker=nextMarker)
 
     def parseErrorResult(self, xml, headers=None):
         root = ET.fromstring(xml)
         code = self._find_item(root, 'Code')
         message = self._find_item(root, 'Message')
         requestId = self._find_item(root, 'RequestId')
         hostId = self._find_item(root, 'HostId')
@@ -1234,26 +1254,49 @@
         option.accessContorlExposeHeaders = headers.get('access-control-expose-headers')
         option.accessContorlMaxAge = util.to_int(headers.get('access-control-max-age'))
         option.storageClass = headers.get(self.ha.default_storage_class_header())
         option.location = headers.get(self.ha.bucket_region_header())
         option.obsVersion = headers.get(self.ha.server_version_header())
         option.availableZone = headers.get(self.ha.az_redundancy_header())
         option.epid = headers.get(self.ha.epid_header())
+        option.redundancy = headers.get(self.ha.bucket_redundancy_header())
         return option
 
     def parseGetBucketLocation(self, xml, headers=None):
         root = ET.fromstring(xml)
         location = root.text if self.is_obs else self._find_item(root, 'LocationConstraint')
         return LocationResponse(location=location)
 
     def parseGetBucketStorageInfo(self, xml, headers=None):
         root = ET.fromstring(xml)
         size = self._find_item(root, 'Size')
         objectNumber = self._find_item(root, 'ObjectNumber')
-        return GetBucketStorageInfoResponse(size=util.to_long(size), objectNumber=util.to_int(objectNumber))
+        standardSize = self._find_item(root, 'StandardSize')
+        standardObjectNumber = self._find_item(root, 'StandardObjectNumber')
+        warmSize = self._find_item(root, 'WarmSize')
+        warmObjectNumber = self._find_item(root, 'WarmObjectNumber')
+        coldSize = self._find_item(root, 'ColdSize')
+        coldObjectNumber = self._find_item(root, 'ColdObjectNumber')
+        deepArchiveSize = self._find_item(root, 'DeepArchiveSize')
+        deepArchiveObjectNumber = self._find_item(root, 'DeepArchiveObjectNumber')
+        highPerformanceSize = self._find_item(root, 'HighPerformanceSize')
+        highPerformanceObjectNumber = self._find_item(root, 'HighPerformanceObjectNumber')
+        standard_IASize = self._find_item(root, 'Standard_IASize')
+        standard_IAObjectNumber = self._find_item(root, 'Standard_IAObjectNumber')
+        glacierSize = self._find_item(root, 'GlacierSize')
+        glacierObjectNumber = self._find_item(root, 'GlacierObjectNumber')
+
+        return GetBucketStorageInfoResponse(size=util.to_long(size), objectNumber=util.to_int(objectNumber),
+                                            standardSize=util.to_long(standardSize), standardObjectNumber=util.to_int(standardObjectNumber),
+                                            warmSize=util.to_long(warmSize), warmObjectNumber=util.to_int(warmObjectNumber),
+                                            coldSize=util.to_long(coldSize), coldObjectNumber=util.to_int(coldObjectNumber),
+                                            deepArchiveSize=util.to_long(deepArchiveSize), deepArchiveObjectNumber=util.to_int(deepArchiveObjectNumber),
+                                            highPerformanceSize=util.to_long(highPerformanceSize), highPerformanceObjectNumber=util.to_int(highPerformanceObjectNumber),
+                                            standard_IASize=util.to_long(standard_IASize), standard_IAObjectNumber=util.to_int(standard_IAObjectNumber),
+                                            glacierSize=util.to_long(glacierSize), glacierObjectNumber=util.to_int(glacierObjectNumber))
 
     @staticmethod
     def parseGetBucketPolicy(json_str, headers=None):
         return Policy(policyJSON=json_str)
 
     def parseGetBucketStoragePolicy(self, xml, headers=None):
         root = ET.fromstring(xml)
```

### Comparing `esdk-obs-python-3.22.2/obs/crypto_client.py` & `esdk-obs-python-3.23.5/obs/crypto_client.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/extension.py` & `esdk-obs-python-3.23.5/obs/extension.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/http2.py` & `esdk-obs-python-3.23.5/obs/http2.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/ilog.py` & `esdk-obs-python-3.23.5/obs/ilog.py`

 * *Files 2% similar despite different names*

```diff
@@ -119,16 +119,15 @@
             self.logger.addHandler(console_handler)
 
     def close(self):
         for handle in self.logger.handlers:
             try:
                 handle.close()
             except Exception:
-                # ignore exception of log handle close.
-                pass
+                print("exception of log handle close")
 
     def log(self, level, msg, *args, **kwargs):
         base_back = sys._getframe().f_back
         func_name = base_back.f_code.co_name
         while func_name.lower() == 'log':
             base_back = base_back.f_back
             func_name = base_back.f_code.co_name
```

### Comparing `esdk-obs-python-3.22.2/obs/loadtoken.py` & `esdk-obs-python-3.23.5/obs/loadtoken.py`

 * *Files 0% similar despite different names*

```diff
@@ -95,16 +95,16 @@
                     raise
                 finally:
                     conn.close()
 
                 try:
                     reAccessKey = r'.*"access": "(.*?)",'
                     reSecretKey = r'.*"secret": "(.*?)",'
-                    reSecurityToken = r'.*"securitytoken": "(.*?)",'
-                    reExpires = r'.*"expires_at": "(.*?)"'
+                    reSecurityToken = r'.*"securitytoken": "(.*?)"'
+                    reExpires = r'.*"expires_at": "(.*?)",'
 
                     patternA = re.compile(reAccessKey)
                     patternS = re.compile(reSecretKey)
                     patternT = re.compile(reSecurityToken)
                     patternE = re.compile(reExpires)
 
                     responseBody = ECS._search_handle_response_body(responseBody)
```

### Comparing `esdk-obs-python-3.22.2/obs/locks.py` & `esdk-obs-python-3.23.5/obs/locks.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/model.py` & `esdk-obs-python-3.23.5/obs/model.py`

 * *Files 2% similar despite different names*

```diff
@@ -458,14 +458,22 @@
         self.contentDisposition = contentDisposition
         self.contentEncoding = contentEncoding
         self.contentLanguage = contentLanguage
         self.contentType = contentType
         self.expires = expires
         self.storageClass = storageClass
 
+class RenameFileHeader(BaseModel,object):
+    allowedAttr = {'objectKey': BASESTRING, 'newObjectKey': BASESTRING}
+
+    def __init__(self, objectKey=None, newObjectKey=None):
+        super(RenameFileHeader, self).__init__()
+        self.objectKey = objectKey
+        self.newObjectKey = newObjectKey
+
 
 class CorsRule(BaseModel):
     allowedAttr = {'id': BASESTRING, 'allowedMethod': list, 'allowedOrigin': list,
                    'allowedHeader': list, 'maxAgeSecond': [int, BASESTRING], 'exposeHeader': list}
 
     def __init__(self, id=None, allowedMethod=None, allowedOrigin=None, allowedHeader=None, maxAgeSecond=None,
                  exposeHeader=None):
@@ -475,18 +483,20 @@
         self.allowedHeader = allowedHeader
         self.maxAgeSecond = maxAgeSecond
         self.exposeHeader = exposeHeader
 
 
 class CreateBucketHeader(BaseModel):
     allowedAttr = {'aclControl': BASESTRING, 'storageClass': BASESTRING, 'extensionGrants': list,
-                   'availableZone': BASESTRING, 'epid': BASESTRING, "isPFS": bool}
+                   'availableZone': BASESTRING, 'epid': BASESTRING, "isPFS": bool, "redundancy": BASESTRING,
+                   "isFusionAllowUpgrade": bool, "isFusionAllowAlternative": bool}
 
     def __init__(self, aclControl=None, storageClass=None, extensionGrants=None,
-                 availableZone=None, epid=None, isPFS=False):
+                 availableZone=None, epid=None, isPFS=False, redundancy=None, 
+                 isFusionAllowUpgrade=None, isFusionAllowAlternative=None):
         """
         Headers that can be carried during bucket creation
         :param aclControl: ACL policy of a bucket
         :param storageClass: Specifies the default storage class of a bucket. The value can be "STANDARD" (Standard),
                "WARM" (Infrequent Access), and "COLD" (Archive). The Standard storage class is used by default.
         :param extensionGrants: Extended permission list that can be specified during bucket creation.
         :param availableZone: AZ type that can be specified during bucket creation. A single AZ is used by default.
@@ -497,15 +507,17 @@
         """
         self.aclControl = aclControl
         self.storageClass = storageClass
         self.extensionGrants = extensionGrants
         self.availableZone = availableZone
         self.epid = epid
         self.isPFS = isPFS
-
+        self.redundancy = redundancy
+        self.isFusionAllowUpgrade = isFusionAllowUpgrade
+        self.isFusionAllowAlternative = isFusionAllowAlternative
 
 class ExtensionGrant(BaseModel):
     allowedAttr = {'permission': BASESTRING, 'granteeId': BASESTRING}
 
     def __init__(self, granteeId=None, permission=None):
         self.granteeId = granteeId
         self.permission = permission
@@ -1061,50 +1073,68 @@
         self.maxParts = maxParts
         self.isTruncated = isTruncated
         self.parts = parts
         self.encoding_type = encoding_type
 
 
 class GetBucketMetadataResponse(BaseModel):
-    allowedAttr = {'storageClass': BASESTRING, 'accessContorlAllowOrigin': BASESTRING,
+    allowedAttr = {'storageClass': BASESTRING, 'accessContorlAllowOrigin': BASESTRING, 
                    'accessContorlAllowHeaders': BASESTRING,
                    'accessContorlAllowMethods': BASESTRING,
                    'accessContorlExposeHeaders': BASESTRING,
                    'accessContorlMaxAge': int, 'location': BASESTRING, 'obsVersion': BASESTRING,
-                   'availableZone': BASESTRING, 'epid': BASESTRING}
+                   'availableZone': BASESTRING, 'epid': BASESTRING, 'redundancy': BASESTRING}
 
     def __init__(self, storageClass=None, accessContorlAllowOrigin=None, accessContorlAllowHeaders=None,
                  accessContorlAllowMethods=None, accessContorlExposeHeaders=None, accessContorlMaxAge=None,
-                 location=None, obsVersion=None, availableZone=None, epid=None):
+                 location=None, obsVersion=None, availableZone=None, epid=None, redundancy=None):
         self.storageClass = storageClass
         self.accessContorlAllowOrigin = accessContorlAllowOrigin
         self.accessContorlAllowHeaders = accessContorlAllowHeaders
         self.accessContorlAllowMethods = accessContorlAllowMethods
         self.accessContorlExposeHeaders = accessContorlExposeHeaders
         self.accessContorlMaxAge = accessContorlMaxAge
         self.location = location
         self.obsVersion = obsVersion
         self.availableZone = availableZone
         self.epid = epid
+        self.redundancy = redundancy
 
 
 class GetBucketQuotaResponse(BaseModel):
     allowedAttr = {'quota': LONG}
 
     def __init__(self, quota=None):
         self.quota = quota
 
 
 class GetBucketStorageInfoResponse(BaseModel):
-    allowedAttr = {'size': LONG, 'objectNumber': int}
-
-    def __init__(self, size=None, objectNumber=None):
+    allowedAttr = {'size': LONG, 'objectNumber': int, 'standardSize': LONG, 'standardObjectNumber': int, 'warmSize': LONG,
+                   'warmObjectNumber': int, 'coldSize': LONG, 'coldObjectNumber': int, 'deepArchiveSize': LONG, 'deepArchiveObjectNumber': int,
+                   'highPerformanceSize': LONG, 'highPerformanceObjectNumber': int, 'standard_IASize': LONG, 'standard_IAObjectNumber': int, 'glacierObjectNumber': LONG}
+
+    def __init__(self, size=None, objectNumber=None, standardSize=None, standardObjectNumber=None, warmSize=None,
+                 warmObjectNumber=None, coldSize=None, coldObjectNumber=None, deepArchiveSize=None, deepArchiveObjectNumber=None,
+                 highPerformanceSize=None, highPerformanceObjectNumber=None, standard_IASize=None, standard_IAObjectNumber=None, glacierSize=None, glacierObjectNumber=None):
         self.size = size
         self.objectNumber = objectNumber
-
+        self.standardSize = standardSize
+        self.standardObjectNumber = standardObjectNumber
+        self.warmSize = warmSize
+        self.warmObjectNumber = warmObjectNumber
+        self.coldSize = coldSize
+        self.coldObjectNumber = coldObjectNumber
+        self.deepArchiveSize = deepArchiveSize
+        self.deepArchiveObjectNumber = deepArchiveObjectNumber
+        self.highPerformanceSize = highPerformanceSize
+        self.highPerformanceObjectNumber = highPerformanceObjectNumber
+        self.standard_IASize = standard_IASize
+        self.standard_IAObjectNumber = standard_IAObjectNumber
+        self.glacierSize = glacierSize
+        self.glacierObjectNumber = glacierObjectNumber
 
 class GetBucketEncryptionResponse(BaseModel):
     allowedAttr = {'encryption': BASESTRING, 'key': BASESTRING}
 
     def __init__(self, encryption=None, key=None):
         self.encryption = encryption
         self.key = key
@@ -1192,20 +1222,23 @@
     allowedAttr = {'lifecycleConfig': Lifecycle}
 
     def __init__(self, lifecycleConfig=None):
         self.lifecycleConfig = lifecycleConfig
 
 
 class ListBucketsResponse(BaseModel):
-    allowedAttr = {'buckets': list, 'owner': Owner}
+    allowedAttr = {'buckets': list, 'owner': Owner, 'maxKeys': int, 'marker': BASESTRING, 'isTruncated': bool, 'nextMarker': BASESTRING}
 
-    def __init__(self, buckets=None, owner=None):
+    def __init__(self, buckets=None, owner=None, maxKeys=None, marker=None, isTruncated=None, nextMarker=None):
         self.buckets = buckets
         self.owner = owner
-
+        self.maxKeys = maxKeys
+        self.marker = marker
+        self.isTruncated = isTruncated
+        self.nextMarker = nextMarker
 
 class ListMultipartUploadsResponse(BaseModel):
     allowedAttr = {'bucket': BASESTRING, 'keyMarker': BASESTRING, 'uploadIdMarker': BASESTRING,
                    'nextKeyMarker': BASESTRING, 'nextUploadIdMarker': BASESTRING, 'maxUploads': int,
                    'isTruncated': bool, 'prefix': BASESTRING, 'delimiter': BASESTRING, 'upload': list,
                    'commonPrefixs': list, "encoding_type": BASESTRING}
```

### Comparing `esdk-obs-python-3.22.2/obs/obs_cipher_suite.py` & `esdk-obs-python-3.23.5/obs/obs_cipher_suite.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,14 @@
 # coding:utf-8
 import binascii
 import hashlib
 import os
+import secrets
 
-from Crypto.Cipher import AES, PKCS1_v1_5
+from Crypto.Cipher import AES, PKCS1_OAEP
 from Crypto.PublicKey import RSA
 from Crypto.Util import Counter
 from Crypto.Util.number import bytes_to_long
 
 from obs import const, util
 
 
@@ -18,15 +19,15 @@
         self.master_key_sha256 = ""
 
     def new(self, readable):
         pass
 
     @staticmethod
     def gen_random_key(key_length):
-        return os.urandom(key_length)
+        return secrets.token_bytes(key_length)
 
     def get_crypto_info_from_headers(self, header_dict):
         key_list = [i for i in header_dict.keys()]
         for key in key_list:
             if key.startswith("x-obs-meta"):
                 header_dict[key.replace("x-obs-meta-", "")] = header_dict.pop(key)
         key_list = [i for i in header_dict.keys()]
@@ -255,15 +256,15 @@
 class CtrRSACipherGenerator(CipherGenerator):
     def __init__(self, master_crypto_key_path, master_key_info=None, *args, **kwargs):
         super(CtrRSACipherGenerator, self).__init__(*args, **kwargs)
         with open(master_crypto_key_path, "rb") as f:
             key = f.read()
             self.master_key_sha256 = hashlib.sha256(key).hexdigest()
             self.master_crypto_key = RSA.importKey(key)
-        self.rsa = PKCS1_v1_5.new(self.master_crypto_key)
+        self.rsa = PKCS1_OAEP.new(self.master_crypto_key)
         self.crypto_mod = "AES256-Ctr/RSA-Object-Key/NoPadding"
         self.master_key_info = "" if master_key_info is None else master_key_info
 
     def new(self, readable, is_decrypt=False, crypto_info=None):
         if crypto_info is not None:
             iv = binascii.a2b_base64(crypto_info["crypto_iv"])
             if "object_encryption_key" in crypto_info:
@@ -280,15 +281,15 @@
                                self.master_key_info,
                                self.master_key_sha256, random_iv, is_decrypt, self.need_sha256)
 
     def encrypt_object_encryption_key(self, key_str):
         return binascii.b2a_base64(self.rsa.encrypt(key_str)).strip().decode("UTF-8")
 
     def decrypt_object_encryption_key(self, key_str):
-        return self.rsa.decrypt(binascii.a2b_base64(key_str), 0)
+        return self.rsa.decrypt(binascii.a2b_base64(key_str))
 
     def get_crypto_info_from_headers(self, header_dict):
         header_dict = super(CtrRSACipherGenerator, self).get_crypto_info_from_headers(header_dict)
         if "encrypted-object-key" not in header_dict:
             raise Exception("Encryption info is not in metadata")
         header_dict["encrypted_object_key"] = header_dict.pop("encrypted-object-key")
         header_dict["crypto_iv"] = header_dict.pop("encrypted-start")
```

### Comparing `esdk-obs-python-3.22.2/obs/progress.py` & `esdk-obs-python-3.23.5/obs/progress.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/obs/searchmethod.py` & `esdk-obs-python-3.23.5/obs/searchmethod.py`

 * *Files 6% similar despite different names*

```diff
@@ -17,15 +17,15 @@
 
 def get_token(security_providers, name='OBS_DEFAULT'):
     if name == 'OBS_DEFAULT':
         for method in security_providers:
             try:
                 value = method.search()
             except Exception:
-                pass
+                print("Method search Error")
             else:
                 return {'accessKey': value.get('accessKey'),
                         'secretKey': value.get('secretKey'),
                         'securityToken': value.get('securityToken')}
         raise NoneTokenException('get token failed')
 
     for method in security_providers:
```

### Comparing `esdk-obs-python-3.22.2/obs/transfer.py` & `esdk-obs-python-3.23.5/obs/transfer.py`

 * *Files 1% similar despite different names*

```diff
@@ -12,14 +12,15 @@
 # Unless required by applicable law or agreed to in writing, software distributed
 # under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
 # CONDITIONS OF ANY KIND, either express or implied.  See the License for the
 # specific language governing permissions and limitations under the License.
 import math
 import operator
 import os
+import stat
 import sys
 import threading
 import traceback
 
 from obs import const, progress, util
 from obs.ilog import DEBUG, ERROR, INFO
 from obs.model import BaseModel, CompleteMultipartUploadRequest, CompletePart, GetObjectHeader, GetObjectRequest, \
@@ -52,15 +53,18 @@
     return _resume_download_with_operation(down_operation)
 
 
 def _resume_download_with_operation(down_operation):
     if down_operation.size == 0:
         down_operation._delete_record()
         down_operation._delete_tmp_file()
-        with open(down_operation.fileName, 'wb'):
+
+        modes = stat.S_IWUSR | stat.S_IRUSR
+        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
+        with os.fdopen(os.open(down_operation.fileName, flags, modes), 'wb'):
             pass
         if down_operation.progressCallback is not None and callable(down_operation.progressCallback):
             down_operation.progressCallback(0, 0, 0)
         return down_operation._metadata_resp
     return down_operation._download()
 
 
@@ -107,15 +111,17 @@
     def _delete_record(self):
         if os.path.exists(self.checkPointFile):
             os.remove(self.checkPointFile)
             self.obsClient.log_client.log(INFO,
                                           'delete checkpoint file success. path is:{0}'.format(self.checkPointFile))
 
     def _write_record(self, record):
-        with open(self.checkPointFile, 'w') as f:
+        modes = stat.S_IWUSR | stat.S_IRUSR
+        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
+        with os.fdopen(os.open(self.checkPointFile, flags, modes), 'w') as f:
             json.dump(record, f)
             self.obsClient.log_client.log(INFO,
                                           'write checkpoint file success. file path is {0}'.format(self.checkPointFile))
 
 
 class uploadOperation(Operation):
     def __init__(self, bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint, checkPointFile,
@@ -153,18 +159,24 @@
             self.partSize = const.DEFAULT_MAXIMUM_SIZE
         else:
             self.partSize = util.to_int(self.partSize)
         if self.taskNum <= 0:
             self.taskNum = 1
         else:
             self.taskNum = int(math.ceil(self.taskNum))
-        self.total_parts = int(self.size / self.partSize)
+            try:
+                self.total_parts = int(self.size / self.partSize)
+            except ZeroDivisionError:
+                print("You can't divide by 0!")
         if self.total_parts >= 10000:
             self.partSize = int(self.size / 10000) if self.size % 10000 == 0 else int(self.size / 10000) + 1
-            self.total_parts = int(self.size / self.partSize)
+            try:
+                self.total_parts = int(self.size / self.partSize)
+            except ZeroDivisionError:
+                print("You can't divide by 0!")
         if self.size % self.partSize != 0:
             self.total_parts += 1
 
     def _upload(self):
         if self.headers is None:
             self.headers = UploadFileHeader()
 
@@ -301,15 +313,15 @@
             return False
 
         if record['fileStatus'][0] != self.size or record['fileStatus'][1] != self.lastModified:
             self.obsClient.log_client.log(INFO, '{0} was changed, clear the record.'.format(self.fileName))
             return False
         if self.checkSum and len(record['fileStatus']) >= 3:
             checkSum = util.base64_encode(
-                util.md5_file_encode_by_size_offset(file_path=self.fileName, size=self.size, offset=0))
+                util.sha256_file_encode_by_size_offset(file_path=self.fileName, size=self.size, offset=0))
             if record['fileStatus'][2] and record['fileStatus'][2] != checkSum:
                 self.obsClient.log_client.log(INFO, '{0} content was changed, clear the record.'.format(self.fileName))
                 return False
         return True
 
     def _slice_file(self):
         uploadParts = []
@@ -339,15 +351,15 @@
                                                       extensionGrants=self.headers.extensionGrants,
                                                       extensionHeaders=self.extensionHeaders,
                                                       encoding_type=self.encoding_type)
 
     def _prepare(self):
         fileStatus = [self.size, self.lastModified]
         if self.checkSum:
-            fileStatus.append(util.base64_encode(util.md5_file_encode_by_size_offset(self.fileName, self.size, 0)))
+            fileStatus.append(util.base64_encode(util.sha256_file_encode_by_size_offset(self.fileName, self.size, 0)))
 
         resp = self.get_init_upload_result()
 
         if resp.status > 300:
             raise Exception('initiateMultipartUpload failed. ErrorCode:{0}. ErrorMessage:{1}'.format(resp.errorCode,
                                                                                                      resp.errorMessage))
         uploadId = resp.body.uploadId
@@ -444,15 +456,17 @@
 
     def _delete_tmp_file(self):
         if os.path.exists(self._tmp_file):
             os.remove(self._tmp_file)
 
     def _do_rename(self):
         try:
-            with open(self.fileName, 'wb') as wf:
+            modes = stat.S_IWUSR | stat.S_IRUSR
+            flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
+            with os.fdopen(os.open(self.fileName, flags, modes), 'wb') as wf:
                 with open(self._tmp_file, 'rb') as rf:
                     while True:
                         chunk = rf.read(const.READ_ONCE_LENGTH)
                         if not chunk:
                             break
                         wf.write(chunk)
             if self.enableCheckPoint:
@@ -535,15 +549,17 @@
             self._record = None
         if self._record is None:
             self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'versionId': self.versionId,
                             'downloadFile': self.fileName, 'imageProcess': self.imageProcess}
 
     def _prepare(self):
         object_status = [self.objectKey, self.size, self.lastModified, self.versionId, self.imageProcess]
-        with open(_to_unicode(self._tmp_file), 'wb') as f:
+        modes = stat.S_IWUSR | stat.S_IRUSR
+        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
+        with os.fdopen(os.open(_to_unicode(self._tmp_file), flags, modes), 'wb') as f:
             if self.size > 0:
                 f.seek(self.size - 1, 0)
             f.write('b' if const.IS_PYTHON2 else 'b'.encode('UTF-8'))
 
         tmp_file_status = [os.path.getsize(self._tmp_file), os.path.getmtime(self._tmp_file)]
         self._record["downloadParts"] = self._split_object()
         self._record["objectStatus"] = object_status
@@ -592,18 +608,24 @@
             return False
         if record['tmpFileStatus'][0] != self.size:
             return False
         return True
 
     def _split_object(self):
         downloadParts = []
-        num_counts = int(self.size / self.partSize)
+        try:
+            num_counts = int(self.size / self.partSize)
+        except ZeroDivisionError:
+            print("You can't divide by 0!")
         if num_counts >= 10000:
             self.partSize = int(self.size / 10000) if self.size % 10000 == 0 else int(self.size / 10000) + 1
-            num_counts = int(self.size / self.partSize)
+            try:
+                num_counts = int(self.size / self.partSize)
+            except ZeroDivisionError:
+                print("You can't divide by 0!")
         if self.size % self.partSize != 0:
             num_counts += 1
         start = 0
         for i in range(1, num_counts + 1):
             end = start + util.to_long(self.partSize) if i != num_counts else util.to_long(self.size)
             part = Part(util.to_long(i), util.to_long(start), end - 1, False)
             start += self.partSize
```

### Comparing `esdk-obs-python-3.22.2/obs/util.py` & `esdk-obs-python-3.23.5/obs/util.py`

 * *Files 1% similar despite different names*

```diff
@@ -345,14 +345,31 @@
                 read_count_once = len(data)
                 if read_count_once <= 0:
                     break
                 m.update(data)
                 read_count += read_count_once
         return m.digest()
 
+def sha256_file_encode_by_size_offset(file_path=None, size=None, offset=None, chuckSize=None):
+    if file_path is not None and size is not None and offset is not None:
+        m = hashlib.sha256()
+        with open(file_path, 'rb') as fp:
+            CHUNK_SIZE = const.READ_ONCE_LENGTH if chuckSize is None else chuckSize
+            fp.seek(offset)
+            read_count = 0
+            while read_count < size:
+                read_size = CHUNK_SIZE if size - read_count >= CHUNK_SIZE else size - read_count
+                data = fp.read(read_size)
+                read_count_once = len(data)
+                if read_count_once <= 0:
+                    break
+                m.update(data)
+                read_count += read_count_once
+        return m.digest()
+
 
 def do_close(result, conn, connHolder, log_client=None):
     if not result:
         close_conn(conn, log_client)
     elif result.getheader('connection', '').lower() == 'close':
         if log_client:
             log_client.log(INFO, 'server inform to close connection')
```

### Comparing `esdk-obs-python-3.22.2/obs/workflow.py` & `esdk-obs-python-3.23.5/obs/workflow.py`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.22.2/setup.py` & `esdk-obs-python-3.23.5/setup.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,36 +1,36 @@
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-# use 'python setup.py bdist_egg' to generate the egg file package
-# use 'easy_install eggfile' to install the egg file to the python Lib
-# or
-# use 'python setup.py install' to install to the python Lib directly
-
-
-from setuptools import setup, find_packages
-
-setup(
-    name='esdk-obs-python',
-    version='3.22.2',
-    packages=find_packages(exclude=['tests']),
-    zip_safe=False,
-    description='OBS Python SDK',
-    long_description='OBS Python SDK',
-    license='Apache-2.0',
-    keywords=('obs', 'python'),
-    install_requires=[
-        'pycryptodome==3.10.1'
-    ],
-    platforms='Independant',
-    url='',
-)
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+# use 'python setup.py bdist_egg' to generate the egg file package
+# use 'easy_install eggfile' to install the egg file to the python Lib
+# or
+# use 'python setup.py install' to install to the python Lib directly
+
+
+from setuptools import setup, find_packages
+
+setup(
+    name='esdk-obs-python',
+    version='3.23.5',
+    packages=find_packages(exclude=['tests']),
+    zip_safe=False,
+    description='OBS Python SDK',
+    long_description='OBS Python SDK',
+    license='Apache-2.0',
+    keywords=('obs', 'python'),
+    install_requires=[
+        'pycryptodome==3.10.1'
+    ],
+    platforms='Independant',
+    url='',
+)
```


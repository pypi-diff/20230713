# Comparing `tmp/kcli-99.0.202307131409-py3-none-any.whl.zip` & `tmp/kcli-99.0.202307131510-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,615 +1,619 @@
-Zip file size: 1504413 bytes, number of entries: 613
--rw-r--r--  2.0 unx       15 b- defN 23-Jul-13 14:04 kvirt/__init__.py
--rw-r--r--  2.0 unx   100420 b- defN 23-Jul-13 14:04 kvirt/baseconfig.py
--rw-r--r--  2.0 unx   171487 b- defN 23-Jul-13 14:04 kvirt/bottle.py
--rw-r--r--  2.0 unx   260066 b- defN 23-Jul-13 14:04 kvirt/cli.py
--rw-r--r--  2.0 unx   193251 b- defN 23-Jul-13 14:04 kvirt/config.py
--rw-r--r--  2.0 unx     2851 b- defN 23-Jul-13 14:04 kvirt/containerconfig.py
--rw-r--r--  2.0 unx    11612 b- defN 23-Jul-13 14:04 kvirt/defaults.py
--rw-r--r--  2.0 unx     1475 b- defN 23-Jul-13 14:04 kvirt/ekstoken.py
--rw-r--r--  2.0 unx    21243 b- defN 23-Jul-13 14:04 kvirt/examples.py
--rw-r--r--  2.0 unx     1047 b- defN 23-Jul-13 14:04 kvirt/gketoken.py
--rw-r--r--  2.0 unx     4333 b- defN 23-Jul-13 14:04 kvirt/ignitionmerger.py
--rw-r--r--  2.0 unx     9871 b- defN 23-Jul-13 14:04 kvirt/keywords.yaml
--rw-r--r--  2.0 unx     3487 b- defN 23-Jul-13 14:04 kvirt/klist.py
--rw-r--r--  2.0 unx     6009 b- defN 23-Jul-13 14:04 kvirt/ansibleutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 14:04 kvirt/cluster/__init__.py
--rw-r--r--  2.0 unx      204 b- defN 23-Jul-13 14:04 kvirt/cluster/sampleprovider.py
--rw-r--r--  2.0 unx    12259 b- defN 23-Jul-13 14:04 kvirt/cluster/eks/__init__.py
--rw-r--r--  2.0 unx       16 b- defN 23-Jul-13 14:04 kvirt/cluster/eks/fake.yml
--rw-r--r--  2.0 unx      169 b- defN 23-Jul-13 14:04 kvirt/cluster/eks/kcli_default.yml
--rw-r--r--  2.0 unx    12218 b- defN 23-Jul-13 14:04 kvirt/cluster/gke/__init__.py
--rw-r--r--  2.0 unx       16 b- defN 23-Jul-13 14:04 kvirt/cluster/gke/fake.yml
--rw-r--r--  2.0 unx      497 b- defN 23-Jul-13 14:04 kvirt/cluster/gke/kcli_default.yml
--rw-r--r--  2.0 unx      405 b- defN 23-Jul-13 14:04 kvirt/cluster/gke/kubeconfig.j2
--rw-r--r--  2.0 unx      931 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/99-apps.yaml
--rw-r--r--  2.0 unx      694 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/99-forcedns
--rw-r--r--  2.0 unx     1480 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/99-notifications.yaml
--rw-r--r--  2.0 unx      653 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/Corefile
--rw-r--r--  2.0 unx    43967 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/__init__.py
--rw-r--r--  2.0 unx     1121 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/assisted_infra.yml
--rw-r--r--  2.0 unx     1269 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/assisted_ingress.yml
--rw-r--r--  2.0 unx     1366 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/autoapprovercron.yml
--rw-r--r--  2.0 unx     1106 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/bmc.yml.j2
--rw-r--r--  2.0 unx      511 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/calico.sh.j2
--rw-r--r--  2.0 unx      200 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/disconnected.sh
--rw-r--r--  2.0 unx      184 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/extras.service
--rw-r--r--  2.0 unx      839 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/extras.sh
--rw-r--r--  2.0 unx     3131 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/hostedcluster.yaml
--rw-r--r--  2.0 unx     1174 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/httpd.yaml
--rw-r--r--  2.0 unx     1110 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/ignition.sh
--rw-r--r--  2.0 unx     2307 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/kcli_plan.yml
--rw-r--r--  2.0 unx     2069 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      502 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/keepalived.conf
--rw-r--r--  2.0 unx     1587 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/nmstateconfig.yml.j2
--rw-r--r--  2.0 unx      752 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/nodepool.yaml
--rw-r--r--  2.0 unx       60 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/nonlocalbind.conf
--rw-r--r--  2.0 unx     1890 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/staticpods/coredns.yml
--rw-r--r--  2.0 unx     2142 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1619 b- defN 23-Jul-13 14:04 kvirt/cluster/hypershift/staticpods/mdns.yml
--rw-r--r--  2.0 unx    13621 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/__init__.py
--rw-r--r--  2.0 unx     1117 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/bootstrap.sh
--rw-r--r--  2.0 unx     1035 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/bootstrap.yml
--rw-r--r--  2.0 unx      441 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/cloud_lb_api.yml
--rw-r--r--  2.0 unx      440 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/ctlplanes.sh
--rw-r--r--  2.0 unx     1068 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/ctlplanes.yml
--rw-r--r--  2.0 unx      231 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/join.sh
--rw-r--r--  2.0 unx     1271 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/kcli_default.yml
--rw-r--r--  2.0 unx      511 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/keepalived.conf
--rw-r--r--  2.0 unx      352 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/keepalived.sh
--rw-r--r--  2.0 unx      166 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/workers.sh
--rw-r--r--  2.0 unx      709 b- defN 23-Jul-13 14:04 kvirt/cluster/k3s/workers.yml
--rw-r--r--  2.0 unx    14254 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/__init__.py
--rwxr-xr-x  2.0 unx     2772 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/bootstrap.sh
--rw-r--r--  2.0 unx     1550 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/bootstrap.yml
--rw-r--r--  2.0 unx      338 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/cloud_lb_api.yml
--rw-r--r--  2.0 unx     1172 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/ctlplanes.yml
--rwxr-xr-x  2.0 unx      343 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/deploy.sh
--rwxr-xr-x  2.0 unx      308 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/join.sh
--rw-r--r--  2.0 unx     1853 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/kcli_default.yml
--rw-r--r--  2.0 unx      563 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/keepalived.conf
--rw-r--r--  2.0 unx      424 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/keepalived.sh
--rw-r--r--  2.0 unx      140 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/kubernetes.repo
--rw-r--r--  2.0 unx      179 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/multus.sh
--rw-r--r--  2.0 unx     1751 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/nfs.sh
--rw-r--r--  2.0 unx      226 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/nfs.yml
--rw-r--r--  2.0 unx     4021 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/pre_el.sh
--rw-r--r--  2.0 unx     3906 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/pre_ubuntu.sh
--rw-r--r--  2.0 unx     2127 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/registry.yml
--rw-r--r--  2.0 unx      949 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/workers.yml
--rw-r--r--  2.0 unx      487 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
--rw-r--r--  2.0 unx     2134 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/argocd/install.sh
--rw-r--r--  2.0 unx       71 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx      314 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
--rw-r--r--  2.0 unx       90 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx       91 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      380 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/certmanager/install.sh
--rw-r--r--  2.0 unx      317 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
--rw-r--r--  2.0 unx      452 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/dashboard/install.sh
--rw-r--r--  2.0 unx       23 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
--rw-r--r--  2.0 unx      373 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/dashboard/user.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
--rw-r--r--  2.0 unx      185 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
--rw-r--r--  2.0 unx      839 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/falco/install.sh
--rw-r--r--  2.0 unx       57 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
--rw-r--r--  2.0 unx      133 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
--rw-r--r--  2.0 unx      175 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/ingress/install.sh
--rw-r--r--  2.0 unx      176 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
--rw-r--r--  2.0 unx      112 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/istio/install.sh
--rw-r--r--  2.0 unx      910 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
--rw-r--r--  2.0 unx      766 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
--rw-r--r--  2.0 unx      913 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
--rw-r--r--  2.0 unx      198 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
--rw-r--r--  2.0 unx      194 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
--rw-r--r--  2.0 unx      253 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/knative/install.sh
--rw-r--r--  2.0 unx      670 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
--rw-r--r--  2.0 unx       30 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
--rw-r--r--  2.0 unx      534 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/metallb/install.sh
--rw-r--r--  2.0 unx       47 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
--rw-r--r--  2.0 unx      150 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
--rw-r--r--  2.0 unx      283 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
--rw-r--r--  2.0 unx      348 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/olm/install.sh
--rw-r--r--  2.0 unx      350 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
--rw-r--r--  2.0 unx      320 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
--rw-r--r--  2.0 unx       34 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
--rw-r--r--  2.0 unx      322 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
--rw-r--r--  2.0 unx     1662 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/rancher/install.sh
--rw-r--r--  2.0 unx      103 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
--rw-r--r--  2.0 unx      161 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
--rw-r--r--  2.0 unx      191 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
--rw-r--r--  2.0 unx      151 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
--rw-r--r--  2.0 unx      572 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/rook/install.sh
--rw-r--r--  2.0 unx      190 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/submariner/install.sh
--rw-r--r--  2.0 unx       22 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
--rw-r--r--  2.0 unx      277 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/tekton/install.sh
--rw-r--r--  2.0 unx      278 b- defN 23-Jul-13 14:04 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
--rw-r--r--  2.0 unx     2970 b- defN 23-Jul-13 14:04 kvirt/cluster/kubecommon/__init__.py
--rw-r--r--  2.0 unx     9395 b- defN 23-Jul-13 14:04 kvirt/cluster/kubernetes/__init__.py
--rw-r--r--  2.0 unx     4782 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/__init__.py
--rw-r--r--  2.0 unx      603 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/kcli_plan.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      262 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/scripts/00_sslip.sh
--rw-r--r--  2.0 unx      799 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/scripts/01_clients.sh
--rw-r--r--  2.0 unx      183 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/scripts/02_crio.sh
--rw-r--r--  2.0 unx      538 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/scripts/03_microshift.sh
--rw-r--r--  2.0 unx      341 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
--rw-r--r--  2.0 unx     2252 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/scripts/05_acm.sh
--rw-r--r--  2.0 unx      696 b- defN 23-Jul-13 14:04 kvirt/cluster/microshift/scripts/deploy.sh
--rw-r--r--  2.0 unx      219 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/01-workload-partitioning
--rw-r--r--  2.0 unx      573 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/10-node-ip-hint.yaml
--rw-r--r--  2.0 unx      997 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-apps.yaml
--rw-r--r--  2.0 unx      618 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
--rw-r--r--  2.0 unx     1239 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
--rw-r--r--  2.0 unx      529 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-chrony.yaml
--rw-r--r--  2.0 unx      646 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-forcedns
--rw-r--r--  2.0 unx      476 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-forcedns-ibm
--rw-r--r--  2.0 unx      854 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-kubevirt-fix.yaml
--rw-r--r--  2.0 unx     1127 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-localhost-fix.yaml
--rw-r--r--  2.0 unx      250 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
--rw-r--r--  2.0 unx      162 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     1659 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-notifications.yaml
--rw-r--r--  2.0 unx      118 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-operatorhub.yaml
--rw-r--r--  2.0 unx      338 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-ovn.yaml
--rw-r--r--  2.0 unx      912 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/99-sno.yaml
--rw-r--r--  2.0 unx      762 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/Corefile
--rw-r--r--  2.0 unx    90217 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/__init__.py
--rw-r--r--  2.0 unx     1325 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/autoapprovercron.yml
--rw-r--r--  2.0 unx      987 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/autorules.yml
--rw-r--r--  2.0 unx     1630 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/bootstrap.yml
--rw-r--r--  2.0 unx      250 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/calico.sh.j2
--rw-r--r--  2.0 unx      107 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/chrony.conf
--rw-r--r--  2.0 unx      629 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/cloud_bootstrap.yml
--rw-r--r--  2.0 unx      792 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/cloud_ctlplanes.yml
--rw-r--r--  2.0 unx      217 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/cloud_dns.yml
--rw-r--r--  2.0 unx      616 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/cloud_lb_api.yml
--rw-r--r--  2.0 unx      224 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx      703 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/cloud_workers.yml
--rw-r--r--  2.0 unx      123 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/cluster-ingress-02-config.yml
--rw-r--r--  2.0 unx      159 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
--rw-r--r--  2.0 unx      224 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/config.hcl.templ
--rw-r--r--  2.0 unx       98 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/contrail-ca-patch.service
--rw-r--r--  2.0 unx      486 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/contrail-ca-patch.sh
--rw-r--r--  2.0 unx       87 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/contrail.auth
--rw-r--r--  2.0 unx     1108 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/contrail.sh.j2
--rw-r--r--  2.0 unx     2278 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/ctlplanes.yml
--rw-r--r--  2.0 unx      326 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/dhcp.conf
--rw-r--r--  2.0 unx      106 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/dhcp.sh
--rw-r--r--  2.0 unx      536 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/dhcp.yml
--rw-r--r--  2.0 unx      836 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected.yml
--rw-r--r--  2.0 unx     8945 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/fake_kubeconfig.json
--rw-r--r--  2.0 unx       35 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/fake_pull.json
--rw-r--r--  2.0 unx     1792 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/haproxy.cfg
--rw-r--r--  2.0 unx     2483 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/haproxy.cfg.kubevirt
--rw-r--r--  2.0 unx      902 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/httpd.yaml
--rw-r--r--  2.0 unx      524 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/ignition.j2
--rw-r--r--  2.0 unx     4084 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/install-config.yaml
--rw-r--r--  2.0 unx     2691 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/iso.sh
--rw-r--r--  2.0 unx      237 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/kcli-ipv6.conf.j2
--rw-r--r--  2.0 unx     4499 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/kcli_default.yml
--rw-r--r--  2.0 unx      982 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/keepalived.conf
--rw-r--r--  2.0 unx       60 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/nonlocalbind.conf
--rw-r--r--  2.0 unx       59 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/openshift-workload-pinning
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/relocate-ip-bootstrap.service
--rw-r--r--  2.0 unx      281 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/relocate-ip-bootstrap.sh
--rw-r--r--  2.0 unx      690 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/relocate-ip.sh
--rw-r--r--  2.0 unx      212 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/sno-finish.service
--rw-r--r--  2.0 unx     2085 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/sno-finish.sh
--rw-r--r--  2.0 unx      660 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/sno.yml
--rw-r--r--  2.0 unx     1615 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/workers.yml
--rw-r--r--  2.0 unx       40 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/cr.sh
--rw-r--r--  2.0 unx      768 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/install.yml.j2
--rw-r--r--  2.0 unx      162 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2913 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2838 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
--rw-r--r--  2.0 unx      418 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
--rw-r--r--  2.0 unx      290 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
--rw-r--r--  2.0 unx     1219 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
--rw-r--r--  2.0 unx      645 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/argocd/configmap.yml
--rw-r--r--  2.0 unx     2423 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/argocd/install.sh
--rw-r--r--  2.0 unx       49 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx     1093 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/autolabeller/cr.yml
--rw-r--r--  2.0 unx      142 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx     1093 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/autolabeller/install.yml
--rw-r--r--  2.0 unx      165 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
--rw-r--r--  2.0 unx       25 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      873 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
--rw-r--r--  2.0 unx       63 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
--rw-r--r--  2.0 unx      265 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/istio/install.sh
--rw-r--r--  2.0 unx      377 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
--rw-r--r--  2.0 unx     1039 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
--rw-r--r--  2.0 unx      154 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
--rw-r--r--  2.0 unx      775 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
--rw-r--r--  2.0 unx      227 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
--rw-r--r--  2.0 unx      642 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
--rw-r--r--  2.0 unx      349 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
--rw-r--r--  2.0 unx      137 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
--rw-r--r--  2.0 unx      595 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/lvms-operator/post.sh
--rw-r--r--  2.0 unx      510 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
--rw-r--r--  2.0 unx       94 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
--rw-r--r--  2.0 unx      162 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2913 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2845 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
--rw-r--r--  2.0 unx      245 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
--rw-r--r--  2.0 unx      149 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
--rwxr-xr-x  2.0 unx       55 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
--rwxr-xr-x  2.0 unx     2298 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/nfs/install.sh
--rw-r--r--  2.0 unx      117 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
--rw-r--r--  2.0 unx      185 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/nfs/uninstall.sh
--rw-r--r--  2.0 unx      849 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/odf-operator/cr.yml
--rw-r--r--  2.0 unx      298 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
--rw-r--r--  2.0 unx      364 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
--rw-r--r--  2.0 unx      362 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
--rw-r--r--  2.0 unx      745 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/odf-operator/post.sh
--rw-r--r--  2.0 unx      530 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/odf-operator/pre.sh
--rw-r--r--  2.0 unx      363 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
--rw-r--r--  2.0 unx      278 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/serverless-operator/post.sh
--rw-r--r--  2.0 unx     1227 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/users/install.sh
--rw-r--r--  2.0 unx       84 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/users/kcli_default.yml
--rw-r--r--  2.0 unx      258 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/users/oauth.yml
--rw-r--r--  2.0 unx      249 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
--rw-r--r--  2.0 unx      422 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/apps/users/uninstall.sh
--rw-r--r--  2.0 unx       60 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
--rw-r--r--  2.0 unx       91 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
--rw-r--r--  2.0 unx      264 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
--rw-r--r--  2.0 unx      911 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
--rw-r--r--  2.0 unx      389 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
--rw-r--r--  2.0 unx      184 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/customisation/99-monitoring.yaml
--rw-r--r--  2.0 unx      289 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/customisation/99-registry.yaml
--rw-r--r--  2.0 unx     1685 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/haproxy.cfg
--rw-r--r--  2.0 unx      211 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/registry.service
--rwxr-xr-x  2.0 unx      328 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
--rwxr-xr-x  2.0 unx      201 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
--rwxr-xr-x  2.0 unx     2381 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
--rwxr-xr-x  2.0 unx     2046 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
--rwxr-xr-x  2.0 unx      337 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
--rwxr-xr-x  2.0 unx     2319 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
--rwxr-xr-x  2.0 unx      241 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
--rwxr-xr-x  2.0 unx      733 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
--rw-r--r--  2.0 unx     4223 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
--rw-r--r--  2.0 unx     2557 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/staticpods/coredns.yml
--rw-r--r--  2.0 unx      987 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/staticpods/haproxy.yml
--rw-r--r--  2.0 unx     2539 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1721 b- defN 23-Jul-13 14:04 kvirt/cluster/openshift/staticpods/mdns.yml
--rw-r--r--  2.0 unx      193 b- defN 23-Jul-13 14:04 kvirt/cluster/profiles/sample-kubeadm-default.yml
--rw-r--r--  2.0 unx      135 b- defN 23-Jul-13 14:04 kvirt/cluster/profiles/sample-openshift-compact.yml
--rw-r--r--  2.0 unx      210 b- defN 23-Jul-13 14:04 kvirt/cluster/profiles/sample-openshift-contrail.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 14:04 kvirt/cluster/profiles/sample-openshift-ipv6.yml
--rw-r--r--  2.0 unx       55 b- defN 23-Jul-13 14:04 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
--rw-r--r--  2.0 unx      148 b- defN 23-Jul-13 14:04 kvirt/cluster/profiles/sample-openshift-sno.yml
--rw-r--r--  2.0 unx     3377 b- defN 23-Jul-13 14:04 kvirt/common/Jenkinsfile.j2
--rw-r--r--  2.0 unx    99100 b- defN 23-Jul-13 14:04 kvirt/common/__init__.py
--rw-r--r--  2.0 unx     1406 b- defN 23-Jul-13 14:04 kvirt/common/autoscale.yaml.j2
--rw-r--r--  2.0 unx     8945 b- defN 23-Jul-13 14:04 kvirt/common/fake_kubeconfig.json
--rw-r--r--  2.0 unx      669 b- defN 23-Jul-13 14:04 kvirt/common/ignition.j2
--rw-r--r--  2.0 unx      125 b- defN 23-Jul-13 14:04 kvirt/common/kubevirt_kcli_conf.j2
--rw-r--r--  2.0 unx       99 b- defN 23-Jul-13 14:04 kvirt/common/local_kcli_conf.j2
--rw-r--r--  2.0 unx     3068 b- defN 23-Jul-13 14:04 kvirt/common/pipeline.yml.j2
--rw-r--r--  2.0 unx     2377 b- defN 23-Jul-13 14:04 kvirt/common/pipeline_kube.yml.j2
--rw-r--r--  2.0 unx     1381 b- defN 23-Jul-13 14:04 kvirt/common/playbook.j2
--rw-r--r--  2.0 unx      833 b- defN 23-Jul-13 14:04 kvirt/common/storage.sh.aws
--rw-r--r--  2.0 unx      635 b- defN 23-Jul-13 14:04 kvirt/common/storage.sh.gcp
--rw-r--r--  2.0 unx       68 b- defN 23-Jul-13 14:04 kvirt/common/storage.sh.ibmcloud
--rw-r--r--  2.0 unx     4562 b- defN 23-Jul-13 14:04 kvirt/common/vm.ovf.j2
--rw-r--r--  2.0 unx     2241 b- defN 23-Jul-13 14:04 kvirt/common/workflow.yml.j2
--rw-r--r--  2.0 unx     2208 b- defN 23-Jul-13 14:04 kvirt/common/workflow_script.yml.j2
--rw-r--r--  2.0 unx    15041 b- defN 23-Jul-13 14:04 kvirt/container/__init__.py
--rw-r--r--  2.0 unx    11716 b- defN 23-Jul-13 14:04 kvirt/expose/__init__.py
--rw-r--r--  2.0 unx     4319 b- defN 23-Jul-13 14:04 kvirt/expose/swagger.yml
--rw-r--r--  2.0 unx      408 b- defN 23-Jul-13 14:04 kvirt/expose/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx   121125 b- defN 23-Jul-13 14:04 kvirt/expose/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-Jul-13 14:04 kvirt/expose/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-Jul-13 14:04 kvirt/expose/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      868 b- defN 23-Jul-13 14:04 kvirt/expose/static/css/kcli.css
--rw-r--r--  2.0 unx      269 b- defN 23-Jul-13 14:04 kvirt/expose/static/css/wheel.css
--rw-r--r--  2.0 unx     1406 b- defN 23-Jul-13 14:04 kvirt/expose/static/images/favicon.ico
--rw-r--r--  2.0 unx      160 b- defN 23-Jul-13 14:04 kvirt/expose/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-Jul-13 14:04 kvirt/expose/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-Jul-13 14:04 kvirt/expose/static/images/sort_desc.png
--rw-r--r--  2.0 unx    24772 b- defN 23-Jul-13 14:04 kvirt/expose/static/images/wheel.gif
--rw-r--r--  2.0 unx    12398 b- defN 23-Jul-13 14:04 kvirt/expose/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx      367 b- defN 23-Jul-13 14:04 kvirt/expose/static/js/exposeactions.js
--rw-r--r--  2.0 unx    83059 b- defN 23-Jul-13 14:04 kvirt/expose/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    89795 b- defN 23-Jul-13 14:04 kvirt/expose/static/js/jquery.min.js
--rw-r--r--  2.0 unx      263 b- defN 23-Jul-13 14:04 kvirt/expose/static/js/list.js
--rw-r--r--  2.0 unx     1605 b- defN 23-Jul-13 14:04 kvirt/expose/templates/form.html
--rw-r--r--  2.0 unx     1035 b- defN 23-Jul-13 14:04 kvirt/expose/templates/head.html
--rw-r--r--  2.0 unx      406 b- defN 23-Jul-13 14:04 kvirt/expose/templates/index.html
--rw-r--r--  2.0 unx     1220 b- defN 23-Jul-13 14:04 kvirt/expose/templates/infoplan.html
--rw-r--r--  2.0 unx      574 b- defN 23-Jul-13 14:04 kvirt/expose/templates/planstable.html
--rw-r--r--  2.0 unx      550 b- defN 23-Jul-13 14:04 kvirt/expose/templates/result.html
--rw-r--r--  2.0 unx     1754 b- defN 23-Jul-13 14:04 kvirt/internalplans/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 14:04 kvirt/jinjafilters/__init__.py
--rw-r--r--  2.0 unx     5351 b- defN 23-Jul-13 14:04 kvirt/jinjafilters/jinjafilters.py
--rw-r--r--  2.0 unx     9018 b- defN 23-Jul-13 14:04 kvirt/kfish/__init__.py
--rw-r--r--  2.0 unx    10455 b- defN 23-Jul-13 14:04 kvirt/ksushy/__init__.py
--rw-r--r--  2.0 unx      121 b- defN 23-Jul-13 14:04 kvirt/ksushy/main.py
--rw-r--r--  2.0 unx     1028 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/bios.json
--rw-r--r--  2.0 unx      443 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/interface.json
--rw-r--r--  2.0 unx      418 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/interfaces.json
--rw-r--r--  2.0 unx     1050 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/manager.json
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/managers.json
--rw-r--r--  2.0 unx      554 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/root.json
--rw-r--r--  2.0 unx     2760 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/system.json
--rw-r--r--  2.0 unx      511 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/systems.json
--rw-r--r--  2.0 unx     1219 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/virtualmedia_cd.json
--rw-r--r--  2.0 unx      705 b- defN 23-Jul-13 14:04 kvirt/ksushy/templates/virtualmedias.json
--rw-r--r--  2.0 unx     2780 b- defN 23-Jul-13 14:04 kvirt/miniconsole/__init__.py
--rw-r--r--  2.0 unx     3733 b- defN 23-Jul-13 14:04 kvirt/nameutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 14:04 kvirt/providers/__init__.py
--rw-r--r--  2.0 unx     9038 b- defN 23-Jul-13 14:04 kvirt/providers/sampleprovider.py
--rw-r--r--  2.0 unx    71311 b- defN 23-Jul-13 14:04 kvirt/providers/aws/__init__.py
--rw-r--r--  2.0 unx      260 b- defN 23-Jul-13 14:04 kvirt/providers/aws/assume_policy.json
--rw-r--r--  2.0 unx     1764 b- defN 23-Jul-13 14:04 kvirt/providers/aws/ctlplane_policy.json
--rw-r--r--  2.0 unx      174 b- defN 23-Jul-13 14:04 kvirt/providers/aws/worker_policy.json
--rw-r--r--  2.0 unx      479 b- defN 23-Jul-13 14:04 kvirt/providers/fake/__init__.py
--rw-r--r--  2.0 unx    75004 b- defN 23-Jul-13 14:04 kvirt/providers/gcp/__init__.py
--rw-r--r--  2.0 unx      175 b- defN 23-Jul-13 14:04 kvirt/providers/gcp/gcp-hack.service
--rw-r--r--  2.0 unx      231 b- defN 23-Jul-13 14:04 kvirt/providers/gcp/gcp-hack.sh
--rw-r--r--  2.0 unx    65166 b- defN 23-Jul-13 14:04 kvirt/providers/ibm/__init__.py
--rw-r--r--  2.0 unx    81078 b- defN 23-Jul-13 14:04 kvirt/providers/kubevirt/__init__.py
--rw-r--r--  2.0 unx   186884 b- defN 23-Jul-13 14:04 kvirt/providers/kvm/__init__.py
--rw-r--r--  2.0 unx     1965 b- defN 23-Jul-13 14:04 kvirt/providers/kvm/helpers.py
--rw-r--r--  2.0 unx    57194 b- defN 23-Jul-13 14:04 kvirt/providers/openstack/__init__.py
--rw-r--r--  2.0 unx    62662 b- defN 23-Jul-13 14:04 kvirt/providers/ovirt/__init__.py
--rw-r--r--  2.0 unx    31230 b- defN 23-Jul-13 14:04 kvirt/providers/packet/__init__.py
--rw-r--r--  2.0 unx    29262 b- defN 23-Jul-13 14:04 kvirt/providers/proxmox/__init__.py
--rw-r--r--  2.0 unx    73215 b- defN 23-Jul-13 14:04 kvirt/providers/vsphere/__init__.py
--rw-r--r--  2.0 unx    13655 b- defN 23-Jul-13 14:04 kvirt/providers/vsphere/helpers.py
--rw-r--r--  2.0 unx     4893 b- defN 23-Jul-13 14:04 kvirt/providers/vsphere/tagging.py
--rw-r--r--  2.0 unx    21420 b- defN 23-Jul-13 14:04 kvirt/providers/web/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 14:04 kvirt/version/__init__.py
--rw-r--r--  2.0 unx       19 b- defN 23-Jul-13 14:09 kvirt/version/git
--rw-r--r--  2.0 unx    46652 b- defN 23-Jul-13 14:04 kvirt/web/__init__.py
--rw-r--r--  2.0 unx      261 b- defN 23-Jul-13 14:04 kvirt/web/main.py
--rw-r--r--  2.0 unx      408 b- defN 23-Jul-13 14:04 kvirt/web/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx    23409 b- defN 23-Jul-13 14:04 kvirt/web/static/css/bootstrap-theme.min.css
--rw-r--r--  2.0 unx   121125 b- defN 23-Jul-13 14:04 kvirt/web/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-Jul-13 14:04 kvirt/web/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-Jul-13 14:04 kvirt/web/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      816 b- defN 23-Jul-13 14:04 kvirt/web/static/css/kcli.css
--rw-r--r--  2.0 unx     3033 b- defN 23-Jul-13 14:04 kvirt/web/static/css/navbar.css
--rw-r--r--  2.0 unx     2908 b- defN 23-Jul-13 14:04 kvirt/web/static/css/spice.css
--rw-r--r--  2.0 unx      271 b- defN 23-Jul-13 14:04 kvirt/web/static/css/wheel.css
--rw-r--r--  2.0 unx    18028 b- defN 23-Jul-13 14:04 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
--rw-r--r--  2.0 unx      715 b- defN 23-Jul-13 14:04 kvirt/web/static/images/Centos.png
--rw-r--r--  2.0 unx      294 b- defN 23-Jul-13 14:04 kvirt/web/static/images/Debian.png
--rw-r--r--  2.0 unx      987 b- defN 23-Jul-13 14:04 kvirt/web/static/images/Fedora.png
--rw-r--r--  2.0 unx      672 b- defN 23-Jul-13 14:04 kvirt/web/static/images/Redhat.png
--rw-r--r--  2.0 unx     1278 b- defN 23-Jul-13 14:04 kvirt/web/static/images/Suse.png
--rw-r--r--  2.0 unx     1782 b- defN 23-Jul-13 14:04 kvirt/web/static/images/Tux.png
--rw-r--r--  2.0 unx      544 b- defN 23-Jul-13 14:04 kvirt/web/static/images/Ubuntu.png
--rw-r--r--  2.0 unx     4213 b- defN 23-Jul-13 14:04 kvirt/web/static/images/delete.png
--rw-r--r--  2.0 unx     1406 b- defN 23-Jul-13 14:04 kvirt/web/static/images/favicon.ico
--rw-r--r--  2.0 unx    23320 b- defN 23-Jul-13 14:04 kvirt/web/static/images/kcli-small.png
--rw-r--r--  2.0 unx    27185 b- defN 23-Jul-13 14:04 kvirt/web/static/images/kcli.jpg
--rw-r--r--  2.0 unx   113928 b- defN 23-Jul-13 14:04 kvirt/web/static/images/kcli.png
--rw-r--r--  2.0 unx    48809 b- defN 23-Jul-13 14:04 kvirt/web/static/images/logo-header.svg
--rw-r--r--  2.0 unx    48809 b- defN 23-Jul-13 14:04 kvirt/web/static/images/logo-main.svg
--rw-r--r--  2.0 unx      160 b- defN 23-Jul-13 14:04 kvirt/web/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-Jul-13 14:04 kvirt/web/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-Jul-13 14:04 kvirt/web/static/images/sort_desc.png
--rw-r--r--  2.0 unx     3927 b- defN 23-Jul-13 14:04 kvirt/web/static/images/start.png
--rw-r--r--  2.0 unx     3631 b- defN 23-Jul-13 14:04 kvirt/web/static/images/stop.png
--rw-r--r--  2.0 unx    24772 b- defN 23-Jul-13 14:04 kvirt/web/static/images/wheel.gif
--rw-r--r--  2.0 unx     2933 b- defN 23-Jul-13 14:04 kvirt/web/static/js/bootstrap-notify.js
--rw-r--r--  2.0 unx    37045 b- defN 23-Jul-13 14:04 kvirt/web/static/js/bootstrap.min.js
--rw-r--r--  2.0 unx     2523 b- defN 23-Jul-13 14:04 kvirt/web/static/js/containeraction.js
--rw-r--r--  2.0 unx    12398 b- defN 23-Jul-13 14:04 kvirt/web/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx     1642 b- defN 23-Jul-13 14:04 kvirt/web/static/js/hostaction.js
--rw-r--r--  2.0 unx     1187 b- defN 23-Jul-13 14:04 kvirt/web/static/js/imageaction.js
--rw-r--r--  2.0 unx    83059 b- defN 23-Jul-13 14:04 kvirt/web/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    87462 b- defN 23-Jul-13 14:04 kvirt/web/static/js/jquery.min.js
--rw-r--r--  2.0 unx     2704 b- defN 23-Jul-13 14:04 kvirt/web/static/js/kcli.js
--rw-r--r--  2.0 unx     1594 b- defN 23-Jul-13 14:04 kvirt/web/static/js/kubeaction.js
--rw-r--r--  2.0 unx     3907 b- defN 23-Jul-13 14:04 kvirt/web/static/js/list.js
--rw-r--r--  2.0 unx     1376 b- defN 23-Jul-13 14:04 kvirt/web/static/js/networkaction.js
--rw-r--r--  2.0 unx     2457 b- defN 23-Jul-13 14:04 kvirt/web/static/js/planaction.js
--rw-r--r--  2.0 unx     1237 b- defN 23-Jul-13 14:04 kvirt/web/static/js/poolaction.js
--rw-r--r--  2.0 unx      846 b- defN 23-Jul-13 14:04 kvirt/web/static/js/productaction.js
--rw-r--r--  2.0 unx      270 b- defN 23-Jul-13 14:04 kvirt/web/static/js/refresh.js
--rw-r--r--  2.0 unx     1835 b- defN 23-Jul-13 14:04 kvirt/web/static/js/repoaction.js
--rw-r--r--  2.0 unx     3463 b- defN 23-Jul-13 14:04 kvirt/web/static/js/snapshotaction.js
--rw-r--r--  2.0 unx     2745 b- defN 23-Jul-13 14:04 kvirt/web/static/js/vmaction.js
--rw-r--r--  2.0 unx      123 b- defN 23-Jul-13 14:04 kvirt/web/static/js/wheel.js
--rw-r--r--  2.0 unx     9944 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/atKeynames.js
--rw-r--r--  2.0 unx     2335 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/bitmap.js
--rw-r--r--  2.0 unx     4795 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/cursor.js
--rw-r--r--  2.0 unx    49214 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/display.js
--rw-r--r--  2.0 unx    13253 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/enums.js
--rw-r--r--  2.0 unx     2847 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/filexfer.js
--rw-r--r--  2.0 unx     9535 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/inputs.js
--rw-r--r--  2.0 unx     6176 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/lz.js
--rw-r--r--  2.0 unx    18370 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/main.js
--rw-r--r--  2.0 unx    12677 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/playback.js
--rw-r--r--  2.0 unx     7036 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/png.js
--rw-r--r--  2.0 unx     3110 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/port.js
--rw-r--r--  2.0 unx    44531 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/quic.js
--rw-r--r--  2.0 unx     3030 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/resize.js
--rw-r--r--  2.0 unx     7282 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/simulatecursor.js
--rw-r--r--  2.0 unx     1895 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/spicearraybuffer.js
--rw-r--r--  2.0 unx    18202 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/spiceconn.js
--rw-r--r--  2.0 unx     3616 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/spicedataview.js
--rw-r--r--  2.0 unx    33015 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/spicemsg.js
--rw-r--r--  2.0 unx    12767 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/spicetype.js
--rw-r--r--  2.0 unx     6808 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/ticket.js
--rw-r--r--  2.0 unx    13628 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/utils.js
--rw-r--r--  2.0 unx    21577 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/webm.js
--rw-r--r--  2.0 unx     4131 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/wire.js
--rw-r--r--  2.0 unx    16580 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/jsbn.js
--rw-r--r--  2.0 unx     2529 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/prng4.js
--rw-r--r--  2.0 unx     3442 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/rng.js
--rw-r--r--  2.0 unx     4257 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/rsa.js
--rw-r--r--  2.0 unx    10671 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/sha1.js
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
--rw-r--r--  2.0 unx      419 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      359 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8601 b- defN 23-Jul-13 14:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     2176 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/error-handler.js
--rw-r--r--  2.0 unx     5682 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/localization.js
--rw-r--r--  2.0 unx    56845 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/ui.js
--rw-r--r--  2.0 unx     6696 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/webutil.js
--rw-r--r--  2.0 unx     3553 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/alt.svg
--rw-r--r--  2.0 unx     3980 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/clipboard.svg
--rw-r--r--  2.0 unx     3430 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/connect.svg
--rw-r--r--  2.0 unx     4381 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/ctrl.svg
--rw-r--r--  2.0 unx     3237 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
--rw-r--r--  2.0 unx     5062 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/disconnect.svg
--rw-r--r--  2.0 unx     4684 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/drag.svg
--rw-r--r--  2.0 unx     3106 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/error.svg
--rw-r--r--  2.0 unx     4522 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/esc.svg
--rw-r--r--  2.0 unx     3066 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/expander.svg
--rw-r--r--  2.0 unx     3139 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/fullscreen.svg
--rw-r--r--  2.0 unx     2559 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/handle.svg
--rw-r--r--  2.0 unx     6386 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/handle_bg.svg
--rw-r--r--  2.0 unx     3204 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/info.svg
--rw-r--r--  2.0 unx     6404 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/keyboard.svg
--rw-r--r--  2.0 unx     7000 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/mouse_left.svg
--rw-r--r--  2.0 unx     7002 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/mouse_middle.svg
--rw-r--r--  2.0 unx     6993 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/mouse_none.svg
--rw-r--r--  2.0 unx     7001 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/mouse_right.svg
--rw-r--r--  2.0 unx     3985 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/power.svg
--rw-r--r--  2.0 unx     3082 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/settings.svg
--rw-r--r--  2.0 unx     2953 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/tab.svg
--rw-r--r--  2.0 unx     4441 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
--rw-r--r--  2.0 unx     3869 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/warning.svg
--rw-r--r--  2.0 unx     3178 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/windows.svg
--rw-r--r--  2.0 unx      871 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/Makefile
--rw-r--r--  2.0 unx     4028 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
--rw-r--r--  2.0 unx     4582 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
--rw-r--r--  2.0 unx     5216 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
--rw-r--r--  2.0 unx      675 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
--rw-r--r--  2.0 unx     5787 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
--rw-r--r--  2.0 unx     1000 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
--rw-r--r--  2.0 unx     1064 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
--rw-r--r--  2.0 unx     1397 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
--rw-r--r--  2.0 unx     1932 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
--rw-r--r--  2.0 unx     1946 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
--rw-r--r--  2.0 unx     2699 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
--rw-r--r--  2.0 unx     2874 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
--rw-r--r--  2.0 unx     2351 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
--rw-r--r--  2.0 unx    11685 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
--rw-r--r--  2.0 unx    11549 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
--rw-r--r--  2.0 unx     2885 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/cs.json
--rw-r--r--  2.0 unx     2854 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/de.json
--rw-r--r--  2.0 unx     3906 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/el.json
--rw-r--r--  2.0 unx     2671 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/es.json
--rw-r--r--  2.0 unx     3354 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/ja.json
--rw-r--r--  2.0 unx     2961 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/ko.json
--rw-r--r--  2.0 unx     3035 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/nl.json
--rw-r--r--  2.0 unx     2830 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/pl.json
--rw-r--r--  2.0 unx     3825 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/ru.json
--rw-r--r--  2.0 unx     2845 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/sv.json
--rw-r--r--  2.0 unx     2811 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/tr.json
--rw-r--r--  2.0 unx     2597 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/zh_CN.json
--rw-r--r--  2.0 unx     2606 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/locale/zh_TW.json
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/sounds/CREDITS
--rw-r--r--  2.0 unx     4531 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/sounds/bell.mp3
--rw-r--r--  2.0 unx     8495 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/sounds/bell.oga
--rw-r--r--  2.0 unx    38580 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
--rw-r--r--  2.0 unx    17472 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/styles/Orbitron700.woff
--rw-r--r--  2.0 unx    18450 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/app/styles/base.css
--rw-r--r--  2.0 unx     4189 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/base64.js
--rw-r--r--  2.0 unx    11241 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/des.js
--rw-r--r--  2.0 unx    20381 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/display.js
--rw-r--r--  2.0 unx     1374 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/encodings.js
--rw-r--r--  2.0 unx     1170 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/inflator.js
--rw-r--r--  2.0 unx    74196 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/rfb.js
--rw-r--r--  2.0 unx     9130 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/websock.js
--rw-r--r--  2.0 unx      628 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/decoders/copyrect.js
--rw-r--r--  2.0 unx     4814 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/decoders/hextile.js
--rw-r--r--  2.0 unx     1739 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/decoders/raw.js
--rw-r--r--  2.0 unx     1210 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/decoders/rre.js
--rw-r--r--  2.0 unx     9662 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/decoders/tight.js
--rw-r--r--  2.0 unx      768 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/decoders/tightpng.js
--rw-r--r--  2.0 unx    11438 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/domkeytable.js
--rw-r--r--  2.0 unx     3804 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/fixedkeys.js
--rw-r--r--  2.0 unx    13090 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/keyboard.js
--rw-r--r--  2.0 unx    34609 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/keysym.js
--rw-r--r--  2.0 unx    25374 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/keysymdef.js
--rw-r--r--  2.0 unx     9995 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/mouse.js
--rw-r--r--  2.0 unx     5283 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/util.js
--rw-r--r--  2.0 unx     2580 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/vkeys.js
--rw-r--r--  2.0 unx    14256 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/input/xtscancodes.js
--rw-r--r--  2.0 unx     3155 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/util/browser.js
--rw-r--r--  2.0 unx     7556 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/util/cursor.js
--rw-r--r--  2.0 unx     4221 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/util/events.js
--rw-r--r--  2.0 unx      896 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/util/eventtarget.js
--rw-r--r--  2.0 unx     1358 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/util/logging.js
--rw-r--r--  2.0 unx     1866 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/util/polyfill.js
--rw-r--r--  2.0 unx      301 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/core/util/strings.js
--rw-r--r--  2.0 unx     7388 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/promise.js
--rw-r--r--  2.0 unx      419 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      295 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8498 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     1084 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/LICENSE
--rw-r--r--  2.0 unx      301 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/README.md
--rw-r--r--  2.0 unx     1062 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
--rw-r--r--  2.0 unx      666 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
--rw-r--r--  2.0 unx     1334 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
--rw-r--r--  2.0 unx      764 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
--rw-r--r--  2.0 unx    60016 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
--rw-r--r--  2.0 unx     1251 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
--rw-r--r--  2.0 unx    11690 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
--rw-r--r--  2.0 unx    47128 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
--rw-r--r--  2.0 unx    11527 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
--rw-r--r--  2.0 unx      560 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
--rw-r--r--  2.0 unx    38767 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
--rw-r--r--  2.0 unx      823 b- defN 23-Jul-13 14:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
--rw-r--r--  2.0 unx     2509 b- defN 23-Jul-13 14:04 kvirt/web/templates/bootstrap.html
--rw-r--r--  2.0 unx    14595 b- defN 23-Jul-13 14:04 kvirt/web/templates/console.html
--rw-r--r--  2.0 unx      717 b- defN 23-Jul-13 14:04 kvirt/web/templates/containercreate.html
--rw-r--r--  2.0 unx      493 b- defN 23-Jul-13 14:04 kvirt/web/templates/containerprofiles.html
--rw-r--r--  2.0 unx     1050 b- defN 23-Jul-13 14:04 kvirt/web/templates/containerprofilestable.html
--rw-r--r--  2.0 unx      490 b- defN 23-Jul-13 14:04 kvirt/web/templates/containers.html
--rw-r--r--  2.0 unx     1746 b- defN 23-Jul-13 14:04 kvirt/web/templates/containerstable.html
--rw-r--r--  2.0 unx     2123 b- defN 23-Jul-13 14:04 kvirt/web/templates/head.html
--rw-r--r--  2.0 unx      473 b- defN 23-Jul-13 14:04 kvirt/web/templates/hosts.html
--rw-r--r--  2.0 unx     1705 b- defN 23-Jul-13 14:04 kvirt/web/templates/hoststable.html
--rw-r--r--  2.0 unx     1119 b- defN 23-Jul-13 14:04 kvirt/web/templates/imagecreate.html
--rw-r--r--  2.0 unx      478 b- defN 23-Jul-13 14:04 kvirt/web/templates/images.html
--rw-r--r--  2.0 unx      646 b- defN 23-Jul-13 14:04 kvirt/web/templates/imagestable.html
--rw-r--r--  2.0 unx      472 b- defN 23-Jul-13 14:04 kvirt/web/templates/isos.html
--rw-r--r--  2.0 unx      261 b- defN 23-Jul-13 14:04 kvirt/web/templates/isostable.html
--rw-r--r--  2.0 unx      609 b- defN 23-Jul-13 14:04 kvirt/web/templates/kubecreate.html
--rw-r--r--  2.0 unx      622 b- defN 23-Jul-13 14:04 kvirt/web/templates/kubeinfo.html
--rw-r--r--  2.0 unx      488 b- defN 23-Jul-13 14:04 kvirt/web/templates/kubeprofiles.html
--rw-r--r--  2.0 unx      845 b- defN 23-Jul-13 14:04 kvirt/web/templates/kubeprofilestable.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jul-13 14:04 kvirt/web/templates/kubes.html
--rw-r--r--  2.0 unx     1850 b- defN 23-Jul-13 14:04 kvirt/web/templates/kubestable.html
--rw-r--r--  2.0 unx      151 b- defN 23-Jul-13 14:04 kvirt/web/templates/layout.html
--rw-r--r--  2.0 unx     5517 b- defN 23-Jul-13 14:04 kvirt/web/templates/navbar.html
--rw-r--r--  2.0 unx      882 b- defN 23-Jul-13 14:04 kvirt/web/templates/networkcreate.html
--rw-r--r--  2.0 unx      537 b- defN 23-Jul-13 14:04 kvirt/web/templates/networks.html
--rw-r--r--  2.0 unx      845 b- defN 23-Jul-13 14:04 kvirt/web/templates/networkstable.html
--rw-r--r--  2.0 unx      750 b- defN 23-Jul-13 14:04 kvirt/web/templates/plancreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jul-13 14:04 kvirt/web/templates/plans.html
--rw-r--r--  2.0 unx     1525 b- defN 23-Jul-13 14:04 kvirt/web/templates/planstable.html
--rw-r--r--  2.0 unx      859 b- defN 23-Jul-13 14:04 kvirt/web/templates/poolcreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jul-13 14:04 kvirt/web/templates/pools.html
--rw-r--r--  2.0 unx      554 b- defN 23-Jul-13 14:04 kvirt/web/templates/poolstable.html
--rw-r--r--  2.0 unx     1282 b- defN 23-Jul-13 14:04 kvirt/web/templates/productcreate.html
--rw-r--r--  2.0 unx      484 b- defN 23-Jul-13 14:04 kvirt/web/templates/products.html
--rw-r--r--  2.0 unx      895 b- defN 23-Jul-13 14:04 kvirt/web/templates/productstable.html
--rw-r--r--  2.0 unx      699 b- defN 23-Jul-13 14:04 kvirt/web/templates/repocreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jul-13 14:04 kvirt/web/templates/repos.html
--rw-r--r--  2.0 unx     1203 b- defN 23-Jul-13 14:04 kvirt/web/templates/repostable.html
--rw-r--r--  2.0 unx      958 b- defN 23-Jul-13 14:04 kvirt/web/templates/vmcreate.html
--rw-r--r--  2.0 unx      486 b- defN 23-Jul-13 14:04 kvirt/web/templates/vmprofiles.html
--rw-r--r--  2.0 unx     1420 b- defN 23-Jul-13 14:04 kvirt/web/templates/vmprofilestable.html
--rw-r--r--  2.0 unx      470 b- defN 23-Jul-13 14:04 kvirt/web/templates/vms.html
--rw-r--r--  2.0 unx     4894 b- defN 23-Jul-13 14:04 kvirt/web/templates/vmstable.html
--rw-r--r--  2.0 unx    11358 b- defN 23-Jul-13 14:09 kcli-99.0.202307131409.dist-info/LICENSE
--rw-r--r--  2.0 unx     3118 b- defN 23-Jul-13 14:09 kcli-99.0.202307131409.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-13 14:09 kcli-99.0.202307131409.dist-info/WHEEL
--rw-r--r--  2.0 unx      281 b- defN 23-Jul-13 14:09 kcli-99.0.202307131409.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-Jul-13 14:09 kcli-99.0.202307131409.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    60012 b- defN 23-Jul-13 14:09 kcli-99.0.202307131409.dist-info/RECORD
-613 files, 4667496 bytes uncompressed, 1407055 bytes compressed:  69.9%
+Zip file size: 1519658 bytes, number of entries: 617
+-rw-r--r--  2.0 unx       15 b- defN 23-Jul-13 15:04 kvirt/__init__.py
+-rw-r--r--  2.0 unx   100420 b- defN 23-Jul-13 15:04 kvirt/baseconfig.py
+-rw-r--r--  2.0 unx   171487 b- defN 23-Jul-13 15:04 kvirt/bottle.py
+-rw-r--r--  2.0 unx   264818 b- defN 23-Jul-13 15:04 kvirt/cli.py
+-rw-r--r--  2.0 unx   198839 b- defN 23-Jul-13 15:04 kvirt/config.py
+-rw-r--r--  2.0 unx     2851 b- defN 23-Jul-13 15:04 kvirt/containerconfig.py
+-rw-r--r--  2.0 unx    11612 b- defN 23-Jul-13 15:04 kvirt/defaults.py
+-rw-r--r--  2.0 unx     1475 b- defN 23-Jul-13 15:04 kvirt/ekstoken.py
+-rw-r--r--  2.0 unx    21622 b- defN 23-Jul-13 15:04 kvirt/examples.py
+-rw-r--r--  2.0 unx     1047 b- defN 23-Jul-13 15:04 kvirt/gketoken.py
+-rw-r--r--  2.0 unx     4333 b- defN 23-Jul-13 15:04 kvirt/ignitionmerger.py
+-rw-r--r--  2.0 unx     9871 b- defN 23-Jul-13 15:04 kvirt/keywords.yaml
+-rw-r--r--  2.0 unx     3487 b- defN 23-Jul-13 15:04 kvirt/klist.py
+-rw-r--r--  2.0 unx     6009 b- defN 23-Jul-13 15:04 kvirt/ansibleutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 15:04 kvirt/cluster/__init__.py
+-rw-r--r--  2.0 unx      204 b- defN 23-Jul-13 15:04 kvirt/cluster/sampleprovider.py
+-rw-r--r--  2.0 unx     9366 b- defN 23-Jul-13 15:04 kvirt/cluster/aks/__init__.py
+-rw-r--r--  2.0 unx       16 b- defN 23-Jul-13 15:04 kvirt/cluster/aks/fake.yml
+-rw-r--r--  2.0 unx      369 b- defN 23-Jul-13 15:04 kvirt/cluster/aks/kcli_default.yml
+-rw-r--r--  2.0 unx    12259 b- defN 23-Jul-13 15:04 kvirt/cluster/eks/__init__.py
+-rw-r--r--  2.0 unx       16 b- defN 23-Jul-13 15:04 kvirt/cluster/eks/fake.yml
+-rw-r--r--  2.0 unx      173 b- defN 23-Jul-13 15:04 kvirt/cluster/eks/kcli_default.yml
+-rw-r--r--  2.0 unx    12218 b- defN 23-Jul-13 15:04 kvirt/cluster/gke/__init__.py
+-rw-r--r--  2.0 unx       16 b- defN 23-Jul-13 15:04 kvirt/cluster/gke/fake.yml
+-rw-r--r--  2.0 unx      497 b- defN 23-Jul-13 15:04 kvirt/cluster/gke/kcli_default.yml
+-rw-r--r--  2.0 unx      405 b- defN 23-Jul-13 15:04 kvirt/cluster/gke/kubeconfig.j2
+-rw-r--r--  2.0 unx      931 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/99-apps.yaml
+-rw-r--r--  2.0 unx      694 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/99-forcedns
+-rw-r--r--  2.0 unx     1480 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/99-notifications.yaml
+-rw-r--r--  2.0 unx      653 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/Corefile
+-rw-r--r--  2.0 unx    43976 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/__init__.py
+-rw-r--r--  2.0 unx     1121 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/assisted_infra.yml
+-rw-r--r--  2.0 unx     1269 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/assisted_ingress.yml
+-rw-r--r--  2.0 unx     1366 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/autoapprovercron.yml
+-rw-r--r--  2.0 unx     1106 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/bmc.yml.j2
+-rw-r--r--  2.0 unx      511 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/calico.sh.j2
+-rw-r--r--  2.0 unx      200 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/disconnected.sh
+-rw-r--r--  2.0 unx      184 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/extras.service
+-rw-r--r--  2.0 unx      839 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/extras.sh
+-rw-r--r--  2.0 unx     3131 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/hostedcluster.yaml
+-rw-r--r--  2.0 unx     1174 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/httpd.yaml
+-rw-r--r--  2.0 unx     1110 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/ignition.sh
+-rw-r--r--  2.0 unx     2307 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/kcli_plan.yml
+-rw-r--r--  2.0 unx     2069 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      502 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/keepalived.conf
+-rw-r--r--  2.0 unx     1587 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/nmstateconfig.yml.j2
+-rw-r--r--  2.0 unx      752 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/nodepool.yaml
+-rw-r--r--  2.0 unx       60 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/nonlocalbind.conf
+-rw-r--r--  2.0 unx     1890 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx     2142 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1619 b- defN 23-Jul-13 15:04 kvirt/cluster/hypershift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx    13637 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/__init__.py
+-rw-r--r--  2.0 unx     1117 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/bootstrap.sh
+-rw-r--r--  2.0 unx     1035 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/bootstrap.yml
+-rw-r--r--  2.0 unx      441 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      440 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/ctlplanes.sh
+-rw-r--r--  2.0 unx     1068 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/ctlplanes.yml
+-rw-r--r--  2.0 unx      231 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/join.sh
+-rw-r--r--  2.0 unx     1271 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/kcli_default.yml
+-rw-r--r--  2.0 unx      511 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/keepalived.conf
+-rw-r--r--  2.0 unx      352 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/keepalived.sh
+-rw-r--r--  2.0 unx      166 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/workers.sh
+-rw-r--r--  2.0 unx      709 b- defN 23-Jul-13 15:04 kvirt/cluster/k3s/workers.yml
+-rw-r--r--  2.0 unx    14263 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/__init__.py
+-rwxr-xr-x  2.0 unx     2772 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/bootstrap.sh
+-rw-r--r--  2.0 unx     1550 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/bootstrap.yml
+-rw-r--r--  2.0 unx      338 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/cloud_lb_api.yml
+-rw-r--r--  2.0 unx     1172 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/ctlplanes.yml
+-rwxr-xr-x  2.0 unx      343 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/deploy.sh
+-rwxr-xr-x  2.0 unx      308 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/join.sh
+-rw-r--r--  2.0 unx     1853 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/kcli_default.yml
+-rw-r--r--  2.0 unx      563 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/keepalived.conf
+-rw-r--r--  2.0 unx      424 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/keepalived.sh
+-rw-r--r--  2.0 unx      140 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/kubernetes.repo
+-rw-r--r--  2.0 unx      179 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/multus.sh
+-rw-r--r--  2.0 unx     1751 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/nfs.sh
+-rw-r--r--  2.0 unx      226 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/nfs.yml
+-rw-r--r--  2.0 unx     4021 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/pre_el.sh
+-rw-r--r--  2.0 unx     3906 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/pre_ubuntu.sh
+-rw-r--r--  2.0 unx     2127 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/registry.yml
+-rw-r--r--  2.0 unx      949 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/workers.yml
+-rw-r--r--  2.0 unx      487 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
+-rw-r--r--  2.0 unx     2134 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       71 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx      314 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
+-rw-r--r--  2.0 unx       90 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx       91 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      380 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/certmanager/install.sh
+-rw-r--r--  2.0 unx      317 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
+-rw-r--r--  2.0 unx      452 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/dashboard/install.sh
+-rw-r--r--  2.0 unx       23 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
+-rw-r--r--  2.0 unx      373 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/dashboard/user.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
+-rw-r--r--  2.0 unx      839 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/falco/install.sh
+-rw-r--r--  2.0 unx       57 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
+-rw-r--r--  2.0 unx      133 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
+-rw-r--r--  2.0 unx      175 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/ingress/install.sh
+-rw-r--r--  2.0 unx      176 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
+-rw-r--r--  2.0 unx      112 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/istio/install.sh
+-rw-r--r--  2.0 unx      910 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
+-rw-r--r--  2.0 unx      766 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
+-rw-r--r--  2.0 unx      913 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
+-rw-r--r--  2.0 unx      198 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
+-rw-r--r--  2.0 unx      194 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
+-rw-r--r--  2.0 unx      253 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/knative/install.sh
+-rw-r--r--  2.0 unx      670 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
+-rw-r--r--  2.0 unx       30 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
+-rw-r--r--  2.0 unx      534 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/metallb/install.sh
+-rw-r--r--  2.0 unx       47 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
+-rw-r--r--  2.0 unx      150 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
+-rw-r--r--  2.0 unx      283 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
+-rw-r--r--  2.0 unx      348 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/olm/install.sh
+-rw-r--r--  2.0 unx      350 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
+-rw-r--r--  2.0 unx      320 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
+-rw-r--r--  2.0 unx       34 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
+-rw-r--r--  2.0 unx      322 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
+-rw-r--r--  2.0 unx     1662 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/rancher/install.sh
+-rw-r--r--  2.0 unx      103 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
+-rw-r--r--  2.0 unx      161 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
+-rw-r--r--  2.0 unx      191 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
+-rw-r--r--  2.0 unx      151 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/rook/install.sh
+-rw-r--r--  2.0 unx      190 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/submariner/install.sh
+-rw-r--r--  2.0 unx       22 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
+-rw-r--r--  2.0 unx      277 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/tekton/install.sh
+-rw-r--r--  2.0 unx      278 b- defN 23-Jul-13 15:04 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
+-rw-r--r--  2.0 unx     2970 b- defN 23-Jul-13 15:04 kvirt/cluster/kubecommon/__init__.py
+-rw-r--r--  2.0 unx     9395 b- defN 23-Jul-13 15:04 kvirt/cluster/kubernetes/__init__.py
+-rw-r--r--  2.0 unx     4782 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/__init__.py
+-rw-r--r--  2.0 unx      603 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/kcli_plan.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      262 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/scripts/00_sslip.sh
+-rw-r--r--  2.0 unx      799 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/scripts/01_clients.sh
+-rw-r--r--  2.0 unx      183 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/scripts/02_crio.sh
+-rw-r--r--  2.0 unx      538 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/scripts/03_microshift.sh
+-rw-r--r--  2.0 unx      341 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
+-rw-r--r--  2.0 unx     2252 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/scripts/05_acm.sh
+-rw-r--r--  2.0 unx      696 b- defN 23-Jul-13 15:04 kvirt/cluster/microshift/scripts/deploy.sh
+-rw-r--r--  2.0 unx      219 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/01-workload-partitioning
+-rw-r--r--  2.0 unx      573 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/10-node-ip-hint.yaml
+-rw-r--r--  2.0 unx      997 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-apps.yaml
+-rw-r--r--  2.0 unx      618 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
+-rw-r--r--  2.0 unx     1239 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
+-rw-r--r--  2.0 unx      529 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-chrony.yaml
+-rw-r--r--  2.0 unx      646 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-forcedns
+-rw-r--r--  2.0 unx      476 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-forcedns-ibm
+-rw-r--r--  2.0 unx      854 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-kubevirt-fix.yaml
+-rw-r--r--  2.0 unx     1127 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-localhost-fix.yaml
+-rw-r--r--  2.0 unx      250 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
+-rw-r--r--  2.0 unx      162 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     1659 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-notifications.yaml
+-rw-r--r--  2.0 unx      118 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-operatorhub.yaml
+-rw-r--r--  2.0 unx      338 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-ovn.yaml
+-rw-r--r--  2.0 unx      912 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/99-sno.yaml
+-rw-r--r--  2.0 unx      762 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/Corefile
+-rw-r--r--  2.0 unx    90226 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/__init__.py
+-rw-r--r--  2.0 unx     1325 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/autoapprovercron.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/autorules.yml
+-rw-r--r--  2.0 unx     1630 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/bootstrap.yml
+-rw-r--r--  2.0 unx      250 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/calico.sh.j2
+-rw-r--r--  2.0 unx      107 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/chrony.conf
+-rw-r--r--  2.0 unx      629 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/cloud_bootstrap.yml
+-rw-r--r--  2.0 unx      792 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/cloud_ctlplanes.yml
+-rw-r--r--  2.0 unx      217 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/cloud_dns.yml
+-rw-r--r--  2.0 unx      616 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx      703 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/cloud_workers.yml
+-rw-r--r--  2.0 unx      123 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/cluster-ingress-02-config.yml
+-rw-r--r--  2.0 unx      159 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/config.hcl.templ
+-rw-r--r--  2.0 unx       98 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/contrail-ca-patch.service
+-rw-r--r--  2.0 unx      486 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/contrail-ca-patch.sh
+-rw-r--r--  2.0 unx       87 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/contrail.auth
+-rw-r--r--  2.0 unx     1108 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/contrail.sh.j2
+-rw-r--r--  2.0 unx     2278 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/ctlplanes.yml
+-rw-r--r--  2.0 unx      326 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/dhcp.conf
+-rw-r--r--  2.0 unx      106 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/dhcp.sh
+-rw-r--r--  2.0 unx      536 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/dhcp.yml
+-rw-r--r--  2.0 unx      836 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected.yml
+-rw-r--r--  2.0 unx     8945 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/fake_kubeconfig.json
+-rw-r--r--  2.0 unx       35 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/fake_pull.json
+-rw-r--r--  2.0 unx     1792 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/haproxy.cfg
+-rw-r--r--  2.0 unx     2483 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/haproxy.cfg.kubevirt
+-rw-r--r--  2.0 unx      902 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/httpd.yaml
+-rw-r--r--  2.0 unx      524 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/ignition.j2
+-rw-r--r--  2.0 unx     4084 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/install-config.yaml
+-rw-r--r--  2.0 unx     2691 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/iso.sh
+-rw-r--r--  2.0 unx      237 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/kcli-ipv6.conf.j2
+-rw-r--r--  2.0 unx     4499 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/kcli_default.yml
+-rw-r--r--  2.0 unx      982 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/keepalived.conf
+-rw-r--r--  2.0 unx       60 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/nonlocalbind.conf
+-rw-r--r--  2.0 unx       59 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/openshift-workload-pinning
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/relocate-ip-bootstrap.service
+-rw-r--r--  2.0 unx      281 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/relocate-ip-bootstrap.sh
+-rw-r--r--  2.0 unx      690 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/relocate-ip.sh
+-rw-r--r--  2.0 unx      212 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/sno-finish.service
+-rw-r--r--  2.0 unx     2085 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/sno-finish.sh
+-rw-r--r--  2.0 unx      660 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/sno.yml
+-rw-r--r--  2.0 unx     1615 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/workers.yml
+-rw-r--r--  2.0 unx       40 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/cr.sh
+-rw-r--r--  2.0 unx      768 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/install.yml.j2
+-rw-r--r--  2.0 unx      162 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2913 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2838 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
+-rw-r--r--  2.0 unx      418 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
+-rw-r--r--  2.0 unx      290 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
+-rw-r--r--  2.0 unx     1219 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
+-rw-r--r--  2.0 unx      645 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/argocd/configmap.yml
+-rw-r--r--  2.0 unx     2423 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       49 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx     1093 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/autolabeller/cr.yml
+-rw-r--r--  2.0 unx      142 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx     1093 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/autolabeller/install.yml
+-rw-r--r--  2.0 unx      165 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
+-rw-r--r--  2.0 unx       25 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      873 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
+-rw-r--r--  2.0 unx       63 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
+-rw-r--r--  2.0 unx      265 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/istio/install.sh
+-rw-r--r--  2.0 unx      377 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
+-rw-r--r--  2.0 unx     1039 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
+-rw-r--r--  2.0 unx      154 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
+-rw-r--r--  2.0 unx      775 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
+-rw-r--r--  2.0 unx      227 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      642 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
+-rw-r--r--  2.0 unx      349 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
+-rw-r--r--  2.0 unx      137 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      595 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/lvms-operator/post.sh
+-rw-r--r--  2.0 unx      510 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
+-rw-r--r--  2.0 unx       94 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      162 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2913 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2845 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
+-rw-r--r--  2.0 unx      245 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
+-rw-r--r--  2.0 unx      149 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
+-rwxr-xr-x  2.0 unx       55 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
+-rwxr-xr-x  2.0 unx     2298 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/nfs/install.sh
+-rw-r--r--  2.0 unx      117 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/nfs/uninstall.sh
+-rw-r--r--  2.0 unx      849 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/odf-operator/cr.yml
+-rw-r--r--  2.0 unx      298 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      364 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
+-rw-r--r--  2.0 unx      362 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
+-rw-r--r--  2.0 unx      745 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/odf-operator/post.sh
+-rw-r--r--  2.0 unx      530 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/odf-operator/pre.sh
+-rw-r--r--  2.0 unx      363 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      278 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/serverless-operator/post.sh
+-rw-r--r--  2.0 unx     1227 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/users/install.sh
+-rw-r--r--  2.0 unx       84 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/users/kcli_default.yml
+-rw-r--r--  2.0 unx      258 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/users/oauth.yml
+-rw-r--r--  2.0 unx      249 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
+-rw-r--r--  2.0 unx      422 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/apps/users/uninstall.sh
+-rw-r--r--  2.0 unx       60 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
+-rw-r--r--  2.0 unx       91 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
+-rw-r--r--  2.0 unx      264 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
+-rw-r--r--  2.0 unx      911 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
+-rw-r--r--  2.0 unx      389 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
+-rw-r--r--  2.0 unx      184 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/customisation/99-monitoring.yaml
+-rw-r--r--  2.0 unx      289 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/customisation/99-registry.yaml
+-rw-r--r--  2.0 unx     1685 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/haproxy.cfg
+-rw-r--r--  2.0 unx      211 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/registry.service
+-rwxr-xr-x  2.0 unx      328 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
+-rwxr-xr-x  2.0 unx      201 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
+-rwxr-xr-x  2.0 unx     2381 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
+-rwxr-xr-x  2.0 unx     2046 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
+-rwxr-xr-x  2.0 unx      337 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
+-rwxr-xr-x  2.0 unx     2319 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
+-rwxr-xr-x  2.0 unx      241 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
+-rwxr-xr-x  2.0 unx      733 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
+-rw-r--r--  2.0 unx     4223 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
+-rw-r--r--  2.0 unx     2557 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/staticpods/haproxy.yml
+-rw-r--r--  2.0 unx     2539 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1721 b- defN 23-Jul-13 15:04 kvirt/cluster/openshift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx      193 b- defN 23-Jul-13 15:04 kvirt/cluster/profiles/sample-kubeadm-default.yml
+-rw-r--r--  2.0 unx      135 b- defN 23-Jul-13 15:04 kvirt/cluster/profiles/sample-openshift-compact.yml
+-rw-r--r--  2.0 unx      210 b- defN 23-Jul-13 15:04 kvirt/cluster/profiles/sample-openshift-contrail.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 15:04 kvirt/cluster/profiles/sample-openshift-ipv6.yml
+-rw-r--r--  2.0 unx       55 b- defN 23-Jul-13 15:04 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
+-rw-r--r--  2.0 unx      148 b- defN 23-Jul-13 15:04 kvirt/cluster/profiles/sample-openshift-sno.yml
+-rw-r--r--  2.0 unx     3377 b- defN 23-Jul-13 15:04 kvirt/common/Jenkinsfile.j2
+-rw-r--r--  2.0 unx    99452 b- defN 23-Jul-13 15:04 kvirt/common/__init__.py
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jul-13 15:04 kvirt/common/autoscale.yaml.j2
+-rw-r--r--  2.0 unx     8945 b- defN 23-Jul-13 15:04 kvirt/common/fake_kubeconfig.json
+-rw-r--r--  2.0 unx      669 b- defN 23-Jul-13 15:04 kvirt/common/ignition.j2
+-rw-r--r--  2.0 unx      125 b- defN 23-Jul-13 15:04 kvirt/common/kubevirt_kcli_conf.j2
+-rw-r--r--  2.0 unx       99 b- defN 23-Jul-13 15:04 kvirt/common/local_kcli_conf.j2
+-rw-r--r--  2.0 unx     3068 b- defN 23-Jul-13 15:04 kvirt/common/pipeline.yml.j2
+-rw-r--r--  2.0 unx     2377 b- defN 23-Jul-13 15:04 kvirt/common/pipeline_kube.yml.j2
+-rw-r--r--  2.0 unx     1381 b- defN 23-Jul-13 15:04 kvirt/common/playbook.j2
+-rw-r--r--  2.0 unx      833 b- defN 23-Jul-13 15:04 kvirt/common/storage.sh.aws
+-rw-r--r--  2.0 unx      635 b- defN 23-Jul-13 15:04 kvirt/common/storage.sh.gcp
+-rw-r--r--  2.0 unx       68 b- defN 23-Jul-13 15:04 kvirt/common/storage.sh.ibmcloud
+-rw-r--r--  2.0 unx     4562 b- defN 23-Jul-13 15:04 kvirt/common/vm.ovf.j2
+-rw-r--r--  2.0 unx     2241 b- defN 23-Jul-13 15:04 kvirt/common/workflow.yml.j2
+-rw-r--r--  2.0 unx     2208 b- defN 23-Jul-13 15:04 kvirt/common/workflow_script.yml.j2
+-rw-r--r--  2.0 unx    15041 b- defN 23-Jul-13 15:04 kvirt/container/__init__.py
+-rw-r--r--  2.0 unx    11716 b- defN 23-Jul-13 15:04 kvirt/expose/__init__.py
+-rw-r--r--  2.0 unx     4319 b- defN 23-Jul-13 15:04 kvirt/expose/swagger.yml
+-rw-r--r--  2.0 unx      408 b- defN 23-Jul-13 15:04 kvirt/expose/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-Jul-13 15:04 kvirt/expose/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-Jul-13 15:04 kvirt/expose/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-Jul-13 15:04 kvirt/expose/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      868 b- defN 23-Jul-13 15:04 kvirt/expose/static/css/kcli.css
+-rw-r--r--  2.0 unx      269 b- defN 23-Jul-13 15:04 kvirt/expose/static/css/wheel.css
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jul-13 15:04 kvirt/expose/static/images/favicon.ico
+-rw-r--r--  2.0 unx      160 b- defN 23-Jul-13 15:04 kvirt/expose/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-Jul-13 15:04 kvirt/expose/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-Jul-13 15:04 kvirt/expose/static/images/sort_desc.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-Jul-13 15:04 kvirt/expose/static/images/wheel.gif
+-rw-r--r--  2.0 unx    12398 b- defN 23-Jul-13 15:04 kvirt/expose/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx      367 b- defN 23-Jul-13 15:04 kvirt/expose/static/js/exposeactions.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-Jul-13 15:04 kvirt/expose/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    89795 b- defN 23-Jul-13 15:04 kvirt/expose/static/js/jquery.min.js
+-rw-r--r--  2.0 unx      263 b- defN 23-Jul-13 15:04 kvirt/expose/static/js/list.js
+-rw-r--r--  2.0 unx     1605 b- defN 23-Jul-13 15:04 kvirt/expose/templates/form.html
+-rw-r--r--  2.0 unx     1035 b- defN 23-Jul-13 15:04 kvirt/expose/templates/head.html
+-rw-r--r--  2.0 unx      406 b- defN 23-Jul-13 15:04 kvirt/expose/templates/index.html
+-rw-r--r--  2.0 unx     1220 b- defN 23-Jul-13 15:04 kvirt/expose/templates/infoplan.html
+-rw-r--r--  2.0 unx      574 b- defN 23-Jul-13 15:04 kvirt/expose/templates/planstable.html
+-rw-r--r--  2.0 unx      550 b- defN 23-Jul-13 15:04 kvirt/expose/templates/result.html
+-rw-r--r--  2.0 unx     1754 b- defN 23-Jul-13 15:04 kvirt/internalplans/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 15:04 kvirt/jinjafilters/__init__.py
+-rw-r--r--  2.0 unx     5351 b- defN 23-Jul-13 15:04 kvirt/jinjafilters/jinjafilters.py
+-rw-r--r--  2.0 unx     9018 b- defN 23-Jul-13 15:04 kvirt/kfish/__init__.py
+-rw-r--r--  2.0 unx    10455 b- defN 23-Jul-13 15:04 kvirt/ksushy/__init__.py
+-rw-r--r--  2.0 unx      121 b- defN 23-Jul-13 15:04 kvirt/ksushy/main.py
+-rw-r--r--  2.0 unx     1028 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/bios.json
+-rw-r--r--  2.0 unx      443 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/interface.json
+-rw-r--r--  2.0 unx      418 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/interfaces.json
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/manager.json
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/managers.json
+-rw-r--r--  2.0 unx      554 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/root.json
+-rw-r--r--  2.0 unx     2760 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/system.json
+-rw-r--r--  2.0 unx      511 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/systems.json
+-rw-r--r--  2.0 unx     1219 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/virtualmedia_cd.json
+-rw-r--r--  2.0 unx      705 b- defN 23-Jul-13 15:04 kvirt/ksushy/templates/virtualmedias.json
+-rw-r--r--  2.0 unx     2780 b- defN 23-Jul-13 15:04 kvirt/miniconsole/__init__.py
+-rw-r--r--  2.0 unx     3733 b- defN 23-Jul-13 15:04 kvirt/nameutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 15:04 kvirt/providers/__init__.py
+-rw-r--r--  2.0 unx     9082 b- defN 23-Jul-13 15:04 kvirt/providers/sampleprovider.py
+-rw-r--r--  2.0 unx    71336 b- defN 23-Jul-13 15:04 kvirt/providers/aws/__init__.py
+-rw-r--r--  2.0 unx      260 b- defN 23-Jul-13 15:04 kvirt/providers/aws/assume_policy.json
+-rw-r--r--  2.0 unx     1764 b- defN 23-Jul-13 15:04 kvirt/providers/aws/ctlplane_policy.json
+-rw-r--r--  2.0 unx      174 b- defN 23-Jul-13 15:04 kvirt/providers/aws/worker_policy.json
+-rw-r--r--  2.0 unx    55725 b- defN 23-Jul-13 15:04 kvirt/providers/azure/__init__.py
+-rw-r--r--  2.0 unx      479 b- defN 23-Jul-13 15:04 kvirt/providers/fake/__init__.py
+-rw-r--r--  2.0 unx    75060 b- defN 23-Jul-13 15:04 kvirt/providers/gcp/__init__.py
+-rw-r--r--  2.0 unx      175 b- defN 23-Jul-13 15:04 kvirt/providers/gcp/gcp-hack.service
+-rw-r--r--  2.0 unx      231 b- defN 23-Jul-13 15:04 kvirt/providers/gcp/gcp-hack.sh
+-rw-r--r--  2.0 unx    65205 b- defN 23-Jul-13 15:04 kvirt/providers/ibm/__init__.py
+-rw-r--r--  2.0 unx    81078 b- defN 23-Jul-13 15:04 kvirt/providers/kubevirt/__init__.py
+-rw-r--r--  2.0 unx   186846 b- defN 23-Jul-13 15:04 kvirt/providers/kvm/__init__.py
+-rw-r--r--  2.0 unx     1965 b- defN 23-Jul-13 15:04 kvirt/providers/kvm/helpers.py
+-rw-r--r--  2.0 unx    57194 b- defN 23-Jul-13 15:04 kvirt/providers/openstack/__init__.py
+-rw-r--r--  2.0 unx    62662 b- defN 23-Jul-13 15:04 kvirt/providers/ovirt/__init__.py
+-rw-r--r--  2.0 unx    31230 b- defN 23-Jul-13 15:04 kvirt/providers/packet/__init__.py
+-rw-r--r--  2.0 unx    29262 b- defN 23-Jul-13 15:04 kvirt/providers/proxmox/__init__.py
+-rw-r--r--  2.0 unx    73215 b- defN 23-Jul-13 15:04 kvirt/providers/vsphere/__init__.py
+-rw-r--r--  2.0 unx    13655 b- defN 23-Jul-13 15:04 kvirt/providers/vsphere/helpers.py
+-rw-r--r--  2.0 unx     4893 b- defN 23-Jul-13 15:04 kvirt/providers/vsphere/tagging.py
+-rw-r--r--  2.0 unx    21420 b- defN 23-Jul-13 15:04 kvirt/providers/web/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 15:04 kvirt/version/__init__.py
+-rw-r--r--  2.0 unx       19 b- defN 23-Jul-13 15:10 kvirt/version/git
+-rw-r--r--  2.0 unx    46652 b- defN 23-Jul-13 15:04 kvirt/web/__init__.py
+-rw-r--r--  2.0 unx      261 b- defN 23-Jul-13 15:04 kvirt/web/main.py
+-rw-r--r--  2.0 unx      408 b- defN 23-Jul-13 15:04 kvirt/web/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx    23409 b- defN 23-Jul-13 15:04 kvirt/web/static/css/bootstrap-theme.min.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-Jul-13 15:04 kvirt/web/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-Jul-13 15:04 kvirt/web/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-Jul-13 15:04 kvirt/web/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      816 b- defN 23-Jul-13 15:04 kvirt/web/static/css/kcli.css
+-rw-r--r--  2.0 unx     3033 b- defN 23-Jul-13 15:04 kvirt/web/static/css/navbar.css
+-rw-r--r--  2.0 unx     2908 b- defN 23-Jul-13 15:04 kvirt/web/static/css/spice.css
+-rw-r--r--  2.0 unx      271 b- defN 23-Jul-13 15:04 kvirt/web/static/css/wheel.css
+-rw-r--r--  2.0 unx    18028 b- defN 23-Jul-13 15:04 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
+-rw-r--r--  2.0 unx      715 b- defN 23-Jul-13 15:04 kvirt/web/static/images/Centos.png
+-rw-r--r--  2.0 unx      294 b- defN 23-Jul-13 15:04 kvirt/web/static/images/Debian.png
+-rw-r--r--  2.0 unx      987 b- defN 23-Jul-13 15:04 kvirt/web/static/images/Fedora.png
+-rw-r--r--  2.0 unx      672 b- defN 23-Jul-13 15:04 kvirt/web/static/images/Redhat.png
+-rw-r--r--  2.0 unx     1278 b- defN 23-Jul-13 15:04 kvirt/web/static/images/Suse.png
+-rw-r--r--  2.0 unx     1782 b- defN 23-Jul-13 15:04 kvirt/web/static/images/Tux.png
+-rw-r--r--  2.0 unx      544 b- defN 23-Jul-13 15:04 kvirt/web/static/images/Ubuntu.png
+-rw-r--r--  2.0 unx     4213 b- defN 23-Jul-13 15:04 kvirt/web/static/images/delete.png
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jul-13 15:04 kvirt/web/static/images/favicon.ico
+-rw-r--r--  2.0 unx    23320 b- defN 23-Jul-13 15:04 kvirt/web/static/images/kcli-small.png
+-rw-r--r--  2.0 unx    27185 b- defN 23-Jul-13 15:04 kvirt/web/static/images/kcli.jpg
+-rw-r--r--  2.0 unx   113928 b- defN 23-Jul-13 15:04 kvirt/web/static/images/kcli.png
+-rw-r--r--  2.0 unx    48809 b- defN 23-Jul-13 15:04 kvirt/web/static/images/logo-header.svg
+-rw-r--r--  2.0 unx    48809 b- defN 23-Jul-13 15:04 kvirt/web/static/images/logo-main.svg
+-rw-r--r--  2.0 unx      160 b- defN 23-Jul-13 15:04 kvirt/web/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-Jul-13 15:04 kvirt/web/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-Jul-13 15:04 kvirt/web/static/images/sort_desc.png
+-rw-r--r--  2.0 unx     3927 b- defN 23-Jul-13 15:04 kvirt/web/static/images/start.png
+-rw-r--r--  2.0 unx     3631 b- defN 23-Jul-13 15:04 kvirt/web/static/images/stop.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-Jul-13 15:04 kvirt/web/static/images/wheel.gif
+-rw-r--r--  2.0 unx     2933 b- defN 23-Jul-13 15:04 kvirt/web/static/js/bootstrap-notify.js
+-rw-r--r--  2.0 unx    37045 b- defN 23-Jul-13 15:04 kvirt/web/static/js/bootstrap.min.js
+-rw-r--r--  2.0 unx     2523 b- defN 23-Jul-13 15:04 kvirt/web/static/js/containeraction.js
+-rw-r--r--  2.0 unx    12398 b- defN 23-Jul-13 15:04 kvirt/web/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx     1642 b- defN 23-Jul-13 15:04 kvirt/web/static/js/hostaction.js
+-rw-r--r--  2.0 unx     1187 b- defN 23-Jul-13 15:04 kvirt/web/static/js/imageaction.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-Jul-13 15:04 kvirt/web/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    87462 b- defN 23-Jul-13 15:04 kvirt/web/static/js/jquery.min.js
+-rw-r--r--  2.0 unx     2704 b- defN 23-Jul-13 15:04 kvirt/web/static/js/kcli.js
+-rw-r--r--  2.0 unx     1594 b- defN 23-Jul-13 15:04 kvirt/web/static/js/kubeaction.js
+-rw-r--r--  2.0 unx     3907 b- defN 23-Jul-13 15:04 kvirt/web/static/js/list.js
+-rw-r--r--  2.0 unx     1376 b- defN 23-Jul-13 15:04 kvirt/web/static/js/networkaction.js
+-rw-r--r--  2.0 unx     2457 b- defN 23-Jul-13 15:04 kvirt/web/static/js/planaction.js
+-rw-r--r--  2.0 unx     1237 b- defN 23-Jul-13 15:04 kvirt/web/static/js/poolaction.js
+-rw-r--r--  2.0 unx      846 b- defN 23-Jul-13 15:04 kvirt/web/static/js/productaction.js
+-rw-r--r--  2.0 unx      270 b- defN 23-Jul-13 15:04 kvirt/web/static/js/refresh.js
+-rw-r--r--  2.0 unx     1835 b- defN 23-Jul-13 15:04 kvirt/web/static/js/repoaction.js
+-rw-r--r--  2.0 unx     3463 b- defN 23-Jul-13 15:04 kvirt/web/static/js/snapshotaction.js
+-rw-r--r--  2.0 unx     2745 b- defN 23-Jul-13 15:04 kvirt/web/static/js/vmaction.js
+-rw-r--r--  2.0 unx      123 b- defN 23-Jul-13 15:04 kvirt/web/static/js/wheel.js
+-rw-r--r--  2.0 unx     9944 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/atKeynames.js
+-rw-r--r--  2.0 unx     2335 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/bitmap.js
+-rw-r--r--  2.0 unx     4795 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/cursor.js
+-rw-r--r--  2.0 unx    49214 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/display.js
+-rw-r--r--  2.0 unx    13253 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/enums.js
+-rw-r--r--  2.0 unx     2847 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/filexfer.js
+-rw-r--r--  2.0 unx     9535 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/inputs.js
+-rw-r--r--  2.0 unx     6176 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/lz.js
+-rw-r--r--  2.0 unx    18370 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/main.js
+-rw-r--r--  2.0 unx    12677 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/playback.js
+-rw-r--r--  2.0 unx     7036 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/png.js
+-rw-r--r--  2.0 unx     3110 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/port.js
+-rw-r--r--  2.0 unx    44531 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/quic.js
+-rw-r--r--  2.0 unx     3030 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/resize.js
+-rw-r--r--  2.0 unx     7282 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/simulatecursor.js
+-rw-r--r--  2.0 unx     1895 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/spicearraybuffer.js
+-rw-r--r--  2.0 unx    18202 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/spiceconn.js
+-rw-r--r--  2.0 unx     3616 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/spicedataview.js
+-rw-r--r--  2.0 unx    33015 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/spicemsg.js
+-rw-r--r--  2.0 unx    12767 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/spicetype.js
+-rw-r--r--  2.0 unx     6808 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/ticket.js
+-rw-r--r--  2.0 unx    13628 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/utils.js
+-rw-r--r--  2.0 unx    21577 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/webm.js
+-rw-r--r--  2.0 unx     4131 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/wire.js
+-rw-r--r--  2.0 unx    16580 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/jsbn.js
+-rw-r--r--  2.0 unx     2529 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/prng4.js
+-rw-r--r--  2.0 unx     3442 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/rng.js
+-rw-r--r--  2.0 unx     4257 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/rsa.js
+-rw-r--r--  2.0 unx    10671 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/sha1.js
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
+-rw-r--r--  2.0 unx      419 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      359 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8601 b- defN 23-Jul-13 15:04 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     2176 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/error-handler.js
+-rw-r--r--  2.0 unx     5682 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/localization.js
+-rw-r--r--  2.0 unx    56845 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/ui.js
+-rw-r--r--  2.0 unx     6696 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/webutil.js
+-rw-r--r--  2.0 unx     3553 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/alt.svg
+-rw-r--r--  2.0 unx     3980 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/clipboard.svg
+-rw-r--r--  2.0 unx     3430 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/connect.svg
+-rw-r--r--  2.0 unx     4381 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/ctrl.svg
+-rw-r--r--  2.0 unx     3237 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
+-rw-r--r--  2.0 unx     5062 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/disconnect.svg
+-rw-r--r--  2.0 unx     4684 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/drag.svg
+-rw-r--r--  2.0 unx     3106 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/error.svg
+-rw-r--r--  2.0 unx     4522 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/esc.svg
+-rw-r--r--  2.0 unx     3066 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/expander.svg
+-rw-r--r--  2.0 unx     3139 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/fullscreen.svg
+-rw-r--r--  2.0 unx     2559 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/handle.svg
+-rw-r--r--  2.0 unx     6386 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/handle_bg.svg
+-rw-r--r--  2.0 unx     3204 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/info.svg
+-rw-r--r--  2.0 unx     6404 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/keyboard.svg
+-rw-r--r--  2.0 unx     7000 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/mouse_left.svg
+-rw-r--r--  2.0 unx     7002 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/mouse_middle.svg
+-rw-r--r--  2.0 unx     6993 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/mouse_none.svg
+-rw-r--r--  2.0 unx     7001 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/mouse_right.svg
+-rw-r--r--  2.0 unx     3985 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/power.svg
+-rw-r--r--  2.0 unx     3082 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/settings.svg
+-rw-r--r--  2.0 unx     2953 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/tab.svg
+-rw-r--r--  2.0 unx     4441 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
+-rw-r--r--  2.0 unx     3869 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/warning.svg
+-rw-r--r--  2.0 unx     3178 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/windows.svg
+-rw-r--r--  2.0 unx      871 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/Makefile
+-rw-r--r--  2.0 unx     4028 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
+-rw-r--r--  2.0 unx     4582 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
+-rw-r--r--  2.0 unx     5216 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
+-rw-r--r--  2.0 unx      675 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
+-rw-r--r--  2.0 unx     5787 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
+-rw-r--r--  2.0 unx     1000 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
+-rw-r--r--  2.0 unx     1064 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
+-rw-r--r--  2.0 unx     1397 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
+-rw-r--r--  2.0 unx     1932 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
+-rw-r--r--  2.0 unx     1946 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
+-rw-r--r--  2.0 unx     2699 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
+-rw-r--r--  2.0 unx     2874 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
+-rw-r--r--  2.0 unx     2351 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
+-rw-r--r--  2.0 unx    11685 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
+-rw-r--r--  2.0 unx    11549 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
+-rw-r--r--  2.0 unx     2885 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/cs.json
+-rw-r--r--  2.0 unx     2854 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/de.json
+-rw-r--r--  2.0 unx     3906 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/el.json
+-rw-r--r--  2.0 unx     2671 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/es.json
+-rw-r--r--  2.0 unx     3354 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/ja.json
+-rw-r--r--  2.0 unx     2961 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/ko.json
+-rw-r--r--  2.0 unx     3035 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/nl.json
+-rw-r--r--  2.0 unx     2830 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/pl.json
+-rw-r--r--  2.0 unx     3825 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/ru.json
+-rw-r--r--  2.0 unx     2845 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/sv.json
+-rw-r--r--  2.0 unx     2811 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/tr.json
+-rw-r--r--  2.0 unx     2597 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/zh_CN.json
+-rw-r--r--  2.0 unx     2606 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/locale/zh_TW.json
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/sounds/CREDITS
+-rw-r--r--  2.0 unx     4531 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/sounds/bell.mp3
+-rw-r--r--  2.0 unx     8495 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/sounds/bell.oga
+-rw-r--r--  2.0 unx    38580 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
+-rw-r--r--  2.0 unx    17472 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/styles/Orbitron700.woff
+-rw-r--r--  2.0 unx    18450 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/app/styles/base.css
+-rw-r--r--  2.0 unx     4189 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/base64.js
+-rw-r--r--  2.0 unx    11241 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/des.js
+-rw-r--r--  2.0 unx    20381 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/display.js
+-rw-r--r--  2.0 unx     1374 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/encodings.js
+-rw-r--r--  2.0 unx     1170 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/inflator.js
+-rw-r--r--  2.0 unx    74196 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/rfb.js
+-rw-r--r--  2.0 unx     9130 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/websock.js
+-rw-r--r--  2.0 unx      628 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/decoders/copyrect.js
+-rw-r--r--  2.0 unx     4814 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/decoders/hextile.js
+-rw-r--r--  2.0 unx     1739 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/decoders/raw.js
+-rw-r--r--  2.0 unx     1210 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/decoders/rre.js
+-rw-r--r--  2.0 unx     9662 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/decoders/tight.js
+-rw-r--r--  2.0 unx      768 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/decoders/tightpng.js
+-rw-r--r--  2.0 unx    11438 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/domkeytable.js
+-rw-r--r--  2.0 unx     3804 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/fixedkeys.js
+-rw-r--r--  2.0 unx    13090 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/keyboard.js
+-rw-r--r--  2.0 unx    34609 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/keysym.js
+-rw-r--r--  2.0 unx    25374 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/keysymdef.js
+-rw-r--r--  2.0 unx     9995 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/mouse.js
+-rw-r--r--  2.0 unx     5283 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/util.js
+-rw-r--r--  2.0 unx     2580 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/vkeys.js
+-rw-r--r--  2.0 unx    14256 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/input/xtscancodes.js
+-rw-r--r--  2.0 unx     3155 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/util/browser.js
+-rw-r--r--  2.0 unx     7556 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/util/cursor.js
+-rw-r--r--  2.0 unx     4221 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/util/events.js
+-rw-r--r--  2.0 unx      896 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/util/eventtarget.js
+-rw-r--r--  2.0 unx     1358 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/util/logging.js
+-rw-r--r--  2.0 unx     1866 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/util/polyfill.js
+-rw-r--r--  2.0 unx      301 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/core/util/strings.js
+-rw-r--r--  2.0 unx     7388 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/promise.js
+-rw-r--r--  2.0 unx      419 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      295 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8498 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     1084 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/LICENSE
+-rw-r--r--  2.0 unx      301 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/README.md
+-rw-r--r--  2.0 unx     1062 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
+-rw-r--r--  2.0 unx      666 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
+-rw-r--r--  2.0 unx     1334 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
+-rw-r--r--  2.0 unx      764 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
+-rw-r--r--  2.0 unx    60016 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
+-rw-r--r--  2.0 unx     1251 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
+-rw-r--r--  2.0 unx    11690 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
+-rw-r--r--  2.0 unx    47128 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
+-rw-r--r--  2.0 unx    11527 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
+-rw-r--r--  2.0 unx      560 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
+-rw-r--r--  2.0 unx    38767 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
+-rw-r--r--  2.0 unx      823 b- defN 23-Jul-13 15:04 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
+-rw-r--r--  2.0 unx     2509 b- defN 23-Jul-13 15:04 kvirt/web/templates/bootstrap.html
+-rw-r--r--  2.0 unx    14595 b- defN 23-Jul-13 15:04 kvirt/web/templates/console.html
+-rw-r--r--  2.0 unx      717 b- defN 23-Jul-13 15:04 kvirt/web/templates/containercreate.html
+-rw-r--r--  2.0 unx      493 b- defN 23-Jul-13 15:04 kvirt/web/templates/containerprofiles.html
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jul-13 15:04 kvirt/web/templates/containerprofilestable.html
+-rw-r--r--  2.0 unx      490 b- defN 23-Jul-13 15:04 kvirt/web/templates/containers.html
+-rw-r--r--  2.0 unx     1746 b- defN 23-Jul-13 15:04 kvirt/web/templates/containerstable.html
+-rw-r--r--  2.0 unx     2123 b- defN 23-Jul-13 15:04 kvirt/web/templates/head.html
+-rw-r--r--  2.0 unx      473 b- defN 23-Jul-13 15:04 kvirt/web/templates/hosts.html
+-rw-r--r--  2.0 unx     1705 b- defN 23-Jul-13 15:04 kvirt/web/templates/hoststable.html
+-rw-r--r--  2.0 unx     1119 b- defN 23-Jul-13 15:04 kvirt/web/templates/imagecreate.html
+-rw-r--r--  2.0 unx      478 b- defN 23-Jul-13 15:04 kvirt/web/templates/images.html
+-rw-r--r--  2.0 unx      646 b- defN 23-Jul-13 15:04 kvirt/web/templates/imagestable.html
+-rw-r--r--  2.0 unx      472 b- defN 23-Jul-13 15:04 kvirt/web/templates/isos.html
+-rw-r--r--  2.0 unx      261 b- defN 23-Jul-13 15:04 kvirt/web/templates/isostable.html
+-rw-r--r--  2.0 unx      609 b- defN 23-Jul-13 15:04 kvirt/web/templates/kubecreate.html
+-rw-r--r--  2.0 unx      622 b- defN 23-Jul-13 15:04 kvirt/web/templates/kubeinfo.html
+-rw-r--r--  2.0 unx      488 b- defN 23-Jul-13 15:04 kvirt/web/templates/kubeprofiles.html
+-rw-r--r--  2.0 unx      845 b- defN 23-Jul-13 15:04 kvirt/web/templates/kubeprofilestable.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jul-13 15:04 kvirt/web/templates/kubes.html
+-rw-r--r--  2.0 unx     1850 b- defN 23-Jul-13 15:04 kvirt/web/templates/kubestable.html
+-rw-r--r--  2.0 unx      151 b- defN 23-Jul-13 15:04 kvirt/web/templates/layout.html
+-rw-r--r--  2.0 unx     5517 b- defN 23-Jul-13 15:04 kvirt/web/templates/navbar.html
+-rw-r--r--  2.0 unx      882 b- defN 23-Jul-13 15:04 kvirt/web/templates/networkcreate.html
+-rw-r--r--  2.0 unx      537 b- defN 23-Jul-13 15:04 kvirt/web/templates/networks.html
+-rw-r--r--  2.0 unx      845 b- defN 23-Jul-13 15:04 kvirt/web/templates/networkstable.html
+-rw-r--r--  2.0 unx      750 b- defN 23-Jul-13 15:04 kvirt/web/templates/plancreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jul-13 15:04 kvirt/web/templates/plans.html
+-rw-r--r--  2.0 unx     1525 b- defN 23-Jul-13 15:04 kvirt/web/templates/planstable.html
+-rw-r--r--  2.0 unx      859 b- defN 23-Jul-13 15:04 kvirt/web/templates/poolcreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jul-13 15:04 kvirt/web/templates/pools.html
+-rw-r--r--  2.0 unx      554 b- defN 23-Jul-13 15:04 kvirt/web/templates/poolstable.html
+-rw-r--r--  2.0 unx     1282 b- defN 23-Jul-13 15:04 kvirt/web/templates/productcreate.html
+-rw-r--r--  2.0 unx      484 b- defN 23-Jul-13 15:04 kvirt/web/templates/products.html
+-rw-r--r--  2.0 unx      895 b- defN 23-Jul-13 15:04 kvirt/web/templates/productstable.html
+-rw-r--r--  2.0 unx      699 b- defN 23-Jul-13 15:04 kvirt/web/templates/repocreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jul-13 15:04 kvirt/web/templates/repos.html
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jul-13 15:04 kvirt/web/templates/repostable.html
+-rw-r--r--  2.0 unx      958 b- defN 23-Jul-13 15:04 kvirt/web/templates/vmcreate.html
+-rw-r--r--  2.0 unx      486 b- defN 23-Jul-13 15:04 kvirt/web/templates/vmprofiles.html
+-rw-r--r--  2.0 unx     1420 b- defN 23-Jul-13 15:04 kvirt/web/templates/vmprofilestable.html
+-rw-r--r--  2.0 unx      470 b- defN 23-Jul-13 15:04 kvirt/web/templates/vms.html
+-rw-r--r--  2.0 unx     4894 b- defN 23-Jul-13 15:04 kvirt/web/templates/vmstable.html
+-rw-r--r--  2.0 unx    11358 b- defN 23-Jul-13 15:10 kcli-99.0.202307131510.dist-info/LICENSE
+-rw-r--r--  2.0 unx     4172 b- defN 23-Jul-13 15:10 kcli-99.0.202307131510.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-13 15:10 kcli-99.0.202307131510.dist-info/WHEEL
+-rw-r--r--  2.0 unx      281 b- defN 23-Jul-13 15:10 kcli-99.0.202307131510.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-Jul-13 15:10 kcli-99.0.202307131510.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    60360 b- defN 23-Jul-13 15:10 kcli-99.0.202307131510.dist-info/RECORD
+617 files, 4745618 bytes uncompressed, 1421752 bytes compressed:  70.0%
```

## zipnote {}

```diff
@@ -42,14 +42,23 @@
 
 Filename: kvirt/cluster/__init__.py
 Comment: 
 
 Filename: kvirt/cluster/sampleprovider.py
 Comment: 
 
+Filename: kvirt/cluster/aks/__init__.py
+Comment: 
+
+Filename: kvirt/cluster/aks/fake.yml
+Comment: 
+
+Filename: kvirt/cluster/aks/kcli_default.yml
+Comment: 
+
 Filename: kvirt/cluster/eks/__init__.py
 Comment: 
 
 Filename: kvirt/cluster/eks/fake.yml
 Comment: 
 
 Filename: kvirt/cluster/eks/kcli_default.yml
@@ -1038,14 +1047,17 @@
 
 Filename: kvirt/providers/aws/ctlplane_policy.json
 Comment: 
 
 Filename: kvirt/providers/aws/worker_policy.json
 Comment: 
 
+Filename: kvirt/providers/azure/__init__.py
+Comment: 
+
 Filename: kvirt/providers/fake/__init__.py
 Comment: 
 
 Filename: kvirt/providers/gcp/__init__.py
 Comment: 
 
 Filename: kvirt/providers/gcp/gcp-hack.service
@@ -1815,26 +1827,26 @@
 
 Filename: kvirt/web/templates/vms.html
 Comment: 
 
 Filename: kvirt/web/templates/vmstable.html
 Comment: 
 
-Filename: kcli-99.0.202307131409.dist-info/LICENSE
+Filename: kcli-99.0.202307131510.dist-info/LICENSE
 Comment: 
 
-Filename: kcli-99.0.202307131409.dist-info/METADATA
+Filename: kcli-99.0.202307131510.dist-info/METADATA
 Comment: 
 
-Filename: kcli-99.0.202307131409.dist-info/WHEEL
+Filename: kcli-99.0.202307131510.dist-info/WHEEL
 Comment: 
 
-Filename: kcli-99.0.202307131409.dist-info/entry_points.txt
+Filename: kcli-99.0.202307131510.dist-info/entry_points.txt
 Comment: 
 
-Filename: kcli-99.0.202307131409.dist-info/top_level.txt
+Filename: kcli-99.0.202307131510.dist-info/top_level.txt
 Comment: 
 
-Filename: kcli-99.0.202307131409.dist-info/RECORD
+Filename: kcli-99.0.202307131510.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## kvirt/cli.py

```diff
@@ -9,15 +9,15 @@
 from kvirt.examples import plandatacreate, vmdatacreate, hostcreate, _list, plancreate, planinfo, productinfo, start
 from kvirt.examples import repocreate, isocreate, networkupdate
 from kvirt.examples import kubegenericcreate, kubek3screate, kubeopenshiftcreate, kubemicroshiftcreate, kubegkecreate
 from kvirt.examples import dnscreate, diskcreate, diskdelete, vmcreate, vmconsole, vmexport, niccreate, nicdelete
 from kvirt.examples import disconnectedcreate, appopenshiftcreate, plantemplatecreate, kubehypershiftcreate
 from kvirt.examples import workflowcreate, kubegenericscale, kubek3sscale, kubeopenshiftscale, kubegkescale
 from kvirt.examples import changelog, starthosts, stophosts, infohosts, ocdownload, openshiftdownload, ocmirrordownload
-from kvirt.examples import kubeekscreate, kubeeksscale
+from kvirt.examples import kubeekscreate, kubeeksscale, kubeakscreate, kubeaksscale
 from kvirt.examples import networkcreate, securitygroupcreate, profilecreate, vmupdate, vmlist, providercreate
 from kvirt.baseconfig import Kbaseconfig
 from kvirt.containerconfig import Kcontainerconfig
 from kvirt.defaults import IMAGES, VERSION, LOCAL_OPENSHIFT_APPS, SSH_PUB_LOCATIONS, PLANTYPES
 from prettytable import PrettyTable
 import argcomplete
 import argparse
@@ -1837,14 +1837,20 @@
         sys.exit(0)
     else:
         if 'reason' in result:
             error(result['reason'])
         sys.exit(1)
 
 
+def create_aks_kube(args):
+    """Create Aks kube"""
+    args.type = 'aks'
+    create_kube(args)
+
+
 def create_eks_kube(args):
     """Create Eks kube"""
     args.type = 'eks'
     create_kube(args)
 
 
 def create_generic_kube(args):
@@ -1911,14 +1917,21 @@
         sys.exit(0)
     else:
         if 'reason' in result:
             error(result['reason'])
         sys.exit(1)
 
 
+def scale_aks_kube(args):
+    """Scale aks kube"""
+    args.type = 'aks'
+    args.ctlplanes = 0
+    scale_kube(args)
+
+
 def scale_eks_kube(args):
     """Scale eks kube"""
     args.type = 'eks'
     args.ctlplanes = 0
     scale_kube(args)
 
 
@@ -2290,20 +2303,22 @@
 def info_kube(args):
     if args.client == 'web':
         info_web_kube(args)
         return
     kubetype = args.kubetype
     output = args.global_output or args.output
     openshift = kubetype == 'openshift'
-    if kubetype in ['eks', 'gke']:
+    if kubetype in ['aks', 'eks', 'gke']:
         baseconfig = Kconfig(client=args.client, debug=args.debug, region=args.region, zone=args.zone,
                              namespace=args.namespace)
     else:
         baseconfig = Kbaseconfig(client=args.client, debug=args.debug, offline=True)
     if args.cluster is not None:
+        if kubetype == 'aks':
+            status = baseconfig.info_specific_aks(args.cluster)
         if kubetype == 'eks':
             status = baseconfig.info_specific_eks(args.cluster)
         elif kubetype == 'gke':
             status = baseconfig.info_specific_gke(args.cluster)
         else:
             status = baseconfig.info_specific_kube(args.cluster, openshift)
         if status is None or not status:
@@ -2325,14 +2340,16 @@
             baseconfig.info_kube_hypershift(quiet=True)
         elif kubetype == 'microshift':
             baseconfig.info_kube_microshift(quiet=True)
         elif kubetype == 'k3s':
             baseconfig.info_kube_k3s(quiet=True)
         elif kubetype == 'gke':
             baseconfig.info_kube_gke(quiet=True)
+        elif kubetype == 'aks':
+            baseconfig.info_kube_aks(quiet=True)
         elif kubetype == 'eks':
             baseconfig.info_kube_eks(quiet=True)
         else:
             baseconfig.info_kube_generic(quiet=True)
 
 
 def info_web_kube(args):
@@ -2349,14 +2366,19 @@
         kubetable.title = f"{status['version'].strip()}"
         for node in status['nodes']:
             kubetable.add_row(node)
         kubetable.align["Kube"] = "l"
         print(kubetable)
 
 
+def info_aks_kube(args):
+    args.kubetype = 'aks'
+    info_kube(args)
+
+
 def info_eks_kube(args):
     args.kubetype = 'eks'
     info_kube(args)
 
 
 def info_generic_kube(args):
     args.kubetype = 'generic'
@@ -2993,14 +3015,32 @@
     data['keypair'] = args.keypair
     common.create_host(data)
     baseconfig = Kbaseconfig(client=args.client, debug=args.debug, quiet=True)
     if len(baseconfig.clients) == 1:
         baseconfig.set_defaults()
 
 
+def create_host_azure(args):
+    """Create Azure Host"""
+    data = {}
+    data['name'] = args.name
+    data['_type'] = 'azure'
+    data['subscription_id'] = args.subscription_id
+    data['app_id'] = args.app_id
+    data['tenant_id'] = args.tenant_id
+    data['secret'] = args.secret
+    data['admin_password'] = args.admin_password
+    data['mail'] = args.mail
+    data['storageaccount'] = args.storageaccount
+    common.create_host(data)
+    baseconfig = Kbaseconfig(client=args.client, debug=args.debug, quiet=True)
+    if len(baseconfig.clients) == 1:
+        baseconfig.set_defaults()
+
+
 def create_host_ibm(args):
     """"Create IBM Cloud host"""
     data = {}
     data['name'] = args.name
     data['_type'] = 'ibm'
     data['iam_api_key'] = args.iam_api_key
     data['region'] = args.region
@@ -3592,14 +3632,30 @@
     awshostcreate_parser.add_argument('--access_key_secret', help='Access Key Secret', metavar='ACCESS_KEY_SECRET',
                                       required=True)
     awshostcreate_parser.add_argument('-k', '--keypair', help='Keypair', metavar='KEYPAIR', required=True)
     awshostcreate_parser.add_argument('-r', '--region', help='Region', metavar='REGION', required=True)
     awshostcreate_parser.add_argument('name', metavar='NAME')
     awshostcreate_parser.set_defaults(func=create_host_aws)
 
+    azurehostcreate_desc = 'Create Azure Host'
+    azurehostcreate_parser = hostcreate_subparsers.add_parser('azure', help=azurehostcreate_desc,
+                                                              description=azurehostcreate_desc)
+    azurehostcreate_parser.add_argument('--subscription_id', help='Subscription Id', metavar='SUBSCRIPTION_ID',
+                                        required=True)
+    azurehostcreate_parser.add_argument('--app_id', help='Application id', metavar='APPLICATION_ID', required=True)
+    azurehostcreate_parser.add_argument('--tenant_id', help='Tenant id', metavar='TENANT_ID', required=True)
+    azurehostcreate_parser.add_argument('-s', '--secret', help='Secret', metavar='SECRET', required=True)
+    azurehostcreate_parser.add_argument('--storageaccount', help='Storage Account', metavar='STORAGEACCOUNT',
+                                        required=True)
+    azurehostcreate_parser.add_argument('-a', '--admin_password', help='Admin Password', metavar='ADMINPASSWORD',
+                                        required=False)
+    azurehostcreate_parser.add_argument('-m', '--mail', help='Mail', metavar='MAIL', required=False)
+    azurehostcreate_parser.add_argument('name', metavar='NAME')
+    azurehostcreate_parser.set_defaults(func=create_host_azure)
+
     ibmhostcreate_desc = 'Create IBM Cloud Host'
     ibmhostcreate_parser = hostcreate_subparsers.add_parser('ibm', help=ibmhostcreate_desc,
                                                             description=ibmhostcreate_desc)
     ibmhostcreate_parser.add_argument('--iam_api_key', help='IAM API Key', metavar='IAM_API_KEY', required=True)
     ibmhostcreate_parser.add_argument('--access_key_id', help='Access Key Id', metavar='ACCESS_KEY_ID')
     ibmhostcreate_parser.add_argument('--access_key_secret', help='Access Key Secret', metavar='ACCESS_KEY_SECRET')
     ibmhostcreate_parser.add_argument('--vpc', help='VPC name', metavar='VPC')
@@ -3709,14 +3765,24 @@
     vspherehostcreate_parser.set_defaults(func=create_host_vsphere)
 
     kubecreate_desc = 'Create Kube'
     kubecreate_parser = create_subparsers.add_parser('kube', description=kubecreate_desc, help=kubecreate_desc,
                                                      aliases=['cluster'])
     kubecreate_subparsers = kubecreate_parser.add_subparsers(metavar='', dest='subcommand_create_kube')
 
+    kubeakscreate_desc = 'Create Aks Kube'
+    kubeakscreate_epilog = f"examples:\n{kubeakscreate}"
+    kubeakscreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubeakscreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
+    kubeakscreate_parser.add_argument('-t', '--threaded', help='Run threaded', action='store_true')
+    kubeakscreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubeakscreate_parser.set_defaults(func=create_aks_kube)
+    kubecreate_subparsers.add_parser('aks', parents=[kubeakscreate_parser], description=kubeakscreate_desc,
+                                     help=kubeakscreate_desc, epilog=kubeakscreate_epilog, formatter_class=rawhelp)
+
     kubeekscreate_desc = 'Create Eks Kube'
     kubeekscreate_epilog = f"examples:\n{kubeekscreate}"
     kubeekscreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubeekscreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
     kubeekscreate_parser.add_argument('-t', '--threaded', help='Run threaded', action='store_true')
     kubeekscreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubeekscreate_parser.set_defaults(func=create_eks_kube)
@@ -3835,14 +3901,20 @@
 
     awsprovidercreate_desc = 'Install Aws Provider'
     awsprovidercreate_parser = providercreate_subparsers.add_parser('aws', help=awsprovidercreate_desc,
                                                                     description=awsprovidercreate_desc)
     awsprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
     awsprovidercreate_parser.set_defaults(func=install_provider)
 
+    azureprovidercreate_desc = 'Install Azure Provider'
+    azureprovidercreate_parser = providercreate_subparsers.add_parser('azure', help=azureprovidercreate_desc,
+                                                                      description=azureprovidercreate_desc)
+    azureprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    azureprovidercreate_parser.set_defaults(func=install_provider)
+
     gcpprovidercreate_desc = 'Install Gcp Provider'
     gcpprovidercreate_parser = providercreate_subparsers.add_parser('gcp', help=gcpprovidercreate_desc,
                                                                     description=gcpprovidercreate_desc)
     gcpprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
     gcpprovidercreate_parser.set_defaults(func=install_provider)
 
     ibmprovidercreate_desc = 'Install IBM Cloud Provider'
@@ -4607,14 +4679,21 @@
     keywordinfo_parser.set_defaults(func=info_keyword)
 
     kubeinfo_desc = 'Info Kube'
     kubeinfo_parser = info_subparsers.add_parser('kube', description=kubeinfo_desc, help=kubeinfo_desc,
                                                  aliases=['cluster'])
     kubeinfo_subparsers = kubeinfo_parser.add_subparsers(metavar='', dest='subcommand_info_kube')
 
+    kubeaksinfo_desc = 'Info Aks Kube'
+    kubeaksinfo_parser = kubeinfo_subparsers.add_parser('aks', description=kubeaksinfo_desc,
+                                                        help=kubeaksinfo_desc,
+                                                        parents=[output_parser])
+    kubeaksinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubeaksinfo_parser.set_defaults(func=info_aks_kube)
+
     kubeeksinfo_desc = 'Info Eks Kube'
     kubeeksinfo_parser = kubeinfo_subparsers.add_parser('eks', description=kubeeksinfo_desc,
                                                         help=kubeeksinfo_desc,
                                                         parents=[output_parser])
     kubeeksinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubeeksinfo_parser.set_defaults(func=info_eks_kube)
 
@@ -4970,19 +5049,28 @@
     scale_subparsers = scale_parser.add_subparsers(metavar='', dest='subcommand_scale')
 
     kubescale_desc = 'Scale Kube'
     kubescale_parser = scale_subparsers.add_parser('kube', description=kubescale_desc, help=kubescale_desc,
                                                    aliases=['cluster'])
     kubescale_subparsers = kubescale_parser.add_subparsers(metavar='', dest='subcommand_scale_kube')
 
+    kubeaksscale_desc = 'Scale Aks Kube'
+    kubeaksscale_epilog = f"examples:\n{kubeaksscale}"
+    kubeaksscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubeaksscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
+    kubeaksscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='myaks')
+    kubeaksscale_parser.set_defaults(func=scale_aks_kube)
+    kubescale_subparsers.add_parser('aks', parents=[kubeaksscale_parser], description=kubeaksscale_desc,
+                                    help=kubeaksscale_desc, epilog=kubeaksscale_epilog, formatter_class=rawhelp)
+
     kubeeksscale_desc = 'Scale Eks Kube'
     kubeeksscale_epilog = f"examples:\n{kubeeksscale}"
     kubeeksscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubeeksscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
-    kubeeksscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='mykube')
+    kubeeksscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='myeks')
     kubeeksscale_parser.set_defaults(func=scale_eks_kube)
     kubescale_subparsers.add_parser('eks', parents=[kubeeksscale_parser], description=kubeeksscale_desc,
                                     help=kubeeksscale_desc, epilog=kubeeksscale_epilog, formatter_class=rawhelp)
 
     kubegenericscale_desc = 'Scale Generic Kube'
     kubegenericscale_epilog = f"examples:\n{kubegenericscale}"
     kubegenericscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
```

## kvirt/config.py

```diff
@@ -86,11994 +86,12343 @@
 00000550: 6f72 6172 7944 6972 6563 746f 7279 0a69  oraryDirectory.i
 00000560: 6d70 6f72 7420 7468 7265 6164 696e 670a  mport threading.
 00000570: 6672 6f6d 2074 696d 6520 696d 706f 7274  from time import
 00000580: 2073 6c65 6570 0a69 6d70 6f72 7420 7765   sleep.import we
 00000590: 6262 726f 7773 6572 0a69 6d70 6f72 7420  bbrowser.import 
 000005a0: 7961 6d6c 0a0a 636c 6f75 6470 6c61 7466  yaml..cloudplatf
 000005b0: 6f72 6d73 203d 205b 2761 7773 272c 2027  orms = ['aws', '
-000005c0: 6763 7027 2c20 2770 6163 6b65 7427 2c20  gcp', 'packet', 
-000005d0: 2769 626d 636c 6f75 6427 5d0a 0a0a 6465  'ibmcloud']...de
-000005e0: 6620 6465 7065 6e64 656e 6379 5f65 7272  f dependency_err
-000005f0: 6f72 2870 726f 7669 6465 7229 3a0a 2020  or(provider):.  
-00000600: 2020 6d73 6720 3d20 6622 436f 756c 646e    msg = f"Couldn
-00000610: 7420 696d 706f 7274 207b 7072 6f76 6964  t import {provid
-00000620: 6572 7d2e 2055 7365 206b 636c 6920 696e  er}. Use kcli in
-00000630: 7374 616c 6c20 7072 6f76 6964 6572 207b  stall provider {
-00000640: 7072 6f76 6964 6572 7d22 0a20 2020 2065  provider}".    e
-00000650: 7272 6f72 286d 7367 290a 2020 2020 7379  rror(msg).    sy
-00000660: 732e 6578 6974 2831 290a 0a0a 636c 6173  s.exit(1)...clas
-00000670: 7320 4b63 6f6e 6669 6728 4b62 6173 6563  s Kconfig(Kbasec
-00000680: 6f6e 6669 6729 3a0a 2020 2020 2222 220a  onfig):.    """.
-00000690: 0a20 2020 2022 2222 0a20 2020 2064 6566  .    """.    def
-000006a0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-000006b0: 636c 6965 6e74 3d4e 6f6e 652c 2064 6562  client=None, deb
-000006c0: 7567 3d46 616c 7365 2c20 7175 6965 743d  ug=False, quiet=
-000006d0: 4661 6c73 652c 2072 6567 696f 6e3d 4e6f  False, region=No
-000006e0: 6e65 2c20 7a6f 6e65 3d4e 6f6e 652c 206e  ne, zone=None, n
-000006f0: 616d 6573 7061 6365 3d4e 6f6e 652c 206f  amespace=None, o
-00000700: 6666 6c69 6e65 3d46 616c 7365 293a 0a20  ffline=False):. 
-00000710: 2020 2020 2020 204b 6261 7365 636f 6e66         Kbaseconf
-00000720: 6967 2e5f 5f69 6e69 745f 5f28 7365 6c66  ig.__init__(self
-00000730: 2c20 636c 6965 6e74 3d63 6c69 656e 742c  , client=client,
-00000740: 2064 6562 7567 3d64 6562 7567 2c20 7175   debug=debug, qu
-00000750: 6965 743d 7175 6965 742c 206f 6666 6c69  iet=quiet, offli
-00000760: 6e65 3d6f 6666 6c69 6e65 290a 2020 2020  ne=offline).    
-00000770: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00000780: 656e 6162 6c65 643a 0a20 2020 2020 2020  enabled:.       
-00000790: 2020 2020 206b 203d 204e 6f6e 650a 2020       k = None.  
-000007a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000007b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000007c0: 7479 7065 203d 3d20 276b 7562 6576 6972  type == 'kubevir
-000007d0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-000007e0: 2020 2020 6966 206e 616d 6573 7061 6365      if namespace
-000007f0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00000800: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00000810: 6d65 7370 6163 6520 3d20 7365 6c66 2e6f  mespace = self.o
-00000820: 7074 696f 6e73 2e67 6574 2827 6e61 6d65  ptions.get('name
-00000830: 7370 6163 6527 290a 2020 2020 2020 2020  space').        
-00000840: 2020 2020 2020 2020 636f 6e74 6578 7420          context 
-00000850: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00000860: 6574 2827 636f 6e74 6578 7427 290a 2020  et('context').  
-00000870: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00000880: 7461 766f 6c75 6d65 7320 3d20 7365 6c66  tavolumes = self
-00000890: 2e6f 7074 696f 6e73 2e67 6574 2827 6461  .options.get('da
-000008a0: 7461 766f 6c75 6d65 7327 2c20 5472 7565  tavolumes', True
-000008b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000008c0: 2020 7265 6164 7772 6974 656d 616e 7920    readwritemany 
-000008d0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-000008e0: 6574 2827 7265 6164 7772 6974 656d 616e  et('readwriteman
-000008f0: 7927 2c20 4661 6c73 6529 0a20 2020 2020  y', False).     
-00000900: 2020 2020 2020 2020 2020 2063 615f 6669             ca_fi
-00000910: 6c65 203d 2073 656c 662e 6f70 7469 6f6e  le = self.option
-00000920: 732e 6765 7428 2763 615f 6669 6c65 2729  s.get('ca_file')
-00000930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000940: 2069 6620 6361 5f66 696c 6520 6973 206e   if ca_file is n
-00000950: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00000960: 2020 2020 2020 2020 2020 2020 2063 615f               ca_
-00000970: 6669 6c65 203d 206f 732e 7061 7468 2e65  file = os.path.e
-00000980: 7870 616e 6475 7365 7228 6361 5f66 696c  xpanduser(ca_fil
-00000990: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000009a0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-000009b0: 2e70 6174 682e 6578 6973 7473 2863 615f  .path.exists(ca_
-000009c0: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-000009d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000009e0: 7272 6f72 2866 2243 6120 6669 6c65 207b  rror(f"Ca file {
-000009f0: 6361 5f66 696c 657d 2064 6f65 736e 2774  ca_file} doesn't
-00000a00: 2065 7869 7374 2e20 4c65 6176 696e 6722   exist. Leaving"
-00000a10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00000a20: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00000a30: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
-00000a40: 2020 2020 2020 6469 736b 5f68 6f74 706c        disk_hotpl
-00000a50: 7567 203d 2073 656c 662e 6f70 7469 6f6e  ug = self.option
-00000a60: 732e 6765 7428 2764 6973 6b5f 686f 7470  s.get('disk_hotp
-00000a70: 6c75 6727 2c20 4661 6c73 6529 0a20 2020  lug', False).   
-00000a80: 2020 2020 2020 2020 2020 2020 206b 7562               kub
-00000a90: 6563 6f6e 6669 675f 6669 6c65 203d 2073  econfig_file = s
-00000aa0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-00000ab0: 276b 7562 6563 6f6e 6669 6727 290a 2020  'kubeconfig').  
-00000ac0: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00000ad0: 6b65 6e20 3d20 7365 6c66 2e6f 7074 696f  ken = self.optio
-00000ae0: 6e73 2e67 6574 2827 746f 6b65 6e27 290a  ns.get('token').
-00000af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000b00: 746f 6b65 6e5f 6669 6c65 203d 2073 656c  token_file = sel
-00000b10: 662e 6f70 7469 6f6e 732e 6765 7428 2774  f.options.get('t
-00000b20: 6f6b 656e 5f66 696c 6527 290a 2020 2020  oken_file').    
-00000b30: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-00000b40: 6f6b 656e 5f66 696c 6520 6973 206e 6f74  oken_file is not
-00000b50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00000b60: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
-00000b70: 5f66 696c 6520 3d20 6f73 2e70 6174 682e  _file = os.path.
-00000b80: 6578 7061 6e64 7573 6572 2874 6f6b 656e  expanduser(token
-00000b90: 5f66 696c 6529 0a20 2020 2020 2020 2020  _file).         
-00000ba0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00000bb0: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00000bc0: 2874 6f6b 656e 5f66 696c 6529 3a0a 2020  (token_file):.  
-00000bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000be0: 2020 2020 2020 6572 726f 7228 2254 6f6b        error("Tok
-00000bf0: 656e 2066 696c 6520 7061 7468 2064 6f65  en file path doe
-00000c00: 736e 2774 2065 7869 7374 2e20 4c65 6176  sn't exist. Leav
-00000c10: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
-00000c20: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00000c30: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-00000c40: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00000c50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00000c60: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-00000c70: 6e20 3d20 6f70 656e 2874 6f6b 656e 5f66  n = open(token_f
-00000c80: 696c 6529 2e72 6561 6428 290a 2020 2020  ile).read().    
-00000c90: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-00000ca0: 7374 7279 203d 2073 656c 662e 6f70 7469  stry = self.opti
-00000cb0: 6f6e 732e 6765 7428 2772 6567 6973 7472  ons.get('registr
-00000cc0: 7927 290a 2020 2020 2020 2020 2020 2020  y').            
-00000cd0: 2020 2020 6163 6365 7373 5f6d 6f64 6520      access_mode 
-00000ce0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00000cf0: 6574 2827 6163 6365 7373 5f6d 6f64 6527  et('access_mode'
-00000d00: 2c20 274e 6f64 6550 6f72 7427 290a 2020  , 'NodePort').  
-00000d10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00000d20: 2061 6363 6573 735f 6d6f 6465 206e 6f74   access_mode not
-00000d30: 2069 6e20 5b27 4578 7465 726e 616c 272c   in ['External',
-00000d40: 2027 4c6f 6164 4261 6c61 6e63 6572 272c   'LoadBalancer',
-00000d50: 2027 4e6f 6465 506f 7274 275d 3a0a 2020   'NodePort']:.  
-00000d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000d70: 2020 6d73 6720 3d20 6622 496e 636f 7272    msg = f"Incorr
-00000d80: 6563 7420 6163 6365 7373 5f6d 6f64 6520  ect access_mode 
-00000d90: 7b61 6363 6573 735f 6d6f 6465 7d2e 2053  {access_mode}. S
-00000da0: 686f 756c 6420 6265 2045 7874 6572 6e61  hould be Externa
-00000db0: 6c2c 204e 6f64 6550 6f72 7420 6f72 204c  l, NodePort or L
-00000dc0: 6f61 6442 616c 616e 6365 7222 0a20 2020  oadBalancer".   
-00000dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000de0: 2065 7272 6f72 286d 7367 290a 2020 2020   error(msg).    
-00000df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000e00: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-00000e10: 2020 2020 2020 2020 2020 2020 766f 6c75              volu
-00000e20: 6d65 5f6d 6f64 6520 3d20 7365 6c66 2e6f  me_mode = self.o
-00000e30: 7074 696f 6e73 2e67 6574 2827 766f 6c75  ptions.get('volu
-00000e40: 6d65 5f6d 6f64 6527 2c20 2746 696c 6573  me_mode', 'Files
-00000e50: 7973 7465 6d27 290a 2020 2020 2020 2020  ystem').        
-00000e60: 2020 2020 2020 2020 6966 2076 6f6c 756d          if volum
-00000e70: 655f 6d6f 6465 206e 6f74 2069 6e20 5b27  e_mode not in ['
-00000e80: 4669 6c65 7379 7374 656d 272c 2027 426c  Filesystem', 'Bl
-00000e90: 6f63 6b27 5d3a 0a20 2020 2020 2020 2020  ock']:.         
-00000ea0: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-00000eb0: 2066 2249 6e63 6f72 7265 6374 2076 6f6c   f"Incorrect vol
-00000ec0: 756d 655f 6d6f 6465 207b 766f 6c75 6d65  ume_mode {volume
-00000ed0: 5f6d 6f64 657d 2e20 5368 6f75 6c64 2062  _mode}. Should b
-00000ee0: 6520 4669 6c65 7379 7374 656d 206f 7220  e Filesystem or 
-00000ef0: 426c 6f63 6b22 0a20 2020 2020 2020 2020  Block".         
-00000f00: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00000f10: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
-00000f20: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00000f30: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
-00000f40: 2020 2020 2020 766f 6c75 6d65 5f61 6363        volume_acc
-00000f50: 6573 7320 3d20 7365 6c66 2e6f 7074 696f  ess = self.optio
-00000f60: 6e73 2e67 6574 2827 766f 6c75 6d65 5f61  ns.get('volume_a
-00000f70: 6363 6573 7327 2c20 2752 6561 6457 7269  ccess', 'ReadWri
-00000f80: 7465 4f6e 6365 2729 0a20 2020 2020 2020  teOnce').       
-00000f90: 2020 2020 2020 2020 2069 6620 766f 6c75           if volu
-00000fa0: 6d65 5f61 6363 6573 7320 6e6f 7420 696e  me_access not in
-00000fb0: 205b 2752 6561 6457 7269 7465 4d61 6e79   ['ReadWriteMany
-00000fc0: 272c 2027 5265 6164 5772 6974 654f 6e63  ', 'ReadWriteOnc
-00000fd0: 6527 5d3a 0a20 2020 2020 2020 2020 2020  e']:.           
-00000fe0: 2020 2020 2020 2020 206d 7367 203d 2066           msg = f
-00000ff0: 2249 6e63 6f72 7265 6374 2076 6f6c 756d  "Incorrect volum
-00001000: 655f 6163 6365 7373 207b 766f 6c75 6d65  e_access {volume
-00001010: 5f61 6363 6573 737d 2e20 5368 6f75 6c64  _access}. Should
-00001020: 2062 6520 5265 6164 5772 6974 654f 6e63   be ReadWriteOnc
-00001030: 6520 6f72 2052 6561 6457 7269 7465 4f6e  e or ReadWriteOn
-00001040: 6365 220a 2020 2020 2020 2020 2020 2020  ce".            
-00001050: 2020 2020 2020 2020 6572 726f 7228 6d73          error(ms
-00001060: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
-00001070: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-00001080: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00001090: 2020 2068 6172 7665 7374 6572 203d 2073     harvester = s
-000010a0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-000010b0: 2768 6172 7665 7374 6572 272c 2046 616c  'harvester', Fal
-000010c0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-000010d0: 2020 2020 656d 6265 645f 7573 6572 6461      embed_userda
-000010e0: 7461 203d 2073 656c 662e 6f70 7469 6f6e  ta = self.option
-000010f0: 732e 6765 7428 2765 6d62 6564 5f75 7365  s.get('embed_use
-00001100: 7264 6174 6127 2c20 4661 6c73 6529 0a20  rdata', False). 
-00001110: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00001120: 6972 7374 5f63 6f6e 7375 6d65 7220 3d20  irst_consumer = 
-00001130: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00001140: 2827 6669 7273 745f 636f 6e73 756d 6572  ('first_consumer
-00001150: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
-00001160: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00001170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001180: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
-00001190: 6f76 6964 6572 732e 6b75 6265 7669 7274  oviders.kubevirt
-000011a0: 2069 6d70 6f72 7420 4b75 6265 7669 7274   import Kubevirt
-000011b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000011c0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-000011d0: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-000011e0: 656e 6465 6e63 795f 6572 726f 7228 276b  endency_error('k
-000011f0: 7562 6576 6972 7427 290a 2020 2020 2020  ubevirt').      
-00001200: 2020 2020 2020 2020 2020 6b20 3d20 4b75            k = Ku
-00001210: 6265 7669 7274 2863 6f6e 7465 7874 3d63  bevirt(context=c
-00001220: 6f6e 7465 7874 2c20 746f 6b65 6e3d 746f  ontext, token=to
-00001230: 6b65 6e2c 2063 615f 6669 6c65 3d63 615f  ken, ca_file=ca_
-00001240: 6669 6c65 2c20 686f 7374 3d73 656c 662e  file, host=self.
-00001250: 686f 7374 2c0a 2020 2020 2020 2020 2020  host,.          
-00001260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001270: 2020 2070 6f72 743d 3634 3433 2c20 7573     port=6443, us
-00001280: 6572 3d73 656c 662e 7573 6572 2c20 6465  er=self.user, de
-00001290: 6275 673d 6465 6275 672c 206e 616d 6573  bug=debug, names
-000012a0: 7061 6365 3d6e 616d 6573 7061 6365 2c0a  pace=namespace,.
-000012b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012c0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-000012d0: 6176 6f6c 756d 6573 3d64 6174 6176 6f6c  avolumes=datavol
-000012e0: 756d 6573 2c20 6469 736b 5f68 6f74 706c  umes, disk_hotpl
-000012f0: 7567 3d64 6973 6b5f 686f 7470 6c75 672c  ug=disk_hotplug,
-00001300: 2072 6561 6477 7269 7465 6d61 6e79 3d72   readwritemany=r
-00001310: 6561 6477 7269 7465 6d61 6e79 2c0a 2020  eadwritemany,.  
-00001320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001330: 2020 2020 2020 2020 2020 2072 6567 6973             regis
-00001340: 7472 793d 7265 6769 7374 7279 2c20 6163  try=registry, ac
-00001350: 6365 7373 5f6d 6f64 653d 6163 6365 7373  cess_mode=access
-00001360: 5f6d 6f64 652c 2076 6f6c 756d 655f 6d6f  _mode, volume_mo
-00001370: 6465 3d76 6f6c 756d 655f 6d6f 6465 2c0a  de=volume_mode,.
-00001380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001390: 2020 2020 2020 2020 2020 2020 2076 6f6c               vol
-000013a0: 756d 655f 6163 6365 7373 3d76 6f6c 756d  ume_access=volum
-000013b0: 655f 6163 6365 7373 2c20 6861 7276 6573  e_access, harves
-000013c0: 7465 723d 6861 7276 6573 7465 722c 2065  ter=harvester, e
-000013d0: 6d62 6564 5f75 7365 7264 6174 613d 656d  mbed_userdata=em
-000013e0: 6265 645f 7573 6572 6461 7461 2c0a 2020  bed_userdata,.  
-000013f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001400: 2020 2020 2020 2020 2020 2066 6972 7374             first
-00001410: 5f63 6f6e 7375 6d65 723d 6669 7273 745f  _consumer=first_
-00001420: 636f 6e73 756d 6572 2c20 6b75 6265 636f  consumer, kubeco
-00001430: 6e66 6967 5f66 696c 653d 6b75 6265 636f  nfig_file=kubeco
-00001440: 6e66 6967 5f66 696c 6529 0a20 2020 2020  nfig_file).     
-00001450: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00001460: 686f 7374 203d 206b 2e68 6f73 740a 2020  host = k.host.  
-00001470: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-00001480: 656c 662e 7479 7065 203d 3d20 2767 6370  elf.type == 'gcp
-00001490: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-000014a0: 2020 2063 7265 6465 6e74 6961 6c73 203d     credentials =
-000014b0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-000014c0: 7428 2763 7265 6465 6e74 6961 6c73 2729  t('credentials')
-000014d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000014e0: 2069 6620 6372 6564 656e 7469 616c 7320   if credentials 
-000014f0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00001500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001510: 206f 732e 656e 7669 726f 6e5b 2747 4f4f   os.environ['GOO
-00001520: 474c 455f 4150 504c 4943 4154 494f 4e5f  GLE_APPLICATION_
-00001530: 4352 4544 454e 5449 414c 5327 5d20 3d20  CREDENTIALS'] = 
-00001540: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
-00001550: 6572 2863 7265 6465 6e74 6961 6c73 290a  er(credentials).
-00001560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001570: 656c 6966 2027 474f 4f47 4c45 5f41 5050  elif 'GOOGLE_APP
-00001580: 4c49 4341 5449 4f4e 5f43 5245 4445 4e54  LICATION_CREDENT
-00001590: 4941 4c53 2720 6e6f 7420 696e 206f 732e  IALS' not in os.
-000015a0: 656e 7669 726f 6e3a 0a20 2020 2020 2020  environ:.       
-000015b0: 2020 2020 2020 2020 2020 2020 2065 7272               err
-000015c0: 6f72 2822 7365 7420 474f 4f47 4c45 5f41  or("set GOOGLE_A
-000015d0: 5050 4c49 4341 5449 4f4e 5f43 5245 4445  PPLICATION_CREDE
-000015e0: 4e54 4941 4c53 2076 6172 6961 626c 652e  NTIALS variable.
-000015f0: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
-00001600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001610: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-00001620: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-00001630: 6a65 6374 203d 2073 656c 662e 6f70 7469  ject = self.opti
-00001640: 6f6e 732e 6765 7428 2770 726f 6a65 6374  ons.get('project
-00001650: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00001660: 2020 2069 6620 7072 6f6a 6563 7420 6973     if project is
-00001670: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00001680: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00001690: 2822 4d69 7373 696e 6720 7072 6f6a 6563  ("Missing projec
-000016a0: 7420 696e 2074 6865 2063 6f6e 6669 6775  t in the configu
-000016b0: 7261 7469 6f6e 2e20 4c65 6176 696e 6722  ration. Leaving"
-000016c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000016d0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-000016e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000016f0: 2020 7a6f 6e65 203d 2073 656c 662e 6f70    zone = self.op
-00001700: 7469 6f6e 732e 6765 7428 277a 6f6e 6527  tions.get('zone'
-00001710: 2c20 2765 7572 6f70 652d 7765 7374 312d  , 'europe-west1-
-00001720: 6227 2920 6966 207a 6f6e 6520 6973 204e  b') if zone is N
-00001730: 6f6e 6520 656c 7365 207a 6f6e 650a 2020  one else zone.  
-00001740: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00001750: 6769 6f6e 203d 2073 656c 662e 6f70 7469  gion = self.opti
-00001760: 6f6e 732e 6765 7428 2772 6567 696f 6e27  ons.get('region'
-00001770: 2920 6966 2072 6567 696f 6e20 6973 204e  ) if region is N
-00001780: 6f6e 6520 656c 7365 2072 6567 696f 6e0a  one else region.
-00001790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000017a0: 7265 6769 6f6e 203d 207a 6f6e 655b 3a2d  region = zone[:-
-000017b0: 325d 2069 6620 7265 6769 6f6e 2069 7320  2] if region is 
-000017c0: 4e6f 6e65 2065 6c73 6520 7265 6769 6f6e  None else region
-000017d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000017e0: 2070 7562 6c69 6320 3d20 7365 6c66 2e6f   public = self.o
-000017f0: 7074 696f 6e73 2e67 6574 2827 7075 626c  ptions.get('publ
-00001800: 6963 272c 2054 7275 6529 0a20 2020 2020  ic', True).     
-00001810: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00001820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001830: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
-00001840: 726f 7669 6465 7273 2e67 6370 2069 6d70  roviders.gcp imp
-00001850: 6f72 7420 4b67 6370 0a20 2020 2020 2020  ort Kgcp.       
-00001860: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-00001870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001880: 2020 2020 2064 6570 656e 6465 6e63 795f       dependency_
-00001890: 6572 726f 7228 2767 6370 2729 0a20 2020  error('gcp').   
-000018a0: 2020 2020 2020 2020 2020 2020 206b 203d               k =
-000018b0: 204b 6763 7028 7072 6f6a 6563 742c 207a   Kgcp(project, z
-000018c0: 6f6e 653d 7a6f 6e65 2c20 7265 6769 6f6e  one=zone, region
-000018d0: 3d72 6567 696f 6e2c 2064 6562 7567 3d64  =region, debug=d
-000018e0: 6562 7567 2c20 7075 626c 6963 3d70 7562  ebug, public=pub
-000018f0: 6c69 6329 0a20 2020 2020 2020 2020 2020  lic).           
-00001900: 2020 2020 2073 656c 662e 6f76 6572 7269       self.overri
-00001910: 6465 732e 7570 6461 7465 287b 2770 726f  des.update({'pro
-00001920: 6a65 6374 273a 2070 726f 6a65 6374 7d29  ject': project})
-00001930: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00001940: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
-00001950: 6177 7327 3a0a 2020 2020 2020 2020 2020  aws':.          
-00001960: 2020 2020 2020 6163 6365 7373 5f6b 6579        access_key
-00001970: 5f69 6420 3d20 7365 6c66 2e6f 7074 696f  _id = self.optio
-00001980: 6e73 2e67 6574 2827 6163 6365 7373 5f6b  ns.get('access_k
-00001990: 6579 5f69 6427 290a 2020 2020 2020 2020  ey_id').        
-000019a0: 2020 2020 2020 2020 6163 6365 7373 5f6b          access_k
-000019b0: 6579 5f73 6563 7265 7420 3d20 7365 6c66  ey_secret = self
-000019c0: 2e6f 7074 696f 6e73 2e67 6574 2827 6163  .options.get('ac
-000019d0: 6365 7373 5f6b 6579 5f73 6563 7265 7427  cess_key_secret'
-000019e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000019f0: 2020 6b65 7970 6169 7220 3d20 7365 6c66    keypair = self
-00001a00: 2e6f 7074 696f 6e73 2e67 6574 2827 6b65  .options.get('ke
-00001a10: 7970 6169 7227 290a 2020 2020 2020 2020  ypair').        
-00001a20: 2020 2020 2020 2020 7365 7373 696f 6e5f          session_
-00001a30: 746f 6b65 6e20 3d20 7365 6c66 2e6f 7074  token = self.opt
-00001a40: 696f 6e73 2e67 6574 2827 7365 7373 696f  ions.get('sessio
-00001a50: 6e5f 746f 6b65 6e27 290a 2020 2020 2020  n_token').      
-00001a60: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
-00001a70: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00001a80: 6765 7428 2772 6567 696f 6e27 2920 6966  get('region') if
-00001a90: 2072 6567 696f 6e20 6973 204e 6f6e 6520   region is None 
-00001aa0: 656c 7365 2072 6567 696f 6e0a 2020 2020  else region.    
-00001ab0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00001ac0: 6567 696f 6e20 6973 204e 6f6e 653a 0a20  egion is None:. 
-00001ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ae0: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
-00001af0: 6720 7265 6769 6f6e 2069 6e20 7468 6520  g region in the 
-00001b00: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
-00001b10: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
-00001b20: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00001b30: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00001b40: 2020 2020 2020 2020 2069 6620 6163 6365           if acce
-00001b50: 7373 5f6b 6579 5f69 6420 6973 204e 6f6e  ss_key_id is Non
-00001b60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00001b70: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
-00001b80: 7373 696e 6720 6163 6365 7373 5f6b 6579  ssing access_key
-00001b90: 5f69 6420 696e 2074 6865 2063 6f6e 6669  _id in the confi
-00001ba0: 6775 7261 7469 6f6e 2e20 4c65 6176 696e  guration. Leavin
-00001bb0: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
-00001bc0: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00001bd0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-00001be0: 2020 2020 6966 2061 6363 6573 735f 6b65      if access_ke
-00001bf0: 795f 7365 6372 6574 2069 7320 4e6f 6e65  y_secret is None
-00001c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00001c10: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
-00001c20: 7369 6e67 2061 6363 6573 735f 6b65 795f  sing access_key_
-00001c30: 7365 6372 6574 2069 6e20 7468 6520 636f  secret in the co
-00001c40: 6e66 6967 7572 6174 696f 6e2e 204c 6561  nfiguration. Lea
-00001c50: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
-00001c60: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00001c70: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-00001c80: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00001c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ca0: 6672 6f6d 206b 7669 7274 2e70 726f 7669  from kvirt.provi
-00001cb0: 6465 7273 2e61 7773 2069 6d70 6f72 7420  ders.aws import 
-00001cc0: 4b61 7773 0a20 2020 2020 2020 2020 2020  Kaws.           
-00001cd0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00001ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001cf0: 2064 6570 656e 6465 6e63 795f 6572 726f   dependency_erro
-00001d00: 7228 2761 7773 2729 0a20 2020 2020 2020  r('aws').       
-00001d10: 2020 2020 2020 2020 206b 203d 204b 6177           k = Kaw
-00001d20: 7328 6163 6365 7373 5f6b 6579 5f69 643d  s(access_key_id=
-00001d30: 6163 6365 7373 5f6b 6579 5f69 642c 2061  access_key_id, a
-00001d40: 6363 6573 735f 6b65 795f 7365 6372 6574  ccess_key_secret
-00001d50: 3d61 6363 6573 735f 6b65 795f 7365 6372  =access_key_secr
-00001d60: 6574 2c20 7265 6769 6f6e 3d72 6567 696f  et, region=regio
-00001d70: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00001d80: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-00001d90: 673d 6465 6275 672c 206b 6579 7061 6972  g=debug, keypair
-00001da0: 3d6b 6579 7061 6972 2c20 7365 7373 696f  =keypair, sessio
-00001db0: 6e5f 746f 6b65 6e3d 7365 7373 696f 6e5f  n_token=session_
-00001dc0: 746f 6b65 6e29 0a20 2020 2020 2020 2020  token).         
-00001dd0: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
-00001de0: 6520 3d3d 2027 6962 6d27 3a0a 2020 2020  e == 'ibm':.    
-00001df0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00001e00: 656e 2873 656c 662e 6f70 7469 6f6e 7329  en(self.options)
-00001e10: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00001e20: 2020 2020 2020 2020 2020 2068 6f6d 6520             home 
-00001e30: 3d20 6f73 2e65 6e76 6972 6f6e 5b27 484f  = os.environ['HO
-00001e40: 4d45 275d 0a20 2020 2020 2020 2020 2020  ME'].           
-00001e50: 2020 2020 2020 2020 2069 616d 5f61 7069           iam_api
-00001e60: 5f6b 6579 2c20 7265 6769 6f6e 2c20 7a6f  _key, region, zo
-00001e70: 6e65 2c20 7670 6320 3d20 4e6f 6e65 2c20  ne, vpc = None, 
-00001e80: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
-00001e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001ea0: 2020 2020 2063 6f73 5f61 7069 5f6b 6579       cos_api_key
-00001eb0: 2c20 636f 735f 7265 736f 7572 6365 5f69  , cos_resource_i
-00001ec0: 6e73 7461 6e63 655f 6964 2c20 6369 735f  nstance_id, cis_
-00001ed0: 7265 736f 7572 6365 5f69 6e73 7461 6e63  resource_instanc
-00001ee0: 655f 6964 203d 204e 6f6e 652c 204e 6f6e  e_id = None, Non
-00001ef0: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
-00001f00: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-00001f10: 7274 2063 6f6e 6669 6770 6172 7365 720a  rt configparser.
-00001f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f30: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-00001f40: 7869 7374 7328 6622 7b68 6f6d 657d 2f2e  xists(f"{home}/.
-00001f50: 6962 6d2f 6372 6564 656e 7469 616c 7322  ibm/credentials"
-00001f60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00001f70: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00001f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f90: 2020 2020 2020 2020 2020 2020 6372 6564              cred
-00001fa0: 636f 6e66 6967 203d 2063 6f6e 6669 6770  config = configp
-00001fb0: 6172 7365 722e 436f 6e66 6967 5061 7273  arser.ConfigPars
-00001fc0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-00001fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fe0: 2063 7265 6463 6f6e 6669 672e 7265 6164   credconfig.read
-00001ff0: 2866 227b 686f 6d65 7d2f 2e69 626d 2f63  (f"{home}/.ibm/c
-00002000: 7265 6465 6e74 6961 6c73 2229 0a20 2020  redentials").   
-00002010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002020: 2020 2020 2020 2020 2069 6620 2764 6566           if 'def
-00002030: 6175 6c74 2720 6e6f 7420 696e 2063 7265  ault' not in cre
-00002040: 6463 6f6e 6669 673a 0a20 2020 2020 2020  dconfig:.       
-00002050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002060: 2020 2020 2020 2020 2065 7272 6f72 280a           error(.
+000005c0: 617a 7572 6527 2c20 2767 6370 272c 2027  azure', 'gcp', '
+000005d0: 7061 636b 6574 272c 2027 6962 6d63 6c6f  packet', 'ibmclo
+000005e0: 7564 275d 0a0a 0a64 6566 2064 6570 656e  ud']...def depen
+000005f0: 6465 6e63 795f 6572 726f 7228 7072 6f76  dency_error(prov
+00000600: 6964 6572 2c20 6578 6365 7074 696f 6e3d  ider, exception=
+00000610: 4e6f 6e65 293a 0a20 2020 206d 7367 203d  None):.    msg =
+00000620: 2066 2243 6f75 6c64 6e74 2069 6d70 6f72   f"Couldnt impor
+00000630: 7420 7b70 726f 7669 6465 727d 2e20 5573  t {provider}. Us
+00000640: 6520 6b63 6c69 2069 6e73 7461 6c6c 2070  e kcli install p
+00000650: 726f 7669 6465 7220 7b70 726f 7669 6465  rovider {provide
+00000660: 727d 220a 2020 2020 6966 2065 7863 6570  r}".    if excep
+00000670: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
+00000680: 3a0a 2020 2020 2020 2020 6d73 6720 2b3d  :.        msg +=
+00000690: 2066 225c 6e48 6974 207b 6578 6365 7074   f"\nHit {except
+000006a0: 696f 6e7d 220a 2020 2020 6572 726f 7228  ion}".    error(
+000006b0: 6d73 6729 0a20 2020 2073 7973 2e65 7869  msg).    sys.exi
+000006c0: 7428 3129 0a0a 0a63 6c61 7373 204b 636f  t(1)...class Kco
+000006d0: 6e66 6967 284b 6261 7365 636f 6e66 6967  nfig(Kbaseconfig
+000006e0: 293a 0a20 2020 2022 2222 0a0a 2020 2020  ):.    """..    
+000006f0: 2222 220a 2020 2020 6465 6620 5f5f 696e  """.    def __in
+00000700: 6974 5f5f 2873 656c 662c 2063 6c69 656e  it__(self, clien
+00000710: 743d 4e6f 6e65 2c20 6465 6275 673d 4661  t=None, debug=Fa
+00000720: 6c73 652c 2071 7569 6574 3d46 616c 7365  lse, quiet=False
+00000730: 2c20 7265 6769 6f6e 3d4e 6f6e 652c 207a  , region=None, z
+00000740: 6f6e 653d 4e6f 6e65 2c20 6e61 6d65 7370  one=None, namesp
+00000750: 6163 653d 4e6f 6e65 2c20 6f66 666c 696e  ace=None, offlin
+00000760: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
+00000770: 2020 4b62 6173 6563 6f6e 6669 672e 5f5f    Kbaseconfig.__
+00000780: 696e 6974 5f5f 2873 656c 662c 2063 6c69  init__(self, cli
+00000790: 656e 743d 636c 6965 6e74 2c20 6465 6275  ent=client, debu
+000007a0: 673d 6465 6275 672c 2071 7569 6574 3d71  g=debug, quiet=q
+000007b0: 7569 6574 2c20 6f66 666c 696e 653d 6f66  uiet, offline=of
+000007c0: 666c 696e 6529 0a20 2020 2020 2020 2069  fline).        i
+000007d0: 6620 6e6f 7420 7365 6c66 2e65 6e61 626c  f not self.enabl
+000007e0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+000007f0: 6b20 3d20 4e6f 6e65 0a20 2020 2020 2020  k = None.       
+00000800: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00000810: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
+00000820: 3d3d 2027 6b75 6265 7669 7274 273a 0a20  == 'kubevirt':. 
+00000830: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00000840: 6620 6e61 6d65 7370 6163 6520 6973 204e  f namespace is N
+00000850: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00000860: 2020 2020 2020 2020 206e 616d 6573 7061           namespa
+00000870: 6365 203d 2073 656c 662e 6f70 7469 6f6e  ce = self.option
+00000880: 732e 6765 7428 276e 616d 6573 7061 6365  s.get('namespace
+00000890: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000008a0: 2020 2063 6f6e 7465 7874 203d 2073 656c     context = sel
+000008b0: 662e 6f70 7469 6f6e 732e 6765 7428 2763  f.options.get('c
+000008c0: 6f6e 7465 7874 2729 0a20 2020 2020 2020  ontext').       
+000008d0: 2020 2020 2020 2020 2064 6174 6176 6f6c           datavol
+000008e0: 756d 6573 203d 2073 656c 662e 6f70 7469  umes = self.opti
+000008f0: 6f6e 732e 6765 7428 2764 6174 6176 6f6c  ons.get('datavol
+00000900: 756d 6573 272c 2054 7275 6529 0a20 2020  umes', True).   
+00000910: 2020 2020 2020 2020 2020 2020 2072 6561               rea
+00000920: 6477 7269 7465 6d61 6e79 203d 2073 656c  dwritemany = sel
+00000930: 662e 6f70 7469 6f6e 732e 6765 7428 2772  f.options.get('r
+00000940: 6561 6477 7269 7465 6d61 6e79 272c 2046  eadwritemany', F
+00000950: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+00000960: 2020 2020 2020 6361 5f66 696c 6520 3d20        ca_file = 
+00000970: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00000980: 2827 6361 5f66 696c 6527 290a 2020 2020  ('ca_file').    
+00000990: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000009a0: 615f 6669 6c65 2069 7320 6e6f 7420 4e6f  a_file is not No
+000009b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000009c0: 2020 2020 2020 2020 6361 5f66 696c 6520          ca_file 
+000009d0: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
+000009e0: 7573 6572 2863 615f 6669 6c65 290a 2020  user(ca_file).  
+000009f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a00: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+00000a10: 2e65 7869 7374 7328 6361 5f66 696c 6529  .exists(ca_file)
+00000a20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00000a30: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00000a40: 6622 4361 2066 696c 6520 7b63 615f 6669  f"Ca file {ca_fi
+00000a50: 6c65 7d20 646f 6573 6e27 7420 6578 6973  le} doesn't exis
+00000a60: 742e 204c 6561 7669 6e67 2229 0a20 2020  t. Leaving").   
+00000a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a80: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+00000a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000aa0: 2064 6973 6b5f 686f 7470 6c75 6720 3d20   disk_hotplug = 
+00000ab0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00000ac0: 2827 6469 736b 5f68 6f74 706c 7567 272c  ('disk_hotplug',
+00000ad0: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+00000ae0: 2020 2020 2020 2020 6b75 6265 636f 6e66          kubeconf
+00000af0: 6967 5f66 696c 6520 3d20 7365 6c66 2e6f  ig_file = self.o
+00000b00: 7074 696f 6e73 2e67 6574 2827 6b75 6265  ptions.get('kube
+00000b10: 636f 6e66 6967 2729 0a20 2020 2020 2020  config').       
+00000b20: 2020 2020 2020 2020 2074 6f6b 656e 203d           token =
+00000b30: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00000b40: 7428 2774 6f6b 656e 2729 0a20 2020 2020  t('token').     
+00000b50: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+00000b60: 5f66 696c 6520 3d20 7365 6c66 2e6f 7074  _file = self.opt
+00000b70: 696f 6e73 2e67 6574 2827 746f 6b65 6e5f  ions.get('token_
+00000b80: 6669 6c65 2729 0a20 2020 2020 2020 2020  file').         
+00000b90: 2020 2020 2020 2069 6620 746f 6b65 6e5f         if token_
+00000ba0: 6669 6c65 2069 7320 6e6f 7420 4e6f 6e65  file is not None
+00000bb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00000bc0: 2020 2020 2020 746f 6b65 6e5f 6669 6c65        token_file
+00000bd0: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
+00000be0: 6475 7365 7228 746f 6b65 6e5f 6669 6c65  duser(token_file
+00000bf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00000c00: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+00000c10: 7061 7468 2e65 7869 7374 7328 746f 6b65  path.exists(toke
+00000c20: 6e5f 6669 6c65 293a 0a20 2020 2020 2020  n_file):.       
+00000c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000c40: 2065 7272 6f72 2822 546f 6b65 6e20 6669   error("Token fi
+00000c50: 6c65 2070 6174 6820 646f 6573 6e27 7420  le path doesn't 
+00000c60: 6578 6973 742e 204c 6561 7669 6e67 2229  exist. Leaving")
+00000c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000c80: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00000c90: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+00000ca0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00000cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000cc0: 2020 2020 2020 2074 6f6b 656e 203d 206f         token = o
+00000cd0: 7065 6e28 746f 6b65 6e5f 6669 6c65 292e  pen(token_file).
+00000ce0: 7265 6164 2829 0a20 2020 2020 2020 2020  read().         
+00000cf0: 2020 2020 2020 2072 6567 6973 7472 7920         registry 
+00000d00: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00000d10: 6574 2827 7265 6769 7374 7279 2729 0a20  et('registry'). 
+00000d20: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00000d30: 6363 6573 735f 6d6f 6465 203d 2073 656c  ccess_mode = sel
+00000d40: 662e 6f70 7469 6f6e 732e 6765 7428 2761  f.options.get('a
+00000d50: 6363 6573 735f 6d6f 6465 272c 2027 4e6f  ccess_mode', 'No
+00000d60: 6465 506f 7274 2729 0a20 2020 2020 2020  dePort').       
+00000d70: 2020 2020 2020 2020 2069 6620 6163 6365           if acce
+00000d80: 7373 5f6d 6f64 6520 6e6f 7420 696e 205b  ss_mode not in [
+00000d90: 2745 7874 6572 6e61 6c27 2c20 274c 6f61  'External', 'Loa
+00000da0: 6442 616c 616e 6365 7227 2c20 274e 6f64  dBalancer', 'Nod
+00000db0: 6550 6f72 7427 5d3a 0a20 2020 2020 2020  ePort']:.       
+00000dc0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+00000dd0: 203d 2066 2249 6e63 6f72 7265 6374 2061   = f"Incorrect a
+00000de0: 6363 6573 735f 6d6f 6465 207b 6163 6365  ccess_mode {acce
+00000df0: 7373 5f6d 6f64 657d 2e20 5368 6f75 6c64  ss_mode}. Should
+00000e00: 2062 6520 4578 7465 726e 616c 2c20 4e6f   be External, No
+00000e10: 6465 506f 7274 206f 7220 4c6f 6164 4261  dePort or LoadBa
+00000e20: 6c61 6e63 6572 220a 2020 2020 2020 2020  lancer".        
+00000e30: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00000e40: 7228 6d73 6729 0a20 2020 2020 2020 2020  r(msg).         
+00000e50: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00000e60: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+00000e70: 2020 2020 2020 2076 6f6c 756d 655f 6d6f         volume_mo
+00000e80: 6465 203d 2073 656c 662e 6f70 7469 6f6e  de = self.option
+00000e90: 732e 6765 7428 2776 6f6c 756d 655f 6d6f  s.get('volume_mo
+00000ea0: 6465 272c 2027 4669 6c65 7379 7374 656d  de', 'Filesystem
+00000eb0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00000ec0: 2020 2069 6620 766f 6c75 6d65 5f6d 6f64     if volume_mod
+00000ed0: 6520 6e6f 7420 696e 205b 2746 696c 6573  e not in ['Files
+00000ee0: 7973 7465 6d27 2c20 2742 6c6f 636b 275d  ystem', 'Block']
+00000ef0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00000f00: 2020 2020 2020 6d73 6720 3d20 6622 496e        msg = f"In
+00000f10: 636f 7272 6563 7420 766f 6c75 6d65 5f6d  correct volume_m
+00000f20: 6f64 6520 7b76 6f6c 756d 655f 6d6f 6465  ode {volume_mode
+00000f30: 7d2e 2053 686f 756c 6420 6265 2046 696c  }. Should be Fil
+00000f40: 6573 7973 7465 6d20 6f72 2042 6c6f 636b  esystem or Block
+00000f50: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00000f60: 2020 2020 2020 6572 726f 7228 6d73 6729        error(msg)
+00000f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000f80: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+00000f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000fa0: 2076 6f6c 756d 655f 6163 6365 7373 203d   volume_access =
+00000fb0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00000fc0: 7428 2776 6f6c 756d 655f 6163 6365 7373  t('volume_access
+00000fd0: 272c 2027 5265 6164 5772 6974 654f 6e63  ', 'ReadWriteOnc
+00000fe0: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+00000ff0: 2020 2020 6966 2076 6f6c 756d 655f 6163      if volume_ac
+00001000: 6365 7373 206e 6f74 2069 6e20 5b27 5265  cess not in ['Re
+00001010: 6164 5772 6974 654d 616e 7927 2c20 2752  adWriteMany', 'R
+00001020: 6561 6457 7269 7465 4f6e 6365 275d 3a0a  eadWriteOnce']:.
+00001030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001040: 2020 2020 6d73 6720 3d20 6622 496e 636f      msg = f"Inco
+00001050: 7272 6563 7420 766f 6c75 6d65 5f61 6363  rrect volume_acc
+00001060: 6573 7320 7b76 6f6c 756d 655f 6163 6365  ess {volume_acce
+00001070: 7373 7d2e 2053 686f 756c 6420 6265 2052  ss}. Should be R
+00001080: 6561 6457 7269 7465 4f6e 6365 206f 7220  eadWriteOnce or 
+00001090: 5265 6164 5772 6974 654f 6e63 6522 0a20  ReadWriteOnce". 
+000010a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000010b0: 2020 2065 7272 6f72 286d 7367 290a 2020     error(msg).  
+000010c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000010d0: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+000010e0: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+000010f0: 7276 6573 7465 7220 3d20 7365 6c66 2e6f  rvester = self.o
+00001100: 7074 696f 6e73 2e67 6574 2827 6861 7276  ptions.get('harv
+00001110: 6573 7465 7227 2c20 4661 6c73 6529 0a20  ester', False). 
+00001120: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00001130: 6d62 6564 5f75 7365 7264 6174 6120 3d20  mbed_userdata = 
+00001140: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00001150: 2827 656d 6265 645f 7573 6572 6461 7461  ('embed_userdata
+00001160: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
+00001170: 2020 2020 2020 2020 2020 6669 7273 745f            first_
+00001180: 636f 6e73 756d 6572 203d 2073 656c 662e  consumer = self.
+00001190: 6f70 7469 6f6e 732e 6765 7428 2766 6972  options.get('fir
+000011a0: 7374 5f63 6f6e 7375 6d65 7227 2c20 4661  st_consumer', Fa
+000011b0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+000011c0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000011d0: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+000011e0: 6f6d 206b 7669 7274 2e70 726f 7669 6465  om kvirt.provide
+000011f0: 7273 2e6b 7562 6576 6972 7420 696d 706f  rs.kubevirt impo
+00001200: 7274 204b 7562 6576 6972 740a 2020 2020  rt Kubevirt.    
+00001210: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00001220: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00001230: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00001240: 2020 2020 2020 2065 7863 6570 7469 6f6e         exception
+00001250: 203d 2065 2069 6620 6465 6275 6720 656c   = e if debug el
+00001260: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+00001270: 2020 2020 2020 2020 2020 2020 6465 7065              depe
+00001280: 6e64 656e 6379 5f65 7272 6f72 2827 6b75  ndency_error('ku
+00001290: 6265 7669 7274 272c 2065 7863 6570 7469  bevirt', excepti
+000012a0: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
+000012b0: 2020 2020 6b20 3d20 4b75 6265 7669 7274      k = Kubevirt
+000012c0: 2863 6f6e 7465 7874 3d63 6f6e 7465 7874  (context=context
+000012d0: 2c20 746f 6b65 6e3d 746f 6b65 6e2c 2063  , token=token, c
+000012e0: 615f 6669 6c65 3d63 615f 6669 6c65 2c20  a_file=ca_file, 
+000012f0: 686f 7374 3d73 656c 662e 686f 7374 2c0a  host=self.host,.
+00001300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001310: 2020 2020 2020 2020 2020 2020 2070 6f72               por
+00001320: 743d 3634 3433 2c20 7573 6572 3d73 656c  t=6443, user=sel
+00001330: 662e 7573 6572 2c20 6465 6275 673d 6465  f.user, debug=de
+00001340: 6275 672c 206e 616d 6573 7061 6365 3d6e  bug, namespace=n
+00001350: 616d 6573 7061 6365 2c0a 2020 2020 2020  amespace,.      
+00001360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001370: 2020 2020 2020 2064 6174 6176 6f6c 756d         datavolum
+00001380: 6573 3d64 6174 6176 6f6c 756d 6573 2c20  es=datavolumes, 
+00001390: 6469 736b 5f68 6f74 706c 7567 3d64 6973  disk_hotplug=dis
+000013a0: 6b5f 686f 7470 6c75 672c 2072 6561 6477  k_hotplug, readw
+000013b0: 7269 7465 6d61 6e79 3d72 6561 6477 7269  ritemany=readwri
+000013c0: 7465 6d61 6e79 2c0a 2020 2020 2020 2020  temany,.        
+000013d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000013e0: 2020 2020 2072 6567 6973 7472 793d 7265       registry=re
+000013f0: 6769 7374 7279 2c20 6163 6365 7373 5f6d  gistry, access_m
+00001400: 6f64 653d 6163 6365 7373 5f6d 6f64 652c  ode=access_mode,
+00001410: 2076 6f6c 756d 655f 6d6f 6465 3d76 6f6c   volume_mode=vol
+00001420: 756d 655f 6d6f 6465 2c0a 2020 2020 2020  ume_mode,.      
+00001430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001440: 2020 2020 2020 2076 6f6c 756d 655f 6163         volume_ac
+00001450: 6365 7373 3d76 6f6c 756d 655f 6163 6365  cess=volume_acce
+00001460: 7373 2c20 6861 7276 6573 7465 723d 6861  ss, harvester=ha
+00001470: 7276 6573 7465 722c 2065 6d62 6564 5f75  rvester, embed_u
+00001480: 7365 7264 6174 613d 656d 6265 645f 7573  serdata=embed_us
+00001490: 6572 6461 7461 2c0a 2020 2020 2020 2020  erdata,.        
+000014a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014b0: 2020 2020 2066 6972 7374 5f63 6f6e 7375       first_consu
+000014c0: 6d65 723d 6669 7273 745f 636f 6e73 756d  mer=first_consum
+000014d0: 6572 2c20 6b75 6265 636f 6e66 6967 5f66  er, kubeconfig_f
+000014e0: 696c 653d 6b75 6265 636f 6e66 6967 5f66  ile=kubeconfig_f
+000014f0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00001500: 2020 2020 2073 656c 662e 686f 7374 203d       self.host =
+00001510: 206b 2e68 6f73 740a 2020 2020 2020 2020   k.host.        
+00001520: 2020 2020 656c 6966 2073 656c 662e 7479      elif self.ty
+00001530: 7065 203d 3d20 2767 6370 273a 0a20 2020  pe == 'gcp':.   
+00001540: 2020 2020 2020 2020 2020 2020 2063 7265               cre
+00001550: 6465 6e74 6961 6c73 203d 2073 656c 662e  dentials = self.
+00001560: 6f70 7469 6f6e 732e 6765 7428 2763 7265  options.get('cre
+00001570: 6465 6e74 6961 6c73 2729 0a20 2020 2020  dentials').     
+00001580: 2020 2020 2020 2020 2020 2069 6620 6372             if cr
+00001590: 6564 656e 7469 616c 7320 6973 206e 6f74  edentials is not
+000015a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000015b0: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
+000015c0: 7669 726f 6e5b 2747 4f4f 474c 455f 4150  viron['GOOGLE_AP
+000015d0: 504c 4943 4154 494f 4e5f 4352 4544 454e  PLICATION_CREDEN
+000015e0: 5449 414c 5327 5d20 3d20 6f73 2e70 6174  TIALS'] = os.pat
+000015f0: 682e 6578 7061 6e64 7573 6572 2863 7265  h.expanduser(cre
+00001600: 6465 6e74 6961 6c73 290a 2020 2020 2020  dentials).      
+00001610: 2020 2020 2020 2020 2020 656c 6966 2027            elif '
+00001620: 474f 4f47 4c45 5f41 5050 4c49 4341 5449  GOOGLE_APPLICATI
+00001630: 4f4e 5f43 5245 4445 4e54 4941 4c53 2720  ON_CREDENTIALS' 
+00001640: 6e6f 7420 696e 206f 732e 656e 7669 726f  not in os.enviro
+00001650: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+00001660: 2020 2020 2020 2065 7272 6f72 2822 7365         error("se
+00001670: 7420 474f 4f47 4c45 5f41 5050 4c49 4341  t GOOGLE_APPLICA
+00001680: 5449 4f4e 5f43 5245 4445 4e54 4941 4c53  TION_CREDENTIALS
+00001690: 2076 6172 6961 626c 652e 4c65 6176 696e   variable.Leavin
+000016a0: 672e 2e2e 2229 0a20 2020 2020 2020 2020  g...").         
+000016b0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+000016c0: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+000016d0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+000016e0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+000016f0: 7428 2770 726f 6a65 6374 2729 0a20 2020  t('project').   
+00001700: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00001710: 7072 6f6a 6563 7420 6973 204e 6f6e 653a  project is None:
+00001720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001730: 2020 2020 2065 7272 6f72 2822 4d69 7373       error("Miss
+00001740: 696e 6720 7072 6f6a 6563 7420 696e 2074  ing project in t
+00001750: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
+00001760: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
+00001770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001780: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00001790: 2020 2020 2020 2020 2020 2020 7a6f 6e65              zone
+000017a0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+000017b0: 6765 7428 277a 6f6e 6527 2c20 2765 7572  get('zone', 'eur
+000017c0: 6f70 652d 7765 7374 312d 6227 2920 6966  ope-west1-b') if
+000017d0: 207a 6f6e 6520 6973 204e 6f6e 6520 656c   zone is None el
+000017e0: 7365 207a 6f6e 650a 2020 2020 2020 2020  se zone.        
+000017f0: 2020 2020 2020 2020 7265 6769 6f6e 203d          region =
+00001800: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00001810: 7428 2772 6567 696f 6e27 2920 6966 2072  t('region') if r
+00001820: 6567 696f 6e20 6973 204e 6f6e 6520 656c  egion is None el
+00001830: 7365 2072 6567 696f 6e0a 2020 2020 2020  se region.      
+00001840: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+00001850: 203d 207a 6f6e 655b 3a2d 325d 2069 6620   = zone[:-2] if 
+00001860: 7265 6769 6f6e 2069 7320 4e6f 6e65 2065  region is None e
+00001870: 6c73 6520 7265 6769 6f6e 0a20 2020 2020  lse region.     
+00001880: 2020 2020 2020 2020 2020 2070 7562 6c69             publi
+00001890: 6320 3d20 7365 6c66 2e6f 7074 696f 6e73  c = self.options
+000018a0: 2e67 6574 2827 7075 626c 6963 272c 2054  .get('public', T
+000018b0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000018c0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000018d0: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+000018e0: 6f6d 206b 7669 7274 2e70 726f 7669 6465  om kvirt.provide
+000018f0: 7273 2e67 6370 2069 6d70 6f72 7420 4b67  rs.gcp import Kg
+00001900: 6370 0a20 2020 2020 2020 2020 2020 2020  cp.             
+00001910: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00001920: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00001930: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00001940: 6365 7074 696f 6e20 3d20 6520 6966 2064  ception = e if d
+00001950: 6562 7567 2065 6c73 6520 4e6f 6e65 0a20  ebug else None. 
+00001960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001970: 2020 2064 6570 656e 6465 6e63 795f 6572     dependency_er
+00001980: 726f 7228 2767 6370 272c 2065 7863 6570  ror('gcp', excep
+00001990: 7469 6f6e 290a 2020 2020 2020 2020 2020  tion).          
+000019a0: 2020 2020 2020 6b20 3d20 4b67 6370 2870        k = Kgcp(p
+000019b0: 726f 6a65 6374 2c20 7a6f 6e65 3d7a 6f6e  roject, zone=zon
+000019c0: 652c 2072 6567 696f 6e3d 7265 6769 6f6e  e, region=region
+000019d0: 2c20 6465 6275 673d 6465 6275 672c 2070  , debug=debug, p
+000019e0: 7562 6c69 633d 7075 626c 6963 290a 2020  ublic=public).  
+000019f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00001a00: 6c66 2e6f 7665 7272 6964 6573 2e75 7064  lf.overrides.upd
+00001a10: 6174 6528 7b27 7072 6f6a 6563 7427 3a20  ate({'project': 
+00001a20: 7072 6f6a 6563 747d 290a 2020 2020 2020  project}).      
+00001a30: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+00001a40: 7479 7065 203d 3d20 2761 7a75 7265 273a  type == 'azure':
+00001a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001a60: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00001a70: 2020 2020 2020 2020 2020 6672 6f6d 206b            from k
+00001a80: 7669 7274 2e70 726f 7669 6465 7273 2e61  virt.providers.a
+00001a90: 7a75 7265 2069 6d70 6f72 7420 4b61 7a75  zure import Kazu
+00001aa0: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
+00001ab0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00001ac0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00001ad0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00001ae0: 6365 7074 696f 6e20 3d20 6520 6966 2064  ception = e if d
+00001af0: 6562 7567 2065 6c73 6520 4e6f 6e65 0a20  ebug else None. 
+00001b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b10: 2020 2064 6570 656e 6465 6e63 795f 6572     dependency_er
+00001b20: 726f 7228 2761 7a75 7265 272c 2065 7863  ror('azure', exc
+00001b30: 6570 7469 6f6e 290a 2020 2020 2020 2020  eption).        
+00001b40: 2020 2020 2020 2020 6164 6d69 6e5f 7573          admin_us
+00001b50: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
+00001b60: 732e 6765 7428 2761 646d 696e 5f75 7365  s.get('admin_use
+00001b70: 7227 2c20 2773 7570 6572 6164 6d69 6e27  r', 'superadmin'
+00001b80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001b90: 2020 6164 6d69 6e5f 7061 7373 776f 7264    admin_password
+00001ba0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00001bb0: 6765 7428 2761 646d 696e 5f70 6173 7377  get('admin_passw
+00001bc0: 6f72 6427 290a 2020 2020 2020 2020 2020  ord').          
+00001bd0: 2020 2020 2020 7375 6273 6372 6970 7469        subscripti
+00001be0: 6f6e 5f69 6420 3d20 7365 6c66 2e6f 7074  on_id = self.opt
+00001bf0: 696f 6e73 2e67 6574 2827 7375 6273 6372  ions.get('subscr
+00001c00: 6970 7469 6f6e 5f69 6427 290a 2020 2020  iption_id').    
+00001c10: 2020 2020 2020 2020 2020 2020 7465 6e61              tena
+00001c20: 6e74 5f69 6420 3d20 7365 6c66 2e6f 7074  nt_id = self.opt
+00001c30: 696f 6e73 2e67 6574 2827 7465 6e61 6e74  ions.get('tenant
+00001c40: 5f69 6427 290a 2020 2020 2020 2020 2020  _id').          
+00001c50: 2020 2020 2020 6170 705f 6964 203d 2073        app_id = s
+00001c60: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00001c70: 2761 7070 5f69 6427 290a 2020 2020 2020  'app_id').      
+00001c80: 2020 2020 2020 2020 2020 7365 6372 6574            secret
+00001c90: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00001ca0: 6765 7428 2773 6563 7265 7427 290a 2020  get('secret').  
+00001cb0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00001cc0: 6361 7469 6f6e 203d 2073 656c 662e 6f70  cation = self.op
+00001cd0: 7469 6f6e 732e 6765 7428 276c 6f63 6174  tions.get('locat
+00001ce0: 696f 6e27 2c20 2777 6573 7475 7327 290a  ion', 'westus').
+00001cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001d00: 7265 736f 7572 6365 5f67 726f 7570 203d  resource_group =
+00001d10: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00001d20: 7428 2772 6573 6f75 7263 655f 6772 6f75  t('resource_grou
+00001d30: 7027 2c20 276b 636c 6927 290a 2020 2020  p', 'kcli').    
+00001d40: 2020 2020 2020 2020 2020 2020 6d61 696c              mail
+00001d50: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00001d60: 6765 7428 276d 6169 6c27 290a 2020 2020  get('mail').    
+00001d70: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
+00001d80: 6167 6561 6363 6f75 6e74 203d 2073 656c  ageaccount = sel
+00001d90: 662e 6f70 7469 6f6e 732e 6765 7428 2773  f.options.get('s
+00001da0: 746f 7261 6765 6163 636f 756e 7427 290a  torageaccount').
+00001db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001dc0: 6966 2073 7562 7363 7269 7074 696f 6e5f  if subscription_
+00001dd0: 6964 2069 7320 4e6f 6e65 3a0a 2020 2020  id is None:.    
+00001de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001df0: 6572 726f 7228 224d 6973 7369 6e67 2073  error("Missing s
+00001e00: 7562 7363 7269 7074 696f 6e5f 6964 2069  ubscription_id i
+00001e10: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
+00001e20: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
+00001e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001e40: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+00001e50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001e60: 6620 7465 6e61 6e74 5f69 6420 6973 204e  f tenant_id is N
+00001e70: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00001e80: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+00001e90: 4d69 7373 696e 6720 7465 6e61 6e74 5f69  Missing tenant_i
+00001ea0: 6420 696e 2074 6865 2063 6f6e 6669 6775  d in the configu
+00001eb0: 7261 7469 6f6e 2e20 4c65 6176 696e 6722  ration. Leaving"
+00001ec0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001ed0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+00001ee0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001ef0: 2020 6966 2061 7070 5f69 6420 6973 204e    if app_id is N
+00001f00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00001f10: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+00001f20: 4d69 7373 696e 6720 6170 705f 6964 2069  Missing app_id i
+00001f30: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
+00001f40: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
+00001f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f60: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+00001f70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001f80: 6620 7365 6372 6574 2069 7320 4e6f 6e65  f secret is None
+00001f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001fa0: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
+00001fb0: 7369 6e67 2073 6563 7265 7420 696e 2074  sing secret in t
+00001fc0: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
+00001fd0: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
+00001fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001ff0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00002000: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+00002010: 4b61 7a75 7265 2873 7562 7363 7269 7074  Kazure(subscript
+00002020: 696f 6e5f 6964 3d73 7562 7363 7269 7074  ion_id=subscript
+00002030: 696f 6e5f 6964 2c20 7465 6e61 6e74 5f69  ion_id, tenant_i
+00002040: 643d 7465 6e61 6e74 5f69 642c 2061 7070  d=tenant_id, app
+00002050: 5f69 643d 6170 705f 6964 2c20 6c6f 6361  _id=app_id, loca
+00002060: 7469 6f6e 3d6c 6f63 6174 696f 6e2c 0a20  tion=location,. 
 00002070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002090: 2020 2020 224d 6973 7369 6e67 2064 6566      "Missing def
-000020a0: 6175 6c74 2073 6563 7469 6f6e 2069 6e20  ault section in 
-000020b0: 7e2f 2e69 626d 2f63 7265 6465 6e74 6961  ~/.ibm/credentia
-000020c0: 6c73 2066 696c 652e 204c 6561 7669 6e67  ls file. Leaving
-000020d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000020e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020f0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00002100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002110: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
-00002120: 616d 5f61 7069 5f6b 6579 2720 696e 2063  am_api_key' in c
-00002130: 7265 6463 6f6e 6669 675b 2764 6566 6175  redconfig['defau
-00002140: 6c74 275d 3a0a 2020 2020 2020 2020 2020  lt']:.          
-00002150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002160: 2020 2020 2020 6961 6d5f 6170 695f 6b65        iam_api_ke
-00002170: 7920 3d20 6372 6564 636f 6e66 6967 5b27  y = credconfig['
-00002180: 6465 6661 756c 7427 5d5b 2769 616d 5f61  default']['iam_a
-00002190: 7069 5f6b 6579 275d 0a20 2020 2020 2020  pi_key'].       
-000021a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000021b0: 2020 2020 2069 6620 2761 6363 6573 735f       if 'access_
-000021c0: 6b65 795f 6964 2720 696e 2063 7265 6463  key_id' in credc
-000021d0: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
-000021e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000021f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002200: 2020 636f 735f 6170 695f 6b65 7920 3d20    cos_api_key = 
-00002210: 6372 6564 636f 6e66 6967 5b27 6465 6661  credconfig['defa
-00002220: 756c 7427 5d5b 2761 6363 6573 735f 6b65  ult']['access_ke
-00002230: 795f 6964 275d 0a20 2020 2020 2020 2020  y_id'].         
-00002240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002250: 2020 2069 6620 2773 6563 7265 745f 6163     if 'secret_ac
-00002260: 6365 7373 5f6b 6579 2720 696e 2063 7265  cess_key' in cre
-00002270: 6463 6f6e 6669 675b 2764 6566 6175 6c74  dconfig['default
-00002280: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00002290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000022a0: 2020 2020 636f 735f 7265 736f 7572 6365      cos_resource
-000022b0: 5f69 6e73 7461 6e63 655f 6964 203d 2063  _instance_id = c
-000022c0: 7265 6463 6f6e 6669 675b 2764 6566 6175  redconfig['defau
-000022d0: 6c74 275d 5b27 7365 6372 6574 5f61 6363  lt']['secret_acc
-000022e0: 6573 735f 6b65 7927 5d0a 2020 2020 2020  ess_key'].      
-000022f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002300: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-00002310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002320: 2020 2020 2020 6572 726f 7228 2243 6f75        error("Cou
-00002330: 646c 6e27 7420 7061 7273 6520 7e2f 2e69  dln't parse ~/.i
-00002340: 626d 2f63 7265 6465 6e74 6961 6c73 2066  bm/credentials f
-00002350: 696c 652e 204c 6561 7669 6e67 2229 0a20  ile. Leaving"). 
-00002360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002370: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00002380: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-00002390: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-000023a0: 2e70 6174 682e 6578 6973 7473 2866 227b  .path.exists(f"{
-000023b0: 686f 6d65 7d2f 2e69 626d 2f63 6f6e 6669  home}/.ibm/confi
-000023c0: 6722 293a 0a20 2020 2020 2020 2020 2020  g"):.           
-000023d0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-000023e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000023f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00002400: 6e66 636f 6e66 6967 203d 2063 6f6e 6669  nfconfig = confi
-00002410: 6770 6172 7365 722e 436f 6e66 6967 5061  gparser.ConfigPa
-00002420: 7273 6572 2829 0a20 2020 2020 2020 2020  rser().         
-00002430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002440: 2020 2063 6f6e 6663 6f6e 6669 672e 7265     confconfig.re
-00002450: 6164 2866 227b 686f 6d65 7d2f 2e69 626d  ad(f"{home}/.ibm
-00002460: 2f63 6f6e 6669 6722 290a 2020 2020 2020  /config").      
-00002470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002480: 2020 2020 2020 6966 2027 6465 6661 756c        if 'defaul
-00002490: 7427 206e 6f74 2069 6e20 636f 6e66 636f  t' not in confco
-000024a0: 6e66 6967 3a0a 2020 2020 2020 2020 2020  nfig:.          
-000024b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024c0: 2020 2020 2020 6572 726f 7228 0a20 2020        error(.   
-000024d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024f0: 2022 4d69 7373 696e 6720 6465 6661 756c   "Missing defaul
-00002500: 7420 7365 6374 696f 6e20 696e 207e 2f2e  t section in ~/.
-00002510: 6962 6d2f 636f 6e66 6967 2066 696c 652e  ibm/config file.
-00002520: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
+00002080: 2020 2020 2020 2020 2020 7365 6372 6574            secret
+00002090: 3d73 6563 7265 742c 2072 6573 6f75 7263  =secret, resourc
+000020a0: 655f 6772 6f75 703d 7265 736f 7572 6365  e_group=resource
+000020b0: 5f67 726f 7570 2c20 6164 6d69 6e5f 7573  _group, admin_us
+000020c0: 6572 3d61 646d 696e 5f75 7365 722c 0a20  er=admin_user,. 
+000020d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000020e0: 2020 2020 2020 2020 2020 6164 6d69 6e5f            admin_
+000020f0: 7061 7373 776f 7264 3d61 646d 696e 5f70  password=admin_p
+00002100: 6173 7377 6f72 642c 206d 6169 6c3d 6d61  assword, mail=ma
+00002110: 696c 2c20 7374 6f72 6167 6561 6363 6f75  il, storageaccou
+00002120: 6e74 3d73 746f 7261 6765 6163 636f 756e  nt=storageaccoun
+00002130: 742c 2064 6562 7567 3d64 6562 7567 290a  t, debug=debug).
+00002140: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00002150: 2073 656c 662e 7479 7065 203d 3d20 2761   self.type == 'a
+00002160: 7773 273a 0a20 2020 2020 2020 2020 2020  ws':.           
+00002170: 2020 2020 2061 6363 6573 735f 6b65 795f       access_key_
+00002180: 6964 203d 2073 656c 662e 6f70 7469 6f6e  id = self.option
+00002190: 732e 6765 7428 2761 6363 6573 735f 6b65  s.get('access_ke
+000021a0: 795f 6964 2729 0a20 2020 2020 2020 2020  y_id').         
+000021b0: 2020 2020 2020 2061 6363 6573 735f 6b65         access_ke
+000021c0: 795f 7365 6372 6574 203d 2073 656c 662e  y_secret = self.
+000021d0: 6f70 7469 6f6e 732e 6765 7428 2761 6363  options.get('acc
+000021e0: 6573 735f 6b65 795f 7365 6372 6574 2729  ess_key_secret')
+000021f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002200: 206b 6579 7061 6972 203d 2073 656c 662e   keypair = self.
+00002210: 6f70 7469 6f6e 732e 6765 7428 276b 6579  options.get('key
+00002220: 7061 6972 2729 0a20 2020 2020 2020 2020  pair').         
+00002230: 2020 2020 2020 2073 6573 7369 6f6e 5f74         session_t
+00002240: 6f6b 656e 203d 2073 656c 662e 6f70 7469  oken = self.opti
+00002250: 6f6e 732e 6765 7428 2773 6573 7369 6f6e  ons.get('session
+00002260: 5f74 6f6b 656e 2729 0a20 2020 2020 2020  _token').       
+00002270: 2020 2020 2020 2020 2072 6567 696f 6e20           region 
+00002280: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00002290: 6574 2827 7265 6769 6f6e 2729 2069 6620  et('region') if 
+000022a0: 7265 6769 6f6e 2069 7320 4e6f 6e65 2065  region is None e
+000022b0: 6c73 6520 7265 6769 6f6e 0a20 2020 2020  lse region.     
+000022c0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+000022d0: 6769 6f6e 2069 7320 4e6f 6e65 3a0a 2020  gion is None:.  
+000022e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000022f0: 2020 6572 726f 7228 224d 6973 7369 6e67    error("Missing
+00002300: 2072 6567 696f 6e20 696e 2074 6865 2063   region in the c
+00002310: 6f6e 6669 6775 7261 7469 6f6e 2e20 4c65  onfiguration. Le
+00002320: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
+00002330: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00002340: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+00002350: 2020 2020 2020 2020 6966 2061 6363 6573          if acces
+00002360: 735f 6b65 795f 6964 2069 7320 4e6f 6e65  s_key_id is None
+00002370: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002380: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
+00002390: 7369 6e67 2061 6363 6573 735f 6b65 795f  sing access_key_
+000023a0: 6964 2069 6e20 7468 6520 636f 6e66 6967  id in the config
+000023b0: 7572 6174 696f 6e2e 204c 6561 7669 6e67  uration. Leaving
+000023c0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000023d0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+000023e0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+000023f0: 2020 2069 6620 6163 6365 7373 5f6b 6579     if access_key
+00002400: 5f73 6563 7265 7420 6973 204e 6f6e 653a  _secret is None:
+00002410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002420: 2020 2020 2065 7272 6f72 2822 4d69 7373       error("Miss
+00002430: 696e 6720 6163 6365 7373 5f6b 6579 5f73  ing access_key_s
+00002440: 6563 7265 7420 696e 2074 6865 2063 6f6e  ecret in the con
+00002450: 6669 6775 7261 7469 6f6e 2e20 4c65 6176  figuration. Leav
+00002460: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
+00002470: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00002480: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+00002490: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000024a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000024b0: 726f 6d20 6b76 6972 742e 7072 6f76 6964  rom kvirt.provid
+000024c0: 6572 732e 6177 7320 696d 706f 7274 204b  ers.aws import K
+000024d0: 6177 730a 2020 2020 2020 2020 2020 2020  aws.            
+000024e0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+000024f0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00002500: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00002510: 7863 6570 7469 6f6e 203d 2065 2069 6620  xception = e if 
+00002520: 6465 6275 6720 656c 7365 204e 6f6e 650a  debug else None.
 00002530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002540: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00002550: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-00002560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002570: 2020 2069 6620 2769 616d 5f61 7069 5f6b     if 'iam_api_k
-00002580: 6579 2720 696e 2063 6f6e 6663 6f6e 6669  ey' in confconfi
-00002590: 675b 2764 6566 6175 6c74 275d 3a0a 2020  g['default']:.  
-000025a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000025b0: 2020 2020 2020 2020 2020 2020 2020 6961                ia
-000025c0: 6d5f 6170 695f 6b65 7920 3d20 636f 6e66  m_api_key = conf
-000025d0: 636f 6e66 6967 5b27 6465 6661 756c 7427  config['default'
-000025e0: 5d5b 2769 616d 5f61 7069 5f6b 6579 275d  ]['iam_api_key']
-000025f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002600: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00002610: 2761 6363 6573 735f 6b65 795f 6964 2720  'access_key_id' 
-00002620: 696e 2063 6f6e 6663 6f6e 6669 675b 2764  in confconfig['d
-00002630: 6566 6175 6c74 275d 3a0a 2020 2020 2020  efault']:.      
-00002640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002650: 2020 2020 2020 2020 2020 636f 735f 6170            cos_ap
-00002660: 695f 6b65 7920 3d20 636f 6e66 636f 6e66  i_key = confconf
-00002670: 6967 5b27 6465 6661 756c 7427 5d5b 2761  ig['default']['a
-00002680: 6363 6573 735f 6b65 795f 6964 275d 0a20  ccess_key_id']. 
-00002690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000026a0: 2020 2020 2020 2020 2020 2069 6620 2773             if 's
-000026b0: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
-000026c0: 2720 696e 2063 6f6e 6663 6f6e 6669 675b  ' in confconfig[
-000026d0: 2764 6566 6175 6c74 275d 3a0a 2020 2020  'default']:.    
-000026e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000026f0: 2020 2020 2020 2020 2020 2020 636f 735f              cos_
-00002700: 7265 736f 7572 6365 5f69 6e73 7461 6e63  resource_instanc
-00002710: 655f 6964 203d 2063 6f6e 6663 6f6e 6669  e_id = confconfi
-00002720: 675b 2764 6566 6175 6c74 275d 5b27 7365  g['default']['se
-00002730: 6372 6574 5f61 6363 6573 735f 6b65 7927  cret_access_key'
-00002740: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00002750: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00002760: 2027 7265 6769 6f6e 2720 696e 2063 6f6e   'region' in con
-00002770: 6663 6f6e 6669 675b 2764 6566 6175 6c74  fconfig['default
-00002780: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00002790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027a0: 2020 2020 7265 6769 6f6e 203d 2063 6f6e      region = con
-000027b0: 6663 6f6e 6669 675b 2764 6566 6175 6c74  fconfig['default
-000027c0: 275d 5b27 7265 6769 6f6e 275d 0a20 2020  ']['region'].   
-000027d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027e0: 2020 2020 2020 2020 2069 6620 277a 6f6e           if 'zon
-000027f0: 6527 2069 6e20 636f 6e66 636f 6e66 6967  e' in confconfig
-00002800: 5b27 6465 6661 756c 7427 5d3a 0a20 2020  ['default']:.   
-00002810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002820: 2020 2020 2020 2020 2020 2020 207a 6f6e               zon
-00002830: 6520 3d20 636f 6e66 636f 6e66 6967 5b27  e = confconfig['
-00002840: 6465 6661 756c 7427 5d5b 277a 6f6e 6527  default']['zone'
-00002850: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00002860: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00002870: 2027 7670 6327 2069 6e20 636f 6e66 636f   'vpc' in confco
-00002880: 6e66 6967 5b27 6465 6661 756c 7427 5d3a  nfig['default']:
-00002890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000028a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000028b0: 207a 6f6e 6520 3d20 636f 6e66 636f 6e66   zone = confconf
-000028c0: 6967 5b27 6465 6661 756c 7427 5d5b 2776  ig['default']['v
-000028d0: 7063 275d 0a20 2020 2020 2020 2020 2020  pc'].           
-000028e0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-000028f0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00002900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002910: 2065 7272 6f72 2822 436f 7564 6c6e 2774   error("Coudln't
-00002920: 2070 6172 7365 207e 2f2e 6962 6d2f 636f   parse ~/.ibm/co
-00002930: 6e66 6967 2066 696c 652e 204c 6561 7669  nfig file. Leavi
-00002940: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
-00002950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002960: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-00002970: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00002980: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00002990: 2020 2020 2020 2069 616d 5f61 7069 5f6b         iam_api_k
-000029a0: 6579 203d 2073 656c 662e 6f70 7469 6f6e  ey = self.option
-000029b0: 732e 6765 7428 2769 616d 5f61 7069 5f6b  s.get('iam_api_k
-000029c0: 6579 2729 0a20 2020 2020 2020 2020 2020  ey').           
-000029d0: 2020 2020 2020 2020 2063 6f73 5f61 7069           cos_api
-000029e0: 5f6b 6579 203d 2073 656c 662e 6f70 7469  _key = self.opti
-000029f0: 6f6e 732e 6765 7428 2763 6f73 5f61 7069  ons.get('cos_api
-00002a00: 5f6b 6579 2729 0a20 2020 2020 2020 2020  _key').         
-00002a10: 2020 2020 2020 2020 2020 2063 6f73 5f72             cos_r
-00002a20: 6573 6f75 7263 655f 696e 7374 616e 6365  esource_instance
-00002a30: 5f69 6420 3d20 7365 6c66 2e6f 7074 696f  _id = self.optio
-00002a40: 6e73 2e67 6574 2827 636f 735f 7265 736f  ns.get('cos_reso
-00002a50: 7572 6365 5f69 6e73 7461 6e63 655f 6964  urce_instance_id
-00002a60: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00002a70: 2020 2020 2020 2063 6973 5f72 6573 6f75         cis_resou
-00002a80: 7263 655f 696e 7374 616e 6365 5f69 6420  rce_instance_id 
-00002a90: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00002aa0: 6574 2827 6369 735f 7265 736f 7572 6365  et('cis_resource
-00002ab0: 5f69 6e73 7461 6e63 655f 6964 2729 0a20  _instance_id'). 
-00002ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ad0: 2020 2072 6567 696f 6e20 3d20 7365 6c66     region = self
-00002ae0: 2e6f 7074 696f 6e73 2e67 6574 2827 7265  .options.get('re
-00002af0: 6769 6f6e 2729 2069 6620 7265 6769 6f6e  gion') if region
-00002b00: 2069 7320 4e6f 6e65 2065 6c73 6520 7265   is None else re
-00002b10: 6769 6f6e 0a20 2020 2020 2020 2020 2020  gion.           
-00002b20: 2020 2020 2020 2020 207a 6f6e 6520 3d20           zone = 
-00002b30: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00002b40: 2827 7a6f 6e65 2729 2069 6620 7a6f 6e65  ('zone') if zone
-00002b50: 2069 7320 4e6f 6e65 2065 6c73 6520 7a6f   is None else zo
-00002b60: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-00002b70: 2020 2020 2020 2076 7063 203d 2073 656c         vpc = sel
-00002b80: 662e 6f70 7469 6f6e 732e 6765 7428 2776  f.options.get('v
-00002b90: 7063 2729 0a20 2020 2020 2020 2020 2020  pc').           
-00002ba0: 2020 2020 2069 6620 6961 6d5f 6170 695f       if iam_api_
-00002bb0: 6b65 7920 6973 204e 6f6e 653a 0a20 2020  key is None:.   
+00002540: 2020 2020 6465 7065 6e64 656e 6379 5f65      dependency_e
+00002550: 7272 6f72 2827 6177 7327 2c20 6578 6365  rror('aws', exce
+00002560: 7074 696f 6e29 0a20 2020 2020 2020 2020  ption).         
+00002570: 2020 2020 2020 206b 203d 204b 6177 7328         k = Kaws(
+00002580: 6163 6365 7373 5f6b 6579 5f69 643d 6163  access_key_id=ac
+00002590: 6365 7373 5f6b 6579 5f69 642c 2061 6363  cess_key_id, acc
+000025a0: 6573 735f 6b65 795f 7365 6372 6574 3d61  ess_key_secret=a
+000025b0: 6363 6573 735f 6b65 795f 7365 6372 6574  ccess_key_secret
+000025c0: 2c20 7265 6769 6f6e 3d72 6567 696f 6e2c  , region=region,
+000025d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000025e0: 2020 2020 2020 2020 2020 6465 6275 673d            debug=
+000025f0: 6465 6275 672c 206b 6579 7061 6972 3d6b  debug, keypair=k
+00002600: 6579 7061 6972 2c20 7365 7373 696f 6e5f  eypair, session_
+00002610: 746f 6b65 6e3d 7365 7373 696f 6e5f 746f  token=session_to
+00002620: 6b65 6e29 0a20 2020 2020 2020 2020 2020  ken).           
+00002630: 2065 6c69 6620 7365 6c66 2e74 7970 6520   elif self.type 
+00002640: 3d3d 2027 6962 6d27 3a0a 2020 2020 2020  == 'ibm':.      
+00002650: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00002660: 2873 656c 662e 6f70 7469 6f6e 7329 203d  (self.options) =
+00002670: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00002680: 2020 2020 2020 2020 2068 6f6d 6520 3d20           home = 
+00002690: 6f73 2e65 6e76 6972 6f6e 5b27 484f 4d45  os.environ['HOME
+000026a0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+000026b0: 2020 2020 2020 2069 616d 5f61 7069 5f6b         iam_api_k
+000026c0: 6579 2c20 7265 6769 6f6e 2c20 7a6f 6e65  ey, region, zone
+000026d0: 2c20 7670 6320 3d20 4e6f 6e65 2c20 4e6f  , vpc = None, No
+000026e0: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 0a20  ne, None, None. 
+000026f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002700: 2020 2063 6f73 5f61 7069 5f6b 6579 2c20     cos_api_key, 
+00002710: 636f 735f 7265 736f 7572 6365 5f69 6e73  cos_resource_ins
+00002720: 7461 6e63 655f 6964 2c20 6369 735f 7265  tance_id, cis_re
+00002730: 736f 7572 6365 5f69 6e73 7461 6e63 655f  source_instance_
+00002740: 6964 203d 204e 6f6e 652c 204e 6f6e 652c  id = None, None,
+00002750: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00002760: 2020 2020 2020 2020 2020 696d 706f 7274            import
+00002770: 2063 6f6e 6669 6770 6172 7365 720a 2020   configparser.  
+00002780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002790: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+000027a0: 7374 7328 6622 7b68 6f6d 657d 2f2e 6962  sts(f"{home}/.ib
+000027b0: 6d2f 6372 6564 656e 7469 616c 7322 293a  m/credentials"):
+000027c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000027d0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+000027e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000027f0: 2020 2020 2020 2020 2020 6372 6564 636f            credco
+00002800: 6e66 6967 203d 2063 6f6e 6669 6770 6172  nfig = configpar
+00002810: 7365 722e 436f 6e66 6967 5061 7273 6572  ser.ConfigParser
+00002820: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00002830: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00002840: 7265 6463 6f6e 6669 672e 7265 6164 2866  redconfig.read(f
+00002850: 227b 686f 6d65 7d2f 2e69 626d 2f63 7265  "{home}/.ibm/cre
+00002860: 6465 6e74 6961 6c73 2229 0a20 2020 2020  dentials").     
+00002870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002880: 2020 2020 2020 2069 6620 2764 6566 6175         if 'defau
+00002890: 6c74 2720 6e6f 7420 696e 2063 7265 6463  lt' not in credc
+000028a0: 6f6e 6669 673a 0a20 2020 2020 2020 2020  onfig:.         
+000028b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000028c0: 2020 2020 2020 2065 7272 6f72 280a 2020         error(.  
+000028d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000028e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000028f0: 2020 224d 6973 7369 6e67 2064 6566 6175    "Missing defau
+00002900: 6c74 2073 6563 7469 6f6e 2069 6e20 7e2f  lt section in ~/
+00002910: 2e69 626d 2f63 7265 6465 6e74 6961 6c73  .ibm/credentials
+00002920: 2066 696c 652e 204c 6561 7669 6e67 2229   file. Leaving")
+00002930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002950: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00002960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002970: 2020 2020 2020 2020 2069 6620 2769 616d           if 'iam
+00002980: 5f61 7069 5f6b 6579 2720 696e 2063 7265  _api_key' in cre
+00002990: 6463 6f6e 6669 675b 2764 6566 6175 6c74  dconfig['default
+000029a0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+000029b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000029c0: 2020 2020 6961 6d5f 6170 695f 6b65 7920      iam_api_key 
+000029d0: 3d20 6372 6564 636f 6e66 6967 5b27 6465  = credconfig['de
+000029e0: 6661 756c 7427 5d5b 2769 616d 5f61 7069  fault']['iam_api
+000029f0: 5f6b 6579 275d 0a20 2020 2020 2020 2020  _key'].         
+00002a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a10: 2020 2069 6620 2761 6363 6573 735f 6b65     if 'access_ke
+00002a20: 795f 6964 2720 696e 2063 7265 6463 6f6e  y_id' in credcon
+00002a30: 6669 675b 2764 6566 6175 6c74 275d 3a0a  fig['default']:.
+00002a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a60: 636f 735f 6170 695f 6b65 7920 3d20 6372  cos_api_key = cr
+00002a70: 6564 636f 6e66 6967 5b27 6465 6661 756c  edconfig['defaul
+00002a80: 7427 5d5b 2761 6363 6573 735f 6b65 795f  t']['access_key_
+00002a90: 6964 275d 0a20 2020 2020 2020 2020 2020  id'].           
+00002aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ab0: 2069 6620 2773 6563 7265 745f 6163 6365   if 'secret_acce
+00002ac0: 7373 5f6b 6579 2720 696e 2063 7265 6463  ss_key' in credc
+00002ad0: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
+00002ae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b00: 2020 636f 735f 7265 736f 7572 6365 5f69    cos_resource_i
+00002b10: 6e73 7461 6e63 655f 6964 203d 2063 7265  nstance_id = cre
+00002b20: 6463 6f6e 6669 675b 2764 6566 6175 6c74  dconfig['default
+00002b30: 275d 5b27 7365 6372 6574 5f61 6363 6573  ']['secret_acces
+00002b40: 735f 6b65 7927 5d0a 2020 2020 2020 2020  s_key'].        
+00002b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b60: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00002b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b80: 2020 2020 6572 726f 7228 2243 6f75 646c      error("Coudl
+00002b90: 6e27 7420 7061 7273 6520 7e2f 2e69 626d  n't parse ~/.ibm
+00002ba0: 2f63 7265 6465 6e74 6961 6c73 2066 696c  /credentials fil
+00002bb0: 652e 204c 6561 7669 6e67 2229 0a20 2020  e. Leaving").   
 00002bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002bd0: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
-00002be0: 6961 6d5f 6170 695f 6b65 7920 696e 2074  iam_api_key in t
-00002bf0: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
-00002c00: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
-00002c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c20: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-00002c30: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00002c40: 6567 696f 6e20 6973 204e 6f6e 653a 0a20  egion is None:. 
-00002c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c60: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
-00002c70: 6720 7265 6769 6f6e 2069 6e20 7468 6520  g region in the 
-00002c80: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
-00002c90: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
-00002ca0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00002cb0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00002cc0: 2020 2020 2020 2020 2066 726f 6d20 6b76           from kv
-00002cd0: 6972 742e 7072 6f76 6964 6572 732e 6962  irt.providers.ib
-00002ce0: 6d20 696d 706f 7274 204b 6962 6d0a 2020  m import Kibm.  
-00002cf0: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
-00002d00: 3d20 4b69 626d 2869 616d 5f61 7069 5f6b  = Kibm(iam_api_k
-00002d10: 6579 3d69 616d 5f61 7069 5f6b 6579 2c20  ey=iam_api_key, 
-00002d20: 7265 6769 6f6e 3d72 6567 696f 6e2c 207a  region=region, z
-00002d30: 6f6e 653d 7a6f 6e65 2c20 7670 633d 7670  one=zone, vpc=vp
-00002d40: 632c 2064 6562 7567 3d64 6562 7567 2c0a  c, debug=debug,.
-00002d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d60: 2020 2020 2020 2020 2063 6f73 5f61 7069           cos_api
-00002d70: 5f6b 6579 3d63 6f73 5f61 7069 5f6b 6579  _key=cos_api_key
-00002d80: 2c20 636f 735f 7265 736f 7572 6365 5f69  , cos_resource_i
-00002d90: 6e73 7461 6e63 655f 6964 3d63 6f73 5f72  nstance_id=cos_r
-00002da0: 6573 6f75 7263 655f 696e 7374 616e 6365  esource_instance
-00002db0: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
-00002dc0: 2020 2020 2020 2020 2020 2020 2020 6369                ci
-00002dd0: 735f 7265 736f 7572 6365 5f69 6e73 7461  s_resource_insta
-00002de0: 6e63 655f 6964 3d63 6973 5f72 6573 6f75  nce_id=cis_resou
-00002df0: 7263 655f 696e 7374 616e 6365 5f69 6429  rce_instance_id)
-00002e00: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00002e10: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
-00002e20: 6f76 6972 7427 3a0a 2020 2020 2020 2020  ovirt':.        
-00002e30: 2020 2020 2020 2020 6461 7461 6365 6e74          datacent
-00002e40: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
-00002e50: 732e 6765 7428 2764 6174 6163 656e 7465  s.get('datacente
-00002e60: 7227 2c20 2744 6566 6175 6c74 2729 0a20  r', 'Default'). 
-00002e70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00002e80: 6c75 7374 6572 203d 2073 656c 662e 6f70  luster = self.op
-00002e90: 7469 6f6e 732e 6765 7428 2763 6c75 7374  tions.get('clust
-00002ea0: 6572 272c 2027 4465 6661 756c 7427 290a  er', 'Default').
-00002eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ec0: 7573 6572 203d 2073 656c 662e 6f70 7469  user = self.opti
-00002ed0: 6f6e 732e 6765 7428 2775 7365 7227 2c20  ons.get('user', 
-00002ee0: 2761 646d 696e 4069 6e74 6572 6e61 6c27  'admin@internal'
-00002ef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00002f00: 2020 7061 7373 776f 7264 203d 2073 656c    password = sel
-00002f10: 662e 6f70 7469 6f6e 732e 6765 7428 2770  f.options.get('p
-00002f20: 6173 7377 6f72 6427 290a 2020 2020 2020  assword').      
-00002f30: 2020 2020 2020 2020 2020 6966 2070 6173            if pas
-00002f40: 7377 6f72 6420 6973 204e 6f6e 653a 0a20  sword is None:. 
-00002f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f60: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
-00002f70: 6720 7061 7373 776f 7264 2069 6e20 7468  g password in th
-00002f80: 6520 636f 6e66 6967 7572 6174 696f 6e2e  e configuration.
-00002f90: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
-00002fa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002fb0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-00002fc0: 2020 2020 2020 2020 2020 206f 7267 203d             org =
-00002fd0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00002fe0: 7428 276f 7267 2729 0a20 2020 2020 2020  t('org').       
-00002ff0: 2020 2020 2020 2020 2069 6620 6f72 6720           if org 
-00003000: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00003010: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00003020: 6f72 2822 4d69 7373 696e 6720 6f72 6720  or("Missing org 
-00003030: 696e 2074 6865 2063 6f6e 6669 6775 7261  in the configura
-00003040: 7469 6f6e 2e20 4c65 6176 696e 6722 290a  tion. Leaving").
-00003050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003060: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00002bd0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00002be0: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+00002bf0: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00002c00: 6174 682e 6578 6973 7473 2866 227b 686f  ath.exists(f"{ho
+00002c10: 6d65 7d2f 2e69 626d 2f63 6f6e 6669 6722  me}/.ibm/config"
+00002c20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00002c30: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00002c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c50: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00002c60: 636f 6e66 6967 203d 2063 6f6e 6669 6770  config = configp
+00002c70: 6172 7365 722e 436f 6e66 6967 5061 7273  arser.ConfigPars
+00002c80: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
+00002c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ca0: 2063 6f6e 6663 6f6e 6669 672e 7265 6164   confconfig.read
+00002cb0: 2866 227b 686f 6d65 7d2f 2e69 626d 2f63  (f"{home}/.ibm/c
+00002cc0: 6f6e 6669 6722 290a 2020 2020 2020 2020  onfig").        
+00002cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ce0: 2020 2020 6966 2027 6465 6661 756c 7427      if 'default'
+00002cf0: 206e 6f74 2069 6e20 636f 6e66 636f 6e66   not in confconf
+00002d00: 6967 3a0a 2020 2020 2020 2020 2020 2020  ig:.            
+00002d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d20: 2020 2020 6572 726f 7228 0a20 2020 2020      error(.     
+00002d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00002d50: 4d69 7373 696e 6720 6465 6661 756c 7420  Missing default 
+00002d60: 7365 6374 696f 6e20 696e 207e 2f2e 6962  section in ~/.ib
+00002d70: 6d2f 636f 6e66 6967 2066 696c 652e 204c  m/config file. L
+00002d80: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
+00002d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002da0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00002db0: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+00002dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002dd0: 2069 6620 2769 616d 5f61 7069 5f6b 6579   if 'iam_api_key
+00002de0: 2720 696e 2063 6f6e 6663 6f6e 6669 675b  ' in confconfig[
+00002df0: 2764 6566 6175 6c74 275d 3a0a 2020 2020  'default']:.    
+00002e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e10: 2020 2020 2020 2020 2020 2020 6961 6d5f              iam_
+00002e20: 6170 695f 6b65 7920 3d20 636f 6e66 636f  api_key = confco
+00002e30: 6e66 6967 5b27 6465 6661 756c 7427 5d5b  nfig['default'][
+00002e40: 2769 616d 5f61 7069 5f6b 6579 275d 0a20  'iam_api_key']. 
+00002e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e60: 2020 2020 2020 2020 2020 2069 6620 2761             if 'a
+00002e70: 6363 6573 735f 6b65 795f 6964 2720 696e  ccess_key_id' in
+00002e80: 2063 6f6e 6663 6f6e 6669 675b 2764 6566   confconfig['def
+00002e90: 6175 6c74 275d 3a0a 2020 2020 2020 2020  ault']:.        
+00002ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002eb0: 2020 2020 2020 2020 636f 735f 6170 695f          cos_api_
+00002ec0: 6b65 7920 3d20 636f 6e66 636f 6e66 6967  key = confconfig
+00002ed0: 5b27 6465 6661 756c 7427 5d5b 2761 6363  ['default']['acc
+00002ee0: 6573 735f 6b65 795f 6964 275d 0a20 2020  ess_key_id'].   
+00002ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f00: 2020 2020 2020 2020 2069 6620 2773 6563           if 'sec
+00002f10: 7265 745f 6163 6365 7373 5f6b 6579 2720  ret_access_key' 
+00002f20: 696e 2063 6f6e 6663 6f6e 6669 675b 2764  in confconfig['d
+00002f30: 6566 6175 6c74 275d 3a0a 2020 2020 2020  efault']:.      
+00002f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f50: 2020 2020 2020 2020 2020 636f 735f 7265            cos_re
+00002f60: 736f 7572 6365 5f69 6e73 7461 6e63 655f  source_instance_
+00002f70: 6964 203d 2063 6f6e 6663 6f6e 6669 675b  id = confconfig[
+00002f80: 2764 6566 6175 6c74 275d 5b27 7365 6372  'default']['secr
+00002f90: 6574 5f61 6363 6573 735f 6b65 7927 5d0a  et_access_key'].
+00002fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fb0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00002fc0: 7265 6769 6f6e 2720 696e 2063 6f6e 6663  region' in confc
+00002fd0: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
+00002fe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003000: 2020 7265 6769 6f6e 203d 2063 6f6e 6663    region = confc
+00003010: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
+00003020: 5b27 7265 6769 6f6e 275d 0a20 2020 2020  ['region'].     
+00003030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003040: 2020 2020 2020 2069 6620 277a 6f6e 6527         if 'zone'
+00003050: 2069 6e20 636f 6e66 636f 6e66 6967 5b27   in confconfig['
+00003060: 6465 6661 756c 7427 5d3a 0a20 2020 2020  default']:.     
 00003070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003080: 6361 5f66 696c 6520 3d20 7365 6c66 2e6f  ca_file = self.o
-00003090: 7074 696f 6e73 2e67 6574 2827 6361 5f66  ptions.get('ca_f
-000030a0: 696c 6527 290a 2020 2020 2020 2020 2020  ile').          
-000030b0: 2020 2020 2020 6966 2063 615f 6669 6c65        if ca_file
-000030c0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000030d0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-000030e0: 726f 7228 224d 6973 7369 6e67 2063 615f  ror("Missing ca_
-000030f0: 6669 6c65 2069 6e20 7468 6520 636f 6e66  file in the conf
-00003100: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
-00003110: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
-00003120: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00003130: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00003140: 2020 2020 2063 615f 6669 6c65 203d 206f       ca_file = o
-00003150: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
-00003160: 7228 6361 5f66 696c 6529 0a20 2020 2020  r(ca_file).     
-00003170: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00003180: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00003190: 2863 615f 6669 6c65 293a 0a20 2020 2020  (ca_file):.     
-000031a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000031b0: 7272 6f72 2822 4361 2066 696c 6520 7061  rror("Ca file pa
-000031c0: 7468 2064 6f65 736e 2774 2065 7869 7374  th doesn't exist
-000031d0: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
-000031e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000031f0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-00003200: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-00003210: 6572 766d 7320 3d20 7365 6c66 2e6f 7074  ervms = self.opt
-00003220: 696f 6e73 2e67 6574 2827 6669 6c74 6572  ions.get('filter
-00003230: 766d 7327 2c20 4661 6c73 6529 0a20 2020  vms', False).   
-00003240: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00003250: 7465 7275 7365 7220 3d20 7365 6c66 2e6f  teruser = self.o
-00003260: 7074 696f 6e73 2e67 6574 2827 6669 6c74  ptions.get('filt
-00003270: 6572 7573 6572 272c 2046 616c 7365 290a  eruser', False).
-00003280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003290: 6669 6c74 6572 7461 6720 3d20 7365 6c66  filtertag = self
-000032a0: 2e6f 7074 696f 6e73 2e67 6574 2827 6669  .options.get('fi
-000032b0: 6c74 6572 7461 6727 290a 2020 2020 2020  ltertag').      
-000032c0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-000032d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000032e0: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
-000032f0: 6f76 6964 6572 732e 6f76 6972 7420 696d  oviders.ovirt im
-00003300: 706f 7274 204b 4f76 6972 740a 2020 2020  port KOvirt.    
-00003310: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00003320: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-00003330: 2020 2020 2020 2020 6465 7065 6e64 656e          dependen
-00003340: 6379 5f65 7272 6f72 2827 6f76 6972 7427  cy_error('ovirt'
-00003350: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003360: 2020 6b20 3d20 4b4f 7669 7274 2868 6f73    k = KOvirt(hos
-00003370: 743d 7365 6c66 2e68 6f73 742c 2070 6f72  t=self.host, por
-00003380: 743d 7365 6c66 2e70 6f72 742c 2075 7365  t=self.port, use
-00003390: 723d 7573 6572 2c20 7061 7373 776f 7264  r=user, password
-000033a0: 3d70 6173 7377 6f72 642c 0a20 2020 2020  =password,.     
-000033b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033c0: 2020 2020 2020 6465 6275 673d 6465 6275        debug=debu
-000033d0: 672c 2064 6174 6163 656e 7465 723d 6461  g, datacenter=da
-000033e0: 7461 6365 6e74 6572 2c20 636c 7573 7465  tacenter, cluste
-000033f0: 723d 636c 7573 7465 722c 2063 615f 6669  r=cluster, ca_fi
-00003400: 6c65 3d63 615f 6669 6c65 2c20 6f72 673d  le=ca_file, org=
-00003410: 6f72 672c 0a20 2020 2020 2020 2020 2020  org,.           
-00003420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003430: 6669 6c74 6572 766d 733d 6669 6c74 6572  filtervms=filter
-00003440: 766d 732c 2066 696c 7465 7275 7365 723d  vms, filteruser=
-00003450: 6669 6c74 6572 7573 6572 2c20 6669 6c74  filteruser, filt
-00003460: 6572 7461 673d 6669 6c74 6572 7461 6729  ertag=filtertag)
-00003470: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00003480: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
-00003490: 6f70 656e 7374 6163 6b27 3a0a 2020 2020  openstack':.    
-000034a0: 2020 2020 2020 2020 2020 2020 7665 7273              vers
-000034b0: 696f 6e20 3d20 7365 6c66 2e6f 7074 696f  ion = self.optio
-000034c0: 6e73 2e67 6574 2827 7665 7273 696f 6e27  ns.get('version'
-000034d0: 2c20 2732 2729 0a20 2020 2020 2020 2020  , '2').         
-000034e0: 2020 2020 2020 2064 6f6d 6169 6e20 3d20         domain = 
-000034f0: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
-00003500: 205b 7365 6c66 2e6f 7074 696f 6e73 2e67   [self.options.g
-00003510: 6574 2827 646f 6d61 696e 2729 2c0a 2020  et('domain'),.  
-00003520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003540: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
-00003550: 726f 6e2e 6765 7428 224f 535f 5553 4552  ron.get("OS_USER
-00003560: 5f44 4f4d 4149 4e5f 4e41 4d45 2229 5d20  _DOMAIN_NAME")] 
-00003570: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
-00003580: 292c 2027 4465 6661 756c 7427 290a 2020  ), 'Default').  
-00003590: 2020 2020 2020 2020 2020 2020 2020 6175                au
-000035a0: 7468 5f75 726c 203d 206e 6578 7428 2865  th_url = next((e
-000035b0: 2066 6f72 2065 2069 6e20 5b73 656c 662e   for e in [self.
-000035c0: 6f70 7469 6f6e 732e 6765 7428 2761 7574  options.get('aut
-000035d0: 685f 7572 6c27 292c 0a20 2020 2020 2020  h_url'),.       
-000035e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000035f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003600: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00003610: 2e67 6574 2822 4f53 5f41 5554 485f 5552  .get("OS_AUTH_UR
-00003620: 4c22 295d 2069 6620 6520 6973 206e 6f74  L")] if e is not
-00003630: 204e 6f6e 6529 2c0a 2020 2020 2020 2020   None),.        
-00003640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003650: 2020 2020 2020 2020 4e6f 6e65 290a 2020          None).  
-00003660: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003670: 2061 7574 685f 7572 6c20 6973 204e 6f6e   auth_url is Non
-00003680: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00003690: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
-000036a0: 7373 696e 6720 6175 7468 5f75 726c 2069  ssing auth_url i
-000036b0: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
-000036c0: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
-000036d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036e0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-000036f0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00003700: 7365 7220 3d20 6e65 7874 2828 6520 666f  ser = next((e fo
-00003710: 7220 6520 696e 205b 7365 6c66 2e6f 7074  r e in [self.opt
-00003720: 696f 6e73 2e67 6574 2827 7573 6572 2729  ions.get('user')
-00003730: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00003740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003750: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
-00003760: 7669 726f 6e2e 6765 7428 224f 535f 5553  viron.get("OS_US
-00003770: 4552 4e41 4d45 2229 5d20 6966 2065 2069  ERNAME")] if e i
-00003780: 7320 6e6f 7420 4e6f 6e65 292c 2027 6164  s not None), 'ad
-00003790: 6d69 6e27 290a 2020 2020 2020 2020 2020  min').          
-000037a0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
-000037b0: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
-000037c0: 205b 7365 6c66 2e6f 7074 696f 6e73 2e67   [self.options.g
-000037d0: 6574 2827 7072 6f6a 6563 7427 292c 0a20  et('project'),. 
-000037e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003800: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
-00003810: 7669 726f 6e2e 6765 7428 224f 535f 5052  viron.get("OS_PR
-00003820: 4f4a 4543 545f 4e41 4d45 2229 5d20 6966  OJECT_NAME")] if
-00003830: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
-00003840: 2027 6164 6d69 6e27 290a 2020 2020 2020   'admin').      
-00003850: 2020 2020 2020 2020 2020 7061 7373 776f            passwo
-00003860: 7264 203d 206e 6578 7428 2865 2066 6f72  rd = next((e for
-00003870: 2065 2069 6e20 5b73 656c 662e 6f70 7469   e in [self.opti
-00003880: 6f6e 732e 6765 7428 2770 6173 7377 6f72  ons.get('passwor
-00003890: 6427 292c 0a20 2020 2020 2020 2020 2020  d'),.           
-000038a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003080: 2020 2020 2020 2020 2020 207a 6f6e 6520             zone 
+00003090: 3d20 636f 6e66 636f 6e66 6967 5b27 6465  = confconfig['de
+000030a0: 6661 756c 7427 5d5b 277a 6f6e 6527 5d0a  fault']['zone'].
+000030b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000030c0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+000030d0: 7670 6327 2069 6e20 636f 6e66 636f 6e66  vpc' in confconf
+000030e0: 6967 5b27 6465 6661 756c 7427 5d3a 0a20  ig['default']:. 
+000030f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003100: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00003110: 6f6e 6520 3d20 636f 6e66 636f 6e66 6967  one = confconfig
+00003120: 5b27 6465 6661 756c 7427 5d5b 2776 7063  ['default']['vpc
+00003130: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00003140: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00003150: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00003160: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00003170: 7272 6f72 2822 436f 7564 6c6e 2774 2070  rror("Coudln't p
+00003180: 6172 7365 207e 2f2e 6962 6d2f 636f 6e66  arse ~/.ibm/conf
+00003190: 6967 2066 696c 652e 204c 6561 7669 6e67  ig file. Leaving
+000031a0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000031b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000031c0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+000031d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000031e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000031f0: 2020 2020 2069 616d 5f61 7069 5f6b 6579       iam_api_key
+00003200: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00003210: 6765 7428 2769 616d 5f61 7069 5f6b 6579  get('iam_api_key
+00003220: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00003230: 2020 2020 2020 2063 6f73 5f61 7069 5f6b         cos_api_k
+00003240: 6579 203d 2073 656c 662e 6f70 7469 6f6e  ey = self.option
+00003250: 732e 6765 7428 2763 6f73 5f61 7069 5f6b  s.get('cos_api_k
+00003260: 6579 2729 0a20 2020 2020 2020 2020 2020  ey').           
+00003270: 2020 2020 2020 2020 2063 6f73 5f72 6573           cos_res
+00003280: 6f75 7263 655f 696e 7374 616e 6365 5f69  ource_instance_i
+00003290: 6420 3d20 7365 6c66 2e6f 7074 696f 6e73  d = self.options
+000032a0: 2e67 6574 2827 636f 735f 7265 736f 7572  .get('cos_resour
+000032b0: 6365 5f69 6e73 7461 6e63 655f 6964 2729  ce_instance_id')
+000032c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000032d0: 2020 2020 2063 6973 5f72 6573 6f75 7263       cis_resourc
+000032e0: 655f 696e 7374 616e 6365 5f69 6420 3d20  e_instance_id = 
+000032f0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00003300: 2827 6369 735f 7265 736f 7572 6365 5f69  ('cis_resource_i
+00003310: 6e73 7461 6e63 655f 6964 2729 0a20 2020  nstance_id').   
+00003320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003330: 2072 6567 696f 6e20 3d20 7365 6c66 2e6f   region = self.o
+00003340: 7074 696f 6e73 2e67 6574 2827 7265 6769  ptions.get('regi
+00003350: 6f6e 2729 2069 6620 7265 6769 6f6e 2069  on') if region i
+00003360: 7320 4e6f 6e65 2065 6c73 6520 7265 6769  s None else regi
+00003370: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00003380: 2020 2020 2020 207a 6f6e 6520 3d20 7365         zone = se
+00003390: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
+000033a0: 7a6f 6e65 2729 2069 6620 7a6f 6e65 2069  zone') if zone i
+000033b0: 7320 4e6f 6e65 2065 6c73 6520 7a6f 6e65  s None else zone
+000033c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000033d0: 2020 2020 2076 7063 203d 2073 656c 662e       vpc = self.
+000033e0: 6f70 7469 6f6e 732e 6765 7428 2776 7063  options.get('vpc
+000033f0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00003400: 2020 2069 6620 6961 6d5f 6170 695f 6b65     if iam_api_ke
+00003410: 7920 6973 204e 6f6e 653a 0a20 2020 2020  y is None:.     
+00003420: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00003430: 7272 6f72 2822 4d69 7373 696e 6720 6961  rror("Missing ia
+00003440: 6d5f 6170 695f 6b65 7920 696e 2074 6865  m_api_key in the
+00003450: 2063 6f6e 6669 6775 7261 7469 6f6e 2e20   configuration. 
+00003460: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
+00003470: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00003480: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+00003490: 2020 2020 2020 2020 2020 6966 2072 6567            if reg
+000034a0: 696f 6e20 6973 204e 6f6e 653a 0a20 2020  ion is None:.   
+000034b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034c0: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
+000034d0: 7265 6769 6f6e 2069 6e20 7468 6520 636f  region in the co
+000034e0: 6e66 6967 7572 6174 696f 6e2e 204c 6561  nfiguration. Lea
+000034f0: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
+00003500: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00003510: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+00003520: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
+00003530: 742e 7072 6f76 6964 6572 732e 6962 6d20  t.providers.ibm 
+00003540: 696d 706f 7274 204b 6962 6d0a 2020 2020  import Kibm.    
+00003550: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+00003560: 4b69 626d 2869 616d 5f61 7069 5f6b 6579  Kibm(iam_api_key
+00003570: 3d69 616d 5f61 7069 5f6b 6579 2c20 7265  =iam_api_key, re
+00003580: 6769 6f6e 3d72 6567 696f 6e2c 207a 6f6e  gion=region, zon
+00003590: 653d 7a6f 6e65 2c20 7670 633d 7670 632c  e=zone, vpc=vpc,
+000035a0: 2064 6562 7567 3d64 6562 7567 2c0a 2020   debug=debug,.  
+000035b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035c0: 2020 2020 2020 2063 6f73 5f61 7069 5f6b         cos_api_k
+000035d0: 6579 3d63 6f73 5f61 7069 5f6b 6579 2c20  ey=cos_api_key, 
+000035e0: 636f 735f 7265 736f 7572 6365 5f69 6e73  cos_resource_ins
+000035f0: 7461 6e63 655f 6964 3d63 6f73 5f72 6573  tance_id=cos_res
+00003600: 6f75 7263 655f 696e 7374 616e 6365 5f69  ource_instance_i
+00003610: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00003620: 2020 2020 2020 2020 2020 2020 6369 735f              cis_
+00003630: 7265 736f 7572 6365 5f69 6e73 7461 6e63  resource_instanc
+00003640: 655f 6964 3d63 6973 5f72 6573 6f75 7263  e_id=cis_resourc
+00003650: 655f 696e 7374 616e 6365 5f69 6429 0a20  e_instance_id). 
+00003660: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00003670: 7365 6c66 2e74 7970 6520 3d3d 2027 6f76  self.type == 'ov
+00003680: 6972 7427 3a0a 2020 2020 2020 2020 2020  irt':.          
+00003690: 2020 2020 2020 6461 7461 6365 6e74 6572        datacenter
+000036a0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+000036b0: 6765 7428 2764 6174 6163 656e 7465 7227  get('datacenter'
+000036c0: 2c20 2744 6566 6175 6c74 2729 0a20 2020  , 'Default').   
+000036d0: 2020 2020 2020 2020 2020 2020 2063 6c75               clu
+000036e0: 7374 6572 203d 2073 656c 662e 6f70 7469  ster = self.opti
+000036f0: 6f6e 732e 6765 7428 2763 6c75 7374 6572  ons.get('cluster
+00003700: 272c 2027 4465 6661 756c 7427 290a 2020  ', 'Default').  
+00003710: 2020 2020 2020 2020 2020 2020 2020 7573                us
+00003720: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
+00003730: 732e 6765 7428 2775 7365 7227 2c20 2761  s.get('user', 'a
+00003740: 646d 696e 4069 6e74 6572 6e61 6c27 290a  dmin@internal').
+00003750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003760: 7061 7373 776f 7264 203d 2073 656c 662e  password = self.
+00003770: 6f70 7469 6f6e 732e 6765 7428 2770 6173  options.get('pas
+00003780: 7377 6f72 6427 290a 2020 2020 2020 2020  sword').        
+00003790: 2020 2020 2020 2020 6966 2070 6173 7377          if passw
+000037a0: 6f72 6420 6973 204e 6f6e 653a 0a20 2020  ord is None:.   
+000037b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037c0: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
+000037d0: 7061 7373 776f 7264 2069 6e20 7468 6520  password in the 
+000037e0: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
+000037f0: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
+00003800: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00003810: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00003820: 2020 2020 2020 2020 206f 7267 203d 2073           org = s
+00003830: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00003840: 276f 7267 2729 0a20 2020 2020 2020 2020  'org').         
+00003850: 2020 2020 2020 2069 6620 6f72 6720 6973         if org is
+00003860: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00003870: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00003880: 2822 4d69 7373 696e 6720 6f72 6720 696e  ("Missing org in
+00003890: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
+000038a0: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
 000038b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000038c0: 2020 6f73 2e65 6e76 6972 6f6e 2e67 6574    os.environ.get
-000038d0: 2822 4f53 5f50 4153 5357 4f52 4422 295d  ("OS_PASSWORD")]
-000038e0: 2069 6620 6520 6973 206e 6f74 204e 6f6e   if e is not Non
-000038f0: 6529 2c20 4e6f 6e65 290a 2020 2020 2020  e), None).      
-00003900: 2020 2020 2020 2020 2020 6361 5f66 696c            ca_fil
-00003910: 6520 3d20 6e65 7874 2828 6520 666f 7220  e = next((e for 
-00003920: 6520 696e 205b 7365 6c66 2e6f 7074 696f  e in [self.optio
-00003930: 6e73 2e67 6574 2827 6361 5f66 696c 6527  ns.get('ca_file'
-00003940: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00003950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003960: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00003970: 732e 656e 7669 726f 6e2e 6765 7428 224f  s.environ.get("O
-00003980: 535f 4341 4345 5254 2229 5d20 6966 2065  S_CACERT")] if e
-00003990: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
-000039a0: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-000039b0: 2020 2020 2072 6567 696f 6e5f 6e61 6d65       region_name
-000039c0: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
-000039d0: 2069 6e20 5b73 656c 662e 6f70 7469 6f6e   in [self.option
-000039e0: 732e 6765 7428 2772 6567 696f 6e5f 6e61  s.get('region_na
-000039f0: 6d65 2729 2c0a 2020 2020 2020 2020 2020  me'),.          
-00003a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a10: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
-00003a20: 6972 6f6e 2e67 6574 2822 4f53 5f52 4547  iron.get("OS_REG
-00003a30: 494f 4e5f 4e41 4d45 2229 5d20 6966 2065  ION_NAME")] if e
-00003a40: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
-00003a50: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-00003a60: 2020 2020 2065 7874 6572 6e61 6c5f 6e65       external_ne
-00003a70: 7477 6f72 6b20 3d20 7365 6c66 2e6f 7074  twork = self.opt
-00003a80: 696f 6e73 2e67 6574 2827 6578 7465 726e  ions.get('extern
-00003a90: 616c 5f6e 6574 776f 726b 2729 0a20 2020  al_network').   
-00003aa0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00003ab0: 6175 7468 5f75 726c 2e65 6e64 7377 6974  auth_url.endswit
-00003ac0: 6828 2776 322e 3027 293a 0a20 2020 2020  h('v2.0'):.     
-00003ad0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00003ae0: 6f6d 6169 6e20 3d20 4e6f 6e65 0a20 2020  omain = None.   
-00003af0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00003b00: 6361 5f66 696c 6520 6973 206e 6f74 204e  ca_file is not N
-00003b10: 6f6e 6520 616e 6420 6e6f 7420 6f73 2e70  one and not os.p
-00003b20: 6174 682e 6578 6973 7473 286f 732e 7061  ath.exists(os.pa
-00003b30: 7468 2e65 7870 616e 6475 7365 7228 6361  th.expanduser(ca
-00003b40: 5f66 696c 6529 293a 0a20 2020 2020 2020  _file)):.       
-00003b50: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00003b60: 6f72 2866 2249 6e64 6963 6174 6564 2063  or(f"Indicated c
-00003b70: 615f 6669 6c65 207b 6361 5f66 696c 657d  a_file {ca_file}
-00003b80: 206e 6f74 2066 6f75 6e64 2e20 4c65 6176   not found. Leav
-00003b90: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
-00003ba0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00003bb0: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
-00003bc0: 2020 2020 2020 676c 616e 6365 5f64 6973        glance_dis
-00003bd0: 6b20 3d20 7365 6c66 2e6f 7074 696f 6e73  k = self.options
-00003be0: 2e67 6574 2827 676c 616e 6365 5f64 6973  .get('glance_dis
-00003bf0: 6b27 2c20 4661 6c73 6529 0a20 2020 2020  k', False).     
-00003c00: 2020 2020 2020 2020 2020 2061 7574 685f             auth_
-00003c10: 746f 6b65 6e20 3d20 6e65 7874 2828 6520  token = next((e 
-00003c20: 666f 7220 6520 696e 205b 7365 6c66 2e6f  for e in [self.o
-00003c30: 7074 696f 6e73 2e67 6574 2827 746f 6b65  ptions.get('toke
-00003c40: 6e27 292c 0a20 2020 2020 2020 2020 2020  n'),.           
-00003c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038c0: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+000038d0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+000038e0: 5f66 696c 6520 3d20 7365 6c66 2e6f 7074  _file = self.opt
+000038f0: 696f 6e73 2e67 6574 2827 6361 5f66 696c  ions.get('ca_fil
+00003900: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+00003910: 2020 2020 6966 2063 615f 6669 6c65 2069      if ca_file i
+00003920: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00003930: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00003940: 7228 224d 6973 7369 6e67 2063 615f 6669  r("Missing ca_fi
+00003950: 6c65 2069 6e20 7468 6520 636f 6e66 6967  le in the config
+00003960: 7572 6174 696f 6e2e 204c 6561 7669 6e67  uration. Leaving
+00003970: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00003980: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00003990: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+000039a0: 2020 2063 615f 6669 6c65 203d 206f 732e     ca_file = os.
+000039b0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
+000039c0: 6361 5f66 696c 6529 0a20 2020 2020 2020  ca_file).       
+000039d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000039e0: 6f73 2e70 6174 682e 6578 6973 7473 2863  os.path.exists(c
+000039f0: 615f 6669 6c65 293a 0a20 2020 2020 2020  a_file):.       
+00003a00: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00003a10: 6f72 2822 4361 2066 696c 6520 7061 7468  or("Ca file path
+00003a20: 2064 6f65 736e 2774 2065 7869 7374 2e20   doesn't exist. 
+00003a30: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
+00003a40: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00003a50: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+00003a60: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00003a70: 766d 7320 3d20 7365 6c66 2e6f 7074 696f  vms = self.optio
+00003a80: 6e73 2e67 6574 2827 6669 6c74 6572 766d  ns.get('filtervm
+00003a90: 7327 2c20 4661 6c73 6529 0a20 2020 2020  s', False).     
+00003aa0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00003ab0: 7275 7365 7220 3d20 7365 6c66 2e6f 7074  ruser = self.opt
+00003ac0: 696f 6e73 2e67 6574 2827 6669 6c74 6572  ions.get('filter
+00003ad0: 7573 6572 272c 2046 616c 7365 290a 2020  user', False).  
+00003ae0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00003af0: 6c74 6572 7461 6720 3d20 7365 6c66 2e6f  ltertag = self.o
+00003b00: 7074 696f 6e73 2e67 6574 2827 6669 6c74  ptions.get('filt
+00003b10: 6572 7461 6727 290a 2020 2020 2020 2020  ertag').        
+00003b20: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00003b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b40: 2066 726f 6d20 6b76 6972 742e 7072 6f76   from kvirt.prov
+00003b50: 6964 6572 732e 6f76 6972 7420 696d 706f  iders.ovirt impo
+00003b60: 7274 204b 4f76 6972 740a 2020 2020 2020  rt KOvirt.      
+00003b70: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00003b80: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00003b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003ba0: 2020 2020 2065 7863 6570 7469 6f6e 203d       exception =
+00003bb0: 2065 2069 6620 6465 6275 6720 656c 7365   e if debug else
+00003bc0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00003bd0: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
+00003be0: 656e 6379 5f65 7272 6f72 2827 6f76 6972  ency_error('ovir
+00003bf0: 7427 2c20 6578 6365 7074 696f 6e29 0a20  t', exception). 
+00003c00: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00003c10: 203d 204b 4f76 6972 7428 686f 7374 3d73   = KOvirt(host=s
+00003c20: 656c 662e 686f 7374 2c20 706f 7274 3d73  elf.host, port=s
+00003c30: 656c 662e 706f 7274 2c20 7573 6572 3d75  elf.port, user=u
+00003c40: 7365 722c 2070 6173 7377 6f72 643d 7061  ser, password=pa
+00003c50: 7373 776f 7264 2c0a 2020 2020 2020 2020  ssword,.        
 00003c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c70: 2020 2020 6f73 2e65 6e76 6972 6f6e 2e67      os.environ.g
-00003c80: 6574 2822 4f53 5f54 4f4b 454e 2229 5d20  et("OS_TOKEN")] 
-00003c90: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
-00003ca0: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
-00003cb0: 2020 2020 2020 2020 2061 7574 685f 7479           auth_ty
-00003cc0: 7065 203d 2027 746f 6b65 6e27 2069 6620  pe = 'token' if 
-00003cd0: 6175 7468 5f74 6f6b 656e 2069 7320 6e6f  auth_token is no
-00003ce0: 7420 4e6f 6e65 2065 6c73 6520 2770 6173  t None else 'pas
-00003cf0: 7377 6f72 6427 0a20 2020 2020 2020 2020  sword'.         
-00003d00: 2020 2020 2020 2069 6620 6175 7468 5f74         if auth_t
-00003d10: 7970 6520 3d3d 2027 7061 7373 776f 7264  ype == 'password
-00003d20: 2720 616e 6420 7061 7373 776f 7264 2069  ' and password i
-00003d30: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00003d40: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00003d50: 7228 224d 6973 7369 6e67 2070 6173 7377  r("Missing passw
-00003d60: 6f72 6420 696e 2074 6865 2063 6f6e 6669  ord in the confi
-00003d70: 6775 7261 7469 6f6e 2e20 4c65 6176 696e  guration. Leavin
-00003d80: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
-00003d90: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00003da0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-00003db0: 2020 2020 6966 2061 7574 685f 7479 7065      if auth_type
-00003dc0: 203d 3d20 2774 6f6b 656e 273a 0a20 2020   == 'token':.   
+00003c70: 2020 2064 6562 7567 3d64 6562 7567 2c20     debug=debug, 
+00003c80: 6461 7461 6365 6e74 6572 3d64 6174 6163  datacenter=datac
+00003c90: 656e 7465 722c 2063 6c75 7374 6572 3d63  enter, cluster=c
+00003ca0: 6c75 7374 6572 2c20 6361 5f66 696c 653d  luster, ca_file=
+00003cb0: 6361 5f66 696c 652c 206f 7267 3d6f 7267  ca_file, org=org
+00003cc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003cd0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00003ce0: 7465 7276 6d73 3d66 696c 7465 7276 6d73  tervms=filtervms
+00003cf0: 2c20 6669 6c74 6572 7573 6572 3d66 696c  , filteruser=fil
+00003d00: 7465 7275 7365 722c 2066 696c 7465 7274  teruser, filtert
+00003d10: 6167 3d66 696c 7465 7274 6167 290a 2020  ag=filtertag).  
+00003d20: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+00003d30: 656c 662e 7479 7065 203d 3d20 276f 7065  elf.type == 'ope
+00003d40: 6e73 7461 636b 273a 0a20 2020 2020 2020  nstack':.       
+00003d50: 2020 2020 2020 2020 2076 6572 7369 6f6e           version
+00003d60: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00003d70: 6765 7428 2776 6572 7369 6f6e 272c 2027  get('version', '
+00003d80: 3227 290a 2020 2020 2020 2020 2020 2020  2').            
+00003d90: 2020 2020 646f 6d61 696e 203d 206e 6578      domain = nex
+00003da0: 7428 2865 2066 6f72 2065 2069 6e20 5b73  t((e for e in [s
+00003db0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00003dc0: 2764 6f6d 6169 6e27 292c 0a20 2020 2020  'domain'),.     
 00003dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003de0: 2075 7365 722c 2070 6173 7377 6f72 642c   user, password,
-00003df0: 2064 6f6d 6169 6e20 3d20 4e6f 6e65 2c20   domain = None, 
-00003e00: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
-00003e10: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00003e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e30: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
-00003e40: 726f 7669 6465 7273 2e6f 7065 6e73 7461  roviders.opensta
-00003e50: 636b 2069 6d70 6f72 7420 4b6f 7065 6e73  ck import Kopens
-00003e60: 7461 636b 0a20 2020 2020 2020 2020 2020  tack.           
-00003e70: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00003e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e90: 2064 6570 656e 6465 6e63 795f 6572 726f   dependency_erro
-00003ea0: 7228 276f 7065 6e73 7461 636b 2729 0a20  r('openstack'). 
-00003eb0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00003ec0: 203d 204b 6f70 656e 7374 6163 6b28 686f   = Kopenstack(ho
-00003ed0: 7374 3d73 656c 662e 686f 7374 2c20 706f  st=self.host, po
-00003ee0: 7274 3d73 656c 662e 706f 7274 2c20 7573  rt=self.port, us
-00003ef0: 6572 3d75 7365 722c 2070 6173 7377 6f72  er=user, passwor
-00003f00: 643d 7061 7373 776f 7264 2c20 7665 7273  d=password, vers
-00003f10: 696f 6e3d 7665 7273 696f 6e2c 0a20 2020  ion=version,.   
-00003f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f30: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-00003f40: 673d 6465 6275 672c 2070 726f 6a65 6374  g=debug, project
-00003f50: 3d70 726f 6a65 6374 2c20 646f 6d61 696e  =project, domain
-00003f60: 3d64 6f6d 6169 6e2c 2061 7574 685f 7572  =domain, auth_ur
-00003f70: 6c3d 6175 7468 5f75 726c 2c20 6361 5f66  l=auth_url, ca_f
-00003f80: 696c 653d 6361 5f66 696c 652c 0a20 2020  ile=ca_file,.   
-00003f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003fa0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-00003fb0: 726e 616c 5f6e 6574 776f 726b 3d65 7874  rnal_network=ext
-00003fc0: 6572 6e61 6c5f 6e65 7477 6f72 6b2c 2072  ernal_network, r
-00003fd0: 6567 696f 6e5f 6e61 6d65 3d72 6567 696f  egion_name=regio
-00003fe0: 6e5f 6e61 6d65 2c20 676c 616e 6365 5f64  n_name, glance_d
-00003ff0: 6973 6b3d 676c 616e 6365 5f64 6973 6b2c  isk=glance_disk,
-00004000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004020: 6175 7468 5f74 7970 653d 6175 7468 5f74  auth_type=auth_t
-00004030: 7970 652c 2061 7574 685f 746f 6b65 6e3d  ype, auth_token=
-00004040: 6175 7468 5f74 6f6b 656e 290a 2020 2020  auth_token).    
-00004050: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00004060: 662e 7479 7065 203d 3d20 2776 7370 6865  f.type == 'vsphe
-00004070: 7265 273a 0a20 2020 2020 2020 2020 2020  re':.           
-00004080: 2020 2020 2075 7365 7220 3d20 7365 6c66       user = self
-00004090: 2e6f 7074 696f 6e73 2e67 6574 2827 7573  .options.get('us
-000040a0: 6572 2729 0a20 2020 2020 2020 2020 2020  er').           
-000040b0: 2020 2020 2069 6620 7573 6572 2069 7320       if user is 
-000040c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000040d0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-000040e0: 224d 6973 7369 6e67 2075 7365 7220 696e  "Missing user in
-000040f0: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00004100: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
-00004110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004120: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
-00004130: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00004140: 7373 776f 7264 203d 2073 656c 662e 6f70  ssword = self.op
-00004150: 7469 6f6e 732e 6765 7428 2770 6173 7377  tions.get('passw
-00004160: 6f72 6427 290a 2020 2020 2020 2020 2020  ord').          
-00004170: 2020 2020 2020 6966 2070 6173 7377 6f72        if passwor
-00004180: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
-00004190: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000041a0: 7272 6f72 2822 4d69 7373 696e 6720 7061  rror("Missing pa
-000041b0: 7373 776f 7264 2069 6e20 7468 6520 636f  ssword in the co
-000041c0: 6e66 6967 7572 6174 696f 6e2e 204c 6561  nfiguration. Lea
-000041d0: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
-000041e0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-000041f0: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-00004200: 2020 2020 2020 2063 6c75 7374 6572 203d         cluster =
-00004210: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00004220: 7428 2763 6c75 7374 6572 2729 0a20 2020  t('cluster').   
-00004230: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00004240: 636c 7573 7465 7220 6973 204e 6f6e 653a  cluster is None:
-00004250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004260: 2020 2020 2065 7272 6f72 2822 4d69 7373       error("Miss
-00004270: 696e 6720 636c 7573 7465 7220 696e 2074  ing cluster in t
-00004280: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
-00004290: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
-000042a0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-000042b0: 6365 6e74 6572 203d 2073 656c 662e 6f70  center = self.op
-000042c0: 7469 6f6e 732e 6765 7428 2764 6174 6163  tions.get('datac
-000042d0: 656e 7465 7227 290a 2020 2020 2020 2020  enter').        
-000042e0: 2020 2020 2020 2020 6966 2064 6174 6163          if datac
-000042f0: 656e 7465 7220 6973 204e 6f6e 653a 0a20  enter is None:. 
-00004300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004310: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
-00004320: 6720 6461 7461 6365 6e74 6572 2069 6e20  g datacenter in 
-00004330: 7468 6520 636f 6e66 6967 7572 6174 696f  the configuratio
-00004340: 6e2e 204c 6561 7669 6e67 2229 0a20 2020  n. Leaving").   
-00004350: 2020 2020 2020 2020 2020 2020 2069 736f               iso
-00004360: 666f 6c64 6572 203d 2073 656c 662e 6f70  folder = self.op
-00004370: 7469 6f6e 732e 6765 7428 2769 736f 666f  tions.get('isofo
-00004380: 6c64 6572 2729 0a20 2020 2020 2020 2020  lder').         
-00004390: 2020 2020 2020 2069 6620 6973 6f66 6f6c         if isofol
-000043a0: 6465 7220 6973 206e 6f74 204e 6f6e 653a  der is not None:
-000043b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000043c0: 2020 2020 2069 6620 272f 2720 6e6f 7420       if '/' not 
-000043d0: 696e 2069 736f 666f 6c64 6572 3a0a 2020  in isofolder:.  
-000043e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043f0: 2020 2020 2020 6973 6f70 6f6f 6c20 3d20        isopool = 
-00004400: 7365 6c66 2e70 6f6f 6c0a 2020 2020 2020  self.pool.      
-00004410: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00004420: 6966 2027 5b27 206e 6f74 2069 6e20 6973  if '[' not in is
-00004430: 6f66 6f6c 6465 723a 0a20 2020 2020 2020  ofolder:.       
-00004440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004450: 2069 736f 666f 6c64 6572 203d 2069 736f   isofolder = iso
-00004460: 666f 6c64 6572 2e73 706c 6974 2827 2f27  folder.split('/'
-00004470: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004480: 2020 2020 2020 2020 2020 6973 6f70 6f6f            isopoo
-00004490: 6c20 3d20 6973 6f66 6f6c 6465 725b 305d  l = isofolder[0]
-000044a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000044b0: 2020 2020 2020 2020 2069 736f 666f 6c64           isofold
-000044c0: 6572 203d 2069 736f 666f 6c64 6572 5b31  er = isofolder[1
-000044d0: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-000044e0: 2020 2020 2020 2069 736f 666f 6c64 6572         isofolder
-000044f0: 203d 2066 275b 7b69 736f 706f 6f6c 7d5d   = f'[{isopool}]
-00004500: 2f7b 6973 6f66 6f6c 6465 727d 270a 2020  /{isofolder}'.  
-00004510: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00004520: 6c74 6572 766d 7320 3d20 7365 6c66 2e6f  ltervms = self.o
-00004530: 7074 696f 6e73 2e67 6574 2827 6669 6c74  ptions.get('filt
-00004540: 6572 766d 7327 2c20 4661 6c73 6529 0a20  ervms', False). 
-00004550: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00004560: 696c 7465 7275 7365 7220 3d20 7365 6c66  ilteruser = self
-00004570: 2e6f 7074 696f 6e73 2e67 6574 2827 6669  .options.get('fi
-00004580: 6c74 6572 7573 6572 272c 2046 616c 7365  lteruser', False
-00004590: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000045a0: 2020 6669 6c74 6572 7461 6720 3d20 7365    filtertag = se
-000045b0: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-000045c0: 6669 6c74 6572 7461 6727 290a 2020 2020  filtertag').    
-000045d0: 2020 2020 2020 2020 2020 2020 6361 7465              cate
-000045e0: 676f 7279 203d 2073 656c 662e 6f70 7469  gory = self.opti
-000045f0: 6f6e 732e 6765 7428 2763 6174 6567 6f72  ons.get('categor
-00004600: 7927 2c20 276b 636c 6927 290a 2020 2020  y', 'kcli').    
-00004610: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00004620: 666f 6c64 6572 203d 2073 656c 662e 6f70  folder = self.op
-00004630: 7469 6f6e 732e 6765 7428 2762 6173 6566  tions.get('basef
-00004640: 6f6c 6465 7227 290a 2020 2020 2020 2020  older').        
-00004650: 2020 2020 2020 2020 6476 7320 3d20 7365          dvs = se
-00004660: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00004670: 6476 7327 2c20 5472 7565 290a 2020 2020  dvs', True).    
-00004680: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-00004690: 7274 5f6e 6574 776f 726b 203d 2073 656c  rt_network = sel
-000046a0: 662e 6f70 7469 6f6e 732e 6765 7428 2769  f.options.get('i
-000046b0: 6d70 6f72 745f 6e65 7477 6f72 6b27 2c20  mport_network', 
-000046c0: 2756 4d20 4e65 7477 6f72 6b27 290a 2020  'VM Network').  
-000046d0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-000046e0: 6d65 6f75 7420 3d20 7365 6c66 2e6f 7074  meout = self.opt
-000046f0: 696f 6e73 2e67 6574 2827 7469 6d65 6f75  ions.get('timeou
-00004700: 7427 2c20 3237 3030 290a 2020 2020 2020  t', 2700).      
-00004710: 2020 2020 2020 2020 2020 666f 7263 655f            force_
-00004720: 706f 6f6c 203d 2073 656c 662e 6f70 7469  pool = self.opti
-00004730: 6f6e 732e 6765 7428 2766 6f72 6365 5f70  ons.get('force_p
-00004740: 6f6f 6c27 2c20 4661 6c73 6529 0a20 2020  ool', False).   
-00004750: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00004760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004770: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
-00004780: 2e70 726f 7669 6465 7273 2e76 7370 6865  .providers.vsphe
-00004790: 7265 2069 6d70 6f72 7420 4b73 7068 6572  re import Kspher
-000047a0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000047b0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-000047c0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000047d0: 7065 6e64 656e 6379 5f65 7272 6f72 2827  pendency_error('
-000047e0: 7673 7068 6572 6527 290a 2020 2020 2020  vsphere').      
-000047f0: 2020 2020 2020 2020 2020 6b20 3d20 4b73            k = Ks
-00004800: 7068 6572 6528 7365 6c66 2e68 6f73 742c  phere(self.host,
-00004810: 2075 7365 722c 2070 6173 7377 6f72 642c   user, password,
-00004820: 2064 6174 6163 656e 7465 722c 2063 6c75   datacenter, clu
-00004830: 7374 6572 2c20 6973 6f66 6f6c 6465 723d  ster, isofolder=
-00004840: 6973 6f66 6f6c 6465 722c 2064 6562 7567  isofolder, debug
-00004850: 3d64 6562 7567 2c0a 2020 2020 2020 2020  =debug,.        
-00004860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004870: 2020 2020 6669 6c74 6572 766d 733d 6669      filtervms=fi
-00004880: 6c74 6572 766d 732c 2066 696c 7465 7275  ltervms, filteru
-00004890: 7365 723d 6669 6c74 6572 7573 6572 2c20  ser=filteruser, 
-000048a0: 6669 6c74 6572 7461 673d 6669 6c74 6572  filtertag=filter
-000048b0: 7461 672c 2063 6174 6567 6f72 793d 6361  tag, category=ca
-000048c0: 7465 676f 7279 2c0a 2020 2020 2020 2020  tegory,.        
-000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048e0: 2020 2020 6261 7365 666f 6c64 6572 3d62      basefolder=b
-000048f0: 6173 6566 6f6c 6465 722c 2064 7673 3d64  asefolder, dvs=d
-00004900: 7673 2c20 696d 706f 7274 5f6e 6574 776f  vs, import_netwo
-00004910: 726b 3d69 6d70 6f72 745f 6e65 7477 6f72  rk=import_networ
-00004920: 6b2c 2074 696d 656f 7574 3d74 696d 656f  k, timeout=timeo
-00004930: 7574 2c0a 2020 2020 2020 2020 2020 2020  ut,.            
-00004940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004950: 666f 7263 655f 706f 6f6c 3d66 6f72 6365  force_pool=force
-00004960: 5f70 6f6f 6c29 0a20 2020 2020 2020 2020  _pool).         
-00004970: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
-00004980: 6520 3d3d 2027 7061 636b 6574 273a 0a20  e == 'packet':. 
-00004990: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000049a0: 7574 685f 746f 6b65 6e20 3d20 7365 6c66  uth_token = self
-000049b0: 2e6f 7074 696f 6e73 2e67 6574 2827 6175  .options.get('au
-000049c0: 7468 5f74 6f6b 656e 2729 0a20 2020 2020  th_token').     
-000049d0: 2020 2020 2020 2020 2020 2069 6620 6175             if au
-000049e0: 7468 5f74 6f6b 656e 2069 7320 4e6f 6e65  th_token is None
-000049f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004a00: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
-00004a10: 7369 6e67 2061 7574 685f 746f 6b65 6e20  sing auth_token 
-00004a20: 696e 2074 6865 2063 6f6e 6669 6775 7261  in the configura
-00004a30: 7469 6f6e 2e20 4c65 6176 696e 6722 290a  tion. Leaving").
-00004a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a50: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
-00004a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a70: 7072 6f6a 6563 7420 3d20 7365 6c66 2e6f  project = self.o
-00004a80: 7074 696f 6e73 2e67 6574 2827 7072 6f6a  ptions.get('proj
-00004a90: 6563 7427 290a 2020 2020 2020 2020 2020  ect').          
-00004aa0: 2020 2020 2020 6966 2070 726f 6a65 6374        if project
-00004ab0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00004ac0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00004ad0: 726f 7228 224d 6973 7369 6e67 2070 726f  ror("Missing pro
-00004ae0: 6a65 6374 2069 6e20 7468 6520 636f 6e66  ject in the conf
-00004af0: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
-00004b00: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
-00004b10: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00004b20: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00004b30: 2020 2020 2066 6163 696c 6974 7920 3d20       facility = 
-00004b40: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00004b50: 2827 6661 6369 6c69 7479 2729 0a20 2020  ('facility').   
-00004b60: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00004b70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004b80: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
-00004b90: 2e70 726f 7669 6465 7273 2e70 6163 6b65  .providers.packe
-00004ba0: 7420 696d 706f 7274 204b 7061 636b 6574  t import Kpacket
-00004bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004bc0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00004bd0: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-00004be0: 656e 6465 6e63 795f 6572 726f 7228 2770  endency_error('p
-00004bf0: 6163 6b65 7427 290a 2020 2020 2020 2020  acket').        
-00004c00: 2020 2020 2020 2020 6b20 3d20 4b70 6163          k = Kpac
-00004c10: 6b65 7428 6175 7468 5f74 6f6b 656e 2c20  ket(auth_token, 
-00004c20: 7072 6f6a 6563 742c 2066 6163 696c 6974  project, facilit
-00004c30: 793d 6661 6369 6c69 7479 2c20 6465 6275  y=facility, debu
-00004c40: 673d 6465 6275 672c 0a20 2020 2020 2020  g=debug,.       
-00004c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c60: 2020 2020 2074 756e 6e65 6c68 6f73 743d       tunnelhost=
-00004c70: 7365 6c66 2e74 756e 6e65 6c68 6f73 742c  self.tunnelhost,
-00004c80: 2074 756e 6e65 6c75 7365 723d 7365 6c66   tunneluser=self
-00004c90: 2e74 756e 6e65 6c75 7365 722c 2074 756e  .tunneluser, tun
-00004ca0: 6e65 6c70 6f72 743d 7365 6c66 2e74 756e  nelport=self.tun
-00004cb0: 6e65 6c70 6f72 742c 0a20 2020 2020 2020  nelport,.       
-00004cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cd0: 2020 2020 2074 756e 6e65 6c64 6972 3d73       tunneldir=s
-00004ce0: 656c 662e 7475 6e6e 656c 6469 7229 0a20  elf.tunneldir). 
-00004cf0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00004d00: 7365 6c66 2e74 7970 6520 3d3d 2027 7072  self.type == 'pr
-00004d10: 6f78 6d6f 7827 3a0a 2020 2020 2020 2020  oxmox':.        
-00004d20: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00004d30: 2250 726f 786d 6f78 2070 726f 7669 6465  "Proxmox provide
-00004d40: 7220 6973 2057 6f72 6b20 496e 2050 726f  r is Work In Pro
-00004d50: 6772 6573 732e 2055 7365 2061 7420 796f  gress. Use at yo
-00004d60: 7572 206f 776e 2072 6973 6b21 2229 0a20  ur own risk!"). 
-00004d70: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00004d80: 7365 7220 3d20 7365 6c66 2e6f 7074 696f  ser = self.optio
-00004d90: 6e73 2e67 6574 2827 7573 6572 2729 0a20  ns.get('user'). 
-00004da0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004db0: 6620 7573 6572 2069 7320 4e6f 6e65 3a0a  f user is None:.
-00004dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004dd0: 2020 2020 6572 726f 7228 224d 6973 7369      error("Missi
-00004de0: 6e67 2075 7365 7220 696e 2074 6865 2063  ng user in the c
-00004df0: 6f6e 6669 6775 7261 7469 6f6e 2e20 4c65  onfiguration. Le
-00004e00: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
-00004e10: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00004e20: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00004e30: 2020 2020 2020 2020 6175 7468 5f74 6f6b          auth_tok
-00004e40: 656e 5f6e 616d 6520 3d20 7365 6c66 2e6f  en_name = self.o
-00004e50: 7074 696f 6e73 2e67 6574 2827 6175 7468  ptions.get('auth
-00004e60: 5f74 6f6b 656e 5f6e 616d 6527 290a 2020  _token_name').  
-00004e70: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00004e80: 7373 776f 7264 203d 2073 656c 662e 6f70  ssword = self.op
-00004e90: 7469 6f6e 732e 6765 7428 2770 6173 7377  tions.get('passw
-00004ea0: 6f72 6427 290a 2020 2020 2020 2020 2020  ord').          
-00004eb0: 2020 2020 2020 6966 206e 6f74 2061 7574        if not aut
-00004ec0: 685f 746f 6b65 6e5f 6e61 6d65 2061 6e64  h_token_name and
-00004ed0: 206e 6f74 2070 6173 7377 6f72 643a 0a20   not password:. 
-00004ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ef0: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
-00004f00: 6720 6175 7468 5f74 6f6b 656e 5f6e 616d  g auth_token_nam
-00004f10: 6520 6f72 2070 6173 7377 6f72 6420 696e  e or password in
-00004f20: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00004f30: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
-00004f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f50: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
-00004f60: 2020 2020 2020 2020 2020 2020 2020 6175                au
-00004f70: 7468 5f74 6f6b 656e 5f73 6563 7265 7420  th_token_secret 
-00004f80: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00004f90: 6574 2827 6175 7468 5f74 6f6b 656e 5f73  et('auth_token_s
-00004fa0: 6563 7265 7427 290a 2020 2020 2020 2020  ecret').        
-00004fb0: 2020 2020 2020 2020 6966 2061 7574 685f          if auth_
-00004fc0: 746f 6b65 6e5f 6e61 6d65 2061 6e64 2061  token_name and a
-00004fd0: 7574 685f 746f 6b65 6e5f 7365 6372 6574  uth_token_secret
-00004fe0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00004ff0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00005000: 726f 7228 224d 6973 7369 6e67 2061 7574  ror("Missing aut
-00005010: 685f 746f 6b65 6e5f 7365 6372 6574 2069  h_token_secret i
-00005020: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
-00005030: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
-00005040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005050: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00005060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00005070: 696c 7465 7274 6167 203d 2073 656c 662e  iltertag = self.
-00005080: 6f70 7469 6f6e 732e 6765 7428 2766 696c  options.get('fil
-00005090: 7465 7274 6167 2729 0a20 2020 2020 2020  tertag').       
-000050a0: 2020 2020 2020 2020 206e 6f64 6520 3d20           node = 
-000050b0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-000050c0: 2827 6e6f 6465 2729 0a20 2020 2020 2020  ('node').       
-000050d0: 2020 2020 2020 2020 2076 6572 6966 795f           verify_
-000050e0: 7373 6c20 3d20 7365 6c66 2e6f 7074 696f  ssl = self.optio
-000050f0: 6e73 2e67 6574 2827 7665 7269 6679 5f73  ns.get('verify_s
-00005100: 736c 2729 0a20 2020 2020 2020 2020 2020  sl').           
-00005110: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00005120: 2020 2020 2020 2020 2020 2020 2020 6672                fr
-00005130: 6f6d 206b 7669 7274 2e70 726f 7669 6465  om kvirt.provide
-00005140: 7273 2e70 726f 786d 6f78 2069 6d70 6f72  rs.proxmox impor
-00005150: 7420 4b70 726f 786d 6f78 0a20 2020 2020  t Kproxmox.     
-00005160: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00005170: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00005180: 2020 2020 2020 2064 6570 656e 6465 6e63         dependenc
-00005190: 795f 6572 726f 7228 2770 726f 786d 6f78  y_error('proxmox
-000051a0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000051b0: 2020 206b 203d 204b 7072 6f78 6d6f 7828     k = Kproxmox(
-000051c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000051d0: 2020 2020 2068 6f73 743d 7365 6c66 2e68       host=self.h
-000051e0: 6f73 742c 0a20 2020 2020 2020 2020 2020  ost,.           
-000051f0: 2020 2020 2020 2020 2070 6f72 743d 4e6f           port=No
-00005200: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00005210: 2020 2020 2020 2020 7573 6572 3d75 7365          user=use
-00005220: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00005230: 2020 2020 2020 2070 6173 7377 6f72 643d         password=
-00005240: 7061 7373 776f 7264 2c0a 2020 2020 2020  password,.      
-00005250: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00005260: 6b65 6e5f 6e61 6d65 3d61 7574 685f 746f  ken_name=auth_to
-00005270: 6b65 6e5f 6e61 6d65 2c0a 2020 2020 2020  ken_name,.      
-00005280: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00005290: 6b65 6e5f 7365 6372 6574 3d61 7574 685f  ken_secret=auth_
-000052a0: 746f 6b65 6e5f 7365 6372 6574 2c0a 2020  token_secret,.  
-000052b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052c0: 2020 6669 6c74 6572 7461 673d 6669 6c74    filtertag=filt
-000052d0: 6572 7461 672c 0a20 2020 2020 2020 2020  ertag,.         
-000052e0: 2020 2020 2020 2020 2020 206e 6f64 653d             node=
-000052f0: 6e6f 6465 2c0a 2020 2020 2020 2020 2020  node,.          
-00005300: 2020 2020 2020 2020 2020 7665 7269 6679            verify
-00005310: 5f73 736c 3d76 6572 6966 795f 7373 6c2c  _ssl=verify_ssl,
-00005320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005330: 2020 2020 2064 6562 7567 3d46 616c 7365       debug=False
-00005340: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00005350: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
-00005360: 2777 6562 273a 0a20 2020 2020 2020 2020  'web':.         
-00005370: 2020 2020 2020 2070 6f72 7420 3d20 7365         port = se
-00005380: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00005390: 706f 7274 272c 2038 3030 3029 0a20 2020  port', 8000).   
-000053a0: 2020 2020 2020 2020 2020 2020 206c 6f63               loc
-000053b0: 616c 6b75 6265 203d 2073 656c 662e 6f70  alkube = self.op
-000053c0: 7469 6f6e 732e 6765 7428 276c 6f63 616c  tions.get('local
-000053d0: 6b75 6265 272c 2054 7275 6529 0a20 2020  kube', True).   
-000053e0: 2020 2020 2020 2020 2020 2020 2066 726f               fro
-000053f0: 6d20 6b76 6972 742e 7072 6f76 6964 6572  m kvirt.provider
-00005400: 732e 7765 6220 696d 706f 7274 204b 7765  s.web import Kwe
-00005410: 6263 6c69 656e 740a 2020 2020 2020 2020  bclient.        
-00005420: 2020 2020 2020 2020 6b20 3d20 4b77 6562          k = Kweb
-00005430: 636c 6965 6e74 2873 656c 662e 686f 7374  client(self.host
-00005440: 2c20 706f 7274 2c20 6c6f 6361 6c6b 7562  , port, localkub
-00005450: 653d 6c6f 6361 6c6b 7562 652c 2064 6562  e=localkube, deb
-00005460: 7567 3d64 6562 7567 290a 2020 2020 2020  ug=debug).      
-00005470: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00005480: 7970 6520 3d20 2777 6562 270a 2020 2020  ype = 'web'.    
-00005490: 2020 2020 2020 2020 656c 6966 206f 6666          elif off
-000054a0: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
-000054b0: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
-000054c0: 2e70 726f 7669 6465 7273 2e66 616b 6520  .providers.fake 
-000054d0: 696d 706f 7274 204b 6661 6b65 0a20 2020  import Kfake.   
-000054e0: 2020 2020 2020 2020 2020 2020 206b 203d               k =
-000054f0: 204b 6661 6b65 2829 0a20 2020 2020 2020   Kfake().       
-00005500: 2020 2020 2020 2020 2073 656c 662e 7479           self.ty
-00005510: 7065 203d 2027 6661 6b65 270a 2020 2020  pe = 'fake'.    
-00005520: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00005530: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00005540: 2073 656c 662e 686f 7374 2069 7320 4e6f   self.host is No
-00005550: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00005560: 2020 2020 2020 2020 6572 726f 7228 2250          error("P
-00005570: 726f 626c 656d 2070 6172 7369 6e67 2079  roblem parsing y
-00005580: 6f75 7220 636f 6e66 6967 7572 6174 696f  our configuratio
-00005590: 6e20 6669 6c65 2229 0a20 2020 2020 2020  n file").       
-000055a0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-000055b0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-000055c0: 2020 2020 2020 2020 2073 6573 7369 6f6e           session
-000055d0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-000055e0: 6765 7428 2773 6573 7369 6f6e 272c 2046  get('session', F
-000055f0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-00005600: 2020 2020 2020 7265 6d6f 7465 646e 736d        remotednsm
-00005610: 6173 7120 3d20 7365 6c66 2e6f 7074 696f  asq = self.optio
-00005620: 6e73 2e67 6574 2827 7265 6d6f 7465 646e  ns.get('remotedn
-00005630: 736d 6173 7127 2c20 4661 6c73 6529 0a20  smasq', False). 
-00005640: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00005650: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00005660: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
-00005670: 7274 2e70 726f 7669 6465 7273 2e6b 766d  rt.providers.kvm
-00005680: 2069 6d70 6f72 7420 4b76 6972 740a 2020   import Kvirt.  
-00005690: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-000056a0: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-000056b0: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
-000056c0: 656e 6379 5f65 7272 6f72 2827 6c69 6276  ency_error('libv
-000056d0: 6972 7427 290a 2020 2020 2020 2020 2020  irt').          
-000056e0: 2020 2020 2020 6b20 3d20 4b76 6972 7428        k = Kvirt(
-000056f0: 686f 7374 3d73 656c 662e 686f 7374 2c20  host=self.host, 
-00005700: 706f 7274 3d73 656c 662e 706f 7274 2c20  port=self.port, 
-00005710: 7573 6572 3d73 656c 662e 7573 6572 2c20  user=self.user, 
-00005720: 7072 6f74 6f63 6f6c 3d73 656c 662e 7072  protocol=self.pr
-00005730: 6f74 6f63 6f6c 2c20 7572 6c3d 7365 6c66  otocol, url=self
-00005740: 2e75 726c 2c0a 2020 2020 2020 2020 2020  .url,.          
-00005750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005760: 6465 6275 673d 6465 6275 672c 2069 6e73  debug=debug, ins
-00005770: 6563 7572 653d 7365 6c66 2e69 6e73 6563  ecure=self.insec
-00005780: 7572 652c 2073 6573 7369 6f6e 3d73 6573  ure, session=ses
-00005790: 7369 6f6e 2c20 7265 6d6f 7465 646e 736d  sion, remotednsm
-000057a0: 6173 713d 7265 6d6f 7465 646e 736d 6173  asq=remotednsmas
-000057b0: 7129 0a20 2020 2020 2020 2020 2020 2069  q).            i
-000057c0: 6620 6b2e 636f 6e6e 2069 7320 4e6f 6e65  f k.conn is None
-000057d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000057e0: 2020 6572 726f 7228 6622 436f 756c 646e    error(f"Couldn
-000057f0: 2774 2063 6f6e 6e65 6374 2074 6f20 636c  't connect to cl
-00005800: 6965 6e74 207b 7365 6c66 2e63 6c69 656e  ient {self.clien
-00005810: 747d 2e20 4c65 6176 696e 672e 2e2e 2229  t}. Leaving...")
-00005820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005830: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-00005840: 2020 2020 2020 2020 2066 6f72 2065 7874           for ext
-00005850: 7261 636c 6965 6e74 2069 6e20 7365 6c66  raclient in self
-00005860: 2e5f 6578 7472 6163 6c69 656e 7473 3a0a  ._extraclients:.
-00005870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005880: 6966 2065 7874 7261 636c 6965 6e74 206e  if extraclient n
-00005890: 6f74 2069 6e20 7365 6c66 2e69 6e69 3a0a  ot in self.ini:.
-000058a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058b0: 2020 2020 7761 726e 696e 6728 6622 4d69      warning(f"Mi
-000058c0: 7373 696e 6720 7365 6374 696f 6e20 666f  ssing section fo
-000058d0: 7220 636c 6965 6e74 207b 6578 7472 6163  r client {extrac
-000058e0: 6c69 656e 747d 2069 6e20 636f 6e66 6967  lient} in config
-000058f0: 2066 696c 652e 2054 7279 696e 6720 746f   file. Trying to
-00005900: 2063 6f6e 6e65 6374 2e2e 2e22 290a 2020   connect...").  
-00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005920: 2020 7365 6c66 2e69 6e69 5b65 7874 7261    self.ini[extra
-00005930: 636c 6965 6e74 5d20 3d20 7b27 686f 7374  client] = {'host
-00005940: 273a 2065 7874 7261 636c 6965 6e74 7d0a  ': extraclient}.
-00005950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005960: 6320 3d20 4b63 6f6e 6669 6728 636c 6965  c = Kconfig(clie
-00005970: 6e74 3d65 7874 7261 636c 6965 6e74 290a  nt=extraclient).
-00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005990: 6520 3d20 632e 6b0a 2020 2020 2020 2020  e = c.k.        
-000059a0: 2020 2020 2020 2020 7365 6c66 2e65 7874          self.ext
-000059b0: 7261 636c 6965 6e74 735b 6578 7472 6163  raclients[extrac
-000059c0: 6c69 656e 745d 203d 2065 0a20 2020 2020  lient] = e.     
-000059d0: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
-000059e0: 636f 6e6e 2069 7320 4e6f 6e65 3a0a 2020  conn is None:.  
-000059f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a00: 2020 6572 726f 7228 6622 436f 756c 646e    error(f"Couldn
-00005a10: 2774 2063 6f6e 6e65 6374 2074 6f20 7370  't connect to sp
-00005a20: 6563 6966 7920 6879 7065 7276 6973 6f72  ecify hypervisor
-00005a30: 207b 6578 7472 6163 6c69 656e 747d 2e20   {extraclient}. 
-00005a40: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
-00005a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a60: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-00005a70: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-00005a80: 7474 7228 7365 6c66 2c20 2761 6c67 6f72  ttr(self, 'algor
-00005a90: 6974 686d 2729 3a0a 2020 2020 2020 2020  ithm'):.        
-00005aa0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00005ab0: 616c 676f 7269 7468 6d20 3d3d 2027 6672  algorithm == 'fr
-00005ac0: 6565 273a 0a20 2020 2020 2020 2020 2020  ee':.           
-00005ad0: 2020 2020 2020 2020 2075 7073 7461 7475           upstatu
-00005ae0: 7320 3d20 5b27 6163 7469 7665 272c 2027  s = ['active', '
-00005af0: 7570 272c 2027 7275 6e6e 696e 6727 5d0a  up', 'running'].
-00005b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b10: 2020 2020 616c 6c63 6c69 7320 3d20 7b73      allclis = {s
-00005b20: 656c 662e 636c 6965 6e74 3a20 6b7d 0a20  elf.client: k}. 
-00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b40: 2020 2061 6c6c 636c 6973 2e75 7064 6174     allclis.updat
-00005b50: 6528 7365 6c66 2e65 7874 7261 636c 6965  e(self.extraclie
-00005b60: 6e74 7329 0a20 2020 2020 2020 2020 2020  nts).           
-00005b70: 2020 2020 2020 2020 206d 696e 636c 692c           mincli,
-00005b80: 206d 696e 766d 7320 3d20 4e6f 6e65 2c20   minvms = None, 
-00005b90: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00005ba0: 2020 2020 2020 2020 2066 6f72 2063 6c69           for cli
-00005bb0: 2069 6e20 616c 6c63 6c69 733a 0a20 2020   in allclis:.   
-00005bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bd0: 2020 2020 2063 6c69 766d 7320 3d20 6c65       clivms = le
-00005be0: 6e28 5b76 6d20 666f 7220 766d 2069 6e20  n([vm for vm in 
-00005bf0: 616c 6c63 6c69 735b 636c 695d 2e6c 6973  allclis[cli].lis
-00005c00: 7428 2920 6966 2076 6d5b 2773 7461 7475  t() if vm['statu
-00005c10: 7327 5d2e 6c6f 7765 7228 2920 696e 2075  s'].lower() in u
-00005c20: 7073 7461 7475 735d 290a 2020 2020 2020  pstatus]).      
-00005c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c40: 2020 6966 206d 696e 766d 7320 6973 204e    if minvms is N
-00005c50: 6f6e 6520 6f72 2063 6c69 766d 7320 3c20  one or clivms < 
-00005c60: 6d69 6e76 6d73 3a0a 2020 2020 2020 2020  minvms:.        
-00005c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c80: 2020 2020 6d69 6e63 6c69 203d 2063 6c69      mincli = cli
-00005c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005ca0: 2020 2020 2020 2020 2020 2020 206d 696e               min
-00005cb0: 766d 7320 3d20 636c 6976 6d73 0a20 2020  vms = clivms.   
+00003de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003df0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+00003e00: 2e67 6574 2822 4f53 5f55 5345 525f 444f  .get("OS_USER_DO
+00003e10: 4d41 494e 5f4e 414d 4522 295d 2069 6620  MAIN_NAME")] if 
+00003e20: 6520 6973 206e 6f74 204e 6f6e 6529 2c20  e is not None), 
+00003e30: 2744 6566 6175 6c74 2729 0a20 2020 2020  'Default').     
+00003e40: 2020 2020 2020 2020 2020 2061 7574 685f             auth_
+00003e50: 7572 6c20 3d20 6e65 7874 2828 6520 666f  url = next((e fo
+00003e60: 7220 6520 696e 205b 7365 6c66 2e6f 7074  r e in [self.opt
+00003e70: 696f 6e73 2e67 6574 2827 6175 7468 5f75  ions.get('auth_u
+00003e80: 726c 2729 2c0a 2020 2020 2020 2020 2020  rl'),.          
+00003e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003eb0: 2020 206f 732e 656e 7669 726f 6e2e 6765     os.environ.ge
+00003ec0: 7428 224f 535f 4155 5448 5f55 524c 2229  t("OS_AUTH_URL")
+00003ed0: 5d20 6966 2065 2069 7320 6e6f 7420 4e6f  ] if e is not No
+00003ee0: 6e65 292c 0a20 2020 2020 2020 2020 2020  ne),.           
+00003ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f00: 2020 2020 204e 6f6e 6529 0a20 2020 2020       None).     
+00003f10: 2020 2020 2020 2020 2020 2069 6620 6175             if au
+00003f20: 7468 5f75 726c 2069 7320 4e6f 6e65 3a0a  th_url is None:.
+00003f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f40: 2020 2020 6572 726f 7228 224d 6973 7369      error("Missi
+00003f50: 6e67 2061 7574 685f 7572 6c20 696e 2074  ng auth_url in t
+00003f60: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
+00003f70: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
+00003f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f90: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00003fa0: 2020 2020 2020 2020 2020 2020 7573 6572              user
+00003fb0: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
+00003fc0: 2069 6e20 5b73 656c 662e 6f70 7469 6f6e   in [self.option
+00003fd0: 732e 6765 7428 2775 7365 7227 292c 0a20  s.get('user'),. 
+00003fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004000: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
+00004010: 6f6e 2e67 6574 2822 4f53 5f55 5345 524e  on.get("OS_USERN
+00004020: 414d 4522 295d 2069 6620 6520 6973 206e  AME")] if e is n
+00004030: 6f74 204e 6f6e 6529 2c20 2761 646d 696e  ot None), 'admin
+00004040: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00004050: 2020 2070 726f 6a65 6374 203d 206e 6578     project = nex
+00004060: 7428 2865 2066 6f72 2065 2069 6e20 5b73  t((e for e in [s
+00004070: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00004080: 2770 726f 6a65 6374 2729 2c0a 2020 2020  'project'),.    
+00004090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040b0: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
+000040c0: 6f6e 2e67 6574 2822 4f53 5f50 524f 4a45  on.get("OS_PROJE
+000040d0: 4354 5f4e 414d 4522 295d 2069 6620 6520  CT_NAME")] if e 
+000040e0: 6973 206e 6f74 204e 6f6e 6529 2c20 2761  is not None), 'a
+000040f0: 646d 696e 2729 0a20 2020 2020 2020 2020  dmin').         
+00004100: 2020 2020 2020 2070 6173 7377 6f72 6420         password 
+00004110: 3d20 6e65 7874 2828 6520 666f 7220 6520  = next((e for e 
+00004120: 696e 205b 7365 6c66 2e6f 7074 696f 6e73  in [self.options
+00004130: 2e67 6574 2827 7061 7373 776f 7264 2729  .get('password')
+00004140: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004160: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00004170: 732e 656e 7669 726f 6e2e 6765 7428 224f  s.environ.get("O
+00004180: 535f 5041 5353 574f 5244 2229 5d20 6966  S_PASSWORD")] if
+00004190: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
+000041a0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+000041b0: 2020 2020 2020 2063 615f 6669 6c65 203d         ca_file =
+000041c0: 206e 6578 7428 2865 2066 6f72 2065 2069   next((e for e i
+000041d0: 6e20 5b73 656c 662e 6f70 7469 6f6e 732e  n [self.options.
+000041e0: 6765 7428 2763 615f 6669 6c65 2729 2c0a  get('ca_file'),.
+000041f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004210: 2020 2020 2020 2020 2020 2020 6f73 2e65              os.e
+00004220: 6e76 6972 6f6e 2e67 6574 2822 4f53 5f43  nviron.get("OS_C
+00004230: 4143 4552 5422 295d 2069 6620 6520 6973  ACERT")] if e is
+00004240: 206e 6f74 204e 6f6e 6529 2c20 4e6f 6e65   not None), None
+00004250: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004260: 2020 7265 6769 6f6e 5f6e 616d 6520 3d20    region_name = 
+00004270: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
+00004280: 205b 7365 6c66 2e6f 7074 696f 6e73 2e67   [self.options.g
+00004290: 6574 2827 7265 6769 6f6e 5f6e 616d 6527  et('region_name'
+000042a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+000042b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000042c0: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
+000042d0: 6e2e 6765 7428 224f 535f 5245 4749 4f4e  n.get("OS_REGION
+000042e0: 5f4e 414d 4522 295d 2069 6620 6520 6973  _NAME")] if e is
+000042f0: 206e 6f74 204e 6f6e 6529 2c20 4e6f 6e65   not None), None
+00004300: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004310: 2020 6578 7465 726e 616c 5f6e 6574 776f    external_netwo
+00004320: 726b 203d 2073 656c 662e 6f70 7469 6f6e  rk = self.option
+00004330: 732e 6765 7428 2765 7874 6572 6e61 6c5f  s.get('external_
+00004340: 6e65 7477 6f72 6b27 290a 2020 2020 2020  network').      
+00004350: 2020 2020 2020 2020 2020 6966 2061 7574            if aut
+00004360: 685f 7572 6c2e 656e 6473 7769 7468 2827  h_url.endswith('
+00004370: 7632 2e30 2729 3a0a 2020 2020 2020 2020  v2.0'):.        
+00004380: 2020 2020 2020 2020 2020 2020 646f 6d61              doma
+00004390: 696e 203d 204e 6f6e 650a 2020 2020 2020  in = None.      
+000043a0: 2020 2020 2020 2020 2020 6966 2063 615f            if ca_
+000043b0: 6669 6c65 2069 7320 6e6f 7420 4e6f 6e65  file is not None
+000043c0: 2061 6e64 206e 6f74 206f 732e 7061 7468   and not os.path
+000043d0: 2e65 7869 7374 7328 6f73 2e70 6174 682e  .exists(os.path.
+000043e0: 6578 7061 6e64 7573 6572 2863 615f 6669  expanduser(ca_fi
+000043f0: 6c65 2929 3a0a 2020 2020 2020 2020 2020  le)):.          
+00004400: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00004410: 6622 496e 6469 6361 7465 6420 6361 5f66  f"Indicated ca_f
+00004420: 696c 6520 7b63 615f 6669 6c65 7d20 6e6f  ile {ca_file} no
+00004430: 7420 666f 756e 642e 204c 6561 7669 6e67  t found. Leaving
+00004440: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00004450: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00004460: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00004470: 2020 2067 6c61 6e63 655f 6469 736b 203d     glance_disk =
+00004480: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00004490: 7428 2767 6c61 6e63 655f 6469 736b 272c  t('glance_disk',
+000044a0: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+000044b0: 2020 2020 2020 2020 6175 7468 5f74 6f6b          auth_tok
+000044c0: 656e 203d 206e 6578 7428 2865 2066 6f72  en = next((e for
+000044d0: 2065 2069 6e20 5b73 656c 662e 6f70 7469   e in [self.opti
+000044e0: 6f6e 732e 6765 7428 2774 6f6b 656e 2729  ons.get('token')
+000044f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004520: 206f 732e 656e 7669 726f 6e2e 6765 7428   os.environ.get(
+00004530: 224f 535f 544f 4b45 4e22 295d 2069 6620  "OS_TOKEN")] if 
+00004540: 6520 6973 206e 6f74 204e 6f6e 6529 2c20  e is not None), 
+00004550: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
+00004560: 2020 2020 2020 6175 7468 5f74 7970 6520        auth_type 
+00004570: 3d20 2774 6f6b 656e 2720 6966 2061 7574  = 'token' if aut
+00004580: 685f 746f 6b65 6e20 6973 206e 6f74 204e  h_token is not N
+00004590: 6f6e 6520 656c 7365 2027 7061 7373 776f  one else 'passwo
+000045a0: 7264 270a 2020 2020 2020 2020 2020 2020  rd'.            
+000045b0: 2020 2020 6966 2061 7574 685f 7479 7065      if auth_type
+000045c0: 203d 3d20 2770 6173 7377 6f72 6427 2061   == 'password' a
+000045d0: 6e64 2070 6173 7377 6f72 6420 6973 204e  nd password is N
+000045e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000045f0: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+00004600: 4d69 7373 696e 6720 7061 7373 776f 7264  Missing password
+00004610: 2069 6e20 7468 6520 636f 6e66 6967 7572   in the configur
+00004620: 6174 696f 6e2e 204c 6561 7669 6e67 2229  ation. Leaving")
+00004630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004640: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+00004650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004660: 2069 6620 6175 7468 5f74 7970 6520 3d3d   if auth_type ==
+00004670: 2027 746f 6b65 6e27 3a0a 2020 2020 2020   'token':.      
+00004680: 2020 2020 2020 2020 2020 2020 2020 7573                us
+00004690: 6572 2c20 7061 7373 776f 7264 2c20 646f  er, password, do
+000046a0: 6d61 696e 203d 204e 6f6e 652c 204e 6f6e  main = None, Non
+000046b0: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
+000046c0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000046d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046e0: 2066 726f 6d20 6b76 6972 742e 7072 6f76   from kvirt.prov
+000046f0: 6964 6572 732e 6f70 656e 7374 6163 6b20  iders.openstack 
+00004700: 696d 706f 7274 204b 6f70 656e 7374 6163  import Kopenstac
+00004710: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00004720: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00004730: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00004740: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00004750: 6570 7469 6f6e 203d 2065 2069 6620 6465  eption = e if de
+00004760: 6275 6720 656c 7365 204e 6f6e 650a 2020  bug else None.  
+00004770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004780: 2020 6465 7065 6e64 656e 6379 5f65 7272    dependency_err
+00004790: 6f72 2827 6f70 656e 7374 6163 6b27 2c20  or('openstack', 
+000047a0: 6578 6365 7074 696f 6e29 0a20 2020 2020  exception).     
+000047b0: 2020 2020 2020 2020 2020 206b 203d 204b             k = K
+000047c0: 6f70 656e 7374 6163 6b28 686f 7374 3d73  openstack(host=s
+000047d0: 656c 662e 686f 7374 2c20 706f 7274 3d73  elf.host, port=s
+000047e0: 656c 662e 706f 7274 2c20 7573 6572 3d75  elf.port, user=u
+000047f0: 7365 722c 2070 6173 7377 6f72 643d 7061  ser, password=pa
+00004800: 7373 776f 7264 2c20 7665 7273 696f 6e3d  ssword, version=
+00004810: 7665 7273 696f 6e2c 0a20 2020 2020 2020  version,.       
+00004820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004830: 2020 2020 2020 2020 6465 6275 673d 6465          debug=de
+00004840: 6275 672c 2070 726f 6a65 6374 3d70 726f  bug, project=pro
+00004850: 6a65 6374 2c20 646f 6d61 696e 3d64 6f6d  ject, domain=dom
+00004860: 6169 6e2c 2061 7574 685f 7572 6c3d 6175  ain, auth_url=au
+00004870: 7468 5f75 726c 2c20 6361 5f66 696c 653d  th_url, ca_file=
+00004880: 6361 5f66 696c 652c 0a20 2020 2020 2020  ca_file,.       
+00004890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048a0: 2020 2020 2020 2020 6578 7465 726e 616c          external
+000048b0: 5f6e 6574 776f 726b 3d65 7874 6572 6e61  _network=externa
+000048c0: 6c5f 6e65 7477 6f72 6b2c 2072 6567 696f  l_network, regio
+000048d0: 6e5f 6e61 6d65 3d72 6567 696f 6e5f 6e61  n_name=region_na
+000048e0: 6d65 2c20 676c 616e 6365 5f64 6973 6b3d  me, glance_disk=
+000048f0: 676c 616e 6365 5f64 6973 6b2c 0a20 2020  glance_disk,.   
+00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004910: 2020 2020 2020 2020 2020 2020 6175 7468              auth
+00004920: 5f74 7970 653d 6175 7468 5f74 7970 652c  _type=auth_type,
+00004930: 2061 7574 685f 746f 6b65 6e3d 6175 7468   auth_token=auth
+00004940: 5f74 6f6b 656e 290a 2020 2020 2020 2020  _token).        
+00004950: 2020 2020 656c 6966 2073 656c 662e 7479      elif self.ty
+00004960: 7065 203d 3d20 2776 7370 6865 7265 273a  pe == 'vsphere':
+00004970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004980: 2075 7365 7220 3d20 7365 6c66 2e6f 7074   user = self.opt
+00004990: 696f 6e73 2e67 6574 2827 7573 6572 2729  ions.get('user')
+000049a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000049b0: 2069 6620 7573 6572 2069 7320 4e6f 6e65   if user is None
+000049c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000049d0: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
+000049e0: 7369 6e67 2075 7365 7220 696e 2074 6865  sing user in the
+000049f0: 2063 6f6e 6669 6775 7261 7469 6f6e 2e20   configuration. 
+00004a00: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
+00004a10: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00004a20: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+00004a30: 2020 2020 2020 2020 2020 7061 7373 776f            passwo
+00004a40: 7264 203d 2073 656c 662e 6f70 7469 6f6e  rd = self.option
+00004a50: 732e 6765 7428 2770 6173 7377 6f72 6427  s.get('password'
+00004a60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004a70: 2020 6966 2070 6173 7377 6f72 6420 6973    if password is
+00004a80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00004a90: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00004aa0: 2822 4d69 7373 696e 6720 7061 7373 776f  ("Missing passwo
+00004ab0: 7264 2069 6e20 7468 6520 636f 6e66 6967  rd in the config
+00004ac0: 7572 6174 696f 6e2e 204c 6561 7669 6e67  uration. Leaving
+00004ad0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00004ae0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00004af0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00004b00: 2020 2063 6c75 7374 6572 203d 2073 656c     cluster = sel
+00004b10: 662e 6f70 7469 6f6e 732e 6765 7428 2763  f.options.get('c
+00004b20: 6c75 7374 6572 2729 0a20 2020 2020 2020  luster').       
+00004b30: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
+00004b40: 7465 7220 6973 204e 6f6e 653a 0a20 2020  ter is None:.   
+00004b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b60: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
+00004b70: 636c 7573 7465 7220 696e 2074 6865 2063  cluster in the c
+00004b80: 6f6e 6669 6775 7261 7469 6f6e 2e20 4c65  onfiguration. Le
+00004b90: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
+00004ba0: 2020 2020 2020 2020 6461 7461 6365 6e74          datacent
+00004bb0: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
+00004bc0: 732e 6765 7428 2764 6174 6163 656e 7465  s.get('datacente
+00004bd0: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
+00004be0: 2020 2020 6966 2064 6174 6163 656e 7465      if datacente
+00004bf0: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
+00004c00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00004c10: 7272 6f72 2822 4d69 7373 696e 6720 6461  rror("Missing da
+00004c20: 7461 6365 6e74 6572 2069 6e20 7468 6520  tacenter in the 
+00004c30: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
+00004c40: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
+00004c50: 2020 2020 2020 2020 2069 736f 666f 6c64           isofold
+00004c60: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
+00004c70: 732e 6765 7428 2769 736f 666f 6c64 6572  s.get('isofolder
+00004c80: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00004c90: 2020 2069 6620 6973 6f66 6f6c 6465 7220     if isofolder 
+00004ca0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00004cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cc0: 2069 6620 272f 2720 6e6f 7420 696e 2069   if '/' not in i
+00004cd0: 736f 666f 6c64 6572 3a0a 2020 2020 2020  sofolder:.      
+00004ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cf0: 2020 6973 6f70 6f6f 6c20 3d20 7365 6c66    isopool = self
+00004d00: 2e70 6f6f 6c0a 2020 2020 2020 2020 2020  .pool.          
+00004d10: 2020 2020 2020 2020 2020 656c 6966 2027            elif '
+00004d20: 5b27 206e 6f74 2069 6e20 6973 6f66 6f6c  [' not in isofol
+00004d30: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+00004d40: 2020 2020 2020 2020 2020 2020 2069 736f               iso
+00004d50: 666f 6c64 6572 203d 2069 736f 666f 6c64  folder = isofold
+00004d60: 6572 2e73 706c 6974 2827 2f27 290a 2020  er.split('/').  
+00004d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d80: 2020 2020 2020 6973 6f70 6f6f 6c20 3d20        isopool = 
+00004d90: 6973 6f66 6f6c 6465 725b 305d 0a20 2020  isofolder[0].   
+00004da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004db0: 2020 2020 2069 736f 666f 6c64 6572 203d       isofolder =
+00004dc0: 2069 736f 666f 6c64 6572 5b31 3a5d 0a20   isofolder[1:]. 
+00004dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004de0: 2020 2069 736f 666f 6c64 6572 203d 2066     isofolder = f
+00004df0: 275b 7b69 736f 706f 6f6c 7d5d 2f7b 6973  '[{isopool}]/{is
+00004e00: 6f66 6f6c 6465 727d 270a 2020 2020 2020  ofolder}'.      
+00004e10: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00004e20: 766d 7320 3d20 7365 6c66 2e6f 7074 696f  vms = self.optio
+00004e30: 6e73 2e67 6574 2827 6669 6c74 6572 766d  ns.get('filtervm
+00004e40: 7327 2c20 4661 6c73 6529 0a20 2020 2020  s', False).     
+00004e50: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00004e60: 7275 7365 7220 3d20 7365 6c66 2e6f 7074  ruser = self.opt
+00004e70: 696f 6e73 2e67 6574 2827 6669 6c74 6572  ions.get('filter
+00004e80: 7573 6572 272c 2046 616c 7365 290a 2020  user', False).  
+00004e90: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00004ea0: 6c74 6572 7461 6720 3d20 7365 6c66 2e6f  ltertag = self.o
+00004eb0: 7074 696f 6e73 2e67 6574 2827 6669 6c74  ptions.get('filt
+00004ec0: 6572 7461 6727 290a 2020 2020 2020 2020  ertag').        
+00004ed0: 2020 2020 2020 2020 6361 7465 676f 7279          category
+00004ee0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00004ef0: 6765 7428 2763 6174 6567 6f72 7927 2c20  get('category', 
+00004f00: 276b 636c 6927 290a 2020 2020 2020 2020  'kcli').        
+00004f10: 2020 2020 2020 2020 6261 7365 666f 6c64          basefold
+00004f20: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
+00004f30: 732e 6765 7428 2762 6173 6566 6f6c 6465  s.get('basefolde
+00004f40: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
+00004f50: 2020 2020 6476 7320 3d20 7365 6c66 2e6f      dvs = self.o
+00004f60: 7074 696f 6e73 2e67 6574 2827 6476 7327  ptions.get('dvs'
+00004f70: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
+00004f80: 2020 2020 2020 2020 696d 706f 7274 5f6e          import_n
+00004f90: 6574 776f 726b 203d 2073 656c 662e 6f70  etwork = self.op
+00004fa0: 7469 6f6e 732e 6765 7428 2769 6d70 6f72  tions.get('impor
+00004fb0: 745f 6e65 7477 6f72 6b27 2c20 2756 4d20  t_network', 'VM 
+00004fc0: 4e65 7477 6f72 6b27 290a 2020 2020 2020  Network').      
+00004fd0: 2020 2020 2020 2020 2020 7469 6d65 6f75            timeou
+00004fe0: 7420 3d20 7365 6c66 2e6f 7074 696f 6e73  t = self.options
+00004ff0: 2e67 6574 2827 7469 6d65 6f75 7427 2c20  .get('timeout', 
+00005000: 3237 3030 290a 2020 2020 2020 2020 2020  2700).          
+00005010: 2020 2020 2020 666f 7263 655f 706f 6f6c        force_pool
+00005020: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00005030: 6765 7428 2766 6f72 6365 5f70 6f6f 6c27  get('force_pool'
+00005040: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
+00005050: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00005060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005070: 2020 6672 6f6d 206b 7669 7274 2e70 726f    from kvirt.pro
+00005080: 7669 6465 7273 2e76 7370 6865 7265 2069  viders.vsphere i
+00005090: 6d70 6f72 7420 4b73 7068 6572 650a 2020  mport Ksphere.  
+000050a0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000050b0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+000050c0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+000050d0: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
+000050e0: 6f6e 203d 2065 2069 6620 6465 6275 6720  on = e if debug 
+000050f0: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
+00005100: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00005110: 7065 6e64 656e 6379 5f65 7272 6f72 2827  pendency_error('
+00005120: 7673 7068 6572 6527 2c20 6578 6365 7074  vsphere', except
+00005130: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
+00005140: 2020 2020 206b 203d 204b 7370 6865 7265       k = Ksphere
+00005150: 2873 656c 662e 686f 7374 2c20 7573 6572  (self.host, user
+00005160: 2c20 7061 7373 776f 7264 2c20 6461 7461  , password, data
+00005170: 6365 6e74 6572 2c20 636c 7573 7465 722c  center, cluster,
+00005180: 2069 736f 666f 6c64 6572 3d69 736f 666f   isofolder=isofo
+00005190: 6c64 6572 2c20 6465 6275 673d 6465 6275  lder, debug=debu
+000051a0: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+000051b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000051c0: 696c 7465 7276 6d73 3d66 696c 7465 7276  iltervms=filterv
+000051d0: 6d73 2c20 6669 6c74 6572 7573 6572 3d66  ms, filteruser=f
+000051e0: 696c 7465 7275 7365 722c 2066 696c 7465  ilteruser, filte
+000051f0: 7274 6167 3d66 696c 7465 7274 6167 2c20  rtag=filtertag, 
+00005200: 6361 7465 676f 7279 3d63 6174 6567 6f72  category=categor
+00005210: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00005220: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00005230: 6173 6566 6f6c 6465 723d 6261 7365 666f  asefolder=basefo
+00005240: 6c64 6572 2c20 6476 733d 6476 732c 2069  lder, dvs=dvs, i
+00005250: 6d70 6f72 745f 6e65 7477 6f72 6b3d 696d  mport_network=im
+00005260: 706f 7274 5f6e 6574 776f 726b 2c20 7469  port_network, ti
+00005270: 6d65 6f75 743d 7469 6d65 6f75 742c 0a20  meout=timeout,. 
+00005280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005290: 2020 2020 2020 2020 2020 2066 6f72 6365             force
+000052a0: 5f70 6f6f 6c3d 666f 7263 655f 706f 6f6c  _pool=force_pool
+000052b0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+000052c0: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
+000052d0: 2770 6163 6b65 7427 3a0a 2020 2020 2020  'packet':.      
+000052e0: 2020 2020 2020 2020 2020 6175 7468 5f74            auth_t
+000052f0: 6f6b 656e 203d 2073 656c 662e 6f70 7469  oken = self.opti
+00005300: 6f6e 732e 6765 7428 2761 7574 685f 746f  ons.get('auth_to
+00005310: 6b65 6e27 290a 2020 2020 2020 2020 2020  ken').          
+00005320: 2020 2020 2020 6966 2061 7574 685f 746f        if auth_to
+00005330: 6b65 6e20 6973 204e 6f6e 653a 0a20 2020  ken is None:.   
+00005340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005350: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
+00005360: 6175 7468 5f74 6f6b 656e 2069 6e20 7468  auth_token in th
+00005370: 6520 636f 6e66 6967 7572 6174 696f 6e2e  e configuration.
+00005380: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
+00005390: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000053a0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+000053b0: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
+000053c0: 6374 203d 2073 656c 662e 6f70 7469 6f6e  ct = self.option
+000053d0: 732e 6765 7428 2770 726f 6a65 6374 2729  s.get('project')
+000053e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000053f0: 2069 6620 7072 6f6a 6563 7420 6973 204e   if project is N
+00005400: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00005410: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+00005420: 4d69 7373 696e 6720 7072 6f6a 6563 7420  Missing project 
+00005430: 696e 2074 6865 2063 6f6e 6669 6775 7261  in the configura
+00005440: 7469 6f6e 2e20 4c65 6176 696e 6722 290a  tion. Leaving").
+00005450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005460: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00005470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005480: 6661 6369 6c69 7479 203d 2073 656c 662e  facility = self.
+00005490: 6f70 7469 6f6e 732e 6765 7428 2766 6163  options.get('fac
+000054a0: 696c 6974 7927 290a 2020 2020 2020 2020  ility').        
+000054b0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000054c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054d0: 2066 726f 6d20 6b76 6972 742e 7072 6f76   from kvirt.prov
+000054e0: 6964 6572 732e 7061 636b 6574 2069 6d70  iders.packet imp
+000054f0: 6f72 7420 4b70 6163 6b65 740a 2020 2020  ort Kpacket.    
+00005500: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00005510: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00005520: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00005530: 2020 2020 2020 2065 7863 6570 7469 6f6e         exception
+00005540: 203d 2065 2069 6620 6465 6275 6720 656c   = e if debug el
+00005550: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+00005560: 2020 2020 2020 2020 2020 2020 6465 7065              depe
+00005570: 6e64 656e 6379 5f65 7272 6f72 2827 7061  ndency_error('pa
+00005580: 636b 6574 272c 2065 7863 6570 7469 6f6e  cket', exception
+00005590: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000055a0: 2020 6b20 3d20 4b70 6163 6b65 7428 6175    k = Kpacket(au
+000055b0: 7468 5f74 6f6b 656e 2c20 7072 6f6a 6563  th_token, projec
+000055c0: 742c 2066 6163 696c 6974 793d 6661 6369  t, facility=faci
+000055d0: 6c69 7479 2c20 6465 6275 673d 6465 6275  lity, debug=debu
+000055e0: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+000055f0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00005600: 756e 6e65 6c68 6f73 743d 7365 6c66 2e74  unnelhost=self.t
+00005610: 756e 6e65 6c68 6f73 742c 2074 756e 6e65  unnelhost, tunne
+00005620: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
+00005630: 6c75 7365 722c 2074 756e 6e65 6c70 6f72  luser, tunnelpor
+00005640: 743d 7365 6c66 2e74 756e 6e65 6c70 6f72  t=self.tunnelpor
+00005650: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00005660: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00005670: 756e 6e65 6c64 6972 3d73 656c 662e 7475  unneldir=self.tu
+00005680: 6e6e 656c 6469 7229 0a20 2020 2020 2020  nneldir).       
+00005690: 2020 2020 2065 6c69 6620 7365 6c66 2e74       elif self.t
+000056a0: 7970 6520 3d3d 2027 7072 6f78 6d6f 7827  ype == 'proxmox'
+000056b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000056c0: 2020 7761 726e 696e 6728 2250 726f 786d    warning("Proxm
+000056d0: 6f78 2070 726f 7669 6465 7220 6973 2057  ox provider is W
+000056e0: 6f72 6b20 496e 2050 726f 6772 6573 732e  ork In Progress.
+000056f0: 2055 7365 2061 7420 796f 7572 206f 776e   Use at your own
+00005700: 2072 6973 6b21 2229 0a20 2020 2020 2020   risk!").       
+00005710: 2020 2020 2020 2020 2075 7365 7220 3d20           user = 
+00005720: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00005730: 2827 7573 6572 2729 0a20 2020 2020 2020  ('user').       
+00005740: 2020 2020 2020 2020 2069 6620 7573 6572           if user
+00005750: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00005760: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00005770: 726f 7228 224d 6973 7369 6e67 2075 7365  ror("Missing use
+00005780: 7220 696e 2074 6865 2063 6f6e 6669 6775  r in the configu
+00005790: 7261 7469 6f6e 2e20 4c65 6176 696e 6722  ration. Leaving"
+000057a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000057b0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+000057c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000057d0: 2020 6175 7468 5f74 6f6b 656e 5f6e 616d    auth_token_nam
+000057e0: 6520 3d20 7365 6c66 2e6f 7074 696f 6e73  e = self.options
+000057f0: 2e67 6574 2827 6175 7468 5f74 6f6b 656e  .get('auth_token
+00005800: 5f6e 616d 6527 290a 2020 2020 2020 2020  _name').        
+00005810: 2020 2020 2020 2020 7061 7373 776f 7264          password
+00005820: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00005830: 6765 7428 2770 6173 7377 6f72 6427 290a  get('password').
+00005840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005850: 6966 206e 6f74 2061 7574 685f 746f 6b65  if not auth_toke
+00005860: 6e5f 6e61 6d65 2061 6e64 206e 6f74 2070  n_name and not p
+00005870: 6173 7377 6f72 643a 0a20 2020 2020 2020  assword:.       
+00005880: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00005890: 6f72 2822 4d69 7373 696e 6720 6175 7468  or("Missing auth
+000058a0: 5f74 6f6b 656e 5f6e 616d 6520 6f72 2070  _token_name or p
+000058b0: 6173 7377 6f72 6420 696e 2074 6865 2063  assword in the c
+000058c0: 6f6e 6669 6775 7261 7469 6f6e 2e20 4c65  onfiguration. Le
+000058d0: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
+000058e0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+000058f0: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+00005900: 2020 2020 2020 2020 6175 7468 5f74 6f6b          auth_tok
+00005910: 656e 5f73 6563 7265 7420 3d20 7365 6c66  en_secret = self
+00005920: 2e6f 7074 696f 6e73 2e67 6574 2827 6175  .options.get('au
+00005930: 7468 5f74 6f6b 656e 5f73 6563 7265 7427  th_token_secret'
+00005940: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005950: 2020 6966 2061 7574 685f 746f 6b65 6e5f    if auth_token_
+00005960: 6e61 6d65 2061 6e64 2061 7574 685f 746f  name and auth_to
+00005970: 6b65 6e5f 7365 6372 6574 2069 7320 4e6f  ken_secret is No
+00005980: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00005990: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
+000059a0: 6973 7369 6e67 2061 7574 685f 746f 6b65  issing auth_toke
+000059b0: 6e5f 7365 6372 6574 2069 6e20 7468 6520  n_secret in the 
+000059c0: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
+000059d0: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
+000059e0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+000059f0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00005a00: 2020 2020 2020 2020 2066 696c 7465 7274           filtert
+00005a10: 6167 203d 2073 656c 662e 6f70 7469 6f6e  ag = self.option
+00005a20: 732e 6765 7428 2766 696c 7465 7274 6167  s.get('filtertag
+00005a30: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00005a40: 2020 206e 6f64 6520 3d20 7365 6c66 2e6f     node = self.o
+00005a50: 7074 696f 6e73 2e67 6574 2827 6e6f 6465  ptions.get('node
+00005a60: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00005a70: 2020 2076 6572 6966 795f 7373 6c20 3d20     verify_ssl = 
+00005a80: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00005a90: 2827 7665 7269 6679 5f73 736c 2729 0a20  ('verify_ssl'). 
+00005aa0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00005ab0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00005ac0: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
+00005ad0: 7274 2e70 726f 7669 6465 7273 2e70 726f  rt.providers.pro
+00005ae0: 786d 6f78 2069 6d70 6f72 7420 4b70 726f  xmox import Kpro
+00005af0: 786d 6f78 0a20 2020 2020 2020 2020 2020  xmox.           
+00005b00: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00005b10: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+00005b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b30: 6578 6365 7074 696f 6e20 3d20 6520 6966  exception = e if
+00005b40: 2064 6562 7567 2065 6c73 6520 4e6f 6e65   debug else None
+00005b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005b60: 2020 2020 2064 6570 656e 6465 6e63 795f       dependency_
+00005b70: 6572 726f 7228 2770 726f 786d 6f78 272c  error('proxmox',
+00005b80: 2065 7863 6570 7469 6f6e 290a 2020 2020   exception).    
+00005b90: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+00005ba0: 4b70 726f 786d 6f78 280a 2020 2020 2020  Kproxmox(.      
+00005bb0: 2020 2020 2020 2020 2020 2020 2020 686f                ho
+00005bc0: 7374 3d73 656c 662e 686f 7374 2c0a 2020  st=self.host,.  
+00005bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005be0: 2020 706f 7274 3d4e 6f6e 652c 0a20 2020    port=None,.   
+00005bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c00: 2075 7365 723d 7573 6572 2c0a 2020 2020   user=user,.    
+00005c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c20: 7061 7373 776f 7264 3d70 6173 7377 6f72  password=passwor
+00005c30: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00005c40: 2020 2020 2020 2074 6f6b 656e 5f6e 616d         token_nam
+00005c50: 653d 6175 7468 5f74 6f6b 656e 5f6e 616d  e=auth_token_nam
+00005c60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00005c70: 2020 2020 2020 2074 6f6b 656e 5f73 6563         token_sec
+00005c80: 7265 743d 6175 7468 5f74 6f6b 656e 5f73  ret=auth_token_s
+00005c90: 6563 7265 742c 0a20 2020 2020 2020 2020  ecret,.         
+00005ca0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00005cb0: 7274 6167 3d66 696c 7465 7274 6167 2c0a  rtag=filtertag,.
 00005cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cd0: 2069 6620 6d69 6e63 6c69 2021 3d20 7365   if mincli != se
-00005ce0: 6c66 2e63 6c69 656e 743a 0a20 2020 2020  lf.client:.     
-00005cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d00: 2020 2073 656c 662e 6578 7472 6163 6c69     self.extracli
-00005d10: 656e 7473 5b73 656c 662e 636c 6965 6e74  ents[self.client
-00005d20: 5d20 3d20 6b0a 2020 2020 2020 2020 2020  ] = k.          
-00005d30: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
-00005d40: 3d20 7365 6c66 2e65 7874 7261 636c 6965  = self.extraclie
-00005d50: 6e74 735b 6d69 6e63 6c69 5d0a 2020 2020  nts[mincli].    
-00005d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d70: 2020 2020 6465 6c20 7365 6c66 2e65 7874      del self.ext
-00005d80: 7261 636c 6965 6e74 735b 6d69 6e63 6c69  raclients[mincli
-00005d90: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00005da0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00005db0: 6c69 656e 7420 3d20 6d69 6e63 6c69 0a20  lient = mincli. 
-00005dc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00005dd0: 6620 7365 6c66 2e61 6c67 6f72 6974 686d  f self.algorithm
-00005de0: 203d 3d20 2762 616c 616e 6365 273a 0a20   == 'balance':. 
-00005df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e00: 2020 206d 656d 6265 7273 203d 205b 7365     members = [se
-00005e10: 6c66 2e63 6c69 656e 745d 202b 206c 6973  lf.client] + lis
-00005e20: 7428 7365 6c66 2e65 7874 7261 636c 6965  t(self.extraclie
-00005e30: 6e74 732e 6b65 7973 2829 290a 2020 2020  nts.keys()).    
-00005e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e50: 6c61 7374 766d 203d 2022 2573 2f2e 6b63  lastvm = "%s/.kc
-00005e60: 6c69 2f76 6d22 2025 206f 732e 656e 7669  li/vm" % os.envi
-00005e70: 726f 6e2e 6765 7428 2748 4f4d 4527 290a  ron.get('HOME').
-00005e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e90: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-00005ea0: 7869 7374 7328 6c61 7374 766d 2920 616e  xists(lastvm) an
-00005eb0: 6420 6f73 2e73 7461 7428 6c61 7374 766d  d os.stat(lastvm
-00005ec0: 292e 7374 5f73 697a 6520 3e20 303a 0a20  ).st_size > 0:. 
-00005ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ee0: 2020 2020 2020 2066 6f72 206c 696e 6520         for line 
-00005ef0: 696e 206f 7065 6e28 6c61 7374 766d 292e  in open(lastvm).
-00005f00: 7265 6164 6c69 6e65 7328 293a 0a20 2020  readlines():.   
-00005f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f20: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-00005f30: 6c69 6e65 2e73 706c 6974 2827 2027 290a  line.split(' ').
+00005cd0: 2020 2020 6e6f 6465 3d6e 6f64 652c 0a20      node=node,. 
+00005ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005cf0: 2020 2076 6572 6966 795f 7373 6c3d 7665     verify_ssl=ve
+00005d00: 7269 6679 5f73 736c 2c0a 2020 2020 2020  rify_ssl,.      
+00005d10: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00005d20: 6275 673d 4661 6c73 6529 0a20 2020 2020  bug=False).     
+00005d30: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00005d40: 2e74 7970 6520 3d3d 2027 7765 6227 3a0a  .type == 'web':.
+00005d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d60: 706f 7274 203d 2073 656c 662e 6f70 7469  port = self.opti
+00005d70: 6f6e 732e 6765 7428 2770 6f72 7427 2c20  ons.get('port', 
+00005d80: 3830 3030 290a 2020 2020 2020 2020 2020  8000).          
+00005d90: 2020 2020 2020 6c6f 6361 6c6b 7562 6520        localkube 
+00005da0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00005db0: 6574 2827 6c6f 6361 6c6b 7562 6527 2c20  et('localkube', 
+00005dc0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00005dd0: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
+00005de0: 2e70 726f 7669 6465 7273 2e77 6562 2069  .providers.web i
+00005df0: 6d70 6f72 7420 4b77 6562 636c 6965 6e74  mport Kwebclient
+00005e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005e10: 206b 203d 204b 7765 6263 6c69 656e 7428   k = Kwebclient(
+00005e20: 7365 6c66 2e68 6f73 742c 2070 6f72 742c  self.host, port,
+00005e30: 206c 6f63 616c 6b75 6265 3d6c 6f63 616c   localkube=local
+00005e40: 6b75 6265 2c20 6465 6275 673d 6465 6275  kube, debug=debu
+00005e50: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
+00005e60: 2020 2073 656c 662e 7479 7065 203d 2027     self.type = '
+00005e70: 7765 6227 0a20 2020 2020 2020 2020 2020  web'.           
+00005e80: 2065 6c69 6620 6f66 666c 696e 653a 0a20   elif offline:. 
+00005e90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00005ea0: 726f 6d20 6b76 6972 742e 7072 6f76 6964  rom kvirt.provid
+00005eb0: 6572 732e 6661 6b65 2069 6d70 6f72 7420  ers.fake import 
+00005ec0: 4b66 616b 650a 2020 2020 2020 2020 2020  Kfake.          
+00005ed0: 2020 2020 2020 6b20 3d20 4b66 616b 6528        k = Kfake(
+00005ee0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005ef0: 2020 7365 6c66 2e74 7970 6520 3d20 2766    self.type = 'f
+00005f00: 616b 6527 0a20 2020 2020 2020 2020 2020  ake'.           
+00005f10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00005f20: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
+00005f30: 6f73 7420 6973 204e 6f6e 653a 0a20 2020  ost is None:.   
 00005f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f50: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00005f60: 656e 286c 696e 6529 2021 3d20 323a 0a20  en(line) != 2:. 
-00005f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00005f90: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00005fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fb0: 2020 2020 636c 6920 3d20 6c69 6e65 5b30      cli = line[0
-00005fc0: 5d2e 7374 7269 7028 290a 2020 2020 2020  ].strip().      
-00005fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fe0: 2020 2020 2020 6966 2063 6c69 2069 6e20        if cli in 
-00005ff0: 6d65 6d62 6572 7320 616e 6420 6d65 6d62  members and memb
-00006000: 6572 732e 696e 6465 7828 636c 6929 203c  ers.index(cli) <
-00006010: 206c 656e 286d 656d 6265 7273 293a 0a20   len(members):. 
-00006020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006030: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00006040: 6c69 696e 6465 7820 3d20 6d65 6d62 6572  liindex = member
-00006050: 732e 696e 6465 7828 636c 6929 0a20 2020  s.index(cli).   
-00006060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006070: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00006080: 636c 6920 3d20 6d65 6d62 6572 735b 2863  cli = members[(c
-00006090: 6c69 696e 6465 7820 2b20 3129 2025 206c  liindex + 1) % l
-000060a0: 656e 286d 656d 6265 7273 295d 0a20 2020  en(members)].   
-000060b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000060d0: 6e65 7763 6c69 2021 3d20 7365 6c66 2e63  newcli != self.c
-000060e0: 6c69 656e 743a 0a20 2020 2020 2020 2020  lient:.         
-000060f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006100: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006110: 6578 7472 6163 6c69 656e 7473 5b73 656c  extraclients[sel
-00006120: 662e 636c 6965 6e74 5d20 3d20 6b0a 2020  f.client] = k.  
-00006130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006150: 2020 6b20 3d20 7365 6c66 2e65 7874 7261    k = self.extra
-00006160: 636c 6965 6e74 735b 6e65 7763 6c69 5d0a  clients[newcli].
-00006170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f50: 2065 7272 6f72 2822 5072 6f62 6c65 6d20   error("Problem 
+00005f60: 7061 7273 696e 6720 796f 7572 2063 6f6e  parsing your con
+00005f70: 6669 6775 7261 7469 6f6e 2066 696c 6522  figuration file"
+00005f80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005f90: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+00005fa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005fb0: 2020 7365 7373 696f 6e20 3d20 7365 6c66    session = self
+00005fc0: 2e6f 7074 696f 6e73 2e67 6574 2827 7365  .options.get('se
+00005fd0: 7373 696f 6e27 2c20 4661 6c73 6529 0a20  ssion', False). 
+00005fe0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00005ff0: 656d 6f74 6564 6e73 6d61 7371 203d 2073  emotednsmasq = s
+00006000: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00006010: 2772 656d 6f74 6564 6e73 6d61 7371 272c  'remotednsmasq',
+00006020: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+00006030: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00006040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006050: 2066 726f 6d20 6b76 6972 742e 7072 6f76   from kvirt.prov
+00006060: 6964 6572 732e 6b76 6d20 696d 706f 7274  iders.kvm import
+00006070: 204b 7669 7274 0a20 2020 2020 2020 2020   Kvirt.         
+00006080: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00006090: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+000060a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060b0: 2020 6578 6365 7074 696f 6e20 3d20 6520    exception = e 
+000060c0: 6966 2064 6562 7567 2065 6c73 6520 4e6f  if debug else No
+000060d0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+000060e0: 2020 2020 2020 2064 6570 656e 6465 6e63         dependenc
+000060f0: 795f 6572 726f 7228 276c 6962 7669 7274  y_error('libvirt
+00006100: 272c 2065 7863 6570 7469 6f6e 290a 2020  ', exception).  
+00006110: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
+00006120: 3d20 4b76 6972 7428 686f 7374 3d73 656c  = Kvirt(host=sel
+00006130: 662e 686f 7374 2c20 706f 7274 3d73 656c  f.host, port=sel
+00006140: 662e 706f 7274 2c20 7573 6572 3d73 656c  f.port, user=sel
+00006150: 662e 7573 6572 2c20 7072 6f74 6f63 6f6c  f.user, protocol
+00006160: 3d73 656c 662e 7072 6f74 6f63 6f6c 2c20  =self.protocol, 
+00006170: 7572 6c3d 7365 6c66 2e75 726c 2c0a 2020  url=self.url,.  
 00006180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006190: 2020 2020 6465 6c20 7365 6c66 2e65 7874      del self.ext
-000061a0: 7261 636c 6965 6e74 735b 6e65 7763 6c69  raclients[newcli
-000061b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000061c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061d0: 2020 2020 2020 7365 6c66 2e63 6c69 656e        self.clien
-000061e0: 7420 3d20 6e65 7763 6c69 0a20 2020 2020  t = newcli.     
-000061f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006200: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00006210: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006220: 2020 7070 7269 6e74 2866 2253 656c 6563    pprint(f"Selec
-00006230: 7469 6e67 2063 6c69 656e 7420 7b73 656c  ting client {sel
-00006240: 662e 636c 6965 6e74 7d20 6672 6f6d 2067  f.client} from g
-00006250: 726f 7570 207b 7365 6c66 2e67 726f 7570  roup {self.group
-00006260: 7d22 290a 2020 2020 2020 2020 7365 6c66  }").        self
-00006270: 2e6b 203d 206b 0a20 2020 2020 2020 2064  .k = k.        d
-00006280: 6566 6175 6c74 5f64 6174 6120 3d20 7b27  efault_data = {'
-00006290: 636f 6e66 6967 5f25 7327 2025 206b 3a20  config_%s' % k: 
-000062a0: 7365 6c66 2e64 6566 6175 6c74 5b6b 5d20  self.default[k] 
-000062b0: 666f 7220 6b20 696e 2073 656c 662e 6465  for k in self.de
-000062c0: 6661 756c 747d 0a20 2020 2020 2020 2063  fault}.        c
-000062d0: 6f6e 6669 675f 6461 7461 203d 207b 2763  onfig_data = {'c
-000062e0: 6f6e 6669 675f 2573 2720 2520 6b3a 2073  onfig_%s' % k: s
-000062f0: 656c 662e 696e 695b 7365 6c66 2e63 6c69  elf.ini[self.cli
-00006300: 656e 745d 5b6b 5d20 666f 7220 6b20 696e  ent][k] for k in
-00006310: 2073 656c 662e 696e 695b 7365 6c66 2e63   self.ini[self.c
-00006320: 6c69 656e 745d 7d0a 2020 2020 2020 2020  lient]}.        
-00006330: 636f 6e66 6967 5f64 6174 615b 2763 6f6e  config_data['con
-00006340: 6669 675f 7479 7065 275d 203d 2063 6f6e  fig_type'] = con
-00006350: 6669 675f 6461 7461 2e67 6574 2827 636f  fig_data.get('co
-00006360: 6e66 6967 5f74 7970 6527 2c20 276b 766d  nfig_type', 'kvm
-00006370: 2729 0a20 2020 2020 2020 2063 6f6e 6669  ').        confi
-00006380: 675f 6461 7461 5b27 636f 6e66 6967 5f68  g_data['config_h
-00006390: 6f73 7427 5d20 3d20 636f 6e66 6967 5f64  ost'] = config_d
-000063a0: 6174 612e 6765 7428 2763 6f6e 6669 675f  ata.get('config_
-000063b0: 686f 7374 272c 2027 3132 372e 302e 302e  host', '127.0.0.
-000063c0: 3127 290a 2020 2020 2020 2020 6465 6661  1').        defa
-000063d0: 756c 745f 7573 6572 203d 2067 6574 7573  ult_user = getus
-000063e0: 6572 2829 2069 6620 636f 6e66 6967 5f64  er() if config_d
-000063f0: 6174 615b 2763 6f6e 6669 675f 7479 7065  ata['config_type
-00006400: 275d 203d 3d20 276b 766d 275c 0a20 2020  '] == 'kvm'\.   
-00006410: 2020 2020 2020 2020 2061 6e64 2073 656c           and sel
-00006420: 662e 686f 7374 2069 6e20 5b27 6c6f 6361  f.host in ['loca
-00006430: 6c68 6f73 7427 2c20 2731 3237 2e30 2e30  lhost', '127.0.0
-00006440: 2e31 275d 2065 6c73 6520 2772 6f6f 7427  .1'] else 'root'
-00006450: 0a20 2020 2020 2020 2063 6f6e 6669 675f  .        config_
-00006460: 6461 7461 5b27 636f 6e66 6967 5f75 7365  data['config_use
-00006470: 7227 5d20 3d20 636f 6e66 6967 5f64 6174  r'] = config_dat
-00006480: 612e 6765 7428 2763 6f6e 6669 675f 7573  a.get('config_us
-00006490: 6572 272c 2064 6566 6175 6c74 5f75 7365  er', default_use
-000064a0: 7229 0a20 2020 2020 2020 2063 6f6e 6669  r).        confi
-000064b0: 675f 6461 7461 5b27 636f 6e66 6967 5f63  g_data['config_c
-000064c0: 6c69 656e 7427 5d20 3d20 7365 6c66 2e63  lient'] = self.c
-000064d0: 6c69 656e 740a 2020 2020 2020 2020 7365  lient.        se
-000064e0: 6c66 2e6f 7665 7272 6964 6573 2e75 7064  lf.overrides.upd
-000064f0: 6174 6528 6465 6661 756c 745f 6461 7461  ate(default_data
-00006500: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
-00006510: 7665 7272 6964 6573 2e75 7064 6174 6528  verrides.update(
-00006520: 636f 6e66 6967 5f64 6174 6129 0a0a 2020  config_data)..  
-00006530: 2020 6465 6620 6372 6561 7465 5f76 6d28    def create_vm(
-00006540: 7365 6c66 2c20 6e61 6d65 2c20 7072 6f66  self, name, prof
-00006550: 696c 653d 4e6f 6e65 2c20 6f76 6572 7269  ile=None, overri
-00006560: 6465 733d 7b7d 2c20 6375 7374 6f6d 7072  des={}, custompr
-00006570: 6f66 696c 653d 7b7d 2c20 6b3d 4e6f 6e65  ofile={}, k=None
-00006580: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006590: 2020 2020 706c 616e 3d27 6b76 6972 7427      plan='kvirt'
-000065a0: 2c20 6261 7365 6469 723d 272e 272c 2063  , basedir='.', c
-000065b0: 6c69 656e 743d 4e6f 6e65 2c20 6f6e 666c  lient=None, onfl
-000065c0: 793d 4e6f 6e65 2c20 6f6e 6c79 6173 7365  y=None, onlyasse
-000065d0: 7473 3d46 616c 7365 293a 0a20 2020 2020  ts=False):.     
-000065e0: 2020 206f 7665 7272 6964 6573 2e75 7064     overrides.upd
-000065f0: 6174 6528 7365 6c66 2e6f 7665 7272 6964  ate(self.overrid
-00006600: 6573 290a 2020 2020 2020 2020 7772 6f6e  es).        wron
-00006610: 675f 6f76 6572 7269 6465 7320 3d20 5b79  g_overrides = [y
-00006620: 2066 6f72 2079 2069 6e20 6f76 6572 7269   for y in overri
-00006630: 6465 7320 6966 2027 2d27 2069 6e20 795d  des if '-' in y]
-00006640: 0a20 2020 2020 2020 2069 6620 7772 6f6e  .        if wron
-00006650: 675f 6f76 6572 7269 6465 733a 0a20 2020  g_overrides:.   
-00006660: 2020 2020 2020 2020 2066 6f72 2077 726f           for wro
-00006670: 6e67 5f6f 7665 7272 6964 6520 696e 2077  ng_override in w
-00006680: 726f 6e67 5f6f 7665 7272 6964 6573 3a0a  rong_overrides:.
-00006690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000066a0: 6572 726f 7228 6622 496e 636f 7272 6563  error(f"Incorrec
-000066b0: 7420 7061 7261 6d65 7465 7220 7b77 726f  t parameter {wro
-000066c0: 6e67 5f6f 7665 7272 6964 6573 7d2e 2048  ng_overrides}. H
-000066d0: 7970 6865 6e73 2061 7265 206e 6f74 2061  yphens are not a
-000066e0: 6c6c 6f77 6564 2229 0a20 2020 2020 2020  llowed").       
-000066f0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00006700: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
-00006710: 2c20 2772 6561 736f 6e27 3a20 2749 6e63  , 'reason': 'Inc
-00006720: 6f72 7265 6374 2070 6172 616d 6574 6572  orrect parameter
-00006730: 7320 666f 756e 6427 7d0a 2020 2020 2020  s found'}.      
-00006740: 2020 6f76 6572 7269 6465 735b 276e 616d    overrides['nam
-00006750: 6527 5d20 3d20 6e61 6d65 0a20 2020 2020  e'] = name.     
-00006760: 2020 206b 7562 6520 3d20 6f76 6572 7269     kube = overri
-00006770: 6465 732e 6765 7428 276b 7562 6527 290a  des.get('kube').
-00006780: 2020 2020 2020 2020 6b75 6265 7479 7065          kubetype
-00006790: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
-000067a0: 2827 6b75 6265 7479 7065 2729 0a20 2020  ('kubetype').   
-000067b0: 2020 2020 206b 203d 2073 656c 662e 6b20       k = self.k 
-000067c0: 6966 206b 2069 7320 4e6f 6e65 2065 6c73  if k is None els
-000067d0: 6520 6b0a 2020 2020 2020 2020 6375 7374  e k.        cust
-000067e0: 6f6d 5f72 6567 696f 6e20 3d20 6e65 7874  om_region = next
-000067f0: 2828 6520 666f 7220 6520 696e 205b 6375  ((e for e in [cu
-00006800: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
-00006810: 2772 6567 696f 6e27 292c 206f 7665 7272  'region'), overr
-00006820: 6964 6573 2e67 6574 2827 7265 6769 6f6e  ides.get('region
-00006830: 2729 5d20 6966 2065 2069 7320 6e6f 7420  ')] if e is not 
-00006840: 4e6f 6e65 292c 204e 6f6e 6529 0a20 2020  None), None).   
-00006850: 2020 2020 2069 6620 6375 7374 6f6d 5f72       if custom_r
-00006860: 6567 696f 6e20 6973 206e 6f74 204e 6f6e  egion is not Non
-00006870: 6520 616e 6420 6861 7361 7474 7228 6b2c  e and hasattr(k,
-00006880: 2027 7265 6769 6f6e 2729 3a0a 2020 2020   'region'):.    
-00006890: 2020 2020 2020 2020 6b2e 7265 6769 6f6e          k.region
-000068a0: 203d 2063 7573 746f 6d5f 7265 6769 6f6e   = custom_region
-000068b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000068c0: 6861 7361 7474 7228 6b2c 2027 7a6f 6e65  hasattr(k, 'zone
-000068d0: 2729 2061 6e64 2063 7573 746f 6d5f 7265  ') and custom_re
-000068e0: 6769 6f6e 206e 6f74 2069 6e20 6b2e 7a6f  gion not in k.zo
-000068f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006900: 2020 2020 6b2e 7a6f 6e65 203d 2066 227b      k.zone = f"{
-00006910: 6375 7374 6f6d 5f72 6567 696f 6e7d 2d32  custom_region}-2
-00006920: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
-00006930: 2073 656c 662e 7479 7065 203d 3d20 2769   self.type == 'i
-00006940: 626d 273a 0a20 2020 2020 2020 2020 2020  bm':.           
-00006950: 2020 2020 206b 2e63 6f6e 6e2e 7365 745f       k.conn.set_
-00006960: 7365 7276 6963 655f 7572 6c28 6622 6874  service_url(f"ht
-00006970: 7470 733a 2f2f 7b63 7573 746f 6d5f 7265  tps://{custom_re
-00006980: 6769 6f6e 7d2e 6961 6173 2e63 6c6f 7564  gion}.iaas.cloud
-00006990: 2e69 626d 2e63 6f6d 2f76 3122 290a 2020  .ibm.com/v1").  
-000069a0: 2020 2020 2020 6375 7374 6f6d 5f7a 6f6e        custom_zon
-000069b0: 6520 3d20 6e65 7874 2828 6520 666f 7220  e = next((e for 
-000069c0: 6520 696e 205b 6375 7374 6f6d 7072 6f66  e in [customprof
-000069d0: 696c 652e 6765 7428 277a 6f6e 6527 292c  ile.get('zone'),
-000069e0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-000069f0: 7a6f 6e65 2729 5d20 6966 2065 2069 7320  zone')] if e is 
-00006a00: 6e6f 7420 4e6f 6e65 292c 204e 6f6e 6529  not None), None)
-00006a10: 0a20 2020 2020 2020 2069 6620 6375 7374  .        if cust
-00006a20: 6f6d 5f7a 6f6e 6520 6973 206e 6f74 204e  om_zone is not N
-00006a30: 6f6e 6520 616e 6420 6861 7361 7474 7228  one and hasattr(
-00006a40: 6b2c 2027 7a6f 6e65 2729 3a0a 2020 2020  k, 'zone'):.    
-00006a50: 2020 2020 2020 2020 6b2e 7a6f 6e65 203d          k.zone =
-00006a60: 2063 7573 746f 6d5f 7a6f 6e65 0a20 2020   custom_zone.   
-00006a70: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-00006a80: 7474 7228 6b2c 2027 7265 6769 6f6e 2729  ttr(k, 'region')
-00006a90: 2061 6e64 206b 2e72 6567 696f 6e20 6e6f   and k.region no
-00006aa0: 7420 696e 206b 2e7a 6f6e 653a 0a20 2020  t in k.zone:.   
-00006ab0: 2020 2020 2020 2020 2020 2020 206b 2e72               k.r
-00006ac0: 6567 696f 6e20 3d20 6375 7374 6f6d 5f7a  egion = custom_z
-00006ad0: 6f6e 655b 3a2d 325d 0a20 2020 2020 2020  one[:-2].       
-00006ae0: 2074 756e 6e65 6c20 3d20 7365 6c66 2e74   tunnel = self.t
-00006af0: 756e 6e65 6c0a 2020 2020 2020 2020 7072  unnel.        pr
-00006b00: 6f66 696c 6520 3d20 7072 6f66 696c 6520  ofile = profile 
-00006b10: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
-00006b20: 2827 696d 6167 6527 2c20 276b 7669 7274  ('image', 'kvirt
-00006b30: 2729 0a20 2020 2020 2020 2066 756c 6c5f  ').        full_
-00006b40: 766f 6c75 6d65 7320 3d20 7365 6c66 2e6b  volumes = self.k
-00006b50: 2e76 6f6c 756d 6573 2829 0a20 2020 2020  .volumes().     
-00006b60: 2020 2076 6f6c 756d 6573 203d 205b 6f73     volumes = [os
-00006b70: 2e70 6174 682e 6261 7365 6e61 6d65 2876  .path.basename(v
-00006b80: 2920 666f 7220 7620 696e 2066 756c 6c5f  ) for v in full_
-00006b90: 766f 6c75 6d65 735d 0a20 2020 2020 2020  volumes].       
-00006ba0: 2076 6d70 726f 6669 6c65 7320 3d20 7b6b   vmprofiles = {k
-00006bb0: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
-00006bc0: 7365 6c66 2e70 726f 6669 6c65 732e 6974  self.profiles.it
-00006bd0: 656d 7328 2920 6966 2027 7479 7065 2720  ems() if 'type' 
-00006be0: 6e6f 7420 696e 2076 206f 7220 765b 2774  not in v or v['t
-00006bf0: 7970 6527 5d20 3d3d 2027 766d 277d 0a20  ype'] == 'vm'}. 
-00006c00: 2020 2020 2020 2069 6620 6375 7374 6f6d         if custom
-00006c10: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
-00006c20: 2020 2020 2076 6d70 726f 6669 6c65 735b       vmprofiles[
-00006c30: 7072 6f66 696c 655d 203d 2063 7573 746f  profile] = custo
-00006c40: 6d70 726f 6669 6c65 0a20 2020 2020 2020  mprofile.       
-00006c50: 2065 6c69 6620 7072 6f66 696c 6520 696e   elif profile in
-00006c60: 2076 6d70 726f 6669 6c65 733a 0a20 2020   vmprofiles:.   
-00006c70: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00006c80: 6622 4465 706c 6f79 696e 6720 766d 207b  f"Deploying vm {
-00006c90: 6e61 6d65 7d20 6672 6f6d 2070 726f 6669  name} from profi
-00006ca0: 6c65 207b 7072 6f66 696c 657d 2e2e 2e22  le {profile}..."
-00006cb0: 290a 2020 2020 2020 2020 656c 6966 2028  ).        elif (
-00006cc0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-00006cd0: 2870 726f 6669 6c65 2920 3d3d 2070 726f  (profile) == pro
-00006ce0: 6669 6c65 2061 6e64 2070 726f 6669 6c65  file and profile
-00006cf0: 2069 6e20 766f 6c75 6d65 7329 206f 7220   in volumes) or 
-00006d00: 7072 6f66 696c 6520 696e 2066 756c 6c5f  profile in full_
-00006d10: 766f 6c75 6d65 733a 0a20 2020 2020 2020  volumes:.       
-00006d20: 2020 2020 2069 6620 6e6f 7420 6f6e 6c79       if not only
-00006d30: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
-00006d40: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00006d50: 2244 6570 6c6f 7969 6e67 2076 6d20 7b6e  "Deploying vm {n
-00006d60: 616d 657d 2066 726f 6d20 696d 6167 6520  ame} from image 
-00006d70: 7b70 726f 6669 6c65 7d2e 2e2e 2229 0a20  {profile}..."). 
-00006d80: 2020 2020 2020 2020 2020 206e 6577 5f70             new_p
-00006d90: 726f 6669 6c65 203d 206f 732e 7061 7468  rofile = os.path
-00006da0: 2e62 6173 656e 616d 6528 7072 6f66 696c  .basename(profil
-00006db0: 6529 0a20 2020 2020 2020 2020 2020 2076  e).            v
-00006dc0: 6d70 726f 6669 6c65 735b 6e65 775f 7072  mprofiles[new_pr
-00006dd0: 6f66 696c 655d 203d 207b 2769 6d61 6765  ofile] = {'image
-00006de0: 273a 2070 726f 6669 6c65 7d0a 2020 2020  ': profile}.    
-00006df0: 2020 2020 2020 2020 7072 6f66 696c 6520          profile 
-00006e00: 3d20 6e65 775f 7072 6f66 696c 650a 2020  = new_profile.  
-00006e10: 2020 2020 2020 656c 6966 2070 726f 6669        elif profi
-00006e20: 6c65 2069 6e20 494d 4147 4553 206f 7220  le in IMAGES or 
-00006e30: 7072 6f66 696c 6520 3d3d 2027 7268 636f  profile == 'rhco
-00006e40: 7334 3030 3027 3a0a 2020 2020 2020 2020  s4000':.        
-00006e50: 2020 2020 766d 7072 6f66 696c 6573 5b70      vmprofiles[p
-00006e60: 726f 6669 6c65 5d20 3d20 7b27 696d 6167  rofile] = {'imag
-00006e70: 6527 3a20 7072 6f66 696c 657d 0a20 2020  e': profile}.   
-00006e80: 2020 2020 2065 6c69 6620 7072 6f66 696c       elif profil
-00006e90: 652e 7374 6172 7473 7769 7468 2827 7268  e.startswith('rh
-00006ea0: 636f 732d 3427 2920 616e 6420 7072 6f66  cos-4') and prof
-00006eb0: 696c 652e 656e 6473 7769 7468 2827 7163  ile.endswith('qc
-00006ec0: 6f77 3227 2920 616e 6420 7365 6c66 2e74  ow2') and self.t
-00006ed0: 7970 6520 6e6f 7420 696e 2063 6c6f 7564  ype not in cloud
-00006ee0: 706c 6174 666f 726d 733a 0a20 2020 2020  platforms:.     
-00006ef0: 2020 2020 2020 2076 6d70 726f 6669 6c65         vmprofile
-00006f00: 735b 7072 6f66 696c 655d 203d 207b 2769  s[profile] = {'i
-00006f10: 6d61 6765 273a 2070 726f 6669 6c65 7d0a  mage': profile}.
-00006f20: 2020 2020 2020 2020 656c 6966 2070 726f          elif pro
-00006f30: 6669 6c65 203d 3d20 276b 7669 7274 273a  file == 'kvirt':
-00006f40: 0a20 2020 2020 2020 2020 2020 2076 6d70  .            vmp
-00006f50: 726f 6669 6c65 735b 7072 6f66 696c 655d  rofiles[profile]
-00006f60: 203d 207b 7d0a 2020 2020 2020 2020 656c   = {}.        el
-00006f70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00006f80: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-00006f90: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-00006fa0: 6173 6f6e 273a 2066 2749 6d61 6765 207b  ason': f'Image {
-00006fb0: 7072 6f66 696c 657d 206e 6f74 2066 6f75  profile} not fou
-00006fc0: 6e64 277d 0a20 2020 2020 2020 2070 726f  nd'}.        pro
-00006fd0: 6669 6c65 6e61 6d65 203d 2070 726f 6669  filename = profi
-00006fe0: 6c65 0a20 2020 2020 2020 2070 726f 6669  le.        profi
-00006ff0: 6c65 203d 2076 6d70 726f 6669 6c65 735b  le = vmprofiles[
-00007000: 7072 6f66 696c 655d 0a20 2020 2020 2020  profile].       
-00007010: 2070 696d 6167 6520 3d20 7072 6f66 696c   pimage = profil
-00007020: 652e 6765 7428 2769 6d61 6765 272c 2027  e.get('image', '
-00007030: 5858 5827 290a 2020 2020 2020 2020 6966  XXX').        if
-00007040: 206e 6f74 206f 6e6c 7961 7373 6574 7320   not onlyassets 
-00007050: 616e 6420 7365 6c66 2e74 7970 6520 6e6f  and self.type no
-00007060: 7420 696e 2063 6c6f 7564 706c 6174 666f  t in cloudplatfo
-00007070: 726d 7320 616e 6420 7069 6d61 6765 2069  rms and pimage i
-00007080: 6e20 494d 4147 4553 2061 6e64 2070 696d  n IMAGES and pim
-00007090: 6167 6520 6e6f 7420 696e 2076 6f6c 756d  age not in volum
-000070a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000070b0: 7070 7269 6e74 2866 2249 6d61 6765 207b  pprint(f"Image {
-000070c0: 7069 6d61 6765 7d20 6e6f 7420 666f 756e  pimage} not foun
-000070d0: 642e 2044 6f77 6e6c 6f61 6469 6e67 2229  d. Downloading")
-000070e0: 0a20 2020 2020 2020 2020 2020 2070 696d  .            pim
-000070f0: 6167 655f 6461 7461 203d 207b 2770 6f6f  age_data = {'poo
-00007100: 6c27 3a20 7365 6c66 2e70 6f6f 6c2c 2027  l': self.pool, '
-00007110: 696d 6167 6527 3a20 7069 6d61 6765 2c20  image': pimage, 
-00007120: 2764 6f77 6e6c 6f61 6427 3a20 5472 7565  'download': True
-00007130: 7d0a 2020 2020 2020 2020 2020 2020 7069  }.            pi
-00007140: 6d61 6765 5f73 697a 6520 3d20 7072 6f66  mage_size = prof
-00007150: 696c 652e 6765 7428 276b 7562 6576 6972  ile.get('kubevir
-00007160: 745f 6469 736b 5f73 697a 6527 2920 6f72  t_disk_size') or
-00007170: 2070 726f 6669 6c65 2e67 6574 2827 7369   profile.get('si
-00007180: 7a65 2729 0a20 2020 2020 2020 2020 2020  ze').           
-00007190: 2069 6620 7069 6d61 6765 5f73 697a 6520   if pimage_size 
-000071a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000071b0: 2020 2020 2020 2020 2020 2020 2070 696d               pim
-000071c0: 6167 655f 6461 7461 5b27 7369 7a65 275d  age_data['size']
-000071d0: 203d 2070 696d 6167 655f 7369 7a65 0a20   = pimage_size. 
-000071e0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-000071f0: 6f66 696c 656e 616d 652e 7374 6172 7473  ofilename.starts
-00007200: 7769 7468 2827 7268 636f 732d 3427 2920  with('rhcos-4') 
-00007210: 616e 6420 7072 6f66 696c 656e 616d 652e  and profilename.
-00007220: 656e 6473 7769 7468 2827 7163 6f77 3227  endswith('qcow2'
-00007230: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00007240: 2020 2070 696d 6167 655f 6461 7461 5b27     pimage_data['
-00007250: 696d 6167 6527 5d20 3d20 7072 6f66 696c  image'] = profil
-00007260: 656e 616d 652e 7370 6c69 7428 272e 2729  ename.split('.')
-00007270: 5b30 5d2e 7265 706c 6163 6528 2772 6863  [0].replace('rhc
-00007280: 6f73 2d34 272c 2027 7268 636f 7334 2729  os-4', 'rhcos4')
-00007290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000072a0: 2070 696d 6167 655f 6461 7461 5b27 7572   pimage_data['ur
-000072b0: 6c27 5d20 3d20 6765 745f 7268 636f 735f  l'] = get_rhcos_
-000072c0: 7572 6c5f 6672 6f6d 5f66 696c 6528 7072  url_from_file(pr
-000072d0: 6f66 696c 656e 616d 652c 205f 7479 7065  ofilename, _type
-000072e0: 3d73 656c 662e 7479 7065 290a 2020 2020  =self.type).    
-000072f0: 2020 2020 2020 2020 7365 6c66 2e68 616e          self.han
-00007300: 646c 655f 686f 7374 282a 2a70 696d 6167  dle_host(**pimag
-00007310: 655f 6461 7461 290a 2020 2020 2020 2020  e_data).        
-00007320: 6966 206e 6f74 2063 7573 746f 6d70 726f  if not custompro
-00007330: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-00007340: 2020 7072 6f66 696c 652e 7570 6461 7465    profile.update
-00007350: 286f 7665 7272 6964 6573 290a 2020 2020  (overrides).    
-00007360: 2020 2020 6966 2027 6261 7365 2720 696e      if 'base' in
-00007370: 2070 726f 6669 6c65 3a0a 2020 2020 2020   profile:.      
-00007380: 2020 2020 2020 6661 7468 6572 203d 2076        father = v
-00007390: 6d70 726f 6669 6c65 735b 7072 6f66 696c  mprofiles[profil
-000073a0: 655b 2762 6173 6527 5d5d 0a20 2020 2020  e['base']].     
-000073b0: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
-000073c0: 756d 6370 7573 203d 2066 6174 6865 722e  umcpus = father.
-000073d0: 6765 7428 276e 756d 6370 7573 272c 2073  get('numcpus', s
-000073e0: 656c 662e 6e75 6d63 7075 7329 0a20 2020  elf.numcpus).   
-000073f0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00007400: 5f6d 656d 6f72 7920 3d20 6661 7468 6572  _memory = father
-00007410: 2e67 6574 2827 6d65 6d6f 7279 272c 2073  .get('memory', s
-00007420: 656c 662e 6d65 6d6f 7279 290a 2020 2020  elf.memory).    
-00007430: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00007440: 706f 6f6c 203d 2066 6174 6865 722e 6765  pool = father.ge
-00007450: 7428 2770 6f6f 6c27 2c20 7365 6c66 2e70  t('pool', self.p
-00007460: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
-00007470: 2064 6566 6175 6c74 5f64 6973 6b73 203d   default_disks =
-00007480: 2066 6174 6865 722e 6765 7428 2764 6973   father.get('dis
-00007490: 6b73 272c 2073 656c 662e 6469 736b 7329  ks', self.disks)
-000074a0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000074b0: 6175 6c74 5f6e 6574 7320 3d20 6661 7468  ault_nets = fath
-000074c0: 6572 2e67 6574 2827 6e65 7473 272c 2073  er.get('nets', s
-000074d0: 656c 662e 6e65 7473 290a 2020 2020 2020  elf.nets).      
-000074e0: 2020 2020 2020 6465 6661 756c 745f 696d        default_im
-000074f0: 6167 6520 3d20 6661 7468 6572 2e67 6574  age = father.get
-00007500: 2827 696d 6167 6527 2c20 7365 6c66 2e69  ('image', self.i
-00007510: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
-00007520: 2020 6465 6661 756c 745f 636c 6f75 6469    default_cloudi
-00007530: 6e69 7420 3d20 6661 7468 6572 2e67 6574  nit = father.get
-00007540: 2827 636c 6f75 6469 6e69 7427 2c20 7365  ('cloudinit', se
-00007550: 6c66 2e63 6c6f 7564 696e 6974 290a 2020  lf.cloudinit).  
-00007560: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007570: 745f 6e65 7374 6564 203d 2066 6174 6865  t_nested = fathe
-00007580: 722e 6765 7428 276e 6573 7465 6427 2c20  r.get('nested', 
-00007590: 7365 6c66 2e6e 6573 7465 6429 0a20 2020  self.nested).   
-000075a0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000075b0: 5f72 6573 6572 7665 646e 7320 3d20 6661  _reservedns = fa
-000075c0: 7468 6572 2e67 6574 2827 7265 7365 7276  ther.get('reserv
-000075d0: 6564 6e73 272c 2073 656c 662e 7265 7365  edns', self.rese
-000075e0: 7276 6564 6e73 290a 2020 2020 2020 2020  rvedns).        
-000075f0: 2020 2020 6465 6661 756c 745f 7265 7365      default_rese
-00007600: 7276 6568 6f73 7420 3d20 6661 7468 6572  rvehost = father
-00007610: 2e67 6574 2827 7265 7365 7276 6568 6f73  .get('reservehos
-00007620: 7427 2c20 7365 6c66 2e72 6573 6572 7665  t', self.reserve
-00007630: 686f 7374 290a 2020 2020 2020 2020 2020  host).          
-00007640: 2020 6465 6661 756c 745f 6370 756d 6f64    default_cpumod
-00007650: 656c 203d 2066 6174 6865 722e 6765 7428  el = father.get(
-00007660: 2763 7075 6d6f 6465 6c27 2c20 7365 6c66  'cpumodel', self
-00007670: 2e63 7075 6d6f 6465 6c29 0a20 2020 2020  .cpumodel).     
-00007680: 2020 2020 2020 2064 6566 6175 6c74 5f63         default_c
-00007690: 7075 666c 6167 7320 3d20 6661 7468 6572  puflags = father
-000076a0: 2e67 6574 2827 6370 7566 6c61 6773 272c  .get('cpuflags',
-000076b0: 2073 656c 662e 6370 7566 6c61 6773 290a   self.cpuflags).
-000076c0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000076d0: 756c 745f 6370 7570 696e 6e69 6e67 203d  ult_cpupinning =
-000076e0: 2066 6174 6865 722e 6765 7428 2763 7075   father.get('cpu
-000076f0: 7069 6e6e 696e 6727 2c20 7365 6c66 2e63  pinning', self.c
-00007700: 7075 7069 6e6e 696e 6729 0a20 2020 2020  pupinning).     
-00007710: 2020 2020 2020 2064 6566 6175 6c74 5f64         default_d
-00007720: 6973 6b73 697a 6520 3d20 6661 7468 6572  isksize = father
-00007730: 2e67 6574 2827 6469 736b 7369 7a65 272c  .get('disksize',
-00007740: 2073 656c 662e 6469 736b 7369 7a65 290a   self.disksize).
-00007750: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007760: 756c 745f 6469 736b 696e 7465 7266 6163  ult_diskinterfac
-00007770: 6520 3d20 6661 7468 6572 2e67 6574 2827  e = father.get('
-00007780: 6469 736b 696e 7465 7266 6163 6527 2c20  diskinterface', 
-00007790: 7365 6c66 2e64 6973 6b69 6e74 6572 6661  self.diskinterfa
-000077a0: 6365 290a 2020 2020 2020 2020 2020 2020  ce).            
-000077b0: 6465 6661 756c 745f 6469 736b 7468 696e  default_diskthin
-000077c0: 203d 2066 6174 6865 722e 6765 7428 2764   = father.get('d
-000077d0: 6973 6b74 6869 6e27 2c20 7365 6c66 2e64  iskthin', self.d
-000077e0: 6973 6b74 6869 6e29 0a20 2020 2020 2020  iskthin).       
-000077f0: 2020 2020 2064 6566 6175 6c74 5f67 7565       default_gue
-00007800: 7374 6964 203d 2066 6174 6865 722e 6765  stid = father.ge
-00007810: 7428 2767 7565 7374 6964 272c 2073 656c  t('guestid', sel
-00007820: 662e 6775 6573 7469 6429 0a20 2020 2020  f.guestid).     
-00007830: 2020 2020 2020 2064 6566 6175 6c74 5f69         default_i
-00007840: 736f 203d 2066 6174 6865 722e 6765 7428  so = father.get(
-00007850: 2769 736f 272c 2073 656c 662e 6973 6f29  'iso', self.iso)
-00007860: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00007870: 6175 6c74 5f76 6e63 203d 2066 6174 6865  ault_vnc = fathe
-00007880: 722e 6765 7428 2776 6e63 272c 2073 656c  r.get('vnc', sel
-00007890: 662e 766e 6329 0a20 2020 2020 2020 2020  f.vnc).         
-000078a0: 2020 2064 6566 6175 6c74 5f72 6573 6572     default_reser
-000078b0: 7665 6970 203d 2066 6174 6865 722e 6765  veip = father.ge
-000078c0: 7428 2772 6573 6572 7665 6970 272c 2073  t('reserveip', s
-000078d0: 656c 662e 7265 7365 7276 6569 7029 0a20  elf.reserveip). 
-000078e0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-000078f0: 6c74 5f73 7461 7274 203d 2066 6174 6865  lt_start = fathe
-00007900: 722e 6765 7428 2773 7461 7274 272c 2073  r.get('start', s
-00007910: 656c 662e 7374 6172 7429 0a20 2020 2020  elf.start).     
-00007920: 2020 2020 2020 2064 6566 6175 6c74 5f61         default_a
-00007930: 7574 6f73 7461 7274 203d 2066 6174 6865  utostart = fathe
-00007940: 722e 6765 7428 2761 7574 6f73 7461 7274  r.get('autostart
-00007950: 272c 2073 656c 662e 6175 746f 7374 6172  ', self.autostar
-00007960: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
-00007970: 6566 6175 6c74 5f6b 6579 7320 3d20 6661  efault_keys = fa
-00007980: 7468 6572 2e67 6574 2827 6b65 7973 272c  ther.get('keys',
-00007990: 2073 656c 662e 6b65 7973 290a 2020 2020   self.keys).    
-000079a0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-000079b0: 6e65 746d 6173 6b73 203d 2066 6174 6865  netmasks = fathe
-000079c0: 722e 6765 7428 276e 6574 6d61 736b 7327  r.get('netmasks'
-000079d0: 2c20 7365 6c66 2e6e 6574 6d61 736b 7329  , self.netmasks)
-000079e0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000079f0: 6175 6c74 5f67 6174 6577 6179 203d 2066  ault_gateway = f
-00007a00: 6174 6865 722e 6765 7428 2767 6174 6577  ather.get('gatew
-00007a10: 6179 272c 2073 656c 662e 6761 7465 7761  ay', self.gatewa
-00007a20: 7929 0a20 2020 2020 2020 2020 2020 2064  y).            d
-00007a30: 6566 6175 6c74 5f64 6e73 203d 2066 6174  efault_dns = fat
-00007a40: 6865 722e 6765 7428 2764 6e73 272c 2073  her.get('dns', s
-00007a50: 656c 662e 646e 7329 0a20 2020 2020 2020  elf.dns).       
-00007a60: 2020 2020 2064 6566 6175 6c74 5f64 6f6d       default_dom
-00007a70: 6169 6e20 3d20 6661 7468 6572 2e67 6574  ain = father.get
-00007a80: 2827 646f 6d61 696e 272c 2073 656c 662e  ('domain', self.
-00007a90: 646f 6d61 696e 290a 2020 2020 2020 2020  domain).        
-00007aa0: 2020 2020 6465 6661 756c 745f 6669 6c65      default_file
-00007ab0: 7320 3d20 6661 7468 6572 2e67 6574 2827  s = father.get('
-00007ac0: 6669 6c65 7327 2c20 7365 6c66 2e66 696c  files', self.fil
-00007ad0: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00007ae0: 6465 6661 756c 745f 656e 6162 6c65 726f  default_enablero
-00007af0: 6f74 203d 2066 6174 6865 722e 6765 7428  ot = father.get(
-00007b00: 2765 6e61 626c 6572 6f6f 7427 2c20 7365  'enableroot', se
-00007b10: 6c66 2e65 6e61 626c 6572 6f6f 7429 0a20  lf.enableroot). 
-00007b20: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00007b30: 6c74 5f70 7269 7661 7465 6b65 7920 3d20  lt_privatekey = 
-00007b40: 6661 7468 6572 2e67 6574 2827 7072 6976  father.get('priv
-00007b50: 6174 656b 6579 272c 2073 656c 662e 7072  atekey', self.pr
-00007b60: 6976 6174 656b 6579 290a 2020 2020 2020  ivatekey).      
-00007b70: 2020 2020 2020 6465 6661 756c 745f 6e65        default_ne
-00007b80: 7477 6f72 6b77 6169 7420 3d20 6661 7468  tworkwait = fath
-00007b90: 6572 2e67 6574 2827 6e65 7477 6f72 6b77  er.get('networkw
-00007ba0: 6169 7427 2c20 7365 6c66 2e6e 6574 776f  ait', self.netwo
-00007bb0: 726b 7761 6974 290a 2020 2020 2020 2020  rkwait).        
-00007bc0: 2020 2020 6465 6661 756c 745f 7268 6e72      default_rhnr
-00007bd0: 6567 6973 7465 7220 3d20 6661 7468 6572  egister = father
-00007be0: 2e67 6574 2827 7268 6e72 6567 6973 7465  .get('rhnregiste
-00007bf0: 7227 2c20 7365 6c66 2e72 686e 7265 6769  r', self.rhnregi
-00007c00: 7374 6572 290a 2020 2020 2020 2020 2020  ster).          
-00007c10: 2020 6465 6661 756c 745f 7268 6e73 6572    default_rhnser
-00007c20: 7665 7220 3d20 6661 7468 6572 2e67 6574  ver = father.get
-00007c30: 2827 7268 6e73 6572 7665 7227 2c20 7365  ('rhnserver', se
-00007c40: 6c66 2e72 686e 7365 7276 6572 290a 2020  lf.rhnserver).  
-00007c50: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007c60: 745f 7268 6e75 7365 7220 3d20 6661 7468  t_rhnuser = fath
-00007c70: 6572 2e67 6574 2827 7268 6e75 7365 7227  er.get('rhnuser'
-00007c80: 2c20 7365 6c66 2e72 686e 7573 6572 290a  , self.rhnuser).
-00007c90: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007ca0: 756c 745f 7268 6e70 6173 7377 6f72 6420  ult_rhnpassword 
-00007cb0: 3d20 6661 7468 6572 2e67 6574 2827 7268  = father.get('rh
-00007cc0: 6e70 6173 7377 6f72 6427 2c20 7365 6c66  npassword', self
-00007cd0: 2e72 686e 7061 7373 776f 7264 290a 2020  .rhnpassword).  
-00007ce0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007cf0: 745f 7268 6e61 6b20 3d20 6661 7468 6572  t_rhnak = father
-00007d00: 2e67 6574 2827 7268 6e61 6374 6976 6174  .get('rhnactivat
-00007d10: 696f 6e6b 6579 272c 2073 656c 662e 7268  ionkey', self.rh
-00007d20: 6e61 6b29 0a20 2020 2020 2020 2020 2020  nak).           
-00007d30: 2064 6566 6175 6c74 5f72 686e 6f72 6720   default_rhnorg 
-00007d40: 3d20 6661 7468 6572 2e67 6574 2827 7268  = father.get('rh
-00007d50: 6e6f 7267 272c 2073 656c 662e 7268 6e6f  norg', self.rhno
-00007d60: 7267 290a 2020 2020 2020 2020 2020 2020  rg).            
-00007d70: 6465 6661 756c 745f 7268 6e70 6f6f 6c20  default_rhnpool 
-00007d80: 3d20 6661 7468 6572 2e67 6574 2827 7268  = father.get('rh
-00007d90: 6e70 6f6f 6c27 2c20 7365 6c66 2e72 686e  npool', self.rhn
-00007da0: 706f 6f6c 290a 2020 2020 2020 2020 2020  pool).          
-00007db0: 2020 6465 6661 756c 745f 7461 6773 203d    default_tags =
-00007dc0: 2066 6174 6865 722e 6765 7428 2774 6167   father.get('tag
-00007dd0: 7327 2c20 7365 6c66 2e74 6167 7329 0a20  s', self.tags). 
-00007de0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00007df0: 6c74 5f66 6c61 766f 7220 3d20 6661 7468  lt_flavor = fath
-00007e00: 6572 2e67 6574 2827 666c 6176 6f72 272c  er.get('flavor',
-00007e10: 2073 656c 662e 666c 6176 6f72 290a 2020   self.flavor).  
-00007e20: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007e30: 745f 636d 6473 203d 2063 6f6d 6d6f 6e2e  t_cmds = common.
-00007e40: 7265 6d6f 7665 5f64 7570 6c69 6361 7465  remove_duplicate
-00007e50: 7328 7365 6c66 2e63 6d64 7320 2b20 6661  s(self.cmds + fa
-00007e60: 7468 6572 2e67 6574 2827 636d 6473 272c  ther.get('cmds',
-00007e70: 205b 5d29 290a 2020 2020 2020 2020 2020   [])).          
-00007e80: 2020 6465 6661 756c 745f 7363 7269 7074    default_script
-00007e90: 7320 3d20 636f 6d6d 6f6e 2e72 656d 6f76  s = common.remov
-00007ea0: 655f 6475 706c 6963 6174 6573 2873 656c  e_duplicates(sel
-00007eb0: 662e 7363 7269 7074 7320 2b20 6661 7468  f.scripts + fath
-00007ec0: 6572 2e67 6574 2827 7363 7269 7074 7327  er.get('scripts'
-00007ed0: 2c20 5b5d 2929 0a20 2020 2020 2020 2020  , [])).         
-00007ee0: 2020 2064 6566 6175 6c74 5f64 6e73 636c     default_dnscl
-00007ef0: 6965 6e74 203d 2066 6174 6865 722e 6765  ient = father.ge
-00007f00: 7428 2764 6e73 636c 6965 6e74 272c 2073  t('dnsclient', s
-00007f10: 656c 662e 646e 7363 6c69 656e 7429 0a20  elf.dnsclient). 
-00007f20: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00007f30: 6c74 5f73 746f 7265 6d65 7461 6461 7461  lt_storemetadata
-00007f40: 203d 2066 6174 6865 722e 6765 7428 2773   = father.get('s
-00007f50: 746f 7265 6d65 7461 6461 7461 272c 2073  toremetadata', s
-00007f60: 656c 662e 7374 6f72 656d 6574 6164 6174  elf.storemetadat
-00007f70: 6129 0a20 2020 2020 2020 2020 2020 2064  a).            d
-00007f80: 6566 6175 6c74 5f6e 6f74 6966 7920 3d20  efault_notify = 
-00007f90: 6661 7468 6572 2e67 6574 2827 6e6f 7469  father.get('noti
-00007fa0: 6679 272c 2073 656c 662e 6e6f 7469 6679  fy', self.notify
-00007fb0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00007fc0: 6661 756c 745f 7075 7368 6275 6c6c 6574  fault_pushbullet
-00007fd0: 746f 6b65 6e20 3d20 6661 7468 6572 2e67  token = father.g
-00007fe0: 6574 2827 7075 7368 6275 6c6c 6574 746f  et('pushbulletto
-00007ff0: 6b65 6e27 2c20 7365 6c66 2e70 7573 6862  ken', self.pushb
-00008000: 756c 6c65 7474 6f6b 656e 290a 2020 2020  ullettoken).    
-00008010: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008020: 6d61 696c 7365 7276 6572 203d 2066 6174  mailserver = fat
-00008030: 6865 722e 6765 7428 276d 6169 6c73 6572  her.get('mailser
-00008040: 7665 7227 2c20 7365 6c66 2e6d 6169 6c73  ver', self.mails
-00008050: 6572 7665 7229 0a20 2020 2020 2020 2020  erver).         
-00008060: 2020 2064 6566 6175 6c74 5f6d 6169 6c66     default_mailf
-00008070: 726f 6d20 3d20 6661 7468 6572 2e67 6574  rom = father.get
-00008080: 2827 6d61 696c 6672 6f6d 272c 2073 656c  ('mailfrom', sel
-00008090: 662e 6d61 696c 6672 6f6d 290a 2020 2020  f.mailfrom).    
-000080a0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-000080b0: 6d61 696c 746f 203d 2066 6174 6865 722e  mailto = father.
-000080c0: 6765 7428 276d 6169 6c74 6f27 2c20 7365  get('mailto', se
-000080d0: 6c66 2e6d 6169 6c74 6f29 0a20 2020 2020  lf.mailto).     
-000080e0: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
-000080f0: 6f74 6966 7963 6d64 203d 2066 6174 6865  otifycmd = fathe
-00008100: 722e 6765 7428 276e 6f74 6966 7963 6d64  r.get('notifycmd
-00008110: 272c 2073 656c 662e 6e6f 7469 6679 636d  ', self.notifycm
-00008120: 6429 0a20 2020 2020 2020 2020 2020 2064  d).            d
-00008130: 6566 6175 6c74 5f6e 6f74 6966 7973 6372  efault_notifyscr
-00008140: 6970 7420 3d20 6661 7468 6572 2e67 6574  ipt = father.get
-00008150: 2827 6e6f 7469 6679 7363 7269 7074 272c  ('notifyscript',
-00008160: 2073 656c 662e 6e6f 7469 6679 7363 7269   self.notifyscri
-00008170: 7074 290a 2020 2020 2020 2020 2020 2020  pt).            
-00008180: 6465 6661 756c 745f 6e6f 7469 6679 6d65  default_notifyme
-00008190: 7468 6f64 7320 3d20 6661 7468 6572 2e67  thods = father.g
-000081a0: 6574 2827 6e6f 7469 6679 6d65 7468 6f64  et('notifymethod
-000081b0: 7327 2c20 7365 6c66 2e6e 6f74 6966 796d  s', self.notifym
-000081c0: 6574 686f 6473 290a 2020 2020 2020 2020  ethods).        
-000081d0: 2020 2020 6465 6661 756c 745f 736c 6163      default_slac
-000081e0: 6b63 6861 6e6e 656c 203d 2066 6174 6865  kchannel = fathe
-000081f0: 722e 6765 7428 2773 6c61 636b 6368 616e  r.get('slackchan
-00008200: 6e65 6c27 2c20 7365 6c66 2e73 6c61 636b  nel', self.slack
-00008210: 6368 616e 6e65 6c29 0a20 2020 2020 2020  channel).       
-00008220: 2020 2020 2064 6566 6175 6c74 5f70 7573       default_pus
-00008230: 6862 756c 6c65 7474 6f6b 656e 203d 2066  hbullettoken = f
-00008240: 6174 6865 722e 6765 7428 2770 7573 6862  ather.get('pushb
-00008250: 756c 6c65 7474 6f6b 656e 272c 2073 656c  ullettoken', sel
-00008260: 662e 7075 7368 6275 6c6c 6574 746f 6b65  f.pushbullettoke
-00008270: 6e29 0a20 2020 2020 2020 2020 2020 2064  n).            d
-00008280: 6566 6175 6c74 5f73 6c61 636b 746f 6b65  efault_slacktoke
-00008290: 6e20 3d20 6661 7468 6572 2e67 6574 2827  n = father.get('
-000082a0: 736c 6163 6b74 6f6b 656e 272c 2073 656c  slacktoken', sel
-000082b0: 662e 736c 6163 6b74 6f6b 656e 290a 2020  f.slacktoken).  
-000082c0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000082d0: 745f 7368 6172 6564 666f 6c64 6572 7320  t_sharedfolders 
-000082e0: 3d20 6661 7468 6572 2e67 6574 2827 7368  = father.get('sh
-000082f0: 6172 6564 666f 6c64 6572 7327 2c20 7365  aredfolders', se
-00008300: 6c66 2e73 6861 7265 6466 6f6c 6465 7273  lf.sharedfolders
-00008310: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00008320: 6661 756c 745f 6b65 726e 656c 203d 2066  fault_kernel = f
-00008330: 6174 6865 722e 6765 7428 276b 6572 6e65  ather.get('kerne
-00008340: 6c27 2c20 7365 6c66 2e6b 6572 6e65 6c29  l', self.kernel)
-00008350: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008360: 6175 6c74 5f69 6e69 7472 6420 3d20 6661  ault_initrd = fa
-00008370: 7468 6572 2e67 6574 2827 696e 6974 7264  ther.get('initrd
-00008380: 272c 2073 656c 662e 696e 6974 7264 290a  ', self.initrd).
-00008390: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000083a0: 756c 745f 636d 646c 696e 6520 3d20 6661  ult_cmdline = fa
-000083b0: 7468 6572 2e67 6574 2827 636d 646c 696e  ther.get('cmdlin
-000083c0: 6527 2c20 7365 6c66 2e63 6d64 6c69 6e65  e', self.cmdline
-000083d0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-000083e0: 6661 756c 745f 706c 6163 656d 656e 7420  fault_placement 
-000083f0: 3d20 6661 7468 6572 2e67 6574 2827 706c  = father.get('pl
-00008400: 6163 656d 656e 7427 2c20 7365 6c66 2e70  acement', self.p
-00008410: 6c61 6365 6d65 6e74 290a 2020 2020 2020  lacement).      
-00008420: 2020 2020 2020 6465 6661 756c 745f 7961        default_ya
-00008430: 6d6c 696e 7665 6e74 6f72 7920 3d20 6661  mlinventory = fa
-00008440: 7468 6572 2e67 6574 2827 7961 6d6c 696e  ther.get('yamlin
-00008450: 7665 6e74 6f72 7927 2c20 7365 6c66 2e79  ventory', self.y
-00008460: 616d 6c69 6e76 656e 746f 7279 290a 2020  amlinventory).  
-00008470: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00008480: 745f 6370 7568 6f74 706c 7567 203d 2066  t_cpuhotplug = f
-00008490: 6174 6865 722e 6765 7428 2763 7075 686f  ather.get('cpuho
-000084a0: 7470 6c75 6727 2c20 7365 6c66 2e63 7075  tplug', self.cpu
-000084b0: 686f 7470 6c75 6729 0a20 2020 2020 2020  hotplug).       
-000084c0: 2020 2020 2064 6566 6175 6c74 5f6d 656d       default_mem
-000084d0: 6f72 7968 6f74 706c 7567 203d 2066 6174  oryhotplug = fat
-000084e0: 6865 722e 6765 7428 276d 656d 6f72 7968  her.get('memoryh
-000084f0: 6f74 706c 7567 272c 2073 656c 662e 6d65  otplug', self.me
-00008500: 6d6f 7279 686f 7470 6c75 6729 0a20 2020  moryhotplug).   
-00008510: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008520: 5f6e 756d 6120 3d20 6661 7468 6572 2e67  _numa = father.g
-00008530: 6574 2827 6e75 6d61 272c 2073 656c 662e  et('numa', self.
-00008540: 6e75 6d61 290a 2020 2020 2020 2020 2020  numa).          
-00008550: 2020 6465 6661 756c 745f 6e75 6d61 6d6f    default_numamo
-00008560: 6465 203d 2066 6174 6865 722e 6765 7428  de = father.get(
-00008570: 276e 756d 616d 6f64 6527 2c20 7365 6c66  'numamode', self
-00008580: 2e6e 756d 616d 6f64 6529 0a20 2020 2020  .numamode).     
-00008590: 2020 2020 2020 2064 6566 6175 6c74 5f70         default_p
-000085a0: 6369 6465 7669 6365 7320 3d20 6661 7468  cidevices = fath
-000085b0: 6572 2e67 6574 2827 7063 6964 6576 6963  er.get('pcidevic
-000085c0: 6573 272c 2073 656c 662e 7063 6964 6576  es', self.pcidev
-000085d0: 6963 6573 290a 2020 2020 2020 2020 2020  ices).          
-000085e0: 2020 6465 6661 756c 745f 7470 6d20 3d20    default_tpm = 
-000085f0: 6661 7468 6572 2e67 6574 2827 7470 6d27  father.get('tpm'
-00008600: 2c20 7365 6c66 2e74 706d 290a 2020 2020  , self.tpm).    
-00008610: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008620: 726e 6720 3d20 6661 7468 6572 2e67 6574  rng = father.get
-00008630: 2827 726e 6727 2c20 7365 6c66 2e72 6e67  ('rng', self.rng
-00008640: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00008650: 6661 756c 745f 7669 7274 7479 7065 203d  fault_virttype =
-00008660: 2066 6174 6865 722e 6765 7428 2776 6972   father.get('vir
-00008670: 7474 7970 6527 2c20 7365 6c66 2e76 6972  ttype', self.vir
-00008680: 7474 7970 6529 0a20 2020 2020 2020 2020  ttype).         
-00008690: 2020 2064 6566 6175 6c74 5f73 6563 7572     default_secur
-000086a0: 6974 7967 726f 7570 7320 3d20 6661 7468  itygroups = fath
-000086b0: 6572 2e67 6574 2827 7365 6375 7269 7479  er.get('security
-000086c0: 6772 6f75 7073 272c 2073 656c 662e 7365  groups', self.se
-000086d0: 6375 7269 7479 6772 6f75 7073 290a 2020  curitygroups).  
-000086e0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000086f0: 745f 726f 6f74 7061 7373 776f 7264 203d  t_rootpassword =
-00008700: 2066 6174 6865 722e 6765 7428 2772 6f6f   father.get('roo
-00008710: 7470 6173 7377 6f72 6427 2c20 7365 6c66  tpassword', self
-00008720: 2e72 6f6f 7470 6173 7377 6f72 6429 0a20  .rootpassword). 
-00008730: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008740: 6c74 5f74 656d 706b 6579 203d 2066 6174  lt_tempkey = fat
-00008750: 6865 722e 6765 7428 2774 656d 706b 6579  her.get('tempkey
-00008760: 272c 2073 656c 662e 7465 6d70 6b65 7929  ', self.tempkey)
-00008770: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008780: 6175 6c74 5f76 6d75 7365 7220 3d20 6661  ault_vmuser = fa
-00008790: 7468 6572 2e67 6574 2827 766d 7573 6572  ther.get('vmuser
-000087a0: 272c 2073 656c 662e 766d 7573 6572 290a  ', self.vmuser).
-000087b0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000087c0: 756c 745f 7761 6974 203d 2066 6174 6865  ult_wait = fathe
-000087d0: 722e 6765 7428 2777 6169 7427 2c20 7365  r.get('wait', se
-000087e0: 6c66 2e77 6169 7429 0a20 2020 2020 2020  lf.wait).       
-000087f0: 2020 2020 2064 6566 6175 6c74 5f77 6169       default_wai
-00008800: 7463 6f6d 6d61 6e64 203d 2066 6174 6865  tcommand = fathe
-00008810: 722e 6765 7428 2777 6169 7463 6f6d 6d61  r.get('waitcomma
-00008820: 6e64 272c 2073 656c 662e 7761 6974 636f  nd', self.waitco
-00008830: 6d6d 616e 6429 0a20 2020 2020 2020 2020  mmand).         
-00008840: 2020 2064 6566 6175 6c74 5f77 6169 7474     default_waitt
-00008850: 696d 656f 7574 203d 2066 6174 6865 722e  imeout = father.
-00008860: 6765 7428 2777 6169 7474 696d 656f 7574  get('waittimeout
-00008870: 272c 2073 656c 662e 7761 6974 7469 6d65  ', self.waittime
-00008880: 6f75 7429 0a20 2020 2020 2020 2065 6c73  out).        els
-00008890: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
-000088a0: 6566 6175 6c74 5f6e 756d 6370 7573 203d  efault_numcpus =
-000088b0: 2073 656c 662e 6e75 6d63 7075 730a 2020   self.numcpus.  
-000088c0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000088d0: 745f 6d65 6d6f 7279 203d 2073 656c 662e  t_memory = self.
-000088e0: 6d65 6d6f 7279 0a20 2020 2020 2020 2020  memory.         
-000088f0: 2020 2064 6566 6175 6c74 5f70 6f6f 6c20     default_pool 
-00008900: 3d20 7365 6c66 2e70 6f6f 6c0a 2020 2020  = self.pool.    
-00008910: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008920: 6469 736b 7320 3d20 7365 6c66 2e64 6973  disks = self.dis
-00008930: 6b73 0a20 2020 2020 2020 2020 2020 2064  ks.            d
-00008940: 6566 6175 6c74 5f6e 6574 7320 3d20 7365  efault_nets = se
-00008950: 6c66 2e6e 6574 730a 2020 2020 2020 2020  lf.nets.        
-00008960: 2020 2020 6465 6661 756c 745f 696d 6167      default_imag
-00008970: 6520 3d20 7365 6c66 2e69 6d61 6765 0a20  e = self.image. 
-00008980: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008990: 6c74 5f63 6c6f 7564 696e 6974 203d 2073  lt_cloudinit = s
-000089a0: 656c 662e 636c 6f75 6469 6e69 740a 2020  elf.cloudinit.  
-000089b0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000089c0: 745f 6e65 7374 6564 203d 2073 656c 662e  t_nested = self.
-000089d0: 6e65 7374 6564 0a20 2020 2020 2020 2020  nested.         
-000089e0: 2020 2064 6566 6175 6c74 5f72 6573 6572     default_reser
-000089f0: 7665 646e 7320 3d20 7365 6c66 2e72 6573  vedns = self.res
-00008a00: 6572 7665 646e 730a 2020 2020 2020 2020  ervedns.        
-00008a10: 2020 2020 6465 6661 756c 745f 7265 7365      default_rese
-00008a20: 7276 6568 6f73 7420 3d20 7365 6c66 2e72  rvehost = self.r
-00008a30: 6573 6572 7665 686f 7374 0a20 2020 2020  eservehost.     
-00008a40: 2020 2020 2020 2064 6566 6175 6c74 5f63         default_c
-00008a50: 7075 6d6f 6465 6c20 3d20 7365 6c66 2e63  pumodel = self.c
-00008a60: 7075 6d6f 6465 6c0a 2020 2020 2020 2020  pumodel.        
-00008a70: 2020 2020 6465 6661 756c 745f 6370 7566      default_cpuf
-00008a80: 6c61 6773 203d 2073 656c 662e 6370 7566  lags = self.cpuf
-00008a90: 6c61 6773 0a20 2020 2020 2020 2020 2020  lags.           
-00008aa0: 2064 6566 6175 6c74 5f63 7075 7069 6e6e   default_cpupinn
-00008ab0: 696e 6720 3d20 7365 6c66 2e63 7075 7069  ing = self.cpupi
-00008ac0: 6e6e 696e 670a 2020 2020 2020 2020 2020  nning.          
-00008ad0: 2020 6465 6661 756c 745f 6e75 6d61 6d6f    default_numamo
-00008ae0: 6465 203d 2073 656c 662e 6e75 6d61 6d6f  de = self.numamo
-00008af0: 6465 0a20 2020 2020 2020 2020 2020 2064  de.            d
-00008b00: 6566 6175 6c74 5f6e 756d 6120 3d20 7365  efault_numa = se
-00008b10: 6c66 2e6e 756d 610a 2020 2020 2020 2020  lf.numa.        
-00008b20: 2020 2020 6465 6661 756c 745f 7063 6964      default_pcid
-00008b30: 6576 6963 6573 203d 2073 656c 662e 7063  evices = self.pc
-00008b40: 6964 6576 6963 6573 0a20 2020 2020 2020  idevices.       
-00008b50: 2020 2020 2064 6566 6175 6c74 5f74 706d       default_tpm
-00008b60: 203d 2073 656c 662e 7470 6d0a 2020 2020   = self.tpm.    
-00008b70: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008b80: 726e 6720 3d20 7365 6c66 2e72 6e67 0a20  rng = self.rng. 
-00008b90: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008ba0: 6c74 5f64 6973 6b73 697a 6520 3d20 7365  lt_disksize = se
-00008bb0: 6c66 2e64 6973 6b73 697a 650a 2020 2020  lf.disksize.    
-00008bc0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008bd0: 6469 736b 696e 7465 7266 6163 6520 3d20  diskinterface = 
-00008be0: 7365 6c66 2e64 6973 6b69 6e74 6572 6661  self.diskinterfa
-00008bf0: 6365 0a20 2020 2020 2020 2020 2020 2064  ce.            d
-00008c00: 6566 6175 6c74 5f64 6973 6b74 6869 6e20  efault_diskthin 
-00008c10: 3d20 7365 6c66 2e64 6973 6b74 6869 6e0a  = self.diskthin.
-00008c20: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00008c30: 756c 745f 6775 6573 7469 6420 3d20 7365  ult_guestid = se
-00008c40: 6c66 2e67 7565 7374 6964 0a20 2020 2020  lf.guestid.     
-00008c50: 2020 2020 2020 2064 6566 6175 6c74 5f69         default_i
-00008c60: 736f 203d 2073 656c 662e 6973 6f0a 2020  so = self.iso.  
-00008c70: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00008c80: 745f 766e 6320 3d20 7365 6c66 2e76 6e63  t_vnc = self.vnc
-00008c90: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008ca0: 6175 6c74 5f72 6573 6572 7665 6970 203d  ault_reserveip =
-00008cb0: 2073 656c 662e 7265 7365 7276 6569 700a   self.reserveip.
-00008cc0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00008cd0: 756c 745f 7374 6172 7420 3d20 7365 6c66  ult_start = self
-00008ce0: 2e73 7461 7274 0a20 2020 2020 2020 2020  .start.         
-00008cf0: 2020 2064 6566 6175 6c74 5f61 7574 6f73     default_autos
-00008d00: 7461 7274 203d 2073 656c 662e 6175 746f  tart = self.auto
-00008d10: 7374 6172 740a 2020 2020 2020 2020 2020  start.          
-00008d20: 2020 6465 6661 756c 745f 6b65 7973 203d    default_keys =
-00008d30: 2073 656c 662e 6b65 7973 0a20 2020 2020   self.keys.     
-00008d40: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
-00008d50: 6574 6d61 736b 7320 3d20 7365 6c66 2e6e  etmasks = self.n
-00008d60: 6574 6d61 736b 730a 2020 2020 2020 2020  etmasks.        
-00008d70: 2020 2020 6465 6661 756c 745f 6761 7465      default_gate
-00008d80: 7761 7920 3d20 7365 6c66 2e67 6174 6577  way = self.gatew
-00008d90: 6179 0a20 2020 2020 2020 2020 2020 2064  ay.            d
-00008da0: 6566 6175 6c74 5f64 6e73 203d 2073 656c  efault_dns = sel
-00008db0: 662e 646e 730a 2020 2020 2020 2020 2020  f.dns.          
-00008dc0: 2020 6465 6661 756c 745f 646f 6d61 696e    default_domain
-00008dd0: 203d 2073 656c 662e 646f 6d61 696e 0a20   = self.domain. 
-00008de0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008df0: 6c74 5f66 696c 6573 203d 2073 656c 662e  lt_files = self.
-00008e00: 6669 6c65 730a 2020 2020 2020 2020 2020  files.          
-00008e10: 2020 6465 6661 756c 745f 656e 6162 6c65    default_enable
-00008e20: 726f 6f74 203d 2073 656c 662e 656e 6162  root = self.enab
-00008e30: 6c65 726f 6f74 0a20 2020 2020 2020 2020  leroot.         
-00008e40: 2020 2064 6566 6175 6c74 5f74 6167 7320     default_tags 
-00008e50: 3d20 7365 6c66 2e74 6167 730a 2020 2020  = self.tags.    
-00008e60: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008e70: 666c 6176 6f72 203d 2073 656c 662e 666c  flavor = self.fl
-00008e80: 6176 6f72 0a20 2020 2020 2020 2020 2020  avor.           
-00008e90: 2064 6566 6175 6c74 5f70 7269 7661 7465   default_private
-00008ea0: 6b65 7920 3d20 7365 6c66 2e70 7269 7661  key = self.priva
-00008eb0: 7465 6b65 790a 2020 2020 2020 2020 2020  tekey.          
-00008ec0: 2020 6465 6661 756c 745f 6e65 7477 6f72    default_networ
-00008ed0: 6b77 6169 7420 3d20 7365 6c66 2e6e 6574  kwait = self.net
-00008ee0: 776f 726b 7761 6974 0a20 2020 2020 2020  workwait.       
-00008ef0: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
-00008f00: 7265 6769 7374 6572 203d 2073 656c 662e  register = self.
-00008f10: 7268 6e72 6567 6973 7465 720a 2020 2020  rhnregister.    
-00008f20: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008f30: 7268 6e73 6572 7665 7220 3d20 7365 6c66  rhnserver = self
-00008f40: 2e72 686e 7365 7276 6572 0a20 2020 2020  .rhnserver.     
-00008f50: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
-00008f60: 686e 7573 6572 203d 2073 656c 662e 7268  hnuser = self.rh
-00008f70: 6e75 7365 720a 2020 2020 2020 2020 2020  nuser.          
-00008f80: 2020 6465 6661 756c 745f 7268 6e70 6173    default_rhnpas
-00008f90: 7377 6f72 6420 3d20 7365 6c66 2e72 686e  sword = self.rhn
-00008fa0: 7061 7373 776f 7264 0a20 2020 2020 2020  password.       
-00008fb0: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
-00008fc0: 616b 203d 2073 656c 662e 7268 6e61 6b0a  ak = self.rhnak.
-00008fd0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00008fe0: 756c 745f 7268 6e6f 7267 203d 2073 656c  ult_rhnorg = sel
-00008ff0: 662e 7268 6e6f 7267 0a20 2020 2020 2020  f.rhnorg.       
-00009000: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
-00009010: 706f 6f6c 203d 2073 656c 662e 7268 6e70  pool = self.rhnp
-00009020: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-00009030: 6465 6661 756c 745f 636d 6473 203d 2073  default_cmds = s
-00009040: 656c 662e 636d 6473 0a20 2020 2020 2020  elf.cmds.       
-00009050: 2020 2020 2064 6566 6175 6c74 5f73 6372       default_scr
-00009060: 6970 7473 203d 2073 656c 662e 7363 7269  ipts = self.scri
-00009070: 7074 730a 2020 2020 2020 2020 2020 2020  pts.            
-00009080: 6465 6661 756c 745f 646e 7363 6c69 656e  default_dnsclien
-00009090: 7420 3d20 7365 6c66 2e64 6e73 636c 6965  t = self.dnsclie
-000090a0: 6e74 0a20 2020 2020 2020 2020 2020 2064  nt.            d
-000090b0: 6566 6175 6c74 5f73 746f 7265 6d65 7461  efault_storemeta
-000090c0: 6461 7461 203d 2073 656c 662e 7374 6f72  data = self.stor
-000090d0: 656d 6574 6164 6174 610a 2020 2020 2020  emetadata.      
-000090e0: 2020 2020 2020 6465 6661 756c 745f 6e6f        default_no
-000090f0: 7469 6679 203d 2073 656c 662e 6e6f 7469  tify = self.noti
-00009100: 6679 0a20 2020 2020 2020 2020 2020 2064  fy.            d
-00009110: 6566 6175 6c74 5f70 7573 6862 756c 6c65  efault_pushbulle
-00009120: 7474 6f6b 656e 203d 2073 656c 662e 7075  ttoken = self.pu
-00009130: 7368 6275 6c6c 6574 746f 6b65 6e0a 2020  shbullettoken.  
-00009140: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00009150: 745f 736c 6163 6b74 6f6b 656e 203d 2073  t_slacktoken = s
-00009160: 656c 662e 736c 6163 6b74 6f6b 656e 0a20  elf.slacktoken. 
-00009170: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009180: 6c74 5f6d 6169 6c73 6572 7665 7220 3d20  lt_mailserver = 
-00009190: 7365 6c66 2e6d 6169 6c73 6572 7665 720a  self.mailserver.
-000091a0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000091b0: 756c 745f 6d61 696c 6672 6f6d 203d 2073  ult_mailfrom = s
-000091c0: 656c 662e 6d61 696c 6672 6f6d 0a20 2020  elf.mailfrom.   
-000091d0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000091e0: 5f6d 6169 6c74 6f20 3d20 7365 6c66 2e6d  _mailto = self.m
-000091f0: 6169 6c74 6f0a 2020 2020 2020 2020 2020  ailto.          
-00009200: 2020 6465 6661 756c 745f 6e6f 7469 6679    default_notify
-00009210: 636d 6420 3d20 7365 6c66 2e6e 6f74 6966  cmd = self.notif
-00009220: 7963 6d64 0a20 2020 2020 2020 2020 2020  ycmd.           
-00009230: 2064 6566 6175 6c74 5f6e 6f74 6966 7973   default_notifys
-00009240: 6372 6970 7420 3d20 7365 6c66 2e6e 6f74  cript = self.not
-00009250: 6966 7973 6372 6970 740a 2020 2020 2020  ifyscript.      
-00009260: 2020 2020 2020 6465 6661 756c 745f 6e6f        default_no
-00009270: 7469 6679 6d65 7468 6f64 7320 3d20 7365  tifymethods = se
-00009280: 6c66 2e6e 6f74 6966 796d 6574 686f 6473  lf.notifymethods
-00009290: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000092a0: 6175 6c74 5f73 6c61 636b 6368 616e 6e65  ault_slackchanne
-000092b0: 6c20 3d20 7365 6c66 2e73 6c61 636b 6368  l = self.slackch
-000092c0: 616e 6e65 6c0a 2020 2020 2020 2020 2020  annel.          
-000092d0: 2020 6465 6661 756c 745f 7368 6172 6564    default_shared
-000092e0: 666f 6c64 6572 7320 3d20 7365 6c66 2e73  folders = self.s
-000092f0: 6861 7265 6466 6f6c 6465 7273 0a20 2020  haredfolders.   
-00009300: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00009310: 5f6b 6572 6e65 6c20 3d20 7365 6c66 2e6b  _kernel = self.k
-00009320: 6572 6e65 6c0a 2020 2020 2020 2020 2020  ernel.          
-00009330: 2020 6465 6661 756c 745f 696e 6974 7264    default_initrd
-00009340: 203d 2073 656c 662e 696e 6974 7264 0a20   = self.initrd. 
-00009350: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009360: 6c74 5f63 6d64 6c69 6e65 203d 2073 656c  lt_cmdline = sel
-00009370: 662e 636d 646c 696e 650a 2020 2020 2020  f.cmdline.      
-00009380: 2020 2020 2020 6465 6661 756c 745f 706c        default_pl
-00009390: 6163 656d 656e 7420 3d20 7365 6c66 2e70  acement = self.p
-000093a0: 6c61 6365 6d65 6e74 0a20 2020 2020 2020  lacement.       
-000093b0: 2020 2020 2064 6566 6175 6c74 5f79 616d       default_yam
-000093c0: 6c69 6e76 656e 746f 7279 203d 2073 656c  linventory = sel
-000093d0: 662e 7961 6d6c 696e 7665 6e74 6f72 790a  f.yamlinventory.
-000093e0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000093f0: 756c 745f 6370 7568 6f74 706c 7567 203d  ult_cpuhotplug =
-00009400: 2073 656c 662e 6370 7568 6f74 706c 7567   self.cpuhotplug
-00009410: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00009420: 6175 6c74 5f6d 656d 6f72 7968 6f74 706c  ault_memoryhotpl
-00009430: 7567 203d 2073 656c 662e 6d65 6d6f 7279  ug = self.memory
-00009440: 686f 7470 6c75 670a 2020 2020 2020 2020  hotplug.        
-00009450: 2020 2020 6465 6661 756c 745f 7669 7274      default_virt
-00009460: 7479 7065 203d 2073 656c 662e 7669 7274  type = self.virt
-00009470: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
-00009480: 2064 6566 6175 6c74 5f73 6563 7572 6974   default_securit
-00009490: 7967 726f 7570 7320 3d20 7365 6c66 2e73  ygroups = self.s
-000094a0: 6563 7572 6974 7967 726f 7570 730a 2020  ecuritygroups.  
-000094b0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000094c0: 745f 726f 6f74 7061 7373 776f 7264 203d  t_rootpassword =
-000094d0: 2073 656c 662e 726f 6f74 7061 7373 776f   self.rootpasswo
-000094e0: 7264 0a20 2020 2020 2020 2020 2020 2064  rd.            d
-000094f0: 6566 6175 6c74 5f74 656d 706b 6579 203d  efault_tempkey =
-00009500: 2073 656c 662e 7465 6d70 6b65 790a 2020   self.tempkey.  
-00009510: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00009520: 745f 766d 7573 6572 203d 2073 656c 662e  t_vmuser = self.
-00009530: 766d 7573 6572 0a20 2020 2020 2020 2020  vmuser.         
-00009540: 2020 2064 6566 6175 6c74 5f77 6169 7420     default_wait 
-00009550: 3d20 7365 6c66 2e77 6169 740a 2020 2020  = self.wait.    
-00009560: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00009570: 7761 6974 636f 6d6d 616e 6420 3d20 7365  waitcommand = se
-00009580: 6c66 2e77 6169 7463 6f6d 6d61 6e64 0a20  lf.waitcommand. 
-00009590: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-000095a0: 6c74 5f77 6169 7474 696d 656f 7574 203d  lt_waittimeout =
-000095b0: 2073 656c 662e 7761 6974 7469 6d65 6f75   self.waittimeou
-000095c0: 740a 2020 2020 2020 2020 706c 616e 203d  t.        plan =
-000095d0: 2070 726f 6669 6c65 2e67 6574 2827 706c   profile.get('pl
-000095e0: 616e 272c 2070 6c61 6e29 0a20 2020 2020  an', plan).     
-000095f0: 2020 2074 656d 706c 6174 6520 3d20 7072     template = pr
-00009600: 6f66 696c 652e 6765 7428 2774 656d 706c  ofile.get('templ
-00009610: 6174 6527 2c20 6465 6661 756c 745f 696d  ate', default_im
-00009620: 6167 6529 0a20 2020 2020 2020 2069 6d61  age).        ima
-00009630: 6765 203d 2070 726f 6669 6c65 2e67 6574  ge = profile.get
-00009640: 2827 696d 6167 6527 2c20 7465 6d70 6c61  ('image', templa
-00009650: 7465 290a 2020 2020 2020 2020 6e65 7473  te).        nets
-00009660: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-00009670: 6e65 7473 272c 2064 6566 6175 6c74 5f6e  nets', default_n
-00009680: 6574 7329 0a20 2020 2020 2020 2063 7075  ets).        cpu
-00009690: 6d6f 6465 6c20 3d20 7072 6f66 696c 652e  model = profile.
-000096a0: 6765 7428 2763 7075 6d6f 6465 6c27 2c20  get('cpumodel', 
-000096b0: 6465 6661 756c 745f 6370 756d 6f64 656c  default_cpumodel
-000096c0: 290a 2020 2020 2020 2020 6370 7566 6c61  ).        cpufla
-000096d0: 6773 203d 2070 726f 6669 6c65 2e67 6574  gs = profile.get
-000096e0: 2827 6370 7566 6c61 6773 272c 2064 6566  ('cpuflags', def
-000096f0: 6175 6c74 5f63 7075 666c 6167 7329 0a20  ault_cpuflags). 
-00009700: 2020 2020 2020 2063 7075 7069 6e6e 696e         cpupinnin
-00009710: 6720 3d20 7072 6f66 696c 652e 6765 7428  g = profile.get(
-00009720: 2763 7075 7069 6e6e 696e 6727 2c20 6465  'cpupinning', de
-00009730: 6661 756c 745f 6370 7570 696e 6e69 6e67  fault_cpupinning
-00009740: 290a 2020 2020 2020 2020 6e75 6d61 6d6f  ).        numamo
-00009750: 6465 203d 2070 726f 6669 6c65 2e67 6574  de = profile.get
-00009760: 2827 6e75 6d61 6d6f 6465 272c 2064 6566  ('numamode', def
-00009770: 6175 6c74 5f6e 756d 616d 6f64 6529 0a20  ault_numamode). 
-00009780: 2020 2020 2020 206e 756d 6120 3d20 7072         numa = pr
-00009790: 6f66 696c 652e 6765 7428 276e 756d 6127  ofile.get('numa'
-000097a0: 2c20 6465 6661 756c 745f 6e75 6d61 290a  , default_numa).
-000097b0: 2020 2020 2020 2020 7063 6964 6576 6963          pcidevic
-000097c0: 6573 203d 2070 726f 6669 6c65 2e67 6574  es = profile.get
-000097d0: 2827 7063 6964 6576 6963 6573 272c 2064  ('pcidevices', d
-000097e0: 6566 6175 6c74 5f70 6369 6465 7669 6365  efault_pcidevice
-000097f0: 7329 0a20 2020 2020 2020 2074 706d 203d  s).        tpm =
-00009800: 2070 726f 6669 6c65 2e67 6574 2827 7470   profile.get('tp
-00009810: 6d27 2c20 6465 6661 756c 745f 7470 6d29  m', default_tpm)
-00009820: 0a20 2020 2020 2020 2072 6e67 203d 2070  .        rng = p
-00009830: 726f 6669 6c65 2e67 6574 2827 726e 6727  rofile.get('rng'
-00009840: 2c20 6465 6661 756c 745f 726e 6729 0a20  , default_rng). 
-00009850: 2020 2020 2020 2073 6563 7572 6974 7967         securityg
-00009860: 726f 7570 7320 3d20 7072 6f66 696c 652e  roups = profile.
-00009870: 6765 7428 2773 6563 7572 6974 7967 726f  get('securitygro
-00009880: 7570 7327 2c20 6465 6661 756c 745f 7365  ups', default_se
-00009890: 6375 7269 7479 6772 6f75 7073 290a 2020  curitygroups).  
-000098a0: 2020 2020 2020 6e75 6d63 7075 7320 3d20        numcpus = 
-000098b0: 7072 6f66 696c 652e 6765 7428 276e 756d  profile.get('num
-000098c0: 6370 7573 272c 2064 6566 6175 6c74 5f6e  cpus', default_n
-000098d0: 756d 6370 7573 290a 2020 2020 2020 2020  umcpus).        
-000098e0: 6d65 6d6f 7279 203d 2070 726f 6669 6c65  memory = profile
-000098f0: 2e67 6574 2827 6d65 6d6f 7279 272c 2064  .get('memory', d
-00009900: 6566 6175 6c74 5f6d 656d 6f72 7929 0a20  efault_memory). 
-00009910: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00009920: 616e 6365 286d 656d 6f72 792c 2073 7472  ance(memory, str
-00009930: 2920 616e 6420 286d 656d 6f72 792e 6c6f  ) and (memory.lo
-00009940: 7765 7228 292e 656e 6473 7769 7468 2827  wer().endswith('
-00009950: 6762 2729 206f 7220 6d65 6d6f 7279 2e6c  gb') or memory.l
-00009960: 6f77 6572 2829 2e65 6e64 7377 6974 6828  ower().endswith(
-00009970: 2767 2729 293a 0a20 2020 2020 2020 2020  'g')):.         
-00009980: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00009990: 2020 2020 2020 2020 6d65 6d6f 7279 203d          memory =
-000099a0: 2069 6e74 286d 656d 6f72 792e 6c6f 7765   int(memory.lowe
-000099b0: 7228 2767 6227 2c20 2727 292e 7265 706c  r('gb', '').repl
-000099c0: 6163 6528 2767 272c 2027 2729 2920 2a20  ace('g', '')) * 
-000099d0: 3130 3234 0a20 2020 2020 2020 2020 2020  1024.           
-000099e0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000099f0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00009a00: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-00009a10: 436f 756c 646e 7420 636f 6e76 6572 7420  Couldnt convert 
-00009a20: 6d65 6d6f 7279 2e20 4869 7420 7b65 7d22  memory. Hit {e}"
-00009a30: 290a 2020 2020 2020 2020 706f 6f6c 203d  ).        pool =
-00009a40: 2070 726f 6669 6c65 2e67 6574 2827 706f   profile.get('po
-00009a50: 6f6c 272c 2064 6566 6175 6c74 5f70 6f6f  ol', default_poo
-00009a60: 6c29 0a20 2020 2020 2020 2064 6973 6b73  l).        disks
-00009a70: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-00009a80: 6469 736b 7327 2c20 6465 6661 756c 745f  disks', default_
-00009a90: 6469 736b 7329 0a20 2020 2020 2020 2064  disks).        d
-00009aa0: 6973 6b73 697a 6520 3d20 7072 6f66 696c  isksize = profil
-00009ab0: 652e 6765 7428 2764 6973 6b73 697a 6527  e.get('disksize'
-00009ac0: 2c20 6465 6661 756c 745f 6469 736b 7369  , default_disksi
-00009ad0: 7a65 290a 2020 2020 2020 2020 6469 736b  ze).        disk
-00009ae0: 696e 7465 7266 6163 6520 3d20 7072 6f66  interface = prof
-00009af0: 696c 652e 6765 7428 2764 6973 6b69 6e74  ile.get('diskint
-00009b00: 6572 6661 6365 272c 2064 6566 6175 6c74  erface', default
-00009b10: 5f64 6973 6b69 6e74 6572 6661 6365 290a  _diskinterface).
-00009b20: 2020 2020 2020 2020 6469 736b 7468 696e          diskthin
-00009b30: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-00009b40: 6469 736b 7468 696e 272c 2064 6566 6175  diskthin', defau
-00009b50: 6c74 5f64 6973 6b74 6869 6e29 0a20 2020  lt_diskthin).   
-00009b60: 2020 2020 2069 6620 6469 736b 7320 616e       if disks an
-00009b70: 6420 6973 696e 7374 616e 6365 2864 6973  d isinstance(dis
-00009b80: 6b73 2c20 6469 6374 2920 616e 6420 2764  ks, dict) and 'd
-00009b90: 6566 6175 6c74 2720 696e 2064 6973 6b73  efault' in disks
-00009ba0: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
-00009bb0: 2064 6973 6b73 203d 205b 7b27 7369 7a65   disks = [{'size
-00009bc0: 273a 2064 6973 6b73 697a 652c 2027 696e  ': disksize, 'in
-00009bd0: 7465 7266 6163 6527 3a20 6469 736b 696e  terface': diskin
-00009be0: 7465 7266 6163 652c 2027 7468 696e 273a  terface, 'thin':
-00009bf0: 2064 6973 6b74 6869 6e7d 5d0a 2020 2020   diskthin}].    
-00009c00: 2020 2020 6775 6573 7469 6420 3d20 7072      guestid = pr
-00009c10: 6f66 696c 652e 6765 7428 2767 7565 7374  ofile.get('guest
-00009c20: 6964 272c 2064 6566 6175 6c74 5f67 7565  id', default_gue
-00009c30: 7374 6964 290a 2020 2020 2020 2020 6973  stid).        is
-00009c40: 6f20 3d20 7072 6f66 696c 652e 6765 7428  o = profile.get(
-00009c50: 2769 736f 272c 2064 6566 6175 6c74 5f69  'iso', default_i
-00009c60: 736f 290a 2020 2020 2020 2020 766e 6320  so).        vnc 
-00009c70: 3d20 7072 6f66 696c 652e 6765 7428 2776  = profile.get('v
-00009c80: 6e63 272c 2064 6566 6175 6c74 5f76 6e63  nc', default_vnc
-00009c90: 290a 2020 2020 2020 2020 636c 6f75 6469  ).        cloudi
-00009ca0: 6e69 7420 3d20 7072 6f66 696c 652e 6765  nit = profile.ge
-00009cb0: 7428 2763 6c6f 7564 696e 6974 272c 2064  t('cloudinit', d
-00009cc0: 6566 6175 6c74 5f63 6c6f 7564 696e 6974  efault_cloudinit
-00009cd0: 290a 2020 2020 2020 2020 6966 2063 6c6f  ).        if clo
-00009ce0: 7564 696e 6974 2061 6e64 2073 656c 662e  udinit and self.
-00009cf0: 7479 7065 203d 3d20 276b 766d 2720 616e  type == 'kvm' an
-00009d00: 645c 0a20 2020 2020 2020 2020 2020 2020  d\.             
-00009d10: 2020 2077 6869 6368 2827 6d6b 6973 6f66     which('mkisof
-00009d20: 7327 2920 6973 204e 6f6e 6520 616e 6420  s') is None and 
-00009d30: 7768 6963 6828 2767 656e 6973 6f69 6d61  which('genisoima
-00009d40: 6765 2729 2061 6e64 2077 6869 6368 2827  ge') and which('
-00009d50: 786f 7272 6973 6f66 7327 2920 6973 204e  xorrisofs') is N
-00009d60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00009d70: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00009d80: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-00009d90: 6561 736f 6e27 3a20 224d 6973 7369 6e67  eason': "Missing
-00009da0: 206d 6b69 736f 6673 2f67 656e 6973 6f69   mkisofs/genisoi
-00009db0: 6d61 6765 2f78 6f72 7269 736f 6673 206e  mage/xorrisofs n
-00009dc0: 6565 6465 6420 666f 7220 636c 6f75 6469  eeded for cloudi
-00009dd0: 6e69 7422 7d0a 2020 2020 2020 2020 7265  nit"}.        re
-00009de0: 7365 7276 6569 7020 3d20 7072 6f66 696c  serveip = profil
-00009df0: 652e 6765 7428 2772 6573 6572 7665 6970  e.get('reserveip
-00009e00: 272c 2064 6566 6175 6c74 5f72 6573 6572  ', default_reser
-00009e10: 7665 6970 290a 2020 2020 2020 2020 7265  veip).        re
-00009e20: 7365 7276 6564 6e73 203d 2070 726f 6669  servedns = profi
-00009e30: 6c65 2e67 6574 2827 7265 7365 7276 6564  le.get('reserved
-00009e40: 6e73 272c 2064 6566 6175 6c74 5f72 6573  ns', default_res
-00009e50: 6572 7665 646e 7329 0a20 2020 2020 2020  ervedns).       
-00009e60: 2072 6573 6572 7665 686f 7374 203d 2070   reservehost = p
-00009e70: 726f 6669 6c65 2e67 6574 2827 7265 7365  rofile.get('rese
-00009e80: 7276 6568 6f73 7427 2c20 6465 6661 756c  rvehost', defaul
-00009e90: 745f 7265 7365 7276 6568 6f73 7429 0a20  t_reservehost). 
-00009ea0: 2020 2020 2020 206e 6573 7465 6420 3d20         nested = 
-00009eb0: 7072 6f66 696c 652e 6765 7428 276e 6573  profile.get('nes
-00009ec0: 7465 6427 2c20 6465 6661 756c 745f 6e65  ted', default_ne
-00009ed0: 7374 6564 290a 2020 2020 2020 2020 7374  sted).        st
-00009ee0: 6172 7420 3d20 7072 6f66 696c 652e 6765  art = profile.ge
-00009ef0: 7428 2773 7461 7274 272c 2064 6566 6175  t('start', defau
-00009f00: 6c74 5f73 7461 7274 290a 2020 2020 2020  lt_start).      
-00009f10: 2020 6175 746f 7374 6172 7420 3d20 7072    autostart = pr
-00009f20: 6f66 696c 652e 6765 7428 2761 7574 6f73  ofile.get('autos
-00009f30: 7461 7274 272c 2064 6566 6175 6c74 5f61  tart', default_a
-00009f40: 7574 6f73 7461 7274 290a 2020 2020 2020  utostart).      
-00009f50: 2020 6b65 7973 203d 2070 726f 6669 6c65    keys = profile
-00009f60: 2e67 6574 2827 6b65 7973 272c 2064 6566  .get('keys', def
-00009f70: 6175 6c74 5f6b 6579 7329 0a20 2020 2020  ault_keys).     
-00009f80: 2020 2063 6d64 7320 3d20 636f 6d6d 6f6e     cmds = common
-00009f90: 2e72 656d 6f76 655f 6475 706c 6963 6174  .remove_duplicat
-00009fa0: 6573 2864 6566 6175 6c74 5f63 6d64 7320  es(default_cmds 
-00009fb0: 2b20 7072 6f66 696c 652e 6765 7428 2763  + profile.get('c
-00009fc0: 6d64 7327 2c20 5b5d 2929 0a20 2020 2020  mds', [])).     
-00009fd0: 2020 206e 6574 6d61 736b 7320 3d20 7072     netmasks = pr
-00009fe0: 6f66 696c 652e 6765 7428 276e 6574 6d61  ofile.get('netma
-00009ff0: 736b 7327 2c20 6465 6661 756c 745f 6e65  sks', default_ne
-0000a000: 746d 6173 6b73 290a 2020 2020 2020 2020  tmasks).        
-0000a010: 6761 7465 7761 7920 3d20 7072 6f66 696c  gateway = profil
-0000a020: 652e 6765 7428 2767 6174 6577 6179 272c  e.get('gateway',
-0000a030: 2064 6566 6175 6c74 5f67 6174 6577 6179   default_gateway
-0000a040: 290a 2020 2020 2020 2020 646e 7320 3d20  ).        dns = 
-0000a050: 7072 6f66 696c 652e 6765 7428 2764 6e73  profile.get('dns
-0000a060: 272c 2064 6566 6175 6c74 5f64 6e73 290a  ', default_dns).
-0000a070: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
-0000a080: 2070 726f 6669 6c65 2e67 6574 2827 646f   profile.get('do
-0000a090: 6d61 696e 272c 206f 7665 7272 6964 6573  main', overrides
-0000a0a0: 2e67 6574 2827 646f 6d61 696e 272c 2064  .get('domain', d
-0000a0b0: 6566 6175 6c74 5f64 6f6d 6169 6e29 290a  efault_domain)).
-0000a0c0: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-0000a0d0: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
-0000a0e0: 2764 6e73 636c 6965 6e74 272c 206f 7665  'dnsclient', ove
-0000a0f0: 7272 6964 6573 2e67 6574 2827 646e 7363  rrides.get('dnsc
-0000a100: 6c69 656e 7427 2c20 6465 6661 756c 745f  lient', default_
-0000a110: 646e 7363 6c69 656e 7429 290a 2020 2020  dnsclient)).    
-0000a120: 2020 2020 7363 7269 7074 7320 3d20 636f      scripts = co
-0000a130: 6d6d 6f6e 2e72 656d 6f76 655f 6475 706c  mmon.remove_dupl
-0000a140: 6963 6174 6573 2864 6566 6175 6c74 5f73  icates(default_s
-0000a150: 6372 6970 7473 202b 2070 726f 6669 6c65  cripts + profile
-0000a160: 2e67 6574 2827 7363 7269 7074 7327 2c20  .get('scripts', 
-0000a170: 5b5d 2929 0a20 2020 2020 2020 2066 696c  [])).        fil
-0000a180: 6573 203d 2070 726f 6669 6c65 2e67 6574  es = profile.get
-0000a190: 2827 6669 6c65 7327 2c20 6465 6661 756c  ('files', defaul
-0000a1a0: 745f 6669 6c65 7329 0a20 2020 2020 2020  t_files).       
-0000a1b0: 2065 7874 7261 5f66 696c 6573 203d 2070   extra_files = p
-0000a1c0: 726f 6669 6c65 2e67 6574 2827 6578 7472  rofile.get('extr
-0000a1d0: 615f 6669 6c65 7327 2920 6f72 206f 7665  a_files') or ove
-0000a1e0: 7272 6964 6573 2e67 6574 2827 6578 7472  rrides.get('extr
-0000a1f0: 615f 6669 6c65 7327 2920 6f72 205b 5d0a  a_files') or [].
-0000a200: 2020 2020 2020 2020 6669 6c65 732e 6578          files.ex
-0000a210: 7465 6e64 2865 7874 7261 5f66 696c 6573  tend(extra_files
-0000a220: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-0000a230: 203d 2073 656c 662e 7061 7273 655f 6669   = self.parse_fi
-0000a240: 6c65 7328 6e61 6d65 2c20 6669 6c65 732c  les(name, files,
-0000a250: 2062 6173 6564 6972 2c20 6f6e 666c 7929   basedir, onfly)
-0000a260: 0a20 2020 2020 2020 2069 6620 7265 7375  .        if resu
-0000a270: 6c74 2069 7320 6e6f 7420 4e6f 6e65 3a0a  lt is not None:.
-0000a280: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a290: 726e 2072 6573 756c 740a 2020 2020 2020  rn result.      
-0000a2a0: 2020 7072 6f66 696c 655f 656e 765f 7061    profile_env_pa
-0000a2b0: 7261 6d65 7465 7273 203d 205b 6b65 7920  rameters = [key 
-0000a2c0: 666f 7220 6b65 7920 696e 2070 726f 6669  for key in profi
-0000a2d0: 6c65 2069 6620 6b65 792e 6973 7570 7065  le if key.isuppe
-0000a2e0: 7228 295d 0a20 2020 2020 2020 206f 7665  r()].        ove
-0000a2f0: 7272 6964 6573 5f65 6e76 5f70 6172 616d  rrides_env_param
-0000a300: 6574 6572 7320 3d20 5b6b 6579 2066 6f72  eters = [key for
-0000a310: 206b 6579 2069 6e20 6f76 6572 7269 6465   key in override
-0000a320: 7320 6966 206b 6579 2e69 7375 7070 6572  s if key.isupper
-0000a330: 2829 5d0a 2020 2020 2020 2020 656e 765f  ()].        env_
-0000a340: 7061 7261 6d65 7465 7273 203d 2073 6f72  parameters = sor
-0000a350: 7465 6428 6c69 7374 2873 6574 2870 726f  ted(list(set(pro
-0000a360: 6669 6c65 5f65 6e76 5f70 6172 616d 6574  file_env_paramet
-0000a370: 6572 7320 2b20 6f76 6572 7269 6465 735f  ers + overrides_
-0000a380: 656e 765f 7061 7261 6d65 7465 7273 2929  env_parameters))
-0000a390: 290a 2020 2020 2020 2020 6966 2065 6e76  ).        if env
-0000a3a0: 5f70 6172 616d 6574 6572 733a 0a20 2020  _parameters:.   
-0000a3b0: 2020 2020 2020 2020 2065 6e76 5f64 6174           env_dat
-0000a3c0: 6120 3d20 2727 0a20 2020 2020 2020 2020  a = ''.         
-0000a3d0: 2020 2066 6f72 206b 6579 2069 6e20 656e     for key in en
-0000a3e0: 765f 7061 7261 6d65 7465 7273 3a0a 2020  v_parameters:.  
-0000a3f0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0000a400: 6c75 6520 3d20 7072 6f66 696c 652e 6765  lue = profile.ge
-0000a410: 7428 6b65 7929 206f 7220 6f76 6572 7269  t(key) or overri
-0000a420: 6465 732e 6765 7428 6b65 7929 0a20 2020  des.get(key).   
-0000a430: 2020 2020 2020 2020 2020 2020 2065 6e76               env
-0000a440: 5f64 6174 6120 2b3d 2066 2265 7870 6f72  _data += f"expor
-0000a450: 7420 7b6b 6579 7d3d 7b76 616c 7565 7d5c  t {key}={value}\
-0000a460: 6e65 7870 6f72 7420 7b6b 6579 2e6c 6f77  nexport {key.low
-0000a470: 6572 2829 7d3d 7b76 616c 7565 7d5c 6e22  er()}={value}\n"
-0000a480: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-0000a490: 6573 2e61 7070 656e 6428 7b27 7061 7468  es.append({'path
-0000a4a0: 273a 2027 2f65 7463 2f70 726f 6669 6c65  ': '/etc/profile
-0000a4b0: 2e64 2f6b 636c 692e 7368 272c 2027 636f  .d/kcli.sh', 'co
-0000a4c0: 6e74 656e 7427 3a20 656e 765f 6461 7461  ntent': env_data
-0000a4d0: 2c20 276d 6f64 6527 3a20 3634 347d 290a  , 'mode': 644}).
-0000a4e0: 2020 2020 2020 2020 656e 6162 6c65 726f          enablero
-0000a4f0: 6f74 203d 2070 726f 6669 6c65 2e67 6574  ot = profile.get
-0000a500: 2827 656e 6162 6c65 726f 6f74 272c 2064  ('enableroot', d
-0000a510: 6566 6175 6c74 5f65 6e61 626c 6572 6f6f  efault_enableroo
-0000a520: 7429 0a20 2020 2020 2020 2074 6167 7320  t).        tags 
-0000a530: 3d20 7072 6f66 696c 652e 6765 7428 2774  = profile.get('t
-0000a540: 6167 7327 2c20 5b5d 290a 2020 2020 2020  ags', []).      
-0000a550: 2020 6966 2064 6566 6175 6c74 5f74 6167    if default_tag
-0000a560: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-0000a570: 6167 7320 3d20 6465 6661 756c 745f 7461  ags = default_ta
-0000a580: 6773 202b 2074 6167 7320 6966 2074 6167  gs + tags if tag
-0000a590: 7320 656c 7365 2064 6566 6175 6c74 5f74  s else default_t
-0000a5a0: 6167 730a 2020 2020 2020 2020 7072 6976  ags.        priv
-0000a5b0: 6174 656b 6579 203d 2070 726f 6669 6c65  atekey = profile
-0000a5c0: 2e67 6574 2827 7072 6976 6174 656b 6579  .get('privatekey
-0000a5d0: 272c 2064 6566 6175 6c74 5f70 7269 7661  ', default_priva
-0000a5e0: 7465 6b65 7929 0a20 2020 2020 2020 206e  tekey).        n
-0000a5f0: 6574 776f 726b 7761 6974 203d 2070 726f  etworkwait = pro
-0000a600: 6669 6c65 2e67 6574 2827 6e65 7477 6f72  file.get('networ
-0000a610: 6b77 6169 7427 2c20 6465 6661 756c 745f  kwait', default_
-0000a620: 6e65 7477 6f72 6b77 6169 7429 0a20 2020  networkwait).   
-0000a630: 2020 2020 2072 686e 7265 6769 7374 6572       rhnregister
-0000a640: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a650: 7268 6e72 6567 6973 7465 7227 2c20 6465  rhnregister', de
-0000a660: 6661 756c 745f 7268 6e72 6567 6973 7465  fault_rhnregiste
-0000a670: 7229 0a20 2020 2020 2020 2072 686e 7365  r).        rhnse
-0000a680: 7276 6572 203d 2070 726f 6669 6c65 2e67  rver = profile.g
-0000a690: 6574 2827 7268 6e73 6572 7665 7227 2c20  et('rhnserver', 
-0000a6a0: 6465 6661 756c 745f 7268 6e73 6572 7665  default_rhnserve
-0000a6b0: 7229 0a20 2020 2020 2020 2072 686e 7573  r).        rhnus
-0000a6c0: 6572 203d 2070 726f 6669 6c65 2e67 6574  er = profile.get
-0000a6d0: 2827 7268 6e75 7365 7227 2c20 6465 6661  ('rhnuser', defa
-0000a6e0: 756c 745f 7268 6e75 7365 7229 0a20 2020  ult_rhnuser).   
-0000a6f0: 2020 2020 2072 686e 7061 7373 776f 7264       rhnpassword
-0000a700: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a710: 7268 6e70 6173 7377 6f72 6427 2c20 6465  rhnpassword', de
-0000a720: 6661 756c 745f 7268 6e70 6173 7377 6f72  fault_rhnpasswor
-0000a730: 6429 0a20 2020 2020 2020 2072 686e 616b  d).        rhnak
-0000a740: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a750: 7268 6e61 6374 6976 6174 696f 6e6b 6579  rhnactivationkey
-0000a760: 272c 2064 6566 6175 6c74 5f72 686e 616b  ', default_rhnak
-0000a770: 290a 2020 2020 2020 2020 7268 6e6f 7267  ).        rhnorg
-0000a780: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a790: 7268 6e6f 7267 272c 2064 6566 6175 6c74  rhnorg', default
-0000a7a0: 5f72 686e 6f72 6729 0a20 2020 2020 2020  _rhnorg).       
-0000a7b0: 2072 686e 706f 6f6c 203d 2070 726f 6669   rhnpool = profi
-0000a7c0: 6c65 2e67 6574 2827 7268 6e70 6f6f 6c27  le.get('rhnpool'
-0000a7d0: 2c20 6465 6661 756c 745f 7268 6e70 6f6f  , default_rhnpoo
-0000a7e0: 6c29 0a20 2020 2020 2020 2066 6c61 766f  l).        flavo
-0000a7f0: 7220 3d20 7072 6f66 696c 652e 6765 7428  r = profile.get(
-0000a800: 2766 6c61 766f 7227 2c20 6465 6661 756c  'flavor', defaul
-0000a810: 745f 666c 6176 6f72 290a 2020 2020 2020  t_flavor).      
-0000a820: 2020 7374 6f72 656d 6574 6164 6174 6120    storemetadata 
-0000a830: 3d20 7072 6f66 696c 652e 6765 7428 2773  = profile.get('s
-0000a840: 746f 7265 6d65 7461 6461 7461 272c 2064  toremetadata', d
-0000a850: 6566 6175 6c74 5f73 746f 7265 6d65 7461  efault_storemeta
-0000a860: 6461 7461 290a 2020 2020 2020 2020 6e6f  data).        no
-0000a870: 7469 6679 203d 2070 726f 6669 6c65 2e67  tify = profile.g
-0000a880: 6574 2827 6e6f 7469 6679 272c 2064 6566  et('notify', def
-0000a890: 6175 6c74 5f6e 6f74 6966 7929 0a20 2020  ault_notify).   
-0000a8a0: 2020 2020 2070 7573 6862 756c 6c65 7474       pushbullett
-0000a8b0: 6f6b 656e 203d 2070 726f 6669 6c65 2e67  oken = profile.g
-0000a8c0: 6574 2827 7075 7368 6275 6c6c 6574 746f  et('pushbulletto
-0000a8d0: 6b65 6e27 2c20 6465 6661 756c 745f 7075  ken', default_pu
-0000a8e0: 7368 6275 6c6c 6574 746f 6b65 6e29 0a20  shbullettoken). 
-0000a8f0: 2020 2020 2020 2073 6c61 636b 746f 6b65         slacktoke
-0000a900: 6e20 3d20 7072 6f66 696c 652e 6765 7428  n = profile.get(
-0000a910: 2773 6c61 636b 746f 6b65 6e27 2c20 6465  'slacktoken', de
-0000a920: 6661 756c 745f 736c 6163 6b74 6f6b 656e  fault_slacktoken
-0000a930: 290a 2020 2020 2020 2020 6e6f 7469 6679  ).        notify
-0000a940: 636d 6420 3d20 7072 6f66 696c 652e 6765  cmd = profile.ge
-0000a950: 7428 276e 6f74 6966 7963 6d64 272c 2064  t('notifycmd', d
-0000a960: 6566 6175 6c74 5f6e 6f74 6966 7963 6d64  efault_notifycmd
-0000a970: 290a 2020 2020 2020 2020 6e6f 7469 6679  ).        notify
-0000a980: 7363 7269 7074 203d 2070 726f 6669 6c65  script = profile
-0000a990: 2e67 6574 2827 6e6f 7469 6679 7363 7269  .get('notifyscri
-0000a9a0: 7074 272c 2064 6566 6175 6c74 5f6e 6f74  pt', default_not
-0000a9b0: 6966 7973 6372 6970 7429 0a20 2020 2020  ifyscript).     
-0000a9c0: 2020 206e 6f74 6966 796d 6574 686f 6473     notifymethods
-0000a9d0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a9e0: 6e6f 7469 6679 6d65 7468 6f64 7327 2c20  notifymethods', 
-0000a9f0: 6465 6661 756c 745f 6e6f 7469 6679 6d65  default_notifyme
-0000aa00: 7468 6f64 7329 0a20 2020 2020 2020 2073  thods).        s
-0000aa10: 6c61 636b 6368 616e 6e65 6c20 3d20 7072  lackchannel = pr
-0000aa20: 6f66 696c 652e 6765 7428 2773 6c61 636b  ofile.get('slack
-0000aa30: 6368 616e 6e65 6c27 2c20 6465 6661 756c  channel', defaul
-0000aa40: 745f 736c 6163 6b63 6861 6e6e 656c 290a  t_slackchannel).
-0000aa50: 2020 2020 2020 2020 6d61 696c 7365 7276          mailserv
-0000aa60: 6572 203d 2070 726f 6669 6c65 2e67 6574  er = profile.get
-0000aa70: 2827 6d61 696c 7365 7276 6572 272c 2064  ('mailserver', d
-0000aa80: 6566 6175 6c74 5f6d 6169 6c73 6572 7665  efault_mailserve
-0000aa90: 7229 0a20 2020 2020 2020 206d 6169 6c66  r).        mailf
-0000aaa0: 726f 6d20 3d20 7072 6f66 696c 652e 6765  rom = profile.ge
-0000aab0: 7428 276d 6169 6c66 726f 6d27 2c20 6465  t('mailfrom', de
-0000aac0: 6661 756c 745f 6d61 696c 6672 6f6d 290a  fault_mailfrom).
-0000aad0: 2020 2020 2020 2020 6d61 696c 746f 203d          mailto =
-0000aae0: 2070 726f 6669 6c65 2e67 6574 2827 6d61   profile.get('ma
-0000aaf0: 696c 746f 272c 2064 6566 6175 6c74 5f6d  ilto', default_m
-0000ab00: 6169 6c74 6f29 0a20 2020 2020 2020 2073  ailto).        s
-0000ab10: 6861 7265 6466 6f6c 6465 7273 203d 2070  haredfolders = p
-0000ab20: 726f 6669 6c65 2e67 6574 2827 7368 6172  rofile.get('shar
-0000ab30: 6564 666f 6c64 6572 7327 2c20 6465 6661  edfolders', defa
-0000ab40: 756c 745f 7368 6172 6564 666f 6c64 6572  ult_sharedfolder
-0000ab50: 7329 0a20 2020 2020 2020 206b 6572 6e65  s).        kerne
-0000ab60: 6c20 3d20 7072 6f66 696c 652e 6765 7428  l = profile.get(
-0000ab70: 276b 6572 6e65 6c27 2c20 6465 6661 756c  'kernel', defaul
-0000ab80: 745f 6b65 726e 656c 290a 2020 2020 2020  t_kernel).      
-0000ab90: 2020 696e 6974 7264 203d 2070 726f 6669    initrd = profi
-0000aba0: 6c65 2e67 6574 2827 696e 6974 7264 272c  le.get('initrd',
-0000abb0: 2064 6566 6175 6c74 5f69 6e69 7472 6429   default_initrd)
-0000abc0: 0a20 2020 2020 2020 2063 6d64 6c69 6e65  .        cmdline
-0000abd0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000abe0: 636d 646c 696e 6527 2c20 6465 6661 756c  cmdline', defaul
-0000abf0: 745f 636d 646c 696e 6529 0a20 2020 2020  t_cmdline).     
-0000ac00: 2020 2070 6c61 6365 6d65 6e74 203d 2070     placement = p
-0000ac10: 726f 6669 6c65 2e67 6574 2827 706c 6163  rofile.get('plac
-0000ac20: 656d 656e 7427 2c20 6465 6661 756c 745f  ement', default_
-0000ac30: 706c 6163 656d 656e 7429 0a20 2020 2020  placement).     
-0000ac40: 2020 2079 616d 6c69 6e76 656e 746f 7279     yamlinventory
-0000ac50: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000ac60: 7961 6d6c 696e 7665 6e74 6f72 7927 2c20  yamlinventory', 
-0000ac70: 6465 6661 756c 745f 7961 6d6c 696e 7665  default_yamlinve
-0000ac80: 6e74 6f72 7929 0a20 2020 2020 2020 2063  ntory).        c
-0000ac90: 7075 686f 7470 6c75 6720 3d20 7072 6f66  puhotplug = prof
-0000aca0: 696c 652e 6765 7428 2763 7075 686f 7470  ile.get('cpuhotp
-0000acb0: 6c75 6727 2c20 6465 6661 756c 745f 6370  lug', default_cp
-0000acc0: 7568 6f74 706c 7567 290a 2020 2020 2020  uhotplug).      
-0000acd0: 2020 6d65 6d6f 7279 686f 7470 6c75 6720    memoryhotplug 
-0000ace0: 3d20 7072 6f66 696c 652e 6765 7428 276d  = profile.get('m
-0000acf0: 656d 6f72 7968 6f74 706c 7567 272c 2064  emoryhotplug', d
-0000ad00: 6566 6175 6c74 5f6d 656d 6f72 7968 6f74  efault_memoryhot
-0000ad10: 706c 7567 290a 2020 2020 2020 2020 726f  plug).        ro
-0000ad20: 6f74 7061 7373 776f 7264 203d 2070 726f  otpassword = pro
-0000ad30: 6669 6c65 2e67 6574 2827 726f 6f74 7061  file.get('rootpa
-0000ad40: 7373 776f 7264 272c 2064 6566 6175 6c74  ssword', default
-0000ad50: 5f72 6f6f 7470 6173 7377 6f72 6429 0a20  _rootpassword). 
-0000ad60: 2020 2020 2020 2076 6d75 7365 7220 3d20         vmuser = 
-0000ad70: 7072 6f66 696c 652e 6765 7428 2776 6d75  profile.get('vmu
-0000ad80: 7365 7227 2c20 6465 6661 756c 745f 766d  ser', default_vm
-0000ad90: 7573 6572 290a 2020 2020 2020 2020 7465  user).        te
-0000ada0: 6d70 6b65 7920 3d20 7072 6f66 696c 652e  mpkey = profile.
-0000adb0: 6765 7428 2774 656d 706b 6579 272c 2064  get('tempkey', d
-0000adc0: 6566 6175 6c74 5f74 656d 706b 6579 290a  efault_tempkey).
-0000add0: 2020 2020 2020 2020 7761 6974 203d 2070          wait = p
-0000ade0: 726f 6669 6c65 2e67 6574 2827 7761 6974  rofile.get('wait
-0000adf0: 272c 2064 6566 6175 6c74 5f77 6169 7429  ', default_wait)
-0000ae00: 0a20 2020 2020 2020 2077 6169 7463 6f6d  .        waitcom
-0000ae10: 6d61 6e64 203d 2070 726f 6669 6c65 2e67  mand = profile.g
-0000ae20: 6574 2827 7761 6974 636f 6d6d 616e 6427  et('waitcommand'
-0000ae30: 2c20 6465 6661 756c 745f 7761 6974 636f  , default_waitco
-0000ae40: 6d6d 616e 6429 0a20 2020 2020 2020 2069  mmand).        i
-0000ae50: 6620 7761 6974 636f 6d6d 616e 6420 6973  f waitcommand is
-0000ae60: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000ae70: 2020 2020 2020 2077 6169 7420 3d20 5472         wait = Tr
-0000ae80: 7565 0a20 2020 2020 2020 2077 6169 7474  ue.        waitt
-0000ae90: 696d 656f 7574 203d 2070 726f 6669 6c65  imeout = profile
-0000aea0: 2e67 6574 2827 7761 6974 7469 6d65 6f75  .get('waittimeou
-0000aeb0: 7427 2c20 6465 6661 756c 745f 7761 6974  t', default_wait
-0000aec0: 7469 6d65 6f75 7429 0a20 2020 2020 2020  timeout).       
-0000aed0: 2076 6972 7474 7970 6520 3d20 7072 6f66   virttype = prof
-0000aee0: 696c 652e 6765 7428 2776 6972 7474 7970  ile.get('virttyp
-0000aef0: 6527 2c20 6465 6661 756c 745f 7669 7274  e', default_virt
-0000af00: 7479 7065 290a 2020 2020 2020 2020 6f76  type).        ov
-0000af10: 6572 7269 6465 732e 7570 6461 7465 2870  errides.update(p
-0000af20: 726f 6669 6c65 290a 2020 2020 2020 2020  rofile).        
-0000af30: 7363 7269 7074 636d 6473 203d 205b 5d0a  scriptcmds = [].
-0000af40: 2020 2020 2020 2020 6966 2069 6d61 6765          if image
-0000af50: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000af60: 2027 7268 656c 2720 696e 2069 6d61 6765   'rhel' in image
-0000af70: 2e6c 6f77 6572 2829 3a0a 2020 2020 2020  .lower():.      
-0000af80: 2020 2020 2020 6966 2072 686e 7265 6769        if rhnregi
-0000af90: 7374 6572 3a0a 2020 2020 2020 2020 2020  ster:.          
-0000afa0: 2020 2020 2020 6966 2072 686e 7573 6572        if rhnuser
-0000afb0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000afc0: 2072 686e 7061 7373 776f 7264 2069 7320   rhnpassword is 
-0000afd0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000afe0: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
-0000aff0: 6572 7269 6465 735b 2772 686e 7573 6572  errides['rhnuser
-0000b000: 275d 203d 2072 686e 7573 6572 0a20 2020  '] = rhnuser.   
-0000b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b020: 206f 7665 7272 6964 6573 5b27 7268 6e70   overrides['rhnp
-0000b030: 6173 7377 6f72 6427 5d20 3d20 7268 6e70  assword'] = rhnp
-0000b040: 6173 7377 6f72 640a 2020 2020 2020 2020  assword.        
-0000b050: 2020 2020 2020 2020 656c 6966 2072 686e          elif rhn
-0000b060: 616b 2069 7320 6e6f 7420 4e6f 6e65 2061  ak is not None a
-0000b070: 6e64 2072 686e 6f72 6720 6973 206e 6f74  nd rhnorg is not
-0000b080: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b090: 2020 2020 2020 2020 2020 206f 7665 7272             overr
-0000b0a0: 6964 6573 5b27 7268 6e61 6374 6976 6174  ides['rhnactivat
-0000b0b0: 696f 6e6b 6579 275d 203d 2072 686e 616b  ionkey'] = rhnak
-0000b0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b0d0: 2020 2020 206f 7665 7272 6964 6573 5b27       overrides['
-0000b0e0: 7268 6e6f 7267 275d 203d 2072 686e 6f72  rhnorg'] = rhnor
-0000b0f0: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-0000b100: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b110: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-0000b120: 3d20 2252 686e 2072 6567 6973 7472 6174  = "Rhn registrat
-0000b130: 696f 6e20 7265 7175 6972 6564 2062 7574  ion required but
-0000b140: 206d 6973 7369 6e67 2063 7265 6465 6e74   missing credent
-0000b150: 6961 6c73 2e20 220a 2020 2020 2020 2020  ials. ".        
-0000b160: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-0000b170: 2b3d 2022 4465 6669 6e65 2072 686e 7573  += "Define rhnus
-0000b180: 6572 2f72 686e 7061 7373 776f 7264 206f  er/rhnpassword o
-0000b190: 7220 7268 6e61 6374 6976 6174 696f 6e6b  r rhnactivationk
-0000b1a0: 6579 2f72 686e 6f72 6722 0a20 2020 2020  ey/rhnorg".     
-0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000b1c0: 6172 6e69 6e67 286d 7367 290a 2020 2020  arning(msg).    
-0000b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1e0: 7268 6e72 6567 6973 7465 7220 3d20 4661  rhnregister = Fa
-0000b1f0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0000b200: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000b210: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-0000b220: 7b6e 616d 657d 2077 696c 6c20 7265 7175  {name} will requ
-0000b230: 6972 6520 6d61 6e75 616c 2073 7562 7363  ire manual subsc
-0000b240: 7269 7074 696f 6e20 746f 2052 6564 2048  ription to Red H
-0000b250: 6174 204e 6574 776f 726b 2229 0a20 2020  at Network").   
-0000b260: 2020 2020 2069 6620 696d 6167 6520 6973       if image is
-0000b270: 206e 6f74 204e 6f6e 6520 616e 6420 636c   not None and cl
-0000b280: 6f75 6469 6e69 7420 616e 6420 6973 6f20  oudinit and iso 
-0000b290: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000b2a0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0000b2b0: 2866 2249 676e 6f72 696e 6720 6973 6f20  (f"Ignoring iso 
-0000b2c0: 7b69 736f 7d20 6173 2069 6d61 6765 207b  {iso} as image {
-0000b2d0: 696d 6167 657d 2069 7320 7365 7422 290a  image} is set").
-0000b2e0: 2020 2020 2020 2020 6966 2073 6372 6970          if scrip
-0000b2f0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0000b300: 666f 7220 7363 7269 7074 2069 6e20 7363  for script in sc
-0000b310: 7269 7074 733a 0a20 2020 2020 2020 2020  ripts:.         
-0000b320: 2020 2020 2020 2069 6620 6f6e 666c 7920         if onfly 
-0000b330: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000b340: 277e 2720 6e6f 7420 696e 2073 6372 6970  '~' not in scrip
-0000b350: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0000b360: 2020 2020 2020 2064 6573 7464 6972 203d         destdir =
-0000b370: 2062 6173 6564 6972 0a20 2020 2020 2020   basedir.       
-0000b380: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000b390: 272f 2720 696e 2073 6372 6970 743a 0a20  '/' in script:. 
-0000b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3b0: 2020 2020 2020 2064 6573 7464 6972 203d         destdir =
-0000b3c0: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-0000b3d0: 2873 6372 6970 7429 0a20 2020 2020 2020  (script).       
-0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3f0: 206f 732e 6d61 6b65 6469 7273 2864 6573   os.makedirs(des
-0000b400: 7464 6972 2c20 6578 6973 745f 6f6b 3d54  tdir, exist_ok=T
-0000b410: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0000b420: 2020 2020 2020 2020 2063 6f6d 6d6f 6e2e           common.
-0000b430: 6665 7463 6828 6622 7b6f 6e66 6c79 7d2f  fetch(f"{onfly}/
-0000b440: 7b73 6372 6970 747d 222c 2064 6573 7464  {script}", destd
-0000b450: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
-0000b460: 2020 2020 7363 7269 7074 203d 206f 732e      script = os.
-0000b470: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-0000b480: 7363 7269 7074 290a 2020 2020 2020 2020  script).        
-0000b490: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-0000b4a0: 7468 2e65 7869 7374 7328 7363 7269 7074  th.exists(script
-0000b4b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b4c0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-0000b4d0: 2e70 6174 682e 6973 6162 7328 7363 7269  .path.isabs(scri
-0000b4e0: 7074 293a 0a20 2020 2020 2020 2020 2020  pt):.           
-0000b4f0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-0000b500: 6970 7420 3d20 6f73 2e70 6174 682e 6162  ipt = os.path.ab
-0000b510: 7370 6174 6828 7363 7269 7074 290a 2020  spath(script).  
-0000b520: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000b530: 6966 2062 6173 6564 6972 2021 3d20 272e  if basedir != '.
-0000b540: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-0000b550: 2020 2020 2020 2073 6372 6970 7420 3d20         script = 
-0000b560: 6627 7b62 6173 6564 6972 7d2f 7b73 6372  f'{basedir}/{scr
-0000b570: 6970 747d 270a 2020 2020 2020 2020 2020  ipt}'.          
-0000b580: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-0000b590: 7061 7468 2e65 7869 7374 7328 7363 7269  path.exists(scri
-0000b5a0: 7074 293a 0a20 2020 2020 2020 2020 2020  pt):.           
-0000b5b0: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
-0000b5c0: 2253 6372 6970 7420 6669 6c65 207b 7363  "Script file {sc
-0000b5d0: 7269 7074 7d20 6e6f 7420 666f 756e 6422  ript} not found"
-0000b5e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b5f0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-0000b600: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b610: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b620: 2020 2020 2020 2020 2020 2020 7363 7269              scri
-0000b630: 7074 6261 7365 6469 7220 3d20 6f73 2e70  ptbasedir = os.p
-0000b640: 6174 682e 6469 726e 616d 6528 7363 7269  ath.dirname(scri
-0000b650: 7074 2920 6966 206f 732e 7061 7468 2e64  pt) if os.path.d
-0000b660: 6972 6e61 6d65 2873 6372 6970 7429 2021  irname(script) !
-0000b670: 3d20 2727 2065 6c73 6520 272e 270a 2020  = '' else '.'.  
-0000b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b690: 2020 656e 7620 3d20 456e 7669 726f 6e6d    env = Environm
-0000b6a0: 656e 7428 6c6f 6164 6572 3d46 696c 6553  ent(loader=FileS
-0000b6b0: 7973 7465 6d4c 6f61 6465 7228 7363 7269  ystemLoader(scri
-0000b6c0: 7074 6261 7365 6469 7229 2c20 756e 6465  ptbasedir), unde
-0000b6d0: 6669 6e65 643d 756e 6465 6669 6e65 642c  fined=undefined,
-0000b6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b700: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-0000b710: 733d 5b27 6a69 6e6a 6132 2e65 7874 2e64  s=['jinja2.ext.d
-0000b720: 6f27 5d2c 2074 7269 6d5f 626c 6f63 6b73  o'], trim_blocks
-0000b730: 3d54 7275 652c 206c 7374 7269 705f 626c  =True, lstrip_bl
-0000b740: 6f63 6b73 3d54 7275 6529 0a20 2020 2020  ocks=True).     
-0000b750: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000b760: 6f72 206a 696e 6a61 6669 6c74 6572 2069  or jinjafilter i
-0000b770: 6e20 6a69 6e6a 6166 696c 7465 7273 2e6a  n jinjafilters.j
-0000b780: 696e 6a61 6669 6c74 6572 733a 0a20 2020  injafilters:.   
-0000b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7a0: 2020 2020 2065 6e76 2e66 696c 7465 7273       env.filters
-0000b7b0: 5b6a 696e 6a61 6669 6c74 6572 5d20 3d20  [jinjafilter] = 
-0000b7c0: 6a69 6e6a 6166 696c 7465 7273 2e6a 696e  jinjafilters.jin
-0000b7d0: 6a61 6669 6c74 6572 735b 6a69 6e6a 6166  jafilters[jinjaf
-0000b7e0: 696c 7465 725d 0a20 2020 2020 2020 2020  ilter].         
-0000b7f0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b810: 2020 2020 2020 2020 7465 6d70 6c20 3d20          templ = 
-0000b820: 656e 762e 6765 745f 7465 6d70 6c61 7465  env.get_template
-0000b830: 286f 732e 7061 7468 2e62 6173 656e 616d  (os.path.basenam
-0000b840: 6528 7363 7269 7074 2929 0a20 2020 2020  e(script)).     
-0000b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b860: 2020 2073 6372 6970 7465 6e74 7269 6573     scriptentries
-0000b870: 203d 2074 656d 706c 2e72 656e 6465 7228   = templ.render(
-0000b880: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-0000b890: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000b8a0: 7863 6570 7420 5465 6d70 6c61 7465 4e6f  xcept TemplateNo
-0000b8b0: 7446 6f75 6e64 3a0a 2020 2020 2020 2020  tFound:.        
-0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8d0: 6572 726f 7228 6622 5363 7269 7074 2066  error(f"Script f
-0000b8e0: 696c 6520 7b6f 732e 7061 7468 2e62 6173  ile {os.path.bas
-0000b8f0: 656e 616d 6528 7363 7269 7074 297d 206e  ename(script)} n
-0000b900: 6f74 2066 6f75 6e64 2229 0a20 2020 2020  ot found").     
-0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b920: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-0000b930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b940: 2020 2065 7863 6570 7420 5465 6d70 6c61     except Templa
-0000b950: 7465 5379 6e74 6178 4572 726f 7220 6173  teSyntaxError as
-0000b960: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000b970: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-0000b980: 3d20 6622 4572 726f 7220 7265 6e64 6572  = f"Error render
-0000b990: 696e 6720 6c69 6e65 207b 652e 6c69 6e65  ing line {e.line
-0000b9a0: 6e6f 7d20 6f66 2073 6372 6970 7420 6669  no} of script fi
-0000b9b0: 6c65 207b 652e 6669 6c65 6e61 6d65 7d2e  le {e.filename}.
-0000b9c0: 2047 6f74 3a20 7b65 2e6d 6573 7361 6765   Got: {e.message
-0000b9d0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0000b9e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000b9f0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
-0000ba00: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
-0000ba10: 3a20 6d73 677d 0a20 2020 2020 2020 2020  : msg}.         
-0000ba20: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000ba30: 7420 5465 6d70 6c61 7465 4572 726f 7220  t TemplateError 
-0000ba40: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000ba50: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-0000ba60: 6720 3d20 6622 4572 726f 7220 7265 6e64  g = f"Error rend
-0000ba70: 6572 696e 6720 7363 7269 7074 2066 696c  ering script fil
-0000ba80: 6520 7b73 6372 6970 747d 2e20 476f 743a  e {script}. Got:
-0000ba90: 207b 652e 6d65 7373 6167 657d 220a 2020   {e.message}".  
-0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bab0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-0000bac0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
-0000bad0: 272c 2027 7265 6173 6f6e 273a 206d 7367  ', 'reason': msg
-0000bae0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0000baf0: 2020 2020 2020 7363 7269 7074 6c69 6e65        scriptline
-0000bb00: 7320 3d20 5b6c 696e 652e 7374 7269 7028  s = [line.strip(
-0000bb10: 2920 666f 7220 6c69 6e65 2069 6e20 7363  ) for line in sc
-0000bb20: 7269 7074 656e 7472 6965 732e 7370 6c69  riptentries.spli
-0000bb30: 7428 275c 6e27 2920 6966 206c 696e 652e  t('\n') if line.
-0000bb40: 7374 7269 7028 2920 213d 2027 275d 0a20  strip() != '']. 
-0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb60: 2020 2069 6620 7363 7269 7074 6c69 6e65     if scriptline
-0000bb70: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000bb80: 2020 2020 2020 2020 2020 2073 6372 6970             scrip
-0000bb90: 746c 696e 6573 2e69 6e73 6572 7428 302c  tlines.insert(0,
-0000bba0: 2066 2265 6368 6f20 5275 6e6e 696e 6720   f"echo Running 
-0000bbb0: 7363 7269 7074 207b 6f73 2e70 6174 682e  script {os.path.
-0000bbc0: 6261 7365 6e61 6d65 2873 6372 6970 7429  basename(script)
-0000bbd0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000bbe0: 2020 2020 2020 2020 2020 2020 7363 7269              scri
-0000bbf0: 7074 636d 6473 2e65 7874 656e 6428 7363  ptcmds.extend(sc
-0000bc00: 7269 7074 6c69 6e65 7329 0a20 2020 2020  riptlines).     
-0000bc10: 2020 2069 6620 636c 6f75 6469 6e69 7420     if cloudinit 
-0000bc20: 616e 6420 696d 6167 6520 6973 206e 6f74  and image is not
-0000bc30: 204e 6f6e 6520 616e 6420 2772 6865 6c27   None and 'rhel'
-0000bc40: 2069 6e20 696d 6167 652e 6c6f 7765 7228   in image.lower(
-0000bc50: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000bc60: 686e 636f 6d6d 616e 6473 203d 205b 5d0a  hncommands = [].
-0000bc70: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0000bc80: 686e 7365 7276 6572 2021 3d20 2268 7474  hnserver != "htt
-0000bc90: 7073 3a2f 2f73 7562 7363 7269 7074 696f  ps://subscriptio
-0000bca0: 6e2e 7268 736d 2e72 6564 6861 742e 636f  n.rhsm.redhat.co
-0000bcb0: 6d22 2061 6e64 206e 6f74 2076 616c 6964  m" and not valid
-0000bcc0: 5f69 7028 7268 6e73 6572 7665 7229 3a0a  _ip(rhnserver):.
-0000bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bce0: 6671 646e 203d 206f 732e 7061 7468 2e62  fqdn = os.path.b
-0000bcf0: 6173 656e 616d 6528 7268 6e73 6572 7665  asename(rhnserve
-0000bd00: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-0000bd10: 2020 2072 686e 636f 6d6d 616e 6473 2e61     rhncommands.a
-0000bd20: 7070 656e 6428 6627 7270 6d20 2d55 7668  ppend(f'rpm -Uvh
-0000bd30: 2068 7474 703a 2f2f 7b66 7164 6e7d 2f70   http://{fqdn}/p
-0000bd40: 7562 2f6b 6174 656c 6c6f 2d63 612d 636f  ub/katello-ca-co
-0000bd50: 6e73 756d 6572 2d6c 6174 6573 742e 6e6f  nsumer-latest.no
-0000bd60: 6172 6368 2e72 706d 2729 0a20 2020 2020  arch.rpm').     
-0000bd70: 2020 2020 2020 2069 6620 7268 6e61 6b20         if rhnak 
-0000bd80: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000bd90: 7268 6e6f 7267 2069 7320 6e6f 7420 4e6f  rhnorg is not No
-0000bda0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000bdb0: 2020 2020 7268 6e63 6f6d 6d61 6e64 732e      rhncommands.
-0000bdc0: 6170 7065 6e64 2827 7375 6273 6372 6970  append('subscrip
-0000bdd0: 7469 6f6e 2d6d 616e 6167 6572 2072 6567  tion-manager reg
-0000bde0: 6973 7465 7220 2d2d 7365 7276 6572 7572  ister --serverur
-0000bdf0: 6c3d 2573 202d 2d66 6f72 6365 202d 2d61  l=%s --force --a
-0000be00: 6374 6976 6174 696f 6e6b 6579 3d25 7320  ctivationkey=%s 
-0000be10: 2d2d 6f72 673d 2573 270a 2020 2020 2020  --org=%s'.      
-0000be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be30: 2020 2020 2020 2020 2020 2020 2025 2028               % (
-0000be40: 7268 6e73 6572 7665 722c 2072 686e 616b  rhnserver, rhnak
-0000be50: 2c20 7268 6e6f 7267 2929 0a20 2020 2020  , rhnorg)).     
-0000be60: 2020 2020 2020 2020 2020 2069 6620 696d             if im
-0000be70: 6167 652e 7374 6172 7473 7769 7468 2827  age.startswith('
-0000be80: 7268 656c 2d38 2729 206f 7220 696d 6167  rhel-8') or imag
-0000be90: 6520 3d3d 2027 7268 656c 3827 3a0a 2020  e == 'rhel8':.  
-0000bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000beb0: 2020 7268 6e63 6f6d 6d61 6e64 732e 6170    rhncommands.ap
-0000bec0: 7065 6e64 2827 7375 6273 6372 6970 7469  pend('subscripti
-0000bed0: 6f6e 2d6d 616e 6167 6572 2072 6570 6f73  on-manager repos
-0000bee0: 202d 2d65 6e61 626c 653d 7268 656c 2d38   --enable=rhel-8
-0000bef0: 2d66 6f72 2d78 3836 5f36 342d 6261 7365  -for-x86_64-base
-0000bf00: 6f73 2d72 706d 7327 290a 2020 2020 2020  os-rpms').      
-0000bf10: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-0000bf20: 6d61 6765 2e73 7461 7274 7377 6974 6828  mage.startswith(
-0000bf30: 2772 6865 6c2d 7365 7276 6572 2d37 2729  'rhel-server-7')
-0000bf40: 206f 7220 696d 6167 6520 3d3d 2027 7268   or image == 'rh
-0000bf50: 656c 3727 3a0a 2020 2020 2020 2020 2020  el7':.          
-0000bf60: 2020 2020 2020 2020 2020 7268 6e63 6f6d            rhncom
-0000bf70: 6d61 6e64 732e 6170 7065 6e64 2827 7375  mands.append('su
-0000bf80: 6273 6372 6970 7469 6f6e 2d6d 616e 6167  bscription-manag
-0000bf90: 6572 2072 6570 6f73 202d 2d65 6e61 626c  er repos --enabl
-0000bfa0: 653d 7268 656c 2d37 2d73 6572 7665 722d  e=rhel-7-server-
-0000bfb0: 7270 6d73 2729 0a20 2020 2020 2020 2020  rpms').         
-0000bfc0: 2020 2065 6c69 6620 7268 6e75 7365 7220     elif rhnuser 
-0000bfd0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000bfe0: 7268 6e70 6173 7377 6f72 6420 6973 206e  rhnpassword is n
-0000bff0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000c000: 2020 2020 2020 2020 2072 686e 636f 6d6d           rhncomm
-0000c010: 616e 6473 2e61 7070 656e 6428 2773 7562  ands.append('sub
-0000c020: 7363 7269 7074 696f 6e2d 6d61 6e61 6765  scription-manage
-0000c030: 7220 7265 6769 7374 6572 202d 2d73 6572  r register --ser
-0000c040: 7665 7275 726c 3d25 7320 2d2d 666f 7263  verurl=%s --forc
-0000c050: 6520 2d2d 7573 6572 6e61 6d65 3d25 7320  e --username=%s 
-0000c060: 2d2d 7061 7373 776f 7264 3d25 7327 0a20  --password=%s'. 
-0000c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c090: 2020 2520 2872 686e 7365 7276 6572 2c20    % (rhnserver, 
-0000c0a0: 7268 6e75 7365 722c 2072 686e 7061 7373  rhnuser, rhnpass
-0000c0b0: 776f 7264 2929 0a20 2020 2020 2020 2020  word)).         
-0000c0c0: 2020 2020 2020 2069 6620 7268 6e70 6f6f         if rhnpoo
-0000c0d0: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
-0000c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0f0: 2020 2072 686e 636f 6d6d 616e 6473 2e61     rhncommands.a
-0000c100: 7070 656e 6428 6627 7375 6273 6372 6970  ppend(f'subscrip
-0000c110: 7469 6f6e 2d6d 616e 6167 6572 2061 7474  tion-manager att
-0000c120: 6163 6820 2d2d 706f 6f6c 3d7b 7268 6e70  ach --pool={rhnp
-0000c130: 6f6f 6c7d 2729 0a20 2020 2020 2020 2020  ool}').         
-0000c140: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c160: 2072 686e 636f 6d6d 616e 6473 2e61 7070   rhncommands.app
-0000c170: 656e 6428 2773 7562 7363 7269 7074 696f  end('subscriptio
-0000c180: 6e2d 6d61 6e61 6765 7220 6174 7461 6368  n-manager attach
-0000c190: 202d 2d61 7574 6f27 290a 2020 2020 2020   --auto').      
-0000c1a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c1b0: 2020 2020 7268 6e63 6f6d 6d61 6e64 7320      rhncommands 
-0000c1c0: 3d20 5b5d 0a20 2020 2020 2020 2073 6861  = [].        sha
-0000c1d0: 7265 6466 6f6c 6465 7263 6d64 7320 3d20  redfoldercmds = 
-0000c1e0: 5b5d 0a20 2020 2020 2020 2069 6620 7368  [].        if sh
-0000c1f0: 6172 6564 666f 6c64 6572 7320 616e 6420  aredfolders and 
-0000c200: 7365 6c66 2e74 7970 6520 3d3d 2027 6b76  self.type == 'kv
-0000c210: 6d27 3a0a 2020 2020 2020 2020 2020 2020  m':.            
-0000c220: 666f 7220 7368 6172 6564 666f 6c64 6572  for sharedfolder
-0000c230: 2069 6e20 7368 6172 6564 666f 6c64 6572   in sharedfolder
-0000c240: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000c250: 2020 2062 6173 6566 6f6c 6465 7220 3d20     basefolder = 
-0000c260: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-0000c270: 2873 6861 7265 6466 6f6c 6465 7229 0a20  (sharedfolder). 
-0000c280: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000c290: 6d64 3120 3d20 6622 6d6b 6469 7220 2d70  md1 = f"mkdir -p
-0000c2a0: 202f 6d6e 742f 7b73 6861 7265 6466 6f6c   /mnt/{sharedfol
-0000c2b0: 6465 727d 220a 2020 2020 2020 2020 2020  der}".          
-0000c2c0: 2020 2020 2020 636d 6432 203d 2066 2265        cmd2 = f"e
-0000c2d0: 6368 6f20 7b62 6173 6566 6f6c 6465 727d  cho {basefolder}
-0000c2e0: 202f 6d6e 742f 7b73 6861 7265 6466 6f6c   /mnt/{sharedfol
-0000c2f0: 6465 727d 2039 7020 7472 616e 733d 7669  der} 9p trans=vi
-0000c300: 7274 696f 2c76 6572 7369 6f6e 3d39 7032  rtio,version=9p2
-0000c310: 3030 302e 4c2c 7277 2030 2030 203e 3e20  000.L,rw 0 0 >> 
-0000c320: 2f65 7463 2f66 7374 6162 220a 2020 2020  /etc/fstab".    
-0000c330: 2020 2020 2020 2020 2020 2020 7368 6172              shar
-0000c340: 6564 666f 6c64 6572 636d 6473 2e61 7070  edfoldercmds.app
-0000c350: 656e 6428 636d 6431 290a 2020 2020 2020  end(cmd1).      
-0000c360: 2020 2020 2020 2020 2020 7368 6172 6564            shared
-0000c370: 666f 6c64 6572 636d 6473 2e61 7070 656e  foldercmds.appen
-0000c380: 6428 636d 6432 290a 2020 2020 2020 2020  d(cmd2).        
-0000c390: 6966 2073 6861 7265 6466 6f6c 6465 7263  if sharedfolderc
-0000c3a0: 6d64 733a 0a20 2020 2020 2020 2020 2020  mds:.           
-0000c3b0: 2073 6861 7265 6466 6f6c 6465 7263 6d64   sharedfoldercmd
-0000c3c0: 732e 6170 7065 6e64 2822 6d6f 756e 7420  s.append("mount 
-0000c3d0: 2d61 2229 0a20 2020 2020 2020 206e 6574  -a").        net
-0000c3e0: 776f 726b 7761 6974 636f 6d6d 616e 6420  workwaitcommand 
-0000c3f0: 3d20 5b66 2773 6c65 6570 207b 6e65 7477  = [f'sleep {netw
-0000c400: 6f72 6b77 6169 747d 275d 2069 6620 6e65  orkwait}'] if ne
-0000c410: 7477 6f72 6b77 6169 7420 3e20 3020 656c  tworkwait > 0 el
-0000c420: 7365 205b 5d0a 2020 2020 2020 2020 726f  se [].        ro
-0000c430: 6f74 636f 6d6d 616e 6420 3d20 5b66 2765  otcommand = [f'e
-0000c440: 6368 6f20 726f 6f74 3a7b 726f 6f74 7061  cho root:{rootpa
-0000c450: 7373 776f 7264 7d20 7c20 6368 7061 7373  ssword} | chpass
-0000c460: 7764 275d 2069 6620 726f 6f74 7061 7373  wd'] if rootpass
-0000c470: 776f 7264 2069 7320 6e6f 7420 4e6f 6e65  word is not None
-0000c480: 2065 6c73 6520 5b5d 0a20 2020 2020 2020   else [].       
-0000c490: 2063 6d64 7320 3d20 726f 6f74 636f 6d6d   cmds = rootcomm
-0000c4a0: 616e 6420 2b20 6e65 7477 6f72 6b77 6169  and + networkwai
-0000c4b0: 7463 6f6d 6d61 6e64 202b 2072 686e 636f  tcommand + rhnco
-0000c4c0: 6d6d 616e 6473 202b 2073 6861 7265 6466  mmands + sharedf
-0000c4d0: 6f6c 6465 7263 6d64 7320 2b20 636d 6473  oldercmds + cmds
-0000c4e0: 202b 2073 6372 6970 7463 6d64 730a 2020   + scriptcmds.  
-0000c4f0: 2020 2020 2020 6966 206e 6f74 6966 7920        if notify 
-0000c500: 616e 6420 696d 6167 6520 6973 206e 6f74  and image is not
-0000c510: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000c520: 2020 2069 6620 6e6f 7469 6679 636d 6420     if notifycmd 
-0000c530: 6973 204e 6f6e 6520 616e 6420 6e6f 7469  is None and noti
-0000c540: 6679 7363 7269 7074 2069 7320 4e6f 6e65  fyscript is None
-0000c550: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c560: 2020 6966 2027 636f 7327 2069 6e20 696d    if 'cos' in im
-0000c570: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
-0000c580: 2020 2020 2020 2020 206e 6f74 6966 7963           notifyc
-0000c590: 6d64 203d 2027 6a6f 7572 6e61 6c63 746c  md = 'journalctl
-0000c5a0: 202d 2d69 6465 6e74 6966 6965 723d 6967   --identifier=ig
-0000c5b0: 6e69 7469 6f6e 202d 2d61 6c6c 202d 2d6e  nition --all --n
-0000c5c0: 6f2d 7061 6765 7227 0a20 2020 2020 2020  o-pager'.       
-0000c5d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5f0: 2020 2063 6c6f 7564 696e 6974 6669 6c65     cloudinitfile
-0000c600: 203d 2063 6f6d 6d6f 6e2e 6765 745f 636c   = common.get_cl
-0000c610: 6f75 6469 6e69 7466 696c 6528 696d 6167  oudinitfile(imag
-0000c620: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0000c630: 2020 2020 2020 206e 6f74 6966 7963 6d64         notifycmd
-0000c640: 203d 2022 7461 696c 202d 3130 3020 2573   = "tail -100 %s
-0000c650: 2220 2520 636c 6f75 6469 6e69 7466 696c  " % cloudinitfil
-0000c660: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-0000c670: 206e 6f74 6966 7973 6372 6970 7420 6973   notifyscript is
-0000c680: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000c690: 2020 2020 2020 2020 2020 206e 6f74 6966             notif
-0000c6a0: 7973 6372 6970 7420 3d20 6f73 2e70 6174  yscript = os.pat
-0000c6b0: 682e 6578 7061 6e64 7573 6572 286e 6f74  h.expanduser(not
-0000c6c0: 6966 7973 6372 6970 7429 0a20 2020 2020  ifyscript).     
-0000c6d0: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
-0000c6e0: 7365 6469 7220 213d 2027 2e27 3a0a 2020  sedir != '.':.  
-0000c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c700: 2020 6e6f 7469 6679 7363 7269 7074 203d    notifyscript =
-0000c710: 2066 277b 6261 7365 6469 727d 2f7b 6e6f   f'{basedir}/{no
-0000c720: 7469 6679 7363 7269 7074 7d27 0a20 2020  tifyscript}'.   
-0000c730: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000c740: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-0000c750: 7473 286e 6f74 6966 7973 6372 6970 7429  ts(notifyscript)
-0000c760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c770: 2020 2020 2020 6e6f 7469 6679 636d 6420        notifycmd 
-0000c780: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-0000c790: 2020 2020 2020 2020 2020 206e 6f74 6966             notif
-0000c7a0: 7973 6372 6970 7420 3d20 4e6f 6e65 0a20  yscript = None. 
-0000c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7c0: 2020 2077 6172 6e69 6e67 2866 224e 6f74     warning(f"Not
-0000c7d0: 6966 6963 6174 696f 6e20 7265 7175 6972  ification requir
-0000c7e0: 6564 2066 6f72 207b 6e61 6d65 7d20 6275  ed for {name} bu
-0000c7f0: 7420 6d69 7373 696e 6720 6e6f 7469 6679  t missing notify
-0000c800: 7363 7269 7074 2229 0a20 2020 2020 2020  script").       
-0000c810: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c830: 2020 2066 696c 6573 2e61 7070 656e 6428     files.append(
-0000c840: 7b27 7061 7468 273a 2027 2f72 6f6f 742f  {'path': '/root/
-0000c850: 2e6e 6f74 6966 792e 7368 272c 2027 6f72  .notify.sh', 'or
-0000c860: 6967 696e 273a 206e 6f74 6966 7973 6372  igin': notifyscr
-0000c870: 6970 747d 290a 2020 2020 2020 2020 2020  ipt}).          
-0000c880: 2020 2020 2020 2020 2020 6e6f 7469 6679            notify
-0000c890: 636d 6420 3d20 2262 6173 6820 2f72 6f6f  cmd = "bash /roo
-0000c8a0: 742f 2e6e 6f74 6966 792e 7368 220a 2020  t/.notify.sh".  
-0000c8b0: 2020 2020 2020 2020 2020 6e6f 7469 6679            notify
-0000c8c0: 636d 6473 2c20 6d61 696c 636f 6e74 656e  cmds, mailconten
-0000c8d0: 7420 3d20 7365 6c66 2e68 616e 646c 655f  t = self.handle_
-0000c8e0: 6e6f 7469 6669 6361 7469 6f6e 7328 6e61  notifications(na
-0000c8f0: 6d65 2c20 6e6f 7469 6679 6d65 7468 6f64  me, notifymethod
-0000c900: 733d 6e6f 7469 6679 6d65 7468 6f64 732c  s=notifymethods,
-0000c910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c950: 2070 7573 6862 756c 6c65 7474 6f6b 656e   pushbullettoken
-0000c960: 3d70 7573 6862 756c 6c65 7474 6f6b 656e  =pushbullettoken
-0000c970: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9b0: 2020 6e6f 7469 6679 7363 7269 7074 3d6e    notifyscript=n
-0000c9c0: 6f74 6966 7973 6372 6970 742c 206e 6f74  otifyscript, not
-0000c9d0: 6966 7963 6d64 3d6e 6f74 6966 7963 6d64  ifycmd=notifycmd
-0000c9e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006190: 2020 2020 2020 2020 6465 6275 673d 6465          debug=de
+000061a0: 6275 672c 2069 6e73 6563 7572 653d 7365  bug, insecure=se
+000061b0: 6c66 2e69 6e73 6563 7572 652c 2073 6573  lf.insecure, ses
+000061c0: 7369 6f6e 3d73 6573 7369 6f6e 2c20 7265  sion=session, re
+000061d0: 6d6f 7465 646e 736d 6173 713d 7265 6d6f  motednsmasq=remo
+000061e0: 7465 646e 736d 6173 7129 0a20 2020 2020  tednsmasq).     
+000061f0: 2020 2020 2020 2069 6620 6b2e 636f 6e6e         if k.conn
+00006200: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00006210: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00006220: 6622 436f 756c 646e 2774 2063 6f6e 6e65  f"Couldn't conne
+00006230: 6374 2074 6f20 636c 6965 6e74 207b 7365  ct to client {se
+00006240: 6c66 2e63 6c69 656e 747d 2e20 4c65 6176  lf.client}. Leav
+00006250: 696e 672e 2e2e 2229 0a20 2020 2020 2020  ing...").       
+00006260: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00006270: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+00006280: 2066 6f72 2065 7874 7261 636c 6965 6e74   for extraclient
+00006290: 2069 6e20 7365 6c66 2e5f 6578 7472 6163   in self._extrac
+000062a0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+000062b0: 2020 2020 2020 2020 6966 2065 7874 7261          if extra
+000062c0: 636c 6965 6e74 206e 6f74 2069 6e20 7365  client not in se
+000062d0: 6c66 2e69 6e69 3a0a 2020 2020 2020 2020  lf.ini:.        
+000062e0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+000062f0: 696e 6728 6622 4d69 7373 696e 6720 7365  ing(f"Missing se
+00006300: 6374 696f 6e20 666f 7220 636c 6965 6e74  ction for client
+00006310: 207b 6578 7472 6163 6c69 656e 747d 2069   {extraclient} i
+00006320: 6e20 636f 6e66 6967 2066 696c 652e 2054  n config file. T
+00006330: 7279 696e 6720 746f 2063 6f6e 6e65 6374  rying to connect
+00006340: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00006350: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00006360: 6e69 5b65 7874 7261 636c 6965 6e74 5d20  ni[extraclient] 
+00006370: 3d20 7b27 686f 7374 273a 2065 7874 7261  = {'host': extra
+00006380: 636c 6965 6e74 7d0a 2020 2020 2020 2020  client}.        
+00006390: 2020 2020 2020 2020 6320 3d20 4b63 6f6e          c = Kcon
+000063a0: 6669 6728 636c 6965 6e74 3d65 7874 7261  fig(client=extra
+000063b0: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
+000063c0: 2020 2020 2020 2020 6520 3d20 632e 6b0a          e = c.k.
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063e0: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
+000063f0: 735b 6578 7472 6163 6c69 656e 745d 203d  s[extraclient] =
+00006400: 2065 0a20 2020 2020 2020 2020 2020 2020   e.             
+00006410: 2020 2069 6620 652e 636f 6e6e 2069 7320     if e.conn is 
+00006420: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00006430: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00006440: 6622 436f 756c 646e 2774 2063 6f6e 6e65  f"Couldn't conne
+00006450: 6374 2074 6f20 7370 6563 6966 7920 6879  ct to specify hy
+00006460: 7065 7276 6973 6f72 207b 6578 7472 6163  pervisor {extrac
+00006470: 6c69 656e 747d 2e20 4c65 6176 696e 672e  lient}. Leaving.
+00006480: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00006490: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+000064a0: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+000064b0: 2069 6620 6861 7361 7474 7228 7365 6c66   if hasattr(self
+000064c0: 2c20 2761 6c67 6f72 6974 686d 2729 3a0a  , 'algorithm'):.
+000064d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064e0: 6966 2073 656c 662e 616c 676f 7269 7468  if self.algorith
+000064f0: 6d20 3d3d 2027 6672 6565 273a 0a20 2020  m == 'free':.   
+00006500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006510: 2075 7073 7461 7475 7320 3d20 5b27 6163   upstatus = ['ac
+00006520: 7469 7665 272c 2027 7570 272c 2027 7275  tive', 'up', 'ru
+00006530: 6e6e 696e 6727 5d0a 2020 2020 2020 2020  nning'].        
+00006540: 2020 2020 2020 2020 2020 2020 616c 6c63              allc
+00006550: 6c69 7320 3d20 7b73 656c 662e 636c 6965  lis = {self.clie
+00006560: 6e74 3a20 6b7d 0a20 2020 2020 2020 2020  nt: k}.         
+00006570: 2020 2020 2020 2020 2020 2061 6c6c 636c             allcl
+00006580: 6973 2e75 7064 6174 6528 7365 6c66 2e65  is.update(self.e
+00006590: 7874 7261 636c 6965 6e74 7329 0a20 2020  xtraclients).   
+000065a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065b0: 206d 696e 636c 692c 206d 696e 766d 7320   mincli, minvms 
+000065c0: 3d20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  = None, None.   
+000065d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065e0: 2066 6f72 2063 6c69 2069 6e20 616c 6c63   for cli in allc
+000065f0: 6c69 733a 0a20 2020 2020 2020 2020 2020  lis:.           
+00006600: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
+00006610: 766d 7320 3d20 6c65 6e28 5b76 6d20 666f  vms = len([vm fo
+00006620: 7220 766d 2069 6e20 616c 6c63 6c69 735b  r vm in allclis[
+00006630: 636c 695d 2e6c 6973 7428 2920 6966 2076  cli].list() if v
+00006640: 6d5b 2773 7461 7475 7327 5d2e 6c6f 7765  m['status'].lowe
+00006650: 7228 2920 696e 2075 7073 7461 7475 735d  r() in upstatus]
+00006660: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00006670: 2020 2020 2020 2020 2020 6966 206d 696e            if min
+00006680: 766d 7320 6973 204e 6f6e 6520 6f72 2063  vms is None or c
+00006690: 6c69 766d 7320 3c20 6d69 6e76 6d73 3a0a  livms < minvms:.
+000066a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066b0: 2020 2020 2020 2020 2020 2020 6d69 6e63              minc
+000066c0: 6c69 203d 2063 6c69 0a20 2020 2020 2020  li = cli.       
+000066d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066e0: 2020 2020 206d 696e 766d 7320 3d20 636c       minvms = cl
+000066f0: 6976 6d73 0a20 2020 2020 2020 2020 2020  ivms.           
+00006700: 2020 2020 2020 2020 2069 6620 6d69 6e63           if minc
+00006710: 6c69 2021 3d20 7365 6c66 2e63 6c69 656e  li != self.clien
+00006720: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00006730: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006740: 6578 7472 6163 6c69 656e 7473 5b73 656c  extraclients[sel
+00006750: 662e 636c 6965 6e74 5d20 3d20 6b0a 2020  f.client] = k.  
+00006760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006770: 2020 2020 2020 6b20 3d20 7365 6c66 2e65        k = self.e
+00006780: 7874 7261 636c 6965 6e74 735b 6d69 6e63  xtraclients[minc
+00006790: 6c69 5d0a 2020 2020 2020 2020 2020 2020  li].            
+000067a0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+000067b0: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
+000067c0: 735b 6d69 6e63 6c69 5d0a 2020 2020 2020  s[mincli].      
+000067d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000067e0: 2020 7365 6c66 2e63 6c69 656e 7420 3d20    self.client = 
+000067f0: 6d69 6e63 6c69 0a20 2020 2020 2020 2020  mincli.         
+00006800: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
+00006810: 6c67 6f72 6974 686d 203d 3d20 2762 616c  lgorithm == 'bal
+00006820: 616e 6365 273a 0a20 2020 2020 2020 2020  ance':.         
+00006830: 2020 2020 2020 2020 2020 206d 656d 6265             membe
+00006840: 7273 203d 205b 7365 6c66 2e63 6c69 656e  rs = [self.clien
+00006850: 745d 202b 206c 6973 7428 7365 6c66 2e65  t] + list(self.e
+00006860: 7874 7261 636c 6965 6e74 732e 6b65 7973  xtraclients.keys
+00006870: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+00006880: 2020 2020 2020 2020 6c61 7374 766d 203d          lastvm =
+00006890: 2022 2573 2f2e 6b63 6c69 2f76 6d22 2025   "%s/.kcli/vm" %
+000068a0: 206f 732e 656e 7669 726f 6e2e 6765 7428   os.environ.get(
+000068b0: 2748 4f4d 4527 290a 2020 2020 2020 2020  'HOME').        
+000068c0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+000068d0: 732e 7061 7468 2e65 7869 7374 7328 6c61  s.path.exists(la
+000068e0: 7374 766d 2920 616e 6420 6f73 2e73 7461  stvm) and os.sta
+000068f0: 7428 6c61 7374 766d 292e 7374 5f73 697a  t(lastvm).st_siz
+00006900: 6520 3e20 303a 0a20 2020 2020 2020 2020  e > 0:.         
+00006910: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00006920: 6f72 206c 696e 6520 696e 206f 7065 6e28  or line in open(
+00006930: 6c61 7374 766d 292e 7265 6164 6c69 6e65  lastvm).readline
+00006940: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00006950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006960: 206c 696e 6520 3d20 6c69 6e65 2e73 706c   line = line.spl
+00006970: 6974 2827 2027 290a 2020 2020 2020 2020  it(' ').        
+00006980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006990: 2020 2020 6966 206c 656e 286c 696e 6529      if len(line)
+000069a0: 2021 3d20 323a 0a20 2020 2020 2020 2020   != 2:.         
+000069b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069c0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+000069d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069e0: 2020 2020 2020 2020 2020 2020 636c 6920              cli 
+000069f0: 3d20 6c69 6e65 5b30 5d2e 7374 7269 7028  = line[0].strip(
+00006a00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00006a10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006a20: 2063 6c69 2069 6e20 6d65 6d62 6572 7320   cli in members 
+00006a30: 616e 6420 6d65 6d62 6572 732e 696e 6465  and members.inde
+00006a40: 7828 636c 6929 203c 206c 656e 286d 656d  x(cli) < len(mem
+00006a50: 6265 7273 293a 0a20 2020 2020 2020 2020  bers):.         
+00006a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a70: 2020 2020 2020 2063 6c69 696e 6465 7820         cliindex 
+00006a80: 3d20 6d65 6d62 6572 732e 696e 6465 7828  = members.index(
+00006a90: 636c 6929 0a20 2020 2020 2020 2020 2020  cli).           
+00006aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ab0: 2020 2020 206e 6577 636c 6920 3d20 6d65       newcli = me
+00006ac0: 6d62 6572 735b 2863 6c69 696e 6465 7820  mbers[(cliindex 
+00006ad0: 2b20 3129 2025 206c 656e 286d 656d 6265  + 1) % len(membe
+00006ae0: 7273 295d 0a20 2020 2020 2020 2020 2020  rs)].           
+00006af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b00: 2020 2020 2069 6620 6e65 7763 6c69 2021       if newcli !
+00006b10: 3d20 7365 6c66 2e63 6c69 656e 743a 0a20  = self.client:. 
+00006b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b40: 2020 2073 656c 662e 6578 7472 6163 6c69     self.extracli
+00006b50: 656e 7473 5b73 656c 662e 636c 6965 6e74  ents[self.client
+00006b60: 5d20 3d20 6b0a 2020 2020 2020 2020 2020  ] = k.          
+00006b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b80: 2020 2020 2020 2020 2020 6b20 3d20 7365            k = se
+00006b90: 6c66 2e65 7874 7261 636c 6965 6e74 735b  lf.extraclients[
+00006ba0: 6e65 7763 6c69 5d0a 2020 2020 2020 2020  newcli].        
+00006bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bc0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00006bd0: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
+00006be0: 735b 6e65 7763 6c69 5d0a 2020 2020 2020  s[newcli].      
+00006bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c00: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00006c10: 6c66 2e63 6c69 656e 7420 3d20 6e65 7763  lf.client = newc
+00006c20: 6c69 0a20 2020 2020 2020 2020 2020 2020  li.             
+00006c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c40: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
+00006c50: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00006c60: 2866 2253 656c 6563 7469 6e67 2063 6c69  (f"Selecting cli
+00006c70: 656e 7420 7b73 656c 662e 636c 6965 6e74  ent {self.client
+00006c80: 7d20 6672 6f6d 2067 726f 7570 207b 7365  } from group {se
+00006c90: 6c66 2e67 726f 7570 7d22 290a 2020 2020  lf.group}").    
+00006ca0: 2020 2020 7365 6c66 2e6b 203d 206b 0a20      self.k = k. 
+00006cb0: 2020 2020 2020 2064 6566 6175 6c74 5f64         default_d
+00006cc0: 6174 6120 3d20 7b27 636f 6e66 6967 5f25  ata = {'config_%
+00006cd0: 7327 2025 206b 3a20 7365 6c66 2e64 6566  s' % k: self.def
+00006ce0: 6175 6c74 5b6b 5d20 666f 7220 6b20 696e  ault[k] for k in
+00006cf0: 2073 656c 662e 6465 6661 756c 747d 0a20   self.default}. 
+00006d00: 2020 2020 2020 2063 6f6e 6669 675f 6461         config_da
+00006d10: 7461 203d 207b 2763 6f6e 6669 675f 2573  ta = {'config_%s
+00006d20: 2720 2520 6b3a 2073 656c 662e 696e 695b  ' % k: self.ini[
+00006d30: 7365 6c66 2e63 6c69 656e 745d 5b6b 5d20  self.client][k] 
+00006d40: 666f 7220 6b20 696e 2073 656c 662e 696e  for k in self.in
+00006d50: 695b 7365 6c66 2e63 6c69 656e 745d 7d0a  i[self.client]}.
+00006d60: 2020 2020 2020 2020 636f 6e66 6967 5f64          config_d
+00006d70: 6174 615b 2763 6f6e 6669 675f 7479 7065  ata['config_type
+00006d80: 275d 203d 2063 6f6e 6669 675f 6461 7461  '] = config_data
+00006d90: 2e67 6574 2827 636f 6e66 6967 5f74 7970  .get('config_typ
+00006da0: 6527 2c20 276b 766d 2729 0a20 2020 2020  e', 'kvm').     
+00006db0: 2020 2063 6f6e 6669 675f 6461 7461 5b27     config_data['
+00006dc0: 636f 6e66 6967 5f68 6f73 7427 5d20 3d20  config_host'] = 
+00006dd0: 636f 6e66 6967 5f64 6174 612e 6765 7428  config_data.get(
+00006de0: 2763 6f6e 6669 675f 686f 7374 272c 2027  'config_host', '
+00006df0: 3132 372e 302e 302e 3127 290a 2020 2020  127.0.0.1').    
+00006e00: 2020 2020 6465 6661 756c 745f 7573 6572      default_user
+00006e10: 203d 2067 6574 7573 6572 2829 2069 6620   = getuser() if 
+00006e20: 636f 6e66 6967 5f64 6174 615b 2763 6f6e  config_data['con
+00006e30: 6669 675f 7479 7065 275d 203d 3d20 276b  fig_type'] == 'k
+00006e40: 766d 275c 0a20 2020 2020 2020 2020 2020  vm'\.           
+00006e50: 2061 6e64 2073 656c 662e 686f 7374 2069   and self.host i
+00006e60: 6e20 5b27 6c6f 6361 6c68 6f73 7427 2c20  n ['localhost', 
+00006e70: 2731 3237 2e30 2e30 2e31 275d 2065 6c73  '127.0.0.1'] els
+00006e80: 6520 2772 6f6f 7427 0a20 2020 2020 2020  e 'root'.       
+00006e90: 2063 6f6e 6669 675f 6461 7461 5b27 636f   config_data['co
+00006ea0: 6e66 6967 5f75 7365 7227 5d20 3d20 636f  nfig_user'] = co
+00006eb0: 6e66 6967 5f64 6174 612e 6765 7428 2763  nfig_data.get('c
+00006ec0: 6f6e 6669 675f 7573 6572 272c 2064 6566  onfig_user', def
+00006ed0: 6175 6c74 5f75 7365 7229 0a20 2020 2020  ault_user).     
+00006ee0: 2020 2063 6f6e 6669 675f 6461 7461 5b27     config_data['
+00006ef0: 636f 6e66 6967 5f63 6c69 656e 7427 5d20  config_client'] 
+00006f00: 3d20 7365 6c66 2e63 6c69 656e 740a 2020  = self.client.  
+00006f10: 2020 2020 2020 7365 6c66 2e6f 7665 7272        self.overr
+00006f20: 6964 6573 2e75 7064 6174 6528 6465 6661  ides.update(defa
+00006f30: 756c 745f 6461 7461 290a 2020 2020 2020  ult_data).      
+00006f40: 2020 7365 6c66 2e6f 7665 7272 6964 6573    self.overrides
+00006f50: 2e75 7064 6174 6528 636f 6e66 6967 5f64  .update(config_d
+00006f60: 6174 6129 0a0a 2020 2020 6465 6620 6372  ata)..    def cr
+00006f70: 6561 7465 5f76 6d28 7365 6c66 2c20 6e61  eate_vm(self, na
+00006f80: 6d65 2c20 7072 6f66 696c 653d 4e6f 6e65  me, profile=None
+00006f90: 2c20 6f76 6572 7269 6465 733d 7b7d 2c20  , overrides={}, 
+00006fa0: 6375 7374 6f6d 7072 6f66 696c 653d 7b7d  customprofile={}
+00006fb0: 2c20 6b3d 4e6f 6e65 2c0a 2020 2020 2020  , k=None,.      
+00006fc0: 2020 2020 2020 2020 2020 2020 706c 616e              plan
+00006fd0: 3d27 6b76 6972 7427 2c20 6261 7365 6469  ='kvirt', basedi
+00006fe0: 723d 272e 272c 2063 6c69 656e 743d 4e6f  r='.', client=No
+00006ff0: 6e65 2c20 6f6e 666c 793d 4e6f 6e65 2c20  ne, onfly=None, 
+00007000: 6f6e 6c79 6173 7365 7473 3d46 616c 7365  onlyassets=False
+00007010: 293a 0a20 2020 2020 2020 206f 7665 7272  ):.        overr
+00007020: 6964 6573 2e75 7064 6174 6528 7365 6c66  ides.update(self
+00007030: 2e6f 7665 7272 6964 6573 290a 2020 2020  .overrides).    
+00007040: 2020 2020 7772 6f6e 675f 6f76 6572 7269      wrong_overri
+00007050: 6465 7320 3d20 5b79 2066 6f72 2079 2069  des = [y for y i
+00007060: 6e20 6f76 6572 7269 6465 7320 6966 2027  n overrides if '
+00007070: 2d27 2069 6e20 795d 0a20 2020 2020 2020  -' in y].       
+00007080: 2069 6620 7772 6f6e 675f 6f76 6572 7269   if wrong_overri
+00007090: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
+000070a0: 2066 6f72 2077 726f 6e67 5f6f 7665 7272   for wrong_overr
+000070b0: 6964 6520 696e 2077 726f 6e67 5f6f 7665  ide in wrong_ove
+000070c0: 7272 6964 6573 3a0a 2020 2020 2020 2020  rrides:.        
+000070d0: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+000070e0: 496e 636f 7272 6563 7420 7061 7261 6d65  Incorrect parame
+000070f0: 7465 7220 7b77 726f 6e67 5f6f 7665 7272  ter {wrong_overr
+00007100: 6964 6573 7d2e 2048 7970 6865 6e73 2061  ides}. Hyphens a
+00007110: 7265 206e 6f74 2061 6c6c 6f77 6564 2229  re not allowed")
+00007120: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00007130: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00007140: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
+00007150: 6e27 3a20 2749 6e63 6f72 7265 6374 2070  n': 'Incorrect p
+00007160: 6172 616d 6574 6572 7320 666f 756e 6427  arameters found'
+00007170: 7d0a 2020 2020 2020 2020 6f76 6572 7269  }.        overri
+00007180: 6465 735b 276e 616d 6527 5d20 3d20 6e61  des['name'] = na
+00007190: 6d65 0a20 2020 2020 2020 206b 7562 6520  me.        kube 
+000071a0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+000071b0: 276b 7562 6527 290a 2020 2020 2020 2020  'kube').        
+000071c0: 6b75 6265 7479 7065 203d 206f 7665 7272  kubetype = overr
+000071d0: 6964 6573 2e67 6574 2827 6b75 6265 7479  ides.get('kubety
+000071e0: 7065 2729 0a20 2020 2020 2020 206b 203d  pe').        k =
+000071f0: 2073 656c 662e 6b20 6966 206b 2069 7320   self.k if k is 
+00007200: 4e6f 6e65 2065 6c73 6520 6b0a 2020 2020  None else k.    
+00007210: 2020 2020 6375 7374 6f6d 5f72 6567 696f      custom_regio
+00007220: 6e20 3d20 6e65 7874 2828 6520 666f 7220  n = next((e for 
+00007230: 6520 696e 205b 6375 7374 6f6d 7072 6f66  e in [customprof
+00007240: 696c 652e 6765 7428 2772 6567 696f 6e27  ile.get('region'
+00007250: 292c 206f 7665 7272 6964 6573 2e67 6574  ), overrides.get
+00007260: 2827 7265 6769 6f6e 2729 5d20 6966 2065  ('region')] if e
+00007270: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
+00007280: 6f6e 6529 0a20 2020 2020 2020 2069 6620  one).        if 
+00007290: 6375 7374 6f6d 5f72 6567 696f 6e20 6973  custom_region is
+000072a0: 206e 6f74 204e 6f6e 6520 616e 6420 6861   not None and ha
+000072b0: 7361 7474 7228 6b2c 2027 7265 6769 6f6e  sattr(k, 'region
+000072c0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+000072d0: 6b2e 7265 6769 6f6e 203d 2063 7573 746f  k.region = custo
+000072e0: 6d5f 7265 6769 6f6e 0a20 2020 2020 2020  m_region.       
+000072f0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+00007300: 6b2c 2027 7a6f 6e65 2729 2061 6e64 2063  k, 'zone') and c
+00007310: 7573 746f 6d5f 7265 6769 6f6e 206e 6f74  ustom_region not
+00007320: 2069 6e20 6b2e 7a6f 6e65 3a0a 2020 2020   in k.zone:.    
+00007330: 2020 2020 2020 2020 2020 2020 6b2e 7a6f              k.zo
+00007340: 6e65 203d 2066 227b 6375 7374 6f6d 5f72  ne = f"{custom_r
+00007350: 6567 696f 6e7d 2d32 220a 2020 2020 2020  egion}-2".      
+00007360: 2020 2020 2020 6966 2073 656c 662e 7479        if self.ty
+00007370: 7065 203d 3d20 2769 626d 273a 0a20 2020  pe == 'ibm':.   
+00007380: 2020 2020 2020 2020 2020 2020 206b 2e63               k.c
+00007390: 6f6e 6e2e 7365 745f 7365 7276 6963 655f  onn.set_service_
+000073a0: 7572 6c28 6622 6874 7470 733a 2f2f 7b63  url(f"https://{c
+000073b0: 7573 746f 6d5f 7265 6769 6f6e 7d2e 6961  ustom_region}.ia
+000073c0: 6173 2e63 6c6f 7564 2e69 626d 2e63 6f6d  as.cloud.ibm.com
+000073d0: 2f76 3122 290a 2020 2020 2020 2020 6375  /v1").        cu
+000073e0: 7374 6f6d 5f7a 6f6e 6520 3d20 6e65 7874  stom_zone = next
+000073f0: 2828 6520 666f 7220 6520 696e 205b 6375  ((e for e in [cu
+00007400: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+00007410: 277a 6f6e 6527 292c 206f 7665 7272 6964  'zone'), overrid
+00007420: 6573 2e67 6574 2827 7a6f 6e65 2729 5d20  es.get('zone')] 
+00007430: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
+00007440: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
+00007450: 2069 6620 6375 7374 6f6d 5f7a 6f6e 6520   if custom_zone 
+00007460: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00007470: 6861 7361 7474 7228 6b2c 2027 7a6f 6e65  hasattr(k, 'zone
+00007480: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+00007490: 6b2e 7a6f 6e65 203d 2063 7573 746f 6d5f  k.zone = custom_
+000074a0: 7a6f 6e65 0a20 2020 2020 2020 2020 2020  zone.           
+000074b0: 2069 6620 6861 7361 7474 7228 6b2c 2027   if hasattr(k, '
+000074c0: 7265 6769 6f6e 2729 2061 6e64 206b 2e72  region') and k.r
+000074d0: 6567 696f 6e20 6e6f 7420 696e 206b 2e7a  egion not in k.z
+000074e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000074f0: 2020 2020 206b 2e72 6567 696f 6e20 3d20       k.region = 
+00007500: 6375 7374 6f6d 5f7a 6f6e 655b 3a2d 325d  custom_zone[:-2]
+00007510: 0a20 2020 2020 2020 2074 756e 6e65 6c20  .        tunnel 
+00007520: 3d20 7365 6c66 2e74 756e 6e65 6c0a 2020  = self.tunnel.  
+00007530: 2020 2020 2020 7072 6f66 696c 6520 3d20        profile = 
+00007540: 7072 6f66 696c 6520 6f72 206f 7665 7272  profile or overr
+00007550: 6964 6573 2e67 6574 2827 696d 6167 6527  ides.get('image'
+00007560: 2c20 276b 7669 7274 2729 0a20 2020 2020  , 'kvirt').     
+00007570: 2020 2066 756c 6c5f 766f 6c75 6d65 7320     full_volumes 
+00007580: 3d20 7365 6c66 2e6b 2e76 6f6c 756d 6573  = self.k.volumes
+00007590: 2829 0a20 2020 2020 2020 2076 6f6c 756d  ().        volum
+000075a0: 6573 203d 205b 6f73 2e70 6174 682e 6261  es = [os.path.ba
+000075b0: 7365 6e61 6d65 2876 2920 666f 7220 7620  sename(v) for v 
+000075c0: 696e 2066 756c 6c5f 766f 6c75 6d65 735d  in full_volumes]
+000075d0: 0a20 2020 2020 2020 2076 6d70 726f 6669  .        vmprofi
+000075e0: 6c65 7320 3d20 7b6b 3a20 7620 666f 7220  les = {k: v for 
+000075f0: 6b2c 2076 2069 6e20 7365 6c66 2e70 726f  k, v in self.pro
+00007600: 6669 6c65 732e 6974 656d 7328 2920 6966  files.items() if
+00007610: 2027 7479 7065 2720 6e6f 7420 696e 2076   'type' not in v
+00007620: 206f 7220 765b 2774 7970 6527 5d20 3d3d   or v['type'] ==
+00007630: 2027 766d 277d 0a20 2020 2020 2020 2069   'vm'}.        i
+00007640: 6620 6375 7374 6f6d 7072 6f66 696c 653a  f customprofile:
+00007650: 0a20 2020 2020 2020 2020 2020 2076 6d70  .            vmp
+00007660: 726f 6669 6c65 735b 7072 6f66 696c 655d  rofiles[profile]
+00007670: 203d 2063 7573 746f 6d70 726f 6669 6c65   = customprofile
+00007680: 0a20 2020 2020 2020 2065 6c69 6620 7072  .        elif pr
+00007690: 6f66 696c 6520 696e 2076 6d70 726f 6669  ofile in vmprofi
+000076a0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+000076b0: 2070 7072 696e 7428 6622 4465 706c 6f79   pprint(f"Deploy
+000076c0: 696e 6720 766d 207b 6e61 6d65 7d20 6672  ing vm {name} fr
+000076d0: 6f6d 2070 726f 6669 6c65 207b 7072 6f66  om profile {prof
+000076e0: 696c 657d 2e2e 2e22 290a 2020 2020 2020  ile}...").      
+000076f0: 2020 656c 6966 2073 656c 662e 7479 7065    elif self.type
+00007700: 2069 6e20 636c 6f75 6470 6c61 7466 6f72   in cloudplatfor
+00007710: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00007720: 766d 7072 6f66 696c 6573 5b70 726f 6669  vmprofiles[profi
+00007730: 6c65 5d20 3d20 7b27 696d 6167 6527 3a20  le] = {'image': 
+00007740: 7072 6f66 696c 657d 0a20 2020 2020 2020  profile}.       
+00007750: 2065 6c69 6620 286f 732e 7061 7468 2e62   elif (os.path.b
+00007760: 6173 656e 616d 6528 7072 6f66 696c 6529  asename(profile)
+00007770: 203d 3d20 7072 6f66 696c 6520 616e 6420   == profile and 
+00007780: 7072 6f66 696c 6520 696e 2076 6f6c 756d  profile in volum
+00007790: 6573 2920 6f72 2070 726f 6669 6c65 2069  es) or profile i
+000077a0: 6e20 6675 6c6c 5f76 6f6c 756d 6573 3a0a  n full_volumes:.
+000077b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000077c0: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
+000077d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000077e0: 7072 696e 7428 6622 4465 706c 6f79 696e  print(f"Deployin
+000077f0: 6720 766d 207b 6e61 6d65 7d20 6672 6f6d  g vm {name} from
+00007800: 2069 6d61 6765 207b 7072 6f66 696c 657d   image {profile}
+00007810: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00007820: 2020 6e65 775f 7072 6f66 696c 6520 3d20    new_profile = 
+00007830: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00007840: 2870 726f 6669 6c65 290a 2020 2020 2020  (profile).      
+00007850: 2020 2020 2020 766d 7072 6f66 696c 6573        vmprofiles
+00007860: 5b6e 6577 5f70 726f 6669 6c65 5d20 3d20  [new_profile] = 
+00007870: 7b27 696d 6167 6527 3a20 7072 6f66 696c  {'image': profil
+00007880: 657d 0a20 2020 2020 2020 2020 2020 2070  e}.            p
+00007890: 726f 6669 6c65 203d 206e 6577 5f70 726f  rofile = new_pro
+000078a0: 6669 6c65 0a20 2020 2020 2020 2065 6c69  file.        eli
+000078b0: 6620 7072 6f66 696c 6520 696e 2049 4d41  f profile in IMA
+000078c0: 4745 5320 6f72 2070 726f 6669 6c65 203d  GES or profile =
+000078d0: 3d20 2772 6863 6f73 3430 3030 273a 0a20  = 'rhcos4000':. 
+000078e0: 2020 2020 2020 2020 2020 2076 6d70 726f             vmpro
+000078f0: 6669 6c65 735b 7072 6f66 696c 655d 203d  files[profile] =
+00007900: 207b 2769 6d61 6765 273a 2070 726f 6669   {'image': profi
+00007910: 6c65 7d0a 2020 2020 2020 2020 656c 6966  le}.        elif
+00007920: 2070 726f 6669 6c65 2e73 7461 7274 7377   profile.startsw
+00007930: 6974 6828 2772 6863 6f73 2d34 2729 2061  ith('rhcos-4') a
+00007940: 6e64 2070 726f 6669 6c65 2e65 6e64 7377  nd profile.endsw
+00007950: 6974 6828 2771 636f 7732 2729 2061 6e64  ith('qcow2') and
+00007960: 2073 656c 662e 7479 7065 206e 6f74 2069   self.type not i
+00007970: 6e20 636c 6f75 6470 6c61 7466 6f72 6d73  n cloudplatforms
+00007980: 3a0a 2020 2020 2020 2020 2020 2020 766d  :.            vm
+00007990: 7072 6f66 696c 6573 5b70 726f 6669 6c65  profiles[profile
+000079a0: 5d20 3d20 7b27 696d 6167 6527 3a20 7072  ] = {'image': pr
+000079b0: 6f66 696c 657d 0a20 2020 2020 2020 2065  ofile}.        e
+000079c0: 6c69 6620 7072 6f66 696c 6520 3d3d 2027  lif profile == '
+000079d0: 6b76 6972 7427 3a0a 2020 2020 2020 2020  kvirt':.        
+000079e0: 2020 2020 766d 7072 6f66 696c 6573 5b70      vmprofiles[p
+000079f0: 726f 6669 6c65 5d20 3d20 7b7d 0a20 2020  rofile] = {}.   
+00007a00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00007a10: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00007a20: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+00007a30: 6527 2c20 2772 6561 736f 6e27 3a20 6627  e', 'reason': f'
+00007a40: 496d 6167 6520 7b70 726f 6669 6c65 7d20  Image {profile} 
+00007a50: 6e6f 7420 666f 756e 6427 7d0a 2020 2020  not found'}.    
+00007a60: 2020 2020 7072 6f66 696c 656e 616d 6520      profilename 
+00007a70: 3d20 7072 6f66 696c 650a 2020 2020 2020  = profile.      
+00007a80: 2020 7072 6f66 696c 6520 3d20 766d 7072    profile = vmpr
+00007a90: 6f66 696c 6573 5b70 726f 6669 6c65 5d0a  ofiles[profile].
+00007aa0: 2020 2020 2020 2020 7069 6d61 6765 203d          pimage =
+00007ab0: 2070 726f 6669 6c65 2e67 6574 2827 696d   profile.get('im
+00007ac0: 6167 6527 2c20 2758 5858 2729 0a20 2020  age', 'XXX').   
+00007ad0: 2020 2020 2069 6620 6e6f 7420 6f6e 6c79       if not only
+00007ae0: 6173 7365 7473 2061 6e64 2073 656c 662e  assets and self.
+00007af0: 7479 7065 206e 6f74 2069 6e20 636c 6f75  type not in clou
+00007b00: 6470 6c61 7466 6f72 6d73 2061 6e64 2070  dplatforms and p
+00007b10: 696d 6167 6520 696e 2049 4d41 4745 5320  image in IMAGES 
+00007b20: 616e 6420 7069 6d61 6765 206e 6f74 2069  and pimage not i
+00007b30: 6e20 766f 6c75 6d65 733a 0a20 2020 2020  n volumes:.     
+00007b40: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00007b50: 496d 6167 6520 7b70 696d 6167 657d 206e  Image {pimage} n
+00007b60: 6f74 2066 6f75 6e64 2e20 446f 776e 6c6f  ot found. Downlo
+00007b70: 6164 696e 6722 290a 2020 2020 2020 2020  ading").        
+00007b80: 2020 2020 7069 6d61 6765 5f64 6174 6120      pimage_data 
+00007b90: 3d20 7b27 706f 6f6c 273a 2073 656c 662e  = {'pool': self.
+00007ba0: 706f 6f6c 2c20 2769 6d61 6765 273a 2070  pool, 'image': p
+00007bb0: 696d 6167 652c 2027 646f 776e 6c6f 6164  image, 'download
+00007bc0: 273a 2054 7275 657d 0a20 2020 2020 2020  ': True}.       
+00007bd0: 2020 2020 2070 696d 6167 655f 7369 7a65       pimage_size
+00007be0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+00007bf0: 6b75 6265 7669 7274 5f64 6973 6b5f 7369  kubevirt_disk_si
+00007c00: 7a65 2729 206f 7220 7072 6f66 696c 652e  ze') or profile.
+00007c10: 6765 7428 2773 697a 6527 290a 2020 2020  get('size').    
+00007c20: 2020 2020 2020 2020 6966 2070 696d 6167          if pimag
+00007c30: 655f 7369 7a65 2069 7320 6e6f 7420 4e6f  e_size is not No
+00007c40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007c50: 2020 2020 7069 6d61 6765 5f64 6174 615b      pimage_data[
+00007c60: 2773 697a 6527 5d20 3d20 7069 6d61 6765  'size'] = pimage
+00007c70: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
+00007c80: 2020 6966 2070 726f 6669 6c65 6e61 6d65    if profilename
+00007c90: 2e73 7461 7274 7377 6974 6828 2772 6863  .startswith('rhc
+00007ca0: 6f73 2d34 2729 2061 6e64 2070 726f 6669  os-4') and profi
+00007cb0: 6c65 6e61 6d65 2e65 6e64 7377 6974 6828  lename.endswith(
+00007cc0: 2771 636f 7732 2729 3a0a 2020 2020 2020  'qcow2'):.      
+00007cd0: 2020 2020 2020 2020 2020 7069 6d61 6765            pimage
+00007ce0: 5f64 6174 615b 2769 6d61 6765 275d 203d  _data['image'] =
+00007cf0: 2070 726f 6669 6c65 6e61 6d65 2e73 706c   profilename.spl
+00007d00: 6974 2827 2e27 295b 305d 2e72 6570 6c61  it('.')[0].repla
+00007d10: 6365 2827 7268 636f 732d 3427 2c20 2772  ce('rhcos-4', 'r
+00007d20: 6863 6f73 3427 290a 2020 2020 2020 2020  hcos4').        
+00007d30: 2020 2020 2020 2020 7069 6d61 6765 5f64          pimage_d
+00007d40: 6174 615b 2775 726c 275d 203d 2067 6574  ata['url'] = get
+00007d50: 5f72 6863 6f73 5f75 726c 5f66 726f 6d5f  _rhcos_url_from_
+00007d60: 6669 6c65 2870 726f 6669 6c65 6e61 6d65  file(profilename
+00007d70: 2c20 5f74 7970 653d 7365 6c66 2e74 7970  , _type=self.typ
+00007d80: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+00007d90: 656c 662e 6861 6e64 6c65 5f68 6f73 7428  elf.handle_host(
+00007da0: 2a2a 7069 6d61 6765 5f64 6174 6129 0a20  **pimage_data). 
+00007db0: 2020 2020 2020 2069 6620 6e6f 7420 6375         if not cu
+00007dc0: 7374 6f6d 7072 6f66 696c 653a 0a20 2020  stomprofile:.   
+00007dd0: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
+00007de0: 2e75 7064 6174 6528 6f76 6572 7269 6465  .update(override
+00007df0: 7329 0a20 2020 2020 2020 2069 6620 2762  s).        if 'b
+00007e00: 6173 6527 2069 6e20 7072 6f66 696c 653a  ase' in profile:
+00007e10: 0a20 2020 2020 2020 2020 2020 2066 6174  .            fat
+00007e20: 6865 7220 3d20 766d 7072 6f66 696c 6573  her = vmprofiles
+00007e30: 5b70 726f 6669 6c65 5b27 6261 7365 275d  [profile['base']
+00007e40: 5d0a 2020 2020 2020 2020 2020 2020 6465  ].            de
+00007e50: 6661 756c 745f 6e75 6d63 7075 7320 3d20  fault_numcpus = 
+00007e60: 6661 7468 6572 2e67 6574 2827 6e75 6d63  father.get('numc
+00007e70: 7075 7327 2c20 7365 6c66 2e6e 756d 6370  pus', self.numcp
+00007e80: 7573 290a 2020 2020 2020 2020 2020 2020  us).            
+00007e90: 6465 6661 756c 745f 6d65 6d6f 7279 203d  default_memory =
+00007ea0: 2066 6174 6865 722e 6765 7428 276d 656d   father.get('mem
+00007eb0: 6f72 7927 2c20 7365 6c66 2e6d 656d 6f72  ory', self.memor
+00007ec0: 7929 0a20 2020 2020 2020 2020 2020 2064  y).            d
+00007ed0: 6566 6175 6c74 5f70 6f6f 6c20 3d20 6661  efault_pool = fa
+00007ee0: 7468 6572 2e67 6574 2827 706f 6f6c 272c  ther.get('pool',
+00007ef0: 2073 656c 662e 706f 6f6c 290a 2020 2020   self.pool).    
+00007f00: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00007f10: 6469 736b 7320 3d20 6661 7468 6572 2e67  disks = father.g
+00007f20: 6574 2827 6469 736b 7327 2c20 7365 6c66  et('disks', self
+00007f30: 2e64 6973 6b73 290a 2020 2020 2020 2020  .disks).        
+00007f40: 2020 2020 6465 6661 756c 745f 6e65 7473      default_nets
+00007f50: 203d 2066 6174 6865 722e 6765 7428 276e   = father.get('n
+00007f60: 6574 7327 2c20 7365 6c66 2e6e 6574 7329  ets', self.nets)
+00007f70: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00007f80: 6175 6c74 5f69 6d61 6765 203d 2066 6174  ault_image = fat
+00007f90: 6865 722e 6765 7428 2769 6d61 6765 272c  her.get('image',
+00007fa0: 2073 656c 662e 696d 6167 6529 0a20 2020   self.image).   
+00007fb0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00007fc0: 5f63 6c6f 7564 696e 6974 203d 2066 6174  _cloudinit = fat
+00007fd0: 6865 722e 6765 7428 2763 6c6f 7564 696e  her.get('cloudin
+00007fe0: 6974 272c 2073 656c 662e 636c 6f75 6469  it', self.cloudi
+00007ff0: 6e69 7429 0a20 2020 2020 2020 2020 2020  nit).           
+00008000: 2064 6566 6175 6c74 5f6e 6573 7465 6420   default_nested 
+00008010: 3d20 6661 7468 6572 2e67 6574 2827 6e65  = father.get('ne
+00008020: 7374 6564 272c 2073 656c 662e 6e65 7374  sted', self.nest
+00008030: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
+00008040: 6465 6661 756c 745f 7265 7365 7276 6564  default_reserved
+00008050: 6e73 203d 2066 6174 6865 722e 6765 7428  ns = father.get(
+00008060: 2772 6573 6572 7665 646e 7327 2c20 7365  'reservedns', se
+00008070: 6c66 2e72 6573 6572 7665 646e 7329 0a20  lf.reservedns). 
+00008080: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008090: 6c74 5f72 6573 6572 7665 686f 7374 203d  lt_reservehost =
+000080a0: 2066 6174 6865 722e 6765 7428 2772 6573   father.get('res
+000080b0: 6572 7665 686f 7374 272c 2073 656c 662e  ervehost', self.
+000080c0: 7265 7365 7276 6568 6f73 7429 0a20 2020  reservehost).   
+000080d0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+000080e0: 5f63 7075 6d6f 6465 6c20 3d20 6661 7468  _cpumodel = fath
+000080f0: 6572 2e67 6574 2827 6370 756d 6f64 656c  er.get('cpumodel
+00008100: 272c 2073 656c 662e 6370 756d 6f64 656c  ', self.cpumodel
+00008110: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00008120: 6661 756c 745f 6370 7566 6c61 6773 203d  fault_cpuflags =
+00008130: 2066 6174 6865 722e 6765 7428 2763 7075   father.get('cpu
+00008140: 666c 6167 7327 2c20 7365 6c66 2e63 7075  flags', self.cpu
+00008150: 666c 6167 7329 0a20 2020 2020 2020 2020  flags).         
+00008160: 2020 2064 6566 6175 6c74 5f63 7075 7069     default_cpupi
+00008170: 6e6e 696e 6720 3d20 6661 7468 6572 2e67  nning = father.g
+00008180: 6574 2827 6370 7570 696e 6e69 6e67 272c  et('cpupinning',
+00008190: 2073 656c 662e 6370 7570 696e 6e69 6e67   self.cpupinning
+000081a0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+000081b0: 6661 756c 745f 6469 736b 7369 7a65 203d  fault_disksize =
+000081c0: 2066 6174 6865 722e 6765 7428 2764 6973   father.get('dis
+000081d0: 6b73 697a 6527 2c20 7365 6c66 2e64 6973  ksize', self.dis
+000081e0: 6b73 697a 6529 0a20 2020 2020 2020 2020  ksize).         
+000081f0: 2020 2064 6566 6175 6c74 5f64 6973 6b69     default_diski
+00008200: 6e74 6572 6661 6365 203d 2066 6174 6865  nterface = fathe
+00008210: 722e 6765 7428 2764 6973 6b69 6e74 6572  r.get('diskinter
+00008220: 6661 6365 272c 2073 656c 662e 6469 736b  face', self.disk
+00008230: 696e 7465 7266 6163 6529 0a20 2020 2020  interface).     
+00008240: 2020 2020 2020 2064 6566 6175 6c74 5f64         default_d
+00008250: 6973 6b74 6869 6e20 3d20 6661 7468 6572  iskthin = father
+00008260: 2e67 6574 2827 6469 736b 7468 696e 272c  .get('diskthin',
+00008270: 2073 656c 662e 6469 736b 7468 696e 290a   self.diskthin).
+00008280: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008290: 756c 745f 6775 6573 7469 6420 3d20 6661  ult_guestid = fa
+000082a0: 7468 6572 2e67 6574 2827 6775 6573 7469  ther.get('guesti
+000082b0: 6427 2c20 7365 6c66 2e67 7565 7374 6964  d', self.guestid
+000082c0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+000082d0: 6661 756c 745f 6973 6f20 3d20 6661 7468  fault_iso = fath
+000082e0: 6572 2e67 6574 2827 6973 6f27 2c20 7365  er.get('iso', se
+000082f0: 6c66 2e69 736f 290a 2020 2020 2020 2020  lf.iso).        
+00008300: 2020 2020 6465 6661 756c 745f 766e 6320      default_vnc 
+00008310: 3d20 6661 7468 6572 2e67 6574 2827 766e  = father.get('vn
+00008320: 6327 2c20 7365 6c66 2e76 6e63 290a 2020  c', self.vnc).  
+00008330: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008340: 745f 7265 7365 7276 6569 7020 3d20 6661  t_reserveip = fa
+00008350: 7468 6572 2e67 6574 2827 7265 7365 7276  ther.get('reserv
+00008360: 6569 7027 2c20 7365 6c66 2e72 6573 6572  eip', self.reser
+00008370: 7665 6970 290a 2020 2020 2020 2020 2020  veip).          
+00008380: 2020 6465 6661 756c 745f 7374 6172 7420    default_start 
+00008390: 3d20 6661 7468 6572 2e67 6574 2827 7374  = father.get('st
+000083a0: 6172 7427 2c20 7365 6c66 2e73 7461 7274  art', self.start
+000083b0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+000083c0: 6661 756c 745f 6175 746f 7374 6172 7420  fault_autostart 
+000083d0: 3d20 6661 7468 6572 2e67 6574 2827 6175  = father.get('au
+000083e0: 746f 7374 6172 7427 2c20 7365 6c66 2e61  tostart', self.a
+000083f0: 7574 6f73 7461 7274 290a 2020 2020 2020  utostart).      
+00008400: 2020 2020 2020 6465 6661 756c 745f 6b65        default_ke
+00008410: 7973 203d 2066 6174 6865 722e 6765 7428  ys = father.get(
+00008420: 276b 6579 7327 2c20 7365 6c66 2e6b 6579  'keys', self.key
+00008430: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
+00008440: 6566 6175 6c74 5f6e 6574 6d61 736b 7320  efault_netmasks 
+00008450: 3d20 6661 7468 6572 2e67 6574 2827 6e65  = father.get('ne
+00008460: 746d 6173 6b73 272c 2073 656c 662e 6e65  tmasks', self.ne
+00008470: 746d 6173 6b73 290a 2020 2020 2020 2020  tmasks).        
+00008480: 2020 2020 6465 6661 756c 745f 6761 7465      default_gate
+00008490: 7761 7920 3d20 6661 7468 6572 2e67 6574  way = father.get
+000084a0: 2827 6761 7465 7761 7927 2c20 7365 6c66  ('gateway', self
+000084b0: 2e67 6174 6577 6179 290a 2020 2020 2020  .gateway).      
+000084c0: 2020 2020 2020 6465 6661 756c 745f 646e        default_dn
+000084d0: 7320 3d20 6661 7468 6572 2e67 6574 2827  s = father.get('
+000084e0: 646e 7327 2c20 7365 6c66 2e64 6e73 290a  dns', self.dns).
+000084f0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008500: 756c 745f 646f 6d61 696e 203d 2066 6174  ult_domain = fat
+00008510: 6865 722e 6765 7428 2764 6f6d 6169 6e27  her.get('domain'
+00008520: 2c20 7365 6c66 2e64 6f6d 6169 6e29 0a20  , self.domain). 
+00008530: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008540: 6c74 5f66 696c 6573 203d 2066 6174 6865  lt_files = fathe
+00008550: 722e 6765 7428 2766 696c 6573 272c 2073  r.get('files', s
+00008560: 656c 662e 6669 6c65 7329 0a20 2020 2020  elf.files).     
+00008570: 2020 2020 2020 2064 6566 6175 6c74 5f65         default_e
+00008580: 6e61 626c 6572 6f6f 7420 3d20 6661 7468  nableroot = fath
+00008590: 6572 2e67 6574 2827 656e 6162 6c65 726f  er.get('enablero
+000085a0: 6f74 272c 2073 656c 662e 656e 6162 6c65  ot', self.enable
+000085b0: 726f 6f74 290a 2020 2020 2020 2020 2020  root).          
+000085c0: 2020 6465 6661 756c 745f 7072 6976 6174    default_privat
+000085d0: 656b 6579 203d 2066 6174 6865 722e 6765  ekey = father.ge
+000085e0: 7428 2770 7269 7661 7465 6b65 7927 2c20  t('privatekey', 
+000085f0: 7365 6c66 2e70 7269 7661 7465 6b65 7929  self.privatekey)
+00008600: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00008610: 6175 6c74 5f6e 6574 776f 726b 7761 6974  ault_networkwait
+00008620: 203d 2066 6174 6865 722e 6765 7428 276e   = father.get('n
+00008630: 6574 776f 726b 7761 6974 272c 2073 656c  etworkwait', sel
+00008640: 662e 6e65 7477 6f72 6b77 6169 7429 0a20  f.networkwait). 
+00008650: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008660: 6c74 5f72 686e 7265 6769 7374 6572 203d  lt_rhnregister =
+00008670: 2066 6174 6865 722e 6765 7428 2772 686e   father.get('rhn
+00008680: 7265 6769 7374 6572 272c 2073 656c 662e  register', self.
+00008690: 7268 6e72 6567 6973 7465 7229 0a20 2020  rhnregister).   
+000086a0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+000086b0: 5f72 686e 7365 7276 6572 203d 2066 6174  _rhnserver = fat
+000086c0: 6865 722e 6765 7428 2772 686e 7365 7276  her.get('rhnserv
+000086d0: 6572 272c 2073 656c 662e 7268 6e73 6572  er', self.rhnser
+000086e0: 7665 7229 0a20 2020 2020 2020 2020 2020  ver).           
+000086f0: 2064 6566 6175 6c74 5f72 686e 7573 6572   default_rhnuser
+00008700: 203d 2066 6174 6865 722e 6765 7428 2772   = father.get('r
+00008710: 686e 7573 6572 272c 2073 656c 662e 7268  hnuser', self.rh
+00008720: 6e75 7365 7229 0a20 2020 2020 2020 2020  nuser).         
+00008730: 2020 2064 6566 6175 6c74 5f72 686e 7061     default_rhnpa
+00008740: 7373 776f 7264 203d 2066 6174 6865 722e  ssword = father.
+00008750: 6765 7428 2772 686e 7061 7373 776f 7264  get('rhnpassword
+00008760: 272c 2073 656c 662e 7268 6e70 6173 7377  ', self.rhnpassw
+00008770: 6f72 6429 0a20 2020 2020 2020 2020 2020  ord).           
+00008780: 2064 6566 6175 6c74 5f72 686e 616b 203d   default_rhnak =
+00008790: 2066 6174 6865 722e 6765 7428 2772 686e   father.get('rhn
+000087a0: 6163 7469 7661 7469 6f6e 6b65 7927 2c20  activationkey', 
+000087b0: 7365 6c66 2e72 686e 616b 290a 2020 2020  self.rhnak).    
+000087c0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+000087d0: 7268 6e6f 7267 203d 2066 6174 6865 722e  rhnorg = father.
+000087e0: 6765 7428 2772 686e 6f72 6727 2c20 7365  get('rhnorg', se
+000087f0: 6c66 2e72 686e 6f72 6729 0a20 2020 2020  lf.rhnorg).     
+00008800: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
+00008810: 686e 706f 6f6c 203d 2066 6174 6865 722e  hnpool = father.
+00008820: 6765 7428 2772 686e 706f 6f6c 272c 2073  get('rhnpool', s
+00008830: 656c 662e 7268 6e70 6f6f 6c29 0a20 2020  elf.rhnpool).   
+00008840: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00008850: 5f74 6167 7320 3d20 6661 7468 6572 2e67  _tags = father.g
+00008860: 6574 2827 7461 6773 272c 2073 656c 662e  et('tags', self.
+00008870: 7461 6773 290a 2020 2020 2020 2020 2020  tags).          
+00008880: 2020 6465 6661 756c 745f 666c 6176 6f72    default_flavor
+00008890: 203d 2066 6174 6865 722e 6765 7428 2766   = father.get('f
+000088a0: 6c61 766f 7227 2c20 7365 6c66 2e66 6c61  lavor', self.fla
+000088b0: 766f 7229 0a20 2020 2020 2020 2020 2020  vor).           
+000088c0: 2064 6566 6175 6c74 5f63 6d64 7320 3d20   default_cmds = 
+000088d0: 636f 6d6d 6f6e 2e72 656d 6f76 655f 6475  common.remove_du
+000088e0: 706c 6963 6174 6573 2873 656c 662e 636d  plicates(self.cm
+000088f0: 6473 202b 2066 6174 6865 722e 6765 7428  ds + father.get(
+00008900: 2763 6d64 7327 2c20 5b5d 2929 0a20 2020  'cmds', [])).   
+00008910: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00008920: 5f73 6372 6970 7473 203d 2063 6f6d 6d6f  _scripts = commo
+00008930: 6e2e 7265 6d6f 7665 5f64 7570 6c69 6361  n.remove_duplica
+00008940: 7465 7328 7365 6c66 2e73 6372 6970 7473  tes(self.scripts
+00008950: 202b 2066 6174 6865 722e 6765 7428 2773   + father.get('s
+00008960: 6372 6970 7473 272c 205b 5d29 290a 2020  cripts', [])).  
+00008970: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008980: 745f 646e 7363 6c69 656e 7420 3d20 6661  t_dnsclient = fa
+00008990: 7468 6572 2e67 6574 2827 646e 7363 6c69  ther.get('dnscli
+000089a0: 656e 7427 2c20 7365 6c66 2e64 6e73 636c  ent', self.dnscl
+000089b0: 6965 6e74 290a 2020 2020 2020 2020 2020  ient).          
+000089c0: 2020 6465 6661 756c 745f 7374 6f72 656d    default_storem
+000089d0: 6574 6164 6174 6120 3d20 6661 7468 6572  etadata = father
+000089e0: 2e67 6574 2827 7374 6f72 656d 6574 6164  .get('storemetad
+000089f0: 6174 6127 2c20 7365 6c66 2e73 746f 7265  ata', self.store
+00008a00: 6d65 7461 6461 7461 290a 2020 2020 2020  metadata).      
+00008a10: 2020 2020 2020 6465 6661 756c 745f 6e6f        default_no
+00008a20: 7469 6679 203d 2066 6174 6865 722e 6765  tify = father.ge
+00008a30: 7428 276e 6f74 6966 7927 2c20 7365 6c66  t('notify', self
+00008a40: 2e6e 6f74 6966 7929 0a20 2020 2020 2020  .notify).       
+00008a50: 2020 2020 2064 6566 6175 6c74 5f70 7573       default_pus
+00008a60: 6862 756c 6c65 7474 6f6b 656e 203d 2066  hbullettoken = f
+00008a70: 6174 6865 722e 6765 7428 2770 7573 6862  ather.get('pushb
+00008a80: 756c 6c65 7474 6f6b 656e 272c 2073 656c  ullettoken', sel
+00008a90: 662e 7075 7368 6275 6c6c 6574 746f 6b65  f.pushbullettoke
+00008aa0: 6e29 0a20 2020 2020 2020 2020 2020 2064  n).            d
+00008ab0: 6566 6175 6c74 5f6d 6169 6c73 6572 7665  efault_mailserve
+00008ac0: 7220 3d20 6661 7468 6572 2e67 6574 2827  r = father.get('
+00008ad0: 6d61 696c 7365 7276 6572 272c 2073 656c  mailserver', sel
+00008ae0: 662e 6d61 696c 7365 7276 6572 290a 2020  f.mailserver).  
+00008af0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008b00: 745f 6d61 696c 6672 6f6d 203d 2066 6174  t_mailfrom = fat
+00008b10: 6865 722e 6765 7428 276d 6169 6c66 726f  her.get('mailfro
+00008b20: 6d27 2c20 7365 6c66 2e6d 6169 6c66 726f  m', self.mailfro
+00008b30: 6d29 0a20 2020 2020 2020 2020 2020 2064  m).            d
+00008b40: 6566 6175 6c74 5f6d 6169 6c74 6f20 3d20  efault_mailto = 
+00008b50: 6661 7468 6572 2e67 6574 2827 6d61 696c  father.get('mail
+00008b60: 746f 272c 2073 656c 662e 6d61 696c 746f  to', self.mailto
+00008b70: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00008b80: 6661 756c 745f 6e6f 7469 6679 636d 6420  fault_notifycmd 
+00008b90: 3d20 6661 7468 6572 2e67 6574 2827 6e6f  = father.get('no
+00008ba0: 7469 6679 636d 6427 2c20 7365 6c66 2e6e  tifycmd', self.n
+00008bb0: 6f74 6966 7963 6d64 290a 2020 2020 2020  otifycmd).      
+00008bc0: 2020 2020 2020 6465 6661 756c 745f 6e6f        default_no
+00008bd0: 7469 6679 7363 7269 7074 203d 2066 6174  tifyscript = fat
+00008be0: 6865 722e 6765 7428 276e 6f74 6966 7973  her.get('notifys
+00008bf0: 6372 6970 7427 2c20 7365 6c66 2e6e 6f74  cript', self.not
+00008c00: 6966 7973 6372 6970 7429 0a20 2020 2020  ifyscript).     
+00008c10: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
+00008c20: 6f74 6966 796d 6574 686f 6473 203d 2066  otifymethods = f
+00008c30: 6174 6865 722e 6765 7428 276e 6f74 6966  ather.get('notif
+00008c40: 796d 6574 686f 6473 272c 2073 656c 662e  ymethods', self.
+00008c50: 6e6f 7469 6679 6d65 7468 6f64 7329 0a20  notifymethods). 
+00008c60: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008c70: 6c74 5f73 6c61 636b 6368 616e 6e65 6c20  lt_slackchannel 
+00008c80: 3d20 6661 7468 6572 2e67 6574 2827 736c  = father.get('sl
+00008c90: 6163 6b63 6861 6e6e 656c 272c 2073 656c  ackchannel', sel
+00008ca0: 662e 736c 6163 6b63 6861 6e6e 656c 290a  f.slackchannel).
+00008cb0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008cc0: 756c 745f 7075 7368 6275 6c6c 6574 746f  ult_pushbulletto
+00008cd0: 6b65 6e20 3d20 6661 7468 6572 2e67 6574  ken = father.get
+00008ce0: 2827 7075 7368 6275 6c6c 6574 746f 6b65  ('pushbullettoke
+00008cf0: 6e27 2c20 7365 6c66 2e70 7573 6862 756c  n', self.pushbul
+00008d00: 6c65 7474 6f6b 656e 290a 2020 2020 2020  lettoken).      
+00008d10: 2020 2020 2020 6465 6661 756c 745f 736c        default_sl
+00008d20: 6163 6b74 6f6b 656e 203d 2066 6174 6865  acktoken = fathe
+00008d30: 722e 6765 7428 2773 6c61 636b 746f 6b65  r.get('slacktoke
+00008d40: 6e27 2c20 7365 6c66 2e73 6c61 636b 746f  n', self.slackto
+00008d50: 6b65 6e29 0a20 2020 2020 2020 2020 2020  ken).           
+00008d60: 2064 6566 6175 6c74 5f73 6861 7265 6466   default_sharedf
+00008d70: 6f6c 6465 7273 203d 2066 6174 6865 722e  olders = father.
+00008d80: 6765 7428 2773 6861 7265 6466 6f6c 6465  get('sharedfolde
+00008d90: 7273 272c 2073 656c 662e 7368 6172 6564  rs', self.shared
+00008da0: 666f 6c64 6572 7329 0a20 2020 2020 2020  folders).       
+00008db0: 2020 2020 2064 6566 6175 6c74 5f6b 6572       default_ker
+00008dc0: 6e65 6c20 3d20 6661 7468 6572 2e67 6574  nel = father.get
+00008dd0: 2827 6b65 726e 656c 272c 2073 656c 662e  ('kernel', self.
+00008de0: 6b65 726e 656c 290a 2020 2020 2020 2020  kernel).        
+00008df0: 2020 2020 6465 6661 756c 745f 696e 6974      default_init
+00008e00: 7264 203d 2066 6174 6865 722e 6765 7428  rd = father.get(
+00008e10: 2769 6e69 7472 6427 2c20 7365 6c66 2e69  'initrd', self.i
+00008e20: 6e69 7472 6429 0a20 2020 2020 2020 2020  nitrd).         
+00008e30: 2020 2064 6566 6175 6c74 5f63 6d64 6c69     default_cmdli
+00008e40: 6e65 203d 2066 6174 6865 722e 6765 7428  ne = father.get(
+00008e50: 2763 6d64 6c69 6e65 272c 2073 656c 662e  'cmdline', self.
+00008e60: 636d 646c 696e 6529 0a20 2020 2020 2020  cmdline).       
+00008e70: 2020 2020 2064 6566 6175 6c74 5f70 6c61       default_pla
+00008e80: 6365 6d65 6e74 203d 2066 6174 6865 722e  cement = father.
+00008e90: 6765 7428 2770 6c61 6365 6d65 6e74 272c  get('placement',
+00008ea0: 2073 656c 662e 706c 6163 656d 656e 7429   self.placement)
+00008eb0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00008ec0: 6175 6c74 5f79 616d 6c69 6e76 656e 746f  ault_yamlinvento
+00008ed0: 7279 203d 2066 6174 6865 722e 6765 7428  ry = father.get(
+00008ee0: 2779 616d 6c69 6e76 656e 746f 7279 272c  'yamlinventory',
+00008ef0: 2073 656c 662e 7961 6d6c 696e 7665 6e74   self.yamlinvent
+00008f00: 6f72 7929 0a20 2020 2020 2020 2020 2020  ory).           
+00008f10: 2064 6566 6175 6c74 5f63 7075 686f 7470   default_cpuhotp
+00008f20: 6c75 6720 3d20 6661 7468 6572 2e67 6574  lug = father.get
+00008f30: 2827 6370 7568 6f74 706c 7567 272c 2073  ('cpuhotplug', s
+00008f40: 656c 662e 6370 7568 6f74 706c 7567 290a  elf.cpuhotplug).
+00008f50: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008f60: 756c 745f 6d65 6d6f 7279 686f 7470 6c75  ult_memoryhotplu
+00008f70: 6720 3d20 6661 7468 6572 2e67 6574 2827  g = father.get('
+00008f80: 6d65 6d6f 7279 686f 7470 6c75 6727 2c20  memoryhotplug', 
+00008f90: 7365 6c66 2e6d 656d 6f72 7968 6f74 706c  self.memoryhotpl
+00008fa0: 7567 290a 2020 2020 2020 2020 2020 2020  ug).            
+00008fb0: 6465 6661 756c 745f 6e75 6d61 203d 2066  default_numa = f
+00008fc0: 6174 6865 722e 6765 7428 276e 756d 6127  ather.get('numa'
+00008fd0: 2c20 7365 6c66 2e6e 756d 6129 0a20 2020  , self.numa).   
+00008fe0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00008ff0: 5f6e 756d 616d 6f64 6520 3d20 6661 7468  _numamode = fath
+00009000: 6572 2e67 6574 2827 6e75 6d61 6d6f 6465  er.get('numamode
+00009010: 272c 2073 656c 662e 6e75 6d61 6d6f 6465  ', self.numamode
+00009020: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00009030: 6661 756c 745f 7063 6964 6576 6963 6573  fault_pcidevices
+00009040: 203d 2066 6174 6865 722e 6765 7428 2770   = father.get('p
+00009050: 6369 6465 7669 6365 7327 2c20 7365 6c66  cidevices', self
+00009060: 2e70 6369 6465 7669 6365 7329 0a20 2020  .pcidevices).   
+00009070: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009080: 5f74 706d 203d 2066 6174 6865 722e 6765  _tpm = father.ge
+00009090: 7428 2774 706d 272c 2073 656c 662e 7470  t('tpm', self.tp
+000090a0: 6d29 0a20 2020 2020 2020 2020 2020 2064  m).            d
+000090b0: 6566 6175 6c74 5f72 6e67 203d 2066 6174  efault_rng = fat
+000090c0: 6865 722e 6765 7428 2772 6e67 272c 2073  her.get('rng', s
+000090d0: 656c 662e 726e 6729 0a20 2020 2020 2020  elf.rng).       
+000090e0: 2020 2020 2064 6566 6175 6c74 5f76 6972       default_vir
+000090f0: 7474 7970 6520 3d20 6661 7468 6572 2e67  ttype = father.g
+00009100: 6574 2827 7669 7274 7479 7065 272c 2073  et('virttype', s
+00009110: 656c 662e 7669 7274 7479 7065 290a 2020  elf.virttype).  
+00009120: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00009130: 745f 7365 6375 7269 7479 6772 6f75 7073  t_securitygroups
+00009140: 203d 2066 6174 6865 722e 6765 7428 2773   = father.get('s
+00009150: 6563 7572 6974 7967 726f 7570 7327 2c20  ecuritygroups', 
+00009160: 7365 6c66 2e73 6563 7572 6974 7967 726f  self.securitygro
+00009170: 7570 7329 0a20 2020 2020 2020 2020 2020  ups).           
+00009180: 2064 6566 6175 6c74 5f72 6f6f 7470 6173   default_rootpas
+00009190: 7377 6f72 6420 3d20 6661 7468 6572 2e67  sword = father.g
+000091a0: 6574 2827 726f 6f74 7061 7373 776f 7264  et('rootpassword
+000091b0: 272c 2073 656c 662e 726f 6f74 7061 7373  ', self.rootpass
+000091c0: 776f 7264 290a 2020 2020 2020 2020 2020  word).          
+000091d0: 2020 6465 6661 756c 745f 7465 6d70 6b65    default_tempke
+000091e0: 7920 3d20 6661 7468 6572 2e67 6574 2827  y = father.get('
+000091f0: 7465 6d70 6b65 7927 2c20 7365 6c66 2e74  tempkey', self.t
+00009200: 656d 706b 6579 290a 2020 2020 2020 2020  empkey).        
+00009210: 2020 2020 6465 6661 756c 745f 766d 7573      default_vmus
+00009220: 6572 203d 2066 6174 6865 722e 6765 7428  er = father.get(
+00009230: 2776 6d75 7365 7227 2c20 7365 6c66 2e76  'vmuser', self.v
+00009240: 6d75 7365 7229 0a20 2020 2020 2020 2020  muser).         
+00009250: 2020 2064 6566 6175 6c74 5f77 6169 7420     default_wait 
+00009260: 3d20 6661 7468 6572 2e67 6574 2827 7761  = father.get('wa
+00009270: 6974 272c 2073 656c 662e 7761 6974 290a  it', self.wait).
+00009280: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009290: 756c 745f 7761 6974 636f 6d6d 616e 6420  ult_waitcommand 
+000092a0: 3d20 6661 7468 6572 2e67 6574 2827 7761  = father.get('wa
+000092b0: 6974 636f 6d6d 616e 6427 2c20 7365 6c66  itcommand', self
+000092c0: 2e77 6169 7463 6f6d 6d61 6e64 290a 2020  .waitcommand).  
+000092d0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000092e0: 745f 7761 6974 7469 6d65 6f75 7420 3d20  t_waittimeout = 
+000092f0: 6661 7468 6572 2e67 6574 2827 7761 6974  father.get('wait
+00009300: 7469 6d65 6f75 7427 2c20 7365 6c66 2e77  timeout', self.w
+00009310: 6169 7474 696d 656f 7574 290a 2020 2020  aittimeout).    
+00009320: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00009330: 2020 2020 2020 6465 6661 756c 745f 6e75        default_nu
+00009340: 6d63 7075 7320 3d20 7365 6c66 2e6e 756d  mcpus = self.num
+00009350: 6370 7573 0a20 2020 2020 2020 2020 2020  cpus.           
+00009360: 2064 6566 6175 6c74 5f6d 656d 6f72 7920   default_memory 
+00009370: 3d20 7365 6c66 2e6d 656d 6f72 790a 2020  = self.memory.  
+00009380: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00009390: 745f 706f 6f6c 203d 2073 656c 662e 706f  t_pool = self.po
+000093a0: 6f6c 0a20 2020 2020 2020 2020 2020 2064  ol.            d
+000093b0: 6566 6175 6c74 5f64 6973 6b73 203d 2073  efault_disks = s
+000093c0: 656c 662e 6469 736b 730a 2020 2020 2020  elf.disks.      
+000093d0: 2020 2020 2020 6465 6661 756c 745f 6e65        default_ne
+000093e0: 7473 203d 2073 656c 662e 6e65 7473 0a20  ts = self.nets. 
+000093f0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009400: 6c74 5f69 6d61 6765 203d 2073 656c 662e  lt_image = self.
+00009410: 696d 6167 650a 2020 2020 2020 2020 2020  image.          
+00009420: 2020 6465 6661 756c 745f 636c 6f75 6469    default_cloudi
+00009430: 6e69 7420 3d20 7365 6c66 2e63 6c6f 7564  nit = self.cloud
+00009440: 696e 6974 0a20 2020 2020 2020 2020 2020  init.           
+00009450: 2064 6566 6175 6c74 5f6e 6573 7465 6420   default_nested 
+00009460: 3d20 7365 6c66 2e6e 6573 7465 640a 2020  = self.nested.  
+00009470: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00009480: 745f 7265 7365 7276 6564 6e73 203d 2073  t_reservedns = s
+00009490: 656c 662e 7265 7365 7276 6564 6e73 0a20  elf.reservedns. 
+000094a0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000094b0: 6c74 5f72 6573 6572 7665 686f 7374 203d  lt_reservehost =
+000094c0: 2073 656c 662e 7265 7365 7276 6568 6f73   self.reservehos
+000094d0: 740a 2020 2020 2020 2020 2020 2020 6465  t.            de
+000094e0: 6661 756c 745f 6370 756d 6f64 656c 203d  fault_cpumodel =
+000094f0: 2073 656c 662e 6370 756d 6f64 656c 0a20   self.cpumodel. 
+00009500: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009510: 6c74 5f63 7075 666c 6167 7320 3d20 7365  lt_cpuflags = se
+00009520: 6c66 2e63 7075 666c 6167 730a 2020 2020  lf.cpuflags.    
+00009530: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00009540: 6370 7570 696e 6e69 6e67 203d 2073 656c  cpupinning = sel
+00009550: 662e 6370 7570 696e 6e69 6e67 0a20 2020  f.cpupinning.   
+00009560: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009570: 5f6e 756d 616d 6f64 6520 3d20 7365 6c66  _numamode = self
+00009580: 2e6e 756d 616d 6f64 650a 2020 2020 2020  .numamode.      
+00009590: 2020 2020 2020 6465 6661 756c 745f 6e75        default_nu
+000095a0: 6d61 203d 2073 656c 662e 6e75 6d61 0a20  ma = self.numa. 
+000095b0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000095c0: 6c74 5f70 6369 6465 7669 6365 7320 3d20  lt_pcidevices = 
+000095d0: 7365 6c66 2e70 6369 6465 7669 6365 730a  self.pcidevices.
+000095e0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+000095f0: 756c 745f 7470 6d20 3d20 7365 6c66 2e74  ult_tpm = self.t
+00009600: 706d 0a20 2020 2020 2020 2020 2020 2064  pm.            d
+00009610: 6566 6175 6c74 5f72 6e67 203d 2073 656c  efault_rng = sel
+00009620: 662e 726e 670a 2020 2020 2020 2020 2020  f.rng.          
+00009630: 2020 6465 6661 756c 745f 6469 736b 7369    default_disksi
+00009640: 7a65 203d 2073 656c 662e 6469 736b 7369  ze = self.disksi
+00009650: 7a65 0a20 2020 2020 2020 2020 2020 2064  ze.            d
+00009660: 6566 6175 6c74 5f64 6973 6b69 6e74 6572  efault_diskinter
+00009670: 6661 6365 203d 2073 656c 662e 6469 736b  face = self.disk
+00009680: 696e 7465 7266 6163 650a 2020 2020 2020  interface.      
+00009690: 2020 2020 2020 6465 6661 756c 745f 6469        default_di
+000096a0: 736b 7468 696e 203d 2073 656c 662e 6469  skthin = self.di
+000096b0: 736b 7468 696e 0a20 2020 2020 2020 2020  skthin.         
+000096c0: 2020 2064 6566 6175 6c74 5f67 7565 7374     default_guest
+000096d0: 6964 203d 2073 656c 662e 6775 6573 7469  id = self.guesti
+000096e0: 640a 2020 2020 2020 2020 2020 2020 6465  d.            de
+000096f0: 6661 756c 745f 6973 6f20 3d20 7365 6c66  fault_iso = self
+00009700: 2e69 736f 0a20 2020 2020 2020 2020 2020  .iso.           
+00009710: 2064 6566 6175 6c74 5f76 6e63 203d 2073   default_vnc = s
+00009720: 656c 662e 766e 630a 2020 2020 2020 2020  elf.vnc.        
+00009730: 2020 2020 6465 6661 756c 745f 7265 7365      default_rese
+00009740: 7276 6569 7020 3d20 7365 6c66 2e72 6573  rveip = self.res
+00009750: 6572 7665 6970 0a20 2020 2020 2020 2020  erveip.         
+00009760: 2020 2064 6566 6175 6c74 5f73 7461 7274     default_start
+00009770: 203d 2073 656c 662e 7374 6172 740a 2020   = self.start.  
+00009780: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00009790: 745f 6175 746f 7374 6172 7420 3d20 7365  t_autostart = se
+000097a0: 6c66 2e61 7574 6f73 7461 7274 0a20 2020  lf.autostart.   
+000097b0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+000097c0: 5f6b 6579 7320 3d20 7365 6c66 2e6b 6579  _keys = self.key
+000097d0: 730a 2020 2020 2020 2020 2020 2020 6465  s.            de
+000097e0: 6661 756c 745f 6e65 746d 6173 6b73 203d  fault_netmasks =
+000097f0: 2073 656c 662e 6e65 746d 6173 6b73 0a20   self.netmasks. 
+00009800: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009810: 6c74 5f67 6174 6577 6179 203d 2073 656c  lt_gateway = sel
+00009820: 662e 6761 7465 7761 790a 2020 2020 2020  f.gateway.      
+00009830: 2020 2020 2020 6465 6661 756c 745f 646e        default_dn
+00009840: 7320 3d20 7365 6c66 2e64 6e73 0a20 2020  s = self.dns.   
+00009850: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009860: 5f64 6f6d 6169 6e20 3d20 7365 6c66 2e64  _domain = self.d
+00009870: 6f6d 6169 6e0a 2020 2020 2020 2020 2020  omain.          
+00009880: 2020 6465 6661 756c 745f 6669 6c65 7320    default_files 
+00009890: 3d20 7365 6c66 2e66 696c 6573 0a20 2020  = self.files.   
+000098a0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+000098b0: 5f65 6e61 626c 6572 6f6f 7420 3d20 7365  _enableroot = se
+000098c0: 6c66 2e65 6e61 626c 6572 6f6f 740a 2020  lf.enableroot.  
+000098d0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000098e0: 745f 7461 6773 203d 2073 656c 662e 7461  t_tags = self.ta
+000098f0: 6773 0a20 2020 2020 2020 2020 2020 2064  gs.            d
+00009900: 6566 6175 6c74 5f66 6c61 766f 7220 3d20  efault_flavor = 
+00009910: 7365 6c66 2e66 6c61 766f 720a 2020 2020  self.flavor.    
+00009920: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00009930: 7072 6976 6174 656b 6579 203d 2073 656c  privatekey = sel
+00009940: 662e 7072 6976 6174 656b 6579 0a20 2020  f.privatekey.   
+00009950: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009960: 5f6e 6574 776f 726b 7761 6974 203d 2073  _networkwait = s
+00009970: 656c 662e 6e65 7477 6f72 6b77 6169 740a  elf.networkwait.
+00009980: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009990: 756c 745f 7268 6e72 6567 6973 7465 7220  ult_rhnregister 
+000099a0: 3d20 7365 6c66 2e72 686e 7265 6769 7374  = self.rhnregist
+000099b0: 6572 0a20 2020 2020 2020 2020 2020 2064  er.            d
+000099c0: 6566 6175 6c74 5f72 686e 7365 7276 6572  efault_rhnserver
+000099d0: 203d 2073 656c 662e 7268 6e73 6572 7665   = self.rhnserve
+000099e0: 720a 2020 2020 2020 2020 2020 2020 6465  r.            de
+000099f0: 6661 756c 745f 7268 6e75 7365 7220 3d20  fault_rhnuser = 
+00009a00: 7365 6c66 2e72 686e 7573 6572 0a20 2020  self.rhnuser.   
+00009a10: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009a20: 5f72 686e 7061 7373 776f 7264 203d 2073  _rhnpassword = s
+00009a30: 656c 662e 7268 6e70 6173 7377 6f72 640a  elf.rhnpassword.
+00009a40: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009a50: 756c 745f 7268 6e61 6b20 3d20 7365 6c66  ult_rhnak = self
+00009a60: 2e72 686e 616b 0a20 2020 2020 2020 2020  .rhnak.         
+00009a70: 2020 2064 6566 6175 6c74 5f72 686e 6f72     default_rhnor
+00009a80: 6720 3d20 7365 6c66 2e72 686e 6f72 670a  g = self.rhnorg.
+00009a90: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009aa0: 756c 745f 7268 6e70 6f6f 6c20 3d20 7365  ult_rhnpool = se
+00009ab0: 6c66 2e72 686e 706f 6f6c 0a20 2020 2020  lf.rhnpool.     
+00009ac0: 2020 2020 2020 2064 6566 6175 6c74 5f63         default_c
+00009ad0: 6d64 7320 3d20 7365 6c66 2e63 6d64 730a  mds = self.cmds.
+00009ae0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009af0: 756c 745f 7363 7269 7074 7320 3d20 7365  ult_scripts = se
+00009b00: 6c66 2e73 6372 6970 7473 0a20 2020 2020  lf.scripts.     
+00009b10: 2020 2020 2020 2064 6566 6175 6c74 5f64         default_d
+00009b20: 6e73 636c 6965 6e74 203d 2073 656c 662e  nsclient = self.
+00009b30: 646e 7363 6c69 656e 740a 2020 2020 2020  dnsclient.      
+00009b40: 2020 2020 2020 6465 6661 756c 745f 7374        default_st
+00009b50: 6f72 656d 6574 6164 6174 6120 3d20 7365  oremetadata = se
+00009b60: 6c66 2e73 746f 7265 6d65 7461 6461 7461  lf.storemetadata
+00009b70: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009b80: 6175 6c74 5f6e 6f74 6966 7920 3d20 7365  ault_notify = se
+00009b90: 6c66 2e6e 6f74 6966 790a 2020 2020 2020  lf.notify.      
+00009ba0: 2020 2020 2020 6465 6661 756c 745f 7075        default_pu
+00009bb0: 7368 6275 6c6c 6574 746f 6b65 6e20 3d20  shbullettoken = 
+00009bc0: 7365 6c66 2e70 7573 6862 756c 6c65 7474  self.pushbullett
+00009bd0: 6f6b 656e 0a20 2020 2020 2020 2020 2020  oken.           
+00009be0: 2064 6566 6175 6c74 5f73 6c61 636b 746f   default_slackto
+00009bf0: 6b65 6e20 3d20 7365 6c66 2e73 6c61 636b  ken = self.slack
+00009c00: 746f 6b65 6e0a 2020 2020 2020 2020 2020  token.          
+00009c10: 2020 6465 6661 756c 745f 6d61 696c 7365    default_mailse
+00009c20: 7276 6572 203d 2073 656c 662e 6d61 696c  rver = self.mail
+00009c30: 7365 7276 6572 0a20 2020 2020 2020 2020  server.         
+00009c40: 2020 2064 6566 6175 6c74 5f6d 6169 6c66     default_mailf
+00009c50: 726f 6d20 3d20 7365 6c66 2e6d 6169 6c66  rom = self.mailf
+00009c60: 726f 6d0a 2020 2020 2020 2020 2020 2020  rom.            
+00009c70: 6465 6661 756c 745f 6d61 696c 746f 203d  default_mailto =
+00009c80: 2073 656c 662e 6d61 696c 746f 0a20 2020   self.mailto.   
+00009c90: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009ca0: 5f6e 6f74 6966 7963 6d64 203d 2073 656c  _notifycmd = sel
+00009cb0: 662e 6e6f 7469 6679 636d 640a 2020 2020  f.notifycmd.    
+00009cc0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00009cd0: 6e6f 7469 6679 7363 7269 7074 203d 2073  notifyscript = s
+00009ce0: 656c 662e 6e6f 7469 6679 7363 7269 7074  elf.notifyscript
+00009cf0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009d00: 6175 6c74 5f6e 6f74 6966 796d 6574 686f  ault_notifymetho
+00009d10: 6473 203d 2073 656c 662e 6e6f 7469 6679  ds = self.notify
+00009d20: 6d65 7468 6f64 730a 2020 2020 2020 2020  methods.        
+00009d30: 2020 2020 6465 6661 756c 745f 736c 6163      default_slac
+00009d40: 6b63 6861 6e6e 656c 203d 2073 656c 662e  kchannel = self.
+00009d50: 736c 6163 6b63 6861 6e6e 656c 0a20 2020  slackchannel.   
+00009d60: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009d70: 5f73 6861 7265 6466 6f6c 6465 7273 203d  _sharedfolders =
+00009d80: 2073 656c 662e 7368 6172 6564 666f 6c64   self.sharedfold
+00009d90: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
+00009da0: 6465 6661 756c 745f 6b65 726e 656c 203d  default_kernel =
+00009db0: 2073 656c 662e 6b65 726e 656c 0a20 2020   self.kernel.   
+00009dc0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009dd0: 5f69 6e69 7472 6420 3d20 7365 6c66 2e69  _initrd = self.i
+00009de0: 6e69 7472 640a 2020 2020 2020 2020 2020  nitrd.          
+00009df0: 2020 6465 6661 756c 745f 636d 646c 696e    default_cmdlin
+00009e00: 6520 3d20 7365 6c66 2e63 6d64 6c69 6e65  e = self.cmdline
+00009e10: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009e20: 6175 6c74 5f70 6c61 6365 6d65 6e74 203d  ault_placement =
+00009e30: 2073 656c 662e 706c 6163 656d 656e 740a   self.placement.
+00009e40: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009e50: 756c 745f 7961 6d6c 696e 7665 6e74 6f72  ult_yamlinventor
+00009e60: 7920 3d20 7365 6c66 2e79 616d 6c69 6e76  y = self.yamlinv
+00009e70: 656e 746f 7279 0a20 2020 2020 2020 2020  entory.         
+00009e80: 2020 2064 6566 6175 6c74 5f63 7075 686f     default_cpuho
+00009e90: 7470 6c75 6720 3d20 7365 6c66 2e63 7075  tplug = self.cpu
+00009ea0: 686f 7470 6c75 670a 2020 2020 2020 2020  hotplug.        
+00009eb0: 2020 2020 6465 6661 756c 745f 6d65 6d6f      default_memo
+00009ec0: 7279 686f 7470 6c75 6720 3d20 7365 6c66  ryhotplug = self
+00009ed0: 2e6d 656d 6f72 7968 6f74 706c 7567 0a20  .memoryhotplug. 
+00009ee0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009ef0: 6c74 5f76 6972 7474 7970 6520 3d20 7365  lt_virttype = se
+00009f00: 6c66 2e76 6972 7474 7970 650a 2020 2020  lf.virttype.    
+00009f10: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00009f20: 7365 6375 7269 7479 6772 6f75 7073 203d  securitygroups =
+00009f30: 2073 656c 662e 7365 6375 7269 7479 6772   self.securitygr
+00009f40: 6f75 7073 0a20 2020 2020 2020 2020 2020  oups.           
+00009f50: 2064 6566 6175 6c74 5f72 6f6f 7470 6173   default_rootpas
+00009f60: 7377 6f72 6420 3d20 7365 6c66 2e72 6f6f  sword = self.roo
+00009f70: 7470 6173 7377 6f72 640a 2020 2020 2020  tpassword.      
+00009f80: 2020 2020 2020 6465 6661 756c 745f 7465        default_te
+00009f90: 6d70 6b65 7920 3d20 7365 6c66 2e74 656d  mpkey = self.tem
+00009fa0: 706b 6579 0a20 2020 2020 2020 2020 2020  pkey.           
+00009fb0: 2064 6566 6175 6c74 5f76 6d75 7365 7220   default_vmuser 
+00009fc0: 3d20 7365 6c66 2e76 6d75 7365 720a 2020  = self.vmuser.  
+00009fd0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00009fe0: 745f 7761 6974 203d 2073 656c 662e 7761  t_wait = self.wa
+00009ff0: 6974 0a20 2020 2020 2020 2020 2020 2064  it.            d
+0000a000: 6566 6175 6c74 5f77 6169 7463 6f6d 6d61  efault_waitcomma
+0000a010: 6e64 203d 2073 656c 662e 7761 6974 636f  nd = self.waitco
+0000a020: 6d6d 616e 640a 2020 2020 2020 2020 2020  mmand.          
+0000a030: 2020 6465 6661 756c 745f 7761 6974 7469    default_waitti
+0000a040: 6d65 6f75 7420 3d20 7365 6c66 2e77 6169  meout = self.wai
+0000a050: 7474 696d 656f 7574 0a20 2020 2020 2020  ttimeout.       
+0000a060: 2070 6c61 6e20 3d20 7072 6f66 696c 652e   plan = profile.
+0000a070: 6765 7428 2770 6c61 6e27 2c20 706c 616e  get('plan', plan
+0000a080: 290a 2020 2020 2020 2020 7465 6d70 6c61  ).        templa
+0000a090: 7465 203d 2070 726f 6669 6c65 2e67 6574  te = profile.get
+0000a0a0: 2827 7465 6d70 6c61 7465 272c 2064 6566  ('template', def
+0000a0b0: 6175 6c74 5f69 6d61 6765 290a 2020 2020  ault_image).    
+0000a0c0: 2020 2020 696d 6167 6520 3d20 7072 6f66      image = prof
+0000a0d0: 696c 652e 6765 7428 2769 6d61 6765 272c  ile.get('image',
+0000a0e0: 2074 656d 706c 6174 6529 0a20 2020 2020   template).     
+0000a0f0: 2020 206e 6574 7320 3d20 7072 6f66 696c     nets = profil
+0000a100: 652e 6765 7428 276e 6574 7327 2c20 6465  e.get('nets', de
+0000a110: 6661 756c 745f 6e65 7473 290a 2020 2020  fault_nets).    
+0000a120: 2020 2020 6370 756d 6f64 656c 203d 2070      cpumodel = p
+0000a130: 726f 6669 6c65 2e67 6574 2827 6370 756d  rofile.get('cpum
+0000a140: 6f64 656c 272c 2064 6566 6175 6c74 5f63  odel', default_c
+0000a150: 7075 6d6f 6465 6c29 0a20 2020 2020 2020  pumodel).       
+0000a160: 2063 7075 666c 6167 7320 3d20 7072 6f66   cpuflags = prof
+0000a170: 696c 652e 6765 7428 2763 7075 666c 6167  ile.get('cpuflag
+0000a180: 7327 2c20 6465 6661 756c 745f 6370 7566  s', default_cpuf
+0000a190: 6c61 6773 290a 2020 2020 2020 2020 6370  lags).        cp
+0000a1a0: 7570 696e 6e69 6e67 203d 2070 726f 6669  upinning = profi
+0000a1b0: 6c65 2e67 6574 2827 6370 7570 696e 6e69  le.get('cpupinni
+0000a1c0: 6e67 272c 2064 6566 6175 6c74 5f63 7075  ng', default_cpu
+0000a1d0: 7069 6e6e 696e 6729 0a20 2020 2020 2020  pinning).       
+0000a1e0: 206e 756d 616d 6f64 6520 3d20 7072 6f66   numamode = prof
+0000a1f0: 696c 652e 6765 7428 276e 756d 616d 6f64  ile.get('numamod
+0000a200: 6527 2c20 6465 6661 756c 745f 6e75 6d61  e', default_numa
+0000a210: 6d6f 6465 290a 2020 2020 2020 2020 6e75  mode).        nu
+0000a220: 6d61 203d 2070 726f 6669 6c65 2e67 6574  ma = profile.get
+0000a230: 2827 6e75 6d61 272c 2064 6566 6175 6c74  ('numa', default
+0000a240: 5f6e 756d 6129 0a20 2020 2020 2020 2070  _numa).        p
+0000a250: 6369 6465 7669 6365 7320 3d20 7072 6f66  cidevices = prof
+0000a260: 696c 652e 6765 7428 2770 6369 6465 7669  ile.get('pcidevi
+0000a270: 6365 7327 2c20 6465 6661 756c 745f 7063  ces', default_pc
+0000a280: 6964 6576 6963 6573 290a 2020 2020 2020  idevices).      
+0000a290: 2020 7470 6d20 3d20 7072 6f66 696c 652e    tpm = profile.
+0000a2a0: 6765 7428 2774 706d 272c 2064 6566 6175  get('tpm', defau
+0000a2b0: 6c74 5f74 706d 290a 2020 2020 2020 2020  lt_tpm).        
+0000a2c0: 726e 6720 3d20 7072 6f66 696c 652e 6765  rng = profile.ge
+0000a2d0: 7428 2772 6e67 272c 2064 6566 6175 6c74  t('rng', default
+0000a2e0: 5f72 6e67 290a 2020 2020 2020 2020 7365  _rng).        se
+0000a2f0: 6375 7269 7479 6772 6f75 7073 203d 2070  curitygroups = p
+0000a300: 726f 6669 6c65 2e67 6574 2827 7365 6375  rofile.get('secu
+0000a310: 7269 7479 6772 6f75 7073 272c 2064 6566  ritygroups', def
+0000a320: 6175 6c74 5f73 6563 7572 6974 7967 726f  ault_securitygro
+0000a330: 7570 7329 0a20 2020 2020 2020 206e 756d  ups).        num
+0000a340: 6370 7573 203d 2070 726f 6669 6c65 2e67  cpus = profile.g
+0000a350: 6574 2827 6e75 6d63 7075 7327 2c20 6465  et('numcpus', de
+0000a360: 6661 756c 745f 6e75 6d63 7075 7329 0a20  fault_numcpus). 
+0000a370: 2020 2020 2020 206d 656d 6f72 7920 3d20         memory = 
+0000a380: 7072 6f66 696c 652e 6765 7428 276d 656d  profile.get('mem
+0000a390: 6f72 7927 2c20 6465 6661 756c 745f 6d65  ory', default_me
+0000a3a0: 6d6f 7279 290a 2020 2020 2020 2020 6966  mory).        if
+0000a3b0: 2069 7369 6e73 7461 6e63 6528 6d65 6d6f   isinstance(memo
+0000a3c0: 7279 2c20 7374 7229 2061 6e64 2028 6d65  ry, str) and (me
+0000a3d0: 6d6f 7279 2e6c 6f77 6572 2829 2e65 6e64  mory.lower().end
+0000a3e0: 7377 6974 6828 2767 6227 2920 6f72 206d  swith('gb') or m
+0000a3f0: 656d 6f72 792e 6c6f 7765 7228 292e 656e  emory.lower().en
+0000a400: 6473 7769 7468 2827 6727 2929 3a0a 2020  dswith('g')):.  
+0000a410: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0000a420: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000a430: 656d 6f72 7920 3d20 696e 7428 6d65 6d6f  emory = int(memo
+0000a440: 7279 2e6c 6f77 6572 2827 6762 272c 2027  ry.lower('gb', '
+0000a450: 2729 2e72 6570 6c61 6365 2827 6727 2c20  ').replace('g', 
+0000a460: 2727 2929 202a 2031 3032 340a 2020 2020  '')) * 1024.    
+0000a470: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0000a480: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+0000a490: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000a4a0: 7272 6f72 2866 2243 6f75 6c64 6e74 2063  rror(f"Couldnt c
+0000a4b0: 6f6e 7665 7274 206d 656d 6f72 792e 2048  onvert memory. H
+0000a4c0: 6974 207b 657d 2229 0a20 2020 2020 2020  it {e}").       
+0000a4d0: 2070 6f6f 6c20 3d20 7072 6f66 696c 652e   pool = profile.
+0000a4e0: 6765 7428 2770 6f6f 6c27 2c20 6465 6661  get('pool', defa
+0000a4f0: 756c 745f 706f 6f6c 290a 2020 2020 2020  ult_pool).      
+0000a500: 2020 6469 736b 7320 3d20 7072 6f66 696c    disks = profil
+0000a510: 652e 6765 7428 2764 6973 6b73 272c 2064  e.get('disks', d
+0000a520: 6566 6175 6c74 5f64 6973 6b73 290a 2020  efault_disks).  
+0000a530: 2020 2020 2020 6469 736b 7369 7a65 203d        disksize =
+0000a540: 2070 726f 6669 6c65 2e67 6574 2827 6469   profile.get('di
+0000a550: 736b 7369 7a65 272c 2064 6566 6175 6c74  sksize', default
+0000a560: 5f64 6973 6b73 697a 6529 0a20 2020 2020  _disksize).     
+0000a570: 2020 2064 6973 6b69 6e74 6572 6661 6365     diskinterface
+0000a580: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0000a590: 6469 736b 696e 7465 7266 6163 6527 2c20  diskinterface', 
+0000a5a0: 6465 6661 756c 745f 6469 736b 696e 7465  default_diskinte
+0000a5b0: 7266 6163 6529 0a20 2020 2020 2020 2064  rface).        d
+0000a5c0: 6973 6b74 6869 6e20 3d20 7072 6f66 696c  iskthin = profil
+0000a5d0: 652e 6765 7428 2764 6973 6b74 6869 6e27  e.get('diskthin'
+0000a5e0: 2c20 6465 6661 756c 745f 6469 736b 7468  , default_diskth
+0000a5f0: 696e 290a 2020 2020 2020 2020 6966 2064  in).        if d
+0000a600: 6973 6b73 2061 6e64 2069 7369 6e73 7461  isks and isinsta
+0000a610: 6e63 6528 6469 736b 732c 2064 6963 7429  nce(disks, dict)
+0000a620: 2061 6e64 2027 6465 6661 756c 7427 2069   and 'default' i
+0000a630: 6e20 6469 736b 735b 305d 3a0a 2020 2020  n disks[0]:.    
+0000a640: 2020 2020 2020 2020 6469 736b 7320 3d20          disks = 
+0000a650: 5b7b 2773 697a 6527 3a20 6469 736b 7369  [{'size': disksi
+0000a660: 7a65 2c20 2769 6e74 6572 6661 6365 273a  ze, 'interface':
+0000a670: 2064 6973 6b69 6e74 6572 6661 6365 2c20   diskinterface, 
+0000a680: 2774 6869 6e27 3a20 6469 736b 7468 696e  'thin': diskthin
+0000a690: 7d5d 0a20 2020 2020 2020 2067 7565 7374  }].        guest
+0000a6a0: 6964 203d 2070 726f 6669 6c65 2e67 6574  id = profile.get
+0000a6b0: 2827 6775 6573 7469 6427 2c20 6465 6661  ('guestid', defa
+0000a6c0: 756c 745f 6775 6573 7469 6429 0a20 2020  ult_guestid).   
+0000a6d0: 2020 2020 2069 736f 203d 2070 726f 6669       iso = profi
+0000a6e0: 6c65 2e67 6574 2827 6973 6f27 2c20 6465  le.get('iso', de
+0000a6f0: 6661 756c 745f 6973 6f29 0a20 2020 2020  fault_iso).     
+0000a700: 2020 2076 6e63 203d 2070 726f 6669 6c65     vnc = profile
+0000a710: 2e67 6574 2827 766e 6327 2c20 6465 6661  .get('vnc', defa
+0000a720: 756c 745f 766e 6329 0a20 2020 2020 2020  ult_vnc).       
+0000a730: 2063 6c6f 7564 696e 6974 203d 2070 726f   cloudinit = pro
+0000a740: 6669 6c65 2e67 6574 2827 636c 6f75 6469  file.get('cloudi
+0000a750: 6e69 7427 2c20 6465 6661 756c 745f 636c  nit', default_cl
+0000a760: 6f75 6469 6e69 7429 0a20 2020 2020 2020  oudinit).       
+0000a770: 2069 6620 636c 6f75 6469 6e69 7420 616e   if cloudinit an
+0000a780: 6420 7365 6c66 2e74 7970 6520 3d3d 2027  d self.type == '
+0000a790: 6b76 6d27 2061 6e64 5c0a 2020 2020 2020  kvm' and\.      
+0000a7a0: 2020 2020 2020 2020 2020 7768 6963 6828            which(
+0000a7b0: 276d 6b69 736f 6673 2729 2069 7320 4e6f  'mkisofs') is No
+0000a7c0: 6e65 2061 6e64 2077 6869 6368 2827 6765  ne and which('ge
+0000a7d0: 6e69 736f 696d 6167 6527 2920 616e 6420  nisoimage') and 
+0000a7e0: 7768 6963 6828 2778 6f72 7269 736f 6673  which('xorrisofs
+0000a7f0: 2729 2069 7320 4e6f 6e65 3a0a 2020 2020  ') is None:.    
+0000a800: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+0000a810: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
+0000a820: 7265 272c 2027 7265 6173 6f6e 273a 2022  re', 'reason': "
+0000a830: 4d69 7373 696e 6720 6d6b 6973 6f66 732f  Missing mkisofs/
+0000a840: 6765 6e69 736f 696d 6167 652f 786f 7272  genisoimage/xorr
+0000a850: 6973 6f66 7320 6e65 6564 6564 2066 6f72  isofs needed for
+0000a860: 2063 6c6f 7564 696e 6974 227d 0a20 2020   cloudinit"}.   
+0000a870: 2020 2020 2072 6573 6572 7665 6970 203d       reserveip =
+0000a880: 2070 726f 6669 6c65 2e67 6574 2827 7265   profile.get('re
+0000a890: 7365 7276 6569 7027 2c20 6465 6661 756c  serveip', defaul
+0000a8a0: 745f 7265 7365 7276 6569 7029 0a20 2020  t_reserveip).   
+0000a8b0: 2020 2020 2072 6573 6572 7665 646e 7320       reservedns 
+0000a8c0: 3d20 7072 6f66 696c 652e 6765 7428 2772  = profile.get('r
+0000a8d0: 6573 6572 7665 646e 7327 2c20 6465 6661  eservedns', defa
+0000a8e0: 756c 745f 7265 7365 7276 6564 6e73 290a  ult_reservedns).
+0000a8f0: 2020 2020 2020 2020 7265 7365 7276 6568          reserveh
+0000a900: 6f73 7420 3d20 7072 6f66 696c 652e 6765  ost = profile.ge
+0000a910: 7428 2772 6573 6572 7665 686f 7374 272c  t('reservehost',
+0000a920: 2064 6566 6175 6c74 5f72 6573 6572 7665   default_reserve
+0000a930: 686f 7374 290a 2020 2020 2020 2020 6e65  host).        ne
+0000a940: 7374 6564 203d 2070 726f 6669 6c65 2e67  sted = profile.g
+0000a950: 6574 2827 6e65 7374 6564 272c 2064 6566  et('nested', def
+0000a960: 6175 6c74 5f6e 6573 7465 6429 0a20 2020  ault_nested).   
+0000a970: 2020 2020 2073 7461 7274 203d 2070 726f       start = pro
+0000a980: 6669 6c65 2e67 6574 2827 7374 6172 7427  file.get('start'
+0000a990: 2c20 6465 6661 756c 745f 7374 6172 7429  , default_start)
+0000a9a0: 0a20 2020 2020 2020 2061 7574 6f73 7461  .        autosta
+0000a9b0: 7274 203d 2070 726f 6669 6c65 2e67 6574  rt = profile.get
+0000a9c0: 2827 6175 746f 7374 6172 7427 2c20 6465  ('autostart', de
+0000a9d0: 6661 756c 745f 6175 746f 7374 6172 7429  fault_autostart)
+0000a9e0: 0a20 2020 2020 2020 206b 6579 7320 3d20  .        keys = 
+0000a9f0: 7072 6f66 696c 652e 6765 7428 276b 6579  profile.get('key
+0000aa00: 7327 2c20 6465 6661 756c 745f 6b65 7973  s', default_keys
+0000aa10: 290a 2020 2020 2020 2020 636d 6473 203d  ).        cmds =
+0000aa20: 2063 6f6d 6d6f 6e2e 7265 6d6f 7665 5f64   common.remove_d
+0000aa30: 7570 6c69 6361 7465 7328 6465 6661 756c  uplicates(defaul
+0000aa40: 745f 636d 6473 202b 2070 726f 6669 6c65  t_cmds + profile
+0000aa50: 2e67 6574 2827 636d 6473 272c 205b 5d29  .get('cmds', [])
+0000aa60: 290a 2020 2020 2020 2020 6e65 746d 6173  ).        netmas
+0000aa70: 6b73 203d 2070 726f 6669 6c65 2e67 6574  ks = profile.get
+0000aa80: 2827 6e65 746d 6173 6b73 272c 2064 6566  ('netmasks', def
+0000aa90: 6175 6c74 5f6e 6574 6d61 736b 7329 0a20  ault_netmasks). 
+0000aaa0: 2020 2020 2020 2067 6174 6577 6179 203d         gateway =
+0000aab0: 2070 726f 6669 6c65 2e67 6574 2827 6761   profile.get('ga
+0000aac0: 7465 7761 7927 2c20 6465 6661 756c 745f  teway', default_
+0000aad0: 6761 7465 7761 7929 0a20 2020 2020 2020  gateway).       
+0000aae0: 2064 6e73 203d 2070 726f 6669 6c65 2e67   dns = profile.g
+0000aaf0: 6574 2827 646e 7327 2c20 6465 6661 756c  et('dns', defaul
+0000ab00: 745f 646e 7329 0a20 2020 2020 2020 2064  t_dns).        d
+0000ab10: 6f6d 6169 6e20 3d20 7072 6f66 696c 652e  omain = profile.
+0000ab20: 6765 7428 2764 6f6d 6169 6e27 2c20 6f76  get('domain', ov
+0000ab30: 6572 7269 6465 732e 6765 7428 2764 6f6d  errides.get('dom
+0000ab40: 6169 6e27 2c20 6465 6661 756c 745f 646f  ain', default_do
+0000ab50: 6d61 696e 2929 0a20 2020 2020 2020 2064  main)).        d
+0000ab60: 6e73 636c 6965 6e74 203d 2070 726f 6669  nsclient = profi
+0000ab70: 6c65 2e67 6574 2827 646e 7363 6c69 656e  le.get('dnsclien
+0000ab80: 7427 2c20 6f76 6572 7269 6465 732e 6765  t', overrides.ge
+0000ab90: 7428 2764 6e73 636c 6965 6e74 272c 2064  t('dnsclient', d
+0000aba0: 6566 6175 6c74 5f64 6e73 636c 6965 6e74  efault_dnsclient
+0000abb0: 2929 0a20 2020 2020 2020 2073 6372 6970  )).        scrip
+0000abc0: 7473 203d 2063 6f6d 6d6f 6e2e 7265 6d6f  ts = common.remo
+0000abd0: 7665 5f64 7570 6c69 6361 7465 7328 6465  ve_duplicates(de
+0000abe0: 6661 756c 745f 7363 7269 7074 7320 2b20  fault_scripts + 
+0000abf0: 7072 6f66 696c 652e 6765 7428 2773 6372  profile.get('scr
+0000ac00: 6970 7473 272c 205b 5d29 290a 2020 2020  ipts', [])).    
+0000ac10: 2020 2020 6669 6c65 7320 3d20 7072 6f66      files = prof
+0000ac20: 696c 652e 6765 7428 2766 696c 6573 272c  ile.get('files',
+0000ac30: 2064 6566 6175 6c74 5f66 696c 6573 290a   default_files).
+0000ac40: 2020 2020 2020 2020 6578 7472 615f 6669          extra_fi
+0000ac50: 6c65 7320 3d20 7072 6f66 696c 652e 6765  les = profile.ge
+0000ac60: 7428 2765 7874 7261 5f66 696c 6573 2729  t('extra_files')
+0000ac70: 206f 7220 6f76 6572 7269 6465 732e 6765   or overrides.ge
+0000ac80: 7428 2765 7874 7261 5f66 696c 6573 2729  t('extra_files')
+0000ac90: 206f 7220 5b5d 0a20 2020 2020 2020 2066   or [].        f
+0000aca0: 696c 6573 2e65 7874 656e 6428 6578 7472  iles.extend(extr
+0000acb0: 615f 6669 6c65 7329 0a20 2020 2020 2020  a_files).       
+0000acc0: 2072 6573 756c 7420 3d20 7365 6c66 2e70   result = self.p
+0000acd0: 6172 7365 5f66 696c 6573 286e 616d 652c  arse_files(name,
+0000ace0: 2066 696c 6573 2c20 6261 7365 6469 722c   files, basedir,
+0000acf0: 206f 6e66 6c79 290a 2020 2020 2020 2020   onfly).        
+0000ad00: 6966 2072 6573 756c 7420 6973 206e 6f74  if result is not
+0000ad10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000ad20: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+0000ad30: 0a20 2020 2020 2020 2070 726f 6669 6c65  .        profile
+0000ad40: 5f65 6e76 5f70 6172 616d 6574 6572 7320  _env_parameters 
+0000ad50: 3d20 5b6b 6579 2066 6f72 206b 6579 2069  = [key for key i
+0000ad60: 6e20 7072 6f66 696c 6520 6966 206b 6579  n profile if key
+0000ad70: 2e69 7375 7070 6572 2829 5d0a 2020 2020  .isupper()].    
+0000ad80: 2020 2020 6f76 6572 7269 6465 735f 656e      overrides_en
+0000ad90: 765f 7061 7261 6d65 7465 7273 203d 205b  v_parameters = [
+0000ada0: 6b65 7920 666f 7220 6b65 7920 696e 206f  key for key in o
+0000adb0: 7665 7272 6964 6573 2069 6620 6b65 792e  verrides if key.
+0000adc0: 6973 7570 7065 7228 295d 0a20 2020 2020  isupper()].     
+0000add0: 2020 2065 6e76 5f70 6172 616d 6574 6572     env_parameter
+0000ade0: 7320 3d20 736f 7274 6564 286c 6973 7428  s = sorted(list(
+0000adf0: 7365 7428 7072 6f66 696c 655f 656e 765f  set(profile_env_
+0000ae00: 7061 7261 6d65 7465 7273 202b 206f 7665  parameters + ove
+0000ae10: 7272 6964 6573 5f65 6e76 5f70 6172 616d  rrides_env_param
+0000ae20: 6574 6572 7329 2929 0a20 2020 2020 2020  eters))).       
+0000ae30: 2069 6620 656e 765f 7061 7261 6d65 7465   if env_paramete
+0000ae40: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0000ae50: 656e 765f 6461 7461 203d 2027 270a 2020  env_data = ''.  
+0000ae60: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+0000ae70: 7920 696e 2065 6e76 5f70 6172 616d 6574  y in env_paramet
+0000ae80: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+0000ae90: 2020 2020 2076 616c 7565 203d 2070 726f       value = pro
+0000aea0: 6669 6c65 2e67 6574 286b 6579 2920 6f72  file.get(key) or
+0000aeb0: 206f 7665 7272 6964 6573 2e67 6574 286b   overrides.get(k
+0000aec0: 6579 290a 2020 2020 2020 2020 2020 2020  ey).            
+0000aed0: 2020 2020 656e 765f 6461 7461 202b 3d20      env_data += 
+0000aee0: 6622 6578 706f 7274 207b 6b65 797d 3d7b  f"export {key}={
+0000aef0: 7661 6c75 657d 5c6e 6578 706f 7274 207b  value}\nexport {
+0000af00: 6b65 792e 6c6f 7765 7228 297d 3d7b 7661  key.lower()}={va
+0000af10: 6c75 657d 5c6e 220a 2020 2020 2020 2020  lue}\n".        
+0000af20: 2020 2020 6669 6c65 732e 6170 7065 6e64      files.append
+0000af30: 287b 2770 6174 6827 3a20 272f 6574 632f  ({'path': '/etc/
+0000af40: 7072 6f66 696c 652e 642f 6b63 6c69 2e73  profile.d/kcli.s
+0000af50: 6827 2c20 2763 6f6e 7465 6e74 273a 2065  h', 'content': e
+0000af60: 6e76 5f64 6174 612c 2027 6d6f 6465 273a  nv_data, 'mode':
+0000af70: 2036 3434 7d29 0a20 2020 2020 2020 2065   644}).        e
+0000af80: 6e61 626c 6572 6f6f 7420 3d20 7072 6f66  nableroot = prof
+0000af90: 696c 652e 6765 7428 2765 6e61 626c 6572  ile.get('enabler
+0000afa0: 6f6f 7427 2c20 6465 6661 756c 745f 656e  oot', default_en
+0000afb0: 6162 6c65 726f 6f74 290a 2020 2020 2020  ableroot).      
+0000afc0: 2020 7461 6773 203d 2070 726f 6669 6c65    tags = profile
+0000afd0: 2e67 6574 2827 7461 6773 272c 205b 5d29  .get('tags', [])
+0000afe0: 0a20 2020 2020 2020 2069 6620 6465 6661  .        if defa
+0000aff0: 756c 745f 7461 6773 3a0a 2020 2020 2020  ult_tags:.      
+0000b000: 2020 2020 2020 7461 6773 203d 2064 6566        tags = def
+0000b010: 6175 6c74 5f74 6167 7320 2b20 7461 6773  ault_tags + tags
+0000b020: 2069 6620 7461 6773 2065 6c73 6520 6465   if tags else de
+0000b030: 6661 756c 745f 7461 6773 0a20 2020 2020  fault_tags.     
+0000b040: 2020 2070 7269 7661 7465 6b65 7920 3d20     privatekey = 
+0000b050: 7072 6f66 696c 652e 6765 7428 2770 7269  profile.get('pri
+0000b060: 7661 7465 6b65 7927 2c20 6465 6661 756c  vatekey', defaul
+0000b070: 745f 7072 6976 6174 656b 6579 290a 2020  t_privatekey).  
+0000b080: 2020 2020 2020 6e65 7477 6f72 6b77 6169        networkwai
+0000b090: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
+0000b0a0: 276e 6574 776f 726b 7761 6974 272c 2064  'networkwait', d
+0000b0b0: 6566 6175 6c74 5f6e 6574 776f 726b 7761  efault_networkwa
+0000b0c0: 6974 290a 2020 2020 2020 2020 7268 6e72  it).        rhnr
+0000b0d0: 6567 6973 7465 7220 3d20 7072 6f66 696c  egister = profil
+0000b0e0: 652e 6765 7428 2772 686e 7265 6769 7374  e.get('rhnregist
+0000b0f0: 6572 272c 2064 6566 6175 6c74 5f72 686e  er', default_rhn
+0000b100: 7265 6769 7374 6572 290a 2020 2020 2020  register).      
+0000b110: 2020 7268 6e73 6572 7665 7220 3d20 7072    rhnserver = pr
+0000b120: 6f66 696c 652e 6765 7428 2772 686e 7365  ofile.get('rhnse
+0000b130: 7276 6572 272c 2064 6566 6175 6c74 5f72  rver', default_r
+0000b140: 686e 7365 7276 6572 290a 2020 2020 2020  hnserver).      
+0000b150: 2020 7268 6e75 7365 7220 3d20 7072 6f66    rhnuser = prof
+0000b160: 696c 652e 6765 7428 2772 686e 7573 6572  ile.get('rhnuser
+0000b170: 272c 2064 6566 6175 6c74 5f72 686e 7573  ', default_rhnus
+0000b180: 6572 290a 2020 2020 2020 2020 7268 6e70  er).        rhnp
+0000b190: 6173 7377 6f72 6420 3d20 7072 6f66 696c  assword = profil
+0000b1a0: 652e 6765 7428 2772 686e 7061 7373 776f  e.get('rhnpasswo
+0000b1b0: 7264 272c 2064 6566 6175 6c74 5f72 686e  rd', default_rhn
+0000b1c0: 7061 7373 776f 7264 290a 2020 2020 2020  password).      
+0000b1d0: 2020 7268 6e61 6b20 3d20 7072 6f66 696c    rhnak = profil
+0000b1e0: 652e 6765 7428 2772 686e 6163 7469 7661  e.get('rhnactiva
+0000b1f0: 7469 6f6e 6b65 7927 2c20 6465 6661 756c  tionkey', defaul
+0000b200: 745f 7268 6e61 6b29 0a20 2020 2020 2020  t_rhnak).       
+0000b210: 2072 686e 6f72 6720 3d20 7072 6f66 696c   rhnorg = profil
+0000b220: 652e 6765 7428 2772 686e 6f72 6727 2c20  e.get('rhnorg', 
+0000b230: 6465 6661 756c 745f 7268 6e6f 7267 290a  default_rhnorg).
+0000b240: 2020 2020 2020 2020 7268 6e70 6f6f 6c20          rhnpool 
+0000b250: 3d20 7072 6f66 696c 652e 6765 7428 2772  = profile.get('r
+0000b260: 686e 706f 6f6c 272c 2064 6566 6175 6c74  hnpool', default
+0000b270: 5f72 686e 706f 6f6c 290a 2020 2020 2020  _rhnpool).      
+0000b280: 2020 666c 6176 6f72 203d 2070 726f 6669    flavor = profi
+0000b290: 6c65 2e67 6574 2827 666c 6176 6f72 272c  le.get('flavor',
+0000b2a0: 2064 6566 6175 6c74 5f66 6c61 766f 7229   default_flavor)
+0000b2b0: 0a20 2020 2020 2020 2073 746f 7265 6d65  .        storeme
+0000b2c0: 7461 6461 7461 203d 2070 726f 6669 6c65  tadata = profile
+0000b2d0: 2e67 6574 2827 7374 6f72 656d 6574 6164  .get('storemetad
+0000b2e0: 6174 6127 2c20 6465 6661 756c 745f 7374  ata', default_st
+0000b2f0: 6f72 656d 6574 6164 6174 6129 0a20 2020  oremetadata).   
+0000b300: 2020 2020 206e 6f74 6966 7920 3d20 7072       notify = pr
+0000b310: 6f66 696c 652e 6765 7428 276e 6f74 6966  ofile.get('notif
+0000b320: 7927 2c20 6465 6661 756c 745f 6e6f 7469  y', default_noti
+0000b330: 6679 290a 2020 2020 2020 2020 7075 7368  fy).        push
+0000b340: 6275 6c6c 6574 746f 6b65 6e20 3d20 7072  bullettoken = pr
+0000b350: 6f66 696c 652e 6765 7428 2770 7573 6862  ofile.get('pushb
+0000b360: 756c 6c65 7474 6f6b 656e 272c 2064 6566  ullettoken', def
+0000b370: 6175 6c74 5f70 7573 6862 756c 6c65 7474  ault_pushbullett
+0000b380: 6f6b 656e 290a 2020 2020 2020 2020 736c  oken).        sl
+0000b390: 6163 6b74 6f6b 656e 203d 2070 726f 6669  acktoken = profi
+0000b3a0: 6c65 2e67 6574 2827 736c 6163 6b74 6f6b  le.get('slacktok
+0000b3b0: 656e 272c 2064 6566 6175 6c74 5f73 6c61  en', default_sla
+0000b3c0: 636b 746f 6b65 6e29 0a20 2020 2020 2020  cktoken).       
+0000b3d0: 206e 6f74 6966 7963 6d64 203d 2070 726f   notifycmd = pro
+0000b3e0: 6669 6c65 2e67 6574 2827 6e6f 7469 6679  file.get('notify
+0000b3f0: 636d 6427 2c20 6465 6661 756c 745f 6e6f  cmd', default_no
+0000b400: 7469 6679 636d 6429 0a20 2020 2020 2020  tifycmd).       
+0000b410: 206e 6f74 6966 7973 6372 6970 7420 3d20   notifyscript = 
+0000b420: 7072 6f66 696c 652e 6765 7428 276e 6f74  profile.get('not
+0000b430: 6966 7973 6372 6970 7427 2c20 6465 6661  ifyscript', defa
+0000b440: 756c 745f 6e6f 7469 6679 7363 7269 7074  ult_notifyscript
+0000b450: 290a 2020 2020 2020 2020 6e6f 7469 6679  ).        notify
+0000b460: 6d65 7468 6f64 7320 3d20 7072 6f66 696c  methods = profil
+0000b470: 652e 6765 7428 276e 6f74 6966 796d 6574  e.get('notifymet
+0000b480: 686f 6473 272c 2064 6566 6175 6c74 5f6e  hods', default_n
+0000b490: 6f74 6966 796d 6574 686f 6473 290a 2020  otifymethods).  
+0000b4a0: 2020 2020 2020 736c 6163 6b63 6861 6e6e        slackchann
+0000b4b0: 656c 203d 2070 726f 6669 6c65 2e67 6574  el = profile.get
+0000b4c0: 2827 736c 6163 6b63 6861 6e6e 656c 272c  ('slackchannel',
+0000b4d0: 2064 6566 6175 6c74 5f73 6c61 636b 6368   default_slackch
+0000b4e0: 616e 6e65 6c29 0a20 2020 2020 2020 206d  annel).        m
+0000b4f0: 6169 6c73 6572 7665 7220 3d20 7072 6f66  ailserver = prof
+0000b500: 696c 652e 6765 7428 276d 6169 6c73 6572  ile.get('mailser
+0000b510: 7665 7227 2c20 6465 6661 756c 745f 6d61  ver', default_ma
+0000b520: 696c 7365 7276 6572 290a 2020 2020 2020  ilserver).      
+0000b530: 2020 6d61 696c 6672 6f6d 203d 2070 726f    mailfrom = pro
+0000b540: 6669 6c65 2e67 6574 2827 6d61 696c 6672  file.get('mailfr
+0000b550: 6f6d 272c 2064 6566 6175 6c74 5f6d 6169  om', default_mai
+0000b560: 6c66 726f 6d29 0a20 2020 2020 2020 206d  lfrom).        m
+0000b570: 6169 6c74 6f20 3d20 7072 6f66 696c 652e  ailto = profile.
+0000b580: 6765 7428 276d 6169 6c74 6f27 2c20 6465  get('mailto', de
+0000b590: 6661 756c 745f 6d61 696c 746f 290a 2020  fault_mailto).  
+0000b5a0: 2020 2020 2020 7368 6172 6564 666f 6c64        sharedfold
+0000b5b0: 6572 7320 3d20 7072 6f66 696c 652e 6765  ers = profile.ge
+0000b5c0: 7428 2773 6861 7265 6466 6f6c 6465 7273  t('sharedfolders
+0000b5d0: 272c 2064 6566 6175 6c74 5f73 6861 7265  ', default_share
+0000b5e0: 6466 6f6c 6465 7273 290a 2020 2020 2020  dfolders).      
+0000b5f0: 2020 6b65 726e 656c 203d 2070 726f 6669    kernel = profi
+0000b600: 6c65 2e67 6574 2827 6b65 726e 656c 272c  le.get('kernel',
+0000b610: 2064 6566 6175 6c74 5f6b 6572 6e65 6c29   default_kernel)
+0000b620: 0a20 2020 2020 2020 2069 6e69 7472 6420  .        initrd 
+0000b630: 3d20 7072 6f66 696c 652e 6765 7428 2769  = profile.get('i
+0000b640: 6e69 7472 6427 2c20 6465 6661 756c 745f  nitrd', default_
+0000b650: 696e 6974 7264 290a 2020 2020 2020 2020  initrd).        
+0000b660: 636d 646c 696e 6520 3d20 7072 6f66 696c  cmdline = profil
+0000b670: 652e 6765 7428 2763 6d64 6c69 6e65 272c  e.get('cmdline',
+0000b680: 2064 6566 6175 6c74 5f63 6d64 6c69 6e65   default_cmdline
+0000b690: 290a 2020 2020 2020 2020 706c 6163 656d  ).        placem
+0000b6a0: 656e 7420 3d20 7072 6f66 696c 652e 6765  ent = profile.ge
+0000b6b0: 7428 2770 6c61 6365 6d65 6e74 272c 2064  t('placement', d
+0000b6c0: 6566 6175 6c74 5f70 6c61 6365 6d65 6e74  efault_placement
+0000b6d0: 290a 2020 2020 2020 2020 7961 6d6c 696e  ).        yamlin
+0000b6e0: 7665 6e74 6f72 7920 3d20 7072 6f66 696c  ventory = profil
+0000b6f0: 652e 6765 7428 2779 616d 6c69 6e76 656e  e.get('yamlinven
+0000b700: 746f 7279 272c 2064 6566 6175 6c74 5f79  tory', default_y
+0000b710: 616d 6c69 6e76 656e 746f 7279 290a 2020  amlinventory).  
+0000b720: 2020 2020 2020 6370 7568 6f74 706c 7567        cpuhotplug
+0000b730: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0000b740: 6370 7568 6f74 706c 7567 272c 2064 6566  cpuhotplug', def
+0000b750: 6175 6c74 5f63 7075 686f 7470 6c75 6729  ault_cpuhotplug)
+0000b760: 0a20 2020 2020 2020 206d 656d 6f72 7968  .        memoryh
+0000b770: 6f74 706c 7567 203d 2070 726f 6669 6c65  otplug = profile
+0000b780: 2e67 6574 2827 6d65 6d6f 7279 686f 7470  .get('memoryhotp
+0000b790: 6c75 6727 2c20 6465 6661 756c 745f 6d65  lug', default_me
+0000b7a0: 6d6f 7279 686f 7470 6c75 6729 0a20 2020  moryhotplug).   
+0000b7b0: 2020 2020 2072 6f6f 7470 6173 7377 6f72       rootpasswor
+0000b7c0: 6420 3d20 7072 6f66 696c 652e 6765 7428  d = profile.get(
+0000b7d0: 2772 6f6f 7470 6173 7377 6f72 6427 2c20  'rootpassword', 
+0000b7e0: 6465 6661 756c 745f 726f 6f74 7061 7373  default_rootpass
+0000b7f0: 776f 7264 290a 2020 2020 2020 2020 766d  word).        vm
+0000b800: 7573 6572 203d 2070 726f 6669 6c65 2e67  user = profile.g
+0000b810: 6574 2827 766d 7573 6572 272c 2064 6566  et('vmuser', def
+0000b820: 6175 6c74 5f76 6d75 7365 7229 0a20 2020  ault_vmuser).   
+0000b830: 2020 2020 2074 656d 706b 6579 203d 2070       tempkey = p
+0000b840: 726f 6669 6c65 2e67 6574 2827 7465 6d70  rofile.get('temp
+0000b850: 6b65 7927 2c20 6465 6661 756c 745f 7465  key', default_te
+0000b860: 6d70 6b65 7929 0a20 2020 2020 2020 2077  mpkey).        w
+0000b870: 6169 7420 3d20 7072 6f66 696c 652e 6765  ait = profile.ge
+0000b880: 7428 2777 6169 7427 2c20 6465 6661 756c  t('wait', defaul
+0000b890: 745f 7761 6974 290a 2020 2020 2020 2020  t_wait).        
+0000b8a0: 7761 6974 636f 6d6d 616e 6420 3d20 7072  waitcommand = pr
+0000b8b0: 6f66 696c 652e 6765 7428 2777 6169 7463  ofile.get('waitc
+0000b8c0: 6f6d 6d61 6e64 272c 2064 6566 6175 6c74  ommand', default
+0000b8d0: 5f77 6169 7463 6f6d 6d61 6e64 290a 2020  _waitcommand).  
+0000b8e0: 2020 2020 2020 6966 2077 6169 7463 6f6d        if waitcom
+0000b8f0: 6d61 6e64 2069 7320 6e6f 7420 4e6f 6e65  mand is not None
+0000b900: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
+0000b910: 6974 203d 2054 7275 650a 2020 2020 2020  it = True.      
+0000b920: 2020 7761 6974 7469 6d65 6f75 7420 3d20    waittimeout = 
+0000b930: 7072 6f66 696c 652e 6765 7428 2777 6169  profile.get('wai
+0000b940: 7474 696d 656f 7574 272c 2064 6566 6175  ttimeout', defau
+0000b950: 6c74 5f77 6169 7474 696d 656f 7574 290a  lt_waittimeout).
+0000b960: 2020 2020 2020 2020 7669 7274 7479 7065          virttype
+0000b970: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0000b980: 7669 7274 7479 7065 272c 2064 6566 6175  virttype', defau
+0000b990: 6c74 5f76 6972 7474 7970 6529 0a20 2020  lt_virttype).   
+0000b9a0: 2020 2020 206f 7665 7272 6964 6573 2e75       overrides.u
+0000b9b0: 7064 6174 6528 7072 6f66 696c 6529 0a20  pdate(profile). 
+0000b9c0: 2020 2020 2020 2073 6372 6970 7463 6d64         scriptcmd
+0000b9d0: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
+0000b9e0: 6620 696d 6167 6520 6973 206e 6f74 204e  f image is not N
+0000b9f0: 6f6e 6520 616e 6420 2772 6865 6c27 2069  one and 'rhel' i
+0000ba00: 6e20 696d 6167 652e 6c6f 7765 7228 293a  n image.lower():
+0000ba10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000ba20: 7268 6e72 6567 6973 7465 723a 0a20 2020  rhnregister:.   
+0000ba30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000ba40: 7268 6e75 7365 7220 6973 206e 6f74 204e  rhnuser is not N
+0000ba50: 6f6e 6520 616e 6420 7268 6e70 6173 7377  one and rhnpassw
+0000ba60: 6f72 6420 6973 206e 6f74 204e 6f6e 653a  ord is not None:
+0000ba70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ba80: 2020 2020 206f 7665 7272 6964 6573 5b27       overrides['
+0000ba90: 7268 6e75 7365 7227 5d20 3d20 7268 6e75  rhnuser'] = rhnu
+0000baa0: 7365 720a 2020 2020 2020 2020 2020 2020  ser.            
+0000bab0: 2020 2020 2020 2020 6f76 6572 7269 6465          override
+0000bac0: 735b 2772 686e 7061 7373 776f 7264 275d  s['rhnpassword']
+0000bad0: 203d 2072 686e 7061 7373 776f 7264 0a20   = rhnpassword. 
+0000bae0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000baf0: 6c69 6620 7268 6e61 6b20 6973 206e 6f74  lif rhnak is not
+0000bb00: 204e 6f6e 6520 616e 6420 7268 6e6f 7267   None and rhnorg
+0000bb10: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb30: 2020 6f76 6572 7269 6465 735b 2772 686e    overrides['rhn
+0000bb40: 6163 7469 7661 7469 6f6e 6b65 7927 5d20  activationkey'] 
+0000bb50: 3d20 7268 6e61 6b0a 2020 2020 2020 2020  = rhnak.        
+0000bb60: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+0000bb70: 7269 6465 735b 2772 686e 6f72 6727 5d20  rides['rhnorg'] 
+0000bb80: 3d20 7268 6e6f 7267 0a20 2020 2020 2020  = rhnorg.       
+0000bb90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbb0: 2020 206d 7367 203d 2022 5268 6e20 7265     msg = "Rhn re
+0000bbc0: 6769 7374 7261 7469 6f6e 2072 6571 7569  gistration requi
+0000bbd0: 7265 6420 6275 7420 6d69 7373 696e 6720  red but missing 
+0000bbe0: 6372 6564 656e 7469 616c 732e 2022 0a20  credentials. ". 
+0000bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc00: 2020 206d 7367 202b 3d20 2244 6566 696e     msg += "Defin
+0000bc10: 6520 7268 6e75 7365 722f 7268 6e70 6173  e rhnuser/rhnpas
+0000bc20: 7377 6f72 6420 6f72 2072 686e 6163 7469  sword or rhnacti
+0000bc30: 7661 7469 6f6e 6b65 792f 7268 6e6f 7267  vationkey/rhnorg
+0000bc40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000bc50: 2020 2020 2020 7761 726e 696e 6728 6d73        warning(ms
+0000bc60: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
+0000bc70: 2020 2020 2020 2072 686e 7265 6769 7374         rhnregist
+0000bc80: 6572 203d 2046 616c 7365 0a20 2020 2020  er = False.     
+0000bc90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000bca0: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0000bcb0: 6e69 6e67 2866 227b 6e61 6d65 7d20 7769  ning(f"{name} wi
+0000bcc0: 6c6c 2072 6571 7569 7265 206d 616e 7561  ll require manua
+0000bcd0: 6c20 7375 6273 6372 6970 7469 6f6e 2074  l subscription t
+0000bce0: 6f20 5265 6420 4861 7420 4e65 7477 6f72  o Red Hat Networ
+0000bcf0: 6b22 290a 2020 2020 2020 2020 6966 2069  k").        if i
+0000bd00: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
+0000bd10: 2061 6e64 2063 6c6f 7564 696e 6974 2061   and cloudinit a
+0000bd20: 6e64 2069 736f 2069 7320 6e6f 7420 4e6f  nd iso is not No
+0000bd30: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000bd40: 7761 726e 696e 6728 6622 4967 6e6f 7269  warning(f"Ignori
+0000bd50: 6e67 2069 736f 207b 6973 6f7d 2061 7320  ng iso {iso} as 
+0000bd60: 696d 6167 6520 7b69 6d61 6765 7d20 6973  image {image} is
+0000bd70: 2073 6574 2229 0a20 2020 2020 2020 2069   set").        i
+0000bd80: 6620 7363 7269 7074 733a 0a20 2020 2020  f scripts:.     
+0000bd90: 2020 2020 2020 2066 6f72 2073 6372 6970         for scrip
+0000bda0: 7420 696e 2073 6372 6970 7473 3a0a 2020  t in scripts:.  
+0000bdb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000bdc0: 206f 6e66 6c79 2069 7320 6e6f 7420 4e6f   onfly is not No
+0000bdd0: 6e65 2061 6e64 2027 7e27 206e 6f74 2069  ne and '~' not i
+0000bde0: 6e20 7363 7269 7074 3a0a 2020 2020 2020  n script:.      
+0000bdf0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0000be00: 7374 6469 7220 3d20 6261 7365 6469 720a  stdir = basedir.
+0000be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be20: 2020 2020 6966 2027 2f27 2069 6e20 7363      if '/' in sc
+0000be30: 7269 7074 3a0a 2020 2020 2020 2020 2020  ript:.          
+0000be40: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0000be50: 7374 6469 7220 3d20 6f73 2e70 6174 682e  stdir = os.path.
+0000be60: 6469 726e 616d 6528 7363 7269 7074 290a  dirname(script).
+0000be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be80: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
+0000be90: 6972 7328 6465 7374 6469 722c 2065 7869  irs(destdir, exi
+0000bea0: 7374 5f6f 6b3d 5472 7565 290a 2020 2020  st_ok=True).    
+0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bec0: 636f 6d6d 6f6e 2e66 6574 6368 2866 227b  common.fetch(f"{
+0000bed0: 6f6e 666c 797d 2f7b 7363 7269 7074 7d22  onfly}/{script}"
+0000bee0: 2c20 6465 7374 6469 7229 0a20 2020 2020  , destdir).     
+0000bef0: 2020 2020 2020 2020 2020 2073 6372 6970             scrip
+0000bf00: 7420 3d20 6f73 2e70 6174 682e 6578 7061  t = os.path.expa
+0000bf10: 6e64 7573 6572 2873 6372 6970 7429 0a20  nduser(script). 
+0000bf20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000bf30: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+0000bf40: 2873 6372 6970 7429 3a0a 2020 2020 2020  (script):.      
+0000bf50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000bf60: 206e 6f74 206f 732e 7061 7468 2e69 7361   not os.path.isa
+0000bf70: 6273 2873 6372 6970 7429 3a0a 2020 2020  bs(script):.    
+0000bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf90: 2020 2020 7363 7269 7074 203d 206f 732e      script = os.
+0000bfa0: 7061 7468 2e61 6273 7061 7468 2873 6372  path.abspath(scr
+0000bfb0: 6970 7429 0a20 2020 2020 2020 2020 2020  ipt).           
+0000bfc0: 2020 2020 2065 6c69 6620 6261 7365 6469       elif basedi
+0000bfd0: 7220 213d 2027 2e27 3a0a 2020 2020 2020  r != '.':.      
+0000bfe0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0000bff0: 7269 7074 203d 2066 277b 6261 7365 6469  ript = f'{basedi
+0000c000: 727d 2f7b 7363 7269 7074 7d27 0a20 2020  r}/{script}'.   
+0000c010: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000c020: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+0000c030: 7473 2873 6372 6970 7429 3a0a 2020 2020  ts(script):.    
+0000c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c050: 6572 726f 7228 6622 5363 7269 7074 2066  error(f"Script f
+0000c060: 696c 6520 7b73 6372 6970 747d 206e 6f74  ile {script} not
+0000c070: 2066 6f75 6e64 2229 0a20 2020 2020 2020   found").       
+0000c080: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+0000c090: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+0000c0a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0c0: 2020 2073 6372 6970 7462 6173 6564 6972     scriptbasedir
+0000c0d0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+0000c0e0: 6d65 2873 6372 6970 7429 2069 6620 6f73  me(script) if os
+0000c0f0: 2e70 6174 682e 6469 726e 616d 6528 7363  .path.dirname(sc
+0000c100: 7269 7074 2920 213d 2027 2720 656c 7365  ript) != '' else
+0000c110: 2027 2e27 0a20 2020 2020 2020 2020 2020   '.'.           
+0000c120: 2020 2020 2020 2020 2065 6e76 203d 2045           env = E
+0000c130: 6e76 6972 6f6e 6d65 6e74 286c 6f61 6465  nvironment(loade
+0000c140: 723d 4669 6c65 5379 7374 656d 4c6f 6164  r=FileSystemLoad
+0000c150: 6572 2873 6372 6970 7462 6173 6564 6972  er(scriptbasedir
+0000c160: 292c 2075 6e64 6566 696e 6564 3d75 6e64  ), undefined=und
+0000c170: 6566 696e 6564 2c0a 2020 2020 2020 2020  efined,.        
+0000c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c190: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0000c1a0: 7465 6e73 696f 6e73 3d5b 276a 696e 6a61  tensions=['jinja
+0000c1b0: 322e 6578 742e 646f 275d 2c20 7472 696d  2.ext.do'], trim
+0000c1c0: 5f62 6c6f 636b 733d 5472 7565 2c20 6c73  _blocks=True, ls
+0000c1d0: 7472 6970 5f62 6c6f 636b 733d 5472 7565  trip_blocks=True
+0000c1e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c1f0: 2020 2020 2020 666f 7220 6a69 6e6a 6166        for jinjaf
+0000c200: 696c 7465 7220 696e 206a 696e 6a61 6669  ilter in jinjafi
+0000c210: 6c74 6572 732e 6a69 6e6a 6166 696c 7465  lters.jinjafilte
+0000c220: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0000c230: 2020 2020 2020 2020 2020 2020 656e 762e              env.
+0000c240: 6669 6c74 6572 735b 6a69 6e6a 6166 696c  filters[jinjafil
+0000c250: 7465 725d 203d 206a 696e 6a61 6669 6c74  ter] = jinjafilt
+0000c260: 6572 732e 6a69 6e6a 6166 696c 7465 7273  ers.jinjafilters
+0000c270: 5b6a 696e 6a61 6669 6c74 6572 5d0a 2020  [jinjafilter].  
+0000c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c290: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000c2b0: 656d 706c 203d 2065 6e76 2e67 6574 5f74  empl = env.get_t
+0000c2c0: 656d 706c 6174 6528 6f73 2e70 6174 682e  emplate(os.path.
+0000c2d0: 6261 7365 6e61 6d65 2873 6372 6970 7429  basename(script)
+0000c2e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c2f0: 2020 2020 2020 2020 2020 7363 7269 7074            script
+0000c300: 656e 7472 6965 7320 3d20 7465 6d70 6c2e  entries = templ.
+0000c310: 7265 6e64 6572 286f 7665 7272 6964 6573  render(overrides
+0000c320: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c330: 2020 2020 2020 6578 6365 7074 2054 656d        except Tem
+0000c340: 706c 6174 654e 6f74 466f 756e 643a 0a20  plateNotFound:. 
+0000c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c360: 2020 2020 2020 2065 7272 6f72 2866 2253         error(f"S
+0000c370: 6372 6970 7420 6669 6c65 207b 6f73 2e70  cript file {os.p
+0000c380: 6174 682e 6261 7365 6e61 6d65 2873 6372  ath.basename(scr
+0000c390: 6970 7429 7d20 6e6f 7420 666f 756e 6422  ipt)} not found"
+0000c3a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c3b0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+0000c3c0: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+0000c3d0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000c3e0: 2054 656d 706c 6174 6553 796e 7461 7845   TemplateSyntaxE
+0000c3f0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+0000c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c410: 2020 206d 7367 203d 2066 2245 7272 6f72     msg = f"Error
+0000c420: 2072 656e 6465 7269 6e67 206c 696e 6520   rendering line 
+0000c430: 7b65 2e6c 696e 656e 6f7d 206f 6620 7363  {e.lineno} of sc
+0000c440: 7269 7074 2066 696c 6520 7b65 2e66 696c  ript file {e.fil
+0000c450: 656e 616d 657d 2e20 476f 743a 207b 652e  ename}. Got: {e.
+0000c460: 6d65 7373 6167 657d 220a 2020 2020 2020  message}".      
+0000c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c480: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+0000c490: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
+0000c4a0: 7265 6173 6f6e 273a 206d 7367 7d0a 2020  reason': msg}.  
+0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4c0: 2020 6578 6365 7074 2054 656d 706c 6174    except Templat
+0000c4d0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+0000c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4f0: 2020 2020 206d 7367 203d 2066 2245 7272       msg = f"Err
+0000c500: 6f72 2072 656e 6465 7269 6e67 2073 6372  or rendering scr
+0000c510: 6970 7420 6669 6c65 207b 7363 7269 7074  ipt file {script
+0000c520: 7d2e 2047 6f74 3a20 7b65 2e6d 6573 7361  }. Got: {e.messa
+0000c530: 6765 7d22 0a20 2020 2020 2020 2020 2020  ge}".           
+0000c540: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000c550: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+0000c560: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
+0000c570: 6e27 3a20 6d73 677d 0a20 2020 2020 2020  n': msg}.       
+0000c580: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0000c590: 6970 746c 696e 6573 203d 205b 6c69 6e65  iptlines = [line
+0000c5a0: 2e73 7472 6970 2829 2066 6f72 206c 696e  .strip() for lin
+0000c5b0: 6520 696e 2073 6372 6970 7465 6e74 7269  e in scriptentri
+0000c5c0: 6573 2e73 706c 6974 2827 5c6e 2729 2069  es.split('\n') i
+0000c5d0: 6620 6c69 6e65 2e73 7472 6970 2829 2021  f line.strip() !
+0000c5e0: 3d20 2727 5d0a 2020 2020 2020 2020 2020  = ''].          
+0000c5f0: 2020 2020 2020 2020 2020 6966 2073 6372            if scr
+0000c600: 6970 746c 696e 6573 3a0a 2020 2020 2020  iptlines:.      
+0000c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c620: 2020 7363 7269 7074 6c69 6e65 732e 696e    scriptlines.in
+0000c630: 7365 7274 2830 2c20 6622 6563 686f 2052  sert(0, f"echo R
+0000c640: 756e 6e69 6e67 2073 6372 6970 7420 7b6f  unning script {o
+0000c650: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0000c660: 7363 7269 7074 297d 2229 0a20 2020 2020  script)}").     
+0000c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c680: 2020 2073 6372 6970 7463 6d64 732e 6578     scriptcmds.ex
+0000c690: 7465 6e64 2873 6372 6970 746c 696e 6573  tend(scriptlines
+0000c6a0: 290a 2020 2020 2020 2020 6966 2063 6c6f  ).        if clo
+0000c6b0: 7564 696e 6974 2061 6e64 2069 6d61 6765  udinit and image
+0000c6c0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0000c6d0: 2027 7268 656c 2720 696e 2069 6d61 6765   'rhel' in image
+0000c6e0: 2e6c 6f77 6572 2829 3a0a 2020 2020 2020  .lower():.      
+0000c6f0: 2020 2020 2020 7268 6e63 6f6d 6d61 6e64        rhncommand
+0000c700: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+0000c710: 2020 2069 6620 7268 6e73 6572 7665 7220     if rhnserver 
+0000c720: 213d 2022 6874 7470 733a 2f2f 7375 6273  != "https://subs
+0000c730: 6372 6970 7469 6f6e 2e72 6873 6d2e 7265  cription.rhsm.re
+0000c740: 6468 6174 2e63 6f6d 2220 616e 6420 6e6f  dhat.com" and no
+0000c750: 7420 7661 6c69 645f 6970 2872 686e 7365  t valid_ip(rhnse
+0000c760: 7276 6572 293a 0a20 2020 2020 2020 2020  rver):.         
+0000c770: 2020 2020 2020 2066 7164 6e20 3d20 6f73         fqdn = os
+0000c780: 2e70 6174 682e 6261 7365 6e61 6d65 2872  .path.basename(r
+0000c790: 686e 7365 7276 6572 290a 2020 2020 2020  hnserver).      
+0000c7a0: 2020 2020 2020 2020 2020 7268 6e63 6f6d            rhncom
+0000c7b0: 6d61 6e64 732e 6170 7065 6e64 2866 2772  mands.append(f'r
+0000c7c0: 706d 202d 5576 6820 6874 7470 3a2f 2f7b  pm -Uvh http://{
+0000c7d0: 6671 646e 7d2f 7075 622f 6b61 7465 6c6c  fqdn}/pub/katell
+0000c7e0: 6f2d 6361 2d63 6f6e 7375 6d65 722d 6c61  o-ca-consumer-la
+0000c7f0: 7465 7374 2e6e 6f61 7263 682e 7270 6d27  test.noarch.rpm'
+0000c800: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000c810: 2072 686e 616b 2069 7320 6e6f 7420 4e6f   rhnak is not No
+0000c820: 6e65 2061 6e64 2072 686e 6f72 6720 6973  ne and rhnorg is
+0000c830: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000c840: 2020 2020 2020 2020 2020 2072 686e 636f             rhnco
+0000c850: 6d6d 616e 6473 2e61 7070 656e 6428 2773  mmands.append('s
+0000c860: 7562 7363 7269 7074 696f 6e2d 6d61 6e61  ubscription-mana
+0000c870: 6765 7220 7265 6769 7374 6572 202d 2d73  ger register --s
+0000c880: 6572 7665 7275 726c 3d25 7320 2d2d 666f  erverurl=%s --fo
+0000c890: 7263 6520 2d2d 6163 7469 7661 7469 6f6e  rce --activation
+0000c8a0: 6b65 793d 2573 202d 2d6f 7267 3d25 7327  key=%s --org=%s'
+0000c8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8d0: 2020 2020 2520 2872 686e 7365 7276 6572      % (rhnserver
+0000c8e0: 2c20 7268 6e61 6b2c 2072 686e 6f72 6729  , rhnak, rhnorg)
+0000c8f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c900: 2020 6966 2069 6d61 6765 2e73 7461 7274    if image.start
+0000c910: 7377 6974 6828 2772 6865 6c2d 3827 2920  swith('rhel-8') 
+0000c920: 6f72 2069 6d61 6765 203d 3d20 2772 6865  or image == 'rhe
+0000c930: 6c38 273a 0a20 2020 2020 2020 2020 2020  l8':.           
+0000c940: 2020 2020 2020 2020 2072 686e 636f 6d6d           rhncomm
+0000c950: 616e 6473 2e61 7070 656e 6428 2773 7562  ands.append('sub
+0000c960: 7363 7269 7074 696f 6e2d 6d61 6e61 6765  scription-manage
+0000c970: 7220 7265 706f 7320 2d2d 656e 6162 6c65  r repos --enable
+0000c980: 3d72 6865 6c2d 382d 666f 722d 7838 365f  =rhel-8-for-x86_
+0000c990: 3634 2d62 6173 656f 732d 7270 6d73 2729  64-baseos-rpms')
+0000c9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c9b0: 2065 6c69 6620 696d 6167 652e 7374 6172   elif image.star
+0000c9c0: 7473 7769 7468 2827 7268 656c 2d73 6572  tswith('rhel-ser
+0000c9d0: 7665 722d 3727 2920 6f72 2069 6d61 6765  ver-7') or image
+0000c9e0: 203d 3d20 2772 6865 6c37 273a 0a20 2020   == 'rhel7':.   
 0000c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca20: 2020 736c 6163 6b63 6861 6e6e 656c 3d73    slackchannel=s
-0000ca30: 6c61 636b 6368 616e 6e65 6c2c 2073 6c61  lackchannel, sla
-0000ca40: 636b 746f 6b65 6e3d 736c 6163 6b74 6f6b  cktoken=slacktok
-0000ca50: 656e 2c0a 2020 2020 2020 2020 2020 2020  en,.            
-0000ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca90: 2020 2020 6d61 696c 7365 7276 6572 3d6d      mailserver=m
-0000caa0: 6169 6c73 6572 7665 722c 206d 6169 6c66  ailserver, mailf
-0000cab0: 726f 6d3d 6d61 696c 6672 6f6d 2c20 6d61  rom=mailfrom, ma
-0000cac0: 696c 746f 3d6d 6169 6c74 6f29 0a20 2020  ilto=mailto).   
-0000cad0: 2020 2020 2020 2020 2069 6620 6d61 696c           if mail
-0000cae0: 636f 6e74 656e 7420 6973 206e 6f74 204e  content is not N
-0000caf0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000cb00: 2020 2020 2066 696c 6573 2e61 7070 656e       files.appen
-0000cb10: 6428 7b27 7061 7468 273a 2027 2f76 6172  d({'path': '/var
-0000cb20: 2f74 6d70 2f6d 6169 6c2e 7478 7427 2c20  /tmp/mail.txt', 
-0000cb30: 2763 6f6e 7465 6e74 273a 206d 6169 6c63  'content': mailc
-0000cb40: 6f6e 7465 6e74 7d29 0a20 2020 2020 2020  ontent}).       
-0000cb50: 2020 2020 2069 6620 6e6f 7469 6679 636d       if notifycm
-0000cb60: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
-0000cb70: 2020 2020 6966 206e 6f74 2063 6d64 733a      if not cmds:
-0000cb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cb90: 2020 2020 2063 6d64 7320 3d20 6e6f 7469       cmds = noti
-0000cba0: 6679 636d 6473 0a20 2020 2020 2020 2020  fycmds.         
-0000cbb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbd0: 2063 6d64 732e 6578 7465 6e64 286e 6f74   cmds.extend(not
-0000cbe0: 6966 7963 6d64 7329 0a20 2020 2020 2020  ifycmds).       
-0000cbf0: 2069 7073 203d 205b 6f76 6572 7269 6465   ips = [override
-0000cc00: 735b 6b65 795d 2066 6f72 206b 6579 2069  s[key] for key i
-0000cc10: 6e20 6f76 6572 7269 6465 7320 6966 2072  n overrides if r
-0000cc20: 652e 6d61 7463 6828 2769 705b 302d 395d  e.match('ip[0-9]
-0000cc30: 2b27 2c20 6b65 7929 5d0a 2020 2020 2020  +', key)].      
-0000cc40: 2020 6e65 746d 6173 6b73 203d 205b 6f76    netmasks = [ov
-0000cc50: 6572 7269 6465 735b 6b65 795d 2066 6f72  errides[key] for
-0000cc60: 206b 6579 2069 6e20 6f76 6572 7269 6465   key in override
-0000cc70: 7320 6966 2072 652e 6d61 7463 6828 276e  s if re.match('n
-0000cc80: 6574 6d61 736b 5b30 2d39 5d2b 272c 206b  etmask[0-9]+', k
-0000cc90: 6579 295d 0a20 2020 2020 2020 2069 6620  ey)].        if 
-0000cca0: 7072 6976 6174 656b 6579 2061 6e64 2073  privatekey and s
-0000ccb0: 656c 662e 7479 7065 203d 3d20 276b 766d  elf.type == 'kvm
-0000ccc0: 273a 0a20 2020 2020 2020 2020 2020 2070  ':.            p
-0000ccd0: 7269 7661 7465 6b65 7966 696c 6520 3d20  rivatekeyfile = 
-0000cce0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0000ccf0: 2070 7562 6c69 636b 6579 6669 6c65 203d   publickeyfile =
-0000cd00: 2063 6f6d 6d6f 6e2e 6765 745f 7373 685f   common.get_ssh_
-0000cd10: 7075 625f 6b65 7928 290a 2020 2020 2020  pub_key().      
-0000cd20: 2020 2020 2020 6966 2070 7562 6c69 636b        if publick
-0000cd30: 6579 6669 6c65 2069 7320 6e6f 7420 4e6f  eyfile is not No
-0000cd40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000cd50: 2020 2020 7072 6976 6174 656b 6579 6669      privatekeyfi
-0000cd60: 6c65 203d 2070 7562 6c69 636b 6579 6669  le = publickeyfi
-0000cd70: 6c65 2e72 6570 6c61 6365 2827 2e70 7562  le.replace('.pub
-0000cd80: 272c 2027 2729 0a20 2020 2020 2020 2020  ', '').         
-0000cd90: 2020 2069 6620 7072 6976 6174 656b 6579     if privatekey
-0000cda0: 6669 6c65 2069 7320 6e6f 7420 4e6f 6e65  file is not None
-0000cdb0: 2061 6e64 2070 7562 6c69 636b 6579 6669   and publickeyfi
-0000cdc0: 6c65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  le is not None:.
-0000cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cde0: 7072 6976 6174 656b 6579 203d 206f 7065  privatekey = ope
-0000cdf0: 6e28 7072 6976 6174 656b 6579 6669 6c65  n(privatekeyfile
-0000ce00: 292e 7265 6164 2829 2e73 7472 6970 2829  ).read().strip()
-0000ce10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ce20: 2070 7562 6c69 636b 6579 203d 206f 7065   publickey = ope
-0000ce30: 6e28 7075 626c 6963 6b65 7966 696c 6529  n(publickeyfile)
-0000ce40: 2e72 6561 6428 292e 7374 7269 7028 290a  .read().strip().
-0000ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce60: 7761 726e 696e 6728 6622 496e 6a65 6374  warning(f"Inject
-0000ce70: 696e 6720 7072 6976 6174 6520 6b65 7920  ing private key 
-0000ce80: 666f 7220 7b6e 616d 657d 2229 0a20 2020  for {name}").   
-0000ce90: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000cea0: 6573 2e61 7070 656e 6428 7b27 7061 7468  es.append({'path
-0000ceb0: 273a 2027 2f72 6f6f 742f 2e73 7368 2f69  ': '/root/.ssh/i
-0000cec0: 645f 7273 6127 2c20 2763 6f6e 7465 6e74  d_rsa', 'content
-0000ced0: 273a 2070 7269 7661 7465 6b65 797d 290a  ': privatekey}).
-0000cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cef0: 6669 6c65 732e 6170 7065 6e64 287b 2770  files.append({'p
-0000cf00: 6174 6827 3a20 272f 726f 6f74 2f2e 7373  ath': '/root/.ss
-0000cf10: 682f 6964 5f72 7361 2e70 7562 272c 2027  h/id_rsa.pub', '
-0000cf20: 636f 6e74 656e 7427 3a20 7075 626c 6963  content': public
-0000cf30: 6b65 797d 290a 2020 2020 2020 2020 2020  key}).          
-0000cf40: 2020 2020 2020 6966 2073 656c 662e 686f        if self.ho
-0000cf50: 7374 2069 6e20 5b27 3132 372e 302e 302e  st in ['127.0.0.
-0000cf60: 3127 2c20 276c 6f63 616c 686f 7374 275d  1', 'localhost']
-0000cf70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000cf80: 2020 2020 2020 6175 7468 6f72 697a 6564        authorized
-0000cf90: 5f6b 6579 735f 6669 6c65 203d 206f 732e  _keys_file = os.
-0000cfa0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-0000cfb0: 277e 2f2e 7373 682f 6175 7468 6f72 697a  '~/.ssh/authoriz
-0000cfc0: 6564 5f6b 6579 7327 290a 2020 2020 2020  ed_keys').      
-0000cfd0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000cfe0: 756e 6420 3d20 4661 6c73 650a 2020 2020  und = False.    
-0000cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d000: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-0000d010: 7328 6175 7468 6f72 697a 6564 5f6b 6579  s(authorized_key
-0000d020: 735f 6669 6c65 293a 0a20 2020 2020 2020  s_file):.       
-0000d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d040: 2066 6f72 206c 696e 6520 696e 206f 7065   for line in ope
-0000d050: 6e28 6175 7468 6f72 697a 6564 5f6b 6579  n(authorized_key
-0000d060: 735f 6669 6c65 292e 7265 6164 6c69 6e65  s_file).readline
-0000d070: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d090: 2069 6620 7075 626c 6963 6b65 7920 696e   if publickey in
-0000d0a0: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
-0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0c0: 2020 2020 2020 2066 6f75 6e64 203d 2054         found = T
-0000d0d0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0000d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0f0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0000d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d110: 2020 6966 206e 6f74 2066 6f75 6e64 3a0a    if not found:.
-0000d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d130: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0000d140: 696e 6728 6622 4164 6469 6e67 2070 7562  ing(f"Adding pub
-0000d150: 6c69 6320 6b65 7920 746f 2061 7574 686f  lic key to autho
-0000d160: 7269 7a65 645f 6b65 7973 5f66 696c 6520  rized_keys_file 
-0000d170: 666f 7220 7b6e 616d 657d 2229 0a20 2020  for {name}").   
-0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d190: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-0000d1a0: 656e 2861 7574 686f 7269 7a65 645f 6b65  en(authorized_ke
-0000d1b0: 7973 5f66 696c 652c 2027 6127 2920 6173  ys_file, 'a') as
-0000d1c0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-0000d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1e0: 2020 2020 662e 7772 6974 6528 6622 5c6e      f.write(f"\n
-0000d1f0: 7b70 7562 6c69 636b 6579 7d22 290a 2020  {publickey}").  
-0000d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d210: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ca00: 2072 686e 636f 6d6d 616e 6473 2e61 7070   rhncommands.app
+0000ca10: 656e 6428 2773 7562 7363 7269 7074 696f  end('subscriptio
+0000ca20: 6e2d 6d61 6e61 6765 7220 7265 706f 7320  n-manager repos 
+0000ca30: 2d2d 656e 6162 6c65 3d72 6865 6c2d 372d  --enable=rhel-7-
+0000ca40: 7365 7276 6572 2d72 706d 7327 290a 2020  server-rpms').  
+0000ca50: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
+0000ca60: 686e 7573 6572 2069 7320 6e6f 7420 4e6f  hnuser is not No
+0000ca70: 6e65 2061 6e64 2072 686e 7061 7373 776f  ne and rhnpasswo
+0000ca80: 7264 2069 7320 6e6f 7420 4e6f 6e65 3a0a  rd is not None:.
+0000ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000caa0: 7268 6e63 6f6d 6d61 6e64 732e 6170 7065  rhncommands.appe
+0000cab0: 6e64 2827 7375 6273 6372 6970 7469 6f6e  nd('subscription
+0000cac0: 2d6d 616e 6167 6572 2072 6567 6973 7465  -manager registe
+0000cad0: 7220 2d2d 7365 7276 6572 7572 6c3d 2573  r --serverurl=%s
+0000cae0: 202d 2d66 6f72 6365 202d 2d75 7365 726e   --force --usern
+0000caf0: 616d 653d 2573 202d 2d70 6173 7377 6f72  ame=%s --passwor
+0000cb00: 643d 2573 270a 2020 2020 2020 2020 2020  d=%s'.          
+0000cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb20: 2020 2020 2020 2020 2025 2028 7268 6e73           % (rhns
+0000cb30: 6572 7665 722c 2072 686e 7573 6572 2c20  erver, rhnuser, 
+0000cb40: 7268 6e70 6173 7377 6f72 6429 290a 2020  rhnpassword)).  
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000cb60: 2072 686e 706f 6f6c 2069 7320 6e6f 7420   rhnpool is not 
+0000cb70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000cb80: 2020 2020 2020 2020 2020 7268 6e63 6f6d            rhncom
+0000cb90: 6d61 6e64 732e 6170 7065 6e64 2866 2773  mands.append(f's
+0000cba0: 7562 7363 7269 7074 696f 6e2d 6d61 6e61  ubscription-mana
+0000cbb0: 6765 7220 6174 7461 6368 202d 2d70 6f6f  ger attach --poo
+0000cbc0: 6c3d 7b72 686e 706f 6f6c 7d27 290a 2020  l={rhnpool}').  
+0000cbd0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000cbe0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000cbf0: 2020 2020 2020 2020 7268 6e63 6f6d 6d61          rhncomma
+0000cc00: 6e64 732e 6170 7065 6e64 2827 7375 6273  nds.append('subs
+0000cc10: 6372 6970 7469 6f6e 2d6d 616e 6167 6572  cription-manager
+0000cc20: 2061 7474 6163 6820 2d2d 6175 746f 2729   attach --auto')
+0000cc30: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000cc40: 2020 2020 2020 2020 2020 2072 686e 636f             rhnco
+0000cc50: 6d6d 616e 6473 203d 205b 5d0a 2020 2020  mmands = [].    
+0000cc60: 2020 2020 7368 6172 6564 666f 6c64 6572      sharedfolder
+0000cc70: 636d 6473 203d 205b 5d0a 2020 2020 2020  cmds = [].      
+0000cc80: 2020 6966 2073 6861 7265 6466 6f6c 6465    if sharedfolde
+0000cc90: 7273 2061 6e64 2073 656c 662e 7479 7065  rs and self.type
+0000cca0: 203d 3d20 276b 766d 273a 0a20 2020 2020   == 'kvm':.     
+0000ccb0: 2020 2020 2020 2066 6f72 2073 6861 7265         for share
+0000ccc0: 6466 6f6c 6465 7220 696e 2073 6861 7265  dfolder in share
+0000ccd0: 6466 6f6c 6465 7273 3a0a 2020 2020 2020  dfolders:.      
+0000cce0: 2020 2020 2020 2020 2020 6261 7365 666f            basefo
+0000ccf0: 6c64 6572 203d 206f 732e 7061 7468 2e62  lder = os.path.b
+0000cd00: 6173 656e 616d 6528 7368 6172 6564 666f  asename(sharedfo
+0000cd10: 6c64 6572 290a 2020 2020 2020 2020 2020  lder).          
+0000cd20: 2020 2020 2020 636d 6431 203d 2066 226d        cmd1 = f"m
+0000cd30: 6b64 6972 202d 7020 2f6d 6e74 2f7b 7368  kdir -p /mnt/{sh
+0000cd40: 6172 6564 666f 6c64 6572 7d22 0a20 2020  aredfolder}".   
+0000cd50: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+0000cd60: 3220 3d20 6622 6563 686f 207b 6261 7365  2 = f"echo {base
+0000cd70: 666f 6c64 6572 7d20 2f6d 6e74 2f7b 7368  folder} /mnt/{sh
+0000cd80: 6172 6564 666f 6c64 6572 7d20 3970 2074  aredfolder} 9p t
+0000cd90: 7261 6e73 3d76 6972 7469 6f2c 7665 7273  rans=virtio,vers
+0000cda0: 696f 6e3d 3970 3230 3030 2e4c 2c72 7720  ion=9p2000.L,rw 
+0000cdb0: 3020 3020 3e3e 202f 6574 632f 6673 7461  0 0 >> /etc/fsta
+0000cdc0: 6222 0a20 2020 2020 2020 2020 2020 2020  b".             
+0000cdd0: 2020 2073 6861 7265 6466 6f6c 6465 7263     sharedfolderc
+0000cde0: 6d64 732e 6170 7065 6e64 2863 6d64 3129  mds.append(cmd1)
+0000cdf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ce00: 2073 6861 7265 6466 6f6c 6465 7263 6d64   sharedfoldercmd
+0000ce10: 732e 6170 7065 6e64 2863 6d64 3229 0a20  s.append(cmd2). 
+0000ce20: 2020 2020 2020 2069 6620 7368 6172 6564         if shared
+0000ce30: 666f 6c64 6572 636d 6473 3a0a 2020 2020  foldercmds:.    
+0000ce40: 2020 2020 2020 2020 7368 6172 6564 666f          sharedfo
+0000ce50: 6c64 6572 636d 6473 2e61 7070 656e 6428  ldercmds.append(
+0000ce60: 226d 6f75 6e74 202d 6122 290a 2020 2020  "mount -a").    
+0000ce70: 2020 2020 6e65 7477 6f72 6b77 6169 7463      networkwaitc
+0000ce80: 6f6d 6d61 6e64 203d 205b 6627 736c 6565  ommand = [f'slee
+0000ce90: 7020 7b6e 6574 776f 726b 7761 6974 7d27  p {networkwait}'
+0000cea0: 5d20 6966 206e 6574 776f 726b 7761 6974  ] if networkwait
+0000ceb0: 203e 2030 2065 6c73 6520 5b5d 0a20 2020   > 0 else [].   
+0000cec0: 2020 2020 2072 6f6f 7463 6f6d 6d61 6e64       rootcommand
+0000ced0: 203d 205b 6627 6563 686f 2072 6f6f 743a   = [f'echo root:
+0000cee0: 7b72 6f6f 7470 6173 7377 6f72 647d 207c  {rootpassword} |
+0000cef0: 2063 6870 6173 7377 6427 5d20 6966 2072   chpasswd'] if r
+0000cf00: 6f6f 7470 6173 7377 6f72 6420 6973 206e  ootpassword is n
+0000cf10: 6f74 204e 6f6e 6520 656c 7365 205b 5d0a  ot None else [].
+0000cf20: 2020 2020 2020 2020 636d 6473 203d 2072          cmds = r
+0000cf30: 6f6f 7463 6f6d 6d61 6e64 202b 206e 6574  ootcommand + net
+0000cf40: 776f 726b 7761 6974 636f 6d6d 616e 6420  workwaitcommand 
+0000cf50: 2b20 7268 6e63 6f6d 6d61 6e64 7320 2b20  + rhncommands + 
+0000cf60: 7368 6172 6564 666f 6c64 6572 636d 6473  sharedfoldercmds
+0000cf70: 202b 2063 6d64 7320 2b20 7363 7269 7074   + cmds + script
+0000cf80: 636d 6473 0a20 2020 2020 2020 2069 6620  cmds.        if 
+0000cf90: 6e6f 7469 6679 2061 6e64 2069 6d61 6765  notify and image
+0000cfa0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000cfb0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000cfc0: 6966 7963 6d64 2069 7320 4e6f 6e65 2061  ifycmd is None a
+0000cfd0: 6e64 206e 6f74 6966 7973 6372 6970 7420  nd notifyscript 
+0000cfe0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000cff0: 2020 2020 2020 2020 2069 6620 2763 6f73           if 'cos
+0000d000: 2720 696e 2069 6d61 6765 3a0a 2020 2020  ' in image:.    
+0000d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d020: 6e6f 7469 6679 636d 6420 3d20 276a 6f75  notifycmd = 'jou
+0000d030: 726e 616c 6374 6c20 2d2d 6964 656e 7469  rnalctl --identi
+0000d040: 6669 6572 3d69 676e 6974 696f 6e20 2d2d  fier=ignition --
+0000d050: 616c 6c20 2d2d 6e6f 2d70 6167 6572 270a  all --no-pager'.
+0000d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d070: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000d080: 2020 2020 2020 2020 2020 636c 6f75 6469            cloudi
+0000d090: 6e69 7466 696c 6520 3d20 636f 6d6d 6f6e  nitfile = common
+0000d0a0: 2e67 6574 5f63 6c6f 7564 696e 6974 6669  .get_cloudinitfi
+0000d0b0: 6c65 2869 6d61 6765 290a 2020 2020 2020  le(image).      
+0000d0c0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+0000d0d0: 7469 6679 636d 6420 3d20 2274 6169 6c20  tifycmd = "tail 
+0000d0e0: 2d31 3030 2025 7322 2025 2063 6c6f 7564  -100 %s" % cloud
+0000d0f0: 696e 6974 6669 6c65 0a20 2020 2020 2020  initfile.       
+0000d100: 2020 2020 2069 6620 6e6f 7469 6679 7363       if notifysc
+0000d110: 7269 7074 2069 7320 6e6f 7420 4e6f 6e65  ript is not None
+0000d120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d130: 2020 6e6f 7469 6679 7363 7269 7074 203d    notifyscript =
+0000d140: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+0000d150: 7365 7228 6e6f 7469 6679 7363 7269 7074  ser(notifyscript
+0000d160: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d170: 2020 6966 2062 6173 6564 6972 2021 3d20    if basedir != 
+0000d180: 272e 273a 0a20 2020 2020 2020 2020 2020  '.':.           
+0000d190: 2020 2020 2020 2020 206e 6f74 6966 7973           notifys
+0000d1a0: 6372 6970 7420 3d20 6627 7b62 6173 6564  cript = f'{based
+0000d1b0: 6972 7d2f 7b6e 6f74 6966 7973 6372 6970  ir}/{notifyscrip
+0000d1c0: 747d 270a 2020 2020 2020 2020 2020 2020  t}'.            
+0000d1d0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+0000d1e0: 7468 2e65 7869 7374 7328 6e6f 7469 6679  th.exists(notify
+0000d1f0: 7363 7269 7074 293a 0a20 2020 2020 2020  script):.       
+0000d200: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+0000d210: 6966 7963 6d64 203d 204e 6f6e 650a 2020  ifycmd = None.  
 0000d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d230: 7761 726e 696e 6728 2243 7265 6174 696e  warning("Creatin
-0000d240: 6720 6175 7468 6f72 697a 6564 5f6b 6579  g authorized_key
-0000d250: 735f 6669 6c65 2229 0a20 2020 2020 2020  s_file").       
-0000d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d270: 2077 6974 6820 6f70 656e 2861 7574 686f   with open(autho
-0000d280: 7269 7a65 645f 6b65 7973 5f66 696c 652c  rized_keys_file,
-0000d290: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
+0000d230: 2020 6e6f 7469 6679 7363 7269 7074 203d    notifyscript =
+0000d240: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000d250: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+0000d260: 6728 6622 4e6f 7469 6669 6361 7469 6f6e  g(f"Notification
+0000d270: 2072 6571 7569 7265 6420 666f 7220 7b6e   required for {n
+0000d280: 616d 657d 2062 7574 206d 6973 7369 6e67  ame} but missing
+0000d290: 206e 6f74 6966 7973 6372 6970 7422 290a   notifyscript").
 0000d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2b0: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
-0000d2c0: 7075 626c 6963 6b65 7929 0a20 2020 2020  publickey).     
-0000d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2e0: 2020 2020 2020 206f 732e 6368 6d6f 6428         os.chmod(
-0000d2f0: 7363 7269 7074 2c20 306f 3630 3029 0a20  script, 0o600). 
-0000d300: 2020 2020 2020 2069 6620 636d 6473 2061         if cmds a
-0000d310: 6e64 2027 7265 626f 6f74 2720 696e 2063  nd 'reboot' in c
-0000d320: 6d64 733a 0a20 2020 2020 2020 2020 2020  mds:.           
-0000d330: 2077 6869 6c65 2027 7265 626f 6f74 2720   while 'reboot' 
-0000d340: 696e 2063 6d64 733a 0a20 2020 2020 2020  in cmds:.       
-0000d350: 2020 2020 2020 2020 2063 6d64 732e 7265           cmds.re
-0000d360: 6d6f 7665 2827 7265 626f 6f74 2729 0a20  move('reboot'). 
-0000d370: 2020 2020 2020 2020 2020 2063 6d64 732e             cmds.
-0000d380: 6170 7065 6e64 2827 7265 626f 6f74 2729  append('reboot')
-0000d390: 0a20 2020 2020 2020 2069 6620 696d 6167  .        if imag
-0000d3a0: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
-0000d3b0: 6420 2827 7268 656c 2d38 2720 696e 2069  d ('rhel-8' in i
-0000d3c0: 6d61 6765 206f 7220 2772 6863 6f73 2720  mage or 'rhcos' 
-0000d3d0: 696e 2069 6d61 6765 2920 616e 6420 6469  in image) and di
-0000d3e0: 736b 7320 616e 6420 6e6f 7420 6f6e 6c79  sks and not only
-0000d3f0: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
-0000d400: 2020 2020 6669 7273 7464 6973 6b20 3d20      firstdisk = 
-0000d410: 6469 736b 735b 305d 0a20 2020 2020 2020  disks[0].       
-0000d420: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000d430: 6365 2866 6972 7374 6469 736b 2c20 7374  ce(firstdisk, st
-0000d440: 7229 2061 6e64 2066 6972 7374 6469 736b  r) and firstdisk
-0000d450: 2e69 7364 6967 6974 2829 3a0a 2020 2020  .isdigit():.    
-0000d460: 2020 2020 2020 2020 2020 2020 6669 7273              firs
-0000d470: 7464 6973 6b20 3d20 696e 7428 6669 7273  tdisk = int(firs
-0000d480: 7464 6973 6b29 0a20 2020 2020 2020 2020  tdisk).         
-0000d490: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000d4a0: 2866 6972 7374 6469 736b 2c20 696e 7429  (firstdisk, int)
-0000d4b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d4c0: 2020 6669 7273 7464 6973 6b73 697a 6520    firstdisksize 
-0000d4d0: 3d20 6669 7273 7464 6973 6b0a 2020 2020  = firstdisk.    
-0000d4e0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0000d4f0: 6972 7374 6469 736b 7369 7a65 203c 2032  irstdisksize < 2
-0000d500: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0000d510: 2020 2020 2020 2070 7072 696e 7428 2252         pprint("R
-0000d520: 6f75 6e64 696e 6720 7570 2066 6972 7374  ounding up first
-0000d530: 2064 6973 6b20 746f 2032 3047 6222 290a   disk to 20Gb").
-0000d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d550: 2020 2020 6469 736b 735b 305d 203d 2032      disks[0] = 2
-0000d560: 300a 2020 2020 2020 2020 2020 2020 656c  0.            el
-0000d570: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
-0000d580: 7273 7464 6973 6b2c 2064 6963 7429 2061  rstdisk, dict) a
-0000d590: 6e64 2027 7369 7a65 2720 696e 2066 6972  nd 'size' in fir
-0000d5a0: 7374 6469 736b 3a0a 2020 2020 2020 2020  stdisk:.        
-0000d5b0: 2020 2020 2020 2020 6669 7273 7464 6973          firstdis
-0000d5c0: 6b73 697a 6520 3d20 6669 7273 7464 6973  ksize = firstdis
-0000d5d0: 6b5b 2773 697a 6527 5d0a 2020 2020 2020  k['size'].      
-0000d5e0: 2020 2020 2020 2020 2020 6966 2066 6972            if fir
-0000d5f0: 7374 6469 736b 7369 7a65 203c 2032 303a  stdisksize < 20:
-0000d600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d610: 2020 2020 2070 7072 696e 7428 2252 6f75       pprint("Rou
-0000d620: 6e64 696e 6720 7570 2066 6972 7374 2064  nding up first d
-0000d630: 6973 6b20 746f 2032 3047 6222 290a 2020  isk to 20Gb").  
-0000d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d650: 2020 6469 736b 735b 305d 5b27 7369 7a65    disks[0]['size
-0000d660: 275d 203d 2032 300a 2020 2020 2020 2020  '] = 20.        
-0000d670: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000d680: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-0000d690: 2249 6e63 6f72 7265 6374 2066 6972 7374  "Incorrect first
-0000d6a0: 2064 6973 6b20 7370 6563 220a 2020 2020   disk spec".    
-0000d6b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d6c0: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
-0000d6d0: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
-0000d6e0: 273a 206d 7367 7d0a 2020 2020 2020 2020  ': msg}.        
-0000d6f0: 2020 2020 6966 2027 7268 636f 7327 2069      if 'rhcos' i
-0000d700: 6e20 696d 6167 6520 616e 6420 6d65 6d6f  n image and memo
-0000d710: 7279 203c 2031 3032 343a 0a20 2020 2020  ry < 1024:.     
-0000d720: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0000d730: 7428 2241 646a 7573 7469 6e67 206d 656d  t("Adjusting mem
-0000d740: 6f72 7920 746f 2031 3032 344d 6222 290a  ory to 1024Mb").
-0000d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d760: 6d65 6d6f 7279 203d 2031 3032 340a 2020  memory = 1024.  
-0000d770: 2020 2020 2020 6d65 7461 6461 7461 203d        metadata =
-0000d780: 207b 2770 6c61 6e27 3a20 706c 616e 2c20   {'plan': plan, 
-0000d790: 2770 726f 6669 6c65 273a 2070 726f 6669  'profile': profi
-0000d7a0: 6c65 6e61 6d65 7d0a 2020 2020 2020 2020  lename}.        
-0000d7b0: 6966 2064 6f6d 6169 6e20 6973 206e 6f74  if domain is not
-0000d7c0: 204e 6f6e 6520 616e 6420 7265 7365 7276   None and reserv
-0000d7d0: 6564 6e73 3a0a 2020 2020 2020 2020 2020  edns:.          
-0000d7e0: 2020 6d65 7461 6461 7461 5b27 646f 6d61    metadata['doma
-0000d7f0: 696e 275d 203d 2064 6f6d 6169 6e0a 2020  in'] = domain.  
-0000d800: 2020 2020 2020 2020 2020 6966 2064 6e73            if dns
-0000d810: 636c 6965 6e74 2069 7320 6e6f 7420 4e6f  client is not No
-0000d820: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000d830: 2020 2020 6d65 7461 6461 7461 5b27 646e      metadata['dn
-0000d840: 7363 6c69 656e 7427 5d20 3d20 646e 7363  sclient'] = dnsc
-0000d850: 6c69 656e 740a 2020 2020 2020 2020 2020  lient.          
-0000d860: 2020 2020 2020 7265 7365 7276 6564 6e73        reservedns
-0000d870: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0000d880: 2069 6620 696d 6167 6520 6973 206e 6f74   if image is not
-0000d890: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000d8a0: 2020 206d 6574 6164 6174 615b 2769 6d61     metadata['ima
-0000d8b0: 6765 275d 203d 2069 6d61 6765 0a20 2020  ge'] = image.   
-0000d8c0: 2020 2020 2065 6c69 6620 5b6e 2066 6f72       elif [n for
-0000d8d0: 206e 2069 6e20 6e65 7473 2069 6620 6973   n in nets if is
-0000d8e0: 696e 7374 616e 6365 286e 2c20 6469 6374  instance(n, dict
-0000d8f0: 2920 616e 6420 276e 6963 2720 696e 206e  ) and 'nic' in n
-0000d900: 5d3a 0a20 2020 2020 2020 2020 2020 2077  ]:.            w
-0000d910: 6172 6e69 6e67 2822 596f 7572 206e 6574  arning("Your net
-0000d920: 7320 6465 6669 6e69 7469 6f6e 2063 6f6e  s definition con
-0000d930: 7461 696e 7320 6e69 6320 6b65 7920 7768  tains nic key wh
-0000d940: 6963 6820 776f 6e27 7420 6265 2075 7365  ich won't be use
-0000d950: 6422 290a 2020 2020 2020 2020 6966 2027  d").        if '
-0000d960: 6f77 6e65 7227 2069 6e20 7072 6f66 696c  owner' in profil
-0000d970: 6520 6f72 2027 6f77 6e65 7227 2069 6e20  e or 'owner' in 
-0000d980: 6f76 6572 7269 6465 733a 0a20 2020 2020  overrides:.     
-0000d990: 2020 2020 2020 206d 6574 6164 6174 615b         metadata[
-0000d9a0: 276f 776e 6572 275d 203d 2070 726f 6669  'owner'] = profi
-0000d9b0: 6c65 2e67 6574 2827 6f77 6e65 7227 2920  le.get('owner') 
-0000d9c0: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
-0000d9d0: 2827 6f77 6e65 7227 290a 2020 2020 2020  ('owner').      
-0000d9e0: 2020 6966 2027 766d 7573 6572 2720 696e    if 'vmuser' in
-0000d9f0: 2070 726f 6669 6c65 206f 7220 2776 6d75   profile or 'vmu
-0000da00: 7365 7227 2069 6e20 6f76 6572 7269 6465  ser' in override
-0000da10: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
-0000da20: 6574 6164 6174 615b 2775 7365 7227 5d20  etadata['user'] 
-0000da30: 3d20 7072 6f66 696c 652e 6765 7428 2776  = profile.get('v
-0000da40: 6d75 7365 7227 2920 6f72 206f 7665 7272  muser') or overr
-0000da50: 6964 6573 2e67 6574 2827 766d 7573 6572  ides.get('vmuser
-0000da60: 2729 0a20 2020 2020 2020 2065 6c69 6620  ').        elif 
-0000da70: 2775 7365 7227 2069 6e20 7072 6f66 696c  'user' in profil
-0000da80: 6520 6f72 2027 7573 6572 2720 696e 206f  e or 'user' in o
-0000da90: 7665 7272 6964 6573 3a0a 2020 2020 2020  verrides:.      
-0000daa0: 2020 2020 2020 6d65 7461 6461 7461 5b27        metadata['
-0000dab0: 7573 6572 275d 203d 2070 726f 6669 6c65  user'] = profile
-0000dac0: 2e67 6574 2827 7573 6572 2729 206f 7220  .get('user') or 
-0000dad0: 6f76 6572 7269 6465 732e 6765 7428 2775  overrides.get('u
-0000dae0: 7365 7227 290a 2020 2020 2020 2020 6966  ser').        if
-0000daf0: 206b 7562 6520 6973 206e 6f74 204e 6f6e   kube is not Non
-0000db00: 6520 616e 6420 6b75 6265 7479 7065 2069  e and kubetype i
-0000db10: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000db20: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
-0000db30: 5b27 6b75 6265 7479 7065 275d 203d 206b  ['kubetype'] = k
-0000db40: 7562 6574 7970 650a 2020 2020 2020 2020  ubetype.        
-0000db50: 2020 2020 6d65 7461 6461 7461 5b27 6b75      metadata['ku
-0000db60: 6265 275d 203d 206b 7562 650a 2020 2020  be'] = kube.    
-0000db70: 2020 2020 6966 2074 656d 706b 6579 3a0a      if tempkey:.
-0000db80: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0000db90: 7665 7272 6964 6573 2e67 6574 2827 7465  verrides.get('te
-0000dba0: 6d70 6b65 7964 6972 2729 2069 7320 4e6f  mpkeydir') is No
-0000dbb0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000dbc0: 2020 2020 7465 6d70 6b65 7964 6972 203d      tempkeydir =
-0000dbd0: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
-0000dbe0: 6f72 7928 290a 2020 2020 2020 2020 2020  ory().          
-0000dbf0: 2020 2020 2020 6f76 6572 7269 6465 735b        overrides[
-0000dc00: 2774 656d 706b 6579 6469 7227 5d20 3d20  'tempkeydir'] = 
-0000dc10: 7465 6d70 6b65 7964 6972 0a20 2020 2020  tempkeydir.     
-0000dc20: 2020 2023 2063 6f6e 6670 6f6f 6c20 6861     # confpool ha
-0000dc30: 6e64 6c69 6e67 2066 6f72 206e 6574 776f  ndling for netwo
-0000dc40: 726b 0a20 2020 2020 2020 2066 6f72 2069  rk.        for i
-0000dc50: 6e64 6578 2c20 6e65 7420 696e 2065 6e75  ndex, net in enu
-0000dc60: 6d65 7261 7465 286e 6574 7329 3a0a 2020  merate(nets):.  
-0000dc70: 2020 2020 2020 2020 2020 636f 6e66 706f            confpo
-0000dc80: 6f6c 203d 204e 6f6e 650a 2020 2020 2020  ol = None.      
-0000dc90: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000dca0: 6e63 6528 6e65 742c 2064 6963 7429 3a0a  nce(net, dict):.
+0000d2b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000d2c0: 2020 2020 2020 2020 2020 6669 6c65 732e            files.
+0000d2d0: 6170 7065 6e64 287b 2770 6174 6827 3a20  append({'path': 
+0000d2e0: 272f 726f 6f74 2f2e 6e6f 7469 6679 2e73  '/root/.notify.s
+0000d2f0: 6827 2c20 276f 7269 6769 6e27 3a20 6e6f  h', 'origin': no
+0000d300: 7469 6679 7363 7269 7074 7d29 0a20 2020  tifyscript}).   
+0000d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d320: 206e 6f74 6966 7963 6d64 203d 2022 6261   notifycmd = "ba
+0000d330: 7368 202f 726f 6f74 2f2e 6e6f 7469 6679  sh /root/.notify
+0000d340: 2e73 6822 0a20 2020 2020 2020 2020 2020  .sh".           
+0000d350: 206e 6f74 6966 7963 6d64 732c 206d 6169   notifycmds, mai
+0000d360: 6c63 6f6e 7465 6e74 203d 2073 656c 662e  lcontent = self.
+0000d370: 6861 6e64 6c65 5f6e 6f74 6966 6963 6174  handle_notificat
+0000d380: 696f 6e73 286e 616d 652c 206e 6f74 6966  ions(name, notif
+0000d390: 796d 6574 686f 6473 3d6e 6f74 6966 796d  ymethods=notifym
+0000d3a0: 6574 686f 6473 2c0a 2020 2020 2020 2020  ethods,.        
+0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3e0: 2020 2020 2020 2020 7075 7368 6275 6c6c          pushbull
+0000d3f0: 6574 746f 6b65 6e3d 7075 7368 6275 6c6c  ettoken=pushbull
+0000d400: 6574 746f 6b65 6e2c 0a20 2020 2020 2020  ettoken,.       
+0000d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d440: 2020 2020 2020 2020 206e 6f74 6966 7973           notifys
+0000d450: 6372 6970 743d 6e6f 7469 6679 7363 7269  cript=notifyscri
+0000d460: 7074 2c20 6e6f 7469 6679 636d 643d 6e6f  pt, notifycmd=no
+0000d470: 7469 6679 636d 642c 0a20 2020 2020 2020  tifycmd,.       
+0000d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4b0: 2020 2020 2020 2020 2073 6c61 636b 6368           slackch
+0000d4c0: 616e 6e65 6c3d 736c 6163 6b63 6861 6e6e  annel=slackchann
+0000d4d0: 656c 2c20 736c 6163 6b74 6f6b 656e 3d73  el, slacktoken=s
+0000d4e0: 6c61 636b 746f 6b65 6e2c 0a20 2020 2020  lacktoken,.     
+0000d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d520: 2020 2020 2020 2020 2020 206d 6169 6c73             mails
+0000d530: 6572 7665 723d 6d61 696c 7365 7276 6572  erver=mailserver
+0000d540: 2c20 6d61 696c 6672 6f6d 3d6d 6169 6c66  , mailfrom=mailf
+0000d550: 726f 6d2c 206d 6169 6c74 6f3d 6d61 696c  rom, mailto=mail
+0000d560: 746f 290a 2020 2020 2020 2020 2020 2020  to).            
+0000d570: 6966 206d 6169 6c63 6f6e 7465 6e74 2069  if mailcontent i
+0000d580: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000d590: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000d5a0: 732e 6170 7065 6e64 287b 2770 6174 6827  s.append({'path'
+0000d5b0: 3a20 272f 7661 722f 746d 702f 6d61 696c  : '/var/tmp/mail
+0000d5c0: 2e74 7874 272c 2027 636f 6e74 656e 7427  .txt', 'content'
+0000d5d0: 3a20 6d61 696c 636f 6e74 656e 747d 290a  : mailcontent}).
+0000d5e0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000d5f0: 6f74 6966 7963 6d64 733a 0a20 2020 2020  otifycmds:.     
+0000d600: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000d610: 7420 636d 6473 3a0a 2020 2020 2020 2020  t cmds:.        
+0000d620: 2020 2020 2020 2020 2020 2020 636d 6473              cmds
+0000d630: 203d 206e 6f74 6966 7963 6d64 730a 2020   = notifycmds.  
+0000d640: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000d650: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d660: 2020 2020 2020 2020 636d 6473 2e65 7874          cmds.ext
+0000d670: 656e 6428 6e6f 7469 6679 636d 6473 290a  end(notifycmds).
+0000d680: 2020 2020 2020 2020 6970 7320 3d20 5b6f          ips = [o
+0000d690: 7665 7272 6964 6573 5b6b 6579 5d20 666f  verrides[key] fo
+0000d6a0: 7220 6b65 7920 696e 206f 7665 7272 6964  r key in overrid
+0000d6b0: 6573 2069 6620 7265 2e6d 6174 6368 2827  es if re.match('
+0000d6c0: 6970 5b30 2d39 5d2b 272c 206b 6579 295d  ip[0-9]+', key)]
+0000d6d0: 0a20 2020 2020 2020 206e 6574 6d61 736b  .        netmask
+0000d6e0: 7320 3d20 5b6f 7665 7272 6964 6573 5b6b  s = [overrides[k
+0000d6f0: 6579 5d20 666f 7220 6b65 7920 696e 206f  ey] for key in o
+0000d700: 7665 7272 6964 6573 2069 6620 7265 2e6d  verrides if re.m
+0000d710: 6174 6368 2827 6e65 746d 6173 6b5b 302d  atch('netmask[0-
+0000d720: 395d 2b27 2c20 6b65 7929 5d0a 2020 2020  9]+', key)].    
+0000d730: 2020 2020 6966 2070 7269 7661 7465 6b65      if privateke
+0000d740: 7920 616e 6420 7365 6c66 2e74 7970 6520  y and self.type 
+0000d750: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
+0000d760: 2020 2020 2020 7072 6976 6174 656b 6579        privatekey
+0000d770: 6669 6c65 203d 204e 6f6e 650a 2020 2020  file = None.    
+0000d780: 2020 2020 2020 2020 7075 626c 6963 6b65          publicke
+0000d790: 7966 696c 6520 3d20 636f 6d6d 6f6e 2e67  yfile = common.g
+0000d7a0: 6574 5f73 7368 5f70 7562 5f6b 6579 2829  et_ssh_pub_key()
+0000d7b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d7c0: 7075 626c 6963 6b65 7966 696c 6520 6973  publickeyfile is
+0000d7d0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000d7e0: 2020 2020 2020 2020 2020 2070 7269 7661             priva
+0000d7f0: 7465 6b65 7966 696c 6520 3d20 7075 626c  tekeyfile = publ
+0000d800: 6963 6b65 7966 696c 652e 7265 706c 6163  ickeyfile.replac
+0000d810: 6528 272e 7075 6227 2c20 2727 290a 2020  e('.pub', '').  
+0000d820: 2020 2020 2020 2020 2020 6966 2070 7269            if pri
+0000d830: 7661 7465 6b65 7966 696c 6520 6973 206e  vatekeyfile is n
+0000d840: 6f74 204e 6f6e 6520 616e 6420 7075 626c  ot None and publ
+0000d850: 6963 6b65 7966 696c 6520 6973 206e 6f74  ickeyfile is not
+0000d860: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000d870: 2020 2020 2020 2070 7269 7661 7465 6b65         privateke
+0000d880: 7920 3d20 6f70 656e 2870 7269 7661 7465  y = open(private
+0000d890: 6b65 7966 696c 6529 2e72 6561 6428 292e  keyfile).read().
+0000d8a0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+0000d8b0: 2020 2020 2020 2020 7075 626c 6963 6b65          publicke
+0000d8c0: 7920 3d20 6f70 656e 2870 7562 6c69 636b  y = open(publick
+0000d8d0: 6579 6669 6c65 292e 7265 6164 2829 2e73  eyfile).read().s
+0000d8e0: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+0000d8f0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+0000d900: 2249 6e6a 6563 7469 6e67 2070 7269 7661  "Injecting priva
+0000d910: 7465 206b 6579 2066 6f72 207b 6e61 6d65  te key for {name
+0000d920: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000d930: 2020 2020 6669 6c65 732e 6170 7065 6e64      files.append
+0000d940: 287b 2770 6174 6827 3a20 272f 726f 6f74  ({'path': '/root
+0000d950: 2f2e 7373 682f 6964 5f72 7361 272c 2027  /.ssh/id_rsa', '
+0000d960: 636f 6e74 656e 7427 3a20 7072 6976 6174  content': privat
+0000d970: 656b 6579 7d29 0a20 2020 2020 2020 2020  ekey}).         
+0000d980: 2020 2020 2020 2066 696c 6573 2e61 7070         files.app
+0000d990: 656e 6428 7b27 7061 7468 273a 2027 2f72  end({'path': '/r
+0000d9a0: 6f6f 742f 2e73 7368 2f69 645f 7273 612e  oot/.ssh/id_rsa.
+0000d9b0: 7075 6227 2c20 2763 6f6e 7465 6e74 273a  pub', 'content':
+0000d9c0: 2070 7562 6c69 636b 6579 7d29 0a20 2020   publickey}).   
+0000d9d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000d9e0: 7365 6c66 2e68 6f73 7420 696e 205b 2731  self.host in ['1
+0000d9f0: 3237 2e30 2e30 2e31 272c 2027 6c6f 6361  27.0.0.1', 'loca
+0000da00: 6c68 6f73 7427 5d3a 0a20 2020 2020 2020  lhost']:.       
+0000da10: 2020 2020 2020 2020 2020 2020 2061 7574               aut
+0000da20: 686f 7269 7a65 645f 6b65 7973 5f66 696c  horized_keys_fil
+0000da30: 6520 3d20 6f73 2e70 6174 682e 6578 7061  e = os.path.expa
+0000da40: 6e64 7573 6572 2827 7e2f 2e73 7368 2f61  nduser('~/.ssh/a
+0000da50: 7574 686f 7269 7a65 645f 6b65 7973 2729  uthorized_keys')
+0000da60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da70: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
+0000da80: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0000da90: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+0000daa0: 682e 6578 6973 7473 2861 7574 686f 7269  h.exists(authori
+0000dab0: 7a65 645f 6b65 7973 5f66 696c 6529 3a0a  zed_keys_file):.
+0000dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dad0: 2020 2020 2020 2020 666f 7220 6c69 6e65          for line
+0000dae0: 2069 6e20 6f70 656e 2861 7574 686f 7269   in open(authori
+0000daf0: 7a65 645f 6b65 7973 5f66 696c 6529 2e72  zed_keys_file).r
+0000db00: 6561 646c 696e 6573 2829 3a0a 2020 2020  eadlines():.    
+0000db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db20: 2020 2020 2020 2020 6966 2070 7562 6c69          if publi
+0000db30: 636b 6579 2069 6e20 6c69 6e65 3a0a 2020  ckey in line:.  
+0000db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db50: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000db60: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
+0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db80: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0000db90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dba0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000dbb0: 666f 756e 643a 0a20 2020 2020 2020 2020  found:.         
+0000dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbd0: 2020 2077 6172 6e69 6e67 2866 2241 6464     warning(f"Add
+0000dbe0: 696e 6720 7075 626c 6963 206b 6579 2074  ing public key t
+0000dbf0: 6f20 6175 7468 6f72 697a 6564 5f6b 6579  o authorized_key
+0000dc00: 735f 6669 6c65 2066 6f72 207b 6e61 6d65  s_file for {name
+0000dc10: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc30: 7769 7468 206f 7065 6e28 6175 7468 6f72  with open(author
+0000dc40: 697a 6564 5f6b 6579 735f 6669 6c65 2c20  ized_keys_file, 
+0000dc50: 2761 2729 2061 7320 663a 0a20 2020 2020  'a') as f:.     
+0000dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc70: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
+0000dc80: 7465 2866 225c 6e7b 7075 626c 6963 6b65  te(f"\n{publicke
+0000dc90: 797d 2229 0a20 2020 2020 2020 2020 2020  y}").           
+0000dca0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
 0000dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dcc0: 636f 6e66 706f 6f6c 203d 206e 6574 2e67  confpool = net.g
-0000dcd0: 6574 2827 6970 706f 6f6c 2729 206f 7220  et('ippool') or 
-0000dce0: 6e65 742e 6765 7428 2763 6f6e 6670 6f6f  net.get('confpoo
-0000dcf0: 6c27 290a 2020 2020 2020 2020 2020 2020  l').            
-0000dd00: 6966 2069 6e64 6578 203d 3d20 3020 616e  if index == 0 an
-0000dd10: 6420 636f 6e66 706f 6f6c 2069 7320 4e6f  d confpool is No
-0000dd20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000dd30: 2020 2020 636f 6e66 706f 6f6c 203d 206f      confpool = o
-0000dd40: 7665 7272 6964 6573 2e67 6574 2827 6970  verrides.get('ip
-0000dd50: 706f 6f6c 2729 206f 7220 6f76 6572 7269  pool') or overri
-0000dd60: 6465 732e 6765 7428 2763 6f6e 6670 6f6f  des.get('confpoo
-0000dd70: 6c27 290a 2020 2020 2020 2020 2020 2020  l').            
-0000dd80: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000dd90: 6528 6e65 742c 2073 7472 293a 0a20 2020  e(net, str):.   
-0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddb0: 206e 6574 735b 696e 6465 785d 203d 207b   nets[index] = {
-0000ddc0: 276e 616d 6527 3a20 6e65 747d 0a20 2020  'name': net}.   
-0000ddd0: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
-0000dde0: 706f 6f6c 2069 7320 4e6f 6e65 3a0a 2020  pool is None:.  
-0000ddf0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000de00: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-0000de10: 2020 2069 6620 636f 6e66 706f 6f6c 206e     if confpool n
-0000de20: 6f74 2069 6e20 7365 6c66 2e63 6f6e 6670  ot in self.confp
-0000de30: 6f6f 6c73 3a0a 2020 2020 2020 2020 2020  ools:.          
-0000de40: 2020 2020 2020 6572 726f 7228 6622 7b63        error(f"{c
-0000de50: 6f6e 6670 6f6f 6c7d 2069 7320 6e6f 7420  onfpool} is not 
-0000de60: 6120 7661 6c69 6420 636f 6e66 706f 6f6c  a valid confpool
-0000de70: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000de80: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-0000de90: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0000dea0: 6e74 636f 6e66 706f 6f6c 203d 2073 656c  ntconfpool = sel
-0000deb0: 662e 636f 6e66 706f 6f6c 735b 636f 6e66  f.confpools[conf
-0000dec0: 706f 6f6c 5d0a 2020 2020 2020 2020 2020  pool].          
-0000ded0: 2020 6970 5f72 6573 6572 7661 7469 6f6e    ip_reservation
-0000dee0: 7320 3d20 6375 7272 656e 7463 6f6e 6670  s = currentconfp
-0000def0: 6f6f 6c2e 6765 7428 2769 705f 7265 7365  ool.get('ip_rese
-0000df00: 7276 6174 696f 6e73 272c 207b 7d29 0a20  rvations', {}). 
-0000df10: 2020 2020 2020 2020 2020 2072 6573 6572             reser
-0000df20: 7665 645f 6970 7320 3d20 6c69 7374 2869  ved_ips = list(i
-0000df30: 705f 7265 7365 7276 6174 696f 6e73 2e76  p_reservations.v
-0000df40: 616c 7565 7328 2929 0a20 2020 2020 2020  alues()).       
-0000df50: 2020 2020 2069 6620 2769 7073 2720 696e       if 'ips' in
-0000df60: 2063 7572 7265 6e74 636f 6e66 706f 6f6c   currentconfpool
-0000df70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000df80: 2020 6970 7320 3d20 6375 7272 656e 7463    ips = currentc
-0000df90: 6f6e 6670 6f6f 6c5b 2769 7073 275d 0a20  onfpool['ips']. 
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000dfb0: 6620 272f 2720 696e 2069 7073 3a0a 2020  f '/' in ips:.  
-0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfd0: 2020 6970 7320 3d20 5b73 7472 2869 2920    ips = [str(i) 
-0000dfe0: 666f 7220 6920 696e 2069 705f 6e65 7477  for i in ip_netw
-0000dff0: 6f72 6b28 6970 7329 5b31 3a2e 315d 5d0a  ork(ips)[1:.1]].
-0000e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e010: 6672 6565 5f69 7073 203d 205b 6970 2066  free_ips = [ip f
-0000e020: 6f72 2069 7020 696e 2069 7073 2069 6620  or ip in ips if 
-0000e030: 6970 206e 6f74 2069 6e20 7265 7365 7276  ip not in reserv
-0000e040: 6564 5f69 7073 5d0a 2020 2020 2020 2020  ed_ips].        
-0000e050: 2020 2020 2020 2020 6966 2066 7265 655f          if free_
-0000e060: 6970 733a 0a20 2020 2020 2020 2020 2020  ips:.           
-0000e070: 2020 2020 2020 2020 2066 7265 655f 6970           free_ip
-0000e080: 203d 2066 7265 655f 6970 735b 305d 0a20   = free_ips[0]. 
-0000e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0a0: 2020 2069 705f 7265 7365 7276 6174 696f     ip_reservatio
-0000e0b0: 6e73 5b6e 616d 655d 203d 2066 7265 655f  ns[name] = free_
-0000e0c0: 6970 0a20 2020 2020 2020 2020 2020 2020  ip.             
-0000e0d0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-0000e0e0: 5573 696e 6720 6970 207b 6672 6565 5f69  Using ip {free_i
-0000e0f0: 707d 2066 726f 6d20 636f 6e66 706f 6f6c  p} from confpool
-0000e100: 207b 636f 6e66 706f 6f6c 7d20 696e 206e   {confpool} in n
-0000e110: 6574 207b 696e 6465 787d 2229 0a20 2020  et {index}").   
-0000e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e130: 206e 6577 5f63 6f6e 6620 3d20 6375 7272   new_conf = curr
-0000e140: 656e 7463 6f6e 6670 6f6f 6c2e 636f 7079  entconfpool.copy
-0000e150: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0000e160: 2020 2020 2020 206e 6577 5f63 6f6e 665b         new_conf[
-0000e170: 2769 7027 5d20 3d20 6672 6565 5f69 700a  'ip'] = free_ip.
-0000e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e190: 2020 2020 6e65 7473 5b69 6e64 6578 5d2e      nets[index].
-0000e1a0: 7570 6461 7465 2863 7572 7265 6e74 636f  update(currentco
-0000e1b0: 6e66 706f 6f6c 290a 2020 2020 2020 2020  nfpool).        
-0000e1c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000e1d0: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
-0000e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1f0: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-0000e200: 7465 5f63 6f6e 6670 6f6f 6c28 636f 6e66  te_confpool(conf
-0000e210: 706f 6f6c 2c20 7b27 6970 5f72 6573 6572  pool, {'ip_reser
-0000e220: 7661 7469 6f6e 7327 3a20 6970 5f72 6573  vations': ip_res
-0000e230: 6572 7661 7469 6f6e 737d 290a 2020 2020  ervations}).    
-0000e240: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000e250: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e260: 2020 2020 2020 6572 726f 7228 6622 4e6f        error(f"No
-0000e270: 2061 7661 696c 6162 6c65 2069 7020 696e   available ip in
-0000e280: 2063 6f6e 6670 6f6f 6c20 7b63 6f6e 6670   confpool {confp
-0000e290: 6f6f 6c7d 2229 0a20 2020 2020 2020 2020  ool}").         
-0000e2a0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-0000e2b0: 7869 7428 3129 0a20 2020 2020 2020 2069  xit(1).        i
-0000e2c0: 6620 6f6e 6c79 6173 7365 7473 3a0a 2020  f onlyassets:.  
-0000e2d0: 2020 2020 2020 2020 2020 696d 6167 6520            image 
-0000e2e0: 3d20 696d 6167 6520 6f72 2070 726f 6669  = image or profi
-0000e2f0: 6c65 6e61 6d65 0a20 2020 2020 2020 2020  lename.         
-0000e300: 2020 2072 6573 756c 7420 3d20 7b27 7265     result = {'re
-0000e310: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
-0000e320: 7d0a 2020 2020 2020 2020 2020 2020 6966  }.            if
-0000e330: 2063 6f6d 6d6f 6e2e 6e65 6564 735f 6967   common.needs_ig
-0000e340: 6e69 7469 6f6e 2869 6d61 6765 293a 0a20  nition(image):. 
-0000e350: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0000e360: 6572 7369 6f6e 203d 2063 6f6d 6d6f 6e2e  ersion = common.
-0000e370: 6967 6e69 7469 6f6e 5f76 6572 7369 6f6e  ignition_version
-0000e380: 2869 6d61 6765 290a 2020 2020 2020 2020  (image).        
-0000e390: 2020 2020 2020 2020 636f 6d70 6163 7420          compact 
-0000e3a0: 3d20 5472 7565 2069 6620 6f76 6572 7269  = True if overri
-0000e3b0: 6465 732e 6765 7428 2763 6f6d 7061 6374  des.get('compact
-0000e3c0: 2729 2065 6c73 6520 4661 6c73 650a 2020  ') else False.  
-0000e3d0: 2020 2020 2020 2020 2020 2020 2020 7573                us
-0000e3e0: 6572 6461 7461 203d 2063 6f6d 6d6f 6e2e  erdata = common.
-0000e3f0: 6967 6e69 7469 6f6e 286e 616d 653d 6e61  ignition(name=na
-0000e400: 6d65 2c20 6b65 7973 3d6b 6579 732c 2063  me, keys=keys, c
-0000e410: 6d64 733d 636d 6473 2c20 6e65 7473 3d6e  mds=cmds, nets=n
-0000e420: 6574 732c 2067 6174 6577 6179 3d67 6174  ets, gateway=gat
-0000e430: 6577 6179 2c20 646e 733d 646e 732c 0a20  eway, dns=dns,. 
-0000e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e460: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
-0000e470: 3d64 6f6d 6169 6e2c 2066 696c 6573 3d66  =domain, files=f
-0000e480: 696c 6573 2c20 656e 6162 6c65 726f 6f74  iles, enableroot
-0000e490: 3d65 6e61 626c 6572 6f6f 742c 206f 7665  =enableroot, ove
-0000e4a0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-0000e4b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4d0: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-0000e4e0: 7369 6f6e 3d76 6572 7369 6f6e 2c20 706c  sion=version, pl
-0000e4f0: 616e 3d70 6c61 6e2c 2069 6d61 6765 3d69  an=plan, image=i
-0000e500: 6d61 6765 2c20 636f 6d70 6163 743d 636f  mage, compact=co
-0000e510: 6d70 6163 742c 0a20 2020 2020 2020 2020  mpact,.         
-0000e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e540: 2020 766d 7573 6572 3d76 6d75 7365 7229    vmuser=vmuser)
-0000e550: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000e560: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000e570: 2020 2075 7365 7264 6174 612c 206d 6574     userdata, met
-0000e580: 6164 6174 612c 206e 6574 6461 7461 203d  adata, netdata =
-0000e590: 2063 6f6d 6d6f 6e2e 636c 6f75 6469 6e69   common.cloudini
-0000e5a0: 7428 6e61 6d65 2c20 6b65 7973 3d6b 6579  t(name, keys=key
-0000e5b0: 732c 2063 6d64 733d 636d 6473 2c20 6e65  s, cmds=cmds, ne
-0000e5c0: 7473 3d6e 6574 732c 2067 6174 6577 6179  ts=nets, gateway
-0000e5d0: 3d67 6174 6577 6179 2c0a 2020 2020 2020  =gateway,.      
-0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e610: 2020 2020 2020 2020 2064 6e73 3d64 6e73           dns=dns
-0000e620: 2c20 646f 6d61 696e 3d64 6f6d 6169 6e2c  , domain=domain,
-0000e630: 2066 696c 6573 3d66 696c 6573 2c0a 2020   files=files,.  
-0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e670: 2020 2020 2020 2020 2020 2020 2065 6e61               ena
-0000e680: 626c 6572 6f6f 743d 656e 6162 6c65 726f  bleroot=enablero
-0000e690: 6f74 2c20 6f76 6572 7269 6465 733d 6f76  ot, overrides=ov
-0000e6a0: 6572 7269 6465 732c 0a20 2020 2020 2020  errides,.       
-0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6e0: 2020 2020 2020 2020 696d 6167 653d 696d          image=im
-0000e6f0: 6167 652c 2073 746f 7265 6d65 7461 6461  age, storemetada
-0000e700: 7461 3d73 746f 7265 6d65 7461 6461 7461  ta=storemetadata
-0000e710: 2c20 766d 7573 6572 3d76 6d75 7365 7229  , vmuser=vmuser)
-0000e720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e730: 2069 6620 6e65 7464 6174 6120 6973 206e   if netdata is n
-0000e740: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000e750: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000e760: 756c 745b 276e 6574 6461 7461 275d 203d  ult['netdata'] =
-0000e770: 206e 6574 6461 7461 0a20 2020 2020 2020   netdata.       
-0000e780: 2020 2020 2072 6573 756c 745b 2775 7365       result['use
-0000e790: 7264 6174 6127 5d20 3d20 7573 6572 6461  rdata'] = userda
-0000e7a0: 7461 0a20 2020 2020 2020 2020 2020 2072  ta.            r
-0000e7b0: 6574 7572 6e20 7265 7375 6c74 0a20 2020  eturn result.   
-0000e7c0: 2020 2020 2072 6573 756c 7420 3d20 6b2e       result = k.
-0000e7d0: 6372 6561 7465 286e 616d 653d 6e61 6d65  create(name=name
-0000e7e0: 2c20 7669 7274 7479 7065 3d76 6972 7474  , virttype=virtt
-0000e7f0: 7970 652c 2070 6c61 6e3d 706c 616e 2c20  ype, plan=plan, 
-0000e800: 7072 6f66 696c 653d 7072 6f66 696c 656e  profile=profilen
-0000e810: 616d 652c 2066 6c61 766f 723d 666c 6176  ame, flavor=flav
-0000e820: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-0000e830: 2020 2020 2020 2020 2020 2020 2020 6370                cp
-0000e840: 756d 6f64 656c 3d63 7075 6d6f 6465 6c2c  umodel=cpumodel,
-0000e850: 2063 7075 666c 6167 733d 6370 7566 6c61   cpuflags=cpufla
-0000e860: 6773 2c20 6370 7570 696e 6e69 6e67 3d63  gs, cpupinning=c
-0000e870: 7075 7069 6e6e 696e 672c 206e 756d 616d  pupinning, numam
-0000e880: 6f64 653d 6e75 6d61 6d6f 6465 2c20 6e75  ode=numamode, nu
-0000e890: 6d61 3d6e 756d 612c 0a20 2020 2020 2020  ma=numa,.       
-0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8b0: 2020 206e 756d 6370 7573 3d69 6e74 286e     numcpus=int(n
-0000e8c0: 756d 6370 7573 292c 206d 656d 6f72 793d  umcpus), memory=
-0000e8d0: 696e 7428 6d65 6d6f 7279 292c 2067 7565  int(memory), gue
-0000e8e0: 7374 6964 3d67 7565 7374 6964 2c20 706f  stid=guestid, po
-0000e8f0: 6f6c 3d70 6f6f 6c2c 0a20 2020 2020 2020  ol=pool,.       
-0000e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e910: 2020 2069 6d61 6765 3d69 6d61 6765 2c20     image=image, 
-0000e920: 6469 736b 733d 6469 736b 732c 2064 6973  disks=disks, dis
-0000e930: 6b73 697a 653d 6469 736b 7369 7a65 2c20  ksize=disksize, 
-0000e940: 6469 736b 7468 696e 3d64 6973 6b74 6869  diskthin=diskthi
-0000e950: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0000e960: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-0000e970: 6b69 6e74 6572 6661 6365 3d64 6973 6b69  kinterface=diski
-0000e980: 6e74 6572 6661 6365 2c20 6e65 7473 3d6e  nterface, nets=n
-0000e990: 6574 732c 2069 736f 3d69 736f 2c20 766e  ets, iso=iso, vn
-0000e9a0: 633d 626f 6f6c 2876 6e63 292c 2063 6c6f  c=bool(vnc), clo
-0000e9b0: 7564 696e 6974 3d62 6f6f 6c28 636c 6f75  udinit=bool(clou
-0000e9c0: 6469 6e69 7429 2c0a 2020 2020 2020 2020  dinit),.        
-0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9e0: 2020 7265 7365 7276 6569 703d 626f 6f6c    reserveip=bool
-0000e9f0: 2872 6573 6572 7665 6970 292c 2072 6573  (reserveip), res
-0000ea00: 6572 7665 646e 733d 626f 6f6c 2872 6573  ervedns=bool(res
-0000ea10: 6572 7665 646e 7329 2c20 7265 7365 7276  ervedns), reserv
-0000ea20: 6568 6f73 743d 626f 6f6c 2872 6573 6572  ehost=bool(reser
-0000ea30: 7665 686f 7374 292c 0a20 2020 2020 2020  vehost),.       
-0000ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea50: 2020 2073 7461 7274 3d62 6f6f 6c28 7374     start=bool(st
-0000ea60: 6172 7429 2c20 6b65 7973 3d6b 6579 732c  art), keys=keys,
-0000ea70: 2063 6d64 733d 636d 6473 2c20 6970 733d   cmds=cmds, ips=
-0000ea80: 6970 732c 206e 6574 6d61 736b 733d 6e65  ips, netmasks=ne
-0000ea90: 746d 6173 6b73 2c20 6761 7465 7761 793d  tmasks, gateway=
-0000eaa0: 6761 7465 7761 792c 2064 6e73 3d64 6e73  gateway, dns=dns
-0000eab0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000eac0: 2020 2020 2020 2020 2020 2020 646f 6d61              doma
-0000ead0: 696e 3d64 6f6d 6169 6e2c 206e 6573 7465  in=domain, neste
-0000eae0: 643d 626f 6f6c 286e 6573 7465 6429 2c20  d=bool(nested), 
-0000eaf0: 7475 6e6e 656c 3d74 756e 6e65 6c2c 2066  tunnel=tunnel, f
-0000eb00: 696c 6573 3d66 696c 6573 2c20 656e 6162  iles=files, enab
-0000eb10: 6c65 726f 6f74 3d65 6e61 626c 6572 6f6f  leroot=enableroo
-0000eb20: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0000eb30: 2020 2020 2020 2020 2020 2020 206f 7665               ove
-0000eb40: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-0000eb50: 2c20 7461 6773 3d74 6167 732c 2073 746f  , tags=tags, sto
-0000eb60: 7265 6d65 7461 6461 7461 3d73 746f 7265  remetadata=store
-0000eb70: 6d65 7461 6461 7461 2c0a 2020 2020 2020  metadata,.      
-0000eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb90: 2020 2020 7368 6172 6564 666f 6c64 6572      sharedfolder
-0000eba0: 733d 7368 6172 6564 666f 6c64 6572 732c  s=sharedfolders,
-0000ebb0: 206b 6572 6e65 6c3d 6b65 726e 656c 2c20   kernel=kernel, 
-0000ebc0: 696e 6974 7264 3d69 6e69 7472 642c 2063  initrd=initrd, c
-0000ebd0: 6d64 6c69 6e65 3d63 6d64 6c69 6e65 2c0a  mdline=cmdline,.
-0000ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebf0: 2020 2020 2020 2020 2020 706c 6163 656d            placem
-0000ec00: 656e 743d 706c 6163 656d 656e 742c 2061  ent=placement, a
-0000ec10: 7574 6f73 7461 7274 3d61 7574 6f73 7461  utostart=autosta
-0000ec20: 7274 2c20 6370 7568 6f74 706c 7567 3d63  rt, cpuhotplug=c
-0000ec30: 7075 686f 7470 6c75 672c 206d 656d 6f72  puhotplug, memor
-0000ec40: 7968 6f74 706c 7567 3d6d 656d 6f72 7968  yhotplug=memoryh
-0000ec50: 6f74 706c 7567 2c0a 2020 2020 2020 2020  otplug,.        
-0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec70: 2020 7063 6964 6576 6963 6573 3d70 6369    pcidevices=pci
-0000ec80: 6465 7669 6365 732c 2074 706d 3d74 706d  devices, tpm=tpm
-0000ec90: 2c20 726e 673d 726e 672c 206d 6574 6164  , rng=rng, metad
-0000eca0: 6174 613d 6d65 7461 6461 7461 2c20 7365  ata=metadata, se
-0000ecb0: 6375 7269 7479 6772 6f75 7073 3d73 6563  curitygroups=sec
-0000ecc0: 7572 6974 7967 726f 7570 732c 0a20 2020  uritygroups,.   
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ece0: 2020 2020 2020 2076 6d75 7365 723d 766d         vmuser=vm
-0000ecf0: 7573 6572 290a 2020 2020 2020 2020 6966  user).        if
-0000ed00: 2072 6573 756c 745b 2772 6573 756c 7427   result['result'
-0000ed10: 5d20 213d 2027 7375 6363 6573 7327 3a0a  ] != 'success':.
-0000ed20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000ed30: 726e 2072 6573 756c 740a 2020 2020 2020  rn result.      
-0000ed40: 2020 6966 2072 6573 6572 7665 646e 7320    if reservedns 
-0000ed50: 616e 6420 646e 7363 6c69 656e 7420 6973  and dnsclient is
-0000ed60: 206e 6f74 204e 6f6e 6520 616e 6420 646f   not None and do
-0000ed70: 6d61 696e 2069 7320 6e6f 7420 4e6f 6e65  main is not None
-0000ed80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000ed90: 2064 6e73 636c 6965 6e74 2069 6e20 7365   dnsclient in se
-0000eda0: 6c66 2e63 6c69 656e 7473 3a0a 2020 2020  lf.clients:.    
-0000edb0: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
-0000edc0: 4b63 6f6e 6669 6728 636c 6965 6e74 3d64  Kconfig(client=d
-0000edd0: 6e73 636c 6965 6e74 292e 6b0a 2020 2020  nsclient).k.    
-0000ede0: 2020 2020 2020 2020 2020 2020 6970 203d              ip =
-0000edf0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0000ee00: 2020 2020 2020 6966 2069 7020 6973 204e        if ip is N
-0000ee10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000ee20: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
-0000ee30: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0000ee40: 2020 2020 2020 2020 2077 6869 6c65 2063           while c
-0000ee50: 6f75 6e74 6572 2021 3d20 3330 303a 0a20  ounter != 300:. 
-0000ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee70: 2020 2020 2020 2069 7020 3d20 6b2e 6970         ip = k.ip
-0000ee80: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
-0000ee90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000eea0: 6620 6970 2069 7320 4e6f 6e65 3a0a 2020  f ip is None:.  
-0000eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eec0: 2020 2020 2020 2020 2020 736c 6565 7028            sleep(
-0000eed0: 3529 0a20 2020 2020 2020 2020 2020 2020  5).             
-0000eee0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000eef0: 7269 6e74 2822 5761 6974 696e 6720 3520  rint("Waiting 5 
-0000ef00: 7365 636f 6e64 7320 746f 2067 7261 6220  seconds to grab 
-0000ef10: 6970 2061 6e64 2063 7265 6174 6520 444e  ip and create DN
-0000ef20: 5320 7265 636f 7264 2e2e 2e22 290a 2020  S record...").  
-0000ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef40: 2020 2020 2020 2020 2020 636f 756e 7465            counte
-0000ef50: 7220 2b3d 2031 300a 2020 2020 2020 2020  r += 10.        
+0000dcc0: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
+0000dcd0: 4372 6561 7469 6e67 2061 7574 686f 7269  Creating authori
+0000dce0: 7a65 645f 6b65 7973 5f66 696c 6522 290a  zed_keys_file").
+0000dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd00: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+0000dd10: 6e28 6175 7468 6f72 697a 6564 5f6b 6579  n(authorized_key
+0000dd20: 735f 6669 6c65 2c20 2777 2729 2061 7320  s_file, 'w') as 
+0000dd30: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+0000dd40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000dd50: 2e77 7269 7465 2870 7562 6c69 636b 6579  .write(publickey
+0000dd60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000dd70: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+0000dd80: 2e63 686d 6f64 2873 6372 6970 742c 2030  .chmod(script, 0
+0000dd90: 6f36 3030 290a 2020 2020 2020 2020 6966  o600).        if
+0000dda0: 2063 6d64 7320 616e 6420 2772 6562 6f6f   cmds and 'reboo
+0000ddb0: 7427 2069 6e20 636d 6473 3a0a 2020 2020  t' in cmds:.    
+0000ddc0: 2020 2020 2020 2020 7768 696c 6520 2772          while 'r
+0000ddd0: 6562 6f6f 7427 2069 6e20 636d 6473 3a0a  eboot' in cmds:.
+0000dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddf0: 636d 6473 2e72 656d 6f76 6528 2772 6562  cmds.remove('reb
+0000de00: 6f6f 7427 290a 2020 2020 2020 2020 2020  oot').          
+0000de10: 2020 636d 6473 2e61 7070 656e 6428 2772    cmds.append('r
+0000de20: 6562 6f6f 7427 290a 2020 2020 2020 2020  eboot').        
+0000de30: 6966 2069 6d61 6765 2069 7320 6e6f 7420  if image is not 
+0000de40: 4e6f 6e65 2061 6e64 2028 2772 6865 6c2d  None and ('rhel-
+0000de50: 3827 2069 6e20 696d 6167 6520 6f72 2027  8' in image or '
+0000de60: 7268 636f 7327 2069 6e20 696d 6167 6529  rhcos' in image)
+0000de70: 2061 6e64 2064 6973 6b73 2061 6e64 206e   and disks and n
+0000de80: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
+0000de90: 2020 2020 2020 2020 2020 2066 6972 7374             first
+0000dea0: 6469 736b 203d 2064 6973 6b73 5b30 5d0a  disk = disks[0].
+0000deb0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000dec0: 7369 6e73 7461 6e63 6528 6669 7273 7464  sinstance(firstd
+0000ded0: 6973 6b2c 2073 7472 2920 616e 6420 6669  isk, str) and fi
+0000dee0: 7273 7464 6973 6b2e 6973 6469 6769 7428  rstdisk.isdigit(
+0000def0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000df00: 2020 2066 6972 7374 6469 736b 203d 2069     firstdisk = i
+0000df10: 6e74 2866 6972 7374 6469 736b 290a 2020  nt(firstdisk).  
+0000df20: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0000df30: 6e73 7461 6e63 6528 6669 7273 7464 6973  nstance(firstdis
+0000df40: 6b2c 2069 6e74 293a 0a20 2020 2020 2020  k, int):.       
+0000df50: 2020 2020 2020 2020 2066 6972 7374 6469           firstdi
+0000df60: 736b 7369 7a65 203d 2066 6972 7374 6469  sksize = firstdi
+0000df70: 736b 0a20 2020 2020 2020 2020 2020 2020  sk.             
+0000df80: 2020 2069 6620 6669 7273 7464 6973 6b73     if firstdisks
+0000df90: 697a 6520 3c20 3230 3a0a 2020 2020 2020  ize < 20:.      
+0000dfa0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0000dfb0: 7269 6e74 2822 526f 756e 6469 6e67 2075  rint("Rounding u
+0000dfc0: 7020 6669 7273 7420 6469 736b 2074 6f20  p first disk to 
+0000dfd0: 3230 4762 2229 0a20 2020 2020 2020 2020  20Gb").         
+0000dfe0: 2020 2020 2020 2020 2020 2064 6973 6b73             disks
+0000dff0: 5b30 5d20 3d20 3230 0a20 2020 2020 2020  [0] = 20.       
+0000e000: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0000e010: 616e 6365 2866 6972 7374 6469 736b 2c20  ance(firstdisk, 
+0000e020: 6469 6374 2920 616e 6420 2773 697a 6527  dict) and 'size'
+0000e030: 2069 6e20 6669 7273 7464 6973 6b3a 0a20   in firstdisk:. 
+0000e040: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000e050: 6972 7374 6469 736b 7369 7a65 203d 2066  irstdisksize = f
+0000e060: 6972 7374 6469 736b 5b27 7369 7a65 275d  irstdisk['size']
+0000e070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e080: 2069 6620 6669 7273 7464 6973 6b73 697a   if firstdisksiz
+0000e090: 6520 3c20 3230 3a0a 2020 2020 2020 2020  e < 20:.        
+0000e0a0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0000e0b0: 6e74 2822 526f 756e 6469 6e67 2075 7020  nt("Rounding up 
+0000e0c0: 6669 7273 7420 6469 736b 2074 6f20 3230  first disk to 20
+0000e0d0: 4762 2229 0a20 2020 2020 2020 2020 2020  Gb").           
+0000e0e0: 2020 2020 2020 2020 2064 6973 6b73 5b30           disks[0
+0000e0f0: 5d5b 2773 697a 6527 5d20 3d20 3230 0a20  ]['size'] = 20. 
+0000e100: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000e110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e120: 206d 7367 203d 2022 496e 636f 7272 6563   msg = "Incorrec
+0000e130: 7420 6669 7273 7420 6469 736b 2073 7065  t first disk spe
+0000e140: 6322 0a20 2020 2020 2020 2020 2020 2020  c".             
+0000e150: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+0000e160: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
+0000e170: 2772 6561 736f 6e27 3a20 6d73 677d 0a20  'reason': msg}. 
+0000e180: 2020 2020 2020 2020 2020 2069 6620 2772             if 'r
+0000e190: 6863 6f73 2720 696e 2069 6d61 6765 2061  hcos' in image a
+0000e1a0: 6e64 206d 656d 6f72 7920 3c20 3130 3234  nd memory < 1024
+0000e1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e1c0: 2020 7070 7269 6e74 2822 4164 6a75 7374    pprint("Adjust
+0000e1d0: 696e 6720 6d65 6d6f 7279 2074 6f20 3130  ing memory to 10
+0000e1e0: 3234 4d62 2229 0a20 2020 2020 2020 2020  24Mb").         
+0000e1f0: 2020 2020 2020 206d 656d 6f72 7920 3d20         memory = 
+0000e200: 3130 3234 0a20 2020 2020 2020 206d 6574  1024.        met
+0000e210: 6164 6174 6120 3d20 7b27 706c 616e 273a  adata = {'plan':
+0000e220: 2070 6c61 6e2c 2027 7072 6f66 696c 6527   plan, 'profile'
+0000e230: 3a20 7072 6f66 696c 656e 616d 657d 0a20  : profilename}. 
+0000e240: 2020 2020 2020 2069 6620 646f 6d61 696e         if domain
+0000e250: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0000e260: 2072 6573 6572 7665 646e 733a 0a20 2020   reservedns:.   
+0000e270: 2020 2020 2020 2020 206d 6574 6164 6174           metadat
+0000e280: 615b 2764 6f6d 6169 6e27 5d20 3d20 646f  a['domain'] = do
+0000e290: 6d61 696e 0a20 2020 2020 2020 2020 2020  main.           
+0000e2a0: 2069 6620 646e 7363 6c69 656e 7420 6973   if dnsclient is
+0000e2b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000e2c0: 2020 2020 2020 2020 2020 206d 6574 6164             metad
+0000e2d0: 6174 615b 2764 6e73 636c 6965 6e74 275d  ata['dnsclient']
+0000e2e0: 203d 2064 6e73 636c 6965 6e74 0a20 2020   = dnsclient.   
+0000e2f0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0000e300: 6572 7665 646e 7320 3d20 4661 6c73 650a  ervedns = False.
+0000e310: 2020 2020 2020 2020 6966 2069 6d61 6765          if image
+0000e320: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000e330: 2020 2020 2020 2020 2020 6d65 7461 6461            metada
+0000e340: 7461 5b27 696d 6167 6527 5d20 3d20 696d  ta['image'] = im
+0000e350: 6167 650a 2020 2020 2020 2020 656c 6966  age.        elif
+0000e360: 205b 6e20 666f 7220 6e20 696e 206e 6574   [n for n in net
+0000e370: 7320 6966 2069 7369 6e73 7461 6e63 6528  s if isinstance(
+0000e380: 6e2c 2064 6963 7429 2061 6e64 2027 6e69  n, dict) and 'ni
+0000e390: 6327 2069 6e20 6e5d 3a0a 2020 2020 2020  c' in n]:.      
+0000e3a0: 2020 2020 2020 7761 726e 696e 6728 2259        warning("Y
+0000e3b0: 6f75 7220 6e65 7473 2064 6566 696e 6974  our nets definit
+0000e3c0: 696f 6e20 636f 6e74 6169 6e73 206e 6963  ion contains nic
+0000e3d0: 206b 6579 2077 6869 6368 2077 6f6e 2774   key which won't
+0000e3e0: 2062 6520 7573 6564 2229 0a20 2020 2020   be used").     
+0000e3f0: 2020 2069 6620 276f 776e 6572 2720 696e     if 'owner' in
+0000e400: 2070 726f 6669 6c65 206f 7220 276f 776e   profile or 'own
+0000e410: 6572 2720 696e 206f 7665 7272 6964 6573  er' in overrides
+0000e420: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
+0000e430: 7461 6461 7461 5b27 6f77 6e65 7227 5d20  tadata['owner'] 
+0000e440: 3d20 7072 6f66 696c 652e 6765 7428 276f  = profile.get('o
+0000e450: 776e 6572 2729 206f 7220 6f76 6572 7269  wner') or overri
+0000e460: 6465 732e 6765 7428 276f 776e 6572 2729  des.get('owner')
+0000e470: 0a20 2020 2020 2020 2069 6620 2776 6d75  .        if 'vmu
+0000e480: 7365 7227 2069 6e20 7072 6f66 696c 6520  ser' in profile 
+0000e490: 6f72 2027 766d 7573 6572 2720 696e 206f  or 'vmuser' in o
+0000e4a0: 7665 7272 6964 6573 3a0a 2020 2020 2020  verrides:.      
+0000e4b0: 2020 2020 2020 6d65 7461 6461 7461 5b27        metadata['
+0000e4c0: 7573 6572 275d 203d 2070 726f 6669 6c65  user'] = profile
+0000e4d0: 2e67 6574 2827 766d 7573 6572 2729 206f  .get('vmuser') o
+0000e4e0: 7220 6f76 6572 7269 6465 732e 6765 7428  r overrides.get(
+0000e4f0: 2776 6d75 7365 7227 290a 2020 2020 2020  'vmuser').      
+0000e500: 2020 656c 6966 2027 7573 6572 2720 696e    elif 'user' in
+0000e510: 2070 726f 6669 6c65 206f 7220 2775 7365   profile or 'use
+0000e520: 7227 2069 6e20 6f76 6572 7269 6465 733a  r' in overrides:
+0000e530: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+0000e540: 6164 6174 615b 2775 7365 7227 5d20 3d20  adata['user'] = 
+0000e550: 7072 6f66 696c 652e 6765 7428 2775 7365  profile.get('use
+0000e560: 7227 2920 6f72 206f 7665 7272 6964 6573  r') or overrides
+0000e570: 2e67 6574 2827 7573 6572 2729 0a20 2020  .get('user').   
+0000e580: 2020 2020 2069 6620 6b75 6265 2069 7320       if kube is 
+0000e590: 6e6f 7420 4e6f 6e65 2061 6e64 206b 7562  not None and kub
+0000e5a0: 6574 7970 6520 6973 206e 6f74 204e 6f6e  etype is not Non
+0000e5b0: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+0000e5c0: 6574 6164 6174 615b 276b 7562 6574 7970  etadata['kubetyp
+0000e5d0: 6527 5d20 3d20 6b75 6265 7479 7065 0a20  e'] = kubetype. 
+0000e5e0: 2020 2020 2020 2020 2020 206d 6574 6164             metad
+0000e5f0: 6174 615b 276b 7562 6527 5d20 3d20 6b75  ata['kube'] = ku
+0000e600: 6265 0a20 2020 2020 2020 2069 6620 7465  be.        if te
+0000e610: 6d70 6b65 793a 0a20 2020 2020 2020 2020  mpkey:.         
+0000e620: 2020 2069 6620 6f76 6572 7269 6465 732e     if overrides.
+0000e630: 6765 7428 2774 656d 706b 6579 6469 7227  get('tempkeydir'
+0000e640: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
+0000e650: 2020 2020 2020 2020 2020 2074 656d 706b             tempk
+0000e660: 6579 6469 7220 3d20 5465 6d70 6f72 6172  eydir = Temporar
+0000e670: 7944 6972 6563 746f 7279 2829 0a20 2020  yDirectory().   
+0000e680: 2020 2020 2020 2020 2020 2020 206f 7665               ove
+0000e690: 7272 6964 6573 5b27 7465 6d70 6b65 7964  rrides['tempkeyd
+0000e6a0: 6972 275d 203d 2074 656d 706b 6579 6469  ir'] = tempkeydi
+0000e6b0: 720a 2020 2020 2020 2020 2320 636f 6e66  r.        # conf
+0000e6c0: 706f 6f6c 2068 616e 646c 696e 6720 666f  pool handling fo
+0000e6d0: 7220 6e65 7477 6f72 6b0a 2020 2020 2020  r network.      
+0000e6e0: 2020 666f 7220 696e 6465 782c 206e 6574    for index, net
+0000e6f0: 2069 6e20 656e 756d 6572 6174 6528 6e65   in enumerate(ne
+0000e700: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
+0000e710: 2063 6f6e 6670 6f6f 6c20 3d20 4e6f 6e65   confpool = None
+0000e720: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000e730: 6973 696e 7374 616e 6365 286e 6574 2c20  isinstance(net, 
+0000e740: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+0000e750: 2020 2020 2020 2063 6f6e 6670 6f6f 6c20         confpool 
+0000e760: 3d20 6e65 742e 6765 7428 2769 7070 6f6f  = net.get('ippoo
+0000e770: 6c27 2920 6f72 206e 6574 2e67 6574 2827  l') or net.get('
+0000e780: 636f 6e66 706f 6f6c 2729 0a20 2020 2020  confpool').     
+0000e790: 2020 2020 2020 2069 6620 696e 6465 7820         if index 
+0000e7a0: 3d3d 2030 2061 6e64 2063 6f6e 6670 6f6f  == 0 and confpoo
+0000e7b0: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
+0000e7c0: 2020 2020 2020 2020 2020 2063 6f6e 6670             confp
+0000e7d0: 6f6f 6c20 3d20 6f76 6572 7269 6465 732e  ool = overrides.
+0000e7e0: 6765 7428 2769 7070 6f6f 6c27 2920 6f72  get('ippool') or
+0000e7f0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+0000e800: 636f 6e66 706f 6f6c 2729 0a20 2020 2020  confpool').     
+0000e810: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0000e820: 696e 7374 616e 6365 286e 6574 2c20 7374  instance(net, st
+0000e830: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0000e840: 2020 2020 2020 2020 6e65 7473 5b69 6e64          nets[ind
+0000e850: 6578 5d20 3d20 7b27 6e61 6d65 273a 206e  ex] = {'name': n
+0000e860: 6574 7d0a 2020 2020 2020 2020 2020 2020  et}.            
+0000e870: 6966 2063 6f6e 6670 6f6f 6c20 6973 204e  if confpool is N
+0000e880: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000e890: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+0000e8a0: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
+0000e8b0: 6670 6f6f 6c20 6e6f 7420 696e 2073 656c  fpool not in sel
+0000e8c0: 662e 636f 6e66 706f 6f6c 733a 0a20 2020  f.confpools:.   
+0000e8d0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+0000e8e0: 6f72 2866 227b 636f 6e66 706f 6f6c 7d20  or(f"{confpool} 
+0000e8f0: 6973 206e 6f74 2061 2076 616c 6964 2063  is not a valid c
+0000e900: 6f6e 6670 6f6f 6c22 290a 2020 2020 2020  onfpool").      
+0000e910: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+0000e920: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+0000e930: 2020 6375 7272 656e 7463 6f6e 6670 6f6f    currentconfpoo
+0000e940: 6c20 3d20 7365 6c66 2e63 6f6e 6670 6f6f  l = self.confpoo
+0000e950: 6c73 5b63 6f6e 6670 6f6f 6c5d 0a20 2020  ls[confpool].   
+0000e960: 2020 2020 2020 2020 2069 705f 7265 7365           ip_rese
+0000e970: 7276 6174 696f 6e73 203d 2063 7572 7265  rvations = curre
+0000e980: 6e74 636f 6e66 706f 6f6c 2e67 6574 2827  ntconfpool.get('
+0000e990: 6970 5f72 6573 6572 7661 7469 6f6e 7327  ip_reservations'
+0000e9a0: 2c20 7b7d 290a 2020 2020 2020 2020 2020  , {}).          
+0000e9b0: 2020 7265 7365 7276 6564 5f69 7073 203d    reserved_ips =
+0000e9c0: 206c 6973 7428 6970 5f72 6573 6572 7661   list(ip_reserva
+0000e9d0: 7469 6f6e 732e 7661 6c75 6573 2829 290a  tions.values()).
+0000e9e0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0000e9f0: 6970 7327 2069 6e20 6375 7272 656e 7463  ips' in currentc
+0000ea00: 6f6e 6670 6f6f 6c3a 0a20 2020 2020 2020  onfpool:.       
+0000ea10: 2020 2020 2020 2020 2069 7073 203d 2063           ips = c
+0000ea20: 7572 7265 6e74 636f 6e66 706f 6f6c 5b27  urrentconfpool['
+0000ea30: 6970 7327 5d0a 2020 2020 2020 2020 2020  ips'].          
+0000ea40: 2020 2020 2020 6966 2027 2f27 2069 6e20        if '/' in 
+0000ea50: 6970 733a 0a20 2020 2020 2020 2020 2020  ips:.           
+0000ea60: 2020 2020 2020 2020 2069 7073 203d 205b           ips = [
+0000ea70: 7374 7228 6929 2066 6f72 2069 2069 6e20  str(i) for i in 
+0000ea80: 6970 5f6e 6574 776f 726b 2869 7073 295b  ip_network(ips)[
+0000ea90: 313a 2e31 5d5d 0a20 2020 2020 2020 2020  1:.1]].         
+0000eaa0: 2020 2020 2020 2066 7265 655f 6970 7320         free_ips 
+0000eab0: 3d20 5b69 7020 666f 7220 6970 2069 6e20  = [ip for ip in 
+0000eac0: 6970 7320 6966 2069 7020 6e6f 7420 696e  ips if ip not in
+0000ead0: 2072 6573 6572 7665 645f 6970 735d 0a20   reserved_ips]. 
+0000eae0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000eaf0: 6620 6672 6565 5f69 7073 3a0a 2020 2020  f free_ips:.    
+0000eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb10: 6672 6565 5f69 7020 3d20 6672 6565 5f69  free_ip = free_i
+0000eb20: 7073 5b30 5d0a 2020 2020 2020 2020 2020  ps[0].          
+0000eb30: 2020 2020 2020 2020 2020 6970 5f72 6573            ip_res
+0000eb40: 6572 7661 7469 6f6e 735b 6e61 6d65 5d20  ervations[name] 
+0000eb50: 3d20 6672 6565 5f69 700a 2020 2020 2020  = free_ip.      
+0000eb60: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0000eb70: 7269 6e74 2866 2255 7369 6e67 2069 7020  rint(f"Using ip 
+0000eb80: 7b66 7265 655f 6970 7d20 6672 6f6d 2063  {free_ip} from c
+0000eb90: 6f6e 6670 6f6f 6c20 7b63 6f6e 6670 6f6f  onfpool {confpoo
+0000eba0: 6c7d 2069 6e20 6e65 7420 7b69 6e64 6578  l} in net {index
+0000ebb0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000ebc0: 2020 2020 2020 2020 6e65 775f 636f 6e66          new_conf
+0000ebd0: 203d 2063 7572 7265 6e74 636f 6e66 706f   = currentconfpo
+0000ebe0: 6f6c 2e63 6f70 7928 290a 2020 2020 2020  ol.copy().      
+0000ebf0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0000ec00: 775f 636f 6e66 5b27 6970 275d 203d 2066  w_conf['ip'] = f
+0000ec10: 7265 655f 6970 0a20 2020 2020 2020 2020  ree_ip.         
+0000ec20: 2020 2020 2020 2020 2020 206e 6574 735b             nets[
+0000ec30: 696e 6465 785d 2e75 7064 6174 6528 6375  index].update(cu
+0000ec40: 7272 656e 7463 6f6e 6670 6f6f 6c29 0a20  rrentconfpool). 
+0000ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec60: 2020 2069 6620 6e6f 7420 6f6e 6c79 6173     if not onlyas
+0000ec70: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
+0000ec80: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000ec90: 6c66 2e75 7064 6174 655f 636f 6e66 706f  lf.update_confpo
+0000eca0: 6f6c 2863 6f6e 6670 6f6f 6c2c 207b 2769  ol(confpool, {'i
+0000ecb0: 705f 7265 7365 7276 6174 696f 6e73 273a  p_reservations':
+0000ecc0: 2069 705f 7265 7365 7276 6174 696f 6e73   ip_reservations
+0000ecd0: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+0000ece0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000ecf0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+0000ed00: 6f72 2866 224e 6f20 6176 6169 6c61 626c  or(f"No availabl
+0000ed10: 6520 6970 2069 6e20 636f 6e66 706f 6f6c  e ip in confpool
+0000ed20: 207b 636f 6e66 706f 6f6c 7d22 290a 2020   {confpool}").  
+0000ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed40: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+0000ed50: 2020 2020 2020 6966 206f 6e6c 7961 7373        if onlyass
+0000ed60: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+0000ed70: 2069 6d61 6765 203d 2069 6d61 6765 206f   image = image o
+0000ed80: 7220 7072 6f66 696c 656e 616d 650a 2020  r profilename.  
+0000ed90: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0000eda0: 203d 207b 2772 6573 756c 7427 3a20 2773   = {'result': 's
+0000edb0: 7563 6365 7373 277d 0a20 2020 2020 2020  uccess'}.       
+0000edc0: 2020 2020 2069 6620 636f 6d6d 6f6e 2e6e       if common.n
+0000edd0: 6565 6473 5f69 676e 6974 696f 6e28 696d  eeds_ignition(im
+0000ede0: 6167 6529 3a0a 2020 2020 2020 2020 2020  age):.          
+0000edf0: 2020 2020 2020 7665 7273 696f 6e20 3d20        version = 
+0000ee00: 636f 6d6d 6f6e 2e69 676e 6974 696f 6e5f  common.ignition_
+0000ee10: 7665 7273 696f 6e28 696d 6167 6529 0a20  version(image). 
+0000ee20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000ee30: 6f6d 7061 6374 203d 2054 7275 6520 6966  ompact = True if
+0000ee40: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+0000ee50: 636f 6d70 6163 7427 2920 656c 7365 2046  compact') else F
+0000ee60: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0000ee70: 2020 2020 2075 7365 7264 6174 6120 3d20       userdata = 
+0000ee80: 636f 6d6d 6f6e 2e69 676e 6974 696f 6e28  common.ignition(
+0000ee90: 6e61 6d65 3d6e 616d 652c 206b 6579 733d  name=name, keys=
+0000eea0: 6b65 7973 2c20 636d 6473 3d63 6d64 732c  keys, cmds=cmds,
+0000eeb0: 206e 6574 733d 6e65 7473 2c20 6761 7465   nets=nets, gate
+0000eec0: 7761 793d 6761 7465 7761 792c 2064 6e73  way=gateway, dns
+0000eed0: 3d64 6e73 2c0a 2020 2020 2020 2020 2020  =dns,.          
+0000eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef00: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c20   domain=domain, 
+0000ef10: 6669 6c65 733d 6669 6c65 732c 2065 6e61  files=files, ena
+0000ef20: 626c 6572 6f6f 743d 656e 6162 6c65 726f  bleroot=enablero
+0000ef30: 6f74 2c20 6f76 6572 7269 6465 733d 6f76  ot, overrides=ov
+0000ef40: 6572 7269 6465 732c 0a20 2020 2020 2020  errides,.       
+0000ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef90: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0000efa0: 2020 2020 2020 2020 6966 2069 7020 6973          if ip is
-0000efb0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000efc0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0000efd0: 2822 436f 756c 646e 2774 2061 7373 6967  ("Couldn't assig
-0000efe0: 6e20 444e 5322 290a 2020 2020 2020 2020  n DNS").        
-0000eff0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f010: 2020 7a2e 7265 7365 7276 655f 646e 7328    z.reserve_dns(
-0000f020: 6e61 6d65 3d6e 616d 652c 206e 6574 733d  name=name, nets=
-0000f030: 5b64 6f6d 6169 6e5d 2c20 646f 6d61 696e  [domain], domain
-0000f040: 3d64 6f6d 6169 6e2c 2069 703d 6970 2c20  =domain, ip=ip, 
-0000f050: 666f 7263 653d 5472 7565 290a 2020 2020  force=True).    
-0000f060: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000f070: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0000f080: 726e 696e 6728 6622 436c 6965 6e74 207b  rning(f"Client {
-0000f090: 646e 7363 6c69 656e 747d 206e 6f74 2066  dnsclient} not f
-0000f0a0: 6f75 6e64 2e20 536b 6970 7069 6e67 2229  ound. Skipping")
-0000f0b0: 0a20 2020 2020 2020 2069 6620 6f73 2e61  .        if os.a
-0000f0c0: 6363 6573 7328 6f73 2e70 6174 682e 6578  ccess(os.path.ex
-0000f0d0: 7061 6e64 7573 6572 2827 7e2f 2e6b 636c  panduser('~/.kcl
-0000f0e0: 6927 292c 206f 732e 575f 4f4b 293a 0a20  i'), os.W_OK):. 
-0000f0f0: 2020 2020 2020 2020 2020 2063 6c69 656e             clien
-0000f100: 7420 3d20 636c 6965 6e74 2069 6620 636c  t = client if cl
-0000f110: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
-0000f120: 2065 6c73 6520 7365 6c66 2e63 6c69 656e   else self.clien
-0000f130: 740a 2020 2020 2020 2020 2020 2020 636f  t.            co
-0000f140: 6d6d 6f6e 2e73 6574 5f6c 6173 7476 6d28  mmon.set_lastvm(
-0000f150: 6e61 6d65 2c20 636c 6965 6e74 290a 2020  name, client).  
-0000f160: 2020 2020 2020 616e 7369 626c 6570 726f        ansiblepro
-0000f170: 6669 6c65 203d 2070 726f 6669 6c65 2e67  file = profile.g
-0000f180: 6574 2827 616e 7369 626c 6527 290a 2020  et('ansible').  
-0000f190: 2020 2020 2020 6966 2061 6e73 6962 6c65        if ansible
-0000f1a0: 7072 6f66 696c 6520 6973 206e 6f74 204e  profile is not N
-0000f1b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000f1c0: 2069 6620 7768 6963 6828 2761 6e73 6962   if which('ansib
-0000f1d0: 6c65 2d70 6c61 7962 6f6f 6b27 2920 6973  le-playbook') is
-0000f1e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000f1f0: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
-0000f200: 616e 7369 626c 652d 706c 6179 626f 6f6b  ansible-playbook
-0000f210: 2065 7865 6375 7461 626c 6520 6e6f 7420   executable not 
-0000f220: 666f 756e 642e 2053 6b69 7070 696e 6720  found. Skipping 
-0000f230: 616e 7369 626c 6520 706c 6179 2229 0a20  ansible play"). 
-0000f240: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000f250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f260: 2066 6f72 2065 6c65 6d65 6e74 2069 6e20   for element in 
-0000f270: 616e 7369 626c 6570 726f 6669 6c65 3a0a  ansibleprofile:.
-0000f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f290: 2020 2020 6966 2027 706c 6179 626f 6f6b      if 'playbook
-0000f2a0: 2720 6e6f 7420 696e 2065 6c65 6d65 6e74  ' not in element
-0000f2b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f2c0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0000f2d0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0000f2e0: 2020 2020 2020 2070 6c61 7962 6f6f 6b20         playbook 
-0000f2f0: 3d20 656c 656d 656e 745b 2770 6c61 7962  = element['playb
-0000f300: 6f6f 6b27 5d0a 2020 2020 2020 2020 2020  ook'].          
-0000f310: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-0000f320: 6c65 7320 3d20 656c 656d 656e 742e 6765  les = element.ge
-0000f330: 7428 2776 6172 6961 626c 6573 272c 207b  t('variables', {
-0000f340: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-0000f350: 2020 2020 2020 2076 6572 626f 7365 203d         verbose =
-0000f360: 2065 6c65 6d65 6e74 2e67 6574 2827 7665   element.get('ve
-0000f370: 7262 6f73 6527 2c20 4661 6c73 6529 0a20  rbose', False). 
-0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f390: 2020 2075 7365 7220 3d20 656c 656d 656e     user = elemen
-0000f3a0: 742e 6765 7428 2775 7365 7227 290a 2020  t.get('user').  
-0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3c0: 2020 616e 7369 626c 6575 7469 6c73 2e70    ansibleutils.p
-0000f3d0: 6c61 7928 6b2c 206e 616d 652c 2070 6c61  lay(k, name, pla
-0000f3e0: 7962 6f6f 6b3d 706c 6179 626f 6f6b 2c20  ybook=playbook, 
-0000f3f0: 7661 7269 6162 6c65 733d 7661 7269 6162  variables=variab
-0000f400: 6c65 732c 2076 6572 626f 7365 3d76 6572  les, verbose=ver
-0000f410: 626f 7365 2c20 7573 6572 3d75 7365 722c  bose, user=user,
-0000f420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f440: 2020 2020 2020 2074 756e 6e65 6c3d 7365         tunnel=se
-0000f450: 6c66 2e74 756e 6e65 6c2c 2074 756e 6e65  lf.tunnel, tunne
-0000f460: 6c68 6f73 743d 7365 6c66 2e68 6f73 742c  lhost=self.host,
-0000f470: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
-0000f480: 2e70 6f72 742c 0a20 2020 2020 2020 2020  .port,.         
-0000f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4a0: 2020 2020 2020 2020 2020 2020 2074 756e               tun
-0000f4b0: 6e65 6c75 7365 723d 7365 6c66 2e75 7365  neluser=self.use
-0000f4c0: 722c 2079 616d 6c69 6e76 656e 746f 7279  r, yamlinventory
-0000f4d0: 3d79 616d 6c69 6e76 656e 746f 7279 2c20  =yamlinventory, 
-0000f4e0: 696e 7365 6375 7265 3d73 656c 662e 696e  insecure=self.in
-0000f4f0: 7365 6375 7265 290a 2020 2020 2020 2020  secure).        
-0000f500: 756e 706c 7567 6364 203d 206f 7665 7272  unplugcd = overr
-0000f510: 6964 6573 2e67 6574 2827 756e 706c 7567  ides.get('unplug
-0000f520: 6364 272c 2046 616c 7365 290a 2020 2020  cd', False).    
-0000f530: 2020 2020 6966 2077 6169 7420 6f72 2075      if wait or u
-0000f540: 6e70 6c75 6763 643a 0a20 2020 2020 2020  nplugcd:.       
-0000f550: 2020 2020 2069 6620 6e6f 7420 636c 6f75       if not clou
-0000f560: 6469 6e69 7420 6f72 206e 6f74 2073 7461  dinit or not sta
-0000f570: 7274 206f 7220 696d 6167 6520 6973 204e  rt or image is N
-0000f580: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000f590: 2020 2020 2070 7072 696e 7428 6622 536b       pprint(f"Sk
-0000f5a0: 6970 7069 6e67 2077 6169 7420 6f6e 207b  ipping wait on {
-0000f5b0: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-0000f5c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000f5d0: 2020 2020 2020 2020 2020 6964 656e 7469            identi
-0000f5e0: 7479 6669 6c65 203d 204e 6f6e 650a 2020  tyfile = None.  
-0000f5f0: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0000f600: 6d70 6b65 795f 636c 6561 6e20 3d20 4661  mpkey_clean = Fa
-0000f610: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0000f620: 2020 2020 6966 206f 7665 7272 6964 6573      if overrides
-0000f630: 2e67 6574 2827 7465 6d70 6b65 7964 6972  .get('tempkeydir
-0000f640: 2729 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ') is not None:.
-0000f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f660: 2020 2020 6964 656e 7469 7479 6669 6c65      identityfile
-0000f670: 203d 2066 227b 6f76 6572 7269 6465 735b   = f"{overrides[
-0000f680: 2774 656d 706b 6579 6469 7227 5d2e 6e61  'tempkeydir'].na
-0000f690: 6d65 7d2f 6964 5f72 7361 220a 2020 2020  me}/id_rsa".    
-0000f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6b0: 7465 6d70 6b65 795f 636c 6561 6e20 3d20  tempkey_clean = 
-0000f6c0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0000f6d0: 2020 2020 2073 656c 662e 7761 6974 5f66       self.wait_f
-0000f6e0: 696e 6973 6828 6e61 6d65 2c20 696d 6167  inish(name, imag
-0000f6f0: 653d 696d 6167 652c 2077 6169 7463 6f6d  e=image, waitcom
-0000f700: 6d61 6e64 3d77 6169 7463 6f6d 6d61 6e64  mand=waitcommand
-0000f710: 2c20 7761 6974 7469 6d65 6f75 743d 7761  , waittimeout=wa
-0000f720: 6974 7469 6d65 6f75 742c 0a20 2020 2020  ittimeout,.     
-0000f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f740: 2020 2020 2020 2020 2020 2020 6964 656e              iden
-0000f750: 7469 7479 6669 6c65 3d69 6465 6e74 6974  tityfile=identit
-0000f760: 7966 696c 652c 2076 6d63 6c69 656e 743d  yfile, vmclient=
-0000f770: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
-0000f780: 2020 2020 2020 2020 6669 6e69 7368 6669          finishfi
-0000f790: 6c65 7320 3d20 7072 6f66 696c 652e 6765  les = profile.ge
-0000f7a0: 7428 2766 696e 6973 6866 696c 6573 272c  t('finishfiles',
-0000f7b0: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
-0000f7c0: 2020 2020 2069 6620 6669 6e69 7368 6669       if finishfi
-0000f7d0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-0000f7e0: 2020 2020 2020 2020 2073 656c 662e 6861           self.ha
-0000f7f0: 6e64 6c65 5f66 696e 6973 6866 696c 6573  ndle_finishfiles
-0000f800: 286e 616d 652c 2066 696e 6973 6866 696c  (name, finishfil
-0000f810: 6573 2c20 6964 656e 7469 7479 6669 6c65  es, identityfile
-0000f820: 3d69 6465 6e74 6974 7966 696c 652c 2076  =identityfile, v
-0000f830: 6d63 6c69 656e 743d 636c 6965 6e74 290a  mclient=client).
-0000f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f850: 6966 2074 656d 706b 6579 5f63 6c65 616e  if tempkey_clean
-0000f860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f870: 2020 2020 2020 7365 6c66 2e63 6c65 616e        self.clean
-0000f880: 5f74 656d 706b 6579 286e 616d 652c 2069  _tempkey(name, i
-0000f890: 6465 6e74 6974 7966 696c 653d 6964 656e  dentityfile=iden
-0000f8a0: 7469 7479 6669 6c65 290a 2020 2020 2020  tityfile).      
-0000f8b0: 2020 2020 2020 6966 2075 6e70 6c75 6763        if unplugc
-0000f8c0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0000f8d0: 2020 2073 656c 662e 6b2e 7570 6461 7465     self.k.update
-0000f8e0: 5f69 736f 286e 616d 652c 204e 6f6e 6529  _iso(name, None)
-0000f8f0: 0a20 2020 2020 2020 2069 6620 6f76 6572  .        if over
-0000f900: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
-0000f910: 6579 6469 7227 2920 6973 206e 6f74 204e  eydir') is not N
-0000f920: 6f6e 6520 616e 6420 6e6f 7420 6f76 6572  one and not over
-0000f930: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
-0000f940: 6579 6469 726b 6565 7027 2c20 4661 6c73  eydirkeep', Fals
-0000f950: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000f960: 6f76 6572 7269 6465 732e 6765 7428 2774  overrides.get('t
-0000f970: 656d 706b 6579 6469 7227 292e 636c 6561  empkeydir').clea
-0000f980: 6e75 7028 290a 2020 2020 2020 2020 7265  nup().        re
-0000f990: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-0000f9a0: 2773 7563 6365 7373 272c 2027 766d 273a  'success', 'vm':
-0000f9b0: 206e 616d 657d 0a0a 2020 2020 6465 6620   name}..    def 
-0000f9c0: 7570 6461 7465 5f76 6d28 7365 6c66 2c20  update_vm(self, 
-0000f9d0: 6e61 6d65 2c20 6f76 6572 7269 6465 7329  name, overrides)
-0000f9e0: 3a0a 2020 2020 2020 2020 6b20 3d20 7365  :.        k = se
-0000f9f0: 6c66 2e6b 0a20 2020 2020 2020 2069 7020  lf.k.        ip 
-0000fa00: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-0000fa10: 2769 7027 290a 2020 2020 2020 2020 666c  'ip').        fl
-0000fa20: 6176 6f72 203d 206f 7665 7272 6964 6573  avor = overrides
-0000fa30: 2e67 6574 2827 666c 6176 6f72 2729 0a20  .get('flavor'). 
-0000fa40: 2020 2020 2020 206e 756d 6370 7573 203d         numcpus =
-0000fa50: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-0000fa60: 6e75 6d63 7075 7327 290a 2020 2020 2020  numcpus').      
-0000fa70: 2020 6d65 6d6f 7279 203d 206f 7665 7272    memory = overr
-0000fa80: 6964 6573 2e67 6574 2827 6d65 6d6f 7279  ides.get('memory
-0000fa90: 2729 0a20 2020 2020 2020 2061 7574 6f73  ').        autos
-0000faa0: 7461 7274 203d 206f 7665 7272 6964 6573  tart = overrides
-0000fab0: 2e67 6574 2827 6175 746f 7374 6172 7427  .get('autostart'
-0000fac0: 290a 2020 2020 2020 2020 646e 7320 3d20  ).        dns = 
-0000fad0: 6f76 6572 7269 6465 732e 6765 7428 2764  overrides.get('d
-0000fae0: 6e73 2729 0a20 2020 2020 2020 2068 6f73  ns').        hos
-0000faf0: 7420 3d20 6f76 6572 7269 6465 732e 6765  t = overrides.ge
-0000fb00: 7428 2768 6f73 7427 290a 2020 2020 2020  t('host').      
-0000fb10: 2020 646f 6d61 696e 203d 206f 7665 7272    domain = overr
-0000fb20: 6964 6573 2e67 6574 2827 646f 6d61 696e  ides.get('domain
-0000fb30: 2729 0a20 2020 2020 2020 2063 6c6f 7564  ').        cloud
-0000fb40: 696e 6974 203d 206f 7665 7272 6964 6573  init = overrides
-0000fb50: 2e67 6574 2827 636c 6f75 6469 6e69 7427  .get('cloudinit'
-0000fb60: 290a 2020 2020 2020 2020 696d 6167 6520  ).        image 
-0000fb70: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-0000fb80: 2769 6d61 6765 2729 0a20 2020 2020 2020  'image').       
-0000fb90: 206e 6574 7320 3d20 6f76 6572 7269 6465   nets = override
-0000fba0: 732e 6765 7428 276e 6574 7327 290a 2020  s.get('nets').  
-0000fbb0: 2020 2020 2020 6469 736b 7320 3d20 6f76        disks = ov
-0000fbc0: 6572 7269 6465 732e 6765 7428 2764 6973  errides.get('dis
-0000fbd0: 6b73 2729 0a20 2020 2020 2020 2069 6e66  ks').        inf
-0000fbe0: 6f72 6d61 7469 6f6e 203d 206f 7665 7272  ormation = overr
-0000fbf0: 6964 6573 2e67 6574 2827 696e 666f 726d  ides.get('inform
-0000fc00: 6174 696f 6e27 290a 2020 2020 2020 2020  ation').        
-0000fc10: 6370 7566 6c61 6773 203d 206f 7665 7272  cpuflags = overr
-0000fc20: 6964 6573 2e67 6574 2827 6370 7566 6c61  ides.get('cpufla
-0000fc30: 6773 272c 205b 5d29 0a20 2020 2020 2020  gs', []).       
-0000fc40: 2064 6973 6162 6c65 203d 206f 7665 7272   disable = overr
-0000fc50: 6964 6573 2e67 6574 2827 6469 7361 626c  ides.get('disabl
-0000fc60: 6527 2c20 4661 6c73 6529 0a20 2020 2020  e', False).     
-0000fc70: 2020 206f 7665 7272 6964 6573 2e70 6f70     overrides.pop
-0000fc80: 2827 6469 7361 626c 6527 2c20 4e6f 6e65  ('disable', None
-0000fc90: 290a 2020 2020 2020 2020 6578 7472 615f  ).        extra_
-0000fca0: 6d65 7461 6461 7461 203d 207b 6b3a 206f  metadata = {k: o
-0000fcb0: 7665 7272 6964 6573 5b6b 5d20 666f 7220  verrides[k] for 
-0000fcc0: 6b20 696e 206f 7665 7272 6964 6573 2069  k in overrides i
-0000fcd0: 6620 6b20 6e6f 7420 696e 2073 656c 662e  f k not in self.
-0000fce0: 6c69 7374 5f6b 6579 776f 7264 7328 297d  list_keywords()}
-0000fcf0: 0a20 2020 2020 2020 2074 656d 706c 6174  .        templat
-0000fd00: 6520 3d20 6f76 6572 7269 6465 732e 6765  e = overrides.ge
-0000fd10: 7428 2774 656d 706c 6174 6527 290a 2020  t('template').  
-0000fd20: 2020 2020 2020 6966 2074 656d 706c 6174        if templat
-0000fd30: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0000fd40: 2020 2020 2020 2020 2020 2064 656c 2065             del e
-0000fd50: 7874 7261 5f6d 6574 6164 6174 615b 2774  xtra_metadata['t
-0000fd60: 656d 706c 6174 6527 5d0a 2020 2020 2020  emplate'].      
-0000fd70: 2020 6966 2064 6e73 3a0a 2020 2020 2020    if dns:.      
-0000fd80: 2020 2020 2020 7070 7269 6e74 2866 2243        pprint(f"C
-0000fd90: 7265 6174 696e 6720 446e 7320 656e 7472  reating Dns entr
-0000fda0: 7920 666f 7220 7b6e 616d 657d 2e2e 2e22  y for {name}..."
-0000fdb0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
-0000fdc0: 7477 6f72 6b73 203d 206b 2e76 6d5f 706f  tworks = k.vm_po
-0000fdd0: 7274 7328 6e61 6d65 290a 2020 2020 2020  rts(name).      
-0000fde0: 2020 2020 2020 6966 206e 6574 776f 726b        if network
-0000fdf0: 7320 616e 6420 646f 6d61 696e 2069 7320  s and domain is 
-0000fe00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000fe10: 2020 2020 2020 646f 6d61 696e 203d 206e        domain = n
-0000fe20: 6574 776f 726b 735b 305d 0a20 2020 2020  etworks[0].     
-0000fe30: 2020 2020 2020 2069 6620 6e6f 7420 6e65         if not ne
-0000fe40: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0000fe50: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0000fe60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000fe70: 2020 2020 2020 2020 2020 2020 206b 2e72               k.r
-0000fe80: 6573 6572 7665 5f64 6e73 286e 616d 653d  eserve_dns(name=
-0000fe90: 6e61 6d65 2c20 6e65 7473 3d6e 6574 776f  name, nets=netwo
-0000fea0: 726b 732c 2064 6f6d 6169 6e3d 646f 6d61  rks, domain=doma
-0000feb0: 696e 2c20 6970 3d69 7029 0a20 2020 2020  in, ip=ip).     
-0000fec0: 2020 2069 6620 6970 2069 7320 6e6f 7420     if ip is not 
-0000fed0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000fee0: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
-0000fef0: 696e 6720 6970 206f 6620 766d 207b 6e61  ing ip of vm {na
-0000ff00: 6d65 7d20 746f 207b 6970 7d2e 2e2e 2229  me} to {ip}...")
-0000ff10: 0a20 2020 2020 2020 2020 2020 206b 2e75  .            k.u
-0000ff20: 7064 6174 655f 6d65 7461 6461 7461 286e  pdate_metadata(n
-0000ff30: 616d 652c 2027 6970 272c 2069 7029 0a20  ame, 'ip', ip). 
-0000ff40: 2020 2020 2020 2069 6620 636c 6f75 6469         if cloudi
-0000ff50: 6e69 743a 0a20 2020 2020 2020 2020 2020  nit:.           
-0000ff60: 2070 7072 696e 7428 6622 5265 6d6f 7669   pprint(f"Removi
-0000ff70: 6e67 2063 6c6f 7564 696e 6974 2069 6e66  ng cloudinit inf
-0000ff80: 6f72 6d61 7469 6f6e 206f 6620 766d 207b  ormation of vm {
-0000ff90: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-0000ffa0: 2020 2020 6b2e 7265 6d6f 7665 5f63 6c6f      k.remove_clo
-0000ffb0: 7564 696e 6974 286e 616d 6529 0a20 2020  udinit(name).   
-0000ffc0: 2020 2020 2069 6620 696d 6167 6520 6973       if image is
-0000ffd0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000ffe0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-0000fff0: 5570 6461 7469 6e67 2069 6d61 6765 206f  Updating image o
-00010000: 6620 766d 207b 6e61 6d65 7d20 746f 207b  f vm {name} to {
-00010010: 696d 6167 657d 2e2e 2e22 290a 2020 2020  image}...").    
-00010020: 2020 2020 2020 2020 6b2e 7570 6461 7465          k.update
-00010030: 5f6d 6574 6164 6174 6128 6e61 6d65 2c20  _metadata(name, 
-00010040: 2769 6d61 6765 272c 2069 6d61 6765 290a  'image', image).
-00010050: 2020 2020 2020 2020 6966 206d 656d 6f72          if memor
-00010060: 7920 6973 206e 6f74 204e 6f6e 653a 0a20  y is not None:. 
-00010070: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00010080: 7428 6622 5570 6461 7469 6e67 206d 656d  t(f"Updating mem
-00010090: 6f72 7920 6f66 2076 6d20 7b6e 616d 657d  ory of vm {name}
-000100a0: 2074 6f20 7b6d 656d 6f72 797d 2e2e 2e22   to {memory}..."
-000100b0: 290a 2020 2020 2020 2020 2020 2020 6b2e  ).            k.
-000100c0: 7570 6461 7465 5f6d 656d 6f72 7928 6e61  update_memory(na
-000100d0: 6d65 2c20 6d65 6d6f 7279 290a 2020 2020  me, memory).    
-000100e0: 2020 2020 6966 206e 756d 6370 7573 2069      if numcpus i
-000100f0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00010100: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00010110: 2255 7064 6174 696e 6720 6e75 6d63 7075  "Updating numcpu
-00010120: 7320 6f66 2076 6d20 7b6e 616d 657d 2074  s of vm {name} t
-00010130: 6f20 7b6e 756d 6370 7573 7d2e 2e2e 2229  o {numcpus}...")
-00010140: 0a20 2020 2020 2020 2020 2020 206b 2e75  .            k.u
-00010150: 7064 6174 655f 6370 7573 286e 616d 652c  pdate_cpus(name,
-00010160: 206e 756d 6370 7573 290a 2020 2020 2020   numcpus).      
-00010170: 2020 6966 2061 7574 6f73 7461 7274 2069    if autostart i
-00010180: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00010190: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-000101a0: 2253 6574 7469 6e67 2061 7574 6f73 7461  "Setting autosta
-000101b0: 7274 2074 6f20 7b61 7574 6f73 7461 7274  rt to {autostart
-000101c0: 7d20 666f 7220 766d 207b 6e61 6d65 7d2e  } for vm {name}.
-000101d0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-000101e0: 206b 2e75 7064 6174 655f 7374 6172 7428   k.update_start(
-000101f0: 6e61 6d65 2c20 7374 6172 743d 6175 746f  name, start=auto
-00010200: 7374 6172 7429 0a20 2020 2020 2020 2069  start).        i
-00010210: 6620 696e 666f 726d 6174 696f 6e3a 0a20  f information:. 
-00010220: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00010230: 7428 6622 5365 7474 696e 6720 696e 666f  t(f"Setting info
-00010240: 726d 6174 696f 6e20 666f 7220 766d 207b  rmation for vm {
-00010250: 6e61 6d65 7d2e 2e2e 2229 0a20 2020 2020  name}...").     
-00010260: 2020 2020 2020 206b 2e75 7064 6174 655f         k.update_
-00010270: 696e 666f 726d 6174 696f 6e28 6e61 6d65  information(name
-00010280: 2c20 696e 666f 726d 6174 696f 6e29 0a20  , information). 
-00010290: 2020 2020 2020 2069 6620 2769 736f 2720         if 'iso' 
-000102a0: 696e 206f 7665 7272 6964 6573 3a0a 2020  in overrides:.  
-000102b0: 2020 2020 2020 2020 2020 6973 6f20 3d20            iso = 
-000102c0: 6f76 6572 7269 6465 735b 2769 736f 275d  overrides['iso']
-000102d0: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-000102e0: 696e 7428 6622 5377 6974 6368 696e 6720  int(f"Switching 
-000102f0: 6973 6f20 666f 7220 766d 207b 6e61 6d65  iso for vm {name
-00010300: 7d20 746f 207b 6973 6f7d 2e2e 2e22 290a  } to {iso}...").
-00010310: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00010320: 736f 203d 3d20 274e 6f6e 6527 206f 7220  so == 'None' or 
-00010330: 6973 6f20 3d3d 2027 273a 0a20 2020 2020  iso == '':.     
-00010340: 2020 2020 2020 2020 2020 2069 736f 203d             iso =
-00010350: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00010360: 2020 6b2e 7570 6461 7465 5f69 736f 286e    k.update_iso(n
-00010370: 616d 652c 2069 736f 290a 2020 2020 2020  ame, iso).      
-00010380: 2020 6966 2066 6c61 766f 7220 6973 206e    if flavor is n
-00010390: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000103a0: 2020 2020 2070 7072 696e 7428 6622 5570       pprint(f"Up
-000103b0: 6461 7469 6e67 2066 6c61 766f 7220 6f66  dating flavor of
-000103c0: 2076 6d20 7b6e 616d 657d 2074 6f20 7b66   vm {name} to {f
-000103d0: 6c61 766f 727d 2e2e 2e22 290a 2020 2020  lavor}...").    
-000103e0: 2020 2020 2020 2020 6b2e 7570 6461 7465          k.update
-000103f0: 5f66 6c61 766f 7228 6e61 6d65 2c20 666c  _flavor(name, fl
-00010400: 6176 6f72 290a 2020 2020 2020 2020 6966  avor).        if
-00010410: 2068 6f73 743a 0a20 2020 2020 2020 2020   host:.         
-00010420: 2020 2070 7072 696e 7428 6622 4372 6561     pprint(f"Crea
-00010430: 7469 6e67 2048 6f73 7420 656e 7472 7920  ting Host entry 
-00010440: 666f 7220 766d 207b 6e61 6d65 7d2e 2e2e  for vm {name}...
-00010450: 2229 0a20 2020 2020 2020 2020 2020 206e  ").            n
-00010460: 6574 776f 726b 7320 3d20 6b2e 766d 5f70  etworks = k.vm_p
-00010470: 6f72 7473 286e 616d 6529 0a20 2020 2020  orts(name).     
-00010480: 2020 2020 2020 2069 6620 6e65 7477 6f72         if networ
-00010490: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
-000104a0: 2020 2020 6966 2064 6f6d 6169 6e20 6973      if domain is
-000104b0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000104c0: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
-000104d0: 6e20 3d20 6e65 7477 6f72 6b73 5b30 5d0a  n = networks[0].
-000104e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104f0: 6b2e 7265 7365 7276 655f 686f 7374 286e  k.reserve_host(n
-00010500: 616d 652c 206e 6574 776f 726b 732c 2064  ame, networks, d
-00010510: 6f6d 6169 6e29 0a20 2020 2020 2020 2063  omain).        c
-00010520: 7572 7265 6e74 766d 203d 206b 2e69 6e66  urrentvm = k.inf
-00010530: 6f28 6e61 6d65 290a 2020 2020 2020 2020  o(name).        
-00010540: 6375 7272 656e 746e 6574 7320 3d20 6375  currentnets = cu
-00010550: 7272 656e 7476 6d2e 6765 7428 276e 6574  rrentvm.get('net
-00010560: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-00010570: 6375 7272 656e 7464 6973 6b73 203d 2063  currentdisks = c
-00010580: 7572 7265 6e74 766d 2e67 6574 2827 6469  urrentvm.get('di
-00010590: 736b 7327 2c20 5b5d 290a 2020 2020 2020  sks', []).      
-000105a0: 2020 6966 2064 6973 6b73 3a0a 2020 2020    if disks:.    
-000105b0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-000105c0: 2255 7064 6174 696e 6720 6469 736b 7320  "Updating disks 
-000105d0: 6f66 2076 6d20 7b6e 616d 657d 2229 0a20  of vm {name}"). 
-000105e0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-000105f0: 6e64 6578 2c20 6375 7272 656e 7464 6973  ndex, currentdis
-00010600: 6b20 696e 2065 6e75 6d65 7261 7465 2863  k in enumerate(c
-00010610: 7572 7265 6e74 6469 736b 7329 3a0a 2020  urrentdisks):.  
-00010620: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010630: 2069 6e64 6578 203c 206c 656e 2864 6973   index < len(dis
-00010640: 6b73 293a 0a20 2020 2020 2020 2020 2020  ks):.           
-00010650: 2020 2020 2020 2020 2064 6973 6b20 3d20           disk = 
-00010660: 6469 736b 735b 696e 6465 785d 0a20 2020  disks[index].   
-00010670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010680: 2063 7572 7265 6e74 6469 736b 7369 7a65   currentdisksize
-00010690: 203d 2063 7572 7265 6e74 6469 736b 5b27   = currentdisk['
-000106a0: 7369 7a65 275d 0a20 2020 2020 2020 2020  size'].         
-000106b0: 2020 2020 2020 2020 2020 2064 6973 6b73             disks
-000106c0: 697a 6520 3d20 6469 736b 2e67 6574 2827  ize = disk.get('
-000106d0: 7369 7a65 272c 2031 3029 2069 6620 6973  size', 10) if is
-000106e0: 696e 7374 616e 6365 2864 6973 6b2c 2064  instance(disk, d
-000106f0: 6963 7429 2065 6c73 6520 696e 7428 6469  ict) else int(di
-00010700: 736b 290a 2020 2020 2020 2020 2020 2020  sk).            
-00010710: 2020 2020 2020 2020 6966 2064 6973 6b73          if disks
-00010720: 697a 6520 3e20 6375 7272 656e 7464 6973  ize > currentdis
-00010730: 6b73 697a 653a 0a20 2020 2020 2020 2020  ksize:.         
-00010740: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00010750: 6620 6375 7272 656e 7476 6d2e 6765 7428  f currentvm.get(
-00010760: 2773 7461 7475 7327 2920 213d 2027 646f  'status') != 'do
-00010770: 776e 273a 0a20 2020 2020 2020 2020 2020  wn':.           
-00010780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010790: 2077 6172 6e69 6e67 2866 2243 616e 7420   warning(f"Cant 
-000107a0: 7265 7369 7a65 2044 6973 6b20 7b69 6e64  resize Disk {ind
-000107b0: 6578 7d20 696e 207b 6e61 6d65 7d20 7768  ex} in {name} wh
-000107c0: 696c 6520 564d 2069 7320 7570 2229 0a20  ile VM is up"). 
-000107d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107e0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-000107f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010800: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00010810: 6622 5265 7369 7a69 6e67 2044 6973 6b20  f"Resizing Disk 
-00010820: 7b69 6e64 6578 7d20 696e 207b 6e61 6d65  {index} in {name
-00010830: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00010840: 2020 2020 2020 2020 2020 2020 6469 736b              disk
-00010850: 7061 7468 203d 2063 7572 7265 6e74 6469  path = currentdi
-00010860: 736b 5b27 7061 7468 275d 0a20 2020 2020  sk['path'].     
-00010870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010880: 2020 206b 2e72 6573 697a 655f 6469 736b     k.resize_disk
-00010890: 2864 6973 6b70 6174 682c 2064 6973 6b73  (diskpath, disks
-000108a0: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-000108b0: 2069 6620 6c65 6e28 6375 7272 656e 7464   if len(currentd
-000108c0: 6973 6b73 2920 3c20 6c65 6e28 6469 736b  isks) < len(disk
-000108d0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000108e0: 2020 2020 7070 7269 6e74 2866 2241 6464      pprint(f"Add
-000108f0: 696e 6720 4469 736b 7320 746f 207b 6e61  ing Disks to {na
-00010900: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-00010910: 2020 2020 2020 666f 7220 6469 736b 2069        for disk i
-00010920: 6e20 6469 736b 735b 6c65 6e28 6375 7272  n disks[len(curr
-00010930: 656e 7464 6973 6b73 293a 5d3a 0a20 2020  entdisks):]:.   
-00010940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010950: 2069 6e74 6572 6661 6365 203d 204e 6f6e   interface = Non
-00010960: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00010970: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00010980: 6e63 6528 6469 736b 2c20 696e 7429 3a0a  nce(disk, int):.
-00010990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109a0: 2020 2020 2020 2020 7369 7a65 203d 2064          size = d
-000109b0: 6973 6b0a 2020 2020 2020 2020 2020 2020  isk.            
-000109c0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
-000109d0: 203d 2073 656c 662e 706f 6f6c 0a20 2020   = self.pool.   
-000109e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109f0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00010a00: 2864 6973 6b2c 2073 7472 2920 616e 6420  (disk, str) and 
-00010a10: 6469 736b 2e69 7364 6967 6974 2829 3a0a  disk.isdigit():.
-00010a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a30: 2020 2020 2020 2020 7369 7a65 203d 2069          size = i
-00010a40: 6e74 2864 6973 6b29 0a20 2020 2020 2020  nt(disk).       
-00010a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a60: 2070 6f6f 6c20 3d20 7365 6c66 2e70 6f6f   pool = self.poo
-00010a70: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-00010a80: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-00010a90: 7461 6e63 6528 6469 736b 2c20 6469 6374  tance(disk, dict
-00010aa0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00010ab0: 2020 2020 2020 2020 2020 2073 697a 6520             size 
-00010ac0: 3d20 6469 736b 2e67 6574 2827 7369 7a65  = disk.get('size
-00010ad0: 272c 2073 656c 662e 6469 736b 7369 7a65  ', self.disksize
-00010ae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00010af0: 2020 2020 2020 2020 2020 706f 6f6c 203d            pool =
-00010b00: 2064 6973 6b2e 6765 7428 2770 6f6f 6c27   disk.get('pool'
-00010b10: 2c20 7365 6c66 2e70 6f6f 6c29 0a20 2020  , self.pool).   
-00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b30: 2020 2020 2069 6e74 6572 6661 6365 203d       interface =
-00010b40: 2064 6973 6b2e 6765 7428 2769 6e74 6572   disk.get('inter
-00010b50: 6661 6365 2729 206f 7220 6f76 6572 7269  face') or overri
-00010b60: 6465 732e 6765 7428 2764 6973 6b69 6e74  des.get('diskint
-00010b70: 6572 6661 6365 2729 0a20 2020 2020 2020  erface').       
-00010b80: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00010b90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00010ba0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00010bb0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00010bc0: 2020 2020 2020 2020 6b2e 6164 645f 6469          k.add_di
-00010bd0: 736b 286e 616d 653d 6e61 6d65 2c20 7369  sk(name=name, si
-00010be0: 7a65 3d73 697a 652c 2070 6f6f 6c3d 706f  ze=size, pool=po
-00010bf0: 6f6c 2c20 696e 7465 7266 6163 653d 696e  ol, interface=in
-00010c00: 7465 7266 6163 6529 0a20 2020 2020 2020  terface).       
-00010c10: 2020 2020 2069 6620 6c65 6e28 6375 7272       if len(curr
-00010c20: 656e 7464 6973 6b73 2920 3e20 6c65 6e28  entdisks) > len(
-00010c30: 6469 736b 7329 3a0a 2020 2020 2020 2020  disks):.        
-00010c40: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00010c50: 2252 656d 6f76 696e 6720 4469 736b 7320  "Removing Disks 
-00010c60: 6f66 207b 6e61 6d65 7d22 290a 2020 2020  of {name}").    
-00010c70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00010c80: 6469 736b 2069 6e20 6375 7272 656e 7464  disk in currentd
-00010c90: 6973 6b73 5b6c 656e 2863 7572 7265 6e74  isks[len(current
-00010ca0: 6469 736b 7329 202d 206c 656e 2864 6973  disks) - len(dis
-00010cb0: 6b73 293a 5d3a 0a20 2020 2020 2020 2020  ks):]:.         
-00010cc0: 2020 2020 2020 2020 2020 2064 6973 6b6e             diskn
-00010cd0: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
-00010ce0: 7365 6e61 6d65 2864 6973 6b5b 2770 6174  sename(disk['pat
-00010cf0: 6827 5d29 0a20 2020 2020 2020 2020 2020  h']).           
-00010d00: 2020 2020 2020 2020 2064 6973 6b70 6f6f           diskpoo
-00010d10: 6c20 3d20 6f73 2e70 6174 682e 6469 726e  l = os.path.dirn
-00010d20: 616d 6528 6469 736b 5b27 7061 7468 275d  ame(disk['path']
-00010d30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00010d40: 2020 2020 2020 6b2e 6465 6c65 7465 5f64        k.delete_d
-00010d50: 6973 6b28 6e61 6d65 3d6e 616d 652c 2064  isk(name=name, d
-00010d60: 6973 6b6e 616d 653d 6469 736b 6e61 6d65  iskname=diskname
-00010d70: 2c20 706f 6f6c 3d64 6973 6b70 6f6f 6c2c  , pool=diskpool,
-00010d80: 2069 6e74 6572 6661 6365 3d69 6e74 6572   interface=inter
-00010d90: 6661 6365 290a 2020 2020 2020 2020 6966  face).        if
-00010da0: 206e 6574 733a 0a20 2020 2020 2020 2020   nets:.         
-00010db0: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
-00010dc0: 7469 6e67 206e 6574 7320 6f66 2076 6d20  ting nets of vm 
-00010dd0: 7b6e 616d 657d 2229 0a20 2020 2020 2020  {name}").       
-00010de0: 2020 2020 2069 6620 6c65 6e28 6375 7272       if len(curr
-00010df0: 656e 746e 6574 7329 203c 206c 656e 286e  entnets) < len(n
-00010e00: 6574 7329 3a0a 2020 2020 2020 2020 2020  ets):.          
-00010e10: 2020 2020 2020 7070 7269 6e74 2866 2241        pprint(f"A
-00010e20: 6464 696e 6720 4e69 6373 2074 6f20 7b6e  dding Nics to {n
-00010e30: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
-00010e40: 2020 2020 2020 2066 6f72 206e 6574 2069         for net i
-00010e50: 6e20 6e65 7473 5b6c 656e 2863 7572 7265  n nets[len(curre
-00010e60: 6e74 6e65 7473 293a 5d3a 0a20 2020 2020  ntnets):]:.     
-00010e70: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00010e80: 6f64 656c 203d 2027 7669 7274 696f 270a  odel = 'virtio'.
-00010e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ea0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00010eb0: 6528 6e65 742c 2073 7472 293a 0a20 2020  e(net, str):.   
-00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ed0: 2020 2020 206e 6574 776f 726b 203d 206e       network = n
-00010ee0: 6574 0a20 2020 2020 2020 2020 2020 2020  et.             
-00010ef0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00010f00: 7374 616e 6365 286e 6574 2c20 6469 6374  stance(net, dict
-00010f10: 2920 616e 6420 276e 616d 6527 2069 6e20  ) and 'name' in 
-00010f20: 6e65 743a 0a20 2020 2020 2020 2020 2020  net:.           
-00010f30: 2020 2020 2020 2020 2020 2020 206e 6574               net
-00010f40: 776f 726b 203d 206e 6574 5b27 6e61 6d65  work = net['name
-00010f50: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00010f60: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-00010f70: 203d 206e 6574 2e67 6574 2827 6d6f 6465   = net.get('mode
-00010f80: 6c27 2c20 2776 6972 7469 6f27 290a 2020  l', 'virtio').  
-00010f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fa0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00010fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fc0: 6572 726f 7228 6622 536b 6970 7069 6e67  error(f"Skipping
-00010fd0: 2077 726f 6e67 206e 6963 2073 7065 6320   wrong nic spec 
-00010fe0: 666f 7220 7b6e 616d 657d 2229 0a20 2020  for {name}").   
-00010ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011000: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00011010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011020: 2020 6b2e 6164 645f 6e69 6328 6e61 6d65    k.add_nic(name
-00011030: 2c20 6e65 7477 6f72 6b2c 206d 6f64 656c  , network, model
-00011040: 3d6d 6f64 656c 290a 2020 2020 2020 2020  =model).        
-00011050: 2020 2020 6966 206c 656e 2863 7572 7265      if len(curre
-00011060: 6e74 6e65 7473 2920 3e20 6c65 6e28 6e65  ntnets) > len(ne
-00011070: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
-00011080: 2020 2020 2070 7072 696e 7428 6622 5265       pprint(f"Re
-00011090: 6d6f 7669 6e67 204e 6963 7320 6f66 207b  moving Nics of {
-000110a0: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-000110b0: 2020 2020 2020 2020 666f 7220 6e65 7420          for net 
-000110c0: 696e 2072 616e 6765 286c 656e 2863 7572  in range(len(cur
-000110d0: 7265 6e74 6e65 7473 292c 206c 656e 286e  rentnets), len(n
-000110e0: 6574 7329 2c20 2d31 293a 0a20 2020 2020  ets), -1):.     
-000110f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011100: 6e74 6572 6661 6365 203d 2022 6574 6825  nterface = "eth%
-00011110: 7322 2025 2028 6e65 7420 2d20 3129 0a20  s" % (net - 1). 
-00011120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011130: 2020 206b 2e64 656c 6574 655f 6e69 6328     k.delete_nic(
-00011140: 6e61 6d65 2c20 696e 7465 7266 6163 6529  name, interface)
-00011150: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00011160: 2069 6e64 6578 2c20 6375 7272 656e 746e   index, currentn
-00011170: 6574 2069 6e20 656e 756d 6572 6174 6528  et in enumerate(
-00011180: 6375 7272 656e 746e 6574 7329 3a0a 2020  currentnets):.  
-00011190: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000111a0: 2069 6e64 6578 203e 206c 656e 286e 6574   index > len(net
-000111b0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000111c0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-000111d0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000111e0: 746e 616d 6520 3d20 6375 7272 656e 746e  tname = currentn
-000111f0: 6574 5b27 6e65 7427 5d0a 2020 2020 2020  et['net'].      
-00011200: 2020 2020 2020 2020 2020 7461 7267 6574            target
-00011210: 6e65 746e 616d 6520 3d20 6e65 7473 5b69  netname = nets[i
-00011220: 6e64 6578 5d5b 276e 616d 6527 5d20 6966  ndex]['name'] if
-00011230: 2069 7369 6e73 7461 6e63 6528 6e65 7473   isinstance(nets
-00011240: 5b69 6e64 6578 5d2c 2064 6963 7429 2065  [index], dict) e
-00011250: 6c73 6520 6e65 7473 5b69 6e64 6578 5d0a  lse nets[index].
-00011260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011270: 6966 2074 6172 6765 746e 6574 6e61 6d65  if targetnetname
-00011280: 2021 3d20 6e65 746e 616d 653a 0a20 2020   != netname:.   
+0000ef70: 2020 2020 7665 7273 696f 6e3d 7665 7273      version=vers
+0000ef80: 696f 6e2c 2070 6c61 6e3d 706c 616e 2c20  ion, plan=plan, 
+0000ef90: 696d 6167 653d 696d 6167 652c 2063 6f6d  image=image, com
+0000efa0: 7061 6374 3d63 6f6d 7061 6374 2c0a 2020  pact=compact,.  
+0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efd0: 2020 2020 2020 2020 2076 6d75 7365 723d           vmuser=
+0000efe0: 766d 7573 6572 290a 2020 2020 2020 2020  vmuser).        
+0000eff0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000f000: 2020 2020 2020 2020 2020 7573 6572 6461            userda
+0000f010: 7461 2c20 6d65 7461 6461 7461 2c20 6e65  ta, metadata, ne
+0000f020: 7464 6174 6120 3d20 636f 6d6d 6f6e 2e63  tdata = common.c
+0000f030: 6c6f 7564 696e 6974 286e 616d 652c 206b  loudinit(name, k
+0000f040: 6579 733d 6b65 7973 2c20 636d 6473 3d63  eys=keys, cmds=c
+0000f050: 6d64 732c 206e 6574 733d 6e65 7473 2c20  mds, nets=nets, 
+0000f060: 6761 7465 7761 793d 6761 7465 7761 792c  gateway=gateway,
+0000f070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0b0: 646e 733d 646e 732c 2064 6f6d 6169 6e3d  dns=dns, domain=
+0000f0c0: 646f 6d61 696e 2c20 6669 6c65 733d 6669  domain, files=fi
+0000f0d0: 6c65 732c 0a20 2020 2020 2020 2020 2020  les,.           
+0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f110: 2020 2020 656e 6162 6c65 726f 6f74 3d65      enableroot=e
+0000f120: 6e61 626c 6572 6f6f 742c 206f 7665 7272  nableroot, overr
+0000f130: 6964 6573 3d6f 7665 7272 6964 6573 2c0a  ides=overrides,.
+0000f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f170: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000f180: 6d61 6765 3d69 6d61 6765 2c20 7374 6f72  mage=image, stor
+0000f190: 656d 6574 6164 6174 613d 7374 6f72 656d  emetadata=storem
+0000f1a0: 6574 6164 6174 612c 2076 6d75 7365 723d  etadata, vmuser=
+0000f1b0: 766d 7573 6572 290a 2020 2020 2020 2020  vmuser).        
+0000f1c0: 2020 2020 2020 2020 6966 206e 6574 6461          if netda
+0000f1d0: 7461 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ta is not None:.
+0000f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1f0: 2020 2020 7265 7375 6c74 5b27 6e65 7464      result['netd
+0000f200: 6174 6127 5d20 3d20 6e65 7464 6174 610a  ata'] = netdata.
+0000f210: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0000f220: 6c74 5b27 7573 6572 6461 7461 275d 203d  lt['userdata'] =
+0000f230: 2075 7365 7264 6174 610a 2020 2020 2020   userdata.      
+0000f240: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+0000f250: 756c 740a 2020 2020 2020 2020 7265 7375  ult.        resu
+0000f260: 6c74 203d 206b 2e63 7265 6174 6528 6e61  lt = k.create(na
+0000f270: 6d65 3d6e 616d 652c 2076 6972 7474 7970  me=name, virttyp
+0000f280: 653d 7669 7274 7479 7065 2c20 706c 616e  e=virttype, plan
+0000f290: 3d70 6c61 6e2c 2070 726f 6669 6c65 3d70  =plan, profile=p
+0000f2a0: 726f 6669 6c65 6e61 6d65 2c20 666c 6176  rofilename, flav
+0000f2b0: 6f72 3d66 6c61 766f 722c 0a20 2020 2020  or=flavor,.     
+0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2d0: 2020 2020 2063 7075 6d6f 6465 6c3d 6370       cpumodel=cp
+0000f2e0: 756d 6f64 656c 2c20 6370 7566 6c61 6773  umodel, cpuflags
+0000f2f0: 3d63 7075 666c 6167 732c 2063 7075 7069  =cpuflags, cpupi
+0000f300: 6e6e 696e 673d 6370 7570 696e 6e69 6e67  nning=cpupinning
+0000f310: 2c20 6e75 6d61 6d6f 6465 3d6e 756d 616d  , numamode=numam
+0000f320: 6f64 652c 206e 756d 613d 6e75 6d61 2c0a  ode, numa=numa,.
+0000f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f340: 2020 2020 2020 2020 2020 6e75 6d63 7075            numcpu
+0000f350: 733d 696e 7428 6e75 6d63 7075 7329 2c20  s=int(numcpus), 
+0000f360: 6d65 6d6f 7279 3d69 6e74 286d 656d 6f72  memory=int(memor
+0000f370: 7929 2c20 6775 6573 7469 643d 6775 6573  y), guestid=gues
+0000f380: 7469 642c 2070 6f6f 6c3d 706f 6f6c 2c0a  tid, pool=pool,.
+0000f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3a0: 2020 2020 2020 2020 2020 696d 6167 653d            image=
+0000f3b0: 696d 6167 652c 2064 6973 6b73 3d64 6973  image, disks=dis
+0000f3c0: 6b73 2c20 6469 736b 7369 7a65 3d64 6973  ks, disksize=dis
+0000f3d0: 6b73 697a 652c 2064 6973 6b74 6869 6e3d  ksize, diskthin=
+0000f3e0: 6469 736b 7468 696e 2c0a 2020 2020 2020  diskthin,.      
+0000f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f400: 2020 2020 6469 736b 696e 7465 7266 6163      diskinterfac
+0000f410: 653d 6469 736b 696e 7465 7266 6163 652c  e=diskinterface,
+0000f420: 206e 6574 733d 6e65 7473 2c20 6973 6f3d   nets=nets, iso=
+0000f430: 6973 6f2c 2076 6e63 3d62 6f6f 6c28 766e  iso, vnc=bool(vn
+0000f440: 6329 2c20 636c 6f75 6469 6e69 743d 626f  c), cloudinit=bo
+0000f450: 6f6c 2863 6c6f 7564 696e 6974 292c 0a20  ol(cloudinit),. 
+0000f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f470: 2020 2020 2020 2020 2072 6573 6572 7665           reserve
+0000f480: 6970 3d62 6f6f 6c28 7265 7365 7276 6569  ip=bool(reservei
+0000f490: 7029 2c20 7265 7365 7276 6564 6e73 3d62  p), reservedns=b
+0000f4a0: 6f6f 6c28 7265 7365 7276 6564 6e73 292c  ool(reservedns),
+0000f4b0: 2072 6573 6572 7665 686f 7374 3d62 6f6f   reservehost=boo
+0000f4c0: 6c28 7265 7365 7276 6568 6f73 7429 2c0a  l(reservehost),.
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4e0: 2020 2020 2020 2020 2020 7374 6172 743d            start=
+0000f4f0: 626f 6f6c 2873 7461 7274 292c 206b 6579  bool(start), key
+0000f500: 733d 6b65 7973 2c20 636d 6473 3d63 6d64  s=keys, cmds=cmd
+0000f510: 732c 2069 7073 3d69 7073 2c20 6e65 746d  s, ips=ips, netm
+0000f520: 6173 6b73 3d6e 6574 6d61 736b 732c 2067  asks=netmasks, g
+0000f530: 6174 6577 6179 3d67 6174 6577 6179 2c20  ateway=gateway, 
+0000f540: 646e 733d 646e 732c 0a20 2020 2020 2020  dns=dns,.       
+0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f560: 2020 2064 6f6d 6169 6e3d 646f 6d61 696e     domain=domain
+0000f570: 2c20 6e65 7374 6564 3d62 6f6f 6c28 6e65  , nested=bool(ne
+0000f580: 7374 6564 292c 2074 756e 6e65 6c3d 7475  sted), tunnel=tu
+0000f590: 6e6e 656c 2c20 6669 6c65 733d 6669 6c65  nnel, files=file
+0000f5a0: 732c 2065 6e61 626c 6572 6f6f 743d 656e  s, enableroot=en
+0000f5b0: 6162 6c65 726f 6f74 2c0a 2020 2020 2020  ableroot,.      
+0000f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5d0: 2020 2020 6f76 6572 7269 6465 733d 6f76      overrides=ov
+0000f5e0: 6572 7269 6465 732c 2074 6167 733d 7461  errides, tags=ta
+0000f5f0: 6773 2c20 7374 6f72 656d 6574 6164 6174  gs, storemetadat
+0000f600: 613d 7374 6f72 656d 6574 6164 6174 612c  a=storemetadata,
+0000f610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f620: 2020 2020 2020 2020 2020 2073 6861 7265             share
+0000f630: 6466 6f6c 6465 7273 3d73 6861 7265 6466  dfolders=sharedf
+0000f640: 6f6c 6465 7273 2c20 6b65 726e 656c 3d6b  olders, kernel=k
+0000f650: 6572 6e65 6c2c 2069 6e69 7472 643d 696e  ernel, initrd=in
+0000f660: 6974 7264 2c20 636d 646c 696e 653d 636d  itrd, cmdline=cm
+0000f670: 646c 696e 652c 0a20 2020 2020 2020 2020  dline,.         
+0000f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f690: 2070 6c61 6365 6d65 6e74 3d70 6c61 6365   placement=place
+0000f6a0: 6d65 6e74 2c20 6175 746f 7374 6172 743d  ment, autostart=
+0000f6b0: 6175 746f 7374 6172 742c 2063 7075 686f  autostart, cpuho
+0000f6c0: 7470 6c75 673d 6370 7568 6f74 706c 7567  tplug=cpuhotplug
+0000f6d0: 2c20 6d65 6d6f 7279 686f 7470 6c75 673d  , memoryhotplug=
+0000f6e0: 6d65 6d6f 7279 686f 7470 6c75 672c 0a20  memoryhotplug,. 
+0000f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f700: 2020 2020 2020 2020 2070 6369 6465 7669           pcidevi
+0000f710: 6365 733d 7063 6964 6576 6963 6573 2c20  ces=pcidevices, 
+0000f720: 7470 6d3d 7470 6d2c 2072 6e67 3d72 6e67  tpm=tpm, rng=rng
+0000f730: 2c20 6d65 7461 6461 7461 3d6d 6574 6164  , metadata=metad
+0000f740: 6174 612c 2073 6563 7572 6974 7967 726f  ata, securitygro
+0000f750: 7570 733d 7365 6375 7269 7479 6772 6f75  ups=securitygrou
+0000f760: 7073 2c0a 2020 2020 2020 2020 2020 2020  ps,.            
+0000f770: 2020 2020 2020 2020 2020 2020 2020 766d                vm
+0000f780: 7573 6572 3d76 6d75 7365 7229 0a20 2020  user=vmuser).   
+0000f790: 2020 2020 2069 6620 7265 7375 6c74 5b27       if result['
+0000f7a0: 7265 7375 6c74 275d 2021 3d20 2773 7563  result'] != 'suc
+0000f7b0: 6365 7373 273a 0a20 2020 2020 2020 2020  cess':.         
+0000f7c0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+0000f7d0: 0a20 2020 2020 2020 2069 6620 7265 7365  .        if rese
+0000f7e0: 7276 6564 6e73 2061 6e64 2064 6e73 636c  rvedns and dnscl
+0000f7f0: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
+0000f800: 2061 6e64 2064 6f6d 6169 6e20 6973 206e   and domain is n
+0000f810: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000f820: 2020 2020 2069 6620 646e 7363 6c69 656e       if dnsclien
+0000f830: 7420 696e 2073 656c 662e 636c 6965 6e74  t in self.client
+0000f840: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000f850: 2020 207a 203d 204b 636f 6e66 6967 2863     z = Kconfig(c
+0000f860: 6c69 656e 743d 646e 7363 6c69 656e 7429  lient=dnsclient)
+0000f870: 2e6b 0a20 2020 2020 2020 2020 2020 2020  .k.             
+0000f880: 2020 2069 7020 3d20 4e6f 6e65 0a20 2020     ip = None.   
+0000f890: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000f8a0: 6970 2069 7320 4e6f 6e65 3a0a 2020 2020  ip is None:.    
+0000f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8c0: 636f 756e 7465 7220 3d20 300a 2020 2020  counter = 0.    
+0000f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8e0: 7768 696c 6520 636f 756e 7465 7220 213d  while counter !=
+0000f8f0: 2033 3030 3a0a 2020 2020 2020 2020 2020   300:.          
+0000f900: 2020 2020 2020 2020 2020 2020 2020 6970                ip
+0000f910: 203d 206b 2e69 7028 6e61 6d65 290a 2020   = k.ip(name).  
+0000f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f930: 2020 2020 2020 6966 2069 7020 6973 204e        if ip is N
+0000f940: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f960: 2073 6c65 6570 2835 290a 2020 2020 2020   sleep(5).      
+0000f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f980: 2020 2020 2020 7072 696e 7428 2257 6169        print("Wai
+0000f990: 7469 6e67 2035 2073 6563 6f6e 6473 2074  ting 5 seconds t
+0000f9a0: 6f20 6772 6162 2069 7020 616e 6420 6372  o grab ip and cr
+0000f9b0: 6561 7465 2044 4e53 2072 6563 6f72 642e  eate DNS record.
+0000f9c0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+0000f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9e0: 2063 6f75 6e74 6572 202b 3d20 3130 0a20   counter += 10. 
+0000f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa20: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0000fa30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000fa40: 6620 6970 2069 7320 4e6f 6e65 3a0a 2020  f ip is None:.  
+0000fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa60: 2020 6572 726f 7228 2243 6f75 6c64 6e27    error("Couldn'
+0000fa70: 7420 6173 7369 676e 2044 4e53 2229 0a20  t assign DNS"). 
+0000fa80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000fa90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000faa0: 2020 2020 2020 2020 207a 2e72 6573 6572           z.reser
+0000fab0: 7665 5f64 6e73 286e 616d 653d 6e61 6d65  ve_dns(name=name
+0000fac0: 2c20 6e65 7473 3d5b 646f 6d61 696e 5d2c  , nets=[domain],
+0000fad0: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c20   domain=domain, 
+0000fae0: 6970 3d69 702c 2066 6f72 6365 3d54 7275  ip=ip, force=Tru
+0000faf0: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+0000fb00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000fb10: 2020 2020 2077 6172 6e69 6e67 2866 2243       warning(f"C
+0000fb20: 6c69 656e 7420 7b64 6e73 636c 6965 6e74  lient {dnsclient
+0000fb30: 7d20 6e6f 7420 666f 756e 642e 2053 6b69  } not found. Ski
+0000fb40: 7070 696e 6722 290a 2020 2020 2020 2020  pping").        
+0000fb50: 6966 206f 732e 6163 6365 7373 286f 732e  if os.access(os.
+0000fb60: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
+0000fb70: 277e 2f2e 6b63 6c69 2729 2c20 6f73 2e57  '~/.kcli'), os.W
+0000fb80: 5f4f 4b29 3a0a 2020 2020 2020 2020 2020  _OK):.          
+0000fb90: 2020 636c 6965 6e74 203d 2063 6c69 656e    client = clien
+0000fba0: 7420 6966 2063 6c69 656e 7420 6973 206e  t if client is n
+0000fbb0: 6f74 204e 6f6e 6520 656c 7365 2073 656c  ot None else sel
+0000fbc0: 662e 636c 6965 6e74 0a20 2020 2020 2020  f.client.       
+0000fbd0: 2020 2020 2063 6f6d 6d6f 6e2e 7365 745f       common.set_
+0000fbe0: 6c61 7374 766d 286e 616d 652c 2063 6c69  lastvm(name, cli
+0000fbf0: 656e 7429 0a20 2020 2020 2020 2061 6e73  ent).        ans
+0000fc00: 6962 6c65 7072 6f66 696c 6520 3d20 7072  ibleprofile = pr
+0000fc10: 6f66 696c 652e 6765 7428 2761 6e73 6962  ofile.get('ansib
+0000fc20: 6c65 2729 0a20 2020 2020 2020 2069 6620  le').        if 
+0000fc30: 616e 7369 626c 6570 726f 6669 6c65 2069  ansibleprofile i
+0000fc40: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000fc50: 2020 2020 2020 2020 6966 2077 6869 6368          if which
+0000fc60: 2827 616e 7369 626c 652d 706c 6179 626f  ('ansible-playbo
+0000fc70: 6f6b 2729 2069 7320 4e6f 6e65 3a0a 2020  ok') is None:.  
+0000fc80: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0000fc90: 726e 696e 6728 2261 6e73 6962 6c65 2d70  rning("ansible-p
+0000fca0: 6c61 7962 6f6f 6b20 6578 6563 7574 6162  laybook executab
+0000fcb0: 6c65 206e 6f74 2066 6f75 6e64 2e20 536b  le not found. Sk
+0000fcc0: 6970 7069 6e67 2061 6e73 6962 6c65 2070  ipping ansible p
+0000fcd0: 6c61 7922 290a 2020 2020 2020 2020 2020  lay").          
+0000fce0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000fcf0: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
+0000fd00: 656e 7420 696e 2061 6e73 6962 6c65 7072  ent in ansiblepr
+0000fd10: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
+0000fd20: 2020 2020 2020 2020 2020 2069 6620 2770             if 'p
+0000fd30: 6c61 7962 6f6f 6b27 206e 6f74 2069 6e20  laybook' not in 
+0000fd40: 656c 656d 656e 743a 0a20 2020 2020 2020  element:.       
+0000fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd60: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+0000fd70: 2020 2020 2020 2020 2020 2020 2020 706c                pl
+0000fd80: 6179 626f 6f6b 203d 2065 6c65 6d65 6e74  aybook = element
+0000fd90: 5b27 706c 6179 626f 6f6b 275d 0a20 2020  ['playbook'].   
+0000fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdb0: 2076 6172 6961 626c 6573 203d 2065 6c65   variables = ele
+0000fdc0: 6d65 6e74 2e67 6574 2827 7661 7269 6162  ment.get('variab
+0000fdd0: 6c65 7327 2c20 7b7d 290a 2020 2020 2020  les', {}).      
+0000fde0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+0000fdf0: 7262 6f73 6520 3d20 656c 656d 656e 742e  rbose = element.
+0000fe00: 6765 7428 2776 6572 626f 7365 272c 2046  get('verbose', F
+0000fe10: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+0000fe20: 2020 2020 2020 2020 2020 7573 6572 203d            user =
+0000fe30: 2065 6c65 6d65 6e74 2e67 6574 2827 7573   element.get('us
+0000fe40: 6572 2729 0a20 2020 2020 2020 2020 2020  er').           
+0000fe50: 2020 2020 2020 2020 2061 6e73 6962 6c65           ansible
+0000fe60: 7574 696c 732e 706c 6179 286b 2c20 6e61  utils.play(k, na
+0000fe70: 6d65 2c20 706c 6179 626f 6f6b 3d70 6c61  me, playbook=pla
+0000fe80: 7962 6f6f 6b2c 2076 6172 6961 626c 6573  ybook, variables
+0000fe90: 3d76 6172 6961 626c 6573 2c20 7665 7262  =variables, verb
+0000fea0: 6f73 653d 7665 7262 6f73 652c 2075 7365  ose=verbose, use
+0000feb0: 723d 7573 6572 2c0a 2020 2020 2020 2020  r=user,.        
+0000fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fed0: 2020 2020 2020 2020 2020 2020 2020 7475                tu
+0000fee0: 6e6e 656c 3d73 656c 662e 7475 6e6e 656c  nnel=self.tunnel
+0000fef0: 2c20 7475 6e6e 656c 686f 7374 3d73 656c  , tunnelhost=sel
+0000ff00: 662e 686f 7374 2c20 7475 6e6e 656c 706f  f.host, tunnelpo
+0000ff10: 7274 3d73 656c 662e 706f 7274 2c0a 2020  rt=self.port,.  
+0000ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff40: 2020 2020 7475 6e6e 656c 7573 6572 3d73      tunneluser=s
+0000ff50: 656c 662e 7573 6572 2c20 7961 6d6c 696e  elf.user, yamlin
+0000ff60: 7665 6e74 6f72 793d 7961 6d6c 696e 7665  ventory=yamlinve
+0000ff70: 6e74 6f72 792c 2069 6e73 6563 7572 653d  ntory, insecure=
+0000ff80: 7365 6c66 2e69 6e73 6563 7572 6529 0a20  self.insecure). 
+0000ff90: 2020 2020 2020 2075 6e70 6c75 6763 6420         unplugcd 
+0000ffa0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+0000ffb0: 2775 6e70 6c75 6763 6427 2c20 4661 6c73  'unplugcd', Fals
+0000ffc0: 6529 0a20 2020 2020 2020 2069 6620 7761  e).        if wa
+0000ffd0: 6974 206f 7220 756e 706c 7567 6364 3a0a  it or unplugcd:.
+0000ffe0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000fff0: 6f74 2063 6c6f 7564 696e 6974 206f 7220  ot cloudinit or 
+00010000: 6e6f 7420 7374 6172 7420 6f72 2069 6d61  not start or ima
+00010010: 6765 2069 7320 4e6f 6e65 3a0a 2020 2020  ge is None:.    
+00010020: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00010030: 6e74 2866 2253 6b69 7070 696e 6720 7761  nt(f"Skipping wa
+00010040: 6974 206f 6e20 7b6e 616d 657d 2229 0a20  it on {name}"). 
+00010050: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00010060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010070: 2069 6465 6e74 6974 7966 696c 6520 3d20   identityfile = 
+00010080: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00010090: 2020 2020 2074 656d 706b 6579 5f63 6c65       tempkey_cle
+000100a0: 616e 203d 2046 616c 7365 0a20 2020 2020  an = False.     
+000100b0: 2020 2020 2020 2020 2020 2069 6620 6f76             if ov
+000100c0: 6572 7269 6465 732e 6765 7428 2774 656d  errides.get('tem
+000100d0: 706b 6579 6469 7227 2920 6973 206e 6f74  pkeydir') is not
+000100e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000100f0: 2020 2020 2020 2020 2020 2069 6465 6e74             ident
+00010100: 6974 7966 696c 6520 3d20 6622 7b6f 7665  ityfile = f"{ove
+00010110: 7272 6964 6573 5b27 7465 6d70 6b65 7964  rrides['tempkeyd
+00010120: 6972 275d 2e6e 616d 657d 2f69 645f 7273  ir'].name}/id_rs
+00010130: 6122 0a20 2020 2020 2020 2020 2020 2020  a".             
+00010140: 2020 2020 2020 2074 656d 706b 6579 5f63         tempkey_c
+00010150: 6c65 616e 203d 2054 7275 650a 2020 2020  lean = True.    
+00010160: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010170: 2e77 6169 745f 6669 6e69 7368 286e 616d  .wait_finish(nam
+00010180: 652c 2069 6d61 6765 3d69 6d61 6765 2c20  e, image=image, 
+00010190: 7761 6974 636f 6d6d 616e 643d 7761 6974  waitcommand=wait
+000101a0: 636f 6d6d 616e 642c 2077 6169 7474 696d  command, waittim
+000101b0: 656f 7574 3d77 6169 7474 696d 656f 7574  eout=waittimeout
+000101c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101e0: 2020 2069 6465 6e74 6974 7966 696c 653d     identityfile=
+000101f0: 6964 656e 7469 7479 6669 6c65 2c20 766d  identityfile, vm
+00010200: 636c 6965 6e74 3d63 6c69 656e 7429 0a20  client=client). 
+00010210: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010220: 696e 6973 6866 696c 6573 203d 2070 726f  inishfiles = pro
+00010230: 6669 6c65 2e67 6574 2827 6669 6e69 7368  file.get('finish
+00010240: 6669 6c65 7327 2c20 5b5d 290a 2020 2020  files', []).    
+00010250: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00010260: 696e 6973 6866 696c 6573 3a0a 2020 2020  inishfiles:.    
+00010270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010280: 7365 6c66 2e68 616e 646c 655f 6669 6e69  self.handle_fini
+00010290: 7368 6669 6c65 7328 6e61 6d65 2c20 6669  shfiles(name, fi
+000102a0: 6e69 7368 6669 6c65 732c 2069 6465 6e74  nishfiles, ident
+000102b0: 6974 7966 696c 653d 6964 656e 7469 7479  ityfile=identity
+000102c0: 6669 6c65 2c20 766d 636c 6965 6e74 3d63  file, vmclient=c
+000102d0: 6c69 656e 7429 0a20 2020 2020 2020 2020  lient).         
+000102e0: 2020 2020 2020 2069 6620 7465 6d70 6b65         if tempke
+000102f0: 795f 636c 6561 6e3a 0a20 2020 2020 2020  y_clean:.       
+00010300: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00010310: 662e 636c 6561 6e5f 7465 6d70 6b65 7928  f.clean_tempkey(
+00010320: 6e61 6d65 2c20 6964 656e 7469 7479 6669  name, identityfi
+00010330: 6c65 3d69 6465 6e74 6974 7966 696c 6529  le=identityfile)
+00010340: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00010350: 756e 706c 7567 6364 3a0a 2020 2020 2020  unplugcd:.      
+00010360: 2020 2020 2020 2020 2020 7365 6c66 2e6b            self.k
+00010370: 2e75 7064 6174 655f 6973 6f28 6e61 6d65  .update_iso(name
+00010380: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+00010390: 6966 206f 7665 7272 6964 6573 2e67 6574  if overrides.get
+000103a0: 2827 7465 6d70 6b65 7964 6972 2729 2069  ('tempkeydir') i
+000103b0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206e  s not None and n
+000103c0: 6f74 206f 7665 7272 6964 6573 2e67 6574  ot overrides.get
+000103d0: 2827 7465 6d70 6b65 7964 6972 6b65 6570  ('tempkeydirkeep
+000103e0: 272c 2046 616c 7365 293a 0a20 2020 2020  ', False):.     
+000103f0: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
+00010400: 2e67 6574 2827 7465 6d70 6b65 7964 6972  .get('tempkeydir
+00010410: 2729 2e63 6c65 616e 7570 2829 0a20 2020  ').cleanup().   
+00010420: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00010430: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
+00010440: 2c20 2776 6d27 3a20 6e61 6d65 7d0a 0a20  , 'vm': name}.. 
+00010450: 2020 2064 6566 2075 7064 6174 655f 766d     def update_vm
+00010460: 2873 656c 662c 206e 616d 652c 206f 7665  (self, name, ove
+00010470: 7272 6964 6573 293a 0a20 2020 2020 2020  rrides):.       
+00010480: 206b 203d 2073 656c 662e 6b0a 2020 2020   k = self.k.    
+00010490: 2020 2020 6970 203d 206f 7665 7272 6964      ip = overrid
+000104a0: 6573 2e67 6574 2827 6970 2729 0a20 2020  es.get('ip').   
+000104b0: 2020 2020 2066 6c61 766f 7220 3d20 6f76       flavor = ov
+000104c0: 6572 7269 6465 732e 6765 7428 2766 6c61  errides.get('fla
+000104d0: 766f 7227 290a 2020 2020 2020 2020 6e75  vor').        nu
+000104e0: 6d63 7075 7320 3d20 6f76 6572 7269 6465  mcpus = override
+000104f0: 732e 6765 7428 276e 756d 6370 7573 2729  s.get('numcpus')
+00010500: 0a20 2020 2020 2020 206d 656d 6f72 7920  .        memory 
+00010510: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+00010520: 276d 656d 6f72 7927 290a 2020 2020 2020  'memory').      
+00010530: 2020 6175 746f 7374 6172 7420 3d20 6f76    autostart = ov
+00010540: 6572 7269 6465 732e 6765 7428 2761 7574  errides.get('aut
+00010550: 6f73 7461 7274 2729 0a20 2020 2020 2020  ostart').       
+00010560: 2064 6e73 203d 206f 7665 7272 6964 6573   dns = overrides
+00010570: 2e67 6574 2827 646e 7327 290a 2020 2020  .get('dns').    
+00010580: 2020 2020 686f 7374 203d 206f 7665 7272      host = overr
+00010590: 6964 6573 2e67 6574 2827 686f 7374 2729  ides.get('host')
+000105a0: 0a20 2020 2020 2020 2064 6f6d 6169 6e20  .        domain 
+000105b0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+000105c0: 2764 6f6d 6169 6e27 290a 2020 2020 2020  'domain').      
+000105d0: 2020 636c 6f75 6469 6e69 7420 3d20 6f76    cloudinit = ov
+000105e0: 6572 7269 6465 732e 6765 7428 2763 6c6f  errides.get('clo
+000105f0: 7564 696e 6974 2729 0a20 2020 2020 2020  udinit').       
+00010600: 2069 6d61 6765 203d 206f 7665 7272 6964   image = overrid
+00010610: 6573 2e67 6574 2827 696d 6167 6527 290a  es.get('image').
+00010620: 2020 2020 2020 2020 6e65 7473 203d 206f          nets = o
+00010630: 7665 7272 6964 6573 2e67 6574 2827 6e65  verrides.get('ne
+00010640: 7473 2729 0a20 2020 2020 2020 2064 6973  ts').        dis
+00010650: 6b73 203d 206f 7665 7272 6964 6573 2e67  ks = overrides.g
+00010660: 6574 2827 6469 736b 7327 290a 2020 2020  et('disks').    
+00010670: 2020 2020 696e 666f 726d 6174 696f 6e20      information 
+00010680: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+00010690: 2769 6e66 6f72 6d61 7469 6f6e 2729 0a20  'information'). 
+000106a0: 2020 2020 2020 2063 7075 666c 6167 7320         cpuflags 
+000106b0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+000106c0: 2763 7075 666c 6167 7327 2c20 5b5d 290a  'cpuflags', []).
+000106d0: 2020 2020 2020 2020 6469 7361 626c 6520          disable 
+000106e0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+000106f0: 2764 6973 6162 6c65 272c 2046 616c 7365  'disable', False
+00010700: 290a 2020 2020 2020 2020 6f76 6572 7269  ).        overri
+00010710: 6465 732e 706f 7028 2764 6973 6162 6c65  des.pop('disable
+00010720: 272c 204e 6f6e 6529 0a20 2020 2020 2020  ', None).       
+00010730: 2065 7874 7261 5f6d 6574 6164 6174 6120   extra_metadata 
+00010740: 3d20 7b6b 3a20 6f76 6572 7269 6465 735b  = {k: overrides[
+00010750: 6b5d 2066 6f72 206b 2069 6e20 6f76 6572  k] for k in over
+00010760: 7269 6465 7320 6966 206b 206e 6f74 2069  rides if k not i
+00010770: 6e20 7365 6c66 2e6c 6973 745f 6b65 7977  n self.list_keyw
+00010780: 6f72 6473 2829 7d0a 2020 2020 2020 2020  ords()}.        
+00010790: 7465 6d70 6c61 7465 203d 206f 7665 7272  template = overr
+000107a0: 6964 6573 2e67 6574 2827 7465 6d70 6c61  ides.get('templa
+000107b0: 7465 2729 0a20 2020 2020 2020 2069 6620  te').        if 
+000107c0: 7465 6d70 6c61 7465 2069 7320 6e6f 7420  template is not 
+000107d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000107e0: 2020 6465 6c20 6578 7472 615f 6d65 7461    del extra_meta
+000107f0: 6461 7461 5b27 7465 6d70 6c61 7465 275d  data['template']
+00010800: 0a20 2020 2020 2020 2069 6620 646e 733a  .        if dns:
+00010810: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+00010820: 696e 7428 6622 4372 6561 7469 6e67 2044  int(f"Creating D
+00010830: 6e73 2065 6e74 7279 2066 6f72 207b 6e61  ns entry for {na
+00010840: 6d65 7d2e 2e2e 2229 0a20 2020 2020 2020  me}...").       
+00010850: 2020 2020 206e 6574 776f 726b 7320 3d20       networks = 
+00010860: 6b2e 766d 5f70 6f72 7473 286e 616d 6529  k.vm_ports(name)
+00010870: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00010880: 6e65 7477 6f72 6b73 2061 6e64 2064 6f6d  networks and dom
+00010890: 6169 6e20 6973 204e 6f6e 653a 0a20 2020  ain is None:.   
+000108a0: 2020 2020 2020 2020 2020 2020 2064 6f6d               dom
+000108b0: 6169 6e20 3d20 6e65 7477 6f72 6b73 5b30  ain = networks[0
+000108c0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+000108d0: 206e 6f74 206e 6574 733a 0a20 2020 2020   not nets:.     
+000108e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000108f0: 6e0a 2020 2020 2020 2020 2020 2020 656c  n.            el
+00010900: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00010910: 2020 2020 6b2e 7265 7365 7276 655f 646e      k.reserve_dn
+00010920: 7328 6e61 6d65 3d6e 616d 652c 206e 6574  s(name=name, net
+00010930: 733d 6e65 7477 6f72 6b73 2c20 646f 6d61  s=networks, doma
+00010940: 696e 3d64 6f6d 6169 6e2c 2069 703d 6970  in=domain, ip=ip
+00010950: 290a 2020 2020 2020 2020 6966 2069 7020  ).        if ip 
+00010960: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00010970: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00010980: 6622 5570 6461 7469 6e67 2069 7020 6f66  f"Updating ip of
+00010990: 2076 6d20 7b6e 616d 657d 2074 6f20 7b69   vm {name} to {i
+000109a0: 707d 2e2e 2e22 290a 2020 2020 2020 2020  p}...").        
+000109b0: 2020 2020 6b2e 7570 6461 7465 5f6d 6574      k.update_met
+000109c0: 6164 6174 6128 6e61 6d65 2c20 2769 7027  adata(name, 'ip'
+000109d0: 2c20 6970 290a 2020 2020 2020 2020 6966  , ip).        if
+000109e0: 2063 6c6f 7564 696e 6974 3a0a 2020 2020   cloudinit:.    
+000109f0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00010a00: 2252 656d 6f76 696e 6720 636c 6f75 6469  "Removing cloudi
+00010a10: 6e69 7420 696e 666f 726d 6174 696f 6e20  nit information 
+00010a20: 6f66 2076 6d20 7b6e 616d 657d 2229 0a20  of vm {name}"). 
+00010a30: 2020 2020 2020 2020 2020 206b 2e72 656d             k.rem
+00010a40: 6f76 655f 636c 6f75 6469 6e69 7428 6e61  ove_cloudinit(na
+00010a50: 6d65 290a 2020 2020 2020 2020 6966 2069  me).        if i
+00010a60: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
+00010a70: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
+00010a80: 7269 6e74 2866 2255 7064 6174 696e 6720  rint(f"Updating 
+00010a90: 696d 6167 6520 6f66 2076 6d20 7b6e 616d  image of vm {nam
+00010aa0: 657d 2074 6f20 7b69 6d61 6765 7d2e 2e2e  e} to {image}...
+00010ab0: 2229 0a20 2020 2020 2020 2020 2020 206b  ").            k
+00010ac0: 2e75 7064 6174 655f 6d65 7461 6461 7461  .update_metadata
+00010ad0: 286e 616d 652c 2027 696d 6167 6527 2c20  (name, 'image', 
+00010ae0: 696d 6167 6529 0a20 2020 2020 2020 2069  image).        i
+00010af0: 6620 6d65 6d6f 7279 2069 7320 6e6f 7420  f memory is not 
+00010b00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00010b10: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
+00010b20: 696e 6720 6d65 6d6f 7279 206f 6620 766d  ing memory of vm
+00010b30: 207b 6e61 6d65 7d20 746f 207b 6d65 6d6f   {name} to {memo
+00010b40: 7279 7d2e 2e2e 2229 0a20 2020 2020 2020  ry}...").       
+00010b50: 2020 2020 206b 2e75 7064 6174 655f 6d65       k.update_me
+00010b60: 6d6f 7279 286e 616d 652c 206d 656d 6f72  mory(name, memor
+00010b70: 7929 0a20 2020 2020 2020 2069 6620 6e75  y).        if nu
+00010b80: 6d63 7075 7320 6973 206e 6f74 204e 6f6e  mcpus is not Non
+00010b90: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00010ba0: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
+00010bb0: 206e 756d 6370 7573 206f 6620 766d 207b   numcpus of vm {
+00010bc0: 6e61 6d65 7d20 746f 207b 6e75 6d63 7075  name} to {numcpu
+00010bd0: 737d 2e2e 2e22 290a 2020 2020 2020 2020  s}...").        
+00010be0: 2020 2020 6b2e 7570 6461 7465 5f63 7075      k.update_cpu
+00010bf0: 7328 6e61 6d65 2c20 6e75 6d63 7075 7329  s(name, numcpus)
+00010c00: 0a20 2020 2020 2020 2069 6620 6175 746f  .        if auto
+00010c10: 7374 6172 7420 6973 206e 6f74 204e 6f6e  start is not Non
+00010c20: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00010c30: 7072 696e 7428 6622 5365 7474 696e 6720  print(f"Setting 
+00010c40: 6175 746f 7374 6172 7420 746f 207b 6175  autostart to {au
+00010c50: 746f 7374 6172 747d 2066 6f72 2076 6d20  tostart} for vm 
+00010c60: 7b6e 616d 657d 2e2e 2e22 290a 2020 2020  {name}...").    
+00010c70: 2020 2020 2020 2020 6b2e 7570 6461 7465          k.update
+00010c80: 5f73 7461 7274 286e 616d 652c 2073 7461  _start(name, sta
+00010c90: 7274 3d61 7574 6f73 7461 7274 290a 2020  rt=autostart).  
+00010ca0: 2020 2020 2020 6966 2069 6e66 6f72 6d61        if informa
+00010cb0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+00010cc0: 2020 7070 7269 6e74 2866 2253 6574 7469    pprint(f"Setti
+00010cd0: 6e67 2069 6e66 6f72 6d61 7469 6f6e 2066  ng information f
+00010ce0: 6f72 2076 6d20 7b6e 616d 657d 2e2e 2e22  or vm {name}..."
+00010cf0: 290a 2020 2020 2020 2020 2020 2020 6b2e  ).            k.
+00010d00: 7570 6461 7465 5f69 6e66 6f72 6d61 7469  update_informati
+00010d10: 6f6e 286e 616d 652c 2069 6e66 6f72 6d61  on(name, informa
+00010d20: 7469 6f6e 290a 2020 2020 2020 2020 6966  tion).        if
+00010d30: 2027 6973 6f27 2069 6e20 6f76 6572 7269   'iso' in overri
+00010d40: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
+00010d50: 2069 736f 203d 206f 7665 7272 6964 6573   iso = overrides
+00010d60: 5b27 6973 6f27 5d0a 2020 2020 2020 2020  ['iso'].        
+00010d70: 2020 2020 7070 7269 6e74 2866 2253 7769      pprint(f"Swi
+00010d80: 7463 6869 6e67 2069 736f 2066 6f72 2076  tching iso for v
+00010d90: 6d20 7b6e 616d 657d 2074 6f20 7b69 736f  m {name} to {iso
+00010da0: 7d2e 2e2e 2229 0a20 2020 2020 2020 2020  }...").         
+00010db0: 2020 2069 6620 6973 6f20 3d3d 2027 4e6f     if iso == 'No
+00010dc0: 6e65 2720 6f72 2069 736f 203d 3d20 2727  ne' or iso == ''
+00010dd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010de0: 2020 6973 6f20 3d20 4e6f 6e65 0a20 2020    iso = None.   
+00010df0: 2020 2020 2020 2020 206b 2e75 7064 6174           k.updat
+00010e00: 655f 6973 6f28 6e61 6d65 2c20 6973 6f29  e_iso(name, iso)
+00010e10: 0a20 2020 2020 2020 2069 6620 666c 6176  .        if flav
+00010e20: 6f72 2069 7320 6e6f 7420 4e6f 6e65 3a0a  or is not None:.
+00010e30: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00010e40: 6e74 2866 2255 7064 6174 696e 6720 666c  nt(f"Updating fl
+00010e50: 6176 6f72 206f 6620 766d 207b 6e61 6d65  avor of vm {name
+00010e60: 7d20 746f 207b 666c 6176 6f72 7d2e 2e2e  } to {flavor}...
+00010e70: 2229 0a20 2020 2020 2020 2020 2020 206b  ").            k
+00010e80: 2e75 7064 6174 655f 666c 6176 6f72 286e  .update_flavor(n
+00010e90: 616d 652c 2066 6c61 766f 7229 0a20 2020  ame, flavor).   
+00010ea0: 2020 2020 2069 6620 686f 7374 3a0a 2020       if host:.  
+00010eb0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00010ec0: 2866 2243 7265 6174 696e 6720 486f 7374  (f"Creating Host
+00010ed0: 2065 6e74 7279 2066 6f72 2076 6d20 7b6e   entry for vm {n
+00010ee0: 616d 657d 2e2e 2e22 290a 2020 2020 2020  ame}...").      
+00010ef0: 2020 2020 2020 6e65 7477 6f72 6b73 203d        networks =
+00010f00: 206b 2e76 6d5f 706f 7274 7328 6e61 6d65   k.vm_ports(name
+00010f10: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00010f20: 206e 6574 776f 726b 733a 0a20 2020 2020   networks:.     
+00010f30: 2020 2020 2020 2020 2020 2069 6620 646f             if do
+00010f40: 6d61 696e 2069 7320 4e6f 6e65 3a0a 2020  main is None:.  
+00010f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f60: 2020 646f 6d61 696e 203d 206e 6574 776f    domain = netwo
+00010f70: 726b 735b 305d 0a20 2020 2020 2020 2020  rks[0].         
+00010f80: 2020 2020 2020 206b 2e72 6573 6572 7665         k.reserve
+00010f90: 5f68 6f73 7428 6e61 6d65 2c20 6e65 7477  _host(name, netw
+00010fa0: 6f72 6b73 2c20 646f 6d61 696e 290a 2020  orks, domain).  
+00010fb0: 2020 2020 2020 6375 7272 656e 7476 6d20        currentvm 
+00010fc0: 3d20 6b2e 696e 666f 286e 616d 6529 0a20  = k.info(name). 
+00010fd0: 2020 2020 2020 2063 7572 7265 6e74 6e65         currentne
+00010fe0: 7473 203d 2063 7572 7265 6e74 766d 2e67  ts = currentvm.g
+00010ff0: 6574 2827 6e65 7473 272c 205b 5d29 0a20  et('nets', []). 
+00011000: 2020 2020 2020 2063 7572 7265 6e74 6469         currentdi
+00011010: 736b 7320 3d20 6375 7272 656e 7476 6d2e  sks = currentvm.
+00011020: 6765 7428 2764 6973 6b73 272c 205b 5d29  get('disks', [])
+00011030: 0a20 2020 2020 2020 2069 6620 6469 736b  .        if disk
+00011040: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+00011050: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
+00011060: 2064 6973 6b73 206f 6620 766d 207b 6e61   disks of vm {na
+00011070: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+00011080: 2020 666f 7220 696e 6465 782c 2063 7572    for index, cur
+00011090: 7265 6e74 6469 736b 2069 6e20 656e 756d  rentdisk in enum
+000110a0: 6572 6174 6528 6375 7272 656e 7464 6973  erate(currentdis
+000110b0: 6b73 293a 0a20 2020 2020 2020 2020 2020  ks):.           
+000110c0: 2020 2020 2069 6620 696e 6465 7820 3c20       if index < 
+000110d0: 6c65 6e28 6469 736b 7329 3a0a 2020 2020  len(disks):.    
+000110e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110f0: 6469 736b 203d 2064 6973 6b73 5b69 6e64  disk = disks[ind
+00011100: 6578 5d0a 2020 2020 2020 2020 2020 2020  ex].            
+00011110: 2020 2020 2020 2020 6375 7272 656e 7464          currentd
+00011120: 6973 6b73 697a 6520 3d20 6375 7272 656e  isksize = curren
+00011130: 7464 6973 6b5b 2773 697a 6527 5d0a 2020  tdisk['size'].  
+00011140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011150: 2020 6469 736b 7369 7a65 203d 2064 6973    disksize = dis
+00011160: 6b2e 6765 7428 2773 697a 6527 2c20 3130  k.get('size', 10
+00011170: 2920 6966 2069 7369 6e73 7461 6e63 6528  ) if isinstance(
+00011180: 6469 736b 2c20 6469 6374 2920 656c 7365  disk, dict) else
+00011190: 2069 6e74 2864 6973 6b29 0a20 2020 2020   int(disk).     
+000111a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000111b0: 6620 6469 736b 7369 7a65 203e 2063 7572  f disksize > cur
+000111c0: 7265 6e74 6469 736b 7369 7a65 3a0a 2020  rentdisksize:.  
+000111d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111e0: 2020 2020 2020 6966 2063 7572 7265 6e74        if current
+000111f0: 766d 2e67 6574 2827 7374 6174 7573 2729  vm.get('status')
+00011200: 2021 3d20 2764 6f77 6e27 3a0a 2020 2020   != 'down':.    
+00011210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011220: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00011230: 6622 4361 6e74 2072 6573 697a 6520 4469  f"Cant resize Di
+00011240: 736b 207b 696e 6465 787d 2069 6e20 7b6e  sk {index} in {n
+00011250: 616d 657d 2077 6869 6c65 2056 4d20 6973  ame} while VM is
+00011260: 2075 7022 290a 2020 2020 2020 2020 2020   up").          
+00011270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011280: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
 00011290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112a0: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
-000112b0: 6e67 206e 6963 207b 696e 6465 787d 2074  ng nic {index} t
-000112c0: 6f20 6e65 7477 6f72 6b20 7b74 6172 6765  o network {targe
-000112d0: 746e 6574 6e61 6d65 7d22 290a 2020 2020  tnetname}").    
-000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112f0: 6b2e 7570 6461 7465 5f6e 6963 286e 616d  k.update_nic(nam
-00011300: 652c 2069 6e64 6578 2c20 7461 7267 6574  e, index, target
-00011310: 6e65 746e 616d 6529 0a20 2020 2020 2020  netname).       
-00011320: 2069 6620 6578 7472 615f 6d65 7461 6461   if extra_metada
-00011330: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-00011340: 666f 7220 6b65 7920 696e 2065 7874 7261  for key in extra
-00011350: 5f6d 6574 6164 6174 613a 0a20 2020 2020  _metadata:.     
-00011360: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00011370: 203d 2065 7874 7261 5f6d 6574 6164 6174   = extra_metadat
-00011380: 615b 6b65 795d 0a20 2020 2020 2020 2020  a[key].         
-00011390: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-000113a0: 5570 6461 7469 6e67 207b 6b65 797d 206f  Updating {key} o
-000113b0: 6620 766d 207b 6e61 6d65 7d20 746f 207b  f vm {name} to {
-000113c0: 7661 6c75 657d 2e2e 2e22 290a 2020 2020  value}...").    
-000113d0: 2020 2020 2020 2020 2020 2020 6b2e 7570              k.up
-000113e0: 6461 7465 5f6d 6574 6164 6174 6128 6e61  date_metadata(na
-000113f0: 6d65 2c20 6b65 792c 2076 616c 7565 290a  me, key, value).
-00011400: 2020 2020 2020 2020 6966 206f 7665 7272          if overr
-00011410: 6964 6573 2e67 6574 2827 6669 6c65 7327  ides.get('files'
-00011420: 2c20 5b5d 293a 0a20 2020 2020 2020 2020  , []):.         
-00011430: 2020 2069 6620 6f76 6572 7269 6465 732e     if overrides.
-00011440: 6765 7428 2773 6b69 705f 6669 6c65 735f  get('skip_files_
-00011450: 7265 6d65 6469 6174 696f 6e27 2c20 4661  remediation', Fa
-00011460: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
-00011470: 2020 2020 2020 7070 7269 6e74 2866 2253        pprint(f"S
-00011480: 6b69 7070 696e 6720 5265 6d65 6469 6174  kipping Remediat
-00011490: 696f 6e20 6669 6c65 7320 6f66 207b 6e61  ion files of {na
-000114a0: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-000114b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000114c0: 2020 2020 2020 2020 6e65 7766 696c 6573          newfiles
-000114d0: 203d 206f 7665 7272 6964 6573 5b27 6669   = overrides['fi
-000114e0: 6c65 7327 5d0a 2020 2020 2020 2020 2020  les'].          
-000114f0: 2020 2020 2020 7070 7269 6e74 2866 2252        pprint(f"R
-00011500: 656d 6564 6961 7469 6e67 2066 696c 6573  emediating files
-00011510: 206f 6620 7b6e 616d 657d 2229 0a20 2020   of {name}").   
-00011520: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00011530: 662e 7265 6d65 6469 6174 655f 6669 6c65  f.remediate_file
-00011540: 7328 6e61 6d65 2c20 6e65 7766 696c 6573  s(name, newfiles
-00011550: 2c20 6f76 6572 7269 6465 7329 0a20 2020  , overrides).   
-00011560: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
-00011570: 6520 3d3d 2027 6b76 6d27 3a0a 2020 2020  e == 'kvm':.    
-00011580: 2020 2020 2020 2020 706f 6f6c 203d 206f          pool = o
-00011590: 7665 7272 6964 6573 2e67 6574 2827 706f  verrides.get('po
-000115a0: 6f6c 2729 0a20 2020 2020 2020 2020 2020  ol').           
-000115b0: 2069 6620 706f 6f6c 2069 7320 6e6f 7420   if pool is not 
-000115c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000115d0: 2020 2020 2020 6b2e 7570 6461 7465 5f70        k.update_p
-000115e0: 6f6f 6c28 6e61 6d65 2c20 706f 6f6c 290a  ool(name, pool).
-000115f0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00011600: 7075 666c 6167 733a 0a20 2020 2020 2020  puflags:.       
-00011610: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00011620: 6622 5570 6461 7469 6e67 2063 7075 666c  f"Updating cpufl
-00011630: 6167 7320 6f66 2076 6d20 7b6e 616d 657d  ags of vm {name}
-00011640: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00011650: 2020 206b 2e75 7064 6174 655f 6370 7566     k.update_cpuf
-00011660: 6c61 6773 286e 616d 652c 2063 7075 666c  lags(name, cpufl
-00011670: 6167 732c 2064 6973 6162 6c65 290a 2020  ags, disable).  
-00011680: 2020 2020 2020 6966 2073 656c 662e 7479        if self.ty
-00011690: 7065 203d 3d20 2776 7370 6865 7265 2720  pe == 'vsphere' 
-000116a0: 616e 6420 7465 6d70 6c61 7465 2069 7320  and template is 
-000116b0: 6e6f 7420 4e6f 6e65 2061 6e64 2069 7369  not None and isi
-000116c0: 6e73 7461 6e63 6528 7465 6d70 6c61 7465  nstance(template
-000116d0: 2c20 626f 6f6c 293a 0a20 2020 2020 2020  , bool):.       
-000116e0: 2020 2020 2074 6172 6765 7420 3d20 2774       target = 't
-000116f0: 656d 706c 6174 6527 2069 6620 7465 6d70  emplate' if temp
-00011700: 6c61 7465 2065 6c73 6520 2776 6d27 0a20  late else 'vm'. 
-00011710: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00011720: 7428 6622 5570 6461 7469 6e67 2076 6d20  t(f"Updating vm 
-00011730: 7b6e 616d 657d 2074 6f20 7b74 6172 6765  {name} to {targe
-00011740: 747d 2e2e 2e22 290a 2020 2020 2020 2020  t}...").        
-00011750: 2020 2020 6966 2074 656d 706c 6174 653a      if template:
-00011760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011770: 206b 2e63 6f6e 7665 7274 5f74 6f5f 7465   k.convert_to_te
-00011780: 6d70 6c61 7465 286e 616d 6529 0a20 2020  mplate(name).   
-00011790: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000117a0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-000117b0: 2e63 6f6e 7665 7274 5f74 6f5f 766d 286e  .convert_to_vm(n
-000117c0: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
-000117d0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-000117e0: 7375 6363 6573 7327 7d0a 0a20 2020 2064  success'}..    d
-000117f0: 6566 206c 6973 745f 706c 616e 7328 7365  ef list_plans(se
-00011800: 6c66 293a 0a20 2020 2020 2020 206b 203d  lf):.        k =
-00011810: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
-00011820: 7265 7375 6c74 7320 3d20 5b5d 0a20 2020  results = [].   
-00011830: 2020 2020 2070 6c61 6e73 203d 207b 7d0a       plans = {}.
-00011840: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
-00011850: 6e20 6b2e 6c69 7374 2829 3a0a 2020 2020  n k.list():.    
-00011860: 2020 2020 2020 2020 766d 6e61 6d65 203d          vmname =
-00011870: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
-00011880: 2020 2020 2020 2020 706c 616e 203d 2076          plan = v
-00011890: 6d2e 6765 7428 2770 6c61 6e27 290a 2020  m.get('plan').  
-000118a0: 2020 2020 2020 2020 2020 6966 2070 6c61            if pla
-000118b0: 6e20 6973 204e 6f6e 6520 6f72 2070 6c61  n is None or pla
-000118c0: 6e20 3d3d 2027 6b76 6972 7427 206f 7220  n == 'kvirt' or 
-000118d0: 706c 616e 203d 3d20 2727 3a0a 2020 2020  plan == '':.    
-000118e0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-000118f0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00011900: 2065 6c69 6620 706c 616e 206e 6f74 2069   elif plan not i
-00011910: 6e20 706c 616e 733a 0a20 2020 2020 2020  n plans:.       
-00011920: 2020 2020 2020 2020 2070 6c61 6e73 5b70           plans[p
-00011930: 6c61 6e5d 203d 205b 766d 6e61 6d65 5d0a  lan] = [vmname].
-00011940: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00011950: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011960: 2020 706c 616e 735b 706c 616e 5d2e 6170    plans[plan].ap
-00011970: 7065 6e64 2876 6d6e 616d 6529 0a20 2020  pend(vmname).   
-00011980: 2020 2020 2066 6f72 2070 6c61 6e20 696e       for plan in
-00011990: 2070 6c61 6e73 3a0a 2020 2020 2020 2020   plans:.        
-000119a0: 2020 2020 7265 7375 6c74 732e 6170 7065      results.appe
-000119b0: 6e64 285b 706c 616e 2c20 272c 272e 6a6f  nd([plan, ','.jo
-000119c0: 696e 2870 6c61 6e73 5b70 6c61 6e5d 295d  in(plans[plan])]
-000119d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000119e0: 2072 6573 756c 7473 0a0a 2020 2020 6465   results..    de
-000119f0: 6620 6c69 7374 5f6b 7562 6573 2873 656c  f list_kubes(sel
-00011a00: 6629 3a0a 2020 2020 2020 2020 6b20 3d20  f):.        k = 
-00011a10: 7365 6c66 2e6b 0a20 2020 2020 2020 2069  self.k.        i
-00011a20: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
-00011a30: 7765 6227 2061 6e64 2073 656c 662e 6b2e  web' and self.k.
-00011a40: 6c6f 6361 6c6b 7562 653a 0a20 2020 2020  localkube:.     
-00011a50: 2020 2020 2020 2072 6574 7572 6e20 6b2e         return k.
-00011a60: 6c69 7374 5f6b 7562 6573 2829 0a20 2020  list_kubes().   
-00011a70: 2020 2020 206b 7562 6573 203d 207b 7d0a       kubes = {}.
-00011a80: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
-00011a90: 6e20 6b2e 6c69 7374 2829 3a0a 2020 2020  n k.list():.    
-00011aa0: 2020 2020 2020 2020 6966 2027 6b75 6265          if 'kube
-00011ab0: 2720 696e 2076 6d20 616e 6420 276b 7562  ' in vm and 'kub
-00011ac0: 6574 7970 6527 2069 6e20 766d 3a0a 2020  etype' in vm:.  
-00011ad0: 2020 2020 2020 2020 2020 2020 2020 766d                vm
-00011ae0: 6e61 6d65 203d 2076 6d5b 276e 616d 6527  name = vm['name'
-00011af0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00011b00: 2020 6b75 6265 203d 2076 6d5b 276b 7562    kube = vm['kub
-00011b10: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-00011b20: 2020 2020 5f74 7970 6520 3d20 766d 5b27      _type = vm['
-00011b30: 6b75 6265 7479 7065 275d 0a20 2020 2020  kubetype'].     
-00011b40: 2020 2020 2020 2020 2020 2070 6c61 6e20             plan 
-00011b50: 3d20 766d 5b27 706c 616e 275d 0a20 2020  = vm['plan'].   
-00011b60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00011b70: 6b75 6265 206e 6f74 2069 6e20 6b75 6265  kube not in kube
-00011b80: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00011b90: 2020 2020 2020 206b 7562 6573 5b6b 7562         kubes[kub
-00011ba0: 655d 203d 207b 2774 7970 6527 3a20 5f74  e] = {'type': _t
-00011bb0: 7970 652c 2027 706c 616e 273a 2070 6c61  ype, 'plan': pla
-00011bc0: 6e2c 2027 766d 7327 3a20 5b76 6d6e 616d  n, 'vms': [vmnam
-00011bd0: 655d 7d0a 2020 2020 2020 2020 2020 2020  e]}.            
-00011be0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00011bf0: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
-00011c00: 6265 735b 6b75 6265 5d5b 2776 6d73 275d  bes[kube]['vms']
-00011c10: 2e61 7070 656e 6428 766d 6e61 6d65 290a  .append(vmname).
-00011c20: 2020 2020 2020 2020 666f 7220 6b75 6265          for kube
-00011c30: 2069 6e20 6b75 6265 733a 0a20 2020 2020   in kubes:.     
-00011c40: 2020 2020 2020 206b 7562 6573 5b6b 7562         kubes[kub
-00011c50: 655d 5b27 766d 7327 5d20 3d20 272c 272e  e]['vms'] = ','.
-00011c60: 6a6f 696e 286b 7562 6573 5b6b 7562 655d  join(kubes[kube]
-00011c70: 5b27 766d 7327 5d29 0a20 2020 2020 2020  ['vms']).       
-00011c80: 2063 6c75 7374 6572 7364 6972 203d 206f   clustersdir = o
-00011c90: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
-00011ca0: 7228 277e 2f2e 6b63 6c69 2f63 6c75 7374  r('~/.kcli/clust
-00011cb0: 6572 7327 290a 2020 2020 2020 2020 6966  ers').        if
-00011cc0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00011cd0: 636c 7573 7465 7273 6469 7229 3a0a 2020  clustersdir):.  
-00011ce0: 2020 2020 2020 2020 2020 666f 7220 6b75            for ku
-00011cf0: 6265 2069 6e20 6e65 7874 286f 732e 7761  be in next(os.wa
-00011d00: 6c6b 2863 6c75 7374 6572 7364 6972 2929  lk(clustersdir))
-00011d10: 5b31 5d3a 0a20 2020 2020 2020 2020 2020  [1]:.           
-00011d20: 2020 2020 2069 6620 6b75 6265 2069 6e20       if kube in 
-00011d30: 6b75 6265 733a 0a20 2020 2020 2020 2020  kubes:.         
-00011d40: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00011d50: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00011d60: 2020 2020 636c 7573 7465 7264 6972 203d      clusterdir =
-00011d70: 2066 277b 636c 7573 7465 7273 6469 727d   f'{clustersdir}
-00011d80: 2f7b 6b75 6265 7d27 0a20 2020 2020 2020  /{kube}'.       
-00011d90: 2020 2020 2020 2020 205f 7479 7065 2c20           _type, 
-00011da0: 706c 616e 203d 2027 6765 6e65 7269 6327  plan = 'generic'
-00011db0: 2c20 6b75 6265 0a20 2020 2020 2020 2020  , kube.         
-00011dc0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00011dd0: 682e 6578 6973 7473 2866 277b 636c 7573  h.exists(f'{clus
-00011de0: 7465 7264 6972 7d2f 6b63 6c69 5f70 6172  terdir}/kcli_par
-00011df0: 616d 6574 6572 732e 796d 6c27 293a 0a20  ameters.yml'):. 
-00011e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e10: 2020 2077 6974 6820 6f70 656e 2866 227b     with open(f"{
-00011e20: 636c 7573 7465 7264 6972 7d2f 6b63 6c69  clusterdir}/kcli
-00011e30: 5f70 6172 616d 6574 6572 732e 796d 6c22  _parameters.yml"
-00011e40: 2c20 2772 2729 2061 7320 696e 7374 616c  , 'r') as instal
-00011e50: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
-00011e60: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
-00011e70: 6c6c 7061 7261 6d20 3d20 7961 6d6c 2e73  llparam = yaml.s
-00011e80: 6166 655f 6c6f 6164 2869 6e73 7461 6c6c  afe_load(install
-00011e90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011ea0: 2020 2020 2020 2020 2020 5f74 7970 6520            _type 
-00011eb0: 3d20 696e 7374 616c 6c70 6172 616d 2e67  = installparam.g
-00011ec0: 6574 2827 6b75 6265 7479 7065 272c 205f  et('kubetype', _
-00011ed0: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
-00011ee0: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-00011ef0: 616e 203d 2069 6e73 7461 6c6c 7061 7261  an = installpara
-00011f00: 6d2e 6765 7428 2770 6c61 6e27 2c20 706c  m.get('plan', pl
-00011f10: 616e 290a 2020 2020 2020 2020 2020 2020  an).            
-00011f20: 2020 2020 6b75 6265 735b 6b75 6265 5d20      kubes[kube] 
-00011f30: 3d20 7b27 7479 7065 273a 205f 7479 7065  = {'type': _type
-00011f40: 2c20 2770 6c61 6e27 3a20 706c 616e 2c20  , 'plan': plan, 
-00011f50: 2776 6d73 273a 205b 5d7d 0a20 2020 2020  'vms': []}.     
-00011f60: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
-00011f70: 3d3d 2027 6763 7027 3a0a 2020 2020 2020  == 'gcp':.      
-00011f80: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
-00011f90: 2e63 6c75 7374 6572 2069 6d70 6f72 7420  .cluster import 
-00011fa0: 676b 650a 2020 2020 2020 2020 2020 2020  gke.            
-00011fb0: 6b75 6265 732e 7570 6461 7465 2867 6b65  kubes.update(gke
-00011fc0: 2e6c 6973 7428 7365 6c66 2929 0a20 2020  .list(self)).   
-00011fd0: 2020 2020 2065 6c69 6620 7365 6c66 2e74       elif self.t
-00011fe0: 7970 6520 3d3d 2027 6177 7327 3a0a 2020  ype == 'aws':.  
-00011ff0: 2020 2020 2020 2020 2020 6672 6f6d 206b            from k
-00012000: 7669 7274 2e63 6c75 7374 6572 2069 6d70  virt.cluster imp
-00012010: 6f72 7420 656b 730a 2020 2020 2020 2020  ort eks.        
-00012020: 2020 2020 6b75 6265 732e 7570 6461 7465      kubes.update
-00012030: 2865 6b73 2e6c 6973 7428 7365 6c66 2929  (eks.list(self))
-00012040: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012050: 6b75 6265 730a 0a20 2020 2064 6566 2063  kubes..    def c
-00012060: 7265 6174 655f 7072 6f64 7563 7428 7365  reate_product(se
-00012070: 6c66 2c20 6e61 6d65 2c20 7265 706f 3d4e  lf, name, repo=N
-00012080: 6f6e 652c 2067 726f 7570 3d4e 6f6e 652c  one, group=None,
-00012090: 2070 6c61 6e3d 4e6f 6e65 2c20 6c61 7465   plan=None, late
-000120a0: 7374 3d46 616c 7365 2c20 6f76 6572 7269  st=False, overri
-000120b0: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-000120c0: 2022 2222 4372 6561 7465 2070 726f 6475   """Create produ
-000120d0: 6374 2222 220a 2020 2020 2020 2020 6966  ct""".        if
-000120e0: 2072 6570 6f20 6973 206e 6f74 204e 6f6e   repo is not Non
-000120f0: 6520 616e 6420 6772 6f75 7020 6973 206e  e and group is n
-00012100: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00012110: 2020 2020 2070 726f 6475 6374 7320 3d20       products = 
-00012120: 5b70 726f 6475 6374 2066 6f72 2070 726f  [product for pro
-00012130: 6475 6374 2069 6e20 7365 6c66 2e6c 6973  duct in self.lis
-00012140: 745f 7072 6f64 7563 7473 2829 0a20 2020  t_products().   
-00012150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012160: 2020 2020 2069 6620 7072 6f64 7563 745b       if product[
-00012170: 276e 616d 6527 5d20 3d3d 206e 616d 6520  'name'] == name 
-00012180: 616e 6420 7072 6f64 7563 745b 2772 6570  and product['rep
-00012190: 6f27 5d20 3d3d 2072 6570 6f20 616e 6420  o'] == repo and 
-000121a0: 7072 6f64 7563 745b 2767 726f 7570 275d  product['group']
-000121b0: 203d 3d20 6772 6f75 705d 0a20 2020 2020   == group].     
-000121c0: 2020 2065 6c69 6620 7265 706f 2069 7320     elif repo is 
-000121d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000121e0: 2020 2020 2020 7072 6f64 7563 7473 203d        products =
-000121f0: 205b 7072 6f64 7563 7420 666f 7220 7072   [product for pr
-00012200: 6f64 7563 7420 696e 2073 656c 662e 6c69  oduct in self.li
-00012210: 7374 5f70 726f 6475 6374 7328 290a 2020  st_products().  
-00012220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012230: 2020 2020 2020 6966 2070 726f 6475 6374        if product
-00012240: 5b27 6e61 6d65 275d 203d 3d20 6e61 6d65  ['name'] == name
-00012250: 2061 6e64 2070 726f 6475 6374 5b27 7265   and product['re
-00012260: 706f 275d 203d 3d20 7265 706f 5d0a 2020  po'] == repo].  
-00012270: 2020 2020 2020 6966 2067 726f 7570 2069        if group i
-00012280: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00012290: 2020 2020 2020 2020 7072 6f64 7563 7473          products
-000122a0: 203d 205b 7072 6f64 7563 7420 666f 7220   = [product for 
-000122b0: 7072 6f64 7563 7420 696e 2073 656c 662e  product in self.
-000122c0: 6c69 7374 5f70 726f 6475 6374 7328 290a  list_products().
-000122d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122e0: 2020 2020 2020 2020 6966 2070 726f 6475          if produ
-000122f0: 6374 5b27 6e61 6d65 275d 203d 3d20 6e61  ct['name'] == na
-00012300: 6d65 2061 6e64 2070 726f 6475 6374 5b27  me and product['
-00012310: 6772 6f75 7027 5d20 3d3d 2067 726f 7570  group'] == group
-00012320: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-00012330: 2020 2020 2020 2020 2020 2020 7072 6f64              prod
-00012340: 7563 7473 203d 205b 7072 6f64 7563 7420  ucts = [product 
-00012350: 666f 7220 7072 6f64 7563 7420 696e 2073  for product in s
-00012360: 656c 662e 6c69 7374 5f70 726f 6475 6374  elf.list_product
-00012370: 7328 2920 6966 2070 726f 6475 6374 5b27  s() if product['
-00012380: 6e61 6d65 275d 203d 3d20 6e61 6d65 5d0a  name'] == name].
-00012390: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
-000123a0: 726f 6475 6374 7329 203d 3d20 303a 0a20  roducts) == 0:. 
-000123b0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-000123c0: 2822 5072 6f64 7563 7420 6e6f 7420 666f  ("Product not fo
-000123d0: 756e 642e 204c 6561 7669 6e67 2e2e 2e22  und. Leaving..."
-000123e0: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
-000123f0: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-00012400: 2020 656c 6966 206c 656e 2870 726f 6475    elif len(produ
-00012410: 6374 7329 203e 2031 3a0a 2020 2020 2020  cts) > 1:.      
-00012420: 2020 2020 2020 6572 726f 7228 2250 726f        error("Pro
-00012430: 6475 6374 2066 6f75 6e64 2069 6e20 7365  duct found in se
-00012440: 7665 7261 6c20 7265 706f 7320 6f72 2067  veral repos or g
-00012450: 726f 7570 732e 2053 7065 6369 6679 206f  roups. Specify o
-00012460: 6e65 2e2e 2e22 290a 2020 2020 2020 2020  ne...").        
-00012470: 2020 2020 666f 7220 7072 6f64 7563 7420      for product 
-00012480: 696e 2070 726f 6475 6374 733a 0a20 2020  in products:.   
-00012490: 2020 2020 2020 2020 2020 2020 2067 726f               gro
-000124a0: 7570 203d 2070 726f 6475 6374 5b27 6772  up = product['gr
-000124b0: 6f75 7027 5d0a 2020 2020 2020 2020 2020  oup'].          
-000124c0: 2020 2020 2020 7265 706f 203d 2070 726f        repo = pro
-000124d0: 6475 6374 5b27 7265 706f 275d 0a20 2020  duct['repo'].   
-000124e0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000124f0: 6e74 2866 2272 6570 6f3a 7b72 6570 6f7d  nt(f"repo:{repo}
-00012500: 5c74 6772 6f75 703a 7b67 726f 7570 7d22  \tgroup:{group}"
-00012510: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
-00012520: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-00012530: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012540: 2020 2020 7072 6f64 7563 7420 3d20 7072      product = pr
-00012550: 6f64 7563 7473 5b30 5d0a 2020 2020 2020  oducts[0].      
-00012560: 2020 2020 2020 706c 616e 203d 206e 616d        plan = nam
-00012570: 6575 7469 6c73 2e67 6574 5f72 616e 646f  eutils.get_rando
-00012580: 6d5f 6e61 6d65 2829 2069 6620 706c 616e  m_name() if plan
-00012590: 2069 7320 4e6f 6e65 2065 6c73 6520 706c   is None else pl
-000125a0: 616e 0a20 2020 2020 2020 2020 2020 2072  an.            r
-000125b0: 6570 6f20 3d20 7072 6f64 7563 745b 2772  epo = product['r
-000125c0: 6570 6f27 5d0a 2020 2020 2020 2020 2020  epo'].          
-000125d0: 2020 6966 2027 7265 616c 6469 7227 2069    if 'realdir' i
-000125e0: 6e20 7072 6f64 7563 743a 0a20 2020 2020  n product:.     
-000125f0: 2020 2020 2020 2020 2020 2072 6570 6f64             repod
-00012600: 6972 203d 2022 2573 2f2e 6b63 6c69 2f70  ir = "%s/.kcli/p
-00012610: 6c61 6e73 2f25 732f 2573 2220 2520 286f  lans/%s/%s" % (o
-00012620: 732e 656e 7669 726f 6e2e 6765 7428 2748  s.environ.get('H
-00012630: 4f4d 4527 292c 2072 6570 6f2c 2070 726f  OME'), repo, pro
-00012640: 6475 6374 5b27 7265 616c 6469 7227 5d29  duct['realdir'])
-00012650: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00012660: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00012670: 2020 2072 6570 6f64 6972 203d 2022 2573     repodir = "%s
-00012680: 2f2e 6b63 6c69 2f70 6c61 6e73 2f25 7322  /.kcli/plans/%s"
-00012690: 2025 2028 6f73 2e65 6e76 6972 6f6e 2e67   % (os.environ.g
-000126a0: 6574 2827 484f 4d45 2729 2c20 7265 706f  et('HOME'), repo
-000126b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000126c0: 2027 2f27 2069 6e20 7072 6f64 7563 745b   '/' in product[
-000126d0: 2766 696c 6527 5d3a 0a20 2020 2020 2020  'file']:.       
-000126e0: 2020 2020 2020 2020 2069 6e70 7574 6669           inputfi
-000126f0: 6c65 203d 206f 732e 7061 7468 2e62 6173  le = os.path.bas
-00012700: 656e 616d 6528 7072 6f64 7563 745b 2766  ename(product['f
-00012710: 696c 6527 5d29 0a20 2020 2020 2020 2020  ile']).         
-00012720: 2020 2020 2020 2072 6570 6f64 6972 202b         repodir +
-00012730: 3d20 222f 2573 2220 2520 6f73 2e70 6174  = "/%s" % os.pat
-00012740: 682e 6469 726e 616d 6528 7072 6f64 7563  h.dirname(produc
-00012750: 745b 2766 696c 6527 5d29 0a20 2020 2020  t['file']).     
-00012760: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00012770: 2020 2020 2020 2020 2020 2020 2069 6e70               inp
-00012780: 7574 6669 6c65 203d 2070 726f 6475 6374  utfile = product
-00012790: 5b27 6669 6c65 275d 0a20 2020 2020 2020  ['file'].       
-000127a0: 2020 2020 2069 6d61 6765 203d 2070 726f       image = pro
-000127b0: 6475 6374 2e67 6574 2827 696d 6167 6527  duct.get('image'
-000127c0: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
-000127d0: 7261 6d65 7465 7273 203d 2070 726f 6475  rameters = produ
-000127e0: 6374 2e67 6574 2827 7061 7261 6d65 7465  ct.get('paramete
-000127f0: 7273 2729 0a20 2020 2020 2020 2020 2020  rs').           
-00012800: 2069 6620 696d 6167 6520 6973 206e 6f74   if image is not
-00012810: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00012820: 2020 2020 2020 2070 7269 6e74 2866 224e         print(f"N
-00012830: 6f74 6520 7468 6174 2074 6869 7320 7072  ote that this pr
-00012840: 6f64 7563 7420 7573 6573 2069 6d61 6765  oduct uses image
-00012850: 3a20 7b69 6d61 6765 7d22 290a 2020 2020  : {image}").    
-00012860: 2020 2020 2020 2020 6966 2070 6172 616d          if param
-00012870: 6574 6572 7320 6973 206e 6f74 204e 6f6e  eters is not Non
-00012880: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00012890: 2020 2066 6f72 2070 6172 616d 6574 6572     for parameter
-000128a0: 2069 6e20 7061 7261 6d65 7465 7273 3a0a   in parameters:.
-000128b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128c0: 2020 2020 6170 706c 6965 645f 7061 7261      applied_para
-000128d0: 6d65 7465 7220 3d20 6f76 6572 7269 6465  meter = override
-000128e0: 735b 7061 7261 6d65 7465 725d 2069 6620  s[parameter] if 
-000128f0: 7061 7261 6d65 7465 7220 696e 206f 7665  parameter in ove
-00012900: 7272 6964 6573 2065 6c73 6520 7061 7261  rrides else para
-00012910: 6d65 7465 7273 5b70 6172 616d 6574 6572  meters[parameter
-00012920: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00012930: 2020 2020 2020 7072 696e 7428 6622 5573        print(f"Us
-00012940: 696e 6720 7061 7261 6d65 7465 7220 7b70  ing parameter {p
-00012950: 6172 616d 6574 6572 7d3a 207b 6170 706c  arameter}: {appl
-00012960: 6965 645f 7061 7261 6d65 7465 727d 2229  ied_parameter}")
-00012970: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
-00012980: 7261 7061 7261 6d65 7465 7273 203d 206c  raparameters = l
-00012990: 6973 7428 7365 7428 6f76 6572 7269 6465  ist(set(override
-000129a0: 7329 202d 2073 6574 2870 6172 616d 6574  s) - set(paramet
-000129b0: 6572 7329 2920 6966 2070 6172 616d 6574  ers)) if paramet
-000129c0: 6572 7320 6973 206e 6f74 204e 6f6e 6520  ers is not None 
-000129d0: 656c 7365 206f 7665 7272 6964 6573 0a20  else overrides. 
-000129e0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-000129f0: 6172 616d 6574 6572 2069 6e20 6578 7472  arameter in extr
-00012a00: 6170 6172 616d 6574 6572 733a 0a20 2020  aparameters:.   
-00012a10: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00012a20: 6e74 2822 5573 696e 6720 7061 7261 6d65  nt("Using parame
-00012a30: 7465 7220 2573 3a20 2573 2220 2520 2870  ter %s: %s" % (p
-00012a40: 6172 616d 6574 6572 2c20 6f76 6572 7269  arameter, overri
-00012a50: 6465 735b 7061 7261 6d65 7465 725d 2929  des[parameter]))
-00012a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00012a70: 6e6f 7420 6c61 7465 7374 3a0a 2020 2020  not latest:.    
-00012a80: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00012a90: 6e74 2866 2255 7369 6e67 2064 6972 6563  nt(f"Using direc
-00012aa0: 746f 7279 207b 7265 706f 6469 727d 2229  tory {repodir}")
-00012ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ac0: 2073 656c 662e 706c 616e 2870 6c61 6e2c   self.plan(plan,
-00012ad0: 2070 6174 683d 7265 706f 6469 722c 2069   path=repodir, i
-00012ae0: 6e70 7574 6669 6c65 3d69 6e70 7574 6669  nputfile=inputfi
-00012af0: 6c65 2c20 6f76 6572 7269 6465 733d 6f76  le, overrides=ov
-00012b00: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-00012b10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00012b20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012b30: 7570 6461 7465 5f72 6570 6f28 7265 706f  update_repo(repo
-00012b40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012b50: 2020 7365 6c66 2e70 6c61 6e28 706c 616e    self.plan(plan
-00012b60: 2c20 7061 7468 3d72 6570 6f64 6972 2c20  , path=repodir, 
-00012b70: 696e 7075 7466 696c 653d 696e 7075 7466  inputfile=inputf
-00012b80: 696c 652c 206f 7665 7272 6964 6573 3d6f  ile, overrides=o
-00012b90: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-00012ba0: 2020 2020 2020 7070 7269 6e74 2866 2250        pprint(f"P
-00012bb0: 726f 6475 6374 2063 616e 2062 6520 6465  roduct can be de
-00012bc0: 6c65 7465 6420 7769 7468 3a20 6b63 6c69  leted with: kcli
-00012bd0: 2064 656c 6574 6520 706c 616e 202d 2d79   delete plan --y
-00012be0: 6573 207b 706c 616e 7d22 290a 2020 2020  es {plan}").    
-00012bf0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00012c00: 756c 7427 3a20 2773 7563 6365 7373 272c  ult': 'success',
-00012c10: 2027 706c 616e 273a 2070 6c61 6e7d 0a0a   'plan': plan}..
-00012c20: 2020 2020 6465 6620 7374 6172 745f 706c      def start_pl
-00012c30: 616e 2873 656c 662c 2070 6c61 6e2c 2063  an(self, plan, c
-00012c40: 6f6e 7461 696e 6572 3d46 616c 7365 293a  ontainer=False):
-00012c50: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
-00012c60: 662e 6b0a 2020 2020 2020 2020 7374 6172  f.k.        star
-00012c70: 7466 6f75 6e64 203d 2046 616c 7365 0a20  tfound = False. 
-00012c80: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00012c90: 5374 6172 7469 6e67 2076 6d73 2066 726f  Starting vms fro
-00012ca0: 6d20 706c 616e 207b 706c 616e 7d22 290a  m plan {plan}").
-00012cb0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00012cc0: 656c 662e 6578 7472 6163 6c69 656e 7473  elf.extraclients
-00012cd0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
-00012ce0: 6172 7463 6c69 656e 7473 203d 207b 7365  artclients = {se
-00012cf0: 6c66 2e63 6c69 656e 743a 206b 7d0a 2020  lf.client: k}.  
-00012d00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00012d10: 2020 2020 2020 2020 7374 6172 7463 6c69          startcli
-00012d20: 656e 7473 203d 2073 656c 662e 6578 7472  ents = self.extr
-00012d30: 6163 6c69 656e 7473 0a20 2020 2020 2020  aclients.       
-00012d40: 2020 2020 2073 7461 7274 636c 6965 6e74       startclient
-00012d50: 732e 7570 6461 7465 287b 7365 6c66 2e63  s.update({self.c
-00012d60: 6c69 656e 743a 206b 7d29 0a20 2020 2020  lient: k}).     
-00012d70: 2020 2066 6f72 2068 7970 6572 7669 736f     for hyperviso
-00012d80: 7220 696e 2073 7461 7274 636c 6965 6e74  r in startclient
-00012d90: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-00012da0: 203d 2073 7461 7274 636c 6965 6e74 735b   = startclients[
-00012db0: 6879 7065 7276 6973 6f72 5d0a 2020 2020  hypervisor].    
-00012dc0: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
-00012dd0: 6e20 736f 7274 6564 2863 2e6c 6973 7428  n sorted(c.list(
-00012de0: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
-00012df0: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
-00012e00: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00012e10: 6520 3d20 766d 5b27 6e61 6d65 275d 0a20  e = vm['name']. 
-00012e20: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00012e30: 6573 6372 6970 7469 6f6e 203d 2076 6d2e  escription = vm.
-00012e40: 6765 7428 2770 6c61 6e27 290a 2020 2020  get('plan').    
-00012e50: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00012e60: 6573 6372 6970 7469 6f6e 203d 3d20 706c  escription == pl
-00012e70: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
-00012e80: 2020 2020 2020 2020 7374 6172 7466 6f75          startfou
-00012e90: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-00012ea0: 2020 2020 2020 2020 2020 2020 2020 632e                c.
-00012eb0: 7374 6172 7428 6e61 6d65 290a 2020 2020  start(name).    
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ed0: 7375 6363 6573 7328 6622 7b6e 616d 657d  success(f"{name}
-00012ee0: 2073 7461 7274 6564 206f 6e20 7b68 7970   started on {hyp
-00012ef0: 6572 7669 736f 727d 2122 290a 2020 2020  ervisor}!").    
-00012f00: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
-00012f10: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00012f20: 6e74 203d 204b 636f 6e74 6169 6e65 7263  nt = Kcontainerc
-00012f30: 6f6e 6669 6728 7365 6c66 2c20 636c 6965  onfig(self, clie
-00012f40: 6e74 3d73 656c 662e 636f 6e74 6169 6e65  nt=self.containe
-00012f50: 7263 6c69 656e 7429 2e63 6f6e 740a 2020  rclient).cont.  
-00012f60: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-00012f70: 6e74 6120 696e 2073 6f72 7465 6428 636f  nta in sorted(co
-00012f80: 6e74 2e6c 6973 745f 636f 6e74 6169 6e65  nt.list_containe
-00012f90: 7273 286b 2929 3a0a 2020 2020 2020 2020  rs(k)):.        
-00012fa0: 2020 2020 2020 2020 6e61 6d65 203d 2063          name = c
-00012fb0: 6f6e 7461 5b30 5d0a 2020 2020 2020 2020  onta[0].        
-00012fc0: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
-00012fd0: 7270 6c61 6e20 3d20 636f 6e74 615b 335d  rplan = conta[3]
-00012fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ff0: 2069 6620 636f 6e74 6169 6e65 7270 6c61   if containerpla
-00013000: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
-00013010: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013020: 7461 7274 666f 756e 6420 3d20 5472 7565  tartfound = True
-00013030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013040: 2020 2020 2063 6f6e 742e 7374 6172 745f       cont.start_
-00013050: 636f 6e74 6169 6e65 7228 6e61 6d65 290a  container(name).
-00013060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013070: 2020 2020 7375 6363 6573 7328 6622 436f      success(f"Co
-00013080: 6e74 6169 6e65 7220 7b6e 616d 657d 2073  ntainer {name} s
-00013090: 7461 7274 6564 2122 290a 2020 2020 2020  tarted!").      
-000130a0: 2020 6966 2073 7461 7274 666f 756e 643a    if startfound:
-000130b0: 0a20 2020 2020 2020 2020 2020 2073 7563  .            suc
-000130c0: 6365 7373 2866 2250 6c61 6e20 7b70 6c61  cess(f"Plan {pla
-000130d0: 6e7d 2073 7461 7274 6564 2122 290a 2020  n} started!").  
-000130e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000130f0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00013100: 224e 6f20 6d61 7463 6869 6e67 206f 626a  "No matching obj
-00013110: 6563 7473 2066 6f75 6e64 2229 0a20 2020  ects found").   
-00013120: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00013130: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
-00013140: 7d0a 0a20 2020 2064 6566 2073 746f 705f  }..    def stop_
-00013150: 706c 616e 2873 656c 662c 2070 6c61 6e2c  plan(self, plan,
-00013160: 2073 6f66 743d 4661 6c73 652c 2063 6f6e   soft=False, con
-00013170: 7461 696e 6572 3d46 616c 7365 293a 0a20  tainer=False):. 
-00013180: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
-00013190: 6b0a 2020 2020 2020 2020 7374 6f70 666f  k.        stopfo
-000131a0: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
-000131b0: 2020 2070 7072 696e 7428 6622 5374 6f70     pprint(f"Stop
-000131c0: 7069 6e67 2076 6d73 2066 726f 6d20 706c  ping vms from pl
-000131d0: 616e 207b 706c 616e 7d22 290a 2020 2020  an {plan}").    
-000131e0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-000131f0: 6578 7472 6163 6c69 656e 7473 3a0a 2020  extraclients:.  
-00013200: 2020 2020 2020 2020 2020 7374 6f70 636c            stopcl
-00013210: 6965 6e74 7320 3d20 7b73 656c 662e 636c  ients = {self.cl
-00013220: 6965 6e74 3a20 6b7d 0a20 2020 2020 2020  ient: k}.       
-00013230: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00013240: 2020 2073 746f 7063 6c69 656e 7473 203d     stopclients =
-00013250: 2073 656c 662e 6578 7472 6163 6c69 656e   self.extraclien
-00013260: 7473 0a20 2020 2020 2020 2020 2020 2073  ts.            s
-00013270: 746f 7063 6c69 656e 7473 2e75 7064 6174  topclients.updat
-00013280: 6528 7b73 656c 662e 636c 6965 6e74 3a20  e({self.client: 
-00013290: 6b7d 290a 2020 2020 2020 2020 666f 7220  k}).        for 
-000132a0: 6879 7065 7276 6973 6f72 2069 6e20 7374  hypervisor in st
-000132b0: 6f70 636c 6965 6e74 733a 0a20 2020 2020  opclients:.     
-000132c0: 2020 2020 2020 2063 203d 2073 746f 7063         c = stopc
-000132d0: 6c69 656e 7473 5b68 7970 6572 7669 736f  lients[hyperviso
-000132e0: 725d 0a20 2020 2020 2020 2020 2020 2066  r].            f
-000132f0: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
-00013300: 632e 6c69 7374 2829 2c20 6b65 793d 6c61  c.list(), key=la
-00013310: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
-00013320: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-00013330: 2020 2020 6e61 6d65 203d 2076 6d5b 276e      name = vm['n
-00013340: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-00013350: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
-00013360: 6e20 3d20 766d 2e67 6574 2827 706c 616e  n = vm.get('plan
-00013370: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00013380: 2020 2069 6620 6465 7363 7269 7074 696f     if descriptio
-00013390: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
-000133a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000133b0: 746f 7066 6f75 6e64 203d 2054 7275 650a  topfound = True.
+000112a0: 7070 7269 6e74 2866 2252 6573 697a 696e  pprint(f"Resizin
+000112b0: 6720 4469 736b 207b 696e 6465 787d 2069  g Disk {index} i
+000112c0: 6e20 7b6e 616d 657d 2229 0a20 2020 2020  n {name}").     
+000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112e0: 2020 2064 6973 6b70 6174 6820 3d20 6375     diskpath = cu
+000112f0: 7272 656e 7464 6973 6b5b 2770 6174 6827  rrentdisk['path'
+00011300: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00011310: 2020 2020 2020 2020 2020 6b2e 7265 7369            k.resi
+00011320: 7a65 5f64 6973 6b28 6469 736b 7061 7468  ze_disk(diskpath
+00011330: 2c20 6469 736b 7369 7a65 290a 2020 2020  , disksize).    
+00011340: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
+00011350: 7572 7265 6e74 6469 736b 7329 203c 206c  urrentdisks) < l
+00011360: 656e 2864 6973 6b73 293a 0a20 2020 2020  en(disks):.     
+00011370: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00011380: 7428 6622 4164 6469 6e67 2044 6973 6b73  t(f"Adding Disks
+00011390: 2074 6f20 7b6e 616d 657d 2229 0a20 2020   to {name}").   
+000113a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000113b0: 2064 6973 6b20 696e 2064 6973 6b73 5b6c   disk in disks[l
+000113c0: 656e 2863 7572 7265 6e74 6469 736b 7329  en(currentdisks)
+000113d0: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
+000113e0: 2020 2020 2020 2020 696e 7465 7266 6163          interfac
+000113f0: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
+00011400: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011410: 6973 696e 7374 616e 6365 2864 6973 6b2c  isinstance(disk,
+00011420: 2069 6e74 293a 0a20 2020 2020 2020 2020   int):.         
+00011430: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00011440: 697a 6520 3d20 6469 736b 0a20 2020 2020  ize = disk.     
+00011450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011460: 2020 2070 6f6f 6c20 3d20 7365 6c66 2e70     pool = self.p
+00011470: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+00011480: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+00011490: 6e73 7461 6e63 6528 6469 736b 2c20 7374  nstance(disk, st
+000114a0: 7229 2061 6e64 2064 6973 6b2e 6973 6469  r) and disk.isdi
+000114b0: 6769 7428 293a 0a20 2020 2020 2020 2020  git():.         
+000114c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000114d0: 697a 6520 3d20 696e 7428 6469 736b 290a  ize = int(disk).
+000114e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114f0: 2020 2020 2020 2020 706f 6f6c 203d 2073          pool = s
+00011500: 656c 662e 706f 6f6c 0a20 2020 2020 2020  elf.pool.       
+00011510: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+00011520: 6620 6973 696e 7374 616e 6365 2864 6973  f isinstance(dis
+00011530: 6b2c 2064 6963 7429 3a0a 2020 2020 2020  k, dict):.      
+00011540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011550: 2020 7369 7a65 203d 2064 6973 6b2e 6765    size = disk.ge
+00011560: 7428 2773 697a 6527 2c20 7365 6c66 2e64  t('size', self.d
+00011570: 6973 6b73 697a 6529 0a20 2020 2020 2020  isksize).       
+00011580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011590: 2070 6f6f 6c20 3d20 6469 736b 2e67 6574   pool = disk.get
+000115a0: 2827 706f 6f6c 272c 2073 656c 662e 706f  ('pool', self.po
+000115b0: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
+000115c0: 2020 2020 2020 2020 2020 2020 696e 7465              inte
+000115d0: 7266 6163 6520 3d20 6469 736b 2e67 6574  rface = disk.get
+000115e0: 2827 696e 7465 7266 6163 6527 2920 6f72  ('interface') or
+000115f0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+00011600: 6469 736b 696e 7465 7266 6163 6527 290a  diskinterface').
+00011610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011620: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00011630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011640: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00011650: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00011660: 2e61 6464 5f64 6973 6b28 6e61 6d65 3d6e  .add_disk(name=n
+00011670: 616d 652c 2073 697a 653d 7369 7a65 2c20  ame, size=size, 
+00011680: 706f 6f6c 3d70 6f6f 6c2c 2069 6e74 6572  pool=pool, inter
+00011690: 6661 6365 3d69 6e74 6572 6661 6365 290a  face=interface).
+000116a0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000116b0: 656e 2863 7572 7265 6e74 6469 736b 7329  en(currentdisks)
+000116c0: 203e 206c 656e 2864 6973 6b73 293a 0a20   > len(disks):. 
+000116d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000116e0: 7072 696e 7428 6622 5265 6d6f 7669 6e67  print(f"Removing
+000116f0: 2044 6973 6b73 206f 6620 7b6e 616d 657d   Disks of {name}
+00011700: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00011710: 2020 2066 6f72 2064 6973 6b20 696e 2063     for disk in c
+00011720: 7572 7265 6e74 6469 736b 735b 6c65 6e28  urrentdisks[len(
+00011730: 6375 7272 656e 7464 6973 6b73 2920 2d20  currentdisks) - 
+00011740: 6c65 6e28 6469 736b 7329 3a5d 3a0a 2020  len(disks):]:.  
+00011750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011760: 2020 6469 736b 6e61 6d65 203d 206f 732e    diskname = os.
+00011770: 7061 7468 2e62 6173 656e 616d 6528 6469  path.basename(di
+00011780: 736b 5b27 7061 7468 275d 290a 2020 2020  sk['path']).    
+00011790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117a0: 6469 736b 706f 6f6c 203d 206f 732e 7061  diskpool = os.pa
+000117b0: 7468 2e64 6972 6e61 6d65 2864 6973 6b5b  th.dirname(disk[
+000117c0: 2770 6174 6827 5d29 0a20 2020 2020 2020  'path']).       
+000117d0: 2020 2020 2020 2020 2020 2020 206b 2e64               k.d
+000117e0: 656c 6574 655f 6469 736b 286e 616d 653d  elete_disk(name=
+000117f0: 6e61 6d65 2c20 6469 736b 6e61 6d65 3d64  name, diskname=d
+00011800: 6973 6b6e 616d 652c 2070 6f6f 6c3d 6469  iskname, pool=di
+00011810: 736b 706f 6f6c 2c20 696e 7465 7266 6163  skpool, interfac
+00011820: 653d 696e 7465 7266 6163 6529 0a20 2020  e=interface).   
+00011830: 2020 2020 2069 6620 6e65 7473 3a0a 2020       if nets:.  
+00011840: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00011850: 2866 2255 7064 6174 696e 6720 6e65 7473  (f"Updating nets
+00011860: 206f 6620 766d 207b 6e61 6d65 7d22 290a   of vm {name}").
+00011870: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00011880: 656e 2863 7572 7265 6e74 6e65 7473 2920  en(currentnets) 
+00011890: 3c20 6c65 6e28 6e65 7473 293a 0a20 2020  < len(nets):.   
+000118a0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+000118b0: 696e 7428 6622 4164 6469 6e67 204e 6963  int(f"Adding Nic
+000118c0: 7320 746f 207b 6e61 6d65 7d22 290a 2020  s to {name}").  
+000118d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000118e0: 7220 6e65 7420 696e 206e 6574 735b 6c65  r net in nets[le
+000118f0: 6e28 6375 7272 656e 746e 6574 7329 3a5d  n(currentnets):]
+00011900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011910: 2020 2020 2020 6d6f 6465 6c20 3d20 2776        model = 'v
+00011920: 6972 7469 6f27 0a20 2020 2020 2020 2020  irtio'.         
+00011930: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00011940: 696e 7374 616e 6365 286e 6574 2c20 7374  instance(net, st
+00011950: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00011960: 2020 2020 2020 2020 2020 2020 6e65 7477              netw
+00011970: 6f72 6b20 3d20 6e65 740a 2020 2020 2020  ork = net.      
+00011980: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00011990: 6966 2069 7369 6e73 7461 6e63 6528 6e65  if isinstance(ne
+000119a0: 742c 2064 6963 7429 2061 6e64 2027 6e61  t, dict) and 'na
+000119b0: 6d65 2720 696e 206e 6574 3a0a 2020 2020  me' in net:.    
+000119c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119d0: 2020 2020 6e65 7477 6f72 6b20 3d20 6e65      network = ne
+000119e0: 745b 276e 616d 6527 5d0a 2020 2020 2020  t['name'].      
+000119f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a00: 2020 6d6f 6465 6c20 3d20 6e65 742e 6765    model = net.ge
+00011a10: 7428 276d 6f64 656c 272c 2027 7669 7274  t('model', 'virt
+00011a20: 696f 2729 0a20 2020 2020 2020 2020 2020  io').           
+00011a30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00011a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a50: 2020 2020 2020 2065 7272 6f72 2866 2253         error(f"S
+00011a60: 6b69 7070 696e 6720 7772 6f6e 6720 6e69  kipping wrong ni
+00011a70: 6320 7370 6563 2066 6f72 207b 6e61 6d65  c spec for {name
+00011a80: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00011a90: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00011aa0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00011ab0: 2020 2020 2020 2020 206b 2e61 6464 5f6e           k.add_n
+00011ac0: 6963 286e 616d 652c 206e 6574 776f 726b  ic(name, network
+00011ad0: 2c20 6d6f 6465 6c3d 6d6f 6465 6c29 0a20  , model=model). 
+00011ae0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00011af0: 6e28 6375 7272 656e 746e 6574 7329 203e  n(currentnets) >
+00011b00: 206c 656e 286e 6574 7329 3a0a 2020 2020   len(nets):.    
+00011b10: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00011b20: 6e74 2866 2252 656d 6f76 696e 6720 4e69  nt(f"Removing Ni
+00011b30: 6373 206f 6620 7b6e 616d 657d 2229 0a20  cs of {name}"). 
+00011b40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00011b50: 6f72 206e 6574 2069 6e20 7261 6e67 6528  or net in range(
+00011b60: 6c65 6e28 6375 7272 656e 746e 6574 7329  len(currentnets)
+00011b70: 2c20 6c65 6e28 6e65 7473 292c 202d 3129  , len(nets), -1)
+00011b80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011b90: 2020 2020 2020 696e 7465 7266 6163 6520        interface 
+00011ba0: 3d20 2265 7468 2573 2220 2520 286e 6574  = "eth%s" % (net
+00011bb0: 202d 2031 290a 2020 2020 2020 2020 2020   - 1).          
+00011bc0: 2020 2020 2020 2020 2020 6b2e 6465 6c65            k.dele
+00011bd0: 7465 5f6e 6963 286e 616d 652c 2069 6e74  te_nic(name, int
+00011be0: 6572 6661 6365 290a 2020 2020 2020 2020  erface).        
+00011bf0: 2020 2020 666f 7220 696e 6465 782c 2063      for index, c
+00011c00: 7572 7265 6e74 6e65 7420 696e 2065 6e75  urrentnet in enu
+00011c10: 6d65 7261 7465 2863 7572 7265 6e74 6e65  merate(currentne
+00011c20: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
+00011c30: 2020 2020 2069 6620 696e 6465 7820 3e20       if index > 
+00011c40: 6c65 6e28 6e65 7473 293a 0a20 2020 2020  len(nets):.     
+00011c50: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00011c60: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00011c70: 2020 2020 206e 6574 6e61 6d65 203d 2063       netname = c
+00011c80: 7572 7265 6e74 6e65 745b 276e 6574 275d  urrentnet['net']
+00011c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011ca0: 2074 6172 6765 746e 6574 6e61 6d65 203d   targetnetname =
+00011cb0: 206e 6574 735b 696e 6465 785d 5b27 6e61   nets[index]['na
+00011cc0: 6d65 275d 2069 6620 6973 696e 7374 616e  me'] if isinstan
+00011cd0: 6365 286e 6574 735b 696e 6465 785d 2c20  ce(nets[index], 
+00011ce0: 6469 6374 2920 656c 7365 206e 6574 735b  dict) else nets[
+00011cf0: 696e 6465 785d 0a20 2020 2020 2020 2020  index].         
+00011d00: 2020 2020 2020 2069 6620 7461 7267 6574         if target
+00011d10: 6e65 746e 616d 6520 213d 206e 6574 6e61  netname != netna
+00011d20: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00011d30: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00011d40: 2255 7064 6174 696e 6720 6e69 6320 7b69  "Updating nic {i
+00011d50: 6e64 6578 7d20 746f 206e 6574 776f 726b  ndex} to network
+00011d60: 207b 7461 7267 6574 6e65 746e 616d 657d   {targetnetname}
+00011d70: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00011d80: 2020 2020 2020 206b 2e75 7064 6174 655f         k.update_
+00011d90: 6e69 6328 6e61 6d65 2c20 696e 6465 782c  nic(name, index,
+00011da0: 2074 6172 6765 746e 6574 6e61 6d65 290a   targetnetname).
+00011db0: 2020 2020 2020 2020 6966 2065 7874 7261          if extra
+00011dc0: 5f6d 6574 6164 6174 613a 0a20 2020 2020  _metadata:.     
+00011dd0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
+00011de0: 6e20 6578 7472 615f 6d65 7461 6461 7461  n extra_metadata
+00011df0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011e00: 2020 7661 6c75 6520 3d20 6578 7472 615f    value = extra_
+00011e10: 6d65 7461 6461 7461 5b6b 6579 5d0a 2020  metadata[key].  
+00011e20: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00011e30: 7269 6e74 2866 2255 7064 6174 696e 6720  rint(f"Updating 
+00011e40: 7b6b 6579 7d20 6f66 2076 6d20 7b6e 616d  {key} of vm {nam
+00011e50: 657d 2074 6f20 7b76 616c 7565 7d2e 2e2e  e} to {value}...
+00011e60: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00011e70: 2020 206b 2e75 7064 6174 655f 6d65 7461     k.update_meta
+00011e80: 6461 7461 286e 616d 652c 206b 6579 2c20  data(name, key, 
+00011e90: 7661 6c75 6529 0a20 2020 2020 2020 2069  value).        i
+00011ea0: 6620 6f76 6572 7269 6465 732e 6765 7428  f overrides.get(
+00011eb0: 2766 696c 6573 272c 205b 5d29 3a0a 2020  'files', []):.  
+00011ec0: 2020 2020 2020 2020 2020 6966 206f 7665            if ove
+00011ed0: 7272 6964 6573 2e67 6574 2827 736b 6970  rrides.get('skip
+00011ee0: 5f66 696c 6573 5f72 656d 6564 6961 7469  _files_remediati
+00011ef0: 6f6e 272c 2046 616c 7365 293a 0a20 2020  on', False):.   
+00011f00: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+00011f10: 696e 7428 6622 536b 6970 7069 6e67 2052  int(f"Skipping R
+00011f20: 656d 6564 6961 7469 6f6e 2066 696c 6573  emediation files
+00011f30: 206f 6620 7b6e 616d 657d 2229 0a20 2020   of {name}").   
+00011f40: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00011f50: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00011f60: 6577 6669 6c65 7320 3d20 6f76 6572 7269  ewfiles = overri
+00011f70: 6465 735b 2766 696c 6573 275d 0a20 2020  des['files'].   
+00011f80: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+00011f90: 696e 7428 6622 5265 6d65 6469 6174 696e  int(f"Remediatin
+00011fa0: 6720 6669 6c65 7320 6f66 207b 6e61 6d65  g files of {name
+00011fb0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00011fc0: 2020 2020 7365 6c66 2e72 656d 6564 6961      self.remedia
+00011fd0: 7465 5f66 696c 6573 286e 616d 652c 206e  te_files(name, n
+00011fe0: 6577 6669 6c65 732c 206f 7665 7272 6964  ewfiles, overrid
+00011ff0: 6573 290a 2020 2020 2020 2020 6966 2073  es).        if s
+00012000: 656c 662e 7479 7065 203d 3d20 276b 766d  elf.type == 'kvm
+00012010: 273a 0a20 2020 2020 2020 2020 2020 2070  ':.            p
+00012020: 6f6f 6c20 3d20 6f76 6572 7269 6465 732e  ool = overrides.
+00012030: 6765 7428 2770 6f6f 6c27 290a 2020 2020  get('pool').    
+00012040: 2020 2020 2020 2020 6966 2070 6f6f 6c20          if pool 
+00012050: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00012060: 2020 2020 2020 2020 2020 2020 206b 2e75               k.u
+00012070: 7064 6174 655f 706f 6f6c 286e 616d 652c  pdate_pool(name,
+00012080: 2070 6f6f 6c29 0a20 2020 2020 2020 2020   pool).         
+00012090: 2020 2069 6620 6370 7566 6c61 6773 3a0a     if cpuflags:.
+000120a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000120b0: 7070 7269 6e74 2866 2255 7064 6174 696e  pprint(f"Updatin
+000120c0: 6720 6370 7566 6c61 6773 206f 6620 766d  g cpuflags of vm
+000120d0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+000120e0: 2020 2020 2020 2020 2020 6b2e 7570 6461            k.upda
+000120f0: 7465 5f63 7075 666c 6167 7328 6e61 6d65  te_cpuflags(name
+00012100: 2c20 6370 7566 6c61 6773 2c20 6469 7361  , cpuflags, disa
+00012110: 626c 6529 0a20 2020 2020 2020 2069 6620  ble).        if 
+00012120: 7365 6c66 2e74 7970 6520 3d3d 2027 7673  self.type == 'vs
+00012130: 7068 6572 6527 2061 6e64 2074 656d 706c  phere' and templ
+00012140: 6174 6520 6973 206e 6f74 204e 6f6e 6520  ate is not None 
+00012150: 616e 6420 6973 696e 7374 616e 6365 2874  and isinstance(t
+00012160: 656d 706c 6174 652c 2062 6f6f 6c29 3a0a  emplate, bool):.
+00012170: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+00012180: 6574 203d 2027 7465 6d70 6c61 7465 2720  et = 'template' 
+00012190: 6966 2074 656d 706c 6174 6520 656c 7365  if template else
+000121a0: 2027 766d 270a 2020 2020 2020 2020 2020   'vm'.          
+000121b0: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
+000121c0: 696e 6720 766d 207b 6e61 6d65 7d20 746f  ing vm {name} to
+000121d0: 207b 7461 7267 6574 7d2e 2e2e 2229 0a20   {target}..."). 
+000121e0: 2020 2020 2020 2020 2020 2069 6620 7465             if te
+000121f0: 6d70 6c61 7465 3a0a 2020 2020 2020 2020  mplate:.        
+00012200: 2020 2020 2020 2020 6b2e 636f 6e76 6572          k.conver
+00012210: 745f 746f 5f74 656d 706c 6174 6528 6e61  t_to_template(na
+00012220: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00012230: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00012240: 2020 2020 2020 6b2e 636f 6e76 6572 745f        k.convert_
+00012250: 746f 5f76 6d28 6e61 6d65 290a 2020 2020  to_vm(name).    
+00012260: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00012270: 756c 7427 3a20 2773 7563 6365 7373 277d  ult': 'success'}
+00012280: 0a0a 2020 2020 6465 6620 6c69 7374 5f70  ..    def list_p
+00012290: 6c61 6e73 2873 656c 6629 3a0a 2020 2020  lans(self):.    
+000122a0: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
+000122b0: 2020 2020 2020 2072 6573 756c 7473 203d         results =
+000122c0: 205b 5d0a 2020 2020 2020 2020 706c 616e   [].        plan
+000122d0: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+000122e0: 6f72 2076 6d20 696e 206b 2e6c 6973 7428  or vm in k.list(
+000122f0: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
+00012300: 6d6e 616d 6520 3d20 766d 5b27 6e61 6d65  mname = vm['name
+00012310: 275d 0a20 2020 2020 2020 2020 2020 2070  '].            p
+00012320: 6c61 6e20 3d20 766d 2e67 6574 2827 706c  lan = vm.get('pl
+00012330: 616e 2729 0a20 2020 2020 2020 2020 2020  an').           
+00012340: 2069 6620 706c 616e 2069 7320 4e6f 6e65   if plan is None
+00012350: 206f 7220 706c 616e 203d 3d20 276b 7669   or plan == 'kvi
+00012360: 7274 2720 6f72 2070 6c61 6e20 3d3d 2027  rt' or plan == '
+00012370: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00012380: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00012390: 2020 2020 2020 2020 656c 6966 2070 6c61          elif pla
+000123a0: 6e20 6e6f 7420 696e 2070 6c61 6e73 3a0a  n not in plans:.
+000123b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123c0: 706c 616e 735b 706c 616e 5d20 3d20 5b76  plans[plan] = [v
+000123d0: 6d6e 616d 655d 0a20 2020 2020 2020 2020  mname].         
+000123e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000123f0: 2020 2020 2020 2020 2070 6c61 6e73 5b70           plans[p
+00012400: 6c61 6e5d 2e61 7070 656e 6428 766d 6e61  lan].append(vmna
+00012410: 6d65 290a 2020 2020 2020 2020 666f 7220  me).        for 
+00012420: 706c 616e 2069 6e20 706c 616e 733a 0a20  plan in plans:. 
+00012430: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00012440: 7473 2e61 7070 656e 6428 5b70 6c61 6e2c  ts.append([plan,
+00012450: 2027 2c27 2e6a 6f69 6e28 706c 616e 735b   ','.join(plans[
+00012460: 706c 616e 5d29 5d29 0a20 2020 2020 2020  plan])]).       
+00012470: 2072 6574 7572 6e20 7265 7375 6c74 730a   return results.
+00012480: 0a20 2020 2064 6566 206c 6973 745f 6b75  .    def list_ku
+00012490: 6265 7328 7365 6c66 293a 0a20 2020 2020  bes(self):.     
+000124a0: 2020 206b 203d 2073 656c 662e 6b0a 2020     k = self.k.  
+000124b0: 2020 2020 2020 6966 2073 656c 662e 7479        if self.ty
+000124c0: 7065 203d 3d20 2777 6562 2720 616e 6420  pe == 'web' and 
+000124d0: 7365 6c66 2e6b 2e6c 6f63 616c 6b75 6265  self.k.localkube
+000124e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000124f0: 7475 726e 206b 2e6c 6973 745f 6b75 6265  turn k.list_kube
+00012500: 7328 290a 2020 2020 2020 2020 6b75 6265  s().        kube
+00012510: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+00012520: 6f72 2076 6d20 696e 206b 2e6c 6973 7428  or vm in k.list(
+00012530: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00012540: 6620 276b 7562 6527 2069 6e20 766d 2061  f 'kube' in vm a
+00012550: 6e64 2027 6b75 6265 7479 7065 2720 696e  nd 'kubetype' in
+00012560: 2076 6d3a 0a20 2020 2020 2020 2020 2020   vm:.           
+00012570: 2020 2020 2076 6d6e 616d 6520 3d20 766d       vmname = vm
+00012580: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
+00012590: 2020 2020 2020 2020 206b 7562 6520 3d20           kube = 
+000125a0: 766d 5b27 6b75 6265 275d 0a20 2020 2020  vm['kube'].     
+000125b0: 2020 2020 2020 2020 2020 205f 7479 7065             _type
+000125c0: 203d 2076 6d5b 276b 7562 6574 7970 6527   = vm['kubetype'
+000125d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000125e0: 2020 706c 616e 203d 2076 6d5b 2770 6c61    plan = vm['pla
+000125f0: 6e27 5d0a 2020 2020 2020 2020 2020 2020  n'].            
+00012600: 2020 2020 6966 206b 7562 6520 6e6f 7420      if kube not 
+00012610: 696e 206b 7562 6573 3a0a 2020 2020 2020  in kubes:.      
+00012620: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
+00012630: 6265 735b 6b75 6265 5d20 3d20 7b27 7479  bes[kube] = {'ty
+00012640: 7065 273a 205f 7479 7065 2c20 2770 6c61  pe': _type, 'pla
+00012650: 6e27 3a20 706c 616e 2c20 2776 6d73 273a  n': plan, 'vms':
+00012660: 205b 766d 6e61 6d65 5d7d 0a20 2020 2020   [vmname]}.     
+00012670: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00012680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012690: 2020 2020 206b 7562 6573 5b6b 7562 655d       kubes[kube]
+000126a0: 5b27 766d 7327 5d2e 6170 7065 6e64 2876  ['vms'].append(v
+000126b0: 6d6e 616d 6529 0a20 2020 2020 2020 2066  mname).        f
+000126c0: 6f72 206b 7562 6520 696e 206b 7562 6573  or kube in kubes
+000126d0: 3a0a 2020 2020 2020 2020 2020 2020 6b75  :.            ku
+000126e0: 6265 735b 6b75 6265 5d5b 2776 6d73 275d  bes[kube]['vms']
+000126f0: 203d 2027 2c27 2e6a 6f69 6e28 6b75 6265   = ','.join(kube
+00012700: 735b 6b75 6265 5d5b 2776 6d73 275d 290a  s[kube]['vms']).
+00012710: 2020 2020 2020 2020 636c 7573 7465 7273          clusters
+00012720: 6469 7220 3d20 6f73 2e70 6174 682e 6578  dir = os.path.ex
+00012730: 7061 6e64 7573 6572 2827 7e2f 2e6b 636c  panduser('~/.kcl
+00012740: 692f 636c 7573 7465 7273 2729 0a20 2020  i/clusters').   
+00012750: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00012760: 6578 6973 7473 2863 6c75 7374 6572 7364  exists(clustersd
+00012770: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
+00012780: 2066 6f72 206b 7562 6520 696e 206e 6578   for kube in nex
+00012790: 7428 6f73 2e77 616c 6b28 636c 7573 7465  t(os.walk(cluste
+000127a0: 7273 6469 7229 295b 315d 3a0a 2020 2020  rsdir))[1]:.    
+000127b0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+000127c0: 7562 6520 696e 206b 7562 6573 3a0a 2020  ube in kubes:.  
+000127d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127e0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+000127f0: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
+00012800: 6572 6469 7220 3d20 6627 7b63 6c75 7374  erdir = f'{clust
+00012810: 6572 7364 6972 7d2f 7b6b 7562 657d 270a  ersdir}/{kube}'.
+00012820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012830: 5f74 7970 652c 2070 6c61 6e20 3d20 2767  _type, plan = 'g
+00012840: 656e 6572 6963 272c 206b 7562 650a 2020  eneric', kube.  
+00012850: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00012860: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00012870: 6627 7b63 6c75 7374 6572 6469 727d 2f6b  f'{clusterdir}/k
+00012880: 636c 695f 7061 7261 6d65 7465 7273 2e79  cli_parameters.y
+00012890: 6d6c 2729 3a0a 2020 2020 2020 2020 2020  ml'):.          
+000128a0: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+000128b0: 7065 6e28 6622 7b63 6c75 7374 6572 6469  pen(f"{clusterdi
+000128c0: 727d 2f6b 636c 695f 7061 7261 6d65 7465  r}/kcli_paramete
+000128d0: 7273 2e79 6d6c 222c 2027 7227 2920 6173  rs.yml", 'r') as
+000128e0: 2069 6e73 7461 6c6c 3a0a 2020 2020 2020   install:.      
+000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012900: 2020 696e 7374 616c 6c70 6172 616d 203d    installparam =
+00012910: 2079 616d 6c2e 7361 6665 5f6c 6f61 6428   yaml.safe_load(
+00012920: 696e 7374 616c 6c29 0a20 2020 2020 2020  install).       
+00012930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012940: 205f 7479 7065 203d 2069 6e73 7461 6c6c   _type = install
+00012950: 7061 7261 6d2e 6765 7428 276b 7562 6574  param.get('kubet
+00012960: 7970 6527 2c20 5f74 7970 6529 0a20 2020  ype', _type).   
+00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012980: 2020 2020 2070 6c61 6e20 3d20 696e 7374       plan = inst
+00012990: 616c 6c70 6172 616d 2e67 6574 2827 706c  allparam.get('pl
+000129a0: 616e 272c 2070 6c61 6e29 0a20 2020 2020  an', plan).     
+000129b0: 2020 2020 2020 2020 2020 206b 7562 6573             kubes
+000129c0: 5b6b 7562 655d 203d 207b 2774 7970 6527  [kube] = {'type'
+000129d0: 3a20 5f74 7970 652c 2027 706c 616e 273a  : _type, 'plan':
+000129e0: 2070 6c61 6e2c 2027 766d 7327 3a20 5b5d   plan, 'vms': []
+000129f0: 7d0a 2020 2020 2020 2020 6966 2073 656c  }.        if sel
+00012a00: 662e 7479 7065 203d 3d20 2767 6370 273a  f.type == 'gcp':
+00012a10: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+00012a20: 6d20 6b76 6972 742e 636c 7573 7465 7220  m kvirt.cluster 
+00012a30: 696d 706f 7274 2067 6b65 0a20 2020 2020  import gke.     
+00012a40: 2020 2020 2020 206b 7562 6573 2e75 7064         kubes.upd
+00012a50: 6174 6528 676b 652e 6c69 7374 2873 656c  ate(gke.list(sel
+00012a60: 6629 290a 2020 2020 2020 2020 656c 6966  f)).        elif
+00012a70: 2073 656c 662e 7479 7065 203d 3d20 2761   self.type == 'a
+00012a80: 7773 273a 0a20 2020 2020 2020 2020 2020  ws':.           
+00012a90: 2066 726f 6d20 6b76 6972 742e 636c 7573   from kvirt.clus
+00012aa0: 7465 7220 696d 706f 7274 2065 6b73 0a20  ter import eks. 
+00012ab0: 2020 2020 2020 2020 2020 206b 7562 6573             kubes
+00012ac0: 2e75 7064 6174 6528 656b 732e 6c69 7374  .update(eks.list
+00012ad0: 2873 656c 6629 290a 2020 2020 2020 2020  (self)).        
+00012ae0: 656c 6966 2073 656c 662e 7479 7065 203d  elif self.type =
+00012af0: 3d20 2761 7a75 7265 273a 0a20 2020 2020  = 'azure':.     
+00012b00: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
+00012b10: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
+00012b20: 2061 6b73 0a20 2020 2020 2020 2020 2020   aks.           
+00012b30: 206b 7562 6573 2e75 7064 6174 6528 616b   kubes.update(ak
+00012b40: 732e 6c69 7374 2873 656c 6629 290a 2020  s.list(self)).  
+00012b50: 2020 2020 2020 7265 7475 726e 206b 7562        return kub
+00012b60: 6573 0a0a 2020 2020 6465 6620 6372 6561  es..    def crea
+00012b70: 7465 5f70 726f 6475 6374 2873 656c 662c  te_product(self,
+00012b80: 206e 616d 652c 2072 6570 6f3d 4e6f 6e65   name, repo=None
+00012b90: 2c20 6772 6f75 703d 4e6f 6e65 2c20 706c  , group=None, pl
+00012ba0: 616e 3d4e 6f6e 652c 206c 6174 6573 743d  an=None, latest=
+00012bb0: 4661 6c73 652c 206f 7665 7272 6964 6573  False, overrides
+00012bc0: 3d7b 7d29 3a0a 2020 2020 2020 2020 2222  ={}):.        ""
+00012bd0: 2243 7265 6174 6520 7072 6f64 7563 7422  "Create product"
+00012be0: 2222 0a20 2020 2020 2020 2069 6620 7265  "".        if re
+00012bf0: 706f 2069 7320 6e6f 7420 4e6f 6e65 2061  po is not None a
+00012c00: 6e64 2067 726f 7570 2069 7320 6e6f 7420  nd group is not 
+00012c10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00012c20: 2020 7072 6f64 7563 7473 203d 205b 7072    products = [pr
+00012c30: 6f64 7563 7420 666f 7220 7072 6f64 7563  oduct for produc
+00012c40: 7420 696e 2073 656c 662e 6c69 7374 5f70  t in self.list_p
+00012c50: 726f 6475 6374 7328 290a 2020 2020 2020  roducts().      
+00012c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c70: 2020 6966 2070 726f 6475 6374 5b27 6e61    if product['na
+00012c80: 6d65 275d 203d 3d20 6e61 6d65 2061 6e64  me'] == name and
+00012c90: 2070 726f 6475 6374 5b27 7265 706f 275d   product['repo']
+00012ca0: 203d 3d20 7265 706f 2061 6e64 2070 726f   == repo and pro
+00012cb0: 6475 6374 5b27 6772 6f75 7027 5d20 3d3d  duct['group'] ==
+00012cc0: 2067 726f 7570 5d0a 2020 2020 2020 2020   group].        
+00012cd0: 656c 6966 2072 6570 6f20 6973 206e 6f74  elif repo is not
+00012ce0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00012cf0: 2020 2070 726f 6475 6374 7320 3d20 5b70     products = [p
+00012d00: 726f 6475 6374 2066 6f72 2070 726f 6475  roduct for produ
+00012d10: 6374 2069 6e20 7365 6c66 2e6c 6973 745f  ct in self.list_
+00012d20: 7072 6f64 7563 7473 2829 0a20 2020 2020  products().     
+00012d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d40: 2020 2069 6620 7072 6f64 7563 745b 276e     if product['n
+00012d50: 616d 6527 5d20 3d3d 206e 616d 6520 616e  ame'] == name an
+00012d60: 6420 7072 6f64 7563 745b 2772 6570 6f27  d product['repo'
+00012d70: 5d20 3d3d 2072 6570 6f5d 0a20 2020 2020  ] == repo].     
+00012d80: 2020 2069 6620 6772 6f75 7020 6973 206e     if group is n
+00012d90: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00012da0: 2020 2020 2070 726f 6475 6374 7320 3d20       products = 
+00012db0: 5b70 726f 6475 6374 2066 6f72 2070 726f  [product for pro
+00012dc0: 6475 6374 2069 6e20 7365 6c66 2e6c 6973  duct in self.lis
+00012dd0: 745f 7072 6f64 7563 7473 2829 0a20 2020  t_products().   
+00012de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012df0: 2020 2020 2069 6620 7072 6f64 7563 745b       if product[
+00012e00: 276e 616d 6527 5d20 3d3d 206e 616d 6520  'name'] == name 
+00012e10: 616e 6420 7072 6f64 7563 745b 2767 726f  and product['gro
+00012e20: 7570 275d 203d 3d20 6772 6f75 705d 0a20  up'] == group]. 
+00012e30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00012e40: 2020 2020 2020 2020 2070 726f 6475 6374           product
+00012e50: 7320 3d20 5b70 726f 6475 6374 2066 6f72  s = [product for
+00012e60: 2070 726f 6475 6374 2069 6e20 7365 6c66   product in self
+00012e70: 2e6c 6973 745f 7072 6f64 7563 7473 2829  .list_products()
+00012e80: 2069 6620 7072 6f64 7563 745b 276e 616d   if product['nam
+00012e90: 6527 5d20 3d3d 206e 616d 655d 0a20 2020  e'] == name].   
+00012ea0: 2020 2020 2069 6620 6c65 6e28 7072 6f64       if len(prod
+00012eb0: 7563 7473 2920 3d3d 2030 3a0a 2020 2020  ucts) == 0:.    
+00012ec0: 2020 2020 2020 2020 6572 726f 7228 2250          error("P
+00012ed0: 726f 6475 6374 206e 6f74 2066 6f75 6e64  roduct not found
+00012ee0: 2e20 4c65 6176 696e 672e 2e2e 2229 0a20  . Leaving..."). 
+00012ef0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00012f00: 7869 7428 3129 0a20 2020 2020 2020 2065  xit(1).        e
+00012f10: 6c69 6620 6c65 6e28 7072 6f64 7563 7473  lif len(products
+00012f20: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
+00012f30: 2020 2065 7272 6f72 2822 5072 6f64 7563     error("Produc
+00012f40: 7420 666f 756e 6420 696e 2073 6576 6572  t found in sever
+00012f50: 616c 2072 6570 6f73 206f 7220 6772 6f75  al repos or grou
+00012f60: 7073 2e20 5370 6563 6966 7920 6f6e 652e  ps. Specify one.
+00012f70: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00012f80: 2066 6f72 2070 726f 6475 6374 2069 6e20   for product in 
+00012f90: 7072 6f64 7563 7473 3a0a 2020 2020 2020  products:.      
+00012fa0: 2020 2020 2020 2020 2020 6772 6f75 7020            group 
+00012fb0: 3d20 7072 6f64 7563 745b 2767 726f 7570  = product['group
+00012fc0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00012fd0: 2020 2072 6570 6f20 3d20 7072 6f64 7563     repo = produc
+00012fe0: 745b 2772 6570 6f27 5d0a 2020 2020 2020  t['repo'].      
+00012ff0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00013000: 6622 7265 706f 3a7b 7265 706f 7d5c 7467  f"repo:{repo}\tg
+00013010: 726f 7570 3a7b 6772 6f75 707d 2229 0a20  roup:{group}"). 
+00013020: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00013030: 7869 7428 3129 0a20 2020 2020 2020 2065  xit(1).        e
+00013040: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00013050: 2070 726f 6475 6374 203d 2070 726f 6475   product = produ
+00013060: 6374 735b 305d 0a20 2020 2020 2020 2020  cts[0].         
+00013070: 2020 2070 6c61 6e20 3d20 6e61 6d65 7574     plan = nameut
+00013080: 696c 732e 6765 745f 7261 6e64 6f6d 5f6e  ils.get_random_n
+00013090: 616d 6528 2920 6966 2070 6c61 6e20 6973  ame() if plan is
+000130a0: 204e 6f6e 6520 656c 7365 2070 6c61 6e0a   None else plan.
+000130b0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+000130c0: 203d 2070 726f 6475 6374 5b27 7265 706f   = product['repo
+000130d0: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
+000130e0: 6620 2772 6561 6c64 6972 2720 696e 2070  f 'realdir' in p
+000130f0: 726f 6475 6374 3a0a 2020 2020 2020 2020  roduct:.        
+00013100: 2020 2020 2020 2020 7265 706f 6469 7220          repodir 
+00013110: 3d20 2225 732f 2e6b 636c 692f 706c 616e  = "%s/.kcli/plan
+00013120: 732f 2573 2f25 7322 2025 2028 6f73 2e65  s/%s/%s" % (os.e
+00013130: 6e76 6972 6f6e 2e67 6574 2827 484f 4d45  nviron.get('HOME
+00013140: 2729 2c20 7265 706f 2c20 7072 6f64 7563  '), repo, produc
+00013150: 745b 2772 6561 6c64 6972 275d 290a 2020  t['realdir']).  
+00013160: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00013170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013180: 7265 706f 6469 7220 3d20 2225 732f 2e6b  repodir = "%s/.k
+00013190: 636c 692f 706c 616e 732f 2573 2220 2520  cli/plans/%s" % 
+000131a0: 286f 732e 656e 7669 726f 6e2e 6765 7428  (os.environ.get(
+000131b0: 2748 4f4d 4527 292c 2072 6570 6f29 0a20  'HOME'), repo). 
+000131c0: 2020 2020 2020 2020 2020 2069 6620 272f             if '/
+000131d0: 2720 696e 2070 726f 6475 6374 5b27 6669  ' in product['fi
+000131e0: 6c65 275d 3a0a 2020 2020 2020 2020 2020  le']:.          
+000131f0: 2020 2020 2020 696e 7075 7466 696c 6520        inputfile 
+00013200: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+00013210: 6d65 2870 726f 6475 6374 5b27 6669 6c65  me(product['file
+00013220: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+00013230: 2020 2020 7265 706f 6469 7220 2b3d 2022      repodir += "
+00013240: 2f25 7322 2025 206f 732e 7061 7468 2e64  /%s" % os.path.d
+00013250: 6972 6e61 6d65 2870 726f 6475 6374 5b27  irname(product['
+00013260: 6669 6c65 275d 290a 2020 2020 2020 2020  file']).        
+00013270: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00013280: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
+00013290: 696c 6520 3d20 7072 6f64 7563 745b 2766  ile = product['f
+000132a0: 696c 6527 5d0a 2020 2020 2020 2020 2020  ile'].          
+000132b0: 2020 696d 6167 6520 3d20 7072 6f64 7563    image = produc
+000132c0: 742e 6765 7428 2769 6d61 6765 2729 0a20  t.get('image'). 
+000132d0: 2020 2020 2020 2020 2020 2070 6172 616d             param
+000132e0: 6574 6572 7320 3d20 7072 6f64 7563 742e  eters = product.
+000132f0: 6765 7428 2770 6172 616d 6574 6572 7327  get('parameters'
+00013300: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00013310: 2069 6d61 6765 2069 7320 6e6f 7420 4e6f   image is not No
+00013320: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00013330: 2020 2020 7072 696e 7428 6622 4e6f 7465      print(f"Note
+00013340: 2074 6861 7420 7468 6973 2070 726f 6475   that this produ
+00013350: 6374 2075 7365 7320 696d 6167 653a 207b  ct uses image: {
+00013360: 696d 6167 657d 2229 0a20 2020 2020 2020  image}").       
+00013370: 2020 2020 2069 6620 7061 7261 6d65 7465       if paramete
+00013380: 7273 2069 7320 6e6f 7420 4e6f 6e65 3a0a  rs is not None:.
+00013390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133a0: 666f 7220 7061 7261 6d65 7465 7220 696e  for parameter in
+000133b0: 2070 6172 616d 6574 6572 733a 0a20 2020   parameters:.   
 000133c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133d0: 2020 2020 632e 7374 6f70 286e 616d 652c      c.stop(name,
-000133e0: 2073 6f66 743d 736f 6674 290a 2020 2020   soft=soft).    
-000133f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013400: 7375 6363 6573 7328 6622 7b6e 616d 657d  success(f"{name}
-00013410: 2073 746f 7070 6564 206f 6e20 7b68 7970   stopped on {hyp
-00013420: 6572 7669 736f 727d 2122 290a 2020 2020  ervisor}!").    
-00013430: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
-00013440: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00013450: 6e74 203d 204b 636f 6e74 6169 6e65 7263  nt = Kcontainerc
-00013460: 6f6e 6669 6728 7365 6c66 2c20 636c 6965  onfig(self, clie
-00013470: 6e74 3d73 656c 662e 636f 6e74 6169 6e65  nt=self.containe
-00013480: 7263 6c69 656e 7429 2e63 6f6e 740a 2020  rclient).cont.  
-00013490: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-000134a0: 6e74 6120 696e 2073 6f72 7465 6428 636f  nta in sorted(co
-000134b0: 6e74 2e6c 6973 745f 636f 6e74 6169 6e65  nt.list_containe
-000134c0: 7273 2829 293a 0a20 2020 2020 2020 2020  rs()):.         
-000134d0: 2020 2020 2020 206e 616d 6520 3d20 636f         name = co
-000134e0: 6e74 615b 305d 0a20 2020 2020 2020 2020  nta[0].         
-000134f0: 2020 2020 2020 2063 6f6e 7461 696e 6572         container
-00013500: 706c 616e 203d 2063 6f6e 7461 5b33 5d0a  plan = conta[3].
-00013510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013520: 6966 2063 6f6e 7461 696e 6572 706c 616e  if containerplan
-00013530: 203d 3d20 706c 616e 3a0a 2020 2020 2020   == plan:.      
-00013540: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00013550: 6f70 666f 756e 6420 3d20 5472 7565 0a20  opfound = True. 
-00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013570: 2020 2063 6f6e 742e 7374 6f70 5f63 6f6e     cont.stop_con
-00013580: 7461 696e 6572 286e 616d 6529 0a20 2020  tainer(name).   
-00013590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135a0: 2073 7563 6365 7373 2866 2243 6f6e 7461   success(f"Conta
-000135b0: 696e 6572 207b 6e61 6d65 7d20 7374 6f70  iner {name} stop
-000135c0: 7065 6421 2229 0a20 2020 2020 2020 2069  ped!").        i
-000135d0: 6620 7374 6f70 666f 756e 643a 0a20 2020  f stopfound:.   
-000135e0: 2020 2020 2020 2020 2073 7563 6365 7373           success
-000135f0: 2866 2250 6c61 6e20 7b70 6c61 6e7d 2073  (f"Plan {plan} s
-00013600: 746f 7070 6564 2122 290a 2020 2020 2020  topped!").      
-00013610: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00013620: 2020 2020 7761 726e 696e 6728 224e 6f20      warning("No 
-00013630: 6d61 7463 6869 6e67 206f 626a 6563 7473  matching objects
-00013640: 2066 6f75 6e64 2229 0a20 2020 2020 2020   found").       
-00013650: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00013660: 273a 2027 7375 6363 6573 7327 7d0a 0a20  ': 'success'}.. 
-00013670: 2020 2064 6566 2061 7574 6f73 7461 7274     def autostart
-00013680: 5f70 6c61 6e28 7365 6c66 2c20 706c 616e  _plan(self, plan
-00013690: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
-000136a0: 656c 662e 6b0a 2020 2020 2020 2020 7070  elf.k.        pp
-000136b0: 7269 6e74 2866 2253 6574 2076 6d73 2066  rint(f"Set vms f
-000136c0: 726f 6d20 706c 616e 207b 706c 616e 7d20  rom plan {plan} 
-000136d0: 746f 2061 7574 6f73 7461 7274 2229 0a20  to autostart"). 
-000136e0: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
-000136f0: 2073 6f72 7465 6428 6b2e 6c69 7374 2829   sorted(k.list()
-00013700: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
-00013710: 785b 276e 616d 6527 5d29 3a0a 2020 2020  x['name']):.    
-00013720: 2020 2020 2020 2020 6e61 6d65 203d 2076          name = v
-00013730: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
-00013740: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
-00013750: 6e20 3d20 766d 5b27 706c 616e 275d 0a20  n = vm['plan']. 
-00013760: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-00013770: 7363 7269 7074 696f 6e20 3d3d 2070 6c61  scription == pla
-00013780: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00013790: 2020 206b 2e75 7064 6174 655f 7374 6172     k.update_star
-000137a0: 7428 6e61 6d65 2c20 7374 6172 743d 5472  t(name, start=Tr
-000137b0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-000137c0: 2020 2020 7375 6363 6573 7328 6622 7b6e      success(f"{n
-000137d0: 616d 657d 2073 6574 2074 6f20 6175 746f  ame} set to auto
-000137e0: 7374 6172 7421 2229 0a20 2020 2020 2020  start!").       
-000137f0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00013800: 273a 2027 7375 6363 6573 7327 7d0a 0a20  ': 'success'}.. 
-00013810: 2020 2064 6566 206e 6f61 7574 6f73 7461     def noautosta
-00013820: 7274 5f70 6c61 6e28 7365 6c66 2c20 706c  rt_plan(self, pl
-00013830: 616e 293a 0a20 2020 2020 2020 206b 203d  an):.        k =
-00013840: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
-00013850: 7070 7269 6e74 2866 2250 7265 7665 6e74  pprint(f"Prevent
-00013860: 696e 6720 766d 7320 6672 6f6d 2070 6c61  ing vms from pla
-00013870: 6e20 7b70 6c61 6e7d 2074 6f20 6175 746f  n {plan} to auto
-00013880: 7374 6172 7422 290a 2020 2020 2020 2020  start").        
-00013890: 666f 7220 766d 2069 6e20 736f 7274 6564  for vm in sorted
-000138a0: 286b 2e6c 6973 7428 292c 206b 6579 3d6c  (k.list(), key=l
-000138b0: 616d 6264 6120 783a 2078 5b27 6e61 6d65  ambda x: x['name
-000138c0: 275d 293a 0a20 2020 2020 2020 2020 2020  ']):.           
-000138d0: 206e 616d 6520 3d20 766d 5b27 6e61 6d65   name = vm['name
-000138e0: 275d 0a20 2020 2020 2020 2020 2020 2064  '].            d
-000138f0: 6573 6372 6970 7469 6f6e 203d 2076 6d5b  escription = vm[
-00013900: 2770 6c61 6e27 5d0a 2020 2020 2020 2020  'plan'].        
-00013910: 2020 2020 6966 2064 6573 6372 6970 7469      if descripti
-00013920: 6f6e 203d 3d20 706c 616e 3a0a 2020 2020  on == plan:.    
-00013930: 2020 2020 2020 2020 2020 2020 6b2e 7570              k.up
-00013940: 6461 7465 5f73 7461 7274 286e 616d 652c  date_start(name,
-00013950: 2073 7461 7274 3d46 616c 7365 290a 2020   start=False).  
-00013960: 2020 2020 2020 2020 2020 2020 2020 7375                su
-00013970: 6363 6573 7328 6622 7b6e 616d 657d 2070  ccess(f"{name} p
-00013980: 7265 7665 6e74 6564 2074 6f20 6175 746f  revented to auto
-00013990: 7374 6172 7421 2229 0a20 2020 2020 2020  start!").       
-000139a0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-000139b0: 273a 2027 7375 6363 6573 7327 7d0a 0a20  ': 'success'}.. 
-000139c0: 2020 2064 6566 2064 656c 6574 655f 706c     def delete_pl
-000139d0: 616e 2873 656c 662c 2070 6c61 6e2c 2063  an(self, plan, c
-000139e0: 6f6e 7461 696e 6572 3d46 616c 7365 2c20  ontainer=False, 
-000139f0: 756e 7265 6769 7374 6572 3d46 616c 7365  unregister=False
-00013a00: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
-00013a10: 656c 662e 6b0a 2020 2020 2020 2020 6465  elf.k.        de
-00013a20: 6c65 7465 6476 6d73 203d 205b 5d0a 2020  letedvms = [].  
-00013a30: 2020 2020 2020 6465 6c65 7465 646c 6273        deletedlbs
-00013a40: 203d 205b 5d0a 2020 2020 2020 2020 646e   = [].        dn
-00013a50: 7363 6c69 656e 7473 203d 205b 5d0a 2020  sclients = [].  
-00013a60: 2020 2020 2020 6e65 7477 6f72 6b73 203d        networks =
-00013a70: 205b 5d0a 2020 2020 2020 2020 6966 2070   [].        if p
-00013a80: 6c61 6e20 3d3d 2027 273a 0a20 2020 2020  lan == '':.     
-00013a90: 2020 2020 2020 2065 7272 6f72 2822 5468         error("Th
-00013aa0: 6174 2077 6f75 6c64 2064 656c 6574 6520  at would delete 
-00013ab0: 6576 6572 7920 766d 2e2e 2e4e 6f74 2064  every vm...Not d
-00013ac0: 6f69 6e67 2074 6861 7422 290a 2020 2020  oing that").    
-00013ad0: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00013ae0: 2831 290a 2020 2020 2020 2020 666f 756e  (1).        foun
-00013af0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-00013b00: 2020 6465 6c65 7465 636c 6965 6e74 7320    deleteclients 
-00013b10: 3d20 7b73 656c 662e 636c 6965 6e74 3a20  = {self.client: 
-00013b20: 6b7d 0a20 2020 2020 2020 2076 6d63 6c69  k}.        vmcli
-00013b30: 656e 7473 203d 205b 5d0a 2020 2020 2020  ents = [].      
-00013b40: 2020 766d 636c 6965 6e74 735f 6669 6c65    vmclients_file
-00013b50: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-00013b60: 6475 7365 7228 6627 7e2f 2e6b 636c 692f  duser(f'~/.kcli/
-00013b70: 766d 636c 6965 6e74 735f 7b70 6c61 6e7d  vmclients_{plan}
-00013b80: 2729 0a20 2020 2020 2020 2069 6620 6f73  ').        if os
-00013b90: 2e70 6174 682e 6578 6973 7473 2876 6d63  .path.exists(vmc
-00013ba0: 6c69 656e 7473 5f66 696c 6529 3a0a 2020  lients_file):.  
-00013bb0: 2020 2020 2020 2020 2020 766d 636c 6965            vmclie
-00013bc0: 6e74 7320 3d20 7961 6d6c 2e73 6166 655f  nts = yaml.safe_
-00013bd0: 6c6f 6164 286f 7065 6e28 766d 636c 6965  load(open(vmclie
-00013be0: 6e74 735f 6669 6c65 2929 0a20 2020 2020  nts_file)).     
-00013bf0: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-00013c00: 2876 6d63 6c69 656e 7473 5f66 696c 6529  (vmclients_file)
-00013c10: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00013c20: 2e65 7874 7261 636c 6965 6e74 733a 0a20  .extraclients:. 
-00013c30: 2020 2020 2020 2020 2020 2064 656c 6574             delet
-00013c40: 6563 6c69 656e 7473 2e75 7064 6174 6528  eclients.update(
-00013c50: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
-00013c60: 7329 0a20 2020 2020 2020 2065 6c69 6620  s).        elif 
-00013c70: 766d 636c 6965 6e74 733a 0a20 2020 2020  vmclients:.     
-00013c80: 2020 2020 2020 2064 656c 6574 6563 6c69         deletecli
-00013c90: 656e 7473 2e75 7064 6174 6528 7b63 6c69  ents.update({cli
-00013ca0: 3a20 4b63 6f6e 6669 6728 636c 6965 6e74  : Kconfig(client
-00013cb0: 3d63 6c69 292e 6b20 666f 7220 636c 6920  =cli).k for cli 
-00013cc0: 696e 2076 6d63 6c69 656e 7473 2069 6620  in vmclients if 
-00013cd0: 636c 6920 213d 2073 656c 662e 636c 6965  cli != self.clie
-00013ce0: 6e74 7d29 0a20 2020 2020 2020 2068 7970  nt}).        hyp
-00013cf0: 6572 7368 6966 7420 3d20 4661 6c73 650a  ershift = False.
-00013d00: 2020 2020 2020 2020 6173 7369 7374 6564          assisted
-00013d10: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00013d20: 2065 6b73 203d 2046 616c 7365 0a20 2020   eks = False.   
-00013d30: 2020 2020 2067 6b65 203d 2046 616c 7365       gke = False
-00013d40: 0a20 2020 2020 2020 2063 6c75 7374 6572  .        cluster
-00013d50: 6469 7220 3d20 222f 6661 6b65 2f78 7878  dir = "/fake/xxx
-00013d60: 220a 2020 2020 2020 2020 666f 7220 6879  ".        for hy
-00013d70: 7065 7276 6973 6f72 2069 6e20 6465 6c65  pervisor in dele
-00013d80: 7465 636c 6965 6e74 733a 0a20 2020 2020  teclients:.     
-00013d90: 2020 2020 2020 2063 203d 2064 656c 6574         c = delet
-00013da0: 6563 6c69 656e 7473 5b68 7970 6572 7669  eclients[hypervi
-00013db0: 736f 725d 0a20 2020 2020 2020 2020 2020  sor].           
-00013dc0: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
-00013dd0: 6428 632e 6c69 7374 2829 2c20 6b65 793d  d(c.list(), key=
-00013de0: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
-00013df0: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
-00013e00: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
-00013e10: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
-00013e20: 2020 2020 2020 2020 6465 7363 7269 7074          descript
-00013e30: 696f 6e20 3d20 766d 2e67 6574 2827 706c  ion = vm.get('pl
-00013e40: 616e 2729 0a20 2020 2020 2020 2020 2020  an').           
-00013e50: 2020 2020 2069 6620 6465 7363 7269 7074       if descript
-00013e60: 696f 6e20 3d3d 2070 6c61 6e3a 0a20 2020  ion == plan:.   
-00013e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e80: 2069 6620 766d 2e67 6574 2827 6b75 6265   if vm.get('kube
-00013e90: 7479 7065 272c 2027 6765 6e65 7269 6327  type', 'generic'
-00013ea0: 2920 696e 205b 2765 6b73 272c 2027 676b  ) in ['eks', 'gk
-00013eb0: 6527 5d3a 0a20 2020 2020 2020 2020 2020  e']:.           
-00013ec0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00013ed0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00013ee0: 2020 2020 2020 2020 2020 6966 2027 6c6f            if 'lo
-00013ef0: 6164 6261 6c61 6e63 6572 2720 696e 2076  adbalancer' in v
-00013f00: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
-00013f10: 2020 2020 2020 2020 2020 206c 6273 203d             lbs =
-00013f20: 2076 6d5b 276c 6f61 6462 616c 616e 6365   vm['loadbalance
-00013f30: 7227 5d2e 7370 6c69 7428 272c 2729 0a20  r'].split(','). 
-00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f50: 2020 2020 2020 2066 6f72 206c 6220 696e         for lb in
-00013f60: 206c 6273 3a0a 2020 2020 2020 2020 2020   lbs:.          
-00013f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f80: 2020 6966 206c 6220 6e6f 7420 696e 2064    if lb not in d
-00013f90: 656c 6574 6564 6c62 733a 0a20 2020 2020  eletedlbs:.     
-00013fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fb0: 2020 2020 2020 2020 2020 2064 656c 6574             delet
-00013fc0: 6564 6c62 732e 6170 7065 6e64 286c 6229  edlbs.append(lb)
-00013fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013fe0: 2020 2020 2076 6d6e 6574 776f 726b 7320       vmnetworks 
-00013ff0: 3d20 632e 766d 5f70 6f72 7473 286e 616d  = c.vm_ports(nam
-00014000: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00014010: 2020 2020 2020 2066 6f72 206e 6574 776f         for netwo
-00014020: 726b 2069 6e20 766d 6e65 7477 6f72 6b73  rk in vmnetworks
-00014030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014040: 2020 2020 2020 2020 2020 6966 206e 6574            if net
-00014050: 776f 726b 2021 3d20 2764 6566 6175 6c74  work != 'default
-00014060: 2720 616e 6420 6e65 7477 6f72 6b20 6e6f  ' and network no
-00014070: 7420 696e 206e 6574 776f 726b 733a 0a20  t in networks:. 
-00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014090: 2020 2020 2020 2020 2020 206e 6574 776f             netwo
-000140a0: 726b 732e 6170 7065 6e64 286e 6574 776f  rks.append(netwo
-000140b0: 726b 290a 2020 2020 2020 2020 2020 2020  rk).            
-000140c0: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-000140d0: 742c 2064 6f6d 6169 6e20 3d20 632e 646e  t, domain = c.dn
-000140e0: 7369 6e66 6f28 6e61 6d65 290a 2020 2020  sinfo(name).    
-000140f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014100: 6966 2075 6e72 6567 6973 7465 723a 0a20  if unregister:. 
-00014110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014120: 2020 2020 2020 2069 6d61 6765 203d 206b         image = k
-00014130: 2e69 6e66 6f28 6e61 6d65 292e 6765 7428  .info(name).get(
-00014140: 2769 6d61 6765 2729 0a20 2020 2020 2020  'image').       
-00014150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014160: 2069 6620 2772 6865 6c27 2069 6e20 696d   if 'rhel' in im
-00014170: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
-00014180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014190: 2070 7072 696e 7428 6622 5265 6d6f 7669   pprint(f"Removi
-000141a0: 6e67 2072 6865 6c20 7375 6273 6372 6970  ng rhel subscrip
-000141b0: 7469 6f6e 2066 6f72 207b 6e61 6d65 7d22  tion for {name}"
-000141c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000141d0: 2020 2020 2020 2020 2020 2020 2020 6970                ip
-000141e0: 2c20 766d 706f 7274 203d 205f 7373 685f  , vmport = _ssh_
-000141f0: 6372 6564 656e 7469 616c 7328 6b2c 206e  credentials(k, n
-00014200: 616d 6529 5b31 3a5d 0a20 2020 2020 2020  ame)[1:].       
-00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014220: 2020 2020 2063 6d64 203d 2022 7375 6273       cmd = "subs
-00014230: 6372 6970 7469 6f6e 2d6d 616e 6167 6572  cription-manager
-00014240: 2075 6e72 6567 6973 7465 7222 0a20 2020   unregister".   
-00014250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014260: 2020 2020 2020 2020 2073 7368 636d 6420           sshcmd 
-00014270: 3d20 7373 6828 6e61 6d65 2c20 6970 3d69  = ssh(name, ip=i
-00014280: 702c 2075 7365 723d 2772 6f6f 7427 2c20  p, user='root', 
-00014290: 7475 6e6e 656c 3d73 656c 662e 7475 6e6e  tunnel=self.tunn
-000142a0: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
-000142b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142c0: 2020 2020 2020 2020 2020 2020 2074 756e               tun
-000142d0: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
-000142e0: 6e65 6c68 6f73 742c 2074 756e 6e65 6c70  nelhost, tunnelp
-000142f0: 6f72 743d 7365 6c66 2e74 756e 6e65 6c70  ort=self.tunnelp
-00014300: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-00014310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014320: 2020 2020 2020 2020 2020 2020 2020 7475                tu
-00014330: 6e6e 656c 7573 6572 3d73 656c 662e 7475  nneluser=self.tu
-00014340: 6e6e 656c 7573 6572 2c20 696e 7365 6375  nneluser, insecu
-00014350: 7265 3d54 7275 652c 2063 6d64 3d63 6d64  re=True, cmd=cmd
-00014360: 2c20 766d 706f 7274 3d76 6d70 6f72 7429  , vmport=vmport)
-00014370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014380: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-00014390: 7379 7374 656d 2873 7368 636d 6429 0a20  system(sshcmd). 
-000143a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143b0: 2020 2063 2e64 656c 6574 6528 6e61 6d65     c.delete(name
-000143c0: 2c20 736e 6170 7368 6f74 733d 5472 7565  , snapshots=True
-000143d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000143e0: 2020 2020 2020 6966 2064 6e73 636c 6965        if dnsclie
-000143f0: 6e74 2069 7320 6e6f 7420 4e6f 6e65 2061  nt is not None a
-00014400: 6e64 2064 6f6d 6169 6e20 6973 206e 6f74  nd domain is not
-00014410: 204e 6f6e 6520 616e 6420 646e 7363 6c69   None and dnscli
-00014420: 656e 7420 696e 2073 656c 662e 636c 6965  ent in self.clie
-00014430: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
-00014440: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00014450: 646e 7363 6c69 656e 7420 696e 2064 6e73  dnsclient in dns
-00014460: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
-00014470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014480: 2020 2020 207a 203d 2064 6e73 636c 6965       z = dnsclie
-00014490: 6e74 735b 646e 7363 6c69 656e 745d 0a20  nts[dnsclient]. 
-000144a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144b0: 2020 2020 2020 2065 6c69 6620 646e 7363         elif dnsc
-000144c0: 6c69 656e 7420 696e 2073 656c 662e 636c  lient in self.cl
-000144d0: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
-000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144f0: 2020 207a 203d 204b 636f 6e66 6967 2863     z = Kconfig(c
-00014500: 6c69 656e 743d 646e 7363 6c69 656e 7429  lient=dnsclient)
-00014510: 2e6b 0a20 2020 2020 2020 2020 2020 2020  .k.             
-00014520: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00014530: 6e73 636c 6965 6e74 735b 646e 7363 6c69  nsclients[dnscli
-00014540: 656e 745d 203d 207a 0a20 2020 2020 2020  ent] = z.       
-00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014560: 207a 2e64 656c 6574 655f 646e 7328 646e   z.delete_dns(dn
-00014570: 7363 6c69 656e 742c 2064 6f6d 6169 6e29  sclient, domain)
-00014580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014590: 2020 2020 2063 6f6d 6d6f 6e2e 6465 6c65       common.dele
-000145a0: 7465 5f6c 6173 7476 6d28 6e61 6d65 2c20  te_lastvm(name, 
-000145b0: 7365 6c66 2e63 6c69 656e 7429 0a20 2020  self.client).   
-000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145d0: 2073 7563 6365 7373 2866 227b 6e61 6d65   success(f"{name
-000145e0: 7d20 6465 6c65 7465 6420 6f6e 207b 6879  } deleted on {hy
-000145f0: 7065 7276 6973 6f72 7d21 2229 0a20 2020  pervisor}!").   
-00014600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014610: 2064 656c 6574 6564 766d 732e 6170 7065   deletedvms.appe
-00014620: 6e64 286e 616d 6529 0a20 2020 2020 2020  nd(name).       
-00014630: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-00014640: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-00014650: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00014660: 7573 7465 7220 3d20 766d 2e67 6574 2827  uster = vm.get('
-00014670: 6b75 6265 2729 0a20 2020 2020 2020 2020  kube').         
-00014680: 2020 2020 2020 2020 2020 2069 6620 636c             if cl
-00014690: 7573 7465 7220 6973 206e 6f74 204e 6f6e  uster is not Non
-000146a0: 6520 616e 6420 636c 7573 7465 7220 213d  e and cluster !=
-000146b0: 2027 273a 0a20 2020 2020 2020 2020 2020   '':.           
-000146c0: 2020 2020 2020 2020 2020 2020 2063 6c75               clu
-000146d0: 7374 6572 6469 7220 3d20 6f73 2e70 6174  sterdir = os.pat
-000146e0: 682e 6578 7061 6e64 7573 6572 2866 227e  h.expanduser(f"~
-000146f0: 2f2e 6b63 6c69 2f63 6c75 7374 6572 732f  /.kcli/clusters/
-00014700: 7b63 6c75 7374 6572 7d22 290a 2020 2020  {cluster}").    
-00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014720: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-00014730: 7869 7374 7328 636c 7573 7465 7264 6972  xists(clusterdir
-00014740: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00014750: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00014760: 6172 616d 6574 6572 7366 696c 6520 3d20  arametersfile = 
-00014770: 6622 7b63 6c75 7374 6572 6469 727d 2f6b  f"{clusterdir}/k
-00014780: 636c 695f 7061 7261 6d65 7465 7273 2e79  cli_parameters.y
-00014790: 6d6c 220a 2020 2020 2020 2020 2020 2020  ml".            
-000147a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147b0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-000147c0: 7328 7061 7261 6d65 7465 7273 6669 6c65  s(parametersfile
-000147d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000147e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147f0: 2020 2077 6974 6820 6f70 656e 2870 6172     with open(par
-00014800: 616d 6574 6572 7366 696c 6529 2061 7320  ametersfile) as 
-00014810: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014830: 2020 2020 2020 2063 6c75 7374 6572 6461         clusterda
-00014840: 7461 203d 2079 616d 6c2e 7361 6665 5f6c  ta = yaml.safe_l
-00014850: 6f61 6428 6629 0a20 2020 2020 2020 2020  oad(f).         
-00014860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014870: 2020 2020 2020 2020 2020 206b 7562 6574             kubet
-00014880: 7970 6520 3d20 636c 7573 7465 7264 6174  ype = clusterdat
-00014890: 612e 6765 7428 276b 7562 6574 7970 6527  a.get('kubetype'
-000148a0: 2c20 2767 656e 6572 6963 2729 0a20 2020  , 'generic').   
-000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148d0: 2069 6620 6b75 6265 7479 7065 203d 3d20   if kubetype == 
-000148e0: 2768 7970 6572 7368 6966 7427 3a0a 2020  'hypershift':.  
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014910: 2020 2020 2020 6879 7065 7273 6869 6674        hypershift
-00014920: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014950: 6173 7369 7374 6564 203d 2063 6c75 7374  assisted = clust
-00014960: 6572 6461 7461 2e67 6574 2861 7373 6973  erdata.get(assis
-00014970: 7465 642c 2046 616c 7365 290a 2020 2020  ted, False).    
-00014980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133d0: 2061 7070 6c69 6564 5f70 6172 616d 6574   applied_paramet
+000133e0: 6572 203d 206f 7665 7272 6964 6573 5b70  er = overrides[p
+000133f0: 6172 616d 6574 6572 5d20 6966 2070 6172  arameter] if par
+00013400: 616d 6574 6572 2069 6e20 6f76 6572 7269  ameter in overri
+00013410: 6465 7320 656c 7365 2070 6172 616d 6574  des else paramet
+00013420: 6572 735b 7061 7261 6d65 7465 725d 0a20  ers[parameter]. 
+00013430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013440: 2020 2070 7269 6e74 2866 2255 7369 6e67     print(f"Using
+00013450: 2070 6172 616d 6574 6572 207b 7061 7261   parameter {para
+00013460: 6d65 7465 727d 3a20 7b61 7070 6c69 6564  meter}: {applied
+00013470: 5f70 6172 616d 6574 6572 7d22 290a 2020  _parameter}").  
+00013480: 2020 2020 2020 2020 2020 6578 7472 6170            extrap
+00013490: 6172 616d 6574 6572 7320 3d20 6c69 7374  arameters = list
+000134a0: 2873 6574 286f 7665 7272 6964 6573 2920  (set(overrides) 
+000134b0: 2d20 7365 7428 7061 7261 6d65 7465 7273  - set(parameters
+000134c0: 2929 2069 6620 7061 7261 6d65 7465 7273  )) if parameters
+000134d0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+000134e0: 6520 6f76 6572 7269 6465 730a 2020 2020  e overrides.    
+000134f0: 2020 2020 2020 2020 666f 7220 7061 7261          for para
+00013500: 6d65 7465 7220 696e 2065 7874 7261 7061  meter in extrapa
+00013510: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
+00013520: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00013530: 2255 7369 6e67 2070 6172 616d 6574 6572  "Using parameter
+00013540: 2025 733a 2025 7322 2025 2028 7061 7261   %s: %s" % (para
+00013550: 6d65 7465 722c 206f 7665 7272 6964 6573  meter, overrides
+00013560: 5b70 6172 616d 6574 6572 5d29 290a 2020  [parameter])).  
+00013570: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00013580: 206c 6174 6573 743a 0a20 2020 2020 2020   latest:.       
+00013590: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+000135a0: 6622 5573 696e 6720 6469 7265 6374 6f72  f"Using director
+000135b0: 7920 7b72 6570 6f64 6972 7d22 290a 2020  y {repodir}").  
+000135c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000135d0: 6c66 2e70 6c61 6e28 706c 616e 2c20 7061  lf.plan(plan, pa
+000135e0: 7468 3d72 6570 6f64 6972 2c20 696e 7075  th=repodir, inpu
+000135f0: 7466 696c 653d 696e 7075 7466 696c 652c  tfile=inputfile,
+00013600: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00013610: 6964 6573 290a 2020 2020 2020 2020 2020  ides).          
+00013620: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00013630: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+00013640: 6174 655f 7265 706f 2872 6570 6f29 0a20  ate_repo(repo). 
+00013650: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013660: 656c 662e 706c 616e 2870 6c61 6e2c 2070  elf.plan(plan, p
+00013670: 6174 683d 7265 706f 6469 722c 2069 6e70  ath=repodir, inp
+00013680: 7574 6669 6c65 3d69 6e70 7574 6669 6c65  utfile=inputfile
+00013690: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+000136a0: 7269 6465 7329 0a20 2020 2020 2020 2020  rides).         
+000136b0: 2020 2070 7072 696e 7428 6622 5072 6f64     pprint(f"Prod
+000136c0: 7563 7420 6361 6e20 6265 2064 656c 6574  uct can be delet
+000136d0: 6564 2077 6974 683a 206b 636c 6920 6465  ed with: kcli de
+000136e0: 6c65 7465 2070 6c61 6e20 2d2d 7965 7320  lete plan --yes 
+000136f0: 7b70 6c61 6e7d 2229 0a20 2020 2020 2020  {plan}").       
+00013700: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+00013710: 273a 2027 7375 6363 6573 7327 2c20 2770  ': 'success', 'p
+00013720: 6c61 6e27 3a20 706c 616e 7d0a 0a20 2020  lan': plan}..   
+00013730: 2064 6566 2073 7461 7274 5f70 6c61 6e28   def start_plan(
+00013740: 7365 6c66 2c20 706c 616e 2c20 636f 6e74  self, plan, cont
+00013750: 6169 6e65 723d 4661 6c73 6529 3a0a 2020  ainer=False):.  
+00013760: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
+00013770: 0a20 2020 2020 2020 2073 7461 7274 666f  .        startfo
+00013780: 756e 6420 3d20 4661 6c73 650a 2020 2020  und = False.    
+00013790: 2020 2020 7070 7269 6e74 2866 2253 7461      pprint(f"Sta
+000137a0: 7274 696e 6720 766d 7320 6672 6f6d 2070  rting vms from p
+000137b0: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
+000137c0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+000137d0: 2e65 7874 7261 636c 6965 6e74 733a 0a20  .extraclients:. 
+000137e0: 2020 2020 2020 2020 2020 2073 7461 7274             start
+000137f0: 636c 6965 6e74 7320 3d20 7b73 656c 662e  clients = {self.
+00013800: 636c 6965 6e74 3a20 6b7d 0a20 2020 2020  client: k}.     
+00013810: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00013820: 2020 2020 2073 7461 7274 636c 6965 6e74       startclient
+00013830: 7320 3d20 7365 6c66 2e65 7874 7261 636c  s = self.extracl
+00013840: 6965 6e74 730a 2020 2020 2020 2020 2020  ients.          
+00013850: 2020 7374 6172 7463 6c69 656e 7473 2e75    startclients.u
+00013860: 7064 6174 6528 7b73 656c 662e 636c 6965  pdate({self.clie
+00013870: 6e74 3a20 6b7d 290a 2020 2020 2020 2020  nt: k}).        
+00013880: 666f 7220 6879 7065 7276 6973 6f72 2069  for hypervisor i
+00013890: 6e20 7374 6172 7463 6c69 656e 7473 3a0a  n startclients:.
+000138a0: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
+000138b0: 7374 6172 7463 6c69 656e 7473 5b68 7970  startclients[hyp
+000138c0: 6572 7669 736f 725d 0a20 2020 2020 2020  ervisor].       
+000138d0: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
+000138e0: 6f72 7465 6428 632e 6c69 7374 2829 2c20  orted(c.list(), 
+000138f0: 6b65 793d 6c61 6d62 6461 2078 3a20 785b  key=lambda x: x[
+00013900: 276e 616d 6527 5d29 3a0a 2020 2020 2020  'name']):.      
+00013910: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+00013920: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
+00013930: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+00013940: 7269 7074 696f 6e20 3d20 766d 2e67 6574  ription = vm.get
+00013950: 2827 706c 616e 2729 0a20 2020 2020 2020  ('plan').       
+00013960: 2020 2020 2020 2020 2069 6620 6465 7363           if desc
+00013970: 7269 7074 696f 6e20 3d3d 2070 6c61 6e3a  ription == plan:
+00013980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013990: 2020 2020 2073 7461 7274 666f 756e 6420       startfound 
+000139a0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+000139b0: 2020 2020 2020 2020 2020 2063 2e73 7461             c.sta
+000139c0: 7274 286e 616d 6529 0a20 2020 2020 2020  rt(name).       
+000139d0: 2020 2020 2020 2020 2020 2020 2073 7563               suc
+000139e0: 6365 7373 2866 227b 6e61 6d65 7d20 7374  cess(f"{name} st
+000139f0: 6172 7465 6420 6f6e 207b 6879 7065 7276  arted on {hyperv
+00013a00: 6973 6f72 7d21 2229 0a20 2020 2020 2020  isor}!").       
+00013a10: 2069 6620 636f 6e74 6169 6e65 723a 0a20   if container:. 
+00013a20: 2020 2020 2020 2020 2020 2063 6f6e 7420             cont 
+00013a30: 3d20 4b63 6f6e 7461 696e 6572 636f 6e66  = Kcontainerconf
+00013a40: 6967 2873 656c 662c 2063 6c69 656e 743d  ig(self, client=
+00013a50: 7365 6c66 2e63 6f6e 7461 696e 6572 636c  self.containercl
+00013a60: 6965 6e74 292e 636f 6e74 0a20 2020 2020  ient).cont.     
+00013a70: 2020 2020 2020 2066 6f72 2063 6f6e 7461         for conta
+00013a80: 2069 6e20 736f 7274 6564 2863 6f6e 742e   in sorted(cont.
+00013a90: 6c69 7374 5f63 6f6e 7461 696e 6572 7328  list_containers(
+00013aa0: 6b29 293a 0a20 2020 2020 2020 2020 2020  k)):.           
+00013ab0: 2020 2020 206e 616d 6520 3d20 636f 6e74       name = cont
+00013ac0: 615b 305d 0a20 2020 2020 2020 2020 2020  a[0].           
+00013ad0: 2020 2020 2063 6f6e 7461 696e 6572 706c       containerpl
+00013ae0: 616e 203d 2063 6f6e 7461 5b33 5d0a 2020  an = conta[3].  
+00013af0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00013b00: 2063 6f6e 7461 696e 6572 706c 616e 203d   containerplan =
+00013b10: 3d20 706c 616e 3a0a 2020 2020 2020 2020  = plan:.        
+00013b20: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00013b30: 7466 6f75 6e64 203d 2054 7275 650a 2020  tfound = True.  
+00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b50: 2020 636f 6e74 2e73 7461 7274 5f63 6f6e    cont.start_con
+00013b60: 7461 696e 6572 286e 616d 6529 0a20 2020  tainer(name).   
+00013b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b80: 2073 7563 6365 7373 2866 2243 6f6e 7461   success(f"Conta
+00013b90: 696e 6572 207b 6e61 6d65 7d20 7374 6172  iner {name} star
+00013ba0: 7465 6421 2229 0a20 2020 2020 2020 2069  ted!").        i
+00013bb0: 6620 7374 6172 7466 6f75 6e64 3a0a 2020  f startfound:.  
+00013bc0: 2020 2020 2020 2020 2020 7375 6363 6573            succes
+00013bd0: 7328 6622 506c 616e 207b 706c 616e 7d20  s(f"Plan {plan} 
+00013be0: 7374 6172 7465 6421 2229 0a20 2020 2020  started!").     
+00013bf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00013c00: 2020 2020 2077 6172 6e69 6e67 2822 4e6f       warning("No
+00013c10: 206d 6174 6368 696e 6720 6f62 6a65 6374   matching object
+00013c20: 7320 666f 756e 6422 290a 2020 2020 2020  s found").      
+00013c30: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+00013c40: 7427 3a20 2773 7563 6365 7373 277d 0a0a  t': 'success'}..
+00013c50: 2020 2020 6465 6620 7374 6f70 5f70 6c61      def stop_pla
+00013c60: 6e28 7365 6c66 2c20 706c 616e 2c20 736f  n(self, plan, so
+00013c70: 6674 3d46 616c 7365 2c20 636f 6e74 6169  ft=False, contai
+00013c80: 6e65 723d 4661 6c73 6529 3a0a 2020 2020  ner=False):.    
+00013c90: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
+00013ca0: 2020 2020 2020 2073 746f 7066 6f75 6e64         stopfound
+00013cb0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00013cc0: 7070 7269 6e74 2866 2253 746f 7070 696e  pprint(f"Stoppin
+00013cd0: 6720 766d 7320 6672 6f6d 2070 6c61 6e20  g vms from plan 
+00013ce0: 7b70 6c61 6e7d 2229 0a20 2020 2020 2020  {plan}").       
+00013cf0: 2069 6620 6e6f 7420 7365 6c66 2e65 7874   if not self.ext
+00013d00: 7261 636c 6965 6e74 733a 0a20 2020 2020  raclients:.     
+00013d10: 2020 2020 2020 2073 746f 7063 6c69 656e         stopclien
+00013d20: 7473 203d 207b 7365 6c66 2e63 6c69 656e  ts = {self.clien
+00013d30: 743a 206b 7d0a 2020 2020 2020 2020 656c  t: k}.        el
+00013d40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00013d50: 7374 6f70 636c 6965 6e74 7320 3d20 7365  stopclients = se
+00013d60: 6c66 2e65 7874 7261 636c 6965 6e74 730a  lf.extraclients.
+00013d70: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+00013d80: 636c 6965 6e74 732e 7570 6461 7465 287b  clients.update({
+00013d90: 7365 6c66 2e63 6c69 656e 743a 206b 7d29  self.client: k})
+00013da0: 0a20 2020 2020 2020 2066 6f72 2068 7970  .        for hyp
+00013db0: 6572 7669 736f 7220 696e 2073 746f 7063  ervisor in stopc
+00013dc0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+00013dd0: 2020 2020 6320 3d20 7374 6f70 636c 6965      c = stopclie
+00013de0: 6e74 735b 6879 7065 7276 6973 6f72 5d0a  nts[hypervisor].
+00013df0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013e00: 766d 2069 6e20 736f 7274 6564 2863 2e6c  vm in sorted(c.l
+00013e10: 6973 7428 292c 206b 6579 3d6c 616d 6264  ist(), key=lambd
+00013e20: 6120 783a 2078 5b27 6e61 6d65 275d 293a  a x: x['name']):
+00013e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013e40: 206e 616d 6520 3d20 766d 5b27 6e61 6d65   name = vm['name
+00013e50: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00013e60: 2020 2064 6573 6372 6970 7469 6f6e 203d     description =
+00013e70: 2076 6d2e 6765 7428 2770 6c61 6e27 290a   vm.get('plan').
+00013e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e90: 6966 2064 6573 6372 6970 7469 6f6e 203d  if description =
+00013ea0: 3d20 706c 616e 3a0a 2020 2020 2020 2020  = plan:.        
+00013eb0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+00013ec0: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
+00013ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ee0: 2063 2e73 746f 7028 6e61 6d65 2c20 736f   c.stop(name, so
+00013ef0: 6674 3d73 6f66 7429 0a20 2020 2020 2020  ft=soft).       
+00013f00: 2020 2020 2020 2020 2020 2020 2073 7563               suc
+00013f10: 6365 7373 2866 227b 6e61 6d65 7d20 7374  cess(f"{name} st
+00013f20: 6f70 7065 6420 6f6e 207b 6879 7065 7276  opped on {hyperv
+00013f30: 6973 6f72 7d21 2229 0a20 2020 2020 2020  isor}!").       
+00013f40: 2069 6620 636f 6e74 6169 6e65 723a 0a20   if container:. 
+00013f50: 2020 2020 2020 2020 2020 2063 6f6e 7420             cont 
+00013f60: 3d20 4b63 6f6e 7461 696e 6572 636f 6e66  = Kcontainerconf
+00013f70: 6967 2873 656c 662c 2063 6c69 656e 743d  ig(self, client=
+00013f80: 7365 6c66 2e63 6f6e 7461 696e 6572 636c  self.containercl
+00013f90: 6965 6e74 292e 636f 6e74 0a20 2020 2020  ient).cont.     
+00013fa0: 2020 2020 2020 2066 6f72 2063 6f6e 7461         for conta
+00013fb0: 2069 6e20 736f 7274 6564 2863 6f6e 742e   in sorted(cont.
+00013fc0: 6c69 7374 5f63 6f6e 7461 696e 6572 7328  list_containers(
+00013fd0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00013fe0: 2020 2020 6e61 6d65 203d 2063 6f6e 7461      name = conta
+00013ff0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00014000: 2020 2020 636f 6e74 6169 6e65 7270 6c61      containerpla
+00014010: 6e20 3d20 636f 6e74 615b 335d 0a20 2020  n = conta[3].   
+00014020: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00014030: 636f 6e74 6169 6e65 7270 6c61 6e20 3d3d  containerplan ==
+00014040: 2070 6c61 6e3a 0a20 2020 2020 2020 2020   plan:.         
+00014050: 2020 2020 2020 2020 2020 2073 746f 7066             stopf
+00014060: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014080: 636f 6e74 2e73 746f 705f 636f 6e74 6169  cont.stop_contai
+00014090: 6e65 7228 6e61 6d65 290a 2020 2020 2020  ner(name).      
+000140a0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+000140b0: 6363 6573 7328 6622 436f 6e74 6169 6e65  ccess(f"Containe
+000140c0: 7220 7b6e 616d 657d 2073 746f 7070 6564  r {name} stopped
+000140d0: 2122 290a 2020 2020 2020 2020 6966 2073  !").        if s
+000140e0: 746f 7066 6f75 6e64 3a0a 2020 2020 2020  topfound:.      
+000140f0: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+00014100: 506c 616e 207b 706c 616e 7d20 7374 6f70  Plan {plan} stop
+00014110: 7065 6421 2229 0a20 2020 2020 2020 2065  ped!").        e
+00014120: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00014130: 2077 6172 6e69 6e67 2822 4e6f 206d 6174   warning("No mat
+00014140: 6368 696e 6720 6f62 6a65 6374 7320 666f  ching objects fo
+00014150: 756e 6422 290a 2020 2020 2020 2020 7265  und").        re
+00014160: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00014170: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
+00014180: 6465 6620 6175 746f 7374 6172 745f 706c  def autostart_pl
+00014190: 616e 2873 656c 662c 2070 6c61 6e29 3a0a  an(self, plan):.
+000141a0: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
+000141b0: 2e6b 0a20 2020 2020 2020 2070 7072 696e  .k.        pprin
+000141c0: 7428 6622 5365 7420 766d 7320 6672 6f6d  t(f"Set vms from
+000141d0: 2070 6c61 6e20 7b70 6c61 6e7d 2074 6f20   plan {plan} to 
+000141e0: 6175 746f 7374 6172 7422 290a 2020 2020  autostart").    
+000141f0: 2020 2020 666f 7220 766d 2069 6e20 736f      for vm in so
+00014200: 7274 6564 286b 2e6c 6973 7428 292c 206b  rted(k.list(), k
+00014210: 6579 3d6c 616d 6264 6120 783a 2078 5b27  ey=lambda x: x['
+00014220: 6e61 6d65 275d 293a 0a20 2020 2020 2020  name']):.       
+00014230: 2020 2020 206e 616d 6520 3d20 766d 5b27       name = vm['
+00014240: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
+00014250: 2020 2064 6573 6372 6970 7469 6f6e 203d     description =
+00014260: 2076 6d5b 2770 6c61 6e27 5d0a 2020 2020   vm['plan'].    
+00014270: 2020 2020 2020 2020 6966 2064 6573 6372          if descr
+00014280: 6970 7469 6f6e 203d 3d20 706c 616e 3a0a  iption == plan:.
+00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142a0: 6b2e 7570 6461 7465 5f73 7461 7274 286e  k.update_start(n
+000142b0: 616d 652c 2073 7461 7274 3d54 7275 6529  ame, start=True)
+000142c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000142d0: 2073 7563 6365 7373 2866 227b 6e61 6d65   success(f"{name
+000142e0: 7d20 7365 7420 746f 2061 7574 6f73 7461  } set to autosta
+000142f0: 7274 2122 290a 2020 2020 2020 2020 7265  rt!").        re
+00014300: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00014310: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
+00014320: 6465 6620 6e6f 6175 746f 7374 6172 745f  def noautostart_
+00014330: 706c 616e 2873 656c 662c 2070 6c61 6e29  plan(self, plan)
+00014340: 3a0a 2020 2020 2020 2020 6b20 3d20 7365  :.        k = se
+00014350: 6c66 2e6b 0a20 2020 2020 2020 2070 7072  lf.k.        ppr
+00014360: 696e 7428 6622 5072 6576 656e 7469 6e67  int(f"Preventing
+00014370: 2076 6d73 2066 726f 6d20 706c 616e 207b   vms from plan {
+00014380: 706c 616e 7d20 746f 2061 7574 6f73 7461  plan} to autosta
+00014390: 7274 2229 0a20 2020 2020 2020 2066 6f72  rt").        for
+000143a0: 2076 6d20 696e 2073 6f72 7465 6428 6b2e   vm in sorted(k.
+000143b0: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
+000143c0: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
+000143d0: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+000143e0: 6d65 203d 2076 6d5b 276e 616d 6527 5d0a  me = vm['name'].
+000143f0: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+00014400: 7269 7074 696f 6e20 3d20 766d 5b27 706c  ription = vm['pl
+00014410: 616e 275d 0a20 2020 2020 2020 2020 2020  an'].           
+00014420: 2069 6620 6465 7363 7269 7074 696f 6e20   if description 
+00014430: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
+00014440: 2020 2020 2020 2020 206b 2e75 7064 6174           k.updat
+00014450: 655f 7374 6172 7428 6e61 6d65 2c20 7374  e_start(name, st
+00014460: 6172 743d 4661 6c73 6529 0a20 2020 2020  art=False).     
+00014470: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+00014480: 7373 2866 227b 6e61 6d65 7d20 7072 6576  ss(f"{name} prev
+00014490: 656e 7465 6420 746f 2061 7574 6f73 7461  ented to autosta
+000144a0: 7274 2122 290a 2020 2020 2020 2020 7265  rt!").        re
+000144b0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+000144c0: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
+000144d0: 6465 6620 6465 6c65 7465 5f70 6c61 6e28  def delete_plan(
+000144e0: 7365 6c66 2c20 706c 616e 2c20 636f 6e74  self, plan, cont
+000144f0: 6169 6e65 723d 4661 6c73 652c 2075 6e72  ainer=False, unr
+00014500: 6567 6973 7465 723d 4661 6c73 6529 3a0a  egister=False):.
+00014510: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
+00014520: 2e6b 0a20 2020 2020 2020 2064 656c 6574  .k.        delet
+00014530: 6564 766d 7320 3d20 5b5d 0a20 2020 2020  edvms = [].     
+00014540: 2020 2064 656c 6574 6564 6c62 7320 3d20     deletedlbs = 
+00014550: 5b5d 0a20 2020 2020 2020 2064 6e73 636c  [].        dnscl
+00014560: 6965 6e74 7320 3d20 5b5d 0a20 2020 2020  ients = [].     
+00014570: 2020 206e 6574 776f 726b 7320 3d20 5b5d     networks = []
+00014580: 0a20 2020 2020 2020 2069 6620 706c 616e  .        if plan
+00014590: 203d 3d20 2727 3a0a 2020 2020 2020 2020   == '':.        
+000145a0: 2020 2020 6572 726f 7228 2254 6861 7420      error("That 
+000145b0: 776f 756c 6420 6465 6c65 7465 2065 7665  would delete eve
+000145c0: 7279 2076 6d2e 2e2e 4e6f 7420 646f 696e  ry vm...Not doin
+000145d0: 6720 7468 6174 2229 0a20 2020 2020 2020  g that").       
+000145e0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+000145f0: 0a20 2020 2020 2020 2066 6f75 6e64 203d  .        found =
+00014600: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+00014610: 656c 6574 6563 6c69 656e 7473 203d 207b  eleteclients = {
+00014620: 7365 6c66 2e63 6c69 656e 743a 206b 7d0a  self.client: k}.
+00014630: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
+00014640: 7320 3d20 5b5d 0a20 2020 2020 2020 2076  s = [].        v
+00014650: 6d63 6c69 656e 7473 5f66 696c 6520 3d20  mclients_file = 
+00014660: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+00014670: 6572 2866 277e 2f2e 6b63 6c69 2f76 6d63  er(f'~/.kcli/vmc
+00014680: 6c69 656e 7473 5f7b 706c 616e 7d27 290a  lients_{plan}').
+00014690: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+000146a0: 7468 2e65 7869 7374 7328 766d 636c 6965  th.exists(vmclie
+000146b0: 6e74 735f 6669 6c65 293a 0a20 2020 2020  nts_file):.     
+000146c0: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
+000146d0: 203d 2079 616d 6c2e 7361 6665 5f6c 6f61   = yaml.safe_loa
+000146e0: 6428 6f70 656e 2876 6d63 6c69 656e 7473  d(open(vmclients
+000146f0: 5f66 696c 6529 290a 2020 2020 2020 2020  _file)).        
+00014700: 2020 2020 6f73 2e72 656d 6f76 6528 766d      os.remove(vm
+00014710: 636c 6965 6e74 735f 6669 6c65 290a 2020  clients_file).  
+00014720: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
+00014730: 7472 6163 6c69 656e 7473 3a0a 2020 2020  traclients:.    
+00014740: 2020 2020 2020 2020 6465 6c65 7465 636c          deletecl
+00014750: 6965 6e74 732e 7570 6461 7465 2873 656c  ients.update(sel
+00014760: 662e 6578 7472 6163 6c69 656e 7473 290a  f.extraclients).
+00014770: 2020 2020 2020 2020 656c 6966 2076 6d63          elif vmc
+00014780: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+00014790: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
+000147a0: 732e 7570 6461 7465 287b 636c 693a 204b  s.update({cli: K
+000147b0: 636f 6e66 6967 2863 6c69 656e 743d 636c  config(client=cl
+000147c0: 6929 2e6b 2066 6f72 2063 6c69 2069 6e20  i).k for cli in 
+000147d0: 766d 636c 6965 6e74 7320 6966 2063 6c69  vmclients if cli
+000147e0: 2021 3d20 7365 6c66 2e63 6c69 656e 747d   != self.client}
+000147f0: 290a 2020 2020 2020 2020 6879 7065 7273  ).        hypers
+00014800: 6869 6674 203d 2046 616c 7365 0a20 2020  hift = False.   
+00014810: 2020 2020 2061 7373 6973 7465 6420 3d20       assisted = 
+00014820: 4661 6c73 650a 2020 2020 2020 2020 616b  False.        ak
+00014830: 7320 3d20 4661 6c73 650a 2020 2020 2020  s = False.      
+00014840: 2020 656b 7320 3d20 4661 6c73 650a 2020    eks = False.  
+00014850: 2020 2020 2020 676b 6520 3d20 4661 6c73        gke = Fals
+00014860: 650a 2020 2020 2020 2020 636c 7573 7465  e.        cluste
+00014870: 7264 6972 203d 2022 2f66 616b 652f 7878  rdir = "/fake/xx
+00014880: 7822 0a20 2020 2020 2020 2066 6f72 2068  x".        for h
+00014890: 7970 6572 7669 736f 7220 696e 2064 656c  ypervisor in del
+000148a0: 6574 6563 6c69 656e 7473 3a0a 2020 2020  eteclients:.    
+000148b0: 2020 2020 2020 2020 6320 3d20 6465 6c65          c = dele
+000148c0: 7465 636c 6965 6e74 735b 6879 7065 7276  teclients[hyperv
+000148d0: 6973 6f72 5d0a 2020 2020 2020 2020 2020  isor].          
+000148e0: 2020 666f 7220 766d 2069 6e20 736f 7274    for vm in sort
+000148f0: 6564 2863 2e6c 6973 7428 292c 206b 6579  ed(c.list(), key
+00014900: 3d6c 616d 6264 6120 783a 2078 5b27 6e61  =lambda x: x['na
+00014910: 6d65 275d 293a 0a20 2020 2020 2020 2020  me']):.         
+00014920: 2020 2020 2020 206e 616d 6520 3d20 766d         name = vm
+00014930: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
+00014940: 2020 2020 2020 2020 2064 6573 6372 6970           descrip
+00014950: 7469 6f6e 203d 2076 6d2e 6765 7428 2770  tion = vm.get('p
+00014960: 6c61 6e27 290a 2020 2020 2020 2020 2020  lan').          
+00014970: 2020 2020 2020 6966 2064 6573 6372 6970        if descrip
+00014980: 7469 6f6e 203d 3d20 706c 616e 3a0a 2020  tion == plan:.  
 00014990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149a0: 646f 6d61 696e 203d 2063 6c75 7374 6572  domain = cluster
-000149b0: 6461 7461 2e67 6574 2827 646f 6d61 696e  data.get('domain
-000149c0: 272c 2064 6f6d 6169 6e29 0a20 2020 2020  ', domain).     
-000149d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000149f0: 6e73 636c 6965 6e74 203d 2063 6c75 7374  nsclient = clust
-00014a00: 6572 6461 7461 2e67 6574 2827 646e 7363  erdata.get('dnsc
-00014a10: 6c69 656e 7427 290a 2020 2020 2020 2020  lient').        
-00014a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a30: 2020 2020 2020 2020 2020 2020 676b 6520              gke 
-00014a40: 3d20 6b75 6265 7479 7065 203d 3d20 2767  = kubetype == 'g
-00014a50: 6b65 270a 2020 2020 2020 2020 2020 2020  ke'.            
-00014a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a70: 2020 2020 2020 2020 656b 7320 3d20 6b75          eks = ku
-00014a80: 6265 7479 7065 203d 3d20 2765 6b73 270a  betype == 'eks'.
-00014a90: 2020 2020 2020 2020 6966 2068 7970 6572          if hyper
-00014aa0: 7368 6966 743a 0a20 2020 2020 2020 2020  shift:.         
-00014ab0: 2020 206b 7562 6563 6f6e 6669 676d 676d     kubeconfigmgm
-00014ac0: 7420 3d20 6622 7b63 6c75 7374 6572 6469  t = f"{clusterdi
-00014ad0: 727d 2f6b 7562 6563 6f6e 6669 672e 6d67  r}/kubeconfig.mg
-00014ae0: 6d74 220a 2020 2020 2020 2020 2020 2020  mt".            
-00014af0: 6361 6c6c 2866 274b 5542 4543 4f4e 4649  call(f'KUBECONFI
-00014b00: 473d 7b6b 7562 6563 6f6e 6669 676d 676d  G={kubeconfigmgm
-00014b10: 747d 206f 6320 6465 6c65 7465 202d 6620  t} oc delete -f 
-00014b20: 7b63 6c75 7374 6572 6469 727d 2f61 7574  {clusterdir}/aut
-00014b30: 6f61 7070 726f 7665 7263 726f 6e2e 796d  oapprovercron.ym
-00014b40: 6c27 2c20 7368 656c 6c3d 5472 7565 290a  l', shell=True).
-00014b50: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00014b60: 2866 274b 5542 4543 4f4e 4649 473d 7b6b  (f'KUBECONFIG={k
-00014b70: 7562 6563 6f6e 6669 676d 676d 747d 206f  ubeconfigmgmt} o
-00014b80: 6320 6465 6c65 7465 202d 6620 7b63 6c75  c delete -f {clu
-00014b90: 7374 6572 6469 727d 2f6e 6f64 6570 6f6f  sterdir}/nodepoo
-00014ba0: 6c2e 7961 6d6c 272c 2073 6865 6c6c 3d54  l.yaml', shell=T
-00014bb0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00014bc0: 2063 616c 6c28 6627 4b55 4245 434f 4e46   call(f'KUBECONF
-00014bd0: 4947 3d7b 6b75 6265 636f 6e66 6967 6d67  IG={kubeconfigmg
-00014be0: 6d74 7d20 6f63 2064 656c 6574 6520 2d66  mt} oc delete -f
-00014bf0: 207b 636c 7573 7465 7264 6972 7d2f 686f   {clusterdir}/ho
-00014c00: 7374 6564 636c 7573 7465 722e 7961 6d6c  stedcluster.yaml
-00014c10: 272c 2073 6865 6c6c 3d54 7275 6529 0a20  ', shell=True). 
-00014c20: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00014c30: 7420 6173 7369 7374 6564 2061 6e64 2028  t assisted and (
-00014c40: 2762 6172 656d 6574 616c 5f69 736f 2720  'baremetal_iso' 
-00014c50: 696e 2063 6c75 7374 6572 6461 7461 206f  in clusterdata o
-00014c60: 7220 2762 6172 656d 6574 616c 5f68 6f73  r 'baremetal_hos
-00014c70: 7473 2720 696e 2063 6c75 7374 6572 6461  ts' in clusterda
-00014c80: 7461 293a 0a20 2020 2020 2020 2020 2020  ta):.           
-00014c90: 2020 2020 2063 616c 6c28 274b 5542 4543       call('KUBEC
-00014ca0: 4f4e 4649 473d 7b6b 7562 6563 6f6e 6669  ONFIG={kubeconfi
-00014cb0: 676d 676d 747d 206f 6320 2d6e 2064 6566  gmgmt} oc -n def
-00014cc0: 6175 6c74 2064 656c 6574 6520 616c 6c20  ault delete all 
-00014cd0: 2d6c 2061 7070 3d68 7474 7064 2d6b 636c  -l app=httpd-kcl
-00014ce0: 6927 2c20 7368 656c 6c3d 5472 7565 290a  i', shell=True).
+000149a0: 2020 6966 2076 6d2e 6765 7428 276b 7562    if vm.get('kub
+000149b0: 6574 7970 6527 2c20 2767 656e 6572 6963  etype', 'generic
+000149c0: 2729 2069 6e20 5b27 616b 7327 2c20 2765  ') in ['aks', 'e
+000149d0: 6b73 272c 2027 676b 6527 5d3a 0a20 2020  ks', 'gke']:.   
+000149e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149f0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00014a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a10: 2020 6966 2027 6c6f 6164 6261 6c61 6e63    if 'loadbalanc
+00014a20: 6572 2720 696e 2076 6d3a 0a20 2020 2020  er' in vm:.     
+00014a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a40: 2020 206c 6273 203d 2076 6d5b 276c 6f61     lbs = vm['loa
+00014a50: 6462 616c 616e 6365 7227 5d2e 7370 6c69  dbalancer'].spli
+00014a60: 7428 272c 2729 0a20 2020 2020 2020 2020  t(',').         
+00014a70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014a80: 6f72 206c 6220 696e 206c 6273 3a0a 2020  or lb in lbs:.  
+00014a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014aa0: 2020 2020 2020 2020 2020 6966 206c 6220            if lb 
+00014ab0: 6e6f 7420 696e 2064 656c 6574 6564 6c62  not in deletedlb
+00014ac0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00014ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ae0: 2020 2064 656c 6574 6564 6c62 732e 6170     deletedlbs.ap
+00014af0: 7065 6e64 286c 6229 0a20 2020 2020 2020  pend(lb).       
+00014b00: 2020 2020 2020 2020 2020 2020 2076 6d6e               vmn
+00014b10: 6574 776f 726b 7320 3d20 632e 766d 5f70  etworks = c.vm_p
+00014b20: 6f72 7473 286e 616d 6529 0a20 2020 2020  orts(name).     
+00014b30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014b40: 6f72 206e 6574 776f 726b 2069 6e20 766d  or network in vm
+00014b50: 6e65 7477 6f72 6b73 3a0a 2020 2020 2020  networks:.      
+00014b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b70: 2020 6966 206e 6574 776f 726b 2021 3d20    if network != 
+00014b80: 2764 6566 6175 6c74 2720 616e 6420 6e65  'default' and ne
+00014b90: 7477 6f72 6b20 6e6f 7420 696e 206e 6574  twork not in net
+00014ba0: 776f 726b 733a 0a20 2020 2020 2020 2020  works:.         
+00014bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bc0: 2020 206e 6574 776f 726b 732e 6170 7065     networks.appe
+00014bd0: 6e64 286e 6574 776f 726b 290a 2020 2020  nd(network).    
+00014be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bf0: 646e 7363 6c69 656e 742c 2064 6f6d 6169  dnsclient, domai
+00014c00: 6e20 3d20 632e 646e 7369 6e66 6f28 6e61  n = c.dnsinfo(na
+00014c10: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00014c20: 2020 2020 2020 2020 6966 2075 6e72 6567          if unreg
+00014c30: 6973 7465 723a 0a20 2020 2020 2020 2020  ister:.         
+00014c40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014c50: 6d61 6765 203d 206b 2e69 6e66 6f28 6e61  mage = k.info(na
+00014c60: 6d65 292e 6765 7428 2769 6d61 6765 2729  me).get('image')
+00014c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c80: 2020 2020 2020 2020 2069 6620 2772 6865           if 'rhe
+00014c90: 6c27 2069 6e20 696d 6167 653a 0a20 2020  l' in image:.   
+00014ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cb0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00014cc0: 6622 5265 6d6f 7669 6e67 2072 6865 6c20  f"Removing rhel 
+00014cd0: 7375 6273 6372 6970 7469 6f6e 2066 6f72  subscription for
+00014ce0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
 00014cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d00: 6361 6c6c 2827 4b55 4245 434f 4e46 4947  call('KUBECONFIG
-00014d10: 3d7b 6b75 6265 636f 6e66 6967 6d67 6d74  ={kubeconfigmgmt
-00014d20: 7d20 6f63 202d 6e20 6465 6661 756c 7420  } oc -n default 
-00014d30: 6465 6c65 7465 2073 7663 2068 7474 7064  delete svc httpd
-00014d40: 2d6b 636c 692d 7376 6327 2c20 7368 656c  -kcli-svc', shel
-00014d50: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-00014d60: 2020 2020 2020 2020 6361 6c6c 2827 4b55          call('KU
-00014d70: 4245 434f 4e46 4947 3d7b 6b75 6265 636f  BECONFIG={kubeco
-00014d80: 6e66 6967 6d67 6d74 7d20 6f63 202d 6e20  nfigmgmt} oc -n 
-00014d90: 6465 6661 756c 7420 6465 6c65 7465 2070  default delete p
-00014da0: 7663 2068 7474 7064 2d6b 636c 692d 7076  vc httpd-kcli-pv
-00014db0: 6327 2c20 7368 656c 6c3d 5472 7565 290a  c', shell=True).
-00014dc0: 2020 2020 2020 2020 6966 2067 6b65 3a0a          if gke:.
-00014dd0: 2020 2020 2020 2020 2020 2020 6763 7063              gcpc
-00014de0: 6c69 656e 7420 3d20 4e6f 6e65 0a20 2020  lient = None.   
-00014df0: 2020 2020 2020 2020 2069 6620 2763 6c69           if 'cli
-00014e00: 656e 7427 2069 6e20 636c 7573 7465 7264  ent' in clusterd
-00014e10: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-00014e20: 2020 2020 2067 6370 636c 6965 6e74 203d       gcpclient =
-00014e30: 2063 6c75 7374 6572 6461 7461 5b27 636c   clusterdata['cl
-00014e40: 6965 6e74 275d 0a20 2020 2020 2020 2020  ient'].         
-00014e50: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
-00014e60: 6520 3d3d 2027 676b 6527 3a0a 2020 2020  e == 'gke':.    
-00014e70: 2020 2020 2020 2020 2020 2020 6763 7063              gcpc
-00014e80: 6c69 656e 7420 3d20 7365 6c66 2e63 6c69  lient = self.cli
-00014e90: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
-00014ea0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00014eb0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-00014ec0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
-00014ed0: 272c 2027 7265 6173 6f6e 273a 2022 4465  ', 'reason': "De
-00014ee0: 6c65 7469 6e67 2067 6b65 2063 6c75 7374  leting gke clust
-00014ef0: 6572 2072 6571 7569 7265 7320 746f 2069  er requires to i
-00014f00: 6e73 7461 6e74 6961 7465 2067 6370 2070  nstantiate gcp p
-00014f10: 726f 7669 6465 7222 7d0a 2020 2020 2020  rovider"}.      
-00014f20: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
-00014f30: 2e63 6c75 7374 6572 2069 6d70 6f72 7420  .cluster import 
-00014f40: 676b 650a 2020 2020 2020 2020 2020 2020  gke.            
-00014f50: 6375 7272 656e 7463 6f6e 6669 6720 3d20  currentconfig = 
-00014f60: 4b63 6f6e 6669 6728 636c 6965 6e74 3d67  Kconfig(client=g
-00014f70: 6370 636c 6965 6e74 292e 6b20 6966 2067  cpclient).k if g
-00014f80: 6370 636c 6965 6e74 2021 3d20 7365 6c66  cpclient != self
-00014f90: 2e63 6c69 656e 7420 656c 7365 2073 656c  .client else sel
-00014fa0: 660a 2020 2020 2020 2020 2020 2020 7a6f  f.            zo
-00014fb0: 6e61 6c20 3d20 636c 7573 7465 7264 6174  nal = clusterdat
-00014fc0: 612e 6765 7428 277a 6f6e 616c 272c 2054  a.get('zonal', T
-00014fd0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00014fe0: 2067 6b65 2e64 656c 6574 6528 6375 7272   gke.delete(curr
-00014ff0: 656e 7463 6f6e 6669 672c 2063 6c75 7374  entconfig, clust
-00015000: 6572 2c20 7a6f 6e61 6c29 0a20 2020 2020  er, zonal).     
-00015010: 2020 2065 6c69 6620 656b 733a 0a20 2020     elif eks:.   
-00015020: 2020 2020 2020 2020 2065 6b73 636c 6965           eksclie
-00015030: 6e74 203d 204e 6f6e 650a 2020 2020 2020  nt = None.      
-00015040: 2020 2020 2020 6966 2027 636c 6965 6e74        if 'client
-00015050: 2720 696e 2063 6c75 7374 6572 6461 7461  ' in clusterdata
-00015060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015070: 2020 656b 7363 6c69 656e 7420 3d20 636c    eksclient = cl
-00015080: 7573 7465 7264 6174 615b 2763 6c69 656e  usterdata['clien
-00015090: 7427 5d0a 2020 2020 2020 2020 2020 2020  t'].            
-000150a0: 656c 6966 2073 656c 662e 7479 7065 203d  elif self.type =
-000150b0: 3d20 2761 7773 273a 0a20 2020 2020 2020  = 'aws':.       
-000150c0: 2020 2020 2020 2020 2065 6b73 636c 6965           eksclie
-000150d0: 6e74 203d 2073 656c 662e 636c 6965 6e74  nt = self.client
-000150e0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000150f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00015100: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-00015110: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
-00015120: 2772 6561 736f 6e27 3a20 2244 656c 6574  'reason': "Delet
-00015130: 696e 6720 656b 7320 636c 7573 7465 7220  ing eks cluster 
-00015140: 7265 7175 6972 6573 2074 6f20 696e 7374  requires to inst
-00015150: 616e 7469 6174 6520 6763 7020 7072 6f76  antiate gcp prov
-00015160: 6964 6572 227d 0a20 2020 2020 2020 2020  ider"}.         
-00015170: 2020 2066 726f 6d20 6b76 6972 742e 636c     from kvirt.cl
-00015180: 7573 7465 7220 696d 706f 7274 2065 6b73  uster import eks
-00015190: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-000151a0: 7265 6e74 636f 6e66 6967 203d 204b 636f  rentconfig = Kco
-000151b0: 6e66 6967 2863 6c69 656e 743d 656b 7363  nfig(client=eksc
-000151c0: 6c69 656e 7429 2e6b 2069 6620 656b 7363  lient).k if eksc
-000151d0: 6c69 656e 7420 213d 2073 656c 662e 636c  lient != self.cl
-000151e0: 6965 6e74 2065 6c73 6520 7365 6c66 0a20  ient else self. 
-000151f0: 2020 2020 2020 2020 2020 2065 6b73 2e64             eks.d
-00015200: 656c 6574 6528 6375 7272 656e 7463 6f6e  elete(currentcon
-00015210: 6669 672c 2063 6c75 7374 6572 290a 2020  fig, cluster).  
-00015220: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00015230: 2e65 7869 7374 7328 636c 7573 7465 7264  .exists(clusterd
-00015240: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
-00015250: 2070 7072 696e 7428 6622 4465 6c65 7469   pprint(f"Deleti
-00015260: 6e67 2064 6972 6563 746f 7279 207b 636c  ng directory {cl
-00015270: 7573 7465 7264 6972 7d22 290a 2020 2020  usterdir}").    
-00015280: 2020 2020 2020 2020 726d 7472 6565 2863          rmtree(c
-00015290: 6c75 7374 6572 6469 722c 2069 676e 6f72  lusterdir, ignor
-000152a0: 655f 6572 726f 7273 3d54 7275 6529 0a20  e_errors=True). 
-000152b0: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
-000152c0: 6e65 723a 0a20 2020 2020 2020 2020 2020  ner:.           
-000152d0: 2063 6f6e 7420 3d20 4b63 6f6e 7461 696e   cont = Kcontain
-000152e0: 6572 636f 6e66 6967 2873 656c 662c 2063  erconfig(self, c
-000152f0: 6c69 656e 743d 7365 6c66 2e63 6f6e 7461  lient=self.conta
-00015300: 696e 6572 636c 6965 6e74 292e 636f 6e74  inerclient).cont
-00015310: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00015320: 2063 6f6e 7461 2069 6e20 736f 7274 6564   conta in sorted
-00015330: 2863 6f6e 742e 6c69 7374 5f63 6f6e 7461  (cont.list_conta
-00015340: 696e 6572 7328 6b29 293a 0a20 2020 2020  iners(k)):.     
-00015350: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-00015360: 3d20 636f 6e74 615b 305d 0a20 2020 2020  = conta[0].     
-00015370: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-00015380: 696e 6572 5f70 6c61 6e20 3d20 636f 6e74  iner_plan = cont
-00015390: 615b 335d 0a20 2020 2020 2020 2020 2020  a[3].           
-000153a0: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
-000153b0: 725f 706c 616e 203d 3d20 706c 616e 3a0a  r_plan == plan:.
-000153c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153d0: 2020 2020 636f 6e74 2e64 656c 6574 655f      cont.delete_
-000153e0: 636f 6e74 6169 6e65 7228 6e61 6d65 290a  container(name).
-000153f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015400: 2020 2020 7375 6363 6573 7328 6622 436f      success(f"Co
-00015410: 6e74 6169 6e65 7220 7b6e 616d 657d 2064  ntainer {name} d
-00015420: 656c 6574 6564 2122 290a 2020 2020 2020  eleted!").      
-00015430: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00015440: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
-00015450: 2020 2069 6620 6e6f 7420 7365 6c66 2e6b     if not self.k
-00015460: 6565 705f 6e65 7477 6f72 6b73 3a0a 2020  eep_networks:.  
-00015470: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00015480: 662e 7479 7065 203d 3d20 276b 766d 273a  f.type == 'kvm':
-00015490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000154a0: 206e 6574 776f 726b 7320 3d20 6b2e 6c69   networks = k.li
-000154b0: 7374 5f6e 6574 776f 726b 7328 290a 2020  st_networks().  
-000154c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000154d0: 7220 6e65 7477 6f72 6b20 696e 206b 2e6c  r network in k.l
-000154e0: 6973 745f 6e65 7477 6f72 6b73 2829 3a0a  ist_networks():.
-000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015500: 2020 2020 6966 2027 706c 616e 2720 696e      if 'plan' in
-00015510: 206e 6574 776f 726b 735b 6e65 7477 6f72   networks[networ
-00015520: 6b5d 2061 6e64 206e 6574 776f 726b 735b  k] and networks[
-00015530: 6e65 7477 6f72 6b5d 5b27 706c 616e 275d  network]['plan']
-00015540: 203d 3d20 706c 616e 3a0a 2020 2020 2020   == plan:.      
+00014d00: 2020 2020 2020 6970 2c20 766d 706f 7274        ip, vmport
+00014d10: 203d 205f 7373 685f 6372 6564 656e 7469   = _ssh_credenti
+00014d20: 616c 7328 6b2c 206e 616d 6529 5b31 3a5d  als(k, name)[1:]
+00014d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014d40: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+00014d50: 203d 2022 7375 6273 6372 6970 7469 6f6e   = "subscription
+00014d60: 2d6d 616e 6167 6572 2075 6e72 6567 6973  -manager unregis
+00014d70: 7465 7222 0a20 2020 2020 2020 2020 2020  ter".           
+00014d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d90: 2073 7368 636d 6420 3d20 7373 6828 6e61   sshcmd = ssh(na
+00014da0: 6d65 2c20 6970 3d69 702c 2075 7365 723d  me, ip=ip, user=
+00014db0: 2772 6f6f 7427 2c20 7475 6e6e 656c 3d73  'root', tunnel=s
+00014dc0: 656c 662e 7475 6e6e 656c 2c0a 2020 2020  elf.tunnel,.    
+00014dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 2020 2020 2074 756e 6e65 6c68 6f73 743d       tunnelhost=
+00014e00: 7365 6c66 2e74 756e 6e65 6c68 6f73 742c  self.tunnelhost,
+00014e10: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
+00014e20: 2e74 756e 6e65 6c70 6f72 742c 0a20 2020  .tunnelport,.   
+00014e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e50: 2020 2020 2020 7475 6e6e 656c 7573 6572        tunneluser
+00014e60: 3d73 656c 662e 7475 6e6e 656c 7573 6572  =self.tunneluser
+00014e70: 2c20 696e 7365 6375 7265 3d54 7275 652c  , insecure=True,
+00014e80: 2063 6d64 3d63 6d64 2c20 766d 706f 7274   cmd=cmd, vmport
+00014e90: 3d76 6d70 6f72 7429 0a20 2020 2020 2020  =vmport).       
+00014ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014eb0: 2020 2020 206f 732e 7379 7374 656d 2873       os.system(s
+00014ec0: 7368 636d 6429 0a20 2020 2020 2020 2020  shcmd).         
+00014ed0: 2020 2020 2020 2020 2020 2063 2e64 656c             c.del
+00014ee0: 6574 6528 6e61 6d65 2c20 736e 6170 7368  ete(name, snapsh
+00014ef0: 6f74 733d 5472 7565 290a 2020 2020 2020  ots=True).      
+00014f00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014f10: 2064 6e73 636c 6965 6e74 2069 7320 6e6f   dnsclient is no
+00014f20: 7420 4e6f 6e65 2061 6e64 2064 6f6d 6169  t None and domai
+00014f30: 6e20 6973 206e 6f74 204e 6f6e 6520 616e  n is not None an
+00014f40: 6420 646e 7363 6c69 656e 7420 696e 2073  d dnsclient in s
+00014f50: 656c 662e 636c 6965 6e74 733a 0a20 2020  elf.clients:.   
+00014f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f70: 2020 2020 2069 6620 646e 7363 6c69 656e       if dnsclien
+00014f80: 7420 696e 2064 6e73 636c 6965 6e74 733a  t in dnsclients:
+00014f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014fa0: 2020 2020 2020 2020 2020 2020 207a 203d               z =
+00014fb0: 2064 6e73 636c 6965 6e74 735b 646e 7363   dnsclients[dnsc
+00014fc0: 6c69 656e 745d 0a20 2020 2020 2020 2020  lient].         
+00014fd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00014fe0: 6c69 6620 646e 7363 6c69 656e 7420 696e  lif dnsclient in
+00014ff0: 2073 656c 662e 636c 6965 6e74 733a 0a20   self.clients:. 
+00015000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015010: 2020 2020 2020 2020 2020 207a 203d 204b             z = K
+00015020: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
+00015030: 7363 6c69 656e 7429 2e6b 0a20 2020 2020  sclient).k.     
+00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015050: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
+00015060: 735b 646e 7363 6c69 656e 745d 203d 207a  s[dnsclient] = z
+00015070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015080: 2020 2020 2020 2020 207a 2e64 656c 6574           z.delet
+00015090: 655f 646e 7328 646e 7363 6c69 656e 742c  e_dns(dnsclient,
+000150a0: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
+000150b0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+000150c0: 6d6f 6e2e 6465 6c65 7465 5f6c 6173 7476  mon.delete_lastv
+000150d0: 6d28 6e61 6d65 2c20 7365 6c66 2e63 6c69  m(name, self.cli
+000150e0: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
+000150f0: 2020 2020 2020 2020 2073 7563 6365 7373           success
+00015100: 2866 227b 6e61 6d65 7d20 6465 6c65 7465  (f"{name} delete
+00015110: 6420 6f6e 207b 6879 7065 7276 6973 6f72  d on {hypervisor
+00015120: 7d21 2229 0a20 2020 2020 2020 2020 2020  }!").           
+00015130: 2020 2020 2020 2020 2064 656c 6574 6564           deleted
+00015140: 766d 732e 6170 7065 6e64 286e 616d 6529  vms.append(name)
+00015150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015160: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
+00015170: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00015180: 2020 2020 2020 636c 7573 7465 7220 3d20        cluster = 
+00015190: 766d 2e67 6574 2827 6b75 6265 2729 0a20  vm.get('kube'). 
+000151a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151b0: 2020 2069 6620 636c 7573 7465 7220 6973     if cluster is
+000151c0: 206e 6f74 204e 6f6e 6520 616e 6420 636c   not None and cl
+000151d0: 7573 7465 7220 213d 2027 273a 0a20 2020  uster != '':.   
+000151e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151f0: 2020 2020 2063 6c75 7374 6572 6469 7220       clusterdir 
+00015200: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
+00015210: 7573 6572 2866 227e 2f2e 6b63 6c69 2f63  user(f"~/.kcli/c
+00015220: 6c75 7374 6572 732f 7b63 6c75 7374 6572  lusters/{cluster
+00015230: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00015240: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00015250: 732e 7061 7468 2e65 7869 7374 7328 636c  s.path.exists(cl
+00015260: 7573 7465 7264 6972 293a 0a20 2020 2020  usterdir):.     
+00015270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015280: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
+00015290: 7366 696c 6520 3d20 6622 7b63 6c75 7374  sfile = f"{clust
+000152a0: 6572 6469 727d 2f6b 636c 695f 7061 7261  erdir}/kcli_para
+000152b0: 6d65 7465 7273 2e79 6d6c 220a 2020 2020  meters.yml".    
+000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152d0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+000152e0: 7468 2e65 7869 7374 7328 7061 7261 6d65  th.exists(parame
+000152f0: 7465 7273 6669 6c65 293a 0a20 2020 2020  tersfile):.     
+00015300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015310: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00015320: 6f70 656e 2870 6172 616d 6574 6572 7366  open(parametersf
+00015330: 696c 6529 2061 7320 663a 0a20 2020 2020  ile) as f:.     
+00015340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015350: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00015360: 6c75 7374 6572 6461 7461 203d 2079 616d  lusterdata = yam
+00015370: 6c2e 7361 6665 5f6c 6f61 6428 6629 0a20  l.safe_load(f). 
+00015380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153a0: 2020 206b 7562 6574 7970 6520 3d20 636c     kubetype = cl
+000153b0: 7573 7465 7264 6174 612e 6765 7428 276b  usterdata.get('k
+000153c0: 7562 6574 7970 6527 2c20 2767 656e 6572  ubetype', 'gener
+000153d0: 6963 2729 0a20 2020 2020 2020 2020 2020  ic').           
+000153e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153f0: 2020 2020 2020 2020 2069 6620 6b75 6265           if kube
+00015400: 7479 7065 203d 3d20 2768 7970 6572 7368  type == 'hypersh
+00015410: 6966 7427 3a0a 2020 2020 2020 2020 2020  ift':.          
+00015420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015430: 2020 2020 2020 2020 2020 2020 2020 6879                hy
+00015440: 7065 7273 6869 6674 203d 2054 7275 650a  pershift = True.
+00015450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015470: 2020 2020 2020 2020 6173 7369 7374 6564          assisted
+00015480: 203d 2063 6c75 7374 6572 6461 7461 2e67   = clusterdata.g
+00015490: 6574 2861 7373 6973 7465 642c 2046 616c  et(assisted, Fal
+000154a0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+000154b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154c0: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
+000154d0: 2063 6c75 7374 6572 6461 7461 2e67 6574   clusterdata.get
+000154e0: 2827 646f 6d61 696e 272c 2064 6f6d 6169  ('domain', domai
+000154f0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015510: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
+00015520: 203d 2063 6c75 7374 6572 6461 7461 2e67   = clusterdata.g
+00015530: 6574 2827 646e 7363 6c69 656e 7427 290a  et('dnsclient').
+00015540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015560: 2020 6e65 7477 6f72 6b72 6573 756c 7420    networkresult 
-00015570: 3d20 6b2e 6465 6c65 7465 5f6e 6574 776f  = k.delete_netwo
-00015580: 726b 286e 6574 776f 726b 290a 2020 2020  rk(network).    
+00015560: 2020 2020 676b 6520 3d20 6b75 6265 7479      gke = kubety
+00015570: 7065 203d 3d20 2767 6b65 270a 2020 2020  pe == 'gke'.    
+00015580: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155a0: 2020 2020 6966 206e 6574 776f 726b 7265      if networkre
-000155b0: 7375 6c74 5b27 7265 7375 6c74 275d 203d  sult['result'] =
-000155c0: 3d20 2773 7563 6365 7373 273a 0a20 2020  = 'success':.   
-000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155e0: 2020 2020 2020 2020 2073 7563 6365 7373           success
-000155f0: 2866 226e 6574 776f 726b 207b 6e65 7477  (f"network {netw
-00015600: 6f72 6b7d 2064 656c 6574 6564 2122 290a  ork} deleted!").
-00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015620: 2020 2020 2020 2020 2020 2020 666f 756e              foun
-00015630: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-00015640: 2020 2020 2065 6c69 6620 6e65 7477 6f72       elif networ
-00015650: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
-00015660: 2020 2020 666f 756e 6420 3d20 5472 7565      found = True
-00015670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015680: 2066 6f72 206e 6574 776f 726b 2069 6e20   for network in 
-00015690: 6e65 7477 6f72 6b73 3a0a 2020 2020 2020  networks:.      
-000156a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000156b0: 7477 6f72 6b72 6573 756c 7420 3d20 6b2e  tworkresult = k.
-000156c0: 6465 6c65 7465 5f6e 6574 776f 726b 286e  delete_network(n
-000156d0: 6574 776f 726b 290a 2020 2020 2020 2020  etwork).        
-000156e0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000156f0: 6574 776f 726b 7265 7375 6c74 5b27 7265  etworkresult['re
-00015700: 7375 6c74 275d 203d 3d20 2773 7563 6365  sult'] == 'succe
-00015710: 7373 273a 0a20 2020 2020 2020 2020 2020  ss':.           
-00015720: 2020 2020 2020 2020 2020 2020 2073 7563               suc
-00015730: 6365 7373 2866 2255 6e75 7365 6420 6e65  cess(f"Unused ne
-00015740: 7477 6f72 6b20 7b6e 6574 776f 726b 7d20  twork {network} 
-00015750: 6465 6c65 7465 6421 2229 0a20 2020 2020  deleted!").     
-00015760: 2020 2066 6f72 206b 6579 6669 6c65 2069     for keyfile i
-00015770: 6e20 676c 6f62 2e67 6c6f 6228 2225 732e  n glob.glob("%s.
-00015780: 6b65 792a 2220 2520 706c 616e 293a 0a20  key*" % plan):. 
-00015790: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-000157a0: 7373 2866 2266 696c 6520 7b6b 6579 6669  ss(f"file {keyfi
-000157b0: 6c65 7d20 6672 6f6d 207b 706c 616e 7d20  le} from {plan} 
-000157c0: 6465 6c65 7465 6421 2229 0a20 2020 2020  deleted!").     
-000157d0: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-000157e0: 286b 6579 6669 6c65 290a 2020 2020 2020  (keyfile).      
-000157f0: 2020 666f 7220 616e 7369 626c 6566 696c    for ansiblefil
-00015800: 6520 696e 2067 6c6f 622e 676c 6f62 2822  e in glob.glob("
-00015810: 2f74 6d70 2f25 732a 696e 762a 2220 2520  /tmp/%s*inv*" % 
-00015820: 706c 616e 293a 0a20 2020 2020 2020 2020  plan):.         
-00015830: 2020 2073 7563 6365 7373 2866 2266 696c     success(f"fil
-00015840: 6520 7b61 6e73 6962 6c65 6669 6c65 7d20  e {ansiblefile} 
-00015850: 6672 6f6d 207b 706c 616e 7d20 6465 6c65  from {plan} dele
-00015860: 7465 6421 2229 0a20 2020 2020 2020 2020  ted!").         
-00015870: 2020 206f 732e 7265 6d6f 7665 2861 6e73     os.remove(ans
-00015880: 6962 6c65 6669 6c65 290a 2020 2020 2020  iblefile).      
-00015890: 2020 6966 2064 656c 6574 6564 6c62 7320    if deletedlbs 
-000158a0: 616e 6420 7365 6c66 2e74 7970 6520 696e  and self.type in
-000158b0: 205b 2761 7773 272c 2027 6763 7027 5d3a   ['aws', 'gcp']:
-000158c0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000158d0: 206c 6220 696e 2064 656c 6574 6564 6c62   lb in deletedlb
-000158e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000158f0: 2020 2073 656c 662e 6465 6c65 7465 5f6c     self.delete_l
-00015900: 6f61 6462 616c 616e 6365 7228 6c62 290a  oadbalancer(lb).
-00015910: 2020 2020 2020 2020 6966 2066 6f75 6e64          if found
-00015920: 3a0a 2020 2020 2020 2020 2020 2020 7375  :.            su
-00015930: 6363 6573 7328 6622 506c 616e 207b 706c  ccess(f"Plan {pl
-00015940: 616e 7d20 6465 6c65 7465 6421 2229 0a20  an} deleted!"). 
-00015950: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00015960: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
-00015970: 6363 6573 7327 2c20 2764 656c 6574 6564  ccess', 'deleted
-00015980: 766d 273a 2064 656c 6574 6564 766d 737d  vm': deletedvms}
-00015990: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000159a0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-000159b0: 2866 224e 6f20 6f62 6a65 6374 7320 666f  (f"No objects fo
-000159c0: 756e 6420 6475 7269 6e67 2064 656c 6574  und during delet
-000159d0: 696f 6e20 6f66 2070 6c61 6e20 7b70 6c61  ion of plan {pla
-000159e0: 6e7d 2229 0a20 2020 2020 2020 2020 2020  n}").           
-000159f0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00015a00: 273a 2027 6661 696c 7572 6527 7d0a 0a20  ': 'failure'}.. 
-00015a10: 2020 2064 6566 2073 6e61 7073 686f 745f     def snapshot_
-00015a20: 706c 616e 2873 656c 662c 2070 6c61 6e2c  plan(self, plan,
-00015a30: 2073 6e61 7073 686f 746e 616d 653d 4e6f   snapshotname=No
-00015a40: 6e65 293a 0a20 2020 2020 2020 206b 203d  ne):.        k =
-00015a50: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
-00015a60: 736e 6170 7368 6f74 666f 756e 6420 3d20  snapshotfound = 
-00015a70: 4661 6c73 650a 2020 2020 2020 2020 7070  False.        pp
-00015a80: 7269 6e74 2866 2253 6e61 7073 686f 7474  rint(f"Snapshott
-00015a90: 696e 6720 766d 7320 6672 6f6d 2070 6c61  ing vms from pla
-00015aa0: 6e20 7b70 6c61 6e7d 2229 0a20 2020 2020  n {plan}").     
-00015ab0: 2020 2069 6620 736e 6170 7368 6f74 6e61     if snapshotna
-00015ac0: 6d65 2069 7320 4e6f 6e65 3a0a 2020 2020  me is None:.    
-00015ad0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00015ae0: 6622 5573 696e 6720 7b70 6c61 6e7d 2061  f"Using {plan} a
-00015af0: 7320 736e 6170 7368 6f74 206e 616d 6520  s snapshot name 
-00015b00: 6173 204e 6f6e 6520 7761 7320 7072 6f76  as None was prov
-00015b10: 6964 6564 2229 0a20 2020 2020 2020 2020  ided").         
-00015b20: 2020 2073 6e61 7073 686f 746e 616d 6520     snapshotname 
-00015b30: 3d20 706c 616e 0a20 2020 2020 2020 2066  = plan.        f
-00015b40: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
-00015b50: 6b2e 6c69 7374 2829 2c20 6b65 793d 6c61  k.list(), key=la
-00015b60: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
-00015b70: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-00015b80: 6e61 6d65 203d 2076 6d5b 276e 616d 6527  name = vm['name'
-00015b90: 5d0a 2020 2020 2020 2020 2020 2020 6465  ].            de
-00015ba0: 7363 7269 7074 696f 6e20 3d20 766d 5b27  scription = vm['
-00015bb0: 706c 616e 275d 0a20 2020 2020 2020 2020  plan'].         
-00015bc0: 2020 2069 6620 6465 7363 7269 7074 696f     if descriptio
-00015bd0: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
-00015be0: 2020 2020 2020 2020 2020 2073 6e61 7073             snaps
-00015bf0: 686f 7466 6f75 6e64 203d 2054 7275 650a  hotfound = True.
-00015c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c10: 6b2e 6372 6561 7465 5f73 6e61 7073 686f  k.create_snapsho
-00015c20: 7428 736e 6170 7368 6f74 6e61 6d65 2c20  t(snapshotname, 
-00015c30: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00015c40: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
-00015c50: 7b6e 616d 657d 2073 6e61 7073 686f 7474  {name} snapshott
-00015c60: 6564 2122 290a 2020 2020 2020 2020 6966  ed!").        if
-00015c70: 2073 6e61 7073 686f 7466 6f75 6e64 3a0a   snapshotfound:.
-00015c80: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-00015c90: 6573 7328 6622 506c 616e 207b 706c 616e  ess(f"Plan {plan
-00015ca0: 7d20 736e 6170 7368 6f74 7465 6421 2229  } snapshotted!")
-00015cb0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00015cc0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00015cd0: 6e67 2822 4e6f 206d 6174 6368 696e 6720  ng("No matching 
-00015ce0: 766d 7320 666f 756e 6422 290a 2020 2020  vms found").    
-00015cf0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00015d00: 756c 7427 3a20 2773 7563 6365 7373 277d  ult': 'success'}
-00015d10: 0a0a 2020 2020 6465 6620 7265 7665 7274  ..    def revert
-00015d20: 5f70 6c61 6e28 7365 6c66 2c20 706c 616e  _plan(self, plan
-00015d30: 2c20 736e 6170 7368 6f74 6e61 6d65 3d4e  , snapshotname=N
-00015d40: 6f6e 6529 3a0a 2020 2020 2020 2020 6b20  one):.        k 
-00015d50: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
-00015d60: 2072 6576 6572 7466 6f75 6e64 203d 2046   revertfound = F
-00015d70: 616c 7365 0a20 2020 2020 2020 2070 7072  alse.        ppr
-00015d80: 696e 7428 6622 5265 7665 7274 696e 6720  int(f"Reverting 
-00015d90: 736e 6170 7368 6f74 7320 6f66 2076 6d73  snapshots of vms
-00015da0: 2066 726f 6d20 706c 616e 207b 706c 616e   from plan {plan
-00015db0: 7d22 290a 2020 2020 2020 2020 6966 2073  }").        if s
-00015dc0: 6e61 7073 686f 746e 616d 6520 6973 204e  napshotname is N
-00015dd0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00015de0: 2077 6172 6e69 6e67 2866 2255 7369 6e67   warning(f"Using
-00015df0: 207b 706c 616e 7dc2 a061 7320 736e 6170   {plan}..as snap
-00015e00: 7368 6f74 206e 616d 6520 6173 204e 6f6e  shot name as Non
-00015e10: 6520 7761 7320 7072 6f76 6964 6564 2229  e was provided")
-00015e20: 0a20 2020 2020 2020 2020 2020 2073 6e61  .            sna
-00015e30: 7073 686f 746e 616d 6520 3d20 706c 616e  pshotname = plan
-00015e40: 0a20 2020 2020 2020 2066 6f72 2076 6d20  .        for vm 
-00015e50: 696e 2073 6f72 7465 6428 6b2e 6c69 7374  in sorted(k.list
-00015e60: 2829 2c20 6b65 793d 6c61 6d62 6461 2078  (), key=lambda x
-00015e70: 3a20 785b 276e 616d 6527 5d29 3a0a 2020  : x['name']):.  
-00015e80: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-00015e90: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
-00015ea0: 2020 2020 2020 2020 6465 7363 7269 7074          descript
-00015eb0: 696f 6e20 3d20 766d 5b27 706c 616e 275d  ion = vm['plan']
-00015ec0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00015ed0: 6465 7363 7269 7074 696f 6e20 3d3d 2070  description == p
-00015ee0: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
-00015ef0: 2020 2020 2072 6576 6572 7466 6f75 6e64       revertfound
-00015f00: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00015f10: 2020 2020 2020 2020 6b2e 7265 7665 7274          k.revert
-00015f20: 5f73 6e61 7073 686f 7428 736e 6170 7368  _snapshot(snapsh
-00015f30: 6f74 6e61 6d65 2c20 6e61 6d65 290a 2020  otname, name).  
-00015f40: 2020 2020 2020 2020 2020 2020 2020 7375                su
-00015f50: 6363 6573 7328 6622 736e 6170 7368 6f74  ccess(f"snapshot
-00015f60: 206f 6620 7b6e 616d 657d 2072 6576 6572   of {name} rever
-00015f70: 7465 6421 2229 0a20 2020 2020 2020 2069  ted!").        i
-00015f80: 6620 7265 7665 7274 666f 756e 643a 0a20  f revertfound:. 
-00015f90: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-00015fa0: 7373 2866 2250 6c61 6e20 7b70 6c61 6e7d  ss(f"Plan {plan}
-00015fb0: 2072 6576 6572 7465 6420 7769 7468 2073   reverted with s
-00015fc0: 6e61 7073 686f 7420 7b73 6e61 7073 686f  napshot {snapsho
-00015fd0: 746e 616d 657d 2122 290a 2020 2020 2020  tname}!").      
-00015fe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00015ff0: 2020 2020 7761 726e 696e 6728 224e 6f20      warning("No 
-00016000: 6d61 7463 6869 6e67 2076 6d73 2066 6f75  matching vms fou
-00016010: 6e64 2229 0a20 2020 2020 2020 2072 6574  nd").        ret
-00016020: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00016030: 7375 6363 6573 7327 7d0a 0a20 2020 2064  success'}..    d
-00016040: 6566 2070 6c61 6e28 7365 6c66 2c20 706c  ef plan(self, pl
-00016050: 616e 2c20 616e 7369 626c 653d 4661 6c73  an, ansible=Fals
-00016060: 652c 2075 726c 3d4e 6f6e 652c 2070 6174  e, url=None, pat
-00016070: 683d 4e6f 6e65 2c20 636f 6e74 6169 6e65  h=None, containe
-00016080: 723d 4661 6c73 652c 2069 6e70 7574 6669  r=False, inputfi
-00016090: 6c65 3d4e 6f6e 652c 2069 6e70 7574 7374  le=None, inputst
-000160a0: 7269 6e67 3d4e 6f6e 652c 0a20 2020 2020  ring=None,.     
-000160b0: 2020 2020 2020 2020 6f76 6572 7269 6465          override
-000160c0: 733d 7b7d 2c20 696e 666f 3d46 616c 7365  s={}, info=False
-000160d0: 2c20 7570 6461 7465 3d46 616c 7365 2c20  , update=False, 
-000160e0: 656d 6265 6464 6564 3d46 616c 7365 2c20  embedded=False, 
-000160f0: 646f 776e 6c6f 6164 3d46 616c 7365 2c20  download=False, 
-00016100: 7175 6965 743d 4661 6c73 652c 2064 6f63  quiet=False, doc
-00016110: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00016120: 2020 2020 206f 6e6c 7961 7373 6574 733d       onlyassets=
-00016130: 4661 6c73 652c 2070 7265 3d54 7275 652c  False, pre=True,
-00016140: 2070 6f73 743d 5472 7565 2c20 6578 636c   post=True, excl
-00016150: 7564 6576 6d73 3d5b 5d2c 2062 6173 656d  udevms=[], basem
-00016160: 6f64 653d 4661 6c73 652c 2074 6872 6561  ode=False, threa
-00016170: 6465 643d 4661 6c73 6529 3a0a 2020 2020  ded=False):.    
-00016180: 2020 2020 2222 224d 616e 6167 6520 706c      """Manage pl
-00016190: 616e 2066 696c 6522 2222 0a20 2020 2020  an file""".     
-000161a0: 2020 206b 203d 2073 656c 662e 6b0a 2020     k = self.k.  
-000161b0: 2020 2020 2020 6e6f 5f6f 7665 7272 6964        no_overrid
-000161c0: 6573 203d 206e 6f74 206f 7665 7272 6964  es = not overrid
-000161d0: 6573 0a20 2020 2020 2020 2074 6872 6561  es.        threa
-000161e0: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
-000161f0: 6e65 7776 6d73 203d 205b 5d0a 2020 2020  newvms = [].    
-00016200: 2020 2020 6e65 7761 7373 6574 7320 3d20      newassets = 
-00016210: 5b5d 0a20 2020 2020 2020 2066 6169 6c65  [].        faile
-00016220: 6476 6d73 203d 205b 5d0a 2020 2020 2020  dvms = [].      
-00016230: 2020 6578 6973 7469 6e67 766d 7320 3d20    existingvms = 
-00016240: 5b5d 0a20 2020 2020 2020 2061 7379 6e63  [].        async
-00016250: 7761 6974 766d 7320 3d20 5b5d 0a20 2020  waitvms = [].   
-00016260: 2020 2020 206f 6e66 6c79 203d 204e 6f6e       onfly = Non
-00016270: 650a 2020 2020 2020 2020 746f 636c 6561  e.        toclea
-00016280: 6e20 3d20 4661 6c73 650a 2020 2020 2020  n = False.      
-00016290: 2020 6765 7462 6163 6b20 3d20 4661 6c73    getback = Fals
-000162a0: 650a 2020 2020 2020 2020 766d 7072 6f66  e.        vmprof
-000162b0: 696c 6573 203d 207b 6b65 793a 2076 616c  iles = {key: val
-000162c0: 7565 2066 6f72 206b 6579 2c20 7661 6c75  ue for key, valu
-000162d0: 6520 696e 2073 656c 662e 7072 6f66 696c  e in self.profil
-000162e0: 6573 2e69 7465 6d73 2829 0a20 2020 2020  es.items().     
-000162f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016300: 2069 6620 2774 7970 6527 206e 6f74 2069   if 'type' not i
-00016310: 6e20 7661 6c75 6520 6f72 2076 616c 7565  n value or value
-00016320: 5b27 7479 7065 275d 203d 3d20 2776 6d27  ['type'] == 'vm'
-00016330: 7d0a 2020 2020 2020 2020 636f 6e74 6169  }.        contai
-00016340: 6e65 7270 726f 6669 6c65 7320 3d20 7b6b  nerprofiles = {k
-00016350: 6579 3a20 7661 6c75 6520 666f 7220 6b65  ey: value for ke
-00016360: 792c 2076 616c 7565 2069 6e20 7365 6c66  y, value in self
-00016370: 2e70 726f 6669 6c65 732e 6974 656d 7328  .profiles.items(
-00016380: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000163a0: 6620 2774 7970 6527 2069 6e20 7661 6c75  f 'type' in valu
-000163b0: 6520 616e 6420 7661 6c75 655b 2774 7970  e and value['typ
-000163c0: 6527 5d20 3d3d 2027 636f 6e74 6169 6e65  e'] == 'containe
-000163d0: 7227 7d0a 2020 2020 2020 2020 6966 2070  r'}.        if p
-000163e0: 6c61 6e20 6973 204e 6f6e 653a 0a20 2020  lan is None:.   
-000163f0: 2020 2020 2020 2020 2070 6c61 6e20 3d20           plan = 
-00016400: 6e61 6d65 7574 696c 732e 6765 745f 7261  nameutils.get_ra
-00016410: 6e64 6f6d 5f6e 616d 6528 290a 2020 2020  ndom_name().    
-00016420: 2020 2020 6966 2075 726c 2069 7320 6e6f      if url is no
-00016430: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00016440: 2020 2020 6966 2075 726c 2e73 7461 7274      if url.start
-00016450: 7377 6974 6828 272f 2729 3a0a 2020 2020  swith('/'):.    
-00016460: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
-00016470: 3d20 6622 6669 6c65 3a2f 2f7b 7572 6c7d  = f"file://{url}
-00016480: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
-00016490: 206e 6f74 2075 726c 2e65 6e64 7377 6974   not url.endswit
-000164a0: 6828 272e 796d 6c27 293a 0a20 2020 2020  h('.yml'):.     
-000164b0: 2020 2020 2020 2020 2020 2075 726c 203d             url =
-000164c0: 2066 227b 7572 6c7d 2f6b 636c 695f 706c   f"{url}/kcli_pl
-000164d0: 616e 2e79 6d6c 220a 2020 2020 2020 2020  an.yml".        
-000164e0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-000164f0: 2254 7279 696e 6720 746f 2072 6574 7269  "Trying to retri
-00016500: 6576 6520 7b75 726c 7d22 290a 2020 2020  eve {url}").    
-00016510: 2020 2020 2020 2020 696e 7075 7466 696c          inputfil
-00016520: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-00016530: 6e61 6d65 2875 726c 290a 2020 2020 2020  name(url).      
-00016540: 2020 2020 2020 6f6e 666c 7920 3d20 6f73        onfly = os
-00016550: 2e70 6174 682e 6469 726e 616d 6528 7572  .path.dirname(ur
-00016560: 6c29 0a20 2020 2020 2020 2020 2020 2070  l).            p
-00016570: 6174 6820 3d20 706c 616e 2069 6620 7061  ath = plan if pa
-00016580: 7468 2069 7320 4e6f 6e65 2065 6c73 6520  th is None else 
-00016590: 7061 7468 0a20 2020 2020 2020 2020 2020  path.           
-000165a0: 2069 6620 6e6f 7420 7175 6965 743a 0a20   if not quiet:. 
-000165b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000165c0: 7072 696e 7428 6622 5265 7472 6965 7669  print(f"Retrievi
-000165d0: 6e67 2073 7065 6369 6669 6564 2070 6c61  ng specified pla
-000165e0: 6e20 6672 6f6d 207b 7572 6c7d 2074 6f20  n from {url} to 
-000165f0: 7b70 6174 687d 2229 0a20 2020 2020 2020  {path}").       
-00016600: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
-00016610: 725f 6d6f 6465 2829 3a0a 2020 2020 2020  r_mode():.      
-00016620: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-00016630: 2066 222f 776f 726b 6469 722f 7b70 6174   f"/workdir/{pat
-00016640: 687d 220a 2020 2020 2020 2020 2020 2020  h}".            
-00016650: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
-00016660: 7869 7374 7328 7061 7468 293a 0a20 2020  xists(path):.   
-00016670: 2020 2020 2020 2020 2020 2020 2074 6f63               toc
-00016680: 6c65 616e 203d 2054 7275 650a 2020 2020  lean = True.    
-00016690: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
-000166a0: 6f6e 2e66 6574 6368 2875 726c 2c20 7061  on.fetch(url, pa
-000166b0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-000166c0: 2020 2020 666f 7220 6465 6661 756c 745f      for default_
-000166d0: 7061 7261 6d65 7465 725f 6669 6c65 2069  parameter_file i
-000166e0: 6e20 5b27 2f6b 636c 695f 6465 6661 756c  n ['/kcli_defaul
-000166f0: 742e 796d 6c27 2c20 6627 2f7b 706c 616e  t.yml', f'/{plan
-00016700: 7d5f 6465 6661 756c 742e 796d 6c27 2c0a  }_default.yml',.
-00016710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016730: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00016740: 2f25 735f 6465 6661 756c 7425 7322 2025  /%s_default%s" %
-00016750: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-00016760: 7428 6f73 2e70 6174 682e 6261 7365 6e61  t(os.path.basena
-00016770: 6d65 2875 726c 2929 5d3a 0a20 2020 2020  me(url))]:.     
-00016780: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00016790: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-000167a0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
-000167b0: 6f6e 2e66 6574 6368 286f 732e 7061 7468  on.fetch(os.path
-000167c0: 2e64 6972 6e61 6d65 2875 726c 2920 2b20  .dirname(url) + 
-000167d0: 6465 6661 756c 745f 7061 7261 6d65 7465  default_paramete
-000167e0: 725f 6669 6c65 2c20 7061 7468 290a 2020  r_file, path).  
-000167f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016800: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-00016810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016820: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-00016830: 2020 2065 6c69 6620 646f 776e 6c6f 6164     elif download
-00016840: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016850: 2020 6d73 6720 3d20 6622 7461 7267 6574    msg = f"target
-00016860: 2064 6972 6563 746f 7279 207b 7061 7468   directory {path
-00016870: 7d20 616c 7265 6164 7920 7468 6572 6522  } already there"
-00016880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016890: 2065 7272 6f72 286d 7367 290a 2020 2020   error(msg).    
-000168a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000168b0: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
-000168c0: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
-000168d0: 273a 206d 7367 7d0a 2020 2020 2020 2020  ': msg}.        
-000168e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000168f0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00016900: 2866 2255 7369 6e67 2065 7869 7374 696e  (f"Using existin
-00016910: 6720 6469 7265 6374 6f72 7920 7b70 6174  g directory {pat
-00016920: 687d 2229 0a20 2020 2020 2020 2020 2020  h}").           
-00016930: 2069 6620 646f 776e 6c6f 6164 3a0a 2020   if download:.  
-00016940: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00016950: 7075 7466 696c 6520 3d20 6622 7b70 6174  putfile = f"{pat
-00016960: 687d 2f7b 696e 7075 7466 696c 657d 220a  h}/{inputfile}".
-00016970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016980: 656e 7472 6965 732c 206f 7665 7272 6964  entries, overrid
-00016990: 6573 2c20 6261 7365 6669 6c65 2c20 6261  es, basefile, ba
-000169a0: 7365 6469 7220 3d20 7365 6c66 2e70 726f  sedir = self.pro
-000169b0: 6365 7373 5f69 6e70 7574 6669 6c65 2870  cess_inputfile(p
-000169c0: 6c61 6e2c 2069 6e70 7574 6669 6c65 2c20  lan, inputfile, 
-000169d0: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
-000169e0: 6465 732c 0a20 2020 2020 2020 2020 2020  des,.           
-000169f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a30: 2020 2020 6f6e 666c 793d 6f6e 666c 792c      onfly=onfly,
-00016a40: 2066 756c 6c3d 5472 7565 2c0a 2020 2020   full=True,.    
-00016a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a90: 2020 2020 2020 2020 2020 2064 6f77 6e6c             downl
-00016aa0: 6f61 645f 6d6f 6465 3d54 7275 6529 0a20  oad_mode=True). 
-00016ab0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00016ac0: 732e 6368 6469 7228 7061 7468 290a 2020  s.chdir(path).  
-00016ad0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00016ae0: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
-00016af0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00016b00: 2020 2020 2020 2020 6966 2027 7479 7065          if 'type
-00016b10: 2720 696e 2065 6e74 7269 6573 5b65 6e74  ' in entries[ent
-00016b20: 7279 5d20 616e 6420 656e 7472 6965 735b  ry] and entries[
-00016b30: 656e 7472 795d 5b27 7479 7065 275d 2021  entry]['type'] !
-00016b40: 3d20 2776 6d27 3a0a 2020 2020 2020 2020  = 'vm':.        
-00016b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b60: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00016b70: 2020 2020 2020 2020 2020 2020 2076 6d65               vme
-00016b80: 6e74 7279 203d 2065 6e74 7269 6573 5b65  ntry = entries[e
-00016b90: 6e74 7279 5d0a 2020 2020 2020 2020 2020  ntry].          
-00016ba0: 2020 2020 2020 2020 2020 766d 6669 6c65            vmfile
-00016bb0: 7320 3d20 766d 656e 7472 792e 6765 7428  s = vmentry.get(
-00016bc0: 2766 696c 6573 272c 205b 5d29 0a20 2020  'files', []).   
-00016bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016be0: 2073 6372 6970 7466 696c 6573 203d 2076   scriptfiles = v
-00016bf0: 6d65 6e74 7279 2e67 6574 2827 7363 7269  mentry.get('scri
-00016c00: 7074 7327 2c20 5b5d 290a 2020 2020 2020  pts', []).      
-00016c10: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00016c20: 7220 6669 6c20 696e 2076 6d66 696c 6573  r fil in vmfiles
-00016c30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016c40: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00016c50: 6e73 7461 6e63 6528 6669 6c2c 2073 7472  nstance(fil, str
-00016c60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00016c70: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00016c80: 7269 6769 6e20 3d20 6669 6c0a 2020 2020  rigin = fil.    
-00016c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ca0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00016cb0: 6e63 6528 6669 6c2c 2064 6963 7429 3a0a  nce(fil, dict):.
-00016cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cd0: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
-00016ce0: 696e 203d 2066 696c 2e67 6574 2827 6f72  in = fil.get('or
-00016cf0: 6967 696e 2729 0a20 2020 2020 2020 2020  igin').         
-00016d00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00016d10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00016d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d30: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00016d40: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-00016d50: 6561 736f 6e27 3a20 2249 6e63 6f72 7265  eason': "Incorre
-00016d60: 6374 2066 696c 6520 656e 7472 7922 7d0a  ct file entry"}.
-00016d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d80: 2020 2020 2020 2020 6966 2027 7e27 206e          if '~' n
-00016d90: 6f74 2069 6e20 6f72 6967 696e 3a0a 2020  ot in origin:.  
-00016da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016db0: 2020 2020 2020 2020 2020 6465 7374 6469            destdi
-00016dc0: 7220 3d20 222e 220a 2020 2020 2020 2020  r = ".".        
-00016dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016de0: 2020 2020 6966 2027 2f27 2069 6e20 6f72      if '/' in or
-00016df0: 6967 696e 3a0a 2020 2020 2020 2020 2020  igin:.          
-00016e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e10: 2020 2020 2020 6465 7374 6469 7220 3d20        destdir = 
-00016e20: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00016e30: 6f72 6967 696e 290a 2020 2020 2020 2020  origin).        
-00016e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e50: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-00016e60: 6972 7328 6465 7374 6469 722c 2065 7869  irs(destdir, exi
-00016e70: 7374 5f6f 6b3d 5472 7565 290a 2020 2020  st_ok=True).    
-00016e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e90: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00016ea0: 2252 6574 7269 6576 696e 6720 6669 6c65  "Retrieving file
-00016eb0: 207b 6f6e 666c 797d 2f7b 6f72 6967 696e   {onfly}/{origin
-00016ec0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f00: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
-00016f10: 6828 6622 7b6f 6e66 6c79 7d2f 7b6f 7269  h(f"{onfly}/{ori
-00016f20: 6769 6e7d 222c 2064 6573 7464 6972 290a  gin}", destdir).
-00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f40: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00016f50: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-00016f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f70: 2020 2020 6966 2063 6f6d 6d6f 6e2e 7572      if common.ur
-00016f80: 6c5f 6578 6973 7473 2866 227b 6f6e 666c  l_exists(f"{onfl
-00016f90: 797d 2f7b 6f72 6967 696e 7d2f 5245 4144  y}/{origin}/READ
-00016fa0: 4d45 2e6d 6422 293a 0a20 2020 2020 2020  ME.md"):.       
-00016fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fc0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-00016fd0: 6d61 6b65 6469 7273 286f 7269 6769 6e2c  makedirs(origin,
-00016fe0: 2065 7869 7374 5f6f 6b3d 5472 7565 290a   exist_ok=True).
-00016ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017010: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00017020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017030: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00017040: 2866 2266 696c 6520 7b6f 6e66 6c79 7d2f  (f"file {onfly}/
-00017050: 7b6f 7269 6769 6e7d 2073 6b69 7070 6564  {origin} skipped
-00017060: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00017070: 2020 2020 2020 2066 6f72 2073 6372 6970         for scrip
-00017080: 7420 696e 2073 6372 6970 7466 696c 6573  t in scriptfiles
-00017090: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000170a0: 2020 2020 2020 2020 2020 6966 2027 7e27            if '~'
-000170b0: 206e 6f74 2069 6e20 7363 7269 7074 3a0a   not in script:.
-000170c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170d0: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-000170e0: 6469 7220 3d20 222e 220a 2020 2020 2020  dir = ".".      
-000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017100: 2020 2020 2020 6966 2027 2f27 2069 6e20        if '/' in 
-00017110: 7363 7269 7074 3a0a 2020 2020 2020 2020  script:.        
-00017120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017130: 2020 2020 2020 2020 6465 7374 6469 7220          destdir 
-00017140: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-00017150: 6528 7363 7269 7074 290a 2020 2020 2020  e(script).      
-00017160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017170: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
-00017180: 6564 6972 7328 6465 7374 6469 722c 2065  edirs(destdir, e
-00017190: 7869 7374 5f6f 6b3d 5472 7565 290a 2020  xist_ok=True).  
-000171a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171b0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-000171c0: 2866 2252 6574 7269 6576 696e 6720 7363  (f"Retrieving sc
-000171d0: 7269 7074 207b 6f6e 666c 797d 2f7b 7363  ript {onfly}/{sc
-000171e0: 7269 7074 7d22 290a 2020 2020 2020 2020  ript}").        
-000171f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017200: 2020 2020 636f 6d6d 6f6e 2e66 6574 6368      common.fetch
-00017210: 2866 227b 6f6e 666c 797d 2f7b 7363 7269  (f"{onfly}/{scri
-00017220: 7074 7d22 2c20 6465 7374 6469 7229 0a20  pt}", destdir). 
-00017230: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00017240: 732e 6368 6469 7228 272e 2e27 290a 2020  s.chdir('..').  
-00017250: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00017260: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-00017270: 2773 7563 6365 7373 277d 0a20 2020 2020  'success'}.     
-00017280: 2020 2069 6620 696e 7075 7473 7472 696e     if inputstrin
-00017290: 6720 6973 206e 6f74 204e 6f6e 653a 0a20  g is not None:. 
-000172a0: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-000172b0: 6669 6c65 203d 2066 2274 656d 705f 706c  file = f"temp_pl
-000172c0: 616e 5f7b 706c 616e 7d2e 796d 6c22 0a20  an_{plan}.yml". 
-000172d0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-000172e0: 6f70 656e 2869 6e70 7574 6669 6c65 2c20  open(inputfile, 
-000172f0: 2277 2229 2061 7320 663a 0a20 2020 2020  "w") as f:.     
-00017300: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
-00017310: 7465 2869 6e70 7574 7374 7269 6e67 290a  te(inputstring).
-00017320: 2020 2020 2020 2020 6966 2069 6e70 7574          if input
-00017330: 6669 6c65 2069 7320 4e6f 6e65 3a0a 2020  file is None:.  
-00017340: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
-00017350: 696c 6520 3d20 276b 636c 695f 706c 616e  ile = 'kcli_plan
-00017360: 2e79 6d6c 270a 2020 2020 2020 2020 2020  .yml'.          
-00017370: 2020 7070 7269 6e74 2822 7573 696e 6720    pprint("using 
-00017380: 6465 6661 756c 7420 696e 7075 7420 6669  default input fi
-00017390: 6c65 206b 636c 695f 706c 616e 2e79 6d6c  le kcli_plan.yml
-000173a0: 2229 0a20 2020 2020 2020 2069 6620 7061  ").        if pa
-000173b0: 7468 2069 7320 6e6f 7420 4e6f 6e65 3a0a  th is not None:.
-000173c0: 2020 2020 2020 2020 2020 2020 6f73 2e63              os.c
-000173d0: 6864 6972 2870 6174 6829 0a20 2020 2020  hdir(path).     
-000173e0: 2020 2020 2020 2067 6574 6261 636b 203d         getback =
-000173f0: 2054 7275 650a 2020 2020 2020 2020 696e   True.        in
-00017400: 7075 7466 696c 6520 3d20 6f73 2e70 6174  putfile = os.pat
-00017410: 682e 6578 7061 6e64 7573 6572 2869 6e70  h.expanduser(inp
-00017420: 7574 6669 6c65 290a 2020 2020 2020 2020  utfile).        
-00017430: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
-00017440: 7869 7374 7328 696e 7075 7466 696c 6529  xists(inputfile)
-00017450: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
-00017460: 726f 7228 6622 496e 7075 7420 6669 6c65  ror(f"Input file
-00017470: 207b 696e 7075 7466 696c 657d 206e 6f74   {inputfile} not
-00017480: 2066 6f75 6e64 2e4c 6561 7669 6e67 2e2e   found.Leaving..
-00017490: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-000174a0: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-000174b0: 2020 2020 2065 6c69 6620 6f73 2e70 6174       elif os.pat
-000174c0: 682e 6973 6469 7228 696e 7075 7466 696c  h.isdir(inputfil
-000174d0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-000174e0: 696e 7075 7466 696c 6520 3d20 6622 7b69  inputfile = f"{i
-000174f0: 6e70 7574 6669 6c65 7d2f 6b63 6c69 5f70  nputfile}/kcli_p
-00017500: 6c61 6e2e 796d 6c22 0a20 2020 2020 2020  lan.yml".       
-00017510: 2069 6620 696e 666f 3a0a 2020 2020 2020   if info:.      
-00017520: 2020 2020 2020 7365 6c66 2e69 6e66 6f5f        self.info_
-00017530: 706c 616e 2869 6e70 7574 6669 6c65 2c20  plan(inputfile, 
-00017540: 6f6e 666c 793d 6f6e 666c 792c 2071 7569  onfly=onfly, qui
-00017550: 6574 3d71 7569 6574 2c20 646f 633d 646f  et=quiet, doc=do
-00017560: 6329 0a20 2020 2020 2020 2020 2020 2069  c).            i
-00017570: 6620 746f 636c 6561 6e3a 0a20 2020 2020  f toclean:.     
-00017580: 2020 2020 2020 2020 2020 206f 732e 6368             os.ch
-00017590: 6469 7228 272e 2e27 290a 2020 2020 2020  dir('..').      
-000175a0: 2020 2020 2020 2020 2020 726d 7472 6565            rmtree
-000175b0: 2870 6174 6829 0a20 2020 2020 2020 2020  (path).         
-000175c0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-000175d0: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
-000175e0: 2020 2020 2020 2020 6261 7365 656e 7472          baseentr
-000175f0: 6965 7320 3d20 7b7d 0a20 2020 2020 2020  ies = {}.       
-00017600: 2065 6e74 7269 6573 2c20 6f76 6572 7269   entries, overri
-00017610: 6465 732c 2062 6173 6566 696c 652c 2062  des, basefile, b
-00017620: 6173 6564 6972 203d 2073 656c 662e 7072  asedir = self.pr
-00017630: 6f63 6573 735f 696e 7075 7466 696c 6528  ocess_inputfile(
-00017640: 706c 616e 2c20 696e 7075 7466 696c 652c  plan, inputfile,
-00017650: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-00017660: 6964 6573 2c0a 2020 2020 2020 2020 2020  ides,.          
-00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176a0: 2020 2020 2020 2020 2020 2020 206f 6e66               onf
-000176b0: 6c79 3d6f 6e66 6c79 2c20 6675 6c6c 3d54  ly=onfly, full=T
-000176c0: 7275 6529 0a20 2020 2020 2020 2069 6620  rue).        if 
-000176d0: 6261 7365 6669 6c65 2069 7320 6e6f 7420  basefile is not 
-000176e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000176f0: 2020 6261 7365 696e 666f 203d 2073 656c    baseinfo = sel
-00017700: 662e 7072 6f63 6573 735f 696e 7075 7466  f.process_inputf
-00017710: 696c 6528 706c 616e 2c20 6622 7b62 6173  ile(plan, f"{bas
-00017720: 6564 6972 7d2f 7b62 6173 6566 696c 657d  edir}/{basefile}
-00017730: 222c 206f 7665 7272 6964 6573 3d6f 7665  ", overrides=ove
-00017740: 7272 6964 6573 2c20 6675 6c6c 3d54 7275  rrides, full=Tru
-00017750: 6529 0a20 2020 2020 2020 2020 2020 2062  e).            b
-00017760: 6173 6565 6e74 7269 6573 2c20 6261 7365  aseentries, base
-00017770: 6f76 6572 7269 6465 7320 3d20 6261 7365  overrides = base
-00017780: 696e 666f 5b30 5d2c 2062 6173 6569 6e66  info[0], baseinf
-00017790: 6f5b 315d 0a20 2020 2020 2020 2020 2020  o[1].           
-000177a0: 2069 6620 6261 7365 6f76 6572 7269 6465   if baseoverride
-000177b0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000177c0: 2020 206f 7665 7272 6964 6573 2e75 7064     overrides.upd
-000177d0: 6174 6528 7b6b 6579 3a20 6261 7365 6f76  ate({key: baseov
-000177e0: 6572 7269 6465 735b 6b65 795d 2066 6f72  errides[key] for
-000177f0: 206b 6579 2069 6e20 6261 7365 6f76 6572   key in baseover
-00017800: 7269 6465 7320 6966 206b 6579 206e 6f74  rides if key not
-00017810: 2069 6e20 6f76 6572 7269 6465 737d 290a   in overrides}).
-00017820: 2020 2020 2020 2020 6966 2065 6e74 7269          if entri
-00017830: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00017840: 2020 2020 2020 2020 656e 7472 6965 7320          entries 
-00017850: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
-00017860: 7365 6c66 2e64 6562 7567 3a0a 2020 2020  self.debug:.    
-00017870: 2020 2020 2020 2020 7072 696e 7428 7961          print(ya
-00017880: 6d6c 2e64 756d 7028 656e 7472 6965 7329  ml.dump(entries)
-00017890: 290a 2020 2020 2020 2020 7061 7261 6d65  ).        parame
-000178a0: 7465 7273 203d 2065 6e74 7269 6573 2e67  ters = entries.g
-000178b0: 6574 2827 7061 7261 6d65 7465 7273 2729  et('parameters')
-000178c0: 0a20 2020 2020 2020 2069 6620 7061 7261  .        if para
-000178d0: 6d65 7465 7273 2069 7320 6e6f 7420 4e6f  meters is not No
-000178e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000178f0: 6465 6c20 656e 7472 6965 735b 2770 6172  del entries['par
-00017900: 616d 6574 6572 7327 5d0a 2020 2020 2020  ameters'].      
-00017910: 2020 6469 6374 5f74 7970 6573 203d 205b    dict_types = [
-00017920: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-00017930: 696e 2065 6e74 7269 6573 2069 6620 6973  in entries if is
-00017940: 696e 7374 616e 6365 2865 6e74 7269 6573  instance(entries
-00017950: 5b65 6e74 7279 5d2c 2064 6963 7429 5d0a  [entry], dict)].
-00017960: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-00017970: 6963 745f 7479 7065 733a 0a20 2020 2020  ict_types:.     
-00017980: 2020 2020 2020 2069 6620 6261 7365 6d6f         if basemo
-00017990: 6465 3a0a 2020 2020 2020 2020 2020 2020  de:.            
-000179a0: 2020 2020 7761 726e 696e 6728 6622 7b69      warning(f"{i
-000179b0: 6e70 7574 6669 6c65 7d20 646f 6573 6e27  nputfile} doesn'
-000179c0: 7420 6c6f 6f6b 206c 696b 6520 6120 7661  t look like a va
-000179d0: 6c69 6420 706c 616e 2e53 6b69 7070 696e  lid plan.Skippin
-000179e0: 672e 2e2e 2e22 290a 2020 2020 2020 2020  g....").        
-000179f0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00017a00: 2272 6573 756c 7422 3a20 2273 7563 6365  "result": "succe
-00017a10: 7373 227d 0a20 2020 2020 2020 2020 2020  ss"}.           
-00017a20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00017a30: 2020 2020 2020 206d 7367 203d 2066 227b         msg = f"{
-00017a40: 696e 7075 7466 696c 657d 2064 6f65 736e  inputfile} doesn
-00017a50: 2774 206c 6f6f 6b20 6c69 6b65 2061 2076  't look like a v
-00017a60: 616c 6964 2070 6c61 6e20 6669 6c65 2e20  alid plan file. 
-00017a70: 4d61 7962 6520 796f 7520 7072 6f76 6964  Maybe you provid
-00017a80: 6564 2061 2070 6172 616d 6574 6572 2066  ed a parameter f
-00017a90: 696c 6520 3f22 0a20 2020 2020 2020 2020  ile ?".         
-00017aa0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-00017ab0: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
-00017ac0: 6527 2c20 2772 6561 736f 6e27 3a20 6d73  e', 'reason': ms
-00017ad0: 677d 0a20 2020 2020 2020 2069 6e70 7574  g}.        input
-00017ae0: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
-00017af0: 726e 616d 6528 696e 7075 7466 696c 6529  rname(inputfile)
-00017b00: 2069 6620 6f73 2e70 6174 682e 6469 726e   if os.path.dirn
-00017b10: 616d 6528 696e 7075 7466 696c 6529 2021  ame(inputfile) !
-00017b20: 3d20 2727 2061 6e64 206f 732e 7061 7468  = '' and os.path
-00017b30: 2e69 7361 6273 2869 6e70 7574 6669 6c65  .isabs(inputfile
-00017b40: 2920 656c 7365 2027 2e27 0a20 2020 2020  ) else '.'.     
-00017b50: 2020 2070 7265 5f62 6173 6520 3d20 6f73     pre_base = os
-00017b60: 2e70 6174 682e 7370 6c69 7465 7874 286f  .path.splitext(o
-00017b70: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00017b80: 696e 7075 7466 696c 6529 295b 305d 0a20  inputfile))[0]. 
-00017b90: 2020 2020 2020 2070 7265 5f73 6372 6970         pre_scrip
-00017ba0: 7420 3d20 6627 7b69 6e70 7574 6469 727d  t = f'{inputdir}
-00017bb0: 2f6b 636c 695f 7072 652e 7368 2720 6966  /kcli_pre.sh' if
-00017bc0: 2070 7265 5f62 6173 6520 3d3d 2027 6b63   pre_base == 'kc
-00017bd0: 6c69 5f70 6c61 6e27 2065 6c73 6520 6622  li_plan' else f"
-00017be0: 7b69 6e70 7574 6469 727d 2f7b 7072 655f  {inputdir}/{pre_
-00017bf0: 6261 7365 7d5f 7072 652e 7368 220a 2020  base}_pre.sh".  
-00017c00: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00017c10: 2e65 7869 7374 7328 7072 655f 7363 7269  .exists(pre_scri
-00017c20: 7074 293a 0a20 2020 2020 2020 2020 2020  pt):.           
-00017c30: 2070 7265 5f73 6372 6970 745f 7368 6f72   pre_script_shor
-00017c40: 7420 3d20 6f73 2e70 6174 682e 6261 7365  t = os.path.base
-00017c50: 6e61 6d65 2870 7265 5f73 6372 6970 7429  name(pre_script)
-00017c60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017c70: 7072 653a 0a20 2020 2020 2020 2020 2020  pre:.           
-00017c80: 2020 2020 2070 7072 696e 7428 6622 5275       pprint(f"Ru
-00017c90: 6e6e 696e 6720 7b70 7265 5f73 6372 6970  nning {pre_scrip
-00017ca0: 745f 7368 6f72 747d 2229 0a20 2020 2020  t_short}").     
-00017cb0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00017cc0: 5465 6d70 6f72 6172 7944 6972 6563 746f  TemporaryDirecto
-00017cd0: 7279 2829 2061 7320 746d 7064 6972 3a0a  ry() as tmpdir:.
+000155a0: 656b 7320 3d20 6b75 6265 7479 7065 203d  eks = kubetype =
+000155b0: 3d20 2765 6b73 270a 2020 2020 2020 2020  = 'eks'.        
+000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155d0: 2020 2020 2020 2020 2020 2020 616b 7320              aks 
+000155e0: 3d20 6b75 6265 7479 7065 203d 3d20 2761  = kubetype == 'a
+000155f0: 6b73 270a 2020 2020 2020 2020 6966 2068  ks'.        if h
+00015600: 7970 6572 7368 6966 743a 0a20 2020 2020  ypershift:.     
+00015610: 2020 2020 2020 206b 7562 6563 6f6e 6669         kubeconfi
+00015620: 676d 676d 7420 3d20 6622 7b63 6c75 7374  gmgmt = f"{clust
+00015630: 6572 6469 727d 2f6b 7562 6563 6f6e 6669  erdir}/kubeconfi
+00015640: 672e 6d67 6d74 220a 2020 2020 2020 2020  g.mgmt".        
+00015650: 2020 2020 6361 6c6c 2866 274b 5542 4543      call(f'KUBEC
+00015660: 4f4e 4649 473d 7b6b 7562 6563 6f6e 6669  ONFIG={kubeconfi
+00015670: 676d 676d 747d 206f 6320 6465 6c65 7465  gmgmt} oc delete
+00015680: 202d 6620 7b63 6c75 7374 6572 6469 727d   -f {clusterdir}
+00015690: 2f61 7574 6f61 7070 726f 7665 7263 726f  /autoapprovercro
+000156a0: 6e2e 796d 6c27 2c20 7368 656c 6c3d 5472  n.yml', shell=Tr
+000156b0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+000156c0: 6361 6c6c 2866 274b 5542 4543 4f4e 4649  call(f'KUBECONFI
+000156d0: 473d 7b6b 7562 6563 6f6e 6669 676d 676d  G={kubeconfigmgm
+000156e0: 747d 206f 6320 6465 6c65 7465 202d 6620  t} oc delete -f 
+000156f0: 7b63 6c75 7374 6572 6469 727d 2f6e 6f64  {clusterdir}/nod
+00015700: 6570 6f6f 6c2e 7961 6d6c 272c 2073 6865  epool.yaml', she
+00015710: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00015720: 2020 2020 2063 616c 6c28 6627 4b55 4245       call(f'KUBE
+00015730: 434f 4e46 4947 3d7b 6b75 6265 636f 6e66  CONFIG={kubeconf
+00015740: 6967 6d67 6d74 7d20 6f63 2064 656c 6574  igmgmt} oc delet
+00015750: 6520 2d66 207b 636c 7573 7465 7264 6972  e -f {clusterdir
+00015760: 7d2f 686f 7374 6564 636c 7573 7465 722e  }/hostedcluster.
+00015770: 7961 6d6c 272c 2073 6865 6c6c 3d54 7275  yaml', shell=Tru
+00015780: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+00015790: 6620 6e6f 7420 6173 7369 7374 6564 2061  f not assisted a
+000157a0: 6e64 2028 2762 6172 656d 6574 616c 5f69  nd ('baremetal_i
+000157b0: 736f 2720 696e 2063 6c75 7374 6572 6461  so' in clusterda
+000157c0: 7461 206f 7220 2762 6172 656d 6574 616c  ta or 'baremetal
+000157d0: 5f68 6f73 7473 2720 696e 2063 6c75 7374  _hosts' in clust
+000157e0: 6572 6461 7461 293a 0a20 2020 2020 2020  erdata):.       
+000157f0: 2020 2020 2020 2020 2063 616c 6c28 274b           call('K
+00015800: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
+00015810: 6f6e 6669 676d 676d 747d 206f 6320 2d6e  onfigmgmt} oc -n
+00015820: 2064 6566 6175 6c74 2064 656c 6574 6520   default delete 
+00015830: 616c 6c20 2d6c 2061 7070 3d68 7474 7064  all -l app=httpd
+00015840: 2d6b 636c 6927 2c20 7368 656c 6c3d 5472  -kcli', shell=Tr
+00015850: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00015860: 2020 2020 6361 6c6c 2827 4b55 4245 434f      call('KUBECO
+00015870: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
+00015880: 6d67 6d74 7d20 6f63 202d 6e20 6465 6661  mgmt} oc -n defa
+00015890: 756c 7420 6465 6c65 7465 2073 7663 2068  ult delete svc h
+000158a0: 7474 7064 2d6b 636c 692d 7376 6327 2c20  ttpd-kcli-svc', 
+000158b0: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
+000158c0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+000158d0: 2827 4b55 4245 434f 4e46 4947 3d7b 6b75  ('KUBECONFIG={ku
+000158e0: 6265 636f 6e66 6967 6d67 6d74 7d20 6f63  beconfigmgmt} oc
+000158f0: 202d 6e20 6465 6661 756c 7420 6465 6c65   -n default dele
+00015900: 7465 2070 7663 2068 7474 7064 2d6b 636c  te pvc httpd-kcl
+00015910: 692d 7076 6327 2c20 7368 656c 6c3d 5472  i-pvc', shell=Tr
+00015920: 7565 290a 2020 2020 2020 2020 6966 2067  ue).        if g
+00015930: 6b65 3a0a 2020 2020 2020 2020 2020 2020  ke:.            
+00015940: 6763 7063 6c69 656e 7420 3d20 4e6f 6e65  gcpclient = None
+00015950: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00015960: 2763 6c69 656e 7427 2069 6e20 636c 7573  'client' in clus
+00015970: 7465 7264 6174 613a 0a20 2020 2020 2020  terdata:.       
+00015980: 2020 2020 2020 2020 2067 6370 636c 6965           gcpclie
+00015990: 6e74 203d 2063 6c75 7374 6572 6461 7461  nt = clusterdata
+000159a0: 5b27 636c 6965 6e74 275d 0a20 2020 2020  ['client'].     
+000159b0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+000159c0: 2e74 7970 6520 3d3d 2027 676b 6527 3a0a  .type == 'gke':.
+000159d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159e0: 6763 7063 6c69 656e 7420 3d20 7365 6c66  gcpclient = self
+000159f0: 2e63 6c69 656e 740a 2020 2020 2020 2020  .client.        
+00015a00: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00015a10: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00015a20: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
+00015a30: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
+00015a40: 2022 4465 6c65 7469 6e67 2067 6b65 2063   "Deleting gke c
+00015a50: 6c75 7374 6572 2072 6571 7569 7265 7320  luster requires 
+00015a60: 746f 2069 6e73 7461 6e74 6961 7465 2067  to instantiate g
+00015a70: 6370 2070 726f 7669 6465 7222 7d0a 2020  cp provider"}.  
+00015a80: 2020 2020 2020 2020 2020 6672 6f6d 206b            from k
+00015a90: 7669 7274 2e63 6c75 7374 6572 2069 6d70  virt.cluster imp
+00015aa0: 6f72 7420 676b 650a 2020 2020 2020 2020  ort gke.        
+00015ab0: 2020 2020 6375 7272 656e 7463 6f6e 6669      currentconfi
+00015ac0: 6720 3d20 4b63 6f6e 6669 6728 636c 6965  g = Kconfig(clie
+00015ad0: 6e74 3d67 6370 636c 6965 6e74 292e 6b20  nt=gcpclient).k 
+00015ae0: 6966 2067 6370 636c 6965 6e74 2021 3d20  if gcpclient != 
+00015af0: 7365 6c66 2e63 6c69 656e 7420 656c 7365  self.client else
+00015b00: 2073 656c 660a 2020 2020 2020 2020 2020   self.          
+00015b10: 2020 7a6f 6e61 6c20 3d20 636c 7573 7465    zonal = cluste
+00015b20: 7264 6174 612e 6765 7428 277a 6f6e 616c  rdata.get('zonal
+00015b30: 272c 2054 7275 6529 0a20 2020 2020 2020  ', True).       
+00015b40: 2020 2020 2067 6b65 2e64 656c 6574 6528       gke.delete(
+00015b50: 6375 7272 656e 7463 6f6e 6669 672c 2063  currentconfig, c
+00015b60: 6c75 7374 6572 2c20 7a6f 6e61 6c29 0a20  luster, zonal). 
+00015b70: 2020 2020 2020 2065 6c69 6620 656b 733a         elif eks:
+00015b80: 0a20 2020 2020 2020 2020 2020 2065 6b73  .            eks
+00015b90: 636c 6965 6e74 203d 204e 6f6e 650a 2020  client = None.  
+00015ba0: 2020 2020 2020 2020 2020 6966 2027 636c            if 'cl
+00015bb0: 6965 6e74 2720 696e 2063 6c75 7374 6572  ient' in cluster
+00015bc0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00015bd0: 2020 2020 2020 656b 7363 6c69 656e 7420        eksclient 
+00015be0: 3d20 636c 7573 7465 7264 6174 615b 2763  = clusterdata['c
+00015bf0: 6c69 656e 7427 5d0a 2020 2020 2020 2020  lient'].        
+00015c00: 2020 2020 656c 6966 2073 656c 662e 7479      elif self.ty
+00015c10: 7065 203d 3d20 2761 7773 273a 0a20 2020  pe == 'aws':.   
+00015c20: 2020 2020 2020 2020 2020 2020 2065 6b73               eks
+00015c30: 636c 6965 6e74 203d 2073 656c 662e 636c  client = self.cl
+00015c40: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
+00015c50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015c60: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00015c70: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+00015c80: 6527 2c20 2772 6561 736f 6e27 3a20 2244  e', 'reason': "D
+00015c90: 656c 6574 696e 6720 656b 7320 636c 7573  eleting eks clus
+00015ca0: 7465 7220 7265 7175 6972 6573 2074 6f20  ter requires to 
+00015cb0: 696e 7374 616e 7469 6174 6520 6177 7320  instantiate aws 
+00015cc0: 7072 6f76 6964 6572 227d 0a20 2020 2020  provider"}.     
+00015cd0: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
+00015ce0: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
+00015cf0: 2065 6b73 0a20 2020 2020 2020 2020 2020   eks.           
+00015d00: 2063 7572 7265 6e74 636f 6e66 6967 203d   currentconfig =
+00015d10: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
+00015d20: 656b 7363 6c69 656e 7429 2e6b 2069 6620  eksclient).k if 
+00015d30: 656b 7363 6c69 656e 7420 213d 2073 656c  eksclient != sel
+00015d40: 662e 636c 6965 6e74 2065 6c73 6520 7365  f.client else se
+00015d50: 6c66 0a20 2020 2020 2020 2020 2020 2065  lf.            e
+00015d60: 6b73 2e64 656c 6574 6528 6375 7272 656e  ks.delete(curren
+00015d70: 7463 6f6e 6669 672c 2063 6c75 7374 6572  tconfig, cluster
+00015d80: 290a 2020 2020 2020 2020 656c 6966 2061  ).        elif a
+00015d90: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+00015da0: 616b 7363 6c69 656e 7420 3d20 4e6f 6e65  aksclient = None
+00015db0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00015dc0: 2763 6c69 656e 7427 2069 6e20 636c 7573  'client' in clus
+00015dd0: 7465 7264 6174 613a 0a20 2020 2020 2020  terdata:.       
+00015de0: 2020 2020 2020 2020 2061 6b73 636c 6965           aksclie
+00015df0: 6e74 203d 2063 6c75 7374 6572 6461 7461  nt = clusterdata
+00015e00: 5b27 636c 6965 6e74 275d 0a20 2020 2020  ['client'].     
+00015e10: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00015e20: 2e74 7970 6520 3d3d 2027 617a 7572 6527  .type == 'azure'
+00015e30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015e40: 2020 656b 7363 6c69 656e 7420 3d20 7365    eksclient = se
+00015e50: 6c66 2e63 6c69 656e 740a 2020 2020 2020  lf.client.      
+00015e60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00015e70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015e80: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
+00015e90: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
+00015ea0: 273a 2022 4465 6c65 7469 6e67 2061 6b73  ': "Deleting aks
+00015eb0: 2063 6c75 7374 6572 2072 6571 7569 7265   cluster require
+00015ec0: 7320 746f 2069 6e73 7461 6e74 6961 7465  s to instantiate
+00015ed0: 2061 7a75 7265 2070 726f 7669 6465 7222   azure provider"
+00015ee0: 7d0a 2020 2020 2020 2020 2020 2020 6672  }.            fr
+00015ef0: 6f6d 206b 7669 7274 2e63 6c75 7374 6572  om kvirt.cluster
+00015f00: 2069 6d70 6f72 7420 616b 730a 2020 2020   import aks.    
+00015f10: 2020 2020 2020 2020 6375 7272 656e 7463          currentc
+00015f20: 6f6e 6669 6720 3d20 4b63 6f6e 6669 6728  onfig = Kconfig(
+00015f30: 636c 6965 6e74 3d61 6b73 636c 6965 6e74  client=aksclient
+00015f40: 292e 6b20 6966 2061 6b73 636c 6965 6e74  ).k if aksclient
+00015f50: 2021 3d20 7365 6c66 2e63 6c69 656e 7420   != self.client 
+00015f60: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
+00015f70: 2020 2020 2020 616b 732e 6465 6c65 7465        aks.delete
+00015f80: 2863 7572 7265 6e74 636f 6e66 6967 2c20  (currentconfig, 
+00015f90: 636c 7573 7465 7229 0a20 2020 2020 2020  cluster).       
+00015fa0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+00015fb0: 7473 2863 6c75 7374 6572 6469 7229 3a0a  ts(clusterdir):.
+00015fc0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00015fd0: 6e74 2866 2244 656c 6574 696e 6720 6469  nt(f"Deleting di
+00015fe0: 7265 6374 6f72 7920 7b63 6c75 7374 6572  rectory {cluster
+00015ff0: 6469 727d 2229 0a20 2020 2020 2020 2020  dir}").         
+00016000: 2020 2072 6d74 7265 6528 636c 7573 7465     rmtree(cluste
+00016010: 7264 6972 2c20 6967 6e6f 7265 5f65 7272  rdir, ignore_err
+00016020: 6f72 733d 5472 7565 290a 2020 2020 2020  ors=True).      
+00016030: 2020 6966 2063 6f6e 7461 696e 6572 3a0a    if container:.
+00016040: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00016050: 203d 204b 636f 6e74 6169 6e65 7263 6f6e   = Kcontainercon
+00016060: 6669 6728 7365 6c66 2c20 636c 6965 6e74  fig(self, client
+00016070: 3d73 656c 662e 636f 6e74 6169 6e65 7263  =self.containerc
+00016080: 6c69 656e 7429 2e63 6f6e 740a 2020 2020  lient).cont.    
+00016090: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
+000160a0: 6120 696e 2073 6f72 7465 6428 636f 6e74  a in sorted(cont
+000160b0: 2e6c 6973 745f 636f 6e74 6169 6e65 7273  .list_containers
+000160c0: 286b 2929 3a0a 2020 2020 2020 2020 2020  (k)):.          
+000160d0: 2020 2020 2020 6e61 6d65 203d 2063 6f6e        name = con
+000160e0: 7461 5b30 5d0a 2020 2020 2020 2020 2020  ta[0].          
+000160f0: 2020 2020 2020 636f 6e74 6169 6e65 725f        container_
+00016100: 706c 616e 203d 2063 6f6e 7461 5b33 5d0a  plan = conta[3].
+00016110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016120: 6966 2063 6f6e 7461 696e 6572 5f70 6c61  if container_pla
+00016130: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
+00016140: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00016150: 6f6e 742e 6465 6c65 7465 5f63 6f6e 7461  ont.delete_conta
+00016160: 696e 6572 286e 616d 6529 0a20 2020 2020  iner(name).     
+00016170: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00016180: 7563 6365 7373 2866 2243 6f6e 7461 696e  uccess(f"Contain
+00016190: 6572 207b 6e61 6d65 7d20 6465 6c65 7465  er {name} delete
+000161a0: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
+000161b0: 2020 2020 2020 2020 2066 6f75 6e64 203d           found =
+000161c0: 2054 7275 650a 2020 2020 2020 2020 6966   True.        if
+000161d0: 206e 6f74 2073 656c 662e 6b65 6570 5f6e   not self.keep_n
+000161e0: 6574 776f 726b 733a 0a20 2020 2020 2020  etworks:.       
+000161f0: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
+00016200: 6520 3d3d 2027 6b76 6d27 3a0a 2020 2020  e == 'kvm':.    
+00016210: 2020 2020 2020 2020 2020 2020 6e65 7477              netw
+00016220: 6f72 6b73 203d 206b 2e6c 6973 745f 6e65  orks = k.list_ne
+00016230: 7477 6f72 6b73 2829 0a20 2020 2020 2020  tworks().       
+00016240: 2020 2020 2020 2020 2066 6f72 206e 6574           for net
+00016250: 776f 726b 2069 6e20 6b2e 6c69 7374 5f6e  work in k.list_n
+00016260: 6574 776f 726b 7328 293a 0a20 2020 2020  etworks():.     
+00016270: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016280: 6620 2770 6c61 6e27 2069 6e20 6e65 7477  f 'plan' in netw
+00016290: 6f72 6b73 5b6e 6574 776f 726b 5d20 616e  orks[network] an
+000162a0: 6420 6e65 7477 6f72 6b73 5b6e 6574 776f  d networks[netwo
+000162b0: 726b 5d5b 2770 6c61 6e27 5d20 3d3d 2070  rk]['plan'] == p
+000162c0: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
+000162d0: 2020 2020 2020 2020 2020 2020 206e 6574               net
+000162e0: 776f 726b 7265 7375 6c74 203d 206b 2e64  workresult = k.d
+000162f0: 656c 6574 655f 6e65 7477 6f72 6b28 6e65  elete_network(ne
+00016300: 7477 6f72 6b29 0a20 2020 2020 2020 2020  twork).         
+00016310: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016320: 6620 6e65 7477 6f72 6b72 6573 756c 745b  f networkresult[
+00016330: 2772 6573 756c 7427 5d20 3d3d 2027 7375  'result'] == 'su
+00016340: 6363 6573 7327 3a0a 2020 2020 2020 2020  ccess':.        
+00016350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016360: 2020 2020 7375 6363 6573 7328 6622 6e65      success(f"ne
+00016370: 7477 6f72 6b20 7b6e 6574 776f 726b 7d20  twork {network} 
+00016380: 6465 6c65 7465 6421 2229 0a20 2020 2020  deleted!").     
+00016390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163a0: 2020 2020 2020 2066 6f75 6e64 203d 2054         found = T
+000163b0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+000163c0: 656c 6966 206e 6574 776f 726b 733a 0a20  elif networks:. 
+000163d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000163e0: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+000163f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00016400: 6e65 7477 6f72 6b20 696e 206e 6574 776f  network in netwo
+00016410: 726b 733a 0a20 2020 2020 2020 2020 2020  rks:.           
+00016420: 2020 2020 2020 2020 206e 6574 776f 726b           network
+00016430: 7265 7375 6c74 203d 206b 2e64 656c 6574  result = k.delet
+00016440: 655f 6e65 7477 6f72 6b28 6e65 7477 6f72  e_network(networ
+00016450: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
+00016460: 2020 2020 2020 2069 6620 6e65 7477 6f72         if networ
+00016470: 6b72 6573 756c 745b 2772 6573 756c 7427  kresult['result'
+00016480: 5d20 3d3d 2027 7375 6363 6573 7327 3a0a  ] == 'success':.
+00016490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164a0: 2020 2020 2020 2020 7375 6363 6573 7328          success(
+000164b0: 6622 556e 7573 6564 206e 6574 776f 726b  f"Unused network
+000164c0: 207b 6e65 7477 6f72 6b7d 2064 656c 6574   {network} delet
+000164d0: 6564 2122 290a 2020 2020 2020 2020 666f  ed!").        fo
+000164e0: 7220 6b65 7966 696c 6520 696e 2067 6c6f  r keyfile in glo
+000164f0: 622e 676c 6f62 2822 2573 2e6b 6579 2a22  b.glob("%s.key*"
+00016500: 2025 2070 6c61 6e29 3a0a 2020 2020 2020   % plan):.      
+00016510: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+00016520: 6669 6c65 207b 6b65 7966 696c 657d 2066  file {keyfile} f
+00016530: 726f 6d20 7b70 6c61 6e7d 2064 656c 6574  rom {plan} delet
+00016540: 6564 2122 290a 2020 2020 2020 2020 2020  ed!").          
+00016550: 2020 6f73 2e72 656d 6f76 6528 6b65 7966    os.remove(keyf
+00016560: 696c 6529 0a20 2020 2020 2020 2066 6f72  ile).        for
+00016570: 2061 6e73 6962 6c65 6669 6c65 2069 6e20   ansiblefile in 
+00016580: 676c 6f62 2e67 6c6f 6228 222f 746d 702f  glob.glob("/tmp/
+00016590: 2573 2a69 6e76 2a22 2025 2070 6c61 6e29  %s*inv*" % plan)
+000165a0: 3a0a 2020 2020 2020 2020 2020 2020 7375  :.            su
+000165b0: 6363 6573 7328 6622 6669 6c65 207b 616e  ccess(f"file {an
+000165c0: 7369 626c 6566 696c 657d 2066 726f 6d20  siblefile} from 
+000165d0: 7b70 6c61 6e7d 2064 656c 6574 6564 2122  {plan} deleted!"
+000165e0: 290a 2020 2020 2020 2020 2020 2020 6f73  ).            os
+000165f0: 2e72 656d 6f76 6528 616e 7369 626c 6566  .remove(ansiblef
+00016600: 696c 6529 0a20 2020 2020 2020 2069 6620  ile).        if 
+00016610: 6465 6c65 7465 646c 6273 2061 6e64 2073  deletedlbs and s
+00016620: 656c 662e 7479 7065 2069 6e20 5b27 6177  elf.type in ['aw
+00016630: 7327 2c20 2761 7a75 7265 272c 2027 6763  s', 'azure', 'gc
+00016640: 7027 5d3a 0a20 2020 2020 2020 2020 2020  p']:.           
+00016650: 2066 6f72 206c 6220 696e 2064 656c 6574   for lb in delet
+00016660: 6564 6c62 733a 0a20 2020 2020 2020 2020  edlbs:.         
+00016670: 2020 2020 2020 2073 656c 662e 6465 6c65         self.dele
+00016680: 7465 5f6c 6f61 6462 616c 616e 6365 7228  te_loadbalancer(
+00016690: 6c62 290a 2020 2020 2020 2020 6966 2066  lb).        if f
+000166a0: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
+000166b0: 2020 7375 6363 6573 7328 6622 506c 616e    success(f"Plan
+000166c0: 207b 706c 616e 7d20 6465 6c65 7465 6421   {plan} deleted!
+000166d0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+000166e0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+000166f0: 2027 7375 6363 6573 7327 2c20 2764 656c   'success', 'del
+00016700: 6574 6564 766d 273a 2064 656c 6574 6564  etedvm': deleted
+00016710: 766d 737d 0a20 2020 2020 2020 2065 6c73  vms}.        els
+00016720: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
+00016730: 7272 6f72 2866 224e 6f20 6f62 6a65 6374  rror(f"No object
+00016740: 7320 666f 756e 6420 6475 7269 6e67 2064  s found during d
+00016750: 656c 6574 696f 6e20 6f66 2070 6c61 6e20  eletion of plan 
+00016760: 7b70 6c61 6e7d 2229 0a20 2020 2020 2020  {plan}").       
+00016770: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00016780: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00016790: 7d0a 0a20 2020 2064 6566 2073 6e61 7073  }..    def snaps
+000167a0: 686f 745f 706c 616e 2873 656c 662c 2070  hot_plan(self, p
+000167b0: 6c61 6e2c 2073 6e61 7073 686f 746e 616d  lan, snapshotnam
+000167c0: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+000167d0: 206b 203d 2073 656c 662e 6b0a 2020 2020   k = self.k.    
+000167e0: 2020 2020 736e 6170 7368 6f74 666f 756e      snapshotfoun
+000167f0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
+00016800: 2020 7070 7269 6e74 2866 2253 6e61 7073    pprint(f"Snaps
+00016810: 686f 7474 696e 6720 766d 7320 6672 6f6d  hotting vms from
+00016820: 2070 6c61 6e20 7b70 6c61 6e7d 2229 0a20   plan {plan}"). 
+00016830: 2020 2020 2020 2069 6620 736e 6170 7368         if snapsh
+00016840: 6f74 6e61 6d65 2069 7320 4e6f 6e65 3a0a  otname is None:.
+00016850: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00016860: 696e 6728 6622 5573 696e 6720 7b70 6c61  ing(f"Using {pla
+00016870: 6e7d 2061 7320 736e 6170 7368 6f74 206e  n} as snapshot n
+00016880: 616d 6520 6173 204e 6f6e 6520 7761 7320  ame as None was 
+00016890: 7072 6f76 6964 6564 2229 0a20 2020 2020  provided").     
+000168a0: 2020 2020 2020 2073 6e61 7073 686f 746e         snapshotn
+000168b0: 616d 6520 3d20 706c 616e 0a20 2020 2020  ame = plan.     
+000168c0: 2020 2066 6f72 2076 6d20 696e 2073 6f72     for vm in sor
+000168d0: 7465 6428 6b2e 6c69 7374 2829 2c20 6b65  ted(k.list(), ke
+000168e0: 793d 6c61 6d62 6461 2078 3a20 785b 276e  y=lambda x: x['n
+000168f0: 616d 6527 5d29 3a0a 2020 2020 2020 2020  ame']):.        
+00016900: 2020 2020 6e61 6d65 203d 2076 6d5b 276e      name = vm['n
+00016910: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
+00016920: 2020 6465 7363 7269 7074 696f 6e20 3d20    description = 
+00016930: 766d 5b27 706c 616e 275d 0a20 2020 2020  vm['plan'].     
+00016940: 2020 2020 2020 2069 6620 6465 7363 7269         if descri
+00016950: 7074 696f 6e20 3d3d 2070 6c61 6e3a 0a20  ption == plan:. 
+00016960: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00016970: 6e61 7073 686f 7466 6f75 6e64 203d 2054  napshotfound = T
+00016980: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00016990: 2020 2020 6b2e 6372 6561 7465 5f73 6e61      k.create_sna
+000169a0: 7073 686f 7428 736e 6170 7368 6f74 6e61  pshot(snapshotna
+000169b0: 6d65 2c20 6e61 6d65 290a 2020 2020 2020  me, name).      
+000169c0: 2020 2020 2020 2020 2020 7375 6363 6573            succes
+000169d0: 7328 6622 7b6e 616d 657d 2073 6e61 7073  s(f"{name} snaps
+000169e0: 686f 7474 6564 2122 290a 2020 2020 2020  hotted!").      
+000169f0: 2020 6966 2073 6e61 7073 686f 7466 6f75    if snapshotfou
+00016a00: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
+00016a10: 7375 6363 6573 7328 6622 506c 616e 207b  success(f"Plan {
+00016a20: 706c 616e 7d20 736e 6170 7368 6f74 7465  plan} snapshotte
+00016a30: 6421 2229 0a20 2020 2020 2020 2065 6c73  d!").        els
+00016a40: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
+00016a50: 6172 6e69 6e67 2822 4e6f 206d 6174 6368  arning("No match
+00016a60: 696e 6720 766d 7320 666f 756e 6422 290a  ing vms found").
+00016a70: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+00016a80: 2772 6573 756c 7427 3a20 2773 7563 6365  'result': 'succe
+00016a90: 7373 277d 0a0a 2020 2020 6465 6620 7265  ss'}..    def re
+00016aa0: 7665 7274 5f70 6c61 6e28 7365 6c66 2c20  vert_plan(self, 
+00016ab0: 706c 616e 2c20 736e 6170 7368 6f74 6e61  plan, snapshotna
+00016ac0: 6d65 3d4e 6f6e 6529 3a0a 2020 2020 2020  me=None):.      
+00016ad0: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
+00016ae0: 2020 2020 2072 6576 6572 7466 6f75 6e64       revertfound
+00016af0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00016b00: 2070 7072 696e 7428 6622 5265 7665 7274   pprint(f"Revert
+00016b10: 696e 6720 736e 6170 7368 6f74 7320 6f66  ing snapshots of
+00016b20: 2076 6d73 2066 726f 6d20 706c 616e 207b   vms from plan {
+00016b30: 706c 616e 7d22 290a 2020 2020 2020 2020  plan}").        
+00016b40: 6966 2073 6e61 7073 686f 746e 616d 6520  if snapshotname 
+00016b50: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00016b60: 2020 2020 2077 6172 6e69 6e67 2866 2255       warning(f"U
+00016b70: 7369 6e67 207b 706c 616e 7dc2 a061 7320  sing {plan}..as 
+00016b80: 736e 6170 7368 6f74 206e 616d 6520 6173  snapshot name as
+00016b90: 204e 6f6e 6520 7761 7320 7072 6f76 6964   None was provid
+00016ba0: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
+00016bb0: 2073 6e61 7073 686f 746e 616d 6520 3d20   snapshotname = 
+00016bc0: 706c 616e 0a20 2020 2020 2020 2066 6f72  plan.        for
+00016bd0: 2076 6d20 696e 2073 6f72 7465 6428 6b2e   vm in sorted(k.
+00016be0: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
+00016bf0: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
+00016c00: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+00016c10: 6d65 203d 2076 6d5b 276e 616d 6527 5d0a  me = vm['name'].
+00016c20: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+00016c30: 7269 7074 696f 6e20 3d20 766d 5b27 706c  ription = vm['pl
+00016c40: 616e 275d 0a20 2020 2020 2020 2020 2020  an'].           
+00016c50: 2069 6620 6465 7363 7269 7074 696f 6e20   if description 
+00016c60: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
+00016c70: 2020 2020 2020 2020 2072 6576 6572 7466           revertf
+00016c80: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+00016c90: 2020 2020 2020 2020 2020 2020 6b2e 7265              k.re
+00016ca0: 7665 7274 5f73 6e61 7073 686f 7428 736e  vert_snapshot(sn
+00016cb0: 6170 7368 6f74 6e61 6d65 2c20 6e61 6d65  apshotname, name
+00016cc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016cd0: 2020 7375 6363 6573 7328 6622 736e 6170    success(f"snap
+00016ce0: 7368 6f74 206f 6620 7b6e 616d 657d 2072  shot of {name} r
+00016cf0: 6576 6572 7465 6421 2229 0a20 2020 2020  everted!").     
+00016d00: 2020 2069 6620 7265 7665 7274 666f 756e     if revertfoun
+00016d10: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+00016d20: 7563 6365 7373 2866 2250 6c61 6e20 7b70  uccess(f"Plan {p
+00016d30: 6c61 6e7d 2072 6576 6572 7465 6420 7769  lan} reverted wi
+00016d40: 7468 2073 6e61 7073 686f 7420 7b73 6e61  th snapshot {sna
+00016d50: 7073 686f 746e 616d 657d 2122 290a 2020  pshotname}!").  
+00016d60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00016d70: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00016d80: 224e 6f20 6d61 7463 6869 6e67 2076 6d73  "No matching vms
+00016d90: 2066 6f75 6e64 2229 0a20 2020 2020 2020   found").       
+00016da0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+00016db0: 273a 2027 7375 6363 6573 7327 7d0a 0a20  ': 'success'}.. 
+00016dc0: 2020 2064 6566 2070 6c61 6e28 7365 6c66     def plan(self
+00016dd0: 2c20 706c 616e 2c20 616e 7369 626c 653d  , plan, ansible=
+00016de0: 4661 6c73 652c 2075 726c 3d4e 6f6e 652c  False, url=None,
+00016df0: 2070 6174 683d 4e6f 6e65 2c20 636f 6e74   path=None, cont
+00016e00: 6169 6e65 723d 4661 6c73 652c 2069 6e70  ainer=False, inp
+00016e10: 7574 6669 6c65 3d4e 6f6e 652c 2069 6e70  utfile=None, inp
+00016e20: 7574 7374 7269 6e67 3d4e 6f6e 652c 0a20  utstring=None,. 
+00016e30: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+00016e40: 7269 6465 733d 7b7d 2c20 696e 666f 3d46  rides={}, info=F
+00016e50: 616c 7365 2c20 7570 6461 7465 3d46 616c  alse, update=Fal
+00016e60: 7365 2c20 656d 6265 6464 6564 3d46 616c  se, embedded=Fal
+00016e70: 7365 2c20 646f 776e 6c6f 6164 3d46 616c  se, download=Fal
+00016e80: 7365 2c20 7175 6965 743d 4661 6c73 652c  se, quiet=False,
+00016e90: 2064 6f63 3d46 616c 7365 2c0a 2020 2020   doc=False,.    
+00016ea0: 2020 2020 2020 2020 206f 6e6c 7961 7373           onlyass
+00016eb0: 6574 733d 4661 6c73 652c 2070 7265 3d54  ets=False, pre=T
+00016ec0: 7275 652c 2070 6f73 743d 5472 7565 2c20  rue, post=True, 
+00016ed0: 6578 636c 7564 6576 6d73 3d5b 5d2c 2062  excludevms=[], b
+00016ee0: 6173 656d 6f64 653d 4661 6c73 652c 2074  asemode=False, t
+00016ef0: 6872 6561 6465 643d 4661 6c73 6529 3a0a  hreaded=False):.
+00016f00: 2020 2020 2020 2020 2222 224d 616e 6167          """Manag
+00016f10: 6520 706c 616e 2066 696c 6522 2222 0a20  e plan file""". 
+00016f20: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
+00016f30: 6b0a 2020 2020 2020 2020 6e6f 5f6f 7665  k.        no_ove
+00016f40: 7272 6964 6573 203d 206e 6f74 206f 7665  rrides = not ove
+00016f50: 7272 6964 6573 0a20 2020 2020 2020 2074  rrides.        t
+00016f60: 6872 6561 6473 203d 205b 5d0a 2020 2020  hreads = [].    
+00016f70: 2020 2020 6e65 7776 6d73 203d 205b 5d0a      newvms = [].
+00016f80: 2020 2020 2020 2020 6e65 7761 7373 6574          newasset
+00016f90: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+00016fa0: 6169 6c65 6476 6d73 203d 205b 5d0a 2020  ailedvms = [].  
+00016fb0: 2020 2020 2020 6578 6973 7469 6e67 766d        existingvm
+00016fc0: 7320 3d20 5b5d 0a20 2020 2020 2020 2061  s = [].        a
+00016fd0: 7379 6e63 7761 6974 766d 7320 3d20 5b5d  syncwaitvms = []
+00016fe0: 0a20 2020 2020 2020 206f 6e66 6c79 203d  .        onfly =
+00016ff0: 204e 6f6e 650a 2020 2020 2020 2020 746f   None.        to
+00017000: 636c 6561 6e20 3d20 4661 6c73 650a 2020  clean = False.  
+00017010: 2020 2020 2020 6765 7462 6163 6b20 3d20        getback = 
+00017020: 4661 6c73 650a 2020 2020 2020 2020 766d  False.        vm
+00017030: 7072 6f66 696c 6573 203d 207b 6b65 793a  profiles = {key:
+00017040: 2076 616c 7565 2066 6f72 206b 6579 2c20   value for key, 
+00017050: 7661 6c75 6520 696e 2073 656c 662e 7072  value in self.pr
+00017060: 6f66 696c 6573 2e69 7465 6d73 2829 0a20  ofiles.items(). 
+00017070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017080: 2020 2020 2069 6620 2774 7970 6527 206e       if 'type' n
+00017090: 6f74 2069 6e20 7661 6c75 6520 6f72 2076  ot in value or v
+000170a0: 616c 7565 5b27 7479 7065 275d 203d 3d20  alue['type'] == 
+000170b0: 2776 6d27 7d0a 2020 2020 2020 2020 636f  'vm'}.        co
+000170c0: 6e74 6169 6e65 7270 726f 6669 6c65 7320  ntainerprofiles 
+000170d0: 3d20 7b6b 6579 3a20 7661 6c75 6520 666f  = {key: value fo
+000170e0: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
+000170f0: 7365 6c66 2e70 726f 6669 6c65 732e 6974  self.profiles.it
+00017100: 656d 7328 290a 2020 2020 2020 2020 2020  ems().          
+00017110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017120: 2020 2069 6620 2774 7970 6527 2069 6e20     if 'type' in 
+00017130: 7661 6c75 6520 616e 6420 7661 6c75 655b  value and value[
+00017140: 2774 7970 6527 5d20 3d3d 2027 636f 6e74  'type'] == 'cont
+00017150: 6169 6e65 7227 7d0a 2020 2020 2020 2020  ainer'}.        
+00017160: 6966 2070 6c61 6e20 6973 204e 6f6e 653a  if plan is None:
+00017170: 0a20 2020 2020 2020 2020 2020 2070 6c61  .            pla
+00017180: 6e20 3d20 6e61 6d65 7574 696c 732e 6765  n = nameutils.ge
+00017190: 745f 7261 6e64 6f6d 5f6e 616d 6528 290a  t_random_name().
+000171a0: 2020 2020 2020 2020 6966 2075 726c 2069          if url i
+000171b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000171c0: 2020 2020 2020 2020 6966 2075 726c 2e73          if url.s
+000171d0: 7461 7274 7377 6974 6828 272f 2729 3a0a  tartswith('/'):.
+000171e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171f0: 7572 6c20 3d20 6622 6669 6c65 3a2f 2f7b  url = f"file://{
+00017200: 7572 6c7d 220a 2020 2020 2020 2020 2020  url}".          
+00017210: 2020 6966 206e 6f74 2075 726c 2e65 6e64    if not url.end
+00017220: 7377 6974 6828 272e 796d 6c27 293a 0a20  swith('.yml'):. 
+00017230: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00017240: 726c 203d 2066 227b 7572 6c7d 2f6b 636c  rl = f"{url}/kcl
+00017250: 695f 706c 616e 2e79 6d6c 220a 2020 2020  i_plan.yml".    
+00017260: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00017270: 6e74 2866 2254 7279 696e 6720 746f 2072  nt(f"Trying to r
+00017280: 6574 7269 6576 6520 7b75 726c 7d22 290a  etrieve {url}").
+00017290: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+000172a0: 7466 696c 6520 3d20 6f73 2e70 6174 682e  tfile = os.path.
+000172b0: 6261 7365 6e61 6d65 2875 726c 290a 2020  basename(url).  
+000172c0: 2020 2020 2020 2020 2020 6f6e 666c 7920            onfly 
+000172d0: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
+000172e0: 6528 7572 6c29 0a20 2020 2020 2020 2020  e(url).         
+000172f0: 2020 2070 6174 6820 3d20 706c 616e 2069     path = plan i
+00017300: 6620 7061 7468 2069 7320 4e6f 6e65 2065  f path is None e
+00017310: 6c73 6520 7061 7468 0a20 2020 2020 2020  lse path.       
+00017320: 2020 2020 2069 6620 6e6f 7420 7175 6965       if not quie
+00017330: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00017340: 2020 2070 7072 696e 7428 6622 5265 7472     pprint(f"Retr
+00017350: 6965 7669 6e67 2073 7065 6369 6669 6564  ieving specified
+00017360: 2070 6c61 6e20 6672 6f6d 207b 7572 6c7d   plan from {url}
+00017370: 2074 6f20 7b70 6174 687d 2229 0a20 2020   to {path}").   
+00017380: 2020 2020 2020 2020 2069 6620 636f 6e74           if cont
+00017390: 6169 6e65 725f 6d6f 6465 2829 3a0a 2020  ainer_mode():.  
+000173a0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000173b0: 7468 203d 2066 222f 776f 726b 6469 722f  th = f"/workdir/
+000173c0: 7b70 6174 687d 220a 2020 2020 2020 2020  {path}".        
+000173d0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+000173e0: 7468 2e65 7869 7374 7328 7061 7468 293a  th.exists(path):
+000173f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017400: 2074 6f63 6c65 616e 203d 2054 7275 650a   toclean = True.
+00017410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017420: 636f 6d6d 6f6e 2e66 6574 6368 2875 726c  common.fetch(url
+00017430: 2c20 7061 7468 290a 2020 2020 2020 2020  , path).        
+00017440: 2020 2020 2020 2020 666f 7220 6465 6661          for defa
+00017450: 756c 745f 7061 7261 6d65 7465 725f 6669  ult_parameter_fi
+00017460: 6c65 2069 6e20 5b27 2f6b 636c 695f 6465  le in ['/kcli_de
+00017470: 6661 756c 742e 796d 6c27 2c20 6627 2f7b  fault.yml', f'/{
+00017480: 706c 616e 7d5f 6465 6661 756c 742e 796d  plan}_default.ym
+00017490: 6c27 2c0a 2020 2020 2020 2020 2020 2020  l',.            
+000174a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174c0: 2020 2022 2f25 735f 6465 6661 756c 7425     "/%s_default%
+000174d0: 7322 2025 206f 732e 7061 7468 2e73 706c  s" % os.path.spl
+000174e0: 6974 6578 7428 6f73 2e70 6174 682e 6261  itext(os.path.ba
+000174f0: 7365 6e61 6d65 2875 726c 2929 5d3a 0a20  sename(url))]:. 
+00017500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017510: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017530: 636f 6d6d 6f6e 2e66 6574 6368 286f 732e  common.fetch(os.
+00017540: 7061 7468 2e64 6972 6e61 6d65 2875 726c  path.dirname(url
+00017550: 2920 2b20 6465 6661 756c 745f 7061 7261  ) + default_para
+00017560: 6d65 7465 725f 6669 6c65 2c20 7061 7468  meter_file, path
+00017570: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017580: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00017590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175a0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+000175b0: 2020 2020 2020 2065 6c69 6620 646f 776e         elif down
+000175c0: 6c6f 6164 3a0a 2020 2020 2020 2020 2020  load:.          
+000175d0: 2020 2020 2020 6d73 6720 3d20 6622 7461        msg = f"ta
+000175e0: 7267 6574 2064 6972 6563 746f 7279 207b  rget directory {
+000175f0: 7061 7468 7d20 616c 7265 6164 7920 7468  path} already th
+00017600: 6572 6522 0a20 2020 2020 2020 2020 2020  ere".           
+00017610: 2020 2020 2065 7272 6f72 286d 7367 290a       error(msg).
+00017620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017630: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+00017640: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+00017650: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
+00017660: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00017670: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00017680: 7269 6e74 2866 2255 7369 6e67 2065 7869  rint(f"Using exi
+00017690: 7374 696e 6720 6469 7265 6374 6f72 7920  sting directory 
+000176a0: 7b70 6174 687d 2229 0a20 2020 2020 2020  {path}").       
+000176b0: 2020 2020 2069 6620 646f 776e 6c6f 6164       if download
+000176c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000176d0: 2020 696e 7075 7466 696c 6520 3d20 6622    inputfile = f"
+000176e0: 7b70 6174 687d 2f7b 696e 7075 7466 696c  {path}/{inputfil
+000176f0: 657d 220a 2020 2020 2020 2020 2020 2020  e}".            
+00017700: 2020 2020 656e 7472 6965 732c 206f 7665      entries, ove
+00017710: 7272 6964 6573 2c20 6261 7365 6669 6c65  rrides, basefile
+00017720: 2c20 6261 7365 6469 7220 3d20 7365 6c66  , basedir = self
+00017730: 2e70 726f 6365 7373 5f69 6e70 7574 6669  .process_inputfi
+00017740: 6c65 2870 6c61 6e2c 2069 6e70 7574 6669  le(plan, inputfi
+00017750: 6c65 2c20 6f76 6572 7269 6465 733d 6f76  le, overrides=ov
+00017760: 6572 7269 6465 732c 0a20 2020 2020 2020  errides,.       
+00017770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177b0: 2020 2020 2020 2020 6f6e 666c 793d 6f6e          onfly=on
+000177c0: 666c 792c 2066 756c 6c3d 5472 7565 2c0a  fly, full=True,.
+000177d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017810: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00017820: 6f77 6e6c 6f61 645f 6d6f 6465 3d54 7275  ownload_mode=Tru
+00017830: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00017840: 2020 206f 732e 6368 6469 7228 7061 7468     os.chdir(path
+00017850: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017860: 2020 666f 7220 656e 7472 7920 696e 2065    for entry in e
+00017870: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
+00017880: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00017890: 7479 7065 2720 696e 2065 6e74 7269 6573  type' in entries
+000178a0: 5b65 6e74 7279 5d20 616e 6420 656e 7472  [entry] and entr
+000178b0: 6965 735b 656e 7472 795d 5b27 7479 7065  ies[entry]['type
+000178c0: 275d 2021 3d20 2776 6d27 3a0a 2020 2020  '] != 'vm':.    
+000178d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178e0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+000178f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017900: 2076 6d65 6e74 7279 203d 2065 6e74 7269   vmentry = entri
+00017910: 6573 5b65 6e74 7279 5d0a 2020 2020 2020  es[entry].      
+00017920: 2020 2020 2020 2020 2020 2020 2020 766d                vm
+00017930: 6669 6c65 7320 3d20 766d 656e 7472 792e  files = vmentry.
+00017940: 6765 7428 2766 696c 6573 272c 205b 5d29  get('files', [])
+00017950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017960: 2020 2020 2073 6372 6970 7466 696c 6573       scriptfiles
+00017970: 203d 2076 6d65 6e74 7279 2e67 6574 2827   = vmentry.get('
+00017980: 7363 7269 7074 7327 2c20 5b5d 290a 2020  scripts', []).  
+00017990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179a0: 2020 666f 7220 6669 6c20 696e 2076 6d66    for fil in vmf
+000179b0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+000179c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000179d0: 2069 7369 6e73 7461 6e63 6528 6669 6c2c   isinstance(fil,
+000179e0: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+000179f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a00: 2020 206f 7269 6769 6e20 3d20 6669 6c0a     origin = fil.
+00017a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a20: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+00017a30: 6e73 7461 6e63 6528 6669 6c2c 2064 6963  nstance(fil, dic
+00017a40: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a60: 6f72 6967 696e 203d 2066 696c 2e67 6574  origin = fil.get
+00017a70: 2827 6f72 6967 696e 2729 0a20 2020 2020  ('origin').     
+00017a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00017aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ab0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00017ac0: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00017ad0: 2c20 2772 6561 736f 6e27 3a20 2249 6e63  , 'reason': "Inc
+00017ae0: 6f72 7265 6374 2066 696c 6520 656e 7472  orrect file entr
+00017af0: 7922 7d0a 2020 2020 2020 2020 2020 2020  y"}.            
+00017b00: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00017b10: 7e27 206e 6f74 2069 6e20 6f72 6967 696e  ~' not in origin
+00017b20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017b30: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00017b40: 7374 6469 7220 3d20 222e 220a 2020 2020  stdir = ".".    
+00017b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b60: 2020 2020 2020 2020 6966 2027 2f27 2069          if '/' i
+00017b70: 6e20 6f72 6967 696e 3a0a 2020 2020 2020  n origin:.      
+00017b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b90: 2020 2020 2020 2020 2020 6465 7374 6469            destdi
+00017ba0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
+00017bb0: 616d 6528 6f72 6967 696e 290a 2020 2020  ame(origin).    
+00017bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bd0: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00017be0: 616b 6564 6972 7328 6465 7374 6469 722c  akedirs(destdir,
+00017bf0: 2065 7869 7374 5f6f 6b3d 5472 7565 290a   exist_ok=True).
+00017c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c10: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00017c20: 6e74 2866 2252 6574 7269 6576 696e 6720  nt(f"Retrieving 
+00017c30: 6669 6c65 207b 6f6e 666c 797d 2f7b 6f72  file {onfly}/{or
+00017c40: 6967 696e 7d22 290a 2020 2020 2020 2020  igin}").        
+00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c60: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00017c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c80: 2020 2020 2020 2020 2063 6f6d 6d6f 6e2e           common.
+00017c90: 6665 7463 6828 6622 7b6f 6e66 6c79 7d2f  fetch(f"{onfly}/
+00017ca0: 7b6f 7269 6769 6e7d 222c 2064 6573 7464  {origin}", destd
+00017cb0: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
+00017cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cd0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
 00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cf0: 2020 2020 7072 655f 7363 7269 7074 203d      pre_script =
-00017d00: 2073 656c 662e 7072 6f63 6573 735f 696e   self.process_in
-00017d10: 7075 7466 696c 6528 2778 7878 272c 2070  putfile('xxx', p
-00017d20: 7265 5f73 6372 6970 742c 206f 7665 7272  re_script, overr
-00017d30: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+00017cf0: 2020 2020 2020 2020 6966 2063 6f6d 6d6f          if commo
+00017d00: 6e2e 7572 6c5f 6578 6973 7473 2866 227b  n.url_exists(f"{
+00017d10: 6f6e 666c 797d 2f7b 6f72 6967 696e 7d2f  onfly}/{origin}/
+00017d20: 5245 4144 4d45 2e6d 6422 293a 0a20 2020  README.md"):.   
+00017d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00017d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d50: 2020 2020 7769 7468 206f 7065 6e28 6622      with open(f"
-00017d60: 7b74 6d70 6469 727d 2f70 7265 2e73 6822  {tmpdir}/pre.sh"
-00017d70: 2c20 2777 2729 2061 7320 663a 0a20 2020  , 'w') as f:.   
+00017d50: 206f 732e 6d61 6b65 6469 7273 286f 7269   os.makedirs(ori
+00017d60: 6769 6e2c 2065 7869 7374 5f6f 6b3d 5472  gin, exist_ok=Tr
+00017d70: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
 00017d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d90: 2020 2020 2066 2e77 7269 7465 2870 7265       f.write(pre
-00017da0: 5f73 6372 6970 7429 0a20 2020 2020 2020  _script).       
-00017db0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00017dc0: 5f72 756e 203d 2072 756e 2866 2762 6173  _run = run(f'bas
-00017dd0: 6820 7b74 6d70 6469 727d 2f70 7265 2e73  h {tmpdir}/pre.s
-00017de0: 6827 2c20 7368 656c 6c3d 5472 7565 2c20  h', shell=True, 
-00017df0: 7374 646f 7574 3d50 4950 452c 2073 7464  stdout=PIPE, std
-00017e00: 6572 723d 5354 444f 5554 2c0a 2020 2020  err=STDOUT,.    
-00017e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e20: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00017e30: 6976 6572 7361 6c5f 6e65 776c 696e 6573  iversal_newlines
-00017e40: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00017e50: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-00017e60: 655f 7275 6e2e 7265 7475 726e 636f 6465  e_run.returncode
-00017e70: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
-00017e80: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00017e90: 7367 203d 2066 2249 7373 7565 2077 6865  sg = f"Issue whe
-00017ea0: 6e20 7275 6e6e 696e 6720 7b70 7265 5f73  n running {pre_s
-00017eb0: 6372 6970 745f 7368 6f72 747d 203a 5c6e  cript_short} :\n
-00017ec0: 7b70 7265 5f72 756e 2e73 7464 6f75 747d  {pre_run.stdout}
-00017ed0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00017ee0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00017ef0: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
-00017f00: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00017f10: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00017f20: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
-00017f30: 6e27 3a20 6d73 677d 0a20 2020 2020 2020  n': msg}.       
-00017f40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00017f50: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00017f60: 6e67 2866 2253 6b69 7070 696e 6720 7b70  ng(f"Skipping {p
-00017f70: 7265 5f73 6372 6970 745f 7368 6f72 747d  re_script_short}
-00017f80: 2061 7320 7265 7175 6573 7465 6422 290a   as requested").
-00017f90: 2020 2020 2020 2020 6b65 7977 6f72 6473          keywords
-00017fa0: 203d 2073 656c 662e 6c69 7374 5f6b 6579   = self.list_key
-00017fb0: 776f 7264 7328 290a 2020 2020 2020 2020  words().        
-00017fc0: 666f 7220 6b65 7920 696e 2073 6f72 7465  for key in sorte
-00017fd0: 6428 6f76 6572 7269 6465 7329 3a0a 2020  d(overrides):.  
-00017fe0: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00017ff0: 2069 6e20 6b65 7977 6f72 6473 3a0a 2020   in keywords:.  
-00018000: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00018010: 795f 7661 6c75 6520 3d20 6765 7461 7474  y_value = getatt
-00018020: 7228 7365 6c66 2c20 6b65 7929 0a20 2020  r(self, key).   
-00018030: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00018040: 5f74 7970 6520 3d20 7479 7065 286b 6579  _type = type(key
-00018050: 5f76 616c 7565 290a 2020 2020 2020 2020  _value).        
-00018060: 2020 2020 2020 2020 6f76 6572 7269 6465          override
-00018070: 5f6b 6579 5f74 7970 6520 3d20 7479 7065  _key_type = type
-00018080: 286f 7665 7272 6964 6573 5b6b 6579 5d29  (overrides[key])
-00018090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000180a0: 2069 6620 6b65 795f 7661 6c75 6520 6973   if key_value is
-000180b0: 206e 6f74 204e 6f6e 6520 616e 6420 6f76   not None and ov
-000180c0: 6572 7269 6465 735b 6b65 795d 2069 7320  errides[key] is 
-000180d0: 6e6f 7420 4e6f 6e65 2061 6e64 206b 6579  not None and key
-000180e0: 5f74 7970 6520 213d 206f 7665 7272 6964  _type != overrid
-000180f0: 655f 6b65 795f 7479 7065 3a0a 2020 2020  e_key_type:.    
-00018100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018110: 6572 726f 7228 6622 5468 6520 7072 6f76  error(f"The prov
-00018120: 6964 6564 2070 6172 616d 6574 6572 207b  ided parameter {
-00018130: 6b65 797d 2068 6173 2061 2077 726f 6e67  key} has a wrong
-00018140: 2074 7970 6520 7b6f 7665 7272 6964 655f   type {override_
-00018150: 6b65 795f 7479 7065 7d2c 2069 7420 7368  key_type}, it sh
-00018160: 6f75 6c64 2062 6520 7b6b 6579 5f74 7970  ould be {key_typ
-00018170: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00018180: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00018190: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-000181a0: 2020 2020 2065 6c69 6620 6f76 6572 7269       elif overri
-000181b0: 6465 735b 6b65 795d 2069 7320 6e6f 7420  des[key] is not 
-000181c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000181d0: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
-000181e0: 7228 7365 6c66 2c20 6b65 792c 206f 7665  r(self, key, ove
-000181f0: 7272 6964 6573 5b6b 6579 5d29 0a20 2020  rrides[key]).   
-00018200: 2020 2020 2076 6d65 6e74 7269 6573 203d       vmentries =
-00018210: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-00018220: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
-00018230: 2774 7970 6527 206e 6f74 2069 6e20 656e  'type' not in en
-00018240: 7472 6965 735b 656e 7472 795d 206f 7220  tries[entry] or 
-00018250: 656e 7472 6965 735b 656e 7472 795d 5b27  entries[entry]['
-00018260: 7479 7065 275d 203d 3d20 2776 6d27 5d0a  type'] == 'vm'].
-00018270: 2020 2020 2020 2020 6469 736b 656e 7472          diskentr
-00018280: 6965 7320 3d20 5b65 6e74 7279 2066 6f72  ies = [entry for
-00018290: 2065 6e74 7279 2069 6e20 656e 7472 6965   entry in entrie
-000182a0: 7320 6966 2027 7479 7065 2720 696e 2065  s if 'type' in e
-000182b0: 6e74 7269 6573 5b65 6e74 7279 5d20 616e  ntries[entry] an
-000182c0: 6420 656e 7472 6965 735b 656e 7472 795d  d entries[entry]
-000182d0: 5b27 7479 7065 275d 203d 3d20 2764 6973  ['type'] == 'dis
-000182e0: 6b27 5d0a 2020 2020 2020 2020 6e65 7477  k'].        netw
-000182f0: 6f72 6b65 6e74 7269 6573 203d 205b 656e  orkentries = [en
-00018300: 7472 7920 666f 7220 656e 7472 7920 696e  try for entry in
-00018310: 2065 6e74 7269 6573 0a20 2020 2020 2020   entries.       
-00018320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018330: 2020 2069 6620 2774 7970 6527 2069 6e20     if 'type' in 
-00018340: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
-00018350: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
-00018360: 5d5b 2774 7970 6527 5d20 3d3d 2027 6e65  ]['type'] == 'ne
-00018370: 7477 6f72 6b27 5d0a 2020 2020 2020 2020  twork'].        
-00018380: 636f 6e74 6169 6e65 7265 6e74 7269 6573  containerentries
-00018390: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
-000183a0: 7472 7920 696e 2065 6e74 7269 6573 0a20  try in entries. 
-000183b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183c0: 2020 2020 2020 2020 2020 2069 6620 2774             if 't
-000183d0: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
-000183e0: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
-000183f0: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
-00018400: 5d20 3d3d 2027 636f 6e74 6169 6e65 7227  ] == 'container'
-00018410: 5d0a 2020 2020 2020 2020 616e 7369 626c  ].        ansibl
-00018420: 6565 6e74 7269 6573 203d 205b 656e 7472  eentries = [entr
-00018430: 7920 666f 7220 656e 7472 7920 696e 2065  y for entry in e
-00018440: 6e74 7269 6573 0a20 2020 2020 2020 2020  ntries.         
-00018450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018460: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
-00018470: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
-00018480: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
-00018490: 2774 7970 6527 5d20 3d3d 2027 616e 7369  'type'] == 'ansi
-000184a0: 626c 6527 5d0a 2020 2020 2020 2020 7072  ble'].        pr
-000184b0: 6f66 696c 6565 6e74 7269 6573 203d 205b  ofileentries = [
-000184c0: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-000184d0: 696e 2065 6e74 7269 6573 0a20 2020 2020  in entries.     
-000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184f0: 2020 2020 2069 6620 2774 7970 6527 2069       if 'type' i
-00018500: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
-00018510: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
-00018520: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
-00018530: 7072 6f66 696c 6527 5d0a 2020 2020 2020  profile'].      
-00018540: 2020 696d 6167 6565 6e74 7269 6573 203d    imageentries =
-00018550: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-00018560: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
-00018570: 2774 7970 6527 2069 6e0a 2020 2020 2020  'type' in.      
-00018580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018590: 2020 656e 7472 6965 735b 656e 7472 795d    entries[entry]
-000185a0: 2061 6e64 2028 656e 7472 6965 735b 656e   and (entries[en
-000185b0: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
-000185c0: 2769 6d61 6765 2720 6f72 2065 6e74 7269  'image' or entri
-000185d0: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
-000185e0: 5d20 3d3d 2027 7465 6d70 6c61 7465 2729  ] == 'template')
-000185f0: 5d0a 2020 2020 2020 2020 706f 6f6c 656e  ].        poolen
-00018600: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
-00018610: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
-00018620: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
-00018630: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
-00018640: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
-00018650: 795d 5b27 7479 7065 275d 203d 3d20 2770  y]['type'] == 'p
-00018660: 6f6f 6c27 5d0a 2020 2020 2020 2020 706c  ool'].        pl
-00018670: 616e 656e 7472 6965 7320 3d20 5b65 6e74  anentries = [ent
-00018680: 7279 2066 6f72 2065 6e74 7279 2069 6e20  ry for entry in 
-00018690: 656e 7472 6965 7320 6966 2027 7479 7065  entries if 'type
-000186a0: 2720 696e 2065 6e74 7269 6573 5b65 6e74  ' in entries[ent
-000186b0: 7279 5d20 616e 6420 656e 7472 6965 735b  ry] and entries[
-000186c0: 656e 7472 795d 5b27 7479 7065 275d 203d  entry]['type'] =
-000186d0: 3d20 2770 6c61 6e27 5d0a 2020 2020 2020  = 'plan'].      
-000186e0: 2020 646e 7365 6e74 7269 6573 203d 205b    dnsentries = [
-000186f0: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-00018700: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
-00018710: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
-00018720: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
-00018730: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
-00018740: 5d20 3d3d 2027 646e 7327 5d0a 2020 2020  ] == 'dns'].    
-00018750: 2020 2020 6b75 6265 7320 3d20 5b27 6b75      kubes = ['ku
-00018760: 6265 272c 2027 636c 7573 7465 7227 5d0a  be', 'cluster'].
-00018770: 2020 2020 2020 2020 6b75 6265 656e 7472          kubeentr
-00018780: 6965 7320 3d20 5b65 6e74 7279 2066 6f72  ies = [entry for
-00018790: 2065 6e74 7279 2069 6e20 656e 7472 6965   entry in entrie
-000187a0: 7320 6966 2027 7479 7065 2720 696e 2065  s if 'type' in e
-000187b0: 6e74 7269 6573 5b65 6e74 7279 5d20 616e  ntries[entry] an
-000187c0: 6420 656e 7472 6965 735b 656e 7472 795d  d entries[entry]
-000187d0: 5b27 7479 7065 275d 2069 6e20 6b75 6265  ['type'] in kube
-000187e0: 735d 0a20 2020 2020 2020 206c 6273 203d  s].        lbs =
-000187f0: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-00018800: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
-00018810: 2774 7970 6527 2069 6e20 656e 7472 6965  'type' in entrie
-00018820: 735b 656e 7472 795d 2061 6e64 2065 6e74  s[entry] and ent
-00018830: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
-00018840: 6527 5d20 3d3d 2027 6c6f 6164 6261 6c61  e'] == 'loadbala
-00018850: 6e63 6572 275d 0a20 2020 2020 2020 2073  ncer'].        s
-00018860: 6773 203d 205b 656e 7472 7920 666f 7220  gs = [entry for 
-00018870: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
-00018880: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
-00018890: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
-000188a0: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
-000188b0: 2774 7970 6527 5d20 3d3d 2027 7365 6375  'type'] == 'secu
-000188c0: 7269 7479 6772 6f75 7027 5d0a 2020 2020  ritygroup'].    
-000188d0: 2020 2020 6275 636b 6574 656e 7472 6965      bucketentrie
-000188e0: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
-000188f0: 6e74 7279 2069 6e20 656e 7472 6965 7320  ntry in entries 
-00018900: 6966 2027 7479 7065 2720 696e 2065 6e74  if 'type' in ent
-00018910: 7269 6573 5b65 6e74 7279 5d20 616e 6420  ries[entry] and 
-00018920: 656e 7472 6965 735b 656e 7472 795d 5b27  entries[entry]['
-00018930: 7479 7065 275d 203d 3d20 2762 7563 6b65  type'] == 'bucke
-00018940: 7427 5d0a 2020 2020 2020 2020 776f 726b  t'].        work
-00018950: 666c 6f77 656e 7472 6965 7320 3d20 5b65  flowentries = [e
-00018960: 6e74 7279 2066 6f72 2065 6e74 7279 2069  ntry for entry i
-00018970: 6e20 656e 7472 6965 730a 2020 2020 2020  n entries.      
-00018980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018990: 2020 2020 2069 6620 2774 7970 6527 2069       if 'type' i
-000189a0: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
-000189b0: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
-000189c0: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
-000189d0: 776f 726b 666c 6f77 275d 0a20 2020 2020  workflow'].     
-000189e0: 2020 2066 6f72 2070 2069 6e20 7072 6f66     for p in prof
-000189f0: 696c 6565 6e74 7269 6573 3a0a 2020 2020  ileentries:.    
-00018a00: 2020 2020 2020 2020 766d 7072 6f66 696c          vmprofil
-00018a10: 6573 5b70 5d20 3d20 656e 7472 6965 735b  es[p] = entries[
-00018a20: 705d 0a20 2020 2020 2020 2069 6620 6e65  p].        if ne
-00018a30: 7477 6f72 6b65 6e74 7269 6573 2061 6e64  tworkentries and
-00018a40: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
-00018a50: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-00018a60: 696e 7428 2244 6570 6c6f 7969 6e67 204e  int("Deploying N
-00018a70: 6574 776f 726b 732e 2e2e 2229 0a20 2020  etworks...").   
-00018a80: 2020 2020 2020 2020 2066 6f72 206e 6574           for net
-00018a90: 2069 6e20 6e65 7477 6f72 6b65 6e74 7269   in networkentri
-00018aa0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00018ab0: 2020 2020 6e65 7470 726f 6669 6c65 203d      netprofile =
-00018ac0: 2065 6e74 7269 6573 5b6e 6574 5d0a 2020   entries[net].  
-00018ad0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018ae0: 206b 2e6e 6574 5f65 7869 7374 7328 6e65   k.net_exists(ne
-00018af0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00018b00: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00018b10: 224e 6574 776f 726b 207b 6e65 747d 2073  "Network {net} s
-00018b20: 6b69 7070 6564 2122 290a 2020 2020 2020  kipped!").      
-00018b30: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00018b40: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00018b50: 2020 2020 2020 2063 6964 7220 3d20 6e65         cidr = ne
-00018b60: 7470 726f 6669 6c65 2e67 6574 2827 6369  tprofile.get('ci
-00018b70: 6472 2729 0a20 2020 2020 2020 2020 2020  dr').           
-00018b80: 2020 2020 206e 6174 203d 2062 6f6f 6c28       nat = bool(
-00018b90: 6e65 7470 726f 6669 6c65 2e67 6574 2827  netprofile.get('
-00018ba0: 6e61 7427 2c20 5472 7565 2929 0a20 2020  nat', True)).   
-00018bb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00018bc0: 6369 6472 2069 7320 4e6f 6e65 3a0a 2020  cidr is None:.  
-00018bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018be0: 2020 7761 726e 696e 6728 6622 4d69 7373    warning(f"Miss
-00018bf0: 696e 6720 4369 6472 2066 6f72 206e 6574  ing Cidr for net
-00018c00: 776f 726b 207b 6e65 747d 2e20 4e6f 7420  work {net}. Not 
-00018c10: 6372 6561 7469 6e67 2069 742e 2e2e 2229  creating it...")
-00018c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018c30: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00018c40: 2020 2020 2020 2020 2020 2020 2020 6468                dh
-00018c50: 6370 203d 206e 6574 7072 6f66 696c 652e  cp = netprofile.
-00018c60: 6765 7428 2764 6863 7027 2c20 5472 7565  get('dhcp', True
-00018c70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00018c80: 2020 646f 6d61 696e 203d 206e 6574 7072    domain = netpr
-00018c90: 6f66 696c 652e 6765 7428 2764 6f6d 6169  ofile.get('domai
-00018ca0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-00018cb0: 2020 2020 7265 7375 6c74 203d 206b 2e63      result = k.c
-00018cc0: 7265 6174 655f 6e65 7477 6f72 6b28 6e61  reate_network(na
-00018cd0: 6d65 3d6e 6574 2c20 6369 6472 3d63 6964  me=net, cidr=cid
-00018ce0: 722c 2064 6863 703d 6468 6370 2c20 6e61  r, dhcp=dhcp, na
-00018cf0: 743d 6e61 742c 2064 6f6d 6169 6e3d 646f  t=nat, domain=do
-00018d00: 6d61 696e 2c20 706c 616e 3d70 6c61 6e2c  main, plan=plan,
-00018d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d30: 2020 2020 2020 2020 2020 206f 7665 7272             overr
-00018d40: 6964 6573 3d6e 6574 7072 6f66 696c 6529  ides=netprofile)
-00018d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d60: 2063 6f6d 6d6f 6e2e 6861 6e64 6c65 5f72   common.handle_r
-00018d70: 6573 706f 6e73 6528 7265 7375 6c74 2c20  esponse(result, 
-00018d80: 6e65 742c 2065 6c65 6d65 6e74 3d27 4e65  net, element='Ne
-00018d90: 7477 6f72 6b20 2729 0a20 2020 2020 2020  twork ').       
-00018da0: 2069 6620 706f 6f6c 656e 7472 6965 7320   if poolentries 
-00018db0: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
-00018dc0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00018dd0: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
-00018de0: 6720 506f 6f6c 732e 2e2e 2229 0a20 2020  g Pools...").   
-00018df0: 2020 2020 2020 2020 2070 6f6f 6c73 203d           pools =
-00018e00: 206b 2e6c 6973 745f 706f 6f6c 7328 290a   k.list_pools().
-00018e10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00018e20: 706f 6f6c 2069 6e20 706f 6f6c 656e 7472  pool in poolentr
-00018e30: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
-00018e40: 2020 2020 2069 6620 706f 6f6c 2069 6e20       if pool in 
-00018e50: 706f 6f6c 733a 0a20 2020 2020 2020 2020  pools:.         
-00018e60: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00018e70: 7428 6622 506f 6f6c 207b 706f 6f6c 7d20  t(f"Pool {pool} 
-00018e80: 736b 6970 7065 6421 2229 0a20 2020 2020  skipped!").     
-00018e90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00018ea0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00018eb0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00018ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ed0: 2020 706f 6f6c 7072 6f66 696c 6520 3d20    poolprofile = 
-00018ee0: 656e 7472 6965 735b 706f 6f6c 5d0a 2020  entries[pool].  
-00018ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f00: 2020 706f 6f6c 7061 7468 203d 2070 6f6f    poolpath = poo
-00018f10: 6c70 726f 6669 6c65 2e67 6574 2827 7061  lprofile.get('pa
-00018f20: 7468 2729 0a20 2020 2020 2020 2020 2020  th').           
-00018f30: 2020 2020 2020 2020 2069 6620 706f 6f6c           if pool
-00018f40: 7061 7468 2069 7320 4e6f 6e65 3a0a 2020  path is None:.  
-00018f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f60: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-00018f70: 506f 6f6c 207b 706f 6f6c 7d20 736b 6970  Pool {pool} skip
-00018f80: 7065 6420 6173 2070 6174 6820 6973 206d  ped as path is m
-00018f90: 6973 7369 6e67 2122 290a 2020 2020 2020  issing!").      
-00018fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fb0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00018fc0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00018fd0: 2e63 7265 6174 655f 706f 6f6c 2870 6f6f  .create_pool(poo
-00018fe0: 6c2c 2070 6f6f 6c70 6174 6829 0a20 2020  l, poolpath).   
-00018ff0: 2020 2020 2069 6620 696d 6167 6565 6e74       if imageent
-00019000: 7269 6573 2061 6e64 206e 6f74 206f 6e6c  ries and not onl
-00019010: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
-00019020: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
-00019030: 6c6f 7969 6e67 2049 6d61 6765 732e 2e2e  loying Images...
-00019040: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-00019050: 6d61 6765 7320 3d20 5b6f 732e 7061 7468  mages = [os.path
-00019060: 2e62 6173 656e 616d 6528 7429 2066 6f72  .basename(t) for
-00019070: 2074 2069 6e20 6b2e 766f 6c75 6d65 7328   t in k.volumes(
-00019080: 295d 0a20 2020 2020 2020 2020 2020 2066  )].            f
-00019090: 6f72 2069 6d61 6765 2069 6e20 696d 6167  or image in imag
-000190a0: 6565 6e74 7269 6573 3a0a 2020 2020 2020  eentries:.      
-000190b0: 2020 2020 2020 2020 2020 696d 6167 6570            imagep
-000190c0: 726f 6669 6c65 203d 2065 6e74 7269 6573  rofile = entries
-000190d0: 5b69 6d61 6765 5d0a 2020 2020 2020 2020  [image].        
-000190e0: 2020 2020 2020 2020 706f 6f6c 203d 2069          pool = i
-000190f0: 6d61 6765 7072 6f66 696c 652e 6765 7428  mageprofile.get(
-00019100: 2770 6f6f 6c27 2c20 7365 6c66 2e70 6f6f  'pool', self.poo
-00019110: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-00019120: 2020 2069 6d61 6765 7369 7a65 203d 2069     imagesize = i
-00019130: 6d61 6765 7072 6f66 696c 652e 6765 7428  mageprofile.get(
-00019140: 2773 697a 6527 290a 2020 2020 2020 2020  'size').        
-00019150: 2020 2020 2020 2020 696d 6167 6575 726c          imageurl
-00019160: 203d 2069 6d61 6765 7072 6f66 696c 652e   = imageprofile.
-00019170: 6765 7428 2775 726c 2729 0a20 2020 2020  get('url').     
-00019180: 2020 2020 2020 2020 2020 2069 6620 696d             if im
-00019190: 6167 6520 696e 2069 6d61 6765 733a 0a20  age in images:. 
-000191a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191b0: 2020 2070 7072 696e 7428 6622 496d 6167     pprint(f"Imag
-000191c0: 6520 7b69 6d61 6765 7d20 736b 6970 7065  e {image} skippe
-000191d0: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
-000191e0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-000191f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00019200: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00019210: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00019220: 7369 6e73 7461 6e63 6528 696d 6167 6575  sinstance(imageu
-00019230: 726c 2c20 7374 7229 2061 6e64 2069 6d61  rl, str) and ima
-00019240: 6765 7572 6c20 3d3d 2022 4e6f 6e65 223a  geurl == "None":
-00019250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019260: 2020 2020 2020 2020 2069 6d61 6765 7572           imageur
-00019270: 6c20 3d20 4e6f 6e65 0a20 2020 2020 2020  l = None.       
-00019280: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-00019290: 203d 2069 6d61 6765 7072 6f66 696c 652e   = imageprofile.
-000192a0: 6765 7428 2763 6d64 2729 0a20 2020 2020  get('cmd').     
-000192b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000192c0: 656c 662e 6861 6e64 6c65 5f68 6f73 7428  elf.handle_host(
-000192d0: 706f 6f6c 3d70 6f6f 6c2c 2069 6d61 6765  pool=pool, image
-000192e0: 3d69 6d61 6765 2c20 646f 776e 6c6f 6164  =image, download
-000192f0: 3d54 7275 652c 2063 6d64 3d63 6d64 2c20  =True, cmd=cmd, 
-00019300: 7572 6c3d 696d 6167 6575 726c 2c20 7369  url=imageurl, si
-00019310: 7a65 3d69 6d61 6765 7369 7a65 290a 2020  ze=imagesize).  
-00019320: 2020 2020 2020 6966 2062 7563 6b65 7465        if buckete
-00019330: 6e74 7269 6573 2061 6e64 206e 6f74 206f  ntries and not o
-00019340: 6e6c 7961 7373 6574 7320 616e 6420 7365  nlyassets and se
-00019350: 6c66 2e74 7970 6520 696e 205b 2761 7773  lf.type in ['aws
-00019360: 272c 2027 6763 7027 2c20 276f 7065 6e73  ', 'gcp', 'opens
-00019370: 7461 636b 275d 3a0a 2020 2020 2020 2020  tack']:.        
-00019380: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
-00019390: 6f79 696e 6720 4275 636b 6574 2045 6e74  oying Bucket Ent
-000193a0: 7269 6573 2e2e 2e22 290a 2020 2020 2020  ries...").      
-000193b0: 2020 2020 2020 666f 7220 6275 636b 6574        for bucket
-000193c0: 656e 7472 7920 696e 2062 7563 6b65 7465  entry in buckete
-000193d0: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
-000193e0: 2020 2020 2020 2020 6275 636b 6574 7072          bucketpr
-000193f0: 6f66 696c 6520 3d20 656e 7472 6965 735b  ofile = entries[
-00019400: 6275 636b 6574 656e 7472 795d 0a20 2020  bucketentry].   
-00019410: 2020 2020 2020 2020 2020 2020 205f 6669               _fi
-00019420: 6c65 7320 3d20 6275 636b 6574 7072 6f66  les = bucketprof
-00019430: 696c 652e 6765 7428 2766 696c 6573 272c  ile.get('files',
-00019440: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
-00019450: 2020 2020 2073 656c 662e 6b2e 6372 6561       self.k.crea
-00019460: 7465 5f62 7563 6b65 7428 6275 636b 6574  te_bucket(bucket
-00019470: 656e 7472 7929 0a20 2020 2020 2020 2020  entry).         
-00019480: 2020 2020 2020 2066 6f72 205f 6669 6c20         for _fil 
-00019490: 696e 205f 6669 6c65 733a 0a20 2020 2020  in _files:.     
-000194a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000194b0: 656c 662e 6b2e 7570 6c6f 6164 5f74 6f5f  elf.k.upload_to_
-000194c0: 6275 636b 6574 2862 7563 6b65 7465 6e74  bucket(bucketent
-000194d0: 7279 2c20 5f66 696c 290a 2020 2020 2020  ry, _fil).      
-000194e0: 2020 7465 6d70 6b65 7920 3d20 6f76 6572    tempkey = over
-000194f0: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
-00019500: 6579 272c 2046 616c 7365 2920 6f72 2073  ey', False) or s
-00019510: 656c 662e 7465 6d70 6b65 790a 2020 2020  elf.tempkey.    
-00019520: 2020 2020 6966 2074 656d 706b 6579 3a0a      if tempkey:.
-00019530: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-00019540: 6b65 7964 6972 203d 2054 656d 706f 7261  keydir = Tempora
-00019550: 7279 4469 7265 6374 6f72 7928 290a 2020  ryDirectory().  
-00019560: 2020 2020 2020 2020 2020 6f76 6572 7269            overri
-00019570: 6465 735b 2774 656d 706b 6579 6469 7227  des['tempkeydir'
-00019580: 5d20 3d20 7465 6d70 6b65 7964 6972 0a20  ] = tempkeydir. 
-00019590: 2020 2020 2020 2020 2020 206f 7665 7272             overr
-000195a0: 6964 6573 5b27 7465 6d70 6b65 7964 6972  ides['tempkeydir
-000195b0: 6b65 6570 275d 203d 2054 7275 650a 2020  keep'] = True.  
-000195c0: 2020 2020 2020 6966 2070 6c61 6e65 6e74        if planent
-000195d0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-000195e0: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
-000195f0: 696e 6720 506c 616e 732e 2e2e 2229 0a20  ing Plans..."). 
-00019600: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-00019610: 6c61 6e65 6e74 7279 2069 6e20 706c 616e  lanentry in plan
-00019620: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
-00019630: 2020 2020 2020 2020 2064 6574 6169 6c73           details
-00019640: 203d 2065 6e74 7269 6573 5b70 6c61 6e65   = entries[plane
-00019650: 6e74 7279 5d0a 2020 2020 2020 2020 2020  ntry].          
-00019660: 2020 2020 2020 706c 616e 7572 6c20 3d20        planurl = 
-00019670: 6465 7461 696c 732e 6765 7428 2775 726c  details.get('url
-00019680: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00019690: 2020 2070 6c61 6e66 696c 6520 3d20 6465     planfile = de
-000196a0: 7461 696c 732e 6765 7428 2766 696c 6527  tails.get('file'
-000196b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000196c0: 2020 6966 2070 6c61 6e75 726c 2069 7320    if planurl is 
-000196d0: 4e6f 6e65 2061 6e64 2070 6c61 6e66 696c  None and planfil
-000196e0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-000196f0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00019700: 6172 6e69 6e67 2866 224d 6973 7369 6e67  arning(f"Missing
-00019710: 2055 726c 2f46 696c 6520 666f 7220 706c   Url/File for pl
-00019720: 616e 207b 706c 616e 656e 7472 797d 2e20  an {planentry}. 
-00019730: 4e6f 7420 6372 6561 7469 6e67 2069 742e  Not creating it.
-00019740: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-00019750: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00019760: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00019770: 2020 656c 6966 2070 6c61 6e75 726c 2069    elif planurl i
-00019780: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00019790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197a0: 7061 7468 203d 2070 6c61 6e65 6e74 7279  path = planentry
-000197b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000197c0: 2020 2020 2069 6620 6e6f 7420 706c 616e       if not plan
-000197d0: 7572 6c2e 656e 6473 7769 7468 2827 796d  url.endswith('ym
-000197e0: 6c27 293a 0a20 2020 2020 2020 2020 2020  l'):.           
-000197f0: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
-00019800: 6e75 726c 203d 2066 227b 706c 616e 7572  nurl = f"{planur
-00019810: 6c7d 2f6b 636c 695f 706c 616e 2e79 6d6c  l}/kcli_plan.yml
-00019820: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00019830: 2020 656c 6966 2027 2f27 2069 6e20 706c    elif '/' in pl
-00019840: 616e 6669 6c65 3a0a 2020 2020 2020 2020  anfile:.        
-00019850: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00019860: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-00019870: 6d65 2870 6c61 6e66 696c 6529 0a20 2020  me(planfile).   
-00019880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019890: 2069 6e70 7574 6669 6c65 203d 206f 732e   inputfile = os.
-000198a0: 7061 7468 2e62 6173 656e 616d 6528 706c  path.basename(pl
-000198b0: 616e 6669 6c65 290a 2020 2020 2020 2020  anfile).        
-000198c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198e0: 2020 7061 7468 203d 2027 2e27 0a20 2020    path = '.'.   
-000198f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019900: 2069 6e70 7574 6669 6c65 203d 2070 6c61   inputfile = pla
-00019910: 6e65 6e74 7279 0a20 2020 2020 2020 2020  nentry.         
-00019920: 2020 2020 2020 2069 6620 6e6f 5f6f 7665         if no_ove
-00019930: 7272 6964 6573 2061 6e64 2070 6172 616d  rrides and param
-00019940: 6574 6572 733a 0a20 2020 2020 2020 2020  eters:.         
-00019950: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00019960: 7428 2255 7369 6e67 2070 6172 616d 6574  t("Using paramet
-00019970: 6572 7320 6672 6f6d 2066 6174 6865 7220  ers from father 
-00019980: 706c 616e 2069 6e20 6368 696c 6420 6f6e  plan in child on
-00019990: 6573 2229 0a20 2020 2020 2020 2020 2020  es").           
-000199a0: 2020 2020 2020 2020 2066 6f72 206f 7665           for ove
-000199b0: 7272 6964 6520 696e 206f 7665 7272 6964  rride in overrid
-000199c0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000199d0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000199e0: 7428 2255 7369 6e67 2070 6172 616d 6574  t("Using paramet
-000199f0: 6572 2025 733a 2025 7322 2025 2028 6f76  er %s: %s" % (ov
-00019a00: 6572 7269 6465 2c20 6f76 6572 7269 6465  erride, override
-00019a10: 735b 6f76 6572 7269 6465 5d29 290a 2020  s[override])).  
-00019a20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00019a30: 6c66 2e70 6c61 6e28 706c 616e 2c20 616e  lf.plan(plan, an
-00019a40: 7369 626c 653d 4661 6c73 652c 2075 726c  sible=False, url
-00019a50: 3d70 6c61 6e75 726c 2c20 7061 7468 3d70  =planurl, path=p
-00019a60: 6174 682c 2063 6f6e 7461 696e 6572 3d46  ath, container=F
-00019a70: 616c 7365 2c20 696e 7075 7466 696c 653d  alse, inputfile=
-00019a80: 696e 7075 7466 696c 652c 0a20 2020 2020  inputfile,.     
-00019a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019aa0: 2020 2020 206f 7665 7272 6964 6573 3d6f       overrides=o
-00019ab0: 7665 7272 6964 6573 2c20 656d 6265 6464  verrides, embedd
-00019ac0: 6564 3d65 6d62 6564 6465 642c 2064 6f77  ed=embedded, dow
-00019ad0: 6e6c 6f61 643d 646f 776e 6c6f 6164 290a  nload=download).
-00019ae0: 2020 2020 2020 2020 6966 206b 7562 6565          if kubee
-00019af0: 6e74 7269 6573 2061 6e64 206e 6f74 206f  ntries and not o
-00019b00: 6e6c 7961 7373 6574 733a 0a20 2020 2020  nlyassets:.     
-00019b10: 2020 2020 2020 2070 7072 696e 7428 2244         pprint("D
-00019b20: 6570 6c6f 7969 6e67 204b 7562 6520 456e  eploying Kube En
-00019b30: 7472 6965 732e 2e2e 2229 0a20 2020 2020  tries...").     
-00019b40: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
-00019b50: 7320 3d20 7b7d 0a20 2020 2020 2020 2020  s = {}.         
-00019b60: 2020 206b 7562 6574 6872 6561 6465 6420     kubethreaded 
-00019b70: 3d20 5472 7565 2069 6620 6c65 6e28 6b75  = True if len(ku
-00019b80: 6265 656e 7472 6965 7329 203e 2031 2065  beentries) > 1 e
-00019b90: 6c73 6520 4661 6c73 650a 2020 2020 2020  lse False.      
-00019ba0: 2020 2020 2020 6966 206b 7562 6574 6872        if kubethr
-00019bb0: 6561 6465 643a 0a20 2020 2020 2020 2020  eaded:.         
-00019bc0: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
-00019bd0: 4c61 756e 6368 696e 6720 6561 6368 2063  Launching each c
-00019be0: 6c75 7374 6572 2069 6e20 6120 7468 7265  luster in a thre
-00019bf0: 6164 2061 7320 7468 6572 6520 6973 206d  ad as there is m
-00019c00: 6f72 6520 7468 616e 206f 6e65 2065 6e74  ore than one ent
-00019c10: 7279 2e2e 2e22 290a 2020 2020 2020 2020  ry...").        
-00019c20: 2020 2020 666f 7220 636c 7573 7465 7220      for cluster 
-00019c30: 696e 206b 7562 6565 6e74 7269 6573 3a0a  in kubeentries:.
-00019c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c50: 7070 7269 6e74 2866 2244 6570 6c6f 7969  pprint(f"Deployi
-00019c60: 6e67 2043 6c75 7374 6572 207b 636c 7573  ng Cluster {clus
-00019c70: 7465 727d 2e2e 2e22 290a 2020 2020 2020  ter}...").      
-00019c80: 2020 2020 2020 2020 2020 6b75 6265 7072            kubepr
-00019c90: 6f66 696c 6520 3d20 656e 7472 6965 735b  ofile = entries[
-00019ca0: 636c 7573 7465 725d 0a20 2020 2020 2020  cluster].       
-00019cb0: 2020 2020 2020 2020 206b 7562 6563 6c69           kubecli
-00019cc0: 656e 7420 3d20 6b75 6265 7072 6f66 696c  ent = kubeprofil
-00019cd0: 652e 6765 7428 2763 6c69 656e 7427 290a  e.get('client').
-00019ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019cf0: 6966 206b 7562 6563 6c69 656e 7420 6973  if kubeclient is
-00019d00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00019d10: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00019d20: 6e74 636f 6e66 6967 203d 2073 656c 660a  ntconfig = self.
-00019d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d40: 656c 6966 206b 7562 6563 6c69 656e 7420  elif kubeclient 
-00019d50: 696e 2073 656c 662e 636c 6965 6e74 733a  in self.clients:
-00019d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019d70: 2020 2020 2063 7572 7265 6e74 636f 6e66       currentconf
-00019d80: 6967 203d 204b 636f 6e66 6967 2863 6c69  ig = Kconfig(cli
-00019d90: 656e 743d 6b75 6265 636c 6965 6e74 290a  ent=kubeclient).
-00019da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019db0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00019dc0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00019dd0: 6622 436c 6965 6e74 207b 6b75 6265 636c  f"Client {kubecl
-00019de0: 6965 6e74 7d20 6e6f 7420 666f 756e 642e  ient} not found.
-00019df0: 2073 6b69 7070 6564 2229 0a20 2020 2020   skipped").     
-00019e00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00019e10: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00019e20: 2020 2020 2020 2020 6b75 6265 7479 7065          kubetype
-00019e30: 203d 206b 7562 6570 726f 6669 6c65 2e67   = kubeprofile.g
-00019e40: 6574 2827 6b75 6265 7479 7065 2729 206f  et('kubetype') o
-00019e50: 7220 6b75 6265 7072 6f66 696c 652e 6765  r kubeprofile.ge
-00019e60: 7428 2763 6c75 7374 6572 7479 7065 272c  t('clustertype',
-00019e70: 2027 6765 6e65 7269 6327 290a 2020 2020   'generic').    
-00019e80: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
-00019e90: 5f6f 7665 7272 6964 6573 203d 206f 7665  _overrides = ove
-00019ea0: 7272 6964 6573 2e63 6f70 7928 290a 2020  rrides.copy().  
-00019eb0: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
-00019ec0: 6265 5f6f 7665 7272 6964 6573 2e75 7064  be_overrides.upd
-00019ed0: 6174 6528 6b75 6265 7072 6f66 696c 6529  ate(kubeprofile)
-00019ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019ef0: 206b 7562 655f 6f76 6572 7269 6465 735b   kube_overrides[
-00019f00: 2763 6c75 7374 6572 275d 203d 2063 6c75  'cluster'] = clu
-00019f10: 7374 6572 0a20 2020 2020 2020 2020 2020  ster.           
-00019f20: 2020 2020 2065 7869 7374 696e 675f 6374       existing_ct
-00019f30: 6c70 6c61 6e65 7320 3d20 5b76 2066 6f72  lplanes = [v for
-00019f40: 2076 2069 6e20 6375 7272 656e 7463 6f6e   v in currentcon
-00019f50: 6669 672e 6b2e 6c69 7374 2829 2069 6620  fig.k.list() if 
-00019f60: 6627 7b63 6c75 7374 6572 7d2d 6374 6c70  f'{cluster}-ctlp
-00019f70: 6c61 6e65 2720 696e 2076 5b27 6e61 6d65  lane' in v['name
-00019f80: 275d 5d0a 2020 2020 2020 2020 2020 2020  ']].            
-00019f90: 2020 2020 6966 2065 7869 7374 696e 675f      if existing_
-00019fa0: 6374 6c70 6c61 6e65 733a 0a20 2020 2020  ctlplanes:.     
-00019fb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00019fc0: 7072 696e 7428 6622 436c 7573 7465 7220  print(f"Cluster 
-00019fd0: 7b63 6c75 7374 6572 7d20 666f 756e 642e  {cluster} found.
-00019fe0: 2073 6b69 7070 6564 2122 290a 2020 2020   skipped!").    
-00019ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a000: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0001a010: 2020 2020 2020 2020 2069 6620 6b75 6265           if kube
-0001a020: 7479 7065 206e 6f74 2069 6e20 5b27 6765  type not in ['ge
-0001a030: 6e65 7269 6327 2c20 276f 7065 6e73 6869  neric', 'openshi
-0001a040: 6674 272c 2027 6879 7065 7273 6869 6674  ft', 'hypershift
-0001a050: 272c 2027 6d69 6372 6f73 6869 6674 272c  ', 'microshift',
-0001a060: 2027 6b33 7327 2c20 2767 6b65 272c 2027   'k3s', 'gke', '
-0001a070: 656b 7327 5d3a 0a20 2020 2020 2020 2020  eks']:.         
-0001a080: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0001a090: 6e67 2866 2249 6e63 6f72 7265 6374 206b  ng(f"Incorrect k
-0001a0a0: 7562 6574 7970 6520 7b6b 7562 6574 7970  ubetype {kubetyp
-0001a0b0: 657d 2073 7065 6369 6669 6564 2e20 736b  e} specified. sk
-0001a0c0: 6970 7065 6421 2229 0a20 2020 2020 2020  ipped!").       
-0001a0d0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001a0e0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-0001a0f0: 2020 2020 2020 6966 206b 7562 6574 6872        if kubethr
-0001a100: 6561 6465 643a 0a20 2020 2020 2020 2020  eaded:.         
-0001a110: 2020 2020 2020 2020 2020 206b 7562 655f             kube_
-0001a120: 6f76 6572 7269 6465 735b 2775 7365 5f65  overrides['use_e
-0001a130: 7869 7374 696e 675f 6f70 656e 7368 6966  xisting_openshif
-0001a140: 7427 5d20 3d20 5472 7565 0a20 2020 2020  t'] = True.     
-0001a150: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001a160: 6577 5f61 7267 7320 3d20 2870 6c61 6e2c  ew_args = (plan,
-0001a170: 206b 7562 6574 7970 652c 206b 7562 655f   kubetype, kube_
-0001a180: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-0001a190: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001a1a0: 203d 2074 6872 6561 6469 6e67 2e54 6872   = threading.Thr
-0001a1b0: 6561 6428 7461 7267 6574 3d73 656c 662e  ead(target=self.
-0001a1c0: 7468 7265 6164 6564 5f63 7265 6174 655f  threaded_create_
-0001a1d0: 6b75 6265 2c20 6172 6773 3d6e 6577 5f61  kube, args=new_a
-0001a1e0: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-0001a1f0: 2020 2020 2020 2020 2074 6872 6561 6473           threads
-0001a200: 2e61 7070 656e 6428 7429 0a20 2020 2020  .append(t).     
-0001a210: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001a220: 2e73 7461 7274 2829 0a20 2020 2020 2020  .start().       
-0001a230: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a250: 2020 2063 7572 7265 6e74 636f 6e66 6967     currentconfig
-0001a260: 2e63 7265 6174 655f 6b75 6265 2870 6c61  .create_kube(pla
-0001a270: 6e2c 206b 7562 6574 7970 652c 206f 7665  n, kubetype, ove
-0001a280: 7272 6964 6573 3d6b 7562 655f 6f76 6572  rrides=kube_over
-0001a290: 7269 6465 7329 0a20 2020 2020 2020 2076  rides).        v
-0001a2a0: 6d63 6c69 656e 7473 203d 205b 5d0a 2020  mclients = [].  
-0001a2b0: 2020 2020 2020 6966 2076 6d65 6e74 7269        if vmentri
-0001a2c0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001a2d0: 6966 206e 6f74 206f 6e6c 7961 7373 6574  if not onlyasset
-0001a2e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001a2f0: 2020 2070 7072 696e 7428 2244 6570 6c6f     pprint("Deplo
-0001a300: 7969 6e67 2056 6d73 2e2e 2e22 290a 2020  ying Vms...").  
-0001a310: 2020 2020 2020 2020 2020 766d 636f 756e            vmcoun
-0001a320: 7465 7220 3d20 300a 2020 2020 2020 2020  ter = 0.        
-0001a330: 2020 2020 686f 7374 7320 3d20 7b7d 0a20      hosts = {}. 
-0001a340: 2020 2020 2020 2020 2020 2076 6d73 5f74             vms_t
-0001a350: 6f5f 686f 7374 203d 207b 7d0a 2020 2020  o_host = {}.    
-0001a360: 2020 2020 2020 2020 6261 7365 706c 616e          baseplan
-0001a370: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
-0001a380: 2020 2076 6d6e 616d 6573 203d 205b 6e61     vmnames = [na
-0001a390: 6d65 2066 6f72 206e 616d 6520 696e 2076  me for name in v
-0001a3a0: 6d65 6e74 7269 6573 5d0a 2020 2020 2020  mentries].      
-0001a3b0: 2020 2020 2020 6966 2062 6173 6566 696c        if basefil
-0001a3c0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0001a3d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001a3e0: 6173 6564 6972 203d 206f 732e 7061 7468  asedir = os.path
-0001a3f0: 2e64 6972 6e61 6d65 2869 6e70 7574 6669  .dirname(inputfi
-0001a400: 6c65 2920 6966 206f 732e 7061 7468 2e69  le) if os.path.i
-0001a410: 7361 6273 2869 6e70 7574 6669 6c65 2920  sabs(inputfile) 
-0001a420: 656c 7365 2027 2e27 0a20 2020 2020 2020  else '.'.       
-0001a430: 2020 2020 2020 2020 2062 6173 6569 6e70           baseinp
-0001a440: 7574 6669 6c65 203d 2066 227b 6261 7365  utfile = f"{base
-0001a450: 6469 727d 2f7b 6261 7365 6669 6c65 7d22  dir}/{basefile}"
-0001a460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a470: 2069 6620 636f 6e74 6169 6e65 725f 6d6f   if container_mo
-0001a480: 6465 2829 2061 6e64 206e 6f74 206f 732e  de() and not os.
-0001a490: 7061 7468 2e69 7361 6273 2862 6173 6566  path.isabs(basef
-0001a4a0: 696c 6529 2061 6e64 2027 2f77 6f72 6b64  ile) and '/workd
-0001a4b0: 6972 2720 6e6f 7420 696e 2062 6173 6564  ir' not in based
-0001a4c0: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
-0001a4d0: 2020 2020 2020 2020 6261 7365 696e 7075          baseinpu
-0001a4e0: 7466 696c 6520 3d20 6622 2f77 6f72 6b64  tfile = f"/workd
-0001a4f0: 6972 2f7b 6261 7365 6469 727d 2f7b 6261  ir/{basedir}/{ba
-0001a500: 7365 6669 6c65 7d22 0a20 2020 2020 2020  sefile}".       
-0001a510: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-0001a520: 3d20 7365 6c66 2e70 6c61 6e28 706c 616e  = self.plan(plan
-0001a530: 2c20 696e 7075 7466 696c 653d 6261 7365  , inputfile=base
-0001a540: 696e 7075 7466 696c 652c 206f 7665 7272  inputfile, overr
-0001a550: 6964 6573 3d6f 7665 7272 6964 6573 2c20  ides=overrides, 
-0001a560: 6578 636c 7564 6576 6d73 3d76 6d6e 616d  excludevms=vmnam
-0001a570: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a590: 2020 2020 2020 2062 6173 656d 6f64 653d         basemode=
-0001a5a0: 5472 7565 2c20 6f6e 6c79 6173 7365 7473  True, onlyassets
-0001a5b0: 3d6f 6e6c 7961 7373 6574 7329 0a20 2020  =onlyassets).   
-0001a5c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001a5d0: 7265 7375 6c74 5b27 7265 7375 6c74 275d  result['result']
-0001a5e0: 2021 3d20 2773 7563 6365 7373 273a 0a20   != 'success':. 
-0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a600: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0001a610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a620: 2062 6173 6570 6c61 6e73 2e61 7070 656e   baseplans.appen
-0001a630: 6428 6261 7365 6669 6c65 290a 2020 2020  d(basefile).    
-0001a640: 2020 2020 2020 2020 766d 7275 6c65 735f          vmrules_
-0001a650: 7374 7269 6374 203d 206f 7665 7272 6964  strict = overrid
-0001a660: 6573 2e67 6574 2827 766d 7275 6c65 735f  es.get('vmrules_
-0001a670: 7374 7269 6374 272c 2073 656c 662e 766d  strict', self.vm
-0001a680: 7275 6c65 735f 7374 7269 6374 290a 2020  rules_strict).  
-0001a690: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
-0001a6a0: 6d65 2069 6e20 766d 656e 7472 6965 733a  me in vmentries:
-0001a6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a6c0: 2069 6620 6e61 6d65 2069 6e20 6578 636c   if name in excl
-0001a6d0: 7564 6576 6d73 3a0a 2020 2020 2020 2020  udevms:.        
-0001a6e0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001a6f0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0001a700: 2020 2020 2063 7572 7265 6e74 706c 616e       currentplan
-0001a710: 6469 7220 3d20 6261 7365 6469 720a 2020  dir = basedir.  
-0001a720: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001a730: 206c 656e 2876 6d65 6e74 7269 6573 2920   len(vmentries) 
-0001a740: 3d3d 2031 2061 6e64 2027 6e61 6d65 2720  == 1 and 'name' 
-0001a750: 696e 206f 7665 7272 6964 6573 3a0a 2020  in overrides:.  
-0001a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a770: 2020 6e65 776e 616d 6520 3d20 6f76 6572    newname = over
-0001a780: 7269 6465 735b 276e 616d 6527 5d0a 2020  rides['name'].  
-0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7a0: 2020 7072 6f66 696c 6520 3d20 656e 7472    profile = entr
-0001a7b0: 6965 735b 6e61 6d65 5d0a 2020 2020 2020  ies[name].      
-0001a7c0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0001a7d0: 6d65 203d 206e 6577 6e61 6d65 0a20 2020  me = newname.   
-0001a7e0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001a7f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001a800: 2020 2020 2020 2070 726f 6669 6c65 203d         profile =
-0001a810: 2065 6e74 7269 6573 5b6e 616d 655d 0a20   entries[name]. 
-0001a820: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a830: 6620 276e 616d 6527 2069 6e20 7072 6f66  f 'name' in prof
-0001a840: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-0001a850: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-0001a860: 7072 6f66 696c 655b 276e 616d 6527 5d0a  profile['name'].
-0001a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a880: 6966 2027 6261 7365 766d 2720 696e 2070  if 'basevm' in p
-0001a890: 726f 6669 6c65 206f 7220 2762 6173 6570  rofile or 'basep
-0001a8a0: 6c61 6e27 2069 6e20 7072 6f66 696c 653a  lan' in profile:
-0001a8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a8c0: 2020 2020 2062 6173 6570 726f 6669 6c65       baseprofile
-0001a8d0: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
-0001a8e0: 2020 2020 2020 2020 2020 6170 7065 6e64            append
-0001a8f0: 6b65 7973 203d 205b 2764 6973 6b73 272c  keys = ['disks',
-0001a900: 2027 6e65 7473 272c 2027 6669 6c65 7327   'nets', 'files'
-0001a910: 2c20 2773 6372 6970 7473 272c 2027 636d  , 'scripts', 'cm
-0001a920: 6473 275d 0a20 2020 2020 2020 2020 2020  ds'].           
-0001a930: 2020 2020 2020 2020 2069 6620 2762 6173           if 'bas
-0001a940: 6570 6c61 6e27 2069 6e20 7072 6f66 696c  eplan' in profil
-0001a950: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001a960: 2020 2020 2020 2020 2020 2062 6173 6570             basep
-0001a970: 6c61 6e20 3d20 7072 6f66 696c 655b 2762  lan = profile['b
-0001a980: 6173 6570 6c61 6e27 5d0a 2020 2020 2020  aseplan'].      
-0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9a0: 2020 6261 7365 6469 7220 3d20 6f73 2e70    basedir = os.p
-0001a9b0: 6174 682e 6469 726e 616d 6528 696e 7075  ath.dirname(inpu
-0001a9c0: 7466 696c 6529 2069 6620 272f 2720 696e  tfile) if '/' in
-0001a9d0: 2069 6e70 7574 6669 6c65 2065 6c73 6520   inputfile else 
-0001a9e0: 272e 270a 2020 2020 2020 2020 2020 2020  '.'.            
-0001a9f0: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0001aa00: 696e 7075 7466 696c 6520 3d20 6622 7b62  inputfile = f"{b
-0001aa10: 6173 6564 6972 7d2f 7b62 6173 6570 6c61  asedir}/{basepla
-0001aa20: 6e7d 220a 2020 2020 2020 2020 2020 2020  n}".            
-0001aa30: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0001aa40: 6f6e 7461 696e 6572 5f6d 6f64 6528 2920  ontainer_mode() 
-0001aa50: 616e 6420 6e6f 7420 6f73 2e70 6174 682e  and not os.path.
-0001aa60: 6973 6162 7328 6261 7365 706c 616e 2920  isabs(baseplan) 
-0001aa70: 616e 6420 272f 776f 726b 6469 7227 206e  and '/workdir' n
-0001aa80: 6f74 2069 6e20 6261 7365 6469 723a 0a20  ot in basedir:. 
-0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aaa0: 2020 2020 2020 2020 2020 2062 6173 6569             basei
-0001aab0: 6e70 7574 6669 6c65 203d 2066 222f 776f  nputfile = f"/wo
-0001aac0: 726b 6469 722f 7b62 6173 6564 6972 7d2f  rkdir/{basedir}/
-0001aad0: 7b62 6173 6570 6c61 6e7d 220a 2020 2020  {baseplan}".    
-0001aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aaf0: 2020 2020 6261 7365 766d 203d 2070 726f      basevm = pro
-0001ab00: 6669 6c65 5b27 6261 7365 766d 275d 2069  file['basevm'] i
-0001ab10: 6620 2762 6173 6576 6d27 2069 6e20 7072  f 'basevm' in pr
-0001ab20: 6f66 696c 6520 656c 7365 206e 616d 650a  ofile else name.
-0001ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab40: 2020 2020 2020 2020 6966 2062 6173 6570          if basep
-0001ab50: 6c61 6e20 6e6f 7420 696e 2062 6173 6570  lan not in basep
-0001ab60: 6c61 6e73 3a0a 2020 2020 2020 2020 2020  lans:.          
-0001ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab80: 2020 7365 6c66 2e70 6c61 6e28 706c 616e    self.plan(plan
-0001ab90: 2c20 696e 7075 7466 696c 653d 6261 7365  , inputfile=base
-0001aba0: 696e 7075 7466 696c 652c 206f 7665 7272  inputfile, overr
-0001abb0: 6964 6573 3d6f 7665 7272 6964 6573 2c20  ides=overrides, 
-0001abc0: 6578 636c 7564 6576 6d73 3d76 6d6e 616d  excludevms=vmnam
-0001abd0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-0001abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abf0: 2020 2020 2020 2020 2020 6261 7365 6d6f            basemo
-0001ac00: 6465 3d54 7275 652c 206f 6e6c 7961 7373  de=True, onlyass
-0001ac10: 6574 733d 6f6e 6c79 6173 7365 7473 290a  ets=onlyassets).
-0001ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac30: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0001ac40: 706c 616e 732e 6170 7065 6e64 2862 6173  plans.append(bas
-0001ac50: 6570 6c61 6e29 0a20 2020 2020 2020 2020  eplan).         
-0001ac60: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001ac70: 6173 6569 6e66 6f20 3d20 7365 6c66 2e70  aseinfo = self.p
-0001ac80: 726f 6365 7373 5f69 6e70 7574 6669 6c65  rocess_inputfile
-0001ac90: 2870 6c61 6e2c 2062 6173 6569 6e70 7574  (plan, baseinput
-0001aca0: 6669 6c65 2c20 6f76 6572 7269 6465 733d  file, overrides=
-0001acb0: 6f76 6572 7269 6465 732c 2066 756c 6c3d  overrides, full=
-0001acc0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0001acd0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-0001ace0: 7365 7072 6f66 696c 6520 3d20 6261 7365  seprofile = base
-0001acf0: 696e 666f 5b30 5d5b 6261 7365 766d 5d20  info[0][basevm] 
-0001ad00: 6966 2062 6173 6576 6d20 696e 2062 6173  if basevm in bas
-0001ad10: 6569 6e66 6f5b 305d 2065 6c73 6520 7b7d  einfo[0] else {}
-0001ad20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ad30: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0001ad40: 706c 616e 6469 7220 3d20 6261 7365 696e  plandir = basein
-0001ad50: 666f 5b33 5d20 6966 206f 732e 7061 7468  fo[3] if os.path
-0001ad60: 2e69 7361 6273 2862 6173 6569 6e66 6f5b  .isabs(baseinfo[
-0001ad70: 335d 2920 656c 7365 2027 2e27 0a20 2020  3]) else '.'.   
-0001ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad90: 2065 6c69 6620 2762 6173 6576 6d27 2069   elif 'basevm' i
-0001ada0: 6e20 7072 6f66 696c 6520 616e 6420 7072  n profile and pr
-0001adb0: 6f66 696c 655b 2762 6173 6576 6d27 5d20  ofile['basevm'] 
-0001adc0: 696e 2062 6173 6565 6e74 7269 6573 3a0a  in baseentries:.
-0001add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ade0: 2020 2020 2020 2020 6261 7365 7072 6f66          baseprof
-0001adf0: 696c 6520 3d20 6261 7365 656e 7472 6965  ile = baseentrie
-0001ae00: 735b 7072 6f66 696c 655b 2762 6173 6576  s[profile['basev
-0001ae10: 6d27 5d5d 0a20 2020 2020 2020 2020 2020  m']].           
-0001ae20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae40: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-0001ae50: 2249 6e63 6f72 7265 6374 2062 6173 6520  "Incorrect base 
-0001ae60: 656e 7472 7920 666f 7220 7b6e 616d 657d  entry for {name}
-0001ae70: 2e20 536b 6970 7069 6e67 2e2e 2e22 290a  . Skipping...").
-0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae90: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0001aea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aeb0: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-0001aec0: 6261 7365 7072 6f66 696c 653a 0a20 2020  baseprofile:.   
-0001aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aee0: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
-0001aef0: 696e 2070 726f 6669 6c65 3a0a 2020 2020  in profile:.    
-0001af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af10: 2020 2020 2020 2020 7072 6f66 696c 655b          profile[
-0001af20: 6b65 795d 203d 2062 6173 6570 726f 6669  key] = baseprofi
-0001af30: 6c65 5b6b 6579 5d0a 2020 2020 2020 2020  le[key].        
-0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af50: 656c 6966 206b 6579 2069 6e20 6261 7365  elif key in base
-0001af60: 7072 6f66 696c 6520 616e 6420 6b65 7920  profile and key 
-0001af70: 696e 2070 726f 6669 6c65 2061 6e64 206b  in profile and k
-0001af80: 6579 2069 6e20 6170 7065 6e64 6b65 7973  ey in appendkeys
-0001af90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001afa0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001afb0: 6f66 696c 655b 6b65 795d 203d 2062 6173  ofile[key] = bas
-0001afc0: 6570 726f 6669 6c65 5b6b 6579 5d20 2b20  eprofile[key] + 
-0001afd0: 7072 6f66 696c 655b 6b65 795d 0a20 2020  profile[key].   
-0001afe0: 2020 2020 2020 2020 2020 2020 2072 756c               rul
-0001aff0: 6566 6f75 6e64 203d 2046 616c 7365 0a20  efound = False. 
-0001b000: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001b010: 6f72 2065 6e74 7279 2069 6e20 6f76 6572  or entry in over
-0001b020: 7269 6465 732e 6765 7428 2776 6d72 756c  rides.get('vmrul
-0001b030: 6573 272c 2073 656c 662e 766d 7275 6c65  es', self.vmrule
-0001b040: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0001b050: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
-0001b060: 6e74 7279 2920 213d 2031 3a0a 2020 2020  ntry) != 1:.    
-0001b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b080: 2020 2020 6572 726f 7228 6622 5772 6f6e      error(f"Wron
-0001b090: 6720 766d 2072 756c 6520 7b65 6e74 7279  g vm rule {entry
-0001b0a0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001b0b0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-0001b0c0: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-0001b0d0: 2020 2020 2020 2020 2020 2020 7275 6c65              rule
-0001b0e0: 203d 206c 6973 7428 656e 7472 792e 6b65   = list(entry.ke
-0001b0f0: 7973 2829 295b 305d 0a20 2020 2020 2020  ys())[0].       
-0001b100: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001b110: 2872 652e 6d61 7463 6828 7275 6c65 2c20  (re.match(rule, 
-0001b120: 6e61 6d65 2920 6f72 2066 6e6d 6174 6368  name) or fnmatch
-0001b130: 286e 616d 652c 2072 756c 6529 2920 616e  (name, rule)) an
-0001b140: 6420 6973 696e 7374 616e 6365 2865 6e74  d isinstance(ent
-0001b150: 7279 5b72 756c 655d 2c20 6469 6374 293a  ry[rule], dict):
-0001b160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b170: 2020 2020 2020 2020 2072 756c 6566 6f75           rulefou
-0001b180: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1a0: 2020 6c69 7374 6b65 7973 203d 205b 2763    listkeys = ['c
-0001b1b0: 6d64 7327 2c20 2766 696c 6573 272c 2027  mds', 'files', '
-0001b1c0: 7363 7269 7074 7327 5d0a 2020 2020 2020  scripts'].      
-0001b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1e0: 2020 666f 7220 7275 6c65 2069 6e20 656e    for rule in en
-0001b1f0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b210: 2063 7572 7265 6e74 203d 2065 6e74 7279   current = entry
-0001b220: 5b72 756c 655d 0a20 2020 2020 2020 2020  [rule].         
-0001b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b240: 2020 2066 6f72 206b 6579 2069 6e20 6375     for key in cu
-0001b250: 7272 656e 743a 0a20 2020 2020 2020 2020  rrent:.         
-0001b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b270: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-0001b280: 206c 6973 746b 6579 7320 616e 6420 6973   listkeys and is
-0001b290: 696e 7374 616e 6365 2863 7572 7265 6e74  instance(current
-0001b2a0: 5b6b 6579 5d2c 206c 6973 7429 2061 6e64  [key], list) and
-0001b2b0: 206b 6579 2069 6e20 7072 6f66 696c 653a   key in profile:
-0001b2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2e0: 2020 2020 2063 7572 7265 6e74 5b6b 6579       current[key
-0001b2f0: 5d20 3d20 7072 6f66 696c 655b 6b65 795d  ] = profile[key]
-0001b300: 202b 2063 7572 7265 6e74 5b6b 6579 5d0a   + current[key].
+00017d90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00017da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017db0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00017dc0: 7269 6e74 2866 2266 696c 6520 7b6f 6e66  rint(f"file {onf
+00017dd0: 6c79 7d2f 7b6f 7269 6769 6e7d 2073 6b69  ly}/{origin} ski
+00017de0: 7070 6564 2229 0a20 2020 2020 2020 2020  pped").         
+00017df0: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00017e00: 6372 6970 7420 696e 2073 6372 6970 7466  cript in scriptf
+00017e10: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+00017e20: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00017e30: 2027 7e27 206e 6f74 2069 6e20 7363 7269   '~' not in scri
+00017e40: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+00017e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e60: 6465 7374 6469 7220 3d20 222e 220a 2020  destdir = ".".  
+00017e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e80: 2020 2020 2020 2020 2020 6966 2027 2f27            if '/'
+00017e90: 2069 6e20 7363 7269 7074 3a0a 2020 2020   in script:.    
+00017ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017eb0: 2020 2020 2020 2020 2020 2020 6465 7374              dest
+00017ec0: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+00017ed0: 726e 616d 6528 7363 7269 7074 290a 2020  rname(script).  
+00017ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ef0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+00017f00: 2e6d 616b 6564 6972 7328 6465 7374 6469  .makedirs(destdi
+00017f10: 722c 2065 7869 7374 5f6f 6b3d 5472 7565  r, exist_ok=True
+00017f20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017f30: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00017f40: 7269 6e74 2866 2252 6574 7269 6576 696e  rint(f"Retrievin
+00017f50: 6720 7363 7269 7074 207b 6f6e 666c 797d  g script {onfly}
+00017f60: 2f7b 7363 7269 7074 7d22 290a 2020 2020  /{script}").    
+00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f80: 2020 2020 2020 2020 636f 6d6d 6f6e 2e66          common.f
+00017f90: 6574 6368 2866 227b 6f6e 666c 797d 2f7b  etch(f"{onfly}/{
+00017fa0: 7363 7269 7074 7d22 2c20 6465 7374 6469  script}", destdi
+00017fb0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+00017fc0: 2020 206f 732e 6368 6469 7228 272e 2e27     os.chdir('..'
+00017fd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017fe0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+00017ff0: 7427 3a20 2773 7563 6365 7373 277d 0a20  t': 'success'}. 
+00018000: 2020 2020 2020 2069 6620 696e 7075 7473         if inputs
+00018010: 7472 696e 6720 6973 206e 6f74 204e 6f6e  tring is not Non
+00018020: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00018030: 6e70 7574 6669 6c65 203d 2066 2274 656d  nputfile = f"tem
+00018040: 705f 706c 616e 5f7b 706c 616e 7d2e 796d  p_plan_{plan}.ym
+00018050: 6c22 0a20 2020 2020 2020 2020 2020 2077  l".            w
+00018060: 6974 6820 6f70 656e 2869 6e70 7574 6669  ith open(inputfi
+00018070: 6c65 2c20 2277 2229 2061 7320 663a 0a20  le, "w") as f:. 
+00018080: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00018090: 2e77 7269 7465 2869 6e70 7574 7374 7269  .write(inputstri
+000180a0: 6e67 290a 2020 2020 2020 2020 6966 2069  ng).        if i
+000180b0: 6e70 7574 6669 6c65 2069 7320 4e6f 6e65  nputfile is None
+000180c0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+000180d0: 7075 7466 696c 6520 3d20 276b 636c 695f  putfile = 'kcli_
+000180e0: 706c 616e 2e79 6d6c 270a 2020 2020 2020  plan.yml'.      
+000180f0: 2020 2020 2020 7070 7269 6e74 2822 7573        pprint("us
+00018100: 696e 6720 6465 6661 756c 7420 696e 7075  ing default inpu
+00018110: 7420 6669 6c65 206b 636c 695f 706c 616e  t file kcli_plan
+00018120: 2e79 6d6c 2229 0a20 2020 2020 2020 2069  .yml").        i
+00018130: 6620 7061 7468 2069 7320 6e6f 7420 4e6f  f path is not No
+00018140: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00018150: 6f73 2e63 6864 6972 2870 6174 6829 0a20  os.chdir(path). 
+00018160: 2020 2020 2020 2020 2020 2067 6574 6261             getba
+00018170: 636b 203d 2054 7275 650a 2020 2020 2020  ck = True.      
+00018180: 2020 696e 7075 7466 696c 6520 3d20 6f73    inputfile = os
+00018190: 2e70 6174 682e 6578 7061 6e64 7573 6572  .path.expanduser
+000181a0: 2869 6e70 7574 6669 6c65 290a 2020 2020  (inputfile).    
+000181b0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+000181c0: 7468 2e65 7869 7374 7328 696e 7075 7466  th.exists(inputf
+000181d0: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+000181e0: 2020 6572 726f 7228 6622 496e 7075 7420    error(f"Input 
+000181f0: 6669 6c65 207b 696e 7075 7466 696c 657d  file {inputfile}
+00018200: 206e 6f74 2066 6f75 6e64 2e4c 6561 7669   not found.Leavi
+00018210: 6e67 2e2e 2e2e 2229 0a20 2020 2020 2020  ng....").       
+00018220: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+00018230: 0a20 2020 2020 2020 2065 6c69 6620 6f73  .        elif os
+00018240: 2e70 6174 682e 6973 6469 7228 696e 7075  .path.isdir(inpu
+00018250: 7466 696c 6529 3a0a 2020 2020 2020 2020  tfile):.        
+00018260: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
+00018270: 6622 7b69 6e70 7574 6669 6c65 7d2f 6b63  f"{inputfile}/kc
+00018280: 6c69 5f70 6c61 6e2e 796d 6c22 0a20 2020  li_plan.yml".   
+00018290: 2020 2020 2069 6620 696e 666f 3a0a 2020       if info:.  
+000182a0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+000182b0: 6e66 6f5f 706c 616e 2869 6e70 7574 6669  nfo_plan(inputfi
+000182c0: 6c65 2c20 6f6e 666c 793d 6f6e 666c 792c  le, onfly=onfly,
+000182d0: 2071 7569 6574 3d71 7569 6574 2c20 646f   quiet=quiet, do
+000182e0: 633d 646f 6329 0a20 2020 2020 2020 2020  c=doc).         
+000182f0: 2020 2069 6620 746f 636c 6561 6e3a 0a20     if toclean:. 
+00018300: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00018310: 732e 6368 6469 7228 272e 2e27 290a 2020  s.chdir('..').  
+00018320: 2020 2020 2020 2020 2020 2020 2020 726d                rm
+00018330: 7472 6565 2870 6174 6829 0a20 2020 2020  tree(path).     
+00018340: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00018350: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
+00018360: 7327 7d0a 2020 2020 2020 2020 6261 7365  s'}.        base
+00018370: 656e 7472 6965 7320 3d20 7b7d 0a20 2020  entries = {}.   
+00018380: 2020 2020 2065 6e74 7269 6573 2c20 6f76       entries, ov
+00018390: 6572 7269 6465 732c 2062 6173 6566 696c  errides, basefil
+000183a0: 652c 2062 6173 6564 6972 203d 2073 656c  e, basedir = sel
+000183b0: 662e 7072 6f63 6573 735f 696e 7075 7466  f.process_inputf
+000183c0: 696c 6528 706c 616e 2c20 696e 7075 7466  ile(plan, inputf
+000183d0: 696c 652c 206f 7665 7272 6964 6573 3d6f  ile, overrides=o
+000183e0: 7665 7272 6964 6573 2c0a 2020 2020 2020  verrides,.      
+000183f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018430: 206f 6e66 6c79 3d6f 6e66 6c79 2c20 6675   onfly=onfly, fu
+00018440: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00018450: 2069 6620 6261 7365 6669 6c65 2069 7320   if basefile is 
+00018460: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00018470: 2020 2020 2020 6261 7365 696e 666f 203d        baseinfo =
+00018480: 2073 656c 662e 7072 6f63 6573 735f 696e   self.process_in
+00018490: 7075 7466 696c 6528 706c 616e 2c20 6622  putfile(plan, f"
+000184a0: 7b62 6173 6564 6972 7d2f 7b62 6173 6566  {basedir}/{basef
+000184b0: 696c 657d 222c 206f 7665 7272 6964 6573  ile}", overrides
+000184c0: 3d6f 7665 7272 6964 6573 2c20 6675 6c6c  =overrides, full
+000184d0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+000184e0: 2020 2062 6173 6565 6e74 7269 6573 2c20     baseentries, 
+000184f0: 6261 7365 6f76 6572 7269 6465 7320 3d20  baseoverrides = 
+00018500: 6261 7365 696e 666f 5b30 5d2c 2062 6173  baseinfo[0], bas
+00018510: 6569 6e66 6f5b 315d 0a20 2020 2020 2020  einfo[1].       
+00018520: 2020 2020 2069 6620 6261 7365 6f76 6572       if baseover
+00018530: 7269 6465 733a 0a20 2020 2020 2020 2020  rides:.         
+00018540: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
+00018550: 2e75 7064 6174 6528 7b6b 6579 3a20 6261  .update({key: ba
+00018560: 7365 6f76 6572 7269 6465 735b 6b65 795d  seoverrides[key]
+00018570: 2066 6f72 206b 6579 2069 6e20 6261 7365   for key in base
+00018580: 6f76 6572 7269 6465 7320 6966 206b 6579  overrides if key
+00018590: 206e 6f74 2069 6e20 6f76 6572 7269 6465   not in override
+000185a0: 737d 290a 2020 2020 2020 2020 6966 2065  s}).        if e
+000185b0: 6e74 7269 6573 2069 7320 4e6f 6e65 3a0a  ntries is None:.
+000185c0: 2020 2020 2020 2020 2020 2020 656e 7472              entr
+000185d0: 6965 7320 3d20 7b7d 0a20 2020 2020 2020  ies = {}.       
+000185e0: 2069 6620 7365 6c66 2e64 6562 7567 3a0a   if self.debug:.
+000185f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00018600: 7428 7961 6d6c 2e64 756d 7028 656e 7472  t(yaml.dump(entr
+00018610: 6965 7329 290a 2020 2020 2020 2020 7061  ies)).        pa
+00018620: 7261 6d65 7465 7273 203d 2065 6e74 7269  rameters = entri
+00018630: 6573 2e67 6574 2827 7061 7261 6d65 7465  es.get('paramete
+00018640: 7273 2729 0a20 2020 2020 2020 2069 6620  rs').        if 
+00018650: 7061 7261 6d65 7465 7273 2069 7320 6e6f  parameters is no
+00018660: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00018670: 2020 2020 6465 6c20 656e 7472 6965 735b      del entries[
+00018680: 2770 6172 616d 6574 6572 7327 5d0a 2020  'parameters'].  
+00018690: 2020 2020 2020 6469 6374 5f74 7970 6573        dict_types
+000186a0: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+000186b0: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
+000186c0: 6620 6973 696e 7374 616e 6365 2865 6e74  f isinstance(ent
+000186d0: 7269 6573 5b65 6e74 7279 5d2c 2064 6963  ries[entry], dic
+000186e0: 7429 5d0a 2020 2020 2020 2020 6966 206e  t)].        if n
+000186f0: 6f74 2064 6963 745f 7479 7065 733a 0a20  ot dict_types:. 
+00018700: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
+00018710: 7365 6d6f 6465 3a0a 2020 2020 2020 2020  semode:.        
+00018720: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00018730: 6622 7b69 6e70 7574 6669 6c65 7d20 646f  f"{inputfile} do
+00018740: 6573 6e27 7420 6c6f 6f6b 206c 696b 6520  esn't look like 
+00018750: 6120 7661 6c69 6420 706c 616e 2e53 6b69  a valid plan.Ski
+00018760: 7070 696e 672e 2e2e 2e22 290a 2020 2020  pping....").    
+00018770: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018780: 726e 207b 2272 6573 756c 7422 3a20 2273  rn {"result": "s
+00018790: 7563 6365 7373 227d 0a20 2020 2020 2020  uccess"}.       
+000187a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000187b0: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
+000187c0: 2066 227b 696e 7075 7466 696c 657d 2064   f"{inputfile} d
+000187d0: 6f65 736e 2774 206c 6f6f 6b20 6c69 6b65  oesn't look like
+000187e0: 2061 2076 616c 6964 2070 6c61 6e20 6669   a valid plan fi
+000187f0: 6c65 2e20 4d61 7962 6520 796f 7520 7072  le. Maybe you pr
+00018800: 6f76 6964 6564 2061 2070 6172 616d 6574  ovided a paramet
+00018810: 6572 2066 696c 6520 3f22 0a20 2020 2020  er file ?".     
+00018820: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00018830: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+00018840: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+00018850: 3a20 6d73 677d 0a20 2020 2020 2020 2069  : msg}.        i
+00018860: 6e70 7574 6469 7220 3d20 6f73 2e70 6174  nputdir = os.pat
+00018870: 682e 6469 726e 616d 6528 696e 7075 7466  h.dirname(inputf
+00018880: 696c 6529 2069 6620 6f73 2e70 6174 682e  ile) if os.path.
+00018890: 6469 726e 616d 6528 696e 7075 7466 696c  dirname(inputfil
+000188a0: 6529 2021 3d20 2727 2061 6e64 206f 732e  e) != '' and os.
+000188b0: 7061 7468 2e69 7361 6273 2869 6e70 7574  path.isabs(input
+000188c0: 6669 6c65 2920 656c 7365 2027 2e27 0a20  file) else '.'. 
+000188d0: 2020 2020 2020 2070 7265 5f62 6173 6520         pre_base 
+000188e0: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
+000188f0: 7874 286f 732e 7061 7468 2e62 6173 656e  xt(os.path.basen
+00018900: 616d 6528 696e 7075 7466 696c 6529 295b  ame(inputfile))[
+00018910: 305d 0a20 2020 2020 2020 2070 7265 5f73  0].        pre_s
+00018920: 6372 6970 7420 3d20 6627 7b69 6e70 7574  cript = f'{input
+00018930: 6469 727d 2f6b 636c 695f 7072 652e 7368  dir}/kcli_pre.sh
+00018940: 2720 6966 2070 7265 5f62 6173 6520 3d3d  ' if pre_base ==
+00018950: 2027 6b63 6c69 5f70 6c61 6e27 2065 6c73   'kcli_plan' els
+00018960: 6520 6622 7b69 6e70 7574 6469 727d 2f7b  e f"{inputdir}/{
+00018970: 7072 655f 6261 7365 7d5f 7072 652e 7368  pre_base}_pre.sh
+00018980: 220a 2020 2020 2020 2020 6966 206f 732e  ".        if os.
+00018990: 7061 7468 2e65 7869 7374 7328 7072 655f  path.exists(pre_
+000189a0: 7363 7269 7074 293a 0a20 2020 2020 2020  script):.       
+000189b0: 2020 2020 2070 7265 5f73 6372 6970 745f       pre_script_
+000189c0: 7368 6f72 7420 3d20 6f73 2e70 6174 682e  short = os.path.
+000189d0: 6261 7365 6e61 6d65 2870 7265 5f73 6372  basename(pre_scr
+000189e0: 6970 7429 0a20 2020 2020 2020 2020 2020  ipt).           
+000189f0: 2069 6620 7072 653a 0a20 2020 2020 2020   if pre:.       
+00018a00: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00018a10: 6622 5275 6e6e 696e 6720 7b70 7265 5f73  f"Running {pre_s
+00018a20: 6372 6970 745f 7368 6f72 747d 2229 0a20  cript_short}"). 
+00018a30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00018a40: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
+00018a50: 6563 746f 7279 2829 2061 7320 746d 7064  ectory() as tmpd
+00018a60: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
+00018a70: 2020 2020 2020 2020 7072 655f 7363 7269          pre_scri
+00018a80: 7074 203d 2073 656c 662e 7072 6f63 6573  pt = self.proces
+00018a90: 735f 696e 7075 7466 696c 6528 2778 7878  s_inputfile('xxx
+00018aa0: 272c 2070 7265 5f73 6372 6970 742c 206f  ', pre_script, o
+00018ab0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+00018ac0: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00018ad0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+00018ae0: 6e28 6622 7b74 6d70 6469 727d 2f70 7265  n(f"{tmpdir}/pre
+00018af0: 2e73 6822 2c20 2777 2729 2061 7320 663a  .sh", 'w') as f:
+00018b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018b10: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
+00018b20: 2870 7265 5f73 6372 6970 7429 0a20 2020  (pre_script).   
+00018b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b40: 2070 7265 5f72 756e 203d 2072 756e 2866   pre_run = run(f
+00018b50: 2762 6173 6820 7b74 6d70 6469 727d 2f70  'bash {tmpdir}/p
+00018b60: 7265 2e73 6827 2c20 7368 656c 6c3d 5472  re.sh', shell=Tr
+00018b70: 7565 2c20 7374 646f 7574 3d50 4950 452c  ue, stdout=PIPE,
+00018b80: 2073 7464 6572 723d 5354 444f 5554 2c0a   stderr=STDOUT,.
+00018b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bb0: 2020 756e 6976 6572 7361 6c5f 6e65 776c    universal_newl
+00018bc0: 696e 6573 3d54 7275 6529 0a20 2020 2020  ines=True).     
+00018bd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018be0: 6620 7072 655f 7275 6e2e 7265 7475 726e  f pre_run.return
+00018bf0: 636f 6465 2021 3d20 303a 0a20 2020 2020  code != 0:.     
+00018c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c10: 2020 206d 7367 203d 2066 2249 7373 7565     msg = f"Issue
+00018c20: 2077 6865 6e20 7275 6e6e 696e 6720 7b70   when running {p
+00018c30: 7265 5f73 6372 6970 745f 7368 6f72 747d  re_script_short}
+00018c40: 203a 5c6e 7b70 7265 5f72 756e 2e73 7464   :\n{pre_run.std
+00018c50: 6f75 747d 220a 2020 2020 2020 2020 2020  out}".          
+00018c60: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00018c70: 726f 7228 6d73 6729 0a20 2020 2020 2020  ror(msg).       
+00018c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c90: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+00018ca0: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
+00018cb0: 6561 736f 6e27 3a20 6d73 677d 0a20 2020  eason': msg}.   
+00018cc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00018cd0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00018ce0: 6172 6e69 6e67 2866 2253 6b69 7070 696e  arning(f"Skippin
+00018cf0: 6720 7b70 7265 5f73 6372 6970 745f 7368  g {pre_script_sh
+00018d00: 6f72 747d 2061 7320 7265 7175 6573 7465  ort} as requeste
+00018d10: 6422 290a 2020 2020 2020 2020 6b65 7977  d").        keyw
+00018d20: 6f72 6473 203d 2073 656c 662e 6c69 7374  ords = self.list
+00018d30: 5f6b 6579 776f 7264 7328 290a 2020 2020  _keywords().    
+00018d40: 2020 2020 666f 7220 6b65 7920 696e 2073      for key in s
+00018d50: 6f72 7465 6428 6f76 6572 7269 6465 7329  orted(overrides)
+00018d60: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00018d70: 206b 6579 2069 6e20 6b65 7977 6f72 6473   key in keywords
+00018d80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018d90: 2020 6b65 795f 7661 6c75 6520 3d20 6765    key_value = ge
+00018da0: 7461 7474 7228 7365 6c66 2c20 6b65 7929  tattr(self, key)
+00018db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018dc0: 206b 6579 5f74 7970 6520 3d20 7479 7065   key_type = type
+00018dd0: 286b 6579 5f76 616c 7565 290a 2020 2020  (key_value).    
+00018de0: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+00018df0: 7269 6465 5f6b 6579 5f74 7970 6520 3d20  ride_key_type = 
+00018e00: 7479 7065 286f 7665 7272 6964 6573 5b6b  type(overrides[k
+00018e10: 6579 5d29 0a20 2020 2020 2020 2020 2020  ey]).           
+00018e20: 2020 2020 2069 6620 6b65 795f 7661 6c75       if key_valu
+00018e30: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
+00018e40: 6420 6f76 6572 7269 6465 735b 6b65 795d  d overrides[key]
+00018e50: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00018e60: 206b 6579 5f74 7970 6520 213d 206f 7665   key_type != ove
+00018e70: 7272 6964 655f 6b65 795f 7479 7065 3a0a  rride_key_type:.
+00018e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e90: 2020 2020 6572 726f 7228 6622 5468 6520      error(f"The 
+00018ea0: 7072 6f76 6964 6564 2070 6172 616d 6574  provided paramet
+00018eb0: 6572 207b 6b65 797d 2068 6173 2061 2077  er {key} has a w
+00018ec0: 726f 6e67 2074 7970 6520 7b6f 7665 7272  rong type {overr
+00018ed0: 6964 655f 6b65 795f 7479 7065 7d2c 2069  ide_key_type}, i
+00018ee0: 7420 7368 6f75 6c64 2062 6520 7b6b 6579  t should be {key
+00018ef0: 5f74 7970 657d 2229 0a20 2020 2020 2020  _type}").       
+00018f00: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00018f10: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00018f20: 2020 2020 2020 2020 2065 6c69 6620 6f76           elif ov
+00018f30: 6572 7269 6465 735b 6b65 795d 2069 7320  errides[key] is 
+00018f40: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00018f50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00018f60: 7461 7474 7228 7365 6c66 2c20 6b65 792c  tattr(self, key,
+00018f70: 206f 7665 7272 6964 6573 5b6b 6579 5d29   overrides[key])
+00018f80: 0a20 2020 2020 2020 2076 6d65 6e74 7269  .        vmentri
+00018f90: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+00018fa0: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+00018fb0: 2069 6620 2774 7970 6527 206e 6f74 2069   if 'type' not i
+00018fc0: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
+00018fd0: 206f 7220 656e 7472 6965 735b 656e 7472   or entries[entr
+00018fe0: 795d 5b27 7479 7065 275d 203d 3d20 2776  y]['type'] == 'v
+00018ff0: 6d27 5d0a 2020 2020 2020 2020 6469 736b  m'].        disk
+00019000: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
+00019010: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+00019020: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+00019030: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
+00019040: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
+00019050: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
+00019060: 2764 6973 6b27 5d0a 2020 2020 2020 2020  'disk'].        
+00019070: 6e65 7477 6f72 6b65 6e74 7269 6573 203d  networkentries =
+00019080: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
+00019090: 7920 696e 2065 6e74 7269 6573 0a20 2020  y in entries.   
+000190a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190b0: 2020 2020 2020 2069 6620 2774 7970 6527         if 'type'
+000190c0: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
+000190d0: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
+000190e0: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
+000190f0: 2027 6e65 7477 6f72 6b27 5d0a 2020 2020   'network'].    
+00019100: 2020 2020 636f 6e74 6169 6e65 7265 6e74      containerent
+00019110: 7269 6573 203d 205b 656e 7472 7920 666f  ries = [entry fo
+00019120: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
+00019130: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00019140: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00019150: 6620 2774 7970 6527 2069 6e20 656e 7472  f 'type' in entr
+00019160: 6965 735b 656e 7472 795d 2061 6e64 2065  ies[entry] and e
+00019170: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
+00019180: 7970 6527 5d20 3d3d 2027 636f 6e74 6169  ype'] == 'contai
+00019190: 6e65 7227 5d0a 2020 2020 2020 2020 616e  ner'].        an
+000191a0: 7369 626c 6565 6e74 7269 6573 203d 205b  sibleentries = [
+000191b0: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
+000191c0: 696e 2065 6e74 7269 6573 0a20 2020 2020  in entries.     
+000191d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191e0: 2020 2020 2069 6620 2774 7970 6527 2069       if 'type' i
+000191f0: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
+00019200: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
+00019210: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
+00019220: 616e 7369 626c 6527 5d0a 2020 2020 2020  ansible'].      
+00019230: 2020 7072 6f66 696c 6565 6e74 7269 6573    profileentries
+00019240: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+00019250: 7472 7920 696e 2065 6e74 7269 6573 0a20  try in entries. 
+00019260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019270: 2020 2020 2020 2020 2069 6620 2774 7970           if 'typ
+00019280: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
+00019290: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
+000192a0: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
+000192b0: 3d3d 2027 7072 6f66 696c 6527 5d0a 2020  == 'profile'].  
+000192c0: 2020 2020 2020 696d 6167 6565 6e74 7269        imageentri
+000192d0: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+000192e0: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+000192f0: 2069 6620 2774 7970 6527 2069 6e0a 2020   if 'type' in.  
+00019300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019310: 2020 2020 2020 656e 7472 6965 735b 656e        entries[en
+00019320: 7472 795d 2061 6e64 2028 656e 7472 6965  try] and (entrie
+00019330: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
+00019340: 203d 3d20 2769 6d61 6765 2720 6f72 2065   == 'image' or e
+00019350: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
+00019360: 7970 6527 5d20 3d3d 2027 7465 6d70 6c61  ype'] == 'templa
+00019370: 7465 2729 5d0a 2020 2020 2020 2020 706f  te')].        po
+00019380: 6f6c 656e 7472 6965 7320 3d20 5b65 6e74  olentries = [ent
+00019390: 7279 2066 6f72 2065 6e74 7279 2069 6e20  ry for entry in 
+000193a0: 656e 7472 6965 7320 6966 2027 7479 7065  entries if 'type
+000193b0: 2720 696e 2065 6e74 7269 6573 5b65 6e74  ' in entries[ent
+000193c0: 7279 5d20 616e 6420 656e 7472 6965 735b  ry] and entries[
+000193d0: 656e 7472 795d 5b27 7479 7065 275d 203d  entry]['type'] =
+000193e0: 3d20 2770 6f6f 6c27 5d0a 2020 2020 2020  = 'pool'].      
+000193f0: 2020 706c 616e 656e 7472 6965 7320 3d20    planentries = 
+00019400: 5b65 6e74 7279 2066 6f72 2065 6e74 7279  [entry for entry
+00019410: 2069 6e20 656e 7472 6965 7320 6966 2027   in entries if '
+00019420: 7479 7065 2720 696e 2065 6e74 7269 6573  type' in entries
+00019430: 5b65 6e74 7279 5d20 616e 6420 656e 7472  [entry] and entr
+00019440: 6965 735b 656e 7472 795d 5b27 7479 7065  ies[entry]['type
+00019450: 275d 203d 3d20 2770 6c61 6e27 5d0a 2020  '] == 'plan'].  
+00019460: 2020 2020 2020 646e 7365 6e74 7269 6573        dnsentries
+00019470: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+00019480: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
+00019490: 6620 2774 7970 6527 2069 6e20 656e 7472  f 'type' in entr
+000194a0: 6965 735b 656e 7472 795d 2061 6e64 2065  ies[entry] and e
+000194b0: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
+000194c0: 7970 6527 5d20 3d3d 2027 646e 7327 5d0a  ype'] == 'dns'].
+000194d0: 2020 2020 2020 2020 6b75 6265 7320 3d20          kubes = 
+000194e0: 5b27 6b75 6265 272c 2027 636c 7573 7465  ['kube', 'cluste
+000194f0: 7227 5d0a 2020 2020 2020 2020 6b75 6265  r'].        kube
+00019500: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
+00019510: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+00019520: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+00019530: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
+00019540: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
+00019550: 7472 795d 5b27 7479 7065 275d 2069 6e20  try]['type'] in 
+00019560: 6b75 6265 735d 0a20 2020 2020 2020 206c  kubes].        l
+00019570: 6273 203d 205b 656e 7472 7920 666f 7220  bs = [entry for 
+00019580: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+00019590: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
+000195a0: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
+000195b0: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
+000195c0: 2774 7970 6527 5d20 3d3d 2027 6c6f 6164  'type'] == 'load
+000195d0: 6261 6c61 6e63 6572 275d 0a20 2020 2020  balancer'].     
+000195e0: 2020 2073 6773 203d 205b 656e 7472 7920     sgs = [entry 
+000195f0: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
+00019600: 7269 6573 2069 6620 2774 7970 6527 2069  ries if 'type' i
+00019610: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
+00019620: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
+00019630: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
+00019640: 7365 6375 7269 7479 6772 6f75 7027 5d0a  securitygroup'].
+00019650: 2020 2020 2020 2020 6275 636b 6574 656e          bucketen
+00019660: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
+00019670: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
+00019680: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
+00019690: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
+000196a0: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
+000196b0: 795d 5b27 7479 7065 275d 203d 3d20 2762  y]['type'] == 'b
+000196c0: 7563 6b65 7427 5d0a 2020 2020 2020 2020  ucket'].        
+000196d0: 776f 726b 666c 6f77 656e 7472 6965 7320  workflowentries 
+000196e0: 3d20 5b65 6e74 7279 2066 6f72 2065 6e74  = [entry for ent
+000196f0: 7279 2069 6e20 656e 7472 6965 730a 2020  ry in entries.  
+00019700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019710: 2020 2020 2020 2020 2069 6620 2774 7970           if 'typ
+00019720: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
+00019730: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
+00019740: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
+00019750: 3d3d 2027 776f 726b 666c 6f77 275d 0a20  == 'workflow']. 
+00019760: 2020 2020 2020 2066 6f72 2070 2069 6e20         for p in 
+00019770: 7072 6f66 696c 6565 6e74 7269 6573 3a0a  profileentries:.
+00019780: 2020 2020 2020 2020 2020 2020 766d 7072              vmpr
+00019790: 6f66 696c 6573 5b70 5d20 3d20 656e 7472  ofiles[p] = entr
+000197a0: 6965 735b 705d 0a20 2020 2020 2020 2069  ies[p].        i
+000197b0: 6620 6e65 7477 6f72 6b65 6e74 7269 6573  f networkentries
+000197c0: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
+000197d0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+000197e0: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
+000197f0: 6e67 204e 6574 776f 726b 732e 2e2e 2229  ng Networks...")
+00019800: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00019810: 206e 6574 2069 6e20 6e65 7477 6f72 6b65   net in networke
+00019820: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
+00019830: 2020 2020 2020 2020 6e65 7470 726f 6669          netprofi
+00019840: 6c65 203d 2065 6e74 7269 6573 5b6e 6574  le = entries[net
+00019850: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00019860: 2020 6966 206b 2e6e 6574 5f65 7869 7374    if k.net_exist
+00019870: 7328 6e65 7429 3a0a 2020 2020 2020 2020  s(net):.        
+00019880: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00019890: 6e74 2866 224e 6574 776f 726b 207b 6e65  nt(f"Network {ne
+000198a0: 747d 2073 6b69 7070 6564 2122 290a 2020  t} skipped!").  
+000198b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198c0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+000198d0: 2020 2020 2020 2020 2020 2063 6964 7220             cidr 
+000198e0: 3d20 6e65 7470 726f 6669 6c65 2e67 6574  = netprofile.get
+000198f0: 2827 6369 6472 2729 0a20 2020 2020 2020  ('cidr').       
+00019900: 2020 2020 2020 2020 206e 6174 203d 2062           nat = b
+00019910: 6f6f 6c28 6e65 7470 726f 6669 6c65 2e67  ool(netprofile.g
+00019920: 6574 2827 6e61 7427 2c20 5472 7565 2929  et('nat', True))
+00019930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019940: 2069 6620 6369 6472 2069 7320 4e6f 6e65   if cidr is None
+00019950: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019960: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+00019970: 4d69 7373 696e 6720 4369 6472 2066 6f72  Missing Cidr for
+00019980: 206e 6574 776f 726b 207b 6e65 747d 2e20   network {net}. 
+00019990: 4e6f 7420 6372 6561 7469 6e67 2069 742e  Not creating it.
+000199a0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+000199b0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+000199c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000199d0: 2020 6468 6370 203d 206e 6574 7072 6f66    dhcp = netprof
+000199e0: 696c 652e 6765 7428 2764 6863 7027 2c20  ile.get('dhcp', 
+000199f0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00019a00: 2020 2020 2020 646f 6d61 696e 203d 206e        domain = n
+00019a10: 6574 7072 6f66 696c 652e 6765 7428 2764  etprofile.get('d
+00019a20: 6f6d 6169 6e27 290a 2020 2020 2020 2020  omain').        
+00019a30: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00019a40: 206b 2e63 7265 6174 655f 6e65 7477 6f72   k.create_networ
+00019a50: 6b28 6e61 6d65 3d6e 6574 2c20 6369 6472  k(name=net, cidr
+00019a60: 3d63 6964 722c 2064 6863 703d 6468 6370  =cidr, dhcp=dhcp
+00019a70: 2c20 6e61 743d 6e61 742c 2064 6f6d 6169  , nat=nat, domai
+00019a80: 6e3d 646f 6d61 696e 2c20 706c 616e 3d70  n=domain, plan=p
+00019a90: 6c61 6e2c 0a20 2020 2020 2020 2020 2020  lan,.           
+00019aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ab0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00019ac0: 7665 7272 6964 6573 3d6e 6574 7072 6f66  verrides=netprof
+00019ad0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00019ae0: 2020 2020 2063 6f6d 6d6f 6e2e 6861 6e64       common.hand
+00019af0: 6c65 5f72 6573 706f 6e73 6528 7265 7375  le_response(resu
+00019b00: 6c74 2c20 6e65 742c 2065 6c65 6d65 6e74  lt, net, element
+00019b10: 3d27 4e65 7477 6f72 6b20 2729 0a20 2020  ='Network ').   
+00019b20: 2020 2020 2069 6620 706f 6f6c 656e 7472       if poolentr
+00019b30: 6965 7320 616e 6420 6e6f 7420 6f6e 6c79  ies and not only
+00019b40: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
+00019b50: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
+00019b60: 6f79 696e 6720 506f 6f6c 732e 2e2e 2229  oying Pools...")
+00019b70: 0a20 2020 2020 2020 2020 2020 2070 6f6f  .            poo
+00019b80: 6c73 203d 206b 2e6c 6973 745f 706f 6f6c  ls = k.list_pool
+00019b90: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00019ba0: 666f 7220 706f 6f6c 2069 6e20 706f 6f6c  for pool in pool
+00019bb0: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
+00019bc0: 2020 2020 2020 2020 2069 6620 706f 6f6c           if pool
+00019bd0: 2069 6e20 706f 6f6c 733a 0a20 2020 2020   in pools:.     
+00019be0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00019bf0: 7072 696e 7428 6622 506f 6f6c 207b 706f  print(f"Pool {po
+00019c00: 6f6c 7d20 736b 6970 7065 6421 2229 0a20  ol} skipped!"). 
+00019c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c20: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00019c30: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00019c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019c50: 2020 2020 2020 706f 6f6c 7072 6f66 696c        poolprofil
+00019c60: 6520 3d20 656e 7472 6965 735b 706f 6f6c  e = entries[pool
+00019c70: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00019c80: 2020 2020 2020 706f 6f6c 7061 7468 203d        poolpath =
+00019c90: 2070 6f6f 6c70 726f 6669 6c65 2e67 6574   poolprofile.get
+00019ca0: 2827 7061 7468 2729 0a20 2020 2020 2020  ('path').       
+00019cb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00019cc0: 706f 6f6c 7061 7468 2069 7320 4e6f 6e65  poolpath is None
+00019cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019ce0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00019cf0: 6728 6622 506f 6f6c 207b 706f 6f6c 7d20  g(f"Pool {pool} 
+00019d00: 736b 6970 7065 6420 6173 2070 6174 6820  skipped as path 
+00019d10: 6973 206d 6973 7369 6e67 2122 290a 2020  is missing!").  
+00019d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d30: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00019d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d50: 2020 206b 2e63 7265 6174 655f 706f 6f6c     k.create_pool
+00019d60: 2870 6f6f 6c2c 2070 6f6f 6c70 6174 6829  (pool, poolpath)
+00019d70: 0a20 2020 2020 2020 2069 6620 696d 6167  .        if imag
+00019d80: 6565 6e74 7269 6573 2061 6e64 206e 6f74  eentries and not
+00019d90: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+00019da0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00019db0: 2244 6570 6c6f 7969 6e67 2049 6d61 6765  "Deploying Image
+00019dc0: 732e 2e2e 2229 0a20 2020 2020 2020 2020  s...").         
+00019dd0: 2020 2069 6d61 6765 7320 3d20 5b6f 732e     images = [os.
+00019de0: 7061 7468 2e62 6173 656e 616d 6528 7429  path.basename(t)
+00019df0: 2066 6f72 2074 2069 6e20 6b2e 766f 6c75   for t in k.volu
+00019e00: 6d65 7328 295d 0a20 2020 2020 2020 2020  mes()].         
+00019e10: 2020 2066 6f72 2069 6d61 6765 2069 6e20     for image in 
+00019e20: 696d 6167 6565 6e74 7269 6573 3a0a 2020  imageentries:.  
+00019e30: 2020 2020 2020 2020 2020 2020 2020 696d                im
+00019e40: 6167 6570 726f 6669 6c65 203d 2065 6e74  ageprofile = ent
+00019e50: 7269 6573 5b69 6d61 6765 5d0a 2020 2020  ries[image].    
+00019e60: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00019e70: 203d 2069 6d61 6765 7072 6f66 696c 652e   = imageprofile.
+00019e80: 6765 7428 2770 6f6f 6c27 2c20 7365 6c66  get('pool', self
+00019e90: 2e70 6f6f 6c29 0a20 2020 2020 2020 2020  .pool).         
+00019ea0: 2020 2020 2020 2069 6d61 6765 7369 7a65         imagesize
+00019eb0: 203d 2069 6d61 6765 7072 6f66 696c 652e   = imageprofile.
+00019ec0: 6765 7428 2773 697a 6527 290a 2020 2020  get('size').    
+00019ed0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00019ee0: 6575 726c 203d 2069 6d61 6765 7072 6f66  eurl = imageprof
+00019ef0: 696c 652e 6765 7428 2775 726c 2729 0a20  ile.get('url'). 
+00019f00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00019f10: 6620 696d 6167 6520 696e 2069 6d61 6765  f image in image
+00019f20: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00019f30: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00019f40: 496d 6167 6520 7b69 6d61 6765 7d20 736b  Image {image} sk
+00019f50: 6970 7065 6421 2229 0a20 2020 2020 2020  ipped!").       
+00019f60: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00019f70: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00019f80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00019f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fa0: 6966 2069 7369 6e73 7461 6e63 6528 696d  if isinstance(im
+00019fb0: 6167 6575 726c 2c20 7374 7229 2061 6e64  ageurl, str) and
+00019fc0: 2069 6d61 6765 7572 6c20 3d3d 2022 4e6f   imageurl == "No
+00019fd0: 6e65 223a 0a20 2020 2020 2020 2020 2020  ne":.           
+00019fe0: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+00019ff0: 6765 7572 6c20 3d20 4e6f 6e65 0a20 2020  geurl = None.   
+0001a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a010: 2063 6d64 203d 2069 6d61 6765 7072 6f66   cmd = imageprof
+0001a020: 696c 652e 6765 7428 2763 6d64 2729 0a20  ile.get('cmd'). 
+0001a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a040: 2020 2073 656c 662e 6861 6e64 6c65 5f68     self.handle_h
+0001a050: 6f73 7428 706f 6f6c 3d70 6f6f 6c2c 2069  ost(pool=pool, i
+0001a060: 6d61 6765 3d69 6d61 6765 2c20 646f 776e  mage=image, down
+0001a070: 6c6f 6164 3d54 7275 652c 2063 6d64 3d63  load=True, cmd=c
+0001a080: 6d64 2c20 7572 6c3d 696d 6167 6575 726c  md, url=imageurl
+0001a090: 2c20 7369 7a65 3d69 6d61 6765 7369 7a65  , size=imagesize
+0001a0a0: 290a 2020 2020 2020 2020 6966 2062 7563  ).        if buc
+0001a0b0: 6b65 7465 6e74 7269 6573 2061 6e64 206e  ketentries and n
+0001a0c0: 6f74 206f 6e6c 7961 7373 6574 7320 616e  ot onlyassets an
+0001a0d0: 6420 7365 6c66 2e74 7970 6520 696e 205b  d self.type in [
+0001a0e0: 2761 7773 272c 2027 617a 7572 6527 2c20  'aws', 'azure', 
+0001a0f0: 2767 6370 272c 2027 6f70 656e 7374 6163  'gcp', 'openstac
+0001a100: 6b27 5d3a 0a20 2020 2020 2020 2020 2020  k']:.           
+0001a110: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
+0001a120: 6e67 2042 7563 6b65 7420 456e 7472 6965  ng Bucket Entrie
+0001a130: 732e 2e2e 2229 0a20 2020 2020 2020 2020  s...").         
+0001a140: 2020 2066 6f72 2062 7563 6b65 7465 6e74     for bucketent
+0001a150: 7279 2069 6e20 6275 636b 6574 656e 7472  ry in bucketentr
+0001a160: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
+0001a170: 2020 2020 2062 7563 6b65 7470 726f 6669       bucketprofi
+0001a180: 6c65 203d 2065 6e74 7269 6573 5b62 7563  le = entries[buc
+0001a190: 6b65 7465 6e74 7279 5d0a 2020 2020 2020  ketentry].      
+0001a1a0: 2020 2020 2020 2020 2020 5f66 696c 6573            _files
+0001a1b0: 203d 2062 7563 6b65 7470 726f 6669 6c65   = bucketprofile
+0001a1c0: 2e67 6574 2827 6669 6c65 7327 2c20 5b5d  .get('files', []
+0001a1d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a1e0: 2020 7365 6c66 2e6b 2e63 7265 6174 655f    self.k.create_
+0001a1f0: 6275 636b 6574 2862 7563 6b65 7465 6e74  bucket(bucketent
+0001a200: 7279 290a 2020 2020 2020 2020 2020 2020  ry).            
+0001a210: 2020 2020 666f 7220 5f66 696c 2069 6e20      for _fil in 
+0001a220: 5f66 696c 6573 3a0a 2020 2020 2020 2020  _files:.        
+0001a230: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001a240: 2e6b 2e75 706c 6f61 645f 746f 5f62 7563  .k.upload_to_buc
+0001a250: 6b65 7428 6275 636b 6574 656e 7472 792c  ket(bucketentry,
+0001a260: 205f 6669 6c29 0a20 2020 2020 2020 2074   _fil).        t
+0001a270: 656d 706b 6579 203d 206f 7665 7272 6964  empkey = overrid
+0001a280: 6573 2e67 6574 2827 7465 6d70 6b65 7927  es.get('tempkey'
+0001a290: 2c20 4661 6c73 6529 206f 7220 7365 6c66  , False) or self
+0001a2a0: 2e74 656d 706b 6579 0a20 2020 2020 2020  .tempkey.       
+0001a2b0: 2069 6620 7465 6d70 6b65 793a 0a20 2020   if tempkey:.   
+0001a2c0: 2020 2020 2020 2020 2074 656d 706b 6579           tempkey
+0001a2d0: 6469 7220 3d20 5465 6d70 6f72 6172 7944  dir = TemporaryD
+0001a2e0: 6972 6563 746f 7279 2829 0a20 2020 2020  irectory().     
+0001a2f0: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
+0001a300: 5b27 7465 6d70 6b65 7964 6972 275d 203d  ['tempkeydir'] =
+0001a310: 2074 656d 706b 6579 6469 720a 2020 2020   tempkeydir.    
+0001a320: 2020 2020 2020 2020 6f76 6572 7269 6465          override
+0001a330: 735b 2774 656d 706b 6579 6469 726b 6565  s['tempkeydirkee
+0001a340: 7027 5d20 3d20 5472 7565 0a20 2020 2020  p'] = True.     
+0001a350: 2020 2069 6620 706c 616e 656e 7472 6965     if planentrie
+0001a360: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+0001a370: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
+0001a380: 2050 6c61 6e73 2e2e 2e22 290a 2020 2020   Plans...").    
+0001a390: 2020 2020 2020 2020 666f 7220 706c 616e          for plan
+0001a3a0: 656e 7472 7920 696e 2070 6c61 6e65 6e74  entry in planent
+0001a3b0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+0001a3c0: 2020 2020 2020 6465 7461 696c 7320 3d20        details = 
+0001a3d0: 656e 7472 6965 735b 706c 616e 656e 7472  entries[planentr
+0001a3e0: 795d 0a20 2020 2020 2020 2020 2020 2020  y].             
+0001a3f0: 2020 2070 6c61 6e75 726c 203d 2064 6574     planurl = det
+0001a400: 6169 6c73 2e67 6574 2827 7572 6c27 290a  ails.get('url').
+0001a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a420: 706c 616e 6669 6c65 203d 2064 6574 6169  planfile = detai
+0001a430: 6c73 2e67 6574 2827 6669 6c65 2729 0a20  ls.get('file'). 
+0001a440: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001a450: 6620 706c 616e 7572 6c20 6973 204e 6f6e  f planurl is Non
+0001a460: 6520 616e 6420 706c 616e 6669 6c65 2069  e and planfile i
+0001a470: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001a480: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0001a490: 696e 6728 6622 4d69 7373 696e 6720 5572  ing(f"Missing Ur
+0001a4a0: 6c2f 4669 6c65 2066 6f72 2070 6c61 6e20  l/File for plan 
+0001a4b0: 7b70 6c61 6e65 6e74 7279 7d2e 204e 6f74  {planentry}. Not
+0001a4c0: 2063 7265 6174 696e 6720 6974 2e2e 2e22   creating it..."
+0001a4d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a4e0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001a4f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a500: 6c69 6620 706c 616e 7572 6c20 6973 206e  lif planurl is n
+0001a510: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001a520: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+0001a530: 6820 3d20 706c 616e 656e 7472 790a 2020  h = planentry.  
+0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a550: 2020 6966 206e 6f74 2070 6c61 6e75 726c    if not planurl
+0001a560: 2e65 6e64 7377 6974 6828 2779 6d6c 2729  .endswith('yml')
+0001a570: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a580: 2020 2020 2020 2020 2020 706c 616e 7572            planur
+0001a590: 6c20 3d20 6622 7b70 6c61 6e75 726c 7d2f  l = f"{planurl}/
+0001a5a0: 6b63 6c69 5f70 6c61 6e2e 796d 6c22 0a20  kcli_plan.yml". 
+0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a5c0: 6c69 6620 272f 2720 696e 2070 6c61 6e66  lif '/' in planf
+0001a5d0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0001a5e0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
+0001a5f0: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+0001a600: 706c 616e 6669 6c65 290a 2020 2020 2020  planfile).      
+0001a610: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001a620: 7075 7466 696c 6520 3d20 6f73 2e70 6174  putfile = os.pat
+0001a630: 682e 6261 7365 6e61 6d65 2870 6c61 6e66  h.basename(planf
+0001a640: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+0001a650: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001a660: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001a670: 6174 6820 3d20 272e 270a 2020 2020 2020  ath = '.'.      
+0001a680: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001a690: 7075 7466 696c 6520 3d20 706c 616e 656e  putfile = planen
+0001a6a0: 7472 790a 2020 2020 2020 2020 2020 2020  try.            
+0001a6b0: 2020 2020 6966 206e 6f5f 6f76 6572 7269      if no_overri
+0001a6c0: 6465 7320 616e 6420 7061 7261 6d65 7465  des and paramete
+0001a6d0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0001a6e0: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+0001a6f0: 5573 696e 6720 7061 7261 6d65 7465 7273  Using parameters
+0001a700: 2066 726f 6d20 6661 7468 6572 2070 6c61   from father pla
+0001a710: 6e20 696e 2063 6869 6c64 206f 6e65 7322  n in child ones"
+0001a720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a730: 2020 2020 2020 666f 7220 6f76 6572 7269        for overri
+0001a740: 6465 2069 6e20 6f76 6572 7269 6465 733a  de in overrides:
+0001a750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a760: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0001a770: 5573 696e 6720 7061 7261 6d65 7465 7220  Using parameter 
+0001a780: 2573 3a20 2573 2220 2520 286f 7665 7272  %s: %s" % (overr
+0001a790: 6964 652c 206f 7665 7272 6964 6573 5b6f  ide, overrides[o
+0001a7a0: 7665 7272 6964 655d 2929 0a20 2020 2020  verride])).     
+0001a7b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001a7c0: 706c 616e 2870 6c61 6e2c 2061 6e73 6962  plan(plan, ansib
+0001a7d0: 6c65 3d46 616c 7365 2c20 7572 6c3d 706c  le=False, url=pl
+0001a7e0: 616e 7572 6c2c 2070 6174 683d 7061 7468  anurl, path=path
+0001a7f0: 2c20 636f 6e74 6169 6e65 723d 4661 6c73  , container=Fals
+0001a800: 652c 2069 6e70 7574 6669 6c65 3d69 6e70  e, inputfile=inp
+0001a810: 7574 6669 6c65 2c0a 2020 2020 2020 2020  utfile,.        
+0001a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a830: 2020 6f76 6572 7269 6465 733d 6f76 6572    overrides=over
+0001a840: 7269 6465 732c 2065 6d62 6564 6465 643d  rides, embedded=
+0001a850: 656d 6265 6464 6564 2c20 646f 776e 6c6f  embedded, downlo
+0001a860: 6164 3d64 6f77 6e6c 6f61 6429 0a20 2020  ad=download).   
+0001a870: 2020 2020 2069 6620 6b75 6265 656e 7472       if kubeentr
+0001a880: 6965 7320 616e 6420 6e6f 7420 6f6e 6c79  ies and not only
+0001a890: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
+0001a8a0: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
+0001a8b0: 6f79 696e 6720 4b75 6265 2045 6e74 7269  oying Kube Entri
+0001a8c0: 6573 2e2e 2e22 290a 2020 2020 2020 2020  es...").        
+0001a8d0: 2020 2020 646e 7363 6c69 656e 7473 203d      dnsclients =
+0001a8e0: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+0001a8f0: 6b75 6265 7468 7265 6164 6564 203d 2054  kubethreaded = T
+0001a900: 7275 6520 6966 206c 656e 286b 7562 6565  rue if len(kubee
+0001a910: 6e74 7269 6573 2920 3e20 3120 656c 7365  ntries) > 1 else
+0001a920: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0001a930: 2020 2069 6620 6b75 6265 7468 7265 6164     if kubethread
+0001a940: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+0001a950: 2020 2020 7761 726e 696e 6728 224c 6175      warning("Lau
+0001a960: 6e63 6869 6e67 2065 6163 6820 636c 7573  nching each clus
+0001a970: 7465 7220 696e 2061 2074 6872 6561 6420  ter in a thread 
+0001a980: 6173 2074 6865 7265 2069 7320 6d6f 7265  as there is more
+0001a990: 2074 6861 6e20 6f6e 6520 656e 7472 792e   than one entry.
+0001a9a0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+0001a9b0: 2066 6f72 2063 6c75 7374 6572 2069 6e20   for cluster in 
+0001a9c0: 6b75 6265 656e 7472 6965 733a 0a20 2020  kubeentries:.   
+0001a9d0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001a9e0: 696e 7428 6622 4465 706c 6f79 696e 6720  int(f"Deploying 
+0001a9f0: 436c 7573 7465 7220 7b63 6c75 7374 6572  Cluster {cluster
+0001aa00: 7d2e 2e2e 2229 0a20 2020 2020 2020 2020  }...").         
+0001aa10: 2020 2020 2020 206b 7562 6570 726f 6669         kubeprofi
+0001aa20: 6c65 203d 2065 6e74 7269 6573 5b63 6c75  le = entries[clu
+0001aa30: 7374 6572 5d0a 2020 2020 2020 2020 2020  ster].          
+0001aa40: 2020 2020 2020 6b75 6265 636c 6965 6e74        kubeclient
+0001aa50: 203d 206b 7562 6570 726f 6669 6c65 2e67   = kubeprofile.g
+0001aa60: 6574 2827 636c 6965 6e74 2729 0a20 2020  et('client').   
+0001aa70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001aa80: 6b75 6265 636c 6965 6e74 2069 7320 4e6f  kubeclient is No
+0001aa90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0001aaa0: 2020 2020 2020 2020 6375 7272 656e 7463          currentc
+0001aab0: 6f6e 6669 6720 3d20 7365 6c66 0a20 2020  onfig = self.   
+0001aac0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0001aad0: 6620 6b75 6265 636c 6965 6e74 2069 6e20  f kubeclient in 
+0001aae0: 7365 6c66 2e63 6c69 656e 7473 3a0a 2020  self.clients:.  
+0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab00: 2020 6375 7272 656e 7463 6f6e 6669 6720    currentconfig 
+0001ab10: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
+0001ab20: 3d6b 7562 6563 6c69 656e 7429 0a20 2020  =kubeclient).   
+0001ab30: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001ab40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001ab50: 2020 2020 2020 2065 7272 6f72 2866 2243         error(f"C
+0001ab60: 6c69 656e 7420 7b6b 7562 6563 6c69 656e  lient {kubeclien
+0001ab70: 747d 206e 6f74 2066 6f75 6e64 2e20 736b  t} not found. sk
+0001ab80: 6970 7065 6422 290a 2020 2020 2020 2020  ipped").        
+0001ab90: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001aba0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0001abb0: 2020 2020 206b 7562 6574 7970 6520 3d20       kubetype = 
+0001abc0: 6b75 6265 7072 6f66 696c 652e 6765 7428  kubeprofile.get(
+0001abd0: 276b 7562 6574 7970 6527 2920 6f72 206b  'kubetype') or k
+0001abe0: 7562 6570 726f 6669 6c65 2e67 6574 2827  ubeprofile.get('
+0001abf0: 636c 7573 7465 7274 7970 6527 2c20 2767  clustertype', 'g
+0001ac00: 656e 6572 6963 2729 0a20 2020 2020 2020  eneric').       
+0001ac10: 2020 2020 2020 2020 206b 7562 655f 6f76           kube_ov
+0001ac20: 6572 7269 6465 7320 3d20 6f76 6572 7269  errides = overri
+0001ac30: 6465 732e 636f 7079 2829 0a20 2020 2020  des.copy().     
+0001ac40: 2020 2020 2020 2020 2020 206b 7562 655f             kube_
+0001ac50: 6f76 6572 7269 6465 732e 7570 6461 7465  overrides.update
+0001ac60: 286b 7562 6570 726f 6669 6c65 290a 2020  (kubeprofile).  
+0001ac70: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
+0001ac80: 6265 5f6f 7665 7272 6964 6573 5b27 636c  be_overrides['cl
+0001ac90: 7573 7465 7227 5d20 3d20 636c 7573 7465  uster'] = cluste
+0001aca0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0001acb0: 2020 6578 6973 7469 6e67 5f63 746c 706c    existing_ctlpl
+0001acc0: 616e 6573 203d 205b 7620 666f 7220 7620  anes = [v for v 
+0001acd0: 696e 2063 7572 7265 6e74 636f 6e66 6967  in currentconfig
+0001ace0: 2e6b 2e6c 6973 7428 2920 6966 2066 277b  .k.list() if f'{
+0001acf0: 636c 7573 7465 727d 2d63 746c 706c 616e  cluster}-ctlplan
+0001ad00: 6527 2069 6e20 765b 276e 616d 6527 5d5d  e' in v['name']]
+0001ad10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ad20: 2069 6620 6578 6973 7469 6e67 5f63 746c   if existing_ctl
+0001ad30: 706c 616e 6573 3a0a 2020 2020 2020 2020  planes:.        
+0001ad40: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001ad50: 6e74 2866 2243 6c75 7374 6572 207b 636c  nt(f"Cluster {cl
+0001ad60: 7573 7465 727d 2066 6f75 6e64 2e20 736b  uster} found. sk
+0001ad70: 6970 7065 6421 2229 0a20 2020 2020 2020  ipped!").       
+0001ad80: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001ad90: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0001ada0: 2020 2020 2020 6966 206b 7562 6574 7970        if kubetyp
+0001adb0: 6520 6e6f 7420 696e 205b 2767 656e 6572  e not in ['gener
+0001adc0: 6963 272c 2027 6f70 656e 7368 6966 7427  ic', 'openshift'
+0001add0: 2c20 2768 7970 6572 7368 6966 7427 2c20  , 'hypershift', 
+0001ade0: 276d 6963 726f 7368 6966 7427 2c20 276b  'microshift', 'k
+0001adf0: 3373 272c 2027 676b 6527 2c20 2761 6b73  3s', 'gke', 'aks
+0001ae00: 272c 2027 656b 7327 5d3a 0a20 2020 2020  ', 'eks']:.     
+0001ae10: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0001ae20: 6172 6e69 6e67 2866 2249 6e63 6f72 7265  arning(f"Incorre
+0001ae30: 6374 206b 7562 6574 7970 6520 7b6b 7562  ct kubetype {kub
+0001ae40: 6574 7970 657d 2073 7065 6369 6669 6564  etype} specified
+0001ae50: 2e20 736b 6970 7065 6421 2229 0a20 2020  . skipped!").   
+0001ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae70: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+0001ae80: 2020 2020 2020 2020 2020 6966 206b 7562            if kub
+0001ae90: 6574 6872 6561 6465 643a 0a20 2020 2020  ethreaded:.     
+0001aea0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0001aeb0: 7562 655f 6f76 6572 7269 6465 735b 2775  ube_overrides['u
+0001aec0: 7365 5f65 7869 7374 696e 675f 6f70 656e  se_existing_open
+0001aed0: 7368 6966 7427 5d20 3d20 5472 7565 0a20  shift'] = True. 
+0001aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aef0: 2020 206e 6577 5f61 7267 7320 3d20 2870     new_args = (p
+0001af00: 6c61 6e2c 206b 7562 6574 7970 652c 206b  lan, kubetype, k
+0001af10: 7562 655f 6f76 6572 7269 6465 7329 0a20  ube_overrides). 
+0001af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af30: 2020 2074 203d 2074 6872 6561 6469 6e67     t = threading
+0001af40: 2e54 6872 6561 6428 7461 7267 6574 3d73  .Thread(target=s
+0001af50: 656c 662e 7468 7265 6164 6564 5f63 7265  elf.threaded_cre
+0001af60: 6174 655f 6b75 6265 2c20 6172 6773 3d6e  ate_kube, args=n
+0001af70: 6577 5f61 7267 7329 0a20 2020 2020 2020  ew_args).       
+0001af80: 2020 2020 2020 2020 2020 2020 2074 6872               thr
+0001af90: 6561 6473 2e61 7070 656e 6428 7429 0a20  eads.append(t). 
+0001afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afb0: 2020 2074 2e73 7461 7274 2829 0a20 2020     t.start().   
+0001afc0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001afd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001afe0: 2020 2020 2020 2063 7572 7265 6e74 636f         currentco
+0001aff0: 6e66 6967 2e63 7265 6174 655f 6b75 6265  nfig.create_kube
+0001b000: 2870 6c61 6e2c 206b 7562 6574 7970 652c  (plan, kubetype,
+0001b010: 206f 7665 7272 6964 6573 3d6b 7562 655f   overrides=kube_
+0001b020: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+0001b030: 2020 2076 6d63 6c69 656e 7473 203d 205b     vmclients = [
+0001b040: 5d0a 2020 2020 2020 2020 6966 2076 6d65  ].        if vme
+0001b050: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
+0001b060: 2020 2020 6966 206e 6f74 206f 6e6c 7961      if not onlya
+0001b070: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0001b080: 2020 2020 2020 2070 7072 696e 7428 2244         pprint("D
+0001b090: 6570 6c6f 7969 6e67 2056 6d73 2e2e 2e22  eploying Vms..."
+0001b0a0: 290a 2020 2020 2020 2020 2020 2020 766d  ).            vm
+0001b0b0: 636f 756e 7465 7220 3d20 300a 2020 2020  counter = 0.    
+0001b0c0: 2020 2020 2020 2020 686f 7374 7320 3d20          hosts = 
+0001b0d0: 7b7d 0a20 2020 2020 2020 2020 2020 2076  {}.            v
+0001b0e0: 6d73 5f74 6f5f 686f 7374 203d 207b 7d0a  ms_to_host = {}.
+0001b0f0: 2020 2020 2020 2020 2020 2020 6261 7365              base
+0001b100: 706c 616e 7320 3d20 5b5d 0a20 2020 2020  plans = [].     
+0001b110: 2020 2020 2020 2076 6d6e 616d 6573 203d         vmnames =
+0001b120: 205b 6e61 6d65 2066 6f72 206e 616d 6520   [name for name 
+0001b130: 696e 2076 6d65 6e74 7269 6573 5d0a 2020  in vmentries].  
+0001b140: 2020 2020 2020 2020 2020 6966 2062 6173            if bas
+0001b150: 6566 696c 6520 6973 206e 6f74 204e 6f6e  efile is not Non
+0001b160: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001b170: 2020 2062 6173 6564 6972 203d 206f 732e     basedir = os.
+0001b180: 7061 7468 2e64 6972 6e61 6d65 2869 6e70  path.dirname(inp
+0001b190: 7574 6669 6c65 2920 6966 206f 732e 7061  utfile) if os.pa
+0001b1a0: 7468 2e69 7361 6273 2869 6e70 7574 6669  th.isabs(inputfi
+0001b1b0: 6c65 2920 656c 7365 2027 2e27 0a20 2020  le) else '.'.   
+0001b1c0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+0001b1d0: 6569 6e70 7574 6669 6c65 203d 2066 227b  einputfile = f"{
+0001b1e0: 6261 7365 6469 727d 2f7b 6261 7365 6669  basedir}/{basefi
+0001b1f0: 6c65 7d22 0a20 2020 2020 2020 2020 2020  le}".           
+0001b200: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
+0001b210: 725f 6d6f 6465 2829 2061 6e64 206e 6f74  r_mode() and not
+0001b220: 206f 732e 7061 7468 2e69 7361 6273 2862   os.path.isabs(b
+0001b230: 6173 6566 696c 6529 2061 6e64 2027 2f77  asefile) and '/w
+0001b240: 6f72 6b64 6972 2720 6e6f 7420 696e 2062  orkdir' not in b
+0001b250: 6173 6564 6972 3a0a 2020 2020 2020 2020  asedir:.        
+0001b260: 2020 2020 2020 2020 2020 2020 6261 7365              base
+0001b270: 696e 7075 7466 696c 6520 3d20 6622 2f77  inputfile = f"/w
+0001b280: 6f72 6b64 6972 2f7b 6261 7365 6469 727d  orkdir/{basedir}
+0001b290: 2f7b 6261 7365 6669 6c65 7d22 0a20 2020  /{basefile}".   
+0001b2a0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0001b2b0: 756c 7420 3d20 7365 6c66 2e70 6c61 6e28  ult = self.plan(
+0001b2c0: 706c 616e 2c20 696e 7075 7466 696c 653d  plan, inputfile=
+0001b2d0: 6261 7365 696e 7075 7466 696c 652c 206f  baseinputfile, o
+0001b2e0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+0001b2f0: 6573 2c20 6578 636c 7564 6576 6d73 3d76  es, excludevms=v
+0001b300: 6d6e 616d 6573 2c0a 2020 2020 2020 2020  mnames,.        
 0001b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b320: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
-0001b330: 696c 652e 7570 6461 7465 2865 6e74 7279  ile.update(entry
-0001b340: 5b72 756c 655d 290a 2020 2020 2020 2020  [rule]).        
-0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b360: 2020 2020 6966 2027 6e61 6d65 2720 696e      if 'name' in
-0001b370: 2065 6e74 7279 5b72 756c 655d 3a0a 2020   entry[rule]:.  
-0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b390: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0001b3a0: 726e 696e 6728 6622 5265 6e61 6d69 6e67  rning(f"Renaming
-0001b3b0: 207b 6e61 6d65 7d20 746f 207b 656e 7472   {name} to {entr
-0001b3c0: 795b 7275 6c65 5d5b 276e 616d 6527 5d7d  y[rule]['name']}
-0001b3d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3f0: 2020 206e 616d 6520 3d20 656e 7472 795b     name = entry[
-0001b400: 7275 6c65 5d5b 276e 616d 6527 5d0a 2020  rule]['name'].  
-0001b410: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b420: 2076 6d72 756c 6573 5f73 7472 6963 7420   vmrules_strict 
-0001b430: 616e 6420 6e6f 7420 7275 6c65 666f 756e  and not rulefoun
-0001b440: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0001b450: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-0001b460: 224e 6f20 766d 7275 6c65 7320 666f 756e  "No vmrules foun
-0001b470: 6420 666f 7220 7b6e 616d 657d 2e20 536b  d for {name}. Sk
-0001b480: 6970 7069 6e67 2e2e 2e22 290a 2020 2020  ipping...").    
-0001b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4a0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0001b4b0: 2020 2020 2020 2020 2076 6d63 6c69 656e           vmclien
-0001b4c0: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
-0001b4d0: 2763 6c69 656e 7427 290a 2020 2020 2020  'client').      
-0001b4e0: 2020 2020 2020 2020 2020 6966 2076 6d63            if vmc
-0001b4f0: 6c69 656e 7420 6973 206e 6f74 204e 6f6e  lient is not Non
-0001b500: 6520 616e 6420 766d 636c 6965 6e74 206e  e and vmclient n
-0001b510: 6f74 2069 6e20 766d 636c 6965 6e74 733a  ot in vmclients:
-0001b520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b530: 2020 2020 2076 6d63 6c69 656e 7473 2e61       vmclients.a
-0001b540: 7070 656e 6428 766d 636c 6965 6e74 290a  ppend(vmclient).
+0001b320: 2020 2020 2020 2020 2020 2062 6173 656d             basem
+0001b330: 6f64 653d 5472 7565 2c20 6f6e 6c79 6173  ode=True, onlyas
+0001b340: 7365 7473 3d6f 6e6c 7961 7373 6574 7329  sets=onlyassets)
+0001b350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b360: 2069 6620 7265 7375 6c74 5b27 7265 7375   if result['resu
+0001b370: 6c74 275d 2021 3d20 2773 7563 6365 7373  lt'] != 'success
+0001b380: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0001b390: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0001b3a0: 7375 6c74 0a20 2020 2020 2020 2020 2020  sult.           
+0001b3b0: 2020 2020 2062 6173 6570 6c61 6e73 2e61       baseplans.a
+0001b3c0: 7070 656e 6428 6261 7365 6669 6c65 290a  ppend(basefile).
+0001b3d0: 2020 2020 2020 2020 2020 2020 766d 7275              vmru
+0001b3e0: 6c65 735f 7374 7269 6374 203d 206f 7665  les_strict = ove
+0001b3f0: 7272 6964 6573 2e67 6574 2827 766d 7275  rrides.get('vmru
+0001b400: 6c65 735f 7374 7269 6374 272c 2073 656c  les_strict', sel
+0001b410: 662e 766d 7275 6c65 735f 7374 7269 6374  f.vmrules_strict
+0001b420: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+0001b430: 7220 6e61 6d65 2069 6e20 766d 656e 7472  r name in vmentr
+0001b440: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
+0001b450: 2020 2020 2069 6620 6e61 6d65 2069 6e20       if name in 
+0001b460: 6578 636c 7564 6576 6d73 3a0a 2020 2020  excludevms:.    
+0001b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b480: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001b490: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001b4a0: 706c 616e 6469 7220 3d20 6261 7365 6469  plandir = basedi
+0001b4b0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0001b4c0: 2020 6966 206c 656e 2876 6d65 6e74 7269    if len(vmentri
+0001b4d0: 6573 2920 3d3d 2031 2061 6e64 2027 6e61  es) == 1 and 'na
+0001b4e0: 6d65 2720 696e 206f 7665 7272 6964 6573  me' in overrides
+0001b4f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001b500: 2020 2020 2020 6e65 776e 616d 6520 3d20        newname = 
+0001b510: 6f76 6572 7269 6465 735b 276e 616d 6527  overrides['name'
+0001b520: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001b530: 2020 2020 2020 7072 6f66 696c 6520 3d20        profile = 
+0001b540: 656e 7472 6965 735b 6e61 6d65 5d0a 2020  entries[name].  
 0001b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b560: 6966 2076 6d63 6c69 656e 7420 6973 204e  if vmclient is N
-0001b570: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001b580: 2020 2020 2020 2020 207a 203d 206b 0a20           z = k. 
-0001b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5a0: 2020 2076 6d63 6c69 656e 7420 3d20 7365     vmclient = se
-0001b5b0: 6c66 2e63 6c69 656e 740a 2020 2020 2020  lf.client.      
-0001b5c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b5d0: 2076 6d63 6c69 656e 7420 6e6f 7420 696e   vmclient not in
-0001b5e0: 2068 6f73 7473 3a0a 2020 2020 2020 2020   hosts:.        
-0001b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b600: 686f 7374 735b 766d 636c 6965 6e74 5d20  hosts[vmclient] 
-0001b610: 3d20 7365 6c66 0a20 2020 2020 2020 2020  = self.         
-0001b620: 2020 2020 2020 2065 6c69 6620 766d 636c         elif vmcl
-0001b630: 6965 6e74 2069 6e20 686f 7374 733a 0a20  ient in hosts:. 
-0001b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b650: 2020 207a 203d 2068 6f73 7473 5b76 6d63     z = hosts[vmc
-0001b660: 6c69 656e 745d 2e6b 0a20 2020 2020 2020  lient].k.       
-0001b670: 2020 2020 2020 2020 2065 6c69 6620 766d           elif vm
-0001b680: 636c 6965 6e74 2069 6e20 7365 6c66 2e63  client in self.c
-0001b690: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-0001b6a0: 2020 2020 2020 2020 2020 2020 6e65 7763              newc
-0001b6b0: 6c69 656e 7420 3d20 4b63 6f6e 6669 6728  lient = Kconfig(
-0001b6c0: 636c 6965 6e74 3d76 6d63 6c69 656e 7429  client=vmclient)
-0001b6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b6e0: 2020 2020 207a 203d 206e 6577 636c 6965       z = newclie
-0001b6f0: 6e74 2e6b 0a20 2020 2020 2020 2020 2020  nt.k.           
-0001b700: 2020 2020 2020 2020 2068 6f73 7473 5b76           hosts[v
-0001b710: 6d63 6c69 656e 745d 203d 206e 6577 636c  mclient] = newcl
-0001b720: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
-0001b730: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001b740: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001b750: 6172 6e69 6e67 2866 2243 6c69 656e 7420  arning(f"Client 
-0001b760: 7b76 6d63 6c69 656e 747d 206e 6f74 2066  {vmclient} not f
-0001b770: 6f75 6e64 2e20 5573 696e 6720 6465 6661  ound. Using defa
-0001b780: 756c 7420 6f6e 6522 290a 2020 2020 2020  ult one").      
-0001b790: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
-0001b7a0: 3d20 6b0a 2020 2020 2020 2020 2020 2020  = k.            
-0001b7b0: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
-0001b7c0: 203d 2073 656c 662e 636c 6965 6e74 0a20   = self.client. 
-0001b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b7e0: 2020 2069 6620 766d 636c 6965 6e74 206e     if vmclient n
-0001b7f0: 6f74 2069 6e20 686f 7374 733a 0a20 2020  ot in hosts:.   
-0001b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b810: 2020 2020 2068 6f73 7473 5b76 6d63 6c69       hosts[vmcli
-0001b820: 656e 745d 203d 2073 656c 660a 2020 2020  ent] = self.    
-0001b830: 2020 2020 2020 2020 2020 2020 766d 735f              vms_
-0001b840: 746f 5f68 6f73 745b 6e61 6d65 5d20 3d20  to_host[name] = 
-0001b850: 686f 7374 735b 766d 636c 6965 6e74 5d0a  hosts[vmclient].
-0001b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b870: 6966 2027 7072 6f66 696c 6527 2069 6e20  if 'profile' in 
-0001b880: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
-0001b890: 696c 655b 2770 726f 6669 6c65 275d 2069  ile['profile'] i
-0001b8a0: 6e20 766d 7072 6f66 696c 6573 3a0a 2020  n vmprofiles:.  
-0001b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8c0: 2020 6375 7374 6f6d 7072 6f66 696c 6520    customprofile 
-0001b8d0: 3d20 766d 7072 6f66 696c 6573 5b70 726f  = vmprofiles[pro
-0001b8e0: 6669 6c65 5b27 7072 6f66 696c 6527 5d5d  file['profile']]
-0001b8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b900: 2020 2020 2070 726f 6669 6c65 6e61 6d65       profilename
-0001b910: 203d 2070 726f 6669 6c65 5b27 7072 6f66   = profile['prof
-0001b920: 696c 6527 5d0a 2020 2020 2020 2020 2020  ile'].          
-0001b930: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b950: 6375 7374 6f6d 7072 6f66 696c 6520 3d20  customprofile = 
-0001b960: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
-0001b970: 2020 2020 2020 2070 726f 6669 6c65 6e61         profilena
-0001b980: 6d65 203d 2027 6b76 6972 7427 0a20 2020  me = 'kvirt'.   
-0001b990: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001b9a0: 6375 7374 6f6d 7072 6f66 696c 653a 0a20  customprofile:. 
-0001b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9c0: 2020 2063 7573 746f 6d70 726f 6669 6c65     customprofile
-0001b9d0: 2e75 7064 6174 6528 7072 6f66 696c 6529  .update(profile)
-0001b9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b9f0: 2020 2020 2070 726f 6669 6c65 203d 2063       profile = c
-0001ba00: 7573 746f 6d70 726f 6669 6c65 0a20 2020  ustomprofile.   
-0001ba10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001ba20: 2770 6c61 7962 6f6f 6b27 2069 6e20 7072  'playbook' in pr
-0001ba30: 6f66 696c 6520 616e 6420 7072 6f66 696c  ofile and profil
-0001ba40: 655b 2770 6c61 7962 6f6f 6b27 5d3a 0a20  e['playbook']:. 
-0001ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba60: 2020 2069 6620 2773 6372 6970 7473 2720     if 'scripts' 
-0001ba70: 6e6f 7420 696e 2070 726f 6669 6c65 2061  not in profile a
-0001ba80: 6e64 2027 6669 6c65 7327 206e 6f74 2069  nd 'files' not i
-0001ba90: 6e20 7072 6f66 696c 6520 616e 6420 2763  n profile and 'c
-0001baa0: 6d64 7327 206e 6f74 2069 6e20 7072 6f66  mds' not in prof
-0001bab0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-0001bac0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001bad0: 696e 7428 6622 536b 6970 7069 6e67 2065  int(f"Skipping e
-0001bae0: 6d70 7479 2070 6c61 7962 6f6f 6b20 666f  mpty playbook fo
-0001baf0: 7220 7b6e 616d 657d 2229 0a20 2020 2020  r {name}").     
-0001bb00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001bb10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001bb20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001bb30: 2769 6d61 6765 2720 696e 2070 726f 6669  'image' in profi
-0001bb40: 6c65 2061 6e64 2027 7268 656c 2720 696e  le and 'rhel' in
-0001bb50: 2070 726f 6669 6c65 5b27 696d 6167 6527   profile['image'
-0001bb60: 5d5c 0a20 2020 2020 2020 2020 2020 2020  ]\.             
-0001bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb80: 2020 2061 6e64 2027 7268 6e72 6567 6973     and 'rhnregis
-0001bb90: 7465 7227 2069 6e20 7072 6f66 696c 6520  ter' in profile 
-0001bba0: 616e 6420 7072 6f66 696c 655b 2772 686e  and profile['rhn
-0001bbb0: 7265 6769 7374 6572 275d 3a0a 2020 2020  register']:.    
-0001bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbd0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-0001bbe0: 6622 4d61 6b65 2073 7572 6520 746f 2073  f"Make sure to s
-0001bbf0: 7562 7363 7269 6265 207b 6e61 6d65 7d20  ubscribe {name} 
-0001bc00: 746f 2052 6564 2048 6174 206e 6574 776f  to Red Hat netwo
-0001bc10: 726b 2229 0a20 2020 2020 2020 2020 2020  rk").           
-0001bc20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001bc30: 2770 7269 7661 7465 6b65 7927 2069 6e20  'privatekey' in 
-0001bc40: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
-0001bc50: 696c 655b 2770 7269 7661 7465 6b65 7927  ile['privatekey'
-0001bc60: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0001bc70: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001bc80: 6172 6e69 6e67 2866 2243 6f70 7920 796f  arning(f"Copy yo
-0001bc90: 7572 2070 7269 7661 7465 206b 6579 2074  ur private key t
-0001bca0: 6f20 7b6e 616d 657d 2229 0a20 2020 2020  o {name}").     
-0001bcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bcc0: 2020 2066 6f72 206e 6574 2069 6e20 7072     for net in pr
-0001bcd0: 6f66 696c 652e 6765 7428 276e 6574 7327  ofile.get('nets'
-0001bce0: 2c20 5b5d 293a 0a20 2020 2020 2020 2020  , []):.         
-0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd00: 2020 2069 6620 2769 7027 2069 6e20 6e65     if 'ip' in ne
-0001bd10: 7420 616e 6420 276d 6173 6b27 2069 6e20  t and 'mask' in 
-0001bd20: 6e65 7420 616e 6420 2767 6174 6577 6179  net and 'gateway
-0001bd30: 2720 696e 206e 6574 3a0a 2020 2020 2020  ' in net:.      
-0001bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd50: 2020 2020 2020 2020 2020 6970 2c20 6d61            ip, ma
-0001bd60: 736b 2c20 6761 7465 7761 7920 3d20 6e65  sk, gateway = ne
-0001bd70: 745b 2769 7027 5d2c 206e 6574 5b27 6d61  t['ip'], net['ma
-0001bd80: 736b 275d 2c20 6e65 745b 2767 6174 6577  sk'], net['gatew
-0001bd90: 6179 275d 0a20 2020 2020 2020 2020 2020  ay'].           
-0001bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdb0: 2020 2020 2077 6172 6e69 6e67 2866 2241       warning(f"A
-0001bdc0: 6464 206d 616e 7561 6c6c 7920 7468 6973  dd manually this
-0001bdd0: 206e 6574 776f 726b 207b 6970 7d2f 7b6d   network {ip}/{m
-0001bde0: 6173 6b7d 2077 6974 6820 6761 7465 7761  ask} with gatewa
-0001bdf0: 7920 7b67 6174 6577 6179 7d22 290a 2020  y {gateway}").  
+0001b560: 2020 6e61 6d65 203d 206e 6577 6e61 6d65    name = newname
+0001b570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b580: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001b590: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+0001b5a0: 6c65 203d 2065 6e74 7269 6573 5b6e 616d  le = entries[nam
+0001b5b0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+0001b5c0: 2020 2069 6620 276e 616d 6527 2069 6e20     if 'name' in 
+0001b5d0: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
+0001b5e0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+0001b5f0: 6520 3d20 7072 6f66 696c 655b 276e 616d  e = profile['nam
+0001b600: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+0001b610: 2020 2020 6966 2027 6261 7365 766d 2720      if 'basevm' 
+0001b620: 696e 2070 726f 6669 6c65 206f 7220 2762  in profile or 'b
+0001b630: 6173 6570 6c61 6e27 2069 6e20 7072 6f66  aseplan' in prof
+0001b640: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0001b650: 2020 2020 2020 2020 2062 6173 6570 726f           basepro
+0001b660: 6669 6c65 203d 207b 7d0a 2020 2020 2020  file = {}.      
+0001b670: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+0001b680: 7065 6e64 6b65 7973 203d 205b 2764 6973  pendkeys = ['dis
+0001b690: 6b73 272c 2027 6e65 7473 272c 2027 6669  ks', 'nets', 'fi
+0001b6a0: 6c65 7327 2c20 2773 6372 6970 7473 272c  les', 'scripts',
+0001b6b0: 2027 636d 6473 275d 0a20 2020 2020 2020   'cmds'].       
+0001b6c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b6d0: 2762 6173 6570 6c61 6e27 2069 6e20 7072  'baseplan' in pr
+0001b6e0: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
+0001b6f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001b700: 6173 6570 6c61 6e20 3d20 7072 6f66 696c  aseplan = profil
+0001b710: 655b 2762 6173 6570 6c61 6e27 5d0a 2020  e['baseplan'].  
+0001b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b730: 2020 2020 2020 6261 7365 6469 7220 3d20        basedir = 
+0001b740: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+0001b750: 696e 7075 7466 696c 6529 2069 6620 272f  inputfile) if '/
+0001b760: 2720 696e 2069 6e70 7574 6669 6c65 2065  ' in inputfile e
+0001b770: 6c73 6520 272e 270a 2020 2020 2020 2020  lse '.'.        
+0001b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b790: 6261 7365 696e 7075 7466 696c 6520 3d20  baseinputfile = 
+0001b7a0: 6622 7b62 6173 6564 6972 7d2f 7b62 6173  f"{basedir}/{bas
+0001b7b0: 6570 6c61 6e7d 220a 2020 2020 2020 2020  eplan}".        
+0001b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7d0: 6966 2063 6f6e 7461 696e 6572 5f6d 6f64  if container_mod
+0001b7e0: 6528 2920 616e 6420 6e6f 7420 6f73 2e70  e() and not os.p
+0001b7f0: 6174 682e 6973 6162 7328 6261 7365 706c  ath.isabs(basepl
+0001b800: 616e 2920 616e 6420 272f 776f 726b 6469  an) and '/workdi
+0001b810: 7227 206e 6f74 2069 6e20 6261 7365 6469  r' not in basedi
+0001b820: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0001b830: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001b840: 6173 6569 6e70 7574 6669 6c65 203d 2066  aseinputfile = f
+0001b850: 222f 776f 726b 6469 722f 7b62 6173 6564  "/workdir/{based
+0001b860: 6972 7d2f 7b62 6173 6570 6c61 6e7d 220a  ir}/{baseplan}".
+0001b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b880: 2020 2020 2020 2020 6261 7365 766d 203d          basevm =
+0001b890: 2070 726f 6669 6c65 5b27 6261 7365 766d   profile['basevm
+0001b8a0: 275d 2069 6620 2762 6173 6576 6d27 2069  '] if 'basevm' i
+0001b8b0: 6e20 7072 6f66 696c 6520 656c 7365 206e  n profile else n
+0001b8c0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0001b8d0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+0001b8e0: 6173 6570 6c61 6e20 6e6f 7420 696e 2062  aseplan not in b
+0001b8f0: 6173 6570 6c61 6e73 3a0a 2020 2020 2020  aseplans:.      
+0001b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b910: 2020 2020 2020 7365 6c66 2e70 6c61 6e28        self.plan(
+0001b920: 706c 616e 2c20 696e 7075 7466 696c 653d  plan, inputfile=
+0001b930: 6261 7365 696e 7075 7466 696c 652c 206f  baseinputfile, o
+0001b940: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+0001b950: 6573 2c20 6578 636c 7564 6576 6d73 3d76  es, excludevms=v
+0001b960: 6d6e 616d 6573 2c0a 2020 2020 2020 2020  mnames,.        
+0001b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b980: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001b990: 7365 6d6f 6465 3d54 7275 652c 206f 6e6c  semode=True, onl
+0001b9a0: 7961 7373 6574 733d 6f6e 6c79 6173 7365  yassets=onlyasse
+0001b9b0: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
+0001b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9d0: 6261 7365 706c 616e 732e 6170 7065 6e64  baseplans.append
+0001b9e0: 2862 6173 6570 6c61 6e29 0a20 2020 2020  (baseplan).     
+0001b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba00: 2020 2062 6173 6569 6e66 6f20 3d20 7365     baseinfo = se
+0001ba10: 6c66 2e70 726f 6365 7373 5f69 6e70 7574  lf.process_input
+0001ba20: 6669 6c65 2870 6c61 6e2c 2062 6173 6569  file(plan, basei
+0001ba30: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
+0001ba40: 6465 733d 6f76 6572 7269 6465 732c 2066  des=overrides, f
+0001ba50: 756c 6c3d 5472 7565 290a 2020 2020 2020  ull=True).      
+0001ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba70: 2020 6261 7365 7072 6f66 696c 6520 3d20    baseprofile = 
+0001ba80: 6261 7365 696e 666f 5b30 5d5b 6261 7365  baseinfo[0][base
+0001ba90: 766d 5d20 6966 2062 6173 6576 6d20 696e  vm] if basevm in
+0001baa0: 2062 6173 6569 6e66 6f5b 305d 2065 6c73   baseinfo[0] els
+0001bab0: 6520 7b7d 0a20 2020 2020 2020 2020 2020  e {}.           
+0001bac0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0001bad0: 7265 6e74 706c 616e 6469 7220 3d20 6261  rentplandir = ba
+0001bae0: 7365 696e 666f 5b33 5d20 6966 206f 732e  seinfo[3] if os.
+0001baf0: 7061 7468 2e69 7361 6273 2862 6173 6569  path.isabs(basei
+0001bb00: 6e66 6f5b 335d 2920 656c 7365 2027 2e27  nfo[3]) else '.'
+0001bb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bb20: 2020 2020 2065 6c69 6620 2762 6173 6576       elif 'basev
+0001bb30: 6d27 2069 6e20 7072 6f66 696c 6520 616e  m' in profile an
+0001bb40: 6420 7072 6f66 696c 655b 2762 6173 6576  d profile['basev
+0001bb50: 6d27 5d20 696e 2062 6173 6565 6e74 7269  m'] in baseentri
+0001bb60: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001bb70: 2020 2020 2020 2020 2020 2020 6261 7365              base
+0001bb80: 7072 6f66 696c 6520 3d20 6261 7365 656e  profile = baseen
+0001bb90: 7472 6965 735b 7072 6f66 696c 655b 2762  tries[profile['b
+0001bba0: 6173 6576 6d27 5d5d 0a20 2020 2020 2020  asevm']].       
+0001bbb0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001bbc0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001bbd0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0001bbe0: 6e67 2866 2249 6e63 6f72 7265 6374 2062  ng(f"Incorrect b
+0001bbf0: 6173 6520 656e 7472 7920 666f 7220 7b6e  ase entry for {n
+0001bc00: 616d 657d 2e20 536b 6970 7069 6e67 2e2e  ame}. Skipping..
+0001bc10: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0001bc20: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001bc30: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0001bc40: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+0001bc50: 2069 6e20 6261 7365 7072 6f66 696c 653a   in baseprofile:
+0001bc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bc70: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
+0001bc80: 6e6f 7420 696e 2070 726f 6669 6c65 3a0a  not in profile:.
+0001bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bca0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
+0001bcb0: 696c 655b 6b65 795d 203d 2062 6173 6570  ile[key] = basep
+0001bcc0: 726f 6669 6c65 5b6b 6579 5d0a 2020 2020  rofile[key].    
+0001bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bce0: 2020 2020 656c 6966 206b 6579 2069 6e20      elif key in 
+0001bcf0: 6261 7365 7072 6f66 696c 6520 616e 6420  baseprofile and 
+0001bd00: 6b65 7920 696e 2070 726f 6669 6c65 2061  key in profile a
+0001bd10: 6e64 206b 6579 2069 6e20 6170 7065 6e64  nd key in append
+0001bd20: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
+0001bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd40: 2020 7072 6f66 696c 655b 6b65 795d 203d    profile[key] =
+0001bd50: 2062 6173 6570 726f 6669 6c65 5b6b 6579   baseprofile[key
+0001bd60: 5d20 2b20 7072 6f66 696c 655b 6b65 795d  ] + profile[key]
+0001bd70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bd80: 2072 756c 6566 6f75 6e64 203d 2046 616c   rulefound = Fal
+0001bd90: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0001bda0: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
+0001bdb0: 6f76 6572 7269 6465 732e 6765 7428 2776  overrides.get('v
+0001bdc0: 6d72 756c 6573 272c 2073 656c 662e 766d  mrules', self.vm
+0001bdd0: 7275 6c65 7329 3a0a 2020 2020 2020 2020  rules):.        
+0001bde0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0001bdf0: 656e 2865 6e74 7279 2920 213d 2031 3a0a  en(entry) != 1:.
 0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 2020 2020 2020 2020 2020 6966 2027 7669            if 'vi
-0001be20: 7073 2720 696e 206e 6574 3a0a 2020 2020  ps' in net:.    
-0001be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be40: 2020 2020 2020 2020 2020 2020 7669 7073              vips
-0001be50: 203d 2027 2c27 2e6a 6f69 6e28 6e65 745b   = ','.join(net[
-0001be60: 2776 6970 7327 5d29 0a20 2020 2020 2020  'vips']).       
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0001be90: 2866 2241 6464 206d 616e 7561 6c6c 7920  (f"Add manually 
-0001bea0: 7669 7073 207b 7669 7073 7d22 290a 2020  vips {vips}").  
-0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bec0: 2020 2020 2020 7070 7269 6e74 2822 4d61        pprint("Ma
-0001bed0: 6b65 2073 7572 6520 746f 2065 7870 6f72  ke sure to expor
-0001bee0: 7420 414e 5349 424c 455f 4a49 4e4a 4132  t ANSIBLE_JINJA2
-0001bef0: 5f45 5854 454e 5349 4f4e 533d 6a69 6e6a  _EXTENSIONS=jinj
-0001bf00: 6132 2e65 7874 2e64 6f22 290a 2020 2020  a2.ext.do").    
-0001bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf20: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-0001bf30: 766d 5f70 6c61 7962 6f6f 6b28 6e61 6d65  vm_playbook(name
-0001bf40: 2c20 7072 6f66 696c 652c 206f 7665 7272  , profile, overr
-0001bf50: 6964 6573 3d6f 7665 7272 6964 6573 2c20  ides=overrides, 
-0001bf60: 7374 6f72 653d 5472 7565 290a 2020 2020  store=True).    
-0001bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf80: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-0001bf90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001bfa0: 7a2e 6578 6973 7473 286e 616d 6529 2061  z.exists(name) a
-0001bfb0: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
-0001bfc0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001bfd0: 2020 2020 2020 2069 6620 6e6f 7420 7570         if not up
-0001bfe0: 6461 7465 3a0a 2020 2020 2020 2020 2020  date:.          
-0001bff0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-0001c000: 7269 6e74 2866 227b 6e61 6d65 7dc2 a073  rint(f"{name}..s
-0001c010: 6b69 7070 6564 206f 6e20 7b76 6d63 6c69  kipped on {vmcli
-0001c020: 656e 747d 2122 290a 2020 2020 2020 2020  ent}!").        
-0001c030: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001c040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c050: 2020 2020 2020 2020 2020 7570 6461 7465            update
-0001c060: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-0001c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c080: 2020 6375 7272 656e 7476 6d20 3d20 7a2e    currentvm = z.
-0001c090: 696e 666f 286e 616d 6529 0a20 2020 2020  info(name).     
-0001c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0b0: 2020 2063 7572 7265 6e74 7374 6172 7420     currentstart 
-0001c0c0: 3d20 6375 7272 656e 7476 6d2e 6765 7428  = currentvm.get(
-0001c0d0: 2761 7574 6f73 7461 7274 272c 2046 616c  'autostart', Fal
-0001c0e0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-0001c0f0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001c100: 656e 746d 656d 6f72 7920 3d20 6375 7272  entmemory = curr
-0001c110: 656e 7476 6d5b 276d 656d 6f72 7927 5d0a  entvm['memory'].
+0001be10: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+0001be20: 5772 6f6e 6720 766d 2072 756c 6520 7b65  Wrong vm rule {e
+0001be30: 6e74 7279 7d22 290a 2020 2020 2020 2020  ntry}").        
+0001be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be50: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+0001be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be70: 7275 6c65 203d 206c 6973 7428 656e 7472  rule = list(entr
+0001be80: 792e 6b65 7973 2829 295b 305d 0a20 2020  y.keys())[0].   
+0001be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bea0: 2069 6620 2872 652e 6d61 7463 6828 7275   if (re.match(ru
+0001beb0: 6c65 2c20 6e61 6d65 2920 6f72 2066 6e6d  le, name) or fnm
+0001bec0: 6174 6368 286e 616d 652c 2072 756c 6529  atch(name, rule)
+0001bed0: 2920 616e 6420 6973 696e 7374 616e 6365  ) and isinstance
+0001bee0: 2865 6e74 7279 5b72 756c 655d 2c20 6469  (entry[rule], di
+0001bef0: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+0001bf00: 2020 2020 2020 2020 2020 2020 2072 756c               rul
+0001bf10: 6566 6f75 6e64 203d 2054 7275 650a 2020  efound = True.  
+0001bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf30: 2020 2020 2020 6c69 7374 6b65 7973 203d        listkeys =
+0001bf40: 205b 2763 6d64 7327 2c20 2766 696c 6573   ['cmds', 'files
+0001bf50: 272c 2027 7363 7269 7074 7327 5d0a 2020  ', 'scripts'].  
+0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf70: 2020 2020 2020 666f 7220 7275 6c65 2069        for rule i
+0001bf80: 6e20 656e 7472 793a 0a20 2020 2020 2020  n entry:.       
+0001bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfa0: 2020 2020 2063 7572 7265 6e74 203d 2065       current = e
+0001bfb0: 6e74 7279 5b72 756c 655d 0a20 2020 2020  ntry[rule].     
+0001bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfd0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
+0001bfe0: 6e20 6375 7272 656e 743a 0a20 2020 2020  n current:.     
+0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c000: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
+0001c010: 7920 696e 206c 6973 746b 6579 7320 616e  y in listkeys an
+0001c020: 6420 6973 696e 7374 616e 6365 2863 7572  d isinstance(cur
+0001c030: 7265 6e74 5b6b 6579 5d2c 206c 6973 7429  rent[key], list)
+0001c040: 2061 6e64 206b 6579 2069 6e20 7072 6f66   and key in prof
+0001c050: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0001c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c070: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001c080: 5b6b 6579 5d20 3d20 7072 6f66 696c 655b  [key] = profile[
+0001c090: 6b65 795d 202b 2063 7572 7265 6e74 5b6b  key] + current[k
+0001c0a0: 6579 5d0a 2020 2020 2020 2020 2020 2020  ey].            
+0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0c0: 7072 6f66 696c 652e 7570 6461 7465 2865  profile.update(e
+0001c0d0: 6e74 7279 5b72 756c 655d 290a 2020 2020  ntry[rule]).    
+0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0f0: 2020 2020 2020 2020 6966 2027 6e61 6d65          if 'name
+0001c100: 2720 696e 2065 6e74 7279 5b72 756c 655d  ' in entry[rule]
+0001c110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 0001c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c130: 2020 2020 2020 2020 6375 7272 656e 7469          currenti
-0001c140: 6d61 6765 203d 2063 7572 7265 6e74 766d  mage = currentvm
-0001c150: 2e67 6574 2827 7465 6d70 6c61 7465 2729  .get('template')
-0001c160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c170: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0001c180: 696d 6167 6520 3d20 6375 7272 656e 7476  image = currentv
-0001c190: 6d2e 6765 7428 2769 6d61 6765 272c 2063  m.get('image', c
-0001c1a0: 7572 7265 6e74 696d 6167 6529 0a20 2020  urrentimage).   
-0001c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1c0: 2020 2020 2063 7572 7265 6e74 6370 7573       currentcpus
-0001c1d0: 203d 2069 6e74 2863 7572 7265 6e74 766d   = int(currentvm
-0001c1e0: 5b27 6370 7573 275d 290a 2020 2020 2020  ['cpus']).      
-0001c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c200: 2020 6375 7272 656e 746e 6574 7320 3d20    currentnets = 
-0001c210: 6375 7272 656e 7476 6d5b 276e 6574 7327  currentvm['nets'
-0001c220: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001c230: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0001c240: 7464 6973 6b73 203d 2063 7572 7265 6e74  tdisks = current
-0001c250: 766d 5b27 6469 736b 7327 5d0a 2020 2020  vm['disks'].    
-0001c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c270: 2020 2020 6375 7272 656e 7466 6c61 766f      currentflavo
-0001c280: 7220 3d20 6375 7272 656e 7476 6d2e 6765  r = currentvm.ge
-0001c290: 7428 2766 6c61 766f 7227 290a 2020 2020  t('flavor').    
-0001c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2b0: 2020 2020 6966 2027 6175 746f 7374 6172      if 'autostar
-0001c2c0: 7427 2069 6e20 7072 6f66 696c 6520 616e  t' in profile an
-0001c2d0: 6420 6375 7272 656e 7473 7461 7274 2021  d currentstart !
-0001c2e0: 3d20 7072 6f66 696c 655b 2761 7574 6f73  = profile['autos
-0001c2f0: 7461 7274 275d 3a0a 2020 2020 2020 2020  tart']:.        
-0001c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c310: 2020 2020 7570 6461 7465 6420 3d20 5472      updated = Tr
-0001c320: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0001c330: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001c340: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
-0001c350: 2061 7574 6f73 7461 7274 206f 6620 7b6e   autostart of {n
-0001c360: 616d 657d 2074 6f20 7b70 726f 6669 6c65  ame} to {profile
-0001c370: 5b27 6175 746f 7374 6172 7427 5d7d 2229  ['autostart']}")
-0001c380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c390: 2020 2020 2020 2020 2020 2020 207a 2e75               z.u
-0001c3a0: 7064 6174 655f 7374 6172 7428 6e61 6d65  pdate_start(name
-0001c3b0: 2c20 7072 6f66 696c 655b 2761 7574 6f73  , profile['autos
-0001c3c0: 7461 7274 275d 290a 2020 2020 2020 2020  tart']).        
-0001c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3e0: 6966 2027 666c 6176 6f72 2720 696e 2070  if 'flavor' in p
-0001c3f0: 726f 6669 6c65 2061 6e64 2063 7572 7265  rofile and curre
-0001c400: 6e74 666c 6176 6f72 2021 3d20 7072 6f66  ntflavor != prof
-0001c410: 696c 655b 2766 6c61 766f 7227 5d3a 0a20  ile['flavor']:. 
-0001c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c430: 2020 2020 2020 2020 2020 2075 7064 6174             updat
-0001c440: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
-0001c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c460: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
-0001c470: 7064 6174 696e 6720 666c 6176 6f72 206f  pdating flavor o
-0001c480: 6620 7b6e 616d 657d 2074 6f20 7b70 726f  f {name} to {pro
-0001c490: 6669 6c65 5b27 666c 6176 6f72 275d 7d22  file['flavor']}"
-0001c4a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c4b0: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
-0001c4c0: 7570 6461 7465 5f66 6c61 766f 7228 6e61  update_flavor(na
-0001c4d0: 6d65 2c20 7072 6f66 696c 655b 2766 6c61  me, profile['fla
-0001c4e0: 766f 7227 5d29 0a20 2020 2020 2020 2020  vor']).         
-0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001c500: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c520: 2069 6620 276d 656d 6f72 7927 2069 6e20   if 'memory' in 
-0001c530: 7072 6f66 696c 6520 616e 6420 6375 7272  profile and curr
-0001c540: 656e 746d 656d 6f72 7920 213d 2070 726f  entmemory != pro
-0001c550: 6669 6c65 5b27 6d65 6d6f 7279 275d 3a0a  file['memory']:.
-0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c580: 7570 6461 7465 6420 3d20 5472 7565 0a20  updated = True. 
-0001c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001c5b0: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
-0001c5c0: 206d 656d 6f72 7920 6f66 207b 6e61 6d65   memory of {name
-0001c5d0: 7d20 746f 207b 7072 6f66 696c 655b 276d  } to {profile['m
-0001c5e0: 656d 6f72 7927 5d7d 2229 0a20 2020 2020  emory']}").     
-0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c600: 2020 2020 2020 2020 2020 207a 2e75 7064             z.upd
-0001c610: 6174 655f 6d65 6d6f 7279 286e 616d 652c  ate_memory(name,
-0001c620: 2070 726f 6669 6c65 5b27 6d65 6d6f 7279   profile['memory
-0001c630: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-0001c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c650: 6966 2027 6e75 6d63 7075 7327 2069 6e20  if 'numcpus' in 
-0001c660: 7072 6f66 696c 6520 616e 6420 6375 7272  profile and curr
-0001c670: 656e 7463 7075 7320 213d 2070 726f 6669  entcpus != profi
-0001c680: 6c65 5b27 6e75 6d63 7075 7327 5d3a 0a20  le['numcpus']:. 
-0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6a0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0001c6b0: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
-0001c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6d0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-0001c6e0: 7269 6e74 2866 2255 7064 6174 696e 6720  rint(f"Updating 
-0001c6f0: 6370 7573 206f 6620 7b6e 616d 657d 2074  cpus of {name} t
-0001c700: 6f20 7b70 726f 6669 6c65 5b27 6e75 6d63  o {profile['numc
-0001c710: 7075 7327 5d7d 2229 0a20 2020 2020 2020  pus']}").       
-0001c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c730: 2020 2020 2020 2020 207a 2e75 7064 6174           z.updat
-0001c740: 655f 6370 7573 286e 616d 652c 2070 726f  e_cpus(name, pro
-0001c750: 6669 6c65 5b27 6e75 6d63 7075 7327 5d29  file['numcpus'])
-0001c760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c770: 2020 2020 2020 2020 2069 6620 2764 6973           if 'dis
-0001c780: 6b73 2720 696e 2070 726f 6669 6c65 3a0a  ks' in profile:.
-0001c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7a0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0001c7b0: 656e 2863 7572 7265 6e74 6469 736b 7329  en(currentdisks)
-0001c7c0: 203c 206c 656e 2870 726f 6669 6c65 5b27   < len(profile['
-0001c7d0: 6469 736b 7327 5d29 3a0a 2020 2020 2020  disks']):.      
-0001c7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7f0: 2020 2020 2020 2020 2020 7570 6461 7465            update
-0001c800: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c820: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-0001c830: 6622 4164 6469 6e67 2044 6973 6b73 2074  f"Adding Disks t
-0001c840: 6f20 7b6e 616d 657d 2229 0a20 2020 2020  o {name}").     
+0001c130: 2020 7761 726e 696e 6728 6622 5265 6e61    warning(f"Rena
+0001c140: 6d69 6e67 207b 6e61 6d65 7d20 746f 207b  ming {name} to {
+0001c150: 656e 7472 795b 7275 6c65 5d5b 276e 616d  entry[rule]['nam
+0001c160: 6527 5d7d 2229 0a20 2020 2020 2020 2020  e']}").         
+0001c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c180: 2020 2020 2020 206e 616d 6520 3d20 656e         name = en
+0001c190: 7472 795b 7275 6c65 5d5b 276e 616d 6527  try[rule]['name'
+0001c1a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001c1b0: 2020 6966 2076 6d72 756c 6573 5f73 7472    if vmrules_str
+0001c1c0: 6963 7420 616e 6420 6e6f 7420 7275 6c65  ict and not rule
+0001c1d0: 666f 756e 643a 0a20 2020 2020 2020 2020  found:.         
+0001c1e0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0001c1f0: 6e67 2866 224e 6f20 766d 7275 6c65 7320  ng(f"No vmrules 
+0001c200: 666f 756e 6420 666f 7220 7b6e 616d 657d  found for {name}
+0001c210: 2e20 536b 6970 7069 6e67 2e2e 2e22 290a  . Skipping...").
+0001c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c230: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001c240: 2020 2020 2020 2020 2020 2020 2076 6d63               vmc
+0001c250: 6c69 656e 7420 3d20 7072 6f66 696c 652e  lient = profile.
+0001c260: 6765 7428 2763 6c69 656e 7427 290a 2020  get('client').  
+0001c270: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001c280: 2076 6d63 6c69 656e 7420 6973 206e 6f74   vmclient is not
+0001c290: 204e 6f6e 6520 616e 6420 766d 636c 6965   None and vmclie
+0001c2a0: 6e74 206e 6f74 2069 6e20 766d 636c 6965  nt not in vmclie
+0001c2b0: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+0001c2c0: 2020 2020 2020 2020 2076 6d63 6c69 656e           vmclien
+0001c2d0: 7473 2e61 7070 656e 6428 766d 636c 6965  ts.append(vmclie
+0001c2e0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+0001c2f0: 2020 2020 6966 2076 6d63 6c69 656e 7420      if vmclient 
+0001c300: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001c310: 2020 2020 2020 2020 2020 2020 207a 203d               z =
+0001c320: 206b 0a20 2020 2020 2020 2020 2020 2020   k.             
+0001c330: 2020 2020 2020 2076 6d63 6c69 656e 7420         vmclient 
+0001c340: 3d20 7365 6c66 2e63 6c69 656e 740a 2020  = self.client.  
+0001c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c360: 2020 6966 2076 6d63 6c69 656e 7420 6e6f    if vmclient no
+0001c370: 7420 696e 2068 6f73 7473 3a0a 2020 2020  t in hosts:.    
+0001c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c390: 2020 2020 686f 7374 735b 766d 636c 6965      hosts[vmclie
+0001c3a0: 6e74 5d20 3d20 7365 6c66 0a20 2020 2020  nt] = self.     
+0001c3b0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001c3c0: 766d 636c 6965 6e74 2069 6e20 686f 7374  vmclient in host
+0001c3d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001c3e0: 2020 2020 2020 207a 203d 2068 6f73 7473         z = hosts
+0001c3f0: 5b76 6d63 6c69 656e 745d 2e6b 0a20 2020  [vmclient].k.   
+0001c400: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0001c410: 6620 766d 636c 6965 6e74 2069 6e20 7365  f vmclient in se
+0001c420: 6c66 2e63 6c69 656e 7473 3a0a 2020 2020  lf.clients:.    
+0001c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c440: 6e65 7763 6c69 656e 7420 3d20 4b63 6f6e  newclient = Kcon
+0001c450: 6669 6728 636c 6965 6e74 3d76 6d63 6c69  fig(client=vmcli
+0001c460: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
+0001c470: 2020 2020 2020 2020 207a 203d 206e 6577           z = new
+0001c480: 636c 6965 6e74 2e6b 0a20 2020 2020 2020  client.k.       
+0001c490: 2020 2020 2020 2020 2020 2020 2068 6f73               hos
+0001c4a0: 7473 5b76 6d63 6c69 656e 745d 203d 206e  ts[vmclient] = n
+0001c4b0: 6577 636c 6965 6e74 0a20 2020 2020 2020  ewclient.       
+0001c4c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4e0: 2020 2077 6172 6e69 6e67 2866 2243 6c69     warning(f"Cli
+0001c4f0: 656e 7420 7b76 6d63 6c69 656e 747d 206e  ent {vmclient} n
+0001c500: 6f74 2066 6f75 6e64 2e20 5573 696e 6720  ot found. Using 
+0001c510: 6465 6661 756c 7420 6f6e 6522 290a 2020  default one").  
+0001c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c530: 2020 7a20 3d20 6b0a 2020 2020 2020 2020    z = k.        
+0001c540: 2020 2020 2020 2020 2020 2020 766d 636c              vmcl
+0001c550: 6965 6e74 203d 2073 656c 662e 636c 6965  ient = self.clie
+0001c560: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
+0001c570: 2020 2020 2020 2069 6620 766d 636c 6965         if vmclie
+0001c580: 6e74 206e 6f74 2069 6e20 686f 7374 733a  nt not in hosts:
+0001c590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c5a0: 2020 2020 2020 2020 2068 6f73 7473 5b76           hosts[v
+0001c5b0: 6d63 6c69 656e 745d 203d 2073 656c 660a  mclient] = self.
+0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5d0: 766d 735f 746f 5f68 6f73 745b 6e61 6d65  vms_to_host[name
+0001c5e0: 5d20 3d20 686f 7374 735b 766d 636c 6965  ] = hosts[vmclie
+0001c5f0: 6e74 5d0a 2020 2020 2020 2020 2020 2020  nt].            
+0001c600: 2020 2020 6966 2027 7072 6f66 696c 6527      if 'profile'
+0001c610: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
+0001c620: 7072 6f66 696c 655b 2770 726f 6669 6c65  profile['profile
+0001c630: 275d 2069 6e20 766d 7072 6f66 696c 6573  '] in vmprofiles
+0001c640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c650: 2020 2020 2020 6375 7374 6f6d 7072 6f66        customprof
+0001c660: 696c 6520 3d20 766d 7072 6f66 696c 6573  ile = vmprofiles
+0001c670: 5b70 726f 6669 6c65 5b27 7072 6f66 696c  [profile['profil
+0001c680: 6527 5d5d 0a20 2020 2020 2020 2020 2020  e']].           
+0001c690: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
+0001c6a0: 6e61 6d65 203d 2070 726f 6669 6c65 5b27  name = profile['
+0001c6b0: 7072 6f66 696c 6527 5d0a 2020 2020 2020  profile'].      
+0001c6c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6e0: 2020 2020 6375 7374 6f6d 7072 6f66 696c      customprofil
+0001c6f0: 6520 3d20 7b7d 0a20 2020 2020 2020 2020  e = {}.         
+0001c700: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+0001c710: 6c65 6e61 6d65 203d 2027 6b76 6972 7427  lename = 'kvirt'
+0001c720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c730: 2069 6620 6375 7374 6f6d 7072 6f66 696c   if customprofil
+0001c740: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001c750: 2020 2020 2020 2063 7573 746f 6d70 726f         custompro
+0001c760: 6669 6c65 2e75 7064 6174 6528 7072 6f66  file.update(prof
+0001c770: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+0001c780: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
+0001c790: 203d 2063 7573 746f 6d70 726f 6669 6c65   = customprofile
+0001c7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c7b0: 2069 6620 2770 6c61 7962 6f6f 6b27 2069   if 'playbook' i
+0001c7c0: 6e20 7072 6f66 696c 6520 616e 6420 7072  n profile and pr
+0001c7d0: 6f66 696c 655b 2770 6c61 7962 6f6f 6b27  ofile['playbook'
+0001c7e0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0001c7f0: 2020 2020 2020 2069 6620 2773 6372 6970         if 'scrip
+0001c800: 7473 2720 6e6f 7420 696e 2070 726f 6669  ts' not in profi
+0001c810: 6c65 2061 6e64 2027 6669 6c65 7327 206e  le and 'files' n
+0001c820: 6f74 2069 6e20 7072 6f66 696c 6520 616e  ot in profile an
+0001c830: 6420 2763 6d64 7327 206e 6f74 2069 6e20  d 'cmds' not in 
+0001c840: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
 0001c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c860: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-0001c870: 6973 6b20 696e 2070 726f 6669 6c65 5b27  isk in profile['
-0001c880: 6469 736b 7327 5d5b 6c65 6e28 6375 7272  disks'][len(curr
-0001c890: 656e 7464 6973 6b73 293a 5d3a 0a20 2020  entdisks):]:.   
-0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c860: 2070 7072 696e 7428 6622 536b 6970 7069   pprint(f"Skippi
+0001c870: 6e67 2065 6d70 7479 2070 6c61 7962 6f6f  ng empty playboo
+0001c880: 6b20 666f 7220 7b6e 616d 657d 2229 0a20  k for {name}"). 
+0001c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
 0001c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8c0: 2069 6620 6973 696e 7374 616e 6365 2864   if isinstance(d
-0001c8d0: 6973 6b2c 2069 6e74 293a 0a20 2020 2020  isk, int):.     
-0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c900: 2020 2073 697a 6520 3d20 6469 736b 0a20     size = disk. 
-0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c930: 2020 2020 2020 2070 6f6f 6c20 3d20 7365         pool = se
-0001c940: 6c66 2e70 6f6f 6c0a 2020 2020 2020 2020  lf.pool.        
+0001c8c0: 2069 6620 2769 6d61 6765 2720 696e 2070   if 'image' in p
+0001c8d0: 726f 6669 6c65 2061 6e64 2027 7268 656c  rofile and 'rhel
+0001c8e0: 2720 696e 2070 726f 6669 6c65 5b27 696d  ' in profile['im
+0001c8f0: 6167 6527 5d5c 0a20 2020 2020 2020 2020  age']\.         
+0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c910: 2020 2020 2020 2061 6e64 2027 7268 6e72         and 'rhnr
+0001c920: 6567 6973 7465 7227 2069 6e20 7072 6f66  egister' in prof
+0001c930: 696c 6520 616e 6420 7072 6f66 696c 655b  ile and profile[
+0001c940: 2772 686e 7265 6769 7374 6572 275d 3a0a  'rhnregister']:.
 0001c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c960: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0001c970: 2069 7369 6e73 7461 6e63 6528 6469 736b   isinstance(disk
-0001c980: 2c20 7374 7229 2061 6e64 2064 6973 6b2e  , str) and disk.
-0001c990: 6973 6469 6769 7428 293a 0a20 2020 2020  isdigit():.     
-0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c960: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0001c970: 696e 6728 6622 4d61 6b65 2073 7572 6520  ing(f"Make sure 
+0001c980: 746f 2073 7562 7363 7269 6265 207b 6e61  to subscribe {na
+0001c990: 6d65 7d20 746f 2052 6564 2048 6174 206e  me} to Red Hat n
+0001c9a0: 6574 776f 726b 2229 0a20 2020 2020 2020  etwork").       
 0001c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9c0: 2020 2073 697a 6520 3d20 696e 7428 6469     size = int(di
-0001c9d0: 736b 290a 2020 2020 2020 2020 2020 2020  sk).            
-0001c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9f0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
-0001ca00: 203d 2073 656c 662e 706f 6f6c 0a20 2020   = self.pool.   
-0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca30: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0001ca40: 2864 6973 6b2c 2064 6963 7429 3a0a 2020  (disk, dict):.  
-0001ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca70: 2020 2020 2020 7369 7a65 203d 2064 6973        size = dis
-0001ca80: 6b2e 6765 7428 2773 697a 6527 2c20 7365  k.get('size', se
-0001ca90: 6c66 2e64 6973 6b73 697a 6529 0a20 2020  lf.disksize).   
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cac0: 2020 2020 2070 6f6f 6c20 3d20 6469 736b       pool = disk
-0001cad0: 2e67 6574 2827 706f 6f6c 272c 2073 656c  .get('pool', sel
-0001cae0: 662e 706f 6f6c 290a 2020 2020 2020 2020  f.pool).        
-0001caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb00: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001cb10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb30: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001cb40: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0001cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb60: 2020 2020 2020 207a 2e61 6464 5f64 6973         z.add_dis
-0001cb70: 6b28 6e61 6d65 3d6e 616d 652c 2073 697a  k(name=name, siz
-0001cb80: 653d 7369 7a65 2c20 706f 6f6c 3d70 6f6f  e=size, pool=poo
-0001cb90: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-0001cba0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001cbb0: 6620 6c65 6e28 6375 7272 656e 7464 6973  f len(currentdis
-0001cbc0: 6b73 2920 3e20 6c65 6e28 7072 6f66 696c  ks) > len(profil
-0001cbd0: 655b 2764 6973 6b73 275d 293a 0a20 2020  e['disks']):.   
-0001cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbf0: 2020 2020 2020 2020 2020 2020 2075 7064               upd
-0001cc00: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
-0001cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc20: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0001cc30: 6e74 2866 2252 656d 6f76 696e 6720 4469  nt(f"Removing Di
-0001cc40: 736b 7320 6f66 207b 6e61 6d65 7d22 290a  sks of {name}").
-0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc70: 666f 7220 6469 736b 2069 6e20 6375 7272  for disk in curr
-0001cc80: 656e 7464 6973 6b73 5b6c 656e 2863 7572  entdisks[len(cur
-0001cc90: 7265 6e74 6469 736b 7329 202d 206c 656e  rentdisks) - len
-0001cca0: 2870 726f 6669 6c65 5b27 6469 736b 7327  (profile['disks'
-0001ccb0: 5d29 3a5d 3a0a 2020 2020 2020 2020 2020  ]):]:.          
-0001ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccd0: 2020 2020 2020 2020 2020 6469 736b 6e61            diskna
-0001cce0: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
-0001ccf0: 656e 616d 6528 6469 736b 5b27 7061 7468  ename(disk['path
-0001cd00: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-0001cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd20: 2020 2020 2020 2020 6469 736b 706f 6f6c          diskpool
-0001cd30: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-0001cd40: 6d65 2864 6973 6b5b 2770 6174 6827 5d29  me(disk['path'])
-0001cd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd70: 2020 2020 207a 2e64 656c 6574 655f 6469       z.delete_di
-0001cd80: 736b 286e 616d 653d 6e61 6d65 2c20 6469  sk(name=name, di
-0001cd90: 736b 6e61 6d65 3d64 6973 6b6e 616d 652c  skname=diskname,
-0001cda0: 2070 6f6f 6c3d 6469 736b 706f 6f6c 290a   pool=diskpool).
-0001cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdc0: 2020 2020 2020 2020 6966 2027 6e65 7473          if 'nets
-0001cdd0: 2720 696e 2070 726f 6669 6c65 3a0a 2020  ' in profile:.  
-0001cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdf0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0001ce00: 2863 7572 7265 6e74 6e65 7473 2920 3c20  (currentnets) < 
-0001ce10: 6c65 6e28 7072 6f66 696c 655b 276e 6574  len(profile['net
-0001ce20: 7327 5d29 3a0a 2020 2020 2020 2020 2020  s']):.          
+0001c9c0: 2069 6620 2770 7269 7661 7465 6b65 7927   if 'privatekey'
+0001c9d0: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
+0001c9e0: 7072 6f66 696c 655b 2770 7269 7661 7465  profile['private
+0001c9f0: 6b65 7927 5d3a 0a20 2020 2020 2020 2020  key']:.         
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca10: 2020 2077 6172 6e69 6e67 2866 2243 6f70     warning(f"Cop
+0001ca20: 7920 796f 7572 2070 7269 7661 7465 206b  y your private k
+0001ca30: 6579 2074 6f20 7b6e 616d 657d 2229 0a20  ey to {name}"). 
+0001ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca50: 2020 2020 2020 2066 6f72 206e 6574 2069         for net i
+0001ca60: 6e20 7072 6f66 696c 652e 6765 7428 276e  n profile.get('n
+0001ca70: 6574 7327 2c20 5b5d 293a 0a20 2020 2020  ets', []):.     
+0001ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca90: 2020 2020 2020 2069 6620 2769 7027 2069         if 'ip' i
+0001caa0: 6e20 6e65 7420 616e 6420 276d 6173 6b27  n net and 'mask'
+0001cab0: 2069 6e20 6e65 7420 616e 6420 2767 6174   in net and 'gat
+0001cac0: 6577 6179 2720 696e 206e 6574 3a0a 2020  eway' in net:.  
+0001cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cae0: 2020 2020 2020 2020 2020 2020 2020 6970                ip
+0001caf0: 2c20 6d61 736b 2c20 6761 7465 7761 7920  , mask, gateway 
+0001cb00: 3d20 6e65 745b 2769 7027 5d2c 206e 6574  = net['ip'], net
+0001cb10: 5b27 6d61 736b 275d 2c20 6e65 745b 2767  ['mask'], net['g
+0001cb20: 6174 6577 6179 275d 0a20 2020 2020 2020  ateway'].       
+0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb40: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0001cb50: 2866 2241 6464 206d 616e 7561 6c6c 7920  (f"Add manually 
+0001cb60: 7468 6973 206e 6574 776f 726b 207b 6970  this network {ip
+0001cb70: 7d2f 7b6d 6173 6b7d 2077 6974 6820 6761  }/{mask} with ga
+0001cb80: 7465 7761 7920 7b67 6174 6577 6179 7d22  teway {gateway}"
+0001cb90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001cba0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001cbb0: 2027 7669 7073 2720 696e 206e 6574 3a0a   'vips' in net:.
+0001cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbe0: 7669 7073 203d 2027 2c27 2e6a 6f69 6e28  vips = ','.join(
+0001cbf0: 6e65 745b 2776 6970 7327 5d29 0a20 2020  net['vips']).   
+0001cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc10: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0001cc20: 6e69 6e67 2866 2241 6464 206d 616e 7561  ning(f"Add manua
+0001cc30: 6c6c 7920 7669 7073 207b 7669 7073 7d22  lly vips {vips}"
+0001cc40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001cc50: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+0001cc60: 2822 4d61 6b65 2073 7572 6520 746f 2065  ("Make sure to e
+0001cc70: 7870 6f72 7420 414e 5349 424c 455f 4a49  xport ANSIBLE_JI
+0001cc80: 4e4a 4132 5f45 5854 454e 5349 4f4e 533d  NJA2_EXTENSIONS=
+0001cc90: 6a69 6e6a 6132 2e65 7874 2e64 6f22 290a  jinja2.ext.do").
+0001cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccb0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
+0001ccc0: 6174 655f 766d 5f70 6c61 7962 6f6f 6b28  ate_vm_playbook(
+0001ccd0: 6e61 6d65 2c20 7072 6f66 696c 652c 206f  name, profile, o
+0001cce0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+0001ccf0: 6573 2c20 7374 6f72 653d 5472 7565 290a  es, store=True).
+0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd10: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0001cd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd30: 2069 6620 7a2e 6578 6973 7473 286e 616d   if z.exists(nam
+0001cd40: 6529 2061 6e64 206e 6f74 206f 6e6c 7961  e) and not onlya
+0001cd50: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0001cd60: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0001cd70: 7420 7570 6461 7465 3a0a 2020 2020 2020  t update:.      
+0001cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd90: 2020 7070 7269 6e74 2866 227b 6e61 6d65    pprint(f"{name
+0001cda0: 7dc2 a073 6b69 7070 6564 206f 6e20 7b76  }..skipped on {v
+0001cdb0: 6d63 6c69 656e 747d 2122 290a 2020 2020  mclient}!").    
+0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001cde0: 2020 2020 2020 2020 2020 2020 2020 7570                up
+0001cdf0: 6461 7465 6420 3d20 4661 6c73 650a 2020  dated = False.  
+0001ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce10: 2020 2020 2020 6375 7272 656e 7476 6d20        currentvm 
+0001ce20: 3d20 7a2e 696e 666f 286e 616d 6529 0a20  = z.info(name). 
 0001ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce40: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
-0001ce50: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0001ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce70: 2020 2020 2070 7072 696e 7428 6622 4164       pprint(f"Ad
-0001ce80: 6469 6e67 204e 6963 7320 746f 207b 6e61  ding Nics to {na
-0001ce90: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-0001cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ceb0: 2020 2020 2020 666f 7220 6e65 7420 696e        for net in
-0001cec0: 2070 726f 6669 6c65 5b27 6e65 7473 275d   profile['nets']
-0001ced0: 5b6c 656e 2863 7572 7265 6e74 6e65 7473  [len(currentnets
-0001cee0: 293a 5d3a 0a20 2020 2020 2020 2020 2020  ):]:.           
-0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf00: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0001cf10: 7374 616e 6365 286e 6574 2c20 7374 7229  stance(net, str)
-0001cf20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf40: 2020 2020 2020 2020 2020 6e65 7477 6f72            networ
-0001cf50: 6b20 3d20 6e65 740a 2020 2020 2020 2020  k = net.        
-0001cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf70: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0001cf80: 2069 7369 6e73 7461 6e63 6528 6e65 742c   isinstance(net,
-0001cf90: 2064 6963 7429 2061 6e64 2027 6e61 6d65   dict) and 'name
-0001cfa0: 2720 696e 206e 6574 3a0a 2020 2020 2020  ' in net:.      
-0001cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfd0: 2020 6e65 7477 6f72 6b20 3d20 6e65 745b    network = net[
-0001cfe0: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
+0001ce40: 2020 2020 2020 2063 7572 7265 6e74 7374         currentst
+0001ce50: 6172 7420 3d20 6375 7272 656e 7476 6d2e  art = currentvm.
+0001ce60: 6765 7428 2761 7574 6f73 7461 7274 272c  get('autostart',
+0001ce70: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+0001ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce90: 6375 7272 656e 746d 656d 6f72 7920 3d20  currentmemory = 
+0001cea0: 6375 7272 656e 7476 6d5b 276d 656d 6f72  currentvm['memor
+0001ceb0: 7927 5d0a 2020 2020 2020 2020 2020 2020  y'].            
+0001cec0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001ced0: 656e 7469 6d61 6765 203d 2063 7572 7265  entimage = curre
+0001cee0: 6e74 766d 2e67 6574 2827 7465 6d70 6c61  ntvm.get('templa
+0001cef0: 7465 2729 0a20 2020 2020 2020 2020 2020  te').           
+0001cf00: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0001cf10: 7265 6e74 696d 6167 6520 3d20 6375 7272  rentimage = curr
+0001cf20: 656e 7476 6d2e 6765 7428 2769 6d61 6765  entvm.get('image
+0001cf30: 272c 2063 7572 7265 6e74 696d 6167 6529  ', currentimage)
+0001cf40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cf50: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001cf60: 6370 7573 203d 2069 6e74 2863 7572 7265  cpus = int(curre
+0001cf70: 6e74 766d 5b27 6370 7573 275d 290a 2020  ntvm['cpus']).  
+0001cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf90: 2020 2020 2020 6375 7272 656e 746e 6574        currentnet
+0001cfa0: 7320 3d20 6375 7272 656e 7476 6d5b 276e  s = currentvm['n
+0001cfb0: 6574 7327 5d0a 2020 2020 2020 2020 2020  ets'].          
+0001cfc0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001cfd0: 7272 656e 7464 6973 6b73 203d 2063 7572  rrentdisks = cur
+0001cfe0: 7265 6e74 766d 5b27 6469 736b 7327 5d0a  rentvm['disks'].
 0001cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d000: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001d010: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d030: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-0001d040: 6622 536b 7070 696e 6720 7772 6f6e 6720  f"Skpping wrong 
-0001d050: 6e69 6320 7370 6563 2066 6f72 207b 6e61  nic spec for {na
-0001d060: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d080: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001d090: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0b0: 2020 2020 2020 2020 2020 207a 2e61 6464             z.add
-0001d0c0: 5f6e 6963 286e 616d 652c 206e 6574 776f  _nic(name, netwo
-0001d0d0: 726b 290a 2020 2020 2020 2020 2020 2020  rk).            
-0001d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0f0: 6966 206c 656e 2863 7572 7265 6e74 6e65  if len(currentne
-0001d100: 7473 2920 3e20 6c65 6e28 7072 6f66 696c  ts) > len(profil
-0001d110: 655b 276e 6574 7327 5d29 3a0a 2020 2020  e['nets']):.    
+0001d000: 2020 2020 2020 2020 6375 7272 656e 7466          currentf
+0001d010: 6c61 766f 7220 3d20 6375 7272 656e 7476  lavor = currentv
+0001d020: 6d2e 6765 7428 2766 6c61 766f 7227 290a  m.get('flavor').
+0001d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d040: 2020 2020 2020 2020 6966 2027 6175 746f          if 'auto
+0001d050: 7374 6172 7427 2069 6e20 7072 6f66 696c  start' in profil
+0001d060: 6520 616e 6420 6375 7272 656e 7473 7461  e and currentsta
+0001d070: 7274 2021 3d20 7072 6f66 696c 655b 2761  rt != profile['a
+0001d080: 7574 6f73 7461 7274 275d 3a0a 2020 2020  utostart']:.    
+0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0a0: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
+0001d0b0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0d0: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
+0001d0e0: 7469 6e67 2061 7574 6f73 7461 7274 206f  ting autostart o
+0001d0f0: 6620 7b6e 616d 657d 2074 6f20 7b70 726f  f {name} to {pro
+0001d100: 6669 6c65 5b27 6175 746f 7374 6172 7427  file['autostart'
+0001d110: 5d7d 2229 0a20 2020 2020 2020 2020 2020  ]}").           
 0001d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d130: 2020 2020 2020 2020 2020 2020 7570 6461              upda
-0001d140: 7465 6420 3d20 5472 7565 0a20 2020 2020  ted = True.     
-0001d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d160: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001d170: 7428 6622 5265 6d6f 7669 6e67 204e 6963  t(f"Removing Nic
-0001d180: 7320 6f66 207b 6e61 6d65 7d22 290a 2020  s of {name}").  
-0001d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001d1b0: 7220 6e65 7420 696e 2072 616e 6765 286c  r net in range(l
-0001d1c0: 656e 2863 7572 7265 6e74 6e65 7473 292c  en(currentnets),
-0001d1d0: 206c 656e 2870 726f 6669 6c65 5b27 6e65   len(profile['ne
-0001d1e0: 7473 275d 292c 202d 3129 3a0a 2020 2020  ts']), -1):.    
-0001d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d210: 696e 7465 7266 6163 6520 3d20 6622 6574  interface = f"et
-0001d220: 687b 6e65 7420 2d31 7d22 0a20 2020 2020  h{net -1}".     
-0001d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d240: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-0001d250: 2e64 656c 6574 655f 6e69 6328 6e61 6d65  .delete_nic(name
-0001d260: 2c20 696e 7465 7266 6163 6529 0a20 2020  , interface).   
-0001d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d280: 2020 2020 2069 6620 6f76 6572 7269 6465       if override
-0001d290: 732e 6765 7428 2773 6b69 705f 6669 6c65  s.get('skip_file
-0001d2a0: 735f 7265 6d65 6469 6174 696f 6e27 2c20  s_remediation', 
-0001d2b0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-0001d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2d0: 2020 2020 7070 7269 6e74 2866 2253 6b69      pprint(f"Ski
-0001d2e0: 7070 696e 6720 5265 6d65 6469 6174 696f  pping Remediatio
-0001d2f0: 6e20 6669 6c65 7320 6f66 207b 6e61 6d65  n files of {name
-0001d300: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001d310: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0001d320: 2073 656c 662e 7265 6d65 6469 6174 655f   self.remediate_
-0001d330: 6669 6c65 7328 6e61 6d65 2c20 7072 6f66  files(name, prof
-0001d340: 696c 652e 6765 7428 2766 696c 6573 272c  ile.get('files',
-0001d350: 205b 5d29 2c20 6f76 6572 7269 6465 732c   []), overrides,
-0001d360: 2069 6e70 7574 6469 723d 696e 7075 7464   inputdir=inputd
-0001d370: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
+0001d130: 207a 2e75 7064 6174 655f 7374 6172 7428   z.update_start(
+0001d140: 6e61 6d65 2c20 7072 6f66 696c 655b 2761  name, profile['a
+0001d150: 7574 6f73 7461 7274 275d 290a 2020 2020  utostart']).    
+0001d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d170: 2020 2020 6966 2027 666c 6176 6f72 2720      if 'flavor' 
+0001d180: 696e 2070 726f 6669 6c65 2061 6e64 2063  in profile and c
+0001d190: 7572 7265 6e74 666c 6176 6f72 2021 3d20  urrentflavor != 
+0001d1a0: 7072 6f66 696c 655b 2766 6c61 766f 7227  profile['flavor'
+0001d1b0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0001d1c0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0001d1d0: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
+0001d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1f0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+0001d200: 2866 2255 7064 6174 696e 6720 666c 6176  (f"Updating flav
+0001d210: 6f72 206f 6620 7b6e 616d 657d 2074 6f20  or of {name} to 
+0001d220: 7b70 726f 6669 6c65 5b27 666c 6176 6f72  {profile['flavor
+0001d230: 275d 7d22 290a 2020 2020 2020 2020 2020  ']}").          
+0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d250: 2020 7a2e 7570 6461 7465 5f66 6c61 766f    z.update_flavo
+0001d260: 7228 6e61 6d65 2c20 7072 6f66 696c 655b  r(name, profile[
+0001d270: 2766 6c61 766f 7227 5d29 0a20 2020 2020  'flavor']).     
+0001d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d290: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2b0: 2020 2020 2069 6620 276d 656d 6f72 7927       if 'memory'
+0001d2c0: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
+0001d2d0: 6375 7272 656e 746d 656d 6f72 7920 213d  currentmemory !=
+0001d2e0: 2070 726f 6669 6c65 5b27 6d65 6d6f 7279   profile['memory
+0001d2f0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+0001d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d310: 2020 2020 7570 6461 7465 6420 3d20 5472      updated = Tr
+0001d320: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0001d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d340: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
+0001d350: 7469 6e67 206d 656d 6f72 7920 6f66 207b  ting memory of {
+0001d360: 6e61 6d65 7d20 746f 207b 7072 6f66 696c  name} to {profil
+0001d370: 655b 276d 656d 6f72 7927 5d7d 2229 0a20  e['memory']}"). 
 0001d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d390: 2075 7064 6174 6564 203d 2054 7275 650a   updated = True.
-0001d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3b0: 2020 2020 2020 2020 6966 206e 6f74 2075          if not u
-0001d3c0: 7064 6174 6564 3a0a 2020 2020 2020 2020  pdated:.        
+0001d390: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+0001d3a0: 2e75 7064 6174 655f 6d65 6d6f 7279 286e  .update_memory(n
+0001d3b0: 616d 652c 2070 726f 6669 6c65 5b27 6d65  ame, profile['me
+0001d3c0: 6d6f 7279 275d 290a 2020 2020 2020 2020  mory']).        
 0001d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3e0: 2020 2020 7070 7269 6e74 2866 227b 6e61      pprint(f"{na
-0001d3f0: 6d65 7d20 736b 6970 7065 6420 6f6e 207b  me} skipped on {
-0001d400: 766d 636c 6965 6e74 7d21 2229 0a20 2020  vmclient}!").   
-0001d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d420: 2065 7869 7374 696e 6776 6d73 2e61 7070   existingvms.app
-0001d430: 656e 6428 6e61 6d65 290a 2020 2020 2020  end(name).      
-0001d440: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001d450: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-0001d460: 2020 2020 2020 2073 6861 7265 646b 6579         sharedkey
-0001d470: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0001d480: 7368 6172 6564 6b65 7927 2c20 7365 6c66  sharedkey', self
-0001d490: 2e73 6861 7265 646b 6579 290a 2020 2020  .sharedkey).    
-0001d4a0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001d4b0: 6861 7265 646b 6579 3a0a 2020 2020 2020  haredkey:.      
-0001d4c0: 2020 2020 2020 2020 2020 2020 2020 766d                vm
-0001d4d0: 636f 756e 7465 7220 2b3d 2031 0a20 2020  counter += 1.   
-0001d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d4f0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-0001d500: 6578 6973 7473 2866 227b 706c 616e 7d2e  exists(f"{plan}.
-0001d510: 6b65 7922 2920 6f72 206e 6f74 206f 732e  key") or not os.
-0001d520: 7061 7468 2e65 7869 7374 7328 6622 7b70  path.exists(f"{p
-0001d530: 6c61 6e7d 2e6b 6579 2e70 7562 2229 3a0a  lan}.key.pub"):.
-0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d550: 2020 2020 2020 2020 6f73 2e73 7973 7465          os.syste
-0001d560: 6d28 6622 7373 682d 6b65 7967 656e 202d  m(f"ssh-keygen -
-0001d570: 7174 2072 7361 202d 4e20 2727 202d 6620  qt rsa -N '' -f 
-0001d580: 7b70 6c61 6e7d 2e6b 6579 2229 0a20 2020  {plan}.key").   
-0001d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5a0: 2070 7562 6c69 636b 6579 203d 206f 7065   publickey = ope
-0001d5b0: 6e28 6622 7b70 6c61 6e7d 2e6b 6579 2e70  n(f"{plan}.key.p
-0001d5c0: 7562 2229 2e72 6561 6428 292e 7374 7269  ub").read().stri
-0001d5d0: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-0001d5e0: 2020 2020 2020 2020 7072 6976 6174 656b          privatek
-0001d5f0: 6579 203d 206f 7065 6e28 6622 7b70 6c61  ey = open(f"{pla
-0001d600: 6e7d 2e6b 6579 2229 2e72 6561 6428 292e  n}.key").read().
-0001d610: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-0001d620: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-0001d630: 6b65 7973 2720 6e6f 7420 696e 2070 726f  keys' not in pro
-0001d640: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-0001d650: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001d660: 6f66 696c 655b 276b 6579 7327 5d20 3d20  ofile['keys'] = 
-0001d670: 5b70 7562 6c69 636b 6579 5d0a 2020 2020  [publickey].    
+0001d3e0: 2020 2020 6966 2027 6e75 6d63 7075 7327      if 'numcpus'
+0001d3f0: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
+0001d400: 6375 7272 656e 7463 7075 7320 213d 2070  currentcpus != p
+0001d410: 726f 6669 6c65 5b27 6e75 6d63 7075 7327  rofile['numcpus'
+0001d420: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0001d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d440: 2020 2075 7064 6174 6564 203d 2054 7275     updated = Tru
+0001d450: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d470: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
+0001d480: 696e 6720 6370 7573 206f 6620 7b6e 616d  ing cpus of {nam
+0001d490: 657d 2074 6f20 7b70 726f 6669 6c65 5b27  e} to {profile['
+0001d4a0: 6e75 6d63 7075 7327 5d7d 2229 0a20 2020  numcpus']}").   
+0001d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4c0: 2020 2020 2020 2020 2020 2020 207a 2e75               z.u
+0001d4d0: 7064 6174 655f 6370 7573 286e 616d 652c  pdate_cpus(name,
+0001d4e0: 2070 726f 6669 6c65 5b27 6e75 6d63 7075   profile['numcpu
+0001d4f0: 7327 5d29 0a20 2020 2020 2020 2020 2020  s']).           
+0001d500: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001d510: 2764 6973 6b73 2720 696e 2070 726f 6669  'disks' in profi
+0001d520: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d540: 6966 206c 656e 2863 7572 7265 6e74 6469  if len(currentdi
+0001d550: 736b 7329 203c 206c 656e 2870 726f 6669  sks) < len(profi
+0001d560: 6c65 5b27 6469 736b 7327 5d29 3a0a 2020  le['disks']):.  
+0001d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d580: 2020 2020 2020 2020 2020 2020 2020 7570                up
+0001d590: 6461 7465 6420 3d20 5472 7565 0a20 2020  dated = True.   
+0001d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5b0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001d5c0: 696e 7428 6622 4164 6469 6e67 2044 6973  int(f"Adding Dis
+0001d5d0: 6b73 2074 6f20 7b6e 616d 657d 2229 0a20  ks to {name}"). 
+0001d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001d600: 6f72 2064 6973 6b20 696e 2070 726f 6669  or disk in profi
+0001d610: 6c65 5b27 6469 736b 7327 5d5b 6c65 6e28  le['disks'][len(
+0001d620: 6375 7272 656e 7464 6973 6b73 293a 5d3a  currentdisks):]:
+0001d630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d650: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0001d660: 6365 2864 6973 6b2c 2069 6e74 293a 0a20  ce(disk, int):. 
+0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d690: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001d6a0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001d6b0: 6f66 696c 655b 276b 6579 7327 5d2e 6170  ofile['keys'].ap
-0001d6c0: 7065 6e64 2870 7562 6c69 636b 6579 290a  pend(publickey).
-0001d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6e0: 2020 2020 6966 2027 6669 6c65 7327 2069      if 'files' i
-0001d6f0: 6e20 7072 6f66 696c 653a 0a20 2020 2020  n profile:.     
-0001d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d710: 2020 2070 726f 6669 6c65 5b27 6669 6c65     profile['file
-0001d720: 7327 5d2e 6170 7065 6e64 287b 2770 6174  s'].append({'pat
-0001d730: 6827 3a20 272f 726f 6f74 2f2e 7373 682f  h': '/root/.ssh/
-0001d740: 6964 5f72 7361 272c 2027 636f 6e74 656e  id_rsa', 'conten
-0001d750: 7427 3a20 7072 6976 6174 656b 6579 7d29  t': privatekey})
-0001d760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d770: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
-0001d780: 5b27 6669 6c65 7327 5d2e 6170 7065 6e64  ['files'].append
-0001d790: 287b 2770 6174 6827 3a20 272f 726f 6f74  ({'path': '/root
-0001d7a0: 2f2e 7373 682f 6964 5f72 7361 2e70 7562  /.ssh/id_rsa.pub
-0001d7b0: 272c 2027 636f 6e74 656e 7427 3a20 7075  ', 'content': pu
-0001d7c0: 626c 6963 6b65 797d 290a 2020 2020 2020  blickey}).      
-0001d7d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001d7e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001d7f0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
-0001d800: 696c 655b 2766 696c 6573 275d 203d 205b  ile['files'] = [
-0001d810: 7b27 7061 7468 273a 2027 2f72 6f6f 742f  {'path': '/root/
-0001d820: 2e73 7368 2f69 645f 7273 6127 2c20 2763  .ssh/id_rsa', 'c
-0001d830: 6f6e 7465 6e74 273a 2070 7269 7661 7465  ontent': private
-0001d840: 6b65 797d 2c0a 2020 2020 2020 2020 2020  key},.          
-0001d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d870: 2020 7b27 7061 7468 273a 2027 2f72 6f6f    {'path': '/roo
-0001d880: 742f 2e73 7368 2f69 645f 7273 612e 7075  t/.ssh/id_rsa.pu
-0001d890: 6227 2c20 2763 6f6e 7465 6e74 273a 2070  b', 'content': p
-0001d8a0: 7562 6c69 636b 6579 7d5d 0a20 2020 2020  ublickey}].     
-0001d8b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d8c0: 6620 766d 636f 756e 7465 7220 3e3d 206c  f vmcounter >= l
-0001d8d0: 656e 2876 6d65 6e74 7269 6573 293a 0a20  en(vmentries):. 
+0001d690: 2020 2020 2020 2073 697a 6520 3d20 6469         size = di
+0001d6a0: 736b 0a20 2020 2020 2020 2020 2020 2020  sk.             
+0001d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6c0: 2020 2020 2020 2020 2020 2070 6f6f 6c20             pool 
+0001d6d0: 3d20 7365 6c66 2e70 6f6f 6c0a 2020 2020  = self.pool.    
+0001d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d700: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0001d710: 6469 736b 2c20 7374 7229 2061 6e64 2064  disk, str) and d
+0001d720: 6973 6b2e 6973 6469 6769 7428 293a 0a20  isk.isdigit():. 
+0001d730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d750: 2020 2020 2020 2073 697a 6520 3d20 696e         size = in
+0001d760: 7428 6469 736b 290a 2020 2020 2020 2020  t(disk).        
+0001d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d790: 706f 6f6c 203d 2073 656c 662e 706f 6f6c  pool = self.pool
+0001d7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7c0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0001d7d0: 616e 6365 2864 6973 6b2c 2064 6963 7429  ance(disk, dict)
+0001d7e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d800: 2020 2020 2020 2020 2020 7369 7a65 203d            size =
+0001d810: 2064 6973 6b2e 6765 7428 2773 697a 6527   disk.get('size'
+0001d820: 2c20 7365 6c66 2e64 6973 6b73 697a 6529  , self.disksize)
+0001d830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d850: 2020 2020 2020 2020 2070 6f6f 6c20 3d20           pool = 
+0001d860: 6469 736b 2e67 6574 2827 706f 6f6c 272c  disk.get('pool',
+0001d870: 2073 656c 662e 706f 6f6c 290a 2020 2020   self.pool).    
+0001d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001d8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001d8d0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
 0001d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8f0: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-0001d900: 2866 227b 706c 616e 7d2e 6b65 792e 7075  (f"{plan}.key.pu
-0001d910: 6222 290a 2020 2020 2020 2020 2020 2020  b").            
-0001d920: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-0001d930: 656d 6f76 6528 6622 7b70 6c61 6e7d 2e6b  emove(f"{plan}.k
-0001d940: 6579 2229 0a20 2020 2020 2020 2020 2020  ey").           
-0001d950: 2020 2020 2063 7572 7265 6e74 6f76 6572       currentover
-0001d960: 7269 6465 7320 3d20 6f76 6572 7269 6465  rides = override
-0001d970: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
-0001d980: 2020 2020 2020 2020 2069 6620 2769 6d61           if 'ima
-0001d990: 6765 2720 696e 2070 726f 6669 6c65 3a0a  ge' in profile:.
+0001d8f0: 2020 2020 2020 2020 2020 207a 2e61 6464             z.add
+0001d900: 5f64 6973 6b28 6e61 6d65 3d6e 616d 652c  _disk(name=name,
+0001d910: 2073 697a 653d 7369 7a65 2c20 706f 6f6c   size=size, pool
+0001d920: 3d70 6f6f 6c29 0a20 2020 2020 2020 2020  =pool).         
+0001d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d940: 2020 2069 6620 6c65 6e28 6375 7272 656e     if len(curren
+0001d950: 7464 6973 6b73 2920 3e20 6c65 6e28 7072  tdisks) > len(pr
+0001d960: 6f66 696c 655b 2764 6973 6b73 275d 293a  ofile['disks']):
+0001d970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d990: 2075 7064 6174 6564 203d 2054 7275 650a   updated = True.
 0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9b0: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
-0001d9c0: 2073 656c 662e 6c69 7374 5f70 726f 6669   self.list_profi
-0001d9d0: 6c65 7328 293a 0a20 2020 2020 2020 2020  les():.         
-0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001d9f0: 7572 7265 6e74 696d 6167 6520 3d20 7072  urrentimage = pr
-0001da00: 6f66 696c 655b 2769 6d61 6765 275d 0a20  ofile['image']. 
-0001da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da20: 2020 2020 2020 2065 6e74 7279 7072 6f66         entryprof
-0001da30: 696c 6520 3d20 656e 7472 795b 305d 0a20  ile = entry[0]. 
-0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da50: 2020 2020 2020 2069 6620 656e 7472 7970         if entryp
-0001da60: 726f 6669 6c65 203d 3d20 6375 7272 656e  rofile == curren
-0001da70: 7469 6d61 6765 3a0a 2020 2020 2020 2020  timage:.        
-0001da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da90: 2020 2020 7072 6f66 696c 655b 2769 6d61      profile['ima
-0001daa0: 6765 275d 203d 2065 6e74 7279 5b34 5d0a  ge'] = entry[4].
-0001dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dac0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001dad0: 656e 746f 7665 7272 6964 6573 5b27 696d  entoverrides['im
-0001dae0: 6167 6527 5d20 3d20 7072 6f66 696c 655b  age'] = profile[
-0001daf0: 2769 6d61 6765 275d 0a20 2020 2020 2020  'image'].       
-0001db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db10: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-0001db20: 2020 2020 2020 2020 2020 2069 6620 7468             if th
-0001db30: 7265 6164 6564 3a0a 2020 2020 2020 2020  readed:.        
-0001db40: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0001db50: 6172 6773 203d 2028 6e61 6d65 2c20 7072  args = (name, pr
-0001db60: 6f66 696c 656e 616d 652c 2063 7572 7265  ofilename, curre
-0001db70: 6e74 6f76 6572 7269 6465 732c 2070 726f  ntoverrides, pro
-0001db80: 6669 6c65 2c20 7a2c 2070 6c61 6e2c 2063  file, z, plan, c
-0001db90: 7572 7265 6e74 706c 616e 6469 722c 2076  urrentplandir, v
-0001dba0: 6d63 6c69 656e 742c 0a20 2020 2020 2020  mclient,.       
-0001dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbc0: 2020 2020 2020 2020 206f 6e66 6c79 2c20           onfly, 
-0001dbd0: 6f6e 6c79 6173 7365 7473 2c20 6e65 7776  onlyassets, newv
-0001dbe0: 6d73 2c20 6661 696c 6564 766d 732c 2061  ms, failedvms, a
-0001dbf0: 7379 6e63 7761 6974 766d 732c 206e 6577  syncwaitvms, new
-0001dc00: 6173 7365 7473 290a 2020 2020 2020 2020  assets).        
-0001dc10: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
-0001dc20: 7468 7265 6164 696e 672e 5468 7265 6164  threading.Thread
-0001dc30: 2874 6172 6765 743d 7365 6c66 2e74 6872  (target=self.thr
-0001dc40: 6561 6465 645f 6372 6561 7465 5f76 6d2c  eaded_create_vm,
-0001dc50: 2061 7267 733d 6e65 775f 6172 6773 290a   args=new_args).
-0001dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc70: 2020 2020 7468 7265 6164 732e 6170 7065      threads.appe
-0001dc80: 6e64 2874 290a 2020 2020 2020 2020 2020  nd(t).          
-0001dc90: 2020 2020 2020 2020 2020 742e 7374 6172            t.star
-0001dca0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-0001dcb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001dcc0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001dcd0: 7375 6c74 203d 2073 656c 662e 6372 6561  sult = self.crea
-0001dce0: 7465 5f76 6d28 6e61 6d65 2c20 7072 6f66  te_vm(name, prof
-0001dcf0: 696c 656e 616d 652c 206f 7665 7272 6964  ilename, overrid
-0001dd00: 6573 3d63 7572 7265 6e74 6f76 6572 7269  es=currentoverri
-0001dd10: 6465 732c 2063 7573 746f 6d70 726f 6669  des, customprofi
-0001dd20: 6c65 3d70 726f 6669 6c65 2c20 6b3d 7a2c  le=profile, k=z,
-0001dd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9c0: 7070 7269 6e74 2866 2252 656d 6f76 696e  pprint(f"Removin
+0001d9d0: 6720 4469 736b 7320 6f66 207b 6e61 6d65  g Disks of {name
+0001d9e0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da00: 2020 2020 666f 7220 6469 736b 2069 6e20      for disk in 
+0001da10: 6375 7272 656e 7464 6973 6b73 5b6c 656e  currentdisks[len
+0001da20: 2863 7572 7265 6e74 6469 736b 7329 202d  (currentdisks) -
+0001da30: 206c 656e 2870 726f 6669 6c65 5b27 6469   len(profile['di
+0001da40: 736b 7327 5d29 3a5d 3a0a 2020 2020 2020  sks']):]:.      
+0001da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da60: 2020 2020 2020 2020 2020 2020 2020 6469                di
+0001da70: 736b 6e61 6d65 203d 206f 732e 7061 7468  skname = os.path
+0001da80: 2e62 6173 656e 616d 6528 6469 736b 5b27  .basename(disk['
+0001da90: 7061 7468 275d 290a 2020 2020 2020 2020  path']).        
+0001daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dab0: 2020 2020 2020 2020 2020 2020 6469 736b              disk
+0001dac0: 706f 6f6c 203d 206f 732e 7061 7468 2e64  pool = os.path.d
+0001dad0: 6972 6e61 6d65 2864 6973 6b5b 2770 6174  irname(disk['pat
+0001dae0: 6827 5d29 0a20 2020 2020 2020 2020 2020  h']).           
+0001daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db00: 2020 2020 2020 2020 207a 2e64 656c 6574           z.delet
+0001db10: 655f 6469 736b 286e 616d 653d 6e61 6d65  e_disk(name=name
+0001db20: 2c20 6469 736b 6e61 6d65 3d64 6973 6b6e  , diskname=diskn
+0001db30: 616d 652c 2070 6f6f 6c3d 6469 736b 706f  ame, pool=diskpo
+0001db40: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
+0001db50: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0001db60: 6e65 7473 2720 696e 2070 726f 6669 6c65  nets' in profile
+0001db70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001db80: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001db90: 206c 656e 2863 7572 7265 6e74 6e65 7473   len(currentnets
+0001dba0: 2920 3c20 6c65 6e28 7072 6f66 696c 655b  ) < len(profile[
+0001dbb0: 276e 6574 7327 5d29 3a0a 2020 2020 2020  'nets']):.      
+0001dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbd0: 2020 2020 2020 2020 2020 7570 6461 7465            update
+0001dbe0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc00: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0001dc10: 6622 4164 6469 6e67 204e 6963 7320 746f  f"Adding Nics to
+0001dc20: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+0001dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc40: 2020 2020 2020 2020 2020 666f 7220 6e65            for ne
+0001dc50: 7420 696e 2070 726f 6669 6c65 5b27 6e65  t in profile['ne
+0001dc60: 7473 275d 5b6c 656e 2863 7572 7265 6e74  ts'][len(current
+0001dc70: 6e65 7473 293a 5d3a 0a20 2020 2020 2020  nets):]:.       
+0001dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001dca0: 6973 696e 7374 616e 6365 286e 6574 2c20  isinstance(net, 
+0001dcb0: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
+0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcd0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001dce0: 7477 6f72 6b20 3d20 6e65 740a 2020 2020  twork = net.    
+0001dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd10: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0001dd20: 6e65 742c 2064 6963 7429 2061 6e64 2027  net, dict) and '
+0001dd30: 6e61 6d65 2720 696e 206e 6574 3a0a 2020  name' in net:.  
 0001dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd50: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
-0001dd60: 6e3d 706c 616e 2c20 6261 7365 6469 723d  n=plan, basedir=
-0001dd70: 6375 7272 656e 7470 6c61 6e64 6972 2c20  currentplandir, 
-0001dd80: 636c 6965 6e74 3d76 6d63 6c69 656e 742c  client=vmclient,
-0001dd90: 206f 6e66 6c79 3d6f 6e66 6c79 2c0a 2020   onfly=onfly,.  
-0001dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd60: 2020 2020 2020 6e65 7477 6f72 6b20 3d20        network = 
+0001dd70: 6e65 745b 276e 616d 6527 5d0a 2020 2020  net['name'].    
+0001dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dda0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
 0001ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddc0: 2020 2020 2020 2020 2020 6f6e 6c79 6173            onlyas
-0001ddd0: 7365 7473 3d6f 6e6c 7961 7373 6574 7329  sets=onlyassets)
-0001dde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ddf0: 2020 2020 2069 6620 6e6f 7420 6f6e 6c79       if not only
-0001de00: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
+0001ddc0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+0001ddd0: 726f 7228 6622 536b 7070 696e 6720 7772  ror(f"Skpping wr
+0001dde0: 6f6e 6720 6e69 6320 7370 6563 2066 6f72  ong nic spec for
+0001ddf0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+0001de00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001de10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de20: 636f 6d6d 6f6e 2e68 616e 646c 655f 7265  common.handle_re
-0001de30: 7370 6f6e 7365 2872 6573 756c 742c 206e  sponse(result, n
-0001de40: 616d 652c 2063 6c69 656e 743d 766d 636c  ame, client=vmcl
-0001de50: 6965 6e74 290a 2020 2020 2020 2020 2020  ient).          
-0001de60: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
-0001de70: 616e 646c 655f 766d 5f72 6573 756c 7428  andle_vm_result(
-0001de80: 6e61 6d65 2c20 7072 6f66 696c 652c 2072  name, profile, r
-0001de90: 6573 756c 743d 7265 7375 6c74 2c20 6e65  esult=result, ne
-0001dea0: 7776 6d73 3d6e 6577 766d 732c 2066 6169  wvms=newvms, fai
-0001deb0: 6c65 6476 6d73 3d66 6169 6c65 6476 6d73  ledvms=failedvms
-0001dec0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dee0: 2020 2020 2020 2020 2020 2020 6173 796e              asyn
-0001def0: 6377 6169 7476 6d73 3d61 7379 6e63 7761  cwaitvms=asyncwa
-0001df00: 6974 766d 732c 206f 6e6c 7961 7373 6574  itvms, onlyasset
-0001df10: 733d 6f6e 6c79 6173 7365 7473 2c20 6e65  s=onlyassets, ne
-0001df20: 7761 7373 6574 733d 6e65 7761 7373 6574  wassets=newasset
-0001df30: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df50: 2020 2020 2020 2020 2020 2020 2076 6d63               vmc
-0001df60: 6c69 656e 743d 766d 636c 6965 6e74 290a  lient=vmclient).
-0001df70: 2020 2020 2020 2020 6966 2076 6d65 6e74          if vment
-0001df80: 7269 6573 2061 6e64 2074 6872 6561 6465  ries and threade
-0001df90: 643a 0a20 2020 2020 2020 2020 2020 2077  d:.            w
-0001dfa0: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
-0001dfb0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0001dfc0: 6e64 6578 2c20 7420 696e 2065 6e75 6d65  ndex, t in enume
-0001dfd0: 7261 7465 2874 6872 6561 6473 293a 0a20  rate(threads):. 
-0001dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dff0: 2020 2069 6620 6e6f 7420 742e 6973 5f61     if not t.is_a
-0001e000: 6c69 7665 2829 3a0a 2020 2020 2020 2020  live():.        
-0001e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e020: 6465 6c20 7468 7265 6164 735b 696e 6465  del threads[inde
-0001e030: 785d 0a20 2020 2020 2020 2020 2020 2020  x].             
-0001e040: 2020 2069 6620 6e6f 7420 7468 7265 6164     if not thread
-0001e050: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001e060: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-0001e070: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001e080: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001e090: 2020 2020 2020 2073 6c65 6570 2831 290a         sleep(1).
-0001e0a0: 2020 2020 2020 2020 6966 2076 6d63 6c69          if vmcli
-0001e0b0: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-0001e0c0: 2020 7961 6d6c 2e73 6166 655f 6475 6d70    yaml.safe_dump
-0001e0d0: 2876 6d63 6c69 656e 7473 2c20 6f70 656e  (vmclients, open
-0001e0e0: 286f 732e 7061 7468 2e65 7870 616e 6475  (os.path.expandu
-0001e0f0: 7365 7228 6627 7e2f 2e6b 636c 692f 766d  ser(f'~/.kcli/vm
-0001e100: 636c 6965 6e74 735f 7b70 6c61 6e7d 2729  clients_{plan}')
-0001e110: 2c20 2777 2729 290a 2020 2020 2020 2020  , 'w')).        
-0001e120: 6966 2064 6973 6b65 6e74 7269 6573 2061  if diskentries a
-0001e130: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
-0001e140: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-0001e150: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
-0001e160: 2044 6973 6b73 2e2e 2e22 290a 2020 2020   Disks...").    
-0001e170: 2020 2020 666f 7220 6469 736b 2069 6e20      for disk in 
-0001e180: 6469 736b 656e 7472 6965 733a 0a20 2020  diskentries:.   
-0001e190: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
-0001e1a0: 203d 2065 6e74 7269 6573 5b64 6973 6b5d   = entries[disk]
-0001e1b0: 0a20 2020 2020 2020 2020 2020 2070 6f6f  .            poo
-0001e1c0: 6c20 3d20 7072 6f66 696c 652e 6765 7428  l = profile.get(
-0001e1d0: 2770 6f6f 6c27 290a 2020 2020 2020 2020  'pool').        
-0001e1e0: 2020 2020 766d 7320 3d20 7072 6f66 696c      vms = profil
-0001e1f0: 652e 6765 7428 2776 6d73 2729 0a20 2020  e.get('vms').   
-0001e200: 2020 2020 2020 2020 2074 656d 706c 6174           templat
-0001e210: 6520 3d20 7072 6f66 696c 652e 6765 7428  e = profile.get(
-0001e220: 2774 656d 706c 6174 6527 290a 2020 2020  'template').    
-0001e230: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
-0001e240: 7072 6f66 696c 652e 6765 7428 2769 6d61  profile.get('ima
-0001e250: 6765 272c 2074 656d 706c 6174 6529 0a20  ge', template). 
-0001e260: 2020 2020 2020 2020 2020 2073 697a 6520             size 
-0001e270: 3d20 696e 7428 7072 6f66 696c 652e 6765  = int(profile.ge
-0001e280: 7428 2773 697a 6527 2c20 3130 2929 0a20  t('size', 10)). 
-0001e290: 2020 2020 2020 2020 2020 2069 6620 706f             if po
-0001e2a0: 6f6c 2069 7320 4e6f 6e65 3a0a 2020 2020  ol is None:.    
-0001e2b0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-0001e2c0: 7228 6622 4d69 7373 696e 6720 4b65 7920  r(f"Missing Key 
-0001e2d0: 506f 6f6c 2066 6f72 2064 6973 6b20 7365  Pool for disk se
-0001e2e0: 6374 696f 6e20 7b64 6973 6b7d 2e20 4e6f  ction {disk}. No
-0001e2f0: 7420 6372 6561 7469 6e67 2069 742e 2e2e  t creating it...
-0001e300: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001e310: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001e320: 2020 2020 2020 2020 6966 2076 6d73 2069          if vms i
-0001e330: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0001e340: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-0001e350: 4d69 7373 696e 6720 6f72 2049 6e63 6f72  Missing or Incor
-0001e360: 7265 6374 204b 6579 2056 6d73 2066 6f72  rect Key Vms for
-0001e370: 2064 6973 6b20 7365 6374 696f 6e20 7b64   disk section {d
-0001e380: 6973 6b7d 2e20 4e6f 7420 6372 6561 7469  isk}. Not creati
-0001e390: 6e67 2069 742e 2e2e 2229 0a20 2020 2020  ng it...").     
-0001e3a0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0001e3b0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-0001e3c0: 7368 6172 6561 626c 6520 3d20 5472 7565  shareable = True
-0001e3d0: 2069 6620 6c65 6e28 766d 7329 203e 2031   if len(vms) > 1
-0001e3e0: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
-0001e3f0: 2020 2020 2020 2020 6966 206b 2e64 6973          if k.dis
-0001e400: 6b5f 6578 6973 7473 2870 6f6f 6c2c 2064  k_exists(pool, d
-0001e410: 6973 6b29 3a0a 2020 2020 2020 2020 2020  isk):.          
-0001e420: 2020 2020 2020 7070 7269 6e74 2866 2243        pprint(f"C
-0001e430: 7265 6174 696f 6e20 666f 7220 4469 736b  reation for Disk
-0001e440: 207b 6469 736b 7d20 736b 6970 7065 6421   {disk} skipped!
-0001e450: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001e460: 2020 2070 6f6f 6c70 6174 6820 3d20 6b2e     poolpath = k.
-0001e470: 6765 745f 706f 6f6c 5f70 6174 6828 706f  get_pool_path(po
-0001e480: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
-0001e490: 2020 2020 6e65 7764 6973 6b20 3d20 6622      newdisk = f"
-0001e4a0: 7b70 6f6f 6c70 6174 687d 2f7b 6469 736b  {poolpath}/{disk
-0001e4b0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0001e4c0: 2020 2066 6f72 2076 6d20 696e 2076 6d73     for vm in vms
-0001e4d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001e4e0: 2020 2020 2020 7070 7269 6e74 2866 2241        pprint(f"A
-0001e4f0: 6464 696e 6720 6469 736b 207b 6469 736b  dding disk {disk
-0001e500: 7d20 746f 207b 766d 7d22 290a 2020 2020  } to {vm}").    
-0001e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e520: 6b2e 6164 645f 6469 736b 286e 616d 653d  k.add_disk(name=
-0001e530: 766d 2c20 7369 7a65 3d73 697a 652c 2070  vm, size=size, p
-0001e540: 6f6f 6c3d 706f 6f6c 2c20 696d 6167 653d  ool=pool, image=
-0001e550: 696d 6167 652c 2073 6861 7265 6162 6c65  image, shareable
-0001e560: 3d73 6861 7265 6162 6c65 2c20 6578 6973  =shareable, exis
-0001e570: 7469 6e67 3d6e 6577 6469 736b 2c0a 2020  ting=newdisk,.  
+0001de20: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+0001de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de40: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+0001de50: 2e61 6464 5f6e 6963 286e 616d 652c 206e  .add_nic(name, n
+0001de60: 6574 776f 726b 290a 2020 2020 2020 2020  etwork).        
+0001de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de80: 2020 2020 6966 206c 656e 2863 7572 7265      if len(curre
+0001de90: 6e74 6e65 7473 2920 3e20 6c65 6e28 7072  ntnets) > len(pr
+0001dea0: 6f66 696c 655b 276e 6574 7327 5d29 3a0a  ofile['nets']):.
+0001deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ded0: 7570 6461 7465 6420 3d20 5472 7565 0a20  updated = True. 
+0001dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001def0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001df00: 7072 696e 7428 6622 5265 6d6f 7669 6e67  print(f"Removing
+0001df10: 204e 6963 7320 6f66 207b 6e61 6d65 7d22   Nics of {name}"
+0001df20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df40: 2020 666f 7220 6e65 7420 696e 2072 616e    for net in ran
+0001df50: 6765 286c 656e 2863 7572 7265 6e74 6e65  ge(len(currentne
+0001df60: 7473 292c 206c 656e 2870 726f 6669 6c65  ts), len(profile
+0001df70: 5b27 6e65 7473 275d 292c 202d 3129 3a0a  ['nets']), -1):.
+0001df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfa0: 2020 2020 696e 7465 7266 6163 6520 3d20      interface = 
+0001dfb0: 6622 6574 687b 6e65 7420 2d31 7d22 0a20  f"eth{net -1}". 
+0001dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfe0: 2020 207a 2e64 656c 6574 655f 6e69 6328     z.delete_nic(
+0001dff0: 6e61 6d65 2c20 696e 7465 7266 6163 6529  name, interface)
+0001e000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e010: 2020 2020 2020 2020 2069 6620 6f76 6572           if over
+0001e020: 7269 6465 732e 6765 7428 2773 6b69 705f  rides.get('skip_
+0001e030: 6669 6c65 735f 7265 6d65 6469 6174 696f  files_remediatio
+0001e040: 6e27 2c20 4661 6c73 6529 3a0a 2020 2020  n', False):.    
+0001e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e060: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001e070: 2253 6b69 7070 696e 6720 5265 6d65 6469  "Skipping Remedi
+0001e080: 6174 696f 6e20 6669 6c65 7320 6f66 207b  ation files of {
+0001e090: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+0001e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0b0: 656c 6966 2073 656c 662e 7265 6d65 6469  elif self.remedi
+0001e0c0: 6174 655f 6669 6c65 7328 6e61 6d65 2c20  ate_files(name, 
+0001e0d0: 7072 6f66 696c 652e 6765 7428 2766 696c  profile.get('fil
+0001e0e0: 6573 272c 205b 5d29 2c20 6f76 6572 7269  es', []), overri
+0001e0f0: 6465 732c 2069 6e70 7574 6469 723d 696e  des, inputdir=in
+0001e100: 7075 7464 6972 293a 0a20 2020 2020 2020  putdir):.       
+0001e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e120: 2020 2020 2075 7064 6174 6564 203d 2054       updated = T
+0001e130: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0001e140: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001e150: 6f74 2075 7064 6174 6564 3a0a 2020 2020  ot updated:.    
+0001e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e170: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001e180: 227b 6e61 6d65 7d20 736b 6970 7065 6420  "{name} skipped 
+0001e190: 6f6e 207b 766d 636c 6965 6e74 7d21 2229  on {vmclient}!")
+0001e1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e1b0: 2020 2020 2065 7869 7374 696e 6776 6d73       existingvms
+0001e1c0: 2e61 7070 656e 6428 6e61 6d65 290a 2020  .append(name).  
+0001e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1e0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+0001e1f0: 2020 2020 2020 2020 2020 2073 6861 7265             share
+0001e200: 646b 6579 203d 2070 726f 6669 6c65 2e67  dkey = profile.g
+0001e210: 6574 2827 7368 6172 6564 6b65 7927 2c20  et('sharedkey', 
+0001e220: 7365 6c66 2e73 6861 7265 646b 6579 290a  self.sharedkey).
+0001e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e240: 6966 2073 6861 7265 646b 6579 3a0a 2020  if sharedkey:.  
+0001e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e260: 2020 766d 636f 756e 7465 7220 2b3d 2031    vmcounter += 1
+0001e270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e280: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+0001e290: 6174 682e 6578 6973 7473 2866 227b 706c  ath.exists(f"{pl
+0001e2a0: 616e 7d2e 6b65 7922 2920 6f72 206e 6f74  an}.key") or not
+0001e2b0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0001e2c0: 6622 7b70 6c61 6e7d 2e6b 6579 2e70 7562  f"{plan}.key.pub
+0001e2d0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0001e2e0: 2020 2020 2020 2020 2020 2020 6f73 2e73              os.s
+0001e2f0: 7973 7465 6d28 6622 7373 682d 6b65 7967  ystem(f"ssh-keyg
+0001e300: 656e 202d 7174 2072 7361 202d 4e20 2727  en -qt rsa -N ''
+0001e310: 202d 6620 7b70 6c61 6e7d 2e6b 6579 2229   -f {plan}.key")
+0001e320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e330: 2020 2020 2070 7562 6c69 636b 6579 203d       publickey =
+0001e340: 206f 7065 6e28 6622 7b70 6c61 6e7d 2e6b   open(f"{plan}.k
+0001e350: 6579 2e70 7562 2229 2e72 6561 6428 292e  ey.pub").read().
+0001e360: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+0001e370: 2020 2020 2020 2020 2020 2020 7072 6976              priv
+0001e380: 6174 656b 6579 203d 206f 7065 6e28 6622  atekey = open(f"
+0001e390: 7b70 6c61 6e7d 2e6b 6579 2229 2e72 6561  {plan}.key").rea
+0001e3a0: 6428 292e 7374 7269 7028 290a 2020 2020  d().strip().    
+0001e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3c0: 6966 2027 6b65 7973 2720 6e6f 7420 696e  if 'keys' not in
+0001e3d0: 2070 726f 6669 6c65 3a0a 2020 2020 2020   profile:.      
+0001e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3f0: 2020 7072 6f66 696c 655b 276b 6579 7327    profile['keys'
+0001e400: 5d20 3d20 5b70 7562 6c69 636b 6579 5d0a  ] = [publickey].
+0001e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e420: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e440: 2020 7072 6f66 696c 655b 276b 6579 7327    profile['keys'
+0001e450: 5d2e 6170 7065 6e64 2870 7562 6c69 636b  ].append(publick
+0001e460: 6579 290a 2020 2020 2020 2020 2020 2020  ey).            
+0001e470: 2020 2020 2020 2020 6966 2027 6669 6c65          if 'file
+0001e480: 7327 2069 6e20 7072 6f66 696c 653a 0a20  s' in profile:. 
+0001e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4a0: 2020 2020 2020 2070 726f 6669 6c65 5b27         profile['
+0001e4b0: 6669 6c65 7327 5d2e 6170 7065 6e64 287b  files'].append({
+0001e4c0: 2770 6174 6827 3a20 272f 726f 6f74 2f2e  'path': '/root/.
+0001e4d0: 7373 682f 6964 5f72 7361 272c 2027 636f  ssh/id_rsa', 'co
+0001e4e0: 6e74 656e 7427 3a20 7072 6976 6174 656b  ntent': privatek
+0001e4f0: 6579 7d29 0a20 2020 2020 2020 2020 2020  ey}).           
+0001e500: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0001e510: 6669 6c65 5b27 6669 6c65 7327 5d2e 6170  file['files'].ap
+0001e520: 7065 6e64 287b 2770 6174 6827 3a20 272f  pend({'path': '/
+0001e530: 726f 6f74 2f2e 7373 682f 6964 5f72 7361  root/.ssh/id_rsa
+0001e540: 2e70 7562 272c 2027 636f 6e74 656e 7427  .pub', 'content'
+0001e550: 3a20 7075 626c 6963 6b65 797d 290a 2020  : publickey}).  
+0001e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e570: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
 0001e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e590: 2020 2020 2020 2020 2020 2020 2074 6869               thi
-0001e5a0: 6e3d 4661 6c73 6529 0a20 2020 2020 2020  n=False).       
-0001e5b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001e5c0: 2020 2020 2020 2020 2020 206e 6577 6469             newdi
-0001e5d0: 736b 203d 206b 2e63 7265 6174 655f 6469  sk = k.create_di
-0001e5e0: 736b 2864 6973 6b2c 2073 697a 653d 7369  sk(disk, size=si
-0001e5f0: 7a65 2c20 706f 6f6c 3d70 6f6f 6c2c 2069  ze, pool=pool, i
-0001e600: 6d61 6765 3d69 6d61 6765 2c20 7468 696e  mage=image, thin
-0001e610: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-0001e620: 2020 2020 2020 2020 6966 206e 6577 6469          if newdi
-0001e630: 736b 2069 7320 4e6f 6e65 3a0a 2020 2020  sk is None:.    
+0001e590: 7072 6f66 696c 655b 2766 696c 6573 275d  profile['files']
+0001e5a0: 203d 205b 7b27 7061 7468 273a 2027 2f72   = [{'path': '/r
+0001e5b0: 6f6f 742f 2e73 7368 2f69 645f 7273 6127  oot/.ssh/id_rsa'
+0001e5c0: 2c20 2763 6f6e 7465 6e74 273a 2070 7269  , 'content': pri
+0001e5d0: 7661 7465 6b65 797d 2c0a 2020 2020 2020  vatekey},.      
+0001e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e600: 2020 2020 2020 7b27 7061 7468 273a 2027        {'path': '
+0001e610: 2f72 6f6f 742f 2e73 7368 2f69 645f 7273  /root/.ssh/id_rs
+0001e620: 612e 7075 6227 2c20 2763 6f6e 7465 6e74  a.pub', 'content
+0001e630: 273a 2070 7562 6c69 636b 6579 7d5d 0a20  ': publickey}]. 
 0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e650: 6572 726f 7228 6622 4469 736b 207b 6469  error(f"Disk {di
-0001e660: 736b 7d20 6e6f 7420 6465 706c 6f79 6564  sk} not deployed
-0001e670: 2e20 4974 2077 6f6e 2774 2062 6520 6164  . It won't be ad
-0001e680: 6465 6420 746f 2061 6e79 2076 6d22 290a  ded to any vm").
-0001e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001e6b0: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
-0001e6c0: 2e70 7072 696e 7428 6622 4469 736b 207b  .pprint(f"Disk {
-0001e6d0: 6469 736b 7d20 6465 706c 6f79 6564 2122  disk} deployed!"
-0001e6e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e6f0: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
-0001e700: 766d 733a 0a20 2020 2020 2020 2020 2020  vms:.           
-0001e710: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001e720: 696e 7428 6622 4164 6469 6e67 2064 6973  int(f"Adding dis
-0001e730: 6b20 7b64 6973 6b7d 2074 6f20 7b76 6d7d  k {disk} to {vm}
-0001e740: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001e750: 2020 2020 2020 2020 2020 206b 2e61 6464             k.add
-0001e760: 5f64 6973 6b28 6e61 6d65 3d76 6d2c 2073  _disk(name=vm, s
-0001e770: 697a 653d 7369 7a65 2c20 706f 6f6c 3d70  ize=size, pool=p
-0001e780: 6f6f 6c2c 2069 6d61 6765 3d69 6d61 6765  ool, image=image
-0001e790: 2c20 7368 6172 6561 626c 653d 7368 6172  , shareable=shar
-0001e7a0: 6561 626c 652c 0a20 2020 2020 2020 2020  eable,.         
-0001e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e7c0: 2020 2020 2020 2020 2020 6578 6973 7469            existi
-0001e7d0: 6e67 3d6e 6577 6469 736b 2c20 7468 696e  ng=newdisk, thin
-0001e7e0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-0001e7f0: 6966 2063 6f6e 7461 696e 6572 656e 7472  if containerentr
-0001e800: 6965 7320 616e 6420 6e6f 7420 6f6e 6c79  ies and not only
-0001e810: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
-0001e820: 2020 2020 636f 6e74 203d 204b 636f 6e74      cont = Kcont
-0001e830: 6169 6e65 7263 6f6e 6669 6728 7365 6c66  ainerconfig(self
-0001e840: 2c20 636c 6965 6e74 3d73 656c 662e 636f  , client=self.co
-0001e850: 6e74 6169 6e65 7263 6c69 656e 7429 2e63  ntainerclient).c
-0001e860: 6f6e 740a 2020 2020 2020 2020 2020 2020  ont.            
-0001e870: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
-0001e880: 6720 436f 6e74 6169 6e65 7273 2e2e 2e22  g Containers..."
-0001e890: 290a 2020 2020 2020 2020 2020 2020 6c61  ).            la
-0001e8a0: 6265 6c20 3d20 6622 706c 616e 3d7b 706c  bel = f"plan={pl
-0001e8b0: 616e 7d22 0a20 2020 2020 2020 2020 2020  an}".           
-0001e8c0: 2066 6f72 2063 6f6e 7461 696e 6572 2069   for container i
-0001e8d0: 6e20 636f 6e74 6169 6e65 7265 6e74 7269  n containerentri
-0001e8e0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001e8f0: 2020 2020 6966 2063 6f6e 742e 6578 6973      if cont.exis
-0001e900: 7473 5f63 6f6e 7461 696e 6572 2863 6f6e  ts_container(con
-0001e910: 7461 696e 6572 293a 0a20 2020 2020 2020  tainer):.       
-0001e920: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001e930: 696e 7428 6622 436f 6e74 6169 6e65 7220  int(f"Container 
-0001e940: 7b63 6f6e 7461 696e 6572 7d20 736b 6970  {container} skip
-0001e950: 7065 6421 2229 0a20 2020 2020 2020 2020  ped!").         
-0001e960: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0001e970: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-0001e980: 2020 2020 7072 6f66 696c 6520 3d20 656e      profile = en
-0001e990: 7472 6965 735b 636f 6e74 6169 6e65 725d  tries[container]
-0001e9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e9b0: 2069 6620 2770 726f 6669 6c65 2720 696e   if 'profile' in
-0001e9c0: 2070 726f 6669 6c65 2061 6e64 2070 726f   profile and pro
-0001e9d0: 6669 6c65 5b27 7072 6f66 696c 6527 5d20  file['profile'] 
-0001e9e0: 696e 2063 6f6e 7461 696e 6572 7072 6f66  in containerprof
-0001e9f0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
-0001ea00: 2020 2020 2020 2020 2020 6375 7374 6f6d            custom
-0001ea10: 7072 6f66 696c 6520 3d20 636f 6e74 6169  profile = contai
-0001ea20: 6e65 7270 726f 6669 6c65 735b 7072 6f66  nerprofiles[prof
-0001ea30: 696c 655b 2770 726f 6669 6c65 275d 5d0a  ile['profile']].
-0001ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001ea60: 2020 2020 2020 2020 2020 6375 7374 6f6d            custom
-0001ea70: 7072 6f66 696c 6520 3d20 7b7d 0a20 2020  profile = {}.   
-0001ea80: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001ea90: 7461 696e 6572 696d 6167 6520 3d20 6e65  tainerimage = ne
-0001eaa0: 7874 2828 6520 666f 7220 6520 696e 205b  xt((e for e in [
-0001eab0: 7072 6f66 696c 652e 6765 7428 2769 6d61  profile.get('ima
-0001eac0: 6765 2729 2c20 7072 6f66 696c 652e 6765  ge'), profile.ge
-0001ead0: 7428 2769 6d61 6765 2729 2c0a 2020 2020  t('image'),.    
+0001e650: 2020 2069 6620 766d 636f 756e 7465 7220     if vmcounter 
+0001e660: 3e3d 206c 656e 2876 6d65 6e74 7269 6573  >= len(vmentries
+0001e670: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001e680: 2020 2020 2020 2020 2020 206f 732e 7265             os.re
+0001e690: 6d6f 7665 2866 227b 706c 616e 7d2e 6b65  move(f"{plan}.ke
+0001e6a0: 792e 7075 6222 290a 2020 2020 2020 2020  y.pub").        
+0001e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6c0: 6f73 2e72 656d 6f76 6528 6622 7b70 6c61  os.remove(f"{pla
+0001e6d0: 6e7d 2e6b 6579 2229 0a20 2020 2020 2020  n}.key").       
+0001e6e0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001e6f0: 6f76 6572 7269 6465 7320 3d20 6f76 6572  overrides = over
+0001e700: 7269 6465 732e 636f 7079 2829 0a20 2020  rides.copy().   
+0001e710: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001e720: 2769 6d61 6765 2720 696e 2070 726f 6669  'image' in profi
+0001e730: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0001e740: 2020 2020 2020 2020 666f 7220 656e 7472          for entr
+0001e750: 7920 696e 2073 656c 662e 6c69 7374 5f70  y in self.list_p
+0001e760: 726f 6669 6c65 7328 293a 0a20 2020 2020  rofiles():.     
+0001e770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e780: 2020 2063 7572 7265 6e74 696d 6167 6520     currentimage 
+0001e790: 3d20 7072 6f66 696c 655b 2769 6d61 6765  = profile['image
+0001e7a0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+0001e7b0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+0001e7c0: 7072 6f66 696c 6520 3d20 656e 7472 795b  profile = entry[
+0001e7d0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+0001e7e0: 2020 2020 2020 2020 2020 2069 6620 656e             if en
+0001e7f0: 7472 7970 726f 6669 6c65 203d 3d20 6375  tryprofile == cu
+0001e800: 7272 656e 7469 6d61 6765 3a0a 2020 2020  rrentimage:.    
+0001e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e820: 2020 2020 2020 2020 7072 6f66 696c 655b          profile[
+0001e830: 2769 6d61 6765 275d 203d 2065 6e74 7279  'image'] = entry
+0001e840: 5b34 5d0a 2020 2020 2020 2020 2020 2020  [4].            
+0001e850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e860: 6375 7272 656e 746f 7665 7272 6964 6573  currentoverrides
+0001e870: 5b27 696d 6167 6527 5d20 3d20 7072 6f66  ['image'] = prof
+0001e880: 696c 655b 2769 6d61 6765 275d 0a20 2020  ile['image'].   
+0001e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8a0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0001e8b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001e8c0: 6620 7468 7265 6164 6564 3a0a 2020 2020  f threaded:.    
+0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8e0: 6e65 775f 6172 6773 203d 2028 6e61 6d65  new_args = (name
+0001e8f0: 2c20 7072 6f66 696c 656e 616d 652c 2063  , profilename, c
+0001e900: 7572 7265 6e74 6f76 6572 7269 6465 732c  urrentoverrides,
+0001e910: 2070 726f 6669 6c65 2c20 7a2c 2070 6c61   profile, z, pla
+0001e920: 6e2c 2063 7572 7265 6e74 706c 616e 6469  n, currentplandi
+0001e930: 722c 2076 6d63 6c69 656e 742c 0a20 2020  r, vmclient,.   
+0001e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e950: 2020 2020 2020 2020 2020 2020 206f 6e66               onf
+0001e960: 6c79 2c20 6f6e 6c79 6173 7365 7473 2c20  ly, onlyassets, 
+0001e970: 6e65 7776 6d73 2c20 6661 696c 6564 766d  newvms, failedvm
+0001e980: 732c 2061 7379 6e63 7761 6974 766d 732c  s, asyncwaitvms,
+0001e990: 206e 6577 6173 7365 7473 290a 2020 2020   newassets).    
+0001e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9b0: 7420 3d20 7468 7265 6164 696e 672e 5468  t = threading.Th
+0001e9c0: 7265 6164 2874 6172 6765 743d 7365 6c66  read(target=self
+0001e9d0: 2e74 6872 6561 6465 645f 6372 6561 7465  .threaded_create
+0001e9e0: 5f76 6d2c 2061 7267 733d 6e65 775f 6172  _vm, args=new_ar
+0001e9f0: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
+0001ea00: 2020 2020 2020 2020 7468 7265 6164 732e          threads.
+0001ea10: 6170 7065 6e64 2874 290a 2020 2020 2020  append(t).      
+0001ea20: 2020 2020 2020 2020 2020 2020 2020 742e                t.
+0001ea30: 7374 6172 7428 290a 2020 2020 2020 2020  start().        
+0001ea40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001ea50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea60: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
+0001ea70: 6372 6561 7465 5f76 6d28 6e61 6d65 2c20  create_vm(name, 
+0001ea80: 7072 6f66 696c 656e 616d 652c 206f 7665  profilename, ove
+0001ea90: 7272 6964 6573 3d63 7572 7265 6e74 6f76  rrides=currentov
+0001eaa0: 6572 7269 6465 732c 2063 7573 746f 6d70  errides, customp
+0001eab0: 726f 6669 6c65 3d70 726f 6669 6c65 2c20  rofile=profile, 
+0001eac0: 6b3d 7a2c 0a20 2020 2020 2020 2020 2020  k=z,.           
+0001ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001eb10: 7573 746f 6d70 726f 6669 6c65 2e67 6574  ustomprofile.get
-0001eb20: 2827 696d 6167 6527 292c 0a20 2020 2020  ('image'),.     
-0001eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eaf0: 2070 6c61 6e3d 706c 616e 2c20 6261 7365   plan=plan, base
+0001eb00: 6469 723d 6375 7272 656e 7470 6c61 6e64  dir=currentpland
+0001eb10: 6972 2c20 636c 6965 6e74 3d76 6d63 6c69  ir, client=vmcli
+0001eb20: 656e 742c 206f 6e66 6c79 3d6f 6e66 6c79  ent, onfly=onfly
+0001eb30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0001eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb50: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001eb60: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
-0001eb70: 2769 6d61 6765 2729 5d20 6966 2065 2069  'image')] if e i
-0001eb80: 7320 6e6f 7420 4e6f 6e65 292c 204e 6f6e  s not None), Non
-0001eb90: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001eba0: 2020 206e 6574 7320 3d20 6e65 7874 2828     nets = next((
-0001ebb0: 6520 666f 7220 6520 696e 205b 7072 6f66  e for e in [prof
-0001ebc0: 696c 652e 6765 7428 276e 6574 7327 292c  ile.get('nets'),
-0001ebd0: 2063 7573 746f 6d70 726f 6669 6c65 2e67   customprofile.g
-0001ebe0: 6574 2827 6e65 7473 2729 5d20 6966 2065  et('nets')] if e
-0001ebf0: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
-0001ec00: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-0001ec10: 2020 2020 2070 6f72 7473 203d 206e 6578       ports = nex
-0001ec20: 7428 2865 2066 6f72 2065 2069 6e20 5b70  t((e for e in [p
-0001ec30: 726f 6669 6c65 2e67 6574 2827 706f 7274  rofile.get('port
-0001ec40: 7327 292c 2063 7573 746f 6d70 726f 6669  s'), customprofi
-0001ec50: 6c65 2e67 6574 2827 706f 7274 7327 295d  le.get('ports')]
-0001ec60: 2069 6620 6520 6973 206e 6f74 204e 6f6e   if e is not Non
-0001ec70: 6529 2c20 4e6f 6e65 290a 2020 2020 2020  e), None).      
-0001ec80: 2020 2020 2020 2020 2020 766f 6c75 6d65            volume
-0001ec90: 7320 3d20 6e65 7874 2828 6520 666f 7220  s = next((e for 
-0001eca0: 6520 696e 205b 7072 6f66 696c 652e 6765  e in [profile.ge
-0001ecb0: 7428 2776 6f6c 756d 6573 2729 2c20 7072  t('volumes'), pr
-0001ecc0: 6f66 696c 652e 6765 7428 2764 6973 6b73  ofile.get('disks
-0001ecd0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+0001eb50: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
+0001eb60: 6c79 6173 7365 7473 3d6f 6e6c 7961 7373  lyassets=onlyass
+0001eb70: 6574 7329 0a20 2020 2020 2020 2020 2020  ets).           
+0001eb80: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001eb90: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
+0001eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebb0: 2020 2020 636f 6d6d 6f6e 2e68 616e 646c      common.handl
+0001ebc0: 655f 7265 7370 6f6e 7365 2872 6573 756c  e_response(resul
+0001ebd0: 742c 206e 616d 652c 2063 6c69 656e 743d  t, name, client=
+0001ebe0: 766d 636c 6965 6e74 290a 2020 2020 2020  vmclient).      
+0001ebf0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001ec00: 6c66 2e68 616e 646c 655f 766d 5f72 6573  lf.handle_vm_res
+0001ec10: 756c 7428 6e61 6d65 2c20 7072 6f66 696c  ult(name, profil
+0001ec20: 652c 2072 6573 756c 743d 7265 7375 6c74  e, result=result
+0001ec30: 2c20 6e65 7776 6d73 3d6e 6577 766d 732c  , newvms=newvms,
+0001ec40: 2066 6169 6c65 6476 6d73 3d66 6169 6c65   failedvms=faile
+0001ec50: 6476 6d73 2c0a 2020 2020 2020 2020 2020  dvms,.          
+0001ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec80: 6173 796e 6377 6169 7476 6d73 3d61 7379  asyncwaitvms=asy
+0001ec90: 6e63 7761 6974 766d 732c 206f 6e6c 7961  ncwaitvms, onlya
+0001eca0: 7373 6574 733d 6f6e 6c79 6173 7365 7473  ssets=onlyassets
+0001ecb0: 2c20 6e65 7761 7373 6574 733d 6e65 7761  , newassets=newa
+0001ecc0: 7373 6574 732c 0a20 2020 2020 2020 2020  ssets,.         
+0001ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed00: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
-0001ed10: 7428 2776 6f6c 756d 6573 2729 2c20 6375  t('volumes'), cu
-0001ed20: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
-0001ed30: 2764 6973 6b73 2729 5d0a 2020 2020 2020  'disks')].      
-0001ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed50: 2020 2020 2020 2020 2020 6966 2065 2069            if e i
-0001ed60: 7320 6e6f 7420 4e6f 6e65 292c 204e 6f6e  s not None), Non
-0001ed70: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001ed80: 2020 2065 6e76 6972 6f6e 6d65 6e74 203d     environment =
-0001ed90: 206e 6578 7428 2865 2066 6f72 2065 2069   next((e for e i
-0001eda0: 6e20 5b70 726f 6669 6c65 2e67 6574 2827  n [profile.get('
-0001edb0: 656e 7669 726f 6e6d 656e 7427 292c 2063  environment'), c
-0001edc0: 7573 746f 6d70 726f 6669 6c65 2e67 6574  ustomprofile.get
-0001edd0: 2827 656e 7669 726f 6e6d 656e 7427 295d  ('environment')]
-0001ede0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee00: 2020 2020 2069 6620 6520 6973 206e 6f74       if e is not
-0001ee10: 204e 6f6e 6529 2c20 4e6f 6e65 290a 2020   None), None).  
-0001ee20: 2020 2020 2020 2020 2020 2020 2020 636d                cm
-0001ee30: 6473 203d 206e 6578 7428 2865 2066 6f72  ds = next((e for
-0001ee40: 2065 2069 6e20 5b70 726f 6669 6c65 2e67   e in [profile.g
-0001ee50: 6574 2827 636d 6473 2729 2c20 6375 7374  et('cmds'), cust
-0001ee60: 6f6d 7072 6f66 696c 652e 6765 7428 2763  omprofile.get('c
-0001ee70: 6d64 7327 295d 2069 6620 6520 6973 206e  mds')] if e is n
-0001ee80: 6f74 204e 6f6e 6529 2c20 5b5d 290a 2020  ot None), []).  
-0001ee90: 2020 2020 2020 2020 2020 2020 2020 7375                su
-0001eea0: 6363 6573 7328 6622 436f 6e74 6169 6e65  ccess(f"Containe
-0001eeb0: 7220 7b63 6f6e 7461 696e 6572 7dc2 a064  r {container}..d
-0001eec0: 6570 6c6f 7965 6421 2229 0a20 2020 2020  eployed!").     
-0001eed0: 2020 2020 2020 2020 2020 2063 6f6e 742e             cont.
-0001eee0: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
-0001eef0: 286e 616d 653d 636f 6e74 6169 6e65 722c  (name=container,
-0001ef00: 2069 6d61 6765 3d63 6f6e 7461 696e 6572   image=container
-0001ef10: 696d 6167 652c 206e 6574 733d 6e65 7473  image, nets=nets
-0001ef20: 2c20 636d 6473 3d63 6d64 732c 2070 6f72  , cmds=cmds, por
-0001ef30: 7473 3d70 6f72 7473 2c0a 2020 2020 2020  ts=ports,.      
-0001ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef60: 766f 6c75 6d65 733d 766f 6c75 6d65 732c  volumes=volumes,
-0001ef70: 2065 6e76 6972 6f6e 6d65 6e74 3d65 6e76   environment=env
-0001ef80: 6972 6f6e 6d65 6e74 2c20 6c61 6265 6c3d  ironment, label=
-0001ef90: 6c61 6265 6c29 0a20 2020 2020 2020 2069  label).        i
-0001efa0: 6620 646e 7365 6e74 7269 6573 2061 6e64  f dnsentries and
-0001efb0: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
-0001efc0: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-0001efd0: 696e 7428 2244 6570 6c6f 7969 6e67 2044  int("Deploying D
-0001efe0: 6e73 2045 6e74 7269 6573 2e2e 2e22 290a  ns Entries...").
-0001eff0: 2020 2020 2020 2020 2020 2020 646e 7363              dnsc
-0001f000: 6c69 656e 7473 203d 207b 7d0a 2020 2020  lients = {}.    
-0001f010: 2020 2020 2020 2020 666f 7220 646e 7365          for dnse
-0001f020: 6e74 7279 2069 6e20 646e 7365 6e74 7269  ntry in dnsentri
-0001f030: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001f040: 2020 2020 646e 7370 726f 6669 6c65 203d      dnsprofile =
-0001f050: 2065 6e74 7269 6573 5b64 6e73 656e 7472   entries[dnsentr
-0001f060: 795d 0a20 2020 2020 2020 2020 2020 2020  y].             
-0001f070: 2020 2064 6e73 646f 6d61 696e 203d 2064     dnsdomain = d
-0001f080: 6e73 7072 6f66 696c 652e 6765 7428 2764  nsprofile.get('d
-0001f090: 6f6d 6169 6e27 290a 2020 2020 2020 2020  omain').        
-0001f0a0: 2020 2020 2020 2020 646e 736e 6574 203d          dnsnet =
-0001f0b0: 2064 6e73 7072 6f66 696c 652e 6765 7428   dnsprofile.get(
-0001f0c0: 276e 6574 272c 2027 6465 6661 756c 7427  'net', 'default'
-0001f0d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f0e0: 2020 646e 7369 7020 3d20 646e 7370 726f    dnsip = dnspro
-0001f0f0: 6669 6c65 2e67 6574 2827 6970 2729 0a20  file.get('ip'). 
-0001f100: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001f110: 6e73 616c 6961 7320 3d20 646e 7370 726f  nsalias = dnspro
-0001f120: 6669 6c65 2e67 6574 2827 616c 6961 7327  file.get('alias'
-0001f130: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
-0001f140: 2020 2020 2020 646e 7363 6c69 656e 7420        dnsclient 
-0001f150: 3d20 646e 7370 726f 6669 6c65 2e67 6574  = dnsprofile.get
-0001f160: 2827 636c 6965 6e74 2729 0a20 2020 2020  ('client').     
-0001f170: 2020 2020 2020 2020 2020 2069 6620 646e             if dn
-0001f180: 7363 6c69 656e 7420 6973 204e 6f6e 653a  sclient is None:
-0001f190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f1a0: 2020 2020 207a 203d 206b 0a20 2020 2020       z = k.     
-0001f1b0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0001f1c0: 646e 7363 6c69 656e 7420 696e 2064 6e73  dnsclient in dns
-0001f1d0: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
-0001f1e0: 2020 2020 2020 2020 2020 2020 207a 203d               z =
-0001f1f0: 2064 6e73 636c 6965 6e74 735b 646e 7363   dnsclients[dnsc
-0001f200: 6c69 656e 745d 0a20 2020 2020 2020 2020  lient].         
-0001f210: 2020 2020 2020 2065 6c69 6620 646e 7363         elif dnsc
-0001f220: 6c69 656e 7420 696e 2073 656c 662e 636c  lient in self.cl
-0001f230: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
-0001f240: 2020 2020 2020 2020 2020 207a 203d 204b             z = K
-0001f250: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
-0001f260: 7363 6c69 656e 7429 2e6b 0a20 2020 2020  sclient).k.     
-0001f270: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001f280: 6e73 636c 6965 6e74 735b 646e 7363 6c69  nsclients[dnscli
-0001f290: 656e 745d 203d 207a 0a20 2020 2020 2020  ent] = z.       
-0001f2a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2c0: 2020 2077 6172 6e69 6e67 2866 2243 6c69     warning(f"Cli
-0001f2d0: 656e 7420 7b64 6e73 636c 6965 6e74 7d20  ent {dnsclient} 
-0001f2e0: 6e6f 7420 666f 756e 642e 2053 6b69 7070  not found. Skipp
-0001f2f0: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
-0001f300: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001f310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f320: 2069 6620 646e 7369 7020 6973 204e 6f6e   if dnsip is Non
-0001f330: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001f340: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
-0001f350: 4d69 7373 696e 6720 6970 2e20 536b 6970  Missing ip. Skip
-0001f360: 7069 6e67 2122 290a 2020 2020 2020 2020  ping!").        
-0001f370: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001f380: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
-0001f390: 2020 2069 6620 646e 736e 6574 2069 7320     if dnsnet is 
-0001f3a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001f3b0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0001f3c0: 6728 224d 6973 7369 6e67 206e 6574 2e20  g("Missing net. 
-0001f3d0: 536b 6970 7069 6e67 2122 290a 2020 2020  Skipping!").    
-0001f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3f0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
-0001f400: 2020 2020 2020 207a 2e72 6573 6572 7665         z.reserve
-0001f410: 5f64 6e73 286e 616d 653d 646e 7365 6e74  _dns(name=dnsent
-0001f420: 7279 2c20 6e65 7473 3d5b 646e 736e 6574  ry, nets=[dnsnet
-0001f430: 5d2c 2064 6f6d 6169 6e3d 646e 7364 6f6d  ], domain=dnsdom
-0001f440: 6169 6e2c 2069 703d 646e 7369 702c 2061  ain, ip=dnsip, a
-0001f450: 6c69 6173 3d64 6e73 616c 6961 732c 2066  lias=dnsalias, f
-0001f460: 6f72 6365 3d54 7275 652c 0a20 2020 2020  orce=True,.     
-0001f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f480: 2020 2020 2020 2020 2070 7269 6d61 7279           primary
-0001f490: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
-0001f4a0: 6620 616e 7369 626c 6565 6e74 7269 6573  f ansibleentries
-0001f4b0: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
-0001f4c0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-0001f4d0: 2069 6620 6e6f 7420 6e65 7776 6d73 3a0a   if not newvms:.
-0001f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4f0: 7761 726e 696e 6728 2241 6e73 6962 6c65  warning("Ansible
-0001f500: 2073 6b69 7070 6564 2061 7320 6e6f 206e   skipped as no n
-0001f510: 6577 2076 6d20 7769 7468 696e 2070 6c61  ew vm within pla
-0001f520: 7962 6f6f 6b20 7072 6f76 6973 696f 6e65  ybook provisione
-0001f530: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
-0001f540: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0001f550: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
-0001f560: 2069 6e20 736f 7274 6564 2861 6e73 6962   in sorted(ansib
-0001f570: 6c65 656e 7472 6965 7329 3a0a 2020 2020  leentries):.    
-0001f580: 2020 2020 2020 2020 2020 2020 5f61 6e73              _ans
-0001f590: 6962 6c65 203d 2065 6e74 7269 6573 5b65  ible = entries[e
-0001f5a0: 6e74 7279 5d0a 2020 2020 2020 2020 2020  ntry].          
-0001f5b0: 2020 2020 2020 6966 2027 706c 6179 626f        if 'playbo
-0001f5c0: 6f6b 2720 6e6f 7420 696e 205f 616e 7369  ok' not in _ansi
-0001f5d0: 626c 653a 0a20 2020 2020 2020 2020 2020  ble:.           
-0001f5e0: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
-0001f5f0: 4d69 7373 696e 6720 506c 6179 626f 6f6b  Missing Playbook
-0001f600: 2066 6f72 2061 6e73 6962 6c65 2e49 676e   for ansible.Ign
-0001f610: 6f72 696e 672e 2e2e 2229 0a20 2020 2020  oring...").     
-0001f620: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001f630: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-0001f640: 2020 2020 2020 2020 2020 2070 6c61 7962             playb
-0001f650: 6f6f 6b20 3d20 5f61 6e73 6962 6c65 5b27  ook = _ansible['
-0001f660: 706c 6179 626f 6f6b 275d 0a20 2020 2020  playbook'].     
-0001f670: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
-0001f680: 7365 203d 205f 616e 7369 626c 655b 2776  se = _ansible['v
-0001f690: 6572 626f 7365 275d 2069 6620 2776 6572  erbose'] if 'ver
-0001f6a0: 626f 7365 2720 696e 205f 616e 7369 626c  bose' in _ansibl
-0001f6b0: 6520 656c 7365 2046 616c 7365 0a20 2020  e else False.   
-0001f6c0: 2020 2020 2020 2020 2020 2020 2067 726f               gro
-0001f6d0: 7570 7320 3d20 5f61 6e73 6962 6c65 2e67  ups = _ansible.g
-0001f6e0: 6574 2827 6772 6f75 7073 272c 207b 7d29  et('groups', {})
-0001f6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f700: 2075 7365 7220 3d20 5f61 6e73 6962 6c65   user = _ansible
-0001f710: 2e67 6574 2827 7573 6572 2729 0a20 2020  .get('user').   
-0001f720: 2020 2020 2020 2020 2020 2020 2076 6172               var
-0001f730: 6961 626c 6573 203d 205f 616e 7369 626c  iables = _ansibl
-0001f740: 652e 6765 7428 2776 6172 6961 626c 6573  e.get('variables
-0001f750: 272c 207b 7d29 0a20 2020 2020 2020 2020  ', {}).         
-0001f760: 2020 2020 2020 2074 6172 6765 7476 6d73         targetvms
-0001f770: 203d 205b 766d 2066 6f72 2076 6d20 696e   = [vm for vm in
-0001f780: 205f 616e 7369 626c 655b 2776 6d73 275d   _ansible['vms']
-0001f790: 2069 6620 766d 2069 6e20 6e65 7776 6d73   if vm in newvms
-0001f7a0: 5d20 6966 2027 766d 7327 2069 6e20 5f61  ] if 'vms' in _a
-0001f7b0: 6e73 6962 6c65 2065 6c73 6520 6e65 7776  nsible else newv
-0001f7c0: 6d73 0a20 2020 2020 2020 2020 2020 2020  ms.             
-0001f7d0: 2020 2069 6620 6e6f 7420 7461 7267 6574     if not target
-0001f7e0: 766d 733a 0a20 2020 2020 2020 2020 2020  vms:.           
-0001f7f0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0001f800: 2822 416e 7369 626c 6520 736b 6970 7065  ("Ansible skippe
-0001f810: 6420 6173 206e 6f20 6e65 7720 766d 2077  d as no new vm w
-0001f820: 6974 6869 6e20 706c 6179 626f 6f6b 2070  ithin playbook p
-0001f830: 726f 7669 7369 6f6e 6564 2229 0a20 2020  rovisioned").   
-0001f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f850: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-0001f860: 2020 2020 2020 2020 616e 7369 626c 6563          ansiblec
-0001f870: 6f6d 6d61 6e64 203d 2022 616e 7369 626c  ommand = "ansibl
-0001f880: 652d 706c 6179 626f 6f6b 220a 2020 2020  e-playbook".    
-0001f890: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0001f8a0: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
-0001f8b0: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
-0001f8c0: 626c 6563 6f6d 6d61 6e64 202b 3d20 2220  blecommand += " 
-0001f8d0: 2d76 7676 220a 2020 2020 2020 2020 2020  -vvv".          
-0001f8e0: 2020 2020 2020 696e 7665 6e74 6f72 7966        inventoryf
-0001f8f0: 696c 6520 3d20 6622 2f74 6d70 2f7b 706c  ile = f"/tmp/{pl
-0001f900: 616e 7d2e 696e 762e 7961 6d6c 2220 6966  an}.inv.yaml" if
-0001f910: 2073 656c 662e 7961 6d6c 696e 7665 6e74   self.yamlinvent
-0001f920: 6f72 7920 656c 7365 2066 222f 746d 702f  ory else f"/tmp/
-0001f930: 7b70 6c61 6e7d 2e69 6e76 220a 2020 2020  {plan}.inv".    
-0001f940: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
-0001f950: 626c 6575 7469 6c73 2e6d 616b 655f 706c  bleutils.make_pl
-0001f960: 616e 5f69 6e76 656e 746f 7279 2876 6d73  an_inventory(vms
-0001f970: 5f74 6f5f 686f 7374 2c20 706c 616e 2c20  _to_host, plan, 
-0001f980: 7461 7267 6574 766d 732c 2067 726f 7570  targetvms, group
-0001f990: 733d 6772 6f75 7073 2c20 7573 6572 3d75  s=groups, user=u
-0001f9a0: 7365 722c 0a20 2020 2020 2020 2020 2020  ser,.           
-0001f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9d0: 2020 2020 2020 7961 6d6c 696e 7665 6e74        yamlinvent
-0001f9e0: 6f72 793d 7365 6c66 2e79 616d 6c69 6e76  ory=self.yamlinv
-0001f9f0: 656e 746f 7279 2c20 7475 6e6e 656c 3d73  entory, tunnel=s
-0001fa00: 656c 662e 7475 6e6e 656c 2c0a 2020 2020  elf.tunnel,.    
-0001fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa30: 2020 2020 2020 2020 2020 2020 2074 756e               tun
-0001fa40: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
-0001fa50: 6e65 6c68 6f73 742c 2074 756e 6e65 6c75  nelhost, tunnelu
-0001fa60: 7365 723d 7365 6c66 2e74 756e 6e65 6c75  ser=self.tunnelu
-0001fa70: 7365 722c 0a20 2020 2020 2020 2020 2020  ser,.           
+0001ecf0: 2076 6d63 6c69 656e 743d 766d 636c 6965   vmclient=vmclie
+0001ed00: 6e74 290a 2020 2020 2020 2020 6966 2076  nt).        if v
+0001ed10: 6d65 6e74 7269 6573 2061 6e64 2074 6872  mentries and thr
+0001ed20: 6561 6465 643a 0a20 2020 2020 2020 2020  eaded:.         
+0001ed30: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
+0001ed40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001ed50: 6f72 2069 6e64 6578 2c20 7420 696e 2065  or index, t in e
+0001ed60: 6e75 6d65 7261 7465 2874 6872 6561 6473  numerate(threads
+0001ed70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001ed80: 2020 2020 2020 2069 6620 6e6f 7420 742e         if not t.
+0001ed90: 6973 5f61 6c69 7665 2829 3a0a 2020 2020  is_alive():.    
+0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edb0: 2020 2020 6465 6c20 7468 7265 6164 735b      del threads[
+0001edc0: 696e 6465 785d 0a20 2020 2020 2020 2020  index].         
+0001edd0: 2020 2020 2020 2069 6620 6e6f 7420 7468         if not th
+0001ede0: 7265 6164 733a 0a20 2020 2020 2020 2020  reads:.         
+0001edf0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0001ee00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ee10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001ee20: 2020 2020 2020 2020 2020 2073 6c65 6570             sleep
+0001ee30: 2831 290a 2020 2020 2020 2020 6966 2076  (1).        if v
+0001ee40: 6d63 6c69 656e 7473 3a0a 2020 2020 2020  mclients:.      
+0001ee50: 2020 2020 2020 7961 6d6c 2e73 6166 655f        yaml.safe_
+0001ee60: 6475 6d70 2876 6d63 6c69 656e 7473 2c20  dump(vmclients, 
+0001ee70: 6f70 656e 286f 732e 7061 7468 2e65 7870  open(os.path.exp
+0001ee80: 616e 6475 7365 7228 6627 7e2f 2e6b 636c  anduser(f'~/.kcl
+0001ee90: 692f 766d 636c 6965 6e74 735f 7b70 6c61  i/vmclients_{pla
+0001eea0: 6e7d 2729 2c20 2777 2729 290a 2020 2020  n}'), 'w')).    
+0001eeb0: 2020 2020 6966 2064 6973 6b65 6e74 7269      if diskentri
+0001eec0: 6573 2061 6e64 206e 6f74 206f 6e6c 7961  es and not onlya
+0001eed0: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0001eee0: 2020 2070 7072 696e 7428 2244 6570 6c6f     pprint("Deplo
+0001eef0: 7969 6e67 2044 6973 6b73 2e2e 2e22 290a  ying Disks...").
+0001ef00: 2020 2020 2020 2020 666f 7220 6469 736b          for disk
+0001ef10: 2069 6e20 6469 736b 656e 7472 6965 733a   in diskentries:
+0001ef20: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+0001ef30: 6669 6c65 203d 2065 6e74 7269 6573 5b64  file = entries[d
+0001ef40: 6973 6b5d 0a20 2020 2020 2020 2020 2020  isk].           
+0001ef50: 2070 6f6f 6c20 3d20 7072 6f66 696c 652e   pool = profile.
+0001ef60: 6765 7428 2770 6f6f 6c27 290a 2020 2020  get('pool').    
+0001ef70: 2020 2020 2020 2020 766d 7320 3d20 7072          vms = pr
+0001ef80: 6f66 696c 652e 6765 7428 2776 6d73 2729  ofile.get('vms')
+0001ef90: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
+0001efa0: 706c 6174 6520 3d20 7072 6f66 696c 652e  plate = profile.
+0001efb0: 6765 7428 2774 656d 706c 6174 6527 290a  get('template').
+0001efc0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+0001efd0: 6520 3d20 7072 6f66 696c 652e 6765 7428  e = profile.get(
+0001efe0: 2769 6d61 6765 272c 2074 656d 706c 6174  'image', templat
+0001eff0: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+0001f000: 697a 6520 3d20 696e 7428 7072 6f66 696c  ize = int(profil
+0001f010: 652e 6765 7428 2773 697a 6527 2c20 3130  e.get('size', 10
+0001f020: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
+0001f030: 6620 706f 6f6c 2069 7320 4e6f 6e65 3a0a  f pool is None:.
+0001f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f050: 6572 726f 7228 6622 4d69 7373 696e 6720  error(f"Missing 
+0001f060: 4b65 7920 506f 6f6c 2066 6f72 2064 6973  Key Pool for dis
+0001f070: 6b20 7365 6374 696f 6e20 7b64 6973 6b7d  k section {disk}
+0001f080: 2e20 4e6f 7420 6372 6561 7469 6e67 2069  . Not creating i
+0001f090: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
+0001f0a0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0001f0b0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+0001f0c0: 6d73 2069 7320 4e6f 6e65 3a0a 2020 2020  ms is None:.    
+0001f0d0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0001f0e0: 7228 6622 4d69 7373 696e 6720 6f72 2049  r(f"Missing or I
+0001f0f0: 6e63 6f72 7265 6374 204b 6579 2056 6d73  ncorrect Key Vms
+0001f100: 2066 6f72 2064 6973 6b20 7365 6374 696f   for disk sectio
+0001f110: 6e20 7b64 6973 6b7d 2e20 4e6f 7420 6372  n {disk}. Not cr
+0001f120: 6561 7469 6e67 2069 742e 2e2e 2229 0a20  eating it..."). 
+0001f130: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001f140: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+0001f150: 2020 2020 7368 6172 6561 626c 6520 3d20      shareable = 
+0001f160: 5472 7565 2069 6620 6c65 6e28 766d 7329  True if len(vms)
+0001f170: 203e 2031 2065 6c73 6520 4661 6c73 650a   > 1 else False.
+0001f180: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+0001f190: 2e64 6973 6b5f 6578 6973 7473 2870 6f6f  .disk_exists(poo
+0001f1a0: 6c2c 2064 6973 6b29 3a0a 2020 2020 2020  l, disk):.      
+0001f1b0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+0001f1c0: 2866 2243 7265 6174 696f 6e20 666f 7220  (f"Creation for 
+0001f1d0: 4469 736b 207b 6469 736b 7d20 736b 6970  Disk {disk} skip
+0001f1e0: 7065 6421 2229 0a20 2020 2020 2020 2020  ped!").         
+0001f1f0: 2020 2020 2020 2070 6f6f 6c70 6174 6820         poolpath 
+0001f200: 3d20 6b2e 6765 745f 706f 6f6c 5f70 6174  = k.get_pool_pat
+0001f210: 6828 706f 6f6c 290a 2020 2020 2020 2020  h(pool).        
+0001f220: 2020 2020 2020 2020 6e65 7764 6973 6b20          newdisk 
+0001f230: 3d20 6622 7b70 6f6f 6c70 6174 687d 2f7b  = f"{poolpath}/{
+0001f240: 6469 736b 7d22 0a20 2020 2020 2020 2020  disk}".         
+0001f250: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
+0001f260: 2076 6d73 3a0a 2020 2020 2020 2020 2020   vms:.          
+0001f270: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+0001f280: 2866 2241 6464 696e 6720 6469 736b 207b  (f"Adding disk {
+0001f290: 6469 736b 7d20 746f 207b 766d 7d22 290a  disk} to {vm}").
+0001f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2b0: 2020 2020 6b2e 6164 645f 6469 736b 286e      k.add_disk(n
+0001f2c0: 616d 653d 766d 2c20 7369 7a65 3d73 697a  ame=vm, size=siz
+0001f2d0: 652c 2070 6f6f 6c3d 706f 6f6c 2c20 696d  e, pool=pool, im
+0001f2e0: 6167 653d 696d 6167 652c 2073 6861 7265  age=image, share
+0001f2f0: 6162 6c65 3d73 6861 7265 6162 6c65 2c20  able=shareable, 
+0001f300: 6578 6973 7469 6e67 3d6e 6577 6469 736b  existing=newdisk
+0001f310: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f330: 2074 6869 6e3d 4661 6c73 6529 0a20 2020   thin=False).   
+0001f340: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001f350: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001f360: 6577 6469 736b 203d 206b 2e63 7265 6174  ewdisk = k.creat
+0001f370: 655f 6469 736b 2864 6973 6b2c 2073 697a  e_disk(disk, siz
+0001f380: 653d 7369 7a65 2c20 706f 6f6c 3d70 6f6f  e=size, pool=poo
+0001f390: 6c2c 2069 6d61 6765 3d69 6d61 6765 2c20  l, image=image, 
+0001f3a0: 7468 696e 3d46 616c 7365 290a 2020 2020  thin=False).    
+0001f3b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001f3c0: 6577 6469 736b 2069 7320 4e6f 6e65 3a0a  ewdisk is None:.
+0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3e0: 2020 2020 6572 726f 7228 6622 4469 736b      error(f"Disk
+0001f3f0: 207b 6469 736b 7d20 6e6f 7420 6465 706c   {disk} not depl
+0001f400: 6f79 6564 2e20 4974 2077 6f6e 2774 2062  oyed. It won't b
+0001f410: 6520 6164 6465 6420 746f 2061 6e79 2076  e added to any v
+0001f420: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
+0001f430: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001f440: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001f450: 6d6d 6f6e 2e70 7072 696e 7428 6622 4469  mmon.pprint(f"Di
+0001f460: 736b 207b 6469 736b 7d20 6465 706c 6f79  sk {disk} deploy
+0001f470: 6564 2122 290a 2020 2020 2020 2020 2020  ed!").          
+0001f480: 2020 2020 2020 2020 2020 666f 7220 766d            for vm
+0001f490: 2069 6e20 766d 733a 0a20 2020 2020 2020   in vms:.       
+0001f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4b0: 2070 7072 696e 7428 6622 4164 6469 6e67   pprint(f"Adding
+0001f4c0: 2064 6973 6b20 7b64 6973 6b7d 2074 6f20   disk {disk} to 
+0001f4d0: 7b76 6d7d 2229 0a20 2020 2020 2020 2020  {vm}").         
+0001f4e0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0001f4f0: 2e61 6464 5f64 6973 6b28 6e61 6d65 3d76  .add_disk(name=v
+0001f500: 6d2c 2073 697a 653d 7369 7a65 2c20 706f  m, size=size, po
+0001f510: 6f6c 3d70 6f6f 6c2c 2069 6d61 6765 3d69  ol=pool, image=i
+0001f520: 6d61 6765 2c20 7368 6172 6561 626c 653d  mage, shareable=
+0001f530: 7368 6172 6561 626c 652c 0a20 2020 2020  shareable,.     
+0001f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f550: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0001f560: 6973 7469 6e67 3d6e 6577 6469 736b 2c20  isting=newdisk, 
+0001f570: 7468 696e 3d46 616c 7365 290a 2020 2020  thin=False).    
+0001f580: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
+0001f590: 656e 7472 6965 7320 616e 6420 6e6f 7420  entries and not 
+0001f5a0: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
+0001f5b0: 2020 2020 2020 2020 636f 6e74 203d 204b          cont = K
+0001f5c0: 636f 6e74 6169 6e65 7263 6f6e 6669 6728  containerconfig(
+0001f5d0: 7365 6c66 2c20 636c 6965 6e74 3d73 656c  self, client=sel
+0001f5e0: 662e 636f 6e74 6169 6e65 7263 6c69 656e  f.containerclien
+0001f5f0: 7429 2e63 6f6e 740a 2020 2020 2020 2020  t).cont.        
+0001f600: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
+0001f610: 6f79 696e 6720 436f 6e74 6169 6e65 7273  oying Containers
+0001f620: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+0001f630: 2020 6c61 6265 6c20 3d20 6622 706c 616e    label = f"plan
+0001f640: 3d7b 706c 616e 7d22 0a20 2020 2020 2020  ={plan}".       
+0001f650: 2020 2020 2066 6f72 2063 6f6e 7461 696e       for contain
+0001f660: 6572 2069 6e20 636f 6e74 6169 6e65 7265  er in containere
+0001f670: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
+0001f680: 2020 2020 2020 2020 6966 2063 6f6e 742e          if cont.
+0001f690: 6578 6973 7473 5f63 6f6e 7461 696e 6572  exists_container
+0001f6a0: 2863 6f6e 7461 696e 6572 293a 0a20 2020  (container):.   
+0001f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f6c0: 2070 7072 696e 7428 6622 436f 6e74 6169   pprint(f"Contai
+0001f6d0: 6e65 7220 7b63 6f6e 7461 696e 6572 7d20  ner {container} 
+0001f6e0: 736b 6970 7065 6421 2229 0a20 2020 2020  skipped!").     
+0001f6f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001f700: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+0001f710: 2020 2020 2020 2020 7072 6f66 696c 6520          profile 
+0001f720: 3d20 656e 7472 6965 735b 636f 6e74 6169  = entries[contai
+0001f730: 6e65 725d 0a20 2020 2020 2020 2020 2020  ner].           
+0001f740: 2020 2020 2069 6620 2770 726f 6669 6c65       if 'profile
+0001f750: 2720 696e 2070 726f 6669 6c65 2061 6e64  ' in profile and
+0001f760: 2070 726f 6669 6c65 5b27 7072 6f66 696c   profile['profil
+0001f770: 6527 5d20 696e 2063 6f6e 7461 696e 6572  e'] in container
+0001f780: 7072 6f66 696c 6573 3a0a 2020 2020 2020  profiles:.      
+0001f790: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001f7a0: 7374 6f6d 7072 6f66 696c 6520 3d20 636f  stomprofile = co
+0001f7b0: 6e74 6169 6e65 7270 726f 6669 6c65 735b  ntainerprofiles[
+0001f7c0: 7072 6f66 696c 655b 2770 726f 6669 6c65  profile['profile
+0001f7d0: 275d 5d0a 2020 2020 2020 2020 2020 2020  ']].            
+0001f7e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001f7f0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001f800: 7374 6f6d 7072 6f66 696c 6520 3d20 7b7d  stomprofile = {}
+0001f810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f820: 2063 6f6e 7461 696e 6572 696d 6167 6520   containerimage 
+0001f830: 3d20 6e65 7874 2828 6520 666f 7220 6520  = next((e for e 
+0001f840: 696e 205b 7072 6f66 696c 652e 6765 7428  in [profile.get(
+0001f850: 2769 6d61 6765 2729 2c20 7072 6f66 696c  'image'), profil
+0001f860: 652e 6765 7428 2769 6d61 6765 2729 2c0a  e.get('image'),.
+0001f870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8a0: 2020 2063 7573 746f 6d70 726f 6669 6c65     customprofile
+0001f8b0: 2e67 6574 2827 696d 6167 6527 292c 0a20  .get('image'),. 
+0001f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8f0: 2020 6375 7374 6f6d 7072 6f66 696c 652e    customprofile.
+0001f900: 6765 7428 2769 6d61 6765 2729 5d20 6966  get('image')] if
+0001f910: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
+0001f920: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+0001f930: 2020 2020 2020 206e 6574 7320 3d20 6e65         nets = ne
+0001f940: 7874 2828 6520 666f 7220 6520 696e 205b  xt((e for e in [
+0001f950: 7072 6f66 696c 652e 6765 7428 276e 6574  profile.get('net
+0001f960: 7327 292c 2063 7573 746f 6d70 726f 6669  s'), customprofi
+0001f970: 6c65 2e67 6574 2827 6e65 7473 2729 5d20  le.get('nets')] 
+0001f980: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
+0001f990: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
+0001f9a0: 2020 2020 2020 2020 2070 6f72 7473 203d           ports =
+0001f9b0: 206e 6578 7428 2865 2066 6f72 2065 2069   next((e for e i
+0001f9c0: 6e20 5b70 726f 6669 6c65 2e67 6574 2827  n [profile.get('
+0001f9d0: 706f 7274 7327 292c 2063 7573 746f 6d70  ports'), customp
+0001f9e0: 726f 6669 6c65 2e67 6574 2827 706f 7274  rofile.get('port
+0001f9f0: 7327 295d 2069 6620 6520 6973 206e 6f74  s')] if e is not
+0001fa00: 204e 6f6e 6529 2c20 4e6f 6e65 290a 2020   None), None).  
+0001fa10: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+0001fa20: 6c75 6d65 7320 3d20 6e65 7874 2828 6520  lumes = next((e 
+0001fa30: 666f 7220 6520 696e 205b 7072 6f66 696c  for e in [profil
+0001fa40: 652e 6765 7428 2776 6f6c 756d 6573 2729  e.get('volumes')
+0001fa50: 2c20 7072 6f66 696c 652e 6765 7428 2764  , profile.get('d
+0001fa60: 6973 6b73 2729 2c0a 2020 2020 2020 2020  isks'),.        
+0001fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001faa0: 2020 2020 2020 7475 6e6e 656c 706f 7274        tunnelport
-0001fab0: 3d73 656c 662e 7475 6e6e 656c 706f 7274  =self.tunnelport
-0001fac0: 2c20 696e 7365 6375 7265 3d73 656c 662e  , insecure=self.
-0001fad0: 696e 7365 6375 7265 290a 2020 2020 2020  insecure).      
-0001fae0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0001faf0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0001fb00: 277e 2f2e 616e 7369 626c 652e 6366 6727  '~/.ansible.cfg'
-0001fb10: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001fb20: 2020 2020 2020 2061 6e73 6962 6c65 636f         ansibleco
-0001fb30: 6e66 6967 203d 206f 732e 7061 7468 2e65  nfig = os.path.e
-0001fb40: 7870 616e 6475 7365 7228 277e 2f2e 616e  xpanduser('~/.an
-0001fb50: 7369 626c 652e 6366 6727 290a 2020 2020  sible.cfg').    
-0001fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb70: 7769 7468 206f 7065 6e28 616e 7369 626c  with open(ansibl
-0001fb80: 6563 6f6e 6669 672c 2022 7722 2920 6173  econfig, "w") as
-0001fb90: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-0001fba0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-0001fbb0: 6974 6528 225b 7373 685f 636f 6e6e 6563  ite("[ssh_connec
-0001fbc0: 7469 6f6e 5d5c 6e72 6574 7269 6573 3d31  tion]\nretries=1
-0001fbd0: 305c 6e22 290a 2020 2020 2020 2020 2020  0\n").          
-0001fbe0: 2020 2020 2020 6966 2076 6172 6961 626c        if variabl
-0001fbf0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001fc00: 2020 2020 2020 2020 7661 7273 6669 6c65          varsfile
-0001fc10: 203d 2066 222f 746d 702f 7b70 6c61 6e7d   = f"/tmp/{plan}
-0001fc20: 2e76 6172 732e 796d 6c22 0a20 2020 2020  .vars.yml".     
-0001fc30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001fc40: 6974 6820 6f70 656e 2876 6172 7366 696c  ith open(varsfil
-0001fc50: 652c 2027 7727 2920 6173 2066 3a0a 2020  e, 'w') as f:.  
-0001fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc70: 2020 2020 2020 7961 6d6c 2e64 756d 7028        yaml.dump(
-0001fc80: 7661 7269 6162 6c65 732c 2066 2c20 6465  variables, f, de
-0001fc90: 6661 756c 745f 666c 6f77 5f73 7479 6c65  fault_flow_style
-0001fca0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-0001fcb0: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
-0001fcc0: 626c 6563 6f6d 6d61 6e64 202b 3d20 6622  blecommand += f"
-0001fcd0: 202d 2d65 7874 7261 2d76 6172 7320 407b   --extra-vars @{
-0001fce0: 7661 7273 6669 6c65 7d22 0a20 2020 2020  varsfile}".     
-0001fcf0: 2020 2020 2020 2020 2020 2061 6e73 6962             ansib
-0001fd00: 6c65 636f 6d6d 616e 6420 2b3d 2066 2220  lecommand += f" 
-0001fd10: 2d69 207b 696e 7665 6e74 6f72 7966 696c  -i {inventoryfil
-0001fd20: 657d 207b 706c 6179 626f 6f6b 7d22 0a20  e} {playbook}". 
-0001fd30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001fd40: 7072 696e 7428 6622 5275 6e6e 696e 673a  print(f"Running:
-0001fd50: 207b 616e 7369 626c 6563 6f6d 6d61 6e64   {ansiblecommand
-0001fd60: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001fd70: 2020 2020 6f73 2e73 7973 7465 6d28 616e      os.system(an
-0001fd80: 7369 626c 6563 6f6d 6d61 6e64 290a 2020  siblecommand).  
-0001fd90: 2020 2020 2020 6966 2061 6e73 6962 6c65        if ansible
-0001fda0: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
-0001fdb0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-0001fdc0: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
-0001fdd0: 6e67 2041 6e73 6962 6c65 2049 6e76 656e  ng Ansible Inven
-0001fde0: 746f 7279 2e2e 2e22 290a 2020 2020 2020  tory...").      
-0001fdf0: 2020 2020 2020 696e 7665 6e74 6f72 7966        inventoryf
-0001fe00: 696c 6520 3d20 6622 2f74 6d70 2f7b 706c  ile = f"/tmp/{pl
-0001fe10: 616e 7d2e 696e 762e 7961 6d6c 2220 6966  an}.inv.yaml" if
-0001fe20: 2073 656c 662e 7961 6d6c 696e 7665 6e74   self.yamlinvent
-0001fe30: 6f72 7920 656c 7365 2066 222f 746d 702f  ory else f"/tmp/
-0001fe40: 7b70 6c61 6e7d 2e69 6e76 220a 2020 2020  {plan}.inv".    
-0001fe50: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-0001fe60: 7468 2e65 7869 7374 7328 696e 7665 6e74  th.exists(invent
-0001fe70: 6f72 7966 696c 6529 3a0a 2020 2020 2020  oryfile):.      
-0001fe80: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0001fe90: 2866 2249 6e76 656e 746f 7279 2069 6e20  (f"Inventory in 
-0001fea0: 7b69 6e76 656e 746f 7279 6669 6c65 7d20  {inventoryfile} 
-0001feb0: 736b 6970 7065 6421 2229 0a20 2020 2020  skipped!").     
-0001fec0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001fed0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001fee0: 696e 7428 6622 4372 6561 7469 6e67 2061  int(f"Creating a
-0001fef0: 6e73 6962 6c65 2069 6e76 656e 746f 7279  nsible inventory
-0001ff00: 2066 6f72 2070 6c61 6e20 7b70 6c61 6e7d   for plan {plan}
-0001ff10: 2069 6e20 7b69 6e76 656e 746f 7279 6669   in {inventoryfi
-0001ff20: 6c65 7d22 290a 2020 2020 2020 2020 2020  le}").          
-0001ff30: 2020 2020 2020 766d 7320 3d20 5b5d 0a20        vms = []. 
-0001ff40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001ff50: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
-0001ff60: 6b2e 6c69 7374 2829 2c20 6b65 793d 6c61  k.list(), key=la
-0001ff70: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
-0001ff80: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-0001ff90: 2020 2020 2020 2020 6e61 6d65 203d 2076          name = v
-0001ffa0: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
-0001ffb0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0001ffc0: 7363 7269 7074 696f 6e20 3d20 766d 5b27  scription = vm['
-0001ffd0: 706c 616e 275d 0a20 2020 2020 2020 2020  plan'].         
-0001ffe0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-0001fff0: 7363 7269 7074 696f 6e20 3d3d 2070 6c61  scription == pla
-00020000: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00020010: 2020 2020 2020 2020 2020 2076 6d73 2e61             vms.a
-00020020: 7070 656e 6428 6e61 6d65 290a 2020 2020  ppend(name).    
-00020030: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
-00020040: 626c 6575 7469 6c73 2e6d 616b 655f 706c  bleutils.make_pl
-00020050: 616e 5f69 6e76 656e 746f 7279 2876 6d73  an_inventory(vms
-00020060: 5f74 6f5f 686f 7374 2c20 706c 616e 2c20  _to_host, plan, 
-00020070: 766d 732c 2079 616d 6c69 6e76 656e 746f  vms, yamlinvento
-00020080: 7279 3d73 656c 662e 7961 6d6c 696e 7665  ry=self.yamlinve
-00020090: 6e74 6f72 792c 0a20 2020 2020 2020 2020  ntory,.         
-000200a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200c0: 2020 2020 2020 2020 696e 7365 6375 7265          insecure
-000200d0: 3d73 656c 662e 696e 7365 6375 7265 290a  =self.insecure).
-000200e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200f0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-00020100: 3a20 2773 7563 6365 7373 272c 2027 706c  : 'success', 'pl
-00020110: 616e 273a 2070 6c61 6e7d 0a20 2020 2020  an': plan}.     
-00020120: 2020 2069 6620 6c62 7320 616e 6420 6e6f     if lbs and no
-00020130: 7420 6f6e 6c79 6173 7365 7473 3a0a 2020  t onlyassets:.  
-00020140: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
-00020150: 656e 7473 203d 207b 7d0a 2020 2020 2020  ents = {}.      
-00020160: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
-00020170: 706c 6f79 696e 6720 4c6f 6164 6261 6c61  ploying Loadbala
-00020180: 6e63 6572 732e 2e2e 2229 0a20 2020 2020  ncers...").     
-00020190: 2020 2020 2020 2066 6f72 2069 6e64 6578         for index
-000201a0: 2c20 6c62 656e 7472 7920 696e 2065 6e75  , lbentry in enu
-000201b0: 6d65 7261 7465 286c 6273 293a 0a20 2020  merate(lbs):.   
-000201c0: 2020 2020 2020 2020 2020 2020 2064 6574               det
-000201d0: 6169 6c73 203d 2065 6e74 7269 6573 5b6c  ails = entries[l
-000201e0: 6265 6e74 7279 5d0a 2020 2020 2020 2020  bentry].        
-000201f0: 2020 2020 2020 2020 706f 7274 7320 3d20          ports = 
-00020200: 6465 7461 696c 732e 6765 7428 2770 6f72  details.get('por
-00020210: 7473 272c 205b 5d29 0a20 2020 2020 2020  ts', []).       
-00020220: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00020230: 706f 7274 733a 0a20 2020 2020 2020 2020  ports:.         
-00020240: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00020250: 2822 4d69 7373 696e 6720 506f 7274 7320  ("Missing Ports 
-00020260: 666f 7220 6c6f 6164 6261 6c61 6e63 6572  for loadbalancer
-00020270: 2e20 4e6f 7420 6372 6561 7469 6e67 2069  . Not creating i
-00020280: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
-00020290: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000202a0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-000202b0: 2020 6368 6563 6b70 6174 6820 3d20 6465    checkpath = de
-000202c0: 7461 696c 732e 6765 7428 2763 6865 636b  tails.get('check
-000202d0: 7061 7468 272c 2027 2f27 290a 2020 2020  path', '/').    
-000202e0: 2020 2020 2020 2020 2020 2020 6368 6563              chec
-000202f0: 6b70 6f72 7420 3d20 6465 7461 696c 732e  kport = details.
-00020300: 6765 7428 2763 6865 636b 706f 7274 272c  get('checkport',
-00020310: 2038 3029 0a20 2020 2020 2020 2020 2020   80).           
-00020320: 2020 2020 2061 6c69 6173 203d 2064 6574       alias = det
-00020330: 6169 6c73 2e67 6574 2827 616c 6961 7327  ails.get('alias'
-00020340: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
-00020350: 2020 2020 2020 646f 6d61 696e 203d 2064        domain = d
-00020360: 6574 6169 6c73 2e67 6574 2827 646f 6d61  etails.get('doma
-00020370: 696e 2729 0a20 2020 2020 2020 2020 2020  in').           
-00020380: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
-00020390: 2064 6574 6169 6c73 2e67 6574 2827 646e   details.get('dn
-000203a0: 7363 6c69 656e 7427 2c20 6f76 6572 7269  sclient', overri
-000203b0: 6465 732e 6765 7428 2764 6e73 636c 6965  des.get('dnsclie
-000203c0: 6e74 2729 290a 2020 2020 2020 2020 2020  nt')).          
-000203d0: 2020 2020 2020 6c62 766d 7320 3d20 6465        lbvms = de
-000203e0: 7461 696c 732e 6765 7428 2776 6d73 272c  tails.get('vms',
-000203f0: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
-00020400: 2020 2020 206c 626e 6574 7320 3d20 6465       lbnets = de
-00020410: 7461 696c 732e 6765 7428 276e 6574 7327  tails.get('nets'
-00020420: 2c20 5b27 6465 6661 756c 7427 5d29 0a20  , ['default']). 
-00020430: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00020440: 6e74 6572 6e61 6c20 3d20 6465 7461 696c  nternal = detail
-00020450: 732e 6765 7428 2769 6e74 6572 6e61 6c27  s.get('internal'
-00020460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00020470: 2020 7375 626e 6574 6964 203d 2064 6574    subnetid = det
-00020480: 6169 6c73 2e67 6574 2827 7375 626e 6574  ails.get('subnet
-00020490: 6964 2729 0a20 2020 2020 2020 2020 2020  id').           
-000204a0: 2020 2020 2069 7020 3d20 6465 7461 696c       ip = detail
-000204b0: 732e 6765 7428 2769 7027 290a 2020 2020  s.get('ip').    
-000204c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000204d0: 2e63 7265 6174 655f 6c6f 6164 6261 6c61  .create_loadbala
-000204e0: 6e63 6572 286c 6265 6e74 7279 2c20 6e65  ncer(lbentry, ne
-000204f0: 7473 3d6c 626e 6574 732c 2070 6f72 7473  ts=lbnets, ports
-00020500: 3d70 6f72 7473 2c20 6368 6563 6b70 6174  =ports, checkpat
-00020510: 683d 6368 6563 6b70 6174 682c 2076 6d73  h=checkpath, vms
-00020520: 3d6c 6276 6d73 2c0a 2020 2020 2020 2020  =lbvms,.        
-00020530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020550: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c20   domain=domain, 
-00020560: 706c 616e 3d70 6c61 6e2c 2063 6865 636b  plan=plan, check
-00020570: 706f 7274 3d63 6865 636b 706f 7274 2c20  port=checkport, 
-00020580: 616c 6961 733d 616c 6961 732c 0a20 2020  alias=alias,.   
-00020590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205b0: 2020 2020 2020 696e 7465 726e 616c 3d69        internal=i
-000205c0: 6e74 6572 6e61 6c2c 2064 6e73 636c 6965  nternal, dnsclie
-000205d0: 6e74 3d64 6e73 636c 6965 6e74 2c20 7375  nt=dnsclient, su
-000205e0: 626e 6574 6964 3d73 7562 6e65 7469 642c  bnetid=subnetid,
-000205f0: 2069 703d 6970 290a 2020 2020 2020 2020   ip=ip).        
-00020600: 6966 2073 6773 2061 6e64 206e 6f74 206f  if sgs and not o
-00020610: 6e6c 7961 7373 6574 733a 0a20 2020 2020  nlyassets:.     
-00020620: 2020 2020 2020 2070 7072 696e 7428 2244         pprint("D
-00020630: 6570 6c6f 7969 6e67 2053 6563 7572 6974  eploying Securit
-00020640: 7947 726f 7570 732e 2e2e 2229 0a20 2020  yGroups...").   
-00020650: 2020 2020 2020 2020 2066 6f72 2073 6720           for sg 
-00020660: 696e 2073 6773 3a0a 2020 2020 2020 2020  in sgs:.        
-00020670: 2020 2020 2020 2020 6465 7461 696c 7320          details 
-00020680: 3d20 656e 7472 6965 735b 7367 5d0a 2020  = entries[sg].  
-00020690: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-000206a0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-000206b0: 2020 2070 6f72 7473 203d 2064 6574 6169     ports = detai
-000206c0: 6c73 2e67 6574 2827 706f 7274 7327 2c20  ls.get('ports', 
-000206d0: 5b5d 290a 2020 2020 2020 2020 2020 2020  []).            
-000206e0: 2020 2020 6966 206e 6f74 2070 6f72 7473      if not ports
-000206f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020700: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
-00020710: 7369 6e67 2050 6f72 7473 2066 6f72 2073  sing Ports for s
-00020720: 6773 2e20 4e6f 7420 6372 6561 7469 6e67  gs. Not creating
-00020730: 2069 742e 2e2e 2229 0a20 2020 2020 2020   it...").       
-00020740: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00020750: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
-00020760: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-00020770: 7365 6375 7269 7479 5f67 726f 7570 2873  security_group(s
-00020780: 672c 207b 2770 6f72 7473 273a 2070 6f72  g, {'ports': por
-00020790: 7473 7d29 0a20 2020 2020 2020 2069 6620  ts}).        if 
-000207a0: 776f 726b 666c 6f77 656e 7472 6965 7320  workflowentries 
-000207b0: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
-000207c0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000207d0: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
-000207e0: 6720 576f 726b 666c 6f77 2045 6e74 7269  g Workflow Entri
-000207f0: 6573 2e2e 2e22 290a 2020 2020 2020 2020  es...").        
-00020800: 2020 2020 666f 7220 776f 726b 666c 6f77      for workflow
-00020810: 2069 6e20 776f 726b 666c 6f77 656e 7472   in workflowentr
-00020820: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
-00020830: 2020 2020 2077 6f72 6b66 6c6f 775f 6f76       workflow_ov
-00020840: 6572 7269 6465 7320 3d20 6f76 6572 7269  errides = overri
-00020850: 6465 732e 636f 7079 2829 0a20 2020 2020  des.copy().     
-00020860: 2020 2020 2020 2020 2020 2077 6f72 6b66             workf
-00020870: 6c6f 775f 6f76 6572 7269 6465 732e 7570  low_overrides.up
-00020880: 6461 7465 2865 6e74 7269 6573 5b77 6f72  date(entries[wor
-00020890: 6b66 6c6f 775d 290a 2020 2020 2020 2020  kflow]).        
-000208a0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-000208b0: 6174 655f 776f 726b 666c 6f77 2877 6f72  ate_workflow(wor
-000208c0: 6b66 6c6f 772c 206f 7665 7272 6964 6573  kflow, overrides
-000208d0: 3d77 6f72 6b66 6c6f 775f 6f76 6572 7269  =workflow_overri
-000208e0: 6465 7329 0a20 2020 2020 2020 2072 6574  des).        ret
-000208f0: 7572 6e64 6174 6120 3d20 7b27 7265 7375  urndata = {'resu
-00020900: 6c74 273a 2027 7375 6363 6573 7327 2c20  lt': 'success', 
-00020910: 2770 6c61 6e27 3a20 706c 616e 7d0a 2020  'plan': plan}.  
-00020920: 2020 2020 2020 7265 7475 726e 6461 7461        returndata
-00020930: 5b27 6e65 7776 6d73 275d 203d 206e 6577  ['newvms'] = new
-00020940: 766d 7320 6966 206e 6577 766d 7320 656c  vms if newvms el
-00020950: 7365 205b 5d0a 2020 2020 2020 2020 7265  se [].        re
-00020960: 7475 726e 6461 7461 5b27 6578 6973 7469  turndata['existi
-00020970: 6e67 766d 7327 5d20 3d20 6578 6973 7469  ngvms'] = existi
-00020980: 6e67 766d 7320 6966 2065 7869 7374 696e  ngvms if existin
-00020990: 6776 6d73 2065 6c73 6520 5b5d 0a20 2020  gvms else [].   
-000209a0: 2020 2020 2072 6574 7572 6e64 6174 615b       returndata[
-000209b0: 2766 6169 6c65 6476 6d73 275d 203d 2066  'failedvms'] = f
-000209c0: 6169 6c65 6476 6d73 2069 6620 6661 696c  ailedvms if fail
-000209d0: 6564 766d 7320 656c 7365 205b 5d0a 2020  edvms else [].  
-000209e0: 2020 2020 2020 7265 7475 726e 6461 7461        returndata
-000209f0: 5b27 6173 7365 7473 275d 203d 206e 6577  ['assets'] = new
-00020a00: 6173 7365 7473 2069 6620 6e65 7761 7373  assets if newass
-00020a10: 6574 7320 656c 7365 205b 5d0a 2020 2020  ets else [].    
-00020a20: 2020 2020 6966 2066 6169 6c65 6476 6d73      if failedvms
-00020a30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00020a40: 7475 726e 6461 7461 5b27 7265 7375 6c74  turndata['result
-00020a50: 275d 203d 2027 6661 696c 7572 6527 0a20  '] = 'failure'. 
-00020a60: 2020 2020 2020 2020 2020 2066 6169 6c65             faile
-00020a70: 646e 616d 6573 203d 2027 2c27 2e6a 6f69  dnames = ','.joi
-00020a80: 6e28 5b76 5b27 6e61 6d65 275d 2066 6f72  n([v['name'] for
-00020a90: 2076 2069 6e20 6661 696c 6564 766d 735d   v in failedvms]
-00020aa0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00020ab0: 7475 726e 6461 7461 5b27 7265 6173 6f6e  turndata['reason
-00020ac0: 275d 203d 2066 2754 6865 2066 6f6c 6c6f  '] = f'The follo
-00020ad0: 7769 6e67 2076 6d73 2066 6169 6c65 643a  wing vms failed:
-00020ae0: 207b 6661 696c 6564 6e61 6d65 737d 270a   {failednames}'.
-00020af0: 2020 2020 2020 2020 6966 2067 6574 6261          if getba
-00020b00: 636b 206f 7220 746f 636c 6561 6e3a 0a20  ck or toclean:. 
-00020b10: 2020 2020 2020 2020 2020 206f 732e 6368             os.ch
-00020b20: 6469 7228 272e 2e27 290a 2020 2020 2020  dir('..').      
-00020b30: 2020 6966 2074 6f63 6c65 616e 3a0a 2020    if toclean:.  
-00020b40: 2020 2020 2020 2020 2020 726d 7472 6565            rmtree
-00020b50: 2870 6174 6829 0a20 2020 2020 2020 2069  (path).        i
-00020b60: 6620 696e 7075 7473 7472 696e 6720 6973  f inputstring is
-00020b70: 206e 6f74 204e 6f6e 6520 616e 6420 6f73   not None and os
-00020b80: 2e70 6174 682e 6578 6973 7473 2866 2274  .path.exists(f"t
-00020b90: 656d 705f 706c 616e 5f7b 706c 616e 7d2e  emp_plan_{plan}.
-00020ba0: 796d 6c22 293a 0a20 2020 2020 2020 2020  yml"):.         
-00020bb0: 2020 206f 732e 7265 6d6f 7665 2866 2274     os.remove(f"t
-00020bc0: 656d 705f 706c 616e 5f7b 706c 616e 7d2e  emp_plan_{plan}.
-00020bd0: 796d 6c22 290a 2020 2020 2020 2020 666f  yml").        fo
-00020be0: 7220 656e 7472 7920 696e 2061 7379 6e63  r entry in async
-00020bf0: 7761 6974 766d 733a 0a20 2020 2020 2020  waitvms:.       
-00020c00: 2020 2020 206e 616d 652c 2066 696e 6973       name, finis
-00020c10: 6866 696c 6573 203d 2065 6e74 7279 5b27  hfiles = entry['
-00020c20: 6e61 6d65 275d 2c20 656e 7472 795b 2766  name'], entry['f
-00020c30: 696e 6973 6866 696c 6573 275d 0a20 2020  inishfiles'].   
-00020c40: 2020 2020 2020 2020 2077 6169 7463 6f6d           waitcom
-00020c50: 6d61 6e64 2c20 7761 6974 7469 6d65 6f75  mand, waittimeou
-00020c60: 7420 3d20 656e 7472 795b 2777 6169 7463  t = entry['waitc
-00020c70: 6f6d 6d61 6e64 275d 2c20 656e 7472 795b  ommand'], entry[
-00020c80: 2777 6169 7474 696d 656f 7574 275d 0a20  'waittimeout']. 
-00020c90: 2020 2020 2020 2020 2020 2076 6d63 6c69             vmcli
-00020ca0: 656e 7420 3d20 656e 7472 795b 2776 6d63  ent = entry['vmc
-00020cb0: 6c69 656e 7427 5d0a 2020 2020 2020 2020  lient'].        
-00020cc0: 2020 2020 7365 6c66 2e77 6169 745f 6669      self.wait_fi
-00020cd0: 6e69 7368 286e 616d 652c 2077 6169 7463  nish(name, waitc
-00020ce0: 6f6d 6d61 6e64 3d77 6169 7463 6f6d 6d61  ommand=waitcomma
-00020cf0: 6e64 2c20 7761 6974 7469 6d65 6f75 743d  nd, waittimeout=
-00020d00: 7761 6974 7469 6d65 6f75 742c 2076 6d63  waittimeout, vmc
-00020d10: 6c69 656e 743d 766d 636c 6965 6e74 290a  lient=vmclient).
-00020d20: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00020d30: 696e 6973 6866 696c 6573 3a0a 2020 2020  inishfiles:.    
-00020d40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00020d50: 2e68 616e 646c 655f 6669 6e69 7368 6669  .handle_finishfi
-00020d60: 6c65 7328 6e61 6d65 2c20 6669 6e69 7368  les(name, finish
-00020d70: 6669 6c65 732c 2076 6d63 6c69 656e 743d  files, vmclient=
-00020d80: 766d 636c 6965 6e74 290a 2020 2020 2020  vmclient).      
-00020d90: 2020 706f 7374 5f73 6372 6970 7420 3d20    post_script = 
-00020da0: 6627 7b69 6e70 7574 6469 727d 2f6b 636c  f'{inputdir}/kcl
-00020db0: 695f 706f 7374 2e73 6827 0a20 2020 2020  i_post.sh'.     
-00020dc0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-00020dd0: 6973 7473 2870 6f73 745f 7363 7269 7074  ists(post_script
-00020de0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00020df0: 6620 706f 7374 3a0a 2020 2020 2020 2020  f post:.        
-00020e00: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-00020e10: 5275 6e6e 696e 6720 6b63 6c69 5f70 6f73  Running kcli_pos
-00020e20: 742e 7368 2229 0a20 2020 2020 2020 2020  t.sh").         
-00020e30: 2020 2020 2020 2077 6974 6820 5465 6d70         with Temp
-00020e40: 6f72 6172 7944 6972 6563 746f 7279 2829  oraryDirectory()
-00020e50: 2061 7320 746d 7064 6972 3a0a 2020 2020   as tmpdir:.    
-00020e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e70: 706f 7374 5f73 6372 6970 7420 3d20 7365  post_script = se
-00020e80: 6c66 2e70 726f 6365 7373 5f69 6e70 7574  lf.process_input
-00020e90: 6669 6c65 2827 7878 7827 2c20 706f 7374  file('xxx', post
-00020ea0: 5f73 6372 6970 742c 206f 7665 7272 6964  _script, overrid
-00020eb0: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
-00020ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ed0: 2020 7769 7468 206f 7065 6e28 6622 7b74    with open(f"{t
-00020ee0: 6d70 6469 727d 2f70 6f73 742e 7368 222c  mpdir}/post.sh",
-00020ef0: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
-00020f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f10: 2020 2020 662e 7772 6974 6528 706f 7374      f.write(post
-00020f20: 5f73 6372 6970 7429 0a20 2020 2020 2020  _script).       
-00020f30: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00020f40: 745f 7275 6e20 3d20 7275 6e28 6627 6261  t_run = run(f'ba
-00020f50: 7368 207b 746d 7064 6972 7d2f 706f 7374  sh {tmpdir}/post
-00020f60: 2e73 6827 2c20 7368 656c 6c3d 5472 7565  .sh', shell=True
-00020f70: 2c20 7374 646f 7574 3d50 4950 452c 2073  , stdout=PIPE, s
-00020f80: 7464 6572 723d 5354 444f 5554 2c0a 2020  tderr=STDOUT,.  
-00020f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fb0: 2075 6e69 7665 7273 616c 5f6e 6577 6c69   universal_newli
-00020fc0: 6e65 733d 5472 7565 290a 2020 2020 2020  nes=True).      
-00020fd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00020fe0: 2070 6f73 745f 7275 6e2e 7265 7475 726e   post_run.return
-00020ff0: 636f 6465 2021 3d20 303a 0a20 2020 2020  code != 0:.     
-00021000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021010: 2020 206d 7367 203d 2066 2249 7373 7565     msg = f"Issue
-00021020: 2077 6865 6e20 7275 6e6e 696e 6720 6b63   when running kc
-00021030: 6c69 5f70 6f73 742e 7368 203a 5c6e 7b70  li_post.sh :\n{p
-00021040: 6f73 745f 7275 6e2e 7374 646f 7574 7d22  ost_run.stdout}"
-00021050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021060: 2020 2020 2020 2020 2065 7272 6f72 286d           error(m
-00021070: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
-00021080: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00021090: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
-000210a0: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
-000210b0: 273a 206d 7367 7d0a 2020 2020 2020 2020  ': msg}.        
-000210c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000210d0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-000210e0: 6728 2253 6b69 7070 696e 6720 6b63 6c69  g("Skipping kcli
-000210f0: 5f70 6f73 742e 7368 2061 7320 7265 7175  _post.sh as requ
-00021100: 6573 7465 6422 290a 2020 2020 2020 2020  ested").        
-00021110: 6966 206f 7665 7272 6964 6573 2e67 6574  if overrides.get
-00021120: 2827 7465 6d70 6b65 7964 6972 2729 2069  ('tempkeydir') i
-00021130: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00021140: 2020 2020 2020 2020 6f76 6572 7269 6465          override
-00021150: 732e 6765 7428 2774 656d 706b 6579 6469  s.get('tempkeydi
-00021160: 7227 292e 636c 6561 6e75 7028 290a 2020  r').cleanup().  
-00021170: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
-00021180: 7572 6e64 6174 610a 0a20 2020 2064 6566  urndata..    def
-00021190: 2068 616e 646c 655f 686f 7374 2873 656c   handle_host(sel
-000211a0: 662c 2070 6f6f 6c3d 4e6f 6e65 2c20 696d  f, pool=None, im
-000211b0: 6167 653d 4e6f 6e65 2c20 7377 6974 6368  age=None, switch
-000211c0: 3d4e 6f6e 652c 2064 6f77 6e6c 6f61 643d  =None, download=
-000211d0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-000211e0: 2020 2020 2020 2020 2020 2075 726c 3d4e             url=N
-000211f0: 6f6e 652c 2063 6d64 3d4e 6f6e 652c 2073  one, cmd=None, s
-00021200: 796e 633d 4661 6c73 652c 2073 697a 653d  ync=False, size=
-00021210: 4e6f 6e65 2c20 6172 6368 3d27 7838 365f  None, arch='x86_
-00021220: 3634 272c 0a20 2020 2020 2020 2020 2020  64',.           
-00021230: 2020 2020 2020 2020 206b 766d 5f6f 7065           kvm_ope
-00021240: 6e73 7461 636b 3d54 7275 652c 2072 6863  nstack=True, rhc
-00021250: 6f73 5f63 6f6d 6d69 743d 4e6f 6e65 2c20  os_commit=None, 
-00021260: 7268 636f 735f 696e 7374 616c 6c65 723d  rhcos_installer=
-00021270: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00021280: 6966 2064 6f77 6e6c 6f61 643a 0a20 2020  if download:.   
-00021290: 2020 2020 2020 2020 206b 203d 2073 656c           k = sel
-000212a0: 662e 6b0a 2020 2020 2020 2020 2020 2020  f.k.            
-000212b0: 6966 2070 6f6f 6c20 6973 204e 6f6e 653a  if pool is None:
-000212c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000212d0: 2070 6f6f 6c20 3d20 7365 6c66 2e70 6f6f   pool = self.poo
-000212e0: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-000212f0: 2020 7070 7269 6e74 2866 2255 7369 6e67    pprint(f"Using
-00021300: 2070 6f6f 6c20 7b70 6f6f 6c7d 2229 0a20   pool {pool}"). 
-00021310: 2020 2020 2020 2020 2020 2069 6620 696d             if im
-00021320: 6167 6520 6973 206e 6f74 204e 6f6e 653a  age is not None:
-00021330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021340: 2069 6620 7572 6c20 6973 204e 6f6e 653a   if url is None:
-00021350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021360: 2020 2020 2069 6620 6172 6368 2021 3d20       if arch != 
-00021370: 2778 3836 5f36 3427 3a0a 2020 2020 2020  'x86_64':.      
-00021380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021390: 2020 494d 4147 4553 2e75 7064 6174 6528    IMAGES.update(
-000213a0: 7b69 3a20 494d 4147 4553 5b69 5d2e 7265  {i: IMAGES[i].re
-000213b0: 706c 6163 6528 2778 3836 5f36 3427 2c20  place('x86_64', 
-000213c0: 6172 6368 292e 7265 706c 6163 6528 2761  arch).replace('a
-000213d0: 6d64 3634 272c 2061 7263 6829 0a20 2020  md64', arch).   
-000213e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000213f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021400: 2020 2020 666f 7220 6920 696e 2049 4d41      for i in IMA
-00021410: 4745 537d 290a 2020 2020 2020 2020 2020  GES}).          
-00021420: 2020 2020 2020 2020 2020 6966 2069 6d61            if ima
-00021430: 6765 206e 6f74 2069 6e20 494d 4147 4553  ge not in IMAGES
-00021440: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021450: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00021460: 6622 496d 6167 6520 7b69 6d61 6765 7d20  f"Image {image} 
-00021470: 6861 7320 6e6f 2061 7373 6f63 6961 7465  has no associate
-00021480: 6420 7572 6c22 290a 2020 2020 2020 2020  d url").        
-00021490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000214a0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-000214b0: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-000214c0: 6173 6f6e 273a 2022 496e 636f 7272 6563  ason': "Incorrec
-000214d0: 7420 696d 6167 6522 7d0a 2020 2020 2020  t image"}.      
-000214e0: 2020 2020 2020 2020 2020 2020 2020 7572                ur
-000214f0: 6c20 3d20 494d 4147 4553 5b69 6d61 6765  l = IMAGES[image
-00021500: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00021510: 2020 2020 2020 696d 6167 655f 7479 7065        image_type
-00021520: 203d 2073 656c 662e 7479 7065 0a20 2020   = self.type.   
-00021530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021540: 2069 6620 6b76 6d5f 6f70 656e 7374 6163   if kvm_openstac
-00021550: 6b20 616e 6420 7365 6c66 2e74 7970 6520  k and self.type 
-00021560: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
-00021570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021580: 2020 696d 6167 655f 7479 7065 203d 2027    image_type = '
-00021590: 6f70 656e 7374 6163 6b27 0a20 2020 2020  openstack'.     
-000215a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000215b0: 6620 7365 6c66 2e74 7970 6520 3d3d 2022  f self.type == "
-000215c0: 7072 6f78 6d6f 7822 3a0a 2020 2020 2020  proxmox":.      
-000215d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000215e0: 2020 696d 6167 655f 7479 7065 203d 2027    image_type = '
-000215f0: 6b76 6d27 0a20 2020 2020 2020 2020 2020  kvm'.           
-00021600: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00021610: 6b76 6d5f 6f70 656e 7374 6163 6b20 616e  kvm_openstack an
-00021620: 6420 7365 6c66 2e74 7970 6520 3d3d 2027  d self.type == '
-00021630: 6b76 6d27 3a0a 2020 2020 2020 2020 2020  kvm':.          
-00021640: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00021650: 6167 6520 2b3d 2022 2d71 656d 7522 0a20  age += "-qemu". 
-00021660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021670: 2020 2069 6620 2772 6863 6f73 2720 696e     if 'rhcos' in
-00021680: 2069 6d61 6765 2061 6e64 206e 6f74 2069   image and not i
-00021690: 6d61 6765 2e65 6e64 7377 6974 6828 2771  mage.endswith('q
-000216a0: 636f 7732 2e67 7a27 293a 0a20 2020 2020  cow2.gz'):.     
-000216b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216c0: 2020 2069 6620 7268 636f 735f 636f 6d6d     if rhcos_comm
-000216d0: 6974 2069 7320 6e6f 7420 4e6f 6e65 3a0a  it is not None:.
-000216e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216f0: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
-00021700: 3d20 636f 6d6d 6f6e 2e67 6574 5f63 6f6d  = common.get_com
-00021710: 6d69 745f 7268 636f 7328 7268 636f 735f  mit_rhcos(rhcos_
-00021720: 636f 6d6d 6974 2c20 5f74 7970 653d 696d  commit, _type=im
-00021730: 6167 655f 7479 7065 290a 2020 2020 2020  age_type).      
-00021740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021750: 2020 656c 6966 2072 6863 6f73 5f69 6e73    elif rhcos_ins
-00021760: 7461 6c6c 6572 3a0a 2020 2020 2020 2020  taller:.        
-00021770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021780: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
-00021790: 5041 5448 275d 202b 3d20 6627 3a7b 6f73  PATH'] += f':{os
-000217a0: 2e67 6574 6377 6428 297d 270a 2020 2020  .getcwd()}'.    
-000217b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000217c0: 2020 2020 2020 2020 7572 6c20 3d20 636f          url = co
-000217d0: 6d6d 6f6e 2e67 6574 5f69 6e73 7461 6c6c  mmon.get_install
-000217e0: 6572 5f72 6863 6f73 285f 7479 7065 3d69  er_rhcos(_type=i
-000217f0: 6d61 6765 5f74 7970 652c 2061 7263 683d  mage_type, arch=
-00021800: 6172 6368 290a 2020 2020 2020 2020 2020  arch).          
-00021810: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00021820: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00021830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021840: 6966 2061 7263 6820 213d 2027 7838 365f  if arch != 'x86_
-00021850: 3634 273a 0a20 2020 2020 2020 2020 2020  64':.           
-00021860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021870: 2020 2020 2075 726c 202b 3d20 6627 2d7b       url += f'-{
-00021880: 6172 6368 7d27 0a20 2020 2020 2020 2020  arch}'.         
-00021890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218a0: 2020 2075 726c 203d 2063 6f6d 6d6f 6e2e     url = common.
-000218b0: 6765 745f 6c61 7465 7374 5f72 6863 6f73  get_latest_rhcos
-000218c0: 2875 726c 2c20 5f74 7970 653d 696d 6167  (url, _type=imag
-000218d0: 655f 7479 7065 2c20 6172 6368 3d61 7263  e_type, arch=arc
-000218e0: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-000218f0: 2020 2020 2020 2069 6620 2766 636f 7327         if 'fcos'
-00021900: 2069 6e20 696d 6167 653a 0a20 2020 2020   in image:.     
-00021910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021920: 2020 2075 726c 203d 2063 6f6d 6d6f 6e2e     url = common.
-00021930: 6765 745f 6c61 7465 7374 5f66 636f 7328  get_latest_fcos(
-00021940: 7572 6c2c 205f 7479 7065 3d69 6d61 6765  url, _type=image
-00021950: 5f74 7970 6529 0a20 2020 2020 2020 2020  _type).         
-00021960: 2020 2020 2020 2020 2020 2069 6620 696d             if im
-00021970: 6167 6520 3d3d 2027 6665 646f 7261 6c61  age == 'fedorala
-00021980: 7465 7374 273a 0a20 2020 2020 2020 2020  test':.         
-00021990: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-000219a0: 726c 203d 2063 6f6d 6d6f 6e2e 6765 745f  rl = common.get_
-000219b0: 6c61 7465 7374 5f66 6564 6f72 6128 7572  latest_fedora(ur
-000219c0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-000219d0: 2020 2020 2020 2069 6d61 6765 203d 206f         image = o
-000219e0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-000219f0: 696d 6167 6529 0a20 2020 2020 2020 2020  image).         
-00021a00: 2020 2020 2020 2020 2020 2069 6620 696d             if im
-00021a10: 6167 652e 7374 6172 7473 7769 7468 2827  age.startswith('
-00021a20: 7268 656c 2729 3a0a 2020 2020 2020 2020  rhel'):.        
-00021a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a40: 6966 2027 7765 6227 2069 6e20 7379 732e  if 'web' in sys.
-00021a50: 6172 6776 5b30 5d3a 0a20 2020 2020 2020  argv[0]:.       
-00021a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a70: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00021a80: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
-00021a90: 2c20 2772 6561 736f 6e27 3a20 224d 6973  , 'reason': "Mis
-00021aa0: 7369 6e67 2075 726c 227d 0a20 2020 2020  sing url"}.     
-00021ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ac0: 2020 2070 7072 696e 7428 6622 4f70 656e     pprint(f"Open
-00021ad0: 696e 6720 7572 6c20 7b75 726c 7d20 666f  ing url {url} fo
-00021ae0: 7220 796f 7520 746f 2067 7261 6220 636f  r you to grab co
-00021af0: 6d70 6c65 7465 2075 726c 2066 6f72 207b  mplete url for {
-00021b00: 696d 6167 657d 206b 766d 2067 7565 7374  image} kvm guest
-00021b10: 2069 6d61 6765 2229 0a20 2020 2020 2020   image").       
-00021b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b30: 2077 6562 6272 6f77 7365 722e 6f70 656e   webbrowser.open
-00021b40: 2875 726c 2c20 6e65 773d 322c 2061 7574  (url, new=2, aut
-00021b50: 6f72 6169 7365 3d54 7275 6529 0a20 2020  oraise=True).   
-00021b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b70: 2020 2020 2075 726c 203d 2069 6e70 7574       url = input
-00021b80: 2822 436f 7079 2055 726c 3a5c 6e22 290a  ("Copy Url:\n").
-00021b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ba0: 2020 2020 2020 2020 6966 2075 726c 2e73          if url.s
-00021bb0: 7472 6970 2829 203d 3d20 2727 3a0a 2020  trip() == '':.  
-00021bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021bd0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00021be0: 224d 6973 7369 6e67 2070 726f 7065 7220  "Missing proper 
-00021bf0: 7572 6c2e 4c65 6176 696e 672e 2e2e 2229  url.Leaving...")
-00021c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021c10: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00021c20: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00021c30: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
-00021c40: 6e27 3a20 224d 6973 7369 6e67 2069 6d61  n': "Missing ima
-00021c50: 6765 227d 0a20 2020 2020 2020 2020 2020  ge"}.           
-00021c60: 2020 2020 2069 6620 636d 6420 6973 204e       if cmd is N
-00021c70: 6f6e 6520 616e 6420 696d 6167 6520 213d  one and image !=
-00021c80: 2027 2720 616e 6420 696d 6167 6520 696e   '' and image in
-00021c90: 2049 4d41 4745 5343 4f4d 4d41 4e44 533a   IMAGESCOMMANDS:
-00021ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021cb0: 2020 2020 2063 6d64 203d 2049 4d41 4745       cmd = IMAGE
-00021cc0: 5343 4f4d 4d41 4e44 535b 696d 6167 655d  SCOMMANDS[image]
-00021cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021ce0: 2070 7072 696e 7428 6622 4772 6162 6269   pprint(f"Grabbi
-00021cf0: 6e67 2069 6d61 6765 207b 696d 6167 657d  ng image {image}
-00021d00: 2066 726f 6d20 7572 6c20 7b75 726c 7d22   from url {url}"
-00021d10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00021d20: 2020 6e65 6564 5f69 736f 203d 2027 6170    need_iso = 'ap
-00021d30: 692f 6173 7369 7374 6564 2d69 6d61 6765  i/assisted-image
-00021d40: 732f 696d 6167 6573 2720 696e 2075 726c  s/images' in url
-00021d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021d60: 2073 686f 7274 6e61 6d65 203d 206f 732e   shortname = os.
-00021d70: 7061 7468 2e62 6173 656e 616d 6528 7572  path.basename(ur
-00021d80: 6c29 2e73 706c 6974 2827 3f27 295b 305d  l).split('?')[0]
-00021d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021da0: 2069 6620 6e65 6564 5f69 736f 3a0a 2020   if need_iso:.  
-00021db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021dc0: 2020 696d 6167 6520 3d20 6627 626f 6f74    image = f'boot
-00021dd0: 2d7b 7368 6f72 746e 616d 657d 2e69 736f  -{shortname}.iso
-00021de0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00021df0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00021e00: 2020 2020 2020 2020 2020 2063 6f6e 7665             conve
-00021e10: 7274 203d 2027 2e72 6177 2e27 2069 6e20  rt = '.raw.' in 
-00021e20: 7572 6c0a 2020 2020 2020 2020 2020 2020  url.            
-00021e30: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00021e40: 206b 2e61 6464 5f69 6d61 6765 2875 726c   k.add_image(url
-00021e50: 2c20 706f 6f6c 2c20 636d 643d 636d 642c  , pool, cmd=cmd,
-00021e60: 206e 616d 653d 696d 6167 652c 2073 697a   name=image, siz
-00021e70: 653d 7369 7a65 2c20 636f 6e76 6572 743d  e=size, convert=
-00021e80: 636f 6e76 6572 7429 0a20 2020 2020 2020  convert).       
-00021e90: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00021ea0: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-00021eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ec0: 2020 2020 6572 726f 7228 6622 476f 7420      error(f"Got 
-00021ed0: 7b65 7d22 290a 2020 2020 2020 2020 2020  {e}").          
-00021ee0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00021ef0: 6622 506c 6561 7365 2072 756e 206b 636c  f"Please run kcl
-00021f00: 6920 6465 6c65 7465 2069 6d61 6765 202d  i delete image -
-00021f10: 2d79 6573 207b 7368 6f72 746e 616d 657d  -yes {shortname}
-00021f20: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00021f30: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-00021f40: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
-00021f50: 6527 2c20 2772 6561 736f 6e27 3a20 2255  e', 'reason': "U
-00021f60: 7365 7220 696e 7465 7272 7570 7469 6f6e  ser interruption
-00021f70: 227d 0a20 2020 2020 2020 2020 2020 2020  "}.             
-00021f80: 2020 2066 6f75 6e64 203d 2027 666f 756e     found = 'foun
-00021f90: 6427 2069 6e20 7265 7375 6c74 0a20 2020  d' in result.   
-00021fa0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00021fb0: 666f 756e 643a 0a20 2020 2020 2020 2020  found:.         
-00021fc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00021fd0: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
-00021fe0: 6363 6573 7327 7d0a 2020 2020 2020 2020  ccess'}.        
-00021ff0: 2020 2020 2020 2020 636f 6d6d 6f6e 2e68          common.h
-00022000: 616e 646c 655f 7265 7370 6f6e 7365 2872  andle_response(r
-00022010: 6573 756c 742c 2069 6d61 6765 2c20 656c  esult, image, el
-00022020: 656d 656e 743d 2749 6d61 6765 272c 2061  ement='Image', a
-00022030: 6374 696f 6e3d 2741 6464 6564 2729 0a20  ction='Added'). 
-00022040: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022050: 6620 7265 7375 6c74 5b27 7265 7375 6c74  f result['result
-00022060: 275d 2021 3d20 2773 7563 6365 7373 273a  '] != 'success':
-00022070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022080: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00022090: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
-000220a0: 2c20 2772 6561 736f 6e27 3a20 7265 7375  , 'reason': resu
-000220b0: 6c74 5b27 7265 6173 6f6e 275d 7d0a 2020  lt['reason']}.  
-000220c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000220d0: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
-000220e0: 6365 7373 277d 0a20 2020 2020 2020 2065  cess'}.        e
-000220f0: 6c69 6620 7377 6974 6368 3a0a 2020 2020  lif switch:.    
-00022100: 2020 2020 2020 2020 6966 2073 7769 7463          if switc
-00022110: 6820 6e6f 7420 696e 2073 656c 662e 636c  h not in self.cl
-00022120: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
-00022130: 2020 2020 2020 2065 7272 6f72 2866 2243         error(f"C
-00022140: 6c69 656e 7420 7b73 7769 7463 687d 206e  lient {switch} n
-00022150: 6f74 2066 6f75 6e64 2069 6e20 636f 6e66  ot found in conf
-00022160: 6967 2e4c 6561 7669 6e67 2e2e 2e2e 2229  ig.Leaving....")
+0001fa90: 2020 2020 6375 7374 6f6d 7072 6f66 696c      customprofil
+0001faa0: 652e 6765 7428 2776 6f6c 756d 6573 2729  e.get('volumes')
+0001fab0: 2c20 6375 7374 6f6d 7072 6f66 696c 652e  , customprofile.
+0001fac0: 6765 7428 2764 6973 6b73 2729 5d0a 2020  get('disks')].  
+0001fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fae0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001faf0: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
+0001fb00: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+0001fb10: 2020 2020 2020 2065 6e76 6972 6f6e 6d65         environme
+0001fb20: 6e74 203d 206e 6578 7428 2865 2066 6f72  nt = next((e for
+0001fb30: 2065 2069 6e20 5b70 726f 6669 6c65 2e67   e in [profile.g
+0001fb40: 6574 2827 656e 7669 726f 6e6d 656e 7427  et('environment'
+0001fb50: 292c 2063 7573 746f 6d70 726f 6669 6c65  ), customprofile
+0001fb60: 2e67 6574 2827 656e 7669 726f 6e6d 656e  .get('environmen
+0001fb70: 7427 295d 0a20 2020 2020 2020 2020 2020  t')].           
+0001fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb90: 2020 2020 2020 2020 2069 6620 6520 6973           if e is
+0001fba0: 206e 6f74 204e 6f6e 6529 2c20 4e6f 6e65   not None), None
+0001fbb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001fbc0: 2020 636d 6473 203d 206e 6578 7428 2865    cmds = next((e
+0001fbd0: 2066 6f72 2065 2069 6e20 5b70 726f 6669   for e in [profi
+0001fbe0: 6c65 2e67 6574 2827 636d 6473 2729 2c20  le.get('cmds'), 
+0001fbf0: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
+0001fc00: 7428 2763 6d64 7327 295d 2069 6620 6520  t('cmds')] if e 
+0001fc10: 6973 206e 6f74 204e 6f6e 6529 2c20 5b5d  is not None), []
+0001fc20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001fc30: 2020 7375 6363 6573 7328 6622 436f 6e74    success(f"Cont
+0001fc40: 6169 6e65 7220 7b63 6f6e 7461 696e 6572  ainer {container
+0001fc50: 7dc2 a064 6570 6c6f 7965 6421 2229 0a20  }..deployed!"). 
+0001fc60: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001fc70: 6f6e 742e 6372 6561 7465 5f63 6f6e 7461  ont.create_conta
+0001fc80: 696e 6572 286e 616d 653d 636f 6e74 6169  iner(name=contai
+0001fc90: 6e65 722c 2069 6d61 6765 3d63 6f6e 7461  ner, image=conta
+0001fca0: 696e 6572 696d 6167 652c 206e 6574 733d  inerimage, nets=
+0001fcb0: 6e65 7473 2c20 636d 6473 3d63 6d64 732c  nets, cmds=cmds,
+0001fcc0: 2070 6f72 7473 3d70 6f72 7473 2c0a 2020   ports=ports,.  
+0001fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fcf0: 2020 2020 766f 6c75 6d65 733d 766f 6c75      volumes=volu
+0001fd00: 6d65 732c 2065 6e76 6972 6f6e 6d65 6e74  mes, environment
+0001fd10: 3d65 6e76 6972 6f6e 6d65 6e74 2c20 6c61  =environment, la
+0001fd20: 6265 6c3d 6c61 6265 6c29 0a20 2020 2020  bel=label).     
+0001fd30: 2020 2069 6620 646e 7365 6e74 7269 6573     if dnsentries
+0001fd40: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
+0001fd50: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+0001fd60: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
+0001fd70: 6e67 2044 6e73 2045 6e74 7269 6573 2e2e  ng Dns Entries..
+0001fd80: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0001fd90: 646e 7363 6c69 656e 7473 203d 207b 7d0a  dnsclients = {}.
+0001fda0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001fdb0: 646e 7365 6e74 7279 2069 6e20 646e 7365  dnsentry in dnse
+0001fdc0: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
+0001fdd0: 2020 2020 2020 2020 646e 7370 726f 6669          dnsprofi
+0001fde0: 6c65 203d 2065 6e74 7269 6573 5b64 6e73  le = entries[dns
+0001fdf0: 656e 7472 795d 0a20 2020 2020 2020 2020  entry].         
+0001fe00: 2020 2020 2020 2064 6e73 646f 6d61 696e         dnsdomain
+0001fe10: 203d 2064 6e73 7072 6f66 696c 652e 6765   = dnsprofile.ge
+0001fe20: 7428 2764 6f6d 6169 6e27 290a 2020 2020  t('domain').    
+0001fe30: 2020 2020 2020 2020 2020 2020 646e 736e              dnsn
+0001fe40: 6574 203d 2064 6e73 7072 6f66 696c 652e  et = dnsprofile.
+0001fe50: 6765 7428 276e 6574 272c 2027 6465 6661  get('net', 'defa
+0001fe60: 756c 7427 290a 2020 2020 2020 2020 2020  ult').          
+0001fe70: 2020 2020 2020 646e 7369 7020 3d20 646e        dnsip = dn
+0001fe80: 7370 726f 6669 6c65 2e67 6574 2827 6970  sprofile.get('ip
+0001fe90: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0001fea0: 2020 2064 6e73 616c 6961 7320 3d20 646e     dnsalias = dn
+0001feb0: 7370 726f 6669 6c65 2e67 6574 2827 616c  sprofile.get('al
+0001fec0: 6961 7327 2c20 5b5d 290a 2020 2020 2020  ias', []).      
+0001fed0: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
+0001fee0: 656e 7420 3d20 646e 7370 726f 6669 6c65  ent = dnsprofile
+0001fef0: 2e67 6574 2827 636c 6965 6e74 2729 0a20  .get('client'). 
+0001ff00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001ff10: 6620 646e 7363 6c69 656e 7420 6973 204e  f dnsclient is N
+0001ff20: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001ff30: 2020 2020 2020 2020 207a 203d 206b 0a20           z = k. 
+0001ff40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001ff50: 6c69 6620 646e 7363 6c69 656e 7420 696e  lif dnsclient in
+0001ff60: 2064 6e73 636c 6965 6e74 733a 0a20 2020   dnsclients:.   
+0001ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff80: 207a 203d 2064 6e73 636c 6965 6e74 735b   z = dnsclients[
+0001ff90: 646e 7363 6c69 656e 745d 0a20 2020 2020  dnsclient].     
+0001ffa0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001ffb0: 646e 7363 6c69 656e 7420 696e 2073 656c  dnsclient in sel
+0001ffc0: 662e 636c 6965 6e74 733a 0a20 2020 2020  f.clients:.     
+0001ffd0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+0001ffe0: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
+0001fff0: 743d 646e 7363 6c69 656e 7429 2e6b 0a20  t=dnsclient).k. 
+00020000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020010: 2020 2064 6e73 636c 6965 6e74 735b 646e     dnsclients[dn
+00020020: 7363 6c69 656e 745d 203d 207a 0a20 2020  sclient] = z.   
+00020030: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00020040: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00020050: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+00020060: 2243 6c69 656e 7420 7b64 6e73 636c 6965  "Client {dnsclie
+00020070: 6e74 7d20 6e6f 7420 666f 756e 642e 2053  nt} not found. S
+00020080: 6b69 7070 696e 6722 290a 2020 2020 2020  kipping").      
+00020090: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000200a0: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
+000200b0: 2020 2020 2069 6620 646e 7369 7020 6973       if dnsip is
+000200c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000200d0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+000200e0: 6e67 2822 4d69 7373 696e 6720 6970 2e20  ng("Missing ip. 
+000200f0: 536b 6970 7069 6e67 2122 290a 2020 2020  Skipping!").    
+00020100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020110: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
+00020120: 2020 2020 2020 2069 6620 646e 736e 6574         if dnsnet
+00020130: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00020140: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+00020150: 726e 696e 6728 224d 6973 7369 6e67 206e  rning("Missing n
+00020160: 6574 2e20 536b 6970 7069 6e67 2122 290a  et. Skipping!").
+00020170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020180: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00020190: 2020 2020 2020 2020 2020 207a 2e72 6573             z.res
+000201a0: 6572 7665 5f64 6e73 286e 616d 653d 646e  erve_dns(name=dn
+000201b0: 7365 6e74 7279 2c20 6e65 7473 3d5b 646e  sentry, nets=[dn
+000201c0: 736e 6574 5d2c 2064 6f6d 6169 6e3d 646e  snet], domain=dn
+000201d0: 7364 6f6d 6169 6e2c 2069 703d 646e 7369  sdomain, ip=dnsi
+000201e0: 702c 2061 6c69 6173 3d64 6e73 616c 6961  p, alias=dnsalia
+000201f0: 732c 2066 6f72 6365 3d54 7275 652c 0a20  s, force=True,. 
+00020200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020210: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00020220: 6d61 7279 3d54 7275 6529 0a20 2020 2020  mary=True).     
+00020230: 2020 2069 6620 616e 7369 626c 6565 6e74     if ansibleent
+00020240: 7269 6573 2061 6e64 206e 6f74 206f 6e6c  ries and not onl
+00020250: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
+00020260: 2020 2020 2069 6620 6e6f 7420 6e65 7776       if not newv
+00020270: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00020280: 2020 2020 7761 726e 696e 6728 2241 6e73      warning("Ans
+00020290: 6962 6c65 2073 6b69 7070 6564 2061 7320  ible skipped as 
+000202a0: 6e6f 206e 6577 2076 6d20 7769 7468 696e  no new vm within
+000202b0: 2070 6c61 7962 6f6f 6b20 7072 6f76 6973   playbook provis
+000202c0: 696f 6e65 6422 290a 2020 2020 2020 2020  ioned").        
+000202d0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+000202e0: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
+000202f0: 6e74 7279 2069 6e20 736f 7274 6564 2861  ntry in sorted(a
+00020300: 6e73 6962 6c65 656e 7472 6965 7329 3a0a  nsibleentries):.
+00020310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020320: 5f61 6e73 6962 6c65 203d 2065 6e74 7269  _ansible = entri
+00020330: 6573 5b65 6e74 7279 5d0a 2020 2020 2020  es[entry].      
+00020340: 2020 2020 2020 2020 2020 6966 2027 706c            if 'pl
+00020350: 6179 626f 6f6b 2720 6e6f 7420 696e 205f  aybook' not in _
+00020360: 616e 7369 626c 653a 0a20 2020 2020 2020  ansible:.       
+00020370: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00020380: 6f72 2822 4d69 7373 696e 6720 506c 6179  or("Missing Play
+00020390: 626f 6f6b 2066 6f72 2061 6e73 6962 6c65  book for ansible
+000203a0: 2e49 676e 6f72 696e 672e 2e2e 2229 0a20  .Ignoring..."). 
+000203b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203c0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+000203d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000203e0: 6c61 7962 6f6f 6b20 3d20 5f61 6e73 6962  laybook = _ansib
+000203f0: 6c65 5b27 706c 6179 626f 6f6b 275d 0a20  le['playbook']. 
+00020400: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00020410: 6572 626f 7365 203d 205f 616e 7369 626c  erbose = _ansibl
+00020420: 655b 2776 6572 626f 7365 275d 2069 6620  e['verbose'] if 
+00020430: 2776 6572 626f 7365 2720 696e 205f 616e  'verbose' in _an
+00020440: 7369 626c 6520 656c 7365 2046 616c 7365  sible else False
+00020450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020460: 2067 726f 7570 7320 3d20 5f61 6e73 6962   groups = _ansib
+00020470: 6c65 2e67 6574 2827 6772 6f75 7073 272c  le.get('groups',
+00020480: 207b 7d29 0a20 2020 2020 2020 2020 2020   {}).           
+00020490: 2020 2020 2075 7365 7220 3d20 5f61 6e73       user = _ans
+000204a0: 6962 6c65 2e67 6574 2827 7573 6572 2729  ible.get('user')
+000204b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000204c0: 2076 6172 6961 626c 6573 203d 205f 616e   variables = _an
+000204d0: 7369 626c 652e 6765 7428 2776 6172 6961  sible.get('varia
+000204e0: 626c 6573 272c 207b 7d29 0a20 2020 2020  bles', {}).     
+000204f0: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+00020500: 7476 6d73 203d 205b 766d 2066 6f72 2076  tvms = [vm for v
+00020510: 6d20 696e 205f 616e 7369 626c 655b 2776  m in _ansible['v
+00020520: 6d73 275d 2069 6620 766d 2069 6e20 6e65  ms'] if vm in ne
+00020530: 7776 6d73 5d20 6966 2027 766d 7327 2069  wvms] if 'vms' i
+00020540: 6e20 5f61 6e73 6962 6c65 2065 6c73 6520  n _ansible else 
+00020550: 6e65 7776 6d73 0a20 2020 2020 2020 2020  newvms.         
+00020560: 2020 2020 2020 2069 6620 6e6f 7420 7461         if not ta
+00020570: 7267 6574 766d 733a 0a20 2020 2020 2020  rgetvms:.       
+00020580: 2020 2020 2020 2020 2020 2020 2077 6172               war
+00020590: 6e69 6e67 2822 416e 7369 626c 6520 736b  ning("Ansible sk
+000205a0: 6970 7065 6420 6173 206e 6f20 6e65 7720  ipped as no new 
+000205b0: 766d 2077 6974 6869 6e20 706c 6179 626f  vm within playbo
+000205c0: 6f6b 2070 726f 7669 7369 6f6e 6564 2229  ok provisioned")
+000205d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000205e0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+000205f0: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
+00020600: 626c 6563 6f6d 6d61 6e64 203d 2022 616e  blecommand = "an
+00020610: 7369 626c 652d 706c 6179 626f 6f6b 220a  sible-playbook".
+00020620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020630: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
+00020640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020650: 616e 7369 626c 6563 6f6d 6d61 6e64 202b  ansiblecommand +
+00020660: 3d20 2220 2d76 7676 220a 2020 2020 2020  = " -vvv".      
+00020670: 2020 2020 2020 2020 2020 696e 7665 6e74            invent
+00020680: 6f72 7966 696c 6520 3d20 6622 2f74 6d70  oryfile = f"/tmp
+00020690: 2f7b 706c 616e 7d2e 696e 762e 7961 6d6c  /{plan}.inv.yaml
+000206a0: 2220 6966 2073 656c 662e 7961 6d6c 696e  " if self.yamlin
+000206b0: 7665 6e74 6f72 7920 656c 7365 2066 222f  ventory else f"/
+000206c0: 746d 702f 7b70 6c61 6e7d 2e69 6e76 220a  tmp/{plan}.inv".
+000206d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000206e0: 616e 7369 626c 6575 7469 6c73 2e6d 616b  ansibleutils.mak
+000206f0: 655f 706c 616e 5f69 6e76 656e 746f 7279  e_plan_inventory
+00020700: 2876 6d73 5f74 6f5f 686f 7374 2c20 706c  (vms_to_host, pl
+00020710: 616e 2c20 7461 7267 6574 766d 732c 2067  an, targetvms, g
+00020720: 726f 7570 733d 6772 6f75 7073 2c20 7573  roups=groups, us
+00020730: 6572 3d75 7365 722c 0a20 2020 2020 2020  er=user,.       
+00020740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020760: 2020 2020 2020 2020 2020 7961 6d6c 696e            yamlin
+00020770: 7665 6e74 6f72 793d 7365 6c66 2e79 616d  ventory=self.yam
+00020780: 6c69 6e76 656e 746f 7279 2c20 7475 6e6e  linventory, tunn
+00020790: 656c 3d73 656c 662e 7475 6e6e 656c 2c0a  el=self.tunnel,.
+000207a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207d0: 2074 756e 6e65 6c68 6f73 743d 7365 6c66   tunnelhost=self
+000207e0: 2e74 756e 6e65 6c68 6f73 742c 2074 756e  .tunnelhost, tun
+000207f0: 6e65 6c75 7365 723d 7365 6c66 2e74 756e  neluser=self.tun
+00020800: 6e65 6c75 7365 722c 0a20 2020 2020 2020  neluser,.       
+00020810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020830: 2020 2020 2020 2020 2020 7475 6e6e 656c            tunnel
+00020840: 706f 7274 3d73 656c 662e 7475 6e6e 656c  port=self.tunnel
+00020850: 706f 7274 2c20 696e 7365 6375 7265 3d73  port, insecure=s
+00020860: 656c 662e 696e 7365 6375 7265 290a 2020  elf.insecure).  
+00020870: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00020880: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+00020890: 7374 7328 277e 2f2e 616e 7369 626c 652e  sts('~/.ansible.
+000208a0: 6366 6727 293a 0a20 2020 2020 2020 2020  cfg'):.         
+000208b0: 2020 2020 2020 2020 2020 2061 6e73 6962             ansib
+000208c0: 6c65 636f 6e66 6967 203d 206f 732e 7061  leconfig = os.pa
+000208d0: 7468 2e65 7870 616e 6475 7365 7228 277e  th.expanduser('~
+000208e0: 2f2e 616e 7369 626c 652e 6366 6727 290a  /.ansible.cfg').
+000208f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020900: 2020 2020 7769 7468 206f 7065 6e28 616e      with open(an
+00020910: 7369 626c 6563 6f6e 6669 672c 2022 7722  sibleconfig, "w"
+00020920: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+00020930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020940: 662e 7772 6974 6528 225b 7373 685f 636f  f.write("[ssh_co
+00020950: 6e6e 6563 7469 6f6e 5d5c 6e72 6574 7269  nnection]\nretri
+00020960: 6573 3d31 305c 6e22 290a 2020 2020 2020  es=10\n").      
+00020970: 2020 2020 2020 2020 2020 6966 2076 6172            if var
+00020980: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+00020990: 2020 2020 2020 2020 2020 2020 7661 7273              vars
+000209a0: 6669 6c65 203d 2066 222f 746d 702f 7b70  file = f"/tmp/{p
+000209b0: 6c61 6e7d 2e76 6172 732e 796d 6c22 0a20  lan}.vars.yml". 
+000209c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000209d0: 2020 2077 6974 6820 6f70 656e 2876 6172     with open(var
+000209e0: 7366 696c 652c 2027 7727 2920 6173 2066  sfile, 'w') as f
+000209f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00020a00: 2020 2020 2020 2020 2020 7961 6d6c 2e64            yaml.d
+00020a10: 756d 7028 7661 7269 6162 6c65 732c 2066  ump(variables, f
+00020a20: 2c20 6465 6661 756c 745f 666c 6f77 5f73  , default_flow_s
+00020a30: 7479 6c65 3d46 616c 7365 290a 2020 2020  tyle=False).    
+00020a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a50: 616e 7369 626c 6563 6f6d 6d61 6e64 202b  ansiblecommand +
+00020a60: 3d20 6622 202d 2d65 7874 7261 2d76 6172  = f" --extra-var
+00020a70: 7320 407b 7661 7273 6669 6c65 7d22 0a20  s @{varsfile}". 
+00020a80: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00020a90: 6e73 6962 6c65 636f 6d6d 616e 6420 2b3d  nsiblecommand +=
+00020aa0: 2066 2220 2d69 207b 696e 7665 6e74 6f72   f" -i {inventor
+00020ab0: 7966 696c 657d 207b 706c 6179 626f 6f6b  yfile} {playbook
+00020ac0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00020ad0: 2020 2070 7072 696e 7428 6622 5275 6e6e     pprint(f"Runn
+00020ae0: 696e 673a 207b 616e 7369 626c 6563 6f6d  ing: {ansiblecom
+00020af0: 6d61 6e64 7d22 290a 2020 2020 2020 2020  mand}").        
+00020b00: 2020 2020 2020 2020 6f73 2e73 7973 7465          os.syste
+00020b10: 6d28 616e 7369 626c 6563 6f6d 6d61 6e64  m(ansiblecommand
+00020b20: 290a 2020 2020 2020 2020 6966 2061 6e73  ).        if ans
+00020b30: 6962 6c65 2061 6e64 206e 6f74 206f 6e6c  ible and not onl
+00020b40: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
+00020b50: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
+00020b60: 6c6f 7969 6e67 2041 6e73 6962 6c65 2049  loying Ansible I
+00020b70: 6e76 656e 746f 7279 2e2e 2e22 290a 2020  nventory...").  
+00020b80: 2020 2020 2020 2020 2020 696e 7665 6e74            invent
+00020b90: 6f72 7966 696c 6520 3d20 6622 2f74 6d70  oryfile = f"/tmp
+00020ba0: 2f7b 706c 616e 7d2e 696e 762e 7961 6d6c  /{plan}.inv.yaml
+00020bb0: 2220 6966 2073 656c 662e 7961 6d6c 696e  " if self.yamlin
+00020bc0: 7665 6e74 6f72 7920 656c 7365 2066 222f  ventory else f"/
+00020bd0: 746d 702f 7b70 6c61 6e7d 2e69 6e76 220a  tmp/{plan}.inv".
+00020be0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00020bf0: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
+00020c00: 7665 6e74 6f72 7966 696c 6529 3a0a 2020  ventoryfile):.  
+00020c10: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00020c20: 7269 6e74 2866 2249 6e76 656e 746f 7279  rint(f"Inventory
+00020c30: 2069 6e20 7b69 6e76 656e 746f 7279 6669   in {inventoryfi
+00020c40: 6c65 7d20 736b 6970 7065 6421 2229 0a20  le} skipped!"). 
+00020c50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00020c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020c70: 2070 7072 696e 7428 6622 4372 6561 7469   pprint(f"Creati
+00020c80: 6e67 2061 6e73 6962 6c65 2069 6e76 656e  ng ansible inven
+00020c90: 746f 7279 2066 6f72 2070 6c61 6e20 7b70  tory for plan {p
+00020ca0: 6c61 6e7d 2069 6e20 7b69 6e76 656e 746f  lan} in {invento
+00020cb0: 7279 6669 6c65 7d22 290a 2020 2020 2020  ryfile}").      
+00020cc0: 2020 2020 2020 2020 2020 766d 7320 3d20            vms = 
+00020cd0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+00020ce0: 2020 2066 6f72 2076 6d20 696e 2073 6f72     for vm in sor
+00020cf0: 7465 6428 6b2e 6c69 7374 2829 2c20 6b65  ted(k.list(), ke
+00020d00: 793d 6c61 6d62 6461 2078 3a20 785b 276e  y=lambda x: x['n
+00020d10: 616d 6527 5d29 3a0a 2020 2020 2020 2020  ame']):.        
+00020d20: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00020d30: 203d 2076 6d5b 276e 616d 6527 5d0a 2020   = vm['name'].  
+00020d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d50: 2020 6465 7363 7269 7074 696f 6e20 3d20    description = 
+00020d60: 766d 5b27 706c 616e 275d 0a20 2020 2020  vm['plan'].     
+00020d70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00020d80: 6620 6465 7363 7269 7074 696f 6e20 3d3d  f description ==
+00020d90: 2070 6c61 6e3a 0a20 2020 2020 2020 2020   plan:.         
+00020da0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00020db0: 6d73 2e61 7070 656e 6428 6e61 6d65 290a  ms.append(name).
+00020dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020dd0: 616e 7369 626c 6575 7469 6c73 2e6d 616b  ansibleutils.mak
+00020de0: 655f 706c 616e 5f69 6e76 656e 746f 7279  e_plan_inventory
+00020df0: 2876 6d73 5f74 6f5f 686f 7374 2c20 706c  (vms_to_host, pl
+00020e00: 616e 2c20 766d 732c 2079 616d 6c69 6e76  an, vms, yamlinv
+00020e10: 656e 746f 7279 3d73 656c 662e 7961 6d6c  entory=self.yaml
+00020e20: 696e 7665 6e74 6f72 792c 0a20 2020 2020  inventory,.     
+00020e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e50: 2020 2020 2020 2020 2020 2020 696e 7365              inse
+00020e60: 6375 7265 3d73 656c 662e 696e 7365 6375  cure=self.insecu
+00020e70: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
+00020e80: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00020e90: 756c 7427 3a20 2773 7563 6365 7373 272c  ult': 'success',
+00020ea0: 2027 706c 616e 273a 2070 6c61 6e7d 0a20   'plan': plan}. 
+00020eb0: 2020 2020 2020 2069 6620 6c62 7320 616e         if lbs an
+00020ec0: 6420 6e6f 7420 6f6e 6c79 6173 7365 7473  d not onlyassets
+00020ed0: 3a0a 2020 2020 2020 2020 2020 2020 646e  :.            dn
+00020ee0: 7363 6c69 656e 7473 203d 207b 7d0a 2020  sclients = {}.  
+00020ef0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00020f00: 2822 4465 706c 6f79 696e 6720 4c6f 6164  ("Deploying Load
+00020f10: 6261 6c61 6e63 6572 732e 2e2e 2229 0a20  balancers..."). 
+00020f20: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00020f30: 6e64 6578 2c20 6c62 656e 7472 7920 696e  ndex, lbentry in
+00020f40: 2065 6e75 6d65 7261 7465 286c 6273 293a   enumerate(lbs):
+00020f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020f60: 2064 6574 6169 6c73 203d 2065 6e74 7269   details = entri
+00020f70: 6573 5b6c 6265 6e74 7279 5d0a 2020 2020  es[lbentry].    
+00020f80: 2020 2020 2020 2020 2020 2020 706f 7274              port
+00020f90: 7320 3d20 6465 7461 696c 732e 6765 7428  s = details.get(
+00020fa0: 2770 6f72 7473 272c 205b 5d29 0a20 2020  'ports', []).   
+00020fb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00020fc0: 6e6f 7420 706f 7274 733a 0a20 2020 2020  not ports:.     
+00020fd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00020fe0: 7272 6f72 2822 4d69 7373 696e 6720 506f  rror("Missing Po
+00020ff0: 7274 7320 666f 7220 6c6f 6164 6261 6c61  rts for loadbala
+00021000: 6e63 6572 2e20 4e6f 7420 6372 6561 7469  ncer. Not creati
+00021010: 6e67 2069 742e 2e2e 2229 0a20 2020 2020  ng it...").     
+00021020: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00021030: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
+00021040: 2020 2020 2020 6368 6563 6b70 6174 6820        checkpath 
+00021050: 3d20 6465 7461 696c 732e 6765 7428 2763  = details.get('c
+00021060: 6865 636b 7061 7468 272c 2027 2f27 290a  heckpath', '/').
+00021070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021080: 6368 6563 6b70 6f72 7420 3d20 6465 7461  checkport = deta
+00021090: 696c 732e 6765 7428 2763 6865 636b 706f  ils.get('checkpo
+000210a0: 7274 272c 2038 3029 0a20 2020 2020 2020  rt', 80).       
+000210b0: 2020 2020 2020 2020 2061 6c69 6173 203d           alias =
+000210c0: 2064 6574 6169 6c73 2e67 6574 2827 616c   details.get('al
+000210d0: 6961 7327 2c20 5b5d 290a 2020 2020 2020  ias', []).      
+000210e0: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
+000210f0: 203d 2064 6574 6169 6c73 2e67 6574 2827   = details.get('
+00021100: 646f 6d61 696e 2729 0a20 2020 2020 2020  domain').       
+00021110: 2020 2020 2020 2020 2064 6e73 636c 6965           dnsclie
+00021120: 6e74 203d 2064 6574 6169 6c73 2e67 6574  nt = details.get
+00021130: 2827 646e 7363 6c69 656e 7427 2c20 6f76  ('dnsclient', ov
+00021140: 6572 7269 6465 732e 6765 7428 2764 6e73  errides.get('dns
+00021150: 636c 6965 6e74 2729 290a 2020 2020 2020  client')).      
+00021160: 2020 2020 2020 2020 2020 6c62 766d 7320            lbvms 
+00021170: 3d20 6465 7461 696c 732e 6765 7428 2776  = details.get('v
+00021180: 6d73 272c 205b 5d29 0a20 2020 2020 2020  ms', []).       
+00021190: 2020 2020 2020 2020 206c 626e 6574 7320           lbnets 
+000211a0: 3d20 6465 7461 696c 732e 6765 7428 276e  = details.get('n
+000211b0: 6574 7327 2c20 5b27 6465 6661 756c 7427  ets', ['default'
+000211c0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+000211d0: 2020 2069 6e74 6572 6e61 6c20 3d20 6465     internal = de
+000211e0: 7461 696c 732e 6765 7428 2769 6e74 6572  tails.get('inter
+000211f0: 6e61 6c27 290a 2020 2020 2020 2020 2020  nal').          
+00021200: 2020 2020 2020 7375 626e 6574 6964 203d        subnetid =
+00021210: 2064 6574 6169 6c73 2e67 6574 2827 7375   details.get('su
+00021220: 626e 6574 6964 2729 0a20 2020 2020 2020  bnetid').       
+00021230: 2020 2020 2020 2020 2069 7020 3d20 6465           ip = de
+00021240: 7461 696c 732e 6765 7428 2769 7027 290a  tails.get('ip').
+00021250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021260: 7365 6c66 2e63 7265 6174 655f 6c6f 6164  self.create_load
+00021270: 6261 6c61 6e63 6572 286c 6265 6e74 7279  balancer(lbentry
+00021280: 2c20 6e65 7473 3d6c 626e 6574 732c 2070  , nets=lbnets, p
+00021290: 6f72 7473 3d70 6f72 7473 2c20 6368 6563  orts=ports, chec
+000212a0: 6b70 6174 683d 6368 6563 6b70 6174 682c  kpath=checkpath,
+000212b0: 2076 6d73 3d6c 6276 6d73 2c0a 2020 2020   vms=lbvms,.    
+000212c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212e0: 2020 2020 2064 6f6d 6169 6e3d 646f 6d61       domain=doma
+000212f0: 696e 2c20 706c 616e 3d70 6c61 6e2c 2063  in, plan=plan, c
+00021300: 6865 636b 706f 7274 3d63 6865 636b 706f  heckport=checkpo
+00021310: 7274 2c20 616c 6961 733d 616c 6961 732c  rt, alias=alias,
+00021320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021340: 2020 2020 2020 2020 2020 696e 7465 726e            intern
+00021350: 616c 3d69 6e74 6572 6e61 6c2c 2064 6e73  al=internal, dns
+00021360: 636c 6965 6e74 3d64 6e73 636c 6965 6e74  client=dnsclient
+00021370: 2c20 7375 626e 6574 6964 3d73 7562 6e65  , subnetid=subne
+00021380: 7469 642c 2069 703d 6970 290a 2020 2020  tid, ip=ip).    
+00021390: 2020 2020 6966 2073 6773 2061 6e64 206e      if sgs and n
+000213a0: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
+000213b0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+000213c0: 7428 2244 6570 6c6f 7969 6e67 2053 6563  t("Deploying Sec
+000213d0: 7572 6974 7947 726f 7570 732e 2e2e 2229  urityGroups...")
+000213e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000213f0: 2073 6720 696e 2073 6773 3a0a 2020 2020   sg in sgs:.    
+00021400: 2020 2020 2020 2020 2020 2020 6465 7461              deta
+00021410: 696c 7320 3d20 656e 7472 6965 735b 7367  ils = entries[sg
+00021420: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00021430: 2020 6e61 6d65 0a20 2020 2020 2020 2020    name.         
+00021440: 2020 2020 2020 2070 6f72 7473 203d 2064         ports = d
+00021450: 6574 6169 6c73 2e67 6574 2827 706f 7274  etails.get('port
+00021460: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
+00021470: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
+00021480: 6f72 7473 3a0a 2020 2020 2020 2020 2020  orts:.          
+00021490: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+000214a0: 224d 6973 7369 6e67 2050 6f72 7473 2066  "Missing Ports f
+000214b0: 6f72 2073 6773 2e20 4e6f 7420 6372 6561  or sgs. Not crea
+000214c0: 7469 6e67 2069 742e 2e2e 2229 0a20 2020  ting it...").   
+000214d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214e0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+000214f0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
+00021500: 6174 655f 7365 6375 7269 7479 5f67 726f  ate_security_gro
+00021510: 7570 2873 672c 207b 2770 6f72 7473 273a  up(sg, {'ports':
+00021520: 2070 6f72 7473 7d29 0a20 2020 2020 2020   ports}).       
+00021530: 2069 6620 776f 726b 666c 6f77 656e 7472   if workflowentr
+00021540: 6965 7320 616e 6420 6e6f 7420 6f6e 6c79  ies and not only
+00021550: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
+00021560: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
+00021570: 6f79 696e 6720 576f 726b 666c 6f77 2045  oying Workflow E
+00021580: 6e74 7269 6573 2e2e 2e22 290a 2020 2020  ntries...").    
+00021590: 2020 2020 2020 2020 666f 7220 776f 726b          for work
+000215a0: 666c 6f77 2069 6e20 776f 726b 666c 6f77  flow in workflow
+000215b0: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
+000215c0: 2020 2020 2020 2020 2077 6f72 6b66 6c6f           workflo
+000215d0: 775f 6f76 6572 7269 6465 7320 3d20 6f76  w_overrides = ov
+000215e0: 6572 7269 6465 732e 636f 7079 2829 0a20  errides.copy(). 
+000215f0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00021600: 6f72 6b66 6c6f 775f 6f76 6572 7269 6465  orkflow_override
+00021610: 732e 7570 6461 7465 2865 6e74 7269 6573  s.update(entries
+00021620: 5b77 6f72 6b66 6c6f 775d 290a 2020 2020  [workflow]).    
+00021630: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00021640: 2e63 7265 6174 655f 776f 726b 666c 6f77  .create_workflow
+00021650: 2877 6f72 6b66 6c6f 772c 206f 7665 7272  (workflow, overr
+00021660: 6964 6573 3d77 6f72 6b66 6c6f 775f 6f76  ides=workflow_ov
+00021670: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00021680: 2072 6574 7572 6e64 6174 6120 3d20 7b27   returndata = {'
+00021690: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
+000216a0: 7327 2c20 2770 6c61 6e27 3a20 706c 616e  s', 'plan': plan
+000216b0: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
+000216c0: 6461 7461 5b27 6e65 7776 6d73 275d 203d  data['newvms'] =
+000216d0: 206e 6577 766d 7320 6966 206e 6577 766d   newvms if newvm
+000216e0: 7320 656c 7365 205b 5d0a 2020 2020 2020  s else [].      
+000216f0: 2020 7265 7475 726e 6461 7461 5b27 6578    returndata['ex
+00021700: 6973 7469 6e67 766d 7327 5d20 3d20 6578  istingvms'] = ex
+00021710: 6973 7469 6e67 766d 7320 6966 2065 7869  istingvms if exi
+00021720: 7374 696e 6776 6d73 2065 6c73 6520 5b5d  stingvms else []
+00021730: 0a20 2020 2020 2020 2072 6574 7572 6e64  .        returnd
+00021740: 6174 615b 2766 6169 6c65 6476 6d73 275d  ata['failedvms']
+00021750: 203d 2066 6169 6c65 6476 6d73 2069 6620   = failedvms if 
+00021760: 6661 696c 6564 766d 7320 656c 7365 205b  failedvms else [
+00021770: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+00021780: 6461 7461 5b27 6173 7365 7473 275d 203d  data['assets'] =
+00021790: 206e 6577 6173 7365 7473 2069 6620 6e65   newassets if ne
+000217a0: 7761 7373 6574 7320 656c 7365 205b 5d0a  wassets else [].
+000217b0: 2020 2020 2020 2020 6966 2066 6169 6c65          if faile
+000217c0: 6476 6d73 3a0a 2020 2020 2020 2020 2020  dvms:.          
+000217d0: 2020 7265 7475 726e 6461 7461 5b27 7265    returndata['re
+000217e0: 7375 6c74 275d 203d 2027 6661 696c 7572  sult'] = 'failur
+000217f0: 6527 0a20 2020 2020 2020 2020 2020 2066  e'.            f
+00021800: 6169 6c65 646e 616d 6573 203d 2027 2c27  ailednames = ','
+00021810: 2e6a 6f69 6e28 5b76 5b27 6e61 6d65 275d  .join([v['name']
+00021820: 2066 6f72 2076 2069 6e20 6661 696c 6564   for v in failed
+00021830: 766d 735d 290a 2020 2020 2020 2020 2020  vms]).          
+00021840: 2020 7265 7475 726e 6461 7461 5b27 7265    returndata['re
+00021850: 6173 6f6e 275d 203d 2066 2754 6865 2066  ason'] = f'The f
+00021860: 6f6c 6c6f 7769 6e67 2076 6d73 2066 6169  ollowing vms fai
+00021870: 6c65 643a 207b 6661 696c 6564 6e61 6d65  led: {failedname
+00021880: 737d 270a 2020 2020 2020 2020 6966 2067  s}'.        if g
+00021890: 6574 6261 636b 206f 7220 746f 636c 6561  etback or toclea
+000218a0: 6e3a 0a20 2020 2020 2020 2020 2020 206f  n:.            o
+000218b0: 732e 6368 6469 7228 272e 2e27 290a 2020  s.chdir('..').  
+000218c0: 2020 2020 2020 6966 2074 6f63 6c65 616e        if toclean
+000218d0: 3a0a 2020 2020 2020 2020 2020 2020 726d  :.            rm
+000218e0: 7472 6565 2870 6174 6829 0a20 2020 2020  tree(path).     
+000218f0: 2020 2069 6620 696e 7075 7473 7472 696e     if inputstrin
+00021900: 6720 6973 206e 6f74 204e 6f6e 6520 616e  g is not None an
+00021910: 6420 6f73 2e70 6174 682e 6578 6973 7473  d os.path.exists
+00021920: 2866 2274 656d 705f 706c 616e 5f7b 706c  (f"temp_plan_{pl
+00021930: 616e 7d2e 796d 6c22 293a 0a20 2020 2020  an}.yml"):.     
+00021940: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
+00021950: 2866 2274 656d 705f 706c 616e 5f7b 706c  (f"temp_plan_{pl
+00021960: 616e 7d2e 796d 6c22 290a 2020 2020 2020  an}.yml").      
+00021970: 2020 666f 7220 656e 7472 7920 696e 2061    for entry in a
+00021980: 7379 6e63 7761 6974 766d 733a 0a20 2020  syncwaitvms:.   
+00021990: 2020 2020 2020 2020 206e 616d 652c 2066           name, f
+000219a0: 696e 6973 6866 696c 6573 203d 2065 6e74  inishfiles = ent
+000219b0: 7279 5b27 6e61 6d65 275d 2c20 656e 7472  ry['name'], entr
+000219c0: 795b 2766 696e 6973 6866 696c 6573 275d  y['finishfiles']
+000219d0: 0a20 2020 2020 2020 2020 2020 2077 6169  .            wai
+000219e0: 7463 6f6d 6d61 6e64 2c20 7761 6974 7469  tcommand, waitti
+000219f0: 6d65 6f75 7420 3d20 656e 7472 795b 2777  meout = entry['w
+00021a00: 6169 7463 6f6d 6d61 6e64 275d 2c20 656e  aitcommand'], en
+00021a10: 7472 795b 2777 6169 7474 696d 656f 7574  try['waittimeout
+00021a20: 275d 0a20 2020 2020 2020 2020 2020 2076  '].            v
+00021a30: 6d63 6c69 656e 7420 3d20 656e 7472 795b  mclient = entry[
+00021a40: 2776 6d63 6c69 656e 7427 5d0a 2020 2020  'vmclient'].    
+00021a50: 2020 2020 2020 2020 7365 6c66 2e77 6169          self.wai
+00021a60: 745f 6669 6e69 7368 286e 616d 652c 2077  t_finish(name, w
+00021a70: 6169 7463 6f6d 6d61 6e64 3d77 6169 7463  aitcommand=waitc
+00021a80: 6f6d 6d61 6e64 2c20 7761 6974 7469 6d65  ommand, waittime
+00021a90: 6f75 743d 7761 6974 7469 6d65 6f75 742c  out=waittimeout,
+00021aa0: 2076 6d63 6c69 656e 743d 766d 636c 6965   vmclient=vmclie
+00021ab0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+00021ac0: 6966 2066 696e 6973 6866 696c 6573 3a0a  if finishfiles:.
+00021ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ae0: 7365 6c66 2e68 616e 646c 655f 6669 6e69  self.handle_fini
+00021af0: 7368 6669 6c65 7328 6e61 6d65 2c20 6669  shfiles(name, fi
+00021b00: 6e69 7368 6669 6c65 732c 2076 6d63 6c69  nishfiles, vmcli
+00021b10: 656e 743d 766d 636c 6965 6e74 290a 2020  ent=vmclient).  
+00021b20: 2020 2020 2020 706f 7374 5f73 6372 6970        post_scrip
+00021b30: 7420 3d20 6627 7b69 6e70 7574 6469 727d  t = f'{inputdir}
+00021b40: 2f6b 636c 695f 706f 7374 2e73 6827 0a20  /kcli_post.sh'. 
+00021b50: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00021b60: 682e 6578 6973 7473 2870 6f73 745f 7363  h.exists(post_sc
+00021b70: 7269 7074 293a 0a20 2020 2020 2020 2020  ript):.         
+00021b80: 2020 2069 6620 706f 7374 3a0a 2020 2020     if post:.    
+00021b90: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00021ba0: 6e74 2822 5275 6e6e 696e 6720 6b63 6c69  nt("Running kcli
+00021bb0: 5f70 6f73 742e 7368 2229 0a20 2020 2020  _post.sh").     
+00021bc0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00021bd0: 5465 6d70 6f72 6172 7944 6972 6563 746f  TemporaryDirecto
+00021be0: 7279 2829 2061 7320 746d 7064 6972 3a0a  ry() as tmpdir:.
+00021bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c00: 2020 2020 706f 7374 5f73 6372 6970 7420      post_script 
+00021c10: 3d20 7365 6c66 2e70 726f 6365 7373 5f69  = self.process_i
+00021c20: 6e70 7574 6669 6c65 2827 7878 7827 2c20  nputfile('xxx', 
+00021c30: 706f 7374 5f73 6372 6970 742c 206f 7665  post_script, ove
+00021c40: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+00021c50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021c60: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00021c70: 6622 7b74 6d70 6469 727d 2f70 6f73 742e  f"{tmpdir}/post.
+00021c80: 7368 222c 2027 7727 2920 6173 2066 3a0a  sh", 'w') as f:.
+00021c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ca0: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+00021cb0: 706f 7374 5f73 6372 6970 7429 0a20 2020  post_script).   
+00021cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021cd0: 2070 6f73 745f 7275 6e20 3d20 7275 6e28   post_run = run(
+00021ce0: 6627 6261 7368 207b 746d 7064 6972 7d2f  f'bash {tmpdir}/
+00021cf0: 706f 7374 2e73 6827 2c20 7368 656c 6c3d  post.sh', shell=
+00021d00: 5472 7565 2c20 7374 646f 7574 3d50 4950  True, stdout=PIP
+00021d10: 452c 2073 7464 6572 723d 5354 444f 5554  E, stderr=STDOUT
+00021d20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00021d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021d40: 2020 2020 2075 6e69 7665 7273 616c 5f6e       universal_n
+00021d50: 6577 6c69 6e65 733d 5472 7565 290a 2020  ewlines=True).  
+00021d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021d70: 2020 6966 2070 6f73 745f 7275 6e2e 7265    if post_run.re
+00021d80: 7475 726e 636f 6465 2021 3d20 303a 0a20  turncode != 0:. 
+00021d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021da0: 2020 2020 2020 206d 7367 203d 2066 2249         msg = f"I
+00021db0: 7373 7565 2077 6865 6e20 7275 6e6e 696e  ssue when runnin
+00021dc0: 6720 6b63 6c69 5f70 6f73 742e 7368 203a  g kcli_post.sh :
+00021dd0: 5c6e 7b70 6f73 745f 7275 6e2e 7374 646f  \n{post_run.stdo
+00021de0: 7574 7d22 0a20 2020 2020 2020 2020 2020  ut}".           
+00021df0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00021e00: 6f72 286d 7367 290a 2020 2020 2020 2020  or(msg).        
+00021e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e20: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+00021e30: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+00021e40: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
+00021e50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00021e60: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+00021e70: 726e 696e 6728 2253 6b69 7070 696e 6720  rning("Skipping 
+00021e80: 6b63 6c69 5f70 6f73 742e 7368 2061 7320  kcli_post.sh as 
+00021e90: 7265 7175 6573 7465 6422 290a 2020 2020  requested").    
+00021ea0: 2020 2020 6966 206f 7665 7272 6964 6573      if overrides
+00021eb0: 2e67 6574 2827 7465 6d70 6b65 7964 6972  .get('tempkeydir
+00021ec0: 2729 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ') is not None:.
+00021ed0: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+00021ee0: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
+00021ef0: 6579 6469 7227 292e 636c 6561 6e75 7028  eydir').cleanup(
+00021f00: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00021f10: 2072 6574 7572 6e64 6174 610a 0a20 2020   returndata..   
+00021f20: 2064 6566 2068 616e 646c 655f 686f 7374   def handle_host
+00021f30: 2873 656c 662c 2070 6f6f 6c3d 4e6f 6e65  (self, pool=None
+00021f40: 2c20 696d 6167 653d 4e6f 6e65 2c20 7377  , image=None, sw
+00021f50: 6974 6368 3d4e 6f6e 652c 2064 6f77 6e6c  itch=None, downl
+00021f60: 6f61 643d 4661 6c73 652c 0a20 2020 2020  oad=False,.     
+00021f70: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00021f80: 726c 3d4e 6f6e 652c 2063 6d64 3d4e 6f6e  rl=None, cmd=Non
+00021f90: 652c 2073 796e 633d 4661 6c73 652c 2073  e, sync=False, s
+00021fa0: 697a 653d 4e6f 6e65 2c20 6172 6368 3d27  ize=None, arch='
+00021fb0: 7838 365f 3634 272c 0a20 2020 2020 2020  x86_64',.       
+00021fc0: 2020 2020 2020 2020 2020 2020 206b 766d               kvm
+00021fd0: 5f6f 7065 6e73 7461 636b 3d54 7275 652c  _openstack=True,
+00021fe0: 2072 6863 6f73 5f63 6f6d 6d69 743d 4e6f   rhcos_commit=No
+00021ff0: 6e65 2c20 7268 636f 735f 696e 7374 616c  ne, rhcos_instal
+00022000: 6c65 723d 4661 6c73 6529 3a0a 2020 2020  ler=False):.    
+00022010: 2020 2020 6966 2064 6f77 6e6c 6f61 643a      if download:
+00022020: 0a20 2020 2020 2020 2020 2020 206b 203d  .            k =
+00022030: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
+00022040: 2020 2020 6966 2070 6f6f 6c20 6973 204e      if pool is N
+00022050: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00022060: 2020 2020 2070 6f6f 6c20 3d20 7365 6c66       pool = self
+00022070: 2e70 6f6f 6c0a 2020 2020 2020 2020 2020  .pool.          
+00022080: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
+00022090: 7369 6e67 2070 6f6f 6c20 7b70 6f6f 6c7d  sing pool {pool}
+000220a0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+000220b0: 6620 696d 6167 6520 6973 206e 6f74 204e  f image is not N
+000220c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000220d0: 2020 2020 2069 6620 7572 6c20 6973 204e       if url is N
+000220e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000220f0: 2020 2020 2020 2020 2069 6620 6172 6368           if arch
+00022100: 2021 3d20 2778 3836 5f36 3427 3a0a 2020   != 'x86_64':.  
+00022110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022120: 2020 2020 2020 494d 4147 4553 2e75 7064        IMAGES.upd
+00022130: 6174 6528 7b69 3a20 494d 4147 4553 5b69  ate({i: IMAGES[i
+00022140: 5d2e 7265 706c 6163 6528 2778 3836 5f36  ].replace('x86_6
+00022150: 3427 2c20 6172 6368 292e 7265 706c 6163  4', arch).replac
+00022160: 6528 2761 6d64 3634 272c 2061 7263 6829  e('amd64', arch)
 00022170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022180: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00022190: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-000221a0: 6561 736f 6e27 3a20 6622 436c 6965 6e74  eason': f"Client
-000221b0: 207b 7377 6974 6368 7d20 6e6f 7420 666f   {switch} not fo
-000221c0: 756e 6420 696e 2063 6f6e 6669 6722 7d0a  und in config"}.
-000221d0: 2020 2020 2020 2020 2020 2020 656e 6162              enab
-000221e0: 6c65 6420 3d20 7365 6c66 2e69 6e69 5b73  led = self.ini[s
-000221f0: 7769 7463 685d 2e67 6574 2827 656e 6162  witch].get('enab
-00022200: 6c65 6427 2c20 5472 7565 290a 2020 2020  led', True).    
-00022210: 2020 2020 2020 2020 6966 206e 6f74 2065          if not e
-00022220: 6e61 626c 6564 3a0a 2020 2020 2020 2020  nabled:.        
-00022230: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-00022240: 436c 6965 6e74 207b 7377 6974 6368 7d20  Client {switch} 
-00022250: 6973 2064 6973 6162 6c65 642e 4c65 6176  is disabled.Leav
-00022260: 696e 672e 2e2e 2e22 290a 2020 2020 2020  ing....").      
-00022270: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00022280: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00022290: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-000222a0: 2066 2243 6c69 656e 7420 7b73 7769 7463   f"Client {switc
-000222b0: 687d 2069 7320 6469 7361 626c 6564 227d  h} is disabled"}
-000222c0: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-000222d0: 696e 7428 6622 5377 6974 6368 696e 6720  int(f"Switching 
-000222e0: 746f 2063 6c69 656e 7420 7b73 7769 7463  to client {switc
-000222f0: 687d 2e2e 2e22 290a 2020 2020 2020 2020  h}...").        
-00022300: 2020 2020 696e 6966 696c 6520 3d20 2225      inifile = "%
-00022310: 732f 2e6b 636c 692f 636f 6e66 6967 2e79  s/.kcli/config.y
-00022320: 6d6c 2220 2520 6f73 2e65 6e76 6972 6f6e  ml" % os.environ
-00022330: 2e67 6574 2827 484f 4d45 2729 0a20 2020  .get('HOME').   
-00022340: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
-00022350: 6174 682e 6578 6973 7473 2869 6e69 6669  ath.exists(inifi
-00022360: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00022370: 2020 2020 206e 6577 696e 6920 3d20 2727       newini = ''
-00022380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022390: 2066 6f72 206c 696e 6520 696e 206f 7065   for line in ope
-000223a0: 6e28 696e 6966 696c 6529 2e72 6561 646c  n(inifile).readl
-000223b0: 696e 6573 2829 3a0a 2020 2020 2020 2020  ines():.        
-000223c0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-000223d0: 636c 6965 6e74 2720 696e 206c 696e 653a  client' in line:
-000223e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000223f0: 2020 2020 2020 2020 206e 6577 696e 6920           newini 
-00022400: 2b3d 2066 2220 636c 6965 6e74 3a20 7b73  += f" client: {s
-00022410: 7769 7463 687d 5c6e 220a 2020 2020 2020  witch}\n".      
-00022420: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00022430: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00022440: 2020 2020 2020 2020 2020 2020 6e65 7769              newi
-00022450: 6e69 202b 3d20 6c69 6e65 0a20 2020 2020  ni += line.     
-00022460: 2020 2020 2020 2020 2020 206f 7065 6e28             open(
-00022470: 696e 6966 696c 652c 2027 7727 292e 7772  inifile, 'w').wr
-00022480: 6974 6528 6e65 7769 6e69 290a 2020 2020  ite(newini).    
-00022490: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-000224a0: 2772 6573 756c 7427 3a20 2773 7563 6365  'result': 'succe
-000224b0: 7373 277d 0a20 2020 2020 2020 2065 6c69  ss'}.        eli
-000224c0: 6620 7379 6e63 3a0a 2020 2020 2020 2020  f sync:.        
-000224d0: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
-000224e0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000224f0: 7420 7365 6c66 2e65 7874 7261 636c 6965  t self.extraclie
-00022500: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
-00022510: 2020 2020 2077 6172 6e69 6e67 2822 4e6f       warning("No
-00022520: 7468 696e 6720 746f 2064 6f2e 204c 6561  thing to do. Lea
-00022530: 7669 6e67 2e2e 2e22 290a 2020 2020 2020  ving...").      
-00022540: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00022550: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
-00022560: 6365 7373 277d 0a20 2020 2020 2020 2020  cess'}.         
-00022570: 2020 2066 6f72 2063 6c69 2069 6e20 7365     for cli in se
-00022580: 6c66 2e65 7874 7261 636c 6965 6e74 733a  lf.extraclients:
-00022590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000225a0: 2064 6573 7420 3d20 7365 6c66 2e65 7874   dest = self.ext
-000225b0: 7261 636c 6965 6e74 735b 636c 695d 0a20  raclients[cli]. 
-000225c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000225d0: 7072 696e 7428 6622 7379 6e63 696e 6720  print(f"syncing 
-000225e0: 636c 6965 6e74 2069 6d61 6765 7320 6672  client images fr
-000225f0: 6f6d 207b 7365 6c66 2e63 6c69 656e 747d  om {self.client}
-00022600: 2074 6f20 7b63 6c69 7d22 290a 2020 2020   to {cli}").    
-00022610: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00022620: 696e 6728 224e 6f74 6520 7268 656c 2069  ing("Note rhel i
-00022630: 6d61 6765 7320 6172 6520 6375 7272 656e  mages are curren
-00022640: 746c 7920 6e6f 7420 7379 6e63 6564 2229  tly not synced")
-00022650: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00022660: 2076 6f6c 2069 6e20 6b2e 766f 6c75 6d65   vol in k.volume
-00022670: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00022680: 2020 2020 2069 6d61 6765 203d 206f 732e       image = os.
-00022690: 7061 7468 2e62 6173 656e 616d 6528 766f  path.basename(vo
-000226a0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-000226b0: 2020 2069 6620 696d 6167 6520 696e 205b     if image in [
-000226c0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-000226d0: 2876 2920 666f 7220 7620 696e 2064 6573  (v) for v in des
-000226e0: 742e 766f 6c75 6d65 7328 295d 3a0a 2020  t.volumes()]:.  
-000226f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022700: 2020 7761 726e 696e 6728 6622 4967 6e6f    warning(f"Igno
-00022710: 7269 6e67 207b 696d 6167 657d 2061 7320  ring {image} as 
-00022720: 6974 2773 2061 6c72 6561 6479 2074 6865  it's already the
-00022730: 7265 2229 0a20 2020 2020 2020 2020 2020  re").           
-00022740: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00022750: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00022760: 2020 7572 6c20 3d20 4e6f 6e65 0a20 2020    url = None.   
-00022770: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00022780: 206e 2069 6e20 6c69 7374 2849 4d41 4745   n in list(IMAGE
-00022790: 532e 7661 6c75 6573 2829 293a 0a20 2020  S.values()):.   
-000227a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000227b0: 2069 6620 6e20 6973 204e 6f6e 653a 0a20   if n is None:. 
+00022180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022190: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+000221a0: 2049 4d41 4745 537d 290a 2020 2020 2020   IMAGES}).      
+000221b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000221c0: 2069 6d61 6765 206e 6f74 2069 6e20 494d   image not in IM
+000221d0: 4147 4553 3a0a 2020 2020 2020 2020 2020  AGES:.          
+000221e0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+000221f0: 726f 7228 6622 496d 6167 6520 7b69 6d61  ror(f"Image {ima
+00022200: 6765 7d20 6861 7320 6e6f 2061 7373 6f63  ge} has no assoc
+00022210: 6961 7465 6420 7572 6c22 290a 2020 2020  iated url").    
+00022220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022230: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00022240: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
+00022250: 2027 7265 6173 6f6e 273a 2022 496e 636f   'reason': "Inco
+00022260: 7272 6563 7420 696d 6167 6522 7d0a 2020  rrect image"}.  
+00022270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022280: 2020 7572 6c20 3d20 494d 4147 4553 5b69    url = IMAGES[i
+00022290: 6d61 6765 5d0a 2020 2020 2020 2020 2020  mage].          
+000222a0: 2020 2020 2020 2020 2020 696d 6167 655f            image_
+000222b0: 7479 7065 203d 2073 656c 662e 7479 7065  type = self.type
+000222c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000222d0: 2020 2020 2069 6620 6b76 6d5f 6f70 656e       if kvm_open
+000222e0: 7374 6163 6b20 616e 6420 7365 6c66 2e74  stack and self.t
+000222f0: 7970 6520 3d3d 2027 6b76 6d27 3a0a 2020  ype == 'kvm':.  
+00022300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022310: 2020 2020 2020 696d 6167 655f 7479 7065        image_type
+00022320: 203d 2027 6f70 656e 7374 6163 6b27 0a20   = 'openstack'. 
+00022330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022340: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
+00022350: 3d3d 2022 7072 6f78 6d6f 7822 3a0a 2020  == "proxmox":.  
+00022360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022370: 2020 2020 2020 696d 6167 655f 7479 7065        image_type
+00022380: 203d 2027 6b76 6d27 0a20 2020 2020 2020   = 'kvm'.       
+00022390: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000223a0: 6e6f 7420 6b76 6d5f 6f70 656e 7374 6163  not kvm_openstac
+000223b0: 6b20 616e 6420 7365 6c66 2e74 7970 6520  k and self.type 
+000223c0: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
+000223d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000223e0: 2020 696d 6167 6520 2b3d 2022 2d71 656d    image += "-qem
+000223f0: 7522 0a20 2020 2020 2020 2020 2020 2020  u".             
+00022400: 2020 2020 2020 2069 6620 2772 6863 6f73         if 'rhcos
+00022410: 2720 696e 2069 6d61 6765 2061 6e64 206e  ' in image and n
+00022420: 6f74 2069 6d61 6765 2e65 6e64 7377 6974  ot image.endswit
+00022430: 6828 2771 636f 7732 2e67 7a27 293a 0a20  h('qcow2.gz'):. 
+00022440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022450: 2020 2020 2020 2069 6620 7268 636f 735f         if rhcos_
+00022460: 636f 6d6d 6974 2069 7320 6e6f 7420 4e6f  commit is not No
+00022470: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00022480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022490: 7572 6c20 3d20 636f 6d6d 6f6e 2e67 6574  url = common.get
+000224a0: 5f63 6f6d 6d69 745f 7268 636f 7328 7268  _commit_rhcos(rh
+000224b0: 636f 735f 636f 6d6d 6974 2c20 5f74 7970  cos_commit, _typ
+000224c0: 653d 696d 6167 655f 7479 7065 290a 2020  e=image_type).  
+000224d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000224e0: 2020 2020 2020 656c 6966 2072 6863 6f73        elif rhcos
+000224f0: 5f69 6e73 7461 6c6c 6572 3a0a 2020 2020  _installer:.    
+00022500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022510: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
+00022520: 6f6e 5b27 5041 5448 275d 202b 3d20 6627  on['PATH'] += f'
+00022530: 3a7b 6f73 2e67 6574 6377 6428 297d 270a  :{os.getcwd()}'.
+00022540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022550: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+00022560: 3d20 636f 6d6d 6f6e 2e67 6574 5f69 6e73  = common.get_ins
+00022570: 7461 6c6c 6572 5f72 6863 6f73 285f 7479  taller_rhcos(_ty
+00022580: 7065 3d69 6d61 6765 5f74 7970 652c 2061  pe=image_type, a
+00022590: 7263 683d 6172 6368 290a 2020 2020 2020  rch=arch).      
+000225a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000225b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000225c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000225d0: 2020 2020 6966 2061 7263 6820 213d 2027      if arch != '
+000225e0: 7838 365f 3634 273a 0a20 2020 2020 2020  x86_64':.       
+000225f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022600: 2020 2020 2020 2020 2075 726c 202b 3d20           url += 
+00022610: 6627 2d7b 6172 6368 7d27 0a20 2020 2020  f'-{arch}'.     
+00022620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022630: 2020 2020 2020 2075 726c 203d 2063 6f6d         url = com
+00022640: 6d6f 6e2e 6765 745f 6c61 7465 7374 5f72  mon.get_latest_r
+00022650: 6863 6f73 2875 726c 2c20 5f74 7970 653d  hcos(url, _type=
+00022660: 696d 6167 655f 7479 7065 2c20 6172 6368  image_type, arch
+00022670: 3d61 7263 6829 0a20 2020 2020 2020 2020  =arch).         
+00022680: 2020 2020 2020 2020 2020 2069 6620 2766             if 'f
+00022690: 636f 7327 2069 6e20 696d 6167 653a 0a20  cos' in image:. 
+000226a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226b0: 2020 2020 2020 2075 726c 203d 2063 6f6d         url = com
+000226c0: 6d6f 6e2e 6765 745f 6c61 7465 7374 5f66  mon.get_latest_f
+000226d0: 636f 7328 7572 6c2c 205f 7479 7065 3d69  cos(url, _type=i
+000226e0: 6d61 6765 5f74 7970 6529 0a20 2020 2020  mage_type).     
+000226f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00022700: 6620 696d 6167 6520 3d3d 2027 6665 646f  f image == 'fedo
+00022710: 7261 6c61 7465 7374 273a 0a20 2020 2020  ralatest':.     
+00022720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022730: 2020 2075 726c 203d 2063 6f6d 6d6f 6e2e     url = common.
+00022740: 6765 745f 6c61 7465 7374 5f66 6564 6f72  get_latest_fedor
+00022750: 6128 7572 6c29 0a20 2020 2020 2020 2020  a(url).         
+00022760: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+00022770: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00022780: 616d 6528 696d 6167 6529 0a20 2020 2020  ame(image).     
+00022790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000227a0: 6620 696d 6167 652e 7374 6172 7473 7769  f image.startswi
+000227b0: 7468 2827 7268 656c 2729 3a0a 2020 2020  th('rhel'):.    
 000227c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000227d0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-000227e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000227f0: 2020 2020 656c 6966 206e 2e73 706c 6974      elif n.split
-00022800: 2827 2f27 295b 2d31 5d20 3d3d 2069 6d61  ('/')[-1] == ima
-00022810: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
-00022820: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
-00022830: 3d20 6e0a 2020 2020 2020 2020 2020 2020  = n.            
-00022840: 2020 2020 6966 2075 726c 2069 7320 4e6f      if url is No
-00022850: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00022860: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00022870: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
-00022880: 7265 272c 2027 7265 6173 6f6e 273a 2022  re', 'reason': "
-00022890: 696d 6167 6520 6e6f 7420 696e 2064 6566  image not in def
-000228a0: 6175 6c74 206c 6973 7422 7d0a 2020 2020  ault list"}.    
-000228b0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000228c0: 6d61 6765 2e73 7461 7274 7377 6974 6828  mage.startswith(
-000228d0: 2772 6865 6c27 293a 0a20 2020 2020 2020  'rhel'):.       
-000228e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000228f0: 2777 6562 2720 696e 2073 7973 2e61 7267  'web' in sys.arg
-00022900: 765b 305d 3a0a 2020 2020 2020 2020 2020  v[0]:.          
-00022910: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00022920: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-00022930: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
-00022940: 6f6e 273a 2022 4d69 7373 696e 6720 7572  on': "Missing ur
-00022950: 6c22 7d0a 2020 2020 2020 2020 2020 2020  l"}.            
-00022960: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00022970: 224f 7065 6e69 6e67 2075 726c 207b 7572  "Opening url {ur
-00022980: 6c7d 2066 6f72 2079 6f75 2074 6f20 6772  l} for you to gr
-00022990: 6162 2063 6f6d 706c 6574 6520 7572 6c20  ab complete url 
-000229a0: 666f 7220 7b76 6f6c 7d20 6b76 6d20 6775  for {vol} kvm gu
-000229b0: 6573 7420 696d 6167 6522 290a 2020 2020  est image").    
-000229c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229d0: 7765 6262 726f 7773 6572 2e6f 7065 6e28  webbrowser.open(
-000229e0: 7572 6c2c 206e 6577 3d32 2c20 6175 746f  url, new=2, auto
-000229f0: 7261 6973 653d 5472 7565 290a 2020 2020  raise=True).    
-00022a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a10: 7572 6c20 3d20 696e 7075 7428 2243 6f70  url = input("Cop
-00022a20: 7920 5572 6c3a 5c6e 2229 0a20 2020 2020  y Url:\n").     
-00022a30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022a40: 6620 7572 6c2e 7374 7269 7028 2920 3d3d  f url.strip() ==
-00022a50: 2027 273a 0a20 2020 2020 2020 2020 2020   '':.           
-00022a60: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00022a70: 6f72 2822 4d69 7373 696e 6720 7072 6f70  or("Missing prop
-00022a80: 6572 2075 726c 2e4c 6561 7669 6e67 2e2e  er url.Leaving..
-00022a90: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00022aa0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00022ab0: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
-00022ac0: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
-00022ad0: 273a 2022 4d69 7373 696e 6720 696d 6167  ': "Missing imag
-00022ae0: 6522 7d0a 2020 2020 2020 2020 2020 2020  e"}.            
-00022af0: 2020 2020 636d 6420 3d20 4e6f 6e65 0a20      cmd = None. 
-00022b00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022b10: 6620 766f 6c20 696e 2049 4d41 4745 5343  f vol in IMAGESC
-00022b20: 4f4d 4d41 4e44 533a 0a20 2020 2020 2020  OMMANDS:.       
-00022b30: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-00022b40: 203d 2049 4d41 4745 5343 4f4d 4d41 4e44   = IMAGESCOMMAND
-00022b50: 535b 696d 6167 655d 0a20 2020 2020 2020  S[image].       
-00022b60: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00022b70: 6622 4772 6162 6269 6e67 2069 6d61 6765  f"Grabbing image
-00022b80: 207b 696d 6167 657d 2e2e 2e22 290a 2020   {image}...").  
-00022b90: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00022ba0: 7374 2e61 6464 5f69 6d61 6765 2875 726c  st.add_image(url
-00022bb0: 2c20 706f 6f6c 2c20 636d 643d 636d 6429  , pool, cmd=cmd)
-00022bc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00022bd0: 7b27 7265 7375 6c74 273a 2027 7375 6363  {'result': 'succ
-00022be0: 6573 7327 7d0a 0a20 2020 2064 6566 2064  ess'}..    def d
-00022bf0: 656c 6574 655f 6c6f 6164 6261 6c61 6e63  elete_loadbalanc
-00022c00: 6572 2873 656c 662c 206e 616d 652c 2064  er(self, name, d
-00022c10: 6f6d 6169 6e3d 4e6f 6e65 293a 0a20 2020  omain=None):.   
-00022c20: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
-00022c30: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00022c40: 2244 656c 6574 696e 6720 6c6f 6164 6261  "Deleting loadba
-00022c50: 6c61 6e63 6572 207b 6e61 6d65 7d22 290a  lancer {name}").
-00022c60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00022c70: 7479 7065 2069 6e20 5b27 6177 7327 2c20  type in ['aws', 
-00022c80: 2767 6370 272c 2027 6962 6d27 5d3a 0a20  'gcp', 'ibm']:. 
-00022c90: 2020 2020 2020 2020 2020 2064 6e73 636c             dnscl
-00022ca0: 6965 6e74 203d 206b 2e64 656c 6574 655f  ient = k.delete_
-00022cb0: 6c6f 6164 6261 6c61 6e63 6572 286e 616d  loadbalancer(nam
-00022cc0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-00022cd0: 6620 646f 6d61 696e 2069 7320 6e6f 7420  f domain is not 
-00022ce0: 4e6f 6e65 2061 6e64 2064 6e73 636c 6965  None and dnsclie
-00022cf0: 6e74 2069 7320 6e6f 7420 4e6f 6e65 2061  nt is not None a
-00022d00: 6e64 2069 7369 6e73 7461 6e63 6528 646e  nd isinstance(dn
-00022d10: 7363 6c69 656e 742c 2073 7472 293a 0a20  sclient, str):. 
-00022d20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022d30: 6620 646e 7363 6c69 656e 7420 696e 2073  f dnsclient in s
-00022d40: 656c 662e 636c 6965 6e74 733a 0a20 2020  elf.clients:.   
-00022d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d60: 207a 203d 204b 636f 6e66 6967 2863 6c69   z = Kconfig(cli
-00022d70: 656e 743d 646e 7363 6c69 656e 7429 2e6b  ent=dnsclient).k
-00022d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022d90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00022da0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00022db0: 6e67 2866 2243 6c69 656e 7420 7b64 6e73  ng(f"Client {dns
-00022dc0: 636c 6965 6e74 7d20 6e6f 7420 666f 756e  client} not foun
-00022dd0: 642e 2053 6b69 7070 696e 6722 290a 2020  d. Skipping").  
-00022de0: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
-00022df0: 6465 6c65 7465 5f64 6e73 286e 616d 652e  delete_dns(name.
-00022e00: 7265 706c 6163 6528 275f 272c 2027 2d27  replace('_', '-'
-00022e10: 292c 2064 6f6d 6169 6e29 0a20 2020 2020  ), domain).     
-00022e20: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
-00022e30: 6520 3d3d 2027 6b76 6d27 3a0a 2020 2020  e == 'kvm':.    
-00022e40: 2020 2020 2020 2020 6b2e 6465 6c65 7465          k.delete
-00022e50: 286e 616d 6529 0a0a 2020 2020 6465 6620  (name)..    def 
-00022e60: 6372 6561 7465 5f6c 6f61 6462 616c 616e  create_loadbalan
-00022e70: 6365 7228 7365 6c66 2c20 6e61 6d65 2c20  cer(self, name, 
-00022e80: 6e65 7473 3d5b 2764 6566 6175 6c74 275d  nets=['default']
-00022e90: 2c20 706f 7274 733d 5b5d 2c20 6368 6563  , ports=[], chec
-00022ea0: 6b70 6174 683d 272f 272c 2076 6d73 3d5b  kpath='/', vms=[
-00022eb0: 5d2c 2064 6f6d 6169 6e3d 4e6f 6e65 2c0a  ], domain=None,.
-00022ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ed0: 2020 2020 2020 2020 2020 2020 706c 616e              plan
-00022ee0: 3d4e 6f6e 652c 2063 6865 636b 706f 7274  =None, checkport
-00022ef0: 3d38 302c 2061 6c69 6173 3d5b 5d2c 2069  =80, alias=[], i
-00022f00: 6e74 6572 6e61 6c3d 4661 6c73 652c 2064  nternal=False, d
-00022f10: 6e73 636c 6965 6e74 3d4e 6f6e 652c 2073  nsclient=None, s
-00022f20: 7562 6e65 7469 643d 4e6f 6e65 2c20 6970  ubnetid=None, ip
-00022f30: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00022f40: 6e61 6d65 203d 206e 616d 6575 7469 6c73  name = nameutils
-00022f50: 2e67 6574 5f72 616e 646f 6d5f 6e61 6d65  .get_random_name
-00022f60: 2829 2e72 6570 6c61 6365 2827 5f27 2c20  ().replace('_', 
-00022f70: 272d 2729 2069 6620 6e61 6d65 2069 7320  '-') if name is 
-00022f80: 4e6f 6e65 2065 6c73 6520 6e61 6d65 0a20  None else name. 
-00022f90: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00022fa0: 4465 706c 6f79 696e 6720 6c6f 6164 6261  Deploying loadba
-00022fb0: 6c61 6e63 6572 207b 6e61 6d65 7d22 290a  lancer {name}").
-00022fc0: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
-00022fd0: 2e6b 0a20 2020 2020 2020 2069 6620 7365  .k.        if se
-00022fe0: 6c66 2e74 7970 6520 696e 205b 2761 7773  lf.type in ['aws
-00022ff0: 272c 2027 6763 7027 2c20 2769 626d 275d  ', 'gcp', 'ibm']
-00023000: 3a0a 2020 2020 2020 2020 2020 2020 6c62  :.            lb
-00023010: 5f69 7020 3d20 6b2e 6372 6561 7465 5f6c  _ip = k.create_l
-00023020: 6f61 6462 616c 616e 6365 7228 6e61 6d65  oadbalancer(name
-00023030: 2c20 706f 7274 733d 706f 7274 732c 2063  , ports=ports, c
-00023040: 6865 636b 7061 7468 3d63 6865 636b 7061  heckpath=checkpa
-00023050: 7468 2c20 766d 733d 766d 732c 2064 6f6d  th, vms=vms, dom
-00023060: 6169 6e3d 646f 6d61 696e 2c0a 2020 2020  ain=domain,.    
-00023070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023090: 2020 2020 2020 6368 6563 6b70 6f72 743d        checkport=
-000230a0: 6368 6563 6b70 6f72 742c 2061 6c69 6173  checkport, alias
-000230b0: 3d61 6c69 6173 2c20 696e 7465 726e 616c  =alias, internal
-000230c0: 3d69 6e74 6572 6e61 6c2c 0a20 2020 2020  =internal,.     
-000230d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000230e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000230f0: 2020 2020 2064 6e73 636c 6965 6e74 3d64       dnsclient=d
-00023100: 6e73 636c 6965 6e74 2c20 7375 626e 6574  nsclient, subnet
-00023110: 6964 3d73 7562 6e65 7469 642c 2069 703d  id=subnetid, ip=
-00023120: 6970 290a 2020 2020 2020 2020 2020 2020  ip).            
-00023130: 6966 2064 6e73 636c 6965 6e74 2069 7320  if dnsclient is 
-00023140: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00023150: 2020 2020 2020 2020 2020 6966 2064 6e73            if dns
-00023160: 636c 6965 6e74 2069 6e20 7365 6c66 2e63  client in self.c
-00023170: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-00023180: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
-00023190: 4b63 6f6e 6669 6728 636c 6965 6e74 3d64  Kconfig(client=d
-000231a0: 6e73 636c 6965 6e74 292e 6b0a 2020 2020  nsclient).k.    
-000231b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000231c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000231d0: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-000231e0: 436c 6965 6e74 207b 646e 7363 6c69 656e  Client {dnsclien
-000231f0: 747d 206e 6f74 2066 6f75 6e64 2e20 536b  t} not found. Sk
-00023200: 6970 7069 6e67 2229 0a20 2020 2020 2020  ipping").       
-00023210: 2020 2020 2020 2020 207a 2e72 6573 6572           z.reser
-00023220: 7665 5f64 6e73 286e 616d 652e 7265 706c  ve_dns(name.repl
-00023230: 6163 6528 275f 272c 2027 2d27 292c 2069  ace('_', '-'), i
-00023240: 703d 6c62 5f69 702c 2064 6f6d 6169 6e3d  p=lb_ip, domain=
-00023250: 646f 6d61 696e 2c20 616c 6961 733d 616c  domain, alias=al
-00023260: 6961 7329 0a20 2020 2020 2020 2065 6c73  ias).        els
-00023270: 653a 0a20 2020 2020 2020 2020 2020 2076  e:.            v
-00023280: 6d69 6e66 6f20 3d20 5b5d 0a20 2020 2020  minfo = [].     
-00023290: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
-000232a0: 2076 6d73 3a0a 2020 2020 2020 2020 2020   vms:.          
-000232b0: 2020 2020 2020 6966 2076 616c 6964 5f69        if valid_i
-000232c0: 7028 766d 293a 0a20 2020 2020 2020 2020  p(vm):.         
-000232d0: 2020 2020 2020 2020 2020 2076 6d6e 616d             vmnam
-000232e0: 6520 3d20 766d 2e72 6570 6c61 6365 2827  e = vm.replace('
-000232f0: 3a27 2c20 272d 2729 2e72 6570 6c61 6365  :', '-').replace
-00023300: 2827 2e27 2c20 272d 2729 0a20 2020 2020  ('.', '-').     
-00023310: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00023320: 6d69 6e66 6f2e 6170 7065 6e64 287b 276e  minfo.append({'n
-00023330: 616d 6527 3a20 766d 6e61 6d65 2c20 2769  ame': vmname, 'i
-00023340: 7027 3a20 766d 7d29 0a20 2020 2020 2020  p': vm}).       
-00023350: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00023360: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00023370: 2020 2020 2020 636f 756e 7465 7220 3d20        counter = 
-00023380: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00023390: 2020 7768 696c 6520 636f 756e 7465 7220    while counter 
-000233a0: 213d 2031 3030 3a0a 2020 2020 2020 2020  != 100:.        
-000233b0: 2020 2020 2020 2020 2020 2020 6970 203d              ip =
-000233c0: 206b 2e69 7028 766d 290a 2020 2020 2020   k.ip(vm).      
-000233d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000233e0: 2069 7020 6973 204e 6f6e 653a 0a20 2020   ip is None:.   
-000233f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023400: 2020 2020 2073 6c65 6570 2835 290a 2020       sleep(5).  
-00023410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023420: 2020 2020 2020 7072 696e 7428 6622 5761        print(f"Wa
-00023430: 6974 696e 6720 3520 7365 636f 6e64 7320  iting 5 seconds 
-00023440: 746f 2067 7261 6220 6970 2066 6f72 2076  to grab ip for v
-00023450: 6d20 7b76 6d7d 2e2e 2e22 290a 2020 2020  m {vm}...").    
-00023460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023470: 2020 2020 636f 756e 7465 7220 2b3d 2035      counter += 5
-00023480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023490: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000234a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234b0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-000234c0: 2020 2020 2020 2020 2076 6d69 6e66 6f2e           vminfo.
-000234d0: 6170 7065 6e64 287b 276e 616d 6527 3a20  append({'name': 
-000234e0: 766d 2c20 2769 7027 3a20 6970 7d29 0a20  vm, 'ip': ip}). 
-000234f0: 2020 2020 2020 2020 2020 206f 7665 7272             overr
-00023500: 6964 6573 203d 207b 0a20 2020 2020 2020  ides = {.       
-00023510: 2020 2020 2020 2020 2022 6e61 6d65 223a           "name":
-00023520: 206e 616d 652c 0a20 2020 2020 2020 2020   name,.         
-00023530: 2020 2020 2020 2022 766d 7322 3a20 766d         "vms": vm
-00023540: 696e 666f 2c0a 2020 2020 2020 2020 2020  info,.          
-00023550: 2020 2020 2020 226e 6574 7322 3a20 6e65        "nets": ne
-00023560: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-00023570: 2020 2020 2270 6f72 7473 223a 2070 6f72      "ports": por
-00023580: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-00023590: 2020 2020 2263 6865 636b 7061 7468 223a      "checkpath":
-000235a0: 2063 6865 636b 7061 7468 2c0a 2020 2020   checkpath,.    
-000235b0: 2020 2020 2020 2020 2020 2020 2264 6f6d              "dom
-000235c0: 6169 6e22 3a20 646f 6d61 696e 2c0a 2020  ain": domain,.  
-000235d0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-000235e0: 2020 2020 2020 2020 7365 6c66 2e70 6c61          self.pla
-000235f0: 6e28 706c 616e 2c20 696e 7075 7473 7472  n(plan, inputstr
-00023600: 696e 673d 6861 7072 6f78 7970 6c61 6e2c  ing=haproxyplan,
-00023610: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-00023620: 6964 6573 290a 0a20 2020 2064 6566 206c  ides)..    def l
-00023630: 6973 745f 6c6f 6164 6261 6c61 6e63 6572  ist_loadbalancer
-00023640: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00023650: 206b 203d 2073 656c 662e 6b0a 2020 2020   k = self.k.    
-00023660: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
-00023670: 206e 6f74 2069 6e20 5b27 6177 7327 2c20   not in ['aws', 
-00023680: 2767 6370 272c 2027 6962 6d27 5d3a 0a20  'gcp', 'ibm']:. 
-00023690: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-000236a0: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
-000236b0: 2020 2020 666f 7220 766d 2069 6e20 6b2e      for vm in k.
-000236c0: 6c69 7374 2829 3a0a 2020 2020 2020 2020  list():.        
-000236d0: 2020 2020 2020 2020 6966 2076 6d5b 2770          if vm['p
-000236e0: 726f 6669 6c65 275d 2e73 7461 7274 7377  rofile'].startsw
-000236f0: 6974 6828 276c 6f61 6462 616c 616e 6365  ith('loadbalance
-00023700: 7227 2920 616e 6420 6c65 6e28 766d 5b27  r') and len(vm['
-00023710: 7072 6f66 696c 6527 5d2e 7370 6c69 7428  profile'].split(
-00023720: 272d 2729 2920 3d3d 2032 3a0a 2020 2020  '-')) == 2:.    
-00023730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023740: 706f 7274 7320 3d20 766d 5b27 7072 6f66  ports = vm['prof
-00023750: 696c 6527 5d2e 7370 6c69 7428 272d 2729  ile'].split('-')
-00023760: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-00023770: 2020 2020 2020 2020 7265 7375 6c74 732e          results.
-00023780: 6170 7065 6e64 285b 766d 5b27 6e61 6d65  append([vm['name
-00023790: 275d 2c20 766d 5b27 6970 275d 2c20 2774  '], vm['ip'], 't
-000237a0: 6370 272c 2070 6f72 7473 2c20 2727 5d29  cp', ports, ''])
-000237b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000237c0: 7572 6e20 7265 7375 6c74 730a 2020 2020  urn results.    
-000237d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000237e0: 2020 2020 2020 7265 7475 726e 206b 2e6c        return k.l
-000237f0: 6973 745f 6c6f 6164 6261 6c61 6e63 6572  ist_loadbalancer
-00023800: 7328 290a 0a20 2020 2064 6566 2077 6169  s()..    def wai
-00023810: 745f 6669 6e69 7368 2873 656c 662c 206e  t_finish(self, n
-00023820: 616d 652c 2069 6d61 6765 3d4e 6f6e 652c  ame, image=None,
-00023830: 2071 7569 6574 3d46 616c 7365 2c20 7761   quiet=False, wa
-00023840: 6974 636f 6d6d 616e 643d 4e6f 6e65 2c20  itcommand=None, 
-00023850: 7761 6974 7469 6d65 6f75 743d 302c 2069  waittimeout=0, i
-00023860: 6465 6e74 6974 7966 696c 653d 4e6f 6e65  dentityfile=None
-00023870: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00023880: 2020 2020 2020 766d 636c 6965 6e74 3d4e        vmclient=N
-00023890: 6f6e 6529 3a0a 2020 2020 2020 2020 636f  one):.        co
-000238a0: 6e66 6967 203d 204b 636f 6e66 6967 2863  nfig = Kconfig(c
-000238b0: 6c69 656e 743d 766d 636c 6965 6e74 2920  lient=vmclient) 
-000238c0: 6966 2076 6d63 6c69 656e 7420 6973 206e  if vmclient is n
-000238d0: 6f74 204e 6f6e 6520 656c 7365 2073 656c  ot None else sel
-000238e0: 660a 2020 2020 2020 2020 6b20 3d20 636f  f.        k = co
-000238f0: 6e66 6967 2e6b 0a20 2020 2020 2020 2069  nfig.k.        i
-00023900: 6620 696d 6167 6520 6973 204e 6f6e 653a  f image is None:
-00023910: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-00023920: 6765 203d 206b 2e69 6e66 6f28 6e61 6d65  ge = k.info(name
-00023930: 295b 2769 6d61 6765 275d 0a20 2020 2020  )['image'].     
-00023940: 2020 2070 7072 696e 7428 6622 5761 6974     pprint(f"Wait
-00023950: 696e 6720 666f 7220 766d 207b 6e61 6d65  ing for vm {name
-00023960: 7d20 746f 2066 696e 6973 6820 6375 7374  } to finish cust
-00023970: 6f6d 6973 6174 696f 6e22 290a 2020 2020  omisation").    
-00023980: 2020 2020 6966 2077 6169 7463 6f6d 6d61      if waitcomma
-00023990: 6e64 2069 7320 6e6f 7420 4e6f 6e65 2061  nd is not None a
-000239a0: 6e64 2027 323e 2720 6e6f 7420 696e 2077  nd '2>' not in w
-000239b0: 6169 7463 6f6d 6d61 6e64 3a0a 2020 2020  aitcommand:.    
-000239c0: 2020 2020 2020 2020 7761 6974 636f 6d6d          waitcomm
-000239d0: 616e 6420 2b3d 2022 2032 3e2f 6465 762f  and += " 2>/dev/
-000239e0: 6e75 6c6c 220a 2020 2020 2020 2020 6966  null".        if
-000239f0: 2063 6f6d 6d6f 6e2e 6e65 6564 735f 6967   common.needs_ig
-00023a00: 6e69 7469 6f6e 2869 6d61 6765 293a 0a20  nition(image):. 
-00023a10: 2020 2020 2020 2020 2020 2063 6d64 203d             cmd =
-00023a20: 2077 6169 7463 6f6d 6d61 6e64 206f 7220   waitcommand or 
-00023a30: 2773 7564 6f20 6a6f 7572 6e61 6c63 746c  'sudo journalctl
-00023a40: 202d 2d61 6c6c 202d 2d6e 6f2d 7061 6765   --all --no-page
-00023a50: 7227 0a20 2020 2020 2020 2065 6c73 653a  r'.        else:
-00023a60: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
-00023a70: 203d 2077 6169 7463 6f6d 6d61 6e64 206f   = waitcommand o
-00023a80: 7220 6622 7375 646f 2074 6169 6c20 2d6e  r f"sudo tail -n
-00023a90: 2035 3020 7b63 6f6d 6d6f 6e2e 6765 745f   50 {common.get_
-00023aa0: 636c 6f75 6469 6e69 7466 696c 6528 696d  cloudinitfile(im
-00023ab0: 6167 6529 7d22 0a20 2020 2020 2020 2075  age)}".        u
-00023ac0: 7365 722c 2069 702c 2076 6d70 6f72 7420  ser, ip, vmport 
-00023ad0: 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  = None, None, No
-00023ae0: 6e65 0a20 2020 2020 2020 2068 6f73 7469  ne.        hosti
-00023af0: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
-00023b00: 2074 696d 656f 7574 203d 2030 0a20 2020   timeout = 0.   
-00023b10: 2020 2020 2077 6869 6c65 2069 7020 6973       while ip is
-00023b20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00023b30: 2020 2069 6e66 6f20 3d20 6b2e 696e 666f     info = k.info
-00023b40: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
-00023b50: 2020 2069 6620 636f 6e66 6967 2e74 7970     if config.typ
-00023b60: 6520 3d3d 2027 7061 636b 6574 2720 616e  e == 'packet' an
-00023b70: 6420 696e 666f 2e67 6574 2827 7374 6174  d info.get('stat
-00023b80: 7573 2729 2021 3d20 2761 6374 6976 6527  us') != 'active'
-00023b90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023ba0: 2020 7761 726e 696e 6728 2257 6169 7469    warning("Waiti
-00023bb0: 6e67 2066 6f72 206e 6f64 6520 746f 2062  ng for node to b
-00023bc0: 6520 6163 7469 7665 2229 0a20 2020 2020  e active").     
-00023bd0: 2020 2020 2020 2020 2020 2069 7020 3d20             ip = 
-00023be0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00023bf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00023c00: 2020 2020 2020 2075 7365 722c 2069 7020         user, ip 
-00023c10: 3d20 636f 6e66 6967 2e76 6d75 7365 7220  = config.vmuser 
-00023c20: 6f72 2069 6e66 6f2e 6765 7428 2775 7365  or info.get('use
-00023c30: 7227 292c 2069 6e66 6f2e 6765 7428 2769  r'), info.get('i
-00023c40: 7027 290a 2020 2020 2020 2020 2020 2020  p').            
-00023c50: 2020 2020 6966 2063 6f6e 6669 672e 7479      if config.ty
-00023c60: 7065 203d 3d20 276b 7562 6576 6972 7427  pe == 'kubevirt'
-00023c70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023c80: 2020 2020 2020 6966 206b 2e61 6363 6573        if k.acces
-00023c90: 735f 6d6f 6465 203d 3d20 274e 6f64 6550  s_mode == 'NodeP
-00023ca0: 6f72 7427 3a0a 2020 2020 2020 2020 2020  ort':.          
-00023cb0: 2020 2020 2020 2020 2020 2020 2020 766d                vm
-00023cc0: 706f 7274 203d 2069 6e66 6f2e 6765 7428  port = info.get(
-00023cd0: 276e 6f64 6570 6f72 7427 290a 2020 2020  'nodeport').    
-00023ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cf0: 2020 2020 6966 2068 6f73 7469 7020 6973      if hostip is
-00023d00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00023d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d20: 2020 2068 6f73 7469 7020 3d20 6b2e 6e6f     hostip = k.no
-00023d30: 6465 5f68 6f73 7428 6e61 6d65 3d69 6e66  de_host(name=inf
-00023d40: 6f2e 6765 7428 2768 6f73 7427 2929 0a20  o.get('host')). 
-00023d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d60: 2020 2020 2020 2069 7020 3d20 686f 7374         ip = host
-00023d70: 6970 0a20 2020 2020 2020 2020 2020 2020  ip.             
-00023d80: 2020 2020 2020 2065 6c69 6620 6b2e 6163         elif k.ac
-00023d90: 6365 7373 5f6d 6f64 6520 3d3d 2027 4c6f  cess_mode == 'Lo
-00023da0: 6164 4261 6c61 6e63 6572 273a 0a20 2020  adBalancer':.   
-00023db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023dc0: 2020 2020 2069 7020 3d20 696e 666f 2e67       ip = info.g
-00023dd0: 6574 2827 6c6f 6164 6261 6c61 6e63 6572  et('loadbalancer
-00023de0: 6970 2729 0a20 2020 2020 2020 2020 2020  ip').           
-00023df0: 2020 2020 2069 6620 7573 6572 2069 7320       if user is 
-00023e00: 6e6f 7420 4e6f 6e65 2061 6e64 2069 7020  not None and ip 
-00023e10: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000227d0: 2020 2020 6966 2027 7765 6227 2069 6e20      if 'web' in 
+000227e0: 7379 732e 6172 6776 5b30 5d3a 0a20 2020  sys.argv[0]:.   
+000227f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022800: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00022810: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
+00022820: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
+00022830: 224d 6973 7369 6e67 2075 726c 227d 0a20  "Missing url"}. 
+00022840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022850: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00022860: 4f70 656e 696e 6720 7572 6c20 7b75 726c  Opening url {url
+00022870: 7d20 666f 7220 796f 7520 746f 2067 7261  } for you to gra
+00022880: 6220 636f 6d70 6c65 7465 2075 726c 2066  b complete url f
+00022890: 6f72 207b 696d 6167 657d 206b 766d 2067  or {image} kvm g
+000228a0: 7565 7374 2069 6d61 6765 2229 0a20 2020  uest image").   
+000228b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000228c0: 2020 2020 2077 6562 6272 6f77 7365 722e       webbrowser.
+000228d0: 6f70 656e 2875 726c 2c20 6e65 773d 322c  open(url, new=2,
+000228e0: 2061 7574 6f72 6169 7365 3d54 7275 6529   autoraise=True)
+000228f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022900: 2020 2020 2020 2020 2075 726c 203d 2069           url = i
+00022910: 6e70 7574 2822 436f 7079 2055 726c 3a5c  nput("Copy Url:\
+00022920: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00022930: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+00022940: 726c 2e73 7472 6970 2829 203d 3d20 2727  rl.strip() == ''
+00022950: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022960: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00022970: 726f 7228 224d 6973 7369 6e67 2070 726f  ror("Missing pro
+00022980: 7065 7220 7572 6c2e 4c65 6176 696e 672e  per url.Leaving.
+00022990: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+000229a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000229b0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+000229c0: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
+000229d0: 6561 736f 6e27 3a20 224d 6973 7369 6e67  eason': "Missing
+000229e0: 2069 6d61 6765 227d 0a20 2020 2020 2020   image"}.       
+000229f0: 2020 2020 2020 2020 2069 6620 636d 6420           if cmd 
+00022a00: 6973 204e 6f6e 6520 616e 6420 696d 6167  is None and imag
+00022a10: 6520 213d 2027 2720 616e 6420 696d 6167  e != '' and imag
+00022a20: 6520 696e 2049 4d41 4745 5343 4f4d 4d41  e in IMAGESCOMMA
+00022a30: 4e44 533a 0a20 2020 2020 2020 2020 2020  NDS:.           
+00022a40: 2020 2020 2020 2020 2063 6d64 203d 2049           cmd = I
+00022a50: 4d41 4745 5343 4f4d 4d41 4e44 535b 696d  MAGESCOMMANDS[im
+00022a60: 6167 655d 0a20 2020 2020 2020 2020 2020  age].           
+00022a70: 2020 2020 2070 7072 696e 7428 6622 4772       pprint(f"Gr
+00022a80: 6162 6269 6e67 2069 6d61 6765 207b 696d  abbing image {im
+00022a90: 6167 657d 2066 726f 6d20 7572 6c20 7b75  age} from url {u
+00022aa0: 726c 7d22 290a 2020 2020 2020 2020 2020  rl}").          
+00022ab0: 2020 2020 2020 6e65 6564 5f69 736f 203d        need_iso =
+00022ac0: 2027 6170 692f 6173 7369 7374 6564 2d69   'api/assisted-i
+00022ad0: 6d61 6765 732f 696d 6167 6573 2720 696e  mages/images' in
+00022ae0: 2075 726c 0a20 2020 2020 2020 2020 2020   url.           
+00022af0: 2020 2020 2073 686f 7274 6e61 6d65 203d       shortname =
+00022b00: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+00022b10: 6528 7572 6c29 2e73 706c 6974 2827 3f27  e(url).split('?'
+00022b20: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
+00022b30: 2020 2020 2069 6620 6e65 6564 5f69 736f       if need_iso
+00022b40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022b50: 2020 2020 2020 696d 6167 6520 3d20 6627        image = f'
+00022b60: 626f 6f74 2d7b 7368 6f72 746e 616d 657d  boot-{shortname}
+00022b70: 2e69 736f 270a 2020 2020 2020 2020 2020  .iso'.          
+00022b80: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00022b90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00022ba0: 6f6e 7665 7274 203d 2027 2e72 6177 2e27  onvert = '.raw.'
+00022bb0: 2069 6e20 7572 6c0a 2020 2020 2020 2020   in url.        
+00022bc0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00022bd0: 6c74 203d 206b 2e61 6464 5f69 6d61 6765  lt = k.add_image
+00022be0: 2875 726c 2c20 706f 6f6c 2c20 636d 643d  (url, pool, cmd=
+00022bf0: 636d 642c 206e 616d 653d 696d 6167 652c  cmd, name=image,
+00022c00: 2073 697a 653d 7369 7a65 2c20 636f 6e76   size=size, conv
+00022c10: 6572 743d 636f 6e76 6572 7429 0a20 2020  ert=convert).   
+00022c20: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00022c30: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00022c40: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00022c50: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+00022c60: 476f 7420 7b65 7d22 290a 2020 2020 2020  Got {e}").      
+00022c70: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00022c80: 726f 7228 6622 506c 6561 7365 2072 756e  ror(f"Please run
+00022c90: 206b 636c 6920 6465 6c65 7465 2069 6d61   kcli delete ima
+00022ca0: 6765 202d 2d79 6573 207b 7368 6f72 746e  ge --yes {shortn
+00022cb0: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
+00022cc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00022cd0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+00022ce0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+00022cf0: 3a20 2255 7365 7220 696e 7465 7272 7570  : "User interrup
+00022d00: 7469 6f6e 227d 0a20 2020 2020 2020 2020  tion"}.         
+00022d10: 2020 2020 2020 2066 6f75 6e64 203d 2027         found = '
+00022d20: 666f 756e 6427 2069 6e20 7265 7375 6c74  found' in result
+00022d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022d40: 2069 6620 666f 756e 643a 0a20 2020 2020   if found:.     
+00022d50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00022d60: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00022d70: 2027 7375 6363 6573 7327 7d0a 2020 2020   'success'}.    
+00022d80: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+00022d90: 6f6e 2e68 616e 646c 655f 7265 7370 6f6e  on.handle_respon
+00022da0: 7365 2872 6573 756c 742c 2069 6d61 6765  se(result, image
+00022db0: 2c20 656c 656d 656e 743d 2749 6d61 6765  , element='Image
+00022dc0: 272c 2061 6374 696f 6e3d 2741 6464 6564  ', action='Added
+00022dd0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00022de0: 2020 2069 6620 7265 7375 6c74 5b27 7265     if result['re
+00022df0: 7375 6c74 275d 2021 3d20 2773 7563 6365  sult'] != 'succe
+00022e00: 7373 273a 0a20 2020 2020 2020 2020 2020  ss':.           
+00022e10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00022e20: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
+00022e30: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
+00022e40: 7265 7375 6c74 5b27 7265 6173 6f6e 275d  result['reason']
+00022e50: 7d0a 2020 2020 2020 2020 2020 2020 7265  }.            re
+00022e60: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00022e70: 2773 7563 6365 7373 277d 0a20 2020 2020  'success'}.     
+00022e80: 2020 2065 6c69 6620 7377 6974 6368 3a0a     elif switch:.
+00022e90: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00022ea0: 7769 7463 6820 6e6f 7420 696e 2073 656c  witch not in sel
+00022eb0: 662e 636c 6965 6e74 733a 0a20 2020 2020  f.clients:.     
+00022ec0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00022ed0: 2866 2243 6c69 656e 7420 7b73 7769 7463  (f"Client {switc
+00022ee0: 687d 206e 6f74 2066 6f75 6e64 2069 6e20  h} not found in 
+00022ef0: 636f 6e66 6967 2e4c 6561 7669 6e67 2e2e  config.Leaving..
+00022f00: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00022f10: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00022f20: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00022f30: 2c20 2772 6561 736f 6e27 3a20 6622 436c  , 'reason': f"Cl
+00022f40: 6965 6e74 207b 7377 6974 6368 7d20 6e6f  ient {switch} no
+00022f50: 7420 666f 756e 6420 696e 2063 6f6e 6669  t found in confi
+00022f60: 6722 7d0a 2020 2020 2020 2020 2020 2020  g"}.            
+00022f70: 656e 6162 6c65 6420 3d20 7365 6c66 2e69  enabled = self.i
+00022f80: 6e69 5b73 7769 7463 685d 2e67 6574 2827  ni[switch].get('
+00022f90: 656e 6162 6c65 6427 2c20 5472 7565 290a  enabled', True).
+00022fa0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00022fb0: 6f74 2065 6e61 626c 6564 3a0a 2020 2020  ot enabled:.    
+00022fc0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00022fd0: 7228 6622 436c 6965 6e74 207b 7377 6974  r(f"Client {swit
+00022fe0: 6368 7d20 6973 2064 6973 6162 6c65 642e  ch} is disabled.
+00022ff0: 4c65 6176 696e 672e 2e2e 2e22 290a 2020  Leaving....").  
+00023000: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00023010: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00023020: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+00023030: 6f6e 273a 2066 2243 6c69 656e 7420 7b73  on': f"Client {s
+00023040: 7769 7463 687d 2069 7320 6469 7361 626c  witch} is disabl
+00023050: 6564 227d 0a20 2020 2020 2020 2020 2020  ed"}.           
+00023060: 2070 7072 696e 7428 6622 5377 6974 6368   pprint(f"Switch
+00023070: 696e 6720 746f 2063 6c69 656e 7420 7b73  ing to client {s
+00023080: 7769 7463 687d 2e2e 2e22 290a 2020 2020  witch}...").    
+00023090: 2020 2020 2020 2020 696e 6966 696c 6520          inifile 
+000230a0: 3d20 2225 732f 2e6b 636c 692f 636f 6e66  = "%s/.kcli/conf
+000230b0: 6967 2e79 6d6c 2220 2520 6f73 2e65 6e76  ig.yml" % os.env
+000230c0: 6972 6f6e 2e67 6574 2827 484f 4d45 2729  iron.get('HOME')
+000230d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000230e0: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
+000230f0: 6e69 6669 6c65 293a 0a20 2020 2020 2020  nifile):.       
+00023100: 2020 2020 2020 2020 206e 6577 696e 6920           newini 
+00023110: 3d20 2727 0a20 2020 2020 2020 2020 2020  = ''.           
+00023120: 2020 2020 2066 6f72 206c 696e 6520 696e       for line in
+00023130: 206f 7065 6e28 696e 6966 696c 6529 2e72   open(inifile).r
+00023140: 6561 646c 696e 6573 2829 3a0a 2020 2020  eadlines():.    
+00023150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023160: 6966 2027 636c 6965 6e74 2720 696e 206c  if 'client' in l
+00023170: 696e 653a 0a20 2020 2020 2020 2020 2020  ine:.           
+00023180: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00023190: 696e 6920 2b3d 2066 2220 636c 6965 6e74  ini += f" client
+000231a0: 3a20 7b73 7769 7463 687d 5c6e 220a 2020  : {switch}\n".  
+000231b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000231d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231e0: 6e65 7769 6e69 202b 3d20 6c69 6e65 0a20  newini += line. 
+000231f0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00023200: 7065 6e28 696e 6966 696c 652c 2027 7727  pen(inifile, 'w'
+00023210: 292e 7772 6974 6528 6e65 7769 6e69 290a  ).write(newini).
+00023220: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00023230: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
+00023240: 7563 6365 7373 277d 0a20 2020 2020 2020  uccess'}.       
+00023250: 2065 6c69 6620 7379 6e63 3a0a 2020 2020   elif sync:.    
+00023260: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
+00023270: 2e6b 0a20 2020 2020 2020 2020 2020 2069  .k.            i
+00023280: 6620 6e6f 7420 7365 6c66 2e65 7874 7261  f not self.extra
+00023290: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
+000232a0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+000232b0: 2822 4e6f 7468 696e 6720 746f 2064 6f2e  ("Nothing to do.
+000232c0: 204c 6561 7669 6e67 2e2e 2e22 290a 2020   Leaving...").  
+000232d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000232e0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+000232f0: 2773 7563 6365 7373 277d 0a20 2020 2020  'success'}.     
+00023300: 2020 2020 2020 2066 6f72 2063 6c69 2069         for cli i
+00023310: 6e20 7365 6c66 2e65 7874 7261 636c 6965  n self.extraclie
+00023320: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00023330: 2020 2020 2064 6573 7420 3d20 7365 6c66       dest = self
+00023340: 2e65 7874 7261 636c 6965 6e74 735b 636c  .extraclients[cl
+00023350: 695d 0a20 2020 2020 2020 2020 2020 2020  i].             
+00023360: 2020 2070 7072 696e 7428 6622 7379 6e63     pprint(f"sync
+00023370: 696e 6720 636c 6965 6e74 2069 6d61 6765  ing client image
+00023380: 7320 6672 6f6d 207b 7365 6c66 2e63 6c69  s from {self.cli
+00023390: 656e 747d 2074 6f20 7b63 6c69 7d22 290a  ent} to {cli}").
+000233a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000233b0: 7761 726e 696e 6728 224e 6f74 6520 7268  warning("Note rh
+000233c0: 656c 2069 6d61 6765 7320 6172 6520 6375  el images are cu
+000233d0: 7272 656e 746c 7920 6e6f 7420 7379 6e63  rrently not sync
+000233e0: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
+000233f0: 2066 6f72 2076 6f6c 2069 6e20 6b2e 766f   for vol in k.vo
+00023400: 6c75 6d65 7328 293a 0a20 2020 2020 2020  lumes():.       
+00023410: 2020 2020 2020 2020 2069 6d61 6765 203d           image =
+00023420: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+00023430: 6528 766f 6c29 0a20 2020 2020 2020 2020  e(vol).         
+00023440: 2020 2020 2020 2069 6620 696d 6167 6520         if image 
+00023450: 696e 205b 6f73 2e70 6174 682e 6261 7365  in [os.path.base
+00023460: 6e61 6d65 2876 2920 666f 7220 7620 696e  name(v) for v in
+00023470: 2064 6573 742e 766f 6c75 6d65 7328 295d   dest.volumes()]
+00023480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023490: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+000234a0: 4967 6e6f 7269 6e67 207b 696d 6167 657d  Ignoring {image}
+000234b0: 2061 7320 6974 2773 2061 6c72 6561 6479   as it's already
+000234c0: 2074 6865 7265 2229 0a20 2020 2020 2020   there").       
+000234d0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000234e0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+000234f0: 2020 2020 2020 7572 6c20 3d20 4e6f 6e65        url = None
+00023500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023510: 2066 6f72 206e 2069 6e20 6c69 7374 2849   for n in list(I
+00023520: 4d41 4745 532e 7661 6c75 6573 2829 293a  MAGES.values()):
+00023530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023540: 2020 2020 2069 6620 6e20 6973 204e 6f6e       if n is Non
+00023550: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00023560: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00023570: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00023580: 2020 2020 2020 2020 656c 6966 206e 2e73          elif n.s
+00023590: 706c 6974 2827 2f27 295b 2d31 5d20 3d3d  plit('/')[-1] ==
+000235a0: 2069 6d61 6765 3a0a 2020 2020 2020 2020   image:.        
+000235b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235c0: 7572 6c20 3d20 6e0a 2020 2020 2020 2020  url = n.        
+000235d0: 2020 2020 2020 2020 6966 2075 726c 2069          if url i
+000235e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000235f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00023600: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
+00023610: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
+00023620: 273a 2022 696d 6167 6520 6e6f 7420 696e  ': "image not in
+00023630: 2064 6566 6175 6c74 206c 6973 7422 7d0a   default list"}.
+00023640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023650: 6966 2069 6d61 6765 2e73 7461 7274 7377  if image.startsw
+00023660: 6974 6828 2772 6865 6c27 293a 0a20 2020  ith('rhel'):.   
+00023670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023680: 2069 6620 2777 6562 2720 696e 2073 7973   if 'web' in sys
+00023690: 2e61 7267 765b 305d 3a0a 2020 2020 2020  .argv[0]:.      
+000236a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236b0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+000236c0: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
+000236d0: 7265 6173 6f6e 273a 2022 4d69 7373 696e  reason': "Missin
+000236e0: 6720 7572 6c22 7d0a 2020 2020 2020 2020  g url"}.        
+000236f0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00023700: 6e74 2866 224f 7065 6e69 6e67 2075 726c  nt(f"Opening url
+00023710: 207b 7572 6c7d 2066 6f72 2079 6f75 2074   {url} for you t
+00023720: 6f20 6772 6162 2063 6f6d 706c 6574 6520  o grab complete 
+00023730: 7572 6c20 666f 7220 7b76 6f6c 7d20 6b76  url for {vol} kv
+00023740: 6d20 6775 6573 7420 696d 6167 6522 290a  m guest image").
+00023750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023760: 2020 2020 7765 6262 726f 7773 6572 2e6f      webbrowser.o
+00023770: 7065 6e28 7572 6c2c 206e 6577 3d32 2c20  pen(url, new=2, 
+00023780: 6175 746f 7261 6973 653d 5472 7565 290a  autoraise=True).
+00023790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000237a0: 2020 2020 7572 6c20 3d20 696e 7075 7428      url = input(
+000237b0: 2243 6f70 7920 5572 6c3a 5c6e 2229 0a20  "Copy Url:\n"). 
+000237c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000237d0: 2020 2069 6620 7572 6c2e 7374 7269 7028     if url.strip(
+000237e0: 2920 3d3d 2027 273a 0a20 2020 2020 2020  ) == '':.       
+000237f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023800: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
+00023810: 7072 6f70 6572 2075 726c 2e4c 6561 7669  proper url.Leavi
+00023820: 6e67 2e2e 2e22 290a 2020 2020 2020 2020  ng...").        
+00023830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023840: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+00023850: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+00023860: 6173 6f6e 273a 2022 4d69 7373 696e 6720  ason': "Missing 
+00023870: 696d 6167 6522 7d0a 2020 2020 2020 2020  image"}.        
+00023880: 2020 2020 2020 2020 636d 6420 3d20 4e6f          cmd = No
+00023890: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+000238a0: 2020 2069 6620 766f 6c20 696e 2049 4d41     if vol in IMA
+000238b0: 4745 5343 4f4d 4d41 4e44 533a 0a20 2020  GESCOMMANDS:.   
+000238c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238d0: 2063 6d64 203d 2049 4d41 4745 5343 4f4d   cmd = IMAGESCOM
+000238e0: 4d41 4e44 535b 696d 6167 655d 0a20 2020  MANDS[image].   
+000238f0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+00023900: 696e 7428 6622 4772 6162 6269 6e67 2069  int(f"Grabbing i
+00023910: 6d61 6765 207b 696d 6167 657d 2e2e 2e22  mage {image}..."
+00023920: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00023930: 2020 6465 7374 2e61 6464 5f69 6d61 6765    dest.add_image
+00023940: 2875 726c 2c20 706f 6f6c 2c20 636d 643d  (url, pool, cmd=
+00023950: 636d 6429 0a20 2020 2020 2020 2072 6574  cmd).        ret
+00023960: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00023970: 7375 6363 6573 7327 7d0a 0a20 2020 2064  success'}..    d
+00023980: 6566 2064 656c 6574 655f 6c6f 6164 6261  ef delete_loadba
+00023990: 6c61 6e63 6572 2873 656c 662c 206e 616d  lancer(self, nam
+000239a0: 652c 2064 6f6d 6169 6e3d 4e6f 6e65 293a  e, domain=None):
+000239b0: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
+000239c0: 662e 6b0a 2020 2020 2020 2020 7070 7269  f.k.        ppri
+000239d0: 6e74 2866 2244 656c 6574 696e 6720 6c6f  nt(f"Deleting lo
+000239e0: 6164 6261 6c61 6e63 6572 207b 6e61 6d65  adbalancer {name
+000239f0: 7d22 290a 2020 2020 2020 2020 6966 2073  }").        if s
+00023a00: 656c 662e 7479 7065 2069 6e20 5b27 6177  elf.type in ['aw
+00023a10: 7327 2c20 2761 7a75 7265 272c 2027 6763  s', 'azure', 'gc
+00023a20: 7027 2c20 2769 626d 275d 3a0a 2020 2020  p', 'ibm']:.    
+00023a30: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
+00023a40: 7420 3d20 6b2e 6465 6c65 7465 5f6c 6f61  t = k.delete_loa
+00023a50: 6462 616c 616e 6365 7228 6e61 6d65 290a  dbalancer(name).
+00023a60: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00023a70: 6f6d 6169 6e20 6973 206e 6f74 204e 6f6e  omain is not Non
+00023a80: 6520 616e 6420 646e 7363 6c69 656e 7420  e and dnsclient 
+00023a90: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00023aa0: 6973 696e 7374 616e 6365 2864 6e73 636c  isinstance(dnscl
+00023ab0: 6965 6e74 2c20 7374 7229 3a0a 2020 2020  ient, str):.    
+00023ac0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00023ad0: 6e73 636c 6965 6e74 2069 6e20 7365 6c66  nsclient in self
+00023ae0: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
+00023af0: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
+00023b00: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
+00023b10: 3d64 6e73 636c 6965 6e74 292e 6b0a 2020  =dnsclient).k.  
+00023b20: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00023b30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00023b40: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00023b50: 6622 436c 6965 6e74 207b 646e 7363 6c69  f"Client {dnscli
+00023b60: 656e 747d 206e 6f74 2066 6f75 6e64 2e20  ent} not found. 
+00023b70: 536b 6970 7069 6e67 2229 0a20 2020 2020  Skipping").     
+00023b80: 2020 2020 2020 2020 2020 207a 2e64 656c             z.del
+00023b90: 6574 655f 646e 7328 6e61 6d65 2e72 6570  ete_dns(name.rep
+00023ba0: 6c61 6365 2827 5f27 2c20 272d 2729 2c20  lace('_', '-'), 
+00023bb0: 646f 6d61 696e 290a 2020 2020 2020 2020  domain).        
+00023bc0: 656c 6966 2073 656c 662e 7479 7065 203d  elif self.type =
+00023bd0: 3d20 276b 766d 273a 0a20 2020 2020 2020  = 'kvm':.       
+00023be0: 2020 2020 206b 2e64 656c 6574 6528 6e61       k.delete(na
+00023bf0: 6d65 290a 0a20 2020 2064 6566 2063 7265  me)..    def cre
+00023c00: 6174 655f 6c6f 6164 6261 6c61 6e63 6572  ate_loadbalancer
+00023c10: 2873 656c 662c 206e 616d 652c 206e 6574  (self, name, net
+00023c20: 733d 5b27 6465 6661 756c 7427 5d2c 2070  s=['default'], p
+00023c30: 6f72 7473 3d5b 5d2c 2063 6865 636b 7061  orts=[], checkpa
+00023c40: 7468 3d27 2f27 2c20 766d 733d 5b5d 2c20  th='/', vms=[], 
+00023c50: 646f 6d61 696e 3d4e 6f6e 652c 0a20 2020  domain=None,.   
+00023c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c70: 2020 2020 2020 2020 2070 6c61 6e3d 4e6f           plan=No
+00023c80: 6e65 2c20 6368 6563 6b70 6f72 743d 3830  ne, checkport=80
+00023c90: 2c20 616c 6961 733d 5b5d 2c20 696e 7465  , alias=[], inte
+00023ca0: 726e 616c 3d46 616c 7365 2c20 646e 7363  rnal=False, dnsc
+00023cb0: 6c69 656e 743d 4e6f 6e65 2c20 7375 626e  lient=None, subn
+00023cc0: 6574 6964 3d4e 6f6e 652c 2069 703d 4e6f  etid=None, ip=No
+00023cd0: 6e65 293a 0a20 2020 2020 2020 206e 616d  ne):.        nam
+00023ce0: 6520 3d20 6e61 6d65 7574 696c 732e 6765  e = nameutils.ge
+00023cf0: 745f 7261 6e64 6f6d 5f6e 616d 6528 292e  t_random_name().
+00023d00: 7265 706c 6163 6528 275f 272c 2027 2d27  replace('_', '-'
+00023d10: 2920 6966 206e 616d 6520 6973 204e 6f6e  ) if name is Non
+00023d20: 6520 656c 7365 206e 616d 650a 2020 2020  e else name.    
+00023d30: 2020 2020 7070 7269 6e74 2866 2244 6570      pprint(f"Dep
+00023d40: 6c6f 7969 6e67 206c 6f61 6462 616c 616e  loying loadbalan
+00023d50: 6365 7220 7b6e 616d 657d 2229 0a20 2020  cer {name}").   
+00023d60: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
+00023d70: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00023d80: 7479 7065 2069 6e20 5b27 6177 7327 2c20  type in ['aws', 
+00023d90: 2761 7a75 7265 272c 2027 6763 7027 2c20  'azure', 'gcp', 
+00023da0: 2769 626d 275d 3a0a 2020 2020 2020 2020  'ibm']:.        
+00023db0: 2020 2020 6c62 5f69 7020 3d20 6b2e 6372      lb_ip = k.cr
+00023dc0: 6561 7465 5f6c 6f61 6462 616c 616e 6365  eate_loadbalance
+00023dd0: 7228 6e61 6d65 2c20 706f 7274 733d 706f  r(name, ports=po
+00023de0: 7274 732c 2063 6865 636b 7061 7468 3d63  rts, checkpath=c
+00023df0: 6865 636b 7061 7468 2c20 766d 733d 766d  heckpath, vms=vm
+00023e00: 732c 2064 6f6d 6169 6e3d 646f 6d61 696e  s, domain=domain
+00023e10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00023e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e30: 2069 6620 636f 6e66 6967 2e74 7970 6520   if config.type 
-00023e40: 3d3d 2027 6f70 656e 7374 6163 6b27 2061  == 'openstack' a
-00023e50: 6e64 2069 6e66 6f2e 6765 7428 2770 7269  nd info.get('pri
-00023e60: 7661 7465 6970 2729 203d 3d20 6970 2061  vateip') == ip a
-00023e70: 6e64 206b 2e65 7874 6572 6e61 6c5f 6e65  nd k.external_ne
-00023e80: 7477 6f72 6b20 6973 206e 6f74 204e 6f6e  twork is not Non
-00023e90: 655c 0a20 2020 2020 2020 2020 2020 2020  e\.             
-00023ea0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00023eb0: 6e64 2069 6e66 6f2e 6765 7428 276e 6574  nd info.get('net
-00023ec0: 7327 295b 305d 5b27 6e65 7427 5d20 213d  s')[0]['net'] !=
-00023ed0: 206b 2e65 7874 6572 6e61 6c5f 6e65 7477   k.external_netw
-00023ee0: 6f72 6b3a 0a20 2020 2020 2020 2020 2020  ork:.           
-00023ef0: 2020 2020 2020 2020 2020 2020 2077 6172               war
-00023f00: 6e69 6e67 2822 5761 6974 696e 6720 666f  ning("Waiting fo
-00023f10: 7220 666c 6f61 7469 6e67 2069 7020 696e  r floating ip in
-00023f20: 7374 6561 6420 6f66 2061 2070 7269 7661  stead of a priva
-00023f30: 7465 2069 702e 2e2e 2229 0a20 2020 2020  te ip...").     
-00023f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f50: 2020 2069 7020 3d20 4e6f 6e65 0a20 2020     ip = None.   
-00023f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00023f80: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00023f90: 6573 7463 6d64 203d 2063 6f6d 6d6f 6e2e  estcmd = common.
-00023fa0: 7373 6828 6e61 6d65 2c20 7573 6572 3d75  ssh(name, user=u
-00023fb0: 7365 722c 2069 703d 6970 2c20 7475 6e6e  ser, ip=ip, tunn
-00023fc0: 656c 3d63 6f6e 6669 672e 7475 6e6e 656c  el=config.tunnel
-00023fd0: 2c20 7475 6e6e 656c 686f 7374 3d63 6f6e  , tunnelhost=con
-00023fe0: 6669 672e 7475 6e6e 656c 686f 7374 2c0a  fig.tunnelhost,.
-00023ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024010: 2020 2020 2020 2020 2020 2020 2074 756e               tun
-00024020: 6e65 6c70 6f72 743d 636f 6e66 6967 2e74  nelport=config.t
-00024030: 756e 6e65 6c70 6f72 742c 2074 756e 6e65  unnelport, tunne
-00024040: 6c75 7365 723d 636f 6e66 6967 2e74 756e  luser=config.tun
-00024050: 6e65 6c75 7365 722c 0a20 2020 2020 2020  neluser,.       
-00024060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e30: 2020 2020 2020 2020 2020 2020 6368 6563              chec
+00023e40: 6b70 6f72 743d 6368 6563 6b70 6f72 742c  kport=checkport,
+00023e50: 2061 6c69 6173 3d61 6c69 6173 2c20 696e   alias=alias, in
+00023e60: 7465 726e 616c 3d69 6e74 6572 6e61 6c2c  ternal=internal,
+00023e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e90: 2020 2020 2020 2020 2020 2064 6e73 636c             dnscl
+00023ea0: 6965 6e74 3d64 6e73 636c 6965 6e74 2c20  ient=dnsclient, 
+00023eb0: 7375 626e 6574 6964 3d73 7562 6e65 7469  subnetid=subneti
+00023ec0: 642c 2069 703d 6970 290a 2020 2020 2020  d, ip=ip).      
+00023ed0: 2020 2020 2020 6966 2064 6e73 636c 6965        if dnsclie
+00023ee0: 6e74 2069 7320 6e6f 7420 4e6f 6e65 3a0a  nt is not None:.
+00023ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f00: 6966 2064 6e73 636c 6965 6e74 2069 6e20  if dnsclient in 
+00023f10: 7365 6c66 2e63 6c69 656e 7473 3a0a 2020  self.clients:.  
+00023f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f30: 2020 7a20 3d20 4b63 6f6e 6669 6728 636c    z = Kconfig(cl
+00023f40: 6965 6e74 3d64 6e73 636c 6965 6e74 292e  ient=dnsclient).
+00023f50: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00023f60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00023f70: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00023f80: 696e 6728 6622 436c 6965 6e74 207b 646e  ing(f"Client {dn
+00023f90: 7363 6c69 656e 747d 206e 6f74 2066 6f75  sclient} not fou
+00023fa0: 6e64 2e20 536b 6970 7069 6e67 2229 0a20  nd. Skipping"). 
+00023fb0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00023fc0: 2e72 6573 6572 7665 5f64 6e73 286e 616d  .reserve_dns(nam
+00023fd0: 652e 7265 706c 6163 6528 275f 272c 2027  e.replace('_', '
+00023fe0: 2d27 292c 2069 703d 6c62 5f69 702c 2064  -'), ip=lb_ip, d
+00023ff0: 6f6d 6169 6e3d 646f 6d61 696e 2c20 616c  omain=domain, al
+00024000: 6961 733d 616c 6961 7329 0a20 2020 2020  ias=alias).     
+00024010: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00024020: 2020 2020 2076 6d69 6e66 6f20 3d20 5b5d       vminfo = []
+00024030: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00024040: 2076 6d20 696e 2076 6d73 3a0a 2020 2020   vm in vms:.    
+00024050: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+00024060: 616c 6964 5f69 7028 766d 293a 0a20 2020  alid_ip(vm):.   
 00024070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024080: 2020 2020 2020 696e 7365 6375 7265 3d63        insecure=c
-00024090: 6f6e 6669 672e 696e 7365 6375 7265 2c20  onfig.insecure, 
-000240a0: 636d 643d 2769 6420 2d75 6e27 2c20 766d  cmd='id -un', vm
-000240b0: 706f 7274 3d76 6d70 6f72 742c 0a20 2020  port=vmport,.   
-000240c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240e0: 2020 2020 2020 2020 2020 6964 656e 7469            identi
-000240f0: 7479 6669 6c65 3d69 6465 6e74 6974 7966  tyfile=identityf
-00024100: 696c 652c 2070 6173 7377 6f72 643d 4661  ile, password=Fa
-00024110: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
-00024120: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00024130: 6f73 2e70 6f70 656e 2874 6573 7463 6d64  os.popen(testcmd
-00024140: 292e 7265 6164 2829 2e73 7472 6970 2829  ).read().strip()
-00024150: 2021 3d20 7573 6572 3a0a 2020 2020 2020   != user:.      
-00024160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024170: 2020 2020 2020 7761 726e 696e 6728 2247        warning("G
-00024180: 6174 6865 7265 6420 6970 206e 6f74 2066  athered ip not f
-00024190: 756e 6374 696f 6e61 6c20 7965 742e 2e2e  unctional yet...
-000241a0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000241b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000241c0: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
-000241d0: 2020 2020 2070 7072 696e 7428 2257 6169       pprint("Wai
-000241e0: 7469 6e67 2066 6f72 2076 6d20 746f 2062  ting for vm to b
-000241f0: 6520 6163 6365 7373 6962 6c65 2e2e 2e22  e accessible..."
-00024200: 290a 2020 2020 2020 2020 2020 2020 736c  ).            sl
-00024210: 6565 7028 3529 0a20 2020 2020 2020 2020  eep(5).         
-00024220: 2020 2074 696d 656f 7574 202b 3d20 350a     timeout += 5.
-00024230: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-00024240: 6169 7474 696d 656f 7574 203e 2030 2061  aittimeout > 0 a
-00024250: 6e64 2074 696d 656f 7574 203e 2077 6169  nd timeout > wai
-00024260: 7474 696d 656f 7574 3a0a 2020 2020 2020  ttimeout:.      
-00024270: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00024280: 2254 696d 656f 7574 2077 6169 7469 6e67  "Timeout waiting
-00024290: 2066 6f72 2076 6d20 746f 2062 6520 6163   for vm to be ac
-000242a0: 6365 7373 6962 6c65 2e2e 2e22 290a 2020  cessible...").  
-000242b0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-000242c0: 6561 6b0a 2020 2020 2020 2020 736c 6565  eak.        slee
-000242d0: 7028 3529 0a20 2020 2020 2020 206f 6c64  p(5).        old
-000242e0: 6f75 7470 7574 203d 2027 270a 2020 2020  output = ''.    
-000242f0: 2020 2020 7469 6d65 6f75 7420 3d20 300a      timeout = 0.
-00024300: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
-00024310: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-00024320: 7373 6863 6d64 203d 2063 6f6d 6d6f 6e2e  sshcmd = common.
-00024330: 7373 6828 6e61 6d65 2c20 7573 6572 3d27  ssh(name, user='
-00024340: 726f 6f74 272c 2069 703d 6970 2c20 7475  root', ip=ip, tu
-00024350: 6e6e 656c 3d63 6f6e 6669 672e 7475 6e6e  nnel=config.tunn
-00024360: 656c 2c20 7475 6e6e 656c 686f 7374 3d63  el, tunnelhost=c
-00024370: 6f6e 6669 672e 7475 6e6e 656c 686f 7374  onfig.tunnelhost
-00024380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00024390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243a0: 2020 766d 706f 7274 3d76 6d70 6f72 742c    vmport=vmport,
-000243b0: 2074 756e 6e65 6c70 6f72 743d 636f 6e66   tunnelport=conf
-000243c0: 6967 2e74 756e 6e65 6c70 6f72 742c 2074  ig.tunnelport, t
-000243d0: 756e 6e65 6c75 7365 723d 636f 6e66 6967  unneluser=config
-000243e0: 2e74 756e 6e65 6c75 7365 722c 0a20 2020  .tunneluser,.   
-000243f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024400: 2020 2020 2020 2020 2020 2020 2069 6e73               ins
-00024410: 6563 7572 653d 636f 6e66 6967 2e69 6e73  ecure=config.ins
-00024420: 6563 7572 652c 2063 6d64 3d63 6d64 2c20  ecure, cmd=cmd, 
-00024430: 6964 656e 7469 7479 6669 6c65 3d69 6465  identityfile=ide
-00024440: 6e74 6974 7966 696c 652c 2070 6173 7377  ntityfile, passw
-00024450: 6f72 643d 4661 6c73 6529 0a20 2020 2020  ord=False).     
-00024460: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
-00024470: 6f73 2e70 6f70 656e 2873 7368 636d 6429  os.popen(sshcmd)
-00024480: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-00024490: 2020 2020 6966 2077 6169 7463 6f6d 6d61      if waitcomma
-000244a0: 6e64 2069 7320 6e6f 7420 4e6f 6e65 3a0a  nd is not None:.
-000244b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244c0: 6966 206f 7574 7075 7420 213d 2027 273a  if output != '':
-000244d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000244e0: 2020 2020 2070 7269 6e74 286f 7574 7075       print(outpu
-000244f0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00024500: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-00024510: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00024520: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00024530: 2020 2020 2020 2070 7072 696e 7428 2257         pprint("W
-00024540: 6169 7469 6e67 2066 6f72 2077 6169 7463  aiting for waitc
-00024550: 6f6d 6d61 6e64 2074 6f20 7375 6363 6565  ommand to succee
-00024560: 642e 2e2e 2229 0a20 2020 2020 2020 2020  d...").         
-00024570: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00024580: 2020 2020 2020 2020 2069 6620 276b 636c           if 'kcl
-00024590: 6920 626f 6f74 2066 696e 6973 6865 6427  i boot finished'
-000245a0: 2069 6e20 6f75 7470 7574 206f 7220 2749   in output or 'I
-000245b0: 676e 6974 696f 6e20 6669 6e69 7368 6564  gnition finished
-000245c0: 2073 7563 6365 7373 6675 6c6c 7927 2069   successfully' i
-000245d0: 6e20 6f75 7470 7574 206f 725c 0a20 2020  n output or\.   
-000245e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000245f0: 2746 696e 6973 6865 6420 436f 6d62 7573  'Finished Combus
-00024600: 7469 6f6e 2720 696e 206f 7574 7075 743a  tion' in output:
-00024610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024620: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-00024630: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-00024640: 7420 3d20 6f75 7470 7574 2e72 6570 6c61  t = output.repla
-00024650: 6365 286f 6c64 6f75 7470 7574 2c20 2727  ce(oldoutput, ''
-00024660: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00024670: 2020 6966 206e 6f74 2071 7569 6574 3a0a    if not quiet:.
-00024680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024690: 2020 2020 7072 696e 7428 6f75 7470 7574      print(output
-000246a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000246b0: 2020 6f6c 646f 7574 7075 7420 3d20 6f75    oldoutput = ou
-000246c0: 7470 7574 0a20 2020 2020 2020 2020 2020  tput.           
-000246d0: 2073 6c65 6570 2832 290a 2020 2020 2020   sleep(2).      
-000246e0: 2020 2020 2020 7469 6d65 6f75 7420 2b3d        timeout +=
-000246f0: 2032 0a20 2020 2020 2020 2020 2020 2069   2.            i
-00024700: 6620 7761 6974 7469 6d65 6f75 7420 3e20  f waittimeout > 
-00024710: 3020 616e 6420 7469 6d65 6f75 7420 3e20  0 and timeout > 
-00024720: 7761 6974 7469 6d65 6f75 743a 0a20 2020  waittimeout:.   
-00024730: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00024740: 6f72 2822 5469 6d65 6f75 7420 7761 6974  or("Timeout wait
-00024750: 696e 6720 666f 7220 7761 6974 636f 6d6d  ing for waitcomm
-00024760: 616e 6420 746f 2065 7865 6375 7465 2e2e  and to execute..
-00024770: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00024780: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-00024790: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
-000247a0: 2020 2064 6566 2063 6c65 616e 5f74 656d     def clean_tem
-000247b0: 706b 6579 2873 656c 662c 206e 616d 652c  pkey(self, name,
-000247c0: 2069 6465 6e74 6974 7966 696c 653d 4e6f   identityfile=No
-000247d0: 6e65 293a 0a20 2020 2020 2020 2063 6d64  ne):.        cmd
-000247e0: 203d 2022 7365 6420 2d69 2027 2f74 656d   = "sed -i '/tem
-000247f0: 702d 6b63 6c69 2d6b 6579 2f64 2720 2f68  p-kcli-key/d' /h
-00024800: 6f6d 652f 2a2f 2e73 7368 2f61 7574 686f  ome/*/.ssh/autho
-00024810: 7269 7a65 645f 6b65 7973 202f 726f 6f74  rized_keys /root
-00024820: 2f2e 7373 682f 6175 7468 6f72 697a 6564  /.ssh/authorized
-00024830: 5f6b 6579 7322 0a20 2020 2020 2020 206b  _keys".        k
-00024840: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
-00024850: 2020 696e 666f 203d 206b 2e69 6e66 6f28    info = k.info(
-00024860: 6e61 6d65 290a 2020 2020 2020 2020 766d  name).        vm
-00024870: 706f 7274 203d 204e 6f6e 650a 2020 2020  port = None.    
-00024880: 2020 2020 6970 203d 2069 6e66 6f2e 6765      ip = info.ge
-00024890: 7428 2769 7027 290a 2020 2020 2020 2020  t('ip').        
-000248a0: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
-000248b0: 276b 7562 6576 6972 7427 3a0a 2020 2020  'kubevirt':.    
-000248c0: 2020 2020 2020 2020 6966 206b 2e61 6363          if k.acc
-000248d0: 6573 735f 6d6f 6465 203d 3d20 274e 6f64  ess_mode == 'Nod
-000248e0: 6550 6f72 7427 3a0a 2020 2020 2020 2020  ePort':.        
-000248f0: 2020 2020 2020 2020 766d 706f 7274 203d          vmport =
-00024900: 2069 6e66 6f2e 6765 7428 276e 6f64 6570   info.get('nodep
-00024910: 6f72 7427 290a 2020 2020 2020 2020 2020  ort').          
-00024920: 2020 2020 2020 6970 203d 206b 2e6e 6f64        ip = k.nod
-00024930: 655f 686f 7374 286e 616d 653d 696e 666f  e_host(name=info
-00024940: 2e67 6574 2827 686f 7374 2729 290a 2020  .get('host')).  
-00024950: 2020 2020 2020 2020 2020 656c 6966 206b            elif k
-00024960: 2e61 6363 6573 735f 6d6f 6465 203d 3d20  .access_mode == 
-00024970: 274c 6f61 6442 616c 616e 6365 7227 3a0a  'LoadBalancer':.
-00024980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024990: 6970 203d 2069 6e66 6f2e 6765 7428 276c  ip = info.get('l
-000249a0: 6f61 6462 616c 616e 6365 7269 7027 290a  oadbalancerip').
-000249b0: 2020 2020 2020 2020 7373 6863 6d64 203d          sshcmd =
-000249c0: 2063 6f6d 6d6f 6e2e 7373 6828 6e61 6d65   common.ssh(name
-000249d0: 2c20 7573 6572 3d27 726f 6f74 272c 2069  , user='root', i
-000249e0: 703d 6970 2c20 7475 6e6e 656c 3d73 656c  p=ip, tunnel=sel
-000249f0: 662e 7475 6e6e 656c 2c20 7475 6e6e 656c  f.tunnel, tunnel
-00024a00: 686f 7374 3d73 656c 662e 7475 6e6e 656c  host=self.tunnel
-00024a10: 686f 7374 2c20 766d 706f 7274 3d76 6d70  host, vmport=vmp
-00024a20: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-00024a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a40: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
-00024a50: 2e74 756e 6e65 6c70 6f72 742c 2074 756e  .tunnelport, tun
-00024a60: 6e65 6c75 7365 723d 7365 6c66 2e74 756e  neluser=self.tun
-00024a70: 6e65 6c75 7365 722c 2069 6e73 6563 7572  neluser, insecur
-00024a80: 653d 7365 6c66 2e69 6e73 6563 7572 652c  e=self.insecure,
-00024a90: 2063 6d64 3d63 6d64 2c0a 2020 2020 2020   cmd=cmd,.      
-00024aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ab0: 2020 2020 2020 6964 656e 7469 7479 6669        identityfi
-00024ac0: 6c65 3d69 6465 6e74 6974 7966 696c 652c  le=identityfile,
-00024ad0: 2070 6173 7377 6f72 643d 4661 6c73 6529   password=False)
-00024ae0: 0a20 2020 2020 2020 206f 732e 706f 7065  .        os.pope
-00024af0: 6e28 7373 6863 6d64 292e 7265 6164 2829  n(sshcmd).read()
-00024b00: 0a0a 2020 2020 6465 6620 7468 7265 6164  ..    def thread
-00024b10: 6564 5f63 7265 6174 655f 6b75 6265 2873  ed_create_kube(s
-00024b20: 656c 662c 2063 6c75 7374 6572 2c20 6b75  elf, cluster, ku
-00024b30: 6265 7479 7065 2c20 6b75 6265 5f6f 7665  betype, kube_ove
-00024b40: 7272 6964 6573 293a 0a20 2020 2020 2020  rrides):.       
-00024b50: 2069 7070 6f6f 6c20 3d20 6b75 6265 5f6f   ippool = kube_o
-00024b60: 7665 7272 6964 6573 2e67 6574 2827 6970  verrides.get('ip
-00024b70: 706f 6f6c 2729 206f 7220 6b75 6265 5f6f  pool') or kube_o
-00024b80: 7665 7272 6964 6573 2e67 6574 2827 636f  verrides.get('co
-00024b90: 6e66 706f 6f6c 2729 0a20 2020 2020 2020  nfpool').       
-00024ba0: 2062 6172 656d 6574 616c 706f 6f6c 203d   baremetalpool =
-00024bb0: 206b 7562 655f 6f76 6572 7269 6465 732e   kube_overrides.
-00024bc0: 6765 7428 2769 7070 6f6f 6c27 2920 6f72  get('ippool') or
-00024bd0: 206b 7562 655f 6f76 6572 7269 6465 732e   kube_overrides.
-00024be0: 6765 7428 2763 6f6e 6670 6f6f 6c27 290a  get('confpool').
-00024bf0: 2020 2020 2020 2020 6966 2069 7070 6f6f          if ippoo
-00024c00: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
-00024c10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00024c20: 6765 745f 7669 705f 6672 6f6d 5f63 6f6e  get_vip_from_con
-00024c30: 6670 6f6f 6c28 636c 7573 7465 722c 2069  fpool(cluster, i
-00024c40: 7070 6f6f 6c2c 206f 7665 7272 6964 6573  ppool, overrides
-00024c50: 3d6b 7562 655f 6f76 6572 7269 6465 7329  =kube_overrides)
-00024c60: 0a20 2020 2020 2020 2069 6620 6261 7265  .        if bare
-00024c70: 6d65 7461 6c70 6f6f 6c20 6973 206e 6f74  metalpool is not
-00024c80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00024c90: 2020 2073 656c 662e 6765 745f 6261 7265     self.get_bare
-00024ca0: 6d65 7461 6c5f 686f 7374 735f 6672 6f6d  metal_hosts_from
-00024cb0: 5f63 6f6e 6670 6f6f 6c28 636c 7573 7465  _confpool(cluste
-00024cc0: 722c 2062 6172 656d 6574 616c 706f 6f6c  r, baremetalpool
-00024cd0: 2c20 6f76 6572 7269 6465 733d 6b75 6265  , overrides=kube
-00024ce0: 5f6f 7665 7272 6964 6573 290a 2020 2020  _overrides).    
-00024cf0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-00024d00: 6b75 6265 2863 6c75 7374 6572 2c20 6b75  kube(cluster, ku
-00024d10: 6265 7479 7065 2c20 6b75 6265 5f6f 7665  betype, kube_ove
-00024d20: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
-00024d30: 2063 7265 6174 655f 6b75 6265 2873 656c   create_kube(sel
-00024d40: 662c 2063 6c75 7374 6572 2c20 6b75 6265  f, cluster, kube
-00024d50: 7479 7065 2c20 6f76 6572 7269 6465 733d  type, overrides=
-00024d60: 7b7d 293a 0a20 2020 2020 2020 2069 6620  {}):.        if 
-00024d70: 7365 6c66 2e74 7970 6520 3d3d 2027 7765  self.type == 'we
-00024d80: 6227 2061 6e64 2073 656c 662e 6b2e 6c6f  b' and self.k.lo
-00024d90: 6361 6c6b 7562 653a 0a20 2020 2020 2020  calkube:.       
-00024da0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00024db0: 2e6b 2e63 7265 6174 655f 6b75 6265 2863  .k.create_kube(c
-00024dc0: 6c75 7374 6572 2c20 6b75 6265 7479 7065  luster, kubetype
-00024dd0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00024de0: 7269 6465 7329 0a20 2020 2020 2020 2069  rides).        i
-00024df0: 7070 6f6f 6c20 3d20 6f76 6572 7269 6465  ppool = override
-00024e00: 732e 6765 7428 2769 7070 6f6f 6c27 2920  s.get('ippool') 
-00024e10: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
-00024e20: 2827 636f 6e66 706f 6f6c 2729 0a20 2020  ('confpool').   
-00024e30: 2020 2020 2062 6172 656d 6574 616c 706f       baremetalpo
-00024e40: 6f6c 203d 206f 7665 7272 6964 6573 2e67  ol = overrides.g
-00024e50: 6574 2827 6970 706f 6f6c 2729 206f 7220  et('ippool') or 
-00024e60: 6f76 6572 7269 6465 732e 6765 7428 2763  overrides.get('c
-00024e70: 6f6e 6670 6f6f 6c27 290a 2020 2020 2020  onfpool').      
-00024e80: 2020 6966 2069 7070 6f6f 6c20 6973 206e    if ippool is n
-00024e90: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00024ea0: 2020 2020 2073 656c 662e 6765 745f 7669       self.get_vi
-00024eb0: 705f 6672 6f6d 5f63 6f6e 6670 6f6f 6c28  p_from_confpool(
-00024ec0: 636c 7573 7465 722c 2069 7070 6f6f 6c2c  cluster, ippool,
-00024ed0: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-00024ee0: 6964 6573 290a 2020 2020 2020 2020 6966  ides).        if
-00024ef0: 2062 6172 656d 6574 616c 706f 6f6c 2069   baremetalpool i
-00024f00: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00024f10: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-00024f20: 5f62 6172 656d 6574 616c 5f68 6f73 7473  _baremetal_hosts
-00024f30: 5f66 726f 6d5f 636f 6e66 706f 6f6c 2863  _from_confpool(c
-00024f40: 6c75 7374 6572 2c20 6261 7265 6d65 7461  luster, baremeta
-00024f50: 6c70 6f6f 6c2c 206f 7665 7272 6964 6573  lpool, overrides
-00024f60: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
-00024f70: 2020 2020 6966 206b 7562 6574 7970 6520      if kubetype 
-00024f80: 3d3d 2027 6f70 656e 7368 6966 7427 3a0a  == 'openshift':.
-00024f90: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00024fa0: 6c74 203d 2073 656c 662e 6372 6561 7465  lt = self.create
-00024fb0: 5f6b 7562 655f 6f70 656e 7368 6966 7428  _kube_openshift(
-00024fc0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00024fd0: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
-00024fe0: 2020 2020 2020 656c 6966 206b 7562 6574        elif kubet
-00024ff0: 7970 6520 3d3d 2027 6879 7065 7273 6869  ype == 'hypershi
-00025000: 6674 273a 0a20 2020 2020 2020 2020 2020  ft':.           
-00025010: 2072 6573 756c 7420 3d20 7365 6c66 2e63   result = self.c
-00025020: 7265 6174 655f 6b75 6265 5f68 7970 6572  reate_kube_hyper
-00025030: 7368 6966 7428 636c 7573 7465 722c 206f  shift(cluster, o
-00025040: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-00025050: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
-00025060: 206b 7562 6574 7970 6520 3d3d 2027 6d69   kubetype == 'mi
-00025070: 6372 6f73 6869 6674 273a 0a20 2020 2020  croshift':.     
-00025080: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00025090: 7365 6c66 2e63 7265 6174 655f 6b75 6265  self.create_kube
-000250a0: 5f6d 6963 726f 7368 6966 7428 636c 7573  _microshift(clus
-000250b0: 7465 722c 206f 7665 7272 6964 6573 3d6f  ter, overrides=o
-000250c0: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-000250d0: 2020 656c 6966 206b 7562 6574 7970 6520    elif kubetype 
-000250e0: 3d3d 2027 6b33 7327 3a0a 2020 2020 2020  == 'k3s':.      
-000250f0: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
-00025100: 656c 662e 6372 6561 7465 5f6b 7562 655f  elf.create_kube_
-00025110: 6b33 7328 636c 7573 7465 722c 206f 7665  k3s(cluster, ove
-00025120: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-00025130: 290a 2020 2020 2020 2020 656c 6966 206b  ).        elif k
-00025140: 7562 6574 7970 6520 3d3d 2027 676b 6527  ubetype == 'gke'
-00025150: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00025160: 7375 6c74 203d 2073 656c 662e 6372 6561  sult = self.crea
-00025170: 7465 5f6b 7562 655f 676b 6528 636c 7573  te_kube_gke(clus
-00025180: 7465 722c 206f 7665 7272 6964 6573 3d6f  ter, overrides=o
-00025190: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-000251a0: 2020 656c 6966 206b 7562 6574 7970 6520    elif kubetype 
-000251b0: 3d3d 2027 656b 7327 3a0a 2020 2020 2020  == 'eks':.      
-000251c0: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
-000251d0: 656c 662e 6372 6561 7465 5f6b 7562 655f  elf.create_kube_
-000251e0: 656b 7328 636c 7573 7465 722c 206f 7665  eks(cluster, ove
-000251f0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-00025200: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00025210: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00025220: 6c74 203d 2073 656c 662e 6372 6561 7465  lt = self.create
-00025230: 5f6b 7562 655f 6765 6e65 7269 6328 636c  _kube_generic(cl
-00025240: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00025250: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
-00025260: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00025270: 740a 0a20 2020 2064 6566 2063 7265 6174  t..    def creat
-00025280: 655f 6b75 6265 5f65 6b73 2873 656c 662c  e_kube_eks(self,
-00025290: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
-000252a0: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-000252b0: 2066 726f 6d20 6b76 6972 742e 636c 7573   from kvirt.clus
-000252c0: 7465 7220 696d 706f 7274 2065 6b73 0a20  ter import eks. 
-000252d0: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
-000252e0: 6e65 725f 6d6f 6465 2829 3a0a 2020 2020  ner_mode():.    
-000252f0: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
-00025300: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
-00025310: 2f77 6f72 6b64 6972 270a 2020 2020 2020  /workdir'.      
+00024080: 2076 6d6e 616d 6520 3d20 766d 2e72 6570   vmname = vm.rep
+00024090: 6c61 6365 2827 3a27 2c20 272d 2729 2e72  lace(':', '-').r
+000240a0: 6570 6c61 6365 2827 2e27 2c20 272d 2729  eplace('.', '-')
+000240b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000240c0: 2020 2020 2076 6d69 6e66 6f2e 6170 7065       vminfo.appe
+000240d0: 6e64 287b 276e 616d 6527 3a20 766d 6e61  nd({'name': vmna
+000240e0: 6d65 2c20 2769 7027 3a20 766d 7d29 0a20  me, 'ip': vm}). 
+000240f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024100: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00024110: 2020 2020 2020 2020 2020 2020 636f 756e              coun
+00024120: 7465 7220 3d20 300a 2020 2020 2020 2020  ter = 0.        
+00024130: 2020 2020 2020 2020 7768 696c 6520 636f          while co
+00024140: 756e 7465 7220 213d 2031 3030 3a0a 2020  unter != 100:.  
+00024150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024160: 2020 6970 203d 206b 2e69 7028 766d 290a    ip = k.ip(vm).
+00024170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024180: 2020 2020 6966 2069 7020 6973 204e 6f6e      if ip is Non
+00024190: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000241a0: 2020 2020 2020 2020 2020 2073 6c65 6570             sleep
+000241b0: 2835 290a 2020 2020 2020 2020 2020 2020  (5).            
+000241c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000241d0: 7428 6622 5761 6974 696e 6720 3520 7365  t(f"Waiting 5 se
+000241e0: 636f 6e64 7320 746f 2067 7261 6220 6970  conds to grab ip
+000241f0: 2066 6f72 2076 6d20 7b76 6d7d 2e2e 2e22   for vm {vm}..."
+00024200: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00024210: 2020 2020 2020 2020 2020 636f 756e 7465            counte
+00024220: 7220 2b3d 2035 0a20 2020 2020 2020 2020  r += 5.         
+00024230: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00024240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024250: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+00024260: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00024270: 6d69 6e66 6f2e 6170 7065 6e64 287b 276e  minfo.append({'n
+00024280: 616d 6527 3a20 766d 2c20 2769 7027 3a20  ame': vm, 'ip': 
+00024290: 6970 7d29 0a20 2020 2020 2020 2020 2020  ip}).           
+000242a0: 206f 7665 7272 6964 6573 203d 207b 0a20   overrides = {. 
+000242b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000242c0: 6e61 6d65 223a 206e 616d 652c 0a20 2020  name": name,.   
+000242d0: 2020 2020 2020 2020 2020 2020 2022 766d               "vm
+000242e0: 7322 3a20 766d 696e 666f 2c0a 2020 2020  s": vminfo,.    
+000242f0: 2020 2020 2020 2020 2020 2020 226e 6574              "net
+00024300: 7322 3a20 6e65 7473 2c0a 2020 2020 2020  s": nets,.      
+00024310: 2020 2020 2020 2020 2020 2270 6f72 7473            "ports
+00024320: 223a 2070 6f72 7473 2c0a 2020 2020 2020  ": ports,.      
+00024330: 2020 2020 2020 2020 2020 2263 6865 636b            "check
+00024340: 7061 7468 223a 2063 6865 636b 7061 7468  path": checkpath
+00024350: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00024360: 2020 2264 6f6d 6169 6e22 3a20 646f 6d61    "domain": doma
+00024370: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+00024380: 7d0a 2020 2020 2020 2020 2020 2020 7365  }.            se
+00024390: 6c66 2e70 6c61 6e28 706c 616e 2c20 696e  lf.plan(plan, in
+000243a0: 7075 7473 7472 696e 673d 6861 7072 6f78  putstring=haprox
+000243b0: 7970 6c61 6e2c 206f 7665 7272 6964 6573  yplan, overrides
+000243c0: 3d6f 7665 7272 6964 6573 290a 0a20 2020  =overrides)..   
+000243d0: 2064 6566 206c 6973 745f 6c6f 6164 6261   def list_loadba
+000243e0: 6c61 6e63 6572 7328 7365 6c66 293a 0a20  lancers(self):. 
+000243f0: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
+00024400: 6b0a 2020 2020 2020 2020 6966 2073 656c  k.        if sel
+00024410: 662e 7479 7065 206e 6f74 2069 6e20 5b27  f.type not in ['
+00024420: 6177 7327 2c20 2761 7a75 7265 272c 2027  aws', 'azure', '
+00024430: 6763 7027 2c20 2769 626d 275d 3a0a 2020  gcp', 'ibm']:.  
+00024440: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00024450: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+00024460: 2020 2066 6f72 2076 6d20 696e 206b 2e6c     for vm in k.l
+00024470: 6973 7428 293a 0a20 2020 2020 2020 2020  ist():.         
+00024480: 2020 2020 2020 2069 6620 766d 5b27 7072         if vm['pr
+00024490: 6f66 696c 6527 5d2e 7374 6172 7473 7769  ofile'].startswi
+000244a0: 7468 2827 6c6f 6164 6261 6c61 6e63 6572  th('loadbalancer
+000244b0: 2729 2061 6e64 206c 656e 2876 6d5b 2770  ') and len(vm['p
+000244c0: 726f 6669 6c65 275d 2e73 706c 6974 2827  rofile'].split('
+000244d0: 2d27 2929 203d 3d20 323a 0a20 2020 2020  -')) == 2:.     
+000244e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000244f0: 6f72 7473 203d 2076 6d5b 2770 726f 6669  orts = vm['profi
+00024500: 6c65 275d 2e73 706c 6974 2827 2d27 295b  le'].split('-')[
+00024510: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+00024520: 2020 2020 2020 2072 6573 756c 7473 2e61         results.a
+00024530: 7070 656e 6428 5b76 6d5b 276e 616d 6527  ppend([vm['name'
+00024540: 5d2c 2076 6d5b 2769 7027 5d2c 2027 7463  ], vm['ip'], 'tc
+00024550: 7027 2c20 706f 7274 732c 2027 275d 290a  p', ports, '']).
+00024560: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00024570: 726e 2072 6573 756c 7473 0a20 2020 2020  rn results.     
+00024580: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00024590: 2020 2020 2072 6574 7572 6e20 6b2e 6c69       return k.li
+000245a0: 7374 5f6c 6f61 6462 616c 616e 6365 7273  st_loadbalancers
+000245b0: 2829 0a0a 2020 2020 6465 6620 7761 6974  ()..    def wait
+000245c0: 5f66 696e 6973 6828 7365 6c66 2c20 6e61  _finish(self, na
+000245d0: 6d65 2c20 696d 6167 653d 4e6f 6e65 2c20  me, image=None, 
+000245e0: 7175 6965 743d 4661 6c73 652c 2077 6169  quiet=False, wai
+000245f0: 7463 6f6d 6d61 6e64 3d4e 6f6e 652c 2077  tcommand=None, w
+00024600: 6169 7474 696d 656f 7574 3d30 2c20 6964  aittimeout=0, id
+00024610: 656e 7469 7479 6669 6c65 3d4e 6f6e 652c  entityfile=None,
+00024620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024630: 2020 2020 2076 6d63 6c69 656e 743d 4e6f       vmclient=No
+00024640: 6e65 293a 0a20 2020 2020 2020 2063 6f6e  ne):.        con
+00024650: 6669 6720 3d20 4b63 6f6e 6669 6728 636c  fig = Kconfig(cl
+00024660: 6965 6e74 3d76 6d63 6c69 656e 7429 2069  ient=vmclient) i
+00024670: 6620 766d 636c 6965 6e74 2069 7320 6e6f  f vmclient is no
+00024680: 7420 4e6f 6e65 2065 6c73 6520 7365 6c66  t None else self
+00024690: 0a20 2020 2020 2020 206b 203d 2063 6f6e  .        k = con
+000246a0: 6669 672e 6b0a 2020 2020 2020 2020 6966  fig.k.        if
+000246b0: 2069 6d61 6765 2069 7320 4e6f 6e65 3a0a   image is None:.
+000246c0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+000246d0: 6520 3d20 6b2e 696e 666f 286e 616d 6529  e = k.info(name)
+000246e0: 5b27 696d 6167 6527 5d0a 2020 2020 2020  ['image'].      
+000246f0: 2020 7070 7269 6e74 2866 2257 6169 7469    pprint(f"Waiti
+00024700: 6e67 2066 6f72 2076 6d20 7b6e 616d 657d  ng for vm {name}
+00024710: 2074 6f20 6669 6e69 7368 2063 7573 746f   to finish custo
+00024720: 6d69 7361 7469 6f6e 2229 0a20 2020 2020  misation").     
+00024730: 2020 2069 6620 7761 6974 636f 6d6d 616e     if waitcomman
+00024740: 6420 6973 206e 6f74 204e 6f6e 6520 616e  d is not None an
+00024750: 6420 2732 3e27 206e 6f74 2069 6e20 7761  d '2>' not in wa
+00024760: 6974 636f 6d6d 616e 643a 0a20 2020 2020  itcommand:.     
+00024770: 2020 2020 2020 2077 6169 7463 6f6d 6d61         waitcomma
+00024780: 6e64 202b 3d20 2220 323e 2f64 6576 2f6e  nd += " 2>/dev/n
+00024790: 756c 6c22 0a20 2020 2020 2020 2069 6620  ull".        if 
+000247a0: 636f 6d6d 6f6e 2e6e 6565 6473 5f69 676e  common.needs_ign
+000247b0: 6974 696f 6e28 696d 6167 6529 3a0a 2020  ition(image):.  
+000247c0: 2020 2020 2020 2020 2020 636d 6420 3d20            cmd = 
+000247d0: 7761 6974 636f 6d6d 616e 6420 6f72 2027  waitcommand or '
+000247e0: 7375 646f 206a 6f75 726e 616c 6374 6c20  sudo journalctl 
+000247f0: 2d2d 616c 6c20 2d2d 6e6f 2d70 6167 6572  --all --no-pager
+00024800: 270a 2020 2020 2020 2020 656c 7365 3a0a  '.        else:.
+00024810: 2020 2020 2020 2020 2020 2020 636d 6420              cmd 
+00024820: 3d20 7761 6974 636f 6d6d 616e 6420 6f72  = waitcommand or
+00024830: 2066 2273 7564 6f20 7461 696c 202d 6e20   f"sudo tail -n 
+00024840: 3530 207b 636f 6d6d 6f6e 2e67 6574 5f63  50 {common.get_c
+00024850: 6c6f 7564 696e 6974 6669 6c65 2869 6d61  loudinitfile(ima
+00024860: 6765 297d 220a 2020 2020 2020 2020 7573  ge)}".        us
+00024870: 6572 2c20 6970 2c20 766d 706f 7274 203d  er, ip, vmport =
+00024880: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
+00024890: 650a 2020 2020 2020 2020 686f 7374 6970  e.        hostip
+000248a0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000248b0: 7469 6d65 6f75 7420 3d20 300a 2020 2020  timeout = 0.    
+000248c0: 2020 2020 7768 696c 6520 6970 2069 7320      while ip is 
+000248d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000248e0: 2020 696e 666f 203d 206b 2e69 6e66 6f28    info = k.info(
+000248f0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00024900: 2020 6966 2063 6f6e 6669 672e 7479 7065    if config.type
+00024910: 203d 3d20 2770 6163 6b65 7427 2061 6e64   == 'packet' and
+00024920: 2069 6e66 6f2e 6765 7428 2773 7461 7475   info.get('statu
+00024930: 7327 2920 213d 2027 6163 7469 7665 273a  s') != 'active':
+00024940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024950: 2077 6172 6e69 6e67 2822 5761 6974 696e   warning("Waitin
+00024960: 6720 666f 7220 6e6f 6465 2074 6f20 6265  g for node to be
+00024970: 2061 6374 6976 6522 290a 2020 2020 2020   active").      
+00024980: 2020 2020 2020 2020 2020 6970 203d 204e            ip = N
+00024990: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000249a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000249b0: 2020 2020 2020 7573 6572 2c20 6970 203d        user, ip =
+000249c0: 2063 6f6e 6669 672e 766d 7573 6572 206f   config.vmuser o
+000249d0: 7220 696e 666f 2e67 6574 2827 7573 6572  r info.get('user
+000249e0: 2729 2c20 696e 666f 2e67 6574 2827 6970  '), info.get('ip
+000249f0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00024a00: 2020 2069 6620 636f 6e66 6967 2e74 7970     if config.typ
+00024a10: 6520 3d3d 2027 6b75 6265 7669 7274 273a  e == 'kubevirt':
+00024a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024a30: 2020 2020 2069 6620 6b2e 6163 6365 7373       if k.access
+00024a40: 5f6d 6f64 6520 3d3d 2027 4e6f 6465 506f  _mode == 'NodePo
+00024a50: 7274 273a 0a20 2020 2020 2020 2020 2020  rt':.           
+00024a60: 2020 2020 2020 2020 2020 2020 2076 6d70               vmp
+00024a70: 6f72 7420 3d20 696e 666f 2e67 6574 2827  ort = info.get('
+00024a80: 6e6f 6465 706f 7274 2729 0a20 2020 2020  nodeport').     
+00024a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024aa0: 2020 2069 6620 686f 7374 6970 2069 7320     if hostip is 
+00024ab0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00024ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ad0: 2020 686f 7374 6970 203d 206b 2e6e 6f64    hostip = k.nod
+00024ae0: 655f 686f 7374 286e 616d 653d 696e 666f  e_host(name=info
+00024af0: 2e67 6574 2827 686f 7374 2729 290a 2020  .get('host')).  
+00024b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b10: 2020 2020 2020 6970 203d 2068 6f73 7469        ip = hosti
+00024b20: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
+00024b30: 2020 2020 2020 656c 6966 206b 2e61 6363        elif k.acc
+00024b40: 6573 735f 6d6f 6465 203d 3d20 274c 6f61  ess_mode == 'Loa
+00024b50: 6442 616c 616e 6365 7227 3a0a 2020 2020  dBalancer':.    
+00024b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b70: 2020 2020 6970 203d 2069 6e66 6f2e 6765      ip = info.ge
+00024b80: 7428 276c 6f61 6462 616c 616e 6365 7269  t('loadbalanceri
+00024b90: 7027 290a 2020 2020 2020 2020 2020 2020  p').            
+00024ba0: 2020 2020 6966 2075 7365 7220 6973 206e      if user is n
+00024bb0: 6f74 204e 6f6e 6520 616e 6420 6970 2069  ot None and ip i
+00024bc0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00024bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024be0: 6966 2063 6f6e 6669 672e 7479 7065 203d  if config.type =
+00024bf0: 3d20 276f 7065 6e73 7461 636b 2720 616e  = 'openstack' an
+00024c00: 6420 696e 666f 2e67 6574 2827 7072 6976  d info.get('priv
+00024c10: 6174 6569 7027 2920 3d3d 2069 7020 616e  ateip') == ip an
+00024c20: 6420 6b2e 6578 7465 726e 616c 5f6e 6574  d k.external_net
+00024c30: 776f 726b 2069 7320 6e6f 7420 4e6f 6e65  work is not None
+00024c40: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00024c50: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00024c60: 6420 696e 666f 2e67 6574 2827 6e65 7473  d info.get('nets
+00024c70: 2729 5b30 5d5b 276e 6574 275d 2021 3d20  ')[0]['net'] != 
+00024c80: 6b2e 6578 7465 726e 616c 5f6e 6574 776f  k.external_netwo
+00024c90: 726b 3a0a 2020 2020 2020 2020 2020 2020  rk:.            
+00024ca0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00024cb0: 696e 6728 2257 6169 7469 6e67 2066 6f72  ing("Waiting for
+00024cc0: 2066 6c6f 6174 696e 6720 6970 2069 6e73   floating ip ins
+00024cd0: 7465 6164 206f 6620 6120 7072 6976 6174  tead of a privat
+00024ce0: 6520 6970 2e2e 2e22 290a 2020 2020 2020  e ip...").      
+00024cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d00: 2020 6970 203d 204e 6f6e 650a 2020 2020    ip = None.    
+00024d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00024d30: 2020 2020 2020 2020 2020 2020 2020 7465                te
+00024d40: 7374 636d 6420 3d20 636f 6d6d 6f6e 2e73  stcmd = common.s
+00024d50: 7368 286e 616d 652c 2075 7365 723d 7573  sh(name, user=us
+00024d60: 6572 2c20 6970 3d69 702c 2074 756e 6e65  er, ip=ip, tunne
+00024d70: 6c3d 636f 6e66 6967 2e74 756e 6e65 6c2c  l=config.tunnel,
+00024d80: 2074 756e 6e65 6c68 6f73 743d 636f 6e66   tunnelhost=conf
+00024d90: 6967 2e74 756e 6e65 6c68 6f73 742c 0a20  ig.tunnelhost,. 
+00024da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024dc0: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
+00024dd0: 656c 706f 7274 3d63 6f6e 6669 672e 7475  elport=config.tu
+00024de0: 6e6e 656c 706f 7274 2c20 7475 6e6e 656c  nnelport, tunnel
+00024df0: 7573 6572 3d63 6f6e 6669 672e 7475 6e6e  user=config.tunn
+00024e00: 656c 7573 6572 2c0a 2020 2020 2020 2020  eluser,.        
+00024e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e30: 2020 2020 2069 6e73 6563 7572 653d 636f       insecure=co
+00024e40: 6e66 6967 2e69 6e73 6563 7572 652c 2063  nfig.insecure, c
+00024e50: 6d64 3d27 6964 202d 756e 272c 2076 6d70  md='id -un', vmp
+00024e60: 6f72 743d 766d 706f 7274 2c0a 2020 2020  ort=vmport,.    
+00024e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e90: 2020 2020 2020 2020 2069 6465 6e74 6974           identit
+00024ea0: 7966 696c 653d 6964 656e 7469 7479 6669  yfile=identityfi
+00024eb0: 6c65 2c20 7061 7373 776f 7264 3d46 616c  le, password=Fal
+00024ec0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+00024ed0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00024ee0: 732e 706f 7065 6e28 7465 7374 636d 6429  s.popen(testcmd)
+00024ef0: 2e72 6561 6428 292e 7374 7269 7028 2920  .read().strip() 
+00024f00: 213d 2075 7365 723a 0a20 2020 2020 2020  != user:.       
+00024f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024f20: 2020 2020 2077 6172 6e69 6e67 2822 4761       warning("Ga
+00024f30: 7468 6572 6564 2069 7020 6e6f 7420 6675  thered ip not fu
+00024f40: 6e63 7469 6f6e 616c 2079 6574 2e2e 2e22  nctional yet..."
+00024f50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00024f60: 2020 2020 2020 2020 2020 2020 2020 6970                ip
+00024f70: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00024f80: 2020 2020 7070 7269 6e74 2822 5761 6974      pprint("Wait
+00024f90: 696e 6720 666f 7220 766d 2074 6f20 6265  ing for vm to be
+00024fa0: 2061 6363 6573 7369 626c 652e 2e2e 2229   accessible...")
+00024fb0: 0a20 2020 2020 2020 2020 2020 2073 6c65  .            sle
+00024fc0: 6570 2835 290a 2020 2020 2020 2020 2020  ep(5).          
+00024fd0: 2020 7469 6d65 6f75 7420 2b3d 2035 0a20    timeout += 5. 
+00024fe0: 2020 2020 2020 2020 2020 2069 6620 7761             if wa
+00024ff0: 6974 7469 6d65 6f75 7420 3e20 3020 616e  ittimeout > 0 an
+00025000: 6420 7469 6d65 6f75 7420 3e20 7761 6974  d timeout > wait
+00025010: 7469 6d65 6f75 743a 0a20 2020 2020 2020  timeout:.       
+00025020: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+00025030: 5469 6d65 6f75 7420 7761 6974 696e 6720  Timeout waiting 
+00025040: 666f 7220 766d 2074 6f20 6265 2061 6363  for vm to be acc
+00025050: 6573 7369 626c 652e 2e2e 2229 0a20 2020  essible...").   
+00025060: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00025070: 616b 0a20 2020 2020 2020 2073 6c65 6570  ak.        sleep
+00025080: 2835 290a 2020 2020 2020 2020 6f6c 646f  (5).        oldo
+00025090: 7574 7075 7420 3d20 2727 0a20 2020 2020  utput = ''.     
+000250a0: 2020 2074 696d 656f 7574 203d 2030 0a20     timeout = 0. 
+000250b0: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
+000250c0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000250d0: 7368 636d 6420 3d20 636f 6d6d 6f6e 2e73  shcmd = common.s
+000250e0: 7368 286e 616d 652c 2075 7365 723d 2772  sh(name, user='r
+000250f0: 6f6f 7427 2c20 6970 3d69 702c 2074 756e  oot', ip=ip, tun
+00025100: 6e65 6c3d 636f 6e66 6967 2e74 756e 6e65  nel=config.tunne
+00025110: 6c2c 2074 756e 6e65 6c68 6f73 743d 636f  l, tunnelhost=co
+00025120: 6e66 6967 2e74 756e 6e65 6c68 6f73 742c  nfig.tunnelhost,
+00025130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025150: 2076 6d70 6f72 743d 766d 706f 7274 2c20   vmport=vmport, 
+00025160: 7475 6e6e 656c 706f 7274 3d63 6f6e 6669  tunnelport=confi
+00025170: 672e 7475 6e6e 656c 706f 7274 2c20 7475  g.tunnelport, tu
+00025180: 6e6e 656c 7573 6572 3d63 6f6e 6669 672e  nneluser=config.
+00025190: 7475 6e6e 656c 7573 6572 2c0a 2020 2020  tunneluser,.    
+000251a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000251b0: 2020 2020 2020 2020 2020 2020 696e 7365              inse
+000251c0: 6375 7265 3d63 6f6e 6669 672e 696e 7365  cure=config.inse
+000251d0: 6375 7265 2c20 636d 643d 636d 642c 2069  cure, cmd=cmd, i
+000251e0: 6465 6e74 6974 7966 696c 653d 6964 656e  dentityfile=iden
+000251f0: 7469 7479 6669 6c65 2c20 7061 7373 776f  tityfile, passwo
+00025200: 7264 3d46 616c 7365 290a 2020 2020 2020  rd=False).      
+00025210: 2020 2020 2020 6f75 7470 7574 203d 206f        output = o
+00025220: 732e 706f 7065 6e28 7373 6863 6d64 292e  s.popen(sshcmd).
+00025230: 7265 6164 2829 0a20 2020 2020 2020 2020  read().         
+00025240: 2020 2069 6620 7761 6974 636f 6d6d 616e     if waitcomman
+00025250: 6420 6973 206e 6f74 204e 6f6e 653a 0a20  d is not None:. 
+00025260: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00025270: 6620 6f75 7470 7574 2021 3d20 2727 3a0a  f output != '':.
+00025280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025290: 2020 2020 7072 696e 7428 6f75 7470 7574      print(output
+000252a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000252b0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+000252c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000252d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000252e0: 2020 2020 2020 7070 7269 6e74 2822 5761        pprint("Wa
+000252f0: 6974 696e 6720 666f 7220 7761 6974 636f  iting for waitco
+00025300: 6d6d 616e 6420 746f 2073 7563 6365 6564  mmand to succeed
+00025310: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
 00025320: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00025330: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
-00025340: 5041 5448 275d 202b 3d20 273a 2573 2720  PATH'] += ':%s' 
-00025350: 2520 6f73 2e67 6574 6377 6428 290a 2020  % os.getcwd().  
-00025360: 2020 2020 2020 7265 7475 726e 2065 6b73        return eks
-00025370: 2e63 7265 6174 6528 7365 6c66 2c20 636c  .create(self, cl
-00025380: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00025390: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-000253a0: 655f 6b75 6265 5f67 656e 6572 6963 2873  e_kube_generic(s
-000253b0: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
-000253c0: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
-000253d0: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
-000253e0: 725f 6d6f 6465 2829 3a0a 2020 2020 2020  r_mode():.      
-000253f0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00025400: 5b27 5041 5448 275d 202b 3d20 273a 2f77  ['PATH'] += ':/w
-00025410: 6f72 6b64 6972 270a 2020 2020 2020 2020  orkdir'.        
-00025420: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00025430: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
-00025440: 5448 275d 202b 3d20 273a 2573 2720 2520  TH'] += ':%s' % 
-00025450: 6f73 2e67 6574 6377 6428 290a 2020 2020  os.getcwd().    
-00025460: 2020 2020 706c 616e 6469 7220 3d20 6f73      plandir = os
-00025470: 2e70 6174 682e 6469 726e 616d 6528 6b75  .path.dirname(ku
-00025480: 6265 6164 6d2e 6372 6561 7465 2e5f 5f63  beadm.create.__c
-00025490: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
-000254a0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-000254b0: 6e20 6b75 6265 6164 6d2e 6372 6561 7465  n kubeadm.create
-000254c0: 2873 656c 662c 2070 6c61 6e64 6972 2c20  (self, plandir, 
-000254d0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-000254e0: 6573 290a 0a20 2020 2064 6566 2063 7265  es)..    def cre
-000254f0: 6174 655f 6b75 6265 5f67 6b65 2873 656c  ate_kube_gke(sel
-00025500: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
-00025510: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
-00025520: 2020 2066 726f 6d20 6b76 6972 742e 636c     from kvirt.cl
-00025530: 7573 7465 7220 696d 706f 7274 2067 6b65  uster import gke
-00025540: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-00025550: 6169 6e65 725f 6d6f 6465 2829 3a0a 2020  ainer_mode():.  
-00025560: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
-00025570: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
-00025580: 273a 2f77 6f72 6b64 6972 270a 2020 2020  ':/workdir'.    
-00025590: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000255a0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-000255b0: 5b27 5041 5448 275d 202b 3d20 273a 2573  ['PATH'] += ':%s
-000255c0: 2720 2520 6f73 2e67 6574 6377 6428 290a  ' % os.getcwd().
-000255d0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
-000255e0: 6b65 2e63 7265 6174 6528 7365 6c66 2c20  ke.create(self, 
-000255f0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00025600: 6573 290a 0a20 2020 2064 6566 2063 7265  es)..    def cre
-00025610: 6174 655f 6b75 6265 5f6d 6963 726f 7368  ate_kube_microsh
-00025620: 6966 7428 7365 6c66 2c20 636c 7573 7465  ift(self, cluste
-00025630: 722c 206f 7665 7272 6964 6573 3d7b 7d29  r, overrides={})
-00025640: 3a0a 2020 2020 2020 2020 6966 2063 6f6e  :.        if con
-00025650: 7461 696e 6572 5f6d 6f64 6528 293a 0a20  tainer_mode():. 
-00025660: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
-00025670: 7669 726f 6e5b 2750 4154 4827 5d20 2b3d  viron['PATH'] +=
-00025680: 2027 3a2f 776f 726b 6469 7227 0a20 2020   ':/workdir'.   
-00025690: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000256a0: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-000256b0: 6e5b 2750 4154 4827 5d20 2b3d 2027 3a25  n['PATH'] += ':%
-000256c0: 7327 2025 206f 732e 6765 7463 7764 2829  s' % os.getcwd()
-000256d0: 0a20 2020 2020 2020 2070 6c61 6e64 6972  .        plandir
-000256e0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-000256f0: 6d65 286d 6963 726f 7368 6966 742e 6372  me(microshift.cr
-00025700: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
-00025710: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
-00025720: 2020 2072 6574 7572 6e20 6d69 6372 6f73     return micros
-00025730: 6869 6674 2e63 7265 6174 6528 7365 6c66  hift.create(self
-00025740: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
-00025750: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
-00025760: 2020 2020 6465 6620 6372 6561 7465 5f6b      def create_k
-00025770: 7562 655f 6b33 7328 7365 6c66 2c20 636c  ube_k3s(self, cl
-00025780: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00025790: 3d7b 7d29 3a0a 2020 2020 2020 2020 6966  ={}):.        if
-000257a0: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
-000257b0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-000257c0: 732e 656e 7669 726f 6e5b 2750 4154 4827  s.environ['PATH'
-000257d0: 5d20 2b3d 2027 3a2f 776f 726b 6469 7227  ] += ':/workdir'
-000257e0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000257f0: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
-00025800: 7669 726f 6e5b 2750 4154 4827 5d20 2b3d  viron['PATH'] +=
-00025810: 2027 3a25 7327 2025 206f 732e 6765 7463   ':%s' % os.getc
-00025820: 7764 2829 0a20 2020 2020 2020 2070 6c61  wd().        pla
-00025830: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
-00025840: 6972 6e61 6d65 286b 3373 2e63 7265 6174  irname(k3s.creat
-00025850: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
-00025860: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-00025870: 7265 7475 726e 206b 3373 2e63 7265 6174  return k3s.creat
-00025880: 6528 7365 6c66 2c20 706c 616e 6469 722c  e(self, plandir,
-00025890: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
-000258a0: 6465 7329 0a0a 2020 2020 6465 6620 6372  des)..    def cr
-000258b0: 6561 7465 5f6b 7562 655f 6879 7065 7273  eate_kube_hypers
-000258c0: 6869 6674 2873 656c 662c 2063 6c75 7374  hift(self, clust
-000258d0: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
-000258e0: 293a 0a20 2020 2020 2020 2069 6620 636f  ):.        if co
-000258f0: 6e74 6169 6e65 725f 6d6f 6465 2829 3a0a  ntainer_mode():.
-00025900: 2020 2020 2020 2020 2020 2020 6f73 2e65              os.e
-00025910: 6e76 6972 6f6e 5b27 5041 5448 275d 202b  nviron['PATH'] +
-00025920: 3d20 273a 2f77 6f72 6b64 6972 270a 2020  = ':/workdir'.  
-00025930: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00025940: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
-00025950: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
-00025960: 2573 2720 2520 6f73 2e67 6574 6377 6428  %s' % os.getcwd(
-00025970: 290a 2020 2020 2020 2020 706c 616e 6469  ).        plandi
-00025980: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-00025990: 616d 6528 6879 7065 7273 6869 6674 2e63  ame(hypershift.c
-000259a0: 7265 6174 652e 5f5f 636f 6465 5f5f 2e63  reate.__code__.c
-000259b0: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
-000259c0: 2020 2020 2320 646e 7363 6c69 656e 7420      # dnsclient 
-000259d0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-000259e0: 2764 6e73 636c 6965 6e74 2729 0a20 2020  'dnsclient').   
-000259f0: 2020 2020 2023 2064 6e73 636f 6e66 6967       # dnsconfig
-00025a00: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
-00025a10: 743d 646e 7363 6c69 656e 7429 2069 6620  t=dnsclient) if 
-00025a20: 646e 7363 6c69 656e 7420 6973 206e 6f74  dnsclient is not
-00025a30: 204e 6f6e 6520 656c 7365 204e 6f6e 650a   None else None.
-00025a40: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-00025a50: 7970 6572 7368 6966 742e 6372 6561 7465  ypershift.create
-00025a60: 2873 656c 662c 2070 6c61 6e64 6972 2c20  (self, plandir, 
-00025a70: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00025a80: 6573 290a 0a20 2020 2064 6566 2063 7265  es)..    def cre
-00025a90: 6174 655f 6b75 6265 5f6f 7065 6e73 6869  ate_kube_openshi
-00025aa0: 6674 2873 656c 662c 2063 6c75 7374 6572  ft(self, cluster
-00025ab0: 2c20 6f76 6572 7269 6465 733d 7b7d 293a  , overrides={}):
-00025ac0: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-00025ad0: 6169 6e65 725f 6d6f 6465 2829 3a0a 2020  ainer_mode():.  
-00025ae0: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
-00025af0: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
-00025b00: 273a 2f77 6f72 6b64 6972 270a 2020 2020  ':/workdir'.    
-00025b10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00025b20: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00025b30: 5b27 5041 5448 275d 202b 3d20 273a 2573  ['PATH'] += ':%s
-00025b40: 2720 2520 6f73 2e67 6574 6377 6428 290a  ' % os.getcwd().
-00025b50: 2020 2020 2020 2020 706c 616e 6469 7220          plandir 
-00025b60: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-00025b70: 6528 6f70 656e 7368 6966 742e 6372 6561  e(openshift.crea
-00025b80: 7465 2e5f 5f63 6f64 655f 5f2e 636f 5f66  te.__code__.co_f
-00025b90: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
-00025ba0: 2064 6e73 636c 6965 6e74 203d 206f 7665   dnsclient = ove
-00025bb0: 7272 6964 6573 2e67 6574 2827 646e 7363  rrides.get('dnsc
-00025bc0: 6c69 656e 7427 290a 2020 2020 2020 2020  lient').        
-00025bd0: 646e 7363 6f6e 6669 6720 3d20 4b63 6f6e  dnsconfig = Kcon
-00025be0: 6669 6728 636c 6965 6e74 3d64 6e73 636c  fig(client=dnscl
-00025bf0: 6965 6e74 2920 6966 2064 6e73 636c 6965  ient) if dnsclie
-00025c00: 6e74 2069 7320 6e6f 7420 4e6f 6e65 2065  nt is not None e
-00025c10: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
-00025c20: 2072 6574 7572 6e20 6f70 656e 7368 6966   return openshif
-00025c30: 742e 6372 6561 7465 2873 656c 662c 2070  t.create(self, p
-00025c40: 6c61 6e64 6972 2c20 636c 7573 7465 722c  landir, cluster,
-00025c50: 206f 7665 7272 6964 6573 2c20 646e 7363   overrides, dnsc
-00025c60: 6f6e 6669 673d 646e 7363 6f6e 6669 6729  onfig=dnsconfig)
-00025c70: 0a0a 2020 2020 6465 6620 6465 6c65 7465  ..    def delete
-00025c80: 5f6b 7562 6528 7365 6c66 2c20 636c 7573  _kube(self, clus
-00025c90: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
-00025ca0: 7d29 3a0a 2020 2020 2020 2020 6879 7065  }):.        hype
-00025cb0: 7273 6869 6674 203d 206f 7665 7272 6964  rshift = overrid
-00025cc0: 6573 2e67 6574 2827 6b75 6265 7479 7065  es.get('kubetype
-00025cd0: 272c 2027 7878 7827 2920 3d3d 2027 6879  ', 'xxx') == 'hy
-00025ce0: 7065 7273 6869 6674 270a 2020 2020 2020  pershift'.      
-00025cf0: 2020 6173 7369 7374 6564 203d 2046 616c    assisted = Fal
-00025d00: 7365 0a20 2020 2020 2020 2065 6b73 203d  se.        eks =
-00025d10: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-00025d20: 6b75 6265 7479 7065 272c 2027 7878 7827  kubetype', 'xxx'
-00025d30: 2920 3d3d 2027 656b 7327 0a20 2020 2020  ) == 'eks'.     
-00025d40: 2020 2067 6b65 203d 206f 7665 7272 6964     gke = overrid
-00025d50: 6573 2e67 6574 2827 6b75 6265 7479 7065  es.get('kubetype
-00025d60: 272c 2027 7878 7827 2920 3d3d 2027 676b  ', 'xxx') == 'gk
-00025d70: 6527 0a20 2020 2020 2020 2064 6f6d 6169  e'.        domai
-00025d80: 6e20 3d20 6f76 6572 7269 6465 732e 6765  n = overrides.ge
-00025d90: 7428 2764 6f6d 6169 6e27 2c20 276b 6172  t('domain', 'kar
-00025da0: 6d61 6c61 6273 2e63 6f72 7027 290a 2020  malabs.corp').  
-00025db0: 2020 2020 2020 6b75 6265 7479 7065 203d        kubetype =
-00025dc0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-00025dd0: 6b75 6265 7479 7065 272c 2027 6765 6e65  kubetype', 'gene
-00025de0: 7269 6327 290a 2020 2020 2020 2020 646e  ric').        dn
-00025df0: 7363 6c69 656e 7420 3d20 4e6f 6e65 0a20  sclient = None. 
-00025e00: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
-00025e10: 6b0a 2020 2020 2020 2020 6966 2073 656c  k.        if sel
-00025e20: 662e 7479 7065 203d 3d20 2777 6562 2720  f.type == 'web' 
-00025e30: 616e 6420 7365 6c66 2e6b 2e6c 6f63 616c  and self.k.local
-00025e40: 6b75 6265 3a0a 2020 2020 2020 2020 2020  kube:.          
-00025e50: 2020 7265 7475 726e 206b 2e64 656c 6574    return k.delet
-00025e60: 655f 6b75 6265 2863 6c75 7374 6572 2c20  e_kube(cluster, 
-00025e70: 6b75 6265 7479 7065 2c20 6f76 6572 7269  kubetype, overri
-00025e80: 6465 733d 6f76 6572 7269 6465 7329 0a20  des=overrides). 
-00025e90: 2020 2020 2020 2063 6c75 7374 6572 203d         cluster =
-00025ea0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-00025eb0: 636c 7573 7465 7227 2c20 636c 7573 7465  cluster', cluste
-00025ec0: 7229 0a20 2020 2020 2020 2069 6620 636c  r).        if cl
-00025ed0: 7573 7465 7220 6973 204e 6f6e 6520 6f72  uster is None or
-00025ee0: 2063 6c75 7374 6572 203d 3d20 2727 3a0a   cluster == '':.
-00025ef0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00025f00: 756c 745f 636c 7573 7465 7273 203d 207b  ult_clusters = {
-00025f10: 2767 656e 6572 6963 273a 2027 6d79 6b75  'generic': 'myku
-00025f20: 6265 272c 2027 6879 7065 7273 6869 6674  be', 'hypershift
-00025f30: 273a 2027 6d79 6879 7065 7273 6869 6674  ': 'myhypershift
-00025f40: 272c 2027 6f70 656e 7368 6966 7427 3a20  ', 'openshift': 
-00025f50: 276d 796f 7065 6e73 6869 6674 272c 0a20  'myopenshift',. 
-00025f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025f70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00025f80: 6b33 7327 3a20 276d 796b 3373 272c 2027  k3s': 'myk3s', '
-00025f90: 6d69 6372 6f73 6869 6674 273a 2027 6d79  microshift': 'my
-00025fa0: 6d69 6372 6f73 6869 6674 272c 2027 676b  microshift', 'gk
-00025fb0: 6527 3a20 276d 7967 6b65 272c 2027 656b  e': 'mygke', 'ek
-00025fc0: 7327 3a20 276d 7965 6b73 277d 0a20 2020  s': 'myeks'}.   
-00025fd0: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
-00025fe0: 203d 2064 6566 6175 6c74 5f63 6c75 7374   = default_clust
-00025ff0: 6572 735b 6b75 6265 7479 7065 5d0a 2020  ers[kubetype].  
-00026000: 2020 2020 2020 636c 7573 7465 7264 6174        clusterdat
-00026010: 6120 3d20 7b7d 0a20 2020 2020 2020 2063  a = {}.        c
-00026020: 6c75 7374 6572 6469 7220 3d20 6f73 2e70  lusterdir = os.p
-00026030: 6174 682e 6578 7061 6e64 7573 6572 2866  ath.expanduser(f
-00026040: 227e 2f2e 6b63 6c69 2f63 6c75 7374 6572  "~/.kcli/cluster
-00026050: 732f 7b63 6c75 7374 6572 7d22 290a 2020  s/{cluster}").  
-00026060: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00026070: 2e65 7869 7374 7328 636c 7573 7465 7264  .exists(clusterd
-00026080: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
-00026090: 2070 6172 616d 6574 6572 7366 696c 6520   parametersfile 
-000260a0: 3d20 6622 7b63 6c75 7374 6572 6469 727d  = f"{clusterdir}
-000260b0: 2f6b 636c 695f 7061 7261 6d65 7465 7273  /kcli_parameters
-000260c0: 2e79 6d6c 220a 2020 2020 2020 2020 2020  .yml".          
-000260d0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-000260e0: 7374 7328 7061 7261 6d65 7465 7273 6669  sts(parametersfi
-000260f0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00026100: 2020 2020 2077 6974 6820 6f70 656e 2870       with open(p
-00026110: 6172 616d 6574 6572 7366 696c 6529 2061  arametersfile) a
-00026120: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
-00026130: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
-00026140: 6461 7461 203d 2079 616d 6c2e 7361 6665  data = yaml.safe
-00026150: 5f6c 6f61 6428 6629 0a20 2020 2020 2020  _load(f).       
-00026160: 2020 2020 2020 2020 2020 2020 206b 7562               kub
-00026170: 6574 7970 6520 3d20 636c 7573 7465 7264  etype = clusterd
-00026180: 6174 612e 6765 7428 276b 7562 6574 7970  ata.get('kubetyp
-00026190: 6527 2c20 2767 656e 6572 6963 2729 0a20  e', 'generic'). 
-000261a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261b0: 2020 2069 6620 6b75 6265 7479 7065 203d     if kubetype =
-000261c0: 3d20 2768 7970 6572 7368 6966 7427 3a0a  = 'hypershift':.
-000261d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261e0: 2020 2020 2020 2020 6879 7065 7273 6869          hypershi
-000261f0: 6674 203d 2054 7275 650a 2020 2020 2020  ft = True.      
-00026200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026210: 2020 6173 7369 7374 6564 203d 2063 6c75    assisted = clu
-00026220: 7374 6572 6461 7461 2e67 6574 2827 6173  sterdata.get('as
-00026230: 7369 7374 6564 272c 2046 616c 7365 290a  sisted', False).
-00026240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026250: 2020 2020 646f 6d61 696e 203d 2063 6c75      domain = clu
-00026260: 7374 6572 6461 7461 2e67 6574 2827 646f  sterdata.get('do
-00026270: 6d61 696e 272c 2064 6f6d 6169 6e29 0a20  main', domain). 
-00026280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026290: 2020 2064 6e73 636c 6965 6e74 203d 2063     dnsclient = c
-000262a0: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
-000262b0: 646e 7363 6c69 656e 7427 290a 2020 2020  dnsclient').    
-000262c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262d0: 676b 6520 3d20 6b75 6265 7479 7065 203d  gke = kubetype =
-000262e0: 3d20 2767 6b65 270a 2020 2020 2020 2020  = 'gke'.        
-000262f0: 2020 2020 2020 2020 2020 2020 656b 7320              eks 
-00026300: 3d20 6b75 6265 7479 7065 203d 3d20 2765  = kubetype == 'e
-00026310: 6b73 270a 2020 2020 2020 2020 6465 6c65  ks'.        dele
-00026320: 7465 636c 6965 6e74 7320 3d20 7b73 656c  teclients = {sel
-00026330: 662e 636c 6965 6e74 3a20 6b7d 0a20 2020  f.client: k}.   
-00026340: 2020 2020 2076 6d63 6c69 656e 7473 203d       vmclients =
-00026350: 205b 5d0a 2020 2020 2020 2020 766d 636c   [].        vmcl
-00026360: 6965 6e74 735f 6669 6c65 203d 206f 732e  ients_file = os.
-00026370: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-00026380: 6627 7e2f 2e6b 636c 692f 766d 636c 6965  f'~/.kcli/vmclie
-00026390: 6e74 735f 7b63 6c75 7374 6572 7d27 290a  nts_{cluster}').
-000263a0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-000263b0: 7468 2e65 7869 7374 7328 766d 636c 6965  th.exists(vmclie
-000263c0: 6e74 735f 6669 6c65 293a 0a20 2020 2020  nts_file):.     
-000263d0: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
-000263e0: 203d 2079 616d 6c2e 7361 6665 5f6c 6f61   = yaml.safe_loa
-000263f0: 6428 6f70 656e 2876 6d63 6c69 656e 7473  d(open(vmclients
-00026400: 5f66 696c 6529 290a 2020 2020 2020 2020  _file)).        
-00026410: 2020 2020 6f73 2e72 656d 6f76 6528 766d      os.remove(vm
-00026420: 636c 6965 6e74 735f 6669 6c65 290a 2020  clients_file).  
-00026430: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
-00026440: 7472 6163 6c69 656e 7473 3a0a 2020 2020  traclients:.    
-00026450: 2020 2020 2020 2020 6465 6c65 7465 636c          deletecl
-00026460: 6965 6e74 732e 7570 6461 7465 2873 656c  ients.update(sel
-00026470: 662e 6578 7472 6163 6c69 656e 7473 290a  f.extraclients).
-00026480: 2020 2020 2020 2020 656c 6966 2076 6d63          elif vmc
-00026490: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-000264a0: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
-000264b0: 732e 7570 6461 7465 287b 636c 693a 204b  s.update({cli: K
-000264c0: 636f 6e66 6967 2863 6c69 656e 743d 636c  config(client=cl
-000264d0: 6929 2e6b 2066 6f72 2063 6c69 2069 6e20  i).k for cli in 
-000264e0: 766d 636c 6965 6e74 7320 6966 2063 6c69  vmclients if cli
-000264f0: 2021 3d20 7365 6c66 2e63 6c69 656e 747d   != self.client}
-00026500: 290a 2020 2020 2020 2020 666f 7220 6879  ).        for hy
-00026510: 7065 7276 6973 6f72 2069 6e20 6465 6c65  pervisor in dele
-00026520: 7465 636c 6965 6e74 733a 0a20 2020 2020  teclients:.     
-00026530: 2020 2020 2020 2063 203d 2064 656c 6574         c = delet
-00026540: 6563 6c69 656e 7473 5b68 7970 6572 7669  eclients[hypervi
-00026550: 736f 725d 0a20 2020 2020 2020 2020 2020  sor].           
-00026560: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
-00026570: 6428 632e 6c69 7374 2829 2c20 6b65 793d  d(c.list(), key=
-00026580: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
-00026590: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
-000265a0: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
-000265b0: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
-000265c0: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-000265d0: 7420 3d20 766d 2e67 6574 2827 646e 7363  t = vm.get('dnsc
-000265e0: 6c69 656e 7427 2920 6f72 2064 6e73 636c  lient') or dnscl
-000265f0: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
-00026600: 2020 2020 2063 7572 7265 6e74 636c 7573       currentclus
-00026610: 7465 7220 3d20 766d 2e67 6574 2827 6b75  ter = vm.get('ku
-00026620: 6265 2729 0a20 2020 2020 2020 2020 2020  be').           
-00026630: 2020 2020 206b 7562 6574 7970 6520 3d20       kubetype = 
-00026640: 766d 2e67 6574 2827 6b75 6265 7479 7065  vm.get('kubetype
-00026650: 272c 2027 6765 6e65 7269 6327 290a 2020  ', 'generic').  
-00026660: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00026670: 2063 7572 7265 6e74 636c 7573 7465 7220   currentcluster 
-00026680: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00026690: 6375 7272 656e 7463 6c75 7374 6572 203d  currentcluster =
-000266a0: 3d20 636c 7573 7465 723a 0a20 2020 2020  = cluster:.     
-000266b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000266c0: 6620 6b75 6265 7479 7065 203d 3d20 2767  f kubetype == 'g
-000266d0: 6b65 273a 0a20 2020 2020 2020 2020 2020  ke':.           
-000266e0: 2020 2020 2020 2020 2020 2020 2067 6b65               gke
-000266f0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00026700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026710: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-00026720: 2020 2020 2020 2020 2020 656c 6966 206b            elif k
-00026730: 7562 6574 7970 6520 3d3d 2027 656b 7327  ubetype == 'eks'
-00026740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00026750: 2020 2020 2020 2020 2020 656b 7320 3d20            eks = 
-00026760: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00026770: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00026780: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00026790: 2020 2020 2020 2063 2e64 656c 6574 6528         c.delete(
-000267a0: 6e61 6d65 2c20 736e 6170 7368 6f74 733d  name, snapshots=
-000267b0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-000267c0: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
-000267d0: 2e64 656c 6574 655f 6c61 7374 766d 286e  .delete_lastvm(n
-000267e0: 616d 652c 2073 656c 662e 636c 6965 6e74  ame, self.client
-000267f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00026800: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
-00026810: 7b6e 616d 657d 2064 656c 6574 6564 206f  {name} deleted o
-00026820: 6e20 7b68 7970 6572 7669 736f 727d 2122  n {hypervisor}!"
-00026830: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-00026840: 662e 7479 7065 203d 3d20 276b 7562 6576  f.type == 'kubev
-00026850: 6972 7427 3a0a 2020 2020 2020 2020 2020  irt':.          
-00026860: 2020 6966 2066 227b 636c 7573 7465 727d    if f"{cluster}
-00026870: 2d61 7069 2220 696e 206b 2e6c 6973 745f  -api" in k.list_
-00026880: 7365 7276 6963 6573 286b 2e6e 616d 6573  services(k.names
-00026890: 7061 6365 293a 0a20 2020 2020 2020 2020  pace):.         
-000268a0: 2020 2020 2020 206b 2e64 656c 6574 655f         k.delete_
-000268b0: 7365 7276 6963 6528 6622 7b63 6c75 7374  service(f"{clust
-000268c0: 6572 7d2d 6170 6922 2c20 6b2e 6e61 6d65  er}-api", k.name
-000268d0: 7370 6163 6529 0a20 2020 2020 2020 2020  space).         
-000268e0: 2020 2069 6620 6622 7b63 6c75 7374 6572     if f"{cluster
-000268f0: 7d2d 696e 6772 6573 7322 2069 6e20 6b2e  }-ingress" in k.
-00026900: 6c69 7374 5f73 6572 7669 6365 7328 6b2e  list_services(k.
-00026910: 6e61 6d65 7370 6163 6529 3a0a 2020 2020  namespace):.    
-00026920: 2020 2020 2020 2020 2020 2020 6b2e 6465              k.de
-00026930: 6c65 7465 5f73 6572 7669 6365 2866 227b  lete_service(f"{
-00026940: 636c 7573 7465 727d 2d69 6e67 7265 7373  cluster}-ingress
-00026950: 222c 206b 2e6e 616d 6573 7061 6365 290a  ", k.namespace).
-00026960: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00026970: 7479 7065 2069 6e20 5b27 6177 7327 2c20  type in ['aws', 
-00026980: 2767 6370 272c 2027 6962 6d27 5d20 616e  'gcp', 'ibm'] an
-00026990: 6420 6e6f 7420 676b 6520 616e 6420 6e6f  d not gke and no
-000269a0: 7420 656b 733a 0a20 2020 2020 2020 2020  t eks:.         
-000269b0: 2020 2065 7869 7374 696e 675f 6c62 7320     existing_lbs 
-000269c0: 3d20 5b6c 5b30 5d20 666f 7220 6c20 696e  = [l[0] for l in
-000269d0: 2073 656c 662e 6c69 7374 5f6c 6f61 6462   self.list_loadb
-000269e0: 616c 616e 6365 7273 2829 2069 6620 6c5b  alancers() if l[
-000269f0: 305d 2069 6e20 5b66 2761 7069 2e7b 636c  0] in [f'api.{cl
-00026a00: 7573 7465 727d 272c 2066 2761 7070 732e  uster}', f'apps.
-00026a10: 7b63 6c75 7374 6572 7d27 5d5d 0a20 2020  {cluster}']].   
-00026a20: 2020 2020 2020 2020 2066 6f72 206c 6220           for lb 
-00026a30: 696e 2065 7869 7374 696e 675f 6c62 733a  in existing_lbs:
-00026a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026a50: 2073 656c 662e 6465 6c65 7465 5f6c 6f61   self.delete_loa
-00026a60: 6462 616c 616e 6365 7228 6c62 2c20 646f  dbalancer(lb, do
-00026a70: 6d61 696e 3d64 6f6d 6169 6e29 0a20 2020  main=domain).   
-00026a80: 2020 2020 2020 2020 2062 7563 6b65 7420           bucket 
-00026a90: 3d20 6622 7b63 6c75 7374 6572 7d2d 7b64  = f"{cluster}-{d
-00026aa0: 6f6d 6169 6e7d 220a 2020 2020 2020 2020  omain}".        
-00026ab0: 2020 2020 6966 2062 7563 6b65 7420 696e      if bucket in
-00026ac0: 2073 656c 662e 6b2e 6c69 7374 5f62 7563   self.k.list_buc
-00026ad0: 6b65 7473 2829 3a0a 2020 2020 2020 2020  kets():.        
-00026ae0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00026af0: 2244 656c 6574 696e 6720 6275 636b 6574  "Deleting bucket
-00026b00: 207b 6275 636b 6574 7d22 290a 2020 2020   {bucket}").    
-00026b10: 2020 2020 2020 2020 2020 2020 6b2e 6465              k.de
-00026b20: 6c65 7465 5f62 7563 6b65 7428 6275 636b  lete_bucket(buck
-00026b30: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
-00026b40: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
-00026b50: 2761 7773 2720 616e 6420 636c 7573 7465  'aws' and cluste
-00026b60: 7220 696e 206b 2e6c 6973 745f 696e 7374  r in k.list_inst
-00026b70: 616e 6365 5f70 726f 6669 6c65 7328 293a  ance_profiles():
-00026b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026b90: 2069 616d 5f72 6f6c 6520 3d20 636c 7573   iam_role = clus
-00026ba0: 7465 7264 6174 612e 6765 7428 2772 6f6c  terdata.get('rol
-00026bb0: 6527 2c20 636c 7573 7465 7229 0a20 2020  e', cluster).   
-00026bc0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00026bd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00026be0: 2020 2020 2020 6b2e 6465 6c65 7465 5f69        k.delete_i
-00026bf0: 6e73 7461 6e63 655f 7072 6f66 696c 6528  nstance_profile(
-00026c00: 636c 7573 7465 722c 2069 616d 5f72 6f6c  cluster, iam_rol
-00026c10: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00026c20: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
-00026c30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00026c40: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-00026c50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00026c60: 2020 2020 2020 2020 2020 2020 206b 2e64               k.d
-00026c70: 656c 6574 655f 726f 6c65 2869 616d 5f72  elete_role(iam_r
-00026c80: 6f6c 6529 0a20 2020 2020 2020 2020 2020  ole).           
-00026c90: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00026ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026cb0: 2070 6173 730a 2020 2020 2020 2020 656c   pass.        el
-00026cc0: 6966 2064 6e73 636c 6965 6e74 2069 7320  if dnsclient is 
-00026cd0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00026ce0: 2020 2020 2020 7a20 3d20 4b63 6f6e 6669        z = Kconfi
-00026cf0: 6728 636c 6965 6e74 3d64 6e73 636c 6965  g(client=dnsclie
-00026d00: 6e74 292e 6b0a 2020 2020 2020 2020 2020  nt).k.          
-00026d10: 2020 7a2e 6465 6c65 7465 5f64 6e73 2866    z.delete_dns(f
-00026d20: 2261 7069 2e7b 636c 7573 7465 727d 222c  "api.{cluster}",
-00026d30: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
-00026d40: 2020 2020 207a 2e64 656c 6574 655f 646e       z.delete_dn
-00026d50: 7328 6622 6170 7073 2e7b 636c 7573 7465  s(f"apps.{cluste
-00026d60: 727d 222c 2064 6f6d 6169 6e29 0a20 2020  r}", domain).   
-00026d70: 2020 2020 2069 6620 6879 7065 7273 6869       if hypershi
-00026d80: 6674 3a0a 2020 2020 2020 2020 2020 2020  ft:.            
-00026d90: 6b75 6265 636f 6e66 6967 6d67 6d74 203d  kubeconfigmgmt =
-00026da0: 2066 227b 636c 7573 7465 7264 6972 7d2f   f"{clusterdir}/
-00026db0: 6b75 6265 636f 6e66 6967 2e6d 676d 7422  kubeconfig.mgmt"
-00026dc0: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-00026dd0: 6c28 6627 4b55 4245 434f 4e46 4947 3d7b  l(f'KUBECONFIG={
-00026de0: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
-00026df0: 6f63 2064 656c 6574 6520 2d66 207b 636c  oc delete -f {cl
-00026e00: 7573 7465 7264 6972 7d2f 6175 746f 6170  usterdir}/autoap
-00026e10: 7072 6f76 6572 6372 6f6e 2e79 6d6c 272c  provercron.yml',
-00026e20: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-00026e30: 2020 2020 2020 2020 2063 616c 6c28 6627           call(f'
-00026e40: 4b55 4245 434f 4e46 4947 3d7b 6b75 6265  KUBECONFIG={kube
-00026e50: 636f 6e66 6967 6d67 6d74 7d20 6f63 2064  configmgmt} oc d
-00026e60: 656c 6574 6520 2d66 207b 636c 7573 7465  elete -f {cluste
-00026e70: 7264 6972 7d2f 6e6f 6465 706f 6f6c 2e79  rdir}/nodepool.y
-00026e80: 616d 6c27 2c20 7368 656c 6c3d 5472 7565  aml', shell=True
-00026e90: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
-00026ea0: 6c6c 2866 274b 5542 4543 4f4e 4649 473d  ll(f'KUBECONFIG=
-00026eb0: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
-00026ec0: 206f 6320 6465 6c65 7465 202d 6620 7b63   oc delete -f {c
-00026ed0: 6c75 7374 6572 6469 727d 2f68 6f73 7465  lusterdir}/hoste
-00026ee0: 6463 6c75 7374 6572 2e79 616d 6c27 2c20  dcluster.yaml', 
-00026ef0: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
-00026f00: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
-00026f10: 7373 6973 7465 6420 616e 6420 2827 6261  ssisted and ('ba
-00026f20: 7265 6d65 7461 6c5f 6973 6f27 2069 6e20  remetal_iso' in 
-00026f30: 636c 7573 7465 7264 6174 6120 6f72 2027  clusterdata or '
-00026f40: 6261 7265 6d65 7461 6c5f 686f 7374 7327  baremetal_hosts'
-00026f50: 2069 6e20 636c 7573 7465 7264 6174 6129   in clusterdata)
-00026f60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00026f70: 2020 6361 6c6c 2866 274b 5542 4543 4f4e    call(f'KUBECON
-00026f80: 4649 473d 7b6b 7562 6563 6f6e 6669 676d  FIG={kubeconfigm
-00026f90: 676d 747d 206f 6320 2d6e 2064 6566 6175  gmt} oc -n defau
-00026fa0: 6c74 2064 656c 6574 6520 616c 6c20 2d6c  lt delete all -l
-00026fb0: 2061 7070 3d68 7474 7064 2d6b 636c 6927   app=httpd-kcli'
-00026fc0: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
-00026fd0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-00026fe0: 6c6c 2866 274b 5542 4543 4f4e 4649 473d  ll(f'KUBECONFIG=
-00026ff0: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
-00027000: 206f 6320 2d6e 2064 6566 6175 6c74 2064   oc -n default d
-00027010: 656c 6574 6520 7076 6320 6874 7470 642d  elete pvc httpd-
-00027020: 6b63 6c69 2d70 7663 272c 2073 6865 6c6c  kcli-pvc', shell
-00027030: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
-00027040: 6620 676b 653a 0a20 2020 2020 2020 2020  f gke:.         
-00027050: 2020 2067 6370 636c 6965 6e74 203d 204e     gcpclient = N
-00027060: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00027070: 6966 2027 636c 6965 6e74 2720 696e 2063  if 'client' in c
-00027080: 6c75 7374 6572 6461 7461 3a0a 2020 2020  lusterdata:.    
-00027090: 2020 2020 2020 2020 2020 2020 6763 7063              gcpc
-000270a0: 6c69 656e 7420 3d20 636c 7573 7465 7264  lient = clusterd
-000270b0: 6174 615b 2763 6c69 656e 7427 5d0a 2020  ata['client'].  
-000270c0: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-000270d0: 656c 662e 7479 7065 203d 3d20 2767 6370  elf.type == 'gcp
-000270e0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-000270f0: 2020 2067 6370 636c 6965 6e74 203d 2073     gcpclient = s
-00027100: 656c 662e 636c 6965 6e74 0a20 2020 2020  elf.client.     
-00027110: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00027120: 2020 2020 2020 2020 2020 2020 206d 7367               msg
-00027130: 203d 2022 4465 6c65 7469 6e67 2067 6b65   = "Deleting gke
-00027140: 2063 6c75 7374 6572 2072 6571 7569 7265   cluster require
-00027150: 7320 746f 2069 6e73 7461 6e74 6961 7465  s to instantiate
-00027160: 2067 6370 2070 726f 7669 6465 7222 0a20   gcp provider". 
-00027170: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00027180: 7272 6f72 286d 7367 290a 2020 2020 2020  rror(msg).      
-00027190: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000271a0: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-000271b0: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-000271c0: 206d 7367 7d0a 2020 2020 2020 2020 2020   msg}.          
-000271d0: 2020 6672 6f6d 206b 7669 7274 2e63 6c75    from kvirt.clu
-000271e0: 7374 6572 2069 6d70 6f72 7420 676b 650a  ster import gke.
-000271f0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00027200: 656e 7463 6f6e 6669 6720 3d20 4b63 6f6e  entconfig = Kcon
-00027210: 6669 6728 636c 6965 6e74 3d67 6370 636c  fig(client=gcpcl
-00027220: 6965 6e74 292e 6b20 6966 2067 6370 636c  ient).k if gcpcl
-00027230: 6965 6e74 2021 3d20 7365 6c66 2e63 6c69  ient != self.cli
-00027240: 656e 7420 656c 7365 2073 656c 660a 2020  ent else self.  
-00027250: 2020 2020 2020 2020 2020 7a6f 6e61 6c20            zonal 
-00027260: 3d20 636c 7573 7465 7264 6174 612e 6765  = clusterdata.ge
-00027270: 7428 277a 6f6e 616c 272c 2054 7275 6529  t('zonal', True)
-00027280: 0a20 2020 2020 2020 2020 2020 2067 6b65  .            gke
-00027290: 2e64 656c 6574 6528 6375 7272 656e 7463  .delete(currentc
-000272a0: 6f6e 6669 672c 2063 6c75 7374 6572 2c20  onfig, cluster, 
-000272b0: 7a6f 6e61 6c29 0a20 2020 2020 2020 2069  zonal).        i
-000272c0: 6620 656b 733a 0a20 2020 2020 2020 2020  f eks:.         
-000272d0: 2020 2065 6b73 636c 6965 6e74 203d 204e     eksclient = N
-000272e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000272f0: 6966 2027 636c 6965 6e74 2720 696e 2063  if 'client' in c
-00027300: 6c75 7374 6572 6461 7461 3a0a 2020 2020  lusterdata:.    
-00027310: 2020 2020 2020 2020 2020 2020 656b 7363              eksc
-00027320: 6c69 656e 7420 3d20 636c 7573 7465 7264  lient = clusterd
-00027330: 6174 615b 2763 6c69 656e 7427 5d0a 2020  ata['client'].  
-00027340: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-00027350: 656c 662e 7479 7065 203d 3d20 2761 7773  elf.type == 'aws
-00027360: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00027370: 2020 2065 6b73 636c 6965 6e74 203d 2073     eksclient = s
-00027380: 656c 662e 636c 6965 6e74 0a20 2020 2020  elf.client.     
-00027390: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000273a0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
-000273b0: 203d 2022 4465 6c65 7469 6e67 2067 6b65   = "Deleting gke
-000273c0: 2063 6c75 7374 6572 2072 6571 7569 7265   cluster require
-000273d0: 7320 746f 2069 6e73 7461 6e74 6961 7465  s to instantiate
-000273e0: 2067 6370 2070 726f 7669 6465 7222 0a20   gcp provider". 
-000273f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00027400: 7272 6f72 286d 7367 290a 2020 2020 2020  rror(msg).      
-00027410: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00027420: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00027430: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00027440: 206d 7367 7d0a 2020 2020 2020 2020 2020   msg}.          
-00027450: 2020 6672 6f6d 206b 7669 7274 2e63 6c75    from kvirt.clu
-00027460: 7374 6572 2069 6d70 6f72 7420 656b 730a  ster import eks.
-00027470: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00027480: 656e 7463 6f6e 6669 6720 3d20 4b63 6f6e  entconfig = Kcon
-00027490: 6669 6728 636c 6965 6e74 3d65 6b73 636c  fig(client=ekscl
-000274a0: 6965 6e74 292e 6b20 6966 2065 6b73 636c  ient).k if ekscl
-000274b0: 6965 6e74 2021 3d20 7365 6c66 2e63 6c69  ient != self.cli
-000274c0: 656e 7420 656c 7365 2073 656c 660a 2020  ent else self.  
-000274d0: 2020 2020 2020 2020 2020 656b 732e 6465            eks.de
-000274e0: 6c65 7465 2863 7572 7265 6e74 636f 6e66  lete(currentconf
-000274f0: 6967 2c20 636c 7573 7465 7229 0a20 2020  ig, cluster).   
-00027500: 2020 2020 2066 6f72 2063 6f6e 6670 6f6f       for confpoo
-00027510: 6c20 696e 2073 656c 662e 636f 6e66 706f  l in self.confpo
-00027520: 6f6c 733a 0a20 2020 2020 2020 2020 2020  ols:.           
-00027530: 2069 705f 7265 7365 7276 6174 696f 6e73   ip_reservations
-00027540: 203d 2073 656c 662e 636f 6e66 706f 6f6c   = self.confpool
-00027550: 735b 636f 6e66 706f 6f6c 5d2e 6765 7428  s[confpool].get(
-00027560: 2769 705f 7265 7365 7276 6174 696f 6e73  'ip_reservations
-00027570: 272c 207b 7d29 0a20 2020 2020 2020 2020  ', {}).         
-00027580: 2020 2069 6620 636c 7573 7465 7220 696e     if cluster in
-00027590: 2069 705f 7265 7365 7276 6174 696f 6e73   ip_reservations
-000275a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000275b0: 2020 6465 6c20 6970 5f72 6573 6572 7661    del ip_reserva
-000275c0: 7469 6f6e 735b 636c 7573 7465 725d 0a20  tions[cluster]. 
-000275d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000275e0: 656c 662e 7570 6461 7465 5f63 6f6e 6670  elf.update_confp
-000275f0: 6f6f 6c28 636f 6e66 706f 6f6c 2c20 7b27  ool(confpool, {'
-00027600: 6970 5f72 6573 6572 7661 7469 6f6e 7327  ip_reservations'
-00027610: 3a20 6970 5f72 6573 6572 7661 7469 6f6e  : ip_reservation
-00027620: 737d 290a 2020 2020 2020 2020 2020 2020  s}).            
-00027630: 6e61 6d65 5f72 6573 6572 7661 7469 6f6e  name_reservation
-00027640: 7320 3d20 7365 6c66 2e63 6f6e 6670 6f6f  s = self.confpoo
-00027650: 6c73 5b63 6f6e 6670 6f6f 6c5d 2e67 6574  ls[confpool].get
-00027660: 2827 6e61 6d65 5f72 6573 6572 7661 7469  ('name_reservati
-00027670: 6f6e 7327 2c20 5b5d 290a 2020 2020 2020  ons', []).      
-00027680: 2020 2020 2020 6966 2063 6c75 7374 6572        if cluster
-00027690: 2069 6e20 6e61 6d65 5f72 6573 6572 7661   in name_reserva
-000276a0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
-000276b0: 2020 2020 2020 206e 616d 655f 7265 7365         name_rese
-000276c0: 7276 6174 696f 6e73 2e72 656d 6f76 6528  rvations.remove(
-000276d0: 636c 7573 7465 7229 0a20 2020 2020 2020  cluster).       
-000276e0: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
-000276f0: 6461 7465 5f63 6f6e 6670 6f6f 6c28 636f  date_confpool(co
-00027700: 6e66 706f 6f6c 2c20 7b27 6e61 6d65 5f72  nfpool, {'name_r
-00027710: 6573 6572 7661 7469 6f6e 7327 3a20 6e61  eservations': na
-00027720: 6d65 5f72 6573 6572 7661 7469 6f6e 737d  me_reservations}
-00027730: 290a 2020 2020 2020 2020 2020 2020 636c  ).            cl
-00027740: 7573 7465 725f 6261 7265 6d65 7461 6c5f  uster_baremetal_
-00027750: 7265 7365 7276 6174 696f 6e73 203d 2073  reservations = s
-00027760: 656c 662e 636f 6e66 706f 6f6c 735b 636f  elf.confpools[co
-00027770: 6e66 706f 6f6c 5d2e 6765 7428 2763 6c75  nfpool].get('clu
-00027780: 7374 6572 5f62 6172 656d 6574 616c 5f72  ster_baremetal_r
-00027790: 6573 6572 7661 7469 6f6e 7327 2c20 7b7d  eservations', {}
-000277a0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000277b0: 2063 6c75 7374 6572 2069 6e20 636c 7573   cluster in clus
-000277c0: 7465 725f 6261 7265 6d65 7461 6c5f 7265  ter_baremetal_re
-000277d0: 7365 7276 6174 696f 6e73 3a0a 2020 2020  servations:.    
-000277e0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-000277f0: 636c 7573 7465 725f 6261 7265 6d65 7461  cluster_baremeta
-00027800: 6c5f 7265 7365 7276 6174 696f 6e73 5b63  l_reservations[c
-00027810: 6c75 7374 6572 5d0a 2020 2020 2020 2020  luster].        
-00027820: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-00027830: 6174 655f 636f 6e66 706f 6f6c 2863 6f6e  ate_confpool(con
-00027840: 6670 6f6f 6c2c 207b 2763 6c75 7374 6572  fpool, {'cluster
-00027850: 5f62 6172 656d 6574 616c 5f72 6573 6572  _baremetal_reser
-00027860: 7661 7469 6f6e 7327 3a20 636c 7573 7465  vations': cluste
-00027870: 725f 6261 7265 6d65 7461 6c5f 7265 7365  r_baremetal_rese
-00027880: 7276 6174 696f 6e73 7d29 0a20 2020 2020  rvations}).     
-00027890: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-000278a0: 6973 7473 2863 6c75 7374 6572 6469 7229  ists(clusterdir)
-000278b0: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
-000278c0: 7269 6e74 2866 2244 656c 6574 696e 6720  rint(f"Deleting 
-000278d0: 6469 7265 6374 6f72 7920 7b63 6c75 7374  directory {clust
-000278e0: 6572 6469 727d 2229 0a20 2020 2020 2020  erdir}").       
-000278f0: 2020 2020 2072 6d74 7265 6528 636c 7573       rmtree(clus
-00027900: 7465 7264 6972 290a 2020 2020 2020 2020  terdir).        
-00027910: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-00027920: 3a20 2773 7563 6365 7373 277d 0a0a 2020  : 'success'}..  
-00027930: 2020 6465 6620 7363 616c 655f 6b75 6265    def scale_kube
-00027940: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
-00027950: 6b75 6265 7479 7065 2c20 6f76 6572 7269  kubetype, overri
-00027960: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-00027970: 2069 6620 6b75 6265 7479 7065 203d 3d20   if kubetype == 
-00027980: 2767 656e 6572 6963 273a 0a20 2020 2020  'generic':.     
-00027990: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-000279a0: 7365 6c66 2e73 6361 6c65 5f6b 7562 655f  self.scale_kube_
-000279b0: 6765 6e65 7269 6328 636c 7573 7465 722c  generic(cluster,
-000279c0: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-000279d0: 6964 6573 290a 2020 2020 2020 2020 656c  ides).        el
-000279e0: 6966 206b 7562 6574 7970 6520 3d3d 2027  if kubetype == '
-000279f0: 6b33 7327 3a0a 2020 2020 2020 2020 2020  k3s':.          
-00027a00: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
-00027a10: 7363 616c 655f 6b75 6265 5f6b 3373 2863  scale_kube_k3s(c
-00027a20: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00027a30: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
-00027a40: 2020 2020 2065 6c69 6620 6b75 6265 7479       elif kubety
-00027a50: 7065 203d 3d20 276f 7065 6e73 6869 6674  pe == 'openshift
-00027a60: 273a 0a20 2020 2020 2020 2020 2020 2072  ':.            r
-00027a70: 6573 756c 7420 3d20 7365 6c66 2e73 6361  esult = self.sca
-00027a80: 6c65 5f6b 7562 655f 6f70 656e 7368 6966  le_kube_openshif
-00027a90: 7428 636c 7573 7465 722c 206f 7665 7272  t(cluster, overr
-00027aa0: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
-00027ab0: 2020 2020 2020 2020 656c 6966 206b 7562          elif kub
-00027ac0: 6574 7970 6520 3d3d 2027 6879 7065 7273  etype == 'hypers
-00027ad0: 6869 6674 273a 0a20 2020 2020 2020 2020  hift':.         
-00027ae0: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
-00027af0: 2e73 6361 6c65 5f6b 7562 655f 6879 7065  .scale_kube_hype
-00027b00: 7273 6869 6674 2863 6c75 7374 6572 2c20  rshift(cluster, 
-00027b10: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
-00027b20: 6465 7329 0a20 2020 2020 2020 2065 6c69  des).        eli
-00027b30: 6620 6b75 6265 7479 7065 203d 3d20 2767  f kubetype == 'g
-00027b40: 6b65 273a 0a20 2020 2020 2020 2020 2020  ke':.           
-00027b50: 2072 6573 756c 7420 3d20 7365 6c66 2e73   result = self.s
-00027b60: 6361 6c65 5f6b 7562 655f 676b 6528 636c  cale_kube_gke(cl
-00027b70: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00027b80: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
-00027b90: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
-00027ba0: 6520 3d3d 2027 656b 7327 3a0a 2020 2020  e == 'eks':.    
-00027bb0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00027bc0: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
-00027bd0: 5f65 6b73 2863 6c75 7374 6572 2c20 6f76  _eks(cluster, ov
-00027be0: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00027bf0: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-00027c00: 6e20 7265 7375 6c74 0a0a 2020 2020 6465  n result..    de
-00027c10: 6620 7363 616c 655f 6b75 6265 5f65 6b73  f scale_kube_eks
-00027c20: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
-00027c30: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
-00027c40: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
-00027c50: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
-00027c60: 2065 6b73 0a20 2020 2020 2020 2072 6574   eks.        ret
-00027c70: 7572 6e20 656b 732e 7363 616c 6528 7365  urn eks.scale(se
-00027c80: 6c66 2c20 636c 7573 7465 722c 206f 7665  lf, cluster, ove
-00027c90: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
-00027ca0: 2073 6361 6c65 5f6b 7562 655f 6765 6e65   scale_kube_gene
-00027cb0: 7269 6328 7365 6c66 2c20 636c 7573 7465  ric(self, cluste
-00027cc0: 722c 206f 7665 7272 6964 6573 3d7b 7d29  r, overrides={})
-00027cd0: 3a0a 2020 2020 2020 2020 706c 616e 6469  :.        plandi
-00027ce0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-00027cf0: 616d 6528 6b75 6265 6164 6d2e 6372 6561  ame(kubeadm.crea
-00027d00: 7465 2e5f 5f63 6f64 655f 5f2e 636f 5f66  te.__code__.co_f
-00027d10: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
-00027d20: 2072 6574 7572 6e20 6b75 6265 6164 6d2e   return kubeadm.
-00027d30: 7363 616c 6528 7365 6c66 2c20 706c 616e  scale(self, plan
-00027d40: 6469 722c 2063 6c75 7374 6572 2c20 6f76  dir, cluster, ov
-00027d50: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
-00027d60: 6620 7363 616c 655f 6b75 6265 5f67 6b65  f scale_kube_gke
-00027d70: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
-00027d80: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
-00027d90: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
-00027da0: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
-00027db0: 2067 6b65 0a20 2020 2020 2020 2072 6574   gke.        ret
-00027dc0: 7572 6e20 676b 652e 7363 616c 6528 7365  urn gke.scale(se
-00027dd0: 6c66 2c20 636c 7573 7465 722c 206f 7665  lf, cluster, ove
-00027de0: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
-00027df0: 2073 6361 6c65 5f6b 7562 655f 6879 7065   scale_kube_hype
-00027e00: 7273 6869 6674 2873 656c 662c 2063 6c75  rshift(self, clu
-00027e10: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
-00027e20: 7b7d 293a 0a20 2020 2020 2020 2070 6c61  {}):.        pla
-00027e30: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
-00027e40: 6972 6e61 6d65 2868 7970 6572 7368 6966  irname(hypershif
-00027e50: 742e 6372 6561 7465 2e5f 5f63 6f64 655f  t.create.__code_
-00027e60: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
-00027e70: 2020 2020 2020 2072 6574 7572 6e20 6879         return hy
-00027e80: 7065 7273 6869 6674 2e73 6361 6c65 2873  pershift.scale(s
-00027e90: 656c 662c 2070 6c61 6e64 6972 2c20 636c  elf, plandir, cl
-00027ea0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00027eb0: 290a 0a20 2020 2064 6566 2073 6361 6c65  )..    def scale
-00027ec0: 5f6b 7562 655f 6b33 7328 7365 6c66 2c20  _kube_k3s(self, 
-00027ed0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00027ee0: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
-00027ef0: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
-00027f00: 682e 6469 726e 616d 6528 6b33 732e 6372  h.dirname(k3s.cr
-00027f10: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
-00027f20: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
-00027f30: 2020 2072 6574 7572 6e20 6b33 732e 7363     return k3s.sc
-00027f40: 616c 6528 7365 6c66 2c20 706c 616e 6469  ale(self, plandi
-00027f50: 722c 2063 6c75 7374 6572 2c20 6f76 6572  r, cluster, over
-00027f60: 7269 6465 7329 0a0a 2020 2020 6465 6620  rides)..    def 
-00027f70: 7363 616c 655f 6b75 6265 5f6f 7065 6e73  scale_kube_opens
-00027f80: 6869 6674 2873 656c 662c 2063 6c75 7374  hift(self, clust
-00027f90: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
-00027fa0: 293a 0a20 2020 2020 2020 2070 6c61 6e64  ):.        pland
-00027fb0: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
-00027fc0: 6e61 6d65 286f 7065 6e73 6869 6674 2e63  name(openshift.c
-00027fd0: 7265 6174 652e 5f5f 636f 6465 5f5f 2e63  reate.__code__.c
-00027fe0: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
-00027ff0: 2020 2020 7265 7475 726e 206f 7065 6e73      return opens
-00028000: 6869 6674 2e73 6361 6c65 2873 656c 662c  hift.scale(self,
-00028010: 2070 6c61 6e64 6972 2c20 636c 7573 7465   plandir, cluste
-00028020: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
-00028030: 2020 2064 6566 2075 7064 6174 655f 6b75     def update_ku
-00028040: 6265 2873 656c 662c 2063 6c75 7374 6572  be(self, cluster
-00028050: 2c20 5f74 7970 652c 206f 7665 7272 6964  , _type, overrid
-00028060: 6573 3d7b 7d2c 2070 6c61 6e3d 4e6f 6e65  es={}, plan=None
-00028070: 293a 0a20 2020 2020 2020 206f 7665 7272  ):.        overr
-00028080: 6964 6573 5b27 736b 6970 5f66 696c 6573  ides['skip_files
-00028090: 5f72 656d 6564 6961 7469 6f6e 275d 203d  _remediation'] =
-000280a0: 2054 7275 650a 2020 2020 2020 2020 6f76   True.        ov
-000280b0: 6572 7269 6465 735b 2773 6361 6c65 275d  errides['scale']
-000280c0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000280d0: 636c 7573 7465 7264 6972 203d 206f 732e  clusterdir = os.
-000280e0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-000280f0: 6622 7e2f 2e6b 636c 692f 636c 7573 7465  f"~/.kcli/cluste
-00028100: 7273 2f7b 636c 7573 7465 727d 2229 0a20  rs/{cluster}"). 
-00028110: 2020 2020 2020 2070 6c61 6e76 6d73 203d         planvms =
-00028120: 205b 5d0a 2020 2020 2020 2020 6966 2070   [].        if p
-00028130: 6c61 6e20 6973 204e 6f6e 653a 0a20 2020  lan is None:.   
-00028140: 2020 2020 2020 2020 2070 6c61 6e20 3d20           plan = 
-00028150: 636c 7573 7465 720a 2020 2020 2020 2020  cluster.        
-00028160: 6966 205f 7479 7065 203d 3d20 2765 6b73  if _type == 'eks
-00028170: 273a 0a20 2020 2020 2020 2020 2020 2073  ':.            s
-00028180: 656c 662e 7363 616c 655f 6b75 6265 5f65  elf.scale_kube_e
-00028190: 6b73 2863 6c75 7374 6572 2c20 6f76 6572  ks(cluster, over
-000281a0: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
-000281b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000281c0: 7572 6e0a 2020 2020 2020 2020 6966 205f  urn.        if _
-000281d0: 7479 7065 203d 3d20 2767 6b65 273a 0a20  type == 'gke':. 
-000281e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000281f0: 7363 616c 655f 6b75 6265 5f67 6b65 2863  scale_kube_gke(c
-00028200: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00028210: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
-00028220: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00028230: 2020 2020 2020 2020 6966 205f 7479 7065          if _type
-00028240: 203d 3d20 2767 656e 6572 6963 273a 0a20   == 'generic':. 
-00028250: 2020 2020 2020 2020 2020 2072 6f6c 6573             roles
-00028260: 203d 205b 2763 746c 706c 616e 6573 272c   = ['ctlplanes',
-00028270: 2027 776f 726b 6572 7327 5d0a 2020 2020   'workers'].    
-00028280: 2020 2020 2020 2020 706c 616e 6469 7220          plandir 
-00028290: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-000282a0: 6528 6b75 6265 6164 6d2e 6372 6561 7465  e(kubeadm.create
-000282b0: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
-000282c0: 656e 616d 6529 0a20 2020 2020 2020 2065  ename).        e
-000282d0: 6c69 6620 5f74 7970 6520 3d3d 2027 6b33  lif _type == 'k3
-000282e0: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
-000282f0: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
-00028300: 682e 6469 726e 616d 6528 6b33 732e 6372  h.dirname(k3s.cr
-00028310: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
-00028320: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
-00028330: 2020 2020 2020 2072 6f6c 6573 203d 205b         roles = [
-00028340: 2762 6f6f 7473 7472 6170 272c 2027 776f  'bootstrap', 'wo
-00028350: 726b 6572 7327 5d20 6966 206f 7665 7272  rkers'] if overr
-00028360: 6964 6573 2e67 6574 2827 6374 6c70 6c61  ides.get('ctlpla
-00028370: 6e65 7327 2c20 3129 203d 3d20 3120 656c  nes', 1) == 1 el
-00028380: 7365 205b 2762 6f6f 7473 7472 6170 272c  se ['bootstrap',
-00028390: 2027 6374 6c70 6c61 6e65 7327 2c0a 2020   'ctlplanes',.  
-000283a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283f0: 2020 2020 2020 2027 776f 726b 6572 7327         'workers'
-00028400: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-00028410: 2020 2020 2020 2020 2020 2020 706c 616e              plan
-00028420: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
-00028430: 726e 616d 6528 6f70 656e 7368 6966 742e  rname(openshift.
-00028440: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
-00028450: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
-00028460: 2020 2020 2020 2020 2072 6f6c 6573 203d           roles =
-00028470: 205b 2763 6c6f 7564 5f63 746c 706c 616e   ['cloud_ctlplan
-00028480: 6573 272c 2027 636c 6f75 645f 776f 726b  es', 'cloud_work
-00028490: 6572 7327 5d20 6966 2073 656c 662e 7479  ers'] if self.ty
-000284a0: 7065 2069 6e20 5b27 6177 7327 2c20 2767  pe in ['aws', 'g
-000284b0: 6370 275d 2065 6c73 6520 5b27 6374 6c70  cp'] else ['ctlp
-000284c0: 6c61 6e65 7327 2c20 2777 6f72 6b65 7273  lanes', 'workers
-000284d0: 275d 0a20 2020 2020 2020 2069 6620 6f76  '].        if ov
-000284e0: 6572 7269 6465 732e 6765 7428 2777 6f72  errides.get('wor
-000284f0: 6b65 7273 272c 2030 2920 3d3d 2030 3a0a  kers', 0) == 0:.
-00028500: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00028510: 726f 6c65 735b 2d31 5d0a 2020 2020 2020  roles[-1].      
-00028520: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00028530: 7374 7328 6622 7b63 6c75 7374 6572 6469  sts(f"{clusterdi
-00028540: 727d 2f6b 636c 695f 7061 7261 6d65 7465  r}/kcli_paramete
-00028550: 7273 2e79 6d6c 2229 3a0a 2020 2020 2020  rs.yml"):.      
-00028560: 2020 2020 2020 6461 7461 203d 207b 2763        data = {'c
-00028570: 6c75 7374 6572 273a 2063 6c75 7374 6572  luster': cluster
-00028580: 2c20 276b 7562 6527 3a20 636c 7573 7465  , 'kube': cluste
-00028590: 722c 2027 6b75 6265 7479 7065 273a 205f  r, 'kubetype': _
-000285a0: 7479 7065 7d0a 2020 2020 2020 2020 2020  type}.          
-000285b0: 2020 7769 7468 206f 7065 6e28 6622 7b63    with open(f"{c
-000285c0: 6c75 7374 6572 6469 727d 2f6b 636c 695f  lusterdir}/kcli_
-000285d0: 7061 7261 6d65 7465 7273 2e79 6d6c 222c  parameters.yml",
-000285e0: 2027 7227 2920 6173 2069 6e73 7461 6c6c   'r') as install
-000285f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00028600: 2020 696e 7374 616c 6c70 6172 616d 203d    installparam =
-00028610: 2079 616d 6c2e 7361 6665 5f6c 6f61 6428   yaml.safe_load(
-00028620: 696e 7374 616c 6c29 0a20 2020 2020 2020  install).       
-00028630: 2020 2020 2020 2020 2064 6174 612e 7570           data.up
-00028640: 6461 7465 2869 6e73 7461 6c6c 7061 7261  date(installpara
-00028650: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
-00028660: 2020 2070 6c61 6e20 3d20 696e 7374 616c     plan = instal
-00028670: 6c70 6172 616d 2e67 6574 2827 706c 616e  lparam.get('plan
-00028680: 272c 2070 6c61 6e29 0a20 2020 2020 2020  ', plan).       
-00028690: 2020 2020 2064 6174 612e 7570 6461 7465       data.update
-000286a0: 286f 7665 7272 6964 6573 290a 2020 2020  (overrides).    
-000286b0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-000286c0: 6e28 6622 7b63 6c75 7374 6572 6469 727d  n(f"{clusterdir}
-000286d0: 2f6b 636c 695f 7061 7261 6d65 7465 7273  /kcli_parameters
-000286e0: 2e79 6d6c 222c 2027 7727 2920 6173 2070  .yml", 'w') as p
-000286f0: 6172 616d 6669 6c65 3a0a 2020 2020 2020  aramfile:.      
-00028700: 2020 2020 2020 2020 2020 7961 6d6c 2e73            yaml.s
-00028710: 6166 655f 6475 6d70 2864 6174 612c 2070  afe_dump(data, p
-00028720: 6172 616d 6669 6c65 290a 2020 2020 2020  aramfile).      
-00028730: 2020 6f73 2e63 6864 6972 286f 732e 7061    os.chdir(os.pa
-00028740: 7468 2e65 7870 616e 6475 7365 7228 227e  th.expanduser("~
-00028750: 2f2e 6b63 6c69 2229 290a 2020 2020 2020  /.kcli")).      
-00028760: 2020 666f 7220 726f 6c65 2069 6e20 726f    for role in ro
-00028770: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00028780: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
-00028790: 6e67 2076 6d73 2077 6974 6820 7b72 6f6c  ng vms with {rol
-000287a0: 657d 2072 6f6c 6522 290a 2020 2020 2020  e} role").      
-000287b0: 2020 2020 2020 706c 616e 6461 7461 203d        plandata =
-000287c0: 2073 656c 662e 706c 616e 2870 6c61 6e2c   self.plan(plan,
-000287d0: 2069 6e70 7574 6669 6c65 3d66 277b 706c   inputfile=f'{pl
-000287e0: 616e 6469 727d 2f7b 726f 6c65 7d2e 796d  andir}/{role}.ym
-000287f0: 6c27 2c20 6f76 6572 7269 6465 733d 6f76  l', overrides=ov
-00028800: 6572 7269 6465 732c 2075 7064 6174 653d  errides, update=
-00028810: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00028820: 2020 706c 616e 766d 732e 6578 7465 6e64    planvms.extend
-00028830: 2870 6c61 6e64 6174 615b 276e 6577 766d  (plandata['newvm
-00028840: 7327 5d20 2b20 706c 616e 6461 7461 5b27  s'] + plandata['
-00028850: 6578 6973 7469 6e67 766d 7327 5d29 0a20  existingvms']). 
-00028860: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-00028870: 6e5b 274b 5542 4543 4f4e 4649 4727 5d20  n['KUBECONFIG'] 
-00028880: 3d20 6622 7b63 6c75 7374 6572 6469 727d  = f"{clusterdir}
-00028890: 2f61 7574 682f 6b75 6265 636f 6e66 6967  /auth/kubeconfig
-000288a0: 220a 2020 2020 2020 2020 6269 6e61 7279  ".        binary
-000288b0: 203d 2027 6f63 2720 6966 2077 6869 6368   = 'oc' if which
-000288c0: 2827 6f63 2729 2069 7320 6e6f 7420 4e6f  ('oc') is not No
-000288d0: 6e65 2065 6c73 6520 276b 7562 6563 746c  ne else 'kubectl
-000288e0: 270a 2020 2020 2020 2020 6e6f 6465 7363  '.        nodesc
-000288f0: 6d64 203d 2066 277b 6269 6e61 7279 7d20  md = f'{binary} 
-00028900: 6765 7420 6e6f 6465 202d 6f20 6e61 6d65  get node -o name
-00028910: 270a 2020 2020 2020 2020 6e6f 6465 7320  '.        nodes 
-00028920: 3d20 5b6e 2e73 7472 6970 2829 2e72 6570  = [n.strip().rep
-00028930: 6c61 6365 2827 6e6f 6465 2f27 2c20 2727  lace('node/', ''
-00028940: 2920 666f 7220 6e20 696e 206f 732e 706f  ) for n in os.po
-00028950: 7065 6e28 6e6f 6465 7363 6d64 292e 7265  pen(nodescmd).re
-00028960: 6164 6c69 6e65 7328 295d 0a20 2020 2020  adlines()].     
-00028970: 2020 2066 6f72 2076 6d20 696e 2073 656c     for vm in sel
-00028980: 662e 6b2e 6c69 7374 2829 3a0a 2020 2020  f.k.list():.    
-00028990: 2020 2020 2020 2020 766d 6e61 6d65 203d          vmname =
-000289a0: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
-000289b0: 2020 2020 2020 2020 766d 706c 616e 203d          vmplan =
-000289c0: 2076 6d2e 6765 7428 2770 6c61 6e27 2c20   vm.get('plan', 
-000289d0: 276b 7669 7274 2729 0a20 2020 2020 2020  'kvirt').       
-000289e0: 2020 2020 2069 6620 766d 706c 616e 203d       if vmplan =
-000289f0: 3d20 706c 616e 2061 6e64 2076 6d6e 616d  = plan and vmnam
-00028a00: 6520 6e6f 7420 696e 2070 6c61 6e76 6d73  e not in planvms
-00028a10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00028a20: 2020 7070 7269 6e74 2866 2244 656c 6574    pprint(f"Delet
-00028a30: 696e 6720 766d 207b 766d 6e61 6d65 7d22  ing vm {vmname}"
-00028a40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00028a50: 2020 7365 6c66 2e6b 2e64 656c 6574 6528    self.k.delete(
-00028a60: 766d 6e61 6d65 290a 2020 2020 2020 2020  vmname).        
-00028a70: 2020 2020 2020 2020 666f 7220 6e6f 6465          for node
-00028a80: 2069 6e20 6e6f 6465 733a 0a20 2020 2020   in nodes:.     
-00028a90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00028aa0: 6620 6e6f 6465 2e73 706c 6974 2827 2e27  f node.split('.'
-00028ab0: 295b 305d 203d 3d20 766d 6e61 6d65 3a0a  )[0] == vmname:.
-00028ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ad0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00028ae0: 2244 656c 6574 696e 6720 6e6f 6465 207b  "Deleting node {
-00028af0: 6e6f 6465 7d20 6672 6f6d 2079 6f75 7220  node} from your 
-00028b00: 636c 7573 7465 7222 290a 2020 2020 2020  cluster").      
-00028b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b20: 2020 6361 6c6c 2866 277b 6269 6e61 7279    call(f'{binary
-00028b30: 7d20 6465 6c65 7465 206e 6f64 6520 7b6e  } delete node {n
-00028b40: 6f64 657d 272c 2073 6865 6c6c 3d54 7275  ode}', shell=Tru
-00028b50: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00028b60: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00028b70: 0a0a 2020 2020 6465 6620 6578 706f 7365  ..    def expose
-00028b80: 5f70 6c61 6e28 7365 6c66 2c20 706c 616e  _plan(self, plan
-00028b90: 2c20 696e 7075 7466 696c 653d 4e6f 6e65  , inputfile=None
-00028ba0: 2c20 6f76 6572 7269 6465 733d 7b7d 2c20  , overrides={}, 
-00028bb0: 706f 7274 3d39 3030 302c 2070 666d 6f64  port=9000, pfmod
-00028bc0: 653d 4661 6c73 652c 2063 6c75 7374 6572  e=False, cluster
-00028bd0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-00028be0: 2069 6e70 7574 6669 6c65 203d 206f 732e   inputfile = os.
-00028bf0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-00028c00: 696e 7075 7466 696c 6529 0a20 2020 2020  inputfile).     
-00028c10: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-00028c20: 682e 6578 6973 7473 2869 6e70 7574 6669  h.exists(inputfi
-00028c30: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00028c40: 2065 7272 6f72 2822 4e6f 2069 6e70 7574   error("No input
-00028c50: 2066 696c 6520 666f 756e 6420 6e6f 7220   file found nor 
-00028c60: 6465 6661 756c 7420 6b63 6c69 5f70 6c61  default kcli_pla
-00028c70: 6e2e 796d 6c2e 4c65 6176 696e 672e 2e2e  n.yml.Leaving...
-00028c80: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00028c90: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-00028ca0: 2020 2020 7070 7269 6e74 2866 2248 616e      pprint(f"Han
-00028cb0: 646c 696e 6720 6578 706f 7365 206f 6620  dling expose of 
-00028cc0: 706c 616e 2077 6974 6820 6e61 6d65 207b  plan with name {
-00028cd0: 706c 616e 7d20 616e 6420 696e 7075 7466  plan} and inputf
-00028ce0: 696c 6520 7b69 6e70 7574 6669 6c65 7d22  ile {inputfile}"
-00028cf0: 290a 2020 2020 2020 2020 6b65 7870 6f73  ).        kexpos
-00028d00: 6572 203d 204b 6578 706f 7365 7228 7365  er = Kexposer(se
-00028d10: 6c66 2c20 706c 616e 2c20 696e 7075 7466  lf, plan, inputf
-00028d20: 696c 652c 206f 7665 7272 6964 6573 3d6f  ile, overrides=o
-00028d30: 7665 7272 6964 6573 2c20 706f 7274 3d70  verrides, port=p
-00028d40: 6f72 742c 2070 666d 6f64 653d 7066 6d6f  ort, pfmode=pfmo
-00028d50: 6465 2c20 636c 7573 7465 723d 636c 7573  de, cluster=clus
-00028d60: 7465 7229 0a20 2020 2020 2020 206b 6578  ter).        kex
-00028d70: 706f 7365 722e 7275 6e28 290a 0a20 2020  poser.run()..   
-00028d80: 2064 6566 2063 7265 6174 655f 6f70 656e   def create_open
-00028d90: 7368 6966 745f 6973 6f28 7365 6c66 2c20  shift_iso(self, 
-00028da0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00028db0: 6573 3d7b 7d2c 2069 676e 6974 696f 6e66  es={}, ignitionf
-00028dc0: 696c 653d 4e6f 6e65 2c20 706f 646d 616e  ile=None, podman
-00028dd0: 3d46 616c 7365 2c20 696e 7374 616c 6c65  =False, installe
-00028de0: 723d 4661 6c73 652c 0a20 2020 2020 2020  r=False,.       
-00028df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e00: 2020 2020 2020 6469 7265 6374 3d46 616c        direct=Fal
-00028e10: 7365 293a 0a20 2020 2020 2020 206d 6574  se):.        met
-00028e20: 616c 5f75 726c 203d 204e 6f6e 650a 2020  al_url = None.  
-00028e30: 2020 2020 2020 6973 6f5f 7665 7273 696f        iso_versio
-00028e40: 6e20 3d20 7374 7228 6f76 6572 7269 6465  n = str(override
-00028e50: 732e 6765 7428 2776 6572 7369 6f6e 272c  s.get('version',
-00028e60: 2027 6c61 7465 7374 2729 290a 2020 2020   'latest')).    
-00028e70: 2020 2020 6966 206e 6f74 2069 6e73 7461      if not insta
-00028e80: 6c6c 6572 3a0a 2020 2020 2020 2020 2020  ller:.          
-00028e90: 2020 6966 2069 736f 5f76 6572 7369 6f6e    if iso_version
-00028ea0: 206e 6f74 2069 6e20 5b27 6c61 7465 7374   not in ['latest
-00028eb0: 272c 2027 7072 652d 7265 6c65 6173 6527  ', 'pre-release'
-00028ec0: 5d20 616e 6420 6e6f 7420 6973 6f5f 7665  ] and not iso_ve
-00028ed0: 7273 696f 6e2e 7374 6172 7473 7769 7468  rsion.startswith
-00028ee0: 2827 342e 2729 3a0a 2020 2020 2020 2020  ('4.'):.        
-00028ef0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00028f00: 2246 6f72 6369 6e67 206c 6976 6520 6973  "Forcing live is
-00028f10: 6f20 7665 7273 696f 6e20 746f 206c 6174  o version to lat
-00028f20: 6573 7422 290a 2020 2020 2020 2020 2020  est").          
-00028f30: 2020 2020 2020 6973 6f5f 7665 7273 696f        iso_versio
-00028f40: 6e20 3d20 276c 6174 6573 7427 0a20 2020  n = 'latest'.   
-00028f50: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
-00028f60: 6f5f 7665 7273 696f 6e2e 7374 6172 7473  o_version.starts
-00028f70: 7769 7468 2827 342e 2729 3a0a 2020 2020  with('4.'):.    
-00028f80: 2020 2020 2020 2020 2020 2020 6d69 6e6f              mino
-00028f90: 725f 7665 7273 696f 6e20 3d20 6973 6f5f  r_version = iso_
-00028fa0: 7665 7273 696f 6e2e 7370 6c69 7428 272e  version.split('.
-00028fb0: 2729 5b31 5d0a 2020 2020 2020 2020 2020  ')[1].          
-00028fc0: 2020 2020 2020 6966 206d 696e 6f72 5f76        if minor_v
-00028fd0: 6572 7369 6f6e 2e69 7364 6967 6974 2829  ersion.isdigit()
-00028fe0: 2061 6e64 2069 6e74 286d 696e 6f72 5f76   and int(minor_v
-00028ff0: 6572 7369 6f6e 2920 3c20 363a 0a20 2020  ersion) < 6:.   
-00029000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029010: 206d 6574 616c 5f75 726c 203d 2066 2268   metal_url = f"h
-00029020: 7474 7073 3a2f 2f6d 6972 726f 722e 6f70  ttps://mirror.op
-00029030: 656e 7368 6966 742e 636f 6d2f 7075 622f  enshift.com/pub/
-00029040: 6f70 656e 7368 6966 742d 7634 2f64 6570  openshift-v4/dep
-00029050: 656e 6465 6e63 6965 732f 7268 636f 732f  endencies/rhcos/
-00029060: 7b69 736f 5f76 6572 7369 6f6e 7d2f 6c61  {iso_version}/la
-00029070: 7465 7374 220a 2020 2020 2020 2020 2020  test".          
-00029080: 2020 2020 2020 2020 2020 6d65 7461 6c5f            metal_
-00029090: 7572 6c20 2b3d 2022 2f72 6863 6f73 2d6d  url += "/rhcos-m
-000290a0: 6574 616c 2e78 3836 5f36 342e 7261 772e  etal.x86_64.raw.
-000290b0: 677a 220a 2020 2020 2020 2020 2020 2020  gz".            
-000290c0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-000290d0: 2245 6d62 6564 6469 6e67 206d 6574 616c  "Embedding metal
-000290e0: 2075 726c 2069 6e20 6973 6f20 666f 7220   url in iso for 
-000290f0: 7461 7267 6574 2076 6572 7369 6f6e 2061  target version a
-00029100: 6e64 2069 6e73 7461 6c6c 696e 6720 7769  nd installing wi
-00029110: 7468 2061 206d 6f72 6520 7265 6365 6e74  th a more recent
-00029120: 2069 736f 2229 0a20 2020 2020 2020 2020   iso").         
-00029130: 2020 2020 2020 2069 736f 5f76 6572 7369         iso_versi
-00029140: 6f6e 203d 2027 6c61 7465 7374 270a 2020  on = 'latest'.  
-00029150: 2020 2020 2020 6170 695f 6970 203d 206f        api_ip = o
-00029160: 7665 7272 6964 6573 2e67 6574 2827 6170  verrides.get('ap
-00029170: 695f 6970 2729 0a20 2020 2020 2020 2069  i_ip').        i
-00029180: 676e 6974 696f 6e5f 7665 7273 696f 6e20  gnition_version 
-00029190: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-000291a0: 2769 676e 6974 696f 6e5f 7665 7273 696f  'ignition_versio
-000291b0: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
-000291c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291d0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-000291e0: 6d6f 6e2e 6967 6e69 7469 6f6e 5f76 6572  mon.ignition_ver
-000291f0: 7369 6f6e 2822 7268 636f 732d 2573 2220  sion("rhcos-%s" 
-00029200: 2520 6973 6f5f 7665 7273 696f 6e2e 7265  % iso_version.re
-00029210: 706c 6163 6528 272e 272c 2027 2729 2929  place('.', '')))
-00029220: 0a20 2020 2020 2020 2072 6f6c 6520 3d20  .        role = 
-00029230: 6f76 6572 7269 6465 732e 6765 7428 2772  overrides.get('r
-00029240: 6f6c 6527 2c20 2777 6f72 6b65 7227 290a  ole', 'worker').
-00029250: 2020 2020 2020 2020 6973 6f20 3d20 6f76          iso = ov
-00029260: 6572 7269 6465 732e 6765 7428 2769 736f  errides.get('iso
-00029270: 272c 2054 7275 6529 0a20 2020 2020 2020  ', True).       
-00029280: 2064 6f6d 6169 6e20 3d20 6f76 6572 7269   domain = overri
-00029290: 6465 732e 6765 7428 2764 6f6d 6169 6e27  des.get('domain'
-000292a0: 290a 2020 2020 2020 2020 6966 2027 2e27  ).        if '.'
-000292b0: 2069 6e20 636c 7573 7465 723a 0a20 2020   in cluster:.   
-000292c0: 2020 2020 2020 2020 2064 6f6d 6169 6e20           domain 
-000292d0: 3d20 272e 272e 6a6f 696e 2863 6c75 7374  = '.'.join(clust
-000292e0: 6572 2e73 706c 6974 2827 2e27 295b 313a  er.split('.')[1:
-000292f0: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
-00029300: 7072 696e 7428 6622 5573 696e 6720 646f  print(f"Using do
-00029310: 6d61 696e 207b 646f 6d61 696e 7d22 290a  main {domain}").
-00029320: 2020 2020 2020 2020 2020 2020 636c 7573              clus
-00029330: 7465 7220 3d20 636c 7573 7465 722e 7265  ter = cluster.re
-00029340: 706c 6163 6528 6622 2e7b 646f 6d61 696e  place(f".{domain
-00029350: 7d22 2c20 2727 290a 2020 2020 2020 2020  }", '').        
-00029360: 6966 2063 6c75 7374 6572 2e73 7461 7274  if cluster.start
-00029370: 7377 6974 6828 2761 7069 2e27 293a 0a20  swith('api.'):. 
-00029380: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
-00029390: 6572 203d 2063 6c75 7374 6572 2e72 6570  er = cluster.rep
-000293a0: 6c61 6365 2822 6170 692e 222c 2027 2729  lace("api.", '')
-000293b0: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-000293c0: 696e 7428 6622 5573 696e 6720 636c 7573  int(f"Using clus
-000293d0: 7465 7220 7b63 6c75 7374 6572 7d22 290a  ter {cluster}").
-000293e0: 2020 2020 2020 2020 686f 7374 735f 636f          hosts_co
-000293f0: 6e74 656e 7420 3d20 4e6f 6e65 0a20 2020  ntent = None.   
-00029400: 2020 2020 2066 696e 616c 6461 7461 203d       finaldata =
-00029410: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-00029420: 2069 676e 6974 696f 6e66 696c 6520 6973   ignitionfile is
-00029430: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00029440: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-00029450: 2e70 6174 682e 6578 6973 7473 2869 676e  .path.exists(ign
-00029460: 6974 696f 6e66 696c 6529 3a0a 2020 2020  itionfile):.    
-00029470: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00029480: 7228 6622 7b69 676e 6974 696f 6e66 696c  r(f"{ignitionfil
-00029490: 657d 206e 6f74 2066 6f75 6e64 2229 0a20  e} not found"). 
-000294a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000294b0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-000294c0: 2020 2020 2020 2066 696e 616c 6461 7461         finaldata
-000294d0: 203d 206f 7065 6e28 6967 6e69 7469 6f6e   = open(ignition
-000294e0: 6669 6c65 292e 7265 6164 2829 0a20 2020  file).read().   
-000294f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00029500: 2020 2020 2020 2069 676e 6974 696f 6e66         ignitionf
-00029510: 696c 6520 3d20 6622 7b72 6f6c 657d 2e69  ile = f"{role}.i
-00029520: 676e 220a 2020 2020 2020 2020 2020 2020  gn".            
-00029530: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-00029540: 7328 6967 6e69 7469 6f6e 6669 6c65 293a  s(ignitionfile):
-00029550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029560: 2077 6172 6e69 6e67 2866 2255 7369 6e67   warning(f"Using
-00029570: 2065 7869 7374 696e 6720 7b69 676e 6974   existing {ignit
-00029580: 696f 6e66 696c 657d 2229 0a20 2020 2020  ionfile}").     
-00029590: 2020 2020 2020 2020 2020 2066 696e 616c             final
-000295a0: 6461 7461 203d 206f 7065 6e28 6967 6e69  data = open(igni
-000295b0: 7469 6f6e 6669 6c65 292e 7265 6164 2829  tionfile).read()
-000295c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000295d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000295e0: 2020 2069 6620 6170 695f 6970 2069 7320     if api_ip is 
-000295f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00029600: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00029610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029620: 2020 2020 2020 2061 7069 5f69 7020 3d20         api_ip = 
-00029630: 736f 636b 6574 2e67 6574 686f 7374 6279  socket.gethostby
-00029640: 6e61 6d65 2866 2761 7069 2e7b 636c 7573  name(f'api.{clus
-00029650: 7465 727d 2e7b 646f 6d61 696e 7d27 290a  ter}.{domain}').
-00029660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029670: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-00029680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029690: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-000296a0: 2020 2020 2020 2020 2069 6620 6170 695f           if api_
-000296b0: 6970 2069 7320 4e6f 6e65 3a0a 2020 2020  ip is None:.    
-000296c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000296d0: 6966 2064 6f6d 6169 6e20 6973 204e 6f6e  if domain is Non
-000296e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000296f0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00029700: 2822 436f 756c 646e 2774 2066 6967 7572  ("Couldn't figur
-00029710: 6520 6f75 7420 6170 695f 6970 206e 6f72  e out api_ip nor
-00029720: 2072 656c 7920 6f6e 2064 6e73 2073 696e   rely on dns sin
-00029730: 6365 2064 6f6d 6169 6e20 6973 206e 6f74  ce domain is not
-00029740: 2073 6574 2229 0a20 2020 2020 2020 2020   set").         
-00029750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00029760: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-00029770: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00029780: 6172 6e69 6e67 2822 436f 756c 646e 2774  arning("Couldn't
-00029790: 2066 6967 7572 6520 6f75 7420 6170 695f   figure out api_
-000297a0: 6970 2e20 5265 6c79 696e 6720 6f6e 2064  ip. Relying on d
-000297b0: 6e73 2229 0a20 2020 2020 2020 2020 2020  ns").           
-000297c0: 2020 2020 2020 2020 2061 7069 5f69 7020           api_ip 
-000297d0: 3d20 6622 6170 692e 7b63 6c75 7374 6572  = f"api.{cluster
-000297e0: 7d2e 7b64 6f6d 6169 6e7d 220a 2020 2020  }.{domain}".    
-000297f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00029800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029810: 2020 2020 2020 686f 7374 735f 636f 6e74        hosts_cont
-00029820: 656e 7420 3d20 2231 3237 2e30 2e30 2e31  ent = "127.0.0.1
-00029830: 2020 206c 6f63 616c 686f 7374 206c 6f63     localhost loc
-00029840: 616c 686f 7374 2e6c 6f63 616c 646f 6d61  alhost.localdoma
-00029850: 696e 206c 6f63 616c 686f 7374 3420 6c6f  in localhost4 lo
-00029860: 6361 6c68 6f73 7434 2e6c 6f63 616c 646f  calhost4.localdo
-00029870: 6d61 696e 345c 6e22 0a20 2020 2020 2020  main4\n".       
-00029880: 2020 2020 2020 2020 2020 2020 2068 6f73               hos
-00029890: 7473 5f63 6f6e 7465 6e74 202b 3d20 223a  ts_content += ":
-000298a0: 3a31 2020 2020 2020 2020 206c 6f63 616c  :1         local
-000298b0: 686f 7374 206c 6f63 616c 686f 7374 2e6c  host localhost.l
-000298c0: 6f63 616c 646f 6d61 696e 206c 6f63 616c  ocaldomain local
-000298d0: 686f 7374 3620 6c6f 6361 6c68 6f73 7436  host6 localhost6
-000298e0: 2e6c 6f63 616c 646f 6d61 696e 365c 6e22  .localdomain6\n"
-000298f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029900: 2020 2020 2068 6f73 7473 5f63 6f6e 7465       hosts_conte
-00029910: 6e74 202b 3d20 6622 7b61 7069 5f69 707d  nt += f"{api_ip}
-00029920: 2061 7069 2d69 6e74 2e7b 636c 7573 7465   api-int.{cluste
-00029930: 727d 2e7b 646f 6d61 696e 7d20 6170 692e  r}.{domain} api.
-00029940: 7b63 6c75 7374 6572 7d2e 7b64 6f6d 6169  {cluster}.{domai
-00029950: 6e7d 220a 2020 2020 2020 2020 706c 616e  n}".        plan
-00029960: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
-00029970: 726e 616d 6528 6f70 656e 7368 6966 742e  rname(openshift.
-00029980: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
-00029990: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
-000299a0: 2020 2020 2077 6974 6820 6f70 656e 2822       with open("
-000299b0: 6973 6f2e 6967 6e22 2c20 2777 2729 2061  iso.ign", 'w') a
-000299c0: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
-000299d0: 2066 756c 6c5f 6e61 6d65 203d 2066 277b   full_name = f'{
-000299e0: 636c 7573 7465 727d 2e7b 646f 6d61 696e  cluster}.{domain
-000299f0: 7d27 2069 6620 646f 6d61 696e 2069 7320  }' if domain is 
-00029a00: 6e6f 7420 4e6f 6e65 2065 6c73 6520 636c  not None else cl
-00029a10: 7573 7465 720a 2020 2020 2020 2020 2020  uster.          
-00029a20: 2020 7070 7269 6e74 2866 2257 7269 7469    pprint(f"Writi
-00029a30: 6e67 2066 696c 6520 6973 6f2e 6967 6e20  ng file iso.ign 
-00029a40: 666f 7220 7b72 6f6c 657d 2069 6e20 7b66  for {role} in {f
-00029a50: 756c 6c5f 6e61 6d65 7d22 290a 2020 2020  ull_name}").    
-00029a60: 2020 2020 2020 2020 6973 6f64 6972 203d          isodir =
-00029a70: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-00029a80: 2863 6f6d 6d6f 6e2e 5f5f 6669 6c65 5f5f  (common.__file__
-00029a90: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00029aa0: 2066 696e 616c 6461 7461 2069 7320 4e6f   finaldata is No
-00029ab0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00029ac0: 2020 2020 656e 7620 3d20 456e 7669 726f      env = Enviro
-00029ad0: 6e6d 656e 7428 6c6f 6164 6572 3d46 696c  nment(loader=Fil
-00029ae0: 6553 7973 7465 6d4c 6f61 6465 7228 6973  eSystemLoader(is
-00029af0: 6f64 6972 292c 2065 7874 656e 7369 6f6e  odir), extension
-00029b00: 733d 5b27 6a69 6e6a 6132 2e65 7874 2e64  s=['jinja2.ext.d
-00029b10: 6f27 5d2c 2074 7269 6d5f 626c 6f63 6b73  o'], trim_blocks
-00029b20: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00029b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029b40: 2020 2020 2020 2020 206c 7374 7269 705f           lstrip_
-00029b50: 626c 6f63 6b73 3d54 7275 6529 0a20 2020  blocks=True).   
-00029b60: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-00029b70: 706c 203d 2065 6e76 2e67 6574 5f74 656d  pl = env.get_tem
-00029b80: 706c 6174 6528 6f73 2e70 6174 682e 6261  plate(os.path.ba
-00029b90: 7365 6e61 6d65 2822 6967 6e69 7469 6f6e  sename("ignition
-00029ba0: 2e6a 3222 2929 0a20 2020 2020 2020 2020  .j2")).         
-00029bb0: 2020 2020 2020 2069 6620 686f 7374 735f         if hosts_
-00029bc0: 636f 6e74 656e 7420 6973 206e 6f74 204e  content is not N
-00029bd0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00029be0: 2020 2020 2020 2020 2068 6f73 7473 5f63           hosts_c
-00029bf0: 6f6e 7465 6e74 203d 2062 6173 6536 342e  ontent = base64.
-00029c00: 6236 3465 6e63 6f64 6528 686f 7374 735f  b64encode(hosts_
-00029c10: 636f 6e74 656e 742e 656e 636f 6465 2829  content.encode()
-00029c20: 292e 6465 636f 6465 2822 5554 462d 3822  ).decode("UTF-8"
-00029c30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00029c40: 2020 6966 2027 3a27 2069 6e20 6170 695f    if ':' in api_
-00029c50: 6970 3a20 2020 2320 4950 7636 2061 6464  ip:   # IPv6 add
-00029c60: 7265 7373 0a20 2020 2020 2020 2020 2020  ress.           
-00029c70: 2020 2020 2020 2020 2069 676e 6974 696f           ignitio
-00029c80: 6e5f 7572 6c20 3d20 6622 6874 7470 3a2f  n_url = f"http:/
-00029c90: 2f5b 7b61 7069 5f69 707d 5d3a 3232 3632  /[{api_ip}]:2262
-00029ca0: 342f 636f 6e66 6967 2f7b 726f 6c65 7d22  4/config/{role}"
-00029cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029cc0: 2065 6c73 653a 2020 2020 2020 2020 2020   else:          
-00029cd0: 2020 2020 2023 2049 5076 3420 6164 6472       # IPv4 addr
-00029ce0: 6573 730a 2020 2020 2020 2020 2020 2020  ess.            
-00029cf0: 2020 2020 2020 2020 6967 6e69 7469 6f6e          ignition
-00029d00: 5f75 726c 203d 2066 2268 7474 703a 2f2f  _url = f"http://
-00029d10: 7b61 7069 5f69 707d 3a32 3236 3234 2f63  {api_ip}:22624/c
-00029d20: 6f6e 6669 672f 7b72 6f6c 657d 220a 2020  onfig/{role}".  
-00029d30: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00029d40: 6e61 6c64 6174 6120 3d20 7465 6d70 6c2e  naldata = templ.
-00029d50: 7265 6e64 6572 2869 676e 6974 696f 6e5f  render(ignition_
-00029d60: 7572 6c3d 6967 6e69 7469 6f6e 5f75 726c  url=ignition_url
-00029d70: 2c20 686f 7374 735f 636f 6e74 656e 743d  , hosts_content=
-00029d80: 686f 7374 735f 636f 6e74 656e 742c 0a20  hosts_content,. 
-00029d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029db0: 2020 2020 2020 2020 6967 6e69 7469 6f6e          ignition
-00029dc0: 5f76 6572 7369 6f6e 3d69 676e 6974 696f  _version=ignitio
-00029dd0: 6e5f 7665 7273 696f 6e29 0a20 2020 2020  n_version).     
-00029de0: 2020 2020 2020 2069 6620 6469 7265 6374         if direct
-00029df0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029e00: 2020 662e 7772 6974 6528 6669 6e61 6c64    f.write(finald
-00029e10: 6174 6129 0a20 2020 2020 2020 2020 2020  ata).           
-00029e20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00029e30: 2020 2020 2020 205f 6669 6c65 7320 3d20         _files = 
-00029e40: 5b7b 2270 6174 6822 3a20 222f 726f 6f74  [{"path": "/root
-00029e50: 2f63 6f6e 6669 672e 6967 6e22 2c20 2263  /config.ign", "c
-00029e60: 6f6e 7465 6e74 223a 2066 696e 616c 6461  ontent": finalda
-00029e70: 7461 7d5d 0a20 2020 2020 2020 2020 2020  ta}].           
-00029e80: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00029e90: 6578 6973 7473 2827 6973 6f2e 7368 2729  exists('iso.sh')
-00029ea0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029eb0: 2020 2020 2020 7070 7269 6e74 2822 5573        pprint("Us
-00029ec0: 696e 6720 6c6f 6361 6c20 6973 6f2e 7368  ing local iso.sh
-00029ed0: 2073 6372 6970 7422 290a 2020 2020 2020   script").      
-00029ee0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00029ef0: 6f73 6372 6970 7420 3d20 2769 736f 2e73  oscript = 'iso.s
-00029f00: 6827 0a20 2020 2020 2020 2020 2020 2020  h'.             
-00029f10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00029f20: 2020 2020 2020 2020 2020 2020 2069 736f               iso
-00029f30: 7363 7269 7074 203d 2066 277b 706c 616e  script = f'{plan
-00029f40: 6469 727d 2f69 736f 2e73 6827 0a20 2020  dir}/iso.sh'.   
-00029f50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00029f60: 6f73 2e70 6174 682e 6578 6973 7473 2827  os.path.exists('
-00029f70: 6d61 6373 2e74 7874 2729 3a0a 2020 2020  macs.txt'):.    
+00025330: 2020 2020 2020 2020 6966 2027 6b63 6c69          if 'kcli
+00025340: 2062 6f6f 7420 6669 6e69 7368 6564 2720   boot finished' 
+00025350: 696e 206f 7574 7075 7420 6f72 2027 4967  in output or 'Ig
+00025360: 6e69 7469 6f6e 2066 696e 6973 6865 6420  nition finished 
+00025370: 7375 6363 6573 7366 756c 6c79 2720 696e  successfully' in
+00025380: 206f 7574 7075 7420 6f72 5c0a 2020 2020   output or\.    
+00025390: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000253a0: 4669 6e69 7368 6564 2043 6f6d 6275 7374  Finished Combust
+000253b0: 696f 6e27 2069 6e20 6f75 7470 7574 3a0a  ion' in output:.
+000253c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253d0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+000253e0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+000253f0: 203d 206f 7574 7075 742e 7265 706c 6163   = output.replac
+00025400: 6528 6f6c 646f 7574 7075 742c 2027 2729  e(oldoutput, '')
+00025410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025420: 2069 6620 6e6f 7420 7175 6965 743a 0a20   if not quiet:. 
+00025430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025440: 2020 2070 7269 6e74 286f 7574 7075 7429     print(output)
+00025450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025460: 206f 6c64 6f75 7470 7574 203d 206f 7574   oldoutput = out
+00025470: 7075 740a 2020 2020 2020 2020 2020 2020  put.            
+00025480: 736c 6565 7028 3229 0a20 2020 2020 2020  sleep(2).       
+00025490: 2020 2020 2074 696d 656f 7574 202b 3d20       timeout += 
+000254a0: 320a 2020 2020 2020 2020 2020 2020 6966  2.            if
+000254b0: 2077 6169 7474 696d 656f 7574 203e 2030   waittimeout > 0
+000254c0: 2061 6e64 2074 696d 656f 7574 203e 2077   and timeout > w
+000254d0: 6169 7474 696d 656f 7574 3a0a 2020 2020  aittimeout:.    
+000254e0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+000254f0: 7228 2254 696d 656f 7574 2077 6169 7469  r("Timeout waiti
+00025500: 6e67 2066 6f72 2077 6169 7463 6f6d 6d61  ng for waitcomma
+00025510: 6e64 2074 6f20 6578 6563 7574 652e 2e2e  nd to execute...
+00025520: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00025530: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00025540: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
+00025550: 2020 6465 6620 636c 6561 6e5f 7465 6d70    def clean_temp
+00025560: 6b65 7928 7365 6c66 2c20 6e61 6d65 2c20  key(self, name, 
+00025570: 6964 656e 7469 7479 6669 6c65 3d4e 6f6e  identityfile=Non
+00025580: 6529 3a0a 2020 2020 2020 2020 636d 6420  e):.        cmd 
+00025590: 3d20 2273 6564 202d 6920 272f 7465 6d70  = "sed -i '/temp
+000255a0: 2d6b 636c 692d 6b65 792f 6427 202f 686f  -kcli-key/d' /ho
+000255b0: 6d65 2f2a 2f2e 7373 682f 6175 7468 6f72  me/*/.ssh/author
+000255c0: 697a 6564 5f6b 6579 7320 2f72 6f6f 742f  ized_keys /root/
+000255d0: 2e73 7368 2f61 7574 686f 7269 7a65 645f  .ssh/authorized_
+000255e0: 6b65 7973 220a 2020 2020 2020 2020 6b20  keys".        k 
+000255f0: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
+00025600: 2069 6e66 6f20 3d20 6b2e 696e 666f 286e   info = k.info(n
+00025610: 616d 6529 0a20 2020 2020 2020 2076 6d70  ame).        vmp
+00025620: 6f72 7420 3d20 4e6f 6e65 0a20 2020 2020  ort = None.     
+00025630: 2020 2069 7020 3d20 696e 666f 2e67 6574     ip = info.get
+00025640: 2827 6970 2729 0a20 2020 2020 2020 2069  ('ip').        i
+00025650: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
+00025660: 6b75 6265 7669 7274 273a 0a20 2020 2020  kubevirt':.     
+00025670: 2020 2020 2020 2069 6620 6b2e 6163 6365         if k.acce
+00025680: 7373 5f6d 6f64 6520 3d3d 2027 4e6f 6465  ss_mode == 'Node
+00025690: 506f 7274 273a 0a20 2020 2020 2020 2020  Port':.         
+000256a0: 2020 2020 2020 2076 6d70 6f72 7420 3d20         vmport = 
+000256b0: 696e 666f 2e67 6574 2827 6e6f 6465 706f  info.get('nodepo
+000256c0: 7274 2729 0a20 2020 2020 2020 2020 2020  rt').           
+000256d0: 2020 2020 2069 7020 3d20 6b2e 6e6f 6465       ip = k.node
+000256e0: 5f68 6f73 7428 6e61 6d65 3d69 6e66 6f2e  _host(name=info.
+000256f0: 6765 7428 2768 6f73 7427 2929 0a20 2020  get('host')).   
+00025700: 2020 2020 2020 2020 2065 6c69 6620 6b2e           elif k.
+00025710: 6163 6365 7373 5f6d 6f64 6520 3d3d 2027  access_mode == '
+00025720: 4c6f 6164 4261 6c61 6e63 6572 273a 0a20  LoadBalancer':. 
+00025730: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00025740: 7020 3d20 696e 666f 2e67 6574 2827 6c6f  p = info.get('lo
+00025750: 6164 6261 6c61 6e63 6572 6970 2729 0a20  adbalancerip'). 
+00025760: 2020 2020 2020 2073 7368 636d 6420 3d20         sshcmd = 
+00025770: 636f 6d6d 6f6e 2e73 7368 286e 616d 652c  common.ssh(name,
+00025780: 2075 7365 723d 2772 6f6f 7427 2c20 6970   user='root', ip
+00025790: 3d69 702c 2074 756e 6e65 6c3d 7365 6c66  =ip, tunnel=self
+000257a0: 2e74 756e 6e65 6c2c 2074 756e 6e65 6c68  .tunnel, tunnelh
+000257b0: 6f73 743d 7365 6c66 2e74 756e 6e65 6c68  ost=self.tunnelh
+000257c0: 6f73 742c 2076 6d70 6f72 743d 766d 706f  ost, vmport=vmpo
+000257d0: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+000257e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257f0: 7475 6e6e 656c 706f 7274 3d73 656c 662e  tunnelport=self.
+00025800: 7475 6e6e 656c 706f 7274 2c20 7475 6e6e  tunnelport, tunn
+00025810: 656c 7573 6572 3d73 656c 662e 7475 6e6e  eluser=self.tunn
+00025820: 656c 7573 6572 2c20 696e 7365 6375 7265  eluser, insecure
+00025830: 3d73 656c 662e 696e 7365 6375 7265 2c20  =self.insecure, 
+00025840: 636d 643d 636d 642c 0a20 2020 2020 2020  cmd=cmd,.       
+00025850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025860: 2020 2020 2069 6465 6e74 6974 7966 696c       identityfil
+00025870: 653d 6964 656e 7469 7479 6669 6c65 2c20  e=identityfile, 
+00025880: 7061 7373 776f 7264 3d46 616c 7365 290a  password=False).
+00025890: 2020 2020 2020 2020 6f73 2e70 6f70 656e          os.popen
+000258a0: 2873 7368 636d 6429 2e72 6561 6428 290a  (sshcmd).read().
+000258b0: 0a20 2020 2064 6566 2074 6872 6561 6465  .    def threade
+000258c0: 645f 6372 6561 7465 5f6b 7562 6528 7365  d_create_kube(se
+000258d0: 6c66 2c20 636c 7573 7465 722c 206b 7562  lf, cluster, kub
+000258e0: 6574 7970 652c 206b 7562 655f 6f76 6572  etype, kube_over
+000258f0: 7269 6465 7329 3a0a 2020 2020 2020 2020  rides):.        
+00025900: 6970 706f 6f6c 203d 206b 7562 655f 6f76  ippool = kube_ov
+00025910: 6572 7269 6465 732e 6765 7428 2769 7070  errides.get('ipp
+00025920: 6f6f 6c27 2920 6f72 206b 7562 655f 6f76  ool') or kube_ov
+00025930: 6572 7269 6465 732e 6765 7428 2763 6f6e  errides.get('con
+00025940: 6670 6f6f 6c27 290a 2020 2020 2020 2020  fpool').        
+00025950: 6261 7265 6d65 7461 6c70 6f6f 6c20 3d20  baremetalpool = 
+00025960: 6b75 6265 5f6f 7665 7272 6964 6573 2e67  kube_overrides.g
+00025970: 6574 2827 6970 706f 6f6c 2729 206f 7220  et('ippool') or 
+00025980: 6b75 6265 5f6f 7665 7272 6964 6573 2e67  kube_overrides.g
+00025990: 6574 2827 636f 6e66 706f 6f6c 2729 0a20  et('confpool'). 
+000259a0: 2020 2020 2020 2069 6620 6970 706f 6f6c         if ippool
+000259b0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000259c0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+000259d0: 6574 5f76 6970 5f66 726f 6d5f 636f 6e66  et_vip_from_conf
+000259e0: 706f 6f6c 2863 6c75 7374 6572 2c20 6970  pool(cluster, ip
+000259f0: 706f 6f6c 2c20 6f76 6572 7269 6465 733d  pool, overrides=
+00025a00: 6b75 6265 5f6f 7665 7272 6964 6573 290a  kube_overrides).
+00025a10: 2020 2020 2020 2020 6966 2062 6172 656d          if barem
+00025a20: 6574 616c 706f 6f6c 2069 7320 6e6f 7420  etalpool is not 
+00025a30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00025a40: 2020 7365 6c66 2e67 6574 5f62 6172 656d    self.get_barem
+00025a50: 6574 616c 5f68 6f73 7473 5f66 726f 6d5f  etal_hosts_from_
+00025a60: 636f 6e66 706f 6f6c 2863 6c75 7374 6572  confpool(cluster
+00025a70: 2c20 6261 7265 6d65 7461 6c70 6f6f 6c2c  , baremetalpool,
+00025a80: 206f 7665 7272 6964 6573 3d6b 7562 655f   overrides=kube_
+00025a90: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+00025aa0: 2020 2073 656c 662e 6372 6561 7465 5f6b     self.create_k
+00025ab0: 7562 6528 636c 7573 7465 722c 206b 7562  ube(cluster, kub
+00025ac0: 6574 7970 652c 206b 7562 655f 6f76 6572  etype, kube_over
+00025ad0: 7269 6465 7329 0a0a 2020 2020 6465 6620  rides)..    def 
+00025ae0: 6372 6561 7465 5f6b 7562 6528 7365 6c66  create_kube(self
+00025af0: 2c20 636c 7573 7465 722c 206b 7562 6574  , cluster, kubet
+00025b00: 7970 652c 206f 7665 7272 6964 6573 3d7b  ype, overrides={
+00025b10: 7d29 3a0a 2020 2020 2020 2020 6966 2073  }):.        if s
+00025b20: 656c 662e 7479 7065 203d 3d20 2777 6562  elf.type == 'web
+00025b30: 2720 616e 6420 7365 6c66 2e6b 2e6c 6f63  ' and self.k.loc
+00025b40: 616c 6b75 6265 3a0a 2020 2020 2020 2020  alkube:.        
+00025b50: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00025b60: 6b2e 6372 6561 7465 5f6b 7562 6528 636c  k.create_kube(cl
+00025b70: 7573 7465 722c 206b 7562 6574 7970 652c  uster, kubetype,
+00025b80: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00025b90: 6964 6573 290a 2020 2020 2020 2020 6970  ides).        ip
+00025ba0: 706f 6f6c 203d 206f 7665 7272 6964 6573  pool = overrides
+00025bb0: 2e67 6574 2827 6970 706f 6f6c 2729 206f  .get('ippool') o
+00025bc0: 7220 6f76 6572 7269 6465 732e 6765 7428  r overrides.get(
+00025bd0: 2763 6f6e 6670 6f6f 6c27 290a 2020 2020  'confpool').    
+00025be0: 2020 2020 6261 7265 6d65 7461 6c70 6f6f      baremetalpoo
+00025bf0: 6c20 3d20 6f76 6572 7269 6465 732e 6765  l = overrides.ge
+00025c00: 7428 2769 7070 6f6f 6c27 2920 6f72 206f  t('ippool') or o
+00025c10: 7665 7272 6964 6573 2e67 6574 2827 636f  verrides.get('co
+00025c20: 6e66 706f 6f6c 2729 0a20 2020 2020 2020  nfpool').       
+00025c30: 2069 6620 6970 706f 6f6c 2069 7320 6e6f   if ippool is no
+00025c40: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00025c50: 2020 2020 7365 6c66 2e67 6574 5f76 6970      self.get_vip
+00025c60: 5f66 726f 6d5f 636f 6e66 706f 6f6c 2863  _from_confpool(c
+00025c70: 6c75 7374 6572 2c20 6970 706f 6f6c 2c20  luster, ippool, 
+00025c80: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
+00025c90: 6465 7329 0a20 2020 2020 2020 2069 6620  des).        if 
+00025ca0: 6261 7265 6d65 7461 6c70 6f6f 6c20 6973  baremetalpool is
+00025cb0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00025cc0: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+00025cd0: 6261 7265 6d65 7461 6c5f 686f 7374 735f  baremetal_hosts_
+00025ce0: 6672 6f6d 5f63 6f6e 6670 6f6f 6c28 636c  from_confpool(cl
+00025cf0: 7573 7465 722c 2062 6172 656d 6574 616c  uster, baremetal
+00025d00: 706f 6f6c 2c20 6f76 6572 7269 6465 733d  pool, overrides=
+00025d10: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+00025d20: 2020 2069 6620 6b75 6265 7479 7065 203d     if kubetype =
+00025d30: 3d20 276f 7065 6e73 6869 6674 273a 0a20  = 'openshift':. 
+00025d40: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00025d50: 7420 3d20 7365 6c66 2e63 7265 6174 655f  t = self.create_
+00025d60: 6b75 6265 5f6f 7065 6e73 6869 6674 2863  kube_openshift(c
+00025d70: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00025d80: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
+00025d90: 2020 2020 2065 6c69 6620 6b75 6265 7479       elif kubety
+00025da0: 7065 203d 3d20 2768 7970 6572 7368 6966  pe == 'hypershif
+00025db0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+00025dc0: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
+00025dd0: 6561 7465 5f6b 7562 655f 6879 7065 7273  eate_kube_hypers
+00025de0: 6869 6674 2863 6c75 7374 6572 2c20 6f76  hift(cluster, ov
+00025df0: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
+00025e00: 7329 0a20 2020 2020 2020 2065 6c69 6620  s).        elif 
+00025e10: 6b75 6265 7479 7065 203d 3d20 276d 6963  kubetype == 'mic
+00025e20: 726f 7368 6966 7427 3a0a 2020 2020 2020  roshift':.      
+00025e30: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+00025e40: 656c 662e 6372 6561 7465 5f6b 7562 655f  elf.create_kube_
+00025e50: 6d69 6372 6f73 6869 6674 2863 6c75 7374  microshift(clust
+00025e60: 6572 2c20 6f76 6572 7269 6465 733d 6f76  er, overrides=ov
+00025e70: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00025e80: 2065 6c69 6620 6b75 6265 7479 7065 203d   elif kubetype =
+00025e90: 3d20 276b 3373 273a 0a20 2020 2020 2020  = 'k3s':.       
+00025ea0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
+00025eb0: 6c66 2e63 7265 6174 655f 6b75 6265 5f6b  lf.create_kube_k
+00025ec0: 3373 2863 6c75 7374 6572 2c20 6f76 6572  3s(cluster, over
+00025ed0: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
+00025ee0: 0a20 2020 2020 2020 2065 6c69 6620 6b75  .        elif ku
+00025ef0: 6265 7479 7065 203d 3d20 2767 6b65 273a  betype == 'gke':
+00025f00: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00025f10: 756c 7420 3d20 7365 6c66 2e63 7265 6174  ult = self.creat
+00025f20: 655f 6b75 6265 5f67 6b65 2863 6c75 7374  e_kube_gke(clust
+00025f30: 6572 2c20 6f76 6572 7269 6465 733d 6f76  er, overrides=ov
+00025f40: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00025f50: 2065 6c69 6620 6b75 6265 7479 7065 203d   elif kubetype =
+00025f60: 3d20 2765 6b73 273a 0a20 2020 2020 2020  = 'eks':.       
+00025f70: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
+00025f80: 6c66 2e63 7265 6174 655f 6b75 6265 5f65  lf.create_kube_e
+00025f90: 6b73 2863 6c75 7374 6572 2c20 6f76 6572  ks(cluster, over
+00025fa0: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
+00025fb0: 0a20 2020 2020 2020 2065 6c69 6620 6b75  .        elif ku
+00025fc0: 6265 7479 7065 203d 3d20 2761 6b73 273a  betype == 'aks':
+00025fd0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00025fe0: 756c 7420 3d20 7365 6c66 2e63 7265 6174  ult = self.creat
+00025ff0: 655f 6b75 6265 5f61 6b73 2863 6c75 7374  e_kube_aks(clust
+00026000: 6572 2c20 6f76 6572 7269 6465 733d 6f76  er, overrides=ov
+00026010: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00026020: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00026030: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
+00026040: 2e63 7265 6174 655f 6b75 6265 5f67 656e  .create_kube_gen
+00026050: 6572 6963 2863 6c75 7374 6572 2c20 6f76  eric(cluster, ov
+00026060: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
+00026070: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
+00026080: 6e20 7265 7375 6c74 0a0a 2020 2020 6465  n result..    de
+00026090: 6620 6372 6561 7465 5f6b 7562 655f 616b  f create_kube_ak
+000260a0: 7328 7365 6c66 2c20 636c 7573 7465 722c  s(self, cluster,
+000260b0: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
+000260c0: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
+000260d0: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
+000260e0: 7420 616b 730a 2020 2020 2020 2020 6966  t aks.        if
+000260f0: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
+00026100: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+00026110: 732e 656e 7669 726f 6e5b 2750 4154 4827  s.environ['PATH'
+00026120: 5d20 2b3d 2027 3a2f 776f 726b 6469 7227  ] += ':/workdir'
+00026130: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00026140: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
+00026150: 7669 726f 6e5b 2750 4154 4827 5d20 2b3d  viron['PATH'] +=
+00026160: 2027 3a25 7327 2025 206f 732e 6765 7463   ':%s' % os.getc
+00026170: 7764 2829 0a20 2020 2020 2020 2072 6574  wd().        ret
+00026180: 7572 6e20 616b 732e 6372 6561 7465 2873  urn aks.create(s
+00026190: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+000261a0: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
+000261b0: 6620 6372 6561 7465 5f6b 7562 655f 656b  f create_kube_ek
+000261c0: 7328 7365 6c66 2c20 636c 7573 7465 722c  s(self, cluster,
+000261d0: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
+000261e0: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
+000261f0: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
+00026200: 7420 656b 730a 2020 2020 2020 2020 6966  t eks.        if
+00026210: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
+00026220: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+00026230: 732e 656e 7669 726f 6e5b 2750 4154 4827  s.environ['PATH'
+00026240: 5d20 2b3d 2027 3a2f 776f 726b 6469 7227  ] += ':/workdir'
+00026250: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00026260: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
+00026270: 7669 726f 6e5b 2750 4154 4827 5d20 2b3d  viron['PATH'] +=
+00026280: 2027 3a25 7327 2025 206f 732e 6765 7463   ':%s' % os.getc
+00026290: 7764 2829 0a20 2020 2020 2020 2072 6574  wd().        ret
+000262a0: 7572 6e20 656b 732e 6372 6561 7465 2873  urn eks.create(s
+000262b0: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+000262c0: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
+000262d0: 6620 6372 6561 7465 5f6b 7562 655f 6765  f create_kube_ge
+000262e0: 6e65 7269 6328 7365 6c66 2c20 636c 7573  neric(self, clus
+000262f0: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
+00026300: 7d29 3a0a 2020 2020 2020 2020 6966 2063  }):.        if c
+00026310: 6f6e 7461 696e 6572 5f6d 6f64 6528 293a  ontainer_mode():
+00026320: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+00026330: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
+00026340: 2b3d 2027 3a2f 776f 726b 6469 7227 0a20  += ':/workdir'. 
+00026350: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00026360: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
+00026370: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
+00026380: 3a25 7327 2025 206f 732e 6765 7463 7764  :%s' % os.getcwd
+00026390: 2829 0a20 2020 2020 2020 2070 6c61 6e64  ().        pland
+000263a0: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
+000263b0: 6e61 6d65 286b 7562 6561 646d 2e63 7265  name(kubeadm.cre
+000263c0: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
+000263d0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+000263e0: 2020 7265 7475 726e 206b 7562 6561 646d    return kubeadm
+000263f0: 2e63 7265 6174 6528 7365 6c66 2c20 706c  .create(self, pl
+00026400: 616e 6469 722c 2063 6c75 7374 6572 2c20  andir, cluster, 
+00026410: 6f76 6572 7269 6465 7329 0a0a 2020 2020  overrides)..    
+00026420: 6465 6620 6372 6561 7465 5f6b 7562 655f  def create_kube_
+00026430: 676b 6528 7365 6c66 2c20 636c 7573 7465  gke(self, cluste
+00026440: 722c 206f 7665 7272 6964 6573 3d7b 7d29  r, overrides={})
+00026450: 3a0a 2020 2020 2020 2020 6672 6f6d 206b  :.        from k
+00026460: 7669 7274 2e63 6c75 7374 6572 2069 6d70  virt.cluster imp
+00026470: 6f72 7420 676b 650a 2020 2020 2020 2020  ort gke.        
+00026480: 6966 2063 6f6e 7461 696e 6572 5f6d 6f64  if container_mod
+00026490: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
+000264a0: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
+000264b0: 4827 5d20 2b3d 2027 3a2f 776f 726b 6469  H'] += ':/workdi
+000264c0: 7227 0a20 2020 2020 2020 2065 6c73 653a  r'.        else:
+000264d0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+000264e0: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
+000264f0: 2b3d 2027 3a25 7327 2025 206f 732e 6765  += ':%s' % os.ge
+00026500: 7463 7764 2829 0a20 2020 2020 2020 2072  tcwd().        r
+00026510: 6574 7572 6e20 676b 652e 6372 6561 7465  eturn gke.create
+00026520: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
+00026530: 6f76 6572 7269 6465 7329 0a0a 2020 2020  overrides)..    
+00026540: 6465 6620 6372 6561 7465 5f6b 7562 655f  def create_kube_
+00026550: 6d69 6372 6f73 6869 6674 2873 656c 662c  microshift(self,
+00026560: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
+00026570: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
+00026580: 2069 6620 636f 6e74 6169 6e65 725f 6d6f   if container_mo
+00026590: 6465 2829 3a0a 2020 2020 2020 2020 2020  de():.          
+000265a0: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
+000265b0: 5448 275d 202b 3d20 273a 2f77 6f72 6b64  TH'] += ':/workd
+000265c0: 6972 270a 2020 2020 2020 2020 656c 7365  ir'.        else
+000265d0: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+000265e0: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+000265f0: 202b 3d20 273a 2573 2720 2520 6f73 2e67   += ':%s' % os.g
+00026600: 6574 6377 6428 290a 2020 2020 2020 2020  etcwd().        
+00026610: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
+00026620: 682e 6469 726e 616d 6528 6d69 6372 6f73  h.dirname(micros
+00026630: 6869 6674 2e63 7265 6174 652e 5f5f 636f  hift.create.__co
+00026640: 6465 5f5f 2e63 6f5f 6669 6c65 6e61 6d65  de__.co_filename
+00026650: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00026660: 206d 6963 726f 7368 6966 742e 6372 6561   microshift.crea
+00026670: 7465 2873 656c 662c 2070 6c61 6e64 6972  te(self, plandir
+00026680: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+00026690: 6964 6573 290a 0a20 2020 2064 6566 2063  ides)..    def c
+000266a0: 7265 6174 655f 6b75 6265 5f6b 3373 2873  reate_kube_k3s(s
+000266b0: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+000266c0: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
+000266d0: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
+000266e0: 725f 6d6f 6465 2829 3a0a 2020 2020 2020  r_mode():.      
+000266f0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+00026700: 5b27 5041 5448 275d 202b 3d20 273a 2f77  ['PATH'] += ':/w
+00026710: 6f72 6b64 6972 270a 2020 2020 2020 2020  orkdir'.        
+00026720: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00026730: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
+00026740: 5448 275d 202b 3d20 273a 2573 2720 2520  TH'] += ':%s' % 
+00026750: 6f73 2e67 6574 6377 6428 290a 2020 2020  os.getcwd().    
+00026760: 2020 2020 706c 616e 6469 7220 3d20 6f73      plandir = os
+00026770: 2e70 6174 682e 6469 726e 616d 6528 6b33  .path.dirname(k3
+00026780: 732e 6372 6561 7465 2e5f 5f63 6f64 655f  s.create.__code_
+00026790: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
+000267a0: 2020 2020 2020 2072 6574 7572 6e20 6b33         return k3
+000267b0: 732e 6372 6561 7465 2873 656c 662c 2070  s.create(self, p
+000267c0: 6c61 6e64 6972 2c20 636c 7573 7465 722c  landir, cluster,
+000267d0: 206f 7665 7272 6964 6573 290a 0a20 2020   overrides)..   
+000267e0: 2064 6566 2063 7265 6174 655f 6b75 6265   def create_kube
+000267f0: 5f68 7970 6572 7368 6966 7428 7365 6c66  _hypershift(self
+00026800: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+00026810: 6964 6573 3d7b 7d29 3a0a 2020 2020 2020  ides={}):.      
+00026820: 2020 6966 2063 6f6e 7461 696e 6572 5f6d    if container_m
+00026830: 6f64 6528 293a 0a20 2020 2020 2020 2020  ode():.         
+00026840: 2020 206f 732e 656e 7669 726f 6e5b 2750     os.environ['P
+00026850: 4154 4827 5d20 2b3d 2027 3a2f 776f 726b  ATH'] += ':/work
+00026860: 6469 7227 0a20 2020 2020 2020 2065 6c73  dir'.        els
+00026870: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
+00026880: 732e 656e 7669 726f 6e5b 2750 4154 4827  s.environ['PATH'
+00026890: 5d20 2b3d 2027 3a25 7327 2025 206f 732e  ] += ':%s' % os.
+000268a0: 6765 7463 7764 2829 0a20 2020 2020 2020  getcwd().       
+000268b0: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
+000268c0: 7468 2e64 6972 6e61 6d65 2868 7970 6572  th.dirname(hyper
+000268d0: 7368 6966 742e 6372 6561 7465 2e5f 5f63  shift.create.__c
+000268e0: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
+000268f0: 6529 0a20 2020 2020 2020 2023 2064 6e73  e).        # dns
+00026900: 636c 6965 6e74 203d 206f 7665 7272 6964  client = overrid
+00026910: 6573 2e67 6574 2827 646e 7363 6c69 656e  es.get('dnsclien
+00026920: 7427 290a 2020 2020 2020 2020 2320 646e  t').        # dn
+00026930: 7363 6f6e 6669 6720 3d20 4b63 6f6e 6669  sconfig = Kconfi
+00026940: 6728 636c 6965 6e74 3d64 6e73 636c 6965  g(client=dnsclie
+00026950: 6e74 2920 6966 2064 6e73 636c 6965 6e74  nt) if dnsclient
+00026960: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+00026970: 6520 4e6f 6e65 0a20 2020 2020 2020 2072  e None.        r
+00026980: 6574 7572 6e20 6879 7065 7273 6869 6674  eturn hypershift
+00026990: 2e63 7265 6174 6528 7365 6c66 2c20 706c  .create(self, pl
+000269a0: 616e 6469 722c 2063 6c75 7374 6572 2c20  andir, cluster, 
+000269b0: 6f76 6572 7269 6465 7329 0a0a 2020 2020  overrides)..    
+000269c0: 6465 6620 6372 6561 7465 5f6b 7562 655f  def create_kube_
+000269d0: 6f70 656e 7368 6966 7428 7365 6c66 2c20  openshift(self, 
+000269e0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+000269f0: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
+00026a00: 6966 2063 6f6e 7461 696e 6572 5f6d 6f64  if container_mod
+00026a10: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
+00026a20: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
+00026a30: 4827 5d20 2b3d 2027 3a2f 776f 726b 6469  H'] += ':/workdi
+00026a40: 7227 0a20 2020 2020 2020 2065 6c73 653a  r'.        else:
+00026a50: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+00026a60: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
+00026a70: 2b3d 2027 3a25 7327 2025 206f 732e 6765  += ':%s' % os.ge
+00026a80: 7463 7764 2829 0a20 2020 2020 2020 2070  tcwd().        p
+00026a90: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
+00026aa0: 2e64 6972 6e61 6d65 286f 7065 6e73 6869  .dirname(openshi
+00026ab0: 6674 2e63 7265 6174 652e 5f5f 636f 6465  ft.create.__code
+00026ac0: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
+00026ad0: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
+00026ae0: 7420 3d20 6f76 6572 7269 6465 732e 6765  t = overrides.ge
+00026af0: 7428 2764 6e73 636c 6965 6e74 2729 0a20  t('dnsclient'). 
+00026b00: 2020 2020 2020 2064 6e73 636f 6e66 6967         dnsconfig
+00026b10: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
+00026b20: 743d 646e 7363 6c69 656e 7429 2069 6620  t=dnsclient) if 
+00026b30: 646e 7363 6c69 656e 7420 6973 206e 6f74  dnsclient is not
+00026b40: 204e 6f6e 6520 656c 7365 204e 6f6e 650a   None else None.
+00026b50: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+00026b60: 7065 6e73 6869 6674 2e63 7265 6174 6528  penshift.create(
+00026b70: 7365 6c66 2c20 706c 616e 6469 722c 2063  self, plandir, c
+00026b80: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00026b90: 732c 2064 6e73 636f 6e66 6967 3d64 6e73  s, dnsconfig=dns
+00026ba0: 636f 6e66 6967 290a 0a20 2020 2064 6566  config)..    def
+00026bb0: 2064 656c 6574 655f 6b75 6265 2873 656c   delete_kube(sel
+00026bc0: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
+00026bd0: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
+00026be0: 2020 2068 7970 6572 7368 6966 7420 3d20     hypershift = 
+00026bf0: 6f76 6572 7269 6465 732e 6765 7428 276b  overrides.get('k
+00026c00: 7562 6574 7970 6527 2c20 2778 7878 2729  ubetype', 'xxx')
+00026c10: 203d 3d20 2768 7970 6572 7368 6966 7427   == 'hypershift'
+00026c20: 0a20 2020 2020 2020 2061 7373 6973 7465  .        assiste
+00026c30: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
+00026c40: 2020 616b 7320 3d20 6f76 6572 7269 6465    aks = override
+00026c50: 732e 6765 7428 276b 7562 6574 7970 6527  s.get('kubetype'
+00026c60: 2c20 2778 7878 2729 203d 3d20 2761 6b73  , 'xxx') == 'aks
+00026c70: 270a 2020 2020 2020 2020 656b 7320 3d20  '.        eks = 
+00026c80: 6f76 6572 7269 6465 732e 6765 7428 276b  overrides.get('k
+00026c90: 7562 6574 7970 6527 2c20 2778 7878 2729  ubetype', 'xxx')
+00026ca0: 203d 3d20 2765 6b73 270a 2020 2020 2020   == 'eks'.      
+00026cb0: 2020 676b 6520 3d20 6f76 6572 7269 6465    gke = override
+00026cc0: 732e 6765 7428 276b 7562 6574 7970 6527  s.get('kubetype'
+00026cd0: 2c20 2778 7878 2729 203d 3d20 2767 6b65  , 'xxx') == 'gke
+00026ce0: 270a 2020 2020 2020 2020 646f 6d61 696e  '.        domain
+00026cf0: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+00026d00: 2827 646f 6d61 696e 272c 2027 6b61 726d  ('domain', 'karm
+00026d10: 616c 6162 732e 636f 7270 2729 0a20 2020  alabs.corp').   
+00026d20: 2020 2020 206b 7562 6574 7970 6520 3d20       kubetype = 
+00026d30: 6f76 6572 7269 6465 732e 6765 7428 276b  overrides.get('k
+00026d40: 7562 6574 7970 6527 2c20 2767 656e 6572  ubetype', 'gener
+00026d50: 6963 2729 0a20 2020 2020 2020 2064 6e73  ic').        dns
+00026d60: 636c 6965 6e74 203d 204e 6f6e 650a 2020  client = None.  
+00026d70: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
+00026d80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00026d90: 2e74 7970 6520 3d3d 2027 7765 6227 2061  .type == 'web' a
+00026da0: 6e64 2073 656c 662e 6b2e 6c6f 6361 6c6b  nd self.k.localk
+00026db0: 7562 653a 0a20 2020 2020 2020 2020 2020  ube:.           
+00026dc0: 2072 6574 7572 6e20 6b2e 6465 6c65 7465   return k.delete
+00026dd0: 5f6b 7562 6528 636c 7573 7465 722c 206b  _kube(cluster, k
+00026de0: 7562 6574 7970 652c 206f 7665 7272 6964  ubetype, overrid
+00026df0: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
+00026e00: 2020 2020 2020 636c 7573 7465 7220 3d20        cluster = 
+00026e10: 6f76 6572 7269 6465 732e 6765 7428 2763  overrides.get('c
+00026e20: 6c75 7374 6572 272c 2063 6c75 7374 6572  luster', cluster
+00026e30: 290a 2020 2020 2020 2020 6966 2063 6c75  ).        if clu
+00026e40: 7374 6572 2069 7320 4e6f 6e65 206f 7220  ster is None or 
+00026e50: 636c 7573 7465 7220 3d3d 2027 273a 0a20  cluster == '':. 
+00026e60: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00026e70: 6c74 5f63 6c75 7374 6572 7320 3d20 7b27  lt_clusters = {'
+00026e80: 6765 6e65 7269 6327 3a20 276d 796b 7562  generic': 'mykub
+00026e90: 6527 2c20 2768 7970 6572 7368 6966 7427  e', 'hypershift'
+00026ea0: 3a20 276d 7968 7970 6572 7368 6966 7427  : 'myhypershift'
+00026eb0: 2c20 276f 7065 6e73 6869 6674 273a 2027  , 'openshift': '
+00026ec0: 6d79 6f70 656e 7368 6966 7427 2c0a 2020  myopenshift',.  
+00026ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ee0: 2020 2020 2020 2020 2020 2020 2020 276b                'k
+00026ef0: 3373 273a 2027 6d79 6b33 7327 2c20 276d  3s': 'myk3s', 'm
+00026f00: 6963 726f 7368 6966 7427 3a20 276d 796d  icroshift': 'mym
+00026f10: 6963 726f 7368 6966 7427 2c20 2767 6b65  icroshift', 'gke
+00026f20: 273a 2027 6d79 676b 6527 2c20 2765 6b73  ': 'mygke', 'eks
+00026f30: 273a 2027 6d79 656b 7327 2c0a 2020 2020  ': 'myeks',.    
+00026f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f50: 2020 2020 2020 2020 2020 2020 2761 6b73              'aks
+00026f60: 273a 2027 6d79 616b 7327 7d0a 2020 2020  ': 'myaks'}.    
+00026f70: 2020 2020 2020 2020 636c 7573 7465 7220          cluster 
+00026f80: 3d20 6465 6661 756c 745f 636c 7573 7465  = default_cluste
+00026f90: 7273 5b6b 7562 6574 7970 655d 0a20 2020  rs[kubetype].   
+00026fa0: 2020 2020 2063 6c75 7374 6572 6461 7461       clusterdata
+00026fb0: 203d 207b 7d0a 2020 2020 2020 2020 636c   = {}.        cl
+00026fc0: 7573 7465 7264 6972 203d 206f 732e 7061  usterdir = os.pa
+00026fd0: 7468 2e65 7870 616e 6475 7365 7228 6622  th.expanduser(f"
+00026fe0: 7e2f 2e6b 636c 692f 636c 7573 7465 7273  ~/.kcli/clusters
+00026ff0: 2f7b 636c 7573 7465 727d 2229 0a20 2020  /{cluster}").   
+00027000: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00027010: 6578 6973 7473 2863 6c75 7374 6572 6469  exists(clusterdi
+00027020: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00027030: 7061 7261 6d65 7465 7273 6669 6c65 203d  parametersfile =
+00027040: 2066 227b 636c 7573 7465 7264 6972 7d2f   f"{clusterdir}/
+00027050: 6b63 6c69 5f70 6172 616d 6574 6572 732e  kcli_parameters.
+00027060: 796d 6c22 0a20 2020 2020 2020 2020 2020  yml".           
+00027070: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+00027080: 7473 2870 6172 616d 6574 6572 7366 696c  ts(parametersfil
+00027090: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000270a0: 2020 2020 7769 7468 206f 7065 6e28 7061      with open(pa
+000270b0: 7261 6d65 7465 7273 6669 6c65 2920 6173  rametersfile) as
+000270c0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+000270d0: 2020 2020 2020 2020 636c 7573 7465 7264          clusterd
+000270e0: 6174 6120 3d20 7961 6d6c 2e73 6166 655f  ata = yaml.safe_
+000270f0: 6c6f 6164 2866 290a 2020 2020 2020 2020  load(f).        
+00027100: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+00027110: 7479 7065 203d 2063 6c75 7374 6572 6461  type = clusterda
+00027120: 7461 2e67 6574 2827 6b75 6265 7479 7065  ta.get('kubetype
+00027130: 272c 2027 6765 6e65 7269 6327 290a 2020  ', 'generic').  
+00027140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027150: 2020 6966 206b 7562 6574 7970 6520 3d3d    if kubetype ==
+00027160: 2027 6879 7065 7273 6869 6674 273a 0a20   'hypershift':. 
+00027170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027180: 2020 2020 2020 2068 7970 6572 7368 6966         hypershif
+00027190: 7420 3d20 5472 7565 0a20 2020 2020 2020  t = True.       
+000271a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000271b0: 2061 7373 6973 7465 6420 3d20 636c 7573   assisted = clus
+000271c0: 7465 7264 6174 612e 6765 7428 2761 7373  terdata.get('ass
+000271d0: 6973 7465 6427 2c20 4661 6c73 6529 0a20  isted', False). 
+000271e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000271f0: 2020 2064 6f6d 6169 6e20 3d20 636c 7573     domain = clus
+00027200: 7465 7264 6174 612e 6765 7428 2764 6f6d  terdata.get('dom
+00027210: 6169 6e27 2c20 646f 6d61 696e 290a 2020  ain', domain).  
+00027220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027230: 2020 646e 7363 6c69 656e 7420 3d20 636c    dnsclient = cl
+00027240: 7573 7465 7264 6174 612e 6765 7428 2764  usterdata.get('d
+00027250: 6e73 636c 6965 6e74 2729 0a20 2020 2020  nsclient').     
+00027260: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00027270: 6b65 203d 206b 7562 6574 7970 6520 3d3d  ke = kubetype ==
+00027280: 2027 676b 6527 0a20 2020 2020 2020 2020   'gke'.         
+00027290: 2020 2020 2020 2020 2020 2065 6b73 203d             eks =
+000272a0: 206b 7562 6574 7970 6520 3d3d 2027 656b   kubetype == 'ek
+000272b0: 7327 0a20 2020 2020 2020 2020 2020 2020  s'.             
+000272c0: 2020 2020 2020 2061 6b73 203d 206b 7562         aks = kub
+000272d0: 6574 7970 6520 3d3d 2027 616b 7327 0a20  etype == 'aks'. 
+000272e0: 2020 2020 2020 2064 656c 6574 6563 6c69         deletecli
+000272f0: 656e 7473 203d 207b 7365 6c66 2e63 6c69  ents = {self.cli
+00027300: 656e 743a 206b 7d0a 2020 2020 2020 2020  ent: k}.        
+00027310: 766d 636c 6965 6e74 7320 3d20 5b5d 0a20  vmclients = []. 
+00027320: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
+00027330: 5f66 696c 6520 3d20 6f73 2e70 6174 682e  _file = os.path.
+00027340: 6578 7061 6e64 7573 6572 2866 277e 2f2e  expanduser(f'~/.
+00027350: 6b63 6c69 2f76 6d63 6c69 656e 7473 5f7b  kcli/vmclients_{
+00027360: 636c 7573 7465 727d 2729 0a20 2020 2020  cluster}').     
+00027370: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+00027380: 6973 7473 2876 6d63 6c69 656e 7473 5f66  ists(vmclients_f
+00027390: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+000273a0: 2020 766d 636c 6965 6e74 7320 3d20 7961    vmclients = ya
+000273b0: 6d6c 2e73 6166 655f 6c6f 6164 286f 7065  ml.safe_load(ope
+000273c0: 6e28 766d 636c 6965 6e74 735f 6669 6c65  n(vmclients_file
+000273d0: 2929 0a20 2020 2020 2020 2020 2020 206f  )).            o
+000273e0: 732e 7265 6d6f 7665 2876 6d63 6c69 656e  s.remove(vmclien
+000273f0: 7473 5f66 696c 6529 0a20 2020 2020 2020  ts_file).       
+00027400: 2069 6620 7365 6c66 2e65 7874 7261 636c   if self.extracl
+00027410: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+00027420: 2020 2064 656c 6574 6563 6c69 656e 7473     deleteclients
+00027430: 2e75 7064 6174 6528 7365 6c66 2e65 7874  .update(self.ext
+00027440: 7261 636c 6965 6e74 7329 0a20 2020 2020  raclients).     
+00027450: 2020 2065 6c69 6620 766d 636c 6965 6e74     elif vmclient
+00027460: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
+00027470: 656c 6574 6563 6c69 656e 7473 2e75 7064  eleteclients.upd
+00027480: 6174 6528 7b63 6c69 3a20 4b63 6f6e 6669  ate({cli: Kconfi
+00027490: 6728 636c 6965 6e74 3d63 6c69 292e 6b20  g(client=cli).k 
+000274a0: 666f 7220 636c 6920 696e 2076 6d63 6c69  for cli in vmcli
+000274b0: 656e 7473 2069 6620 636c 6920 213d 2073  ents if cli != s
+000274c0: 656c 662e 636c 6965 6e74 7d29 0a20 2020  elf.client}).   
+000274d0: 2020 2020 2066 6f72 2068 7970 6572 7669       for hypervi
+000274e0: 736f 7220 696e 2064 656c 6574 6563 6c69  sor in deletecli
+000274f0: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
+00027500: 2020 6320 3d20 6465 6c65 7465 636c 6965    c = deleteclie
+00027510: 6e74 735b 6879 7065 7276 6973 6f72 5d0a  nts[hypervisor].
+00027520: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00027530: 766d 2069 6e20 736f 7274 6564 2863 2e6c  vm in sorted(c.l
+00027540: 6973 7428 292c 206b 6579 3d6c 616d 6264  ist(), key=lambd
+00027550: 6120 783a 2078 5b27 6e61 6d65 275d 293a  a x: x['name']):
+00027560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027570: 206e 616d 6520 3d20 766d 5b27 6e61 6d65   name = vm['name
+00027580: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00027590: 2020 2064 6e73 636c 6965 6e74 203d 2076     dnsclient = v
+000275a0: 6d2e 6765 7428 2764 6e73 636c 6965 6e74  m.get('dnsclient
+000275b0: 2729 206f 7220 646e 7363 6c69 656e 740a  ') or dnsclient.
+000275c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000275d0: 6375 7272 656e 7463 6c75 7374 6572 203d  currentcluster =
+000275e0: 2076 6d2e 6765 7428 276b 7562 6527 290a   vm.get('kube').
+000275f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027600: 6b75 6265 7479 7065 203d 2076 6d2e 6765  kubetype = vm.ge
+00027610: 7428 276b 7562 6574 7970 6527 2c20 2767  t('kubetype', 'g
+00027620: 656e 6572 6963 2729 0a20 2020 2020 2020  eneric').       
+00027630: 2020 2020 2020 2020 2069 6620 6375 7272           if curr
+00027640: 656e 7463 6c75 7374 6572 2069 7320 6e6f  entcluster is no
+00027650: 7420 4e6f 6e65 2061 6e64 2063 7572 7265  t None and curre
+00027660: 6e74 636c 7573 7465 7220 3d3d 2063 6c75  ntcluster == clu
+00027670: 7374 6572 3a0a 2020 2020 2020 2020 2020  ster:.          
+00027680: 2020 2020 2020 2020 2020 6966 206b 7562            if kub
+00027690: 6574 7970 6520 3d3d 2027 676b 6527 3a0a  etype == 'gke':.
+000276a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000276b0: 2020 2020 2020 2020 676b 6520 3d20 5472          gke = Tr
+000276c0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+000276d0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+000276e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000276f0: 2020 2020 2065 6c69 6620 6b75 6265 7479       elif kubety
+00027700: 7065 203d 3d20 2765 6b73 273a 0a20 2020  pe == 'eks':.   
+00027710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027720: 2020 2020 2065 6b73 203d 2054 7275 650a       eks = True.
+00027730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027740: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00027750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027760: 2020 656c 6966 206b 7562 6574 7970 6520    elif kubetype 
+00027770: 3d3d 2027 616b 7327 3a0a 2020 2020 2020  == 'aks':.      
+00027780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027790: 2020 616b 7320 3d20 5472 7565 0a20 2020    aks = True.   
+000277a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000277b0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+000277c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000277d0: 2e64 656c 6574 6528 6e61 6d65 2c20 736e  .delete(name, sn
+000277e0: 6170 7368 6f74 733d 5472 7565 290a 2020  apshots=True).  
+000277f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027800: 2020 636f 6d6d 6f6e 2e64 656c 6574 655f    common.delete_
+00027810: 6c61 7374 766d 286e 616d 652c 2073 656c  lastvm(name, sel
+00027820: 662e 636c 6965 6e74 290a 2020 2020 2020  f.client).      
+00027830: 2020 2020 2020 2020 2020 2020 2020 7375                su
+00027840: 6363 6573 7328 6622 7b6e 616d 657d 2064  ccess(f"{name} d
+00027850: 656c 6574 6564 206f 6e20 7b68 7970 6572  eleted on {hyper
+00027860: 7669 736f 727d 2122 290a 2020 2020 2020  visor}!").      
+00027870: 2020 6966 2073 656c 662e 7479 7065 203d    if self.type =
+00027880: 3d20 276b 7562 6576 6972 7427 3a0a 2020  = 'kubevirt':.  
+00027890: 2020 2020 2020 2020 2020 6966 2066 227b            if f"{
+000278a0: 636c 7573 7465 727d 2d61 7069 2220 696e  cluster}-api" in
+000278b0: 206b 2e6c 6973 745f 7365 7276 6963 6573   k.list_services
+000278c0: 286b 2e6e 616d 6573 7061 6365 293a 0a20  (k.namespace):. 
+000278d0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+000278e0: 2e64 656c 6574 655f 7365 7276 6963 6528  .delete_service(
+000278f0: 6622 7b63 6c75 7374 6572 7d2d 6170 6922  f"{cluster}-api"
+00027900: 2c20 6b2e 6e61 6d65 7370 6163 6529 0a20  , k.namespace). 
+00027910: 2020 2020 2020 2020 2020 2069 6620 6622             if f"
+00027920: 7b63 6c75 7374 6572 7d2d 696e 6772 6573  {cluster}-ingres
+00027930: 7322 2069 6e20 6b2e 6c69 7374 5f73 6572  s" in k.list_ser
+00027940: 7669 6365 7328 6b2e 6e61 6d65 7370 6163  vices(k.namespac
+00027950: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00027960: 2020 2020 6b2e 6465 6c65 7465 5f73 6572      k.delete_ser
+00027970: 7669 6365 2866 227b 636c 7573 7465 727d  vice(f"{cluster}
+00027980: 2d69 6e67 7265 7373 222c 206b 2e6e 616d  -ingress", k.nam
+00027990: 6573 7061 6365 290a 2020 2020 2020 2020  espace).        
+000279a0: 6966 2073 656c 662e 7479 7065 2069 6e20  if self.type in 
+000279b0: 5b27 6177 7327 2c20 2761 7a75 7265 272c  ['aws', 'azure',
+000279c0: 2027 6763 7027 2c20 2769 626d 275d 2061   'gcp', 'ibm'] a
+000279d0: 6e64 206e 6f74 2067 6b65 2061 6e64 206e  nd not gke and n
+000279e0: 6f74 2065 6b73 2061 6e64 206e 6f74 2061  ot eks and not a
+000279f0: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+00027a00: 6578 6973 7469 6e67 5f6c 6273 203d 205b  existing_lbs = [
+00027a10: 6c5b 305d 2066 6f72 206c 2069 6e20 7365  l[0] for l in se
+00027a20: 6c66 2e6c 6973 745f 6c6f 6164 6261 6c61  lf.list_loadbala
+00027a30: 6e63 6572 7328 2920 6966 206c 5b30 5d20  ncers() if l[0] 
+00027a40: 696e 205b 6627 6170 692e 7b63 6c75 7374  in [f'api.{clust
+00027a50: 6572 7d27 2c20 6627 6170 7073 2e7b 636c  er}', f'apps.{cl
+00027a60: 7573 7465 727d 275d 5d0a 2020 2020 2020  uster}']].      
+00027a70: 2020 2020 2020 666f 7220 6c62 2069 6e20        for lb in 
+00027a80: 6578 6973 7469 6e67 5f6c 6273 3a0a 2020  existing_lbs:.  
+00027a90: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00027aa0: 6c66 2e64 656c 6574 655f 6c6f 6164 6261  lf.delete_loadba
+00027ab0: 6c61 6e63 6572 286c 622c 2064 6f6d 6169  lancer(lb, domai
+00027ac0: 6e3d 646f 6d61 696e 290a 2020 2020 2020  n=domain).      
+00027ad0: 2020 2020 2020 6275 636b 6574 203d 2066        bucket = f
+00027ae0: 227b 636c 7573 7465 727d 2d7b 646f 6d61  "{cluster}-{doma
+00027af0: 696e 7d22 0a20 2020 2020 2020 2020 2020  in}".           
+00027b00: 2069 6620 6275 636b 6574 2069 6e20 7365   if bucket in se
+00027b10: 6c66 2e6b 2e6c 6973 745f 6275 636b 6574  lf.k.list_bucket
+00027b20: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00027b30: 2020 2020 2070 7072 696e 7428 6622 4465       pprint(f"De
+00027b40: 6c65 7469 6e67 2062 7563 6b65 7420 7b62  leting bucket {b
+00027b50: 7563 6b65 747d 2229 0a20 2020 2020 2020  ucket}").       
+00027b60: 2020 2020 2020 2020 206b 2e64 656c 6574           k.delet
+00027b70: 655f 6275 636b 6574 2862 7563 6b65 7429  e_bucket(bucket)
+00027b80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00027b90: 7365 6c66 2e74 7970 6520 3d3d 2027 6177  self.type == 'aw
+00027ba0: 7327 2061 6e64 2063 6c75 7374 6572 2069  s' and cluster i
+00027bb0: 6e20 6b2e 6c69 7374 5f69 6e73 7461 6e63  n k.list_instanc
+00027bc0: 655f 7072 6f66 696c 6573 2829 3a0a 2020  e_profiles():.  
+00027bd0: 2020 2020 2020 2020 2020 2020 2020 6961                ia
+00027be0: 6d5f 726f 6c65 203d 2063 6c75 7374 6572  m_role = cluster
+00027bf0: 6461 7461 2e67 6574 2827 726f 6c65 272c  data.get('role',
+00027c00: 2063 6c75 7374 6572 290a 2020 2020 2020   cluster).      
+00027c10: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00027c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c30: 2020 206b 2e64 656c 6574 655f 696e 7374     k.delete_inst
+00027c40: 616e 6365 5f70 726f 6669 6c65 2863 6c75  ance_profile(clu
+00027c50: 7374 6572 2c20 6961 6d5f 726f 6c65 290a  ster, iam_role).
+00027c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c70: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00027c80: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00027c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027ca0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00027cb0: 2020 2020 2020 2020 2020 6b2e 6465 6c65            k.dele
+00027cc0: 7465 5f72 6f6c 6528 6961 6d5f 726f 6c65  te_role(iam_role
+00027cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00027ce0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+00027cf0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00027d00: 7373 0a20 2020 2020 2020 2065 6c69 6620  ss.        elif 
+00027d10: 646e 7363 6c69 656e 7420 6973 206e 6f74  dnsclient is not
+00027d20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00027d30: 2020 207a 203d 204b 636f 6e66 6967 2863     z = Kconfig(c
+00027d40: 6c69 656e 743d 646e 7363 6c69 656e 7429  lient=dnsclient)
+00027d50: 2e6b 0a20 2020 2020 2020 2020 2020 207a  .k.            z
+00027d60: 2e64 656c 6574 655f 646e 7328 6622 6170  .delete_dns(f"ap
+00027d70: 692e 7b63 6c75 7374 6572 7d22 2c20 646f  i.{cluster}", do
+00027d80: 6d61 696e 290a 2020 2020 2020 2020 2020  main).          
+00027d90: 2020 7a2e 6465 6c65 7465 5f64 6e73 2866    z.delete_dns(f
+00027da0: 2261 7070 732e 7b63 6c75 7374 6572 7d22  "apps.{cluster}"
+00027db0: 2c20 646f 6d61 696e 290a 2020 2020 2020  , domain).      
+00027dc0: 2020 6966 2068 7970 6572 7368 6966 743a    if hypershift:
+00027dd0: 0a20 2020 2020 2020 2020 2020 206b 7562  .            kub
+00027de0: 6563 6f6e 6669 676d 676d 7420 3d20 6622  econfigmgmt = f"
+00027df0: 7b63 6c75 7374 6572 6469 727d 2f6b 7562  {clusterdir}/kub
+00027e00: 6563 6f6e 6669 672e 6d67 6d74 220a 2020  econfig.mgmt".  
+00027e10: 2020 2020 2020 2020 2020 6361 6c6c 2866            call(f
+00027e20: 274b 5542 4543 4f4e 4649 473d 7b6b 7562  'KUBECONFIG={kub
+00027e30: 6563 6f6e 6669 676d 676d 747d 206f 6320  econfigmgmt} oc 
+00027e40: 6465 6c65 7465 202d 6620 7b63 6c75 7374  delete -f {clust
+00027e50: 6572 6469 727d 2f61 7574 6f61 7070 726f  erdir}/autoappro
+00027e60: 7665 7263 726f 6e2e 796d 6c27 2c20 7368  vercron.yml', sh
+00027e70: 656c 6c3d 5472 7565 290a 2020 2020 2020  ell=True).      
+00027e80: 2020 2020 2020 6361 6c6c 2866 274b 5542        call(f'KUB
+00027e90: 4543 4f4e 4649 473d 7b6b 7562 6563 6f6e  ECONFIG={kubecon
+00027ea0: 6669 676d 676d 747d 206f 6320 6465 6c65  figmgmt} oc dele
+00027eb0: 7465 202d 6620 7b63 6c75 7374 6572 6469  te -f {clusterdi
+00027ec0: 727d 2f6e 6f64 6570 6f6f 6c2e 7961 6d6c  r}/nodepool.yaml
+00027ed0: 272c 2073 6865 6c6c 3d54 7275 6529 0a20  ', shell=True). 
+00027ee0: 2020 2020 2020 2020 2020 2063 616c 6c28             call(
+00027ef0: 6627 4b55 4245 434f 4e46 4947 3d7b 6b75  f'KUBECONFIG={ku
+00027f00: 6265 636f 6e66 6967 6d67 6d74 7d20 6f63  beconfigmgmt} oc
+00027f10: 2064 656c 6574 6520 2d66 207b 636c 7573   delete -f {clus
+00027f20: 7465 7264 6972 7d2f 686f 7374 6564 636c  terdir}/hostedcl
+00027f30: 7573 7465 722e 7961 6d6c 272c 2073 6865  uster.yaml', she
+00027f40: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00027f50: 2020 2020 2069 6620 6e6f 7420 6173 7369       if not assi
+00027f60: 7374 6564 2061 6e64 2028 2762 6172 656d  sted and ('barem
+00027f70: 6574 616c 5f69 736f 2720 696e 2063 6c75  etal_iso' in clu
+00027f80: 7374 6572 6461 7461 206f 7220 2762 6172  sterdata or 'bar
+00027f90: 656d 6574 616c 5f68 6f73 7473 2720 696e  emetal_hosts' in
+00027fa0: 2063 6c75 7374 6572 6461 7461 293a 0a20   clusterdata):. 
+00027fb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00027fc0: 616c 6c28 6627 4b55 4245 434f 4e46 4947  all(f'KUBECONFIG
+00027fd0: 3d7b 6b75 6265 636f 6e66 6967 6d67 6d74  ={kubeconfigmgmt
+00027fe0: 7d20 6f63 202d 6e20 6465 6661 756c 7420  } oc -n default 
+00027ff0: 6465 6c65 7465 2061 6c6c 202d 6c20 6170  delete all -l ap
+00028000: 703d 6874 7470 642d 6b63 6c69 272c 2073  p=httpd-kcli', s
+00028010: 6865 6c6c 3d54 7275 6529 0a20 2020 2020  hell=True).     
+00028020: 2020 2020 2020 2020 2020 2063 616c 6c28             call(
+00028030: 6627 4b55 4245 434f 4e46 4947 3d7b 6b75  f'KUBECONFIG={ku
+00028040: 6265 636f 6e66 6967 6d67 6d74 7d20 6f63  beconfigmgmt} oc
+00028050: 202d 6e20 6465 6661 756c 7420 6465 6c65   -n default dele
+00028060: 7465 2070 7663 2068 7474 7064 2d6b 636c  te pvc httpd-kcl
+00028070: 692d 7076 6327 2c20 7368 656c 6c3d 5472  i-pvc', shell=Tr
+00028080: 7565 290a 2020 2020 2020 2020 6966 2067  ue).        if g
+00028090: 6b65 3a0a 2020 2020 2020 2020 2020 2020  ke:.            
+000280a0: 6763 7063 6c69 656e 7420 3d20 4e6f 6e65  gcpclient = None
+000280b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000280c0: 2763 6c69 656e 7427 2069 6e20 636c 7573  'client' in clus
+000280d0: 7465 7264 6174 613a 0a20 2020 2020 2020  terdata:.       
+000280e0: 2020 2020 2020 2020 2067 6370 636c 6965           gcpclie
+000280f0: 6e74 203d 2063 6c75 7374 6572 6461 7461  nt = clusterdata
+00028100: 5b27 636c 6965 6e74 275d 0a20 2020 2020  ['client'].     
+00028110: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00028120: 2e74 7970 6520 3d3d 2027 6763 7027 3a0a  .type == 'gcp':.
+00028130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028140: 6763 7063 6c69 656e 7420 3d20 7365 6c66  gcpclient = self
+00028150: 2e63 6c69 656e 740a 2020 2020 2020 2020  .client.        
+00028160: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00028170: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
+00028180: 2244 656c 6574 696e 6720 676b 6520 636c  "Deleting gke cl
+00028190: 7573 7465 7220 7265 7175 6972 6573 2074  uster requires t
+000281a0: 6f20 696e 7374 616e 7469 6174 6520 6763  o instantiate gc
+000281b0: 7020 7072 6f76 6964 6572 220a 2020 2020  p provider".    
+000281c0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+000281d0: 7228 6d73 6729 0a20 2020 2020 2020 2020  r(msg).         
+000281e0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+000281f0: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+00028200: 6527 2c20 2772 6561 736f 6e27 3a20 6d73  e', 'reason': ms
+00028210: 677d 0a20 2020 2020 2020 2020 2020 2066  g}.            f
+00028220: 726f 6d20 6b76 6972 742e 636c 7573 7465  rom kvirt.cluste
+00028230: 7220 696d 706f 7274 2067 6b65 0a20 2020  r import gke.   
+00028240: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00028250: 636f 6e66 6967 203d 204b 636f 6e66 6967  config = Kconfig
+00028260: 2863 6c69 656e 743d 6763 7063 6c69 656e  (client=gcpclien
+00028270: 7429 2e6b 2069 6620 6763 7063 6c69 656e  t).k if gcpclien
+00028280: 7420 213d 2073 656c 662e 636c 6965 6e74  t != self.client
+00028290: 2065 6c73 6520 7365 6c66 0a20 2020 2020   else self.     
+000282a0: 2020 2020 2020 207a 6f6e 616c 203d 2063         zonal = c
+000282b0: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
+000282c0: 7a6f 6e61 6c27 2c20 5472 7565 290a 2020  zonal', True).  
+000282d0: 2020 2020 2020 2020 2020 676b 652e 6465            gke.de
+000282e0: 6c65 7465 2863 7572 7265 6e74 636f 6e66  lete(currentconf
+000282f0: 6967 2c20 636c 7573 7465 722c 207a 6f6e  ig, cluster, zon
+00028300: 616c 290a 2020 2020 2020 2020 656c 6966  al).        elif
+00028310: 2065 6b73 3a0a 2020 2020 2020 2020 2020   eks:.          
+00028320: 2020 656b 7363 6c69 656e 7420 3d20 4e6f    eksclient = No
+00028330: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
+00028340: 6620 2763 6c69 656e 7427 2069 6e20 636c  f 'client' in cl
+00028350: 7573 7465 7264 6174 613a 0a20 2020 2020  usterdata:.     
+00028360: 2020 2020 2020 2020 2020 2065 6b73 636c             ekscl
+00028370: 6965 6e74 203d 2063 6c75 7374 6572 6461  ient = clusterda
+00028380: 7461 5b27 636c 6965 6e74 275d 0a20 2020  ta['client'].   
+00028390: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
+000283a0: 6c66 2e74 7970 6520 3d3d 2027 6177 7327  lf.type == 'aws'
+000283b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000283c0: 2020 656b 7363 6c69 656e 7420 3d20 7365    eksclient = se
+000283d0: 6c66 2e63 6c69 656e 740a 2020 2020 2020  lf.client.      
+000283e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000283f0: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
+00028400: 3d20 2244 656c 6574 696e 6720 656b 7320  = "Deleting eks 
+00028410: 636c 7573 7465 7220 7265 7175 6972 6573  cluster requires
+00028420: 2074 6f20 696e 7374 616e 7469 6174 6520   to instantiate 
+00028430: 6177 7320 7072 6f76 6964 6572 220a 2020  aws provider".  
+00028440: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00028450: 726f 7228 6d73 6729 0a20 2020 2020 2020  ror(msg).       
+00028460: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00028470: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
+00028480: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
+00028490: 6d73 677d 0a20 2020 2020 2020 2020 2020  msg}.           
+000284a0: 2066 726f 6d20 6b76 6972 742e 636c 7573   from kvirt.clus
+000284b0: 7465 7220 696d 706f 7274 2065 6b73 0a20  ter import eks. 
+000284c0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+000284d0: 6e74 636f 6e66 6967 203d 204b 636f 6e66  ntconfig = Kconf
+000284e0: 6967 2863 6c69 656e 743d 656b 7363 6c69  ig(client=ekscli
+000284f0: 656e 7429 2e6b 2069 6620 656b 7363 6c69  ent).k if ekscli
+00028500: 656e 7420 213d 2073 656c 662e 636c 6965  ent != self.clie
+00028510: 6e74 2065 6c73 6520 7365 6c66 0a20 2020  nt else self.   
+00028520: 2020 2020 2020 2020 2065 6b73 2e64 656c           eks.del
+00028530: 6574 6528 6375 7272 656e 7463 6f6e 6669  ete(currentconfi
+00028540: 672c 2063 6c75 7374 6572 290a 2020 2020  g, cluster).    
+00028550: 2020 2020 656c 6966 2061 6b73 3a0a 2020      elif aks:.  
+00028560: 2020 2020 2020 2020 2020 616b 7363 6c69            akscli
+00028570: 656e 7420 3d20 4e6f 6e65 0a20 2020 2020  ent = None.     
+00028580: 2020 2020 2020 2069 6620 2763 6c69 656e         if 'clien
+00028590: 7427 2069 6e20 636c 7573 7465 7264 6174  t' in clusterdat
+000285a0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+000285b0: 2020 2061 6b73 636c 6965 6e74 203d 2063     aksclient = c
+000285c0: 6c75 7374 6572 6461 7461 5b27 636c 6965  lusterdata['clie
+000285d0: 6e74 275d 0a20 2020 2020 2020 2020 2020  nt'].           
+000285e0: 2065 6c69 6620 7365 6c66 2e74 7970 6520   elif self.type 
+000285f0: 3d3d 2027 617a 7572 6527 3a0a 2020 2020  == 'azure':.    
+00028600: 2020 2020 2020 2020 2020 2020 616b 7363              aksc
+00028610: 6c69 656e 7420 3d20 7365 6c66 2e63 6c69  lient = self.cli
+00028620: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00028630: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00028640: 2020 2020 2020 6d73 6720 3d20 2244 656c        msg = "Del
+00028650: 6574 696e 6720 616b 7320 636c 7573 7465  eting aks cluste
+00028660: 7220 7265 7175 6972 6573 2074 6f20 696e  r requires to in
+00028670: 7374 616e 7469 6174 6520 617a 7572 6520  stantiate azure 
+00028680: 7072 6f76 6964 6572 220a 2020 2020 2020  provider".      
+00028690: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+000286a0: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
+000286b0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+000286c0: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+000286d0: 2c20 2772 6561 736f 6e27 3a20 6d73 677d  , 'reason': msg}
+000286e0: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+000286f0: 6d20 6b76 6972 742e 636c 7573 7465 7220  m kvirt.cluster 
+00028700: 696d 706f 7274 2061 6b73 0a20 2020 2020  import aks.     
+00028710: 2020 2020 2020 2063 7572 7265 6e74 636f         currentco
+00028720: 6e66 6967 203d 204b 636f 6e66 6967 2863  nfig = Kconfig(c
+00028730: 6c69 656e 743d 616b 7363 6c69 656e 7429  lient=aksclient)
+00028740: 2e6b 2069 6620 616b 7363 6c69 656e 7420  .k if aksclient 
+00028750: 213d 2073 656c 662e 636c 6965 6e74 2065  != self.client e
+00028760: 6c73 6520 7365 6c66 0a20 2020 2020 2020  lse self.       
+00028770: 2020 2020 2061 6b73 2e64 656c 6574 6528       aks.delete(
+00028780: 6375 7272 656e 7463 6f6e 6669 672c 2063  currentconfig, c
+00028790: 6c75 7374 6572 290a 2020 2020 2020 2020  luster).        
+000287a0: 666f 7220 636f 6e66 706f 6f6c 2069 6e20  for confpool in 
+000287b0: 7365 6c66 2e63 6f6e 6670 6f6f 6c73 3a0a  self.confpools:.
+000287c0: 2020 2020 2020 2020 2020 2020 6970 5f72              ip_r
+000287d0: 6573 6572 7661 7469 6f6e 7320 3d20 7365  eservations = se
+000287e0: 6c66 2e63 6f6e 6670 6f6f 6c73 5b63 6f6e  lf.confpools[con
+000287f0: 6670 6f6f 6c5d 2e67 6574 2827 6970 5f72  fpool].get('ip_r
+00028800: 6573 6572 7661 7469 6f6e 7327 2c20 7b7d  eservations', {}
+00028810: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00028820: 2063 6c75 7374 6572 2069 6e20 6970 5f72   cluster in ip_r
+00028830: 6573 6572 7661 7469 6f6e 733a 0a20 2020  eservations:.   
+00028840: 2020 2020 2020 2020 2020 2020 2064 656c               del
+00028850: 2069 705f 7265 7365 7276 6174 696f 6e73   ip_reservations
+00028860: 5b63 6c75 7374 6572 5d0a 2020 2020 2020  [cluster].      
+00028870: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
+00028880: 7064 6174 655f 636f 6e66 706f 6f6c 2863  pdate_confpool(c
+00028890: 6f6e 6670 6f6f 6c2c 207b 2769 705f 7265  onfpool, {'ip_re
+000288a0: 7365 7276 6174 696f 6e73 273a 2069 705f  servations': ip_
+000288b0: 7265 7365 7276 6174 696f 6e73 7d29 0a20  reservations}). 
+000288c0: 2020 2020 2020 2020 2020 206e 616d 655f             name_
+000288d0: 7265 7365 7276 6174 696f 6e73 203d 2073  reservations = s
+000288e0: 656c 662e 636f 6e66 706f 6f6c 735b 636f  elf.confpools[co
+000288f0: 6e66 706f 6f6c 5d2e 6765 7428 276e 616d  nfpool].get('nam
+00028900: 655f 7265 7365 7276 6174 696f 6e73 272c  e_reservations',
+00028910: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
+00028920: 2069 6620 636c 7573 7465 7220 696e 206e   if cluster in n
+00028930: 616d 655f 7265 7365 7276 6174 696f 6e73  ame_reservations
+00028940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00028950: 2020 6e61 6d65 5f72 6573 6572 7661 7469    name_reservati
+00028960: 6f6e 732e 7265 6d6f 7665 2863 6c75 7374  ons.remove(clust
+00028970: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+00028980: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+00028990: 636f 6e66 706f 6f6c 2863 6f6e 6670 6f6f  confpool(confpoo
+000289a0: 6c2c 207b 276e 616d 655f 7265 7365 7276  l, {'name_reserv
+000289b0: 6174 696f 6e73 273a 206e 616d 655f 7265  ations': name_re
+000289c0: 7365 7276 6174 696f 6e73 7d29 0a20 2020  servations}).   
+000289d0: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
+000289e0: 5f62 6172 656d 6574 616c 5f72 6573 6572  _baremetal_reser
+000289f0: 7661 7469 6f6e 7320 3d20 7365 6c66 2e63  vations = self.c
+00028a00: 6f6e 6670 6f6f 6c73 5b63 6f6e 6670 6f6f  onfpools[confpoo
+00028a10: 6c5d 2e67 6574 2827 636c 7573 7465 725f  l].get('cluster_
+00028a20: 6261 7265 6d65 7461 6c5f 7265 7365 7276  baremetal_reserv
+00028a30: 6174 696f 6e73 272c 207b 7d29 0a20 2020  ations', {}).   
+00028a40: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
+00028a50: 7465 7220 696e 2063 6c75 7374 6572 5f62  ter in cluster_b
+00028a60: 6172 656d 6574 616c 5f72 6573 6572 7661  aremetal_reserva
+00028a70: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
+00028a80: 2020 2020 2020 2064 656c 2063 6c75 7374         del clust
+00028a90: 6572 5f62 6172 656d 6574 616c 5f72 6573  er_baremetal_res
+00028aa0: 6572 7661 7469 6f6e 735b 636c 7573 7465  ervations[cluste
+00028ab0: 725d 0a20 2020 2020 2020 2020 2020 2020  r].             
+00028ac0: 2020 2073 656c 662e 7570 6461 7465 5f63     self.update_c
+00028ad0: 6f6e 6670 6f6f 6c28 636f 6e66 706f 6f6c  onfpool(confpool
+00028ae0: 2c20 7b27 636c 7573 7465 725f 6261 7265  , {'cluster_bare
+00028af0: 6d65 7461 6c5f 7265 7365 7276 6174 696f  metal_reservatio
+00028b00: 6e73 273a 2063 6c75 7374 6572 5f62 6172  ns': cluster_bar
+00028b10: 656d 6574 616c 5f72 6573 6572 7661 7469  emetal_reservati
+00028b20: 6f6e 737d 290a 2020 2020 2020 2020 6966  ons}).        if
+00028b30: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00028b40: 636c 7573 7465 7264 6972 293a 0a20 2020  clusterdir):.   
+00028b50: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00028b60: 6622 4465 6c65 7469 6e67 2064 6972 6563  f"Deleting direc
+00028b70: 746f 7279 207b 636c 7573 7465 7264 6972  tory {clusterdir
+00028b80: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00028b90: 726d 7472 6565 2863 6c75 7374 6572 6469  rmtree(clusterdi
+00028ba0: 7229 0a20 2020 2020 2020 2072 6574 7572  r).        retur
+00028bb0: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
+00028bc0: 6363 6573 7327 7d0a 0a20 2020 2064 6566  ccess'}..    def
+00028bd0: 2073 6361 6c65 5f6b 7562 6528 7365 6c66   scale_kube(self
+00028be0: 2c20 636c 7573 7465 722c 206b 7562 6574  , cluster, kubet
+00028bf0: 7970 652c 206f 7665 7272 6964 6573 3d7b  ype, overrides={
+00028c00: 7d29 3a0a 2020 2020 2020 2020 6966 206b  }):.        if k
+00028c10: 7562 6574 7970 6520 3d3d 2027 6765 6e65  ubetype == 'gene
+00028c20: 7269 6327 3a0a 2020 2020 2020 2020 2020  ric':.          
+00028c30: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
+00028c40: 7363 616c 655f 6b75 6265 5f67 656e 6572  scale_kube_gener
+00028c50: 6963 2863 6c75 7374 6572 2c20 6f76 6572  ic(cluster, over
+00028c60: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
+00028c70: 0a20 2020 2020 2020 2065 6c69 6620 6b75  .        elif ku
+00028c80: 6265 7479 7065 203d 3d20 276b 3373 273a  betype == 'k3s':
+00028c90: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00028ca0: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
+00028cb0: 5f6b 7562 655f 6b33 7328 636c 7573 7465  _kube_k3s(cluste
+00028cc0: 722c 206f 7665 7272 6964 6573 3d6f 7665  r, overrides=ove
+00028cd0: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
+00028ce0: 656c 6966 206b 7562 6574 7970 6520 3d3d  elif kubetype ==
+00028cf0: 2027 6f70 656e 7368 6966 7427 3a0a 2020   'openshift':.  
+00028d00: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00028d10: 203d 2073 656c 662e 7363 616c 655f 6b75   = self.scale_ku
+00028d20: 6265 5f6f 7065 6e73 6869 6674 2863 6c75  be_openshift(clu
+00028d30: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+00028d40: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+00028d50: 2020 2065 6c69 6620 6b75 6265 7479 7065     elif kubetype
+00028d60: 203d 3d20 2768 7970 6572 7368 6966 7427   == 'hypershift'
+00028d70: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00028d80: 7375 6c74 203d 2073 656c 662e 7363 616c  sult = self.scal
+00028d90: 655f 6b75 6265 5f68 7970 6572 7368 6966  e_kube_hypershif
+00028da0: 7428 636c 7573 7465 722c 206f 7665 7272  t(cluster, overr
+00028db0: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+00028dc0: 2020 2020 2020 2020 656c 6966 206b 7562          elif kub
+00028dd0: 6574 7970 6520 3d3d 2027 676b 6527 3a0a  etype == 'gke':.
+00028de0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00028df0: 6c74 203d 2073 656c 662e 7363 616c 655f  lt = self.scale_
+00028e00: 6b75 6265 5f67 6b65 2863 6c75 7374 6572  kube_gke(cluster
+00028e10: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+00028e20: 7269 6465 7329 0a20 2020 2020 2020 2065  rides).        e
+00028e30: 6c69 6620 6b75 6265 7479 7065 203d 3d20  lif kubetype == 
+00028e40: 2765 6b73 273a 0a20 2020 2020 2020 2020  'eks':.         
+00028e50: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
+00028e60: 2e73 6361 6c65 5f6b 7562 655f 656b 7328  .scale_kube_eks(
+00028e70: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+00028e80: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
+00028e90: 2020 2020 2020 656c 6966 206b 7562 6574        elif kubet
+00028ea0: 7970 6520 3d3d 2027 616b 7327 3a0a 2020  ype == 'aks':.  
+00028eb0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00028ec0: 203d 2073 656c 662e 7363 616c 655f 6b75   = self.scale_ku
+00028ed0: 6265 5f61 6b73 2863 6c75 7374 6572 2c20  be_aks(cluster, 
+00028ee0: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
+00028ef0: 6465 7329 0a20 2020 2020 2020 2072 6574  des).        ret
+00028f00: 7572 6e20 7265 7375 6c74 0a0a 2020 2020  urn result..    
+00028f10: 6465 6620 7363 616c 655f 6b75 6265 5f61  def scale_kube_a
+00028f20: 6b73 2873 656c 662c 2063 6c75 7374 6572  ks(self, cluster
+00028f30: 2c20 6f76 6572 7269 6465 733d 7b7d 293a  , overrides={}):
+00028f40: 0a20 2020 2020 2020 2066 726f 6d20 6b76  .        from kv
+00028f50: 6972 742e 636c 7573 7465 7220 696d 706f  irt.cluster impo
+00028f60: 7274 2061 6b73 0a20 2020 2020 2020 2072  rt aks.        r
+00028f70: 6574 7572 6e20 616b 732e 7363 616c 6528  eturn aks.scale(
+00028f80: 7365 6c66 2c20 636c 7573 7465 722c 206f  self, cluster, o
+00028f90: 7665 7272 6964 6573 290a 0a20 2020 2064  verrides)..    d
+00028fa0: 6566 2073 6361 6c65 5f6b 7562 655f 656b  ef scale_kube_ek
+00028fb0: 7328 7365 6c66 2c20 636c 7573 7465 722c  s(self, cluster,
+00028fc0: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
+00028fd0: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
+00028fe0: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
+00028ff0: 7420 656b 730a 2020 2020 2020 2020 7265  t eks.        re
+00029000: 7475 726e 2065 6b73 2e73 6361 6c65 2873  turn eks.scale(s
+00029010: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+00029020: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
+00029030: 6620 7363 616c 655f 6b75 6265 5f67 656e  f scale_kube_gen
+00029040: 6572 6963 2873 656c 662c 2063 6c75 7374  eric(self, clust
+00029050: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
+00029060: 293a 0a20 2020 2020 2020 2070 6c61 6e64  ):.        pland
+00029070: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
+00029080: 6e61 6d65 286b 7562 6561 646d 2e63 7265  name(kubeadm.cre
+00029090: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
+000290a0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+000290b0: 2020 7265 7475 726e 206b 7562 6561 646d    return kubeadm
+000290c0: 2e73 6361 6c65 2873 656c 662c 2070 6c61  .scale(self, pla
+000290d0: 6e64 6972 2c20 636c 7573 7465 722c 206f  ndir, cluster, o
+000290e0: 7665 7272 6964 6573 290a 0a20 2020 2064  verrides)..    d
+000290f0: 6566 2073 6361 6c65 5f6b 7562 655f 676b  ef scale_kube_gk
+00029100: 6528 7365 6c66 2c20 636c 7573 7465 722c  e(self, cluster,
+00029110: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
+00029120: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
+00029130: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
+00029140: 7420 676b 650a 2020 2020 2020 2020 7265  t gke.        re
+00029150: 7475 726e 2067 6b65 2e73 6361 6c65 2873  turn gke.scale(s
+00029160: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+00029170: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
+00029180: 6620 7363 616c 655f 6b75 6265 5f68 7970  f scale_kube_hyp
+00029190: 6572 7368 6966 7428 7365 6c66 2c20 636c  ershift(self, cl
+000291a0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+000291b0: 3d7b 7d29 3a0a 2020 2020 2020 2020 706c  ={}):.        pl
+000291c0: 616e 6469 7220 3d20 6f73 2e70 6174 682e  andir = os.path.
+000291d0: 6469 726e 616d 6528 6879 7065 7273 6869  dirname(hypershi
+000291e0: 6674 2e63 7265 6174 652e 5f5f 636f 6465  ft.create.__code
+000291f0: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
+00029200: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+00029210: 7970 6572 7368 6966 742e 7363 616c 6528  ypershift.scale(
+00029220: 7365 6c66 2c20 706c 616e 6469 722c 2063  self, plandir, c
+00029230: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00029240: 7329 0a0a 2020 2020 6465 6620 7363 616c  s)..    def scal
+00029250: 655f 6b75 6265 5f6b 3373 2873 656c 662c  e_kube_k3s(self,
+00029260: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
+00029270: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
+00029280: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
+00029290: 7468 2e64 6972 6e61 6d65 286b 3373 2e63  th.dirname(k3s.c
+000292a0: 7265 6174 652e 5f5f 636f 6465 5f5f 2e63  reate.__code__.c
+000292b0: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
+000292c0: 2020 2020 7265 7475 726e 206b 3373 2e73      return k3s.s
+000292d0: 6361 6c65 2873 656c 662c 2070 6c61 6e64  cale(self, pland
+000292e0: 6972 2c20 636c 7573 7465 722c 206f 7665  ir, cluster, ove
+000292f0: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
+00029300: 2073 6361 6c65 5f6b 7562 655f 6f70 656e   scale_kube_open
+00029310: 7368 6966 7428 7365 6c66 2c20 636c 7573  shift(self, clus
+00029320: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
+00029330: 7d29 3a0a 2020 2020 2020 2020 706c 616e  }):.        plan
+00029340: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+00029350: 726e 616d 6528 6f70 656e 7368 6966 742e  rname(openshift.
+00029360: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
+00029370: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
+00029380: 2020 2020 2072 6574 7572 6e20 6f70 656e       return open
+00029390: 7368 6966 742e 7363 616c 6528 7365 6c66  shift.scale(self
+000293a0: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
+000293b0: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
+000293c0: 2020 2020 6465 6620 7570 6461 7465 5f6b      def update_k
+000293d0: 7562 6528 7365 6c66 2c20 636c 7573 7465  ube(self, cluste
+000293e0: 722c 205f 7479 7065 2c20 6f76 6572 7269  r, _type, overri
+000293f0: 6465 733d 7b7d 2c20 706c 616e 3d4e 6f6e  des={}, plan=Non
+00029400: 6529 3a0a 2020 2020 2020 2020 6f76 6572  e):.        over
+00029410: 7269 6465 735b 2773 6b69 705f 6669 6c65  rides['skip_file
+00029420: 735f 7265 6d65 6469 6174 696f 6e27 5d20  s_remediation'] 
+00029430: 3d20 5472 7565 0a20 2020 2020 2020 206f  = True.        o
+00029440: 7665 7272 6964 6573 5b27 7363 616c 6527  verrides['scale'
+00029450: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
+00029460: 2063 6c75 7374 6572 6469 7220 3d20 6f73   clusterdir = os
+00029470: 2e70 6174 682e 6578 7061 6e64 7573 6572  .path.expanduser
+00029480: 2866 227e 2f2e 6b63 6c69 2f63 6c75 7374  (f"~/.kcli/clust
+00029490: 6572 732f 7b63 6c75 7374 6572 7d22 290a  ers/{cluster}").
+000294a0: 2020 2020 2020 2020 706c 616e 766d 7320          planvms 
+000294b0: 3d20 5b5d 0a20 2020 2020 2020 2069 6620  = [].        if 
+000294c0: 706c 616e 2069 7320 4e6f 6e65 3a0a 2020  plan is None:.  
+000294d0: 2020 2020 2020 2020 2020 706c 616e 203d            plan =
+000294e0: 2063 6c75 7374 6572 0a20 2020 2020 2020   cluster.       
+000294f0: 2069 6620 5f74 7970 6520 3d3d 2027 616b   if _type == 'ak
+00029500: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
+00029510: 7365 6c66 2e73 6361 6c65 5f6b 7562 655f  self.scale_kube_
+00029520: 616b 7328 636c 7573 7465 722c 206f 7665  aks(cluster, ove
+00029530: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+00029540: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00029550: 7475 726e 0a20 2020 2020 2020 2069 6620  turn.        if 
+00029560: 5f74 7970 6520 3d3d 2027 656b 7327 3a0a  _type == 'eks':.
+00029570: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00029580: 2e73 6361 6c65 5f6b 7562 655f 656b 7328  .scale_kube_eks(
+00029590: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+000295a0: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
+000295b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000295c0: 0a20 2020 2020 2020 2069 6620 5f74 7970  .        if _typ
+000295d0: 6520 3d3d 2027 676b 6527 3a0a 2020 2020  e == 'gke':.    
+000295e0: 2020 2020 2020 2020 7365 6c66 2e73 6361          self.sca
+000295f0: 6c65 5f6b 7562 655f 676b 6528 636c 7573  le_kube_gke(clus
+00029600: 7465 722c 206f 7665 7272 6964 6573 3d6f  ter, overrides=o
+00029610: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
+00029620: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00029630: 2020 2020 2069 6620 5f74 7970 6520 3d3d       if _type ==
+00029640: 2027 6765 6e65 7269 6327 3a0a 2020 2020   'generic':.    
+00029650: 2020 2020 2020 2020 726f 6c65 7320 3d20          roles = 
+00029660: 5b27 6374 6c70 6c61 6e65 7327 2c20 2777  ['ctlplanes', 'w
+00029670: 6f72 6b65 7273 275d 0a20 2020 2020 2020  orkers'].       
+00029680: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
+00029690: 732e 7061 7468 2e64 6972 6e61 6d65 286b  s.path.dirname(k
+000296a0: 7562 6561 646d 2e63 7265 6174 652e 5f5f  ubeadm.create.__
+000296b0: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
+000296c0: 6d65 290a 2020 2020 2020 2020 656c 6966  me).        elif
+000296d0: 205f 7479 7065 203d 3d20 276b 3373 273a   _type == 'k3s':
+000296e0: 0a20 2020 2020 2020 2020 2020 2070 6c61  .            pla
+000296f0: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
+00029700: 6972 6e61 6d65 286b 3373 2e63 7265 6174  irname(k3s.creat
+00029710: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
+00029720: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+00029730: 2020 2020 726f 6c65 7320 3d20 5b27 626f      roles = ['bo
+00029740: 6f74 7374 7261 7027 2c20 2777 6f72 6b65  otstrap', 'worke
+00029750: 7273 275d 2069 6620 6f76 6572 7269 6465  rs'] if override
+00029760: 732e 6765 7428 2763 746c 706c 616e 6573  s.get('ctlplanes
+00029770: 272c 2031 2920 3d3d 2031 2065 6c73 6520  ', 1) == 1 else 
+00029780: 5b27 626f 6f74 7374 7261 7027 2c20 2763  ['bootstrap', 'c
+00029790: 746c 706c 616e 6573 272c 0a20 2020 2020  tlplanes',.     
+000297a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297f0: 2020 2020 2777 6f72 6b65 7273 275d 0a20      'workers']. 
+00029800: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00029810: 2020 2020 2020 2020 2070 6c61 6e64 6972           plandir
+00029820: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+00029830: 6d65 286f 7065 6e73 6869 6674 2e63 7265  me(openshift.cre
+00029840: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
+00029850: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+00029860: 2020 2020 2020 726f 6c65 7320 3d20 5b27        roles = ['
+00029870: 6374 6c70 6c61 6e65 7327 2c20 2777 6f72  ctlplanes', 'wor
+00029880: 6b65 7273 275d 0a20 2020 2020 2020 2020  kers'].         
+00029890: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
+000298a0: 696e 205b 2761 7773 272c 2027 617a 7572  in ['aws', 'azur
+000298b0: 6527 2c20 2767 6370 275d 3a0a 2020 2020  e', 'gcp']:.    
+000298c0: 2020 2020 2020 2020 2020 2020 726f 6c65              role
+000298d0: 7320 3d20 5b66 2763 6c6f 7564 5f7b 726f  s = [f'cloud_{ro
+000298e0: 6c65 7d27 2066 6f72 2072 6f6c 6520 696e  le}' for role in
+000298f0: 2072 6f6c 6573 5d0a 2020 2020 2020 2020   roles].        
+00029900: 6966 206f 7665 7272 6964 6573 2e67 6574  if overrides.get
+00029910: 2827 776f 726b 6572 7327 2c20 3029 203d  ('workers', 0) =
+00029920: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00029930: 2064 656c 2072 6f6c 6573 5b2d 315d 0a20   del roles[-1]. 
+00029940: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00029950: 682e 6578 6973 7473 2866 227b 636c 7573  h.exists(f"{clus
+00029960: 7465 7264 6972 7d2f 6b63 6c69 5f70 6172  terdir}/kcli_par
+00029970: 616d 6574 6572 732e 796d 6c22 293a 0a20  ameters.yml"):. 
+00029980: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+00029990: 3d20 7b27 636c 7573 7465 7227 3a20 636c  = {'cluster': cl
+000299a0: 7573 7465 722c 2027 6b75 6265 273a 2063  uster, 'kube': c
+000299b0: 6c75 7374 6572 2c20 276b 7562 6574 7970  luster, 'kubetyp
+000299c0: 6527 3a20 5f74 7970 657d 0a20 2020 2020  e': _type}.     
+000299d0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+000299e0: 2866 227b 636c 7573 7465 7264 6972 7d2f  (f"{clusterdir}/
+000299f0: 6b63 6c69 5f70 6172 616d 6574 6572 732e  kcli_parameters.
+00029a00: 796d 6c22 2c20 2772 2729 2061 7320 696e  yml", 'r') as in
+00029a10: 7374 616c 6c3a 0a20 2020 2020 2020 2020  stall:.         
+00029a20: 2020 2020 2020 2069 6e73 7461 6c6c 7061         installpa
+00029a30: 7261 6d20 3d20 7961 6d6c 2e73 6166 655f  ram = yaml.safe_
+00029a40: 6c6f 6164 2869 6e73 7461 6c6c 290a 2020  load(install).  
+00029a50: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00029a60: 7461 2e75 7064 6174 6528 696e 7374 616c  ta.update(instal
+00029a70: 6c70 6172 616d 290a 2020 2020 2020 2020  lparam).        
+00029a80: 2020 2020 2020 2020 706c 616e 203d 2069          plan = i
+00029a90: 6e73 7461 6c6c 7061 7261 6d2e 6765 7428  nstallparam.get(
+00029aa0: 2770 6c61 6e27 2c20 706c 616e 290a 2020  'plan', plan).  
+00029ab0: 2020 2020 2020 2020 2020 6461 7461 2e75            data.u
+00029ac0: 7064 6174 6528 6f76 6572 7269 6465 7329  pdate(overrides)
+00029ad0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00029ae0: 6820 6f70 656e 2866 227b 636c 7573 7465  h open(f"{cluste
+00029af0: 7264 6972 7d2f 6b63 6c69 5f70 6172 616d  rdir}/kcli_param
+00029b00: 6574 6572 732e 796d 6c22 2c20 2777 2729  eters.yml", 'w')
+00029b10: 2061 7320 7061 7261 6d66 696c 653a 0a20   as paramfile:. 
+00029b20: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00029b30: 616d 6c2e 7361 6665 5f64 756d 7028 6461  aml.safe_dump(da
+00029b40: 7461 2c20 7061 7261 6d66 696c 6529 0a20  ta, paramfile). 
+00029b50: 2020 2020 2020 206f 732e 6368 6469 7228         os.chdir(
+00029b60: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+00029b70: 6572 2822 7e2f 2e6b 636c 6922 2929 0a20  er("~/.kcli")). 
+00029b80: 2020 2020 2020 2066 6f72 2072 6f6c 6520         for role 
+00029b90: 696e 2072 6f6c 6573 3a0a 2020 2020 2020  in roles:.      
+00029ba0: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
+00029bb0: 7064 6174 696e 6720 766d 7320 7769 7468  pdating vms with
+00029bc0: 207b 726f 6c65 7d20 726f 6c65 2229 0a20   {role} role"). 
+00029bd0: 2020 2020 2020 2020 2020 2070 6c61 6e64             pland
+00029be0: 6174 6120 3d20 7365 6c66 2e70 6c61 6e28  ata = self.plan(
+00029bf0: 706c 616e 2c20 696e 7075 7466 696c 653d  plan, inputfile=
+00029c00: 6627 7b70 6c61 6e64 6972 7d2f 7b72 6f6c  f'{plandir}/{rol
+00029c10: 657d 2e79 6d6c 272c 206f 7665 7272 6964  e}.yml', overrid
+00029c20: 6573 3d6f 7665 7272 6964 6573 2c20 7570  es=overrides, up
+00029c30: 6461 7465 3d54 7275 6529 0a20 2020 2020  date=True).     
+00029c40: 2020 2020 2020 2070 6c61 6e76 6d73 2e65         planvms.e
+00029c50: 7874 656e 6428 706c 616e 6461 7461 5b27  xtend(plandata['
+00029c60: 6e65 7776 6d73 275d 202b 2070 6c61 6e64  newvms'] + pland
+00029c70: 6174 615b 2765 7869 7374 696e 6776 6d73  ata['existingvms
+00029c80: 275d 290a 2020 2020 2020 2020 6f73 2e65  ']).        os.e
+00029c90: 6e76 6972 6f6e 5b27 4b55 4245 434f 4e46  nviron['KUBECONF
+00029ca0: 4947 275d 203d 2066 227b 636c 7573 7465  IG'] = f"{cluste
+00029cb0: 7264 6972 7d2f 6175 7468 2f6b 7562 6563  rdir}/auth/kubec
+00029cc0: 6f6e 6669 6722 0a20 2020 2020 2020 2062  onfig".        b
+00029cd0: 696e 6172 7920 3d20 276f 6327 2069 6620  inary = 'oc' if 
+00029ce0: 7768 6963 6828 276f 6327 2920 6973 206e  which('oc') is n
+00029cf0: 6f74 204e 6f6e 6520 656c 7365 2027 6b75  ot None else 'ku
+00029d00: 6265 6374 6c27 0a20 2020 2020 2020 206e  bectl'.        n
+00029d10: 6f64 6573 636d 6420 3d20 6627 7b62 696e  odescmd = f'{bin
+00029d20: 6172 797d 2067 6574 206e 6f64 6520 2d6f  ary} get node -o
+00029d30: 206e 616d 6527 0a20 2020 2020 2020 206e   name'.        n
+00029d40: 6f64 6573 203d 205b 6e2e 7374 7269 7028  odes = [n.strip(
+00029d50: 292e 7265 706c 6163 6528 276e 6f64 652f  ).replace('node/
+00029d60: 272c 2027 2729 2066 6f72 206e 2069 6e20  ', '') for n in 
+00029d70: 6f73 2e70 6f70 656e 286e 6f64 6573 636d  os.popen(nodescm
+00029d80: 6429 2e72 6561 646c 696e 6573 2829 5d0a  d).readlines()].
+00029d90: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
+00029da0: 6e20 7365 6c66 2e6b 2e6c 6973 7428 293a  n self.k.list():
+00029db0: 0a20 2020 2020 2020 2020 2020 2076 6d6e  .            vmn
+00029dc0: 616d 6520 3d20 766d 5b27 6e61 6d65 275d  ame = vm['name']
+00029dd0: 0a20 2020 2020 2020 2020 2020 2076 6d70  .            vmp
+00029de0: 6c61 6e20 3d20 766d 2e67 6574 2827 706c  lan = vm.get('pl
+00029df0: 616e 272c 2027 6b76 6972 7427 290a 2020  an', 'kvirt').  
+00029e00: 2020 2020 2020 2020 2020 6966 2076 6d70            if vmp
+00029e10: 6c61 6e20 3d3d 2070 6c61 6e20 616e 6420  lan == plan and 
+00029e20: 766d 6e61 6d65 206e 6f74 2069 6e20 706c  vmname not in pl
+00029e30: 616e 766d 733a 0a20 2020 2020 2020 2020  anvms:.         
+00029e40: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00029e50: 4465 6c65 7469 6e67 2076 6d20 7b76 6d6e  Deleting vm {vmn
+00029e60: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
+00029e70: 2020 2020 2020 2073 656c 662e 6b2e 6465         self.k.de
+00029e80: 6c65 7465 2876 6d6e 616d 6529 0a20 2020  lete(vmname).   
+00029e90: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00029ea0: 206e 6f64 6520 696e 206e 6f64 6573 3a0a   node in nodes:.
+00029eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ec0: 2020 2020 6966 206e 6f64 652e 7370 6c69      if node.spli
+00029ed0: 7428 272e 2729 5b30 5d20 3d3d 2076 6d6e  t('.')[0] == vmn
+00029ee0: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
+00029ef0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+00029f00: 696e 7428 6622 4465 6c65 7469 6e67 206e  int(f"Deleting n
+00029f10: 6f64 6520 7b6e 6f64 657d 2066 726f 6d20  ode {node} from 
+00029f20: 796f 7572 2063 6c75 7374 6572 2229 0a20  your cluster"). 
+00029f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f40: 2020 2020 2020 2063 616c 6c28 6627 7b62         call(f'{b
+00029f50: 696e 6172 797d 2064 656c 6574 6520 6e6f  inary} delete no
+00029f60: 6465 207b 6e6f 6465 7d27 2c20 7368 656c  de {node}', shel
+00029f70: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
 00029f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029f90: 5f66 696c 6573 2e61 7070 656e 6428 7b22  _files.append({"
-00029fa0: 7061 7468 223a 2022 2f72 6f6f 742f 6d61  path": "/root/ma
-00029fb0: 6373 2e74 7874 222c 2022 6f72 6967 696e  cs.txt", "origin
-00029fc0: 223a 2027 6d61 6373 2e74 7874 277d 290a  ": 'macs.txt'}).
-00029fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029fe0: 6973 6f5f 6f76 6572 7269 6465 7320 3d20  iso_overrides = 
-00029ff0: 7b27 7363 7269 7074 7327 3a20 5b69 736f  {'scripts': [iso
-0002a000: 7363 7269 7074 5d2c 2027 6669 6c65 7327  script], 'files'
-0002a010: 3a20 5f66 696c 6573 2c20 276d 6574 616c  : _files, 'metal
-0002a020: 5f75 726c 273a 206d 6574 616c 5f75 726c  _url': metal_url
-0002a030: 2c20 276e 6f6e 616d 6527 3a20 5472 7565  , 'noname': True
-0002a040: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a060: 2020 2027 696d 6167 6527 3a20 2772 6863     'image': 'rhc
-0002a070: 6f73 3430 3030 277d 0a20 2020 2020 2020  os4000'}.       
-0002a080: 2020 2020 2020 2020 2069 6620 6d65 7461           if meta
-0002a090: 6c5f 7572 6c20 6973 206e 6f74 204e 6f6e  l_url is not Non
-0002a0a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002a0b0: 2020 2020 2020 2069 736f 5f6f 7665 7272         iso_overr
-0002a0c0: 6964 6573 5b27 6e65 6564 5f6e 6574 776f  ides['need_netwo
-0002a0d0: 726b 275d 203d 2054 7275 650a 2020 2020  rk'] = True.    
-0002a0e0: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
-0002a0f0: 6f76 6572 7269 6465 732e 7570 6461 7465  overrides.update
-0002a100: 286f 7665 7272 6964 6573 290a 2020 2020  (overrides).    
-0002a110: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-0002a120: 6e61 6d65 2720 696e 206f 7665 7272 6964  name' in overrid
-0002a130: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0002a140: 2020 2020 2020 2020 6973 6f5f 6e61 6d65          iso_name
-0002a150: 203d 206f 7665 7272 6964 6573 5b27 6e61   = overrides['na
-0002a160: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-0002a170: 2020 2020 2020 2020 2069 736f 5f6f 7665           iso_ove
-0002a180: 7272 6964 6573 5b27 6e6f 6e61 6d65 275d  rrides['noname']
-0002a190: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0002a1a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0002a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1c0: 2020 2069 736f 5f6e 616d 6520 3d20 2761     iso_name = 'a
-0002a1d0: 7574 6f69 6e73 7461 6c6c 6572 270a 2020  utoinstaller'.  
-0002a1e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0002a1f0: 7375 6c74 203d 2073 656c 662e 6372 6561  sult = self.crea
-0002a200: 7465 5f76 6d28 6973 6f5f 6e61 6d65 2c20  te_vm(iso_name, 
-0002a210: 6f76 6572 7269 6465 733d 6973 6f5f 6f76  overrides=iso_ov
-0002a220: 6572 7269 6465 732c 206f 6e6c 7961 7373  errides, onlyass
-0002a230: 6574 733d 5472 7565 290a 2020 2020 2020  ets=True).      
-0002a240: 2020 2020 2020 2020 2020 6966 2027 7265            if 're
-0002a250: 6173 6f6e 2720 696e 2072 6573 756c 743a  ason' in result:
-0002a260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a270: 2020 2020 2065 7272 6f72 2872 6573 756c       error(resul
-0002a280: 745b 2772 6561 736f 6e27 5d29 0a20 2020  t['reason']).   
-0002a290: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0002a2a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002a2b0: 2020 2020 2020 2066 2e77 7269 7465 2872         f.write(r
-0002a2c0: 6573 756c 745b 2775 7365 7264 6174 6127  esult['userdata'
-0002a2d0: 5d29 0a20 2020 2020 2020 2069 6620 6973  ]).        if is
-0002a2e0: 6f3a 0a20 2020 2020 2020 2020 2020 2069  o:.            i
-0002a2f0: 6620 7365 6c66 2e74 7970 6520 6e6f 7420  f self.type not 
-0002a300: 696e 205b 276b 766d 272c 2027 6661 6b65  in ['kvm', 'fake
-0002a310: 272c 2027 6b75 6265 7669 7274 272c 2027  ', 'kubevirt', '
-0002a320: 7673 7068 6572 6527 2c20 276f 7065 6e73  vsphere', 'opens
-0002a330: 7461 636b 275d 3a0a 2020 2020 2020 2020  tack']:.        
-0002a340: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-0002a350: 6622 4973 6f20 6765 6e65 7261 7469 6f6e  f"Iso generation
-0002a360: 206e 6f74 2073 7570 706f 7274 6564 206f   not supported o
-0002a370: 6e20 7b73 656c 662e 7479 7065 7d22 290a  n {self.type}").
-0002a380: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0002a390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002a3a0: 2020 6973 6f5f 706f 6f6c 203d 206f 7665    iso_pool = ove
-0002a3b0: 7272 6964 6573 2e67 6574 2827 706f 6f6c  rrides.get('pool
-0002a3c0: 2729 206f 7220 7365 6c66 2e70 6f6f 6c0a  ') or self.pool.
-0002a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a3e0: 6765 6e65 7261 7465 5f72 6863 6f73 5f69  generate_rhcos_i
-0002a3f0: 736f 2873 656c 662e 6b2c 2066 227b 636c  so(self.k, f"{cl
-0002a400: 7573 7465 727d 2d7b 726f 6c65 7d22 2c20  uster}-{role}", 
-0002a410: 6973 6f5f 706f 6f6c 2c20 7665 7273 696f  iso_pool, versio
-0002a420: 6e3d 6973 6f5f 7665 7273 696f 6e2c 2070  n=iso_version, p
-0002a430: 6f64 6d61 6e3d 706f 646d 616e 2c0a 2020  odman=podman,.  
-0002a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a460: 2069 6e73 7461 6c6c 6572 3d69 6e73 7461   installer=insta
-0002a470: 6c6c 6572 290a 0a20 2020 2064 6566 2063  ller)..    def c
-0002a480: 7265 6174 655f 6f70 656e 7368 6966 745f  reate_openshift_
-0002a490: 6469 7363 6f6e 6e65 6374 6564 2873 656c  disconnected(sel
-0002a4a0: 662c 2070 6c61 6e2c 206f 7665 7272 6964  f, plan, overrid
-0002a4b0: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
-0002a4c0: 6461 7461 203d 206f 7665 7272 6964 6573  data = overrides
-0002a4d0: 0a20 2020 2020 2020 2070 6c61 6e64 6972  .        plandir
-0002a4e0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-0002a4f0: 6d65 286f 7065 6e73 6869 6674 2e63 7265  me(openshift.cre
-0002a500: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
-0002a510: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
-0002a520: 2020 636c 7573 7465 7220 3d20 6461 7461    cluster = data
-0002a530: 2e67 6574 2827 636c 7573 7465 7227 2c20  .get('cluster', 
-0002a540: 276d 796f 7065 6e73 6869 6674 2729 0a20  'myopenshift'). 
-0002a550: 2020 2020 2020 2075 7073 7472 6561 6d20         upstream 
-0002a560: 3d20 6461 7461 2e67 6574 2827 7570 7374  = data.get('upst
-0002a570: 7265 616d 272c 2046 616c 7365 290a 2020  ream', False).  
-0002a580: 2020 2020 2020 7665 7273 696f 6e20 3d20        version = 
-0002a590: 6461 7461 2e67 6574 2827 7665 7273 696f  data.get('versio
-0002a5a0: 6e27 2c20 2773 7461 626c 6527 290a 2020  n', 'stable').  
-0002a5b0: 2020 2020 2020 7461 6720 3d20 6461 7461        tag = data
-0002a5c0: 2e67 6574 2827 7461 6727 2c20 4f50 454e  .get('tag', OPEN
-0002a5d0: 5348 4946 545f 5441 4729 0a20 2020 2020  SHIFT_TAG).     
-0002a5e0: 2020 2070 7072 696e 7428 6622 5573 696e     pprint(f"Usin
-0002a5f0: 6720 7665 7273 696f 6e20 7b76 6572 7369  g version {versi
-0002a600: 6f6e 7d20 616e 6420 7461 6720 7b74 6167  on} and tag {tag
-0002a610: 7d22 290a 2020 2020 2020 2020 6469 7363  }").        disc
-0002a620: 6f6e 6e65 6374 6564 5f76 6d20 3d20 6622  onnected_vm = f"
-0002a630: 7b63 6c75 7374 6572 7d2d 6469 7363 6f6e  {cluster}-discon
-0002a640: 6e65 6374 6564 220a 2020 2020 2020 2020  nected".        
-0002a650: 6469 7363 6f6e 6e65 6374 6564 5f72 6575  disconnected_reu
-0002a660: 7365 203d 2064 6174 612e 6765 7428 2764  se = data.get('d
-0002a670: 6973 636f 6e6e 6563 7465 645f 7265 7573  isconnected_reus
-0002a680: 6527 2c20 4661 6c73 6529 0a20 2020 2020  e', False).     
-0002a690: 2020 2064 6973 636f 6e6e 6563 7465 645f     disconnected_
-0002a6a0: 7379 6e63 203d 2064 6174 612e 6765 7428  sync = data.get(
-0002a6b0: 2764 6973 636f 6e6e 6563 7465 645f 7379  'disconnected_sy
-0002a6c0: 6e63 272c 2054 7275 6529 0a20 2020 2020  nc', True).     
-0002a6d0: 2020 2070 7072 696e 7428 6622 4465 706c     pprint(f"Depl
-0002a6e0: 6f79 696e 6720 6469 7363 6f6e 6e65 6374  oying disconnect
-0002a6f0: 6564 2076 6d20 7b64 6973 636f 6e6e 6563  ed vm {disconnec
-0002a700: 7465 645f 766d 7d22 290a 2020 2020 2020  ted_vm}").      
-0002a710: 2020 6966 2064 6973 636f 6e6e 6563 7465    if disconnecte
-0002a720: 645f 7379 6e63 3a0a 2020 2020 2020 2020  d_sync:.        
-0002a730: 2020 2020 7075 6c6c 5f73 6563 7265 7420      pull_secret 
-0002a740: 3d20 7077 645f 7061 7468 2864 6174 612e  = pwd_path(data.
-0002a750: 6765 7428 2770 756c 6c5f 7365 6372 6574  get('pull_secret
-0002a760: 2729 2920 6966 206e 6f74 2075 7073 7472  ')) if not upstr
-0002a770: 6561 6d20 656c 7365 2066 227b 706c 616e  eam else f"{plan
-0002a780: 6469 727d 2f66 616b 655f 7075 6c6c 2e6a  dir}/fake_pull.j
-0002a790: 736f 6e22 0a20 2020 2020 2020 2020 2020  son".           
-0002a7a0: 2069 6620 6e6f 7420 7570 7374 7265 616d   if not upstream
-0002a7b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002a7c0: 2020 7075 6c6c 5f73 6563 7265 7420 3d20    pull_secret = 
-0002a7d0: 7077 645f 7061 7468 2864 6174 612e 6765  pwd_path(data.ge
-0002a7e0: 7428 2770 756c 6c5f 7365 6372 6574 272c  t('pull_secret',
-0002a7f0: 2027 6f70 656e 7368 6966 745f 7075 6c6c   'openshift_pull
-0002a800: 2e6a 736f 6e27 2929 0a20 2020 2020 2020  .json')).       
-0002a810: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002a820: 2020 2020 2020 2020 2020 2070 756c 6c5f             pull_
-0002a830: 7365 6372 6574 203d 2066 227b 706c 616e  secret = f"{plan
-0002a840: 6469 727d 2f66 616b 655f 7075 6c6c 2e6a  dir}/fake_pull.j
-0002a850: 736f 6e22 0a20 2020 2020 2020 2020 2020  son".           
-0002a860: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-0002a870: 6578 6973 7473 2870 756c 6c5f 7365 6372  exists(pull_secr
-0002a880: 6574 293a 0a20 2020 2020 2020 2020 2020  et):.           
-0002a890: 2020 2020 2065 7272 6f72 2866 224d 6973       error(f"Mis
-0002a8a0: 7369 6e67 2070 756c 6c20 7365 6372 6574  sing pull secret
-0002a8b0: 2066 696c 6520 7b70 756c 6c5f 7365 6372   file {pull_secr
-0002a8c0: 6574 7d22 290a 2020 2020 2020 2020 2020  et}").          
-0002a8d0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-0002a8e0: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-0002a8f0: 7461 5b27 7075 6c6c 5f73 6563 7265 7427  ta['pull_secret'
-0002a900: 5d20 3d20 7265 2e73 7562 2872 225c 7322  ] = re.sub(r"\s"
-0002a910: 2c20 2222 2c20 6f70 656e 2870 756c 6c5f  , "", open(pull_
-0002a920: 7365 6372 6574 292e 7265 6164 2829 290a  secret).read()).
-0002a930: 2020 2020 2020 2020 6469 7363 6f6e 6e65          disconne
-0002a940: 6374 6564 5f70 6c61 6e20 3d20 6622 7b70  cted_plan = f"{p
-0002a950: 6c61 6e7d 2d72 6575 7365 2220 6966 2064  lan}-reuse" if d
-0002a960: 6973 636f 6e6e 6563 7465 645f 7265 7573  isconnected_reus
-0002a970: 6520 656c 7365 2070 6c61 6e0a 2020 2020  e else plan.    
-0002a980: 2020 2020 6966 2076 6572 7369 6f6e 203d      if version =
-0002a990: 3d20 2763 6927 2061 6e64 2027 6469 7363  = 'ci' and 'disc
-0002a9a0: 6f6e 6e65 6374 6564 5f6f 7269 6769 6e27  onnected_origin'
-0002a9b0: 206e 6f74 2069 6e20 6f76 6572 7269 6465   not in override
-0002a9c0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0002a9d0: 6567 203d 2027 7265 6769 7374 7279 2e62  eg = 'registry.b
-0002a9e0: 7569 6c64 3031 2e63 692e 6f70 656e 7368  uild01.ci.opensh
-0002a9f0: 6966 742e 6f72 6727 2069 6620 7374 7228  ift.org' if str(
-0002aa00: 7461 6729 2e73 7461 7274 7377 6974 6828  tag).startswith(
-0002aa10: 2763 692d 2729 2065 6c73 6520 2772 6567  'ci-') else 'reg
-0002aa20: 6973 7472 792e 6369 2e6f 7065 6e73 6869  istry.ci.openshi
-0002aa30: 6674 2e6f 7267 270a 2020 2020 2020 2020  ft.org'.        
-0002aa40: 2020 2020 7761 726e 696e 6728 6622 466f      warning(f"Fo
-0002aa50: 7263 696e 6720 6469 7363 6f6e 6e65 6374  rcing disconnect
-0002aa60: 6564 5f6f 7269 6769 6e20 746f 207b 7265  ed_origin to {re
-0002aa70: 677d 2229 0a20 2020 2020 2020 2020 2020  g}").           
-0002aa80: 2064 6174 615b 2764 6973 636f 6e6e 6563   data['disconnec
-0002aa90: 7465 645f 6f72 6967 696e 275d 203d 2072  ted_origin'] = r
-0002aaa0: 6567 0a20 2020 2020 2020 2072 6573 756c  eg.        resul
-0002aab0: 7420 3d20 7365 6c66 2e70 6c61 6e28 6469  t = self.plan(di
-0002aac0: 7363 6f6e 6e65 6374 6564 5f70 6c61 6e2c  sconnected_plan,
-0002aad0: 2069 6e70 7574 6669 6c65 3d66 277b 706c   inputfile=f'{pl
-0002aae0: 616e 6469 727d 2f64 6973 636f 6e6e 6563  andir}/disconnec
-0002aaf0: 7465 642e 796d 6c27 2c20 6f76 6572 7269  ted.yml', overri
-0002ab00: 6465 733d 6461 7461 290a 2020 2020 2020  des=data).      
-0002ab10: 2020 6966 2072 6573 756c 745b 2772 6573    if result['res
-0002ab20: 756c 7427 5d20 213d 2027 7375 6363 6573  ult'] != 'succes
-0002ab30: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
-0002ab40: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-0002ab50: 2020 2020 656c 6966 2064 6973 636f 6e6e      elif disconn
-0002ab60: 6563 7465 645f 7379 6e63 3a0a 2020 2020  ected_sync:.    
-0002ab70: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-0002ab80: 5573 6520 7468 6520 666f 6c6c 6f77 696e  Use the followin
-0002ab90: 6720 4f50 454e 5348 4946 545f 494e 5354  g OPENSHIFT_INST
-0002aba0: 414c 4c5f 5245 4c45 4153 455f 494d 4147  ALL_RELEASE_IMAG
-0002abb0: 455f 4f56 4552 5249 4445 2229 0a20 2020  E_OVERRIDE").   
-0002abc0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-0002abd0: 6461 7461 2e67 6574 2827 6469 7363 6f6e  data.get('discon
-0002abe0: 6e65 6374 6564 5f72 6575 7365 5f6e 616d  nected_reuse_nam
-0002abf0: 6527 2920 6f72 2063 6c75 7374 6572 0a20  e') or cluster. 
-0002ac00: 2020 2020 2020 2020 2020 2069 702c 2076             ip, v
-0002ac10: 6d70 6f72 7420 3d20 5f73 7368 5f63 7265  mport = _ssh_cre
-0002ac20: 6465 6e74 6961 6c73 2873 656c 662e 6b2c  dentials(self.k,
-0002ac30: 2066 277b 6e61 6d65 7d2d 6469 7363 6f6e   f'{name}-discon
-0002ac40: 6e65 6374 6564 2729 5b31 3a5d 0a20 2020  nected')[1:].   
-0002ac50: 2020 2020 2020 2020 2063 6d64 203d 2022           cmd = "
-0002ac60: 6361 7420 2f72 6f6f 742f 7665 7273 696f  cat /root/versio
-0002ac70: 6e2e 7478 7422 0a20 2020 2020 2020 2020  n.txt".         
-0002ac80: 2020 2073 7368 636d 6420 3d20 7373 6828     sshcmd = ssh(
-0002ac90: 6e61 6d65 2c20 6970 3d69 702c 2075 7365  name, ip=ip, use
-0002aca0: 723d 2772 6f6f 7427 2c20 7475 6e6e 656c  r='root', tunnel
-0002acb0: 3d73 656c 662e 7475 6e6e 656c 2c0a 2020  =self.tunnel,.  
-0002acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002acd0: 2020 2020 2020 2074 756e 6e65 6c68 6f73         tunnelhos
-0002ace0: 743d 7365 6c66 2e74 756e 6e65 6c68 6f73  t=self.tunnelhos
-0002acf0: 742c 2074 756e 6e65 6c70 6f72 743d 7365  t, tunnelport=se
-0002ad00: 6c66 2e74 756e 6e65 6c70 6f72 742c 0a20  lf.tunnelport,. 
-0002ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ad20: 2020 2020 2020 2020 7475 6e6e 656c 7573          tunnelus
-0002ad30: 6572 3d73 656c 662e 7475 6e6e 656c 7573  er=self.tunnelus
-0002ad40: 6572 2c20 696e 7365 6375 7265 3d54 7275  er, insecure=Tru
-0002ad50: 652c 2063 6d64 3d63 6d64 2c20 766d 706f  e, cmd=cmd, vmpo
-0002ad60: 7274 3d76 6d70 6f72 7429 0a20 2020 2020  rt=vmport).     
-0002ad70: 2020 2020 2020 206f 732e 7379 7374 656d         os.system
-0002ad80: 2873 7368 636d 6429 0a0a 2020 2020 6465  (sshcmd)..    de
-0002ad90: 6620 6861 6e64 6c65 5f66 696e 6973 6866  f handle_finishf
-0002ada0: 696c 6573 2873 656c 662c 206e 616d 652c  iles(self, name,
-0002adb0: 2066 696e 6973 6866 696c 6573 2c20 6964   finishfiles, id
-0002adc0: 656e 7469 7479 6669 6c65 3d4e 6f6e 652c  entityfile=None,
-0002add0: 2076 6d63 6c69 656e 743d 4e6f 6e65 293a   vmclient=None):
-0002ade0: 0a20 2020 2020 2020 2063 6f6e 6669 6720  .        config 
-0002adf0: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
-0002ae00: 3d76 6d63 6c69 656e 7429 2069 6620 766d  =vmclient) if vm
-0002ae10: 636c 6965 6e74 2069 7320 6e6f 7420 4e6f  client is not No
-0002ae20: 6e65 2065 6c73 6520 7365 6c66 0a20 2020  ne else self.   
-0002ae30: 2020 2020 206b 203d 2063 6f6e 6669 672e       k = config.
-0002ae40: 6b0a 2020 2020 2020 2020 6375 7272 656e  k.        curren
-0002ae50: 745f 6970 203d 2063 6f6d 6d6f 6e2e 5f73  t_ip = common._s
-0002ae60: 7368 5f63 7265 6465 6e74 6961 6c73 286b  sh_credentials(k
-0002ae70: 2c20 6e61 6d65 295b 315d 0a20 2020 2020  , name)[1].     
-0002ae80: 2020 2066 6f72 2066 696e 6973 6866 696c     for finishfil
-0002ae90: 6520 696e 2066 696e 6973 6866 696c 6573  e in finishfiles
-0002aea0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0002aeb0: 2069 7369 6e73 7461 6e63 6528 6669 6e69   isinstance(fini
-0002aec0: 7368 6669 6c65 2c20 7374 7229 3a0a 2020  shfile, str):.  
-0002aed0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0002aee0: 7374 696e 6174 696f 6e20 3d20 272e 270a  stination = '.'.
-0002aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002af00: 736f 7572 6365 203d 2066 696e 6973 6866  source = finishf
-0002af10: 696c 6520 6966 2027 2f27 2069 6e20 6669  ile if '/' in fi
-0002af20: 6e69 7368 6669 6c65 2065 6c73 6520 6627  nishfile else f'
-0002af30: 2f72 6f6f 742f 7b66 696e 6973 6866 696c  /root/{finishfil
-0002af40: 657d 270a 2020 2020 2020 2020 2020 2020  e}'.            
-0002af50: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0002af60: 6669 6e69 7368 6669 6c65 2c20 6469 6374  finishfile, dict
-0002af70: 2920 616e 6420 276f 7269 6769 6e27 2069  ) and 'origin' i
-0002af80: 6e20 6669 6e69 7368 6669 6c65 2061 6e64  n finishfile and
-0002af90: 2027 7061 7468 2720 696e 2066 696e 6973   'path' in finis
-0002afa0: 6866 696c 653a 0a20 2020 2020 2020 2020  hfile:.         
-0002afb0: 2020 2020 2020 2073 6f75 7263 652c 2064         source, d
-0002afc0: 6573 7469 6e61 7469 6f6e 203d 2066 696e  estination = fin
-0002afd0: 6973 6866 696c 652e 6765 7428 276f 7269  ishfile.get('ori
-0002afe0: 6769 6e27 292c 206f 732e 7061 7468 2e65  gin'), os.path.e
-0002aff0: 7870 616e 6475 7365 7228 6669 6e69 7368  xpanduser(finish
-0002b000: 6669 6c65 2e67 6574 2827 7061 7468 272c  file.get('path',
-0002b010: 2027 2e27 2929 0a20 2020 2020 2020 2020   '.')).         
-0002b020: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002b030: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0002b040: 2866 2249 6e63 6f72 7265 6374 2066 696e  (f"Incorrect fin
-0002b050: 6973 6866 696c 6520 656e 7472 7920 7b66  ishfile entry {f
-0002b060: 696e 6973 6866 696c 657d 2e20 536b 6970  inishfile}. Skip
-0002b070: 7069 6e67 2229 0a20 2020 2020 2020 2020  ping").         
-0002b080: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0002b090: 2020 2020 2020 2020 2020 2020 7363 7063              scpc
-0002b0a0: 6d64 203d 2063 6f6d 6d6f 6e2e 7363 7028  md = common.scp(
-0002b0b0: 6e61 6d65 2c20 6970 3d63 7572 7265 6e74  name, ip=current
-0002b0c0: 5f69 702c 2075 7365 723d 2772 6f6f 7427  _ip, user='root'
-0002b0d0: 2c20 736f 7572 6365 3d73 6f75 7263 652c  , source=source,
-0002b0e0: 2064 6573 7469 6e61 7469 6f6e 3d64 6573   destination=des
-0002b0f0: 7469 6e61 7469 6f6e 2c0a 2020 2020 2020  tination,.      
-0002b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b110: 2020 2020 2020 2020 2020 7475 6e6e 656c            tunnel
-0002b120: 3d63 6f6e 6669 672e 7475 6e6e 656c 2c20  =config.tunnel, 
-0002b130: 7475 6e6e 656c 686f 7374 3d63 6f6e 6669  tunnelhost=confi
-0002b140: 672e 7475 6e6e 656c 686f 7374 2c20 7475  g.tunnelhost, tu
-0002b150: 6e6e 656c 706f 7274 3d63 6f6e 6669 672e  nnelport=config.
-0002b160: 7475 6e6e 656c 706f 7274 2c0a 2020 2020  tunnelport,.    
-0002b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b180: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
-0002b190: 656c 7573 6572 3d73 656c 662e 7475 6e6e  eluser=self.tunn
-0002b1a0: 656c 7573 6572 2c20 646f 776e 6c6f 6164  eluser, download
-0002b1b0: 3d54 7275 652c 2069 6e73 6563 7572 653d  =True, insecure=
-0002b1c0: 5472 7565 2c20 6964 656e 7469 7479 6669  True, identityfi
-0002b1d0: 6c65 3d69 6465 6e74 6974 7966 696c 6529  le=identityfile)
-0002b1e0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-0002b1f0: 7379 7374 656d 2873 6370 636d 6429 0a0a  system(scpcmd)..
-0002b200: 2020 2020 6465 6620 6861 6e64 6c65 5f6e      def handle_n
-0002b210: 6f74 6966 6963 6174 696f 6e73 2873 656c  otifications(sel
-0002b220: 662c 206e 616d 652c 206e 6f74 6966 796d  f, name, notifym
-0002b230: 6574 686f 6473 3d5b 5d2c 2070 7573 6862  ethods=[], pushb
-0002b240: 756c 6c65 7474 6f6b 656e 3d4e 6f6e 652c  ullettoken=None,
-0002b250: 206e 6f74 6966 7973 6372 6970 743d 4e6f   notifyscript=No
-0002b260: 6e65 2c20 6e6f 7469 6679 636d 643d 4e6f  ne, notifycmd=No
-0002b270: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0002b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b290: 2073 6c61 636b 6368 616e 6e65 6c3d 4e6f   slackchannel=No
-0002b2a0: 6e65 2c20 736c 6163 6b74 6f6b 656e 3d4e  ne, slacktoken=N
-0002b2b0: 6f6e 652c 206d 6169 6c73 6572 7665 723d  one, mailserver=
-0002b2c0: 4e6f 6e65 2c20 6d61 696c 6672 6f6d 3d4e  None, mailfrom=N
-0002b2d0: 6f6e 652c 206d 6169 6c74 6f3d 4e6f 6e65  one, mailto=None
-0002b2e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002b2f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002b300: 6c75 7374 6572 3d46 616c 7365 293a 0a20  luster=False):. 
-0002b310: 2020 2020 2020 205f 7479 7065 203d 2027         _type = '
-0002b320: 436c 7573 7465 7227 2069 6620 636c 7573  Cluster' if clus
-0002b330: 7465 7220 656c 7365 2027 566d 270a 2020  ter else 'Vm'.  
-0002b340: 2020 2020 2020 7469 746c 6520 3d20 6622        title = f"
-0002b350: 7b5f 7479 7065 7d20 7b6e 616d 657d 206f  {_type} {name} o
-0002b360: 6e20 7b73 656c 662e 636c 6965 6e74 7d20  n {self.client} 
-0002b370: 7265 706f 7274 220a 2020 2020 2020 2020  report".        
-0002b380: 636d 6473 2c20 6d61 696c 636f 6e74 656e  cmds, mailconten
-0002b390: 7420 3d20 5b5d 2c20 4e6f 6e65 0a20 2020  t = [], None.   
-0002b3a0: 2020 2020 2066 6f72 206e 6f74 6966 796d       for notifym
-0002b3b0: 6574 686f 6420 696e 2073 6f72 7465 6428  ethod in sorted(
-0002b3c0: 6e6f 7469 6679 6d65 7468 6f64 732c 2072  notifymethods, r
-0002b3d0: 6576 6572 7365 3d54 7275 6529 3a0a 2020  everse=True):.  
-0002b3e0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0002b3f0: 6966 796d 6574 686f 6420 3d3d 2027 7075  ifymethod == 'pu
-0002b400: 7368 6275 6c6c 6574 273a 0a20 2020 2020  shbullet':.     
-0002b410: 2020 2020 2020 2020 2020 2069 6620 7075             if pu
-0002b420: 7368 6275 6c6c 6574 746f 6b65 6e20 6973  shbullettoken is
-0002b430: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002b440: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0002b450: 6e67 2866 224e 6f74 6966 6963 6174 696f  ng(f"Notificatio
-0002b460: 6e20 7265 7175 6972 6564 2066 6f72 207b  n required for {
-0002b470: 6e61 6d65 7d20 6275 7420 6d69 7373 696e  name} but missin
-0002b480: 6720 7075 7368 6275 6c6c 6574 746f 6b65  g pushbullettoke
-0002b490: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-0002b4a0: 2020 2020 656c 6966 206e 6f74 6966 7973      elif notifys
-0002b4b0: 6372 6970 7420 6973 204e 6f6e 6520 616e  cript is None an
-0002b4c0: 6420 6e6f 7469 6679 636d 6420 6973 204e  d notifycmd is N
-0002b4d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002b4e0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0002b4f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0002b500: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002b510: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-0002b520: 6e20 3d20 7075 7368 6275 6c6c 6574 746f  n = pushbulletto
-0002b530: 6b65 6e0a 2020 2020 2020 2020 2020 2020  ken.            
-0002b540: 2020 2020 2020 2020 7062 636d 6420 3d20          pbcmd = 
-0002b550: 2763 7572 6c20 2d73 7520 2225 733a 2220  'curl -su "%s:" 
-0002b560: 2d64 2074 7970 653d 226e 6f74 6522 202d  -d type="note" -
-0002b570: 6420 626f 6479 3d22 6025 7320 323e 2631  d body="`%s 2>&1
-0002b580: 6022 202d 6420 7469 746c 653d 2225 7322  `" -d title="%s"
-0002b590: 2027 2025 2028 746f 6b65 6e2c 0a20 2020   ' % (token,.   
-0002b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b5f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0002b600: 6f74 6966 7963 6d64 2c0a 2020 2020 2020  otifycmd,.      
-0002b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b660: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-0002b670: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0002b680: 2020 2020 2020 2070 6263 6d64 202b 3d20         pbcmd += 
-0002b690: 2768 7474 7073 3a2f 2f61 7069 2e70 7573  'https://api.pus
-0002b6a0: 6862 756c 6c65 742e 636f 6d2f 7632 2f70  hbullet.com/v2/p
-0002b6b0: 7573 6865 7327 0a20 2020 2020 2020 2020  ushes'.         
-0002b6c0: 2020 2020 2020 2020 2020 2063 6d64 732e             cmds.
-0002b6d0: 6170 7065 6e64 2870 6263 6d64 290a 2020  append(pbcmd).  
-0002b6e0: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
-0002b6f0: 6f74 6966 796d 6574 686f 6420 3d3d 2027  otifymethod == '
-0002b700: 736c 6163 6b27 3a0a 2020 2020 2020 2020  slack':.        
-0002b710: 2020 2020 2020 2020 6966 2073 6c61 636b          if slack
-0002b720: 6368 616e 6e65 6c20 6973 204e 6f6e 653a  channel is None:
-0002b730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b740: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
-0002b750: 6f74 6966 6963 6174 696f 6e20 7265 7175  otification requ
-0002b760: 6972 6564 2066 6f72 207b 6e61 6d65 7d20  ired for {name} 
-0002b770: 6275 7420 6d69 7373 696e 6720 736c 6163  but missing slac
-0002b780: 6b20 6368 616e 6e65 6c22 290a 2020 2020  k channel").    
-0002b790: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0002b7a0: 2073 6c61 636b 746f 6b65 6e20 6973 204e   slacktoken is N
-0002b7b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002b7c0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0002b7d0: 2866 224e 6f74 6966 6963 6174 696f 6e20  (f"Notification 
-0002b7e0: 7265 7175 6972 6564 2066 6f72 207b 6e61  required for {na
-0002b7f0: 6d65 7d20 6275 7420 6d69 7373 696e 6720  me} but missing 
-0002b800: 736c 6163 6b74 6f6b 656e 2229 0a20 2020  slacktoken").   
-0002b810: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0002b820: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002b830: 2020 2020 2020 2073 6c61 636b 636d 6420         slackcmd 
-0002b840: 3d20 6622 696e 666f 3d60 7b6e 6f74 6966  = f"info=`{notif
-0002b850: 7963 6d64 7d20 323e 2631 207c 2073 6564  ycmd} 2>&1 | sed
-0002b860: 2027 732f 5c5c 7832 2f20 2f67 2760 3b22   's/\\x2/ /g'`;"
-0002b870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b880: 2020 2020 2073 6c61 636b 636d 6420 2b3d       slackcmd +=
-0002b890: 2022 2222 6375 726c 202d 5820 504f 5354   """curl -X POST
-0002b8a0: 202d 4820 2741 7574 686f 7269 7a61 7469   -H 'Authorizati
-0002b8b0: 6f6e 3a20 4265 6172 6572 2025 7327 0a20  on: Bearer %s'. 
-0002b8c0: 2d48 2027 436f 6e74 656e 742d 7479 7065  -H 'Content-type
-0002b8d0: 3a20 6170 706c 6963 6174 696f 6e2f 6a73  : application/js
-0002b8e0: 6f6e 3b20 6368 6172 7365 743d 7574 662d  on; charset=utf-
-0002b8f0: 3827 0a20 2d2d 6461 7461 2027 7b22 6368  8'. --data '{"ch
-0002b900: 616e 6e65 6c22 3a22 2573 222c 2274 6578  annel":"%s","tex
-0002b910: 7422 3a22 2573 222c 2261 7474 6163 686d  t":"%s","attachm
-0002b920: 656e 7473 223a 205b 7b22 7465 7874 223a  ents": [{"text":
-0002b930: 2227 2224 696e 666f 2227 222c 2266 616c  "'"$info"'","fal
-0002b940: 6c62 6163 6b22 3a22 6e6f 7468 696e 6722  lback":"nothing"
-0002b950: 2c0a 2263 6f6c 6f72 223a 2223 3341 4133  ,."color":"#3AA3
-0002b960: 4533 222c 2261 7474 6163 686d 656e 745f  E3","attachment_
-0002b970: 7479 7065 223a 2264 6566 6175 6c74 227d  type":"default"}
-0002b980: 5d7d 2720 6874 7470 733a 2f2f 736c 6163  ]}' https://slac
-0002b990: 6b2e 636f 6d2f 6170 692f 6368 6174 2e70  k.com/api/chat.p
-0002b9a0: 6f73 744d 6573 7361 6765 2222 2220 2520  ostMessage""" % 
-0002b9b0: 2873 6c61 636b 746f 6b65 6e2c 0a20 2020  (slacktoken,.   
-0002b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba10: 2020 2020 2020 2020 2020 2020 736c 6163              slac
-0002ba20: 6b63 6861 6e6e 656c 2c20 7469 746c 6529  kchannel, title)
-0002ba30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ba40: 2020 2020 2073 6c61 636b 636d 6420 3d20       slackcmd = 
-0002ba50: 736c 6163 6b63 6d64 2e72 6570 6c61 6365  slackcmd.replace
-0002ba60: 2827 5c6e 272c 2027 2729 0a20 2020 2020  ('\n', '').     
-0002ba70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002ba80: 6d64 732e 6170 7065 6e64 2873 6c61 636b  mds.append(slack
-0002ba90: 636d 6429 0a20 2020 2020 2020 2020 2020  cmd).           
-0002baa0: 2065 6c69 6620 6e6f 7469 6679 6d65 7468   elif notifymeth
-0002bab0: 6f64 203d 3d20 276d 6169 6c27 3a0a 2020  od == 'mail':.  
-0002bac0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002bad0: 206d 6169 6c73 6572 7665 7220 6973 204e   mailserver is N
-0002bae0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002baf0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0002bb00: 2866 224e 6f74 6966 6963 6174 696f 6e20  (f"Notification 
-0002bb10: 7265 7175 6972 6564 2066 6f72 207b 6e61  required for {na
-0002bb20: 6d65 7d20 6275 7420 6d69 7373 696e 6720  me} but missing 
-0002bb30: 6d61 696c 7365 7276 6572 2229 0a20 2020  mailserver").   
-0002bb40: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0002bb50: 6620 6d61 696c 6672 6f6d 2069 7320 4e6f  f mailfrom is No
-0002bb60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002bb70: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-0002bb80: 6622 4e6f 7469 6669 6361 7469 6f6e 2072  f"Notification r
-0002bb90: 6571 7569 7265 6420 666f 7220 7b6e 616d  equired for {nam
-0002bba0: 657d 2062 7574 206d 6973 7369 6e67 206d  e} but missing m
-0002bbb0: 6169 6c66 726f 6d22 290a 2020 2020 2020  ailfrom").      
-0002bbc0: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
-0002bbd0: 6f74 206d 6169 6c74 6f3a 0a20 2020 2020  ot mailto:.     
-0002bbe0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0002bbf0: 6172 6e69 6e67 2866 224e 6f74 6966 6963  arning(f"Notific
-0002bc00: 6174 696f 6e20 7265 7175 6972 6564 2066  ation required f
-0002bc10: 6f72 207b 6e61 6d65 7d20 6275 7420 6d69  or {name} but mi
-0002bc20: 7373 696e 6720 6d61 696c 746f 2229 0a20  ssing mailto"). 
-0002bc30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0002bc40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002bc50: 2020 2020 2020 2020 206e 6f77 203d 2064           now = d
-0002bc60: 6174 6574 696d 652e 6e6f 7728 290a 2020  atetime.now().  
-0002bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bc80: 2020 6e6f 7720 3d20 6e6f 772e 2073 7472    now = now. str
-0002bc90: 6674 696d 6528 2225 612c 2564 2025 6220  ftime("%a,%d %b 
-0002bca0: 2559 2025 483a 254d 3a25 5322 290a 2020  %Y %H:%M:%S").  
-0002bcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bcc0: 2020 746f 7320 3d20 272c 272e 6a6f 696e    tos = ','.join
-0002bcd0: 285b 6622 3c7b 746f 7d3e 2220 666f 7220  ([f"<{to}>" for 
-0002bce0: 746f 2069 6e20 6d61 696c 746f 5d29 0a20  to in mailto]). 
-0002bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd00: 2020 206d 6169 6c63 6f6e 7465 6e74 203d     mailcontent =
-0002bd10: 2066 2246 726f 6d3a 207b 6d61 696c 6672   f"From: {mailfr
-0002bd20: 6f6d 7d20 3c7b 6d61 696c 6672 6f6d 7d3e  om} <{mailfrom}>
-0002bd30: 5c6e 546f 3a20 7b74 6f73 7d5c 6e44 6174  \nTo: {tos}\nDat
-0002bd40: 653a 207b 6e6f 777d 5c6e 5375 626a 6563  e: {now}\nSubjec
-0002bd50: 743a 207b 7469 746c 657d 220a 2020 2020  t: {title}".    
-0002bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd70: 6d61 696c 636d 6420 3d20 5b5d 0a20 2020  mailcmd = [].   
-0002bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd90: 2069 6620 6e6f 7420 636c 7573 7465 723a   if not cluster:
-0002bda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bdb0: 2020 2020 2020 2020 206d 6169 6c63 6d64           mailcmd
-0002bdc0: 2e61 7070 656e 6428 2774 6573 7420 2d66  .append('test -f
-0002bdd0: 202f 6574 632f 6465 6269 616e 5f76 6572   /etc/debian_ver
-0002bde0: 7369 6f6e 2026 2620 6170 742d 6765 7420  sion && apt-get 
-0002bdf0: 2d79 2069 6e73 7461 6c6c 2063 7572 6c27  -y install curl'
-0002be00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002be10: 2020 2020 2020 2020 2020 6d61 696c 636d            mailcm
-0002be20: 642e 6170 7065 6e64 2827 6563 686f 2022  d.append('echo "
-0002be30: 2220 3e3e 202f 7661 722f 746d 702f 6d61  " >> /var/tmp/ma
-0002be40: 696c 2e74 7874 2729 0a20 2020 2020 2020  il.txt').       
-0002be50: 2020 2020 2020 2020 2020 2020 206d 6169               mai
-0002be60: 6c63 6d64 2e61 7070 656e 6428 6627 7b6e  lcmd.append(f'{n
-0002be70: 6f74 6966 7963 6d64 7d20 323e 2631 203e  otifycmd} 2>&1 >
-0002be80: 3e20 2f76 6172 2f74 6d70 2f6d 6169 6c2e  > /var/tmp/mail.
-0002be90: 7478 7427 290a 2020 2020 2020 2020 2020  txt').          
-0002bea0: 2020 2020 2020 2020 2020 6375 726c 636d            curlcm
-0002beb0: 6420 3d20 6622 6375 726c 202d 2d73 696c  d = f"curl --sil
-0002bec0: 656e 7420 2d2d 7572 6c20 736d 7470 3a2f  ent --url smtp:/
-0002bed0: 2f7b 6d61 696c 7365 7276 6572 7d3a 3235  /{mailserver}:25
-0002bee0: 202d 2d6d 6169 6c2d 6672 6f6d 207b 6d61   --mail-from {ma
-0002bef0: 696c 6672 6f6d 7d22 0a20 2020 2020 2020  ilfrom}".       
-0002bf00: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0002bf10: 2061 6464 7265 7373 2069 6e20 6d61 696c   address in mail
-0002bf20: 746f 3a0a 2020 2020 2020 2020 2020 2020  to:.            
-0002bf30: 2020 2020 2020 2020 2020 2020 6375 726c              curl
-0002bf40: 636d 6420 2b3d 2066 2220 2d2d 6d61 696c  cmd += f" --mail
-0002bf50: 2d72 6370 7420 7b61 6464 7265 7373 7d20  -rcpt {address} 
-0002bf60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002bf70: 2020 2020 2020 6966 2063 6c75 7374 6572        if cluster
-0002bf80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002bf90: 2020 2020 2020 2020 2020 6d61 696c 636f            mailco
-0002bfa0: 6e74 656e 7420 3d20 2222 0a20 2020 2020  ntent = "".     
-0002bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bfc0: 2020 206b 7562 6563 6f6e 6669 6720 3d20     kubeconfig = 
-0002bfd0: 6627 2f65 7463 2f6b 7562 6572 6e65 7465  f'/etc/kubernete
-0002bfe0: 732f 6b75 6265 636f 6e66 6967 2e7b 6e61  s/kubeconfig.{na
-0002bff0: 6d65 7d27 0a20 2020 2020 2020 2020 2020  me}'.           
-0002c000: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0002c010: 6c63 6d64 202b 3d20 6627 202d 4820 2253  lcmd += f' -H "S
-0002c020: 7562 6a65 6374 3a20 7b74 6974 6c65 7d22  ubject: {title}"
-0002c030: 202d 4820 2246 726f 6d3a 207b 6d61 696c   -H "From: {mail
-0002c040: 6672 6f6d 7d20 3c7b 6d61 696c 6672 6f6d  from} <{mailfrom
-0002c050: 7d3e 2227 0a20 2020 2020 2020 2020 2020  }>"'.           
-0002c060: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0002c070: 2061 6464 7265 7373 2069 6e20 6d61 696c   address in mail
-0002c080: 746f 3a0a 2020 2020 2020 2020 2020 2020  to:.            
-0002c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c0a0: 6375 726c 636d 6420 2b3d 2066 2720 2d48  curlcmd += f' -H
-0002c0b0: 2022 546f 3a20 7b61 6464 7265 7373 7d20   "To: {address} 
-0002c0c0: 3c7b 6164 6472 6573 737d 3e22 270a 2020  <{address}>"'.  
-0002c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c0e0: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
-0002c0f0: 2027 202d 4620 223d 283b 7479 7065 3d6d   ' -F "=(;type=m
-0002c100: 756c 7469 7061 7274 2f6d 6978 6564 2220  ultipart/mixed" 
-0002c110: 2d46 2022 3d24 2863 6174 202f 7661 722f  -F "=$(cat /var/
-0002c120: 746d 702f 6d61 696c 2e74 7874 293b 7479  tmp/mail.txt);ty
-0002c130: 7065 3d74 6578 742f 706c 6169 6e22 270a  pe=text/plain"'.
-0002c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c150: 2020 2020 2020 2020 6375 726c 636d 6420          curlcmd 
-0002c160: 2b3d 2066 2720 2d46 2022 6669 6c65 3d40  += f' -F "file=@
-0002c170: 7b6b 7562 6563 6f6e 6669 677d 3b74 7970  {kubeconfig};typ
-0002c180: 653d 7465 7874 2f70 6c61 696e 3b65 6e63  e=text/plain;enc
-0002c190: 6f64 6572 3d62 6173 6536 3422 202d 4620  oder=base64" -F 
-0002c1a0: 223d 2922 270a 2020 2020 2020 2020 2020  "=)"'.          
-0002c1b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c1d0: 2020 2020 2020 2020 6375 726c 636d 6420          curlcmd 
-0002c1e0: 2b3d 2022 202d 2d75 706c 6f61 642d 6669  += " --upload-fi
-0002c1f0: 6c65 202f 7661 722f 746d 702f 6d61 696c  le /var/tmp/mail
-0002c200: 2e74 7874 220a 2020 2020 2020 2020 2020  .txt".          
-0002c210: 2020 2020 2020 2020 2020 6d61 696c 636d            mailcm
-0002c220: 642e 6170 7065 6e64 2863 7572 6c63 6d64  d.append(curlcmd
-0002c230: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002c240: 2020 2020 2020 636d 6473 2e65 7874 656e        cmds.exten
-0002c250: 6428 6d61 696c 636d 6429 0a20 2020 2020  d(mailcmd).     
-0002c260: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002c270: 2020 2020 2020 2020 2020 2020 2065 7272               err
-0002c280: 6f72 2866 2249 6e76 616c 6964 206d 6574  or(f"Invalid met
-0002c290: 686f 6420 7b6e 6f74 6966 796d 6574 686f  hod {notifymetho
-0002c2a0: 647d 2229 0a20 2020 2020 2020 2072 6574  d}").        ret
-0002c2b0: 7572 6e20 636d 6473 2c20 6d61 696c 636f  urn cmds, mailco
-0002c2c0: 6e74 656e 740a 0a20 2020 2064 6566 2068  ntent..    def h
-0002c2d0: 616e 646c 655f 766d 5f72 6573 756c 7428  andle_vm_result(
-0002c2e0: 7365 6c66 2c20 6e61 6d65 2c20 7072 6f66  self, name, prof
-0002c2f0: 696c 652c 2072 6573 756c 742c 206e 6577  ile, result, new
-0002c300: 766d 732c 2066 6169 6c65 6476 6d73 2c20  vms, failedvms, 
-0002c310: 6173 796e 6377 6169 7476 6d73 2c20 6f6e  asyncwaitvms, on
-0002c320: 6c79 6173 7365 7473 3d46 616c 7365 2c20  lyassets=False, 
-0002c330: 6e65 7761 7373 6574 733d 5b5d 2c0a 2020  newassets=[],.  
-0002c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c350: 2020 2020 2020 2076 6d63 6c69 656e 743d         vmclient=
-0002c360: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
-0002c370: 6620 2772 6573 756c 7427 2069 6e20 7265  f 'result' in re
-0002c380: 7375 6c74 2061 6e64 2072 6573 756c 745b  sult and result[
-0002c390: 2772 6573 756c 7427 5d20 3d3d 2027 7375  'result'] == 'su
-0002c3a0: 6363 6573 7327 3a0a 2020 2020 2020 2020  ccess':.        
-0002c3b0: 2020 2020 6e65 7776 6d73 2e61 7070 656e      newvms.appen
-0002c3c0: 6428 6e61 6d65 290a 2020 2020 2020 2020  d(name).        
-0002c3d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0002c3e0: 2020 6661 696c 6564 766d 732e 6170 7065    failedvms.appe
-0002c3f0: 6e64 287b 276e 616d 6527 3a20 6e61 6d65  nd({'name': name
-0002c400: 2c20 2772 6561 736f 6e27 3a20 7265 7375  , 'reason': resu
-0002c410: 6c74 5b27 7265 6173 6f6e 275d 7d29 0a20  lt['reason']}). 
-0002c420: 2020 2020 2020 2073 7461 7274 203d 2070         start = p
-0002c430: 726f 6669 6c65 2e67 6574 2827 7374 6172  rofile.get('star
-0002c440: 7427 2c20 5472 7565 290a 2020 2020 2020  t', True).      
-0002c450: 2020 636c 6f75 6469 6e69 7420 3d20 7072    cloudinit = pr
-0002c460: 6f66 696c 652e 6765 7428 2763 6c6f 7564  ofile.get('cloud
-0002c470: 696e 6974 272c 2054 7275 6529 0a20 2020  init', True).   
-0002c480: 2020 2020 2061 7379 6e63 7761 6974 203d       asyncwait =
-0002c490: 2070 726f 6669 6c65 2e67 6574 2827 6173   profile.get('as
-0002c4a0: 796e 6377 6169 7427 2c20 4661 6c73 6529  yncwait', False)
-0002c4b0: 0a20 2020 2020 2020 2066 696e 6973 6866  .        finishf
-0002c4c0: 696c 6573 203d 2070 726f 6669 6c65 2e67  iles = profile.g
-0002c4d0: 6574 2827 6669 6e69 7368 6669 6c65 7327  et('finishfiles'
-0002c4e0: 2c20 5b5d 290a 2020 2020 2020 2020 6966  , []).        if
-0002c4f0: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
-0002c500: 2020 2020 2020 2020 2069 6620 2764 6174           if 'dat
-0002c510: 6127 2069 6e20 7265 7375 6c74 3a0a 2020  a' in result:.  
-0002c520: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0002c530: 7761 7373 6574 732e 6170 7065 6e64 2872  wassets.append(r
-0002c540: 6573 756c 745b 2764 6174 6127 5d29 0a20  esult['data']). 
-0002c550: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002c560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c570: 2065 7272 6f72 2872 6573 756c 745b 2772   error(result['r
-0002c580: 6561 736f 6e27 5d29 0a20 2020 2020 2020  eason']).       
-0002c590: 2069 6620 6e6f 7420 6173 796e 6377 6169   if not asyncwai
-0002c5a0: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
-0002c5b0: 6574 7572 6e0a 2020 2020 2020 2020 656c  eturn.        el
-0002c5c0: 6966 206e 6f74 2073 7461 7274 206f 7220  if not start or 
-0002c5d0: 6e6f 7420 636c 6f75 6469 6e69 7420 6f72  not cloudinit or
-0002c5e0: 2070 726f 6669 6c65 2e67 6574 2827 696d   profile.get('im
-0002c5f0: 6167 6527 2920 6973 204e 6f6e 653a 0a20  age') is None:. 
-0002c600: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0002c610: 7428 6622 536b 6970 7069 6e67 2077 6169  t(f"Skipping wai
-0002c620: 7420 6f6e 207b 6e61 6d65 7d22 290a 2020  t on {name}").  
-0002c630: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002c640: 2020 2020 2020 2020 7761 6974 636f 6d6d          waitcomm
-0002c650: 616e 6420 3d20 7072 6f66 696c 652e 6765  and = profile.ge
-0002c660: 7428 2777 6169 7463 6f6d 6d61 6e64 2729  t('waitcommand')
-0002c670: 0a20 2020 2020 2020 2020 2020 2077 6169  .            wai
-0002c680: 7474 696d 656f 7574 203d 2070 726f 6669  ttimeout = profi
-0002c690: 6c65 2e67 6574 2827 7761 6974 7469 6d65  le.get('waittime
-0002c6a0: 6f75 7427 2c20 3029 0a20 2020 2020 2020  out', 0).       
-0002c6b0: 2020 2020 2061 7379 6e63 7761 6974 766d       asyncwaitvm
-0002c6c0: 203d 207b 276e 616d 6527 3a20 6e61 6d65   = {'name': name
-0002c6d0: 2c20 2766 696e 6973 6866 696c 6573 273a  , 'finishfiles':
-0002c6e0: 2066 696e 6973 6866 696c 6573 2c20 2777   finishfiles, 'w
-0002c6f0: 6169 7463 6f6d 6d61 6e64 273a 2077 6169  aitcommand': wai
-0002c700: 7463 6f6d 6d61 6e64 2c0a 2020 2020 2020  tcommand,.      
+00029f90: 6272 6561 6b0a 0a20 2020 2064 6566 2065  break..    def e
+00029fa0: 7870 6f73 655f 706c 616e 2873 656c 662c  xpose_plan(self,
+00029fb0: 2070 6c61 6e2c 2069 6e70 7574 6669 6c65   plan, inputfile
+00029fc0: 3d4e 6f6e 652c 206f 7665 7272 6964 6573  =None, overrides
+00029fd0: 3d7b 7d2c 2070 6f72 743d 3930 3030 2c20  ={}, port=9000, 
+00029fe0: 7066 6d6f 6465 3d46 616c 7365 2c20 636c  pfmode=False, cl
+00029ff0: 7573 7465 723d 4661 6c73 6529 3a0a 2020  uster=False):.  
+0002a000: 2020 2020 2020 696e 7075 7466 696c 6520        inputfile 
+0002a010: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
+0002a020: 7573 6572 2869 6e70 7574 6669 6c65 290a  user(inputfile).
+0002a030: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0002a040: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
+0002a050: 7075 7466 696c 6529 3a0a 2020 2020 2020  putfile):.      
+0002a060: 2020 2020 2020 6572 726f 7228 224e 6f20        error("No 
+0002a070: 696e 7075 7420 6669 6c65 2066 6f75 6e64  input file found
+0002a080: 206e 6f72 2064 6566 6175 6c74 206b 636c   nor default kcl
+0002a090: 695f 706c 616e 2e79 6d6c 2e4c 6561 7669  i_plan.yml.Leavi
+0002a0a0: 6e67 2e2e 2e2e 2229 0a20 2020 2020 2020  ng....").       
+0002a0b0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+0002a0c0: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
+0002a0d0: 6622 4861 6e64 6c69 6e67 2065 7870 6f73  f"Handling expos
+0002a0e0: 6520 6f66 2070 6c61 6e20 7769 7468 206e  e of plan with n
+0002a0f0: 616d 6520 7b70 6c61 6e7d 2061 6e64 2069  ame {plan} and i
+0002a100: 6e70 7574 6669 6c65 207b 696e 7075 7466  nputfile {inputf
+0002a110: 696c 657d 2229 0a20 2020 2020 2020 206b  ile}").        k
+0002a120: 6578 706f 7365 7220 3d20 4b65 7870 6f73  exposer = Kexpos
+0002a130: 6572 2873 656c 662c 2070 6c61 6e2c 2069  er(self, plan, i
+0002a140: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
+0002a150: 6465 733d 6f76 6572 7269 6465 732c 2070  des=overrides, p
+0002a160: 6f72 743d 706f 7274 2c20 7066 6d6f 6465  ort=port, pfmode
+0002a170: 3d70 666d 6f64 652c 2063 6c75 7374 6572  =pfmode, cluster
+0002a180: 3d63 6c75 7374 6572 290a 2020 2020 2020  =cluster).      
+0002a190: 2020 6b65 7870 6f73 6572 2e72 756e 2829    kexposer.run()
+0002a1a0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+0002a1b0: 5f6f 7065 6e73 6869 6674 5f69 736f 2873  _openshift_iso(s
+0002a1c0: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+0002a1d0: 6572 7269 6465 733d 7b7d 2c20 6967 6e69  errides={}, igni
+0002a1e0: 7469 6f6e 6669 6c65 3d4e 6f6e 652c 2070  tionfile=None, p
+0002a1f0: 6f64 6d61 6e3d 4661 6c73 652c 2069 6e73  odman=False, ins
+0002a200: 7461 6c6c 6572 3d46 616c 7365 2c0a 2020  taller=False,.  
+0002a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a220: 2020 2020 2020 2020 2020 2064 6972 6563             direc
+0002a230: 743d 4661 6c73 6529 3a0a 2020 2020 2020  t=False):.      
+0002a240: 2020 6d65 7461 6c5f 7572 6c20 3d20 4e6f    metal_url = No
+0002a250: 6e65 0a20 2020 2020 2020 2069 736f 5f76  ne.        iso_v
+0002a260: 6572 7369 6f6e 203d 2073 7472 286f 7665  ersion = str(ove
+0002a270: 7272 6964 6573 2e67 6574 2827 7665 7273  rrides.get('vers
+0002a280: 696f 6e27 2c20 276c 6174 6573 7427 2929  ion', 'latest'))
+0002a290: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0002a2a0: 696e 7374 616c 6c65 723a 0a20 2020 2020  installer:.     
+0002a2b0: 2020 2020 2020 2069 6620 6973 6f5f 7665         if iso_ve
+0002a2c0: 7273 696f 6e20 6e6f 7420 696e 205b 276c  rsion not in ['l
+0002a2d0: 6174 6573 7427 2c20 2770 7265 2d72 656c  atest', 'pre-rel
+0002a2e0: 6561 7365 275d 2061 6e64 206e 6f74 2069  ease'] and not i
+0002a2f0: 736f 5f76 6572 7369 6f6e 2e73 7461 7274  so_version.start
+0002a300: 7377 6974 6828 2734 2e27 293a 0a20 2020  swith('4.'):.   
+0002a310: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0002a320: 6e69 6e67 2822 466f 7263 696e 6720 6c69  ning("Forcing li
+0002a330: 7665 2069 736f 2076 6572 7369 6f6e 2074  ve iso version t
+0002a340: 6f20 6c61 7465 7374 2229 0a20 2020 2020  o latest").     
+0002a350: 2020 2020 2020 2020 2020 2069 736f 5f76             iso_v
+0002a360: 6572 7369 6f6e 203d 2027 6c61 7465 7374  ersion = 'latest
+0002a370: 270a 2020 2020 2020 2020 2020 2020 656c  '.            el
+0002a380: 6966 2069 736f 5f76 6572 7369 6f6e 2e73  if iso_version.s
+0002a390: 7461 7274 7377 6974 6828 2734 2e27 293a  tartswith('4.'):
+0002a3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a3b0: 206d 696e 6f72 5f76 6572 7369 6f6e 203d   minor_version =
+0002a3c0: 2069 736f 5f76 6572 7369 6f6e 2e73 706c   iso_version.spl
+0002a3d0: 6974 2827 2e27 295b 315d 0a20 2020 2020  it('.')[1].     
+0002a3e0: 2020 2020 2020 2020 2020 2069 6620 6d69             if mi
+0002a3f0: 6e6f 725f 7665 7273 696f 6e2e 6973 6469  nor_version.isdi
+0002a400: 6769 7428 2920 616e 6420 696e 7428 6d69  git() and int(mi
+0002a410: 6e6f 725f 7665 7273 696f 6e29 203c 2036  nor_version) < 6
+0002a420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002a430: 2020 2020 2020 6d65 7461 6c5f 7572 6c20        metal_url 
+0002a440: 3d20 6622 6874 7470 733a 2f2f 6d69 7272  = f"https://mirr
+0002a450: 6f72 2e6f 7065 6e73 6869 6674 2e63 6f6d  or.openshift.com
+0002a460: 2f70 7562 2f6f 7065 6e73 6869 6674 2d76  /pub/openshift-v
+0002a470: 342f 6465 7065 6e64 656e 6369 6573 2f72  4/dependencies/r
+0002a480: 6863 6f73 2f7b 6973 6f5f 7665 7273 696f  hcos/{iso_versio
+0002a490: 6e7d 2f6c 6174 6573 7422 0a20 2020 2020  n}/latest".     
+0002a4a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0002a4b0: 6574 616c 5f75 726c 202b 3d20 222f 7268  etal_url += "/rh
+0002a4c0: 636f 732d 6d65 7461 6c2e 7838 365f 3634  cos-metal.x86_64
+0002a4d0: 2e72 6177 2e67 7a22 0a20 2020 2020 2020  .raw.gz".       
+0002a4e0: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0002a4f0: 6e69 6e67 2822 456d 6265 6464 696e 6720  ning("Embedding 
+0002a500: 6d65 7461 6c20 7572 6c20 696e 2069 736f  metal url in iso
+0002a510: 2066 6f72 2074 6172 6765 7420 7665 7273   for target vers
+0002a520: 696f 6e20 616e 6420 696e 7374 616c 6c69  ion and installi
+0002a530: 6e67 2077 6974 6820 6120 6d6f 7265 2072  ng with a more r
+0002a540: 6563 656e 7420 6973 6f22 290a 2020 2020  ecent iso").    
+0002a550: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
+0002a560: 7665 7273 696f 6e20 3d20 276c 6174 6573  version = 'lates
+0002a570: 7427 0a20 2020 2020 2020 2061 7069 5f69  t'.        api_i
+0002a580: 7020 3d20 6f76 6572 7269 6465 732e 6765  p = overrides.ge
+0002a590: 7428 2761 7069 5f69 7027 290a 2020 2020  t('api_ip').    
+0002a5a0: 2020 2020 6967 6e69 7469 6f6e 5f76 6572      ignition_ver
+0002a5b0: 7369 6f6e 203d 206f 7665 7272 6964 6573  sion = overrides
+0002a5c0: 2e67 6574 2827 6967 6e69 7469 6f6e 5f76  .get('ignition_v
+0002a5d0: 6572 7369 6f6e 272c 0a20 2020 2020 2020  ersion',.       
+0002a5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a600: 2020 636f 6d6d 6f6e 2e69 676e 6974 696f    common.ignitio
+0002a610: 6e5f 7665 7273 696f 6e28 2272 6863 6f73  n_version("rhcos
+0002a620: 2d25 7322 2025 2069 736f 5f76 6572 7369  -%s" % iso_versi
+0002a630: 6f6e 2e72 6570 6c61 6365 2827 2e27 2c20  on.replace('.', 
+0002a640: 2727 2929 290a 2020 2020 2020 2020 726f  ''))).        ro
+0002a650: 6c65 203d 206f 7665 7272 6964 6573 2e67  le = overrides.g
+0002a660: 6574 2827 726f 6c65 272c 2027 776f 726b  et('role', 'work
+0002a670: 6572 2729 0a20 2020 2020 2020 2069 736f  er').        iso
+0002a680: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+0002a690: 2827 6973 6f27 2c20 5472 7565 290a 2020  ('iso', True).  
+0002a6a0: 2020 2020 2020 646f 6d61 696e 203d 206f        domain = o
+0002a6b0: 7665 7272 6964 6573 2e67 6574 2827 646f  verrides.get('do
+0002a6c0: 6d61 696e 2729 0a20 2020 2020 2020 2069  main').        i
+0002a6d0: 6620 272e 2720 696e 2063 6c75 7374 6572  f '.' in cluster
+0002a6e0: 3a0a 2020 2020 2020 2020 2020 2020 646f  :.            do
+0002a6f0: 6d61 696e 203d 2027 2e27 2e6a 6f69 6e28  main = '.'.join(
+0002a700: 636c 7573 7465 722e 7370 6c69 7428 272e  cluster.split('.
+0002a710: 2729 5b31 3a5d 290a 2020 2020 2020 2020  ')[1:]).        
+0002a720: 2020 2020 7070 7269 6e74 2866 2255 7369      pprint(f"Usi
+0002a730: 6e67 2064 6f6d 6169 6e20 7b64 6f6d 6169  ng domain {domai
+0002a740: 6e7d 2229 0a20 2020 2020 2020 2020 2020  n}").           
+0002a750: 2063 6c75 7374 6572 203d 2063 6c75 7374   cluster = clust
+0002a760: 6572 2e72 6570 6c61 6365 2866 222e 7b64  er.replace(f".{d
+0002a770: 6f6d 6169 6e7d 222c 2027 2729 0a20 2020  omain}", '').   
+0002a780: 2020 2020 2069 6620 636c 7573 7465 722e       if cluster.
+0002a790: 7374 6172 7473 7769 7468 2827 6170 692e  startswith('api.
+0002a7a0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+0002a7b0: 636c 7573 7465 7220 3d20 636c 7573 7465  cluster = cluste
+0002a7c0: 722e 7265 706c 6163 6528 2261 7069 2e22  r.replace("api."
+0002a7d0: 2c20 2727 290a 2020 2020 2020 2020 2020  , '').          
+0002a7e0: 2020 7070 7269 6e74 2866 2255 7369 6e67    pprint(f"Using
+0002a7f0: 2063 6c75 7374 6572 207b 636c 7573 7465   cluster {cluste
+0002a800: 727d 2229 0a20 2020 2020 2020 2068 6f73  r}").        hos
+0002a810: 7473 5f63 6f6e 7465 6e74 203d 204e 6f6e  ts_content = Non
+0002a820: 650a 2020 2020 2020 2020 6669 6e61 6c64  e.        finald
+0002a830: 6174 6120 3d20 4e6f 6e65 0a20 2020 2020  ata = None.     
+0002a840: 2020 2069 6620 6967 6e69 7469 6f6e 6669     if ignitionfi
+0002a850: 6c65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  le is not None:.
+0002a860: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0002a870: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+0002a880: 7328 6967 6e69 7469 6f6e 6669 6c65 293a  s(ignitionfile):
+0002a890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a8a0: 2065 7272 6f72 2866 227b 6967 6e69 7469   error(f"{igniti
+0002a8b0: 6f6e 6669 6c65 7d20 6e6f 7420 666f 756e  onfile} not foun
+0002a8c0: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
+0002a8d0: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+0002a8e0: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
+0002a8f0: 6c64 6174 6120 3d20 6f70 656e 2869 676e  ldata = open(ign
+0002a900: 6974 696f 6e66 696c 6529 2e72 6561 6428  itionfile).read(
+0002a910: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0002a920: 2020 2020 2020 2020 2020 2020 6967 6e69              igni
+0002a930: 7469 6f6e 6669 6c65 203d 2066 227b 726f  tionfile = f"{ro
+0002a940: 6c65 7d2e 6967 6e22 0a20 2020 2020 2020  le}.ign".       
+0002a950: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+0002a960: 6578 6973 7473 2869 676e 6974 696f 6e66  exists(ignitionf
+0002a970: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+0002a980: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+0002a990: 5573 696e 6720 6578 6973 7469 6e67 207b  Using existing {
+0002a9a0: 6967 6e69 7469 6f6e 6669 6c65 7d22 290a  ignitionfile}").
+0002a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a9c0: 6669 6e61 6c64 6174 6120 3d20 6f70 656e  finaldata = open
+0002a9d0: 2869 676e 6974 696f 6e66 696c 6529 2e72  (ignitionfile).r
+0002a9e0: 6561 6428 290a 2020 2020 2020 2020 2020  ead().          
+0002a9f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002aa00: 2020 2020 2020 2020 6966 2061 7069 5f69          if api_i
+0002aa10: 7020 6973 204e 6f6e 653a 0a20 2020 2020  p is None:.     
+0002aa20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002aa30: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0002aa40: 2020 2020 2020 2020 2020 2020 6170 695f              api_
+0002aa50: 6970 203d 2073 6f63 6b65 742e 6765 7468  ip = socket.geth
+0002aa60: 6f73 7462 796e 616d 6528 6627 6170 692e  ostbyname(f'api.
+0002aa70: 7b63 6c75 7374 6572 7d2e 7b64 6f6d 6169  {cluster}.{domai
+0002aa80: 6e7d 2729 0a20 2020 2020 2020 2020 2020  n}').           
+0002aa90: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+0002aaa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002aab0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+0002aac0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002aad0: 2061 7069 5f69 7020 6973 204e 6f6e 653a   api_ip is None:
+0002aae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002aaf0: 2020 2020 2069 6620 646f 6d61 696e 2069       if domain i
+0002ab00: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab20: 6572 726f 7228 2243 6f75 6c64 6e27 7420  error("Couldn't 
+0002ab30: 6669 6775 7265 206f 7574 2061 7069 5f69  figure out api_i
+0002ab40: 7020 6e6f 7220 7265 6c79 206f 6e20 646e  p nor rely on dn
+0002ab50: 7320 7369 6e63 6520 646f 6d61 696e 2069  s since domain i
+0002ab60: 7320 6e6f 7420 7365 7422 290a 2020 2020  s not set").    
+0002ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab80: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+0002ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aba0: 2020 2020 7761 726e 696e 6728 2243 6f75      warning("Cou
+0002abb0: 6c64 6e27 7420 6669 6775 7265 206f 7574  ldn't figure out
+0002abc0: 2061 7069 5f69 702e 2052 656c 7969 6e67   api_ip. Relying
+0002abd0: 206f 6e20 646e 7322 290a 2020 2020 2020   on dns").      
+0002abe0: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+0002abf0: 695f 6970 203d 2066 2261 7069 2e7b 636c  i_ip = f"api.{cl
+0002ac00: 7573 7465 727d 2e7b 646f 6d61 696e 7d22  uster}.{domain}"
+0002ac10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ac20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002ac30: 2020 2020 2020 2020 2020 2068 6f73 7473             hosts
+0002ac40: 5f63 6f6e 7465 6e74 203d 2022 3132 372e  _content = "127.
+0002ac50: 302e 302e 3120 2020 6c6f 6361 6c68 6f73  0.0.1   localhos
+0002ac60: 7420 6c6f 6361 6c68 6f73 742e 6c6f 6361  t localhost.loca
+0002ac70: 6c64 6f6d 6169 6e20 6c6f 6361 6c68 6f73  ldomain localhos
+0002ac80: 7434 206c 6f63 616c 686f 7374 342e 6c6f  t4 localhost4.lo
+0002ac90: 6361 6c64 6f6d 6169 6e34 5c6e 220a 2020  caldomain4\n".  
+0002aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002acb0: 2020 686f 7374 735f 636f 6e74 656e 7420    hosts_content 
+0002acc0: 2b3d 2022 3a3a 3120 2020 2020 2020 2020  += "::1         
+0002acd0: 6c6f 6361 6c68 6f73 7420 6c6f 6361 6c68  localhost localh
+0002ace0: 6f73 742e 6c6f 6361 6c64 6f6d 6169 6e20  ost.localdomain 
+0002acf0: 6c6f 6361 6c68 6f73 7436 206c 6f63 616c  localhost6 local
+0002ad00: 686f 7374 362e 6c6f 6361 6c64 6f6d 6169  host6.localdomai
+0002ad10: 6e36 5c6e 220a 2020 2020 2020 2020 2020  n6\n".          
+0002ad20: 2020 2020 2020 2020 2020 686f 7374 735f            hosts_
+0002ad30: 636f 6e74 656e 7420 2b3d 2066 227b 6170  content += f"{ap
+0002ad40: 695f 6970 7d20 6170 692d 696e 742e 7b63  i_ip} api-int.{c
+0002ad50: 6c75 7374 6572 7d2e 7b64 6f6d 6169 6e7d  luster}.{domain}
+0002ad60: 2061 7069 2e7b 636c 7573 7465 727d 2e7b   api.{cluster}.{
+0002ad70: 646f 6d61 696e 7d22 0a20 2020 2020 2020  domain}".       
+0002ad80: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
+0002ad90: 7468 2e64 6972 6e61 6d65 286f 7065 6e73  th.dirname(opens
+0002ada0: 6869 6674 2e63 7265 6174 652e 5f5f 636f  hift.create.__co
+0002adb0: 6465 5f5f 2e63 6f5f 6669 6c65 6e61 6d65  de__.co_filename
+0002adc0: 290a 2020 2020 2020 2020 7769 7468 206f  ).        with o
+0002add0: 7065 6e28 2269 736f 2e69 676e 222c 2027  pen("iso.ign", '
+0002ade0: 7727 2920 6173 2066 3a0a 2020 2020 2020  w') as f:.      
+0002adf0: 2020 2020 2020 6675 6c6c 5f6e 616d 6520        full_name 
+0002ae00: 3d20 6627 7b63 6c75 7374 6572 7d2e 7b64  = f'{cluster}.{d
+0002ae10: 6f6d 6169 6e7d 2720 6966 2064 6f6d 6169  omain}' if domai
+0002ae20: 6e20 6973 206e 6f74 204e 6f6e 6520 656c  n is not None el
+0002ae30: 7365 2063 6c75 7374 6572 0a20 2020 2020  se cluster.     
+0002ae40: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+0002ae50: 5772 6974 696e 6720 6669 6c65 2069 736f  Writing file iso
+0002ae60: 2e69 676e 2066 6f72 207b 726f 6c65 7d20  .ign for {role} 
+0002ae70: 696e 207b 6675 6c6c 5f6e 616d 657d 2229  in {full_name}")
+0002ae80: 0a20 2020 2020 2020 2020 2020 2069 736f  .            iso
+0002ae90: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+0002aea0: 726e 616d 6528 636f 6d6d 6f6e 2e5f 5f66  rname(common.__f
+0002aeb0: 696c 655f 5f29 0a20 2020 2020 2020 2020  ile__).         
+0002aec0: 2020 2069 6620 6669 6e61 6c64 6174 6120     if finaldata 
+0002aed0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002aee0: 2020 2020 2020 2020 2065 6e76 203d 2045           env = E
+0002aef0: 6e76 6972 6f6e 6d65 6e74 286c 6f61 6465  nvironment(loade
+0002af00: 723d 4669 6c65 5379 7374 656d 4c6f 6164  r=FileSystemLoad
+0002af10: 6572 2869 736f 6469 7229 2c20 6578 7465  er(isodir), exte
+0002af20: 6e73 696f 6e73 3d5b 276a 696e 6a61 322e  nsions=['jinja2.
+0002af30: 6578 742e 646f 275d 2c20 7472 696d 5f62  ext.do'], trim_b
+0002af40: 6c6f 636b 733d 5472 7565 2c0a 2020 2020  locks=True,.    
+0002af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002af60: 2020 2020 2020 2020 2020 2020 2020 6c73                ls
+0002af70: 7472 6970 5f62 6c6f 636b 733d 5472 7565  trip_blocks=True
+0002af80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002af90: 2020 7465 6d70 6c20 3d20 656e 762e 6765    templ = env.ge
+0002afa0: 745f 7465 6d70 6c61 7465 286f 732e 7061  t_template(os.pa
+0002afb0: 7468 2e62 6173 656e 616d 6528 2269 676e  th.basename("ign
+0002afc0: 6974 696f 6e2e 6a32 2229 290a 2020 2020  ition.j2")).    
+0002afd0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+0002afe0: 6f73 7473 5f63 6f6e 7465 6e74 2069 7320  osts_content is 
+0002aff0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0002b000: 2020 2020 2020 2020 2020 2020 2020 686f                ho
+0002b010: 7374 735f 636f 6e74 656e 7420 3d20 6261  sts_content = ba
+0002b020: 7365 3634 2e62 3634 656e 636f 6465 2868  se64.b64encode(h
+0002b030: 6f73 7473 5f63 6f6e 7465 6e74 2e65 6e63  osts_content.enc
+0002b040: 6f64 6528 2929 2e64 6563 6f64 6528 2255  ode()).decode("U
+0002b050: 5446 2d38 2229 0a20 2020 2020 2020 2020  TF-8").         
+0002b060: 2020 2020 2020 2069 6620 273a 2720 696e         if ':' in
+0002b070: 2061 7069 5f69 703a 2020 2023 2049 5076   api_ip:   # IPv
+0002b080: 3620 6164 6472 6573 730a 2020 2020 2020  6 address.      
+0002b090: 2020 2020 2020 2020 2020 2020 2020 6967                ig
+0002b0a0: 6e69 7469 6f6e 5f75 726c 203d 2066 2268  nition_url = f"h
+0002b0b0: 7474 703a 2f2f 5b7b 6170 695f 6970 7d5d  ttp://[{api_ip}]
+0002b0c0: 3a32 3236 3234 2f63 6f6e 6669 672f 7b72  :22624/config/{r
+0002b0d0: 6f6c 657d 220a 2020 2020 2020 2020 2020  ole}".          
+0002b0e0: 2020 2020 2020 656c 7365 3a20 2020 2020        else:     
+0002b0f0: 2020 2020 2020 2020 2020 2320 4950 7634            # IPv4
+0002b100: 2061 6464 7265 7373 0a20 2020 2020 2020   address.       
+0002b110: 2020 2020 2020 2020 2020 2020 2069 676e               ign
+0002b120: 6974 696f 6e5f 7572 6c20 3d20 6622 6874  ition_url = f"ht
+0002b130: 7470 3a2f 2f7b 6170 695f 6970 7d3a 3232  tp://{api_ip}:22
+0002b140: 3632 342f 636f 6e66 6967 2f7b 726f 6c65  624/config/{role
+0002b150: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0002b160: 2020 2066 696e 616c 6461 7461 203d 2074     finaldata = t
+0002b170: 656d 706c 2e72 656e 6465 7228 6967 6e69  empl.render(igni
+0002b180: 7469 6f6e 5f75 726c 3d69 676e 6974 696f  tion_url=ignitio
+0002b190: 6e5f 7572 6c2c 2068 6f73 7473 5f63 6f6e  n_url, hosts_con
+0002b1a0: 7465 6e74 3d68 6f73 7473 5f63 6f6e 7465  tent=hosts_conte
+0002b1b0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0002b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1d0: 2020 2020 2020 2020 2020 2020 2069 676e               ign
+0002b1e0: 6974 696f 6e5f 7665 7273 696f 6e3d 6967  ition_version=ig
+0002b1f0: 6e69 7469 6f6e 5f76 6572 7369 6f6e 290a  nition_version).
+0002b200: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+0002b210: 6972 6563 743a 0a20 2020 2020 2020 2020  irect:.         
+0002b220: 2020 2020 2020 2066 2e77 7269 7465 2866         f.write(f
+0002b230: 696e 616c 6461 7461 290a 2020 2020 2020  inaldata).      
+0002b240: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002b250: 2020 2020 2020 2020 2020 2020 5f66 696c              _fil
+0002b260: 6573 203d 205b 7b22 7061 7468 223a 2022  es = [{"path": "
+0002b270: 2f72 6f6f 742f 636f 6e66 6967 2e69 676e  /root/config.ign
+0002b280: 222c 2022 636f 6e74 656e 7422 3a20 6669  ", "content": fi
+0002b290: 6e61 6c64 6174 617d 5d0a 2020 2020 2020  naldata}].      
+0002b2a0: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+0002b2b0: 7061 7468 2e65 7869 7374 7328 2769 736f  path.exists('iso
+0002b2c0: 2e73 6827 293a 0a20 2020 2020 2020 2020  .sh'):.         
+0002b2d0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0002b2e0: 7428 2255 7369 6e67 206c 6f63 616c 2069  t("Using local i
+0002b2f0: 736f 2e73 6820 7363 7269 7074 2229 0a20  so.sh script"). 
+0002b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b310: 2020 2069 736f 7363 7269 7074 203d 2027     isoscript = '
+0002b320: 6973 6f2e 7368 270a 2020 2020 2020 2020  iso.sh'.        
+0002b330: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b350: 2020 6973 6f73 6372 6970 7420 3d20 6627    isoscript = f'
+0002b360: 7b70 6c61 6e64 6972 7d2f 6973 6f2e 7368  {plandir}/iso.sh
+0002b370: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0002b380: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+0002b390: 7374 7328 276d 6163 732e 7478 7427 293a  sts('macs.txt'):
+0002b3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b3b0: 2020 2020 205f 6669 6c65 732e 6170 7065       _files.appe
+0002b3c0: 6e64 287b 2270 6174 6822 3a20 222f 726f  nd({"path": "/ro
+0002b3d0: 6f74 2f6d 6163 732e 7478 7422 2c20 226f  ot/macs.txt", "o
+0002b3e0: 7269 6769 6e22 3a20 276d 6163 732e 7478  rigin": 'macs.tx
+0002b3f0: 7427 7d29 0a20 2020 2020 2020 2020 2020  t'}).           
+0002b400: 2020 2020 2069 736f 5f6f 7665 7272 6964       iso_overrid
+0002b410: 6573 203d 207b 2773 6372 6970 7473 273a  es = {'scripts':
+0002b420: 205b 6973 6f73 6372 6970 745d 2c20 2766   [isoscript], 'f
+0002b430: 696c 6573 273a 205f 6669 6c65 732c 2027  iles': _files, '
+0002b440: 6d65 7461 6c5f 7572 6c27 3a20 6d65 7461  metal_url': meta
+0002b450: 6c5f 7572 6c2c 2027 6e6f 6e61 6d65 273a  l_url, 'noname':
+0002b460: 2054 7275 652c 0a20 2020 2020 2020 2020   True,.         
+0002b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b480: 2020 2020 2020 2020 2769 6d61 6765 273a          'image':
+0002b490: 2027 7268 636f 7334 3030 3027 7d0a 2020   'rhcos4000'}.  
+0002b4a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002b4b0: 206d 6574 616c 5f75 726c 2069 7320 6e6f   metal_url is no
+0002b4c0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0002b4d0: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
+0002b4e0: 6f76 6572 7269 6465 735b 276e 6565 645f  overrides['need_
+0002b4f0: 6e65 7477 6f72 6b27 5d20 3d20 5472 7565  network'] = True
+0002b500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b510: 2069 736f 5f6f 7665 7272 6964 6573 2e75   iso_overrides.u
+0002b520: 7064 6174 6528 6f76 6572 7269 6465 7329  pdate(overrides)
+0002b530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b540: 2069 6620 276e 616d 6527 2069 6e20 6f76   if 'name' in ov
+0002b550: 6572 7269 6465 733a 0a20 2020 2020 2020  errides:.       
+0002b560: 2020 2020 2020 2020 2020 2020 2069 736f               iso
+0002b570: 5f6e 616d 6520 3d20 6f76 6572 7269 6465  _name = override
+0002b580: 735b 276e 616d 6527 5d0a 2020 2020 2020  s['name'].      
+0002b590: 2020 2020 2020 2020 2020 2020 2020 6973                is
+0002b5a0: 6f5f 6f76 6572 7269 6465 735b 276e 6f6e  o_overrides['non
+0002b5b0: 616d 6527 5d20 3d20 4661 6c73 650a 2020  ame'] = False.  
+0002b5c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0002b5d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002b5e0: 2020 2020 2020 2020 6973 6f5f 6e61 6d65          iso_name
+0002b5f0: 203d 2027 6175 746f 696e 7374 616c 6c65   = 'autoinstalle
+0002b600: 7227 0a20 2020 2020 2020 2020 2020 2020  r'.             
+0002b610: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
+0002b620: 2e63 7265 6174 655f 766d 2869 736f 5f6e  .create_vm(iso_n
+0002b630: 616d 652c 206f 7665 7272 6964 6573 3d69  ame, overrides=i
+0002b640: 736f 5f6f 7665 7272 6964 6573 2c20 6f6e  so_overrides, on
+0002b650: 6c79 6173 7365 7473 3d54 7275 6529 0a20  lyassets=True). 
+0002b660: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002b670: 6620 2772 6561 736f 6e27 2069 6e20 7265  f 'reason' in re
+0002b680: 7375 6c74 3a0a 2020 2020 2020 2020 2020  sult:.          
+0002b690: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+0002b6a0: 7265 7375 6c74 5b27 7265 6173 6f6e 275d  result['reason']
+0002b6b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002b6c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002b6d0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+0002b6e0: 6974 6528 7265 7375 6c74 5b27 7573 6572  ite(result['user
+0002b6f0: 6461 7461 275d 290a 2020 2020 2020 2020  data']).        
+0002b700: 6966 2069 736f 3a0a 2020 2020 2020 2020  if iso:.        
+0002b710: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
+0002b720: 206e 6f74 2069 6e20 5b27 6b76 6d27 2c20   not in ['kvm', 
+0002b730: 2766 616b 6527 2c20 276b 7562 6576 6972  'fake', 'kubevir
+0002b740: 7427 2c20 2776 7370 6865 7265 272c 2027  t', 'vsphere', '
+0002b750: 6f70 656e 7374 6163 6b27 5d3a 0a20 2020  openstack']:.   
+0002b760: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0002b770: 6e69 6e67 2866 2249 736f 2067 656e 6572  ning(f"Iso gener
+0002b780: 6174 696f 6e20 6e6f 7420 7375 7070 6f72  ation not suppor
+0002b790: 7465 6420 6f6e 207b 7365 6c66 2e74 7970  ted on {self.typ
+0002b7a0: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0002b7b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002b7c0: 2020 2020 2020 2069 736f 5f70 6f6f 6c20         iso_pool 
+0002b7d0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+0002b7e0: 2770 6f6f 6c27 2920 6f72 2073 656c 662e  'pool') or self.
+0002b7f0: 706f 6f6c 0a20 2020 2020 2020 2020 2020  pool.           
+0002b800: 2020 2020 2067 656e 6572 6174 655f 7268       generate_rh
+0002b810: 636f 735f 6973 6f28 7365 6c66 2e6b 2c20  cos_iso(self.k, 
+0002b820: 6622 7b63 6c75 7374 6572 7d2d 7b72 6f6c  f"{cluster}-{rol
+0002b830: 657d 222c 2069 736f 5f70 6f6f 6c2c 2076  e}", iso_pool, v
+0002b840: 6572 7369 6f6e 3d69 736f 5f76 6572 7369  ersion=iso_versi
+0002b850: 6f6e 2c20 706f 646d 616e 3d70 6f64 6d61  on, podman=podma
+0002b860: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0002b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b880: 2020 2020 2020 696e 7374 616c 6c65 723d        installer=
+0002b890: 696e 7374 616c 6c65 7229 0a0a 2020 2020  installer)..    
+0002b8a0: 6465 6620 6372 6561 7465 5f6f 7065 6e73  def create_opens
+0002b8b0: 6869 6674 5f64 6973 636f 6e6e 6563 7465  hift_disconnecte
+0002b8c0: 6428 7365 6c66 2c20 706c 616e 2c20 6f76  d(self, plan, ov
+0002b8d0: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
+0002b8e0: 2020 2020 2064 6174 6120 3d20 6f76 6572       data = over
+0002b8f0: 7269 6465 730a 2020 2020 2020 2020 706c  rides.        pl
+0002b900: 616e 6469 7220 3d20 6f73 2e70 6174 682e  andir = os.path.
+0002b910: 6469 726e 616d 6528 6f70 656e 7368 6966  dirname(openshif
+0002b920: 742e 6372 6561 7465 2e5f 5f63 6f64 655f  t.create.__code_
+0002b930: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
+0002b940: 2020 2020 2020 2063 6c75 7374 6572 203d         cluster =
+0002b950: 2064 6174 612e 6765 7428 2763 6c75 7374   data.get('clust
+0002b960: 6572 272c 2027 6d79 6f70 656e 7368 6966  er', 'myopenshif
+0002b970: 7427 290a 2020 2020 2020 2020 7570 7374  t').        upst
+0002b980: 7265 616d 203d 2064 6174 612e 6765 7428  ream = data.get(
+0002b990: 2775 7073 7472 6561 6d27 2c20 4661 6c73  'upstream', Fals
+0002b9a0: 6529 0a20 2020 2020 2020 2076 6572 7369  e).        versi
+0002b9b0: 6f6e 203d 2064 6174 612e 6765 7428 2776  on = data.get('v
+0002b9c0: 6572 7369 6f6e 272c 2027 7374 6162 6c65  ersion', 'stable
+0002b9d0: 2729 0a20 2020 2020 2020 2074 6167 203d  ').        tag =
+0002b9e0: 2064 6174 612e 6765 7428 2774 6167 272c   data.get('tag',
+0002b9f0: 204f 5045 4e53 4849 4654 5f54 4147 290a   OPENSHIFT_TAG).
+0002ba00: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002ba10: 2255 7369 6e67 2076 6572 7369 6f6e 207b  "Using version {
+0002ba20: 7665 7273 696f 6e7d 2061 6e64 2074 6167  version} and tag
+0002ba30: 207b 7461 677d 2229 0a20 2020 2020 2020   {tag}").       
+0002ba40: 2064 6973 636f 6e6e 6563 7465 645f 766d   disconnected_vm
+0002ba50: 203d 2066 227b 636c 7573 7465 727d 2d64   = f"{cluster}-d
+0002ba60: 6973 636f 6e6e 6563 7465 6422 0a20 2020  isconnected".   
+0002ba70: 2020 2020 2064 6973 636f 6e6e 6563 7465       disconnecte
+0002ba80: 645f 7265 7573 6520 3d20 6461 7461 2e67  d_reuse = data.g
+0002ba90: 6574 2827 6469 7363 6f6e 6e65 6374 6564  et('disconnected
+0002baa0: 5f72 6575 7365 272c 2046 616c 7365 290a  _reuse', False).
+0002bab0: 2020 2020 2020 2020 6469 7363 6f6e 6e65          disconne
+0002bac0: 6374 6564 5f73 796e 6320 3d20 6461 7461  cted_sync = data
+0002bad0: 2e67 6574 2827 6469 7363 6f6e 6e65 6374  .get('disconnect
+0002bae0: 6564 5f73 796e 6327 2c20 5472 7565 290a  ed_sync', True).
+0002baf0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002bb00: 2244 6570 6c6f 7969 6e67 2064 6973 636f  "Deploying disco
+0002bb10: 6e6e 6563 7465 6420 766d 207b 6469 7363  nnected vm {disc
+0002bb20: 6f6e 6e65 6374 6564 5f76 6d7d 2229 0a20  onnected_vm}"). 
+0002bb30: 2020 2020 2020 2069 6620 6469 7363 6f6e         if discon
+0002bb40: 6e65 6374 6564 5f73 796e 633a 0a20 2020  nected_sync:.   
+0002bb50: 2020 2020 2020 2020 2070 756c 6c5f 7365           pull_se
+0002bb60: 6372 6574 203d 2070 7764 5f70 6174 6828  cret = pwd_path(
+0002bb70: 6461 7461 2e67 6574 2827 7075 6c6c 5f73  data.get('pull_s
+0002bb80: 6563 7265 7427 2929 2069 6620 6e6f 7420  ecret')) if not 
+0002bb90: 7570 7374 7265 616d 2065 6c73 6520 6622  upstream else f"
+0002bba0: 7b70 6c61 6e64 6972 7d2f 6661 6b65 5f70  {plandir}/fake_p
+0002bbb0: 756c 6c2e 6a73 6f6e 220a 2020 2020 2020  ull.json".      
+0002bbc0: 2020 2020 2020 6966 206e 6f74 2075 7073        if not ups
+0002bbd0: 7472 6561 6d3a 0a20 2020 2020 2020 2020  tream:.         
+0002bbe0: 2020 2020 2020 2070 756c 6c5f 7365 6372         pull_secr
+0002bbf0: 6574 203d 2070 7764 5f70 6174 6828 6461  et = pwd_path(da
+0002bc00: 7461 2e67 6574 2827 7075 6c6c 5f73 6563  ta.get('pull_sec
+0002bc10: 7265 7427 2c20 276f 7065 6e73 6869 6674  ret', 'openshift
+0002bc20: 5f70 756c 6c2e 6a73 6f6e 2729 290a 2020  _pull.json')).  
+0002bc30: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0002bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc50: 7075 6c6c 5f73 6563 7265 7420 3d20 6622  pull_secret = f"
+0002bc60: 7b70 6c61 6e64 6972 7d2f 6661 6b65 5f70  {plandir}/fake_p
+0002bc70: 756c 6c2e 6a73 6f6e 220a 2020 2020 2020  ull.json".      
+0002bc80: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+0002bc90: 7061 7468 2e65 7869 7374 7328 7075 6c6c  path.exists(pull
+0002bca0: 5f73 6563 7265 7429 3a0a 2020 2020 2020  _secret):.      
+0002bcb0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+0002bcc0: 6622 4d69 7373 696e 6720 7075 6c6c 2073  f"Missing pull s
+0002bcd0: 6563 7265 7420 6669 6c65 207b 7075 6c6c  ecret file {pull
+0002bce0: 5f73 6563 7265 747d 2229 0a20 2020 2020  _secret}").     
+0002bcf0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+0002bd00: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+0002bd10: 2020 2064 6174 615b 2770 756c 6c5f 7365     data['pull_se
+0002bd20: 6372 6574 275d 203d 2072 652e 7375 6228  cret'] = re.sub(
+0002bd30: 7222 5c73 222c 2022 222c 206f 7065 6e28  r"\s", "", open(
+0002bd40: 7075 6c6c 5f73 6563 7265 7429 2e72 6561  pull_secret).rea
+0002bd50: 6428 2929 0a20 2020 2020 2020 2064 6973  d()).        dis
+0002bd60: 636f 6e6e 6563 7465 645f 706c 616e 203d  connected_plan =
+0002bd70: 2066 227b 706c 616e 7d2d 7265 7573 6522   f"{plan}-reuse"
+0002bd80: 2069 6620 6469 7363 6f6e 6e65 6374 6564   if disconnected
+0002bd90: 5f72 6575 7365 2065 6c73 6520 706c 616e  _reuse else plan
+0002bda0: 0a20 2020 2020 2020 2069 6620 7665 7273  .        if vers
+0002bdb0: 696f 6e20 3d3d 2027 6369 2720 616e 6420  ion == 'ci' and 
+0002bdc0: 2764 6973 636f 6e6e 6563 7465 645f 6f72  'disconnected_or
+0002bdd0: 6967 696e 2720 6e6f 7420 696e 206f 7665  igin' not in ove
+0002bde0: 7272 6964 6573 3a0a 2020 2020 2020 2020  rrides:.        
+0002bdf0: 2020 2020 7265 6720 3d20 2772 6567 6973      reg = 'regis
+0002be00: 7472 792e 6275 696c 6430 312e 6369 2e6f  try.build01.ci.o
+0002be10: 7065 6e73 6869 6674 2e6f 7267 2720 6966  penshift.org' if
+0002be20: 2073 7472 2874 6167 292e 7374 6172 7473   str(tag).starts
+0002be30: 7769 7468 2827 6369 2d27 2920 656c 7365  with('ci-') else
+0002be40: 2027 7265 6769 7374 7279 2e63 692e 6f70   'registry.ci.op
+0002be50: 656e 7368 6966 742e 6f72 6727 0a20 2020  enshift.org'.   
+0002be60: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0002be70: 2866 2246 6f72 6369 6e67 2064 6973 636f  (f"Forcing disco
+0002be80: 6e6e 6563 7465 645f 6f72 6967 696e 2074  nnected_origin t
+0002be90: 6f20 7b72 6567 7d22 290a 2020 2020 2020  o {reg}").      
+0002bea0: 2020 2020 2020 6461 7461 5b27 6469 7363        data['disc
+0002beb0: 6f6e 6e65 6374 6564 5f6f 7269 6769 6e27  onnected_origin'
+0002bec0: 5d20 3d20 7265 670a 2020 2020 2020 2020  ] = reg.        
+0002bed0: 7265 7375 6c74 203d 2073 656c 662e 706c  result = self.pl
+0002bee0: 616e 2864 6973 636f 6e6e 6563 7465 645f  an(disconnected_
+0002bef0: 706c 616e 2c20 696e 7075 7466 696c 653d  plan, inputfile=
+0002bf00: 6627 7b70 6c61 6e64 6972 7d2f 6469 7363  f'{plandir}/disc
+0002bf10: 6f6e 6e65 6374 6564 2e79 6d6c 272c 206f  onnected.yml', o
+0002bf20: 7665 7272 6964 6573 3d64 6174 6129 0a20  verrides=data). 
+0002bf30: 2020 2020 2020 2069 6620 7265 7375 6c74         if result
+0002bf40: 5b27 7265 7375 6c74 275d 2021 3d20 2773  ['result'] != 's
+0002bf50: 7563 6365 7373 273a 0a20 2020 2020 2020  uccess':.       
+0002bf60: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+0002bf70: 0a20 2020 2020 2020 2065 6c69 6620 6469  .        elif di
+0002bf80: 7363 6f6e 6e65 6374 6564 5f73 796e 633a  sconnected_sync:
+0002bf90: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+0002bfa0: 696e 7428 2255 7365 2074 6865 2066 6f6c  int("Use the fol
+0002bfb0: 6c6f 7769 6e67 204f 5045 4e53 4849 4654  lowing OPENSHIFT
+0002bfc0: 5f49 4e53 5441 4c4c 5f52 454c 4541 5345  _INSTALL_RELEASE
+0002bfd0: 5f49 4d41 4745 5f4f 5645 5252 4944 4522  _IMAGE_OVERRIDE"
+0002bfe0: 290a 2020 2020 2020 2020 2020 2020 6e61  ).            na
+0002bff0: 6d65 203d 2064 6174 612e 6765 7428 2764  me = data.get('d
+0002c000: 6973 636f 6e6e 6563 7465 645f 7265 7573  isconnected_reus
+0002c010: 655f 6e61 6d65 2729 206f 7220 636c 7573  e_name') or clus
+0002c020: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
+0002c030: 6970 2c20 766d 706f 7274 203d 205f 7373  ip, vmport = _ss
+0002c040: 685f 6372 6564 656e 7469 616c 7328 7365  h_credentials(se
+0002c050: 6c66 2e6b 2c20 6627 7b6e 616d 657d 2d64  lf.k, f'{name}-d
+0002c060: 6973 636f 6e6e 6563 7465 6427 295b 313a  isconnected')[1:
+0002c070: 5d0a 2020 2020 2020 2020 2020 2020 636d  ].            cm
+0002c080: 6420 3d20 2263 6174 202f 726f 6f74 2f76  d = "cat /root/v
+0002c090: 6572 7369 6f6e 2e74 7874 220a 2020 2020  ersion.txt".    
+0002c0a0: 2020 2020 2020 2020 7373 6863 6d64 203d          sshcmd =
+0002c0b0: 2073 7368 286e 616d 652c 2069 703d 6970   ssh(name, ip=ip
+0002c0c0: 2c20 7573 6572 3d27 726f 6f74 272c 2074  , user='root', t
+0002c0d0: 756e 6e65 6c3d 7365 6c66 2e74 756e 6e65  unnel=self.tunne
+0002c0e0: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+0002c0f0: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
+0002c100: 656c 686f 7374 3d73 656c 662e 7475 6e6e  elhost=self.tunn
+0002c110: 656c 686f 7374 2c20 7475 6e6e 656c 706f  elhost, tunnelpo
+0002c120: 7274 3d73 656c 662e 7475 6e6e 656c 706f  rt=self.tunnelpo
+0002c130: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+0002c140: 2020 2020 2020 2020 2020 2020 2074 756e               tun
+0002c150: 6e65 6c75 7365 723d 7365 6c66 2e74 756e  neluser=self.tun
+0002c160: 6e65 6c75 7365 722c 2069 6e73 6563 7572  neluser, insecur
+0002c170: 653d 5472 7565 2c20 636d 643d 636d 642c  e=True, cmd=cmd,
+0002c180: 2076 6d70 6f72 743d 766d 706f 7274 290a   vmport=vmport).
+0002c190: 2020 2020 2020 2020 2020 2020 6f73 2e73              os.s
+0002c1a0: 7973 7465 6d28 7373 6863 6d64 290a 0a20  ystem(sshcmd).. 
+0002c1b0: 2020 2064 6566 2068 616e 646c 655f 6669     def handle_fi
+0002c1c0: 6e69 7368 6669 6c65 7328 7365 6c66 2c20  nishfiles(self, 
+0002c1d0: 6e61 6d65 2c20 6669 6e69 7368 6669 6c65  name, finishfile
+0002c1e0: 732c 2069 6465 6e74 6974 7966 696c 653d  s, identityfile=
+0002c1f0: 4e6f 6e65 2c20 766d 636c 6965 6e74 3d4e  None, vmclient=N
+0002c200: 6f6e 6529 3a0a 2020 2020 2020 2020 636f  one):.        co
+0002c210: 6e66 6967 203d 204b 636f 6e66 6967 2863  nfig = Kconfig(c
+0002c220: 6c69 656e 743d 766d 636c 6965 6e74 2920  lient=vmclient) 
+0002c230: 6966 2076 6d63 6c69 656e 7420 6973 206e  if vmclient is n
+0002c240: 6f74 204e 6f6e 6520 656c 7365 2073 656c  ot None else sel
+0002c250: 660a 2020 2020 2020 2020 6b20 3d20 636f  f.        k = co
+0002c260: 6e66 6967 2e6b 0a20 2020 2020 2020 2063  nfig.k.        c
+0002c270: 7572 7265 6e74 5f69 7020 3d20 636f 6d6d  urrent_ip = comm
+0002c280: 6f6e 2e5f 7373 685f 6372 6564 656e 7469  on._ssh_credenti
+0002c290: 616c 7328 6b2c 206e 616d 6529 5b31 5d0a  als(k, name)[1].
+0002c2a0: 2020 2020 2020 2020 666f 7220 6669 6e69          for fini
+0002c2b0: 7368 6669 6c65 2069 6e20 6669 6e69 7368  shfile in finish
+0002c2c0: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+0002c2d0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0002c2e0: 2866 696e 6973 6866 696c 652c 2073 7472  (finishfile, str
+0002c2f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002c300: 2020 2064 6573 7469 6e61 7469 6f6e 203d     destination =
+0002c310: 2027 2e27 0a20 2020 2020 2020 2020 2020   '.'.           
+0002c320: 2020 2020 2073 6f75 7263 6520 3d20 6669       source = fi
+0002c330: 6e69 7368 6669 6c65 2069 6620 272f 2720  nishfile if '/' 
+0002c340: 696e 2066 696e 6973 6866 696c 6520 656c  in finishfile el
+0002c350: 7365 2066 272f 726f 6f74 2f7b 6669 6e69  se f'/root/{fini
+0002c360: 7368 6669 6c65 7d27 0a20 2020 2020 2020  shfile}'.       
+0002c370: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0002c380: 616e 6365 2866 696e 6973 6866 696c 652c  ance(finishfile,
+0002c390: 2064 6963 7429 2061 6e64 2027 6f72 6967   dict) and 'orig
+0002c3a0: 696e 2720 696e 2066 696e 6973 6866 696c  in' in finishfil
+0002c3b0: 6520 616e 6420 2770 6174 6827 2069 6e20  e and 'path' in 
+0002c3c0: 6669 6e69 7368 6669 6c65 3a0a 2020 2020  finishfile:.    
+0002c3d0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+0002c3e0: 6365 2c20 6465 7374 696e 6174 696f 6e20  ce, destination 
+0002c3f0: 3d20 6669 6e69 7368 6669 6c65 2e67 6574  = finishfile.get
+0002c400: 2827 6f72 6967 696e 2729 2c20 6f73 2e70  ('origin'), os.p
+0002c410: 6174 682e 6578 7061 6e64 7573 6572 2866  ath.expanduser(f
+0002c420: 696e 6973 6866 696c 652e 6765 7428 2770  inishfile.get('p
+0002c430: 6174 6827 2c20 272e 2729 290a 2020 2020  ath', '.')).    
+0002c440: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002c450: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0002c460: 726e 696e 6728 6622 496e 636f 7272 6563  rning(f"Incorrec
+0002c470: 7420 6669 6e69 7368 6669 6c65 2065 6e74  t finishfile ent
+0002c480: 7279 207b 6669 6e69 7368 6669 6c65 7d2e  ry {finishfile}.
+0002c490: 2053 6b69 7070 696e 6722 290a 2020 2020   Skipping").    
+0002c4a0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0002c4b0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0002c4c0: 2073 6370 636d 6420 3d20 636f 6d6d 6f6e   scpcmd = common
+0002c4d0: 2e73 6370 286e 616d 652c 2069 703d 6375  .scp(name, ip=cu
+0002c4e0: 7272 656e 745f 6970 2c20 7573 6572 3d27  rrent_ip, user='
+0002c4f0: 726f 6f74 272c 2073 6f75 7263 653d 736f  root', source=so
+0002c500: 7572 6365 2c20 6465 7374 696e 6174 696f  urce, destinatio
+0002c510: 6e3d 6465 7374 696e 6174 696f 6e2c 0a20  n=destination,. 
+0002c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c530: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002c540: 756e 6e65 6c3d 636f 6e66 6967 2e74 756e  unnel=config.tun
+0002c550: 6e65 6c2c 2074 756e 6e65 6c68 6f73 743d  nel, tunnelhost=
+0002c560: 636f 6e66 6967 2e74 756e 6e65 6c68 6f73  config.tunnelhos
+0002c570: 742c 2074 756e 6e65 6c70 6f72 743d 636f  t, tunnelport=co
+0002c580: 6e66 6967 2e74 756e 6e65 6c70 6f72 742c  nfig.tunnelport,
+0002c590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c5b0: 2074 756e 6e65 6c75 7365 723d 7365 6c66   tunneluser=self
+0002c5c0: 2e74 756e 6e65 6c75 7365 722c 2064 6f77  .tunneluser, dow
+0002c5d0: 6e6c 6f61 643d 5472 7565 2c20 696e 7365  nload=True, inse
+0002c5e0: 6375 7265 3d54 7275 652c 2069 6465 6e74  cure=True, ident
+0002c5f0: 6974 7966 696c 653d 6964 656e 7469 7479  ityfile=identity
+0002c600: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+0002c610: 2020 6f73 2e73 7973 7465 6d28 7363 7063    os.system(scpc
+0002c620: 6d64 290a 0a20 2020 2064 6566 2068 616e  md)..    def han
+0002c630: 646c 655f 6e6f 7469 6669 6361 7469 6f6e  dle_notification
+0002c640: 7328 7365 6c66 2c20 6e61 6d65 2c20 6e6f  s(self, name, no
+0002c650: 7469 6679 6d65 7468 6f64 733d 5b5d 2c20  tifymethods=[], 
+0002c660: 7075 7368 6275 6c6c 6574 746f 6b65 6e3d  pushbullettoken=
+0002c670: 4e6f 6e65 2c20 6e6f 7469 6679 7363 7269  None, notifyscri
+0002c680: 7074 3d4e 6f6e 652c 206e 6f74 6966 7963  pt=None, notifyc
+0002c690: 6d64 3d4e 6f6e 652c 0a20 2020 2020 2020  md=None,.       
+0002c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c6b0: 2020 2020 2020 736c 6163 6b63 6861 6e6e        slackchann
+0002c6c0: 656c 3d4e 6f6e 652c 2073 6c61 636b 746f  el=None, slackto
+0002c6d0: 6b65 6e3d 4e6f 6e65 2c20 6d61 696c 7365  ken=None, mailse
+0002c6e0: 7276 6572 3d4e 6f6e 652c 206d 6169 6c66  rver=None, mailf
+0002c6f0: 726f 6d3d 4e6f 6e65 2c20 6d61 696c 746f  rom=None, mailto
+0002c700: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
 0002c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c720: 2020 2020 2027 7761 6974 7469 6d65 6f75       'waittimeou
-0002c730: 7427 3a20 7761 6974 7469 6d65 6f75 742c  t': waittimeout,
-0002c740: 2027 766d 636c 6965 6e74 273a 2076 6d63   'vmclient': vmc
-0002c750: 6c69 656e 747d 0a20 2020 2020 2020 2020  lient}.         
-0002c760: 2020 2061 7379 6e63 7761 6974 766d 732e     asyncwaitvms.
-0002c770: 6170 7065 6e64 2861 7379 6e63 7761 6974  append(asyncwait
-0002c780: 766d 290a 0a20 2020 2064 6566 2074 6872  vm)..    def thr
-0002c790: 6561 6465 645f 6372 6561 7465 5f76 6d28  eaded_create_vm(
-0002c7a0: 7365 6c66 2c20 6e61 6d65 2c20 7072 6f66  self, name, prof
-0002c7b0: 696c 656e 616d 652c 2063 7572 7265 6e74  ilename, current
-0002c7c0: 6f76 6572 7269 6465 732c 2070 726f 6669  overrides, profi
-0002c7d0: 6c65 2c20 7a2c 2070 6c61 6e2c 2063 7572  le, z, plan, cur
-0002c7e0: 7265 6e74 706c 616e 6469 722c 2076 6d63  rentplandir, vmc
-0002c7f0: 6c69 656e 742c 0a20 2020 2020 2020 2020  lient,.         
-0002c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c810: 2020 6f6e 666c 792c 206f 6e6c 7961 7373    onfly, onlyass
-0002c820: 6574 732c 206e 6577 766d 732c 2066 6169  ets, newvms, fai
-0002c830: 6c65 6476 6d73 2c20 6173 796e 6377 6169  ledvms, asyncwai
-0002c840: 7476 6d73 2c20 6e65 7761 7373 6574 7329  tvms, newassets)
-0002c850: 3a0a 2020 2020 2020 2020 7265 7375 6c74  :.        result
-0002c860: 203d 2073 656c 662e 6372 6561 7465 5f76   = self.create_v
-0002c870: 6d28 6e61 6d65 2c20 7072 6f66 696c 656e  m(name, profilen
-0002c880: 616d 652c 206f 7665 7272 6964 6573 3d63  ame, overrides=c
-0002c890: 7572 7265 6e74 6f76 6572 7269 6465 732c  urrentoverrides,
-0002c8a0: 2063 7573 746f 6d70 726f 6669 6c65 3d70   customprofile=p
-0002c8b0: 726f 6669 6c65 2c20 6b3d 7a2c 0a20 2020  rofile, k=z,.   
-0002c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c8d0: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
-0002c8e0: 6e3d 706c 616e 2c20 6261 7365 6469 723d  n=plan, basedir=
-0002c8f0: 6375 7272 656e 7470 6c61 6e64 6972 2c20  currentplandir, 
-0002c900: 636c 6965 6e74 3d76 6d63 6c69 656e 742c  client=vmclient,
-0002c910: 206f 6e66 6c79 3d6f 6e66 6c79 2c0a 2020   onfly=onfly,.  
-0002c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c930: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
-0002c940: 6c79 6173 7365 7473 3d6f 6e6c 7961 7373  lyassets=onlyass
-0002c950: 6574 7329 0a20 2020 2020 2020 2069 6620  ets).        if 
-0002c960: 6e6f 7420 6f6e 6c79 6173 7365 7473 3a0a  not onlyassets:.
-0002c970: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
-0002c980: 6f6e 2e68 616e 646c 655f 7265 7370 6f6e  on.handle_respon
-0002c990: 7365 2872 6573 756c 742c 206e 616d 652c  se(result, name,
-0002c9a0: 2063 6c69 656e 743d 766d 636c 6965 6e74   client=vmclient
-0002c9b0: 290a 2020 2020 2020 2020 7365 6c66 2e68  ).        self.h
-0002c9c0: 616e 646c 655f 766d 5f72 6573 756c 7428  andle_vm_result(
-0002c9d0: 6e61 6d65 2c20 7072 6f66 696c 652c 2072  name, profile, r
-0002c9e0: 6573 756c 743d 7265 7375 6c74 2c20 6e65  esult=result, ne
-0002c9f0: 7776 6d73 3d6e 6577 766d 732c 2066 6169  wvms=newvms, fai
-0002ca00: 6c65 6476 6d73 3d66 6169 6c65 6476 6d73  ledvms=failedvms
-0002ca10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca30: 6173 796e 6377 6169 7476 6d73 3d61 7379  asyncwaitvms=asy
-0002ca40: 6e63 7761 6974 766d 732c 206f 6e6c 7961  ncwaitvms, onlya
-0002ca50: 7373 6574 733d 6f6e 6c79 6173 7365 7473  ssets=onlyassets
-0002ca60: 2c20 6e65 7761 7373 6574 733d 6e65 7761  , newassets=newa
-0002ca70: 7373 6574 732c 2076 6d63 6c69 656e 743d  ssets, vmclient=
-0002ca80: 766d 636c 6965 6e74 290a 0a20 2020 2064  vmclient)..    d
-0002ca90: 6566 2070 6172 7365 5f66 696c 6573 2873  ef parse_files(s
-0002caa0: 656c 662c 206e 616d 652c 2066 696c 6573  elf, name, files
-0002cab0: 2c20 6261 7365 6469 723d 272e 272c 206f  , basedir='.', o
-0002cac0: 6e66 6c79 3d4e 6f6e 6529 3a0a 2020 2020  nfly=None):.    
-0002cad0: 2020 2020 6966 206e 6f74 2066 696c 6573      if not files
-0002cae0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0002caf0: 7475 726e 0a20 2020 2020 2020 2066 6f72  turn.        for
-0002cb00: 2069 6e64 6578 2c20 6669 6c20 696e 2065   index, fil in e
-0002cb10: 6e75 6d65 7261 7465 2866 696c 6573 293a  numerate(files):
-0002cb20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002cb30: 6973 696e 7374 616e 6365 2866 696c 2c20  isinstance(fil, 
-0002cb40: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-0002cb50: 2020 2020 2020 7061 7468 203d 2066 222f        path = f"/
-0002cb60: 726f 6f74 2f7b 6669 6c7d 220a 2020 2020  root/{fil}".    
-0002cb70: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-0002cb80: 6173 6564 6972 2021 3d20 272e 273a 0a20  asedir != '.':. 
-0002cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cba0: 2020 206f 7269 6769 6e20 3d20 6622 7b62     origin = f"{b
-0002cbb0: 6173 6564 6972 7d2f 7b70 6174 687d 220a  asedir}/{path}".
-0002cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cbd0: 6f72 6967 696e 203d 2066 696c 0a20 2020  origin = fil.   
-0002cbe0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0002cbf0: 7465 6e74 203d 204e 6f6e 650a 2020 2020  tent = None.    
-0002cc00: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0002cc10: 735b 696e 6465 785d 203d 207b 2770 6174  s[index] = {'pat
-0002cc20: 6827 3a20 7061 7468 2c20 276f 7269 6769  h': path, 'origi
-0002cc30: 6e27 3a20 6f72 6967 696e 7d0a 2020 2020  n': origin}.    
-0002cc40: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-0002cc50: 6e73 7461 6e63 6528 6669 6c2c 2064 6963  nstance(fil, dic
-0002cc60: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0002cc70: 2020 2020 6f72 6967 696e 203d 2066 696c      origin = fil
-0002cc80: 2e67 6574 2827 6f72 6967 696e 2729 0a20  .get('origin'). 
-0002cc90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002cca0: 6f6e 7465 6e74 203d 2066 696c 2e67 6574  ontent = fil.get
-0002ccb0: 2827 636f 6e74 656e 7427 290a 2020 2020  ('content').    
-0002ccc0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0002ccd0: 203d 2066 696c 2e67 6574 2827 7061 7468   = fil.get('path
-0002cce0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0002ccf0: 2020 2069 6620 7061 7468 2069 7320 4e6f     if path is No
-0002cd00: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002cd10: 2020 2020 2020 2020 6966 206f 7269 6769          if origi
-0002cd20: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
-0002cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cd40: 2020 2020 2020 2066 696c 6573 5b69 6e64         files[ind
-0002cd50: 6578 5d5b 2770 6174 6827 5d20 3d20 6622  ex]['path'] = f"
-0002cd60: 2f72 6f6f 742f 7b6f 7269 6769 6e7d 220a  /root/{origin}".
-0002cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cd80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cda0: 2020 6572 726f 7228 6622 496e 636f 7272    error(f"Incorr
-0002cdb0: 6563 7420 656e 7472 7920 7b66 696c 7d2e  ect entry {fil}.
-0002cdc0: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
-0002cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cde0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-0002cdf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ce00: 2065 6c69 6620 6e6f 7420 7061 7468 2e73   elif not path.s
-0002ce10: 7461 7274 7377 6974 6828 272f 2729 3a0a  tartswith('/'):.
+0002c720: 2020 2020 636c 7573 7465 723d 4661 6c73      cluster=Fals
+0002c730: 6529 3a0a 2020 2020 2020 2020 5f74 7970  e):.        _typ
+0002c740: 6520 3d20 2743 6c75 7374 6572 2720 6966  e = 'Cluster' if
+0002c750: 2063 6c75 7374 6572 2065 6c73 6520 2756   cluster else 'V
+0002c760: 6d27 0a20 2020 2020 2020 2074 6974 6c65  m'.        title
+0002c770: 203d 2066 227b 5f74 7970 657d 207b 6e61   = f"{_type} {na
+0002c780: 6d65 7d20 6f6e 207b 7365 6c66 2e63 6c69  me} on {self.cli
+0002c790: 656e 747d 2072 6570 6f72 7422 0a20 2020  ent} report".   
+0002c7a0: 2020 2020 2063 6d64 732c 206d 6169 6c63       cmds, mailc
+0002c7b0: 6f6e 7465 6e74 203d 205b 5d2c 204e 6f6e  ontent = [], Non
+0002c7c0: 650a 2020 2020 2020 2020 666f 7220 6e6f  e.        for no
+0002c7d0: 7469 6679 6d65 7468 6f64 2069 6e20 736f  tifymethod in so
+0002c7e0: 7274 6564 286e 6f74 6966 796d 6574 686f  rted(notifymetho
+0002c7f0: 6473 2c20 7265 7665 7273 653d 5472 7565  ds, reverse=True
+0002c800: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0002c810: 6620 6e6f 7469 6679 6d65 7468 6f64 203d  f notifymethod =
+0002c820: 3d20 2770 7573 6862 756c 6c65 7427 3a0a  = 'pushbullet':.
+0002c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c840: 6966 2070 7573 6862 756c 6c65 7474 6f6b  if pushbullettok
+0002c850: 656e 2069 7320 4e6f 6e65 3a0a 2020 2020  en is None:.    
+0002c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c870: 7761 726e 696e 6728 6622 4e6f 7469 6669  warning(f"Notifi
+0002c880: 6361 7469 6f6e 2072 6571 7569 7265 6420  cation required 
+0002c890: 666f 7220 7b6e 616d 657d 2062 7574 206d  for {name} but m
+0002c8a0: 6973 7369 6e67 2070 7573 6862 756c 6c65  issing pushbulle
+0002c8b0: 7474 6f6b 656e 2229 0a20 2020 2020 2020  ttoken").       
+0002c8c0: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
+0002c8d0: 7469 6679 7363 7269 7074 2069 7320 4e6f  tifyscript is No
+0002c8e0: 6e65 2061 6e64 206e 6f74 6966 7963 6d64  ne and notifycmd
+0002c8f0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0002c900: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0002c910: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+0002c920: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c940: 2074 6f6b 656e 203d 2070 7573 6862 756c   token = pushbul
+0002c950: 6c65 7474 6f6b 656e 0a20 2020 2020 2020  lettoken.       
+0002c960: 2020 2020 2020 2020 2020 2020 2070 6263               pbc
+0002c970: 6d64 203d 2027 6375 726c 202d 7375 2022  md = 'curl -su "
+0002c980: 2573 3a22 202d 6420 7479 7065 3d22 6e6f  %s:" -d type="no
+0002c990: 7465 2220 2d64 2062 6f64 793d 2260 2573  te" -d body="`%s
+0002c9a0: 2032 3e26 3160 2220 2d64 2074 6974 6c65   2>&1`" -d title
+0002c9b0: 3d22 2573 2220 2720 2520 2874 6f6b 656e  ="%s" ' % (token
+0002c9c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca20: 2020 2020 6e6f 7469 6679 636d 642c 0a20      notifycmd,. 
+0002ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca90: 2074 6974 6c65 290a 2020 2020 2020 2020   title).        
+0002caa0: 2020 2020 2020 2020 2020 2020 7062 636d              pbcm
+0002cab0: 6420 2b3d 2027 6874 7470 733a 2f2f 6170  d += 'https://ap
+0002cac0: 692e 7075 7368 6275 6c6c 6574 2e63 6f6d  i.pushbullet.com
+0002cad0: 2f76 322f 7075 7368 6573 270a 2020 2020  /v2/pushes'.    
+0002cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002caf0: 636d 6473 2e61 7070 656e 6428 7062 636d  cmds.append(pbcm
+0002cb00: 6429 0a20 2020 2020 2020 2020 2020 2065  d).            e
+0002cb10: 6c69 6620 6e6f 7469 6679 6d65 7468 6f64  lif notifymethod
+0002cb20: 203d 3d20 2773 6c61 636b 273a 0a20 2020   == 'slack':.   
+0002cb30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002cb40: 736c 6163 6b63 6861 6e6e 656c 2069 7320  slackchannel is 
+0002cb50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0002cb60: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+0002cb70: 6728 6622 4e6f 7469 6669 6361 7469 6f6e  g(f"Notification
+0002cb80: 2072 6571 7569 7265 6420 666f 7220 7b6e   required for {n
+0002cb90: 616d 657d 2062 7574 206d 6973 7369 6e67  ame} but missing
+0002cba0: 2073 6c61 636b 2063 6861 6e6e 656c 2229   slack channel")
+0002cbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cbc0: 2065 6c69 6620 736c 6163 6b74 6f6b 656e   elif slacktoken
+0002cbd0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0002cbe0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0002cbf0: 726e 696e 6728 6622 4e6f 7469 6669 6361  rning(f"Notifica
+0002cc00: 7469 6f6e 2072 6571 7569 7265 6420 666f  tion required fo
+0002cc10: 7220 7b6e 616d 657d 2062 7574 206d 6973  r {name} but mis
+0002cc20: 7369 6e67 2073 6c61 636b 746f 6b65 6e22  sing slacktoken"
+0002cc30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002cc40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002cc50: 2020 2020 2020 2020 2020 2020 736c 6163              slac
+0002cc60: 6b63 6d64 203d 2066 2269 6e66 6f3d 607b  kcmd = f"info=`{
+0002cc70: 6e6f 7469 6679 636d 647d 2032 3e26 3120  notifycmd} 2>&1 
+0002cc80: 7c20 7365 6420 2773 2f5c 5c78 322f 202f  | sed 's/\\x2/ /
+0002cc90: 6727 603b 220a 2020 2020 2020 2020 2020  g'`;".          
+0002cca0: 2020 2020 2020 2020 2020 736c 6163 6b63            slackc
+0002ccb0: 6d64 202b 3d20 2222 2263 7572 6c20 2d58  md += """curl -X
+0002ccc0: 2050 4f53 5420 2d48 2027 4175 7468 6f72   POST -H 'Author
+0002ccd0: 697a 6174 696f 6e3a 2042 6561 7265 7220  ization: Bearer 
+0002cce0: 2573 270a 202d 4820 2743 6f6e 7465 6e74  %s'. -H 'Content
+0002ccf0: 2d74 7970 653a 2061 7070 6c69 6361 7469  -type: applicati
+0002cd00: 6f6e 2f6a 736f 6e3b 2063 6861 7273 6574  on/json; charset
+0002cd10: 3d75 7466 2d38 270a 202d 2d64 6174 6120  =utf-8'. --data 
+0002cd20: 277b 2263 6861 6e6e 656c 223a 2225 7322  '{"channel":"%s"
+0002cd30: 2c22 7465 7874 223a 2225 7322 2c22 6174  ,"text":"%s","at
+0002cd40: 7461 6368 6d65 6e74 7322 3a20 5b7b 2274  tachments": [{"t
+0002cd50: 6578 7422 3a22 2722 2469 6e66 6f22 2722  ext":"'"$info"'"
+0002cd60: 2c22 6661 6c6c 6261 636b 223a 226e 6f74  ,"fallback":"not
+0002cd70: 6869 6e67 222c 0a22 636f 6c6f 7222 3a22  hing",."color":"
+0002cd80: 2333 4141 3345 3322 2c22 6174 7461 6368  #3AA3E3","attach
+0002cd90: 6d65 6e74 5f74 7970 6522 3a22 6465 6661  ment_type":"defa
+0002cda0: 756c 7422 7d5d 7d27 2068 7474 7073 3a2f  ult"}]}' https:/
+0002cdb0: 2f73 6c61 636b 2e63 6f6d 2f61 7069 2f63  /slack.com/api/c
+0002cdc0: 6861 742e 706f 7374 4d65 7373 6167 6522  hat.postMessage"
+0002cdd0: 2222 2025 2028 736c 6163 6b74 6f6b 656e  "" % (slacktoken
+0002cde0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce30: 2020 2020 6572 726f 7228 6622 496e 636f      error(f"Inco
-0002ce40: 7272 6563 7420 7061 7468 207b 7061 7468  rrect path {path
-0002ce50: 7d2e 4c65 6176 696e 672e 2e2e 2229 0a20  }.Leaving..."). 
-0002ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce70: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-0002ce80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002ce90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cea0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-0002ceb0: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-0002cec0: 6561 736f 6e27 3a20 2249 6e63 6f72 7265  eason': "Incorre
-0002ced0: 6374 2066 696c 6520 656e 7472 7922 7d0a  ct file entry"}.
-0002cee0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0002cef0: 7269 6769 6e20 6973 206e 6f74 204e 6f6e  rigin is not Non
-0002cf00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002cf10: 2020 2069 6620 6f6e 666c 7920 6973 206e     if onfly is n
-0002cf20: 6f74 204e 6f6e 6520 616e 6420 277e 2720  ot None and '~' 
-0002cf30: 6e6f 7420 696e 206f 7269 6769 6e3a 0a20  not in origin:. 
-0002cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf50: 2020 2064 6573 7464 6972 203d 2062 6173     destdir = bas
-0002cf60: 6564 6972 0a20 2020 2020 2020 2020 2020  edir.           
-0002cf70: 2020 2020 2020 2020 2069 6620 272f 2720           if '/' 
-0002cf80: 696e 206f 7269 6769 6e3a 0a20 2020 2020  in origin:.     
-0002cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cfa0: 2020 2064 6573 7464 6972 203d 206f 732e     destdir = os.
-0002cfb0: 7061 7468 2e64 6972 6e61 6d65 286f 7269  path.dirname(ori
-0002cfc0: 6769 6e29 0a20 2020 2020 2020 2020 2020  gin).           
-0002cfd0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-0002cfe0: 6d61 6b65 6469 7273 2864 6573 7464 6972  makedirs(destdir
-0002cff0: 2c20 6578 6973 745f 6f6b 3d54 7275 6529  , exist_ok=True)
-0002d000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d010: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
-0002d020: 6828 6622 7b6f 6e66 6c79 7d2f 7b6f 7269  h(f"{onfly}/{ori
-0002d030: 6769 6e7d 222c 2064 6573 7464 6972 290a  gin}", destdir).
-0002d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d050: 6f72 6967 696e 203d 206f 732e 7061 7468  origin = os.path
-0002d060: 2e65 7870 616e 6475 7365 7228 6f72 6967  .expanduser(orig
-0002d070: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
-0002d080: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0002d090: 7468 2e69 7361 6273 286f 7269 6769 6e29  th.isabs(origin)
-0002d0a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002d0b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0002d0c0: 6e63 6528 6669 6c2c 2064 6963 7429 2061  nce(fil, dict) a
-0002d0d0: 6e64 2066 696c 2e67 6574 2827 6375 7272  nd fil.get('curr
-0002d0e0: 656e 7464 6972 272c 2046 616c 7365 293a  entdir', False):
-0002d0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d100: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
-0002d110: 3d20 6622 7b6f 732e 6765 7463 7764 2829  = f"{os.getcwd()
-0002d120: 7d2f 7b6f 7269 6769 6e7d 220a 2020 2020  }/{origin}".    
-0002d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d140: 2020 2020 6669 6c65 735b 696e 6465 785d      files[index]
-0002d150: 5b27 6f72 6967 696e 275d 203d 206f 7269  ['origin'] = ori
-0002d160: 6769 6e0a 2020 2020 2020 2020 2020 2020  gin.            
-0002d170: 2020 2020 2020 2020 656c 6966 2062 6173          elif bas
-0002d180: 6564 6972 2021 3d20 272e 2720 616e 6420  edir != '.' and 
-0002d190: 6e6f 7420 6f72 6967 696e 2e73 7461 7274  not origin.start
-0002d1a0: 7377 6974 6828 272e 2f27 2920 616e 6420  swith('./') and 
-0002d1b0: 6e6f 7420 6f72 6967 696e 2e73 7461 7274  not origin.start
-0002d1c0: 7377 6974 6828 272f 776f 726b 6469 722f  swith('/workdir/
-0002d1d0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-0002d1e0: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
-0002d1f0: 696e 203d 2066 227b 6261 7365 6469 727d  in = f"{basedir}
-0002d200: 2f7b 6f72 6967 696e 7d22 0a20 2020 2020  /{origin}".     
-0002d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d220: 2020 2066 696c 6573 5b69 6e64 6578 5d5b     files[index][
-0002d230: 276f 7269 6769 6e27 5d20 3d20 6f72 6967  'origin'] = orig
-0002d240: 696e 0a20 2020 2020 2020 2020 2020 2020  in.             
-0002d250: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-0002d260: 682e 6578 6973 7473 286f 7269 6769 6e29  h.exists(origin)
-0002d270: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002d280: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-0002d290: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
-0002d2a0: 272c 2027 7265 6173 6f6e 273a 2066 224f  ', 'reason': f"O
-0002d2b0: 7269 6769 6e20 6669 6c65 207b 6f72 6967  rigin file {orig
-0002d2c0: 696e 7d20 6e6f 7420 666f 756e 6420 666f  in} not found fo
-0002d2d0: 7220 7b6e 616d 657d 227d 0a20 2020 2020  r {name}"}.     
-0002d2e0: 2020 2020 2020 2065 6c69 6620 636f 6e74         elif cont
-0002d2f0: 656e 7420 6973 204e 6f6e 653a 0a20 2020  ent is None:.   
-0002d300: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0002d310: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-0002d320: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
-0002d330: 6e27 3a20 6622 436f 6e74 656e 7420 6f66  n': f"Content of
-0002d340: 2066 696c 6520 7b70 6174 687d 206e 6f74   file {path} not
-0002d350: 2066 6f75 6e64 2066 6f72 207b 6e61 6d65   found for {name
-0002d360: 7d22 7d0a 0a20 2020 2064 6566 2070 7265  }"}..    def pre
-0002d370: 7065 6e64 5f69 6e70 7574 5f64 6972 2873  pend_input_dir(s
-0002d380: 656c 662c 206e 6577 6669 6c65 732c 2069  elf, newfiles, i
-0002d390: 6e70 7574 6469 7229 3a0a 2020 2020 2020  nputdir):.      
-0002d3a0: 2020 7265 7375 6c74 7320 3d20 5b5d 0a20    results = []. 
-0002d3b0: 2020 2020 2020 2066 6f72 2066 6963 2069         for fic i
-0002d3c0: 6e20 6e65 7766 696c 6573 3a0a 2020 2020  n newfiles:.    
-0002d3d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0002d3e0: 7461 6e63 6528 6669 632c 2073 7472 2920  tance(fic, str) 
-0002d3f0: 616e 6420 6e6f 7420 6f73 2e70 6174 682e  and not os.path.
-0002d400: 6973 6162 7328 6669 6329 3a0a 2020 2020  isabs(fic):.    
-0002d410: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0002d420: 6669 6320 3d20 6622 7b69 6e70 7574 6469  fic = f"{inputdi
-0002d430: 727d 2f7b 6669 637d 220a 2020 2020 2020  r}/{fic}".      
-0002d440: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-0002d450: 7461 6e63 6528 6669 632c 2064 6963 7429  tance(fic, dict)
-0002d460: 2061 6e64 2027 6f72 6967 696e 2720 696e   and 'origin' in
-0002d470: 2066 6963 2061 6e64 206e 6f74 206f 732e   fic and not os.
-0002d480: 7061 7468 2e69 7361 6273 286f 732e 7061  path.isabs(os.pa
-0002d490: 7468 2e65 7870 616e 6475 7365 7228 6669  th.expanduser(fi
-0002d4a0: 635b 276f 7269 6769 6e27 5d29 293a 0a20  c['origin'])):. 
-0002d4b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0002d4c0: 6577 5f66 6963 203d 2066 6963 2e63 6f70  ew_fic = fic.cop
-0002d4d0: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-0002d4e0: 2020 2020 6e65 775f 6669 635b 276f 7269      new_fic['ori
-0002d4f0: 6769 6e27 5d20 3d20 6622 7b69 6e70 7574  gin'] = f"{input
-0002d500: 6469 727d 2f7b 6669 635b 276f 7269 6769  dir}/{fic['origi
-0002d510: 6e27 5d7d 220a 2020 2020 2020 2020 2020  n']}".          
-0002d520: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002d530: 2020 2020 2020 2020 6e65 775f 6669 6320          new_fic 
-0002d540: 3d20 6669 630a 2020 2020 2020 2020 2020  = fic.          
-0002d550: 2020 7265 7375 6c74 732e 6170 7065 6e64    results.append
-0002d560: 286e 6577 5f66 6963 290a 2020 2020 2020  (new_fic).      
-0002d570: 2020 7265 7475 726e 2072 6573 756c 7473    return results
-0002d580: 0a0a 2020 2020 6465 6620 7265 6d65 6469  ..    def remedi
-0002d590: 6174 655f 6669 6c65 7328 7365 6c66 2c20  ate_files(self, 
-0002d5a0: 6e61 6d65 2c20 6e65 7766 696c 6573 2c20  name, newfiles, 
-0002d5b0: 6f76 6572 7269 6465 733d 7b7d 2c20 696e  overrides={}, in
-0002d5c0: 7075 7464 6972 3d27 2e27 293a 0a20 2020  putdir='.'):.   
-0002d5d0: 2020 2020 2075 7064 6174 6564 5f66 696c       updated_fil
-0002d5e0: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
-0002d5f0: 6970 2c20 766d 706f 7274 203d 205f 7373  ip, vmport = _ss
-0002d600: 685f 6372 6564 656e 7469 616c 7328 7365  h_credentials(se
-0002d610: 6c66 2e6b 2c20 6e61 6d65 295b 313a 5d0a  lf.k, name)[1:].
-0002d620: 2020 2020 2020 2020 6966 2069 6e70 7574          if input
-0002d630: 6469 7220 213d 2027 2e27 3a0a 2020 2020  dir != '.':.    
-0002d640: 2020 2020 2020 2020 6e65 7766 696c 6573          newfiles
-0002d650: 203d 2073 656c 662e 7072 6570 656e 645f   = self.prepend_
-0002d660: 696e 7075 745f 6469 7228 6e65 7766 696c  input_dir(newfil
-0002d670: 6573 2c20 696e 7075 7464 6972 290a 2020  es, inputdir).  
-0002d680: 2020 2020 2020 7365 6c66 2e70 6172 7365        self.parse
-0002d690: 5f66 696c 6573 286e 616d 652c 206e 6577  _files(name, new
-0002d6a0: 6669 6c65 7329 0a20 2020 2020 2020 206f  files).        o
-0002d6b0: 7665 7272 6964 6573 5f66 696c 6573 203d  verrides_files =
-0002d6c0: 206f 7665 7272 6964 6573 2e63 6f70 7928   overrides.copy(
-0002d6d0: 290a 2020 2020 2020 2020 6f76 6572 7269  ).        overri
-0002d6e0: 6465 735f 6669 6c65 735b 276e 616d 6527  des_files['name'
-0002d6f0: 5d20 3d20 6e61 6d65 0a20 2020 2020 2020  ] = name.       
-0002d700: 2064 6174 6120 3d20 7072 6f63 6573 735f   data = process_
-0002d710: 6669 6c65 7328 6669 6c65 733d 6e65 7766  files(files=newf
-0002d720: 696c 6573 2c20 6f76 6572 7269 6465 733d  iles, overrides=
-0002d730: 6f76 6572 7269 6465 735f 6669 6c65 732c  overrides_files,
-0002d740: 2072 656d 6564 6961 7465 3d54 7275 6529   remediate=True)
-0002d750: 0a20 2020 2020 2020 2064 6174 6164 6972  .        datadir
-0002d760: 7320 3d20 7b7d 0a20 2020 2020 2020 2077  s = {}.        w
-0002d770: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
-0002d780: 6563 746f 7279 2829 2061 7320 746d 7064  ectory() as tmpd
-0002d790: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
-0002d7a0: 666f 7220 696e 6465 782c 2065 6e74 7279  for index, entry
-0002d7b0: 2069 6e20 656e 756d 6572 6174 6528 6461   in enumerate(da
-0002d7c0: 7461 293a 0a20 2020 2020 2020 2020 2020  ta):.           
-0002d7d0: 2020 2020 2064 6573 7469 6e61 7469 6f6e       destination
-0002d7e0: 203d 2065 6e74 7279 5b27 7061 7468 275d   = entry['path']
-0002d7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d800: 2070 6174 6864 6972 203d 206f 732e 7061   pathdir = os.pa
-0002d810: 7468 2e64 6972 6e61 6d65 2864 6573 7469  th.dirname(desti
-0002d820: 6e61 7469 6f6e 290a 2020 2020 2020 2020  nation).        
-0002d830: 2020 2020 2020 2020 6966 2070 6174 6864          if pathd
-0002d840: 6972 206e 6f74 2069 6e20 6461 7461 6469  ir not in datadi
-0002d850: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-0002d860: 2020 2020 2020 2020 7061 7468 6469 7263          pathdirc
-0002d870: 6d64 203d 2066 276c 7320 2d61 207b 7061  md = f'ls -a {pa
-0002d880: 7468 6469 727d 2032 3e26 3127 0a20 2020  thdir} 2>&1'.   
-0002d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d8a0: 2070 6174 6864 6972 636d 6420 3d20 7373   pathdircmd = ss
-0002d8b0: 6828 6e61 6d65 2c20 6970 3d69 702c 2075  h(name, ip=ip, u
-0002d8c0: 7365 723d 2772 6f6f 7427 2c20 7475 6e6e  ser='root', tunn
-0002d8d0: 656c 3d73 656c 662e 7475 6e6e 656c 2c20  el=self.tunnel, 
-0002d8e0: 7475 6e6e 656c 686f 7374 3d73 656c 662e  tunnelhost=self.
-0002d8f0: 7475 6e6e 656c 686f 7374 2c0a 2020 2020  tunnelhost,.    
-0002d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d920: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
-0002d930: 2e74 756e 6e65 6c70 6f72 742c 2074 756e  .tunnelport, tun
-0002d940: 6e65 6c75 7365 723d 7365 6c66 2e74 756e  neluser=self.tun
-0002d950: 6e65 6c75 7365 722c 2069 6e73 6563 7572  neluser, insecur
-0002d960: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-0002d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d980: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-0002d990: 3d70 6174 6864 6972 636d 642c 2076 6d70  =pathdircmd, vmp
-0002d9a0: 6f72 743d 766d 706f 7274 290a 2020 2020  ort=vmport).    
-0002d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d9c0: 7061 7468 6469 7266 696c 6573 203d 206f  pathdirfiles = o
-0002d9d0: 732e 706f 7065 6e28 7061 7468 6469 7263  s.popen(pathdirc
-0002d9e0: 6d64 292e 7265 6164 6c69 6e65 7328 290a  md).readlines().
-0002d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002da00: 2020 2020 6966 206c 656e 2870 6174 6864      if len(pathd
-0002da10: 6972 6669 6c65 7329 203d 3d20 3120 616e  irfiles) == 1 an
-0002da20: 6420 274e 6f20 7375 6368 2066 696c 6520  d 'No such file 
-0002da30: 6f72 2064 6972 6563 746f 7279 2720 696e  or directory' in
-0002da40: 2070 6174 6864 6972 6669 6c65 735b 305d   pathdirfiles[0]
-0002da50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002da60: 2020 2020 2020 2020 2020 6372 6561 7465            create
-0002da70: 6469 7263 6d64 203d 2066 276d 6b64 6972  dircmd = f'mkdir
-0002da80: 202d 7020 7b70 6174 6864 6972 7d27 0a20   -p {pathdir}'. 
-0002da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002daa0: 2020 2020 2020 2063 7265 6174 6564 6972         createdir
-0002dab0: 636d 6420 3d20 7373 6828 6e61 6d65 2c20  cmd = ssh(name, 
-0002dac0: 6970 3d69 702c 2075 7365 723d 2772 6f6f  ip=ip, user='roo
-0002dad0: 7427 2c20 7475 6e6e 656c 3d73 656c 662e  t', tunnel=self.
-0002dae0: 7475 6e6e 656c 2c20 7475 6e6e 656c 686f  tunnel, tunnelho
-0002daf0: 7374 3d73 656c 662e 7475 6e6e 656c 686f  st=self.tunnelho
-0002db00: 7374 2c0a 2020 2020 2020 2020 2020 2020  st,.            
-0002db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002db20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0002db30: 756e 6e65 6c70 6f72 743d 7365 6c66 2e74  unnelport=self.t
-0002db40: 756e 6e65 6c70 6f72 742c 2074 756e 6e65  unnelport, tunne
-0002db50: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
-0002db60: 6c75 7365 722c 2069 6e73 6563 7572 653d  luser, insecure=
-0002db70: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-0002db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dba0: 2063 6d64 3d63 7265 6174 6564 6972 636d   cmd=createdircm
-0002dbb0: 642c 2076 6d70 6f72 743d 766d 706f 7274  d, vmport=vmport
-0002dbc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002dbd0: 2020 2020 2020 2020 2020 6f73 2e70 6f70            os.pop
-0002dbe0: 656e 2863 7265 6174 6564 6972 636d 6429  en(createdircmd)
-0002dbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002dc00: 2020 2020 2020 2020 2070 6174 6864 6972           pathdir
-0002dc10: 6669 6c65 7320 3d20 5b5d 0a20 2020 2020  files = [].     
-0002dc20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0002dc30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002dc40: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-0002dc50: 6864 6972 6669 6c65 7320 3d20 5b78 2e73  hdirfiles = [x.s
-0002dc60: 7472 6970 2829 2066 6f72 2078 2069 6e20  trip() for x in 
-0002dc70: 7061 7468 6469 7266 696c 6573 5d0a 2020  pathdirfiles].  
-0002dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dc90: 2020 6461 7461 6469 7273 5b70 6174 6864    datadirs[pathd
-0002dca0: 6972 5d20 3d20 7061 7468 6469 7266 696c  ir] = pathdirfil
-0002dcb0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-0002dcc0: 2020 2069 6620 6f73 2e70 6174 682e 6261     if os.path.ba
-0002dcd0: 7365 6e61 6d65 2864 6573 7469 6e61 7469  sename(destinati
-0002dce0: 6f6e 2920 6e6f 7420 696e 2064 6174 6164  on) not in datad
-0002dcf0: 6972 735b 7061 7468 6469 725d 3a0a 2020  irs[pathdir]:.  
-0002dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dd10: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
-0002dd20: 696e 6720 7b64 6573 7469 6e61 7469 6f6e  ing {destination
-0002dd30: 7d20 696e 207b 6e61 6d65 7d22 290a 2020  } in {name}").  
-0002dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dd50: 2020 736f 7572 6365 203d 2066 227b 746d    source = f"{tm
-0002dd60: 7064 6972 7d2f 6669 637b 696e 6465 787d  pdir}/fic{index}
-0002dd70: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002dd80: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-0002dd90: 736f 7572 6365 2c20 2777 2729 2061 7320  source, 'w') as 
-0002dda0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0002ddb0: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
-0002ddc0: 7465 2865 6e74 7279 5b27 636f 6e74 656e  te(entry['conten
-0002ddd0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
-0002dde0: 2020 2020 2020 2020 2073 6370 636d 6420           scpcmd 
-0002ddf0: 3d20 7363 7028 6e61 6d65 2c20 6970 3d69  = scp(name, ip=i
-0002de00: 702c 2075 7365 723d 2772 6f6f 7427 2c20  p, user='root', 
-0002de10: 736f 7572 6365 3d73 6f75 7263 652c 2064  source=source, d
-0002de20: 6573 7469 6e61 7469 6f6e 3d64 6573 7469  estination=desti
-0002de30: 6e61 7469 6f6e 2c20 7475 6e6e 656c 3d73  nation, tunnel=s
-0002de40: 656c 662e 7475 6e6e 656c 2c0a 2020 2020  elf.tunnel,.    
-0002de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de60: 2020 2020 2020 2020 2020 2020 2074 756e               tun
-0002de70: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
-0002de80: 6e65 6c68 6f73 742c 2074 756e 6e65 6c70  nelhost, tunnelp
-0002de90: 6f72 743d 7365 6c66 2e74 756e 6e65 6c70  ort=self.tunnelp
-0002dea0: 6f72 742c 2074 756e 6e65 6c75 7365 723d  ort, tunneluser=
-0002deb0: 7365 6c66 2e74 756e 6e65 6c75 7365 722c  self.tunneluser,
-0002dec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dee0: 2020 646f 776e 6c6f 6164 3d46 616c 7365    download=False
-0002def0: 2c20 696e 7365 6375 7265 3d54 7275 652c  , insecure=True,
-0002df00: 2076 6d70 6f72 743d 766d 706f 7274 290a   vmport=vmport).
-0002df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002df20: 2020 2020 6f73 2e73 7973 7465 6d28 7363      os.system(sc
-0002df30: 7063 6d64 290a 2020 2020 2020 2020 2020  pcmd).          
-0002df40: 2020 2020 2020 2020 2020 7570 6461 7465            update
-0002df50: 645f 6669 6c65 732e 6170 7065 6e64 2864  d_files.append(d
-0002df60: 6573 7469 6e61 7469 6f6e 290a 2020 2020  estination).    
-0002df70: 2020 2020 7265 7475 726e 2075 7064 6174      return updat
-0002df80: 6564 5f66 696c 6573 0a0a 2020 2020 6465  ed_files..    de
-0002df90: 6620 696e 666f 5f73 7065 6369 6669 635f  f info_specific_
-0002dfa0: 706c 616e 2873 656c 662c 2070 6c61 6e29  plan(self, plan)
-0002dfb0: 3a0a 2020 2020 2020 2020 7070 7269 6e74  :.        pprint
-0002dfc0: 2866 2250 726f 7669 6469 6e67 2069 6e66  (f"Providing inf
-0002dfd0: 6f72 6d61 7469 6f6e 2061 626f 7574 2070  ormation about p
-0002dfe0: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
-0002dff0: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
-0002e000: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
-0002e010: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0002e020: 2076 6d20 696e 206b 2e6c 6973 7428 293a   vm in k.list():
-0002e030: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002e040: 766d 2e67 6574 2827 706c 616e 272c 2027  vm.get('plan', '
-0002e050: 2729 203d 3d20 706c 616e 3a0a 2020 2020  ') == plan:.    
-0002e060: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0002e070: 6c74 732e 6170 7065 6e64 2876 6d29 0a20  lts.append(vm). 
-0002e080: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0002e090: 7375 6c74 730a 0a20 2020 2064 6566 2061  sults..    def a
-0002e0a0: 7574 6f73 6361 6c65 5f63 6c75 7374 6572  utoscale_cluster
-0002e0b0: 2873 656c 662c 206b 7562 652c 206b 7562  (self, kube, kub
-0002e0c0: 6574 7970 652c 2077 6f72 6b65 7273 2c20  etype, workers, 
-0002e0d0: 7468 7265 7368 6f6c 642c 2069 646c 6529  threshold, idle)
-0002e0e0: 3a0a 2020 2020 2020 2020 6966 2074 6872  :.        if thr
-0002e0f0: 6573 686f 6c64 203e 2039 3939 393a 0a20  eshold > 9999:. 
-0002e100: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0002e110: 7428 6622 536b 6970 7069 6e67 2061 7574  t(f"Skipping aut
-0002e120: 6f73 6361 6c69 6e67 2075 7020 6368 6563  oscaling up chec
-0002e130: 6b73 2066 6f72 2063 6c75 7374 6572 207b  ks for cluster {
-0002e140: 6b75 6265 7d20 6173 2070 6572 2074 6872  kube} as per thr
-0002e150: 6573 686f 6c64 207b 7468 7265 7368 6f6c  eshold {threshol
-0002e160: 647d 2229 0a20 2020 2020 2020 2020 2020  d}").           
-0002e170: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-0002e180: 273a 2027 7375 6363 6573 7327 2c20 2777  ': 'success', 'w
-0002e190: 6f72 6b65 7273 273a 2077 6f72 6b65 7273  orkers': workers
-0002e1a0: 7d0a 2020 2020 2020 2020 6966 2069 646c  }.        if idl
-0002e1b0: 6520 3c20 313a 0a20 2020 2020 2020 2020  e < 1:.         
-0002e1c0: 2020 2070 7072 696e 7428 6622 536b 6970     pprint(f"Skip
-0002e1d0: 7069 6e67 2061 7574 6f73 6361 6c69 6e67  ping autoscaling
-0002e1e0: 2064 6f77 6e20 6368 6563 6b73 2066 6f72   down checks for
-0002e1f0: 2063 6c75 7374 6572 207b 6b75 6265 7d20   cluster {kube} 
-0002e200: 6173 2070 6572 2069 646c 6520 7b69 646c  as per idle {idl
-0002e210: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-0002e220: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-0002e230: 273a 2027 7375 6363 6573 7327 2c20 2777  ': 'success', 'w
-0002e240: 6f72 6b65 7273 273a 2077 6f72 6b65 7273  orkers': workers
-0002e250: 7d0a 2020 2020 2020 2020 7070 7269 6e74  }.        pprint
-0002e260: 2866 2243 6865 636b 696e 6720 6e6f 6e20  (f"Checking non 
-0002e270: 7363 6865 6475 6c65 6420 706f 6473 2063  scheduled pods c
-0002e280: 6f75 6e74 206f 6e20 636c 7573 7465 7220  ount on cluster 
-0002e290: 7b6b 7562 657d 2229 0a20 2020 2020 2020  {kube}").       
-0002e2a0: 2073 656c 6563 746f 7220 3d20 2221 6e6f   selector = "!no
-0002e2b0: 6465 2d72 6f6c 652e 6b75 6265 726e 6574  de-role.kubernet
-0002e2c0: 6573 2e69 6f2f 636f 6e74 726f 6c2d 706c  es.io/control-pl
-0002e2d0: 616e 652c 6e6f 6465 2d72 6f6c 652e 6b75  ane,node-role.ku
-0002e2e0: 6265 726e 6574 6573 2e69 6f2f 776f 726b  bernetes.io/work
-0002e2f0: 6572 220a 2020 2020 2020 2020 6375 7272  er".        curr
-0002e300: 656e 7463 6d64 203d 2066 226b 7562 6563  entcmd = f"kubec
-0002e310: 746c 2067 6574 206e 6f64 6520 2d2d 7365  tl get node --se
-0002e320: 6c65 6374 6f72 3d27 7b73 656c 6563 746f  lector='{selecto
-0002e330: 727d 2722 0a20 2020 2020 2020 2063 7572  r}'".        cur
-0002e340: 7265 6e74 636d 6420 2b3d 2022 207c 2067  rentcmd += " | g
-0002e350: 7265 7020 2720 5265 6164 7927 220a 2020  rep ' Ready'".  
-0002e360: 2020 2020 2020 776f 726b 6572 7320 3d20        workers = 
-0002e370: 6c65 6e28 6f73 2e70 6f70 656e 2863 7572  len(os.popen(cur
-0002e380: 7265 6e74 636d 6429 2e72 6561 646c 696e  rentcmd).readlin
-0002e390: 6573 2829 290a 2020 2020 2020 2020 7065  es()).        pe
-0002e3a0: 6e64 696e 6763 6d64 203d 2022 6b75 6265  ndingcmd = "kube
-0002e3b0: 6374 6c20 6765 7420 706f 6473 202d 4120  ctl get pods -A 
-0002e3c0: 2d2d 6669 656c 642d 7365 6c65 6374 6f72  --field-selector
-0002e3d0: 3d73 7461 7475 732e 7068 6173 653d 5065  =status.phase=Pe
-0002e3e0: 6e64 696e 6720 2d6f 2079 616d 6c22 0a20  nding -o yaml". 
-0002e3f0: 2020 2020 2020 2070 656e 6469 6e67 5f70         pending_p
-0002e400: 6f64 7320 3d20 7961 6d6c 2e73 6166 655f  ods = yaml.safe_
-0002e410: 6c6f 6164 286f 732e 706f 7065 6e28 7065  load(os.popen(pe
-0002e420: 6e64 696e 6763 6d64 292e 7265 6164 2829  ndingcmd).read()
-0002e430: 295b 2769 7465 6d73 275d 0a20 2020 2020  )['items'].     
-0002e440: 2020 2069 6620 6c65 6e28 7065 6e64 696e     if len(pendin
-0002e450: 675f 706f 6473 2920 3e20 7468 7265 7368  g_pods) > thresh
-0002e460: 6f6c 643a 0a20 2020 2020 2020 2020 2020  old:.           
-0002e470: 2070 7072 696e 7428 6622 5472 6967 6765   pprint(f"Trigge
-0002e480: 7269 6e67 2073 6361 6c69 6e67 2075 7020  ring scaling up 
-0002e490: 666f 7220 636c 7573 7465 7220 7b6b 7562  for cluster {kub
-0002e4a0: 657d 2061 7320 7468 6572 6520 6172 6520  e} as there are 
-0002e4b0: 7b6c 656e 2870 656e 6469 6e67 5f70 6f64  {len(pending_pod
-0002e4c0: 7329 7d20 7065 6e64 696e 6720 706f 6473  s)} pending pods
-0002e4d0: 2229 0a20 2020 2020 2020 2020 2020 2077  ").            w
-0002e4e0: 6f72 6b65 7273 202b 3d20 310a 2020 2020  orkers += 1.    
-0002e4f0: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-0002e500: 5363 616c 696e 6720 7570 2063 6c75 7374  Scaling up clust
-0002e510: 6572 207b 6b75 6265 7d20 746f 207b 776f  er {kube} to {wo
-0002e520: 726b 6572 737d 2077 6f72 6b65 7273 2229  rkers} workers")
-0002e530: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0002e540: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
-0002e550: 5f6b 7562 6528 6b75 6265 2c20 6b75 6265  _kube(kube, kube
-0002e560: 7479 7065 2c20 6f76 6572 7269 6465 733d  type, overrides=
-0002e570: 7b27 776f 726b 6572 7327 3a20 776f 726b  {'workers': work
-0002e580: 6572 737d 290a 2020 2020 2020 2020 2020  ers}).          
-0002e590: 2020 7265 7375 6c74 5b27 776f 726b 6572    result['worker
-0002e5a0: 7327 5d20 3d20 776f 726b 6572 730a 2020  s'] = workers.  
-0002e5b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002e5c0: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-0002e5d0: 6e6f 6465 7320 3d20 7b7d 0a20 2020 2020  nodes = {}.     
-0002e5e0: 2020 2063 7572 7265 6e74 636d 6420 3d20     currentcmd = 
-0002e5f0: 226b 7562 6563 746c 2067 6574 2070 6f64  "kubectl get pod
-0002e600: 202d 4120 2d6f 2079 616d 6c22 0a20 2020   -A -o yaml".   
-0002e610: 2020 2020 2061 6c6c 706f 6473 203d 2079       allpods = y
-0002e620: 616d 6c2e 7361 6665 5f6c 6f61 6428 6f73  aml.safe_load(os
-0002e630: 2e70 6f70 656e 2863 7572 7265 6e74 636d  .popen(currentcm
-0002e640: 6429 2e72 6561 6428 2929 5b27 6974 656d  d).read())['item
-0002e650: 7327 5d0a 2020 2020 2020 2020 666f 7220  s'].        for 
-0002e660: 706f 6420 696e 2061 6c6c 706f 6473 3a0a  pod in allpods:.
-0002e670: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
-0002e680: 6e61 6d65 203d 2070 6f64 5b27 7370 6563  name = pod['spec
-0002e690: 275d 5b27 6e6f 6465 4e61 6d65 275d 0a20  ']['nodeName']. 
-0002e6a0: 2020 2020 2020 2020 2020 2073 7461 7475             statu
-0002e6b0: 7320 3d20 706f 645b 2773 7461 7475 7327  s = pod['status'
-0002e6c0: 5d5b 2770 6861 7365 275d 0a20 2020 2020  ]['phase'].     
-0002e6d0: 2020 2020 2020 2069 6620 7374 6174 7573         if status
-0002e6e0: 2021 3d20 2752 756e 6e69 6e67 273a 0a20   != 'Running':. 
-0002e6f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002e700: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-0002e710: 2020 2020 6966 206e 6f64 656e 616d 6520      if nodename 
-0002e720: 6e6f 7420 696e 206e 6f64 6573 3a0a 2020  not in nodes:.  
-0002e730: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-0002e740: 6465 735b 6e6f 6465 6e61 6d65 5d20 3d20  des[nodename] = 
-0002e750: 310a 2020 2020 2020 2020 2020 2020 656c  1.            el
-0002e760: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002e770: 2020 2020 6e6f 6465 735b 6e6f 6465 6e61      nodes[nodena
-0002e780: 6d65 5d20 2b3d 2031 0a20 2020 2020 2020  me] += 1.       
-0002e790: 2074 6f64 656c 6574 6520 3d20 300a 2020   todelete = 0.  
-0002e7a0: 2020 2020 2020 666f 7220 6e6f 6465 2069        for node i
-0002e7b0: 6e20 6e6f 6465 733a 0a20 2020 2020 2020  n nodes:.       
-0002e7c0: 2020 2020 2069 6620 6e6f 6465 735b 6e6f       if nodes[no
-0002e7d0: 6465 5d20 3c20 6964 6c65 3a0a 2020 2020  de] < idle:.    
-0002e7e0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0002e7f0: 6e74 2866 226e 6f64 6520 7b6e 6f64 657d  nt(f"node {node}
-0002e800: 2074 6f20 6265 2072 656d 6f76 6564 2073   to be removed s
-0002e810: 696e 6365 2069 7420 6f6e 6c79 2068 6173  ince it only has
-0002e820: 2074 6865 2066 6f6c 6c6f 7769 6e67 2070   the following p
-0002e830: 6f64 733a 207b 6e6f 6465 735b 6e6f 6465  ods: {nodes[node
-0002e840: 5d7d 2229 0a20 2020 2020 2020 2020 2020  ]}").           
-0002e850: 2020 2020 2074 6f64 656c 6574 6520 2b3d       todelete +=
-0002e860: 2031 0a20 2020 2020 2020 2069 6620 746f   1.        if to
-0002e870: 6465 6c65 7465 203e 2030 3a0a 2020 2020  delete > 0:.    
-0002e880: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0002e890: 2254 7269 6767 6572 696e 6720 7363 616c  "Triggering scal
-0002e8a0: 696e 6720 646f 776e 2066 6f72 2063 6c75  ing down for clu
-0002e8b0: 7374 6572 207b 6b75 6265 7d20 6173 2074  ster {kube} as t
-0002e8c0: 6865 7265 2061 7265 207b 746f 6465 6c65  here are {todele
-0002e8d0: 7465 7d20 6964 6c65 206e 6f64 6573 2229  te} idle nodes")
-0002e8e0: 0a20 2020 2020 2020 2020 2020 2077 6f72  .            wor
-0002e8f0: 6b65 7273 203d 2077 6f72 6b65 7273 202d  kers = workers -
-0002e900: 2074 6f64 656c 6574 650a 2020 2020 2020   todelete.      
-0002e910: 2020 2020 2020 7070 7269 6e74 2866 2253        pprint(f"S
-0002e920: 6361 6c69 6e67 2064 6f77 6e20 636c 7573  caling down clus
-0002e930: 7465 7220 7b6b 7562 657d 2074 6f20 7b77  ter {kube} to {w
-0002e940: 6f72 6b65 7273 7d20 776f 726b 6572 7322  orkers} workers"
-0002e950: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0002e960: 7375 6c74 203d 2073 656c 662e 7363 616c  sult = self.scal
-0002e970: 655f 6b75 6265 286b 7562 652c 206b 7562  e_kube(kube, kub
-0002e980: 6574 7970 652c 206f 7665 7272 6964 6573  etype, overrides
-0002e990: 3d7b 2777 6f72 6b65 7273 273a 2077 6f72  ={'workers': wor
-0002e9a0: 6b65 7273 7d29 0a20 2020 2020 2020 2020  kers}).         
-0002e9b0: 2020 2072 6573 756c 745b 2777 6f72 6b65     result['worke
-0002e9c0: 7273 275d 203d 2077 6f72 6b65 7273 0a20  rs'] = workers. 
-0002e9d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002e9e0: 6e20 7265 7375 6c74 0a20 2020 2020 2020  n result.       
-0002e9f0: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-0002ea00: 273a 2027 7375 6363 6573 7327 2c20 2777  ': 'success', 'w
-0002ea10: 6f72 6b65 7273 273a 2077 6f72 6b65 7273  orkers': workers
-0002ea20: 7d0a 0a20 2020 2064 6566 206c 6f6f 705f  }..    def loop_
-0002ea30: 6175 746f 7363 616c 655f 636c 7573 7465  autoscale_cluste
-0002ea40: 7228 7365 6c66 2c20 6b75 6265 2c20 6b75  r(self, kube, ku
-0002ea50: 6265 7479 7065 2c20 776f 726b 6572 732c  betype, workers,
-0002ea60: 2074 6872 6573 686f 6c64 2c20 6964 6c65   threshold, idle
-0002ea70: 293a 0a20 2020 2020 2020 2070 7072 696e  ):.        pprin
-0002ea80: 7428 6622 5374 6172 7469 6e67 2077 6974  t(f"Starting wit
-0002ea90: 6820 7b77 6f72 6b65 7273 7d20 776f 726b  h {workers} work
-0002eaa0: 6572 7322 290a 2020 2020 2020 2020 6966  ers").        if
-0002eab0: 2077 6869 6368 2827 6b75 6265 6374 6c27   which('kubectl'
-0002eac0: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
-0002ead0: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6765         common.ge
-0002eae0: 745f 6b75 6265 6374 6c28 290a 2020 2020  t_kubectl().    
-0002eaf0: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
-0002eb00: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
-0002eb10: 2e27 0a20 2020 2020 2020 2077 6869 6c65  .'.        while
-0002eb20: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-0002eb30: 2020 2073 656c 6563 746f 7220 3d20 2221     selector = "!
-0002eb40: 6e6f 6465 2d72 6f6c 652e 6b75 6265 726e  node-role.kubern
-0002eb50: 6574 6573 2e69 6f2f 636f 6e74 726f 6c2d  etes.io/control-
-0002eb60: 706c 616e 652c 6e6f 6465 2d72 6f6c 652e  plane,node-role.
-0002eb70: 6b75 6265 726e 6574 6573 2e69 6f2f 776f  kubernetes.io/wo
-0002eb80: 726b 6572 220a 2020 2020 2020 2020 2020  rker".          
-0002eb90: 2020 6375 7272 656e 7463 6d64 203d 2066    currentcmd = f
-0002eba0: 226b 7562 6563 746c 2067 6574 206e 6f64  "kubectl get nod
-0002ebb0: 6520 2d2d 7365 6c65 6374 6f72 3d27 7b73  e --selector='{s
-0002ebc0: 656c 6563 746f 727d 2722 0a20 2020 2020  elector}'".     
-0002ebd0: 2020 2020 2020 2063 7572 7265 6e74 636d         currentcm
-0002ebe0: 6420 2b3d 2022 207c 2067 7265 7020 2720  d += " | grep ' 
-0002ebf0: 5265 6164 7927 220a 2020 2020 2020 2020  Ready'".        
-0002ec00: 2020 2020 6375 7272 656e 746e 6f64 6573      currentnodes
-0002ec10: 203d 206f 732e 706f 7065 6e28 6375 7272   = os.popen(curr
-0002ec20: 656e 7463 6d64 292e 7265 6164 6c69 6e65  entcmd).readline
-0002ec30: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0002ec40: 6966 206c 656e 2863 7572 7265 6e74 6e6f  if len(currentno
-0002ec50: 6465 7329 2021 3d20 776f 726b 6572 733a  des) != workers:
-0002ec60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ec70: 2070 7072 696e 7428 6622 4f6e 676f 696e   pprint(f"Ongoin
-0002ec80: 6720 7363 616c 696e 6720 6f70 6572 6174  g scaling operat
-0002ec90: 696f 6e20 6f6e 2063 6c75 7374 6572 207b  ion on cluster {
-0002eca0: 6b75 6265 7d22 290a 2020 2020 2020 2020  kube}").        
-0002ecb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002ecc0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0002ecd0: 203d 2073 656c 662e 6175 746f 7363 616c   = self.autoscal
-0002ece0: 655f 636c 7573 7465 7228 6b75 6265 2c20  e_cluster(kube, 
-0002ecf0: 6b75 6265 7479 7065 2c20 776f 726b 6572  kubetype, worker
-0002ed00: 732c 2074 6872 6573 686f 6c64 2c20 6964  s, threshold, id
-0002ed10: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-0002ed20: 2020 2020 6966 2072 6573 756c 745b 2772      if result['r
-0002ed30: 6573 756c 7427 5d20 213d 2027 7375 6363  esult'] != 'succ
-0002ed40: 6573 7327 3a0a 2020 2020 2020 2020 2020  ess':.          
-0002ed50: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002ed60: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-0002ed70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ed90: 2020 776f 726b 6572 7320 3d20 7265 7375    workers = resu
-0002eda0: 6c74 5b27 776f 726b 6572 7327 5d0a 2020  lt['workers'].  
-0002edb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002edc0: 2020 7070 7269 6e74 2866 2243 7572 7265    pprint(f"Curre
-0002edd0: 6e74 2077 6f72 6b65 7273 206e 756d 6265  nt workers numbe
-0002ede0: 7220 6465 7369 7265 643a 207b 776f 726b  r desired: {work
-0002edf0: 6572 737d 2229 0a20 2020 2020 2020 2020  ers}").         
-0002ee00: 2020 2073 6c65 6570 2836 3029 0a0a 2020     sleep(60)..  
-0002ee10: 2020 6465 6620 7468 7265 6164 6564 5f77    def threaded_w
-0002ee20: 6562 5f63 6f6e 736f 6c65 2873 656c 662c  eb_console(self,
-0002ee30: 2070 6f72 742c 206e 616d 6529 3a0a 2020   port, name):.  
-0002ee40: 2020 2020 2020 636f 6e73 6f6c 6520 3d20        console = 
-0002ee50: 4b6d 696e 6963 6f6e 736f 6c65 2863 6f6e  Kminiconsole(con
-0002ee60: 6669 673d 7365 6c66 2c20 706f 7274 3d70  fig=self, port=p
-0002ee70: 6f72 742c 206e 616d 653d 6e61 6d65 290a  ort, name=name).
-0002ee80: 2020 2020 2020 2020 636f 6e73 6f6c 652e          console.
-0002ee90: 7275 6e28 290a 0a20 2020 2064 6566 2077  run()..    def w
-0002eea0: 6562 636f 6e73 6f6c 6528 7365 6c66 2c20  ebconsole(self, 
-0002eeb0: 6e61 6d65 293a 0a20 2020 2020 2020 2070  name):.        p
-0002eec0: 6f72 7420 3d20 6765 745f 6672 6565 5f70  ort = get_free_p
-0002eed0: 6f72 7428 290a 2020 2020 2020 2020 7420  ort().        t 
-0002eee0: 3d20 7468 7265 6164 696e 672e 5468 7265  = threading.Thre
-0002eef0: 6164 2874 6172 6765 743d 7365 6c66 2e74  ad(target=self.t
-0002ef00: 6872 6561 6465 645f 7765 625f 636f 6e73  hreaded_web_cons
-0002ef10: 6f6c 652c 2061 7267 733d 2870 6f72 742c  ole, args=(port,
-0002ef20: 206e 616d 652c 2929 0a20 2020 2020 2020   name,)).       
-0002ef30: 2074 2e73 7461 7274 2829 0a20 2020 2020   t.start().     
-0002ef40: 2020 2077 6562 6272 6f77 7365 722e 6f70     webbrowser.op
-0002ef50: 656e 2866 2268 7474 703a 2f2f 3132 372e  en(f"http://127.
-0002ef60: 302e 302e 313a 7b70 6f72 747d 222c 206e  0.0.1:{port}", n
-0002ef70: 6577 3d32 2c20 6175 746f 7261 6973 653d  ew=2, autoraise=
-0002ef80: 5472 7565 290a 0a20 2020 2064 6566 2069  True)..    def i
-0002ef90: 6e66 6f5f 7370 6563 6966 6963 5f65 6b73  nfo_specific_eks
-0002efa0: 2873 656c 662c 2063 6c75 7374 6572 293a  (self, cluster):
-0002efb0: 0a20 2020 2020 2020 2066 726f 6d20 6b76  .        from kv
-0002efc0: 6972 742e 636c 7573 7465 722e 656b 7320  irt.cluster.eks 
-0002efd0: 696d 706f 7274 2069 6e66 6f20 6173 2065  import info as e
-0002efe0: 6b73 5f69 6e66 6f0a 2020 2020 2020 2020  ks_info.        
-0002eff0: 7265 7475 726e 2065 6b73 5f69 6e66 6f28  return eks_info(
-0002f000: 7365 6c66 2c20 636c 7573 7465 722c 2073  self, cluster, s
-0002f010: 656c 662e 6465 6275 6729 0a0a 2020 2020  elf.debug)..    
-0002f020: 6465 6620 696e 666f 5f6b 7562 655f 656b  def info_kube_ek
-0002f030: 7328 7365 6c66 2c20 7175 6965 742c 2077  s(self, quiet, w
-0002f040: 6562 3d46 616c 7365 293a 0a20 2020 2020  eb=False):.     
-0002f050: 2020 2066 726f 6d20 6b76 6972 742e 636c     from kvirt.cl
-0002f060: 7573 7465 7220 696d 706f 7274 2065 6b73  uster import eks
-0002f070: 0a20 2020 2020 2020 2070 6c61 6e64 6972  .        plandir
-0002f080: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-0002f090: 6d65 2865 6b73 2e63 7265 6174 652e 5f5f  me(eks.create.__
-0002f0a0: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
-0002f0b0: 6d65 290a 2020 2020 2020 2020 696e 7075  me).        inpu
-0002f0c0: 7466 696c 6520 3d20 6627 7b70 6c61 6e64  tfile = f'{pland
-0002f0d0: 6972 7d2f 6661 6b65 2e79 6d6c 270a 2020  ir}/fake.yml'.  
-0002f0e0: 2020 2020 2020 7365 6c66 2e69 6e66 6f5f        self.info_
-0002f0f0: 706c 616e 2869 6e70 7574 6669 6c65 2c20  plan(inputfile, 
-0002f100: 7175 6965 743d 7175 6965 742c 2077 6562  quiet=quiet, web
-0002f110: 3d77 6562 290a 2020 2020 2020 2020 656b  =web).        ek
-0002f120: 732e 696e 666f 5f73 6572 7669 6365 2873  s.info_service(s
-0002f130: 656c 6629 0a0a 2020 2020 6465 6620 696e  elf)..    def in
-0002f140: 666f 5f73 7065 6369 6669 635f 676b 6528  fo_specific_gke(
-0002f150: 7365 6c66 2c20 636c 7573 7465 7229 3a0a  self, cluster):.
-0002f160: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
-0002f170: 7274 2e63 6c75 7465 722e 676b 6520 696d  rt.cluter.gke im
-0002f180: 706f 7274 2069 6e66 6f20 6173 2067 6b65  port info as gke
-0002f190: 5f69 6e66 6f0a 2020 2020 2020 2020 7265  _info.        re
-0002f1a0: 7475 726e 2067 6b65 5f69 6e66 6f28 7365  turn gke_info(se
-0002f1b0: 6c66 2c20 636c 7573 7465 722c 2073 656c  lf, cluster, sel
-0002f1c0: 662e 6465 6275 6729 0a0a 2020 2020 6465  f.debug)..    de
-0002f1d0: 6620 696e 666f 5f6b 7562 655f 676b 6528  f info_kube_gke(
-0002f1e0: 7365 6c66 2c20 7175 6965 742c 2077 6562  self, quiet, web
-0002f1f0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-0002f200: 2066 726f 6d20 6b76 6972 742e 636c 7573   from kvirt.clus
-0002f210: 7465 7220 696d 706f 7274 2067 6b65 0a20  ter import gke. 
-0002f220: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
-0002f230: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-0002f240: 2867 6b65 2e63 7265 6174 652e 5f5f 636f  (gke.create.__co
-0002f250: 6465 5f5f 2e63 6f5f 6669 6c65 6e61 6d65  de__.co_filename
-0002f260: 290a 2020 2020 2020 2020 696e 7075 7466  ).        inputf
-0002f270: 696c 6520 3d20 6627 7b70 6c61 6e64 6972  ile = f'{plandir
-0002f280: 7d2f 6661 6b65 2e79 6d6c 270a 2020 2020  }/fake.yml'.    
-0002f290: 2020 2020 7365 6c66 2e69 6e66 6f5f 706c      self.info_pl
-0002f2a0: 616e 2869 6e70 7574 6669 6c65 2c20 7175  an(inputfile, qu
-0002f2b0: 6965 743d 7175 6965 742c 2077 6562 3d77  iet=quiet, web=w
-0002f2c0: 6562 290a 2020 2020 2020 2020 676b 652e  eb).        gke.
-0002f2d0: 696e 666f 5f73 6572 7669 6365 2873 656c  info_service(sel
-0002f2e0: 6629 0a                                  f).
+0002ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce40: 2073 6c61 636b 6368 616e 6e65 6c2c 2074   slackchannel, t
+0002ce50: 6974 6c65 290a 2020 2020 2020 2020 2020  itle).          
+0002ce60: 2020 2020 2020 2020 2020 736c 6163 6b63            slackc
+0002ce70: 6d64 203d 2073 6c61 636b 636d 642e 7265  md = slackcmd.re
+0002ce80: 706c 6163 6528 275c 6e27 2c20 2727 290a  place('\n', '').
+0002ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cea0: 2020 2020 636d 6473 2e61 7070 656e 6428      cmds.append(
+0002ceb0: 736c 6163 6b63 6d64 290a 2020 2020 2020  slackcmd).      
+0002cec0: 2020 2020 2020 656c 6966 206e 6f74 6966        elif notif
+0002ced0: 796d 6574 686f 6420 3d3d 2027 6d61 696c  ymethod == 'mail
+0002cee0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0002cef0: 2020 2069 6620 6d61 696c 7365 7276 6572     if mailserver
+0002cf00: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0002cf10: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0002cf20: 726e 696e 6728 6622 4e6f 7469 6669 6361  rning(f"Notifica
+0002cf30: 7469 6f6e 2072 6571 7569 7265 6420 666f  tion required fo
+0002cf40: 7220 7b6e 616d 657d 2062 7574 206d 6973  r {name} but mis
+0002cf50: 7369 6e67 206d 6169 6c73 6572 7665 7222  sing mailserver"
+0002cf60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002cf70: 2020 656c 6966 206d 6169 6c66 726f 6d20    elif mailfrom 
+0002cf80: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002cf90: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0002cfa0: 6e69 6e67 2866 224e 6f74 6966 6963 6174  ning(f"Notificat
+0002cfb0: 696f 6e20 7265 7175 6972 6564 2066 6f72  ion required for
+0002cfc0: 207b 6e61 6d65 7d20 6275 7420 6d69 7373   {name} but miss
+0002cfd0: 696e 6720 6d61 696c 6672 6f6d 2229 0a20  ing mailfrom"). 
+0002cfe0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002cff0: 6c69 6620 6e6f 7420 6d61 696c 746f 3a0a  lif not mailto:.
+0002d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d010: 2020 2020 7761 726e 696e 6728 6622 4e6f      warning(f"No
+0002d020: 7469 6669 6361 7469 6f6e 2072 6571 7569  tification requi
+0002d030: 7265 6420 666f 7220 7b6e 616d 657d 2062  red for {name} b
+0002d040: 7574 206d 6973 7369 6e67 206d 6169 6c74  ut missing mailt
+0002d050: 6f22 290a 2020 2020 2020 2020 2020 2020  o").            
+0002d060: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002d070: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+0002d080: 7720 3d20 6461 7465 7469 6d65 2e6e 6f77  w = datetime.now
+0002d090: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0002d0a0: 2020 2020 2020 206e 6f77 203d 206e 6f77         now = now
+0002d0b0: 2e20 7374 7266 7469 6d65 2822 2561 2c25  . strftime("%a,%
+0002d0c0: 6420 2562 2025 5920 2548 3a25 4d3a 2553  d %b %Y %H:%M:%S
+0002d0d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0002d0e0: 2020 2020 2020 2074 6f73 203d 2027 2c27         tos = ','
+0002d0f0: 2e6a 6f69 6e28 5b66 223c 7b74 6f7d 3e22  .join([f"<{to}>"
+0002d100: 2066 6f72 2074 6f20 696e 206d 6169 6c74   for to in mailt
+0002d110: 6f5d 290a 2020 2020 2020 2020 2020 2020  o]).            
+0002d120: 2020 2020 2020 2020 6d61 696c 636f 6e74          mailcont
+0002d130: 656e 7420 3d20 6622 4672 6f6d 3a20 7b6d  ent = f"From: {m
+0002d140: 6169 6c66 726f 6d7d 203c 7b6d 6169 6c66  ailfrom} <{mailf
+0002d150: 726f 6d7d 3e5c 6e54 6f3a 207b 746f 737d  rom}>\nTo: {tos}
+0002d160: 5c6e 4461 7465 3a20 7b6e 6f77 7d5c 6e53  \nDate: {now}\nS
+0002d170: 7562 6a65 6374 3a20 7b74 6974 6c65 7d22  ubject: {title}"
+0002d180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d190: 2020 2020 206d 6169 6c63 6d64 203d 205b       mailcmd = [
+0002d1a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0002d1b0: 2020 2020 2020 6966 206e 6f74 2063 6c75        if not clu
+0002d1c0: 7374 6572 3a0a 2020 2020 2020 2020 2020  ster:.          
+0002d1d0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0002d1e0: 696c 636d 642e 6170 7065 6e64 2827 7465  ilcmd.append('te
+0002d1f0: 7374 202d 6620 2f65 7463 2f64 6562 6961  st -f /etc/debia
+0002d200: 6e5f 7665 7273 696f 6e20 2626 2061 7074  n_version && apt
+0002d210: 2d67 6574 202d 7920 696e 7374 616c 6c20  -get -y install 
+0002d220: 6375 726c 2729 0a20 2020 2020 2020 2020  curl').         
+0002d230: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0002d240: 6169 6c63 6d64 2e61 7070 656e 6428 2765  ailcmd.append('e
+0002d250: 6368 6f20 2222 203e 3e20 2f76 6172 2f74  cho "" >> /var/t
+0002d260: 6d70 2f6d 6169 6c2e 7478 7427 290a 2020  mp/mail.txt').  
+0002d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d280: 2020 6d61 696c 636d 642e 6170 7065 6e64    mailcmd.append
+0002d290: 2866 277b 6e6f 7469 6679 636d 647d 2032  (f'{notifycmd} 2
+0002d2a0: 3e26 3120 3e3e 202f 7661 722f 746d 702f  >&1 >> /var/tmp/
+0002d2b0: 6d61 696c 2e74 7874 2729 0a20 2020 2020  mail.txt').     
+0002d2c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002d2d0: 7572 6c63 6d64 203d 2066 2263 7572 6c20  urlcmd = f"curl 
+0002d2e0: 2d2d 7369 6c65 6e74 202d 2d75 726c 2073  --silent --url s
+0002d2f0: 6d74 703a 2f2f 7b6d 6169 6c73 6572 7665  mtp://{mailserve
+0002d300: 727d 3a32 3520 2d2d 6d61 696c 2d66 726f  r}:25 --mail-fro
+0002d310: 6d20 7b6d 6169 6c66 726f 6d7d 220a 2020  m {mailfrom}".  
+0002d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d330: 2020 666f 7220 6164 6472 6573 7320 696e    for address in
+0002d340: 206d 6169 6c74 6f3a 0a20 2020 2020 2020   mailto:.       
+0002d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d360: 2063 7572 6c63 6d64 202b 3d20 6622 202d   curlcmd += f" -
+0002d370: 2d6d 6169 6c2d 7263 7074 207b 6164 6472  -mail-rcpt {addr
+0002d380: 6573 737d 2022 0a20 2020 2020 2020 2020  ess} ".         
+0002d390: 2020 2020 2020 2020 2020 2069 6620 636c             if cl
+0002d3a0: 7573 7465 723a 0a20 2020 2020 2020 2020  uster:.         
+0002d3b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0002d3c0: 6169 6c63 6f6e 7465 6e74 203d 2022 220a  ailcontent = "".
+0002d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d3e0: 2020 2020 2020 2020 6b75 6265 636f 6e66          kubeconf
+0002d3f0: 6967 203d 2066 272f 6574 632f 6b75 6265  ig = f'/etc/kube
+0002d400: 726e 6574 6573 2f6b 7562 6563 6f6e 6669  rnetes/kubeconfi
+0002d410: 672e 7b6e 616d 657d 270a 2020 2020 2020  g.{name}'.      
+0002d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d430: 2020 6375 726c 636d 6420 2b3d 2066 2720    curlcmd += f' 
+0002d440: 2d48 2022 5375 626a 6563 743a 207b 7469  -H "Subject: {ti
+0002d450: 746c 657d 2220 2d48 2022 4672 6f6d 3a20  tle}" -H "From: 
+0002d460: 7b6d 6169 6c66 726f 6d7d 203c 7b6d 6169  {mailfrom} <{mai
+0002d470: 6c66 726f 6d7d 3e22 270a 2020 2020 2020  lfrom}>"'.      
+0002d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d490: 2020 666f 7220 6164 6472 6573 7320 696e    for address in
+0002d4a0: 206d 6169 6c74 6f3a 0a20 2020 2020 2020   mailto:.       
+0002d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d4c0: 2020 2020 2063 7572 6c63 6d64 202b 3d20       curlcmd += 
+0002d4d0: 6627 202d 4820 2254 6f3a 207b 6164 6472  f' -H "To: {addr
+0002d4e0: 6573 737d 203c 7b61 6464 7265 7373 7d3e  ess} <{address}>
+0002d4f0: 2227 0a20 2020 2020 2020 2020 2020 2020  "'.             
+0002d500: 2020 2020 2020 2020 2020 2063 7572 6c63             curlc
+0002d510: 6d64 202b 3d20 2720 2d46 2022 3d28 3b74  md += ' -F "=(;t
+0002d520: 7970 653d 6d75 6c74 6970 6172 742f 6d69  ype=multipart/mi
+0002d530: 7865 6422 202d 4620 223d 2428 6361 7420  xed" -F "=$(cat 
+0002d540: 2f76 6172 2f74 6d70 2f6d 6169 6c2e 7478  /var/tmp/mail.tx
+0002d550: 7429 3b74 7970 653d 7465 7874 2f70 6c61  t);type=text/pla
+0002d560: 696e 2227 0a20 2020 2020 2020 2020 2020  in"'.           
+0002d570: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0002d580: 6c63 6d64 202b 3d20 6627 202d 4620 2266  lcmd += f' -F "f
+0002d590: 696c 653d 407b 6b75 6265 636f 6e66 6967  ile=@{kubeconfig
+0002d5a0: 7d3b 7479 7065 3d74 6578 742f 706c 6169  };type=text/plai
+0002d5b0: 6e3b 656e 636f 6465 723d 6261 7365 3634  n;encoder=base64
+0002d5c0: 2220 2d46 2022 3d29 2227 0a20 2020 2020  " -F "=)"'.     
+0002d5d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002d5e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002d5f0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0002d600: 6c63 6d64 202b 3d20 2220 2d2d 7570 6c6f  lcmd += " --uplo
+0002d610: 6164 2d66 696c 6520 2f76 6172 2f74 6d70  ad-file /var/tmp
+0002d620: 2f6d 6169 6c2e 7478 7422 0a20 2020 2020  /mail.txt".     
+0002d630: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0002d640: 6169 6c63 6d64 2e61 7070 656e 6428 6375  ailcmd.append(cu
+0002d650: 726c 636d 6429 0a20 2020 2020 2020 2020  rlcmd).         
+0002d660: 2020 2020 2020 2020 2020 2063 6d64 732e             cmds.
+0002d670: 6578 7465 6e64 286d 6169 6c63 6d64 290a  extend(mailcmd).
+0002d680: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002d690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d6a0: 2020 6572 726f 7228 6622 496e 7661 6c69    error(f"Invali
+0002d6b0: 6420 6d65 7468 6f64 207b 6e6f 7469 6679  d method {notify
+0002d6c0: 6d65 7468 6f64 7d22 290a 2020 2020 2020  method}").      
+0002d6d0: 2020 7265 7475 726e 2063 6d64 732c 206d    return cmds, m
+0002d6e0: 6169 6c63 6f6e 7465 6e74 0a0a 2020 2020  ailcontent..    
+0002d6f0: 6465 6620 6861 6e64 6c65 5f76 6d5f 7265  def handle_vm_re
+0002d700: 7375 6c74 2873 656c 662c 206e 616d 652c  sult(self, name,
+0002d710: 2070 726f 6669 6c65 2c20 7265 7375 6c74   profile, result
+0002d720: 2c20 6e65 7776 6d73 2c20 6661 696c 6564  , newvms, failed
+0002d730: 766d 732c 2061 7379 6e63 7761 6974 766d  vms, asyncwaitvm
+0002d740: 732c 206f 6e6c 7961 7373 6574 733d 4661  s, onlyassets=Fa
+0002d750: 6c73 652c 206e 6577 6173 7365 7473 3d5b  lse, newassets=[
+0002d760: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0002d770: 2020 2020 2020 2020 2020 2020 766d 636c              vmcl
+0002d780: 6965 6e74 3d4e 6f6e 6529 3a0a 2020 2020  ient=None):.    
+0002d790: 2020 2020 6966 2027 7265 7375 6c74 2720      if 'result' 
+0002d7a0: 696e 2072 6573 756c 7420 616e 6420 7265  in result and re
+0002d7b0: 7375 6c74 5b27 7265 7375 6c74 275d 203d  sult['result'] =
+0002d7c0: 3d20 2773 7563 6365 7373 273a 0a20 2020  = 'success':.   
+0002d7d0: 2020 2020 2020 2020 206e 6577 766d 732e           newvms.
+0002d7e0: 6170 7065 6e64 286e 616d 6529 0a20 2020  append(name).   
+0002d7f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002d800: 2020 2020 2020 2066 6169 6c65 6476 6d73         failedvms
+0002d810: 2e61 7070 656e 6428 7b27 6e61 6d65 273a  .append({'name':
+0002d820: 206e 616d 652c 2027 7265 6173 6f6e 273a   name, 'reason':
+0002d830: 2072 6573 756c 745b 2772 6561 736f 6e27   result['reason'
+0002d840: 5d7d 290a 2020 2020 2020 2020 7374 6172  ]}).        star
+0002d850: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
+0002d860: 2773 7461 7274 272c 2054 7275 6529 0a20  'start', True). 
+0002d870: 2020 2020 2020 2063 6c6f 7564 696e 6974         cloudinit
+0002d880: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0002d890: 636c 6f75 6469 6e69 7427 2c20 5472 7565  cloudinit', True
+0002d8a0: 290a 2020 2020 2020 2020 6173 796e 6377  ).        asyncw
+0002d8b0: 6169 7420 3d20 7072 6f66 696c 652e 6765  ait = profile.ge
+0002d8c0: 7428 2761 7379 6e63 7761 6974 272c 2046  t('asyncwait', F
+0002d8d0: 616c 7365 290a 2020 2020 2020 2020 6669  alse).        fi
+0002d8e0: 6e69 7368 6669 6c65 7320 3d20 7072 6f66  nishfiles = prof
+0002d8f0: 696c 652e 6765 7428 2766 696e 6973 6866  ile.get('finishf
+0002d900: 696c 6573 272c 205b 5d29 0a20 2020 2020  iles', []).     
+0002d910: 2020 2069 6620 6f6e 6c79 6173 7365 7473     if onlyassets
+0002d920: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0002d930: 2027 6461 7461 2720 696e 2072 6573 756c   'data' in resul
+0002d940: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0002d950: 2020 206e 6577 6173 7365 7473 2e61 7070     newassets.app
+0002d960: 656e 6428 7265 7375 6c74 5b27 6461 7461  end(result['data
+0002d970: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+0002d980: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002d990: 2020 2020 2020 6572 726f 7228 7265 7375        error(resu
+0002d9a0: 6c74 5b27 7265 6173 6f6e 275d 290a 2020  lt['reason']).  
+0002d9b0: 2020 2020 2020 6966 206e 6f74 2061 7379        if not asy
+0002d9c0: 6e63 7761 6974 3a0a 2020 2020 2020 2020  ncwait:.        
+0002d9d0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+0002d9e0: 2020 2065 6c69 6620 6e6f 7420 7374 6172     elif not star
+0002d9f0: 7420 6f72 206e 6f74 2063 6c6f 7564 696e  t or not cloudin
+0002da00: 6974 206f 7220 7072 6f66 696c 652e 6765  it or profile.ge
+0002da10: 7428 2769 6d61 6765 2729 2069 7320 4e6f  t('image') is No
+0002da20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002da30: 7070 7269 6e74 2866 2253 6b69 7070 696e  pprint(f"Skippin
+0002da40: 6720 7761 6974 206f 6e20 7b6e 616d 657d  g wait on {name}
+0002da50: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
+0002da60: 0a20 2020 2020 2020 2020 2020 2077 6169  .            wai
+0002da70: 7463 6f6d 6d61 6e64 203d 2070 726f 6669  tcommand = profi
+0002da80: 6c65 2e67 6574 2827 7761 6974 636f 6d6d  le.get('waitcomm
+0002da90: 616e 6427 290a 2020 2020 2020 2020 2020  and').          
+0002daa0: 2020 7761 6974 7469 6d65 6f75 7420 3d20    waittimeout = 
+0002dab0: 7072 6f66 696c 652e 6765 7428 2777 6169  profile.get('wai
+0002dac0: 7474 696d 656f 7574 272c 2030 290a 2020  ttimeout', 0).  
+0002dad0: 2020 2020 2020 2020 2020 6173 796e 6377            asyncw
+0002dae0: 6169 7476 6d20 3d20 7b27 6e61 6d65 273a  aitvm = {'name':
+0002daf0: 206e 616d 652c 2027 6669 6e69 7368 6669   name, 'finishfi
+0002db00: 6c65 7327 3a20 6669 6e69 7368 6669 6c65  les': finishfile
+0002db10: 732c 2027 7761 6974 636f 6d6d 616e 6427  s, 'waitcommand'
+0002db20: 3a20 7761 6974 636f 6d6d 616e 642c 0a20  : waitcommand,. 
+0002db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002db40: 2020 2020 2020 2020 2020 2777 6169 7474            'waitt
+0002db50: 696d 656f 7574 273a 2077 6169 7474 696d  imeout': waittim
+0002db60: 656f 7574 2c20 2776 6d63 6c69 656e 7427  eout, 'vmclient'
+0002db70: 3a20 766d 636c 6965 6e74 7d0a 2020 2020  : vmclient}.    
+0002db80: 2020 2020 2020 2020 6173 796e 6377 6169          asyncwai
+0002db90: 7476 6d73 2e61 7070 656e 6428 6173 796e  tvms.append(asyn
+0002dba0: 6377 6169 7476 6d29 0a0a 2020 2020 6465  cwaitvm)..    de
+0002dbb0: 6620 7468 7265 6164 6564 5f63 7265 6174  f threaded_creat
+0002dbc0: 655f 766d 2873 656c 662c 206e 616d 652c  e_vm(self, name,
+0002dbd0: 2070 726f 6669 6c65 6e61 6d65 2c20 6375   profilename, cu
+0002dbe0: 7272 656e 746f 7665 7272 6964 6573 2c20  rrentoverrides, 
+0002dbf0: 7072 6f66 696c 652c 207a 2c20 706c 616e  profile, z, plan
+0002dc00: 2c20 6375 7272 656e 7470 6c61 6e64 6972  , currentplandir
+0002dc10: 2c20 766d 636c 6965 6e74 2c0a 2020 2020  , vmclient,.    
+0002dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc30: 2020 2020 2020 206f 6e66 6c79 2c20 6f6e         onfly, on
+0002dc40: 6c79 6173 7365 7473 2c20 6e65 7776 6d73  lyassets, newvms
+0002dc50: 2c20 6661 696c 6564 766d 732c 2061 7379  , failedvms, asy
+0002dc60: 6e63 7761 6974 766d 732c 206e 6577 6173  ncwaitvms, newas
+0002dc70: 7365 7473 293a 0a20 2020 2020 2020 2072  sets):.        r
+0002dc80: 6573 756c 7420 3d20 7365 6c66 2e63 7265  esult = self.cre
+0002dc90: 6174 655f 766d 286e 616d 652c 2070 726f  ate_vm(name, pro
+0002dca0: 6669 6c65 6e61 6d65 2c20 6f76 6572 7269  filename, overri
+0002dcb0: 6465 733d 6375 7272 656e 746f 7665 7272  des=currentoverr
+0002dcc0: 6964 6573 2c20 6375 7374 6f6d 7072 6f66  ides, customprof
+0002dcd0: 696c 653d 7072 6f66 696c 652c 206b 3d7a  ile=profile, k=z
+0002dce0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dd00: 2020 706c 616e 3d70 6c61 6e2c 2062 6173    plan=plan, bas
+0002dd10: 6564 6972 3d63 7572 7265 6e74 706c 616e  edir=currentplan
+0002dd20: 6469 722c 2063 6c69 656e 743d 766d 636c  dir, client=vmcl
+0002dd30: 6965 6e74 2c20 6f6e 666c 793d 6f6e 666c  ient, onfly=onfl
+0002dd40: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+0002dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dd60: 2020 206f 6e6c 7961 7373 6574 733d 6f6e     onlyassets=on
+0002dd70: 6c79 6173 7365 7473 290a 2020 2020 2020  lyassets).      
+0002dd80: 2020 6966 206e 6f74 206f 6e6c 7961 7373    if not onlyass
+0002dd90: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+0002dda0: 2063 6f6d 6d6f 6e2e 6861 6e64 6c65 5f72   common.handle_r
+0002ddb0: 6573 706f 6e73 6528 7265 7375 6c74 2c20  esponse(result, 
+0002ddc0: 6e61 6d65 2c20 636c 6965 6e74 3d76 6d63  name, client=vmc
+0002ddd0: 6c69 656e 7429 0a20 2020 2020 2020 2073  lient).        s
+0002dde0: 656c 662e 6861 6e64 6c65 5f76 6d5f 7265  elf.handle_vm_re
+0002ddf0: 7375 6c74 286e 616d 652c 2070 726f 6669  sult(name, profi
+0002de00: 6c65 2c20 7265 7375 6c74 3d72 6573 756c  le, result=resul
+0002de10: 742c 206e 6577 766d 733d 6e65 7776 6d73  t, newvms=newvms
+0002de20: 2c20 6661 696c 6564 766d 733d 6661 696c  , failedvms=fail
+0002de30: 6564 766d 732c 0a20 2020 2020 2020 2020  edvms,.         
+0002de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de50: 2020 2020 2061 7379 6e63 7761 6974 766d       asyncwaitvm
+0002de60: 733d 6173 796e 6377 6169 7476 6d73 2c20  s=asyncwaitvms, 
+0002de70: 6f6e 6c79 6173 7365 7473 3d6f 6e6c 7961  onlyassets=onlya
+0002de80: 7373 6574 732c 206e 6577 6173 7365 7473  ssets, newassets
+0002de90: 3d6e 6577 6173 7365 7473 2c20 766d 636c  =newassets, vmcl
+0002dea0: 6965 6e74 3d76 6d63 6c69 656e 7429 0a0a  ient=vmclient)..
+0002deb0: 2020 2020 6465 6620 7061 7273 655f 6669      def parse_fi
+0002dec0: 6c65 7328 7365 6c66 2c20 6e61 6d65 2c20  les(self, name, 
+0002ded0: 6669 6c65 732c 2062 6173 6564 6972 3d27  files, basedir='
+0002dee0: 2e27 2c20 6f6e 666c 793d 4e6f 6e65 293a  .', onfly=None):
+0002def0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0002df00: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+0002df10: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0002df20: 2020 666f 7220 696e 6465 782c 2066 696c    for index, fil
+0002df30: 2069 6e20 656e 756d 6572 6174 6528 6669   in enumerate(fi
+0002df40: 6c65 7329 3a0a 2020 2020 2020 2020 2020  les):.          
+0002df50: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0002df60: 6669 6c2c 2073 7472 293a 0a20 2020 2020  fil, str):.     
+0002df70: 2020 2020 2020 2020 2020 2070 6174 6820             path 
+0002df80: 3d20 6622 2f72 6f6f 742f 7b66 696c 7d22  = f"/root/{fil}"
+0002df90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002dfa0: 2069 6620 6261 7365 6469 7220 213d 2027   if basedir != '
+0002dfb0: 2e27 3a0a 2020 2020 2020 2020 2020 2020  .':.            
+0002dfc0: 2020 2020 2020 2020 6f72 6967 696e 203d          origin =
+0002dfd0: 2066 227b 6261 7365 6469 727d 2f7b 7061   f"{basedir}/{pa
+0002dfe0: 7468 7d22 0a20 2020 2020 2020 2020 2020  th}".           
+0002dff0: 2020 2020 206f 7269 6769 6e20 3d20 6669       origin = fi
+0002e000: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+0002e010: 2020 636f 6e74 656e 7420 3d20 4e6f 6e65    content = None
+0002e020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e030: 2066 696c 6573 5b69 6e64 6578 5d20 3d20   files[index] = 
+0002e040: 7b27 7061 7468 273a 2070 6174 682c 2027  {'path': path, '
+0002e050: 6f72 6967 696e 273a 206f 7269 6769 6e7d  origin': origin}
+0002e060: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0002e070: 6620 6973 696e 7374 616e 6365 2866 696c  f isinstance(fil
+0002e080: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
+0002e090: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
+0002e0a0: 3d20 6669 6c2e 6765 7428 276f 7269 6769  = fil.get('origi
+0002e0b0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+0002e0c0: 2020 2020 636f 6e74 656e 7420 3d20 6669      content = fi
+0002e0d0: 6c2e 6765 7428 2763 6f6e 7465 6e74 2729  l.get('content')
+0002e0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e0f0: 2070 6174 6820 3d20 6669 6c2e 6765 7428   path = fil.get(
+0002e100: 2770 6174 6827 290a 2020 2020 2020 2020  'path').        
+0002e110: 2020 2020 2020 2020 6966 2070 6174 6820          if path 
+0002e120: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002e130: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002e140: 6f72 6967 696e 2069 7320 6e6f 7420 4e6f  origin is not No
+0002e150: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002e160: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0002e170: 735b 696e 6465 785d 5b27 7061 7468 275d  s[index]['path']
+0002e180: 203d 2066 222f 726f 6f74 2f7b 6f72 6967   = f"/root/{orig
+0002e190: 696e 7d22 0a20 2020 2020 2020 2020 2020  in}".           
+0002e1a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0002e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e1c0: 2020 2020 2020 2065 7272 6f72 2866 2249         error(f"I
+0002e1d0: 6e63 6f72 7265 6374 2065 6e74 7279 207b  ncorrect entry {
+0002e1e0: 6669 6c7d 2e4c 6561 7669 6e67 2e2e 2e22  fil}.Leaving..."
+0002e1f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002e200: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+0002e210: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+0002e220: 2020 2020 2020 656c 6966 206e 6f74 2070        elif not p
+0002e230: 6174 682e 7374 6172 7473 7769 7468 2827  ath.startswith('
+0002e240: 2f27 293a 0a20 2020 2020 2020 2020 2020  /'):.           
+0002e250: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
+0002e260: 2249 6e63 6f72 7265 6374 2070 6174 6820  "Incorrect path 
+0002e270: 7b70 6174 687d 2e4c 6561 7669 6e67 2e2e  {path}.Leaving..
+0002e280: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0002e290: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+0002e2a0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+0002e2b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002e2c0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+0002e2d0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
+0002e2e0: 272c 2027 7265 6173 6f6e 273a 2022 496e  ', 'reason': "In
+0002e2f0: 636f 7272 6563 7420 6669 6c65 2065 6e74  correct file ent
+0002e300: 7279 227d 0a20 2020 2020 2020 2020 2020  ry"}.           
+0002e310: 2069 6620 6f72 6967 696e 2069 7320 6e6f   if origin is no
+0002e320: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0002e330: 2020 2020 2020 2020 6966 206f 6e66 6c79          if onfly
+0002e340: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0002e350: 2027 7e27 206e 6f74 2069 6e20 6f72 6967   '~' not in orig
+0002e360: 696e 3a0a 2020 2020 2020 2020 2020 2020  in:.            
+0002e370: 2020 2020 2020 2020 6465 7374 6469 7220          destdir 
+0002e380: 3d20 6261 7365 6469 720a 2020 2020 2020  = basedir.      
+0002e390: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002e3a0: 2027 2f27 2069 6e20 6f72 6967 696e 3a0a   '/' in origin:.
+0002e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e3c0: 2020 2020 2020 2020 6465 7374 6469 7220          destdir 
+0002e3d0: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
+0002e3e0: 6528 6f72 6967 696e 290a 2020 2020 2020  e(origin).      
+0002e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e400: 2020 6f73 2e6d 616b 6564 6972 7328 6465    os.makedirs(de
+0002e410: 7374 6469 722c 2065 7869 7374 5f6f 6b3d  stdir, exist_ok=
+0002e420: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0002e430: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+0002e440: 2e66 6574 6368 2866 227b 6f6e 666c 797d  .fetch(f"{onfly}
+0002e450: 2f7b 6f72 6967 696e 7d22 2c20 6465 7374  /{origin}", dest
+0002e460: 6469 7229 0a20 2020 2020 2020 2020 2020  dir).           
+0002e470: 2020 2020 206f 7269 6769 6e20 3d20 6f73       origin = os
+0002e480: 2e70 6174 682e 6578 7061 6e64 7573 6572  .path.expanduser
+0002e490: 286f 7269 6769 6e29 0a20 2020 2020 2020  (origin).       
+0002e4a0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0002e4b0: 6f73 2e70 6174 682e 6973 6162 7328 6f72  os.path.isabs(or
+0002e4c0: 6967 696e 293a 0a20 2020 2020 2020 2020  igin):.         
+0002e4d0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0002e4e0: 696e 7374 616e 6365 2866 696c 2c20 6469  instance(fil, di
+0002e4f0: 6374 2920 616e 6420 6669 6c2e 6765 7428  ct) and fil.get(
+0002e500: 2763 7572 7265 6e74 6469 7227 2c20 4661  'currentdir', Fa
+0002e510: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
+0002e520: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0002e530: 6967 696e 203d 2066 227b 6f73 2e67 6574  igin = f"{os.get
+0002e540: 6377 6428 297d 2f7b 6f72 6967 696e 7d22  cwd()}/{origin}"
+0002e550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e560: 2020 2020 2020 2020 2066 696c 6573 5b69           files[i
+0002e570: 6e64 6578 5d5b 276f 7269 6769 6e27 5d20  ndex]['origin'] 
+0002e580: 3d20 6f72 6967 696e 0a20 2020 2020 2020  = origin.       
+0002e590: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0002e5a0: 6620 6261 7365 6469 7220 213d 2027 2e27  f basedir != '.'
+0002e5b0: 2061 6e64 206e 6f74 206f 7269 6769 6e2e   and not origin.
+0002e5c0: 7374 6172 7473 7769 7468 2827 2e2f 2729  startswith('./')
+0002e5d0: 2061 6e64 206e 6f74 206f 7269 6769 6e2e   and not origin.
+0002e5e0: 7374 6172 7473 7769 7468 2827 2f77 6f72  startswith('/wor
+0002e5f0: 6b64 6972 2f27 293a 0a20 2020 2020 2020  kdir/'):.       
+0002e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e610: 206f 7269 6769 6e20 3d20 6622 7b62 6173   origin = f"{bas
+0002e620: 6564 6972 7d2f 7b6f 7269 6769 6e7d 220a  edir}/{origin}".
+0002e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e640: 2020 2020 2020 2020 6669 6c65 735b 696e          files[in
+0002e650: 6465 785d 5b27 6f72 6967 696e 275d 203d  dex]['origin'] =
+0002e660: 206f 7269 6769 6e0a 2020 2020 2020 2020   origin.        
+0002e670: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0002e680: 732e 7061 7468 2e65 7869 7374 7328 6f72  s.path.exists(or
+0002e690: 6967 696e 293a 0a20 2020 2020 2020 2020  igin):.         
+0002e6a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002e6b0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+0002e6c0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+0002e6d0: 3a20 6622 4f72 6967 696e 2066 696c 6520  : f"Origin file 
+0002e6e0: 7b6f 7269 6769 6e7d 206e 6f74 2066 6f75  {origin} not fou
+0002e6f0: 6e64 2066 6f72 207b 6e61 6d65 7d22 7d0a  nd for {name}"}.
+0002e700: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0002e710: 2063 6f6e 7465 6e74 2069 7320 4e6f 6e65   content is None
+0002e720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002e730: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+0002e740: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
+0002e750: 7265 6173 6f6e 273a 2066 2243 6f6e 7465  reason': f"Conte
+0002e760: 6e74 206f 6620 6669 6c65 207b 7061 7468  nt of file {path
+0002e770: 7d20 6e6f 7420 666f 756e 6420 666f 7220  } not found for 
+0002e780: 7b6e 616d 657d 227d 0a0a 2020 2020 6465  {name}"}..    de
+0002e790: 6620 7072 6570 656e 645f 696e 7075 745f  f prepend_input_
+0002e7a0: 6469 7228 7365 6c66 2c20 6e65 7766 696c  dir(self, newfil
+0002e7b0: 6573 2c20 696e 7075 7464 6972 293a 0a20  es, inputdir):. 
+0002e7c0: 2020 2020 2020 2072 6573 756c 7473 203d         results =
+0002e7d0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+0002e7e0: 6669 6320 696e 206e 6577 6669 6c65 733a  fic in newfiles:
+0002e7f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002e800: 6973 696e 7374 616e 6365 2866 6963 2c20  isinstance(fic, 
+0002e810: 7374 7229 2061 6e64 206e 6f74 206f 732e  str) and not os.
+0002e820: 7061 7468 2e69 7361 6273 2866 6963 293a  path.isabs(fic):
+0002e830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e840: 206e 6577 5f66 6963 203d 2066 227b 696e   new_fic = f"{in
+0002e850: 7075 7464 6972 7d2f 7b66 6963 7d22 0a20  putdir}/{fic}". 
+0002e860: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0002e870: 6973 696e 7374 616e 6365 2866 6963 2c20  isinstance(fic, 
+0002e880: 6469 6374 2920 616e 6420 276f 7269 6769  dict) and 'origi
+0002e890: 6e27 2069 6e20 6669 6320 616e 6420 6e6f  n' in fic and no
+0002e8a0: 7420 6f73 2e70 6174 682e 6973 6162 7328  t os.path.isabs(
+0002e8b0: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+0002e8c0: 6572 2866 6963 5b27 6f72 6967 696e 275d  er(fic['origin']
+0002e8d0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0002e8e0: 2020 2020 6e65 775f 6669 6320 3d20 6669      new_fic = fi
+0002e8f0: 632e 636f 7079 2829 0a20 2020 2020 2020  c.copy().       
+0002e900: 2020 2020 2020 2020 206e 6577 5f66 6963           new_fic
+0002e910: 5b27 6f72 6967 696e 275d 203d 2066 227b  ['origin'] = f"{
+0002e920: 696e 7075 7464 6972 7d2f 7b66 6963 5b27  inputdir}/{fic['
+0002e930: 6f72 6967 696e 275d 7d22 0a20 2020 2020  origin']}".     
+0002e940: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002e950: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0002e960: 5f66 6963 203d 2066 6963 0a20 2020 2020  _fic = fic.     
+0002e970: 2020 2020 2020 2072 6573 756c 7473 2e61         results.a
+0002e980: 7070 656e 6428 6e65 775f 6669 6329 0a20  ppend(new_fic). 
+0002e990: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0002e9a0: 7375 6c74 730a 0a20 2020 2064 6566 2072  sults..    def r
+0002e9b0: 656d 6564 6961 7465 5f66 696c 6573 2873  emediate_files(s
+0002e9c0: 656c 662c 206e 616d 652c 206e 6577 6669  elf, name, newfi
+0002e9d0: 6c65 732c 206f 7665 7272 6964 6573 3d7b  les, overrides={
+0002e9e0: 7d2c 2069 6e70 7574 6469 723d 272e 2729  }, inputdir='.')
+0002e9f0: 3a0a 2020 2020 2020 2020 7570 6461 7465  :.        update
+0002ea00: 645f 6669 6c65 7320 3d20 5b5d 0a20 2020  d_files = [].   
+0002ea10: 2020 2020 2069 702c 2076 6d70 6f72 7420       ip, vmport 
+0002ea20: 3d20 5f73 7368 5f63 7265 6465 6e74 6961  = _ssh_credentia
+0002ea30: 6c73 2873 656c 662e 6b2c 206e 616d 6529  ls(self.k, name)
+0002ea40: 5b31 3a5d 0a20 2020 2020 2020 2069 6620  [1:].        if 
+0002ea50: 696e 7075 7464 6972 2021 3d20 272e 273a  inputdir != '.':
+0002ea60: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+0002ea70: 6669 6c65 7320 3d20 7365 6c66 2e70 7265  files = self.pre
+0002ea80: 7065 6e64 5f69 6e70 7574 5f64 6972 286e  pend_input_dir(n
+0002ea90: 6577 6669 6c65 732c 2069 6e70 7574 6469  ewfiles, inputdi
+0002eaa0: 7229 0a20 2020 2020 2020 2073 656c 662e  r).        self.
+0002eab0: 7061 7273 655f 6669 6c65 7328 6e61 6d65  parse_files(name
+0002eac0: 2c20 6e65 7766 696c 6573 290a 2020 2020  , newfiles).    
+0002ead0: 2020 2020 6f76 6572 7269 6465 735f 6669      overrides_fi
+0002eae0: 6c65 7320 3d20 6f76 6572 7269 6465 732e  les = overrides.
+0002eaf0: 636f 7079 2829 0a20 2020 2020 2020 206f  copy().        o
+0002eb00: 7665 7272 6964 6573 5f66 696c 6573 5b27  verrides_files['
+0002eb10: 6e61 6d65 275d 203d 206e 616d 650a 2020  name'] = name.  
+0002eb20: 2020 2020 2020 6461 7461 203d 2070 726f        data = pro
+0002eb30: 6365 7373 5f66 696c 6573 2866 696c 6573  cess_files(files
+0002eb40: 3d6e 6577 6669 6c65 732c 206f 7665 7272  =newfiles, overr
+0002eb50: 6964 6573 3d6f 7665 7272 6964 6573 5f66  ides=overrides_f
+0002eb60: 696c 6573 2c20 7265 6d65 6469 6174 653d  iles, remediate=
+0002eb70: 5472 7565 290a 2020 2020 2020 2020 6461  True).        da
+0002eb80: 7461 6469 7273 203d 207b 7d0a 2020 2020  tadirs = {}.    
+0002eb90: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
+0002eba0: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
+0002ebb0: 2074 6d70 6469 723a 0a20 2020 2020 2020   tmpdir:.       
+0002ebc0: 2020 2020 2066 6f72 2069 6e64 6578 2c20       for index, 
+0002ebd0: 656e 7472 7920 696e 2065 6e75 6d65 7261  entry in enumera
+0002ebe0: 7465 2864 6174 6129 3a0a 2020 2020 2020  te(data):.      
+0002ebf0: 2020 2020 2020 2020 2020 6465 7374 696e            destin
+0002ec00: 6174 696f 6e20 3d20 656e 7472 795b 2770  ation = entry['p
+0002ec10: 6174 6827 5d0a 2020 2020 2020 2020 2020  ath'].          
+0002ec20: 2020 2020 2020 7061 7468 6469 7220 3d20        pathdir = 
+0002ec30: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+0002ec40: 6465 7374 696e 6174 696f 6e29 0a20 2020  destination).   
+0002ec50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002ec60: 7061 7468 6469 7220 6e6f 7420 696e 2064  pathdir not in d
+0002ec70: 6174 6164 6972 733a 0a20 2020 2020 2020  atadirs:.       
+0002ec80: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+0002ec90: 6864 6972 636d 6420 3d20 6627 6c73 202d  hdircmd = f'ls -
+0002eca0: 6120 7b70 6174 6864 6972 7d20 323e 2631  a {pathdir} 2>&1
+0002ecb0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0002ecc0: 2020 2020 2020 7061 7468 6469 7263 6d64        pathdircmd
+0002ecd0: 203d 2073 7368 286e 616d 652c 2069 703d   = ssh(name, ip=
+0002ece0: 6970 2c20 7573 6572 3d27 726f 6f74 272c  ip, user='root',
+0002ecf0: 2074 756e 6e65 6c3d 7365 6c66 2e74 756e   tunnel=self.tun
+0002ed00: 6e65 6c2c 2074 756e 6e65 6c68 6f73 743d  nel, tunnelhost=
+0002ed10: 7365 6c66 2e74 756e 6e65 6c68 6f73 742c  self.tunnelhost,
+0002ed20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ed40: 2020 2020 2020 7475 6e6e 656c 706f 7274        tunnelport
+0002ed50: 3d73 656c 662e 7475 6e6e 656c 706f 7274  =self.tunnelport
+0002ed60: 2c20 7475 6e6e 656c 7573 6572 3d73 656c  , tunneluser=sel
+0002ed70: 662e 7475 6e6e 656c 7573 6572 2c20 696e  f.tunneluser, in
+0002ed80: 7365 6375 7265 3d54 7275 652c 0a20 2020  secure=True,.   
+0002ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002edb0: 2020 636d 643d 7061 7468 6469 7263 6d64    cmd=pathdircmd
+0002edc0: 2c20 766d 706f 7274 3d76 6d70 6f72 7429  , vmport=vmport)
+0002edd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ede0: 2020 2020 2070 6174 6864 6972 6669 6c65       pathdirfile
+0002edf0: 7320 3d20 6f73 2e70 6f70 656e 2870 6174  s = os.popen(pat
+0002ee00: 6864 6972 636d 6429 2e72 6561 646c 696e  hdircmd).readlin
+0002ee10: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
+0002ee20: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0002ee30: 7061 7468 6469 7266 696c 6573 2920 3d3d  pathdirfiles) ==
+0002ee40: 2031 2061 6e64 2027 4e6f 2073 7563 6820   1 and 'No such 
+0002ee50: 6669 6c65 206f 7220 6469 7265 6374 6f72  file or director
+0002ee60: 7927 2069 6e20 7061 7468 6469 7266 696c  y' in pathdirfil
+0002ee70: 6573 5b30 5d3a 0a20 2020 2020 2020 2020  es[0]:.         
+0002ee80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002ee90: 7265 6174 6564 6972 636d 6420 3d20 6627  reatedircmd = f'
+0002eea0: 6d6b 6469 7220 2d70 207b 7061 7468 6469  mkdir -p {pathdi
+0002eeb0: 727d 270a 2020 2020 2020 2020 2020 2020  r}'.            
+0002eec0: 2020 2020 2020 2020 2020 2020 6372 6561              crea
+0002eed0: 7465 6469 7263 6d64 203d 2073 7368 286e  tedircmd = ssh(n
+0002eee0: 616d 652c 2069 703d 6970 2c20 7573 6572  ame, ip=ip, user
+0002eef0: 3d27 726f 6f74 272c 2074 756e 6e65 6c3d  ='root', tunnel=
+0002ef00: 7365 6c66 2e74 756e 6e65 6c2c 2074 756e  self.tunnel, tun
+0002ef10: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
+0002ef20: 6e65 6c68 6f73 742c 0a20 2020 2020 2020  nelhost,.       
+0002ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ef50: 2020 2020 7475 6e6e 656c 706f 7274 3d73      tunnelport=s
+0002ef60: 656c 662e 7475 6e6e 656c 706f 7274 2c20  elf.tunnelport, 
+0002ef70: 7475 6e6e 656c 7573 6572 3d73 656c 662e  tunneluser=self.
+0002ef80: 7475 6e6e 656c 7573 6572 2c20 696e 7365  tunneluser, inse
+0002ef90: 6375 7265 3d54 7275 652c 0a20 2020 2020  cure=True,.     
+0002efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002efc0: 2020 2020 2020 636d 643d 6372 6561 7465        cmd=create
+0002efd0: 6469 7263 6d64 2c20 766d 706f 7274 3d76  dircmd, vmport=v
+0002efe0: 6d70 6f72 7429 0a20 2020 2020 2020 2020  mport).         
+0002eff0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0002f000: 732e 706f 7065 6e28 6372 6561 7465 6469  s.popen(createdi
+0002f010: 7263 6d64 290a 2020 2020 2020 2020 2020  rcmd).          
+0002f020: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0002f030: 7468 6469 7266 696c 6573 203d 205b 5d0a  thdirfiles = [].
+0002f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f050: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f070: 2020 7061 7468 6469 7266 696c 6573 203d    pathdirfiles =
+0002f080: 205b 782e 7374 7269 7028 2920 666f 7220   [x.strip() for 
+0002f090: 7820 696e 2070 6174 6864 6972 6669 6c65  x in pathdirfile
+0002f0a0: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
+0002f0b0: 2020 2020 2020 2064 6174 6164 6972 735b         datadirs[
+0002f0c0: 7061 7468 6469 725d 203d 2070 6174 6864  pathdir] = pathd
+0002f0d0: 6972 6669 6c65 730a 2020 2020 2020 2020  irfiles.        
+0002f0e0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+0002f0f0: 7468 2e62 6173 656e 616d 6528 6465 7374  th.basename(dest
+0002f100: 696e 6174 696f 6e29 206e 6f74 2069 6e20  ination) not in 
+0002f110: 6461 7461 6469 7273 5b70 6174 6864 6972  datadirs[pathdir
+0002f120: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0002f130: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+0002f140: 5570 6461 7469 6e67 207b 6465 7374 696e  Updating {destin
+0002f150: 6174 696f 6e7d 2069 6e20 7b6e 616d 657d  ation} in {name}
+0002f160: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0002f170: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
+0002f180: 6622 7b74 6d70 6469 727d 2f66 6963 7b69  f"{tmpdir}/fic{i
+0002f190: 6e64 6578 7d22 0a20 2020 2020 2020 2020  ndex}".         
+0002f1a0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0002f1b0: 6f70 656e 2873 6f75 7263 652c 2027 7727  open(source, 'w'
+0002f1c0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+0002f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f1e0: 662e 7772 6974 6528 656e 7472 795b 2763  f.write(entry['c
+0002f1f0: 6f6e 7465 6e74 275d 290a 2020 2020 2020  ontent']).      
+0002f200: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0002f210: 7063 6d64 203d 2073 6370 286e 616d 652c  pcmd = scp(name,
+0002f220: 2069 703d 6970 2c20 7573 6572 3d27 726f   ip=ip, user='ro
+0002f230: 6f74 272c 2073 6f75 7263 653d 736f 7572  ot', source=sour
+0002f240: 6365 2c20 6465 7374 696e 6174 696f 6e3d  ce, destination=
+0002f250: 6465 7374 696e 6174 696f 6e2c 2074 756e  destination, tun
+0002f260: 6e65 6c3d 7365 6c66 2e74 756e 6e65 6c2c  nel=self.tunnel,
+0002f270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f290: 2020 7475 6e6e 656c 686f 7374 3d73 656c    tunnelhost=sel
+0002f2a0: 662e 7475 6e6e 656c 686f 7374 2c20 7475  f.tunnelhost, tu
+0002f2b0: 6e6e 656c 706f 7274 3d73 656c 662e 7475  nnelport=self.tu
+0002f2c0: 6e6e 656c 706f 7274 2c20 7475 6e6e 656c  nnelport, tunnel
+0002f2d0: 7573 6572 3d73 656c 662e 7475 6e6e 656c  user=self.tunnel
+0002f2e0: 7573 6572 2c0a 2020 2020 2020 2020 2020  user,.          
+0002f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f300: 2020 2020 2020 2064 6f77 6e6c 6f61 643d         download=
+0002f310: 4661 6c73 652c 2069 6e73 6563 7572 653d  False, insecure=
+0002f320: 5472 7565 2c20 766d 706f 7274 3d76 6d70  True, vmport=vmp
+0002f330: 6f72 7429 0a20 2020 2020 2020 2020 2020  ort).           
+0002f340: 2020 2020 2020 2020 206f 732e 7379 7374           os.syst
+0002f350: 656d 2873 6370 636d 6429 0a20 2020 2020  em(scpcmd).     
+0002f360: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0002f370: 7064 6174 6564 5f66 696c 6573 2e61 7070  pdated_files.app
+0002f380: 656e 6428 6465 7374 696e 6174 696f 6e29  end(destination)
+0002f390: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002f3a0: 7570 6461 7465 645f 6669 6c65 730a 0a20  updated_files.. 
+0002f3b0: 2020 2064 6566 2069 6e66 6f5f 7370 6563     def info_spec
+0002f3c0: 6966 6963 5f70 6c61 6e28 7365 6c66 2c20  ific_plan(self, 
+0002f3d0: 706c 616e 293a 0a20 2020 2020 2020 2070  plan):.        p
+0002f3e0: 7072 696e 7428 6622 5072 6f76 6964 696e  print(f"Providin
+0002f3f0: 6720 696e 666f 726d 6174 696f 6e20 6162  g information ab
+0002f400: 6f75 7420 706c 616e 207b 706c 616e 7d22  out plan {plan}"
+0002f410: 290a 2020 2020 2020 2020 6b20 3d20 7365  ).        k = se
+0002f420: 6c66 2e6b 0a20 2020 2020 2020 2072 6573  lf.k.        res
+0002f430: 756c 7473 203d 205b 5d0a 2020 2020 2020  ults = [].      
+0002f440: 2020 666f 7220 766d 2069 6e20 6b2e 6c69    for vm in k.li
+0002f450: 7374 2829 3a0a 2020 2020 2020 2020 2020  st():.          
+0002f460: 2020 6966 2076 6d2e 6765 7428 2770 6c61    if vm.get('pla
+0002f470: 6e27 2c20 2727 2920 3d3d 2070 6c61 6e3a  n', '') == plan:
+0002f480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f490: 2072 6573 756c 7473 2e61 7070 656e 6428   results.append(
+0002f4a0: 766d 290a 2020 2020 2020 2020 7265 7475  vm).        retu
+0002f4b0: 726e 2072 6573 756c 7473 0a0a 2020 2020  rn results..    
+0002f4c0: 6465 6620 6175 746f 7363 616c 655f 636c  def autoscale_cl
+0002f4d0: 7573 7465 7228 7365 6c66 2c20 6b75 6265  uster(self, kube
+0002f4e0: 2c20 6b75 6265 7479 7065 2c20 776f 726b  , kubetype, work
+0002f4f0: 6572 732c 2074 6872 6573 686f 6c64 2c20  ers, threshold, 
+0002f500: 6964 6c65 293a 0a20 2020 2020 2020 2069  idle):.        i
+0002f510: 6620 7468 7265 7368 6f6c 6420 3e20 3939  f threshold > 99
+0002f520: 3939 3a0a 2020 2020 2020 2020 2020 2020  99:.            
+0002f530: 7070 7269 6e74 2866 2253 6b69 7070 696e  pprint(f"Skippin
+0002f540: 6720 6175 746f 7363 616c 696e 6720 7570  g autoscaling up
+0002f550: 2063 6865 636b 7320 666f 7220 636c 7573   checks for clus
+0002f560: 7465 7220 7b6b 7562 657d 2061 7320 7065  ter {kube} as pe
+0002f570: 7220 7468 7265 7368 6f6c 6420 7b74 6872  r threshold {thr
+0002f580: 6573 686f 6c64 7d22 290a 2020 2020 2020  eshold}").      
+0002f590: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+0002f5a0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+0002f5b0: 272c 2027 776f 726b 6572 7327 3a20 776f  ', 'workers': wo
+0002f5c0: 726b 6572 737d 0a20 2020 2020 2020 2069  rkers}.        i
+0002f5d0: 6620 6964 6c65 203c 2031 3a0a 2020 2020  f idle < 1:.    
+0002f5e0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002f5f0: 2253 6b69 7070 696e 6720 6175 746f 7363  "Skipping autosc
+0002f600: 616c 696e 6720 646f 776e 2063 6865 636b  aling down check
+0002f610: 7320 666f 7220 636c 7573 7465 7220 7b6b  s for cluster {k
+0002f620: 7562 657d 2061 7320 7065 7220 6964 6c65  ube} as per idle
+0002f630: 207b 6964 6c65 7d22 290a 2020 2020 2020   {idle}").      
+0002f640: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+0002f650: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+0002f660: 272c 2027 776f 726b 6572 7327 3a20 776f  ', 'workers': wo
+0002f670: 726b 6572 737d 0a20 2020 2020 2020 2070  rkers}.        p
+0002f680: 7072 696e 7428 6622 4368 6563 6b69 6e67  print(f"Checking
+0002f690: 206e 6f6e 2073 6368 6564 756c 6564 2070   non scheduled p
+0002f6a0: 6f64 7320 636f 756e 7420 6f6e 2063 6c75  ods count on clu
+0002f6b0: 7374 6572 207b 6b75 6265 7d22 290a 2020  ster {kube}").  
+0002f6c0: 2020 2020 2020 7365 6c65 6374 6f72 203d        selector =
+0002f6d0: 2022 216e 6f64 652d 726f 6c65 2e6b 7562   "!node-role.kub
+0002f6e0: 6572 6e65 7465 732e 696f 2f63 6f6e 7472  ernetes.io/contr
+0002f6f0: 6f6c 2d70 6c61 6e65 2c6e 6f64 652d 726f  ol-plane,node-ro
+0002f700: 6c65 2e6b 7562 6572 6e65 7465 732e 696f  le.kubernetes.io
+0002f710: 2f77 6f72 6b65 7222 0a20 2020 2020 2020  /worker".       
+0002f720: 2063 7572 7265 6e74 636d 6420 3d20 6622   currentcmd = f"
+0002f730: 6b75 6265 6374 6c20 6765 7420 6e6f 6465  kubectl get node
+0002f740: 202d 2d73 656c 6563 746f 723d 277b 7365   --selector='{se
+0002f750: 6c65 6374 6f72 7d27 220a 2020 2020 2020  lector}'".      
+0002f760: 2020 6375 7272 656e 7463 6d64 202b 3d20    currentcmd += 
+0002f770: 2220 7c20 6772 6570 2027 2052 6561 6479  " | grep ' Ready
+0002f780: 2722 0a20 2020 2020 2020 2077 6f72 6b65  '".        worke
+0002f790: 7273 203d 206c 656e 286f 732e 706f 7065  rs = len(os.pope
+0002f7a0: 6e28 6375 7272 656e 7463 6d64 292e 7265  n(currentcmd).re
+0002f7b0: 6164 6c69 6e65 7328 2929 0a20 2020 2020  adlines()).     
+0002f7c0: 2020 2070 656e 6469 6e67 636d 6420 3d20     pendingcmd = 
+0002f7d0: 226b 7562 6563 746c 2067 6574 2070 6f64  "kubectl get pod
+0002f7e0: 7320 2d41 202d 2d66 6965 6c64 2d73 656c  s -A --field-sel
+0002f7f0: 6563 746f 723d 7374 6174 7573 2e70 6861  ector=status.pha
+0002f800: 7365 3d50 656e 6469 6e67 202d 6f20 7961  se=Pending -o ya
+0002f810: 6d6c 220a 2020 2020 2020 2020 7065 6e64  ml".        pend
+0002f820: 696e 675f 706f 6473 203d 2079 616d 6c2e  ing_pods = yaml.
+0002f830: 7361 6665 5f6c 6f61 6428 6f73 2e70 6f70  safe_load(os.pop
+0002f840: 656e 2870 656e 6469 6e67 636d 6429 2e72  en(pendingcmd).r
+0002f850: 6561 6428 2929 5b27 6974 656d 7327 5d0a  ead())['items'].
+0002f860: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
+0002f870: 656e 6469 6e67 5f70 6f64 7329 203e 2074  ending_pods) > t
+0002f880: 6872 6573 686f 6c64 3a0a 2020 2020 2020  hreshold:.      
+0002f890: 2020 2020 2020 7070 7269 6e74 2866 2254        pprint(f"T
+0002f8a0: 7269 6767 6572 696e 6720 7363 616c 696e  riggering scalin
+0002f8b0: 6720 7570 2066 6f72 2063 6c75 7374 6572  g up for cluster
+0002f8c0: 207b 6b75 6265 7d20 6173 2074 6865 7265   {kube} as there
+0002f8d0: 2061 7265 207b 6c65 6e28 7065 6e64 696e   are {len(pendin
+0002f8e0: 675f 706f 6473 297d 2070 656e 6469 6e67  g_pods)} pending
+0002f8f0: 2070 6f64 7322 290a 2020 2020 2020 2020   pods").        
+0002f900: 2020 2020 776f 726b 6572 7320 2b3d 2031      workers += 1
+0002f910: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+0002f920: 696e 7428 2253 6361 6c69 6e67 2075 7020  int("Scaling up 
+0002f930: 636c 7573 7465 7220 7b6b 7562 657d 2074  cluster {kube} t
+0002f940: 6f20 7b77 6f72 6b65 7273 7d20 776f 726b  o {workers} work
+0002f950: 6572 7322 290a 2020 2020 2020 2020 2020  ers").          
+0002f960: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
+0002f970: 7363 616c 655f 6b75 6265 286b 7562 652c  scale_kube(kube,
+0002f980: 206b 7562 6574 7970 652c 206f 7665 7272   kubetype, overr
+0002f990: 6964 6573 3d7b 2777 6f72 6b65 7273 273a  ides={'workers':
+0002f9a0: 2077 6f72 6b65 7273 7d29 0a20 2020 2020   workers}).     
+0002f9b0: 2020 2020 2020 2072 6573 756c 745b 2777         result['w
+0002f9c0: 6f72 6b65 7273 275d 203d 2077 6f72 6b65  orkers'] = worke
+0002f9d0: 7273 0a20 2020 2020 2020 2020 2020 2072  rs.            r
+0002f9e0: 6574 7572 6e20 7265 7375 6c74 0a20 2020  eturn result.   
+0002f9f0: 2020 2020 206e 6f64 6573 203d 207b 7d0a       nodes = {}.
+0002fa00: 2020 2020 2020 2020 6375 7272 656e 7463          currentc
+0002fa10: 6d64 203d 2022 6b75 6265 6374 6c20 6765  md = "kubectl ge
+0002fa20: 7420 706f 6420 2d41 202d 6f20 7961 6d6c  t pod -A -o yaml
+0002fa30: 220a 2020 2020 2020 2020 616c 6c70 6f64  ".        allpod
+0002fa40: 7320 3d20 7961 6d6c 2e73 6166 655f 6c6f  s = yaml.safe_lo
+0002fa50: 6164 286f 732e 706f 7065 6e28 6375 7272  ad(os.popen(curr
+0002fa60: 656e 7463 6d64 292e 7265 6164 2829 295b  entcmd).read())[
+0002fa70: 2769 7465 6d73 275d 0a20 2020 2020 2020  'items'].       
+0002fa80: 2066 6f72 2070 6f64 2069 6e20 616c 6c70   for pod in allp
+0002fa90: 6f64 733a 0a20 2020 2020 2020 2020 2020  ods:.           
+0002faa0: 206e 6f64 656e 616d 6520 3d20 706f 645b   nodename = pod[
+0002fab0: 2773 7065 6327 5d5b 276e 6f64 654e 616d  'spec']['nodeNam
+0002fac0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+0002fad0: 7374 6174 7573 203d 2070 6f64 5b27 7374  status = pod['st
+0002fae0: 6174 7573 275d 5b27 7068 6173 6527 5d0a  atus']['phase'].
+0002faf0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0002fb00: 7461 7475 7320 213d 2027 5275 6e6e 696e  tatus != 'Runnin
+0002fb10: 6727 3a0a 2020 2020 2020 2020 2020 2020  g':.            
+0002fb20: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0002fb30: 2020 2020 2020 2020 2069 6620 6e6f 6465           if node
+0002fb40: 6e61 6d65 206e 6f74 2069 6e20 6e6f 6465  name not in node
+0002fb50: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0002fb60: 2020 206e 6f64 6573 5b6e 6f64 656e 616d     nodes[nodenam
+0002fb70: 655d 203d 2031 0a20 2020 2020 2020 2020  e] = 1.         
+0002fb80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002fb90: 2020 2020 2020 2020 206e 6f64 6573 5b6e           nodes[n
+0002fba0: 6f64 656e 616d 655d 202b 3d20 310a 2020  odename] += 1.  
+0002fbb0: 2020 2020 2020 746f 6465 6c65 7465 203d        todelete =
+0002fbc0: 2030 0a20 2020 2020 2020 2066 6f72 206e   0.        for n
+0002fbd0: 6f64 6520 696e 206e 6f64 6573 3a0a 2020  ode in nodes:.  
+0002fbe0: 2020 2020 2020 2020 2020 6966 206e 6f64            if nod
+0002fbf0: 6573 5b6e 6f64 655d 203c 2069 646c 653a  es[node] < idle:
+0002fc00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002fc10: 2070 7072 696e 7428 6622 6e6f 6465 207b   pprint(f"node {
+0002fc20: 6e6f 6465 7d20 746f 2062 6520 7265 6d6f  node} to be remo
+0002fc30: 7665 6420 7369 6e63 6520 6974 206f 6e6c  ved since it onl
+0002fc40: 7920 6861 7320 7468 6520 666f 6c6c 6f77  y has the follow
+0002fc50: 696e 6720 706f 6473 3a20 7b6e 6f64 6573  ing pods: {nodes
+0002fc60: 5b6e 6f64 655d 7d22 290a 2020 2020 2020  [node]}").      
+0002fc70: 2020 2020 2020 2020 2020 746f 6465 6c65            todele
+0002fc80: 7465 202b 3d20 310a 2020 2020 2020 2020  te += 1.        
+0002fc90: 6966 2074 6f64 656c 6574 6520 3e20 303a  if todelete > 0:
+0002fca0: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+0002fcb0: 696e 7428 6622 5472 6967 6765 7269 6e67  int(f"Triggering
+0002fcc0: 2073 6361 6c69 6e67 2064 6f77 6e20 666f   scaling down fo
+0002fcd0: 7220 636c 7573 7465 7220 7b6b 7562 657d  r cluster {kube}
+0002fce0: 2061 7320 7468 6572 6520 6172 6520 7b74   as there are {t
+0002fcf0: 6f64 656c 6574 657d 2069 646c 6520 6e6f  odelete} idle no
+0002fd00: 6465 7322 290a 2020 2020 2020 2020 2020  des").          
+0002fd10: 2020 776f 726b 6572 7320 3d20 776f 726b    workers = work
+0002fd20: 6572 7320 2d20 746f 6465 6c65 7465 0a20  ers - todelete. 
+0002fd30: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0002fd40: 7428 6622 5363 616c 696e 6720 646f 776e  t(f"Scaling down
+0002fd50: 2063 6c75 7374 6572 207b 6b75 6265 7d20   cluster {kube} 
+0002fd60: 746f 207b 776f 726b 6572 737d 2077 6f72  to {workers} wor
+0002fd70: 6b65 7273 2229 0a20 2020 2020 2020 2020  kers").         
+0002fd80: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
+0002fd90: 2e73 6361 6c65 5f6b 7562 6528 6b75 6265  .scale_kube(kube
+0002fda0: 2c20 6b75 6265 7479 7065 2c20 6f76 6572  , kubetype, over
+0002fdb0: 7269 6465 733d 7b27 776f 726b 6572 7327  rides={'workers'
+0002fdc0: 3a20 776f 726b 6572 737d 290a 2020 2020  : workers}).    
+0002fdd0: 2020 2020 2020 2020 7265 7375 6c74 5b27          result['
+0002fde0: 776f 726b 6572 7327 5d20 3d20 776f 726b  workers'] = work
+0002fdf0: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
+0002fe00: 7265 7475 726e 2072 6573 756c 740a 2020  return result.  
+0002fe10: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+0002fe20: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+0002fe30: 272c 2027 776f 726b 6572 7327 3a20 776f  ', 'workers': wo
+0002fe40: 726b 6572 737d 0a0a 2020 2020 6465 6620  rkers}..    def 
+0002fe50: 6c6f 6f70 5f61 7574 6f73 6361 6c65 5f63  loop_autoscale_c
+0002fe60: 6c75 7374 6572 2873 656c 662c 206b 7562  luster(self, kub
+0002fe70: 652c 206b 7562 6574 7970 652c 2077 6f72  e, kubetype, wor
+0002fe80: 6b65 7273 2c20 7468 7265 7368 6f6c 642c  kers, threshold,
+0002fe90: 2069 646c 6529 3a0a 2020 2020 2020 2020   idle):.        
+0002fea0: 7070 7269 6e74 2866 2253 7461 7274 696e  pprint(f"Startin
+0002feb0: 6720 7769 7468 207b 776f 726b 6572 737d  g with {workers}
+0002fec0: 2077 6f72 6b65 7273 2229 0a20 2020 2020   workers").     
+0002fed0: 2020 2069 6620 7768 6963 6828 276b 7562     if which('kub
+0002fee0: 6563 746c 2729 2069 7320 4e6f 6e65 3a0a  ectl') is None:.
+0002fef0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+0002ff00: 6f6e 2e67 6574 5f6b 7562 6563 746c 2829  on.get_kubectl()
+0002ff10: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+0002ff20: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
+0002ff30: 2b3d 2027 3a2e 270a 2020 2020 2020 2020  += ':.'.        
+0002ff40: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
+0002ff50: 2020 2020 2020 2020 7365 6c65 6374 6f72          selector
+0002ff60: 203d 2022 216e 6f64 652d 726f 6c65 2e6b   = "!node-role.k
+0002ff70: 7562 6572 6e65 7465 732e 696f 2f63 6f6e  ubernetes.io/con
+0002ff80: 7472 6f6c 2d70 6c61 6e65 2c6e 6f64 652d  trol-plane,node-
+0002ff90: 726f 6c65 2e6b 7562 6572 6e65 7465 732e  role.kubernetes.
+0002ffa0: 696f 2f77 6f72 6b65 7222 0a20 2020 2020  io/worker".     
+0002ffb0: 2020 2020 2020 2063 7572 7265 6e74 636d         currentcm
+0002ffc0: 6420 3d20 6622 6b75 6265 6374 6c20 6765  d = f"kubectl ge
+0002ffd0: 7420 6e6f 6465 202d 2d73 656c 6563 746f  t node --selecto
+0002ffe0: 723d 277b 7365 6c65 6374 6f72 7d27 220a  r='{selector}'".
+0002fff0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00030000: 656e 7463 6d64 202b 3d20 2220 7c20 6772  entcmd += " | gr
+00030010: 6570 2027 2052 6561 6479 2722 0a20 2020  ep ' Ready'".   
+00030020: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00030030: 6e6f 6465 7320 3d20 6f73 2e70 6f70 656e  nodes = os.popen
+00030040: 2863 7572 7265 6e74 636d 6429 2e72 6561  (currentcmd).rea
+00030050: 646c 696e 6573 2829 0a20 2020 2020 2020  dlines().       
+00030060: 2020 2020 2069 6620 6c65 6e28 6375 7272       if len(curr
+00030070: 656e 746e 6f64 6573 2920 213d 2077 6f72  entnodes) != wor
+00030080: 6b65 7273 3a0a 2020 2020 2020 2020 2020  kers:.          
+00030090: 2020 2020 2020 7070 7269 6e74 2866 224f        pprint(f"O
+000300a0: 6e67 6f69 6e67 2073 6361 6c69 6e67 206f  ngoing scaling o
+000300b0: 7065 7261 7469 6f6e 206f 6e20 636c 7573  peration on clus
+000300c0: 7465 7220 7b6b 7562 657d 2229 0a20 2020  ter {kube}").   
+000300d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000300e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000300f0: 6573 756c 7420 3d20 7365 6c66 2e61 7574  esult = self.aut
+00030100: 6f73 6361 6c65 5f63 6c75 7374 6572 286b  oscale_cluster(k
+00030110: 7562 652c 206b 7562 6574 7970 652c 2077  ube, kubetype, w
+00030120: 6f72 6b65 7273 2c20 7468 7265 7368 6f6c  orkers, threshol
+00030130: 642c 2069 646c 6529 0a20 2020 2020 2020  d, idle).       
+00030140: 2020 2020 2020 2020 2069 6620 7265 7375           if resu
+00030150: 6c74 5b27 7265 7375 6c74 275d 2021 3d20  lt['result'] != 
+00030160: 2773 7563 6365 7373 273a 0a20 2020 2020  'success':.     
+00030170: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00030180: 6574 7572 6e20 7265 7375 6c74 0a20 2020  eturn result.   
+00030190: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000301a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000301b0: 2020 2020 2020 2077 6f72 6b65 7273 203d         workers =
+000301c0: 2072 6573 756c 745b 2777 6f72 6b65 7273   result['workers
+000301d0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+000301e0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+000301f0: 4375 7272 656e 7420 776f 726b 6572 7320  Current workers 
+00030200: 6e75 6d62 6572 2064 6573 6972 6564 3a20  number desired: 
+00030210: 7b77 6f72 6b65 7273 7d22 290a 2020 2020  {workers}").    
+00030220: 2020 2020 2020 2020 736c 6565 7028 3630          sleep(60
+00030230: 290a 0a20 2020 2064 6566 2074 6872 6561  )..    def threa
+00030240: 6465 645f 7765 625f 636f 6e73 6f6c 6528  ded_web_console(
+00030250: 7365 6c66 2c20 706f 7274 2c20 6e61 6d65  self, port, name
+00030260: 293a 0a20 2020 2020 2020 2063 6f6e 736f  ):.        conso
+00030270: 6c65 203d 204b 6d69 6e69 636f 6e73 6f6c  le = Kminiconsol
+00030280: 6528 636f 6e66 6967 3d73 656c 662c 2070  e(config=self, p
+00030290: 6f72 743d 706f 7274 2c20 6e61 6d65 3d6e  ort=port, name=n
+000302a0: 616d 6529 0a20 2020 2020 2020 2063 6f6e  ame).        con
+000302b0: 736f 6c65 2e72 756e 2829 0a0a 2020 2020  sole.run()..    
+000302c0: 6465 6620 7765 6263 6f6e 736f 6c65 2873  def webconsole(s
+000302d0: 656c 662c 206e 616d 6529 3a0a 2020 2020  elf, name):.    
+000302e0: 2020 2020 706f 7274 203d 2067 6574 5f66      port = get_f
+000302f0: 7265 655f 706f 7274 2829 0a20 2020 2020  ree_port().     
+00030300: 2020 2074 203d 2074 6872 6561 6469 6e67     t = threading
+00030310: 2e54 6872 6561 6428 7461 7267 6574 3d73  .Thread(target=s
+00030320: 656c 662e 7468 7265 6164 6564 5f77 6562  elf.threaded_web
+00030330: 5f63 6f6e 736f 6c65 2c20 6172 6773 3d28  _console, args=(
+00030340: 706f 7274 2c20 6e61 6d65 2c29 290a 2020  port, name,)).  
+00030350: 2020 2020 2020 742e 7374 6172 7428 290a        t.start().
+00030360: 2020 2020 2020 2020 7765 6262 726f 7773          webbrows
+00030370: 6572 2e6f 7065 6e28 6622 6874 7470 3a2f  er.open(f"http:/
+00030380: 2f31 3237 2e30 2e30 2e31 3a7b 706f 7274  /127.0.0.1:{port
+00030390: 7d22 2c20 6e65 773d 322c 2061 7574 6f72  }", new=2, autor
+000303a0: 6169 7365 3d54 7275 6529 0a0a 2020 2020  aise=True)..    
+000303b0: 6465 6620 696e 666f 5f73 7065 6369 6669  def info_specifi
+000303c0: 635f 616b 7328 7365 6c66 2c20 636c 7573  c_aks(self, clus
+000303d0: 7465 7229 3a0a 2020 2020 2020 2020 6672  ter):.        fr
+000303e0: 6f6d 206b 7669 7274 2e63 6c75 7374 6572  om kvirt.cluster
+000303f0: 2e61 6b73 2069 6d70 6f72 7420 696e 666f  .aks import info
+00030400: 2061 7320 616b 735f 696e 666f 0a20 2020   as aks_info.   
+00030410: 2020 2020 2072 6574 7572 6e20 616b 735f       return aks_
+00030420: 696e 666f 2873 656c 662c 2063 6c75 7374  info(self, clust
+00030430: 6572 2c20 7365 6c66 2e64 6562 7567 290a  er, self.debug).
+00030440: 0a20 2020 2064 6566 2069 6e66 6f5f 7370  .    def info_sp
+00030450: 6563 6966 6963 5f65 6b73 2873 656c 662c  ecific_eks(self,
+00030460: 2063 6c75 7374 6572 293a 0a20 2020 2020   cluster):.     
+00030470: 2020 2066 726f 6d20 6b76 6972 742e 636c     from kvirt.cl
+00030480: 7573 7465 722e 656b 7320 696d 706f 7274  uster.eks import
+00030490: 2069 6e66 6f20 6173 2065 6b73 5f69 6e66   info as eks_inf
+000304a0: 6f0a 2020 2020 2020 2020 7265 7475 726e  o.        return
+000304b0: 2065 6b73 5f69 6e66 6f28 7365 6c66 2c20   eks_info(self, 
+000304c0: 636c 7573 7465 722c 2073 656c 662e 6465  cluster, self.de
+000304d0: 6275 6729 0a0a 2020 2020 6465 6620 696e  bug)..    def in
+000304e0: 666f 5f6b 7562 655f 616b 7328 7365 6c66  fo_kube_aks(self
+000304f0: 2c20 7175 6965 742c 2077 6562 3d46 616c  , quiet, web=Fal
+00030500: 7365 293a 0a20 2020 2020 2020 2066 726f  se):.        fro
+00030510: 6d20 6b76 6972 742e 636c 7573 7465 7220  m kvirt.cluster 
+00030520: 696d 706f 7274 2061 6b73 0a20 2020 2020  import aks.     
+00030530: 2020 2070 6c61 6e64 6972 203d 206f 732e     plandir = os.
+00030540: 7061 7468 2e64 6972 6e61 6d65 2861 6b73  path.dirname(aks
+00030550: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
+00030560: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
+00030570: 2020 2020 2020 696e 7075 7466 696c 6520        inputfile 
+00030580: 3d20 6627 7b70 6c61 6e64 6972 7d2f 6661  = f'{plandir}/fa
+00030590: 6b65 2e79 6d6c 270a 2020 2020 2020 2020  ke.yml'.        
+000305a0: 7365 6c66 2e69 6e66 6f5f 706c 616e 2869  self.info_plan(i
+000305b0: 6e70 7574 6669 6c65 2c20 7175 6965 743d  nputfile, quiet=
+000305c0: 7175 6965 742c 2077 6562 3d77 6562 290a  quiet, web=web).
+000305d0: 2020 2020 2020 2020 616b 732e 696e 666f          aks.info
+000305e0: 5f73 6572 7669 6365 2873 656c 6629 0a0a  _service(self)..
+000305f0: 2020 2020 6465 6620 696e 666f 5f6b 7562      def info_kub
+00030600: 655f 656b 7328 7365 6c66 2c20 7175 6965  e_eks(self, quie
+00030610: 742c 2077 6562 3d46 616c 7365 293a 0a20  t, web=False):. 
+00030620: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
+00030630: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
+00030640: 2065 6b73 0a20 2020 2020 2020 2070 6c61   eks.        pla
+00030650: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
+00030660: 6972 6e61 6d65 2865 6b73 2e63 7265 6174  irname(eks.creat
+00030670: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
+00030680: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+00030690: 696e 7075 7466 696c 6520 3d20 6627 7b70  inputfile = f'{p
+000306a0: 6c61 6e64 6972 7d2f 6661 6b65 2e79 6d6c  landir}/fake.yml
+000306b0: 270a 2020 2020 2020 2020 7365 6c66 2e69  '.        self.i
+000306c0: 6e66 6f5f 706c 616e 2869 6e70 7574 6669  nfo_plan(inputfi
+000306d0: 6c65 2c20 7175 6965 743d 7175 6965 742c  le, quiet=quiet,
+000306e0: 2077 6562 3d77 6562 290a 2020 2020 2020   web=web).      
+000306f0: 2020 656b 732e 696e 666f 5f73 6572 7669    eks.info_servi
+00030700: 6365 2873 656c 6629 0a0a 2020 2020 6465  ce(self)..    de
+00030710: 6620 696e 666f 5f73 7065 6369 6669 635f  f info_specific_
+00030720: 676b 6528 7365 6c66 2c20 636c 7573 7465  gke(self, cluste
+00030730: 7229 3a0a 2020 2020 2020 2020 6672 6f6d  r):.        from
+00030740: 206b 7669 7274 2e63 6c75 7465 722e 676b   kvirt.cluter.gk
+00030750: 6520 696d 706f 7274 2069 6e66 6f20 6173  e import info as
+00030760: 2067 6b65 5f69 6e66 6f0a 2020 2020 2020   gke_info.      
+00030770: 2020 7265 7475 726e 2067 6b65 5f69 6e66    return gke_inf
+00030780: 6f28 7365 6c66 2c20 636c 7573 7465 722c  o(self, cluster,
+00030790: 2073 656c 662e 6465 6275 6729 0a0a 2020   self.debug)..  
+000307a0: 2020 6465 6620 696e 666f 5f6b 7562 655f    def info_kube_
+000307b0: 676b 6528 7365 6c66 2c20 7175 6965 742c  gke(self, quiet,
+000307c0: 2077 6562 3d46 616c 7365 293a 0a20 2020   web=False):.   
+000307d0: 2020 2020 2066 726f 6d20 6b76 6972 742e       from kvirt.
+000307e0: 636c 7573 7465 7220 696d 706f 7274 2067  cluster import g
+000307f0: 6b65 0a20 2020 2020 2020 2070 6c61 6e64  ke.        pland
+00030800: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
+00030810: 6e61 6d65 2867 6b65 2e63 7265 6174 652e  name(gke.create.
+00030820: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
+00030830: 6e61 6d65 290a 2020 2020 2020 2020 696e  name).        in
+00030840: 7075 7466 696c 6520 3d20 6627 7b70 6c61  putfile = f'{pla
+00030850: 6e64 6972 7d2f 6661 6b65 2e79 6d6c 270a  ndir}/fake.yml'.
+00030860: 2020 2020 2020 2020 7365 6c66 2e69 6e66          self.inf
+00030870: 6f5f 706c 616e 2869 6e70 7574 6669 6c65  o_plan(inputfile
+00030880: 2c20 7175 6965 743d 7175 6965 742c 2077  , quiet=quiet, w
+00030890: 6562 3d77 6562 290a 2020 2020 2020 2020  eb=web).        
+000308a0: 676b 652e 696e 666f 5f73 6572 7669 6365  gke.info_service
+000308b0: 2873 656c 6629 0a                        (self).
```

## kvirt/examples.py

```diff
@@ -176,14 +176,21 @@
 $ kcli console -s myvm
 """
 
 vmexport = """# Export vm myvm with a specific name for the generated image
 $ kcli export -i myimage myvm
 """
 
+kubeakscreate = """# Create an aks instance named myaks
+$ kcli create kube aks -P network=subnet-1 myaks
+
+# Use a parameter file
+$ kcli create kube aks --paramfile=myparameters.yml myaks
+"""
+
 kubeekscreate = """# Create an eks instance named myeks (specifying two subnets in different AZs)
 $ kcli create kube eks -P network=subnet-1 -P extra_networks=[subnet-2] myeks
 
 # Specify custom role for ctlplane
 $ kcli create kube eks -P network=subnet-1 -P extra_networks=[subnet-2] -P ctlplane_role=role1 myeks
 
 # Use a parameter file
@@ -361,14 +368,22 @@
 $ kcli run workflow myworkflow -P cmds=[hostname]
 
 # Only output assets to dir without running
 $ kcli run workflow myscript.sh -do mydir
 
 """
 
+kubeaksscale = """# Scale nodes from aks cluster myeks
+$ kcli scale cluster aks -P workers=3 myaks
+
+# Alternative way to indicate workers
+$ kcli scale cluster aks --workers 3 myaks
+
+"""
+
 kubeeksscale = """# Scale nodes from eks cluster myeks
 $ kcli scale cluster eks -P workers=3 myeks
 
 # Alternative way to indicate workers
 $ kcli scale cluster eks --workers 3 myeks
 
 """
```

## kvirt/cluster/eks/__init__.py

```diff
@@ -59,15 +59,15 @@
             'role': None,
             'disk_size': None,
             'flavor': None,
             'ami_type': None,
             'capacity_type': None,
             'version': None}
     data.update(overrides)
-    cluster = overrides.get('cluster', cluster or 'mygke')
+    cluster = overrides.get('cluster', cluster or 'myeks')
     version = data['version']
     workers = data['workers']
     disk_size = data['disk_size']
     flavor = data['flavor']
     ami_type = data['ami_type']
     capacity_type = data['capacity_type']
     access_key_id, access_key_secret, session_token, region = project_init(config)
```

## kvirt/cluster/eks/kcli_default.yml

```diff
@@ -1,10 +1,10 @@
 info: |
-  Deploy kubernetes using eks on $nodes
-nodes: 2
+  Deploy kubernetes using eks on $workers
+workers: 2
 version:
 network: default
 extra_networks: []
 role:
 security_group:
 disk_size:
 flavor:
```

## kvirt/cluster/hypershift/__init__.py

```diff
@@ -20,15 +20,15 @@
 from time import sleep
 from uuid import UUID
 from urllib.parse import urlparse
 from urllib.request import urlopen, Request
 import yaml
 
 virtplatforms = ['kvm', 'kubevirt', 'ovirt', 'openstack', 'vsphere', 'proxmox']
-cloudplatforms = ['aws', 'gcp', 'ibm']
+cloudplatforms = ['aws', 'azure', 'gcp', 'ibm']
 
 
 def valid_uuid(uuid):
     try:
         UUID(uuid)
         return True
     except:
```

## kvirt/cluster/k3s/__init__.py

```diff
@@ -8,15 +8,15 @@
 from shutil import which
 from string import ascii_letters, digits
 from subprocess import call, run
 from tempfile import NamedTemporaryFile
 from time import sleep
 import yaml
 
-cloud_platforms = ['aws', 'gcp']
+cloud_platforms = ['aws', 'azure', 'gcp', 'ibm']
 
 
 def update_ip_alias(config, nodes):
     cmd_one = ['kubectl', 'get', 'nodes', '-o=jsonpath={range .items[?(@.spec.podCIDR)]}{.metadata.name}{\'\\n\'}{end}']
     while True:
         pprint(f"Waiting 5s for {nodes} nodes to have a Pod CIDR assigned")
         result = run(cmd_one, capture_output=True, text=True)
```

## kvirt/cluster/kubeadm/__init__.py

```diff
@@ -11,15 +11,15 @@
 from shutil import which
 from string import ascii_lowercase, ascii_letters, digits
 from subprocess import call
 from tempfile import NamedTemporaryFile
 from time import sleep
 import yaml
 
-cloudplatforms = ['aws', 'gcp', 'ibm']
+cloudplatforms = ['aws', 'azure', 'gcp', 'ibm']
 
 
 def scale(config, plandir, cluster, overrides):
     plan = cluster
     data = {'cluster': cluster, 'sslip': False, 'kube': cluster, 'kubetype': 'generic', 'image': 'centos8stream',
             'extra_scripts': []}
     data['basedir'] = '/workdir' if container_mode() else '.'
```

## kvirt/cluster/openshift/__init__.py

```diff
@@ -21,15 +21,15 @@
 from tempfile import TemporaryDirectory
 from time import sleep
 from urllib.request import urlopen, Request
 import yaml
 
 
 virtplatforms = ['kvm', 'kubevirt', 'ovirt', 'openstack', 'vsphere', 'proxmox']
-cloudplatforms = ['aws', 'gcp', 'ibm']
+cloudplatforms = ['aws', 'azure', 'gcp', 'ibm']
 
 
 def aws_credentials(config):
     if os.path.exists(os.path.expanduser('~/.aws/credentials')):
         return
     aws_dir = f'{os.environ["HOME"]}/.aws'
     if not os.path.exists(aws_dir):
```

## kvirt/common/__init__.py

```diff
@@ -2287,14 +2287,19 @@
     elif which('apt-get') is not None:
         pkgmgr = 'apt-get'
     if not pip and pkgmgr is None:
         error("Package based installation requires either dnf or apt-get")
         sys.exit(1)
     if provider == 'aws':
         cmd = 'pip3 install boto3' if pip else f'{pkgmgr} -y install python3-boto3'
+    if provider == 'azure':
+        if not pip:
+            warning("Using pip as this is the only way for this provider")
+        cmd = 'pip3 install azure-mgmt-compute azure-mgmt-network azure-mgmt-resource azure-mgmt-core azure-identity'
+        cmd += ' azure-mgmt-marketplaceordering azure-storage-blob azure-mgmt-dns azure-mgmt-containerservice'
     elif provider == 'gcp':
         if not pip:
             warning("Using pip as this is the only way for this provider")
         cmd = 'pip3 install google-api-python-client google-auth-httplib2 google-cloud-dns google-cloud-storage '
         cmd += 'google-cloud-container'
     elif provider == 'ibm':
         if not pip:
```

## kvirt/providers/sampleprovider.py

```diff
@@ -165,15 +165,15 @@
     def add_disk(self, name, size=1, pool=None, thin=True, image=None, shareable=False, existing=None,
                  interface='virtio', novm=False, overrides={}):
         print("not implemented")
 
     def delete_disk(self, name, diskname, pool=None, novm=False):
         print("not implemented")
 
-# should return a dict of {'pool': poolname, 'path': name}
+# should return a dict of {'diskname': {'pool': poolname, 'path': name}}
     def list_disks(self):
         print("not implemented")
         return []
 
     def add_nic(self, name, network, model='virtio'):
         print("not implemented")
 
@@ -191,15 +191,15 @@
         print("not implemented")
         return {'result': 'success'}
 
     def create_network(self, name, cidr=None, dhcp=True, nat=True, domain=None, plan='kvirt', overrides={}):
         print("not implemented")
         return {'result': 'success'}
 
-    def delete_network(self, name=None, cidr=None):
+    def delete_network(self, name=None, cidr=None, force=False):
         print("not implemented")
         return {'result': 'success'}
 
 # should return a list of pools
     def list_pools(self):
         print("not implemented")
         return []
@@ -261,15 +261,15 @@
         print("not implemented")
         return []
 
     def list_bucketfiles(self, bucket):
         print("not implemented")
         return []
 
-    def reserve_dns(self, name, nets=[], domain=None, ip=None, alias=[], force=False, primary=False):
+    def reserve_dns(self, name, nets=[], domain=None, ip=None, alias=[], force=False, primary=False, instanceid=None):
         print("not implemented")
 
     def update_nic(self, name, index, network):
         print("not implemented")
 
     def update_network(self, name, dhcp=None, nat=None, domain=None, plan=None, overrides={}):
         print("not implemented")
```

## kvirt/providers/aws/__init__.py

```diff
@@ -388,15 +388,15 @@
         except:
             return {'result': 'failure', 'reason': f"VM {name} not found"}
         instanceid = vm['InstanceId']
         conn.start_instances(InstanceIds=[instanceid])
         return {'result': 'success'}
 
     def info_host(self):
-        return {"region": self.region}
+        return {"region": self.region, 'vms': len(self.list())}
 
     def status(self, name):
         conn = self.conn
         df = {'InstanceIds': [name]} if name.startswith('i-') else {'Filters': [{'Name': "tag:Name", 'Values': [name]}]}
         try:
             vm = conn.describe_instances(**df)['Reservations'][0]['Instances'][0]
         except:
```

## kvirt/providers/gcp/__init__.py

```diff
@@ -439,14 +439,15 @@
         project = self.project
         zone = self.zone
         data['project'] = project
         projectinfo = resource.projects().get(projectId=project).execute()
         data['project_number'] = projectinfo['projectNumber']
         data['project_creation_time'] = projectinfo['createTime']
         data['zone'] = zone
+        data['vms'] = len(self.list())
         return data
 
     def status(self, name):
         status = None
         conn = self.conn
         project = self.project
         zone = self.zone
@@ -1130,15 +1131,15 @@
                 else:
                     new = f'{a}.{domain}.' if '.' not in a else f'{a}.'
                     alias_record_set = dnszone.resource_record_set(new, 'CNAME', 300, [entry])
                 changes.add_record_set(alias_record_set)
         changes.create()
         return {'result': 'success'}
 
-    def delete_dns(self, name, domain, allentries=False):
+    def delete_dns(self, name, domain, instanceid=None, allentries=False):
         project = self.project
         region = self.region
         client = dns.Client(project)
         cluster = None
         fqdn = f"{name}.{domain}"
         if fqdn.split('-')[0] == fqdn.split('.')[1]:
             cluster = fqdn.split('-')[0]
```

## kvirt/providers/ibm/__init__.py

```diff
@@ -331,14 +331,15 @@
         return {'result': 'success'}
 
     def info_host(self):
         data = {}
         data['region'] = self.region
         data['zone'] = self.zone
         data['vpc'] = self.vpc
+        data['vms'] = len(self.list())
         return data
 
     def status(self, name):
         try:
             vm = self._get_vm(name)
             if vm is None:
                 return {'result': 'failure', 'reason': f'VM {name} not found'}
```

## kvirt/providers/kvm/__init__.py

```diff
@@ -2850,16 +2850,15 @@
         if size < 1:
             error("Incorrect size.Leaving...")
             return {'result': 'failure', 'reason': "Incorrect size"}
         if not thin:
             diskformat = 'raw'
         if novm:
             try:
-                self.create_disk(name=name, size=size, pool=pool, thin=thin, image=image)
-                return {'result': 'success'}
+                return self.create_disk(name=name, size=size, pool=pool, thin=thin, image=image)
             except Exception as e:
                 error(f"Couldn't create disk. Hit {e}")
                 return {'result': 'failure', 'reason': f"Couldn't create disk. Hit {e}"}
         try:
             vm = conn.lookupByName(name)
             xml = vm.XMLDesc(0)
             root = ET.fromstring(xml)
```

## kvirt/version/git

```diff
@@ -1 +1 @@
-d8ef0a1 2023/07/13
+3a9a43a 2023/07/13
```

## Comparing `kcli-99.0.202307131409.dist-info/LICENSE` & `kcli-99.0.202307131510.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `kcli-99.0.202307131409.dist-info/METADATA` & `kcli-99.0.202307131510.dist-info/METADATA`

 * *Files 24% similar despite different names*

```diff
@@ -1,23 +1,31 @@
 Metadata-Version: 2.1
 Name: kcli
-Version: 99.0.202307131409
+Version: 99.0.202307131510
 Summary: Provisioner/Manager for Libvirt/Vsphere/Aws/Gcp/Kubevirt/Ovirt/Openstack/IBM Cloud and containers
 Home-page: http://github.com/karmab/kcli
 Author: Karim Boumedhel
 Author-email: karimboumedhel@gmail.com
 License: ASL
 Platform: UNKNOWN
 License-File: LICENSE
 Requires-Dist: PyYAML
 Requires-Dist: argcomplete
 Requires-Dist: jinja2
 Requires-Dist: libvirt-python (>=2.0.0)
 Requires-Dist: prettytable
 Provides-Extra: all
+Requires-Dist: azure-identity ; extra == 'all'
+Requires-Dist: azure-mgmt-compute ; extra == 'all'
+Requires-Dist: azure-mgmt-containerservice ; extra == 'all'
+Requires-Dist: azure-mgmt-core ; extra == 'all'
+Requires-Dist: azure-mgmt-dns ; extra == 'all'
+Requires-Dist: azure-mgmt-marketplaceorderingazure-storage-blob ; extra == 'all'
+Requires-Dist: azure-mgmt-network ; extra == 'all'
+Requires-Dist: azure-mgmt-resource ; extra == 'all'
 Requires-Dist: boto3 ; extra == 'all'
 Requires-Dist: cryptography ; extra == 'all'
 Requires-Dist: docker (>=2.0) ; extra == 'all'
 Requires-Dist: google-api-python-client ; extra == 'all'
 Requires-Dist: google-auth-httplib2 ; extra == 'all'
 Requires-Dist: google-cloud-container ; extra == 'all'
 Requires-Dist: google-cloud-dns ; extra == 'all'
@@ -38,14 +46,23 @@
 Requires-Dist: python-neutronclient ; extra == 'all'
 Requires-Dist: python-novaclient ; extra == 'all'
 Requires-Dist: python-swiftclient ; extra == 'all'
 Requires-Dist: pyvmomi ; extra == 'all'
 Requires-Dist: websockify ; extra == 'all'
 Provides-Extra: aws
 Requires-Dist: boto3 ; extra == 'aws'
+Provides-Extra: azure
+Requires-Dist: azure-identity ; extra == 'azure'
+Requires-Dist: azure-mgmt-compute ; extra == 'azure'
+Requires-Dist: azure-mgmt-containerservice ; extra == 'azure'
+Requires-Dist: azure-mgmt-core ; extra == 'azure'
+Requires-Dist: azure-mgmt-dns ; extra == 'azure'
+Requires-Dist: azure-mgmt-marketplaceorderingazure-storage-blob ; extra == 'azure'
+Requires-Dist: azure-mgmt-network ; extra == 'azure'
+Requires-Dist: azure-mgmt-resource ; extra == 'azure'
 Provides-Extra: gcp
 Requires-Dist: google-api-python-client ; extra == 'gcp'
 Requires-Dist: google-auth-httplib2 ; extra == 'gcp'
 Requires-Dist: google-cloud-container ; extra == 'gcp'
 Requires-Dist: google-cloud-dns ; extra == 'gcp'
 Requires-Dist: google-cloud-storage ; extra == 'gcp'
 Provides-Extra: ibm
@@ -61,13 +78,17 @@
 Requires-Dist: python-glanceclient ; extra == 'openstack'
 Requires-Dist: python-keystoneclient ; extra == 'openstack'
 Requires-Dist: python-neutronclient ; extra == 'openstack'
 Requires-Dist: python-novaclient ; extra == 'openstack'
 Requires-Dist: python-swiftclient ; extra == 'openstack'
 Provides-Extra: ovirt
 Requires-Dist: ovirt-engine-sdk-python ; extra == 'ovirt'
+Provides-Extra: packet
+Requires-Dist: packet-python ; extra == 'packet'
+Provides-Extra: proxmox
+Requires-Dist: proxmoxer ; extra == 'proxmox'
 Provides-Extra: vsphere
 Requires-Dist: cryptography ; extra == 'vsphere'
 Requires-Dist: pyvmomi ; extra == 'vsphere'
 
 Provisioner/Manager for Libvirt/Vsphere/Aws/Gcp/Kubevirt/Ovirt/Openstack/IBM Cloud and containers
```

## Comparing `kcli-99.0.202307131409.dist-info/RECORD` & `kcli-99.0.202307131510.dist-info/RECORD`

 * *Files 1% similar despite different names*

```diff
@@ -1,35 +1,38 @@
 kvirt/__init__.py,sha256=eoZ6GfifbqhMLNzjlqRDVil-yyBkOmVN9ujSgJWNBlY,15
 kvirt/baseconfig.py,sha256=SVs4GB-vHzKaa29ERsSHTDDcUUPAM3UfZ5IkP95VCb4,100420
 kvirt/bottle.py,sha256=DMuCINuwVog8XC-D6nPFVzRmo6lnJZ1H3sNK2VICKKE,171487
-kvirt/cli.py,sha256=-EXTNGn5SN3ZaAGaIjh36XMjpwwZeJV8Ucvd0ElLzbE,260066
-kvirt/config.py,sha256=zjw1VSNa2RtGwXyKZxWh2fWKeRFbIadNmRRpXKrFeC4,193251
+kvirt/cli.py,sha256=J2viC5d0-WnYgXeOqjN2roImSRCxAgyXNmrdpMrPs1Q,264818
+kvirt/config.py,sha256=zt2wha-7VDXsm_JFEObPEsXhVd9UqXBxN6-E1rLmxoI,198839
 kvirt/containerconfig.py,sha256=Pfp1wWU1u1S6S0IT00mWFEAa8FlbTV2qrFE21_cquWA,2851
 kvirt/defaults.py,sha256=I1d1gKipNnKx6-oDP6NzDgANA6m7MrR_yQ3R5dzy_DM,11612
 kvirt/ekstoken.py,sha256=MjK_tcLFl2VKxqgTSB4ve_kybZw5dBj2H6BezGGtBpM,1475
-kvirt/examples.py,sha256=uFFwcid37csxIfJmHQQ8po1QF90V4GZ31WHX6vY8XFs,21243
+kvirt/examples.py,sha256=KNcLLMMtpl1hq7XRP_OPdcX7Yd_l28tJff7_xZPgH3M,21622
 kvirt/gketoken.py,sha256=tufCvrSBE_L2HEt8CjePvBXes7wkj7auUVJXbgZBblI,1047
 kvirt/ignitionmerger.py,sha256=K22COM_XqYOG28ezUJzoRjQL-jbJqpFWgm7lUwDiVbE,4333
 kvirt/keywords.yaml,sha256=HG5nGzsC2pPwWy86XQjL-UoDw_j8IIy4dVZeGIMP3k0,9871
 kvirt/klist.py,sha256=6rUa1Z7aH-Yx8MAVW-7TvB2DzteGkquBBlPQmei1p8E,3487
 kvirt/ansibleutils/__init__.py,sha256=uxy2it8uvuhDZSIlKOimpqPZtFTPsZ0AX_DLs5y7fSo,6009
 kvirt/cluster/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kvirt/cluster/sampleprovider.py,sha256=OA414n2t54Bd6EIV1K1hXpe3KndPBtRzoYTZRH5JWu4,204
-kvirt/cluster/eks/__init__.py,sha256=J34rlgbWQR0IRgJoXSRjPlfhZum0qw5bXqyO0A0zo7s,12259
+kvirt/cluster/aks/__init__.py,sha256=IQp19sqXuzHSrVUaix_UmgL6Q8drjSeLapvhUENkK3o,9366
+kvirt/cluster/aks/fake.yml,sha256=pWlbBWME2LeLtXGiYDpd6yGuHSZCrvZ9O_mUWF1Om_w,16
+kvirt/cluster/aks/kcli_default.yml,sha256=vlzd33YOuQ-bsH_DEVKTwQ13-5SIs62Cl0rFLIq9JU0,369
+kvirt/cluster/eks/__init__.py,sha256=wUcAS2gOTSDUp9jWO68XKdolZEZe6u8op_vboST0HL0,12259
 kvirt/cluster/eks/fake.yml,sha256=pWlbBWME2LeLtXGiYDpd6yGuHSZCrvZ9O_mUWF1Om_w,16
-kvirt/cluster/eks/kcli_default.yml,sha256=kWppGUyVLN-Lt1Ne9TNSI6R39Gn1K2qzlm6b8UUvZyo,169
+kvirt/cluster/eks/kcli_default.yml,sha256=gvM40fFv7yWMObvh7deMpV_L1JIAtI4uOY29ZhIicdU,173
 kvirt/cluster/gke/__init__.py,sha256=7KftniXh-bqL0ne4x7_J5IVrxtJfUt12uesyPJogtKA,12218
 kvirt/cluster/gke/fake.yml,sha256=pWlbBWME2LeLtXGiYDpd6yGuHSZCrvZ9O_mUWF1Om_w,16
 kvirt/cluster/gke/kcli_default.yml,sha256=QfI4kP9hJJXOZChmSmGxi2wFsUAhFb7VsZBXh0upeBc,497
 kvirt/cluster/gke/kubeconfig.j2,sha256=FKRblDOLeZPHFm7W2ZM3vj_5xp61_ChOFwMokmTTz-Q,405
 kvirt/cluster/hypershift/99-apps.yaml,sha256=nWmGvSlPFTU8roqqkO89Hd-1lDiCaMM8mp_G_f-7Epk,931
 kvirt/cluster/hypershift/99-forcedns,sha256=J53iIXocjMnmXRizQW2MiIOeg9MTqmA4xEKS6e5VXk8,694
 kvirt/cluster/hypershift/99-notifications.yaml,sha256=0Cd13fQNCOQKS7ERso7E05zUkctrtHaFzcK2jGCsl0s,1480
 kvirt/cluster/hypershift/Corefile,sha256=giwgQjGQvqwhY1hiMMu2oovV0LrDuiorzGnDi-o4rEg,653
-kvirt/cluster/hypershift/__init__.py,sha256=bA-WN87Ux_J8S4DNXy8reUOKqXBCaGRYAFJ7NtKTYNw,43967
+kvirt/cluster/hypershift/__init__.py,sha256=ai0G2Oak4Kl6IScJFbQTjtLh0fsbGu-fihVXJUBSlvM,43976
 kvirt/cluster/hypershift/assisted_infra.yml,sha256=4j7OLvkCEkctaNUSoKwxIslOSRjUtWaHhrO9qEaBG6o,1121
 kvirt/cluster/hypershift/assisted_ingress.yml,sha256=5WGeyzXH_kaTxnOAI8jpXT55fVHYx05iPhkEe2adXwM,1269
 kvirt/cluster/hypershift/autoapprovercron.yml,sha256=bezehF0xe-UeJDAiYta60mtLN906mncH1_qKNmnfurE,1366
 kvirt/cluster/hypershift/bmc.yml.j2,sha256=w3byQN41fF-nQ91Ky_IwoxsDsMaq_C-pJvGHEZ9qbek,1106
 kvirt/cluster/hypershift/calico.sh.j2,sha256=E-6TYTNEm_5CkaNcJbBHS08Led8-HrhF_YWQzbOiZ-0,511
 kvirt/cluster/hypershift/cloud_lb_apps.yml,sha256=QyLKvXW4jwKr3UySRhLOIwReklkJLTUGVI64oWvZw-E,200
 kvirt/cluster/hypershift/disconnected.sh,sha256=fE8050N1XFcyTVS2QKaq_ml4mGca1NDAdLowBXAUEoI,1433
@@ -43,27 +46,27 @@
 kvirt/cluster/hypershift/keepalived.conf,sha256=uy6hpQhNJ-Jg42VOwkqT0y_OJpjR5kzUpKafH1bV4_Q,502
 kvirt/cluster/hypershift/nmstateconfig.yml.j2,sha256=EjNalSAXko4ZVEN-tnMJn3l59s2_-uBYSDN_C2SWZ6c,1587
 kvirt/cluster/hypershift/nodepool.yaml,sha256=CMRrPOwGSLCZNkO3oZU5JePksgwggxR4w556UqEikJw,752
 kvirt/cluster/hypershift/nonlocalbind.conf,sha256=eRCLfWYHqx2UgY3QE1pbXm2iFwERatyihNySEEbeuE8,60
 kvirt/cluster/hypershift/staticpods/coredns.yml,sha256=pIs5vJ12RxTCH4nVuDWGECiGuGLecbT8qDDGVXmjfqs,1890
 kvirt/cluster/hypershift/staticpods/keepalived.yml,sha256=Y90jy_Y6pgiwOa_0QvUqus34c8oMEZZu4G-OI6jCV70,2142
 kvirt/cluster/hypershift/staticpods/mdns.yml,sha256=-gX6SyvdSEXND36uA_ppr-5wzAEFx13ZgvdU_IeIl2o,1619
-kvirt/cluster/k3s/__init__.py,sha256=zDc0oQLV0cVyQf1q6CV927MAdw0nPmp55Tug1Mk2DVE,13621
+kvirt/cluster/k3s/__init__.py,sha256=3OOQrrh-StqmLdDrYF-xz6jF3ZkXQ93HccVkWBZ5PJA,13637
 kvirt/cluster/k3s/bootstrap.sh,sha256=INB2JoqetAaYwB7TX3gVtvwpAHQ2N-sKX-a-dZjnh_0,1117
 kvirt/cluster/k3s/bootstrap.yml,sha256=WugJz2xMYCAZ4egKIYgY6nSJ_FYgQES7X3bFEHrUI34,1035
 kvirt/cluster/k3s/cloud_lb_api.yml,sha256=zoJuWfr0_MrAyGs1nijsmLyNR-VobTZVF3T9ZTA5_6Q,441
 kvirt/cluster/k3s/ctlplanes.sh,sha256=uw84t8oAs32U3NQsW7AaFyTJD4p4zazu-btmnYcy-WY,440
 kvirt/cluster/k3s/ctlplanes.yml,sha256=yUSEMtcTrp88s7FvD2Bu7SHbzPOu8dxs1iOuEPGV8ZE,1068
 kvirt/cluster/k3s/join.sh,sha256=-SxEDkHGpnS-prTtA7K5LO-coCCSrZ83EpjYgkTAXJA,231
 kvirt/cluster/k3s/kcli_default.yml,sha256=OmoYsCpnwSjrbO7dyj3a3NxGtcbjlB22zXXAu5cJjx4,1271
 kvirt/cluster/k3s/keepalived.conf,sha256=XBC6ezpHtjHF2lUU9l3z7zvjp5YYHzGuAz30TXvsFCo,511
 kvirt/cluster/k3s/keepalived.sh,sha256=CpUcNspJekNZGqTBmLk6m_tCaulL5hmKEQLYj-Pxc5w,352
 kvirt/cluster/k3s/workers.sh,sha256=ErZ5T8uEV8iV7PczVHY4bHXtFC3fsKVtF3k5tS_0vkc,166
 kvirt/cluster/k3s/workers.yml,sha256=HD1MkMcRKwvFndoMJOS8fC1f_O1vfzi27PVwR4GN_7k,709
-kvirt/cluster/kubeadm/__init__.py,sha256=p3-8rddgEsrOmNl8msL0gyROQ4IOUJFEDbkAqZ0_gWs,14254
+kvirt/cluster/kubeadm/__init__.py,sha256=al3hPyhdGhKMzXHWMnDj1Ip0w_kdUbrqpdHQjoy6EQ4,14263
 kvirt/cluster/kubeadm/bootstrap.sh,sha256=uHvP2t5FASTy2r30gR2rdIo1kc5Du9Y8YGI2uMCS36g,2772
 kvirt/cluster/kubeadm/bootstrap.yml,sha256=mxeChMSJHut45oY8jC7ZyR5CIUAMroUS07wSaQ096uU,1550
 kvirt/cluster/kubeadm/cloud_lb_api.yml,sha256=dTH4qdnvhPRk0mhZh1tkX8D9Zsg24nvmC4cxXMRNxJk,338
 kvirt/cluster/kubeadm/ctlplanes.yml,sha256=qgStzWZSSMmIq-qAamSK3sFipdocawNTNWDKRdpGpPc,1172
 kvirt/cluster/kubeadm/deploy.sh,sha256=iCqoY0QHMltWKYRPmhu4DdsVrn4WIsRe9LugeRZzxpk,343
 kvirt/cluster/kubeadm/join.sh,sha256=B9Sno_aHsIfcrds8IsL4m6eorr5ttV5t7bubQGLXaCo,308
 kvirt/cluster/kubeadm/kcli_default.yml,sha256=E61RyDh7thh0VOS6X0Zasy19rD4ZcuxbOLNG2pXgRiI,1853
@@ -150,15 +153,15 @@
 kvirt/cluster/openshift/99-metal3-fake-machine.yaml,sha256=Bm1h00oD0PACNHk1QQJf-kfHQHD7f4VOkGRCQ9rfSUI,250
 kvirt/cluster/openshift/99-metal3-provisioning.yaml,sha256=HJ_rl-F-qNm6tQcvkqnDT8aAu-FwQLMOUXBZ9UxaDxg,162
 kvirt/cluster/openshift/99-notifications.yaml,sha256=SKdm2ujYhJD5HI7DjuwHhVSMi_M0QfSqYAflekjDkoE,1659
 kvirt/cluster/openshift/99-operatorhub.yaml,sha256=hBx14bZ3qYzkX1s-Q0EbJkMRXpBHvS4y7ckjdTKqs30,118
 kvirt/cluster/openshift/99-ovn.yaml,sha256=ZPthDu26byF6yOpr4TX2CiQ_k5rG4r_9VTxKFJ8Jz7U,338
 kvirt/cluster/openshift/99-sno.yaml,sha256=IS88cxRPXMWDQn_xKo3ho6hH-oMHYanCow_z7QtO0gk,912
 kvirt/cluster/openshift/Corefile,sha256=VpjS3qzS1CrRr473hNp5mNgURxbVtNQNp9b6KVZ2mMQ,762
-kvirt/cluster/openshift/__init__.py,sha256=v_tRdB1AZOnsLe3oeVjn3KyUwh0Xzvf7U9ngmXIC5p8,90217
+kvirt/cluster/openshift/__init__.py,sha256=dBLk_dfdaAO90tU-32UgbLTwo-M4VAUQSGhXGIiJvrA,90226
 kvirt/cluster/openshift/autoapprovercron.yml,sha256=SWYLRl6p1_jajLPaDMWbyVImliW3bKY8V4TflkZubJ8,1325
 kvirt/cluster/openshift/autorules.yml,sha256=YigI0IlT0ah7WhdqQTxJfsJgWnJvNdvjs00wDsmUQM4,987
 kvirt/cluster/openshift/bootstrap.yml,sha256=qAQFBBBofSxotTTqV-knV0h1H2qqNNSB14v-TQv4tlc,1630
 kvirt/cluster/openshift/calico.sh.j2,sha256=6HH46S3eM3V7sHIXzWiYk739QwUAqAWl5M0hmFqyKNU,250
 kvirt/cluster/openshift/chrony.conf,sha256=WYo7cseCaZMx-JP6p9RFnsmmwlHg8whKQA4DxLZx_jI,107
 kvirt/cluster/openshift/cloud_bootstrap.yml,sha256=X5-ib8HK_4iuJ4JnFYIG39LBXhbr7cdGIHP473wnlJ4,629
 kvirt/cluster/openshift/cloud_ctlplanes.yml,sha256=YyOZbZq7S9I8W4UQHKujBUJrS1Wy5gtAo7Ey5Ql9qus,792
@@ -278,15 +281,15 @@
 kvirt/cluster/profiles/sample-kubeadm-default.yml,sha256=nSVV2Q5610SHemeErWF6eXqYAko3M2euNMPk_KYkvOc,193
 kvirt/cluster/profiles/sample-openshift-compact.yml,sha256=sYA9UXAnSFaiXJLPvA6A8_TY--A3xEp3fiWFBr3pA_Y,135
 kvirt/cluster/profiles/sample-openshift-contrail.yml,sha256=BRIQ9q5KdsklWBtCcUo56XP7N5-ZKVGxpTEYyA063ug,210
 kvirt/cluster/profiles/sample-openshift-ipv6.yml,sha256=L_kajan3FQQtUTJutGZlqqoENum6smQ11iet18mPAo8,157
 kvirt/cluster/profiles/sample-openshift-sno-bm.yml,sha256=bOx8AtKWv_ukKaXJ450oe6p2NUz9CI1oqYJXQJU1LGY,55
 kvirt/cluster/profiles/sample-openshift-sno.yml,sha256=U2I9t5DFLWIDagj7sHS6WNNw6FExsm2shUUJegCoCuY,148
 kvirt/common/Jenkinsfile.j2,sha256=FOK7002eP_nUoinIZZVhNo3SeKKwU8nVOAn0EVfZLRk,3377
-kvirt/common/__init__.py,sha256=j-WhBqL3cvY7bEFMYIi6ZlbM9VSaZkmNUs8W9yNZUj0,99100
+kvirt/common/__init__.py,sha256=oT1j4Dx1RugZhs9h46gPqt_lifdbO7rCAVXoPtAOyEA,99452
 kvirt/common/autoscale.yaml.j2,sha256=fCKt-ooHIr0oeAIZWQLlIcVJD0msW5A7BkNyVbO6Dj0,1406
 kvirt/common/fake_kubeconfig.json,sha256=XxFI3MSxrYbA6-4U8W5vSVFxrQmOeTOxAVzc7e1ngNc,8945
 kvirt/common/ignition.j2,sha256=eZN_uM9itflZCvrakYU25HFdQLdLxqZAN9pEzYmEDCE,669
 kvirt/common/kubevirt_kcli_conf.j2,sha256=OCwVN8OoymNKZ9BBooKabCR6RSbU58XfUtj9tttXdmE,125
 kvirt/common/local_kcli_conf.j2,sha256=_HqXYt5pCe5JK7y8UPR7BVm7RoC9vJGlrltnKz-J1vs,99
 kvirt/common/pipeline.yml.j2,sha256=c7QUmTo82zJtH0AQVdKw-Y7MpWGeiejw5npQIUIXtRU,3068
 kvirt/common/pipeline_kube.yml.j2,sha256=zLxvWIz9z0rlhxzUkZXj96fEndcm0DoO6KIzjRqOiGs,2377
@@ -337,37 +340,38 @@
 kvirt/ksushy/templates/system.json,sha256=pQOqTqvv1XuoCsDEPVXENANDme92mRK2P4wfaGPO7uA,2760
 kvirt/ksushy/templates/systems.json,sha256=yuSt-tgmJyxv8GN1eCr8MH2Pp5y088Scp7s-8T76YgQ,511
 kvirt/ksushy/templates/virtualmedia_cd.json,sha256=7GiCfBsFs91bBToQLTdWpynk98olFKvdDaJRacGjnWk,1219
 kvirt/ksushy/templates/virtualmedias.json,sha256=IocFk2ecKvgnzO8nyxsBhJEdU62X_KvX0m4EunVQscw,705
 kvirt/miniconsole/__init__.py,sha256=jCaDAk4Yq2fjOR_4GrnRxMq9CPLolxIJR81_hAk1eZg,2780
 kvirt/nameutils/__init__.py,sha256=FzurPU27SstXpSIiSvPMcGW0h-Nx0RT2Ur7MYJNMyCY,3733
 kvirt/providers/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-kvirt/providers/sampleprovider.py,sha256=CUYPZEk7IVQJyDMSfx7G-R9CDSsSIamNKPeptLzv-tA,9038
-kvirt/providers/aws/__init__.py,sha256=NB_MmhHemZgLGQsb-1HJlG8llNHmGSzqQRSGGDwrvAw,71311
+kvirt/providers/sampleprovider.py,sha256=moRyJ0DI2PDUuoGz_MPsmQQx_xBnIcM7sIoHPJyA49c,9082
+kvirt/providers/aws/__init__.py,sha256=dC9WTZec03CzHQAQkpID_c_4171BgV-AwiiXncRciFQ,71336
 kvirt/providers/aws/assume_policy.json,sha256=nffb0COdLM4Ud6zRuaUteJVl09SnkRWs8IUw-x0ie3o,260
 kvirt/providers/aws/ctlplane_policy.json,sha256=Nf2tQdrtFeVFzJleY59O6l0y-c1NidhScDcyK0a_jmo,1764
 kvirt/providers/aws/worker_policy.json,sha256=vJpfEzEmuXoQaJ4TRZMqgHX6QNCnu_yup8Wg64NReDs,174
+kvirt/providers/azure/__init__.py,sha256=Nc48unGH_2neSDozL-m49MGOnc6PaWuwnw06VgXXNik,55725
 kvirt/providers/fake/__init__.py,sha256=ufPQ7JdEkz7fQAiwb-LfHwrKzBFZrpiwk-8Hh8oI_XI,479
-kvirt/providers/gcp/__init__.py,sha256=e7LZtqq5cCwn_6k6RfhoxhVnM6WVChwdC8se5_1T-Zc,75004
+kvirt/providers/gcp/__init__.py,sha256=AmF805BSxzqAbMQ844p3Pg3W0d_IbMR0hKeXJ1cPqgw,75060
 kvirt/providers/gcp/gcp-hack.service,sha256=gG35O6KTLlGqIMwrSBqb_id-h3SWm_us_yLkLfQelOw,175
 kvirt/providers/gcp/gcp-hack.sh,sha256=K4ZDgWo9AoysBEMAZW3pj_5_1KmQAz0th49EqamsLVY,231
-kvirt/providers/ibm/__init__.py,sha256=eJErZ4CIDwejrru1w-dLMYrzm1SXrLgxg6w3udsGx0M,65166
+kvirt/providers/ibm/__init__.py,sha256=kh_5Uce4ly5Mx5k5Fa9meFO3se48nPt-1D8x9xtG2Tw,65205
 kvirt/providers/kubevirt/__init__.py,sha256=3akplzHJmP6bpYm0XHeuxnnY7YQcSYFxunUgZU9dWeo,81078
-kvirt/providers/kvm/__init__.py,sha256=zUH7QZ8LRlJXY_a6PvURYquCdZxag37BNeyaPIby_Wk,186884
+kvirt/providers/kvm/__init__.py,sha256=6ul2vBR003D9CwTxrgOGyi0tKo4XQyzghuCMgHx1wAM,186846
 kvirt/providers/kvm/helpers.py,sha256=t2CLczaU-gWPXL6iglK2Mlu-85ErH59nkdSA50v18lM,1965
 kvirt/providers/openstack/__init__.py,sha256=koQucaeeFSRpxDizeYZ1PLm4HfsecpQSI56lUeKuS70,57194
 kvirt/providers/ovirt/__init__.py,sha256=SYfwN7vgif_SYn6L5CPqepWS7v5JYrw2aG2StSCU6qA,62662
 kvirt/providers/packet/__init__.py,sha256=z71vF3yFtt36u2xcIlDdpLtQ0Tvv30acFyllwPZ2qOo,31230
 kvirt/providers/proxmox/__init__.py,sha256=hW84JyLK7t7Zsqwrx1hYniqAxp38IyCnxRnTAyoWnIw,29262
 kvirt/providers/vsphere/__init__.py,sha256=-Yap7VbRjUjWI9mrvDnvGks5rW37UolJl7_wphBsnck,73215
 kvirt/providers/vsphere/helpers.py,sha256=F1rB_AHISd8TFYQ6eRolQmCVqU8KFAa36CCwjDj-vqw,13655
 kvirt/providers/vsphere/tagging.py,sha256=7RqFIUETSzHAjS0F_8-j145-_8lca7aDUsCxs4DhQVQ,4893
 kvirt/providers/web/__init__.py,sha256=5fTs7xbQ2TT9uCUp6TtYWQVl6ywsB-efH7_PgX1wrZI,21420
 kvirt/version/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-kvirt/version/git,sha256=7C7Xl75RVzh9fdRivkFkI00Y-5jZCaBmjZGgJRGwGHk,19
+kvirt/version/git,sha256=egLVGAycBO7ZLxyGM2Gmw8LNQWl4c-EDE7PGtohO0pU,19
 kvirt/web/__init__.py,sha256=mz6UtxtapEZzgWy-6KWw5pwNQUhUxWyHqFOh1HUlQZk,46652
 kvirt/web/main.py,sha256=DIb6tW3ce7wCc83kD9HBCG4ALJuLItp9uaP6tzdsm_Y,261
 kvirt/web/static/css/bootstrap-notify.css,sha256=ibUTW-jDj-F8d1T1KZ4DOujRmVTFfvMKL9y14QgEaPQ,408
 kvirt/web/static/css/bootstrap-theme.min.css,sha256=ZT4HPpdCOt2lvDkXokHuhJfdOKSPFLzeAJik5U_Q-l4,23409
 kvirt/web/static/css/bootstrap.min.css,sha256=E-dwlJxOS7dOrKCvR-5WCqiHCbIHLl59MMDVsfU4oiU,121125
 kvirt/web/static/css/dataTables.checkboxes.css,sha256=H-x4lWeyX3jMsghnkCUUTO2lXjRpJ8pxhUj3YAqaBrQ,399
 kvirt/web/static/css/jquery.dataTables.min.css,sha256=-Z1rYa3ys5OdZNUck5G7lBvb8A13OrYwvf-d8PfEaHQ,13587
@@ -601,13 +605,13 @@
 kvirt/web/templates/repos.html,sha256=HaFCTQjX3zSaqyV05Y_wG0vSkOWDpc-wj6Uj5TLbiFg,475
 kvirt/web/templates/repostable.html,sha256=6HH8sgdppR-yojQspdcI59ju4e9HZYVvV6uvnPxqbeo,1203
 kvirt/web/templates/vmcreate.html,sha256=FG3OoQEKTpeo8spJ1WiqYVkOp672saYRQKujNWOA3uQ,958
 kvirt/web/templates/vmprofiles.html,sha256=T65Cv7povhBtD2dyuWkWJE6byaA9EYtLSk5gtcQlHIU,486
 kvirt/web/templates/vmprofilestable.html,sha256=-8viNOqSvN_yzimENxq7Q0187zbflOn8p8zpgx0Vyek,1420
 kvirt/web/templates/vms.html,sha256=k2ptKeiLFdpzgfbk6xi__sduu0UALYXXrnrmDEmAfaQ,470
 kvirt/web/templates/vmstable.html,sha256=ikuYkIm_ocvGIBXFyJt1-tBjwQWCyqkgC08leoXgR54,4894
-kcli-99.0.202307131409.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
-kcli-99.0.202307131409.dist-info/METADATA,sha256=tVqcBRNAI8W9EHAOAXm1n8VVu15UmaZ1zFEBZde3ZJ4,3118
-kcli-99.0.202307131409.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-kcli-99.0.202307131409.dist-info/entry_points.txt,sha256=BrQuU8qI-1nidLF1G4COY5zxOvhu4akPk_teiSsx2D0,281
-kcli-99.0.202307131409.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
-kcli-99.0.202307131409.dist-info/RECORD,,
+kcli-99.0.202307131510.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
+kcli-99.0.202307131510.dist-info/METADATA,sha256=IaAHAoCE105JjdspGx_AILnoK7fgKizBZ_6JL7p7ycc,4172
+kcli-99.0.202307131510.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+kcli-99.0.202307131510.dist-info/entry_points.txt,sha256=BrQuU8qI-1nidLF1G4COY5zxOvhu4akPk_teiSsx2D0,281
+kcli-99.0.202307131510.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
+kcli-99.0.202307131510.dist-info/RECORD,,
```

